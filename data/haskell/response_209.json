[{"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1547063805, "post_id": 54117352, "comment_id": 95067465, "body": "The state is being threaded through the State monad. <code>addResult</code> is doing a <code>get</code> to retrieve the list so far, and then it uses <code>put</code> to put a new list into the state monad.  The initial state is the [] that is being fed to <code>execState</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1547068322, "post_id": 54117352, "comment_id": 95069359, "body": "As a complete tangent: this code triggers a very strong &quot;ICK&quot; reaction for me. <code>fizzbuzzList = map fizzBuzz . reverse</code> would be much more idiomatic. It&#39;s also much more obvious how to change the code in case you didn&#39;t want the answers backwards after all."}, {"owner": {"reputation": 195, "user_id": 10891762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a71b4e51a1e940199e9f59075f2e997?s=128&d=identicon&r=PG&f=1", "display_name": "Nirvin M", "link": "https://stackoverflow.com/users/10891762/nirvin-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1547090086, "post_id": 54117352, "comment_id": 95075007, "body": "@DanielWagner This code is from the book Haskell Programming from First Priniciples."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1547065716, "last_edit_date": 1547065716, "creation_date": 1547064429, "answer_id": 54117533, "question_id": 54117352, "link": "https://stackoverflow.com/questions/54117352/unable-to-understand-how-state-monad-get-its-state-in-this-code/54117533#54117533", "title": "Unable to understand how State Monad get it&#39;s state in this code", "body": "<p><code>State</code> can be thought of as being defined like</p>\n\n<pre><code>data State s a = s -&gt; (a, s)\n</code></pre>\n\n<p>which means that</p>\n\n<pre><code>Integer -&gt; State [String] ()\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>Integer -&gt; [String] -&gt; ((), [String])\n</code></pre>\n\n<p>So <code>addResult</code> takes an integer and returns a <em>function</em> that takes a state and returns a tuple containing the new state.</p>\n\n<p><code>mapM_</code>, roughly speaking, chains a group of these functions together. Using regular map would produce a list of <code>State</code> functions, each expecting a state and returning a new state. <code>mapM_</code> takes the further step of binding each <code>State</code> to the previous. The end result is not a list of <code>State</code> values, but a single <code>State</code> value that forms a pipeline.</p>\n\n<p><code>execState</code> then provides the initial state in one end of the pipeline, and returns the final state from the other end.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1547071801, "post_id": 54117837, "comment_id": 95070813, "body": "In what sense is <code>mapM</code> &quot;simpler&quot; than <code>mapM_</code>? Yes, there are more laws available to reason about it (none of which you&#39;ve used), but the actual function is actually a tad more complicated."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1547081110, "post_id": 54117837, "comment_id": 95073263, "body": "@dfeuer True. I suppose I was using &quot;simpler&quot; to mean &quot;more foundational&quot;; that is, you can get <code>mapM_</code> from <code>mapM</code> but not the other way around."}, {"owner": {"reputation": 195, "user_id": 10891762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a71b4e51a1e940199e9f59075f2e997?s=128&d=identicon&r=PG&f=1", "display_name": "Nirvin M", "link": "https://stackoverflow.com/users/10891762/nirvin-m"}, "edited": false, "score": 0, "creation_date": 1547091190, "post_id": 54117837, "comment_id": 95075203, "body": "Totally forgot the definition of mapM. Thanks for explaining."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 4, "last_activity_date": 1547065729, "creation_date": 1547065729, "answer_id": 54117837, "question_id": 54117352, "link": "https://stackoverflow.com/questions/54117352/unable-to-understand-how-state-monad-get-its-state-in-this-code/54117837#54117837", "title": "Unable to understand how State Monad get it&#39;s state in this code", "body": "<p>As you have correctly observed, the State monad is used to thread some external 'state' value through a series of computations. However, you ask how this state is 'persisted' across multiple invocations of your function <code>addResult :: Integer -&gt; State [String] ()</code> on each value of the list <code>list</code>. The trick is the definition of <code>mapM_</code>. We'll start by considering the simpler function <code>mapM</code>:</p>\n\n<pre><code>mapM f [] = return []\nmapM f (x:xs) = do\n    fx &lt;- f x\n    fxs &lt;- mapM f xs\n    return (fx : fxs)\n</code></pre>\n\n<p>If we mentally 'expand' this recursive definition out with, say, an example list <code>[x1,x2,x3,x4,...,xn]</code>, we'll observe that the value of <code>mapM f [x1,...,xn]</code> would be another monadic computation:</p>\n\n<pre><code>do\n    fx1 &lt;- f x1\n    fx2 &lt;- f x2\n    -- etc.\n    fxn &lt;- f xn\n    return [fx1,fx2,...,fxn]\n</code></pre>\n\n<p>So <code>mapM</code> basically 'sticks together' a bunch of monadic computations into one big one, by running them together in order. Which explains how you build up a list instead of producing many smaller ones: the <code>get</code> at the beginning of <code>addResult</code> gets the state <em>from the last run</em>, not from the beginning, because you're running all the computations together, like so:</p>\n\n<pre><code>do\n    fl0 &lt;- addResult (list !! 0)\n    fl1 &lt;- addResult (list !! 1)\n    -- etc. like before\n</code></pre>\n\n<p>(If you read carefully, you'll notice I've been talking about <code>mapM</code>, but you actually used <code>mapM_</code>. They're exactly the same, except that the latter returns <code>()</code>.)</p>\n"}], "owner": {"reputation": 195, "user_id": 10891762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a71b4e51a1e940199e9f59075f2e997?s=128&d=identicon&r=PG&f=1", "display_name": "Nirvin M", "link": "https://stackoverflow.com/users/10891762/nirvin-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 54117837, "answer_count": 2, "score": 2, "last_activity_date": 1547065729, "creation_date": 1547063511, "question_id": 54117352, "link": "https://stackoverflow.com/questions/54117352/unable-to-understand-how-state-monad-get-its-state-in-this-code", "title": "Unable to understand how State Monad get it&#39;s state in this code", "body": "<p>I kind of understand State Monad's usefulness it propagating new values in a sequential execution. But in the following code, I'm having trouble in understanding how and where <code>addResult</code> get it's updated state everytime it gets evaluated.</p>\n\n<pre><code>fizzBuzz :: Integer -&gt; String\nfizzBuzz n\n   | n `mod` 15 == 0 = \"FizzBuzz\"\n   | n `mod` 5 == 0 = \"Buzz\"\n   | n `mod` 3 == 0 = \"Fizz\"\n   | otherwise = show n\n\nfizzbuzzList :: [Integer] -&gt; [String]\nfizzbuzzList list = execState (mapM_ addResult list) []\n\naddResult :: Integer -&gt; State [String] ()\naddResult n = do\n    xs &lt;- get\n    let result = fizzBuzz n\n    put (result : xs)\n\nmain :: IO ()\nmain = mapM_ putStrLn $ fizzbuzzList [1..100]\n</code></pre>\n\n<p>This code evaluates to produce</p>\n\n<blockquote>\n  <p>1, 2, Fizz...</p>\n</blockquote>\n\n<p>I just couldn't figure out how the new value produced by <code>addResult</code> gets appended to the previously produced list. Can you please help me understand how <code>mapM_ addResult list</code> does it's stuff here?</p>\n"}, {"tags": ["haskell", "currying", "lambda-calculus", "function-composition"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062545, "post_id": 54117078, "comment_id": 95066939, "body": "the <code>.</code> operator only operates on functions (it is for function composition - that is, the result you get from first applying one function, then the other). So I don&#39;t see how you can think the return value of <code>t2</code> can be anything other than a function. (That&#39;s the <code>b1 -&gt; b2</code> part at the end of the type signature GHC has derived.)"}, {"owner": {"reputation": 111, "user_id": 2804705, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a18fdb95e5db202604e6051db8f6d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Minimax", "link": "https://stackoverflow.com/users/2804705/minimax"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062632, "post_id": 54117078, "comment_id": 95066980, "body": "I see, but why (b1-&gt;b2), why not (b1-&gt;b3)? how does it know it has the same type as the output of the right x function"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062642, "post_id": 54117078, "comment_id": 95066984, "body": "also, are you sure you didn&#39;t mean <code>x.y.z</code> on the right-hand side? It&#39;s strange to give it an argument <code>z</code> which isn&#39;t used at all to compute the function result. (GHC is giving this argument the type <code>p</code>, which as you will see, could be absolutely anything.)"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062733, "post_id": 54117078, "comment_id": 95067029, "body": "because <code>x . y . x</code> means &quot;apply <code>x</code> first, then apply <code>y</code> to the result, then apply <code>x</code> again to the result of that&quot;. If <code>x</code> has type <code>b1 -&gt; b2</code>, then you need a <code>b1</code> to get the process started (because <code>x</code> is applied first), and the compound function must return a <code>b2</code> (because <code>x</code> is also applied last)."}, {"owner": {"reputation": 111, "user_id": 2804705, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a18fdb95e5db202604e6051db8f6d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Minimax", "link": "https://stackoverflow.com/users/2804705/minimax"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062757, "post_id": 54117078, "comment_id": 95067042, "body": "@RobinZigmond Yes I was testing how and where unused parameters show up in the type signature. It is confusing to me why it shows up right after (b2-&gt;b1), and why are the types b1 and b2 applied after p? It&#39;s so confusing..."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547062919, "post_id": 54117078, "comment_id": 95067116, "body": "the <code>-&gt;</code> arrow in Haskell type signatures is right associative, meaning you can also read this type as <code>(b1 -&gt; b2) -&gt; (b2 -&gt; b1) -&gt; p -&gt; (b1 -&gt; b2)</code>. [This fact is just an alternative way of describing how all functions in Haskell are curried.] Looked at in this way, you can see that it takes 2 functions (the second of which maps from the target type of the first back to its source type) and one other argument of any type, and returns a function of the same type as the first argument. Hopefully you can see how this matches the explicit formula you&#39;ve given for it?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1547063310, "last_edit_date": 1547063310, "creation_date": 1547062952, "answer_id": 54117219, "question_id": 54117078, "link": "https://stackoverflow.com/questions/54117078/what-is-the-type-of-this-haskell-double-function-composition/54117219#54117219", "title": "What is the type of this haskell double function composition?", "body": "<p>First let's rewrite this in a way that makes it clear which argument corresponds to which part of the type signature:</p>\n\n<pre><code>t2 :: (b1-&gt;b2) -&gt; (b2-&gt;b1) -&gt; p -&gt; b1 -&gt; b2\nt2    x           y           z  = x . y . x\n</code></pre>\n\n<p><code>z :: p</code> isn't used at all, so we can easily eliminate this by instead considering</p>\n\n<pre><code>t3 :: (b1-&gt;b2) -&gt; (b2-&gt;b1) -&gt; b1 -&gt; b2\nt3    x           y         = x . y . x\n</code></pre>\n\n<p>Why is that the type? Well, the composition chain feeds the result of <code>x</code> into <code>y</code>, and the result of <code>y</code> back into <code>x</code>. In other words, <code>y</code> gets you from the result type of <code>x</code> back to the argument type of <code>x</code>. Therefore the type of <code>y</code> must be the \u201cinverted\u201d type of <code>x</code>. So</p>\n\n<pre><code>t3 :: (m-&gt;n) -&gt; (n-&gt;m) -&gt; ?\nt3    x         y       = x . y . x\n</code></pre>\n\n<p>The type of the composition is dominated by the \u201couter ends\u201d, i.e. the argument must be the type of argument for <code>x</code> and the result must be the type of result of... again, <code>x</code>. Hence</p>\n\n<pre><code>t3 :: (m-&gt;n) -&gt; (n-&gt;m) -&gt; m-&gt;n\nt3    x         y       = x.y.x\n</code></pre>\n\n<p>which is what GHCi told you, with renamed type variables.</p>\n"}], "owner": {"reputation": 111, "user_id": 2804705, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a18fdb95e5db202604e6051db8f6d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Minimax", "link": "https://stackoverflow.com/users/2804705/minimax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 54117219, "answer_count": 1, "score": 0, "last_activity_date": 1602288077, "creation_date": 1547062294, "last_edit_date": 1602288077, "question_id": 54117078, "link": "https://stackoverflow.com/questions/54117078/what-is-the-type-of-this-haskell-double-function-composition", "title": "What is the type of this haskell double function composition?", "body": "<p><code>t2 = (\\x y z-&gt; x.y.x)</code></p>\n\n<p>GHCI shows me this:</p>\n\n<p><code>t2 :: (b1 -&gt; b2) -&gt; (b2 -&gt; b1) -&gt; p -&gt; b1 -&gt; b2</code></p>\n\n<p>I can't quite grasp it how this type signature comes to be. So far I've figured that the righter-most x is basically a function which takes a <code>b2</code> and returns a <code>b1</code>, then that <code>b1</code> is the input of the middle function <code>y</code>, and outputs <code>b2</code>again? Should it not return a value of a new type <code>b3</code>or something? </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1547058311, "post_id": 54115620, "comment_id": 95065159, "body": "I had this problem some time ago. To be honest, I still have it: <code>stack setup</code> fails for ghc-8-6-3 (tinfo6 variant) install. Somehow it does not really seem to matter: I can run <code>stack build</code> in the same directory just fine afterwards. I suspect it will come to bite me one day, but for now it works. Could you try if you can actually build after the failed setup?"}, {"owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1547058393, "post_id": 54115620, "comment_id": 95065195, "body": "Unfortunately, it doesn&#39;t for me. But I found some informations and will update my question accordingly."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1547058733, "post_id": 54115620, "comment_id": 95065352, "body": "Wait, what just happened. I cleaned up my ghc-8-6-3 install to test this, and ghc run ok-ishly - there was an error due to missing export lists, so I assumed it would work. Just to be sure I&#39;ve fixed the missing lists, and it blew up with exactly the same linker errors. So I did do something to make it work before. Oh well. I feel very stupid."}], "answers": [{"tags": [], "owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "is_accepted": false, "score": 2, "last_activity_date": 1547058733, "creation_date": 1547058733, "answer_id": 54116285, "question_id": 54115620, "link": "https://stackoverflow.com/questions/54115620/stack-how-to-build-with-lts-13-2-i-want-to-use-newer-libraries/54116285#54116285", "title": "Stack: how to build with lts-13.2? I want to use newer libraries", "body": "<p>Apparently, this is a re-emergence of an old problem: <a href=\"https://github.com/commercialhaskell/stack/issues/4497\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/4497</a></p>\n\n<p>Seems some config tool sets <code>(\"C compiler supports -no-pie\", \"NO\")</code> in <code>~/.stack/programs/x86_64-linux/ghc-tinfo6-8.6.3/lib/ghc-8.6.3/settings</code> wrongly; changing this manually to <code>YES</code> will let me build my project. </p>\n\n<p>So this problem is apparently a bug in one of the generator tools stack uses. Mind this is a \"hotfix\"; follow the issue on Github with the link I provided to stay up to date.</p>\n"}], "owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1547058733, "creation_date": 1547055573, "last_edit_date": 1547055971, "question_id": 54115620, "link": "https://stackoverflow.com/questions/54115620/stack-how-to-build-with-lts-13-2-i-want-to-use-newer-libraries", "title": "Stack: how to build with lts-13.2? I want to use newer libraries", "body": "<p>I am using stack for some of my Haskell projects. Up until now, I was having no trouble; but since lts-13.1 I get a weird built error.</p>\n\n<p>When I setup up a new project with <code>stack new foo &amp;&amp; cd foo</code>, and then run <code>stack setup --ghc-build standard</code>, I get this huge repetitive error message:</p>\n\n<pre><code>/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Interpreter.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(CheckUnload.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(CheckUnload.thr_o): requires dynamic R_X86_64_32 reloc against 'linker_unloaded_mutex' which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Scav.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Compact.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Compact.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Compact.thr_o): requires dynamic R_X86_64_32 reloc which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Evac_thr.thr_o): requires dynamic R_X86_64_32 reloc against 'stg_WHITEHOLE_info' which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Evac_thr.thr_o): requires dynamic R_X86_64_32 reloc against 'stg_WHITEHOLE_info' which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(MarkWeak.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(MarkWeak.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(MarkWeak.thr_o): requires dynamic R_X86_64_32 reloc which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Evac.thr_o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libHSrts_thr.a(Evac.thr_o): requires dynamic R_X86_64_32 reloc against 'stg_WHITEHOLE_info' which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libCffi.a(ffi64.o): requires unsupported dynamic reloc 11; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libCffi.a(unix64.o): requires dynamic R_X86_64_PC32 reloc against 'abort' which may overflow at runtime; recompile with -fPIC\n/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libCffi.a(ffiw64.o): requires dynamic R_X86_64_32 reloc against 'ffi_closure_win64' which may overflow at runtime; recompile with -fPIC\n</code></pre>\n\n<p>...hundreds more of the same...</p>\n\n<pre><code>/usr/bin/ld.gold: error: /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/lib/ghc-8.6.3/rts/libCffi.a(win64.o): requires dynamic R_X86_64_PC32 reloc against 'abort' which may overflow at runtime; recompile with -fPIC\nclang-7: error: linker command failed with exit code 1 (use -v to see invocation)\n`clang' failed in phase `Linker'. (Exit code: 1)\n\n--  While building simple Setup.hs using:\n      /home/georg/.stack/programs/x86_64-linux/ghc-8.6.3/bin/ghc -rtsopts -threaded -clear-package-db -global-package-db -hide-all-packages -package base -main-is StackSetupShim.mainOverride -package Cabal-2.4.0.1 /home/georg/.stack/setup-exe-src/setup-mPHDZzAJ.hs /home/georg/.stack/setup- \n   exe-src/setup-shim-mPHDZzAJ.hs -o /home/georg/.stack/setup-exe-cache/x86_64- \n   linux/tmp-Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.3\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I think this has something to do with lts-13.1/2 or my Arch Linux/gcc installation, because when I change <code>resolver: lts-13.2</code> to <code>resolver: lts-12.4</code> in <code>stack.yaml</code>, it builds fine.</p>\n\n<p>I tried different options for <code>--ghc-build</code> to no avail; switched between clang and gcc; all my stack and other local Haskell packages are up to date (I'm on Arch Linux).</p>\n\n<p>I want to use the latest version of Megaparsec 7.0.4, which is not part of lt-12.4 (version 6.5). I can work around this problem with dependency options in stack/cabal, but I wonder why not even an empty/new project won't build with lts-13.2 on my machine (lts-13.1 won't work either). <a href=\"https://github.com/commercialhaskell/stack/issues/3518\" rel=\"nofollow noreferrer\">This problem</a> is very similiar to mine, but none the solutions presented there work for me.</p>\n\n<p>What am I missing? </p>\n"}, {"tags": ["haskell", "networking", "tcp"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547054312, "post_id": 54115168, "comment_id": 95063339, "body": "Side comment: If the default <code>Binary</code> instances don&#39;t do what you want, it doesn&#39;t seem like a good idea to have them around at all."}, {"owner": {"reputation": 23, "user_id": 9977351, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nxet3NKlxR4/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2SnFfqLIysTbxPyBeqdI65MmJmog/mo/photo.jpg?sz=128", "display_name": "Lalit Nankani", "link": "https://stackoverflow.com/users/9977351/lalit-nankani"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547054586, "post_id": 54115168, "comment_id": 95063483, "body": "@Li-yaoXia I have posted the same code I was trying out. I was not sure if there was a way to do it with binary and posted the code for suggestions and improvements. I will remove it once I am sure if that&#39;s not going to work at all for my use case."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9977351, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nxet3NKlxR4/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2SnFfqLIysTbxPyBeqdI65MmJmog/mo/photo.jpg?sz=128", "display_name": "Lalit Nankani", "link": "https://stackoverflow.com/users/9977351/lalit-nankani"}, "edited": false, "score": 0, "creation_date": 1547056552, "post_id": 54115594, "comment_id": 95064420, "body": "What will be the implementation of putRequest? As one can also give say less than 12 characters for password: (i.e.: a1234)"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 23, "user_id": 9977351, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nxet3NKlxR4/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2SnFfqLIysTbxPyBeqdI65MmJmog/mo/photo.jpg?sz=128", "display_name": "Lalit Nankani", "link": "https://stackoverflow.com/users/9977351/lalit-nankani"}, "edited": false, "score": 0, "creation_date": 1547057473, "post_id": 54115594, "comment_id": 95064784, "body": "When you construct a <code>Password</code> value with a bytestring shorter than 12 you could pad it with <code>&#39;\\0&#39;</code>. A <code>Password</code> is then directly serialized using <code>putByteString</code> because you still have the invariant that it has fixed length."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1547055798, "last_edit_date": 1547055798, "creation_date": 1547055457, "answer_id": 54115594, "question_id": 54115168, "link": "https://stackoverflow.com/questions/54115168/how-can-we-serialize-deserialize-a-haskell-data-struct-to-bytestring/54115594#54115594", "title": "How can we serialize &amp; deserialize a Haskell Data Struct to Bytestring?", "body": "<p>To address the main question first, you can parse bytestrings of a known length with <code>getByteString</code> (or <code>getLazyByteString</code>). So a binary parser for <code>Request</code> could be:</p>\n\n<pre><code>parseRequest :: Get Request\nparseRequest =\n  Request\n    &lt;$&gt; parseHeader\n    &lt;*&gt; getByteString 14\n    &lt;*&gt; getByteString 12\n</code></pre>\n\n<p>If you also have a serializers, say <code>putRequest</code>, you can put it in a <code>Binary</code> instance with the parser, allowing you to use some more functions of the library for convenience (but you don't have to).</p>\n\n<pre><code>instance Binary Request where\n  get = parseRequest\n  put = putRequest\n</code></pre>\n\n<hr>\n\n<p>To avoid mixing up password and id, it seems a good idea to wrap them in newtypes:</p>\n\n<pre><code>newtype UniqueID = MkUniqueID ByteString  -- length 14\nnewtype Password = MkPassword ByteString  -- length 12\n</code></pre>\n\n<p>When implementing operations on those, make sure that they don't construct values of the wrong length. Then you can hide the constructors when exporting the types, so that users cannot break those invariants.</p>\n\n<p>The parsers for those types are where you specify the lengths you want:</p>\n\n<pre><code>parseUniqueID :: Get UniqueID\nparseUniqueID = MkUniqueID &lt;$&gt; getByteString 14\n\nparsePassword :: Get Password\nparsePassword = MkPassword &lt;$&gt; getByteString 12\n</code></pre>\n\n<p>Now this makes the definition of <code>Request</code> more descriptive, the only way to mix a password and an ID in Haskell code is to get the order wrong in serialization/deserialization, so this reduces the potential for mistakes elsewhere.</p>\n\n<pre><code>data Request = Request\n  { header   :: Header\n  , uniqueID :: UniqueID\n  , password :: Password\n  }\n\nparseRequest :: Get Request\nparseRequest =\n  Request\n    &lt;$&gt; parseHeader\n    &lt;*&gt; parseUniqueID\n    &lt;*&gt; parsePassword\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9977351, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nxet3NKlxR4/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2SnFfqLIysTbxPyBeqdI65MmJmog/mo/photo.jpg?sz=128", "display_name": "Lalit Nankani", "link": "https://stackoverflow.com/users/9977351/lalit-nankani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 54115594, "answer_count": 1, "score": 1, "last_activity_date": 1547063666, "creation_date": 1547053737, "last_edit_date": 1547063666, "question_id": 54115168, "link": "https://stackoverflow.com/questions/54115168/how-can-we-serialize-deserialize-a-haskell-data-struct-to-bytestring", "title": "How can we serialize &amp; deserialize a Haskell Data Struct to Bytestring?", "body": "<p>I have a TCP Server written in C++, which expects a request in following format:</p>\n\n<pre><code>struct Header {\n   int headerField1;\n   int headerField2;\n}\n\nstruct Request {\n   Header header;\n   char[14] uniqueID;\n   char[12] password;\n}\n</code></pre>\n\n<p>I want to implement a client to send this request to my server in Haskell</p>\n\n<p>I have tried Data.Binary.encode which doesn't do the trick.\nI am more confused how can I use a arbitrary sized type in haskell. i.e. char[12];</p>\n\n<p><strong>Haskell Code:</strong></p>\n\n<pre><code>data Header = Header \n  {\n     headerField1   :: Word32\n  ,  headerField2   :: Word32\n  } deriving (Generic)\ninstance Binary Header\n\ndata Request = Request \n  {\n     header         :: Header\n  ,  uniqueID       :: ByteString -- I am not sure which data type to use here.\n  ,  password       :: ByteString -- Same as above, as length is defined 12 bytes which is arbitrary.\n  } deriving (Generic)\ninstance Binary Request\n</code></pre>\n\n<p>I have written a custom bytestring to data parser which works great for header as there are no arbitrary sized type</p>\n\n<pre><code>parseHeader = do\n    Header &lt;$&gt; \n        getWord32le &lt;*&gt;\n        getWord32le\n</code></pre>\n\n<p>I am looking for a Haskell way to do the serialization &amp; deserialization of the packet structure defined to ByteString (and vice versa) along with a way to create arbitrary sized data type -- char[12]</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "edited": false, "score": 0, "creation_date": 1547048140, "post_id": 54113299, "comment_id": 95059509, "body": "Ah. So there <i>was</i> something obvious I was missing. Thank you :)"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1547047324, "creation_date": 1547047324, "answer_id": 54113299, "question_id": 54112996, "link": "https://stackoverflow.com/questions/54112996/how-do-i-set-haskell-benchmarking-up-with-stacks-package-yaml/54113299#54113299", "title": "How do I set Haskell benchmarking up with Stack&#39;s package.yaml?", "body": "<p><code>package.yaml</code> is a configuration processed by the tool <strong>hpack</strong>, which stack just calls. From <a href=\"https://github.com/sol/hpack#quick-reference\" rel=\"nofollow noreferrer\">the doc of hpack</a> we can see that there is a <code>benchmarks</code> field, that works mostly like <code>tests</code>.</p>\n"}], "owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 54113299, "answer_count": 1, "score": 0, "last_activity_date": 1547047324, "creation_date": 1547046206, "question_id": 54112996, "link": "https://stackoverflow.com/questions/54112996/how-do-i-set-haskell-benchmarking-up-with-stacks-package-yaml", "title": "How do I set Haskell benchmarking up with Stack&#39;s package.yaml?", "body": "<p>I keep seeing directions to set benchmarking up in my project's foo.cabal file, but surely there is a way to set it up in package.yaml?</p>\n\n<p>Is there something obvious I'm missing?</p>\n"}, {"tags": ["haskell", "types", "applicative", "haskell-lens"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547047824, "post_id": 54112068, "comment_id": 95059318, "body": "<code>setThis</code> expects a lens, i.e., that you can always set or get exactly one value. However, the optic <code>dmsTypes . _Just . _j</code> is not a lens, because there is nothing to set or get if the <code>_dmsTypes</code> field is <code>Nothing</code>. What would you like to do with this <code>Nothing</code>?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547048937, "post_id": 54112068, "comment_id": 95060034, "body": "@Li-yaoXia Oh! That makes a lot of sense. If <code>_dmsTypes</code> is <code>Nothing</code> I would want it propagated. So if <code>setThis</code> encounters <code>Nothing</code> in the set I get the data from, it should do nothing. The function should only &#39;set&#39; something in the <code>dataType2</code> if <code>_dmsTypes</code> is <code>Just x</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547052393, "post_id": 54112068, "comment_id": 95062235, "body": "Hm, does my answer do what you want if <code>_j</code> is <code>Nothing</code> in <code>dataType1</code> but <code>Just _</code> in <code>dataType2</code>, or the other way around? Or does it not matter?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1547053630, "post_id": 54112068, "comment_id": 95062966, "body": "It does. Since I&#39;m using applicative operators, the behaviour is similar to fmap on <code>Just</code> but simple addition on <code>Nothing</code>"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1547049879, "creation_date": 1547049879, "answer_id": 54114046, "question_id": 54112068, "link": "https://stackoverflow.com/questions/54112068/how-do-i-add-an-applicative-context-to-a-type-expected-by-lens-mydatatype/54114046#54114046", "title": "How do I add an Applicative context to a type expected by Lens&#39; MyDataType?", "body": "<p>Since the thing <code>func</code> points at might not exist, it should be a <em>traversal</em> (any number of focused values) rather than a <em>lens</em> (exactly one focused value).</p>\n\n<p>The part of <code>setThis</code> that uses a <em>setter</em> (i.e., <code>(%~)</code>) remains the same, but the <em>getter</em> part (i.e., <code>(^.)</code>) should instead use a <em>fold</em>, with <code>(^?)</code>. In that case, <code>dataType1 ^? func</code> will have two layers of <code>Maybe</code>, one from <code>(^?)</code> and one from <code>func</code> (in what is currently <code>f0</code>), that you'll probably want to flatten with <code>join</code>.</p>\n\n<pre><code>baseState = join (dataType1 ^? func)\n</code></pre>\n\n<p>Now <code>f0</code> must be <code>Maybe</code>.</p>\n\n<pre><code>setThis :: Traversal' MyDataType1 (Maybe Float) -&gt; ...\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 54114046, "answer_count": 1, "score": 0, "last_activity_date": 1547049879, "creation_date": 1547043088, "question_id": 54112068, "link": "https://stackoverflow.com/questions/54112068/how-do-i-add-an-applicative-context-to-a-type-expected-by-lens-mydatatype", "title": "How do I add an Applicative context to a type expected by Lens&#39; MyDataType?", "body": "<p>I have a function generalized over a function <code>func</code> to be applied on <code>MyDataType1</code> and another <code>MyDataType1</code> like this</p>\n\n<pre><code>setThis :: (Functor f0, Applicative f0) =&gt; Lens' MyDataType1 (f0 Float) -&gt; Float -&gt; MyDataType1 -&gt; MyDataType1 -&gt; MyDataType1         \nsetThis func toThis dataType1 dataType2 = dataType2 &amp; func %~ (\\a -&gt; (+) &lt;$&gt; a &lt;*&gt; delta\n    where baseStat = dataType1 ^. func -- baseStat has type Maybe Float\n          delta = (\\a -&gt; toThis * a) &lt;$&gt; baseStat -- also have type Maybe Float\n</code></pre>\n\n<p>where <code>MyDataType1</code> is (when used with <code>print</code>. Every numeric value is a <code>Float</code>)</p>\n\n<pre><code>data MyDataType1 = MyDataType1 { _name = Just \"First\"\n                               , _length = Just 5.5 \n                               , _dmsTypes = Just\n                                     ( DMS { _i = Just 1.9\n                                           , _j = Nothing\n                                           , _k = Just 95.9\n                                           }\n                                      )\n                               }\n</code></pre>\n\n<p>The function <code>setThis</code> given a default record function like <code>length</code>, a constant <code>Float</code>, <strong>a data set to get base value from</strong> and <strong>a data set to modify</strong>, sets <code>_length</code> to a number that's a sum of the original value and the value from the other set multiplied by some constant.</p>\n\n<p>It works just as I expect when given function <code>length</code>.</p>\n\n<p>What I want to do is have the exact same behavior when given a function like <code>(dmsTypes . _j)</code> as in</p>\n\n<pre><code>setThis (dmsTypes . _Just . _j) 0.3 (someY) (someY) -- someY :: MyDataType1 \n</code></pre>\n\n<p>Although GHC throws this error if I do just that</p>\n\n<pre><code>Could not deduce (Applicative f) arising from a use of \u2018_Just\u2019\n  from the context: Functor f\n    bound by a type expected by the context:\n               Lens' MyDataType1 (Maybe Float)\nPossible fix:\n    add (Applicative f) to the context of\n      a type expected by the context:\n        Lens' MyDataType1 (Maybe Float)\n</code></pre>\n\n<p>And while it seems like GHC knows exactly what I should do, I don't know how to do it.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1547049442, "post_id": 54108567, "comment_id": 95060395, "body": "You will likely need to poke around in <a href=\"http://hackage.haskell.org/package/ghc\" rel=\"nofollow noreferrer\">the GHC API</a>, though I don&#39;t have enough experience with it to write a proper answer."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1547053469, "post_id": 54108567, "comment_id": 95062876, "body": "<code>:browse</code> uses the .hi files that are part of the package. Not nearly a complete answer, but at least a place to start looking."}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1547178320, "post_id": 54108567, "comment_id": 95111604, "body": "@DanielWagner Thanks. That is something quite new to me...."}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1547178396, "post_id": 54108567, "comment_id": 95111611, "body": "@Carl Thanks. I saw something. Maybe suits me."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1549319848, "post_id": 54108567, "comment_id": 95853092, "body": "@Magicloud Are the other modules compiling? If so, this is quite simple with the GHC API: use <code>depanal</code> to compute the <code>ModuleGraph</code>, then look at the <code>ms_textual_imps</code> field of the <code>ModSummary</code>&#39;s in that graph."}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547032441, "creation_date": 1547031478, "last_edit_date": 1547032441, "question_id": 54108567, "link": "https://stackoverflow.com/questions/54108567/how-does-ghci-browse-imported-modules", "title": "How does GHCi &quot;:browse&quot; imported modules?", "body": "<p>I am working on generating codes, for which I need to know some information of other modules.</p>\n\n<p>If I had the source of that module, haskell-src-exts is a way to go.</p>\n\n<p>But what if I do not have the source? I see GHCi do something like this, but could not figure out what is the key.</p>\n\n<p>TemplateHaskell's reifyModule only gives module relationships. Did I miss anything? Or there are other ways to go?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547029094, "post_id": 54107722, "comment_id": 95047673, "body": "Try using <code>filter</code> together with the modulo function"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1547029178, "post_id": 54107722, "comment_id": 95047717, "body": "What is &quot;unwanted form&quot; mean ?"}, {"owner": {"reputation": 13, "user_id": 10888820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90492919f3cfe184bd1e55516414c514?s=128&d=identicon&r=PG&f=1", "display_name": "csstudent", "link": "https://stackoverflow.com/users/10888820/csstudent"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1547029595, "post_id": 54107722, "comment_id": 95047966, "body": "@talex My current solution gives:      ghci&gt; take 10 (function [3,5]) ---&gt;     [3,5,6,10,9,15,12,20,15,25]      (1*3, 1*5, 2*3, 2*5, 3*3, 3*5, 4*3, 4*5, 5*3, 5*5),  but it should be sorted ascending like      [3,5,6,9,10,12,15,18,20,21]      (1*3, 1*5, 2*3, 3*3, 2*5, 4*3, 3*5, 5*3, 4*5, 6*3)"}, {"owner": {"reputation": 6008, "user_id": 1983772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f429722c8167802b89cbe4d324aa1e?s=128&d=identicon&r=PG", "display_name": "Norrius", "link": "https://stackoverflow.com/users/1983772/norrius"}, "edited": false, "score": 2, "creation_date": 1547031833, "post_id": 54107722, "comment_id": 95049480, "body": "Instead of starting with nothing and adding &quot;correct&quot; numbers, try starting with all numbers and removing &quot;wrong&quot; numbers."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1547032801, "post_id": 54107722, "comment_id": 95050004, "body": "<code>[d*x | x &lt;- [1..]]</code> could be simplified to <code>[d, d+d ..]</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547035876, "post_id": 54107722, "comment_id": 95051784, "body": "<code>map (d*) [1..]</code> is arguably more idiomatic (or at least I would say it is, but I&#39;m new to the language so my stylistic judgement could be off)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1547401143, "post_id": 54107722, "comment_id": 95171824, "body": "@RobinZigmond It&#39;s less efficient: For each new element you have to multiply <code>x</code> up from scratch, whereas my solution just has to add <code>x</code> to the previous result."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1547161450, "last_edit_date": 1547161450, "creation_date": 1547040369, "answer_id": 54111233, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers/54111233#54111233", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>If you want to do it with the modulo function, you can define a simple one-liner</p>\n\n<pre><code>foo ds = filter (\\x -&gt; any (== 0) [mod x d | d &lt;- ds]) [1..]\n</code></pre>\n\n<p>or, in the more readable form,</p>\n\n<pre><code>foo ds = filter p [1..]\n  where\n  p x = any id [ mod x d == 0 | d &lt;- ds]\n      = any (== 0) [ mod x d | d &lt;- ds]\n      = not $ null [ () | d &lt;- ds, mod x d == 0]\n      = null [ () | d &lt;- ds, mod x d /= 0]\n      = null [ () | d &lt;- ds, rem x d &gt; 0]\n</code></pre>\n\n<p>With this, we get</p>\n\n<pre><code>&gt; take 20 $ foo [3,5]\n[3,5,6,9,10,12,15,18,20,21,24,25,27,30,33,35,36,39,40,42]\n</code></pre>\n\n<p>But, it is inefficient: <code>last $ take 20 $ foo [300,500] == 4200</code>, so to produce those 20 numbers this code tests 4200. And it gets worse the bigger the numbers are.</p>\n\n<p>We should produce <code>n</code> numbers in time roughly proportional to <code>n</code>, instead.</p>\n\n<p>For this, first write each number's multiples in their own list:</p>\n\n<pre><code>[ [d*x | x &lt;- [1..]] | d &lt;- ds ] ==\n[ [d, d+d ..] | d &lt;- ds ] \n</code></pre>\n\n<p>Then, <em>merge</em> these ordered increasing lists of numbers in an ordered fashion to produce one ordered non-decreasing list of numbers. The package <a href=\"https://hackage.haskell.org/package/data-ordlist\" rel=\"nofollow noreferrer\"><code>data-ordlist</code></a> has many <a href=\"https://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html#g:3\" rel=\"nofollow noreferrer\">functions</a> to deal with this kind of lists:</p>\n\n<pre><code>import qualified Data.List.Ordered as O\nimport           Data.List               (sort)\n\nbar :: (Ord a, Num a, Enum a) =&gt; [a] -&gt; [a]\nbar ds = foldr    O.merge [] [ [d, d+d ..] | d &lt;- ds ]\n       = O.foldt' O.merge [] [ [d, d+d ..] | d &lt;- ds ]   -- more efficient, \n       = O.mergeAll [ [d, d+d ..] | d &lt;- sort ds ]       -- tree-shaped folding\n</code></pre>\n\n<p>If we want the produced list to not contain any duplicates, i.e. create an increasing list, we can change it to </p>\n\n<pre><code>baz ds = O.nub $ foldr O.merge [] [ [d, d+d ..] | d &lt;- ds ]\n       = foldr    O.union [] [ [d, d+d ..] | d &lt;- ds ]\n       = O.foldt' O.union [] [ [d, d+d ..] | d &lt;- ds ]\n       = O.unionAll [ [d, d+d ..] | d &lt;- sort ds ]\n       = (O.unionAll . map (iterate =&lt;&lt; (+)) . sort)  ds\n</code></pre>\n\n<p>Oh, and, unlike the quadratic <code>Data.List.nub</code>, <code>Data.List.Ordered.nub</code> is linear, spends <code>O(1)</code> time on each element of the input list.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1547161950, "post_id": 54111316, "comment_id": 95107994, "body": "BTW I tried to simplify your function and ended up with <code>function = O.nub . unfoldr g . map (iterate =&lt;&lt; (+))       where {       g mss = Just (m, s:r)                 where {                 ((m:s):r) = sortBy (comparing head) mss }}</code>,  which does seem like a nice encoding of <code>O.mergeAll</code> in  basic functions :)  under the assumption that the input list is <i>short</i>  (and contains only infinite lists, of course), so <code>sort</code> time isn&#39;t an issue. <code>O.</code> is short for <code>Data.List.Ordered</code> from <code>data-ordlist</code> package. :)"}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 1, "last_activity_date": 1547040623, "creation_date": 1547040623, "answer_id": 54111316, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers/54111316#54111316", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>The answer here just shows the idea, it is not a optimized solution, there may exists many way to implement it. </p>\n\n<p>Firstly, calculate all the value of each factors from the inputted list:</p>\n\n<pre><code>map (\\d-&gt;[d*x|x&lt;-[1..]]) xs\n</code></pre>\n\n<p>For example: <code>xs = [3, 5]</code> gives</p>\n\n<pre><code>[[3, 6, 9, ...], [5, 10, 15, ...]]\n</code></pre>\n\n<p>then, find the minimum value of 1st element of each list as:</p>\n\n<pre><code>findMinValueIndex::[(Int, [Int])]-&gt;Int\nfindMinValueIndex xss = minimum $ \n                        map fst $ \n                        filter (\\p-&gt; (head $ snd p) == minValue) xss\n    where minValue = minimum $ map (head . snd) xss\n</code></pre>\n\n<p>Once we found the list hold the minimum value, return it and remove the minimum value from list as:</p>\n\n<pre><code>sortMulti xss = \n            let idx = findMinValueIndex $ zip [0..] xss\n            in  head (xss!!idx):sortMulti (updateList idx (tail $ xss!!idx) xss\n</code></pre>\n\n<p>So, for example, after find the first value (i.e. <code>3</code>) of the result, the lists for find next value is:</p>\n\n<pre><code>[[6, 9, ...], [5, 10, 15, ...]]\n</code></pre>\n\n<p>repeat above steps we can construct the desired list. Finally, remove the duplicated values. Here is the completed coding:</p>\n\n<pre><code>import Data.Sequence (update, fromList)\nimport Data.Foldable (toList)\n\nfunction :: [Int] -&gt; [Int]\nfunction xs = removeDup $ sortMulti $ map (\\d-&gt;[d*x|x&lt;-[1..]]) xs\n    where sortMulti xss = \n            let idx = findMinValueIndex $ zip [0..] xss\n            in  head (xss!!idx):sortMulti (updateList idx (tail $ xss!!idx) xss)\n\nremoveDup::[Int]-&gt;[Int]\nremoveDup [] = []\nremoveDup [a] = [a]\nremoveDup (x:xs) | x == head xs = removeDup xs\n                 | otherwise = x:removeDup xs\n\nfindMinValueIndex::[(Int, [Int])]-&gt;Int\nfindMinValueIndex xss = minimum $ \n                        map fst $ \n                        filter (\\p-&gt; (head $ snd p) == minValue) xss\n    where minValue = minimum $ map (head . snd) xss\n\nupdateList::Int-&gt;[Int]-&gt;[[Int]]-&gt;[[Int]]\nupdateList n xs xss = toList $ update n xs $ fromList xss\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 1, "last_activity_date": 1547042910, "creation_date": 1547042910, "answer_id": 54112015, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers/54112015#54112015", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>There is a pretty nice recursive solution</p>\n\n<pre><code>function' :: Int -&gt; [Int]\nfunction' d = [d * x | x &lt;- [1..]]\n\nbraid :: [Int] -&gt; [Int] -&gt; [Int]\nbraid []        bs = bs\nbraid as        [] = as\nbraid aa@(a:as) bb@(b:bs) \n  | a &lt; b     = a:braid as bb\n  | a == b    = a:braid as bs # avoid duplicates\n  | otherwise = b:braid aa bs\n\nfunction :: [Int] -&gt; [Int]\nfunction ds = foldr braid [] (map function' ds)\n</code></pre>\n\n<p><code>braid</code> function builds the desired list \"on the fly\" using only input's head and laziness </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user10878951"}, "is_accepted": false, "score": 3, "last_activity_date": 1547049041, "creation_date": 1547049041, "answer_id": 54113779, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers/54113779#54113779", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>If you think of <code>d</code> being a factor not as </p>\n\n<pre><code>y = x * d \n</code></pre>\n\n<p>but instead</p>\n\n<pre><code>y `mod` d == 0,\n</code></pre>\n\n<p>then you can source the list comprehension from the list <code>[1..]</code> and add a predicate function, for example:</p>\n\n<pre><code>function ds \n    | null ds   = [1..]\n    | otherwise = [ x | x &lt;- [1..], qualifies x ]\n    where\n      qualifies x = any (==0) $ (flip mod) &lt;$&gt; ds &lt;*&gt; [x]\n</code></pre>\n\n<p>A more expressive version which is perhaps easier to grasp in the beginning:</p>\n\n<pre><code>function' ds   \n    | null ds   = [1..]\n    | otherwise = [ x | x &lt;- [1..], divByAnyIn ds x ]\n    where\n      divByAnyIn ds x = \n          case ds of\n            (d:ds') -&gt; if x `mod` d == 0 then True \n                                         else divByAnyIn ds' x\n            _       -&gt; False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1547194098, "post_id": 54119743, "comment_id": 95116127, "body": "You can think about this problem as &quot;I have a bunch of increasing streams and I have to create one single increasing stream out of them&quot;. The way I think about this is &quot;Let me define an accumulator <code>acc</code> and a function <code>f</code> that decide at each step which element from all streams goes into the accumulator&quot;. <code>f</code> should be recursive, since at each step you are doing the same. From this point of view, <code>foldr</code> over a recursive function looks as the perfect candidate. Just sharing my thoughts"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547229600, "post_id": 54119743, "comment_id": 95134628, "body": "@steve <code>combine</code> = <code>Data.List.Ordered.union</code>. :) recursive or not, it just combines two streams into one. you meant good &quot;insane&quot;, like thrilling, right? as for speed differences, you only hint at, not describe, but they make sense. see discussion of &quot;left-leaning&quot; vs &quot;right-leaning&quot; (and tree-like) folding on <a href=\"https://wiki.haskell.org/Prime_numbers\" rel=\"nofollow noreferrer\">wiki.haskell.org/Prime_numbers</a>. but only if you use more than 2 divisors; if there are 2 there shouldn&#39;t be any difference, as there&#39;s no deepening structure."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547229741, "post_id": 54119743, "comment_id": 95134676, "body": "you&#39;re folding it over a list of only 2 lists btw (if <code>xs == [2,3]</code>) (each <i>is</i> infinite of course). but it&#39;s possible to fold over n infinite list as well. examples at the aforementioned page, and in Data.List.Ordered. with it we can even call <code>O.unionAll [[n,n+n..] | n &lt;-[1..]]</code>. --- the 10x factor is because package functions are compiled."}, {"owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547296341, "post_id": 54119743, "comment_id": 95149300, "body": "The factor of 10 really is because it was not compiled. Compiling it gives a neck and neck race. @WillNess of course I mean the good &quot;insane&quot;"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547296439, "post_id": 54119743, "comment_id": 95149326, "body": "right. :) neck and neck because it is the same thing, essentially. you can see it in the source code."}, {"owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "edited": false, "score": 0, "creation_date": 1547297386, "post_id": 54119743, "comment_id": 95149544, "body": "well, not exactly. I am benchmarking against <code>j xs = foldr O.union [] [ [x, x+x ..] | x &lt;- xs ]</code> and folding O.union is still faster than my combine function."}, {"owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "edited": false, "score": 0, "creation_date": 1547298201, "post_id": 54119743, "comment_id": 95149736, "body": "but yes, you are absolutely right. It&#39;s basically the same."}], "tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": true, "score": 1, "last_activity_date": 1547222588, "last_edit_date": 1547222588, "creation_date": 1547075364, "answer_id": 54119743, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers/54119743#54119743", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>I have a one liner.</p>\n\n<pre><code>import Data.List (nub)\n\nf xs = nub [x|x&lt;-[1..], d&lt;-xs, x `mod` d == 0]\n\ntake 10 $ f [3,5] -- [3,5,6,9,10,12,15,18,20,21]\n</code></pre>\n\n<p>runtime should be O(n\u00b2 + n*d) from the resulting list. The <em>nub</em> runs in O(n\u00b2). Would be nice to get rid of it.</p>\n\n<pre><code>g xs = [x |x&lt;-[1..], let ys = map (mod x) xs in 0 `elem` ys]\n</code></pre>\n\n<p>This performs pretty ok. It should run in O (n*d). I also have this version which I thought performs at least as well as <em>g</em>, but apparently it performs better than <em>f</em> and worse than <em>g</em>.</p>\n\n<pre><code>h xs = [x |x&lt;-[1..], or [x `mod` d == 0 |d&lt;-xs] ]\n</code></pre>\n\n<p>I am not sure why that is, <em>or</em> is lazy as far as I can tell and I don`t see any reason why it should run slower. It especially does not scale as well when you increase the length of the input list.</p>\n\n<pre><code>i xs = foldr1 combine [[x, x+x ..] |x&lt;- sort xs]\n    where\n      combine l [] = l\n      combine [] r = r\n      combine l@(x:xs) r@(y:ys)\n        | x &lt; y = (x: combine xs r)\n        | x &gt; y = (y: combine l ys)\n        | otherwise = (x: combine xs ys)\n</code></pre>\n\n<p>Not a one liner anymore, but the fastest I could come up with. I am not a hundred percent sure why it makes such a big difference on runtime if you right or left fold and if you sort the input list in advance. But it should not make a difference on the result since:</p>\n\n<pre><code>commutative a b = combine [a] [b] == combine [b] [a]\n</code></pre>\n\n<p>I find it completely insane to think about this Problem in terms of folding a recursive function over a list of endless lists of multiples of input coefficients.</p>\n\n<p>On my System it is still about a factor of 10 slower than another solution presented here using Data.List.Ordered.</p>\n"}], "owner": {"reputation": 13, "user_id": 10888820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90492919f3cfe184bd1e55516414c514?s=128&d=identicon&r=PG&f=1", "display_name": "csstudent", "link": "https://stackoverflow.com/users/10888820/csstudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 0, "accepted_answer_id": 54119743, "answer_count": 5, "score": 1, "last_activity_date": 1547230335, "creation_date": 1547028831, "last_edit_date": 1547230335, "question_id": 54107722, "link": "https://stackoverflow.com/questions/54107722/how-to-make-a-sorted-list-of-multiples-for-several-numbers", "title": "How to make a sorted list of multiples for several numbers?", "body": "<p>I'm having trouble with an assignment from my Haskell class. I have already solved a partial problem of this task: I have to write a function that takes an Int and creates an infinite list with the multiples of that Int. </p>\n\n<pre><code>function :: Int -&gt; [Int]\nfunction d = [d*x | x &lt;- [1..]]\n</code></pre>\n\n<p><strong>Console:</strong></p>\n\n<pre><code>ghci&gt; take 10 (function 3)\n</code></pre>\n\n<p>gives </p>\n\n<pre><code>[3,6,9,12,15,18,21,24,27,30]\n</code></pre>\n\n<p>In the second task I have to extend the function so that it accepts a list of numbers and uses each value of that list as a factor (d previously). For example:</p>\n\n<pre><code>ghci&gt; take 10 (function [3, 5])\n</code></pre>\n\n<p>should give </p>\n\n<pre><code>[3,5,6,9,10,12,15,18,20,21]\n</code></pre>\n\n<p>Already tried a list comprehension like</p>\n\n<pre><code>function d = [y*x | y &lt;- [1..], x &lt;- d]\n</code></pre>\n\n<p>but the function returns the list in an unsorted form:</p>\n\n<pre><code>[3,5,6,10,9,15,12,20,15,25]\n</code></pre>\n\n<p>We got the tip that we should use the modulo function of Haskell, but I have no real idea how to proceed exactly. Do you have a good tip for me?</p>\n"}, {"tags": ["haskell", "haskell-lens", "type-signature"], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1547039211, "post_id": 54108026, "comment_id": 95053839, "body": "Thanks for the answer! Both version work perfectly! Also I had to add <code>(Functor f0, Applicative f0)</code> to the context of the type to permit the use of <code>&lt;$&gt;</code>, <code>&lt;+&gt;</code> &amp; <code>&lt;*&gt;</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1547040106, "last_edit_date": 1592644375, "creation_date": 1547029736, "answer_id": 54108026, "question_id": 54107702, "link": "https://stackoverflow.com/questions/54107702/what-would-be-the-type-signature-of-a-function-that-can-be-applied-both-like/54108026#54108026", "title": "What would be the type signature of a function that can be applied both like (&amp; f %~) and (^. f) where operators are from Lens library?", "body": "<p>Interesting question!</p>\n<blockquote>\n<p>I know here <code>basedOn ^. _func</code>, <code>_func</code> would have the type  <code>Getting (f0 Float) MyDataType (f0 Float)</code></p>\n<p>and here <code>toSetOn &amp; _func %~ (\\a -&gt; (+) &lt;$&gt; a &lt;*&gt; percentDelta</code>, <code>_func</code> would have the type  <code>ASetter Weapon Weapon (f0 Float) (f0 Float)</code></p>\n</blockquote>\n<p>So, informally, <code>_func</code> is both a getter and a setter. Looking at the diagram on <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">the lens homepage on Hackage</a> or the one on <a href=\"http://oleg.fi/gists/posts/2017-04-18-glassery.html\" rel=\"nofollow noreferrer\">the <em>Glassery</em> blogpost</a> by Oleg Grenrus, the &quot;least common ancestor&quot; of getters and setters is lenses.</p>\n<p>The lens library proposes at least two representations of lenses, a polymorphic one <code>Lens' Weapon (f0 Float)</code> (the definition contains a <code>forall</code>) and a monomorphic one <code>ALens' Weapon (f0 Float)</code> (that replaces the <code>forall</code> with a concrete functor).</p>\n<p>Since we expect here <code>_func</code> to automatically specialize to <code>ASetter</code> and <code>Getting</code>, one straightforward way is to use the polymorphic one (this requires <code>RankNTypes</code> if <code>_func</code> is a parameter rather than a toplevel binding).</p>\n<pre><code>_func :: Lens' Weapon (f0 Float)   -- Polymorphic\n      -- specializes to\n      :: Getting (f0 Float) Weapon (f0 Float)\n      :: ASetter' Weapon (f0 Float)\n</code></pre>\n<p>There is another way using the monomorphic version. I find this more idiomatic when <code>_func</code> is a function parameter, as it makes it easier for callers to pass in a suitable argument. However, we must then explicitly generalize <code>_func</code> when we actually use it.</p>\n<pre><code>_func :: ALens' Weapon (f0 Float)   -- Monomorphic\n\ncloneLens _func :: Lens' Weapon (f0 Float)  -- Polymorphic again\n\n-- The ALens' type synonym usually appears in argument position\nmyFun :: ALens' Foo Bar -&gt; MyResult\nmyFun _func = ...\n\n-- Example usage\nbasedOn ^. cloneLens _func\ntoSetOn &amp; cloneLens _func %~ ...\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54108026, "answer_count": 1, "score": 1, "last_activity_date": 1547040106, "creation_date": 1547028765, "last_edit_date": 1547038596, "question_id": 54107702, "link": "https://stackoverflow.com/questions/54107702/what-would-be-the-type-signature-of-a-function-that-can-be-applied-both-like", "title": "What would be the type signature of a function that can be applied both like (&amp; f %~) and (^. f) where operators are from Lens library?", "body": "<p>I have a function that gets a value from a record and sets it to the same field in a different record.</p>\n\n<p>What I want to do is understand how the mechanisms behind it works</p>\n\n<pre><code>setToPercent perc basedOn toSetOn = setStat\n    where baseStat = basedOn ^. _func -- type is Maybe Float\n          percentDelta = (\\a -&gt; perc * a) &lt;$&gt; baseStat -- Maybe Float\n          setStat = toSetOn &amp; _func %~ (\\a -&gt; (+) &lt;$&gt; a &lt;*&gt; percentDelta)\n</code></pre>\n\n<p>Where <code>_func</code> is defined as <code>MyDataType -&gt; Maybe Float</code> (default function from record syntax.)</p>\n\n<p>And it works just like I expect it to. What I want to know is <code>_func</code>'s type signature.</p>\n\n<p>I know here <code>basedOn ^. _func</code>, <code>_func</code> would have the type \n<code>Getting (f0 Float) MyDataType (f0 Float)</code></p>\n\n<p>and here <code>toSetOn &amp; _func %~ (\\a -&gt; (+) &lt;$&gt; a &lt;*&gt; percentDelta</code>, <code>_func</code> would have the type <code>ASetter Weapon Weapon (f0 Float) (f0 Float)</code>\nwhere data <code>Weapon</code> and <code>MyDataType</code> are basically the same data type with identical constructors.</p>\n\n<p>But I'm not sure what would be the overall type.\nAs in what would be the function type if I were to generalize <code>setToPercent</code> w.r.t <code>_func</code> as in</p>\n\n<pre><code>setToPercent fnToApply perc basedOn toSetOn = setStat\n    where baseStat = basedOn ^. fnToApply -- type is Maybe Float\n          percentDelta = (\\a -&gt; perc * a) &lt;$&gt; baseStat -- Maybe Float\n          setStat = toSetOn &amp; fnToApply %~ (\\a -&gt; (+) &lt;$&gt; a &lt;*&gt; percentDelta)\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1547016988, "post_id": 54104339, "comment_id": 95041544, "body": "Everything is morre or less correct. The only thing you seem to be misssing is that monadic code is not necessasrily more complex than non-monadic code. It just a bit different and takes a little getting used to."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1547020011, "post_id": 54104339, "comment_id": 95042835, "body": "Well, <i>is</i> <code>recover</code> still deterministic even when using a probabilistic prime checker? If it&#39;s only asymptotically deterministic (i.e. Monte Carlo), then it seems just proper to make that explicit with a <code>MonadRandom m =&gt; ...</code> signature."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1547105776, "last_edit_date": 1547105776, "creation_date": 1547024981, "answer_id": 54106540, "question_id": 54104339, "link": "https://stackoverflow.com/questions/54104339/using-state-monad-turns-all-of-my-functions-into-monadic-functions/54106540#54106540", "title": "Using State Monad turns all of my functions into monadic functions", "body": "<p>That is indeed a valid criticism of monads as they are implemented in Haskell. I don't see a better solution on the short term than what you mention, and switching all the code to monadic style is probably the most robust one, even though they are more heavyweight than the natural style, and indeed it can be a pain to port a large codebase, although it may pay off later if you want to add more external effects.</p>\n\n<p>I think algebraic effects can solve this elegantly, for examples:</p>\n\n<ul>\n<li><p><a href=\"http://math.andrej.com/eff/\" rel=\"nofollow noreferrer\">eff</a> (<a href=\"https://github.com/matijapretnar/eff/blob/master/examples/random.eff\" rel=\"nofollow noreferrer\">example program with randomness</a>)</p></li>\n<li><p><a href=\"https://www.fstar-lang.org/#introduction\" rel=\"nofollow noreferrer\">F*</a></p></li>\n</ul>\n\n<p>All functions are annotated with their effects <code>a -&gt; eff b</code>, however, contrary to Haskell, they can all be composed simply like pure functions <code>a -&gt; b</code> (which are thus a special case of effectful functions, with an empty effect signature). The language then ensures that effects form a semi-lattice so that functions with different effects can be composed.</p>\n\n<p>It seems difficult to have such a system in Haskell. Free(r) monads libraries allow composing types of effects in a similar way, but still require the explicit monadic style at the term level.\nOne interesting idea would be to overload function application, so it can be implicitly changed to <code>(&gt;&gt;=)</code>, but a principled way to do so eludes me. The main issue is that a function <code>a -&gt; m b</code> is seen as both an effectful function with effects in <code>m</code> and codomain <code>b</code>, and as a pure function with codomain <code>m b</code>. How can we infer when to use <code>($)</code> or <code>(&gt;&gt;=)</code>?</p>\n\n<p>In the particular case of randomness, I once had a somewhat related idea involving splittable random generators (shameless plug): <a href=\"https://blog.poisson.chat/posts/2017-03-04-splittable-generators.html\" rel=\"nofollow noreferrer\">https://blog.poisson.chat/posts/2017-03-04-splittable-generators.html</a></p>\n"}], "owner": {"reputation": 79, "user_id": 10887973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e6b11e3fc27c7a611b4c28761149f8e?s=128&d=identicon&r=PG&f=1", "display_name": "arcus_mannen", "link": "https://stackoverflow.com/users/10887973/arcus-mannen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 2, "accepted_answer_id": 54106540, "answer_count": 1, "score": 3, "last_activity_date": 1547105776, "creation_date": 1547015233, "question_id": 54104339, "link": "https://stackoverflow.com/questions/54104339/using-state-monad-turns-all-of-my-functions-into-monadic-functions", "title": "Using State Monad turns all of my functions into monadic functions", "body": "<p>I write a cryptography library in Haskell to learn about cryptography and monads. (<strong>Not</strong> for real-world use!) The type of my function for primality testing is</p>\n\n<pre><code>prime :: (Integral a, Random a, RandomGen g) =&gt; a -&gt; State g Bool\n</code></pre>\n\n<p>So as you can see I use the State Monad so I don't have the thread through the generator all the time. Internally the prime function uses the Miller-Rabin test, which rely on random numbers, which is why the prime function also must rely on random number. It makes sense in a way since the prime function only does a probabilistic test.</p>\n\n<p><em>Just for reference, the entire prime function is below, but I don't think you need to read it.</em></p>\n\n<pre><code>-- | findDS n, for odd n, gives odd d and s &gt;= 0 s.t. n=2^s*d.\nfindDS :: Integral a =&gt; a -&gt; (a, a)\nfindDS n = findDS' (n-1) 0\n  where\n    findDS' q s\n      | even q = findDS' (q `div` 2) (s+1)\n      | odd  q = (q,s)\n\n-- | millerRabinOnce n d s a does one MR round test on\n-- n using a.\nmillerRabinOnce :: Integral a =&gt; a -&gt; a -&gt; a -&gt; a -&gt; Bool\nmillerRabinOnce n d s a\n  | even n           = False\n  | otherwise        = not (test1 &amp;&amp; test2)\n  where\n    (d,s) = findDS n\n\n    test1 = powerModulo a d n /= 1\n    test2 = and $ map (\\t -&gt; powerModulo a ((2^t)*d) n /= n-1) \n                      [0..s-1]\n\n-- | millerRabin k n does k MR rounds testing n for primality.\nmillerRabin :: (RandomGen g, Random a, Integral a) =&gt;\n  a -&gt; a -&gt; State g Bool\nmillerRabin k n = millerRabin' k\n  where\n    (d, s)          = findDS n\n    millerRabin' 0 = return True\n    millerRabin' k = do\n      rest &lt;- millerRabin' $ k - 1\n      test &lt;- randomR_st (1, n - 1)\n      let this = millerRabinOnce n d s test\n      return $ this &amp;&amp; rest\n\n-- |\u00a0primeK k n. Probabilistic primality test of n\n-- using k Miller-Rabin rounds.\nprimeK :: (Integral a, Random a, RandomGen g) =&gt; \n  a -&gt; a -&gt; State g Bool\nprimeK k n\n  | n &lt; 2            = return False\n  | n == 2 || n == 3 = return True\n  |\u00a0otherwise        = millerRabin (min n k) n\n\n-- | Probabilistic primality test with 64 Miller-Rabin rounds.\nprime :: (Integral a, Random a, RandomGen g) =&gt; \n  a -&gt; State g Bool\nprime = primeK 64\n</code></pre>\n\n<p>The thing is, everywhere I need to use prime numbers, I have to turn that function into a monadic function too. Even where it's seemingly not any randomness involved. For example, below is my <em>former</em> function for recovering a secret in Shamir's Secret Sharing Scheme. A deterministic operation, right?</p>\n\n<pre><code>recover :: Integral a =&gt; [a] -&gt; [a] -&gt; a -&gt; a\nrecover pi_s si_s q = sum prods `mod` q\n  where\n    bi_s  = map (beta pi_s q) pi_s\n    prods = zipWith (*) bi_s si_s\n</code></pre>\n\n<p>Well that was when I used a naive, deterministic primality test function. I haven't rewritten the <code>recover</code> function yet, but I already know that the <code>beta</code> function relies on prime numbers, and hence it, and <code>recover</code> too, will. And both will have to go from simple non-monadic functions into two monadic function, even though the reason they use the State Monad / randomness is really deep down.</p>\n\n<p>I can't help but think that all the code becomes more complex now that it has to be monadic. Am I missing something or is this always the case in situations like these in Haskell?</p>\n\n<p>One solution I could think of is</p>\n\n<pre><code>prime' n = runState (prime n) (mkStdGen 123)\n</code></pre>\n\n<p>and use <code>prime'</code> instead. This solution raises two questions.</p>\n\n<ol>\n<li>Is this a bad idea? I don't think it's very elegant.</li>\n<li>Where should this \"cut\" from monadic to non-monadic code be? Because I also have functions like this <code>genPrime</code>:</li>\n</ol>\n\n<p>_</p>\n\n<pre><code>genPrime :: (RandomGen g, Random a, Integral a) =&gt; a -&gt; State g a\ngenPrime b = do\n  n  &lt;- randomR_st (2^(b-1),2^b-1)\n  ps &lt;- filterM prime [n..]\n  return $ head ps\n</code></pre>\n\n<p>The question becomes whether to have the \"cut\" before or after <code>genPrime</code> and the like.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 0, "creation_date": 1547023687, "post_id": 54102999, "comment_id": 95044576, "body": "Special thanks for advice on naming and qualified imports!"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 1, "creation_date": 1547075080, "post_id": 54102999, "comment_id": 95071855, "body": "@EPo: My pleasure. :) I prefer qualified imports generally; even though they\u2019re more verbose, they make it clearer where a name comes from when reading unfamiliar code. Also if a dependency adds a new export, an unqualified import can introduce clashes, but a qualified import can\u2019t."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 5, "last_activity_date": 1547005927, "creation_date": 1547005927, "answer_id": 54102999, "question_id": 54102979, "link": "https://stackoverflow.com/questions/54102979/algebraic-data-type-field-name-not-recognised/54102999#54102999", "title": "algebraic data type field name not recognised", "body": "<p>You need to export the fields of the data type:</p>\n\n<pre><code>module Convert (makeTables, Table(..)) where\n--                               ~~~~\n</code></pre>\n\n<p>Currently you only export the data type itself, so it\u2019s opaque\u2014the fields are private to the <code>Convert</code> module. This is useful if you want a data structure that can only be constructed or manipulated using a certain public API. (E.g. the \u201csmart constructor\u201d pattern.)</p>\n\n<p>Typically if you plan to import <code>Convert</code> unqualified, you would prefix the field names so they don\u2019t clash with anything:</p>\n\n<pre><code>data Table = Table\n  { tableHeaders :: [[String]]\n  , tableDataRows :: [[String]]\n  } deriving (Show)\n</code></pre>\n\n<p>But you can also leave them as-is and import the module qualified, e.g.:</p>\n\n<pre><code>import Convert (Table)\nimport qualified Convert\n\ntitles :: Table -&gt; [String]\ntitles t = map (intercalate \" \") (Convert.headers t)\n</code></pre>\n"}], "owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 54102999, "answer_count": 1, "score": 1, "last_activity_date": 1547005927, "creation_date": 1547005700, "question_id": 54102979, "link": "https://stackoverflow.com/questions/54102979/algebraic-data-type-field-name-not-recognised", "title": "algebraic data type field name not recognised", "body": "<p>I have a declaration of an algebraic data type\nin one module and use this data structure in another.</p>\n\n<p>In <code>Convert.hs</code> I have</p>\n\n<pre><code>module Convert (makeTables, Table) where\n\ndata Table = Table {\n    headers :: [[String]],\n    datarows :: [[String]]\n    }\n    deriving (Show)  \n-- ...\n</code></pre>\n\n<p>In another module I have:</p>\n\n<pre><code>import Convert\n\ntitles :: Table -&gt; [String]\ntitles t = map (intercalate \" \") (headers t)\n</code></pre>\n\n<p>The compiler apparently is aware of <code>Table</code> as it does pass the function signature. However, <code>headers</code> field name is not available:</p>\n\n<pre><code>    Variable not in scope: headers :: Table -&gt; [[[Char]]]\n   |\n10 | titles t = map (intercalate \" \") (headers t)\n   |                                   ^^^^^^^\n</code></pre>\n\n<p>Any remedies possible to this? Many thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 12, "last_activity_date": 1546995154, "creation_date": 1546995154, "answer_id": 54101836, "question_id": 54101478, "link": "https://stackoverflow.com/questions/54101478/overlapping-instances-that-dont-seem-to-overlap/54101836#54101836", "title": "Overlapping instances that don&#39;t seem to overlap", "body": "<p>The problem is that those instance indeed overlap, since the instance resolution mechanism only looks at the instance head when deciding which instance to take, and only later, <em>after</em> an instance has been chosen, it checks the constraints to see that it is met (and otherwise throws and error).  </p>\n\n<p>I suggest reading the documentation on <a href=\"https://downloads.haskell.org/~ghc/8.6.2/docs/html/users_guide/glasgow_exts.html#instance-declarations\" rel=\"noreferrer\">instance resolution</a>  </p>\n\n<p>One way to fix your problem (other than redesigning your solution, which is probably the right thing to do), is to tell GHC that a certain instance is \"less important\" (or overlappable).<br>\nThis basically means that GHC will choose a more specific instance if it's available (what more specific means you can read in the documentation linked above).<br>\nThis is achieved by using the pragma <code>{-# OVERLAPPABLE #-}</code> or <code>{-# OVERLAPS #-}</code> (read the documentation to see the difference, basically the former is more specific).  </p>\n\n<p>The resulting code would look something like this  </p>\n\n<pre><code>{-# Language FlexibleInstances #-}\n\nclass Predicate a where\n    test :: a -&gt; Bool\n\ninstance {-# OVERLAPPABLE #-} (Predicate a, Traversable t) =&gt; Predicate (t a) where\n    test = all test\n\ndata Bar = Bar\ninstance Predicate Bar where\n    test Bar = False\n\ndata Baz a = Baz a\ninstance Predicate a =&gt; Predicate (Baz a) where\n    test (Baz x) = test x\n\nmain :: IO ()\nmain = do\n   print . test $ Baz Bar\n   print . test $ ([] :: [Bar])\n   print . test $ [Bar]\n   print . test $ Baz ([] :: [Bar])\n</code></pre>\n\n<p>And the result from running it is  </p>\n\n<pre><code>False\nTrue\nFalse\nTrue\n</code></pre>\n\n<p>as expected.</p>\n"}], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 54101836, "answer_count": 1, "score": 1, "last_activity_date": 1546995154, "creation_date": 1546992111, "last_edit_date": 1546994087, "question_id": 54101478, "link": "https://stackoverflow.com/questions/54101478/overlapping-instances-that-dont-seem-to-overlap", "title": "Overlapping instances that don&#39;t seem to overlap", "body": "<p>Consider the following (close to minimal) example:</p>\n\n<pre><code>{-# Language FlexibleInstances #-}\n\nclass Predicate a where\n    test :: a -&gt; Bool\n\ninstance (Predicate a, Traversable t) =&gt; Predicate (t a) where\n    test = all test\n\ndata Bar = Bar\ninstance Predicate Bar where\n    test Bar = False\n\ndata Baz a = Baz a\ninstance Predicate a =&gt; Predicate (Baz a) where\n    test (Baz x) = test x\n\nmain :: IO ()\nmain = print $ test $ Baz Bar\n</code></pre>\n\n<p>Looking at <code>test $ Baz Bar</code>, you'd expect a result of <code>False</code>, as we have the instances <code>Predicate Bar</code> and <code>Predicate a =&gt; Predicate (Baz a)</code>.</p>\n\n<p>But GHC 8.6.3 and 8.0.1 both reject this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>test.hs:18:16: error:\n    \u2022 Overlapping instances for Predicate (Baz Bar)\n        arising from a use of \u2018test\u2019\n      Matching instances:\n        instance (Predicate a, Traversable t) =&gt; Predicate (t a)\n          -- Defined at test.hs:6:10\n        instance Predicate a =&gt; Predicate (Baz a)\n          -- Defined at test.hs:14:10\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018test $ Baz Bar\u2019\n      In the expression: print $ test $ Baz Bar\n      In an equation for \u2018main\u2019: main = print $ test $ Baz Bar\n   |\n18 | main = print $ test $ Baz Bar\n   |                ^^^^^^^^^^^^^^\n</code></pre>\n\n<p>And yet there's no overlap: we can confirm there's no instance of <code>Traversable Baz</code> by commenting out the <code>Predicate (Baz a)</code> instance, in which case we get the error:</p>\n\n<pre><code>test.hs:18:16: error:\n    \u2022 No instance for (Traversable Baz) arising from a use of \u2018test\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018test $ Baz Bar\u2019\n      In the expression: print $ test $ Baz Bar\n      In an equation for \u2018main\u2019: main = print $ test $ Baz Bar\n   |\n18 | main = print $ test $ Baz Bar\n   |                ^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I'm assuming this is a limitation of <code>FlexibleInstances</code>? If so, why, and is there an approved workaround?</p>\n\n<hr>\n\n<p>Okay, turns out this is a consequence of GHC deciding on which instance to use <em>independently</em> of the constraints on the instance, as described <a href=\"https://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow noreferrer\">here</a>. That trick doesn't seem to work here though:</p>\n\n<pre><code>instance (b ~ Baz, Predicate a) =&gt; Predicate (b a) where\n</code></pre>\n\n<p>Gives a <code>Duplicate instance declarations</code> error, so I'm leaving the question open for a solution that works in this case.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1546990387, "post_id": 54100964, "comment_id": 95035389, "body": "I&#39;m a little confused about what you are asking.  Are you asking why aren&#39;t singletons generated automatically from a <code>data</code> definition?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1547001147, "post_id": 54100964, "comment_id": 95037801, "body": "There&#39;s no reason GHC <i>couldn&#39;t</i> derive instances of <code>SingI</code> or <code>SingE</code>, but it doesn&#39;t. You can use <code>Data.Singletons.TH</code> to derive them if you like. I think GHC HQ is much more interested in working out how to get to <code>DependentHaskell</code> than trying to add special support for a hack around the <i>lack</i> of dependent types."}, {"owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "edited": false, "score": 0, "creation_date": 1547049991, "post_id": 54100964, "comment_id": 95060753, "body": "Data.Singletons.TH did the job, thanks."}], "owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546988448, "creation_date": 1546988448, "question_id": 54100964, "link": "https://stackoverflow.com/questions/54100964/why-no-automatic-type-demotion", "title": "Why no automatic type demotion?", "body": "<p>I can promote any algebraic value constructor to a type by applying <code>{-# LANGUAGE DataKinds #-}</code>. And I expect the type demotion to be same simple and automated, as a promotion. However, given a promoted type <code>data Test = A | B | C</code> I can't just <code>fromSing (sing :: Sing 'A)</code> Is there any reasons to prevent automatic demotion when a constructors appears to construct a singletons?</p>\n"}, {"tags": ["haskell", "side-effects"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546986968, "post_id": 54100390, "comment_id": 95034353, "body": "I think free theorems might have a result about this? It&#39;s been a while since I&#39;ve read the paper."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1555163662, "post_id": 54100551, "comment_id": 98019039, "body": "I understand that GHC does not check or take advantage of laws in general. But this is a very simple case where &quot;optimization&quot; could be made even by mistake. Is there any guarantee that no such optimization takes place unless instructed in code?"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1560283075, "post_id": 54100551, "comment_id": 99683493, "body": "Correct answer to a twisted question :)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1546985967, "creation_date": 1546985967, "answer_id": 54100551, "question_id": 54100390, "link": "https://stackoverflow.com/questions/54100390/is-pure-x-io-a-a-pure-value-or-one-with-a-side-effect/54100551#54100551", "title": "Is `pure x :: IO a` a pure value or one with a side effect?", "body": "<p>GHC does not know anything about type class laws (unlike e.g. Idris or Coq), those only exist as documentation and programming convention. Hence, an instance can be lawful or unlawful, and in either case GHC optimization will not alter program behavior.</p>\n\n<p>If you write a specific lawful instance, then you can perhaps add a <code>REWRITE</code> rule to get GHC to remove <code>pure id</code>, and GHC may also end up optimizing <code>pure id</code> away in specific <code>Applicative</code> functors, where the safety of this optimization is apparent.</p>\n"}, {"tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": false, "score": 2, "last_activity_date": 1546987764, "creation_date": 1546987764, "answer_id": 54100839, "question_id": 54100390, "link": "https://stackoverflow.com/questions/54100390/is-pure-x-io-a-a-pure-value-or-one-with-a-side-effect/54100839#54100839", "title": "Is `pure x :: IO a` a pure value or one with a side effect?", "body": "<p>I have to separate your question into two questions:</p>\n\n<blockquote>\n  <p>Is <code>pure x :: IO a</code> a pure value or one with a side effect?</p>\n</blockquote>\n\n<p>A virtually pure value. In this code, <code>x</code>'s type is <code>a</code>, which is a pure value.<br>\nAnd <code>pure</code>'s type is <code>a -&gt; IO a</code>, which wraps the argument with <code>IO</code> but actually without any side effect.<br>\nSo <code>pure x :: IO a</code> seems to have a side effect in its type, but actually doesn't have.</p>\n\n<blockquote>\n  <p>... can pure do anything observable and not break the law?</p>\n</blockquote>\n\n<p>No. <code>pure</code> just applies <code>id</code> against the result of side effect caused by <code>v</code>.<br>\nAs long as the instance follows the Applicative law, it is not <code>pure</code> but <code>v</code> that causes the side effect.</p>\n\n<p>I guess you take <code>x</code> in <code>pure x</code> for <code>v :: IO a</code> in <code>pure id &lt;*&gt; v</code>.<br>\nThe former is a completely pure value whose type is <code>a</code>, and the latter is not a pure value: an action which can cause a side effect returning a value whose type is <code>a</code>.</p>\n\n<p>And the final question:</p>\n\n<blockquote>\n  <p>If I define a type that encapsulates IO and say, spawn a new thread, is GHC free to optimize it away?</p>\n</blockquote>\n\n<p>Sorry, I'm not sure of the optimization.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "accepted_answer_id": 54100551, "answer_count": 2, "score": 3, "last_activity_date": 1560283487, "creation_date": 1546984902, "last_edit_date": 1560283487, "question_id": 54100390, "link": "https://stackoverflow.com/questions/54100390/is-pure-x-io-a-a-pure-value-or-one-with-a-side-effect", "title": "Is `pure x :: IO a` a pure value or one with a side effect?", "body": "<p>Given</p>\n\n<pre><code>pure id &lt;*&gt; v = v\n</code></pre>\n\n<p>holds, can <code>pure</code> do anything observable and not break the law?</p>\n\n<p>If I define a type that encapsulates <code>IO</code> and say, spawn a new thread, is GHC free to optimize it away?</p>\n\n<p>EDIT: I finally realized that the question actually is about consequences of having an unlawful instance of IO...</p>\n"}, {"tags": ["haskell", "plot", "data-analysis"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1546983695, "post_id": 54098309, "comment_id": 95033089, "body": "I would probably use <a href=\"http://hackage.haskell.org/package/diagrams\" rel=\"nofollow noreferrer\"><code>diagrams</code></a> for this if I wanted to avoid gnuplot. But I think this question is unfortunately off-topic for SO because it asks for a tool recommendation, which usually has no objective answer."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1546989445, "post_id": 54098309, "comment_id": 95035164, "body": "Write it yourself an option?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1547014498, "post_id": 54098309, "comment_id": 95040707, "body": "@JonPurdy I don&#39;t necessarily want to be gnuplot free, I thought maybe there&#39;s a way of doing most of the work in Haskell and letting gnuplot just &#39;render&#39; the final product instead the other way around. Although diagrams does seem really promising."}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1546975112, "creation_date": 1546975112, "question_id": 54098309, "link": "https://stackoverflow.com/questions/54098309/a-better-way-of-plotting-a-spider-chart-from-haskell-data", "title": "A better way of plotting a &#39;Spider Chart&#39; from Haskell data?", "body": "<p>I want to try Haskell out for a small practice data analysis project.\nI have a lot of data each processed and represented in Haskell Data type I named as <code>Eap</code></p>\n\n<p>I have a list of <code>Eap</code> where each <code>Eap</code> looks like this</p>\n\n<pre><code>Eap\n  { _name = Just \"someName\"\n    _size = Just 50.0\n    _dmsTypes = Just\n      ( Dms\n           { _i = Just 50.0\n           , _j = Just 5.0\n           , _k = Just 90.0\n           , _l = Nothing\n           , _m = Just 100.0\n           , _n = Just 10.0\n           }\n      )\n    }\n</code></pre>\n\n<p>What I want to do is understand the data by plotting a 'Spider Chart' which look like this <img src=\"https://upload.wikimedia.org/wikipedia/commons/1/18/Spider_Chart2.jpg\" alt=\"here\"></p>\n\n<p>I want to plot it such that each of six vertex represents <code>_i</code>, <code>_j</code>, <code>_k</code> .. <code>_n</code> from <code>Dms</code>. Since there's a list of <code>Eap</code>s each <code>Dms</code> would have different colors.</p>\n\n<p>Right now the best way I found is as suggested in this <a href=\"https://stackoverflow.com/a/49847005/9235239\">answer</a>.</p>\n\n<p>It involves using gnuplot. And gnuplot has wrapper as a Haskell package over at <a href=\"https://hackage.haskell.org/package/gnuplot\" rel=\"nofollow noreferrer\">Hackage</a></p>\n\n<p>And while it's possible to implement that in Haskell with gnuplot, the code becomes quite error prone and really unreadable. Debugging becomes a mess.</p>\n\n<p>So I wanted to ask, is there a better way of plotting a 'Spider chart' of Haskell data which is relatively easy and maintainable?</p>\n"}, {"tags": ["haskell", "tying-the-knot"], "comments": [{"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 0, "creation_date": 1546967233, "post_id": 54096535, "comment_id": 95025605, "body": "So, same as last time, my problem is more involved (though not so much more as last time), but this my current least blocking point.  I&#39;m not even to the point of blocking on writing the patching function, I can&#39;t even write the generator. My initializers are neither 1 nor comparable; my operation is not <code>(+)</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546968116, "post_id": 54096535, "comment_id": 95026067, "body": "<i>&quot;the evaluator can&#39;t decide whether the generated structure is finite or not [...]&quot;</i> The evaluator doesn&#39;t care; it will just evaluate what you tell it to. If there&#39;s a loop, you&#39;ve self-referenced somewhere."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1546970911, "post_id": 54096535, "comment_id": 95027386, "body": "If you&#39;re doing more with multidimensional infinite recursive structures, you might want to step away from lists toward a <a href=\"http://hackage.haskell.org/package/data-inttrie-0.1.4/docs/Data-IntTrie.html\" rel=\"nofollow noreferrer\">trie</a>, for better performance and less awkwardness."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546971045, "post_id": 54096535, "comment_id": 95027445, "body": "I&#39;ve edited my answer to answer your main question. (In case you missed the notification.)"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546975249, "post_id": 54096535, "comment_id": 95029476, "body": "@AJFarmar: this is neither useful nor constructive. I know why there&#39;s a loop. I detailed it a paragraph above what you&#39;re quoting. I know the evaluator doesn&#39;t care. Or have any other feeling, FTM. I feel that entire previous section should make it clear I have a vague idea how the evaluation works; so if it wasn&#39;t obvious enough here it is spelled out: that sentence is intended neither as an answer not without context."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546975703, "post_id": 54096535, "comment_id": 95029694, "body": "@Li-yaoXia: didn&#39;t miss anything, was just AFK at the wrong time. Sorry for the induced stress."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1547220012, "post_id": 54096535, "comment_id": 95129677, "body": "@luqui: here&#39;s <a href=\"https://stackoverflow.com/a/54149312/12274\">my attempt</a> (as an answer here) at using tries. Your feedback welcome!"}], "answers": [{"comments": [{"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 1, "creation_date": 1546974859, "post_id": 54096748, "comment_id": 95029267, "body": "This is so PERFECT. Thank you so much! I&#39;ll posit the following comments: 1) thank you for the word &quot;productive&quot;, that I&#39;ve been dearly missing while writing the question; 2) I like that you call &quot;simple&quot; the <code>(zipWith . zipWith)</code> expression :-) It&#39;ll take me some time, but I&#39;m not calling intuitive yet (yet I write <code>(f .) . (+)</code>-like expressions all the time, fancy that); 3) Ironic to call it <code>zipWith&#39;</code>, considering the <code>foldl</code>/<code>foldl&#39;</code> situation; 4) So no way to do it with the standard library?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 0, "creation_date": 1546982706, "post_id": 54096748, "comment_id": 95032674, "body": "Right I don&#39;t know of any common place where <code>zipWith&#39;</code> can be imported from. You should try <code>zipWith . zipWith . zipWith</code> :) I think the types of those things are quite indicative here."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1546970980, "last_edit_date": 1546970980, "creation_date": 1546968105, "answer_id": 54096748, "question_id": 54096535, "link": "https://stackoverflow.com/questions/54096535/birecursively-defining-a-doubly-infinite-list-of-lists/54096748#54096748", "title": "Birecursively defining a doubly infinite list of lists", "body": "<p>Here's a lazier version of <code>zipWith</code> that makes your example productive. It assumes the second list is at least as long as the first, without forcing it.</p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith' f (i : is) ~(j : js) = f i j : zipWith' f is js\n\n-- equivalently --\n\nzipWith' f (i : is) jjs = f i (head j) : zipWith' f is (tail js)\n</code></pre>\n\n<hr>\n\n<p>Looking at the matrix we want to define:</p>\n\n<pre><code>matrix =\n  [1,1,1,1,1,1,1...\n  [1,/-------------\n  [1,|\n  [1,|  remainder\n  [1,|\n  ...\n</code></pre>\n\n<p>There is a simple relationship between the matrix and the remainder, that describes the fact that each entry in the remainder is obtained by summing the entry to its left and the one above it: take the sum of the matrix without its first row, and the matrix without its first column.</p>\n\n<pre><code>remainder = (zipWith . zipWith) (+) (tail matrix) (map tail matrix)\n</code></pre>\n\n<p>From there, we can apply a patch/padding function to the remainder, to fill in the first row and first column, and edit whatever elements. Those modifications will be fed back through the recursive occurences of <code>matrix</code>. This leads to the following generalized definition of <code>pascals</code>:</p>\n\n<pre><code>-- parameterized by the patch\n-- and the operation to generate each entry from its older neighbors\npascals_ :: ([[a]] -&gt; [[a]]) -&gt; (a -&gt; a -&gt; a) -&gt; [[a]]\npascals_ pad (+) = self where\n  self = pad ((zipWith . zipWith) (+) (tail self) (map tail self))\n</code></pre>\n\n<p>For example, the simplest padding function is to complete the matrix with an initial row and column.</p>\n\n<pre><code>rowCol :: [a] -&gt; [a] -&gt; [[a]] -&gt; [[a]]\nrowCol row col remainder = row : zipWith' (:) col remainder\n</code></pre>\n\n<p>Here we have to be careful to be lazy in the remainder, since we're in the middle of defining it, hence the use of <code>zipWith'</code> defined above. Said another way, we must ensure that if we pass <code>undefined</code> to <code>rowCol row col</code> we can still see the initial values that the rest of the matrix can be generated from.</p>\n\n<p>Now <code>pascals</code> can be defined as follows.</p>\n\n<pre><code>pascals :: [[Integer]]\npascals = pascals_ (rowCol (repeat 1) (repeat 1)) (+)\n</code></pre>\n\n<hr>\n\n<p>Helper to truncate infinite matrices:</p>\n\n<pre><code>trunc :: [[Integer]] -&gt; [[Integer]]\ntrunc = map (take 10) . take 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": false, "score": 2, "last_activity_date": 1547219953, "creation_date": 1547219953, "answer_id": 54149312, "question_id": 54096535, "link": "https://stackoverflow.com/questions/54096535/birecursively-defining-a-doubly-infinite-list-of-lists/54149312#54149312", "title": "Birecursively defining a doubly infinite list of lists", "body": "<p>For comparison's sake, I've written an alternate version using <code>Data.IntTrie</code> as suggested by @luqui.</p>\n\n<pre><code>pascal :: Trie2D Int\npascal = overwriteRow 0 1 $ overwriteCol 0 1 $\n         liftA2 (+) (shiftDown pascal) (shiftRight pascal)\n</code></pre>\n\n<p>Using the following <code>Trie2D</code> structure:</p>\n\n<pre><code>newtype Trie2D a = T2 { unT2 :: IntTrie (IntTrie a) }\n\ninstance Functor Trie2D where\n  fmap f (T2 t) = T2 (fmap f &lt;$&gt; t)\n\ninstance Applicative Trie2D where\n  pure = T2 . pure . pure\n  ~(T2 f) &lt;*&gt; ~(T2 a) = T2 $ (&lt;*&gt;) &lt;$&gt; f &lt;*&gt; a -- took some head-scratching\n\napply2d :: Trie2D a -&gt; Int -&gt; Int -&gt; a\napply2d (T2 t) i j = t `apply` i `apply` j\n</code></pre>\n\n<p>And support code:</p>\n\n<pre><code>overwriteRow,overwriteCol :: Int -&gt; a -&gt; Trie2D a -&gt; Trie2D a\noverwriteRow i x = T2 . overwrite i (pure x) . unT2\noverwriteCol j x = T2 . fmap (overwrite j x) . unT2\n\nshiftUp, shiftDown, shiftLeft, shiftRight :: Trie2D a -&gt; Trie2D a\nshiftUp    (T2 t) = T2 (shiftL t)\nshiftDown  (T2 t) = T2 (shiftR t)\nshiftLeft  (T2 t) = T2 (shiftL &lt;$&gt; t)\nshiftRight (T2 t) = T2 (shiftR &lt;$&gt; t)\n\nshiftL, shiftR :: IntTrie a -&gt; IntTrie a\nshiftL t = apply t . succ @Int &lt;$&gt; identity\nshiftR t = apply t . pred @Int &lt;$&gt; identity\n\nt2dump :: Show a =&gt; Trie2D a -&gt; IO ()\nt2dump t2 = mapM_ print [ [ apply2d t2 i j | j &lt;- [0..9] ] | i &lt;- [0..9] ]\n</code></pre>\n\n<p>Let's not forget the patching function, it <em>is</em> the underlying cause of the entire question:</p>\n\n<pre><code>overwrite2d :: Int -&gt; Int -&gt; a -&gt; Trie2D a -&gt; Trie2D a\noverwrite2d i j x = T2 . modify i (overwrite j x) . unT2\n</code></pre>\n\n<p>Took a bit of time, but very satisfying results.  Thanks for giving me the opportunity to try this out!</p>\n\n<p>I do enjoy the ease of writing <em>once the support code is up and running</em>.</p>\n\n<p>Comments welcome!  Forgive me for forcing the <code>Bits</code> instance to <code>Int</code> a lot, but the code is hairy enough as is.</p>\n"}], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 54096748, "answer_count": 2, "score": 3, "last_activity_date": 1547219953, "creation_date": 1546967163, "question_id": 54096535, "link": "https://stackoverflow.com/questions/54096535/birecursively-defining-a-doubly-infinite-list-of-lists", "title": "Birecursively defining a doubly infinite list of lists", "body": "<h1>Context</h1>\n\n<p>I asked about <a href=\"https://stackoverflow.com/q/53988970/12274\">patching a recursively-defined list</a> the other day.  I'm now trying to bring it up a level by operating on a 2D list instead (a list of lists).</p>\n\n<p>I'll use Pascal's triangle as an example, like for example <a href=\"https://stackoverflow.com/a/27233941/12274\">this beautiful one</a>:</p>\n\n<pre><code>pascals = repeat 1 : map (scanl1 (+)) pascals\n[1,1,1,1,1,1...\n[1,2,3,4,5...\n[1,3,6,10...\n[1,4,10...\n[1,5...\n[1...\n</code></pre>\n\n<h1>Question</h1>\n\n<p>I'd like to express it such that:</p>\n\n<ol>\n<li><p>I'll come with my own first rows and columns (example above assumes first row is <code>repeat 1</code>, which is fixable enough, and that first column is <code>repeat (head (head pascals))</code>, which is going to be more tricky)</p></li>\n<li><p>Each element remains a function of the one above and the one left of it.</p></li>\n<li><p>As a whole, it is a function of itself enough for it to be possible to insert a patching function in the definition and have it propagate patches.</p></li>\n</ol>\n\n<p>So from the outside, <strong>I'd like to find an <code>f</code> function such that I can define <code>pascal</code> as such:</strong></p>\n\n<pre><code>pascal p = p (f pascal)\n</code></pre>\n\n<p>...so that <code>pascal id</code> is the same as in the example, and <code>pascal (patch (1,3) to 16)</code> yields something like:</p>\n\n<pre><code>[1,1,1,1, 1,1...\n[1,2,3,16,17...\n[1,3,6,22...\n[1,4,10...\n[1,5...\n[1...\n</code></pre>\n\n<h1>Where I'm at</h1>\n\n<p>Let's first define and extract the first row and column, so we can have them available and not be tempted to abuse their contents.</p>\n\n<pre><code>element0 = 1\nrow0 = element0 : repeat 1\ncol0 = element0 : repeat 1\n</code></pre>\n\n<p>Updating the definition to use <code>row0</code> is easy enough:</p>\n\n<pre><code>pascals = row0 : map (scanl1 (+)) pascals\n</code></pre>\n\n<p>But the first column is still <code>element0</code>.  Updating to take them from <code>col0</code>:</p>\n\n<pre><code>pascals = row0 : zipWith newRow (tail col0) pascals\n  where\n    newRow leftMost prevRow = scanl (+) leftMost (tail prevRow)\n</code></pre>\n\n<p>Now we're good with the first requirement (custom first row and column).  With no patching, the second is still good.</p>\n\n<p>We even get part of the third: if we patch an element, it will propagate downwards since <code>newRow</code> is defined in terms of <code>prevRow</code>.  But it won't propagate rightwards, since the <code>(+)</code> operates on <code>scanl</code>'s internal accumulator, and from <code>leftMost</code>, which is an explicit in this context.</p>\n\n<h1>What I've tried</h1>\n\n<p>From there, it seems like the right way to do is to really separate concerns.  We want our initializers <code>row0</code> and <code>col0</code> as explicit as possible in the definition, and find a way to define the rest of the matrix independently.  Stub:</p>\n\n<pre><code>pascals = row0 : zipWith (:) (tail col0) remainder\n[1,1,1,1,1,1,1,1,1,1...\n[1,/-------------------\n[1,|\n[1,|\n[1,|\n[1,|  remainder\n[1,|\n[1,|\n[1,|\n[1,|\n</code></pre>\n\n<p>and then we'd want the remainder defined directly in terms of the whole.  The natural definition would be:</p>\n\n<pre><code>remainder = zipWith genRow pascals (tail pascals)\n  where genRow prev cur = zipWith (+) (tail prev) cur\n[1,1,1,1,1,1,1,1,1,1...\n&lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>The first row comes out fine.  Why the loop?  Following the evaluation helps:  <code>pascals</code> is defined as a cons, whose car is fine (and printed).  What's is cdr?  It's <code>zipWith (:) (tail col0) remainder</code>.  Is that expression a <code>[]</code> or <code>(:)</code>?  It's the shortest of its arguments <code>tail col0</code> and <code>remainder</code>.  <code>col0</code> being infinite, it's as null as <code>remainder</code>, <em>i.e.</em> <code>zipWith genRow pascals (tail pascals)</code>.  Is that <code>[]</code> or <code>(:)</code>?  Well, <code>pascals</code> has already been evaluated to <code>(:)</code>, but <code>(tail pascals)</code> hasn't been found a WHNF yet.  And we're already in the process of trying, so <code>&lt;&lt;loop&gt;&gt;</code>.</p>\n\n<p>(Sorry for spelling it out with words, but I really had to mentally trace it like that to understand it the first time).</p>\n\n<h1>Way out?</h1>\n\n<p>With the definitions I'm at, it seems like all definitions are proper, data-flow wise.  The loop now seems simply because the evaluator can't decide whether the generated structure is finite or not.  I can't find a way to make it a promise \"it's infinite all right\".</p>\n\n<p>I feel like I need some converse of lazy matching: some lazy returning where I can tell the evaluator the WHNF of this comes out as <code>(:)</code>, but you'll still need to call this thunk later to find out what's in it.</p>\n\n<p>It also still feels like a fixed point, but I haven't managed to express in a way that worked.</p>\n"}, {"tags": ["haskell", "list-comprehension", "infinite", "hamming-numbers", "smooth-numbers"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1546961898, "post_id": 54095052, "comment_id": 95022484, "body": "So it&#39;s just a matter of ordering? I wonder if <code>[x*y | (x,y) &lt;- zip [1..] [1..]]</code> would work? Hm, yeah no, that actually goes on both at the same time. Interesting question actually."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1546962213, "post_id": 54095052, "comment_id": 95022684, "body": "@BartekBanachewicz Just prepending <code>sort</code> does the trick for finite lists."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 6, "creation_date": 1546962610, "post_id": 54095052, "comment_id": 95022948, "body": "If you arrange all values <code>x, y</code> on a two-dimensional grid, can you show the path in which you intend to iterate through them?"}, {"owner": {"reputation": 345, "user_id": 5717066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zXUcs.jpg?s=128&g=1", "display_name": "Matteo Ugolotti", "link": "https://stackoverflow.com/users/5717066/matteo-ugolotti"}, "edited": false, "score": 2, "creation_date": 1546962754, "post_id": 54095052, "comment_id": 95023034, "body": "How about powers3=[2^x*3^y | x &lt;-[0..],y &lt;-[0..x]]     Then you can sort the resulting list."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1546962769, "post_id": 54095052, "comment_id": 95023046, "body": "Getting things in a different order is easy. But &quot;mixed&quot; is not an order. If you can specify precisely what order you want, we&#39;ll be able to help a lot better."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1546962793, "post_id": 54095052, "comment_id": 95023054, "body": "@SilvioMayolo increasing order."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1546962979, "post_id": 54095052, "comment_id": 95023153, "body": "Maybe this question should be tagged [sorting], but there are already too many tags."}, {"owner": {"reputation": 81, "user_id": 4401983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/af56ebfd504c67ff3a4bbb8d29935055?s=128&d=identicon&r=PG&f=1", "display_name": "JAM AICA", "link": "https://stackoverflow.com/users/4401983/jam-aica"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1546963555, "post_id": 54095052, "comment_id": 95023503, "body": "@mkrieger1 it&#39;s not exactly sorting. I have tried for example to make 2 different lists as I writed on the post and mergesort between them but I&#39;m missing results.       The problem is on the multiplying.For example for values x=2,y=1, the result will be 2^2*3^1 = 12. In the above case I &#39;m missing this result. I just want to take the numbers sorted finally,but I guess it&#39;s not possible to sort an infinite list."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1546963702, "post_id": 54095052, "comment_id": 95023597, "body": "I don&#39;t understand. It&#39;s not sorting, but you tried to mergesort? Can you explain the logic by which the result should be ordered? (See my <a href=\"https://stackoverflow.com/questions/54095052/haskell-list-comprehensions-infinite-list-problem?noredirect=1#comment95022948_54095052\">earlier comment</a>)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 1, "creation_date": 1546963914, "post_id": 54095052, "comment_id": 95023718, "body": "@mkrieger1 simple increasing order. you probably meant merge, not mergesort. @ Jam-aica yes it can be done. there&#39;s a package data-ordlist; and the two tags that I added have many highly relevant entries. :)"}, {"owner": {"reputation": 81, "user_id": 4401983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/af56ebfd504c67ff3a4bbb8d29935055?s=128&d=identicon&r=PG&f=1", "display_name": "JAM AICA", "link": "https://stackoverflow.com/users/4401983/jam-aica"}, "reply_to_user": {"reputation": 345, "user_id": 5717066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zXUcs.jpg?s=128&g=1", "display_name": "Matteo Ugolotti", "link": "https://stackoverflow.com/users/5717066/matteo-ugolotti"}, "edited": false, "score": 0, "creation_date": 1546964494, "post_id": 54095052, "comment_id": 95024071, "body": "OK,I tried the solution of @MatteoUgolotti and that helped but I&#39;ve not totally solved it.                                                                                                                                            powers2=[2^x*3^y | y &lt;-[0..],x &lt;-[0..y]] powers3=[2^x*3^y | x &lt;-[0..],y &lt;-[0..x]]                                                                             multiples = nub (merge (&lt;=) powers2 powers3) But merge does not do the job totally."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1546964665, "post_id": 54095052, "comment_id": 95024176, "body": "@mkrieger1 re &quot;readily known path&quot; this is a not yet solved problem AFAIK. I can explain it by I can&#39;t code it. the explanation is: in the 2D grid, draw a line from (1/log 2,0) to (0,1/log 3). Now move it away from (0,0) keeping it parallel to itself. As you come to cross each (i,j) point for whole i and j, output <code>2^i*3^j</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546966955, "post_id": 54095052, "comment_id": 95025453, "body": "@JAMAICA our last two streams, [2^x*3^y | y &lt;-[0..],x &lt;-[0..y]]  and the other one, won&#39;t be ordered. but merge needs its arguments ordered. that&#39;s why it doesn&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4401983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/af56ebfd504c67ff3a4bbb8d29935055?s=128&d=identicon&r=PG&f=1", "display_name": "JAM AICA", "link": "https://stackoverflow.com/users/4401983/jam-aica"}, "edited": false, "score": 0, "creation_date": 1546973557, "post_id": 54096234, "comment_id": 95028603, "body": "Bingo! That worked. Make no mistake,the lists I wrote were not the ones you pointed out at start, it was the same with mults23_2D but I had not managed to make that kind of sorting! How could I handle it If I wanted to add in the equation 5^z?( 2^x*3^y*5^z)"}, {"owner": {"reputation": 81, "user_id": 4401983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/af56ebfd504c67ff3a4bbb8d29935055?s=128&d=identicon&r=PG&f=1", "display_name": "JAM AICA", "link": "https://stackoverflow.com/users/4401983/jam-aica"}, "edited": false, "score": 0, "creation_date": 1546998394, "post_id": 54096234, "comment_id": 95037249, "body": "To add 5^z like in the above comment,we just need a double nested foldr...                                                                                                                                      result = foldr g [] [foldr g....]"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1546969016, "last_edit_date": 1546969016, "creation_date": 1546966112, "answer_id": 54096234, "question_id": 54095052, "link": "https://stackoverflow.com/questions/54095052/haskell-list-comprehensions-infinite-list-problem/54096234#54096234", "title": "Haskell List comprehensions infinite list problem", "body": "<p>The code that you show,</p>\n\n<pre><code>multiples = nub (merge (&lt;=) powers2 powers3)\npowers3 = [2^x * 3^y | x &lt;- [0..], y &lt;- [0..]]\npowers2 = [2^x * 3^y | y &lt;- [0..], x &lt;- [0..]]\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>powers3 = [2^x * 3^y | x &lt;- [0], y &lt;- [0..]]\n        = [2^0 * 3^y | y &lt;- [0..]]\n        = [3^y | y &lt;- [0..]]\npowers2 = [2^x * 3^y | y &lt;- [0], x &lt;- [0..]] \n        = [2^x * 3^0 | x &lt;- [0..]]\n        = [2^x | x &lt;- [0..]]\n</code></pre>\n\n<p>so you only produce the powers of <em>2</em> and <em>3</em>, without any mixed multiples. As such, there are guaranteed to be no duplicates in the stream, and the <code>nub</code> was not necessary. And of course it's incomplete.</p>\n\n<p>But let's look at it at another angle. It was proposed in the comments to create a 2D grid out of these numbers:</p>\n\n<pre><code>mults23_2D = [[2^x * 3^y | y &lt;- [0..]] | x &lt;- [0..]]\n{-\n   1   3   9   27  81  ...\n   2   6  18   54  ...\n   4  12  36  108  ...\n   8  24  72  ...\n  16  ...\n  .......     \n-}\n</code></pre>\n\n<p>Now we're getting somewhere. At least now none are skipped. We just need to understand how to <em>join</em> them into one sorted, increasing stream of numbers. Simple <code>concat</code> of course won't do. We need to merge them in order. A well-known function <code>merge</code> does that, provided the arguments are already ordered, increasing lists.</p>\n\n<p>Each row produced is already in increasing order, but there are infinitely many of them. Never fear, <code>foldr</code> can do it. We define</p>\n\n<pre><code>mults23 = foldr g [] [[2^x * 3^y | y &lt;- [0..]] | x &lt;- [0..]]\n  -- foldr g [] [a,b,c,...] == a `g` (b `g` (c `g` (....)))\n where\n g (x:xs) ys = \n</code></pre>\n\n<p>Here it is a little bit tricky. If we define <code>g = merge</code>, we'll have a run-away recursion, because each <code>merge</code> will want to know the head element of its \"right\" (second) argument stream.</p>\n\n<p>To prevent that, we produce the leftmost element right away. </p>\n\n<pre><code>                x : merge xs ys\n</code></pre>\n\n<p>And that's that.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1616519172, "last_edit_date": 1616519172, "creation_date": 1616517090, "answer_id": 66767308, "question_id": 54095052, "link": "https://stackoverflow.com/questions/54095052/haskell-list-comprehensions-infinite-list-problem/66767308#66767308", "title": "Haskell List comprehensions infinite list problem", "body": "<p><strong>Tool use</strong></p>\n<p>I needed an infinite Cartesian product function. An infinite function must take the diagonals of a table.\nThe pair pattern of a diagonal traversal is</p>\n<p>0 0 \u2013 0 1, 1 0 \u2013 0 2, 1 1, 2 0 \u2013 0 3, 1 2, 2 1, 3 0</p>\n<p>I love the symmetries but the pattern is counting forward with first digit and backward with second which when expressed in an infinite function is</p>\n<pre><code>diag2 xs ys = [ (m,n) | i&lt;- [1..], (m,n) &lt;- zip (take i xs) (reverse.take i $ ys) ]\n</code></pre>\n<p>The infinite generation is just to take any amount however large to work with.\nWhat may be important, also is taking a diagonal or triangular number for a complete set.\n<code>revt n</code> makes a triangular number from you input.  If you want 25 elements <code>revt 25</code> will return 7. <code>tri 7</code> will return 28 the parameter for <code>take</code>. <code>revt</code> and <code>tri</code> are</p>\n<pre><code>tri n = foldl (+) 1 [2..n]\nrevt n = floor (sqrt (n*2))\n</code></pre>\n<p>Making and using <code>taket</code> is good until you learn the first 10 or so triangular numbers.</p>\n<pre><code>taket n xs = take (tri $ revt n) xs\n</code></pre>\n<p>Now, with some tools in place we apply them (mostly 1) to a problem.</p>\n<pre><code>[ 2^a * 3^b | (a,b) &lt;- sort.taket 25 $ diag2 [0..] [0..]]\n</code></pre>\n<p>[1,3,9,27,81,243,729, 2,6,18,54,162,486, 4,12,36,108,324, 8,24,72,216, 16,48,144, 32,96, 64]</p>\n<p>And it\u2019s a diagonal. The first group is 7 long, the second is 6 long, the second-to-the-last is 2 long and the last is 1 long. <code>revt 25</code> is 7. <code>tri 7</code> is 28 the length of the output list.</p>\n"}], "owner": {"reputation": 81, "user_id": 4401983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/af56ebfd504c67ff3a4bbb8d29935055?s=128&d=identicon&r=PG&f=1", "display_name": "JAM AICA", "link": "https://stackoverflow.com/users/4401983/jam-aica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "accepted_answer_id": 54096234, "answer_count": 2, "score": 0, "last_activity_date": 1616519172, "creation_date": 1546961763, "last_edit_date": 1546962667, "question_id": 54095052, "link": "https://stackoverflow.com/questions/54095052/haskell-list-comprehensions-infinite-list-problem", "title": "Haskell List comprehensions infinite list problem", "body": "<p>I'm trying to learn Haskell and comprehension lists but cannot find solution on this:</p>\n\n<pre><code>mylist = [x*y | x &lt;- [1..], y &lt;- [1..]]\n</code></pre>\n\n<p>After my trials the result is something like this</p>\n\n<pre><code>mylist = [1,2,3,4,5,...]\n</code></pre>\n\n<p>because in list comprehensions, <code>x</code> takes the value <code>1</code>,and then <code>y</code> changes value repeatedly.</p>\n\n<p>But my goal is to achieve a different assignment so as to have the following result:</p>\n\n<pre><code>mylist = [1,2,2,4,3,3,6.....]\n</code></pre>\n\n<p>I mean i want the combinations being mixed and not each one apart,because I have a serious problem to have the suitable result.</p>\n\n<p>I will give a more specific example.</p>\n\n<p>I want a list that will have all numbers of this form:</p>\n\n<pre><code>num = 2^x * 3^y \n</code></pre>\n\n<p><code>x</code> and <code>y</code> must take all values <code>&gt;= 0</code>.</p>\n\n<p>My approach is the following:</p>\n\n<pre><code>powers = [2^x * 3^y | x &lt;- [0..], y &lt;- [0..]]\n</code></pre>\n\n<p>But in this way I only take powers of 3, because <code>x</code> is constantly 0.</p>\n\n<p>I tried this one</p>\n\n<pre><code>multiples = nub (merge (&lt;=) powers2 powers3)\npowers3 = [2^x * 3^y | x &lt;- [0..], y &lt;- [0..]]\npowers2 = [2^x * 3^y | y &lt;- [0..], x &lt;- [0..]]\n</code></pre>\n\n<p>so as to merge the different ones but again,the values 6,12,etc. are missing - the result is this:</p>\n\n<pre><code>mylist = [1,2,3,4,8,9,16,27,32,64,81...]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1546958256, "post_id": 54094045, "comment_id": 95020123, "body": "Did you mean <code>[(&quot;A&quot;, a), (&quot;B&quot;, b), (&quot;C&quot;, c)]</code>?"}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1546958334, "post_id": 54094045, "comment_id": 95020172, "body": "@BartekBanachewicz exactly, corrected"}, {"owner": {"reputation": 98, "user_id": 3938382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4775dd53b1b7b5f5514da9154057efd?s=128&d=identicon&r=PG", "display_name": "bruteforcecat", "link": "https://stackoverflow.com/users/3938382/bruteforcecat"}, "edited": false, "score": 1, "creation_date": 1546960085, "post_id": 54094045, "comment_id": 95021318, "body": "I think your question should be you have Maybe a, Maybe b, Maybe c and you want to transform it to Maybe (a, b, c)? but the difficult part the inner type are heterogenous and you want them to be scaled well?"}, {"owner": {"reputation": 98, "user_id": 3938382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4775dd53b1b7b5f5514da9154057efd?s=128&d=identicon&r=PG", "display_name": "bruteforcecat", "link": "https://stackoverflow.com/users/3938382/bruteforcecat"}, "edited": false, "score": 1, "creation_date": 1546960248, "post_id": 54094045, "comment_id": 95021425, "body": "The most easier one is just to use pattern matching like <code>getQuerySelect (Just token) (Just deviceId) .... = Just (token, deviceId)</code> <code>getQuerySelect _ _ .... = Nothing</code>  If they are honogenous list, you could just use <code>traverse id</code> to change [Maybe a] to Maybe [a]."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "reply_to_user": {"reputation": 98, "user_id": 3938382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4775dd53b1b7b5f5514da9154057efd?s=128&d=identicon&r=PG", "display_name": "bruteforcecat", "link": "https://stackoverflow.com/users/3938382/bruteforcecat"}, "edited": false, "score": 0, "creation_date": 1546960279, "post_id": 54094045, "comment_id": 95021439, "body": "@bruteforcecat No, the result type is <code>[(String, String)]</code>. Each &quot;Just&quot; argument will be analysed and put into the result array. Arguments equal to &quot;Nothing&quot; will simply be not included in the result list."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1546961428, "post_id": 54094045, "comment_id": 95022222, "body": "Why not introduce a type <code>(Maybe Token, Maybe DevideId, Maybe SensorId, Maybe Int, Maybe Int, Maybe Int, Maybe UTCTime, Maybe UTCTime)</code> together with a type  <code>(Token, DevideId, SensorId, Int, Int, Int, UTCTime, UTCTime)</code> ."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1546963520, "post_id": 54094045, "comment_id": 95023481, "body": "@Elmex80s good idea, I would call this type &quot;QueryParams&quot;... That would make the signature shorter. However, I&#39;m not sure how that solves the problem?"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1546969711, "post_id": 54094045, "comment_id": 95026807, "body": "A question is, do you really want an array/list or is a tuple good enough. Makes a huge difference to your (final) solution."}], "answers": [{"comments": [{"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1546959096, "post_id": 54094148, "comment_id": 95020675, "body": "Thanks, I added some context to my question to explain what I meant by &quot;scale well for more Maybes&quot;... Actually they are a bit heterogeneous."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1546959240, "post_id": 54094148, "comment_id": 95020754, "body": "@cdupont How do you convert the inner types to <code>String</code>? Just <code>show</code>?"}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1546959488, "post_id": 54094148, "comment_id": 95020908, "body": "some types might need some transformation (formating for UCTTime etc.). So having one line per Maybe and accumulate the results is good enough..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1546959568, "post_id": 54094148, "comment_id": 95020970, "body": "Then convert beforehand, each specifically; I&#39;ll add that to the answer."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 3, "last_activity_date": 1546959656, "last_edit_date": 1546959656, "creation_date": 1546958509, "answer_id": 54094148, "question_id": 54094045, "link": "https://stackoverflow.com/questions/54094045/haskell-generate-an-array-out-of-multiple-maybes/54094148#54094148", "title": "Haskell: Generate an array out of multiple maybes", "body": "<p>If you want it to \"scale well for more Maybes\", then just work with an array in the first place:</p>\n\n<pre><code>getFoosArr :: [Maybe Int] -&gt; [(String, Int)]\n</code></pre>\n\n<p>The implementation could then be e.g.:</p>\n\n<pre><code>getFoosArr = catMaybes . zipWith (\\a -&gt; fmap (a,)) [A..]\n</code></pre>\n\n<p>First we tag each <code>Maybe Int</code> with a letter<sup>1</sup>, and then it's just a matter of filtering out the <code>Just</code>s with <code>catMaybes</code>.</p>\n\n<p>And of course your original function would simply need to pass the arguments then:</p>\n\n<pre><code>getFoos ma mb mc = getFoosArr [ma, mb, mc]\n</code></pre>\n\n<hr>\n\n<p>If you have heterogenous types, but want to convert it all to <code>String</code> anyway, it's easy; make <code>getFoosArr</code> take <code>[Maybe String]</code>, and convert the <code>Just</code>s before passing further:</p>\n\n<pre><code>getFoosHet ma mb mc = getFoosArr \n                      [ fmap showA ma\n                      , fmap showB mb\n                      , fmap showC mc\n                      ]\n</code></pre>\n\n<p>I'm assuming <code>showA :: A -&gt; String</code>, <code>ma :: Just A</code>.</p>\n\n<hr>\n\n<p><sup>1</sup> I've eta-reduced <code>\\a b -&gt; fmap (a,) b</code> to <code>\\a -&gt; fmap (a,)</code>. It could also be written as <code>fmap . (,)</code>, but I personally find it a bit less readable.</p>\n"}], "owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546960658, "creation_date": 1546958137, "last_edit_date": 1546960658, "question_id": 54094045, "link": "https://stackoverflow.com/questions/54094045/haskell-generate-an-array-out-of-multiple-maybes", "title": "Haskell: Generate an array out of multiple maybes", "body": "<p>I have simple question but I can't find an elegant solution.\nI have a function like this:</p>\n\n<pre><code>getFoos :: Maybe Int\n        -&gt; Maybe Int\n        -&gt; Maybe Int\n        -&gt; [(String, Int)]\ngetFoos ma mb mc = ...\n</code></pre>\n\n<p>I would like to create this array: <code>[(\"A\": 1), (\"B\": 2), (\"C\": 3)]</code>.\nBut that's only if the three arguments are Just! If one or several are Nothing, they will simply not appear in the resulting array.\nAny elegant way to accomplish this?</p>\n\n<p>For info, the real signature of my function is:</p>\n\n<pre><code> getQuerySelect :: Maybe Token\n                -&gt; Maybe DeviceId\n                -&gt; Maybe SensorId\n                -&gt; Maybe Int\n                -&gt; Maybe Int\n                -&gt; Maybe Int\n                -&gt; Maybe UTCTime\n                -&gt; Maybe UTCTime\n                -&gt; [(String, String)]\n</code></pre>\n\n<p>It's meant for database query with MongoDB.</p>\n\n<p>My design so far:</p>\n\n<pre><code>  getQuerySelect mdev msen ... = do\n  let selDev = [(\"device_id\", dev) | (Just (DeviceId dev)) &lt;- [mdev]]\n  let selSen = [(\"sensor_id\", sen) | (Just (SensorId sen)) &lt;- [msen]]\n  ...\n  return $ selDev &lt;&gt; selSen &lt;&gt; ...\n</code></pre>\n\n<p>Works, but still a bit awkward in my opinion.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1546951166, "post_id": 54091936, "comment_id": 95015990, "body": "I would start by <i>trying</i> to implement the function. Nobody&#39;s going to write your code for you\u2014please show an attempt."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 2, "creation_date": 1546951728, "post_id": 54091936, "comment_id": 95016277, "body": "Smells like homework :/"}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 0, "creation_date": 1546951738, "post_id": 54091936, "comment_id": 95016281, "body": "You should start by parsing your expression into <code>Expr</code> (which is essentially a binary tree). Then, given this <code>Expr</code> and a symbol table which maps symbols like <code>x</code> and <code>y</code> to their values, computing this expression will boil down to going through the binary tree and performing appropriate computations at each node."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546953329, "post_id": 54091936, "comment_id": 95017114, "body": "can you explain in words what the <code>compute</code> function is supposed to do - in particular what its inputs represent? I&#39;m having a hard time figuring this out from the type signature (even after mentally correcting the typo). [I will repeat what @AJFarmar said though, no-one is going to write the function for you if you show no attempt.]"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546954082, "post_id": 54091936, "comment_id": 95017589, "body": "<code>compute</code> already receives the symbol table and syntax tree; it just needs to evaluate the expression. E.g. <code>compute [(&quot;foo&quot;, 5)] (Sum (Var &quot;foo&quot;) (Val 3))</code> should return 8."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546954567, "post_id": 54091936, "comment_id": 95017883, "body": "ah, so the list of pairs is a mapping from variable names to values. That makes sense, but wasn&#39;t obvious (to me) without further explanation :)"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1546957384, "last_edit_date": 1546957384, "creation_date": 1546956860, "answer_id": 54093681, "question_id": 54091936, "link": "https://stackoverflow.com/questions/54091936/represent-arithmetic-expressions/54093681#54093681", "title": "Represent arithmetic expressions", "body": "<p>Given a symbol table and a syntax tree, you need to evaluate the expression. For example,</p>\n\n<pre><code>&gt; compute [(\"foo\", 5)] (Sum (Var \"foo\") (Val 3))\n8\n</code></pre>\n\n<p>because <code>foo + 3 == 5 + 3 == 8</code>.</p>\n\n<p>In order to write this function, you simply need to handle each of the 5 type of expressions that <code>compute</code> could receive:</p>\n\n<pre><code>compute :: Num a =&gt; [([Char], a)] -&gt; Expr a -&gt; a\ncompute st (Val x) = x\ncompute st (Var v) = ...\ncompute st (Sum x y) = ...\ncompute st (Prod x y) = ...\ncompute st (Minus x y) = ...\n</code></pre>\n\n<p>I've filled in the most trivial case as an example. The computed value of a <code>Val</code> value is simply the value of type <code>a</code> it wraps: <code>compute [] (Val 3) == 3</code>.</p>\n\n<p>For <code>Var</code>, you need to find <code>v</code> in the symbol table <code>st</code> and return its corresponding value. The predefined function <code>lookup</code> will be useful. For example, <code>compute [(\"foo\", 5)] (Var \"foo\") == 5</code>. You'll have to decide what to do in a case like <code>compute [] (Var \"foo\")</code>, where <code>foo</code> is not defined. The function <code>maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code> may come in handy.</p>\n\n<p>For <code>Sum</code>, <code>Prod</code>, and <code>Minus</code>, you need to recursively evaluate each operand, then add/subtract/multiply the results. For example, <code>compute st (Sum (Val 3) (Val 5)) == compute st (Val 3) + compute st (Val 5)</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9732772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f08f633088778bb2cd6e3711ee724bf?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/9732772/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "closed_date": 1546957540, "answer_count": 1, "score": -5, "last_activity_date": 1546957384, "creation_date": 1546950934, "last_edit_date": 1546951912, "question_id": 54091936, "link": "https://stackoverflow.com/questions/54091936/represent-arithmetic-expressions", "closed_reason": "Needs more focus", "title": "Represent arithmetic expressions", "body": "<p>I want to compute in Haskell an expressions that contains letters and operations.</p>\n\n<p>I defined an algebraic type Expr a to represent arithmetic expressions:</p>\n\n<pre><code>data Expr a = Val a\n    | Var [Char]\n    | Sum (Expr a) (Expr a)\n    | Prod (Expr a) (Expr a)\n    | Minus (Expr a) (Expr a)\n</code></pre>\n\n<p>And the operation</p>\n\n<pre><code>compute :: Num a =&gt; [(Char], a)] -&gt; Expr a -&gt; a\n</code></pre>\n\n<p>But I don't know how to implement the function, I am new to haskell.</p>\n"}, {"tags": ["haskell", "recursion", "matrix"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1546921314, "post_id": 54085003, "comment_id": 95003433, "body": "Test your negllist function."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1546921402, "post_id": 54085003, "comment_id": 95003457, "body": "Why do you need `Enum a&#180;? Don&#39;t you want your function to work with real or complex matrices?"}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546922415, "post_id": 54085003, "comment_id": 95003672, "body": "I noticed the problem with neglist, thank you n.m I&#39;ve corrected it so that list sizes of 2 do not cause a runtime error. Unfortunately, this did not correct the problem. As for the Enum typeclass, I honestly couldn&#39;t tell you. If I do not include it ghci will throw an error at me saying it&#39;s needed when calling sizedown. I can post the detailed error message on request if needed."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1546923051, "post_id": 54085003, "comment_id": 95003820, "body": "It looks like you are misled by the <code>..</code> operator. It doesn&#39;t do what you think it does. <code>[1, 2 .. 5]</code> expands to <code>[1, 2, 3, 4, 5]</code>, but <code>[f(1), f(2) .. f(5)]</code> does not expand to <code>[f(1), f(2), f(3), f(4), f(5)]</code>"}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546923229, "post_id": 54085003, "comment_id": 95003858, "body": "It doesn&#39;t? I remember trying it out to make sure in ghci. Maybe I was mistaken.   EDIT: Oh no it doesn&#39;t. What should I implement instead? A mapping of some kind? List comprehension?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546923565, "post_id": 54085003, "comment_id": 95003936, "body": "ghci is telling you you need <code>Enum</code> because of the way you are using the <code>..</code> operator, but you are not using it correctly."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1546923667, "post_id": 54085003, "comment_id": 95003955, "body": "Yes you can do what you need with either map or list comprehension."}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546924361, "post_id": 54085003, "comment_id": 95004128, "body": "Unfortunately I&#39;m not too suave with either at the moment, can I get a hint of some kind? I feel that a list comprehension would be the best way but am not familiar with them in the slightest."}, {"owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "edited": false, "score": 0, "creation_date": 1546925026, "post_id": 54085003, "comment_id": 95004288, "body": "try <a href=\"https://wiki.haskell.org/Debugging\" rel=\"nofollow noreferrer\">debugging</a> the code."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1546927904, "post_id": 54085003, "comment_id": 95005028, "body": "For which inputs does the program fail?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546930734, "post_id": 54085003, "comment_id": 95006008, "body": "<code>[f i | i &lt;- [1, 2 .. 5]]</code> does the mapping through a list comprehension."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1546933544, "post_id": 54085003, "comment_id": 95007020, "body": "In <code>elerem</code> you can simplify to <code>... where (first, sec) = splitAt x xs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1546961185, "post_id": 54086272, "comment_id": 95022064, "body": "Thank you for the information! Unfortunately even after correcting this error with list comprehension (at least I think so, with sizedown xf = [(determin (cut (tail xf) i)) | i &lt;- [1,2..(length xf - 1)]] ) I am still receiving the same issue. For example, the nested list/matrix [[1,0,0],[4,1,0],[55,0,1]] when entered into my code has an output of 1, which is definitely not the determinant of that matrix."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "reply_to_user": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1546961280, "post_id": 54086272, "comment_id": 95022114, "body": "@Sagarmatha <a href=\"https://tio.run/#%23y00syUjNTSzJTE78/z@gKDOvxMEltcShutpQx0DHoFan2kTHEEybmgIFDGtr//8HAA\" rel=\"nofollow noreferrer\">It is indeed 1</a>."}, {"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1546963465, "post_id": 54086272, "comment_id": 95023447, "body": "I apologize, I picked a bad example to show my error with. How about this one [[8,13,3],[5,3,9],[11,6,3]]. My programs solution is 732, but calculators online are saying 723."}], "tags": [], "owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "is_accepted": false, "score": 3, "last_activity_date": 1546930879, "last_edit_date": 1546930879, "creation_date": 1546928776, "answer_id": 54086272, "question_id": 54085003, "link": "https://stackoverflow.com/questions/54085003/programming-a-haskell-matrix-solver-for-learning-runtime-logic-errors-present/54086272#54086272", "title": "Programming a haskell matrix-solver for learning, runtime logic errors present", "body": "<p>The problem is that <code>..</code> <strong>only</strong> generates arithmetic sequence based on the computed <em>result</em> of the parameters.</p>\n\n<p>In particular,</p>\n\n<pre><code>[(f 1), (f 2) .. (f 5)]\n</code></pre>\n\n<p>is not the same as</p>\n\n<pre><code>[(f 1), (f 2), (f 3), (f 4), (f 5)]\n</code></pre>\n\n<p>, instead it is equal to</p>\n\n<pre><code>let a=f 1; b=f 2; c=f 5 in [a,b..c]\n</code></pre>\n\n<p><a href=\"https://tio.run/#%23y0gszk7Nyfn/P02hQsEWiLUUKrhyEzPzgJyCosy8EgUVhWiNNAVDTR0FIGWkqaCnB2KYasb@/w8A\" rel=\"nofollow noreferrer\">Try it yourself</a> with some nonlinear function, for example <code>f x = x*x</code>.</p>\n\n<p>In order to generate <code>[(f 1), (f 2), (f 3), (f 4), (f 5)]</code> you can use <code>map f [1..5]</code> or list comprehension <code>[f i | i &lt;- [1..5]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "is_accepted": false, "score": -1, "last_activity_date": 1546964099, "creation_date": 1546964099, "answer_id": 54095675, "question_id": 54085003, "link": "https://stackoverflow.com/questions/54085003/programming-a-haskell-matrix-solver-for-learning-runtime-logic-errors-present/54095675#54095675", "title": "Programming a haskell matrix-solver for learning, runtime logic errors present", "body": "<p>In response to my last comment with the matrix that was giving a determinant of 732 instead of the correct answer of 723, I have discovered the answer myself. It seems that (length xf - 1) is incorrect, simply (length xf) is acceptable. Thank you all for the help!</p>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1546964099, "creation_date": 1546919690, "question_id": 54085003, "link": "https://stackoverflow.com/questions/54085003/programming-a-haskell-matrix-solver-for-learning-runtime-logic-errors-present", "title": "Programming a haskell matrix-solver for learning, runtime logic errors present", "body": "<p>I've been learning Haskell seriously for a about a week and a half now, and took inspiration from my linear algebra classes to make a matrix solver. The first step of this is to make a determinant function, but I wanted to go the extra mile and make a function that could solve higher dimension (4x4, 5x5, etc...) matrices.</p>\n\n<p>I'm pretty proud of what I have, considering it's all I've learned, and I've been able to address all errors I've gotten on my on until this point thanks to the Haskell compiler. However, it's at this point I am at a loss. The code below will compile in GHCI with no issues:</p>\n\n<pre><code>elerem :: Int -&gt; [a] -&gt; [a]\nelerem x xs = init first ++ sec\n    where\n     first = fst split\n     sec   = snd split\n     split = splitAt x xs\n\nneglist :: Num a =&gt; [a] -&gt; [a]\nneglist (x:y:rest) = x:(negate y):(neglist rest)\nneglist [x] = [x]\n\ndetermin :: (Num a, Enum a) =&gt; [[a]] -&gt; a\ndetermin xf\n    |length (head xf) /= length xf = 0\n    |(length xf == 2) &amp;&amp; (length (head xf) == 2) = cofactor xf\n    |otherwise = sum (zipWith (*) (neglist (head xf)) (sizedown xf))\n        where\n         sizedown xf = [(determin (cut (tail xf) 1)), (determin (cut (tail xf) 2))..(determin (cut (tail xf) (length xf)))]\n         cut xf x = map (elerem x) xf\n         cofactor xf = head (head xf) * last (last xf) - head (last xf) * last (head xf)\n</code></pre>\n\n<p>And from my testing so far, runs successfully with and 2x2 matrix, and some, but not all, 3x3 matrices. Since I'm not actually getting any error messages I'm not sure where I went wrong exactly in the code, all I can see is that my code is not giving the same answers that matrix calculators are on the internet.</p>\n\n<p>My one clue is that when starting with a 3x3 identity matrix, my code runs the very obvious answer of 1. Changing element values in the identity matrix also changes the answer to be correct, except with the first value (or columns) of the second and third matrix (or row). It seems the former intentionally messes up answers, and the latter is ignored by calculation and treated as 0.\nI feel that this will be a harder problem to solve than normal with the lack of helpful error messages, and I am not experienced enough yet to picture the function expansion process running in my head to find the exact center of the problem. Any help would be greatly appreciated.</p>\n"}, {"tags": ["haskell", "error-handling", "text-parsing", "parsec"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1546930507, "post_id": 54083473, "comment_id": 95005922, "body": "If the <code>seq1</code> fail, it print out the error message and try <code>seq2</code>? or just stop parsing when <code>seq1</code> fail?"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1546943846, "creation_date": 1546943846, "answer_id": 54089987, "question_id": 54083473, "link": "https://stackoverflow.com/questions/54083473/how-can-i-force-parsec-to-return-an-error/54089987#54089987", "title": "How can I force Parsec to return an error?", "body": "<p>If you want the monad to behave differently then perhaps you should build a different monad.  (N.B. I'm not entirely clear what you want, but moving forward anyway).</p>\n\n<p><strong>Solution: Use a Monad Transformer Stack</strong></p>\n\n<p>For example, to get a <code>fail</code>-like function that isn't caught and ignored by Parsec's <code>try</code> you could use an <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Except.html\" rel=\"nofollow noreferrer\">Except monad</a>.  <code>Except</code> allows you to throw errors much like exceptions but they are plumbed monadically instead of using the actual exception mechanism which demands IO to catch it.</p>\n\n<p>First, lets define our monad:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Combinator\nimport Text.Parsec.Char\nimport Control.Monad.Trans.Except\nimport Control.Monad.Trans\n\ntype EscParse a = ParsecT String () (Except String) a\n</code></pre>\n\n<p>So the monad is <code>EscParse</code> and combines features of Parsec (via the transformer <code>ParsecT</code>) and <code>Except</code>.</p>\n\n<p>Second, let's define some helpers:</p>\n\n<pre><code>run :: EscParse a -&gt; SourceName -&gt; String -&gt; Either String (Either ParseError a)\nrun op sn input = runExcept (runPT op () sn input)\n\nescFail :: String -&gt; EscParse a\nescFail = lift. throwE\n</code></pre>\n\n<p>Our <code>run</code> is like <code>runParse</code> but also runs the except monad.  You might want to do something to avoid the nested Either, but that's an easy cosmetic change.  <code>escFail</code> is what you'd use if you don't want the error to be ignored.</p>\n\n<p>Third, we need to implement your parser using this new monad:</p>\n\n<pre><code>parseA :: EscParse String\nparseA = try seq1 &lt;|&gt;  seq2\n\nseq1 :: EscParse String\nseq1 = do manyTill anyChar (try $ string \"\\n* \")\n          many1 anyChar\n          escFail \"My error message\"\n\nseq2 :: EscParse String\nseq2 = do manyTill anyChar (try $ string \"\\n- \")\n          many1 anyChar\n</code></pre>\n\n<p>Other than spacing and type signature, the above matches what you had but using <code>escFail</code> instead of <code>fail</code>.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 54089987, "answer_count": 1, "score": 2, "last_activity_date": 1546943846, "creation_date": 1546905048, "question_id": 54083473, "link": "https://stackoverflow.com/questions/54083473/how-can-i-force-parsec-to-return-an-error", "title": "How can I force Parsec to return an error?", "body": "<p>I'm making a parser with Parsec and I try to return a specific error during the parsing.</p>\n\n<p>This is a minimal parser example to expose my problem :</p>\n\n<pre><code>parseA = try seq1\n      &lt;|&gt;  seq2\n\nseq1 = do\n          manyTill anyChar (try $ string \"\\n* \")\n          many1 anyChar\n          fail \"My error message\" \n\nseq2 = do\n          manyTill anyChar (try $ string \"\\n- \")\n          many1 anyChar\n</code></pre>\n\n<p>I would like to perform some tests in the first <code>try $ do</code> sequence and stop the parsing and return a specific error message. \nWhen I don't use <code>fail</code> I get :</p>\n\n<pre><code>ghci&gt;  parse parseA  \"\" \"aaaaaa\\nbbbb\\n* ccccc\\n- ddd\"\nRight \"ccccc\\n- ddd\"\n</code></pre>\n\n<p>When I use <code>fail</code> or <code>unexpected</code>, my parser doesn't stop  (due to the <code>try</code> function) and execute the next <code>do</code> sequence:</p>\n\n<pre><code>ghci&gt;  parse parseA  \"\" \"aaaaaa\\nbbbb\\n* ccccc\\n- ddd\"\nRight \"ddd\"\n</code></pre>\n\n<p>And it's not what I want!</p>\n\n<p>I considered using the basic <code>error</code> function to stop the execution of my parser but I would like to have a \"clean\" error returned by the parsing function like this:</p>\n\n<pre><code>ghci&gt;  parse parseA  \"\" \"aaaaaa\\nbbbb\\n* ccccc\\n- ddd\"\nLeft \"My error message\"\n</code></pre>\n\n<p><strong>Do you know how to properly stop a parser and return a custom error?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1546894957, "post_id": 54081802, "comment_id": 94996936, "body": "What do you think of <code>replicateM_ 3 (putChar c)</code> or is <code>putChar</code> a placeholder?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1546896413, "post_id": 54081802, "comment_id": 94997577, "body": "Your example doesn&#39;t seem rich enough to explain what you&#39;re really trying to accomplish. Could you give a more complicated one?"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1546895315, "creation_date": 1546895315, "answer_id": 54081939, "question_id": 54081802, "link": "https://stackoverflow.com/questions/54081802/pass-a-variable-to-several-sequenced-functions-in-io/54081939#54081939", "title": "Pass a variable to several sequenced functions in IO", "body": "<p>Here's a fixed version of <code>(&gt;^=)</code></p>\n\n<pre><code>(&gt;^=) :: Monad m =&gt; m b -&gt; (b -&gt; m a) -&gt; m b\n(&gt;^=) ctx f = ctx &gt;&gt;= \\y -&gt; f y &gt;&gt; return y   -- only uses ctx once\n</code></pre>\n\n<p>You can also put the actions in a list and traverse it, using existing combinators:</p>\n\n<pre><code>traverse_ (\\go -&gt; go 'c') [putChar, putChar, putChar]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1546901805, "post_id": 54081962, "comment_id": 94999435, "body": "Or another: <code>main = stimes 3 putChar c</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1546898646, "last_edit_date": 1546898646, "creation_date": 1546895440, "answer_id": 54081962, "question_id": 54081802, "link": "https://stackoverflow.com/questions/54081802/pass-a-variable-to-several-sequenced-functions-in-io/54081962#54081962", "title": "Pass a variable to several sequenced functions in IO", "body": "<p>(This makes the possibly too-optimistic assumption that all the functions have a return type of <code>IO ()</code>.)</p>\n\n<hr>\n\n<p><code>putChar</code> has type <code>Char -&gt; IO ()</code>. There are three types here, all of which have <code>Monoid</code> instances:</p>\n\n<ul>\n<li>(Since <code>base-4.9</code>) <code>() &lt;&gt; () == ()</code></li>\n<li>(Since <code>base-4.10</code>) If <code>b</code> is a monoid, then <code>IO b</code> is as well; <code>m1 &lt;&gt; m2 == (liftA2 (&lt;&gt;)) m1 m2</code> (a new <code>IO</code> action, in which the results of executing the original <code>IO</code> actions are combined, is returned).</li>\n<li>(Since <code>base-4.9</code>) If <code>b</code> is a monoid, then for <code>f,g :: a -&gt; b</code> we have <code>f &lt;&gt; g == \\x -&gt; f x &lt;&gt; g x</code> (both functions are called on the same argument and the return values are combined.</li>\n</ul>\n\n<p>Putting this all together, functions of type <code>Char -&gt; IO ()</code> form a monoid.</p>\n\n<pre><code>&gt; :t putChar &lt;&gt; putChar &lt;&gt; putChar\nputChar &lt;&gt; putChar &lt;&gt; putChar :: Char -&gt; IO ()\n&gt; (putChar &lt;&gt; putChar &lt;&gt; putChar) 'c'\nccc&gt;\n</code></pre>\n\n<p>So you can simply write</p>\n\n<pre><code>main = putChar &lt;&gt; putChar &lt;&gt; putChar $ c\n</code></pre>\n\n<p>or</p>\n\n<pre><code>main = mconcat (replicate 3 putChar) $ c\n</code></pre>\n"}], "owner": {"reputation": 68, "user_id": 10881187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0a4f29c98969ff51c64dc910312c9c0?s=128&d=identicon&r=PG&f=1", "display_name": "nbrr", "link": "https://stackoverflow.com/users/10881187/nbrr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 54081962, "answer_count": 2, "score": 2, "last_activity_date": 1546898646, "creation_date": 1546894762, "question_id": 54081802, "link": "https://stackoverflow.com/questions/54081802/pass-a-variable-to-several-sequenced-functions-in-io", "title": "Pass a variable to several sequenced functions in IO", "body": "<p>There are a bunch of IO computations whose result don't matter, and that rely on a same context variable. I would like an aesthetical way to pass this argument to all functions.</p>\n\n<p>Say that I want to print a char several times</p>\n\n<pre><code>c = 'c'\nmain = do\n  putChar c\n  putChar c\n  putChar c\n</code></pre>\n\n<p>but I don't want to write the parameter each time.</p>\n\n<p>The following works just fine:</p>\n\n<pre><code>samearg :: (Foldable t, Monad m) =&gt; t (a -&gt; m ()) -&gt; a -&gt; m ()\nsamearg fs ctx = foldl (\\d f -&gt; d &gt;&gt;= \\_ -&gt; f ctx) (return ()) fs\n(&gt;^=) = flip samearg\n\n'c' &gt;^= [putChar,putChar,putChar]\n</code></pre>\n\n<p>Now, I'm just curious whether I could have written things according to my initial idea, or whether there is some standard way to do this. I wanted to write something like <code>'c' &gt;^= putChar &gt;^= putChar &gt;^= putChar</code> that would reduce to this</p>\n\n<pre><code>((return 'c' &gt;&gt;= putChar &gt;&gt;= \\_ -&gt; return 'c')\n&gt;&gt;= putChar &gt;&gt;= \\_ -&gt; return 'c')\n&gt;&gt;= putChar\n</code></pre>\n\n<p>but this operator I wrote isn't reducing to what I expected</p>\n\n<pre><code>(&gt;^=) :: Monad m =&gt; m b -&gt; (b -&gt; m a) -&gt; m b\n(&gt;^=) ctx f = ctx &gt;&gt;= f &gt;&gt;= \\_ -&gt; ctx\n\nreturn 'c' &gt;^= putChar &gt;^= putChar &gt;^= putChar\n</code></pre>\n\n<p>which I understand, but I'm still wondering whether I could have made it work.</p>\n"}, {"tags": ["function", "haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1546891058, "post_id": 54080933, "comment_id": 94995325, "body": "You can not mention the <i>same</i> variable twice in a pattern. What should happen if your tuple contains <code>(1, &#39;a&#39;, 2)</code>? Here the &quot;two c&#39;s&quot; are simply different."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1546891085, "post_id": 54080933, "comment_id": 94995340, "body": "Don&#39;t confuse type variables with patterns."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546891256, "post_id": 54080933, "comment_id": 94995415, "body": "There are two possibilities: <code>test (a,b,_) = (b,a,b)</code> and <code>test (_,b,c) = (b,c,b)</code>, since the only sensible thing you can do with values of unknown type is copy them from the input to the output. Further constraining the type opens up more possibilities, e.g. <code>test :: Monoid c =&gt; (c,b,c) -&gt; (b,c,b)</code> allows for <code>test (a,b,c) = (b,a&lt;&gt;c,b)</code> and <code>test (a,b,c) = (b,c&lt;&gt;a,b)</code> as well."}, {"owner": {"reputation": 3, "user_id": 10757117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/668bb4076bd58f821c9492a911b4eb4c?s=128&d=identicon&r=PG&f=1", "display_name": "Kabauter", "link": "https://stackoverflow.com/users/10757117/kabauter"}, "edited": false, "score": 0, "creation_date": 1546891391, "post_id": 54080933, "comment_id": 94995480, "body": "I have to find an expression which general type is the given one of the function test. Edit: test (a,b,_) = (b,a,b) does not work, its not of type (a,b,a) -&gt; (b,a,b). Monoid is not allowed. I have to use the given function. Does it work with a let?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1546896011, "post_id": 54080933, "comment_id": 94997422, "body": "@Kabauter, <code>test (a,b,_) = (b,a,b)</code> has a <i>more general</i> type than you specify. But if you actually give it the type signature you specify, it will compile and will have the type you want."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10757117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/668bb4076bd58f821c9492a911b4eb4c?s=128&d=identicon&r=PG&f=1", "display_name": "Kabauter", "link": "https://stackoverflow.com/users/10757117/kabauter"}, "edited": false, "score": 0, "creation_date": 1546891914, "post_id": 54081076, "comment_id": 94995720, "body": "I understand. Let me check the solutions of my mates."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 4, "last_activity_date": 1546891681, "creation_date": 1546891681, "answer_id": 54081076, "question_id": 54080933, "link": "https://stackoverflow.com/questions/54080933/expression-for-a-type/54081076#54081076", "title": "Expression for a type", "body": "<p>As mentioned in the comments, if you want</p>\n\n<pre><code>test :: forall b c. (c, b, c) -&gt; (b, c, b)\n</code></pre>\n\n<p>(<code>forall</code> added for emphasis)</p>\n\n<p>Then you can't actually <em>do</em> anything with the values in the tuple, since you know nothing about their respective types. So the only two (non-bottom) possible implementations of this function are</p>\n\n<pre><code>test (c, b, _) = (b, c, b)\n-- or\ntest (_, b, c) = (b, c, b)\n</code></pre>\n\n<p>The first and third elements of the result tuple can only possibly be <code>b</code>, as that's the only value you have of the appropriate type. The second value can be either the first or third original value.</p>\n\n<p>Of course, if you allow <a href=\"https://wiki.haskell.org/Bottom\" rel=\"nofollow noreferrer\">bottom</a>, then there are a ton of nonsense functions you can write.</p>\n\n<pre><code>test (a, b, c) = test (c, b, a)\ntest _ = undefined\ntest _ = error \"Yup, this is definitely a tuple\"\ntest (_, b, c) = (b, c, undefined)\n</code></pre>\n\n<p>None of these are terribly meaningful, but they will typecheck. For all practical purposes though, only the two non-bottom examples are interesting.</p>\n"}], "owner": {"reputation": 3, "user_id": 10757117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/668bb4076bd58f821c9492a911b4eb4c?s=128&d=identicon&r=PG&f=1", "display_name": "Kabauter", "link": "https://stackoverflow.com/users/10757117/kabauter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "closed_date": 1546896507, "answer_count": 1, "score": -4, "last_activity_date": 1546893621, "creation_date": 1546890953, "question_id": 54080933, "link": "https://stackoverflow.com/questions/54080933/expression-for-a-type", "closed_reason": "Duplicate", "title": "Expression for a type", "body": "<p>I need to find an expression for a Haskell function. \nThe function: test :: (c,b,c) -> (b,c,b)</p>\n\n<p>My code of course does not work, because there are \"Conflicting definitions for \u2018c\u2019\".</p>\n\n<pre><code>test (c,b,c) = (b, c, b)\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1546881454, "post_id": 54078870, "comment_id": 94991170, "body": "Also, consider using <code>newtype Signal = Signal [Double]</code> instead of <code>data ...</code> so that the compiler knows it can dispense with the wrapper in the run-time representation."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 6, "last_activity_date": 1546881264, "creation_date": 1546881264, "answer_id": 54078870, "question_id": 54078660, "link": "https://stackoverflow.com/questions/54078660/list-operations-on-own-types-consisting-of-one-list/54078870#54078870", "title": "List operations on own types consisting of one list", "body": "<p>Note that the function definition as below: </p>\n\n<pre><code>take2 :: Signal -&gt; Signal\ntake2 s = take 2 s\n</code></pre>\n\n<p><code>s</code> is not a list, it is a <code>Signal</code> and <code>take 2 s</code> is a list, not a <code>Signal</code>, The thing you need is get the list from <code>Signal</code> and construct a <code>Signal</code> from a list as:</p>\n\n<pre><code>take2 (Signal s) = Signal $ take 2 s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "is_accepted": false, "score": 0, "last_activity_date": 1546967997, "creation_date": 1546967997, "answer_id": 54096722, "question_id": 54078660, "link": "https://stackoverflow.com/questions/54078660/list-operations-on-own-types-consisting-of-one-list/54096722#54096722", "title": "List operations on own types consisting of one list", "body": "<p>Not knowing which analogies to use, I'll assume a C/++/#/etc background -</p>\n\n<pre><code>data Signal = Signal [Double]\n</code></pre>\n\n<p>Is equivalent to</p>\n\n<pre><code>struct Signal { vector&lt;double&gt; contents; };\n</code></pre>\n\n<p>If you wish is to actually represent a <code>[Double]</code> directly rather than containing it, i.e something akin to</p>\n\n<pre><code>typedef vector&lt;double&gt; Signal;\n</code></pre>\n\n<p>Then that's called a \"type synonym\" in Haskell and defined using:</p>\n\n<pre><code>type Signal = [Double]\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 4383523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609e0a290f2cb1ee05c5da9e3c684187?s=128&d=identicon&r=PG&f=1", "display_name": "Earthy", "link": "https://stackoverflow.com/users/4383523/earthy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546967997, "creation_date": 1546880379, "last_edit_date": 1546886607, "question_id": 54078660, "link": "https://stackoverflow.com/questions/54078660/list-operations-on-own-types-consisting-of-one-list", "title": "List operations on own types consisting of one list", "body": "<p>I got the type \"<code>Signal</code>\" that is only a list of doubles and I want to use normal list-operations like on a native <code>[Double]</code>. This should be possible but it just won't compile. How would you describe this to the compiler syntactically correct.</p>\n\n<p>Here is the test code:</p>\n\n<pre><code>data Signal = Signal [Double] deriving(Show, Eq)\n\ntest :: Signal\ntest = Signal [1.0,2.0,3.0]\n\ntake2 :: Signal -&gt; Signal\ntake2 s = take 2 s\n</code></pre>\n\n<p>Expected: <code>take2 test = [1.0,2.0]</code></p>\n\n<p>Actual:</p>\n\n<pre><code>\"Couldn't match expected type \u2018Signal\u2019 with actual type \u2018[a0]\u2019\nIn the expression: take 2 s\nIn an equation for \u2018take2\u2019: take2 s = take 2 s\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1546876797, "post_id": 54077057, "comment_id": 94988716, "body": "BTW, mixing different record constructors together typically isn&#39;t a very good idea."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546878921, "post_id": 54077057, "comment_id": 94989929, "body": "To be clear, you want to define a function <code>handle :: GsdCommand -&gt; CommandDirective GsdState</code> that <i>only</i> accepts a value created by <code>CreateWorkspace</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 2, "last_activity_date": 1546880283, "last_edit_date": 1546880283, "creation_date": 1546879944, "answer_id": 54078554, "question_id": 54077057, "link": "https://stackoverflow.com/questions/54077057/passing-a-data-constructor-instead-of-a-type-constructor-on-a-function/54078554#54078554", "title": "Passing a data constructor instead of a Type constructor on a function", "body": "<p>Maybe this approach is enough for what you want. Below is a variant of the <code>Either</code> type, but tagged with <code>L</code> (left) and <code>R</code> (right) annotations, and with projections <code>l</code> and <code>r</code>. </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n\nmodule G where\n\ndata L\ndata R\n\ndata E d a b where\n  L :: {l :: a} -&gt; E L a b \n  R :: {r :: b} -&gt; E R a b \n\nfoo :: E L a b -&gt; a\nfoo (L x) = x\n</code></pre>\n\n<p>Function <code>foo</code> and the projection <code>l</code> work only on left values, and <code>r</code> works only on right values. </p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1546881136, "post_id": 54078804, "comment_id": 94991015, "body": "Note you can also keep the record syntax with the GADT: <code>CreateWorkspace :: { commandId ::CommandID, ...} -&gt; GsdCommand Create</code>, etc."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546881307, "post_id": 54078804, "comment_id": 94991093, "body": "Explicit promotion to the type level, as with <code>&#39;Create</code>, is not necessary."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546881672, "post_id": 54078804, "comment_id": 94991261, "body": "Oh, right, because the compiler knows that <code>GsdCommand</code> has to take a type, not a function/data constructor."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1546890662, "last_edit_date": 1546890662, "creation_date": 1546881017, "answer_id": 54078804, "question_id": 54077057, "link": "https://stackoverflow.com/questions/54077057/passing-a-data-constructor-instead-of-a-type-constructor-on-a-function/54078804#54078804", "title": "Passing a data constructor instead of a Type constructor on a function", "body": "<p><strong>Solution 1: Don't get fancy, use Haskell 98 compatible types</strong></p>\n\n<p>The first solution I recommend is using a separate record type.  This doesn't require any fancy type system hackery and avoids the partial functions implicit in your record field names.</p>\n\n<pre><code>type CommandId = ()\ntype WorkspaceId = ()\ntype Text = ()\n\ndata GsdCreate = GsdCreate { gsdcCommandId     :: CommandId\n                           , gsdcWorkspaceId   :: WorkspaceId\n                           , gsdcWorkspaceName :: Text\n                           }\n        deriving (Show)\n\ndata GsdCommand =  CreateWorkspace GsdCreate\n             | RenameWorkspace { commandId :: CommandId\n                               , workspaceId ::WorkspaceId\n                               , workspaceNewName :: Text }\n             | SetGoal  { commandId :: CommandId ,\n                          workspaceId ::WorkspaceId ,\n                          goalDescription :: Text }\n        deriving (Show)\n\ntype CommandDirective a = Maybe a\ntype GsdState = ()\n\nhandle :: GsdCreate -&gt; CommandDirective GsdState\nhandle = undefined\n</code></pre>\n\n<p>Aside:  I'm actually in favor of Haskell eliminating <code>data</code> as we know it and instead having:</p>\n\n<ul>\n<li><code>Record</code> for single constructor types with field names</li>\n<li><code>data</code> without field names but with multiple constructors.</li>\n</ul>\n\n<p><strong>Solution 2: Use GADTs and DataKinds</strong></p>\n\n<p>This solution is a bit overkill for your example, but perhaps your real problem has a need that isn't presented in the snippet.  The idea is to create a new data type that defines tags for your constructors and to use those constructors as types for a GADT:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n\ntype CommandId = ()\ntype WorkspaceId = ()\ntype Text = ()\n\ndata Ty = Create | Rename | Set\n\ndata GsdCommand a where\n  CreateWorkspace :: CommandId -&gt; WorkspaceId -&gt; Text -&gt; GsdCommand Create\n  RenameWorkspace :: CommandId -&gt; WorkspaceId -&gt; Text -&gt; GsdCommand Rename\n  SetGoal         :: CommandId -&gt; WorkspaceId -&gt; Text -&gt; GsdCommand Set\n\ntype CommandDirective a = Maybe a\ntype GsdState = ()\n\nhandle :: GsdCommand Create -&gt; CommandDirective GsdState\nhandle = undefined\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 54078804, "answer_count": 2, "score": 1, "last_activity_date": 1546890662, "creation_date": 1546874227, "last_edit_date": 1546876996, "question_id": 54077057, "link": "https://stackoverflow.com/questions/54077057/passing-a-data-constructor-instead-of-a-type-constructor-on-a-function", "title": "Passing a data constructor instead of a Type constructor on a function", "body": "<pre><code>data GsdCommand =  CreateWorkspace { commandId :: CommandId , workspaceId ::WorkspaceId , workspaceName :: Text }\n             | RenameWorkspace { commandId :: CommandId , workspaceId ::WorkspaceId , workspaceNewName :: Text }\n             | SetGoal  { commandId :: CommandId ,\n                          workspaceId ::WorkspaceId ,\n                          goalId :: GoalId ,\n                          goalDescription :: Text} deriving Show\n</code></pre>\n\n<p>I would like to handle a specific command into one function, \n e.g in pseudo code :</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\nhandle :: 'CreateWorkspace -&gt; CommandDirective GsdState\n</code></pre>\n\n<p>I was thinking that I could lift value constructors into types, but I don't know how to do it actually...</p>\n"}, {"tags": ["haskell", "data-structures"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1546869872, "post_id": 54075779, "comment_id": 94984733, "body": "Oh, so <code>_ict, _sh :: Maybe Float</code> (this should be in the Q), and you want to apply <code>plusXPercent</code> on all of them? No way unless you generate that from TH as well. OTOH, generating that from TH isn&#39;t that hard, assuming you already know how to write lens generators using TH, which now that I think about it sounds reasonably obscure to not assume that everyone can do that. <a href=\"https://stackoverflow.com/questions/22807619/systematically-applying-a-function-to-all-fields-of-a-haskell-record\">Alternatives are all bad</a>, though..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1546870285, "post_id": 54075779, "comment_id": 94984952, "body": "I felt bad about leaving you with that, so going further: the type of your record declaration is gonna be <a href=\"http://hackage.haskell.org/package/template-haskell-2.14.0.0/docs/Language-Haskell-TH.html#t:Dec\" rel=\"nofollow noreferrer\"><code>Dec</code> constructed with <code>DataD</code></a>. You&#39;ll be interested in the <code>Con</code> part, which <a href=\"http://hackage.haskell.org/package/template-haskell-2.14.0.0/docs/Language-Haskell-TH.html#t:Con\" rel=\"nofollow noreferrer\">has the RecC constructor</a>. From there it&#39;s just a list of tuples of <code>(Name, Bang, Type)</code>, of which you need the <code>Name</code> if you assume they&#39;re all <code>Maybe Float</code>. Armed with that list, you can generate a traversal lens."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546870290, "post_id": 54075779, "comment_id": 94984956, "body": "I&#39;m assuming <code>Mage</code> is not defined with something like <code>data Mage a = Mage { _ict :: Maybe a, ...}</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1546870369, "post_id": 54075779, "comment_id": 94984999, "body": "Perhaps define a <code>MonoFunctor</code> instance for <code>Mage</code>?"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546870539, "post_id": 54075779, "comment_id": 94985101, "body": "@chepner (To your first comment) No, but that&#39;d been textbook case for an Applicative instance. I&#39;ve updated the question with it&#39;s actual definition."}], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1546872322, "post_id": 54076405, "comment_id": 94986156, "body": "I don&#39;t know what I did wrong but I&#39;m getting error - <code>Couldn&#39;t match expected type &#39;Element Mage&#39; with actual type &#39;Maybe Float&#39;</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1546873520, "post_id": 54076405, "comment_id": 94986844, "body": "I omitted the type instance for <code>Element</code>, fixed."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1546873467, "last_edit_date": 1546873467, "creation_date": 1546871817, "answer_id": 54076405, "question_id": 54075779, "link": "https://stackoverflow.com/questions/54075779/how-to-map-a-function-over-a-part-of-a-nested-data-structure/54076405#54076405", "title": "How to map a function over a part of a nested data structure?", "body": "<p>If you want to use the <code>mono-traversable</code> package, you can define a <code>MonoFunctor</code> instance for <code>Mage</code>.</p>\n\n<pre><code>type instance Element Mage = Maybe Float\n\ninstance MonoFunctor Mage where\n    omap f (Mage x y z) = Mage (f x) (f y) (f z)\n</code></pre>\n\n<p>Then you can use <code>omap</code> to apply (e.g.) <code>fmap (+1)</code> to every field\nof <code>Mage</code>.</p>\n\n<pre><code> omap (fmap (+1)) (Mage { _ict = Nothing                                   \n                        , _create = Just 1.24                                                                                          \n                        , _sh = Nothing\n                        })\n   == Mage { _ict = Nothing, _create = Just 2.24, _sh = Nothing }\n</code></pre>\n\n<p>Then, I think, you would write (sorry, just guessing, lenses aren't my strong suit):</p>\n\n<pre><code>--setSer x = x &amp; (structTypes . _Just . create) %~ fmap plusXPercent\n\nsetSer x = x &amp; (structTypes . _Just) %~ (omap (fmap plusXPercent))\n</code></pre>\n\n<p>However, <code>MonoFunctor</code> may be overkill; you can accomplish the same thing with the <code>Applicative</code> instance for functions.</p>\n\n<pre><code>foo :: (Maybe Float -&gt; Maybe Float) -&gt; Mage -&gt; Mage\nfoo f = Mage &lt;$&gt; f . _ict &lt;*&gt; f . _create &lt;*&gt; f . _sh\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 3, "last_activity_date": 1546872858, "creation_date": 1546872858, "answer_id": 54076695, "question_id": 54075779, "link": "https://stackoverflow.com/questions/54075779/how-to-map-a-function-over-a-part-of-a-nested-data-structure/54076695#54076695", "title": "How to map a function over a part of a nested data structure?", "body": "<p>You can always write Traversals by hand, and that's what this calls for. Lens has a class that would apply here, <a href=\"https://hackage.haskell.org/package/lens-4.17/docs/src/Control.Lens.Each.html#Each\" rel=\"nofollow noreferrer\"><code>Each</code></a>.</p>\n\n<pre><code>instance (a ~ Float, b ~ Float) =&gt; Each Mage Mage a b where\n    each f (Mage i c s) = Mage &lt;$&gt; traverse f i &lt;*&gt; traverse f c &lt;*&gt; traverse f s\n</code></pre>\n\n<p>You could also write that Traversal without the class, but you might as well re-use the name when it's appropriate. </p>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 54076405, "answer_count": 2, "score": 3, "last_activity_date": 1546873467, "creation_date": 1546869368, "last_edit_date": 1546870430, "question_id": 54075779, "link": "https://stackoverflow.com/questions/54075779/how-to-map-a-function-over-a-part-of-a-nested-data-structure", "title": "How to map a function over a part of a nested data structure?", "body": "<p>I want to map a function of type <code>Float -&gt; Float</code> over a part of a data structure which looks like this.</p>\n\n<pre><code>VDstruct { _onBuild = Just True                                                                                          \n         , _imageName = Just \"arc.png\"                                                                                        \n         , _category = Just \"All\"                                                                                         \n         , _mmo = Just 210                                                                                                     \n         , _structTypes = Just                                                                                                  \n               ( Mage                                                                                                           \n                   { _ict = Nothing                                                                                            \n                   , _create = Just 1.24                                                                                          \n                   , _sh = Nothing                                                                                                                                                                                     \n                   }    \n         }\n</code></pre>\n\n<p>I want to apply that function to <code>_ict</code>, <code>_create</code> and to <code>_sh</code>.</p>\n\n<p>I know how to do that for each one of those.\nI'm using Lenses to help me out with that.\nThe result has <code>_create = Just 5.4</code> which is exactly what I expect from <code>plusXPercent</code> function.\nThis is what I'm using right now.</p>\n\n<pre><code>setSer x = x &amp; (structTypes . _Just . create) %~ fmap plusXPercent\n</code></pre>\n\n<p>What I want to do is instead of naming every <code>_ict</code>, <code>_sh</code>, etc. I want a way to 'map' that function over the entirety of <code>Mage</code> structure.</p>\n\n<p>How should I go about doing that?</p>\n\n<p>Edit: <code>_ict</code>, <code>_create</code> and <code>_sh</code> have type <code>Maybe Float</code></p>\n\n<p>and <code>Mage</code> is defined like this</p>\n\n<pre><code>data Mage = Mage { _ict :: Maybe Float\n                 , _create :: Maybe Float\n                 , _sh :: Maybe Float\n                 } deriving Show\n</code></pre>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1546870139, "last_edit_date": 1546870139, "creation_date": 1546865906, "answer_id": 54074892, "question_id": 54074762, "link": "https://stackoverflow.com/questions/54074762/how-to-fix-the-error-cannot-construct-the-infinite-type-in-my-code-and-how-t/54074892#54074892", "title": "How to fix the error (&#39;cannot construct the infinite type&#39;) in my code and how to make my code work", "body": "<p>Your code has some errors in it.  Tweaking your misuse of <code>(:)</code> gets it to pass the type-checker:</p>\n\n<pre><code>separa a xs \n  | length xs &gt;= a =  go a (drop a xs) [take a xs]\n  | otherwise      =  [xs]\n  where\n  go a xs yss \n    | length xs &gt;= a  =  go a (drop a xs) (yss ++ [take a xs]) \n                                  -- was: (yss : (take a xs))\n    | otherwise       =  go a [] (yss ++ [xs])\n                         -- was: (yss : xs)\n  go a [] yss = yss\n</code></pre>\n\n<p>but it's better to further change it to</p>\n\n<pre><code>separa :: Int -&gt; [a] -&gt; [[a]]\nsepara a xs \n  | length xs &gt;= a =  go a (drop a xs) [take a xs]\n  | otherwise      =  [xs]\n  where\n  go a xs yss \n    | length xs &gt;= a  =  go a (drop a xs) ([take a xs] ++ yss) \n    | otherwise       =  reverse ([xs] ++ yss)\n</code></pre>\n\n<p>It works:</p>\n\n<pre><code>&gt; separa 3 [1..10]\n[[1,2,3],[4,5,6],[7,8,9],[10]]\n</code></pre>\n\n<p>This is a common \"build in reverse, then reverse when built\" idiom, frequently seen in strict functional languages. Some of them allow for lists to be built in top-down, natural order, by a technique known as <em>tail-recursion modulo cons</em>. Haskell is lazy, and lets us build its lists in top-down manner naturally and easily, with the equivalent <em>guarded recursion</em>:</p>\n\n<pre><code>separa :: Int -&gt; [a] -&gt; [[a]]\nsepara a xs \n  | length xs &gt;= a =  go a (drop a xs) [take a xs]\n  | otherwise      =  [xs]\n  where\n  go a xs yss \n    | length xs &gt;= a  =  --     go a (drop a xs) (yss ++ [take a xs]) \n                         yss ++ go a (drop a xs)         [take a xs] \n    | otherwise       =  -- go a [] (yss ++ [xs])\n                         yss ++             [xs]\n</code></pre>\n\n<p>There's an off-by-one error here; I'll leave it for you to fix on your own.</p>\n\n<hr>\n\n<p>But sometimes the infinite type is inherent to a problem, and not a result of a programming error. Then we can fix it by using recursive types. </p>\n\n<p>Whenever we get type equivalency <code>t ~ a..b..t..c..</code>, we can start by defining a type</p>\n\n<pre><code>newtype T = MkT (a..b..T..c..)\n</code></pre>\n\n<p>then see which type variables are free and close over them, as</p>\n\n<pre><code>newtype T a b c = MkT (a..b..(T a b c)..c..)\n</code></pre>\n\n<p>An example: <a href=\"https://stackoverflow.com/questions/29885983/infinite-type-error-when-defining-zip-with-foldr-only-can-it-be-fixed\">Infinite type error when defining zip with foldr only; can it be fixed?</a></p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 6, "last_activity_date": 1546867035, "creation_date": 1546867035, "answer_id": 54075186, "question_id": 54074762, "link": "https://stackoverflow.com/questions/54074762/how-to-fix-the-error-cannot-construct-the-infinite-type-in-my-code-and-how-t/54075186#54075186", "title": "How to fix the error (&#39;cannot construct the infinite type&#39;) in my code and how to make my code work", "body": "<p>Note that the expression:</p>\n\n<pre><code>yss : (take a xs)\n</code></pre>\n\n<p><code>(take a xs)</code> has type <code>[b]</code>, so <code>yss</code> has type <code>b</code>. But when you pass <code>yss : (take a xs)</code> as an argument to <code>separaM</code> function, <code>yss</code> is expected has type <code>[b]</code> not <code>b</code>. That is why the error occurred.</p>\n\n<p>Actually, you don't need <code>yss</code> to store the result, the recursive function can be defined as:</p>\n\n<pre><code>separaM _ [] = []\nseparaM a xs = (if length xs &gt;= a then (take a xs) else xs) : \n               separaM a (drop a xs)\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10550444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8acee5395fdafa904623f041d827fdf9?s=128&d=identicon&r=PG", "display_name": "Rui Fernando", "link": "https://stackoverflow.com/users/10550444/rui-fernando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 54075186, "answer_count": 2, "score": 0, "last_activity_date": 1546870139, "creation_date": 1546865287, "last_edit_date": 1546866451, "question_id": 54074762, "link": "https://stackoverflow.com/questions/54074762/how-to-fix-the-error-cannot-construct-the-infinite-type-in-my-code-and-how-t", "title": "How to fix the error (&#39;cannot construct the infinite type&#39;) in my code and how to make my code work", "body": "<p>Basically i'm trying to do a function where you are given a list and a number and you have to split the list in lists of the same size as the number given and the last split of all can have a length lower than the number given</p>\n\n<pre><code>separa a xs = if length xs &gt;= a then separaM a (drop a xs) ([take a xs]) else [xs]\n\nseparaM a xs yss = if length xs &gt;= a then separaM a (drop a xs) (yss : (take a xs)) else separaM a [] (yss : xs)\nseparaM a [] yss = yss\n</code></pre>\n\n<p>I expect the output of 3 \"comovais\" to be [\"com\",\"ova\",\"is\"] but in my program there is no output because of the error</p>\n"}, {"tags": ["haskell", "cabal"], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1546850550, "creation_date": 1546850550, "question_id": 54070995, "link": "https://stackoverflow.com/questions/54070995/how-to-have-haddock-generate-docs-with-my-suffix-handler", "title": "How to have Haddock generate docs with my suffix handler?", "body": "<p>I have a suffix handler to hack some source during build. It works fine and generates correct result.</p>\n\n<p>But when I ran <code>stack haddock</code>, it generated docs against original source. Checking out the .hs in .stack-work/ folder, my handler was not involved.</p>\n\n<p>So I checked the UserHook arg passed to haddockHook, it seemed containing my handler. So I am confused. What should I do?</p>\n\n<p>PS: My Setup.hs</p>\n\n<pre><code>main =\n  defaultMainWithHooks simpleUserHooks\n    { hookedPreProcessors = [ (\"hs\", \\bi lbi clbi -&gt;\n        PreProcessor False $ \\(iD, iF) (oD, oF) verbosity -&gt; myHandler) ]}\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1546845854, "post_id": 54068475, "comment_id": 94972924, "body": "What is the problem of your approach in question? it seems workable."}, {"owner": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1546898232, "post_id": 54068475, "comment_id": 94998301, "body": "The simple approach I have there seems a bit too tedious and I wasn&#39;t sure how to handle nested custom types."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 0, "last_activity_date": 1546835506, "creation_date": 1546835506, "answer_id": 54068574, "question_id": 54068475, "link": "https://stackoverflow.com/questions/54068475/merging-records-of-custom-data-type-in-haskell/54068574#54068574", "title": "Merging records of custom data type in Haskell", "body": "<p>For simple case you can use <code>orElse</code>.</p>\n\n<p>If you need to merge data if it presents in both objects you can create helper</p>\n\n<pre><code>mergeHelper :: (a -&gt; a-&gt; a) -&gt; Maybe a -&gt; Maybe a -&gt; Maybe a\nmergeHelper _ None x = x\nmergeHelper _ (Maybe x) _ = Maybe x\nmergeHelper f (Maybe x) (Maybe y) = Maybe $ f x y\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1546867617, "post_id": 54070996, "comment_id": 94983477, "body": "Isn&#39;t <code>Maybe (Last ...)</code> a bit redundant? Why not just <code>Last ...</code>?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1546868405, "post_id": 54070996, "comment_id": 94983908, "body": "@Carl The <code>Last</code> type used above is the one from <code>Data.Semigroup</code>, not the one from <code>Data.Monoid</code>. While <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Semigroup.html#t:Last\" rel=\"nofollow noreferrer\">the documentation for that type</a> states that you can <i>Use Option (Last a) to get the behavior of Last from Data.Monoid</i>, the <code>Option</code> wrapper will be deprecated because <code>Semigroup</code> is now a superclas of <code>Monoid</code>. So <code>Maybe (Last a)</code> seems to be the enduring abstraction..."}, {"owner": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "edited": false, "score": 0, "creation_date": 1546908871, "post_id": 54070996, "comment_id": 95001031, "body": "Thanks for the answer. This works great and introduces me to more Haskell concepts. One more thing though, if I have a large data type with many attributes, defining the <code>&lt;&gt;</code> gets pretty long. Is there any shorthand for it?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "edited": false, "score": 0, "creation_date": 1546931945, "post_id": 54070996, "comment_id": 95006402, "body": "@n.z. If you define the types so that they have unambiguous <code>Semigroup</code> instances, you may be able to use a GHC extension like <code>DeriveAnyClass</code>, but I&#39;m not sure. It&#39;s also possible you can make something work with the <code>Generic</code> type class, or with Template Haskell, but none of those are my area of expertise, so I may be wrong about those suggestions..."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 4, "last_activity_date": 1546850553, "creation_date": 1546850553, "answer_id": 54070996, "question_id": 54068475, "link": "https://stackoverflow.com/questions/54068475/merging-records-of-custom-data-type-in-haskell/54070996#54070996", "title": "Merging records of custom data type in Haskell", "body": "<p>A function with the type <code>SomeType -&gt; SomeType -&gt; SomeType</code> looks like a candidate for a <code>Semigroup</code>, or at least something that can be implemented with <code>Semigroup</code>. There's a couple of options.</p>\n\n<h1>Explicit merge</h1>\n\n<p>If you keep <code>SomeType</code> as in the OP, you could write an explicit <code>merge</code> function like this:</p>\n\n<pre><code>merge :: SomeType -&gt; SomeType -&gt; SomeType\nmerge x y = toSomeType $ toTriple x &lt;&gt; toTriple y\n  where\n    toTriple (SomeType a b c) = (Last &lt;$&gt; a, Last &lt;$&gt; b, c)\n    toSomeType (a, b, c) = SomeType (getLast &lt;$&gt; a) (getLast &lt;$&gt; b) c\n</code></pre>\n\n<p>This converts each <code>SomeType</code> instance to a triple (three-tuple), for which a <code>Semigroup</code> instance exists if all three elements have <code>Semigroup</code> instances.</p>\n\n<p>There's more than one <code>Semigroup</code> instance for <code>Maybe</code>, but (from GHC 8.4) any <code>Maybe a</code> is a <code>Semigroup</code> (and <code>Monoid</code>) instance when <code>a</code> is a <code>Semigroup</code> instance.</p>\n\n<p>The <code>Semigroup</code> instance that favours the last of two values is <code>Last</code>, so <code>toTriple</code> maps <code>a</code> and <code>b</code> to <code>Maybe Last</code> values. It doesn't, however, map <code>c</code>, because in this implementation it assumes that <code>OtherType</code> is already a <code>Semigroup</code> instance (see below).</p>\n\n<p>Since the resulting triples are themselves <code>Semigroup</code> instances, they can be combined with the <code>&lt;&gt;</code> operator. This gives you a resulting triple that you can convert back to a <code>SomeType</code> value with <code>toSomeType</code>.</p>\n\n<h1>Semigroup instances</h1>\n\n<p>You could also simply make the types themselves <code>Semigroup</code> instances. I think this is best if there's no ambiguity. In itself, <code>Maybe</code> can be more than one <code>Semigroup</code> instance, e.g. favouring the <code>First</code> or <code>Last</code> value, respectively.</p>\n\n<p>If you <em>always</em> want to favour the <code>Last</code> value, however, you can make this explicit in the type. Here's one way <code>OtherType</code> could look:</p>\n\n<pre><code>data OtherType =\n  OtherType { foo :: Maybe (Last Int), bar :: Maybe (Last String) } deriving (Eq, Show)\n</code></pre>\n\n<p>Notice that the fields aren't just <code>Maybe</code> values, but explicitly <code>Maybe Last</code> values. This gives rise to an unambiguous <code>Semigroup</code> instance:</p>\n\n<pre><code>instance Semigroup OtherType where\n  (OtherType foo1 bar1) &lt;&gt; (OtherType foo2 bar2) =\n    OtherType (foo1 &lt;&gt; foo2) (bar1 &lt;&gt; bar2)\n</code></pre>\n\n<p>You could also follow the same design principle for <code>SomeType</code>, which would make the explicit <code>merge</code> function redundant.</p>\n\n<h1>Examples</h1>\n\n<p>You can try out the above functionality in GHCi:</p>\n\n<pre><code>*Q54068475&gt; merge st1 st2\nSomeType {a = Just 1, b = Just \"world\", c = Nothing}\n*Q54068475&gt; ot1 = OtherType (Just (Last 42)) (Just (Last \"foo\"))\n*Q54068475&gt; ot2 = OtherType (Just (Last 1337)) Nothing\n*Q54068475&gt; merge (SomeType (Just 1) (Just \"hello\") (Just ot1))\n                  (SomeType Nothing (Just \"world\") (Just ot2))\nSomeType {a = Just 1,\n          b = Just \"world\",\n          c = Just (OtherType {foo = Just (Last {getLast = 1337}),\n                               bar = Just (Last {getLast = \"foo\"})})}\n</code></pre>\n\n<p>(I've added a few line breaks to the GHCi session to make it more readable...)</p>\n\n<h1>Monoids</h1>\n\n<p>These types could also be <code>Monoid</code> instances:</p>\n\n<pre><code>instance Monoid OtherType where\n  mempty = OtherType Nothing Nothing\n</code></pre>\n\n<p>This could come in useful, so you might as well consider adding those instances as well...</p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "edited": false, "score": 0, "creation_date": 1546993369, "post_id": 54075613, "comment_id": 95036132, "body": "c1 and c2 are <code>Maybe OtherType</code> so <code>merge c1 c2</code> would not work. Need something like <code>instance (Mergeable a) =&gt; Mergeable (Maybe a) where; merge a Nothing = a; merge Nothing b = b; merge a b = merge &lt;$&gt; a &lt;*&gt; b</code>     <b>Edit</b>: formatting for no code block in comment"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "edited": false, "score": 0, "creation_date": 1547040079, "post_id": 54075613, "comment_id": 95054374, "body": "Oops. <code>merge &lt;$&gt; c1 &lt;*&gt; c2</code> would suffice."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1547040132, "last_edit_date": 1547040132, "creation_date": 1546868791, "answer_id": 54075613, "question_id": 54068475, "link": "https://stackoverflow.com/questions/54068475/merging-records-of-custom-data-type-in-haskell/54075613#54075613", "title": "Merging records of custom data type in Haskell", "body": "<p>You can make use of the <code>Alternative</code> instance for <code>Maybe</code> types.</p>\n\n<pre><code>import Control.Applicative  -- for &lt;|&gt;\nmerge (SomeType a1 b1 c1) (SomeType a2 b2 c2)\n    = SomeType (a2 &lt;|&gt; a1) (b2 &lt;|&gt; b1) (c2 &lt;|&gt; c1)\n</code></pre>\n\n<p>For <code>Maybe</code> types, <code>(&lt;|&gt;)</code> returns its first argument if it is not <code>Nothing</code>, otherwise it returns its second arguments. To prioritize the <em>second</em> argument of <code>merge</code>, use its component as the first argument for <code>&lt;|&gt;</code> in each case.</p>\n\n<p>In order to handle both <code>SomeType</code> and <code>OtherType</code>, you might want to use a type class.</p>\n\n<pre><code>class Mergeable a where\n    merge a1 a2 :: a -&gt; a -&gt; a\n\ninstance Mergeable SomeType where\n    merge (SomeType a1 b1 c1) (SomeType a2 b2 c2)\n    = SomeType (a2 &lt;|&gt; a1) (b2 &lt;|&gt; b1) (merge &lt;$&gt; c1 &lt;*&gt; c2)  -- not merge c2 c1\n\ninstance Mergeable OtherType where\n    merge (OtherType a1 b1) (OtherType a2 b2) = ...\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 8929823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13886c5dc4fa15aab740ad6fa485fb9?s=128&d=identicon&r=PG&f=1", "display_name": "n.z.", "link": "https://stackoverflow.com/users/8929823/n-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 1, "accepted_answer_id": 54070996, "answer_count": 3, "score": 3, "last_activity_date": 1547040132, "creation_date": 1546834362, "last_edit_date": 1546850730, "question_id": 54068475, "link": "https://stackoverflow.com/questions/54068475/merging-records-of-custom-data-type-in-haskell", "title": "Merging records of custom data type in Haskell", "body": "<p>I have some data type</p>\n\n<pre><code>data SomeType = SomeType { a :: Maybe Int\n                         , b :: Maybe String\n                         , c :: Maybe OtherType }\n</code></pre>\n\n<p>and two variables of the type</p>\n\n<pre><code>st1 = SomeType (Just 1) (Just \"hello\") Nothing\nst2 = SomeType Nothing (Just \"world\") Nothing\n</code></pre>\n\n<p>How would I merge them prioritising the second one?</p>\n\n<pre><code>merged = SomeType (Just 1) (Just \"world\") Nothing\n</code></pre>\n\n<p>Here <code>a st2</code> is <code>Nothing</code>, so <code>Just 1</code> from <code>a st1</code> is preferred.<br>\nFor <code>b</code>, <code>Just \"world\"</code> from <code>st2</code> overrides <code>st1</code>'s <code>Just \"hello\"</code>.</p>\n\n<p>My simple approach would be to do something like</p>\n\n<pre><code>merge :: SomeType -&gt; SomeType -&gt; SomeType\nmerge (SomeType a1 b1 c1) (SomeType a2 b2 c2) = \n  SomeType { a = maybe a1 pure a2 \n           , b = maybe b1 pure b2\n           , c = maybe c1 pure c2 }\n</code></pre>\n\n<p>The actual type is larger than this example and <code>c :: Maybe OtherType</code> needs to be merged recursively as well.</p>\n\n<p><strong>Edit</strong>:\nAlso, I'm aware of record field update in the following form</p>\n\n<pre><code>st1 { b = Just \"world\" } \n</code></pre>\n\n<p>to create new record with updated fields. \nNot sure if this helps in my case.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1546816217, "post_id": 54066749, "comment_id": 94966837, "body": "Well you basically already have the required logic, there is only one constant here that should be replaced with a variable."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 4, "creation_date": 1546817501, "post_id": 54066749, "comment_id": 94967127, "body": "You have written <code>fromDigits</code> for base 10 so just replace <code>fromDigits xs</code> with <code>fromDigits 10 xs</code> and change <code>10</code> to be a variable. Also update the type"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1546857355, "post_id": 54066749, "comment_id": 94978183, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53140675/convert-a-list-of-digits-to-a-number-haskell\">Convert a list of digits to a number HASKELL</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1546817891, "creation_date": 1546817891, "answer_id": 54066915, "question_id": 54066749, "link": "https://stackoverflow.com/questions/54066749/convert-a-list-of-digits-to-a-natural-number/54066915#54066915", "title": "Convert a list of digits to a natural number", "body": "<p>A positional number system with radix <em>r</em> is structured in such way, such that a number <em>a<sub>1</sub>a<sub>2</sub>&hellip;a<sub>n</sub></em> with <em>a<sub>i</sub></em> a digit, has value:</p>\n\n<p><a href=\"https://i.stack.imgur.com/PwpvR.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/PwpvR.gif\" alt=\"sum of a_i times r^(n-i)\"></a></p>\n\n<p>So that means we can obtain the number for a sequence of of digits through:</p>\n\n<pre><code>fromDigits :: (Num a, Foldable f) =&gt; a -&gt; f a -&gt; a\nfromDigits r = foldl (\\a x -&gt; r * a + x) 0\n</code></pre>\n\n<p>or syntactically a bit more compact:</p>\n\n<pre><code>fromDigits :: (Num a, Foldable f) =&gt; a -&gt; f a -&gt; a\nfromDigits r = foldl ((+) . (r *)) 0\n</code></pre>\n\n<p>Each iteration, we thus multiply the accumulator with the radix <code>r</code>, and then we add the next digit to it. Eventually a the first digit will thus by multiplied with the radix <code>r</code> <em>n</em> times if the number contains <em>n</em> digits.</p>\n\n<p>For example the number <code>1425</code> has different values for different radices:</p>\n\n<pre><code>Prelude&gt; fromDigits 6 [1,4,2,5]\n377\nPrelude&gt; fromDigits 7 [1,4,2,5]\n558\nPrelude&gt; fromDigits 8 [1,4,2,5]\n789\nPrelude&gt; fromDigits 9 [1,4,2,5]\n1076\nPrelude&gt; fromDigits 10 [1,4,2,5]\n1425\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 9908409, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fph_tvFS-BA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3TCWtHc4AyOE3Jf-MsgD329Foteg/mo/photo.jpg?sz=128", "display_name": "Jay.F", "link": "https://stackoverflow.com/users/9908409/jay-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 54066915, "answer_count": 1, "score": 1, "last_activity_date": 1546817891, "creation_date": 1546816096, "question_id": 54066749, "link": "https://stackoverflow.com/questions/54066749/convert-a-list-of-digits-to-a-natural-number", "title": "Convert a list of digits to a natural number", "body": "<p>Given a a list of digits representing a natural number and a base >2, how can one output the proper natural number. i.e given [1,2,3] and base 10 we get 123. Given [1,0,1] and base 2 we get 5.</p>\n\n<p>There are examples that cover converting numbers to lists using div and mod, but I don't know how to do the reverse (for binary numbers, for decimals its easy enough to convert a list of digits to int directly but I assume there is a mathematical approach that works in both cases). </p>\n\n<pre><code>--For decimal conversion:\nfromDigits :: [Integer] -&gt; Integer\nfromDigits xs = aux xs 0\nwhere aux [] acc = acc\n      aux (x:xs) acc  = aux xs ((acc * 10) + x)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1546993932, "post_id": 54066166, "comment_id": 95036257, "body": "What&#39;s wrong with (fromDIgits (cleanString x)) ?"}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 9908409, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fph_tvFS-BA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3TCWtHc4AyOE3Jf-MsgD329Foteg/mo/photo.jpg?sz=128", "display_name": "Jay.F", "link": "https://stackoverflow.com/users/9908409/jay-f"}, "edited": false, "score": 0, "creation_date": 1546811297, "post_id": 54066197, "comment_id": 94965703, "body": "Thank you very much! I wish I could upvote this but my reputation is too low, fixed my issue. edit: I can just doesnt change the visible score, thanks"}, {"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 3, "creation_date": 1546813353, "post_id": 54066197, "comment_id": 94966197, "body": "For cases like this you can use the <code>Data.Function.on</code> combinator too! <code>plus = (+) `on` (fromDigits . cleanString)</code>"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1546810838, "creation_date": 1546810838, "answer_id": 54066197, "question_id": 54066166, "link": "https://stackoverflow.com/questions/54066166/need-to-change-inputs-to-a-function-before-they-are-used/54066197#54066197", "title": "Need to change inputs to a function before they are used?", "body": "<p><code>x</code> isn't a function, so it doesn't make sense to <code>.</code> it with anything. You shouldn't be doing <code>x.cleanString</code>, but rather <code>cleanString x</code>. Same for <code>y</code>. With those changes, your program seems to work for me:</p>\n\n<pre><code>plus x y = (fromDigits (cleanString x))+(fromDigits (cleanString y))\n</code></pre>\n\n<p>If you want to use <code>.</code> even though you don't have to, you can, just on functions instead of on <code>x</code> or <code>y</code>:</p>\n\n<pre><code>plus x y = ((fromDigits.cleanString) x)+((fromDigits.cleanString) y)\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 9908409, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fph_tvFS-BA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3TCWtHc4AyOE3Jf-MsgD329Foteg/mo/photo.jpg?sz=128", "display_name": "Jay.F", "link": "https://stackoverflow.com/users/9908409/jay-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 54066197, "answer_count": 1, "score": 1, "last_activity_date": 1546810921, "creation_date": 1546810574, "last_edit_date": 1546810921, "question_id": 54066166, "link": "https://stackoverflow.com/questions/54066166/need-to-change-inputs-to-a-function-before-they-are-used", "title": "Need to change inputs to a function before they are used?", "body": "<p>I am trying to write a  function that intakes two lists which represent the digits of a natural number, in reverse and SUMS them. There may also be an arbitrary number of trailing 0's in the lists.</p>\n\n<pre><code>plus :: [Int] -&gt; [Int] -&gt; [Int]\n-- Ex: \"plus [0,1,2,0] [2,1,0]\" meaning 210+12\n</code></pre>\n\n<p>I have 3 separate functions that perform different parts of the problem and I cant get them to work together:</p>\n\n<hr>\n\n<p><code>cleanString</code> puts the digits back in order (most significant first) and removes any extra 0's (<code>cleanString [0,1,2,0]</code> outputs <code>[2,1,0]</code>):</p>\n\n<p><code>fromDigits</code> takes a list like <code>[2,1,0]</code> and gives <code>210</code>:</p>\n\n<p>then the actual \"plus\" function is where I cant get it to run the input lists through <code>cleanString</code> before they go into <code>fromDigits</code> and add the resulting two ints. Compile error at <code>fromDigits (x.cleanString)</code>.</p>\n\n<hr>\n\n<pre><code>cleanString :: [Integer]-&gt;[Integer]\n--reverse the string, then trim any leading zeroes\ncleanString x = dropWhile(&lt;1) y where y=reverse x\n\nfromDigits :: [Integer] -&gt; Integer\nfromDigits xs = aux xs 0\n    where aux [] acc = acc\n          aux (x:xs) acc  = aux xs ((acc * 10) + x)\n\nplus :: [Integer]-&gt;[Integer] -&gt; Integer\nplus x y = (fromDigits (x.cleanString))+(fromDigits (y.cleanString))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1546813607, "post_id": 54066139, "comment_id": 94966259, "body": "I&#39;m not experienced enough in Haskell to know a good way to get an equivalent to Python generators - but with that particular type you can use the <code>sequence</code> function and <code>fmap</code> it over the <code>IO</code> to get a <code>IO IO [String]</code>, then use <code>join</code> to reduce to an <code>IO [String]</code> which I assume is the type you want."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 9, "last_activity_date": 1547332823, "last_edit_date": 1547332823, "creation_date": 1546815288, "answer_id": 54066662, "question_id": 54066139, "link": "https://stackoverflow.com/questions/54066139/mimicking-python-generator-with-io-in-haskell/54066662#54066662", "title": "Mimicking Python generator, with IO, in Haskell", "body": "<p>The data type you're looking for is <a href=\"https://hackage.haskell.org/package/free-5.1/docs/Control-Monad-Trans-Free.html#t:FreeT\" rel=\"nofollow noreferrer\"><code>FreeT</code></a>:</p>\n\n<pre><code>data FreeF f a b = Pure a | Free (f b)\nnewtype FreeT f m a = FreeT { runFreeT :: m (FreeF f a (FreeT f m a)) }\n</code></pre>\n\n<p><code>FreeT f m a</code> represents \"alternating layers of <code>m</code> followed by <code>f</code>, except at any point, instead of a <code>f</code>-layer, there can be a terminating <code>a</code>-value\". The specific form of this type that equates to your generators is</p>\n\n<pre><code>type Generator a = FreeT ((,) a) IO ()\n</code></pre>\n\n<p>A <code>Generator a</code> is alternating layers of <code>IO</code>-computation and <code>a</code>-production, except one of the <code>IO</code>-computations can terminate generation by producing a <code>()</code> instead.</p>\n\n<pre><code>instance (Functor f, Monad m) =&gt; Monad (FreeT f m)\ninstance MonadTrans (FreeT f)\nlift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t m a\nlift :: Monad m =&gt; m a -&gt; FreeT f m a\nliftF :: (Functor f, MonadFree f m) =&gt; f a -&gt; m a\nliftF :: (Functor f, Monad m) =&gt; f a -&gt; FreeT f m a\n</code></pre>\n\n<p>So you can write <code>gen</code> in this manner:</p>\n\n<pre><code>-- singleton generator\nyield :: a -&gt; Generator a\nyield x = liftF (x, ())\n-- empty generator (unused/part of when)\nend :: Generator a\nend = return ()\ngen :: FilePath -&gt; Generator String\ngen path = do handle &lt;- lift $ openFile path\n              fileLines &lt;- lift $ lines &lt;$&gt; hGetContents handle\n              forM_ fileLines $ \\line -&gt; do\n                  lift $ putStrLn $ \"From \" ++ path ++ \" about to yield the line \" ++ line\n                  yield line\n                  lift $ putStrLn $ \"From \" ++ path ++ \" recently yielded the line \" ++ line\n                  when ('.' `elem` line) $ gen line\n              lift $ hClose handle\n</code></pre>\n\n<p>You can then tear this structure back down:</p>\n\n<pre><code>main = iterT (\\(line, continue) -&gt; putStrLn (\"Main program has \" ++ line) &gt;&gt; continue)\n             (gen \"a.txt\")\n</code></pre>\n\n<p><code>FreeT</code> has a cousin, named <a href=\"https://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming.html#t:Stream\" rel=\"nofollow noreferrer\"><code>Stream</code></a>. This is pretty much the same thing, except it uses some tricks to squeeze some more performance out. (The cost is that equality is now fuzzier than before, but we don't usually care about equality of control structures anyway.) Specifically, instead of alternating <code>m</code> and <code>f</code> layers, <code>Stream</code> is just a sequence of <code>m</code> and <code>f</code> layers in whatever order they're created in. As long as <code>Monad m</code>, this is fine, as adjacent <code>m</code> layers can always be <code>join</code>ed together and new <code>pure</code> ones formed between adjacent <code>f</code>-layers, until the alternating structure of <code>FreeT</code> is recovered.</p>\n\n<p>If you use <code>Stream</code> (which you probably should), then you may want to replace <code>(,)</code> with <a href=\"https://hackage.haskell.org/package/streaming-0.2.2.0/docs/Data-Functor-Of.html#t:Of\" rel=\"nofollow noreferrer\"><code>Of</code></a>, from the same package:</p>\n\n<pre><code>data Of a b = !a :&gt; b\ntype Generator a = Stream (Of a) IO ()\n</code></pre>\n\n<p>The strictness isn't particularly useful with <code>String</code>, but it does read better. It's more useful for other types, like <code>Int</code>.</p>\n"}], "owner": {"reputation": 161, "user_id": 9261858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df1d12f9e960a7d9227643a8570fbdd?s=128&d=identicon&r=PG&f=1", "display_name": "Retired Writing Code for Fun", "link": "https://stackoverflow.com/users/9261858/retired-writing-code-for-fun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1547332823, "creation_date": 1546810384, "question_id": 54066139, "link": "https://stackoverflow.com/questions/54066139/mimicking-python-generator-with-io-in-haskell", "title": "Mimicking Python generator, with IO, in Haskell", "body": "<p>This is a question about how to do something in Haskell, that is easy to do in Python3.</p>\n\n<p>I have a Python3 program that uses generators, as follows:</p>\n\n<pre><code>def gen(filename):\n    for line in open(filename):\n        line = line.rstrip()\n        print(f\"From {filename} about to yield the line {line}\")\n        yield line\n        print(f\"From {filename} recently yielded the line {line}\")\n        if \".\" in line:\n            yield from gen(line)\n\nfor line in gen(\"a.txt\"):\n    print(f\"Main program has {line}\")\n</code></pre>\n\n<p>If I give it an input file a.txt containing the following:</p>\n\n<pre><code>First line of a\nb.txt\nThird line of a\n</code></pre>\n\n<p>and another input file b.txt containing the following:</p>\n\n<pre><code>First line of b\nSecond line of b\n</code></pre>\n\n<p>then the output, as I would expect, is:</p>\n\n<pre><code>From a.txt about to yield the line First line of a\nMain program has First line of a\nFrom a.txt recently yielded the line First line of a\nFrom a.txt about to yield the line b.txt\nMain program has b.txt\nFrom a.txt recently yielded the line b.txt\nFrom b.txt about to yield the line First line of b\nMain program has First line of b\nFrom b.txt recently yielded the line First line of b\nFrom b.txt about to yield the line Second line of b\nMain program has Second line of b\nFrom b.txt recently yielded the line Second line of b\nFrom a.txt about to yield the line Third line of a\nMain program has Third line of a\nFrom a.txt recently yielded the line Third line of a\n</code></pre>\n\n<p>I would very much like to be able to do the same thing in Haskell. I need to preserve the basic structure of the Python version, keeping gen() as a function (or semi-coroutine, if you want to call it that) that I can call from various different places.</p>\n\n<p>In my attempts to write it in Haskell, I am getting in a dreadful mess with types like:</p>\n\n<pre><code>IO [IO String]\n</code></pre>\n\n<p>and I suspect that I'm going about it the wrong way.</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["haskell", "scope"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1546807257, "post_id": 54065740, "comment_id": 94964630, "body": "well all operators, functions bind &quot;closer&quot; (have lower precedence) than a lambda epxression, so it is just a consequence of operator precedence."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1546807892, "post_id": 54065740, "comment_id": 94964820, "body": "Whether or not <code>\\x -&gt; x + 1 . \\y -&gt; x + y</code> makes sense semantically isn&#39;t relevant to the question of it from being <i>syntactically</i> valid."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1546817156, "post_id": 54065861, "comment_id": 94967055, "body": "An amusing aside: parsing perl actually does depend on the runtime type of the values, making it impossible to statically parse. <a href=\"http://www.jeffreykegler.com/Home/perl-and-undecidability\" rel=\"nofollow noreferrer\">jeffreykegler.com/Home/perl-and-undecidability</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1546817560, "post_id": 54065861, "comment_id": 94967140, "body": "@Carl: ah yes, the article talks about <code>dunno + 4</code>. Brilliant :) Thanks for sharing."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1546817583, "last_edit_date": 1546817583, "creation_date": 1546808037, "answer_id": 54065861, "question_id": 54065740, "link": "https://stackoverflow.com/questions/54065740/what-are-the-scoping-rules-for-bind-or-for-expressions-in-general/54065861#54065861", "title": "What are the scoping rules for bind or for expressions in general?", "body": "<p><strong>In short</strong>: Typically the syntactical correctness is a step in compilers/interpreters that is done before the semantical correctness check (type systems, etc.). There are good reasons to separate the two.</p>\n\n<blockquote>\n  <p>What I don't understand is the underlying rule. How can the compiler decide that the second lambda is a closure of the first one without this being apparent from the syntax?</p>\n</blockquote>\n\n<p>The Haskell compiler (like most, if not <em>nearly</em> all reasonable languages) are not apparent of the semantics, or the type system when they parse expressions. This is a consequence of the <a href=\"https://www.haskell.org/onlinereport/exps.html\" rel=\"nofollow noreferrer\">language grammar as described in the Haskell '98 report</a>.</p>\n\n<p>The body of a lambda expression thus <a href=\"https://stackoverflow.com/a/11237469/67579\">extends as far to the right as possible (without hitting closing parenthesis</a>.</p>\n\n<blockquote>\n  <p>In this expression such a behavior wouldn't even make sense:</p>\n\n<pre><code>\\x -&gt; x + 1 . \\y -&gt; x + y\n</code></pre>\n</blockquote>\n\n<p>No perhaps not. But typically parsing is done <em>without knowledge of the types</em>. Since that would be \"unstable\". Imagine that you write <code>2 + 3 * 4</code>. Most people will see this as <code>2 + (3 * 4)</code>, perhaps some languages will interpret this differently, but eventually programmers get used to that. Now imagine that whether or not <code>3</code> being a float results in interpreting the expression differently, so <code>2 + 3.0 * 4</code> then all of a sudden is interpreted as <code>(2 + 3.0) * 4</code>. Here one can still say that the language has some explicit rules. But if later on, we replace <code>2</code>, <code>3</code> and <code>4</code> by an identifier, then we are really getting into trouble, since altering the type of that identifier, could give a totally different meaning to a lot of expressions in the program.</p>\n\n<p>In general it however frequently makes sense to extend lambda expressions to the right, as you found out with the first expression. For example if you write:</p>\n\n<pre><code>f a b = 2 * a + b\n</code></pre>\n\n<p>then this is equivalent to:</p>\n\n<pre><code>\\a -&gt; (\\b -&gt; 2 * a + b)\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>\\a -&gt; \\b -&gt; 2 * a + b\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10675354"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54065861, "answer_count": 1, "score": 1, "last_activity_date": 1546817583, "creation_date": 1546807168, "question_id": 54065740, "link": "https://stackoverflow.com/questions/54065740/what-are-the-scoping-rules-for-bind-or-for-expressions-in-general", "title": "What are the scoping rules for bind or for expressions in general?", "body": "<p>I would'n expect this expression to work:</p>\n\n<pre><code>[1,2] &gt;&gt;= \\n -&gt; ['a','b'] &gt;&gt;= \\ch -&gt; return (n,ch) -- [(1, 'a'), (1, 'b'), ...]\n</code></pre>\n\n<p>because <code>n</code> should be out of scope in the second lambda. Apparently the second lambda is a closure of the first one:</p>\n\n<pre><code>[1,2] &gt;&gt;= (\\n -&gt; ['a','b'] &gt;&gt;= (\\ch -&gt; return (n,ch)))\n</code></pre>\n\n<p>What I don't understand is the underlying rule. How can the compiler decide\nthat the second lambda is a closure of the first one without this being apparent from the syntax?</p>\n\n<p>In this expression such a behavior wouldn't even make sense:</p>\n\n<pre><code>\\x -&gt; x + 1 . \\y -&gt; x + y\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 9, "creation_date": 1546788092, "post_id": 54062945, "comment_id": 94958928, "body": "If you always want to return two lists, then a 2-tuple of lists probably makes more sense than a list containing lists."}, {"owner": {"reputation": 51, "user_id": 7141842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80d1593a780f80751687f27550049878?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas Clarke", "link": "https://stackoverflow.com/users/7141842/lukas-clarke"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546789086, "post_id": 54062945, "comment_id": 94959202, "body": "Can you give me an example on how to do that? Sorry as I said I\u2019m very new to Haskell"}, {"owner": {"reputation": 1855, "user_id": 6587634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209643793277415/picture?type=large", "display_name": "Wong Jia Hau", "link": "https://stackoverflow.com/users/6587634/wong-jia-hau"}, "edited": false, "score": 1, "creation_date": 1546850967, "post_id": 54062945, "comment_id": 94974801, "body": "Why is this question downvoted without explanation?"}], "answers": [{"comments": [{"owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "edited": false, "score": 1, "creation_date": 1546791148, "post_id": 54063374, "comment_id": 94959811, "body": "Note that if you really do want a 2-element list and not a tuple, you can just replace all of the round parentheses with square brackets (except on the second line)"}, {"owner": {"reputation": 51, "user_id": 7141842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80d1593a780f80751687f27550049878?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas Clarke", "link": "https://stackoverflow.com/users/7141842/lukas-clarke"}, "edited": false, "score": 0, "creation_date": 1546792269, "post_id": 54063374, "comment_id": 94960185, "body": "Thanks this is exactly what i wanted to know!"}], "tags": [], "owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "is_accepted": true, "score": 4, "last_activity_date": 1546790842, "creation_date": 1546790842, "answer_id": 54063374, "question_id": 54062945, "link": "https://stackoverflow.com/questions/54062945/how-to-produce-two-lists-in-haskell/54063374#54063374", "title": "How to produce two lists in Haskell", "body": "<p>Following @WillemVanOnsem's suggestion to use a 2-tuple:</p>\n\n<pre><code>tear f [] = ([],[])\ntear f (x:xs)\n | f x = (x:y,z)\n | otherwise = (y,x:z)\n    where (y,z) = tear f xs\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 7141842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80d1593a780f80751687f27550049878?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas Clarke", "link": "https://stackoverflow.com/users/7141842/lukas-clarke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 54063374, "answer_count": 1, "score": 2, "last_activity_date": 1546884688, "creation_date": 1546788037, "last_edit_date": 1546884688, "question_id": 54062945, "link": "https://stackoverflow.com/questions/54062945/how-to-produce-two-lists-in-haskell", "title": "How to produce two lists in Haskell", "body": "<p>How do I take a list in haskell and produce two lists as an output?</p>\n\n<p>For example a question I am working on asks to create a program that takes a\npredicate and a list and returns a list of two lists, the first\nthose elements of the input list which pass the predicate, the\nsecond those that don't, in order, e.g</p>\n\n<pre><code> tear (&gt;5) [1,10,2,12,3,13]\n</code></pre>\n\n<p>=> [[10,12,13],[1,2,3]]</p>\n\n<p>What i have so far:</p>\n\n<pre><code>tear f [] = []\ntear f (x:xs)\n | f x = x: tear f xs\n | otherwise = tear f xs\n</code></pre>\n\n<p>Which produces </p>\n\n<pre><code>tear (&gt;5) [1,10,2,12,3,13]\n[10,12,13]\n</code></pre>\n"}, {"tags": ["list", "haskell", "element"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1546786781, "post_id": 54062561, "comment_id": 94958591, "body": "What should <code>palindromize &quot;racecar&quot;</code> do? What about <code>palindromize &quot;raceca&quot;</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546796976, "post_id": 54062638, "comment_id": 94961711, "body": "Just a quick note that the <code>[x]</code> case is redundant, since the <code>xs</code> case will add an empty list to end when the list contains a single element."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1546797317, "last_edit_date": 1546797317, "creation_date": 1546785929, "answer_id": 54062638, "question_id": 54062561, "link": "https://stackoverflow.com/questions/54062561/how-to-palindromize-a-list-in-haskell/54062638#54062638", "title": "How to palindromize a list in Haskell?", "body": "<p>We can use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:tail\" rel=\"nofollow noreferrer\"><strong><code>tail :: [a] -&gt; [a]</code></strong></a> to obtain a list that contains all elements of the list, except the first one. In fact a list in Haskell is defined conceptually as a linked list, and <code>tail</code> can thus be seen as a \"getter\" of the tail of a linked list node.</p>\n\n<p>We know that if we reverse a non-empty list, that such list contains at least one element, so we know such <code>tail</code> exists. We thus call <code>tail</code> on the result of the <code>reverse</code>:</p>\n\n<pre><code>palindromize :: [a] -&gt; [a]\npalindromize [] = []\npalindromize xs = xs ++ <b>tail</b> (reverse xs)</code></pre>\n\n<p>We can also make use of <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:drop\" rel=\"nofollow noreferrer\"><strong><code>drop :: Int -&gt; [a] -&gt; [a]</code></strong></a>, by calling <code>drop 1</code>, we extract a list without the first element, but <code>drop 1</code> is more safe: for an empty list <code>drop 1</code> will return the empty list. If we use <code>drop 1</code>, we can also get rid of the different clauses: a palindrome of a list is then the list and the reverse of the list where we dropped the first element from:</p>\n\n<pre><code>palindromize :: [a] -&gt; [a]\npalindromize l = l ++ <b>drop 1</b> (reverse l)</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8851389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9480107dd96a80ed52f47eddfe8d77a?s=128&d=identicon&r=PG&f=1", "display_name": "DanyJ", "link": "https://stackoverflow.com/users/8851389/danyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 54062638, "answer_count": 1, "score": 1, "last_activity_date": 1546797317, "creation_date": 1546785385, "last_edit_date": 1546786785, "question_id": 54062561, "link": "https://stackoverflow.com/questions/54062561/how-to-palindromize-a-list-in-haskell", "title": "How to palindromize a list in Haskell?", "body": "<blockquote>\n<pre><code>palindromize :: [a] -&gt; [a]\npalindromize [] = []\npalindromize [x] = [x]\npalindromize (x:xs) = (x:xs) ++ reverse(x:xs)\n</code></pre>\n</blockquote>\n\n<p>I did this code in haskell but in the middle element I don't want to see double, how to do this ?\n(Another way I don't want to see the original list last element)\nShall I use head or tail or something?</p>\n\n<p>Like that:\npalindromize \"mad\"  == \"madam\"\npalindromize \"race\" == \"racecar\"</p>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1546783665, "post_id": 54062288, "comment_id": 94957708, "body": "You should &quot;move&quot; the problem to the <code>a</code> parameter. You can define a <code>Tree (Either Int String)</code>, so then a <code>Leaf</code> can contain <code>Left 3</code>, or <code>Right &quot;string&quot;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1546783669, "post_id": 54062288, "comment_id": 94957711, "body": "The need to do this stems more from the ability to do it (easily) in other languages more than from an <i>actual</i> need to do it."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1546783733, "post_id": 54062288, "comment_id": 94957725, "body": "Why do you need different types in the leaves?"}, {"owner": {"reputation": 1, "user_id": 10875097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87bfa54e7a2751dc3a109ef34451a78?s=128&d=identicon&r=PG&f=1", "display_name": "BerryScott", "link": "https://stackoverflow.com/users/10875097/berryscott"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546784028, "post_id": 54062288, "comment_id": 94957793, "body": "What if I wanted the leaf to be any type ?  @WillemVanOnsem"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546784102, "post_id": 54062288, "comment_id": 94957808, "body": "@BerryScott: if these can be any type, then the tree is &quot;useless&quot;, since then you can not perform any operation on the tree at all, since the type is a &quot;contract&quot; what you can do with the values."}, {"owner": {"reputation": 1, "user_id": 10875097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87bfa54e7a2751dc3a109ef34451a78?s=128&d=identicon&r=PG&f=1", "display_name": "BerryScott", "link": "https://stackoverflow.com/users/10875097/berryscott"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546784404, "post_id": 54062288, "comment_id": 94957887, "body": "@WillemVanOnsem Its part of &quot;homework&quot; i have done a height and others functions on this tree, I have these functions working as it is for when leaf is just an integer or just a string I wish to do it for leaf when its anytype."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 4, "creation_date": 1546784783, "post_id": 54062288, "comment_id": 94957980, "body": "&quot;A value of any type&quot; is not a useful concept in Haskell the way it is in non-statically-typed scripting languages."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1546785073, "post_id": 54062288, "comment_id": 94958095, "body": "@BerryScott: I think the question is where the <i>quantifiers</i> in the statements are placed, you have constructed a tree that can encapsulate values of any type. All the leaves have the same type, but we can pick any type for <code>a</code>. If the leaves have all different types, then there is not much (well nothing at all actually) we can do with these elements."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1546785162, "post_id": 54062288, "comment_id": 94958125, "body": "@BerryScott You might want to double-check what the exercise actually requires. A <code>height :: Tree a -&gt; Int</code> function will work with <code>Tree String</code>, <code>Tree Int</code>, and so forth -- that, however, doesn&#39;t mean you can have <code>String</code> and <code>Int</code> elements in the same tree."}, {"owner": {"reputation": 1, "user_id": 10875097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87bfa54e7a2751dc3a109ef34451a78?s=128&d=identicon&r=PG&f=1", "display_name": "BerryScott", "link": "https://stackoverflow.com/users/10875097/berryscott"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1546785795, "post_id": 54062288, "comment_id": 94958295, "body": "@duplode the testcase examples that were given on the exercise show the tree given to the height function containing integer and bool type leaves. Functions need to be polymorphic"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1546786176, "post_id": 54062288, "comment_id": 94958410, "body": "@BerryScott &quot;[...] show the tree given to the height function containing integer and bool type leaves&quot; -- What does that tree look like in the example?"}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "edited": false, "score": 1, "creation_date": 1546839966, "post_id": 54062288, "comment_id": 94971116, "body": "Unrelated to your question, but you\u2019ll likely find your code to be significantly simpler if you get rid of the <code>Leaf a</code> constructor and use <code>Node a Empty Empty</code> instead."}], "owner": {"reputation": 1, "user_id": 10875097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87bfa54e7a2751dc3a109ef34451a78?s=128&d=identicon&r=PG&f=1", "display_name": "BerryScott", "link": "https://stackoverflow.com/users/10875097/berryscott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 203, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546783659, "creation_date": 1546783557, "last_edit_date": 1546783659, "question_id": 54062288, "link": "https://stackoverflow.com/questions/54062288/haskell-trees-how-to-get-binary-tree-with-leaf-as-any-type", "title": "Haskell trees: how to get binary tree with leaf as any type?", "body": "<p>Created a binary tree structure, values can be either a node with 2 branches, a leaf or empty. I've not specifically defined leaf to be a certain type so I can create trees with all leaves as integers or all as string, but how can I get it so that it accepts a mix of the 2 types, so a tree with leaves as integers aswell as strings?</p>\n\n<pre><code>data Tree a = Empty | Leaf a | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>Example of what I want: a node with 2 leaves, <code>leaf1 = \"a string\"</code> <code>leaf2 = 5</code>\nMy current problem is that <code>leaf1</code> and <code>leaf2</code> need to be same type so both either integers or both strings. I get an error If I do a mix.</p>\n"}, {"tags": ["haskell", "continuations", "continuation-passing", "delimited-continuations"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546776978, "post_id": 54061274, "comment_id": 94956094, "body": "I don&#39;t know what character <code>\u2217</code> (U+2217) is, but it&#39;s certainly not an asterisk, <code>*</code> (U+002A). The error probably tells you something like this, which is why you should put it in your question, instead of just saying &#39;compile error&#39;."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10675354"}, "edited": false, "score": 0, "creation_date": 1546784272, "post_id": 54062231, "comment_id": 94957847, "body": "Of course, I still need <code>return</code> and a binary lift operation, even if both are not part of the monad class anymore. Thank you so much!"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1546783615, "last_edit_date": 1546783615, "creation_date": 1546783230, "answer_id": 54062231, "question_id": 54061274, "link": "https://stackoverflow.com/questions/54061274/how-to-express-delimited-continuations-with-pure-functions-only/54062231#54062231", "title": "How to express delimited continuations with pure functions only?", "body": "<p>Keep going!</p>\n\n<pre><code>import Prelude hiding (return)\n\n-- reset :: Cont a a -&gt; Cont r a\nreset :: ((a -&gt; a) -&gt; a) -&gt; (a -&gt; r) -&gt; r\nreset k f = f $ k id\n\n-- shift :: ((a -&gt; r) -&gt; Cont r r) -&gt; Cont r a\nshift :: ((a -&gt; r) -&gt; (r -&gt; r) -&gt; r) -&gt; (a -&gt; r) -&gt; r\nshift f k = f k id\n\n-- return :: a -&gt; Cont r a\nreturn :: a -&gt; (a -&gt; r) -&gt; r\nreturn a k = k a\n\n-- liftM2 :: (a -&gt; b -&gt; c) -&gt; Cont r a -&gt; Cont r b -&gt; Cont r c\nliftM2 :: (a -&gt; b -&gt; c) -&gt; ((a -&gt; r) -&gt; r) -&gt; ((b -&gt; r) -&gt; r) -&gt; (c -&gt; r) -&gt; r\nliftM2 f ma mb k = ma $ \\a -&gt; mb $ \\b -&gt; k (f a b)\n\nexample :: Num a =&gt; (a -&gt; r) -&gt; r\nexample = liftM2 (-) (reset (liftM2 (+) (return 3) (shift (\\k -&gt; return (5*2))))) (return 1)\n</code></pre>\n\n<p>One issue with <code>(1-) (reset ((3+) (shift (\\k -&gt; 5*2))))</code> is that you're replacing <code>Cont</code>'s <code>return</code> with <code>id</code>, when it's actually <code>flip id</code>:</p>\n\n<pre><code>\u03bb :t shift (\\k -&gt; 5*2)\nshift (\\k -&gt; 5*2) :: Num ((r -&gt; r) -&gt; r) =&gt; (a -&gt; r) -&gt; r\n\u03bb :t shift (\\k -&gt; ($ 5*2))\nshift (\\k -&gt; ($ 5*2)) :: Num r =&gt; (a -&gt; r) -&gt; r\n</code></pre>\n\n<p>Usually, when ghci says \"we need to be able to treat functions as numbers for this code to work\", that means you've made a mistake somewhere :)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10675354"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 1, "accepted_answer_id": 54062231, "answer_count": 1, "score": 1, "last_activity_date": 1546783615, "creation_date": 1546776006, "last_edit_date": 1546782710, "question_id": 54061274, "link": "https://stackoverflow.com/questions/54061274/how-to-express-delimited-continuations-with-pure-functions-only", "title": "How to express delimited continuations with pure functions only?", "body": "<p>I worked through Oleg's <a href=\"http://okmij.org/ftp/continuations/Haskell-tutorial.pdf\" rel=\"nofollow noreferrer\">tutorial</a> of delimited continuations:</p>\n\n<pre><code>newtype Cont r a = Cont{runCont :: (a -&gt; r) -&gt; r}\n\ninstance Monad (Cont r) where\n  return x = Cont (\\k -&gt; k x)\n  Cont m &gt;&gt;= f = Cont (\\k -&gt; m (\\v -&gt; runCont (f v) k))\n\nrunC :: Cont r r -&gt; r\nrunC m = runCont m id\n\nreset :: Cont a a -&gt; Cont r a\nreset = return . runC\n\nshift :: ((a -&gt; r) -&gt; Cont r r) -&gt; Cont r a\nshift f = Cont (runC . f)\n\nliftM2 (-)\n  (reset\n    (liftM2 (+) (return 3)\n      (shift (\\k -&gt; return (5*2))))) -- drop the continuation\n        (return 1) -- 9\n</code></pre>\n\n<p>Since continuations are basically functions and <code>reset</code>/<code>shift</code> are not even part of the monad api, I wonder how to implement delimited continuations without the <code>newtype</code> and monad machinery.</p>\n\n<p>Here is what I've come up with so far:</p>\n\n<pre><code>reset :: Cont a a -&gt; Cont r a -- becomes\nreset :: ((a -&gt; a) -&gt; a) -&gt; (a -&gt; r) -&gt; r\nreset k f = f $ k id\n\nshift :: ((a -&gt; r) -&gt; Cont r r) -&gt; Cont r a -- becomes\nshift :: ((a -&gt; r) -&gt; (r -&gt; r) -&gt; r) -&gt; (a -&gt; r) -&gt; r\nshift f k = f k id\n</code></pre>\n\n<p>I am pretty sure this is plain wrong and if it's not I don't know how to apply the operators correctly:</p>\n\n<pre><code>(1-) (reset ((3+) (shift (\\k -&gt; 5*2)))) -- yields\n\n\u2022 Non type-variable argument in the constraint: Num ((a -&gt; a) -&gt; a)\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    t1 :: forall a r.\n          (Num ((a -&gt; a) -&gt; a), Num ((a -&gt; r) -&gt; r)) =&gt;\n          (a -&gt; r) -&gt; r\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "let", "lambda-calculus", "letrec"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1546753868, "post_id": 54058816, "comment_id": 94951660, "body": "you probably need to define <code>let times x y = x * y ...</code> otherwise doesn&#39;t make much sense."}, {"owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1546758377, "post_id": 54058816, "comment_id": 94952299, "body": "@karakfa Thank you! Small mental error on my part. Got ahead myself! I will edit. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546854532, "post_id": 54058816, "comment_id": 94976554, "body": "Haskell&#39;s <code>let</code> is not <code>let</code>, it is <code>letrec</code>."}, {"owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546876011, "post_id": 54058816, "comment_id": 94988296, "body": "@WillNess If <code>let</code> is actually <code>letrec</code>, does that mean <code>fix</code> is applied to every bindings, or only recursive ones?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546876435, "post_id": 54058816, "comment_id": 94988511, "body": "every and always. in theory at least; a compiler might realize there&#39;s no recursion and optimize. and we don&#39;t actually have to use fix. recursion can be implemented directly by the implementation, under the hood."}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "edited": false, "score": 0, "creation_date": 1546758849, "post_id": 54059091, "comment_id": 94952379, "body": "Thank you! I was already aware of using <code>fix</code> along with the extra lambda to do recursion, but hadn&#39;t seen mutually recursive bindings done, so thanks! That&#39;s really cool. With you scoping example, I see that it&#39;s like my failed implementation, but with extra brackets. If I understand currently, l.c. is right associative, and thus these two expressions should evaluate the same, yes? Your example does work in GHCi. It&#39;s always cool to see that so much can be done with just the typed lambda calculus."}, {"owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "edited": false, "score": 0, "creation_date": 1546759083, "post_id": 54059091, "comment_id": 94952418, "body": "Oh, I see the difference. I did <code>\\square times -&gt;</code> instead of <code>\\times -&gt; (\\square</code>. This makes more sense. I still don&#39;t really understand why the brackets are needed. Maybe you could clarify?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546854675, "post_id": 54059091, "comment_id": 94976644, "body": "All u need is <b>U</b>: <code>Y = U . (. U)</code>. :) (well, <b>B</b> too)."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 5, "last_activity_date": 1546754815, "creation_date": 1546754815, "answer_id": 54059091, "question_id": 54058816, "link": "https://stackoverflow.com/questions/54058816/haskell-let-bindings-in-lambda-calculus/54059091#54059091", "title": "Haskell `let` bindings in lambda calculus", "body": "<p>The <code>times</code>/<code>square</code> example can be expressed in terms of lambda functions using scoping:</p>\n\n<pre><code>(\\times -&gt; (\\square -&gt; square 5)(\\x -&gt; times x x))(\\x y -&gt; x * y)\n</code></pre>\n\n<p>But scoping isn't enough for recursive or mutually recursive let-bindings like</p>\n\n<pre><code>let ones = 1 : ones in take 5 ones\n\nlet even n = n == 0 || odd (abs n - 1)\n    odd n  = n /= 0 &amp;&amp; even (abs n - 1)\nin even 7\n</code></pre>\n\n<p>In the lambda calculus you can define the <a href=\"https://en.wikipedia.org/wiki/Fixed-point_combinator#Fixed_point_combinators_in_lambda_calculus\" rel=\"noreferrer\">y-combinator</a> for recursion as</p>\n\n<pre><code>(\\f -&gt; (\\x -&gt; f (x x))(\\x -&gt; f (x x)))\n</code></pre>\n\n<p>This lets you define functions and values in terms of themselves. That formulation isn't legal haskell due to typing constraints <a href=\"https://stackoverflow.com/questions/4273413/y-combinator-in-haskell\">but there are ways around that</a>.</p>\n\n<p>Using the y-combinator lets us express the above let-bindings using the lambda calculus:</p>\n\n<pre><code>(\\ones -&gt; take 5 ones)((\\f -&gt; (\\x -&gt; f (x x))(\\x -&gt; f (x x)))(\\ones -&gt; 1 : ones))\n\n(\\evenodd -&gt; evenodd (\\x y -&gt; x) 7)((\\f -&gt; (\\x -&gt; f (x x))(\\x -&gt; f (x x)))(\\evenodd c -&gt; c (\\n -&gt; n == 0 || evenodd (\\x y -&gt; y) (abs n - 1)) (\\n -&gt; n /= 0 &amp;&amp; evenodd (\\x y -&gt; x) (abs n - 1)))) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1546766401, "creation_date": 1546766401, "answer_id": 54060175, "question_id": 54058816, "link": "https://stackoverflow.com/questions/54058816/haskell-let-bindings-in-lambda-calculus/54060175#54060175", "title": "Haskell `let` bindings in lambda calculus", "body": "<p>Note that multiple <code>let</code> bindings can be reduced to a single one, defining a pair (tuple, in the general case). E.g. we can rewrite</p>\n\n<pre><code>let times x y = x * y\n    square x = times x x\nin square 5\n</code></pre>\n\n<p>as</p>\n\n<pre><code>let times = \\x y -&gt; x * y\n    square = \\x -&gt; times x x\nin square 5\n</code></pre>\n\n<p>then</p>\n\n<pre><code>let (times, square) = (\\x y -&gt; x * y, \\x -&gt; times x x)\nin square 5\n</code></pre>\n\n<p>then, if wanted,</p>\n\n<pre><code>let pair = (\\x y -&gt; x * y, \\x -&gt; fst pair x x)\nin snd pair 5\n</code></pre>\n\n<p>After that, we can apply the usual lambda calculus translation. If the pair definition ends up to be recursive, as in the case above, we need a fixed point combinator.</p>\n\n<pre><code>(\\pair -&gt; snd pair 5) (fix (\\pair -&gt; (\\x y -&gt; x * y, \\x -&gt; fst pair x x)))\n</code></pre>\n\n<p>Note that this translation does not play along type inference algorithms, which handle <code>let</code> in a special way, introducing polymorphism. This is not important if we only care about the dynamic aspects of our program, though.</p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "is_accepted": false, "score": 2, "last_activity_date": 1546819294, "last_edit_date": 1546819294, "creation_date": 1546794873, "answer_id": 54064000, "question_id": 54058816, "link": "https://stackoverflow.com/questions/54058816/haskell-let-bindings-in-lambda-calculus/54064000#54064000", "title": "Haskell `let` bindings in lambda calculus", "body": "<p>I will answer my own question to maybe provide a helpful perspective to those who visit this question.</p>\n\n<p>We want to implement the following program with two let bindings:</p>\n\n<pre><code>let times a b = a * b\n    square x = times x x\nin square 5\n</code></pre>\n\n<p>To start with, let's simplify this to the essence of what we want:</p>\n\n<pre><code>square 5\n</code></pre>\n\n<p>Simple enough. However, <code>square</code> in this case is undefined! Well, we can bind it using the mechanism our language provides us with - a lambda. This gives us <code>(\\ square -&gt; square 5) (\\x -&gt; times x x)</code>. Now <code>square</code> is defined, but its cousin <code>times</code> is not... Well, we need another lambda! Our final program should look like this:</p>\n\n<pre><code>(\\times -&gt; (\\square -&gt; square 5) (\\x -&gt; times x x)) (\\a b -&gt; a * b)\n</code></pre>\n\n<p>Notice that the <code>(\\times -&gt; ...)</code> completely encloses our last step, so that <code>times</code> will be in scope as it is bound. This is consistent with the answer given by @rampion, and reduces as follows:</p>\n\n<pre><code>(\\times -&gt; (\\square  -&gt; square 5) (\\x -&gt; times x x)) (\\a b -&gt; a * b) =&gt;\n(\\square -&gt; square 5) (\\x -&gt; (\\a b -&gt; a * b) x x)                    =&gt;\n(\\square -&gt; square 5) (\\x -&gt; (\\b -&gt; x * b) x)                        =&gt; \n(\\square -&gt; square 5) (\\x -&gt; x * x)                                  =&gt; \n(\\x -&gt; x * x) 5                                                      =&gt;\n5 * 5                                                                =&gt; \n25\n</code></pre>\n\n<p>If the <code>square</code> function had not depended on <code>times</code>, we could have easily written <code>(\\times square -&gt; ....</code>. The dependency means that we must nest these two environments, one containing <code>times</code>, and another inside of that which can use its definition.</p>\n\n<p>Thanks for all of your help! I'm blown away by the simplicity and power of the lambda calculus. </p>\n"}], "owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 757, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1546854510, "creation_date": 1546751316, "last_edit_date": 1546854510, "question_id": 54058816, "link": "https://stackoverflow.com/questions/54058816/haskell-let-bindings-in-lambda-calculus", "title": "Haskell `let` bindings in lambda calculus", "body": "<p>I want to understand how <code>let</code> bindings work in Haskell (or maybe lambda calculus, if the Haskell implementation differs?)</p>\n\n<p>I understand from reading <a href=\"http://dev.stephendiehl.com/fun/003_lambda_calculus.html\" rel=\"nofollow noreferrer\">Write you a Haskell</a> that this is valid for a single <code>let</code> binding.</p>\n\n<pre><code>let x = y in e == (\\x -&gt; e) y\n</code></pre>\n\n<p>This makes sense to me, since it's consistent with how bindings work in the lambda calculus. Where I'm confused is using multiple <code>let</code> bindings, where one binding can reference the bindings above. I will provide a trivial example.</p>\n\n<p>Original code:</p>\n\n<pre><code>let times x y = x * y\n    square x = times x x\nin square 5\n</code></pre>\n\n<p>My guess at the implementation:</p>\n\n<pre><code>(\\square times -&gt; square 5) (\\x -&gt; times x x) (\\x -&gt; x * x)\n</code></pre>\n\n<p>This seems not to work because <code>times</code> is not defined when square is called by the lambda. However, this can by solved by this implementation:</p>\n\n<pre><code>(\\square -&gt; square 5) ((\\times x -&gt; times x x) (\\x -&gt; x * x))\n</code></pre>\n\n<p>Is this the proper way to implement this binding, at least in the lambda calculus?</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 3, "creation_date": 1546746953, "post_id": 54058434, "comment_id": 94950781, "body": "<code>IO</code> is not the only monad for which it makes sense to talk about side-effects. For example, in the <code>State</code> the term &quot;side-effect&quot; means updating the state. In general a side-effect is anything that happens &quot;behind the scenes&quot;, anything that isn&#39;t directly encoded in the monadic computation itself."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546748689, "post_id": 54058434, "comment_id": 94951015, "body": "Have you tried proving the laws?"}, {"owner": {"reputation": 73, "user_id": 4573345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5c6b8cb4d9d400567e4f8cd97e3f623?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/4573345/dmitry"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1546779202, "post_id": 54058434, "comment_id": 94956683, "body": "@FyodorSoikin thank you for your comment, it actually clarifies a very important point that I&#39;m glad to see before I delve deeper into Haskell."}, {"owner": {"reputation": 73, "user_id": 4573345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5c6b8cb4d9d400567e4f8cd97e3f623?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/4573345/dmitry"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1546779436, "post_id": 54058434, "comment_id": 94956726, "body": "@augustss unfortunately I am not familiar with a way to formally prove these laws, but I definitely tried to analyze them and find some way one of them could not be satisfied by the given instance, but didn&#39;t find anything"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1546764664, "post_id": 54058662, "comment_id": 94953423, "body": "In other words, a [non-]commutative <code>Monad</code> is supposed to be a [non-]commutative <code>Applicative</code>. (Personally, I think this requirement is needlessly strict, and we should somehow differentiate effects that we mean to be commutative or not, but that\u2019s a separate issue.)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1546755906, "last_edit_date": 1592644375, "creation_date": 1546749387, "answer_id": 54058662, "question_id": 54058434, "link": "https://stackoverflow.com/questions/54058434/why-is-this-applicative-instance-unlawful/54058662#54058662", "title": "Why is this applicative instance unlawful?", "body": "<p>The <code>Applicative</code> instance is lawful.  In fact, it's the same instance as <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\"><code>Compose</code></a><code> IO (Either e)</code>.  Compositions of applicative functors are applicative (this is one of the very nice things that applicatives have that monads don't).</p>\n<p>However, the following is also listed in the laws section of <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html\" rel=\"noreferrer\">the documentation</a>:</p>\n<blockquote>\n<p>If <code>f</code> is also a <code>Monad</code>, it should satisfy</p>\n<pre><code>pure = return\n(&lt;*&gt;) = ap\n(*&gt;) = (&gt;&gt;)\n</code></pre>\n</blockquote>\n<p>And this is where the problem is, since there can be no monad that corresponds to the given applicative (this is where the comment about conditional execution of the RHS comes into play).  So the <code>Applicative</code> and <code>Monad</code> instances, while each in isolation is lawful, do not agree, and that is punishable by death.</p>\n"}], "owner": {"reputation": 73, "user_id": 4573345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5c6b8cb4d9d400567e4f8cd97e3f623?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/4573345/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 54058662, "answer_count": 1, "score": 7, "last_activity_date": 1546755906, "creation_date": 1546745802, "question_id": 54058434, "link": "https://stackoverflow.com/questions/54058434/why-is-this-applicative-instance-unlawful", "title": "Why is this applicative instance unlawful?", "body": "<p>I was reading about monad transformers and found this apparently well known article - <a href=\"https://two-wrongs.com/a-gentle-introduction-to-monad-transformers\" rel=\"noreferrer\">A Gentle Introduction to Monad Transformers</a>. What caught my attention was the part where the author describes an applicative instance for a makeshift <code>ExceptT</code> transformer, but leaves a warning mentioning that that instance is unlawful.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>data EitherIO e a = EitherIO {\n    runEitherIO :: IO (Either e a)\n}\n\ninstance Functor (EitherIO e) where\n    fmap f = EitherIO . fmap (fmap f) . runEitherIO\n\ninstance Applicative (EitherIO e) where\n    pure    = EitherIO . return . Right\n    f &lt;*&gt; x = EitherIO $\n        liftA2 (&lt;*&gt;)\n            (runEitherIO f)\n            (runEitherIO x)\n</code></pre>\n\n<p>And the warning:</p>\n\n<blockquote>\n  <p>Warning: A very sharp-sighted reader has pointed out to me that this applicative instance is unlawful. Specifically, it executes the side effects of the right-hand side unconditionally. The expectation of a lawful instance is that it should only execute the side-effects of the right-hand side if the left-hand side was a successful operation.</p>\n</blockquote>\n\n<p>I am assuming that specifically the implementation of <code>&lt;*&gt;</code> is the problem.</p>\n\n<p>So my main question is: <strong>which laws exactly does this instance not satisfy?</strong></p>\n\n<p>From what I can see, the four applicative laws are satisfied (I might be wrong of course). The author says that the problem is that side effects on the right (I am assuming, to the right of <code>&lt;*&gt;</code>) are executed even if the left-hand side was not a successful operation (I am assuming, \"successful operation\" means that the IO action would yield a <code>Right</code> value when executed).</p>\n\n<p>While I can see that it makes sense from a usage standpoint, it would still be enlightening to see which laws exactly are not satisfied here, and why.</p>\n\n<p>Also, the explanation of why the instance is unlawful mentions side-effects, which makes the reasoning kind of apply only for the IO monad? But at the end of the text, as a finishing move, we change the IO monad to a general monad and make it a parameter of the described data type. This leads me to another question: if we imagine that I was writing this monad transformer myself, <strong>what kind of reasoning would I need to apply, to notice that the described applicative instance is indeed unlawful, without resorting to thinking about specific monads that could be used with this transformer?</strong></p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 1259, "user_id": 7862080, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0GJT4.png?s=128&g=1", "display_name": "George Cernat", "link": "https://stackoverflow.com/users/7862080/george-cernat"}, "edited": false, "score": 0, "creation_date": 1546733380, "post_id": 54057366, "comment_id": 94948918, "body": "First, thanks for your answer. If I wanted to add the &quot;sequence&quot; to my code, where would that be? Also, there&#39;s no issue in using library functions"}, {"owner": {"reputation": 1259, "user_id": 7862080, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0GJT4.png?s=128&g=1", "display_name": "George Cernat", "link": "https://stackoverflow.com/users/7862080/george-cernat"}, "edited": false, "score": 0, "creation_date": 1546733778, "post_id": 54057366, "comment_id": 94948980, "body": "Also, how would it look using &quot;replicateM&quot;?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 1259, "user_id": 7862080, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0GJT4.png?s=128&g=1", "display_name": "George Cernat", "link": "https://stackoverflow.com/users/7862080/george-cernat"}, "edited": false, "score": 1, "creation_date": 1546741450, "post_id": 54057366, "comment_id": 94950125, "body": "@GeorgeCernat: <code>sequence (readPerss n)</code> instead of <code>let persons = readPerss n; return persons</code>; alternatively, <code>replicateM n readPers</code> (and remove <code>readPerss</code> entirely)"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 3, "last_activity_date": 1546732355, "last_edit_date": 1546732355, "creation_date": 1546731990, "answer_id": 54057366, "question_id": 54057041, "link": "https://stackoverflow.com/questions/54057041/haskell-read-list-of-persons/54057366#54057366", "title": "Haskell - read list of persons", "body": "<p>You are very close! What you are doing in <code>readPerss :: (Ord t, Num t) =&gt; t -&gt; [IO (String, Int)]</code> is returning a list of <code>IO</code> actions; each action returns a pair of <code>String</code> and <code>Int</code> when it is executed. Currently in <code>pFunc</code> you are only <em>building</em> this list of actions, storing it in a variable with <code>let</code>, and returning it from <code>pFunc</code>; you are never <em>executing</em> them with a <code>&lt;-</code> \u201cbind\u201d statement.</p>\n\n<p>There are a few simple ways to do what you want. The smallest change to your code that does what you want is to add <code>sequence</code>, which takes a <em>container of actions</em> and produces an <em>action that returns a container</em>:</p>\n\n<pre><code>sequence :: (Traversable t, Monad m) =&gt; t (m a) -&gt; m (t a)\n</code></pre>\n\n<p>Here <code>t</code> is <code>[]</code>, <code>m</code> is <code>IO</code>, and <code>a</code> is <code>(String, Int)</code>:</p>\n\n<pre><code>sequence :: [IO (String, Int)] -&gt; IO [(String, Int)]\n</code></pre>\n\n<p>Another way is to rewrite <code>readPerss</code> so that it executes the actions directly, accumulating the <code>(String, Int)</code> <em>results</em> in a list instead of accumulating the <code>IO</code> <em>actions</em>:</p>\n\n<pre><code>readPerss :: (Ord t, Num t) =&gt; t -&gt; IO [(String, Int)]\n-- Change [IO \u2026] to IO [\u2026]:         ~~~~~~~~~~~~~~~~~~\n\nreadPerss n\n  | n &gt; 0 = do\n    pers &lt;- readPers\n    perss &lt;- readPerss (n - 1)\n    return (pers : perss)\n  | otherwise = return []\n</code></pre>\n\n<p>I know you may not be supposed to use library functions if this is a homework assignment or exercise, but in typical code \u201crepeat <code>x</code> action <code>n</code> times and accumulate the results\u201d is often represented with <code>replicateM n x</code>:</p>\n\n<pre><code>replicateM :: Applicative m =&gt; Int -&gt; m a -&gt; m [a]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 2, "last_activity_date": 1546736824, "last_edit_date": 1546736824, "creation_date": 1546733781, "answer_id": 54057531, "question_id": 54057041, "link": "https://stackoverflow.com/questions/54057041/haskell-read-list-of-persons/54057531#54057531", "title": "Haskell - read list of persons", "body": "<p>This is how I always do this (it is from a code challenge isn\u2019t it). I always seperate IO and logic as soon as possible. Works perfect (unless N is very big).</p>\n\n<pre><code>import Data.List.Split (chunksOf)\n\ntype Person = (String, Int)\n\nmain = do\n    x &lt;- getContents\n    putStrLn $ program x\n\nprogram :: String -&gt; String\nprogram s = \u201cOldest is \u201c ++ x ++ \u201c (\u201c ++ (show y) ++ \u201c years old).\u201d\n    where\n    (x, y)  = solve persons\n    persons = [(name, read age :: Int) | [name, age] &lt;- chunksOf 2 . tail . lines $ s]\n\nsolve :: [Person] -&gt; Person\nsolve ls = undefined \n</code></pre>\n\n<p>I leave the <code>undefined</code> to you. </p>\n"}], "owner": {"reputation": 1259, "user_id": 7862080, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0GJT4.png?s=128&g=1", "display_name": "George Cernat", "link": "https://stackoverflow.com/users/7862080/george-cernat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 54057366, "answer_count": 2, "score": 4, "last_activity_date": 1546736824, "creation_date": 1546728760, "question_id": 54057041, "link": "https://stackoverflow.com/questions/54057041/haskell-read-list-of-persons", "title": "Haskell - read list of persons", "body": "<p>The problem sounds like this: write a program that reads a number n and then n persons, for each persons, read their name and age and then return the oldest persons/persons.</p>\n\n<p>Example input:</p>\n\n<pre><code>3\nIon Ionel Ionescu\n70\nGica Petrescu\n99\nMustafa ben Muhamad\n7\n</code></pre>\n\n<p>Example output</p>\n\n<pre><code>Oldest is Gica Petrescu (99 years).\n</code></pre>\n\n<p>My code so far:</p>\n\n<pre><code>readPers :: IO(String, Int)\nreadPers = do\n    name &lt;- getLine\n    age &lt;- readLn :: IO Int\n    return (name, age)\n\nreadPerss :: (Ord t, Num t) =&gt; t -&gt; [IO (String, Int)]\nreadPerss n\n    | n &gt; 0 = readPers : readPerss(n-1)\n    | otherwise = []\n\npFunc = do\n    print \"Numer of persons:\"\n    n &lt;- readLn :: IO Int\n    let persons = readPerss n\n    return persons\n</code></pre>\n\n<p>I first read n, then I try to make a list of persons using readPers and readPerss, but I am stuck, I don't know how to tackle it from that point forward and I guess that my implementation thus far is not quite right.</p>\n\n<p>How should I solve the problem?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546728989, "post_id": 54057028, "comment_id": 94948098, "body": "This is not possible in Haskell, because it requires dependent types. There is no type signature for <code>fromInt</code> that will work."}, {"owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546729103, "post_id": 54057028, "comment_id": 94948124, "body": "Does Haskell not have dependent types? <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/konn/&hellip;</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546729178, "post_id": 54057028, "comment_id": 94948142, "body": "No, not of the kind you require. If you read the article you linked, you will notice that it does not allow the type signature you require."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1546729286, "post_id": 54057028, "comment_id": 94948161, "body": "You should add some more context why you want that. Broadly speaking, there are two very different ways you could approach this: with type families (as type-level functions) or with Template Haskell (to generate code for type expressions)."}, {"owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546729535, "post_id": 54057028, "comment_id": 94948225, "body": "@leftaroundabout I take it with Template Haskell <code>fromInt</code> would generate the <code>inc $ inc $ ...</code> expression? What would the type family approach be?"}], "answers": [{"comments": [{"owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "edited": false, "score": 0, "creation_date": 1546793132, "post_id": 54057911, "comment_id": 94960493, "body": "I take it the core issue is that for any given function the result type has to be fixed?"}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": true, "score": 3, "last_activity_date": 1546738618, "creation_date": 1546738618, "answer_id": 54057911, "question_id": 54057028, "link": "https://stackoverflow.com/questions/54057028/at-compile-time-generate-type-level-nats-for-constraint-checking/54057911#54057911", "title": "At compile time generate type level Nats for constraint checking", "body": "<p>Since Haskell does not have dependent types, there\u2019s no way to lift value-level <code>Int</code> to a type-level natural.  Depending on your use case, you have several approximating options.</p>\n\n<h3>Use continuation passing style</h3>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\n\nfromInt :: Int -&gt; (forall a. IntNat a -&gt; r) -&gt; r\nfromInt 0 f = f zero\nfromInt n f = fromInt (n - 1) (f . inc)\n</code></pre>\n\n<h3>Use an existential type</h3>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata AnyIntNat = forall n. AnyIntNat (IntNat n)\n\nfromInt :: Int -&gt; AnyIntNat\nfromInt 0 = AnyIntNat zero\nfromInt n =\n  case fromInt (n - 1) of\n    AnyIntNat m -&gt; AnyIntNat (inc m)\n</code></pre>\n\n<h3>Take advantage of the existing type-level literals</h3>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, DataKinds, FlexibleContexts,\n  TypeApplications, TypeFamilies, TypeOperators, UndecidableInstances\n  #-}\n\nimport GHC.TypeLits\n\nclass GetIntNat n where\n  getIntNat :: IntNat n\n\ninstance GetIntNat Z where\n  getIntNat = zero\n\ninstance GetIntNat n =&gt; GetIntNat (S n) where\n  getIntNat = inc getIntNat\n\ntype family Peano n where\n  Peano 0 = Z\n  Peano n = S (Peano (n - 1))\n\n-- usage: fromNat @5\nfromNat :: GetIntNat (Peano n) =&gt; IntNat (Peano n)\nfromNat = getIntNat\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 2, "last_activity_date": 1546739052, "creation_date": 1546739052, "answer_id": 54057945, "question_id": 54057028, "link": "https://stackoverflow.com/questions/54057028/at-compile-time-generate-type-level-nats-for-constraint-checking/54057945#54057945", "title": "At compile time generate type level Nats for constraint checking", "body": "<blockquote>\n  <p>I would like users of the DSL to not have to write something like:</p>\n\n<pre><code>five = inc $ inc $ inc $ inc $ inc $ zero\n</code></pre>\n</blockquote>\n\n<p>This is the sort of thing you could easily write a quasiquoter for, but in this case you can use GHC's support for type-level Nat literals, converting to your representation using type families (which are type-level functions).</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators, KindSignatures, TypeFamilies, UndecidableInstances  #-}\nimport GHC.TypeLits\nimport Data.Proxy\n\ndata Z\ndata S a\n\ntype family FromNat (n :: Nat) where\n  FromNat 0 = Z\n  FromNat n = S (FromNat (n - 1))\n\nfromNat :: Proxy n -&gt; Proxy (FromNat n)\nfromNat _ = Proxy\n</code></pre>\n\n<p>You also get some things like type-level addition etc</p>\n\n<pre><code>*Main GHC.TypeLits Data.Proxy&gt; :t fromNat (Proxy :: Proxy 5)\nfromNat (Proxy :: Proxy 5) :: Proxy (S (S (S (S (S Z)))))\n*Main GHC.TypeLits Data.Proxy&gt; :t fromNat (Proxy :: Proxy (3 + 2))\nfromNat (Proxy :: Proxy (3 + 2)) :: Proxy (S (S (S (S (S Z)))))\n</code></pre>\n\n<p><strong>EDIT</strong>: Anders in first with an answer, but leaving this as an alternative implementation</p>\n"}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 54057911, "answer_count": 2, "score": 3, "last_activity_date": 1546739052, "creation_date": 1546728642, "last_edit_date": 1546729049, "question_id": 54057028, "link": "https://stackoverflow.com/questions/54057028/at-compile-time-generate-type-level-nats-for-constraint-checking", "title": "At compile time generate type level Nats for constraint checking", "body": "<p>I am trying to have the value of an integer value represented at the type level at compile time such that I can check it against some constraints.</p>\n\n<p>I would like users of the DSL to not have to write something like:</p>\n\n<pre><code>five = inc $ inc $ inc $ inc $ inc $ zero\n</code></pre>\n\n<p>Hence what I've been trying to create is a function which elevates that value to the type level. </p>\n\n<p>ie</p>\n\n<pre><code>fromInt :: Int -&gt; repr n\nfromInt n = __\n</code></pre>\n\n<p>This is what I have tried so far:</p>\n\n<pre><code>data Z\ndata S a\n\ndata IntNat a = IN Int\n\nzero = (IN 0 :: IntNat Z)\n\ninc :: IntNat a -&gt; IntNat (S a)\ninc (IN i) = (IN (i + 1))\n\nfromInt :: Int -&gt; IntNat a \nfromInt 0 = (IN 0 :: IntNat Z)\nfromInt n = inc (fromInt (n - 1))\n</code></pre>\n\n<p>This however fails since I don't have a general enough representation of the IntNat, <code>IntNat Z ~/~ IntNat S Z</code>.</p>\n\n<p>Is this approach generally flawed, or is it a case of needing to enclose <code>S Z</code> in a type family / type class?</p>\n\n<p>The other classic example of this would be to generate a vector of a specific length when using type level length annotated vectors. That function should address the same problem that I am having.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1546728619, "post_id": 54057022, "comment_id": 94948011, "body": "Why do you think there are |a| inhabitants in the first place?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546728919, "post_id": 54057022, "comment_id": 94948085, "body": "I&#39;m voting to close this question as off-topic because it is not a question about Haskell or programming in general, but rather about mathematics. Try asking this on <a href=\"https://math.stackexchange.com/\">Mathematics stack exchange</a>, if it has not already been asked."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546732750, "post_id": 54057022, "comment_id": 94948809, "body": "I suspect you&#39;ve misunderstood the word &quot;inhabitants&quot; here (which is a strange one to use). As already pointed out, this is a question of pure mathematics - nothing to do with programming, or Haskell - but from the figure of <code>|b|^|a|</code> it&#39;s clear that it means the number of different functions from <code>a</code> to <code>b</code>. I suspect you&#39;re thinking of something different. (Note that Haskell has no concept of functions being &quot;the same&quot; or different - function types are not members of <code>Eq</code>. This is for the simple reason that it is impossible in practice to test if 2 functions agree on every possible input.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1546779093, "post_id": 54057022, "comment_id": 94956655, "body": "@RobinZigmond &quot;Inhabitants&quot; is an appropriate word here. As for sameness of functions, in this context that usually means extensional equality, that is, having the same values at every argument. See also <a href=\"https://stackoverflow.com/q/9190352/2751851\"><i>Abusing the algebra of algebraic data types - why does this work?</i></a>."}, {"owner": {"reputation": 39, "user_id": 10873065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a9bbac2bdca432feca99f6496f18e79?s=128&d=identicon&r=PG&f=1", "display_name": "littlefish", "link": "https://stackoverflow.com/users/10873065/littlefish"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546784856, "post_id": 54057022, "comment_id": 94958005, "body": "@AJFarmar it is, of course, a Haskell problem as a and b is any type here"}, {"owner": {"reputation": 39, "user_id": 10873065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a9bbac2bdca432feca99f6496f18e79?s=128&d=identicon&r=PG&f=1", "display_name": "littlefish", "link": "https://stackoverflow.com/users/10873065/littlefish"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546784988, "post_id": 54057022, "comment_id": 94958061, "body": "@WillemVanOnsem As far as i can see it is because it can have |a|  number of instances in the any type so a should contain |a| inhabitants"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1546785129, "post_id": 54057022, "comment_id": 94958113, "body": "@littlefish No, <code>a</code> and <code>b</code> here represent sets, which is why you&#39;re using the well-known set notation <code>|a|</code> to represent the cardinality of the set <code>a</code>. The fact that this may be applied to Haskell types is incidental; this may be applied to any typed programming language, and indeed mathematical functions."}, {"owner": {"reputation": 39, "user_id": 10873065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a9bbac2bdca432feca99f6496f18e79?s=128&d=identicon&r=PG&f=1", "display_name": "littlefish", "link": "https://stackoverflow.com/users/10873065/littlefish"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546785230, "post_id": 54057022, "comment_id": 94958147, "body": "@AJFarmar ok if you say so"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546797619, "post_id": 54057022, "comment_id": 94961915, "body": "@AJFarmar With respect, I think the OP probably knows what their own question is about."}, {"owner": {"reputation": 39, "user_id": 10873065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a9bbac2bdca432feca99f6496f18e79?s=128&d=identicon&r=PG&f=1", "display_name": "littlefish", "link": "https://stackoverflow.com/users/10873065/littlefish"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1547135262, "post_id": 54057022, "comment_id": 95095812, "body": "@ReinHenrichs THANK YOU!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1546732034, "creation_date": 1546732034, "answer_id": 54057371, "question_id": 54057022, "link": "https://stackoverflow.com/questions/54057022/why-there-are-ba-inhabitants-in-the-function-a-b-how-it-comes-why-it-is-n/54057371#54057371", "title": "why there are |b|^|a| inhabitants in the function a-&gt;b.how it comes? why it is not just &quot;a&quot; inhabitants", "body": "<p>Let's talk about a specific example, namely functions on the two specific types below:</p>\n\n<pre><code>data Three = A | B | C\ndata Four = OneFish | TwoFish | RedFish | BlueFish\n</code></pre>\n\n<p>A function of type <code>Three -&gt; Four</code> can be fully specified by choosing one of the four possible values of type <code>Four</code> for each of the inputs <code>A</code>, <code>B</code>, and <code>C</code>; here's an example:</p>\n\n<pre><code>f A = TwoFish\nf B = BlueFish\nf C = OneFish\n</code></pre>\n\n<p>Here's another example; it's just like <code>f</code> except that it makes a different choice for <code>C</code>:</p>\n\n<pre><code>g A = TwoFish\ng B = BlueFish\ng C = BlueFish\n</code></pre>\n\n<p>Since there are four choices of output for <code>A</code>, four choices of output for <code>B</code>, and four choices of output for <code>C</code>, there are 4*4*4 = 64 possible choices of functions.</p>\n\n<p>Now we can generalize a little bit and talk about total functions on other finite input types. As before, a function from <code>a</code> to <code>b</code> can be fully specified by telling which <code>b</code> it chooses for each input <code>a</code>. Where before we had 4 possible outputs for each input, there are now <code>|b|</code>-many possibilities for each of these choices. As before, since the choices are completely independent, we must multiply <code>|b|</code> by itself once for each possible input -- that is, <code>|a|</code>-many times. That is, we have <code>|b|^|a|</code> possible complete specifications.</p>\n"}], "owner": {"reputation": 39, "user_id": 10873065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a9bbac2bdca432feca99f6496f18e79?s=128&d=identicon&r=PG&f=1", "display_name": "littlefish", "link": "https://stackoverflow.com/users/10873065/littlefish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1546732034, "creation_date": 1546728584, "question_id": 54057022, "link": "https://stackoverflow.com/questions/54057022/why-there-are-ba-inhabitants-in-the-function-a-b-how-it-comes-why-it-is-n", "title": "why there are |b|^|a| inhabitants in the function a-&gt;b.how it comes? why it is not just &quot;a&quot; inhabitants", "body": "<p>why there are |b|^|a| inhabitants in the function a->b\nI think it should be \"a\" inhabitants in it as a is any type. Can't understand why it is not.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546728233, "post_id": 54056959, "comment_id": 94947927, "body": "You mean decrement all the elements between index <code>i</code> and <code>j</code>? &quot;Decrement all the integers 0 &lt;= i &lt;= j &lt; N&quot; is a bit ambiguous."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1546728504, "post_id": 54056959, "comment_id": 94947990, "body": "It might be obvious to you, but what is <code>S</code>? Please add the relevant import statement."}, {"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546728856, "post_id": 54056959, "comment_id": 94948063, "body": "@WillemVanOnsem it should become clear from the function definition"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1546728966, "post_id": 54056959, "comment_id": 94948092, "body": "@Amoz: strictly speaking if you say &quot;<i>Lets say I have a list of integers of length N and I want to increment all the integers 0 &lt;= i &lt;= j &lt; N</i>&quot;, then it means you want to decrement elements in a list for which the integers &quot;<i>0 &lt;= i &lt;= j &lt; N</i>&quot; hold, but <i>0 &lt;= i &lt;= j &lt; N</i> are no integers, it is a boolean (well unless we extend the &quot;&lt;=&quot; operator, etc.). so the definition right now, does not make much sense."}, {"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1546729614, "post_id": 54056959, "comment_id": 94948248, "body": "@WillemVanOnsem Thanks I get your point. I thought the word &quot;index&quot; in the title could be sufficient. I edited my post! thanks for feedback"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 0, "last_activity_date": 1546739002, "creation_date": 1546739002, "answer_id": 54057941, "question_id": 54056959, "link": "https://stackoverflow.com/questions/54056959/haskell-update-sublist-by-index/54057941#54057941", "title": "Haskell update sublist by index", "body": "<p>We need to be thinking more functionally about this.  If we look at:</p>\n\n<pre><code>S.adjust :: Int -&gt; (a -&gt; a) -&gt; S.Seq a -&gt; S.Seq a\n</code></pre>\n\n<p>It takes an index to adjust, the adjustment to apply, and a sequence, and returns a new sequence.  To adjust a bunch of elements, we adjust the first, then adjust the second to the result of the first adjustment, and so on.  First we can make a list of all the adjustments we want to make:</p>\n\n<pre><code>adjustments :: [S.Seq Int -&gt; S.Seq Int]\nadjustments = [ S.adjust i (+1) | i &lt;- [lower..upper] ]\n</code></pre>\n\n<p>(take note: this is a list of functions).   Then I want to apply one after the next to a seed sequence.  So if the list ended up being</p>\n\n<pre><code>adjustments = [inc1, inc2, inc3]\n</code></pre>\n\n<p>We want to get</p>\n\n<pre><code>inc1 (inc2 (inc3 seq0))\n</code></pre>\n\n<p>where <code>seq0</code> is the initial incoming sequence.  Does this approach make sense; is it enough to get you started?  </p>\n"}, {"tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": false, "score": 2, "last_activity_date": 1546739383, "creation_date": 1546739383, "answer_id": 54057971, "question_id": 54056959, "link": "https://stackoverflow.com/questions/54056959/haskell-update-sublist-by-index/54057971#54057971", "title": "Haskell update sublist by index", "body": "<p>A more efficient approach is to split the sequence at the two endpoints, use <code>fmap</code> on the middle part, then join the parts back together.</p>\n\n<pre><code>increment :: Int -&gt; Int -&gt; S.Seq Int -&gt; S.Seq Int\nincrement i j sq = sq0 S.&gt;&lt; fmap (+ 1) sq1 S.&gt;&lt; sq2\n  where\n    (sq01, sq2) = S.splitAt (j + 1) sq\n    (sq0, sq1) = S.splitAt i sq01\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 4, "last_activity_date": 1546764433, "creation_date": 1546764433, "answer_id": 54059961, "question_id": 54056959, "link": "https://stackoverflow.com/questions/54056959/haskell-update-sublist-by-index/54059961#54059961", "title": "Haskell update sublist by index", "body": "<blockquote>\n  <p>I have tried searching, and also looking at the standard libaries (Data.Array, Data.Vector etc) but there's something about the way it's written that makes my eyes bleed a little bit and I want some human advice</p>\n</blockquote>\n\n<p>Yes, it is straight forward to use <code>Data.Array</code> to dual with problem that involved index. For immutable array, you can use <code>accum</code> function to update the elements of array with list of <code>(index, value)</code> pair to specify the index and value. </p>\n\n<p>For example, assume we need add 1 to elements of array <code>[1,2,3,4,5,6,7,8,9,10]</code> from index 2 to 4.</p>\n\n<p>Fristly, construct an array from list <code>[1,2,3,4,5,6,7,8,9,10]</code>:</p>\n\n<pre><code>testArray = let xs = [1..10] in listArray (0, length xs-1) xs\n</code></pre>\n\n<p>and apply <code>accum</code> function to the array:</p>\n\n<pre><code>increment' i j ary = accum (+) ary (zip [i..j] (repeat 1))\n</code></pre>\n\n<p>Note that <code>(zip [i..j] (repeat 1))</code> constructs a list of pairs, if <code>i = 2 and j = 4</code> gives:</p>\n\n<pre><code>[(2, 1), (3, 1), (4, 1)]\n</code></pre>\n\n<p>the first value of pair is the index of array and the second is second argument of <code>(+)</code>, <code>accum</code> retrieve the value of specific index and apply <code>(+1)</code> to the value, that is just what we want. To test it:</p>\n\n<pre><code>elems $ increment' 2 4 testArray\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>[1,2,4,5,6,6,7,8,9,10]\n</code></pre>\n\n<p>Otherwise, if you just want to replace the old value of array with new value and don't care what the old value is. <code>accum</code> function can be applied in this situation as well. For example, assume to replace elements of index 2 to 4 with <code>0</code>:</p>\n\n<pre><code>accum (flip const) testArray (zip [2..4] (repeat 0))\n</code></pre>\n"}], "owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1546764433, "creation_date": 1546728152, "last_edit_date": 1546729399, "question_id": 54056959, "link": "https://stackoverflow.com/questions/54056959/haskell-update-sublist-by-index", "title": "Haskell update sublist by index", "body": "<p>Trying to learn Haskell, I have come across this simple pattern a few times recently: </p>\n\n<p>Lets say I have a list of something and I want to update all elements in a sublist, for example from index i to j.</p>\n\n<p>All the solutions I can come up with feels really hacky and bad, like this example:</p>\n\n<pre><code>import qualified Data.Sequence as S\n\nincrement :: Int -&gt; Int -&gt; S.Seq Int -&gt; S.Seq Int\nincrement i j sq | i &lt;= j = increment (i + 1) to (S.adjust (+1) i sq)\n                 | otherwise = sq\n</code></pre>\n\n<p>I guess I would make it even worse with a list. </p>\n\n<p>Anyone know some easy way to do this? I have tried searching, and also looking at the standard libaries (Data.Array, Data.Vector etc) but there's something about the way it's written that makes my eyes bleed a little bit and I want some human advice</p>\n"}, {"tags": ["list", "haskell", "count", "iteration"], "answers": [{"comments": [{"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 0, "creation_date": 1546690807, "post_id": 54051593, "comment_id": 94938193, "body": "Thank you for <code>zipWith</code> suggestion and thorough explanation! I will put together <code>expand</code> and <code>zipWith</code> in a separate posting for reference."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 6, "last_activity_date": 1546688176, "creation_date": 1546688176, "answer_id": 54051593, "question_id": 54051075, "link": "https://stackoverflow.com/questions/54051075/accumulate-value-count-inside-a-list-of-tuples-in-haskell/54051593#54051593", "title": "Accumulate value count inside a list of tuples in Haskell", "body": "<p>If you already have a function <code>expand</code> to expand <code>\"aqqqq\"</code> into list of tuples, you can accomplish the rest with <code>zipWith</code>:</p>\n\n<pre><code>Prelude&gt; zipWith (\\(p, ix) x -&gt; (p, ix, x)) (expand fmt) row\n[('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)]\n</code></pre>\n\n<p>The <code>expand</code> function produces tuples of the type <code>Num t =&gt; (Char, t)</code>. I called the values inside that tuple <code>p</code> (for <em>period</em>) and <code>ix</code> (for <em>index</em>). Zipping that list of tuples with <code>row</code> also produces values, that I, in the lambda expression, simply called <code>x</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1546722241, "post_id": 54052142, "comment_id": 94946498, "body": "As you say, partial application of your original solution wouldn&#39;t make things faster. Your last definition of <code>makeSplitter</code> is good. If you like, you can make the <code>values</code> lamdba implicit here: <code>makeSplitter fmt = zipWith merge pos where ...</code>. I think it&#39;s also clearer what&#39;s going on if you just get rid of the <code>pos</code> binding: <code>makeSplitter fmt = zipWith merge (expand fmt) where ...</code>"}, {"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1546724448, "post_id": 54052142, "comment_id": 94947107, "body": "Thank you, @amalloy. I think the excessive bindings I used are due to imperative programming background, I removed them from code."}], "tags": [], "owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "is_accepted": false, "score": 1, "last_activity_date": 1546692396, "creation_date": 1546692396, "answer_id": 54052142, "question_id": 54051075, "link": "https://stackoverflow.com/questions/54051075/accumulate-value-count-inside-a-list-of-tuples-in-haskell/54052142#54052142", "title": "Accumulate value count inside a list of tuples in Haskell", "body": "<p>Based on @Mark Seemann suggestion, here is a complete listing with a solution. I changed lambda to a named function for a bit more readability and introduced a type for row format.</p>\n\n<pre><code>count :: Char -&gt; String -&gt; Int\ncount letter str = length $ filter (== letter) str\n\ntype RowFormat = [Char]\nexpand :: RowFormat -&gt; [(Char, Int)]\nexpand pat = [(c, count c (take (i+1) pat)) | (c, i) &lt;- zip pat [0..]]\n\nsplit' :: RowFormat -&gt; [a] -&gt; [(Char, Int, a)]\nsplit' fmt values = zipWith merge (expand fmt) values\n      where merge (freq, period) value = (freq, period, value) \n</code></pre>\n\n<p>The result is as expected:</p>\n\n<pre><code>*Main&gt; split' \"aqqqq\" [100, 10, 40, 25, 25]\n[('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)]\n</code></pre>\n\n<p>An afterthought - I still expand the format string each time I parse row, probably even currying <code>parse = split' \"aqqqq\"</code> will just delay computation. \nHere is my try to make a dedicated reader function:</p>\n\n<pre><code>makeSplitter fmt = \\values -&gt; zipWith merge pos values\n      where \n        merge (freq, period) value = (freq, period, value)\n        pos = expand fmt \nsplitRow = makeSplitter \"aqqqq\" \na = splitRow [100, 10, 40, 25, 25]\n</code></pre>\n\n<p><code>a</code> is expected result, same as above</p>\n\n<pre><code>[('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)] \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 2, "last_activity_date": 1546708729, "creation_date": 1546708729, "answer_id": 54054326, "question_id": 54051075, "link": "https://stackoverflow.com/questions/54051075/accumulate-value-count-inside-a-list-of-tuples-in-haskell/54054326#54054326", "title": "Accumulate value count inside a list of tuples in Haskell", "body": "<p>The main problem here is how to convert the string, say <code>\"aqqqq\"</code> to the list of frequency of characters appear in the string. i.e. we want:</p>\n\n<pre><code>\"aqqqq\" =&gt; [1, 1, 2, 3, 4]\n</code></pre>\n\n<p>Once the list of frequency is constructed, we can use <code>zip3</code> to product the expected list of tuples as:</p>\n\n<pre><code>[('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)]\n</code></pre>\n\n<p>Obviously, we can't use <code>map</code> to product desired frequency list since the value need to be accumulated. To solve it, I recommend to use <code>Data.Map</code> in order to improve the computational complexity from <code>O(n)</code> to <code>O(log n)</code>. </p>\n\n<p>It is simple to count the frequency using <code>insertWith</code> as:</p>\n\n<pre><code>countFreq  c m = insertWith (+) c 1 m\n</code></pre>\n\n<p>and get back the accumulated value using <code>lookup</code> as:</p>\n\n<pre><code>accumValue c m = fromMaybe 0 (Map.lookup c m) + 1\n</code></pre>\n\n<p>now, it is straight forward to build desired list as:</p>\n\n<pre><code>mkAccumList (c:cs) m = accumValue c m : mkAccumList cs (countFreq c m)\n</code></pre>\n\n<p>put all together:</p>\n\n<pre><code>import Data.Map as Map (empty, lookup, insertWith)\nimport Data.Maybe (fromMaybe)\n\ncountFreq  c m = insertWith (+) c 1 m\naccumValue c m = fromMaybe 0 (Map.lookup c m) + 1\n\nsplit::String -&gt; [a] -&gt; [(Char, Int, a)]\nsplit fmt row = zip3 fmt (mkAccumList fmt Map.empty) row\n    where mkAccumList (c:cs) m = accumValue c m : mkAccumList cs (countFreq c m)\n          mkAccumList [] _ = []\n</code></pre>\n\n<p>To work with infinite list:</p>\n\n<pre><code>take 8 $ split (cycle \"aqqqq\") (cycle [100, 10, 40, 25, 25])\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>[('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25),('a',2,100),('q',5,10),\n('q',6,40)]    \n</code></pre>\n"}], "owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "accepted_answer_id": 54051593, "answer_count": 3, "score": 3, "last_activity_date": 1546708729, "creation_date": 1546684230, "last_edit_date": 1546688425, "question_id": 54051075, "link": "https://stackoverflow.com/questions/54051075/accumulate-value-count-inside-a-list-of-tuples-in-haskell", "title": "Accumulate value count inside a list of tuples in Haskell", "body": "<p>I'm trying to parse a list using a pattern string that indicated types of values (annual and quarterly). I need to accumulate quarter numbers in the resulting output. So far I came up with this:</p>\n\n<pre><code>row = [100, 10, 40, 25, 25]\nfmt = \"aqqqq\"\nexpected = [('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)]\n\ncount :: Char -&gt; String -&gt; Int\ncount letter str = length $ filter (== letter) str\n\nsplit :: String -&gt; [a] -&gt; [(Char, Int, a)]\nsplit fmt row = [(freq, count freq (fmt' i), x)   \n               | (freq, x, i) &lt;- zip3 fmt row [0..]]\n               where fmt' i = take (i+1) fmt\n\n-- split \"aqqqq\" [100, 10, 40, 25, 25]\n-- [('a',1,100),('q',1,10),('q',2,40),('q',3,25),('q',4,25)]\n</code></pre>\n\n<p>I imagine there should be something more readable and performant that this code, or even a terrific one liner.</p>\n\n<p>I also experimented with expanding <code>\"aqqqq\"</code> into list of tuples <code>[('a',1),('q',1),('q',2),('q',3),('q',4)]</code> and later adding values; maybe this is a better way as I would need specify the format once for several rows.</p>\n"}, {"tags": ["docker", "haskell", "build", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "is_accepted": true, "score": 1, "last_activity_date": 1546934104, "creation_date": 1546934104, "answer_id": 54087392, "question_id": 54050016, "link": "https://stackoverflow.com/questions/54050016/how-to-define-a-shake-rule-to-build-docker-images/54087392#54087392", "title": "How to define a shake rule to build docker images?", "body": "<p>So the proposed solution works. One can add a \"phony\" target to ensure the images are built on demand:</p>\n\n<pre><code>\"haskell.img\" ~&gt; void (needImage \"haskell\")\n</code></pre>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 2, "accepted_answer_id": 54087392, "answer_count": 1, "score": 5, "last_activity_date": 1546934104, "creation_date": 1546674373, "last_edit_date": 1546725079, "question_id": 54050016, "link": "https://stackoverflow.com/questions/54050016/how-to-define-a-shake-rule-to-build-docker-images", "title": "How to define a shake rule to build docker images?", "body": "<p>I have a shake build (version 0.16.4) that builds a lot of docker images out of <code>Dockerfile</code>s and other support files. I would like to factor out all those build in a single \"rule\" whose output will be a docker image. I have read <a href=\"https://stackoverflow.com/questions/24897133/how-to-define-a-timer-rule-in-shake\">How to define a timer rule in Shake</a> about custom rules in shake but this does not explain how to define one's own <em>output</em>. </p>\n\n<p>I would like to express something like</p>\n\n<pre><code> Image \"foo\" \"latest\" %&gt; \\ img -&gt; do\n     need [ ... ]\n     buildDockerImage \"docker/foo\" img\n\n Image \"bar\" \"latest\" %&gt; \\ img -&gt; \n     needImage \"foo\" \"latest\"\n     ...\n</code></pre>\n\n<p>and then have shake track the image as a dependency. I have already implemented that kind of stuff in an older version of shake but I am clueless about how to do it in  > 0.16.</p>\n\n<p><strong>Update</strong>: </p>\n\n<p>I have tried this, following the guidelines from <a href=\"https://hackage.haskell.org/package/shake-0.17.3/docs/Development-Shake-Rule.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/shake-0.17.3/docs/Development-Shake-Rule.html</a></p>\n\n<pre><code>newtype Repo = Repo String\n    deriving (Show, Eq, Hashable, Binary, NFData)\n\nnewtype Tag = Tag String\n    deriving (Show, Eq, Hashable, Binary, NFData)\n\nnewtype SHA256 = SHA256 String\n    deriving (Show, Eq, Hashable, Binary, NFData)\n\nnewtype Image = Image (Repo,Tag)\n    deriving (Show, Eq, Hashable, Binary, NFData)\n\ntype instance RuleResult Image = SHA256\n\ndata ImageRule = ImageRule Image (Action ())\n\nimageRule :: (Repo, Tag) -&gt; Action () -&gt; Rules ()\nimageRule k a = addUserRule $ ImageRule (Image k) a\n\nneedImage :: (Repo,Tag) -&gt; Action SHA256\nneedImage = apply1 . Image\n\ntoBytes :: String -&gt; BS.ByteString\ntoBytes = encodeUtf8 . Text.pack\n\nfromBytes :: BS.ByteString -&gt; String\nfromBytes = Text.unpack . decodeUtf8\n\naddBuiltinDockerRule :: Rules ()\naddBuiltinDockerRule = addBuiltinRule noLint imageIdentity run\n    where\n      imageIdentity _ (SHA256 v) = toBytes v\n\n      imageSha (Image (Repo r,Tag t)) = do\n        Stdout out &lt;- cmd \"docker\" [ \"images\", \"--no-trunc\", \"-q\", r &lt;&gt; \":\" &lt;&gt; t ]\n        pure $ BS.unpack out\n\n      run :: BuiltinRun Image SHA256\n      run key old mode = do\n          current &lt;- imageSha key\n          liftIO $ putStrLn (\"current:\"  &lt;&gt; show current)\n          if mode == RunDependenciesSame &amp;&amp; fmap BS.unpack old == Just current then\n              return $ RunResult ChangedNothing (BS.pack current) (SHA256 $ fromBytes $ BS.pack current)\n          else do\n              (_, act) &lt;- getUserRuleOne key (const Nothing) $ \\(ImageRule k act) -&gt; if k == key then Just act else Nothing\n              act\n              current &lt;- imageSha key\n              return $ RunResult ChangedRecomputeDiff (BS.pack current) (SHA256 $ fromBytes $ BS.pack current)\n</code></pre>\n\n<p>And then using it in a <code>Build.hs</code> file:</p>\n\n<pre><code>main :: IO ()\nmain = shakeArgs options $ do\n\n  addBuiltinDockerRule\n\n  want [ \".haskell.img\" ]\n\n  imageRule (Repo \"haskell\", Tag \"latest\") $ do\n    need [ \"docker/haskell/Dockerfile\" ]\n    cmd \"docker\" [ \"build\", \"-t\", \"haskell:latest\", \"-f\", \"docker/haskell/Dockerfile\" ]\n\n  \".haskell.img\" %&gt; \\ fp -&gt; do\n    needImage (Repo \"haskell\", Tag \"latest\")\n    Stdout out &lt;- cmd \"docker\" [ \"images\", \"--no-trunc\", \"-q\", \"haskell:latest\" ]\n    writeFile' fp out\n</code></pre>\n\n<p>This seems to work but one shortcoming is that it's not possible to <code>want</code> an image: I have to add a rule with file to make it work. </p>\n"}, {"tags": ["haskell", "ocaml", "type-inference"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546698883, "post_id": 54049989, "comment_id": 94940181, "body": "It&#39;s worth noting that with <code>newtype PolyEndo = Endo {runEndo :: \u2200 a . a -&gt; a}</code>, you can write <code>case Endo id of Endo f -&gt; (f True, f &#39;a&#39;)</code>. That makes it hardly less strange that it doesn&#39;t work without the wrapper, though..."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1546708179, "creation_date": 1546708179, "answer_id": 54054246, "question_id": 54049989, "link": "https://stackoverflow.com/questions/54049989/why-arent-haskell-variables-polymorphic-when-bound-by-pattern-matching/54054246#54054246", "title": "Why aren&#39;t Haskell variables polymorphic when bound by pattern matching?", "body": "<p>One first issue is that with type classes, generalization is not always free. Consider <code>show :: forall a. Show a =&gt; a -&gt; String</code> and this expression:</p>\n\n<pre><code>case show of\n  f -&gt; ...\n</code></pre>\n\n<p>If you generalize <code>f</code> to <code>f :: forall a. Show a =&gt; a -&gt; String</code>, then GHC will pass a <code>Show</code> dictionary at every call of <code>f</code>, instead of once at the single occurrence of <code>show</code>. In case there are multiple calls all at the same type, this duplicates work compared to not generalizing.</p>\n\n<p>It is also not actually a generalization of the current type inference algorithm when combined with type classes: it can cause existing programs to no longer typecheck. For example,</p>\n\n<pre><code>    case show of\n      f -&gt; f () ++ f mempty\n</code></pre>\n\n<p>By not generalizing <code>f</code>, we can infer that <code>mempty</code> has type <code>()</code>. On the other hand, generalizing <code>f :: forall a. Show a =&gt; a -&gt; String</code> will lose that connection, and the type of <code>mempty</code> in that expression will be ambiguous.</p>\n\n<p>It is true though that these are minor issues, and maybe things would be mostly fine with some monomorphism restrictions, even if not entirely backwards compatible.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1546709414, "last_edit_date": 1546709414, "creation_date": 1546708979, "answer_id": 54054368, "question_id": 54049989, "link": "https://stackoverflow.com/questions/54049989/why-arent-haskell-variables-polymorphic-when-bound-by-pattern-matching/54054368#54054368", "title": "Why aren&#39;t Haskell variables polymorphic when bound by pattern matching?", "body": "<p>If we assign a polymorphic type (<code>forall x. t</code>) to a case scrutinee, then it matches no non-trivial pattern, so there's no point for having <code>case</code>.</p>\n\n<p>Could we generalize in some other useful way? Not really, because of GHC's lack of support for \"impredicative\" instantiation. In your example of <code>Just (a:b:(x,y):_)</code>, not a single bound variable can have polymorphic type, since <code>Maybe</code>, <code>(,)</code>, and <code>[]</code> cannot be instantiated with such types.</p>\n\n<p>One thing works, as mentioned in the comments: data types with polymorphic fields, such as <code>data Endo = Endo (forall a. a -&gt; a)</code>. However, type checking for polymorphic fields doesn't technically involve a generalization step, nor does it behave like let-generalization.</p>\n\n<p>In principle, generalization could be performed at many points, for example even at arbitrary function arguments (e.g. in <code>f (\\x -&gt; x)</code>). However, too much generalization clogs up type inference by introducing untractable higher-rank types; this can be also understood as eliminating useful type dependencies between different parts of the program by removing unsolved metavariables. Although there are systems which can handle higher-rank inference much better than GHC, most notably <a href=\"http://cristal.inria.fr/~remy/mlf/\" rel=\"nofollow noreferrer\">MLF</a>, they're also much more complicated and haven't seen much practical use. I personally prefer to not have silent let-generalization at all. </p>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 0, "last_activity_date": 1546713306, "creation_date": 1546713306, "answer_id": 54055032, "question_id": 54049989, "link": "https://stackoverflow.com/questions/54049989/why-arent-haskell-variables-polymorphic-when-bound-by-pattern-matching/54055032#54055032", "title": "Why aren&#39;t Haskell variables polymorphic when bound by pattern matching?", "body": "<p>In addition to the other answers, there's a reason for how type variables are treated in pattern matches in terms of the interaction with existential types.  Let's take a look at a couple definitions from <a href=\"https://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Coyoneda.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Coyoneda</code></a>:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Coyoneda f a where\n    Coyoneda :: (b -&gt; a) -&gt; f b -&gt; Coyoneda f a\n\nlowerCoyoneda :: Functor f =&gt; Coyoneda f a -&gt; f a\nlowerCoyoneda (Coyoneda g x) = fmap g x\n</code></pre>\n\n<p><code>Coyoneda</code> has an existential type variable used by both arguments to the constructor. If GHC doesn't pin that type down, there's no way for the <code>fmap</code> in <code>lowerCoyoneda</code> to type-check. GHC needs to know that <code>g</code> and <code>x</code> have the appropriate relation in their types, and that requires fixing the type variable in the pattern match.</p>\n"}], "owner": {"reputation": 717, "user_id": 2905219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bde88eb92833e086844c9bf1a254c66?s=128&d=identicon&r=PG&f=1", "display_name": "echinodermata", "link": "https://stackoverflow.com/users/2905219/echinodermata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 54054368, "answer_count": 3, "score": 6, "last_activity_date": 1546713306, "creation_date": 1546673997, "question_id": 54049989, "link": "https://stackoverflow.com/questions/54049989/why-arent-haskell-variables-polymorphic-when-bound-by-pattern-matching", "title": "Why aren&#39;t Haskell variables polymorphic when bound by pattern matching?", "body": "<p>Consider a variable introduced in a pattern, such as <code>f</code> in this Haskell example:</p>\n\n<pre><code>case (\\x -&gt; x) of f -&gt; (f True, f 'c')\n</code></pre>\n\n<p>This code results in a type error (\"Couldn't match expected type \u2018Bool\u2019 with actual type \u2018Char\u2019\"), because of the two different uses of <code>f</code>. It shows that the inferred type of <code>f</code> is not polymorphic in Haskell.</p>\n\n<p>But why shouldn't <code>f</code> be polymorphic?</p>\n\n<p>I have two points of comparison: OCaml and \"textbook\" Hindley-Milner. Both suggest that <code>f</code> ought to be polymorphic.</p>\n\n<ol>\n<li><p>In OCaml, the analogous code is not an error:</p>\n\n<pre><code>match (fun x -&gt; x) with f -&gt; (f true, f 'c')\n</code></pre>\n\n<p>This evaluates to <code>(true, 'c')</code> with type <code>bool * char</code>. So it looks like OCaml gets along fine with assigning <code>f</code> a polymorphic type.</p></li>\n<li><p>We can gain clarity by stripping things down to the fundamentals of Hindley-Milner - lambda calculus with \"let\" - which both Haskell and OCaml are based on. When reduce to this core system, of course, there is no such thing as pattern matching. We can draw parallels though. Between \"let\" and \"lambda\", <code>case expr1 of f -&gt; expr2</code> is much closer to <code>let f = expr1 in expr2</code> than to <code>(lambda f. expr2) expr1</code>. \"Case\", like \"let\", syntactically restricts <code>f</code> to be bound to <code>expr1</code>, while a function <code>lambda f. expr2</code> doesn't know what <code>f</code> will be bound to since the function has no such restriction on where in the program it will be called. This was the reason why let-bound variables are generalized in Hindley-Milner and lambda-bound variables are not. It appears that the same reasoning that allows let-bound variables to be generalized shows that variables introduced by pattern matching could be generalized too.</p></li>\n</ol>\n\n<p>The examples above are minimal for clarity, so they only show a trivial pattern <code>f</code> in the pattern matching, but all the same logic extends to arbitrarily complex patterns like <code>Just (a:b:(x,y):_)</code>, which can introduce multiple variables that would all be generalized.</p>\n\n<p>Is my analysis correct? In Haskell specifically - recognizing that it's not just plain Hindley-Milner and not OCaml - why don't we generalize the type of <code>f</code> in the first example?</p>\n\n<p>Was this an explicit language design decision, and if so, what were the reasons? (I note that <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tldi10-vytiniotis.pdf\" rel=\"noreferrer\">some in the community think that not even \"let\" should be generalized</a>, but I would imagine the design decision pre-dates that paper.)</p>\n\n<p>If variables introduced in a pattern were made polymorphic similar to \"let\", would that break compatibility with other aspects of Haskell in a significant way?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1546647167, "post_id": 54047733, "comment_id": 94930937, "body": "What is your question?"}, {"owner": {"reputation": 101, "user_id": 7122838, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/718532b37813094a6b80fb6eb44f4f2e?s=128&d=identicon&r=PG&f=1", "display_name": "Emy eminescu", "link": "https://stackoverflow.com/users/7122838/emy-eminescu"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1546647251, "post_id": 54047733, "comment_id": 94930959, "body": "@MichaelLitchard  what is the proper implementation of the &#39;envs&#39; function?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1546648586, "post_id": 54047733, "comment_id": 94931196, "body": "<code>envs = mapM (flip fmap (,) (flip fmap [False, True]))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1546651560, "post_id": 54047957, "comment_id": 94931690, "body": "If you&#39;re going to give away the solution to this exercise, you should give the good one hinted at in the comments on the question itself: <code>envs = mapM (\\name -&gt; [(name, False), (name, True)])</code>."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1546649155, "creation_date": 1546649155, "answer_id": 54047957, "question_id": 54047733, "link": "https://stackoverflow.com/questions/54047733/haskell-function-name-name-bool/54047957#54047957", "title": "Haskell function :: [Name] -&gt; [[(Name, Bool)]]", "body": "<p>What you want to do is get all combinations of <code>True</code> and <code>False</code> for the number of names, which can be done easily with <code>replicateM</code> specialised to lists:</p>\n\n<pre><code>replicateM (length names) [False, True]\n</code></pre>\n\n<p>E.g. if <code>length names == 2</code>, then this produces:</p>\n\n<pre><code>[ [False, False]\n, [False, True]\n, [True, False]\n, [True, True]\n]\n</code></pre>\n\n<p>What remains is just to zip each of these with the names themselves:</p>\n\n<pre><code>envs names =\n  [ zip names values\n  | let n = length names\n  , values &lt;- replicateM n [False, True]\n  ]\n</code></pre>\n\n<p>For <code>envs [\"P\", \"Q\"]</code> this produces:</p>\n\n<pre><code>[ [(\"P\", False), (\"Q\", False)]\n, [(\"P\", False), (\"Q\", True)]\n, [(\"P\", True), (\"Q\", False)]\n, [(\"P\", True), (\"Q\", True)]\n]\n</code></pre>\n\n<p>And it works for any number of inputs, even 0, for which your original implementation would fail since you don\u2019t match <code>[]</code>. It always returns 2<sup>n</sup> assignments:</p>\n\n<pre><code>-- 2^0 == 1\nenvs [] == [[]]\n\n-- 2^3 == 8\nenvs [\"P\", \"Q\", \"R\"] ==\n  [ [(\"P\", False), (\"Q\", False), (\"R\", False)]\n  , [(\"P\", False), (\"Q\", False), (\"R\", True)]\n  , [(\"P\", False), (\"Q\", True), (\"R\", False)]\n  , [(\"P\", False), (\"Q\", True), (\"R\", True)]\n  , [(\"P\", True), (\"Q\", False), (\"R\", False)]\n  , [(\"P\", True), (\"Q\", False), (\"R\", True)]\n  , [(\"P\", True), (\"Q\", True), (\"R\", False)]\n  , [(\"P\", True), (\"Q\", True), (\"R\", True)]\n  ]\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 7122838, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/718532b37813094a6b80fb6eb44f4f2e?s=128&d=identicon&r=PG&f=1", "display_name": "Emy eminescu", "link": "https://stackoverflow.com/users/7122838/emy-eminescu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 54047957, "answer_count": 1, "score": 1, "last_activity_date": 1546649155, "creation_date": 1546646862, "last_edit_date": 1546647226, "question_id": 54047733, "link": "https://stackoverflow.com/questions/54047733/haskell-function-name-name-bool", "title": "Haskell function :: [Name] -&gt; [[(Name, Bool)]]", "body": "<p>Given the following:</p>\n\n<pre><code>type Name = String\nenvs :: [Name] -&gt; [[(Name , Bool)]]\n</code></pre>\n\n<p>I have to implement 'envs' so that given a list of Names, it returns all possible combinations of Names and booleans</p>\n\n<p>My attempt didn't return all possible combinations, this was my code:</p>\n\n<pre><code>envs xxs@(x:xs) = [[ (name, value) | name &lt;- xxs  , value &lt;- [False, True] ]]\n</code></pre>\n\n<p>the expected results for </p>\n\n<pre><code>envs [\"P\", \"Q\"]\n</code></pre>\n\n<p>are:</p>\n\n<pre><code>[ [ (\"P\",False)\n  , (\"Q\",False)\n  ]\n, [ (\"P\",False)\n  , (\"Q\",True)\n  ]\n, [ (\"P\",True)\n  , (\"Q\",False)\n  ]\n, [ (\"P\",True)\n  , (\"Q\",True)\n  ]\n]\n</code></pre>\n\n<p>But, mine were:</p>\n\n<pre><code>[[(\"P\",True),(\"Q\",True)],[(\"P\",False),(\"Q\",False)]]\n</code></pre>\n\n<p>So what is the proper implementation of the 'envs' function, the one that returns the expected result?</p>\n"}, {"tags": ["forms", "haskell", "logic", "logical-operators"], "answers": [{"tags": [], "owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "is_accepted": false, "score": 3, "last_activity_date": 1546640141, "creation_date": 1546640141, "answer_id": 54046886, "question_id": 54046804, "link": "https://stackoverflow.com/questions/54046804/haskell-propositional-logic/54046886#54046886", "title": "Haskell - propositional logic", "body": "<p>You want to call <code>show</code> recursively in your definition. So the example with <code>Not</code> would be</p>\n\n<pre><code>show (Not p) = \"(~\" ++ show p ++ \")\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1546640173, "creation_date": 1546640173, "answer_id": 54046894, "question_id": 54046804, "link": "https://stackoverflow.com/questions/54046804/haskell-propositional-logic/54046894#54046894", "title": "Haskell - propositional logic", "body": "<p>You should match only one \"layer\" of your formula, i.e. only one constructor, and exploit recursion for subformulae. For instance,</p>\n\n<pre><code>show (Not f) = \"(~\" ++ show f ++ \")\"\n</code></pre>\n\n<p>will apply to any formula starting with a negation, even if there is a non variable subformula under that negation.</p>\n\n<p>Getting parentheses right might be tricky. You'll need to either be generous with parentheses or define <code>showsPrec</code>. If you are a beginner, I'd recommend the former, which does not need to cope with precedence levels.</p>\n"}], "owner": {"reputation": 1259, "user_id": 7862080, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0GJT4.png?s=128&g=1", "display_name": "George Cernat", "link": "https://stackoverflow.com/users/7862080/george-cernat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 1, "closed_date": 1546651785, "accepted_answer_id": 54046894, "answer_count": 2, "score": 1, "last_activity_date": 1546640173, "creation_date": 1546639698, "question_id": 54046804, "link": "https://stackoverflow.com/questions/54046804/haskell-propositional-logic", "closed_reason": "Duplicate", "title": "Haskell - propositional logic", "body": "<p>I have the following:</p>\n\n<pre><code>type Name = String\ndata Prop\n= Var Name\n| F\n| T\n| Not Prop\n| Prop :|: Prop\n| Prop :&amp;: Prop\nderiving (Eq, Read)\ninfixr 2 :|:\n</code></pre>\n\n<p>the type Prop represents a propositional formula. The propositional variables, such as p and q can be represented by Var \"p\" and Var \"q\".</p>\n\n<p>F and T are the constant booleans for False and True.</p>\n\n<p>Not represents the negation (~ or \u00ac)</p>\n\n<p>:|: and :&amp;: represent the disjunction (/) and conjuction (/\\)</p>\n\n<p>We can write logical propositions:</p>\n\n<pre><code>( Var \"p\" :|: Var \"q\") :&amp;: ( Not (Var \"p\") :&amp;: Var \"q\")\n</code></pre>\n\n<p>What I have to do is: replace Not, :|: and :&amp;: with ~, / and /\\ by making Prop an instance of the class Show, so that the following will be true:</p>\n\n<pre><code>test_ShowProp :: Bool\ntest_ShowProp =\nshow (Not (Var \"P\") :&amp;: Var \"Q\") == \"((~P)/\\Q)\"\n</code></pre>\n\n<p>This is my implementation so far:</p>\n\n<pre><code>instance Show Prop where\n    show (Var p) = p \n    show (Not (Var p)) = \"(~\" ++ p ++ \")\" \n    show (Var p :|: Var q) = p ++ \"\\\\/\" ++ q\n    show (Var p :&amp;: Var q) = p ++ \"/\\\\\" ++ q\n</code></pre>\n\n<p>But this doesn't cover all the cases, just the basic ones. How should I continue the implementation so that it tackles any propositional formula, not just the hardcoded ones? Because at the moment</p>\n\n<pre><code>(Var \"p\" :&amp;: Var \"q\")\n</code></pre>\n\n<blockquote>\n  <p>outputs: p/\\q</p>\n</blockquote>\n\n<p>but</p>\n\n<pre><code>Not (Var \"p\" :&amp;: Var \"q\")\n</code></pre>\n\n<blockquote>\n  <p>outputs: Non-exhaustive patterns in function show</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1546637695, "post_id": 54046079, "comment_id": 94928296, "body": "Posting the full error message is very important on issues like this. Otherwise, people have to guess, or to spend more effort in copying your code into a file, and see the error. This generally results in fewer, less precise answers."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546638072, "post_id": 54046079, "comment_id": 94928444, "body": "Right although in fairness, in this case the error message really wouldn&#39;t have helped finding the error more quickly. But in the future, do always add error messages even if they are clunky."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546644093, "post_id": 54046079, "comment_id": 94930295, "body": "if you use explicit delimiters <code>do { ... ; ... }</code>, you will never have to worry about code being broken by accidental indentation."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "edited": false, "score": 0, "creation_date": 1546637967, "post_id": 54046297, "comment_id": 94928408, "body": "Thank you so extremely much! This answered everything I needed to know and more, I can&#39;t believe my tutorial left out that little fact about putStrLn and how it works. The indentation was just sloppy rushed work on my part and I can&#39;t believe I missed it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1546637188, "creation_date": 1546637188, "answer_id": 54046297, "question_id": 54046079, "link": "https://stackoverflow.com/questions/54046079/beginner-haskell-code-getting-type-errors-with-do-constructs-in-main/54046297#54046297", "title": "Beginner haskell code getting type errors with do constructs in main", "body": "<p>There are two mistakes in your code:</p>\n\n<ol>\n<li><p>Indentation. Always make sure that all the lines the belong together in a <code>do</code> block are indented to the same level</p>\n\n<pre><code>main = do\n \u22eeputStrLn \"This program...\"\n \u22eeuser &lt;- getLine\n \u22eeif (read user) &lt; 1\n \u22ee   then\n \u22ee      do\u22eeputStrLn \"Improper...\"\n \u22ee        \u22ee\u2588putStrLn ...\n \u22ee  else\n \u22ee    do putStrLn ...\n</code></pre>\n\n<p>Notice there's one space to many before the third <code>putStrLn</code>.<br>Indentation is also important for many other Haskell constructs (<code>where</code>, <code>case</code>, <code>class</code>...). As a matter of style, I would also make it a habit to align <code>else</code>/<code>then</code>, though that's actually not required by the standard. I.e.</p>\n\n<pre><code>main = do\n \u22eeputStrLn \"This program...\"\n \u22eeuser &lt;- getLine\n \u22eeif (read user) &lt; 1\n \u22ee\u22eethen do\n \u22ee\u22ee \u22eeputStrLn \"Improper...\"\n \u22ee\u22ee \u22eeputStrLn ...\n \u22ee\u22eeelse do\n \u22ee\u22ee \u22eeputStrLn ...\n</code></pre></li>\n<li><p>Although <code>putStrLn</code> may look like a \u201ccommand at the begin of the line\u201d that's always parsed as such, this is not the case \u2013 it's just an ordinary function. Therefore, <code>putStrLn show oddsort 10 [] ++ \"Bla\"</code> is parsed as</p>\n\n<pre><code>  (putStrLn show oddsort 10 []) ++ \"Bla\"\n</code></pre>\n\n<p>i.e. <code>putStrLn</code> is applied to the arguments <code>show</code>, <code>oddsort</code>, <code>10</code> and <code>[]</code>. Obviously it has no idea what to do with all of that, i.e. this is a massive type error! What you actually want is</p>\n\n<pre><code>  putStrLn (show (oddsort 10 []) ++ \"Bla\")\n</code></pre>\n\n<p>which can also be written with the \u201cparenthisation operator\u201d <code>$</code>:</p>\n\n<pre><code>  putStrLn $ show (oddsort 10 []) ++ \"Bla\"\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1546637344, "creation_date": 1546637344, "answer_id": 54046325, "question_id": 54046079, "link": "https://stackoverflow.com/questions/54046079/beginner-haskell-code-getting-type-errors-with-do-constructs-in-main/54046325#54046325", "title": "Beginner haskell code getting type errors with do constructs in main", "body": "<p>I'll focus on these lines</p>\n\n<pre><code>do putStrLn \"Improper input specified. 10 will be chosen as     default.\"\n    putStrLn show oddsort 10 [] ++ \"Is the list of odd numbers from 1 to 10.\"\n</code></pre>\n\n<p>Issues:</p>\n\n<ol>\n<li><p>wrong indentation: block entries should start exactly on the same column</p></li>\n<li><p>the second line parses as <code>(putStrLn show oddsort 10 []) ++ (\"Is the list of odd numbers from 1 to 10.\")</code> which is wrong, since you can't <code>++</code> a non-list like <code>putStrLn show oddsort 10 []</code>. You need parentheses.</p></li>\n<li><p><code>putStrLn show oddsort 10 []</code> calls function <code>putStrLn</code> with  4 arguments: <code>show</code>, <code>oddsort</code>, <code>10</code>, and <code>[]</code>. This is not what you want, so you need more parentheses.</p></li>\n</ol>\n\n<p>There are probably more issues, but these are the most evident ones.</p>\n\n<p>General recommendations: add type signatures to all your top-level bindings, like <code>oddsort</code>. This will help GHC to produce better type error messages.\nFurther, turning on warnings with <code>-Wall</code> can also help detecting some issues.</p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 1, "last_activity_date": 1546647024, "creation_date": 1546647024, "answer_id": 54047756, "question_id": 54046079, "link": "https://stackoverflow.com/questions/54046079/beginner-haskell-code-getting-type-errors-with-do-constructs-in-main/54047756#54047756", "title": "Beginner haskell code getting type errors with do constructs in main", "body": "<p>Here is a working version of your code:</p>\n\n<pre><code>oddsort :: Int -&gt; [Int] -&gt; [Int]\noddsort x xs\n  |x == 1 = x : xs\n  |x `mod` 2 == 0 = oddsort (x - 1) (x:xs)\n  |otherwise = oddsort (x - 2) (x:xs)\n\nmain = do\n    putStrLn \"This program can find all odd numbers between 1 and a desired number. Please enter a number.\"\n    user &lt;- getLine\n    if (read user :: Int) &lt; 1\n    then putStrLn $ \"Improper input specified. 10 will be chosen as     default. \\n\" ++ ((show $ oddsort 10 []) ++ \" Is the list of odd numbers from 1 to 10.\")\n    else putStrLn $ show $ (oddsort (read user :: Int) [])\n</code></pre>\n\n<p>I made a few changes to your code and listed them in order.</p>\n\n<p>The first thing I did was add a type signature to <code>oddsort</code> because otherwise the type signature is left to the compiler to inference (guess) the type and you don't really want to do that with functions, why? well check <a href=\"https://stackoverflow.com/questions/23401698/what-is-a-good-reason-to-use-a-type-signature-for-functions-when-the-compiler-ca\">this</a>.</p>\n\n<p>Then I changed <code>if (read user) &lt; 1</code> to <code>if (read user :: Int) &lt; 1</code>, because again you're leaving it up to the compiler to guess the return of <code>read</code> and read returns a specific type once you've defined the signature for the return type <code>:: Int</code> which specifies that the return type of <code>read</code> is an <code>Int</code>.</p>\n\n<p>The last change was in <code>then</code> clause, I simply removed your second <code>putStrLn</code> statement and concatenated the result of <code>(show $ oddsort 10 [])</code> to <code>\"Is the list of odd numbers from 1 to 10.\")</code> because by having <code>putStrLn show oddsort 10 []</code> GHC will take everything after show as an argument and putStrLn can only take strings and only 1 argument at that. You can see this on the repl by typing <code>:t show</code>. Also I concatenated them to 1 string because you really only need 1 but 2 looks neater so keep it that way but add parenthesis to your second putStrLn so there is only 1 argument. You can also use <code>$</code> operator for this.</p>\n"}], "owner": {"reputation": 67, "user_id": 10697707, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hTPwdU02uBs/AAAAAAAAAAI/AAAAAAAAAJg/tkKYNoEUDwM/photo.jpg?sz=128", "display_name": "Sagarmatha", "link": "https://stackoverflow.com/users/10697707/sagarmatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1546647024, "creation_date": 1546636149, "question_id": 54046079, "link": "https://stackoverflow.com/questions/54046079/beginner-haskell-code-getting-type-errors-with-do-constructs-in-main", "title": "Beginner haskell code getting type errors with do constructs in main", "body": "<p>I'm just learning some light haskell code, but the tutorials I have been following don't mention this error I continue to get when trying to run any code with do and I/O type. GHCI seems to think its some type error. Here is my code: </p>\n\n<pre><code>main = do\n  putStrLn \"This program can find all odd numbers between 1 and a desired number. Please enter a number.\"\n  user &lt;- getLine\n  if (read user) &lt; 1\n      then\n        do putStrLn \"Improper input specified. 10 will be chosen as     default.\"\n            putStrLn show oddsort 10 [] ++ \"Is the list of odd numbers from 1 to 10.\"\n    else\n      do putStrLn show (oddsort (read user) [])\n\noddsort x xs\n  |x == 1 = 1:xs\n  |x `mod` 2 == 0 = oddsort (x-1) xs\n  |otherwise = oddsort (x - 2) (x:xs)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "expression"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1546635243, "post_id": 54045769, "comment_id": 94927316, "body": "One typically uses a lexer (or even parser) like <code>alex</code>, <code>happy</code>, <code>parsec</code>, etc."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1546635668, "post_id": 54045769, "comment_id": 94927479, "body": "Definitely look into parser-generators for this kind of task."}, {"owner": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "edited": false, "score": 0, "creation_date": 1546636256, "post_id": 54045769, "comment_id": 94927744, "body": "For a simple task like this, you can fold the list with a tuple <code>(cur_token, [parsed_tokens]</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1546637952, "post_id": 54045769, "comment_id": 94928403, "body": "Since your language looks like a subset of Haskell, you could reuse the lexer that ships in <code>base</code>. Here&#39;s a one liner you can paste into GHCi: <code>splitTok s = head  [ tks | (tks, &quot;&quot;) &lt;- Text.ParserCombinators.ReadP.readP_to_S ( Text.ParserCombinators.ReadP.many Text.Read.Lex.hsLex) s ]</code>. Or, assuming the right imports: <code>splitTok s = head  [ tks | (tks, &quot;&quot;) &lt;- readP_to_S (many hsLex) s ]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1546668827, "post_id": 54046955, "comment_id": 94933940, "body": "Not to encourage the hackiness, but what if you just got rid of the <code>strip</code> beforehand?  <code>addSpacing</code> and then let <code>words</code> deal with the cruft."}], "tags": [], "owner": {"reputation": 208, "user_id": 9252109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beeb1e77101c576b7428ac0692f5c679?s=128&d=identicon&r=PG&f=1", "display_name": "atmostmediocre", "link": "https://stackoverflow.com/users/9252109/atmostmediocre"}, "is_accepted": false, "score": 1, "last_activity_date": 1546640537, "creation_date": 1546640537, "answer_id": 54046955, "question_id": 54045769, "link": "https://stackoverflow.com/questions/54045769/how-to-split-a-mathematical-expression-into-tokens-string-string/54046955#54046955", "title": "How to split a mathematical expression into tokens? (String -&gt; [String])", "body": "<p>Okay, I came up with an ugly hack that does the job. (Unfortunately introduces a bug)</p>\n\n<pre><code>import Data.Char (isSpace, isDigit)\n\nstrip :: String -&gt; String\nstrip = filter (not . isSpace)\n\naddSpacing :: String -&gt; String\naddSpacing [a] = [a]\naddSpacing (x:y:cs)\n    | isDigit x &amp;&amp; isDigit y = x : addSpacing rest\n    | otherwise = x : ' ' : addSpacing rest\n  where rest = y : cs\n\nsplitTok :: String -&gt; [String]\nsplitTok = words . addSpacing . strip\n</code></pre>\n\n<p>It fails in producing a correct string of tokens in this example:</p>\n\n<pre><code>ghci&gt; splitTok \"125 +   12 62 - 12  *( 51/  3)        \"\n[\"125\",\"+\",\"1262\",\"-\",\"12\",\"*\",\"(\",\"51\",\"/\",\"3\",\")\"]\n</code></pre>\n\n<p>For most expressions it works fine though:</p>\n\n<pre><code>ghci&gt; splitTok \"4123-36522+12\"\n[\"4123\",\"-\",\"36522\",\"+\",\"12\"]\nghci&gt; splitTok \"124 *(12 -(4+5*(331/7)))\"\n[\"124\",\"*\",\"(\",\"12\",\"-\",\"(\",\"4\",\"+\",\"5\",\"*\",\"(\",\"331\",\"/\",\"7\",\")\",\")\",\")\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 2, "last_activity_date": 1546669247, "creation_date": 1546669247, "answer_id": 54049523, "question_id": 54045769, "link": "https://stackoverflow.com/questions/54045769/how-to-split-a-mathematical-expression-into-tokens-string-string/54049523#54049523", "title": "How to split a mathematical expression into tokens? (String -&gt; [String])", "body": "<p>It seems just to group the digits together and removes the space. Try</p>\n\n<pre><code>import Data.Char (isSpace, isDigit)\nimport Data.List (groupBy)\n\nsplitTok = groupBy (\\x y-&gt;isDigit x &amp;&amp; isDigit y) . filter (not . isSpace)\n</code></pre>\n"}], "owner": {"reputation": 208, "user_id": 9252109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beeb1e77101c576b7428ac0692f5c679?s=128&d=identicon&r=PG&f=1", "display_name": "atmostmediocre", "link": "https://stackoverflow.com/users/9252109/atmostmediocre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 54049523, "answer_count": 2, "score": 0, "last_activity_date": 1546669247, "creation_date": 1546634635, "last_edit_date": 1546635041, "question_id": 54045769, "link": "https://stackoverflow.com/questions/54045769/how-to-split-a-mathematical-expression-into-tokens-string-string", "title": "How to split a mathematical expression into tokens? (String -&gt; [String])", "body": "<p>I know my question sounds generic and I didn't really know how to google for such a thing,  so I'll provide examples of what I mean:</p>\n\n<pre><code>ghci&gt; splitTok \"12 + 564 * (5 - 38) / 223\"\n[\"12\", \"+\", \"564\", \"*\", \"(\", \"5\", \"-\", \"38\", \")\", \"/\", \"223\"]\nghci&gt; splitTok \" 5+2-42  *    (46/5 )\"\n[\"5\", \"+\", \"2\", \"-\", \"42\", \"*\", \"(\", \"46\", \"/\", \"5\", \")\"]\n</code></pre>\n\n<p>How could something like that be implemented? Or maybe there is a function in Prelude that does this type of thing?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1546633017, "post_id": 54045372, "comment_id": 94926485, "body": "The same goes for <code>&quot;&#47;\\&quot;</code>, which should be <code>&quot;&#47;\\\\&quot;</code> instead."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 2, "last_activity_date": 1546632459, "creation_date": 1546632459, "answer_id": 54045372, "question_id": 54044742, "link": "https://stackoverflow.com/questions/54044742/how-to-fix-lexical-error-in-string-character-literal-at-character-in-ghc/54045372#54045372", "title": "How to fix : lexical error in string/character literal at character &#39; &quot; &#39; in ghci", "body": "<p>Write <code>\"\\\\/\"</code> instead of <code>\"\\/\"</code>. Symbols starting with <code>\\</code> are called escape sequences, and there is no <code>\\/</code> sequence. The <code>\\\\</code> sequence just outputs <code>\\</code>, which is exactly what you need.</p>\n\n<p>Note that this isn't specific to Haskell language.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1546633786, "last_edit_date": 1546633786, "creation_date": 1546633069, "answer_id": 54045473, "question_id": 54044742, "link": "https://stackoverflow.com/questions/54044742/how-to-fix-lexical-error-in-string-character-literal-at-character-in-ghc/54045473#54045473", "title": "How to fix : lexical error in string/character literal at character &#39; &quot; &#39; in ghci", "body": "<p>The expression <code>\"/\\ \"</code> is parsed thus:</p>\n\n<ul>\n<li><code>\"</code>: a string literal starts here.</li>\n<li><code>/</code>: a forward-slash character</li>\n<li><code>\\</code>: the start of an <a href=\"https://www.haskell.org/onlinereport/lexemes.html#sect2.6\" rel=\"nofollow noreferrer\">escape sequence</a>. Backslashes in string literals are <em>not</em> interpreted as an actual backslash character that should appear in the string you're trying to define, but as a control character introducing such an escape sequence. But then...</li>\n<li><p><code></code>: a space. Spaces can't be part of escape sequences, but there is one way in which this can be done nevertheless: if you're trying to escape a line break in a long string literal. for instance (line breaks highlighted)</p>\n\n<pre><code>foo :: String\u21b2\nfoo = \" bla bla \\      \u21b2\n      \\ bum blum blam \\\u21b2\n      \\ gum gao wo\"\u21b2\n</code></pre>\n\n<p>is a legal string literal. The backslashes extend it into the next line, namely until the the leading backslash there, and it doesn't matter that there are spaces between the trailing backslash and the line end. What you have in your code is not ok though:</p></li>\n<li><code>\"</code> is illegal at this point, because you've started an escape sequence that can only be a newline, but this is not a newline.</li>\n</ul>\n\n<p>What you want instead is a literal backslash. You can achieve that in a string literal with the escape sequence <code>\\\\</code></p>\n\n<pre><code>  show (And s d) = show s ++ \"/\\\\ \" ++ show d\n  show (Or s d) = show s ++ \"\\\\/\" ++ show d\n</code></pre>\n\n<p>If you have lots of backslashes in string literals, you may consider using <a href=\"http://hackage.haskell.org/package/raw-strings-qq\" rel=\"nofollow noreferrer\">raw string literals</a> which don't have any escaping.</p>\n\n<p>A nicer alternative is to just use proper Unicode symbols:</p>\n\n<pre><code>  show (And s d) = show s ++ \"\u2227\" ++ show d\n  show (Or s d) = show s ++ \"\u2228\" ++ show d\n</code></pre>\n\n<p>these don't need to be escaped in any way.</p>\n\n<hr>\n\n<p>BTW this <code>Show</code> instance won't really work properly, namely it won't have proper grouping / precedence. For instance, <code>And (Or a b) (Or c d)</code> will be rendered as <code>a\u2228b\u2227c\u2228d</code>, which is logically different. To get proper parenthisation, you need to define <code>showsPrec</code> rather than the simple <code>show</code>:</p>\n\n<pre><code>instance (Show Prop) where\n  showsPrec p (Var s) = showsPrec p s\n  showsPrec p (Not e) = showParen (p&gt;=7)\n       $ (\"\u00ac\"++) . showsPrec 7 e\n  showsPrec p (And s d) = showParen (p&gt;=3)\n       $ showsPrec 3 s ++ \"\u2227\" ++ showsPrec 3 d\n  showsPrec p (Or s d) = showParen (p&gt;=2)\n       $ showsPrec 2 s ++ \"\u2228\" ++ showsPrec 2 d\n</code></pre>\n\n<p>Also note that it's considered good etiquette that <code>Show</code> instances should spit out valid Haskell code. For the <code>\u2227</code> and <code>\u2228</code> operators that's easy enough to achieve:</p>\n\n<pre><code>infixr 3 \u2227\n(\u2227) = And\ninfixr 2 \u2228\n(\u2228) = Or\n</code></pre>\n\n<p>but Haskell doesn't have support for prefix operators like <code>\u00ac</code>. You <em>could</em> actually get prefix <code>-</code> by implementing a <code>Num</code> instance, but <em>please don't</em>, this would be very confusing. So, you should better change the <code>Not</code> clause to just yield <code>\"Not\"</code>:</p>\n\n<pre><code>  showsPrec p (Not e) = showParen (p&gt;=10)\n       $ (\"Not \"++) . showsPrec 10 e\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9283402, "user_type": "registered", "profile_image": "https://graph.facebook.com/1604412832976814/picture?type=large", "display_name": "Manuel Marques", "link": "https://stackoverflow.com/users/9283402/manuel-marques"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 54045473, "answer_count": 2, "score": 0, "last_activity_date": 1546633786, "creation_date": 1546629162, "question_id": 54044742, "link": "https://stackoverflow.com/questions/54044742/how-to-fix-lexical-error-in-string-character-literal-at-character-in-ghc", "title": "How to fix : lexical error in string/character literal at character &#39; &quot; &#39; in ghci", "body": "<p>This type given by the exercise is used for logical propositions.What I'm trying to do is define an instance for Show to this particular type.</p>\n\n<p>This here is my code:</p>\n\n<pre><code>data Prop = Var String | Not Prop | And Prop Prop | Or Prop Prop\n\np1::Prop\np1 = Not (Or (And (Not( Var \"A\")) (Var \"B\")) (Var \"C\"))\n\ninstance (Show Prop) where\n    Var s = show s\n    Not s = \"-\" ++ show s\n    And s d = show s ++ \"/\\ \" ++ show d\n    Or s d = show s ++ \"\\/\" ++ show d\n</code></pre>\n\n<p>For example, the p1 defined above , after show defined is supposed to  appear as :\n\"-((-A /\\ B) / C)\"</p>\n\n<p>I'm getting this error:</p>\n\n<pre><code>T1516.hs:48:33: error:\nlexical error in string/character literal at character '\"'\n</code></pre>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1546629238, "post_id": 54044328, "comment_id": 94925159, "body": "Is this the long form version of the question &quot;How do I get the final <code>Foo</code> from a <code>State Foo ()</code>?&quot; Or is it how to turn a tuple <code>(a,b,x)</code> into a tuple <code>(a,b,c)</code> given a function <code>f :: x -&gt; c</code>?"}, {"owner": {"reputation": 3, "user_id": 10868589, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tQKup3QGB1s/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYycC_-k7qjIG3407_3NE0EwlL8cQ/mo/photo.jpg?sz=128", "display_name": "Noonanrick", "link": "https://stackoverflow.com/users/10868589/noonanrick"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1546630264, "post_id": 54044328, "comment_id": 94925540, "body": "Yes more the latter, I want to return the final result of Contractst in a tuple with the contract currently being evaluated and the output message."}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1546686712, "post_id": 54045155, "comment_id": 94937231, "body": "3-tuples should be given a <code>Functor</code> instance <a href=\"https://stackoverflow.com/questions/36460833/why-does-length-return-1-for-a-tuple-with-2-elements-and-gives-an-error-for-a-t\" title=\"why does length return 1 for a tuple with 2 elements and gives an error for a t\">stackoverflow.com/questions/36460833/&hellip;</a> and a <code>Foldable</code> one while we are at it."}, {"owner": {"reputation": 3, "user_id": 10868589, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tQKup3QGB1s/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYycC_-k7qjIG3407_3NE0EwlL8cQ/mo/photo.jpg?sz=128", "display_name": "Noonanrick", "link": "https://stackoverflow.com/users/10868589/noonanrick"}, "edited": false, "score": 0, "creation_date": 1546796954, "post_id": 54045155, "comment_id": 94961705, "body": "Thanks that helped a lot, just one quick question. When I use execState the state is returned as expected but when I try evalState it returns (). Why is this? Should it not return the final state?"}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1546797838, "post_id": 54045155, "comment_id": 94961965, "body": "<code>evalState</code> returns the last result. <code>execState</code> returns the last state. <code>runState</code> returns a tuple of both."}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 0, "last_activity_date": 1546631306, "creation_date": 1546631306, "answer_id": 54045155, "question_id": 54044328, "link": "https://stackoverflow.com/questions/54044328/updating-and-returning-multiple-values-using-the-state-monad/54045155#54045155", "title": "Updating and returning multiple values using the state monad", "body": "<p>I didn't read through your motivation, but if your problem is how to transform the last element of a 3-tuple, you can easily write a function for that:</p>\n\n<pre><code>mapLast3 f (a,b,x) = (a, b, f x)\n</code></pre>\n\n<p>Here it is in a complete example, where a 3-tuple <code>(Int, Double, State String ())</code> gets transformed into a <code>(Int, Double, String)</code> by running the computation with a hard coded initial state:</p>\n\n<pre><code>import Control.Monad.State\n\nmapLast3 :: (x -&gt; c) -&gt; (a,b,x) -&gt; (a,b,c)\nmapLast3 f (a,b,x) = (a, b, f x)\n\nmyExecutor :: State String () -&gt; String\nmyExecutor f = execState f \"Hello\"\n\nexecLast3 :: (a, b, State String ()) -&gt; (a, b, String)\nexecLast3 = mapLast3 myExecutor\n\nmyStateFunction :: State String ()\nmyStateFunction = modify (++ \" World\")\n\nmyOriginalTuple :: (Int, Double, State String ())\nmyOriginalTuple = (42, 3.14, myStateFunction)\n\nmyFinalTuple :: (Int, Double, String)\nmyFinalTuple = execLast3 myOriginalTuple\n\nmain = print myFinalTuple\n</code></pre>\n\n<p>It will print <code>(42,3.14,\"Hello World\")</code></p>\n"}], "owner": {"reputation": 3, "user_id": 10868589, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tQKup3QGB1s/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYycC_-k7qjIG3407_3NE0EwlL8cQ/mo/photo.jpg?sz=128", "display_name": "Noonanrick", "link": "https://stackoverflow.com/users/10868589/noonanrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 54045155, "answer_count": 1, "score": 0, "last_activity_date": 1547518176, "creation_date": 1546626792, "last_edit_date": 1547518176, "question_id": 54044328, "link": "https://stackoverflow.com/questions/54044328/updating-and-returning-multiple-values-using-the-state-monad", "title": "Updating and returning multiple values using the state monad", "body": "<p>I am working on a contract evaluator for a contract DSL I am writing. The contract DSL is based on Simon Peyton Jones financial combinators paper. I am relatively new to Haskell and monads and I am having problems with the state monad. As you can see below evalAll2 is recursively called until End is reached. I have three variables in the record ContractSt that are updated when evalC is called, people is the number of parties to the contract(identified by a unique int), balance is amount of money in the contract and the owner is the a person who owns the contract. A contract is evaluated like this: </p>\n\n<pre><code>bettingContract :: Contract\nbettingContract \n          = until (Date (2018,12,13)) \n                (cashIn 20 1 \n                    (cashIn 20 2 \n                        (time (Date (2018,12,15))\n                            (pay 1 2 40 End)\n                        End)\n                    End)                            \n                End)\n            End\n\nc1 = evalAll(bettingContract)\n</code></pre>\n\n<p>What I want the code to do is to output the Contract being evaluated, the \"output\" which is a message generated based the action of a particular and to show the values of the ContractSt after the contract has been evaluated. The main problem is that I get: </p>\n\n<pre><code>&lt;interactive&gt;:12:1: error:\n    * No instance for (Show\n                         (Control.Monad.Trans.State.Lazy.StateT\n                            ContractSt\n                            Data.Functor.Identity.Identity\n                            ()))\n        arising from a use of `print'\n</code></pre>\n\n<p>when I try and evaluate a contract. I understand that I have to use evalState to return the final result (which is what I want), and that I'm not trying to create an instance for of show for () but returning the final state along with the contract, and the output is where I'm having the most difficulty. </p>\n\n<pre><code>data ContractSt = ContractSt { \npeople :: [Person], balance :: Money, owner :: Person } deriving (Show)\n\nevalAll :: Contract -&gt; (Contract, OP, State ContractSt ()\nevalAll c = evalAll2 c [] initialState \n\nevalAll2 :: Contract -&gt; OP -&gt; State ContractSt () -&gt; (Contract, OP, State \nContractSt ()\nevalAll2 c o s\n    | c == End = (c, o, s)\n    | otherwise = evalAll2 nc (o ++ no) ns\n        where\n            (nc, no,ns) = evalC c \n</code></pre>\n"}, {"tags": ["haskell", "st-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546615975, "post_id": 54041813, "comment_id": 94918870, "body": "Usually &#39;unsafe&#39; means &#39;violates purity/transparency&#39;. I think this violates referential transparency, hence is unsafe."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1546630507, "post_id": 54041813, "comment_id": 94925642, "body": "FWIW, I find <code>unsafeThaw</code> <i>much</i> scarier than <code>unsafeFreeze</code>, because the requirements for using it safely aren&#39;t as well-confined to the <code>IO</code> context. The only place I&#39;ve personally seen <code>unsafeThaw</code> used is in the <code>fromList</code> mechanism of <code>Data.HashMap</code>, where it&#39;s used to avoid an extra tree traversal. That code is <i>frighteningly</i> subtle. If you use only <code>unsafeFreeze</code> (not <code>unsafeThaw</code>) and you never write to a frozen array, you can be pretty confident that everything will work as you expect."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1546631033, "post_id": 54041813, "comment_id": 94925849, "body": "Note: I conjecture that in <i>most</i> cases where one might be tempted to use <code>unsafeThaw</code>, it would actually be better to just stick to mutable vectors throughout. <code>HashMap.fromList</code> is a bit special because it uses <code>unsafeThaw</code> in the process of creating arrays that are permanently frozen at the end, never to be re-thawed. If there were some way to tie a bunch of arrays to a &quot;token&quot; and freeze them all at once, that would be much cleaner, and I would argue for removing <code>unsafeThaw</code> altogether. But there is no such mechanism and there&#39;s no particularly clean way to make one that I can see."}], "answers": [{"comments": [{"owner": {"reputation": 5876, "user_id": 11809, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b8ee952abb6620c1c93b3acb46cd391c?s=128&d=identicon&r=PG", "display_name": "cemerick", "link": "https://stackoverflow.com/users/11809/cemerick"}, "edited": false, "score": 0, "creation_date": 1546620561, "post_id": 54042624, "comment_id": 94921460, "body": "Thank you, this is sort of what I was afraid of. I&#39;ll perhaps post a follow-up to the ML, but I wonder if there are any mitigations, e.g. maybe constraining operations on the mutable vector/array to a single <code>-XStrict</code> module?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 5876, "user_id": 11809, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b8ee952abb6620c1c93b3acb46cd391c?s=128&d=identicon&r=PG", "display_name": "cemerick", "link": "https://stackoverflow.com/users/11809/cemerick"}, "edited": false, "score": 0, "creation_date": 1546621137, "post_id": 54042624, "comment_id": 94921727, "body": "You can a) leave the array mutable b) thaw and refreeze the array on writes. I don&#39;t know enough about your intended usage and API to tell which&#39;s right, but these are generally your options for remaining memory safe."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546622408, "post_id": 54042624, "comment_id": 94922279, "body": "Please include the relevant bits from the linked message in the answer."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546622935, "post_id": 54042624, "comment_id": 94922478, "body": "@leftaroundabout Can you elaborate? I included here the parts which I have found relevant."}, {"owner": {"reputation": 5876, "user_id": 11809, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b8ee952abb6620c1c93b3acb46cd391c?s=128&d=identicon&r=PG", "display_name": "cemerick", "link": "https://stackoverflow.com/users/11809/cemerick"}, "edited": false, "score": 0, "creation_date": 1546955033, "post_id": 54042624, "comment_id": 95018156, "body": "I can confirm that this usage pattern will yield segfaults with nontrivial code. A simplified prototype of what I needed did produce outstanding results, but when fleshed out into its final form, the segfaults flowed. Turns out, &quot;unsafe&quot; really truly does mean <i>unsafe</i>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 8, "last_activity_date": 1546618843, "creation_date": 1546618843, "answer_id": 54042624, "question_id": 54041813, "link": "https://stackoverflow.com/questions/54041813/just-how-unsafe-are-data-vectors-unsafefreeze-unsafethaw/54042624#54042624", "title": "Just how &quot;unsafe&quot; are Data.Vector&#39;s unsafeFreeze/unsafeThaw?", "body": "<p>This usage pattern can crash: see this <a href=\"https://mail.haskell.org/pipermail/glasgow-haskell-users/2014-May/024978.html\" rel=\"noreferrer\">message</a> for reference. The reason is that mutating an immutable array can create minor GC roots which are not actually visible to minor GC. This error only occurs if your array is in the old GC generation and the written objects are in the new generation, hence you won't trigger it with the simplest tests.</p>\n"}], "owner": {"reputation": 5876, "user_id": 11809, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b8ee952abb6620c1c93b3acb46cd391c?s=128&d=identicon&r=PG", "display_name": "cemerick", "link": "https://stackoverflow.com/users/11809/cemerick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 54042624, "answer_count": 1, "score": 5, "last_activity_date": 1546618843, "creation_date": 1546615599, "question_id": 54041813, "link": "https://stackoverflow.com/questions/54041813/just-how-unsafe-are-data-vectors-unsafefreeze-unsafethaw", "title": "Just how &quot;unsafe&quot; are Data.Vector&#39;s unsafeFreeze/unsafeThaw?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:unsafeFreeze\" rel=\"noreferrer\">documentation for <code>Data.Vector.unsafeFreeze</code></a> says:</p>\n\n<blockquote>\n  <p>Unsafe[ly] convert a mutable vector to an immutable one without copying.\n  The mutable vector may not be used after this operation.</p>\n</blockquote>\n\n<p>I would like to characterize exactly what \"unsafe\" means here. Experimentally, it appears to \"only\" imply that further modification of the originating mutable vector will cause the immutable vector(s) returned by <code>unsafeFreeze</code> to no longer be pure:</p>\n\n<pre><code>$ import qualified Data.Vector as V\n$ import qualified Data.Vector.Mutable as MV\n$ import Control.Monad.ST\n$ :{\n$ |runST $ do\n$ |        mv &lt;- V.thaw $ V.fromList [0..10]\n$ |        v &lt;- V.unsafeFreeze mv\n$ |        MV.write mv 0 (-1)\n$ |        MV.write mv 1 (-2)\n$ |        v' &lt;- V.freeze mv\n$ |        v'' &lt;- V.unsafeFreeze mv\n$ |        return (v, v', v'')\n$ |:}\n([-1,-2,2,3,4,5,6,7,8,9,10],[-1,-2,2,3,4,5,6,7,8,9,10],[-1,-2,2,3,4,5,6,7,8,9,10])\n</code></pre>\n\n<p>I can imagine a modifying the source used in an \"unsafe\" freeze doing all sorts of gnarly things that would lead to much worse behaviour, e.g. segfaulting. I'm quickly out of my depth a.t.m. attempting to read the source around the unsafe operations, unfortunately.</p>\n\n<p>Can I rely on said impurity being the sole way in which these operations are \"unsafe\"?</p>\n\n<p>For context: I have need to implement a variety of modifying algorithms over a typically immutable data structure, and not reusing its public-facing API within that scope of internal mutability would be extremely inconvenient (since AFAICT there is no way to generically <em>access</em> both mutable and immutable vectors). (Ab)using <code>unsafeFreeze</code> when I need to use that API would be the perfect escape hatch, as long as I'm not setting myself up for much more unpleasant side effects down the road.</p>\n"}, {"tags": ["haskell", "instance", "typeclass", "extensibility"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10867566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cc68009f6214b10b5146819797b2d24?s=128&d=identicon&r=PG&f=1", "display_name": "flupe", "link": "https://stackoverflow.com/users/10867566/flupe"}, "edited": false, "score": 0, "creation_date": 1546615349, "post_id": 54041617, "comment_id": 94918478, "body": "Thanks for the quick answer and sorry about the typo, you assumed right and I just fixed it.  I did have a similar solution at some point, however it does not suit the scope of what I am trying to do: provide a generic document model and let users define conversion to some other target language. We have to assume that <code>StringWriter a</code> is not available when defining the <code>DocumentBlock</code>.  When trying to define a more generic typeclass <code>Writer a o</code> that will be refined by users, it fails to compile, as directives will not implicetly have an instance for any <code>Writer a o</code>. (See next comment)"}, {"owner": {"reputation": 51, "user_id": 10867566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cc68009f6214b10b5146819797b2d24?s=128&d=identicon&r=PG&f=1", "display_name": "flupe", "link": "https://stackoverflow.com/users/10867566/flupe"}, "edited": false, "score": 0, "creation_date": 1546615699, "post_id": 54041617, "comment_id": 94918697, "body": "(I have no idea how SO works so see the original post for the code example)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 51, "user_id": 10867566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cc68009f6214b10b5146819797b2d24?s=128&d=identicon&r=PG&f=1", "display_name": "flupe", "link": "https://stackoverflow.com/users/10867566/flupe"}, "edited": false, "score": 0, "creation_date": 1546616143, "post_id": 54041617, "comment_id": 94918967, "body": "@flupe As long as you also provide a generic catch-all instance <code>instance Writer a o</code> to be overlapped by users, the constraints should not be a problem, since they can always be satisfied. It is important, though, that the specific instances are in scope when they have to be used."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 51, "user_id": 10867566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cc68009f6214b10b5146819797b2d24?s=128&d=identicon&r=PG&f=1", "display_name": "flupe", "link": "https://stackoverflow.com/users/10867566/flupe"}, "edited": false, "score": 0, "creation_date": 1546616374, "post_id": 54041617, "comment_id": 94919100, "body": "@flupe Actually, that constraint is way too weak: it only requires a conversion to &quot;some <code>o</code>&quot;, which will be useless later on since we can&#39;t rely on any <code>o</code>. You need a fixed return type for <code>write</code>, or something similar."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1546615940, "last_edit_date": 1546615940, "creation_date": 1546614911, "answer_id": 54041617, "question_id": 54039876, "link": "https://stackoverflow.com/questions/54039876/haskell-not-using-the-more-specific-instance-of-a-typeclass/54041617#54041617", "title": "Haskell not using the more specific instance of a typeclass", "body": "<p>Your code does not compile, since <code>Block something</code> has type <code>DocumentBlock</code>, while <code>write</code> expects an <code>Args a</code> argument, and the two types are different.\nDid you mean <code>writeBlock</code> instead? I'll assume so.</p>\n\n<p>What you might want to try is to add a constraint in your existential type, e.g.:</p>\n\n<pre><code>data DocumentBlock\n    = Paragraph String\n    | forall a. StringWriter a =&gt; Block (Args a)\n             -- ^^^^^^^^^^^^^^ --\n</code></pre>\n\n<p>This has the following effect. Operationally, every time <code>Block something</code> is used, the instance is remembered (a pointer is implicitly stored along the <code>Args a</code> value). That will be a pointer to the catch-all instance, or to the specific one, whichever is the best fit.</p>\n\n<p>When the constructor is then pattern-matched later on, the instance can then be used. Full working code:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n\n-- Arguments for custom directives.\ndata family Args :: * -&gt; *\n\ndata DocumentBlock\n    = Paragraph String\n    | forall a. StringWriter a =&gt; Block (Args a)\n\ndata Math\n-- The expected arguments for the math directive.\ndata instance Args Math = MathArgs String\n\ndoc :: [DocumentBlock]\ndoc =\n    [ Paragraph \"some text\"\n    , Block (MathArgs \"x_{n+1} = x_{n} + 3\")\n    ]\n\nclass StringWriter a where\n    write :: Args a -&gt; String\n\n-- User defined generic conversion for all directives.\ninstance {-# OVERLAPPABLE #-} StringWriter a where\n   write _ = \"Directive\"\n\n-- Custom way of showing the math directive.\ninstance StringWriter Math where\n    write (MathArgs raw) = \"Math(\" ++ raw ++ \")\"\n\n-- Then to display a DocumentBlock\nwriteBlock :: DocumentBlock -&gt; String\nwriteBlock (Paragraph t) = \"Paragraph(\" ++ t ++ \")\"\nwriteBlock (Block args)  = write args\n\nmain :: IO ()\nmain = putStrLn $ writeBlock (Block (MathArgs \"a + b\"))\n</code></pre>\n\n<p>This prints <code>Math(a + b)</code>.</p>\n\n<p>A final note: for this to work it is crucial that all the relevant instances are in scope when <code>Block</code> is used. Otherwise, GHC might choose the wrong instance, causing some unintended output. This is the main limitation, making overlapping instances a bit fragile in general.\nAs long as there are no orphan instances, this should work.</p>\n\n<p>Also note that, if using other existential types, a user can (intentionally or accidentally) cause GHC to pick the wrong instance anyway. For instance, if we use</p>\n\n<pre><code>data SomeArgs = forall a. SomeArgs (Args a)\n\ntoGenericInstance :: DocumentBlock -&gt; DocumentBlock\ntoGenericInstance (Block a) = case SomeArgs a of\n   SomeArgs a' -&gt; Block a'  -- this will always pick the generic instance\ntoGenericInstance db = db\n</code></pre>\n\n<p>then, <code>writeBlock (toGenericInstance (Block (MathArgs \"a + b\")))</code>\nwill produce <code>Directive</code> instead. </p>\n"}], "owner": {"reputation": 51, "user_id": 10867566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cc68009f6214b10b5146819797b2d24?s=128&d=identicon&r=PG&f=1", "display_name": "flupe", "link": "https://stackoverflow.com/users/10867566/flupe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1546615940, "creation_date": 1546608505, "last_edit_date": 1546615802, "question_id": 54039876, "link": "https://stackoverflow.com/questions/54039876/haskell-not-using-the-more-specific-instance-of-a-typeclass", "title": "Haskell not using the more specific instance of a typeclass", "body": "<p>I've been having trouble the past few days figuring out whether something I'm trying to do is actually feasible in Haskell.</p>\n\n<p>Here is some context:\nI am trying to code a little markup language (akin to ReST) where the syntax already enables custom extensions through <em>directives</em>.\nFor users to implement new directives, they should be able to add new semantic constructs inside the document datatype. For exemple if one wants to add a directive for displaying math, they might want to have a <code>MathBlock String</code> constructor inside the ast.</p>\n\n<p>Obviously data types are not extensible, and a solution where there is a generic constructor <code>DirectiveBlock String</code> containing the name of the directive (here, <code>\"math\"</code>) is undesirable as we would like to have in our ast only well-formed constructs (so only directives with well-formed arguments).</p>\n\n<p>Using type families, I prototyped something like:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n\n-- Arguments for custom directives.\ndata family Args :: * -&gt; *\n\ndata DocumentBlock\n    = Paragraph String\n    | forall a. Block (Args a)\n</code></pre>\n\n<p>Sure enough, if someone wishes to define a new directive for math display, they can do it as such:</p>\n\n<pre><code>data Math\n-- The expected arguments for the math directive.\ndata instance Args Math = MathArgs String\n\ndoc :: [DocumentBlock]\ndoc =\n    [ Paragraph \"some text\"\n    , Block (MathArgs \"x_{n+1} = x_{n} + 3\")\n    ]\n</code></pre>\n\n<p>So far so good, we can only construct documents where directive blocks receive the correct arguments.</p>\n\n<p>The problem arises when one user wants to convert the internal representation of a document to some custom output, say, String.\nThe user needs to provide <strong>a default output for all directives</strong>, since there will be many and some of them cannot be converted to the target.\nFurthermore, the user may wish to provide <strong>a more specific output for some directives</strong>:</p>\n\n<pre><code>class StringWriter a where\n    write :: Args a -&gt; String\n\n-- User defined generic conversion for all directives.\ninstance StringWriter a where\n   write _ = \"Directive\"\n\n-- Custom way of showing the math directive.\ninstance StringWriter Math where\n    write (MathArgs raw) = \"Math(\" ++ raw ++ \")\"\n\n-- Then to display a DocumentBlock\nwriteBlock :: DocumentBlock -&gt; String\nwriteBlock (Paragraph t) = \"Paragraph(\" ++ t ++ \")\"\nwriteBlock (Block args)  = write args\n\nmain :: IO ()\nmain = putStrLn $ writeBlock (Block (MathArgs \"a + b\"))\n</code></pre>\n\n<p>With this example, the output is <code>Block</code> and not <code>Math(a+b)</code>, so the generic instance for StringWriter is always chosen. Even when playing with <code>{-# OVERLAPPABLE #-}</code>, nothing succeeds.</p>\n\n<p>Is the kind of behavior I'm describing possible at all in Haskell?</p>\n\n<hr>\n\n<p>When trying to include a generic Writer inside the <code>Block</code> definition, it also fails to compile.</p>\n\n<pre><code>-- ...\n\nclass Writer a o where\n    write :: Args a -&gt; o\n\ndata DocumentBlock\n    = Paragraph String\n    | forall a o. Writer a o =&gt; Block (Args a)\n\ninstance {-# OVERLAPPABLE #-} Writer a String where\n   write _ = \"Directive\"\n\ninstance {-# OVERLAPS #-} Writer Math String where\n    write (MathArgs raw) = \"Math(\" ++ raw ++ \")\"\n\n-- ...\n</code></pre>\n"}, {"tags": ["haskell", "io", "functor"], "comments": [{"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 12, "creation_date": 1546599626, "post_id": 54037432, "comment_id": 94910455, "body": "<code>getArgs</code> is not evaluated in any special way. It is just returning an empty list. Are you actually launching your program with some argument? Note, from the documentation, that the returned list does not include the program name but only the command-line arguments."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 4, "creation_date": 1546599924, "post_id": 54037432, "comment_id": 94910594, "body": "If you get an exception about the list returned by <code>getArgs</code> being empty, that&#39;s almost certainly because it <i>is</i> empty, not because of evaluation order. When <code>head</code> is applied to an argument that hasn&#39;t been evaluated, then the argument will be evaluated at that point - it won&#39;t just claim the argument is an empty list when it might not be. That&#39;s not how laziness works."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1546602762, "post_id": 54037432, "comment_id": 94912005, "body": "In Haskell, one does not evaluate arguments directly (not left-to-right, or at least not as a general rule). It is evaluated lazily."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1546605656, "post_id": 54039118, "comment_id": 94913376, "body": "I did run it from <code>ghci</code> and i was expecting to be  prompted to enter the arguments"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1546605671, "post_id": 54039118, "comment_id": 94913383, "body": "&quot;Most probably you ran your program from ghci, which can produce such an effect.&quot; What do you mean by that?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 4, "creation_date": 1546605736, "post_id": 54039118, "comment_id": 94913410, "body": "@sepp2k That if you have a haskell program which you load into an interactive environment, and call <code>main</code> manually, it will receive no arguments (because, in fact, none were provided). You <a href=\"https://stackoverflow.com/questions/49055999/how-does-getargs-work#comment85117310_49056302\">can provide those arguments using <code>:main</code></a>."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 4, "last_activity_date": 1546605439, "creation_date": 1546605439, "answer_id": 54039118, "question_id": 54037432, "link": "https://stackoverflow.com/questions/54037432/why-is-getargs-evaluated-after-fmap-method-argument/54039118#54039118", "title": "Why is getArgs evaluated after fmap method argument?", "body": "<p>If <code>head</code> breaks on empty list, that means that <code>getArgs</code> <em>did</em> already evaluate, because the value <code>[]</code> was produced and matched by <code>head</code>.</p>\n\n<p>Most probably you ran your program from <code>ghci</code>, which can produce such an effect. Since <code>head</code> is unsafe, you should check whether there's at least one argument on the list present.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 54039118, "answer_count": 1, "score": 0, "last_activity_date": 1546605439, "creation_date": 1546598843, "last_edit_date": 1546599869, "question_id": 54037432, "link": "https://stackoverflow.com/questions/54037432/why-is-getargs-evaluated-after-fmap-method-argument", "title": "Why is getArgs evaluated after fmap method argument?", "body": "<p>Why does <code>getArgs</code> gets evaluated after the method argument of <code>fmap</code>?</p>\n\n<pre><code>main::IO()\nmain=do\n    fpath&lt;-fmap head getArgs\n    putStrLn fpath\n</code></pre>\n\n<p>I get the error :\n<code>Exception: Prelude.head: empty list</code>\nIt seems it applies head on something that has not been computed yet.</p>\n\n<p>I first assumed that it might be another rule about lazyness that i am not aware of being new to Haskell so i tried with :<br>\n<code>a&lt;-fmap head getLine</code> # no problem<br> \n<code>a&lt;-fmap head (readFile [filename])</code> # again no problem</p>\n\n<p>So why is <code>getArgs</code> special that gets evaluated after ? </p>\n"}, {"tags": ["list", "haskell", "recursion", "transpose", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 6, "creation_date": 1546593283, "post_id": 54035881, "comment_id": 94907227, "body": "<code>head&#39; (x:xs) = x</code>, but what is <code>head&#39; []</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1546625590, "post_id": 54035881, "comment_id": 94923676, "body": "Since <code>head&#39; xs:head&#39;&#39; lxs = head&#39;&#39; (xs:lxs)</code>, you can collapse <code>merge (xs:lxs) = (head&#39; xs:head&#39;&#39; lxs):...</code> to <code>merge (xs:lxs) = (head&#39;&#39; (xs:lxs)):...</code>. Similar equational reasoning applies to the <code>...</code>, giving <code>merge (xs:lxs) = (head&#39;&#39; (xs:lxs)):(tail&#39;&#39; (xs:lxs))</code>. At that point there&#39;s not much point to pattern matching; <code>merge lxs = head&#39;&#39; lxs:tail&#39;&#39; lxs</code>. But now you should definitely be suspicious: this definition of <code>merge</code> obviously always calls <code>(:)</code> and never <code>[]</code>. So how does one get to the &quot;end&quot; of the <code>merge</code>&#39;s output?"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1546626288, "post_id": 54036384, "comment_id": 94923973, "body": "So when does <code>merge ([]:xss) = merge xss</code> run as opposed to the other two definitions of <code>merge</code>?"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 1, "last_activity_date": 1546594951, "creation_date": 1546594951, "answer_id": 54036384, "question_id": 54035881, "link": "https://stackoverflow.com/questions/54035881/how-to-deal-with-recursing-through-a-list-in-haskell-transpose-operation/54036384#54036384", "title": "How to deal with recursing through a list in Haskell (transpose operation)", "body": "<p>You need to add exit conditions:</p>\n\n<pre><code>merge [] = []\nmerge ([]:xss) = merge xss\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1546611262, "creation_date": 1546611262, "answer_id": 54040652, "question_id": 54035881, "link": "https://stackoverflow.com/questions/54035881/how-to-deal-with-recursing-through-a-list-in-haskell-transpose-operation/54040652#54040652", "title": "How to deal with recursing through a list in Haskell (transpose operation)", "body": "<p><code>map</code> is all you need, in addition to the existing <code>head</code> and <code>tail</code> functions. For simplicity, this assumes that the input is always a non-empty list (i.e., <code>xs</code> might be <code>[[],[],[]]</code>, but never <code>[]</code> alone, so there's no problem with using <code>head</code> or <code>tail</code>.)</p>\n\n<pre><code>&gt; map head list\n[1,4,7]\n&gt; map tail list\n[[2,3],[5,6],[8,9]]\n&gt; let foo xs = if null (head xs) then [] else map head xs : foo (map tail xs)\n&gt; foo list\n[[1,4,7],[2,5,8],[3,6,9]]\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 54036384, "answer_count": 2, "score": 1, "last_activity_date": 1547810291, "creation_date": 1546592921, "last_edit_date": 1547810291, "question_id": 54035881, "link": "https://stackoverflow.com/questions/54035881/how-to-deal-with-recursing-through-a-list-in-haskell-transpose-operation", "title": "How to deal with recursing through a list in Haskell (transpose operation)", "body": "<p>While I understand that there may be transpose or ZipList functions in Haskell, I am trying to build my own transpose function that will take <em>n</em> lists of equal length <em>m</em> and transpose them into <em>m</em> lists of length <em>n</em>.</p>\n\n<p>So far I have the function nearly working with the following code:</p>\n\n<pre><code>list = [[1,2,3],[4,5,6],[7,8,9]]\n\nhead' (x:xs) = x\n\nhead'' [] = []\nhead'' (xs:lxs) = head' xs:head'' lxs\n\ntail' [] = []\ntail' (x:xs) = xs\n\ntail'' [] = []\ntail'' (xs:lxs) = tail' xs:tail'' lxs\n\nmerge (xs:lxs) = (head' xs:head'' lxs):(merge (tail' xs:tail'' lxs))\n</code></pre>\n\n<p>and I get the following output when I run > <code>merge list</code> in ghci I get:</p>\n\n<pre><code>[[1,4,7],[2,5,8],[3,6,9],[*** Exception: list2.hs:16:1-16: Non-exhaustive patterns in function head'\n</code></pre>\n\n<p>which I am pretty sure means that the base case of the empty list on my <code>head'</code> function is missing. The list is transposed, just not closed. How do I deal with that problem in this case? I have an inkling that it might have to do with <code>Maybe</code>, but I'm having trouble implementing it that way.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546609172, "post_id": 54034145, "comment_id": 94915031, "body": "Why does <code>filterFiles</code> have <code>IO [String]</code> as its return type? You are just filtering a plain list of strings; there&#39;s no I/O involved in the definition other than the fact that you are unnecessarily using <code>filterM</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1546609453, "post_id": 54034145, "comment_id": 94915178, "body": "You can simply use <code>fmap</code>/<code>&lt;$&gt;</code> to use a function of type <code>[String] -&gt; [String]</code> with <code>getFiles</code>: <code>filterFiles &lt;$&gt; getFiles somePath</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1546584843, "post_id": 54034209, "comment_id": 94904189, "body": "You are right but now i see that i still have to add a <code>return</code> inside the lambda :     <code>filterM(\\x-&gt; return . not $ (x ``elem`` [&quot;.&quot;,&quot;..&quot;]) </code>. ( unrelated to the original question anyway)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1546584396, "creation_date": 1546584396, "answer_id": 54034209, "question_id": 54034145, "link": "https://stackoverflow.com/questions/54034145/pattern-syntax-in-expression/54034209#54034209", "title": "Pattern syntax in expression", "body": "<p>You forgot to include the lambda.</p>\n\n<pre><code>filterFiles =filterM (\\x-&gt; not ( x `elem` [\".\",\"..\"]))\n                      ^ here\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 4, "last_activity_date": 1546606845, "last_edit_date": 1546606845, "creation_date": 1546588109, "answer_id": 54034940, "question_id": 54034145, "link": "https://stackoverflow.com/questions/54034145/pattern-syntax-in-expression/54034940#54034940", "title": "Pattern syntax in expression", "body": "<p>The function <code>filterFiles</code> does not involves <code>IO</code>, use <code>filter</code> may be suitable as:</p>\n\n<pre><code>filterFiles::[String]-&gt;[String]\nfilterFiles = filter (\\x-&gt; not ( x `elem` [\".\",\"..\"]))\n</code></pre>\n\n<p>Otherwise, instead of using lambda expression, using <code>flip</code> and <code>notElem</code> may be more concise as:</p>\n\n<pre><code>filterFiles = filter (flip notElem [\".\",\"..\"])\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 54034209, "answer_count": 2, "score": 0, "last_activity_date": 1546606845, "creation_date": 1546584067, "question_id": 54034145, "link": "https://stackoverflow.com/questions/54034145/pattern-syntax-in-expression", "title": "Pattern syntax in expression", "body": "<p>I am wondering why am i getting this error since i have not used any pattern.In my case i have not pattern matched on the <code>filterM</code>'s <code>lambda</code>.</p>\n\n<p><strong>Error</strong></p>\n\n<pre><code> Pattern syntax in expression context: x -&gt; not (x `elem` [\".\", \"..\"])\n   |\n20 |     filterFiles =filterM (x-&gt;not (x `elem` [\".\",\"..\"]))\n   |                           ^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I just want to filter the files in a given directory </p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>  module Fil where\n\n    import System.Directory\n    import Control.Monad(filterM)\n\n    getFiles::FilePath-&gt;IO [String]\n    getFiles  = getDirectoryContents\n\n    filterFiles::[String]-&gt;IO [String]\n    filterFiles =filterM (x-&gt; not ( x `elem` [\".\",\"..\"]))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1546572290, "post_id": 54032482, "comment_id": 94901488, "body": "Um. Can you include enough code that we can reproduce your problem, please? Lots of stuff about this snippet looks off, but it&#39;s tough to tell for sure without knowing what <code>splitEvery</code>, <code>rowLength</code>, <code>coords</code>, <code>table</code>, <code>allCoords</code>, <code>colLength</code>, and <code>rowLength</code> do."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 1, "last_activity_date": 1546570330, "creation_date": 1546570330, "answer_id": 54032556, "question_id": 54032482, "link": "https://stackoverflow.com/questions/54032482/how-do-i-make-this-function-add-nothing-to-the-list/54032556#54032556", "title": "How do I make this function add Nothing to the list?", "body": "<p>Use guards</p>\n\n<pre><code>toShape :: AltShape -&gt; Shape\ntoShape ps = splitEvery (rowLength ps) \n            [ (lookup row (table ps)):r \n            | row &lt;- allCoords (colLength ps) (rowLength ps)\n            , row `notElem` (map coords ps) ]\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546570330, "creation_date": 1546569516, "question_id": 54032482, "link": "https://stackoverflow.com/questions/54032482/how-do-i-make-this-function-add-nothing-to-the-list", "title": "How do I make this function add Nothing to the list?", "body": "<p>Is there any way to add Nothing to a list in a list comphrehension?</p>\n\n<p>I have written the following function</p>\n\n<pre><code>toShape :: AltShape -&gt; Shape\ntoShape ps = splitEvery (rowLength ps) \n            [ if (row `notElem` (map coords ps)) \n              then (lookup row (table ps)):r \n              else Nothing\n               | row &lt;- allCoords (colLength ps) (rowLength ps) ]\n</code></pre>\n\n<p>Where AltShape and Shape are defined as:</p>\n\n<pre><code>type AltShape = [Point]\ndata Point = P Colour (Int,Int)  deriving (Eq,Show)\n\ntype Shape = [Row]\ntype Row = [Square]\ntype Square = Maybe Colour\n\ndata Colour = Black | Red | Green   deriving (Eq,Show)\n</code></pre>\n\n<p>Basically the function is supposed to convert AltShapes to Shapes. I have been trying to accomplish this by creating a function which creates all possible coordinates based on the width and height of the shape, and then matching them to the actual points in the shape. If there is a match I want to add Just c to the list, where c is the colour, and if there isn't a match I want it to add Nothing to the list. But now I just end up with a list of Just c. How should I write it differently?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1546562890, "post_id": 54031747, "comment_id": 94899806, "body": "In fact this is exactly what HaTeX does: its monad type is <a href=\"https://github.com/Daniel-Diaz/HaTeX/blob/5feee2f65c7d6ab45b097214fb3e43c0fc96588a/Text/LaTeX/Base/Writer.hs#L78\" rel=\"nofollow noreferrer\">a wrapper over WriterT</a>. They of course also <a href=\"https://github.com/Daniel-Diaz/HaTeX/blob/5feee2f65c7d6ab45b097214fb3e43c0fc96588a/Text/LaTeX/Base/Writer.hs#L215\" rel=\"nofollow noreferrer\">must define IsString</a>."}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": true, "score": 2, "last_activity_date": 1546562782, "last_edit_date": 1546562782, "creation_date": 1546562356, "answer_id": 54031747, "question_id": 54031702, "link": "https://stackoverflow.com/questions/54031702/return-a-single-string-from-multiple-strings-in-a-do-block/54031747#54031747", "title": "Return a single string from multiple strings in a do block", "body": "\n\n<p>You can use a <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Writer-Lazy.html\" rel=\"nofollow noreferrer\">writer monad</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Trans.Writer\n\nwriteContent :: Writer String ()\nwriteContent = do\n  tell \"Some text. \"\n  tell \"Some more text. \"\n  tell \"This should all compile into a single line \"\n  tell \"and be output to the screen.\"\n\nmain :: IO ()\nmain = do\n  putStr $ execWriter writeContent\n</code></pre>\n\n<p>To do this without an extra (visible) function call like <code>tell</code>, you need the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-OverloadedStrings\" rel=\"nofollow noreferrer\"><code>OverloadedStrings</code> extension</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, GeneralizedNewtypeDeriving, OverloadedStrings\n  #-}\n\nimport Control.Monad.Trans.Writer\nimport Data.String\n\nnewtype StringBuilder a =\n  StringBuilder (Writer String a)\n  deriving (Functor, Applicative, Monad)\n\ninstance (a ~ ()) =&gt; IsString (StringBuilder a) where\n  fromString = StringBuilder . tell\n\nbuildString :: StringBuilder () -&gt; String\nbuildString (StringBuilder w) = execWriter w\n\nwriteContent :: StringBuilder ()\nwriteContent = do\n  \"Some text. \"\n  \"Some more text. \"\n  \"This should all compile into a single line \"\n  \"and be output to the screen.\"\n\nmain :: IO ()\nmain = do\n  putStr $ buildString writeContent\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 1758759, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5e7df1d51660a7dd65bb2e7f46eca915?s=128&d=identicon&r=PG", "display_name": "dim_voly", "link": "https://stackoverflow.com/users/1758759/dim-voly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 54031747, "answer_count": 1, "score": 1, "last_activity_date": 1546562782, "creation_date": 1546561993, "question_id": 54031702, "link": "https://stackoverflow.com/questions/54031702/return-a-single-string-from-multiple-strings-in-a-do-block", "title": "Return a single string from multiple strings in a do block", "body": "<p>I am trying to achieve something similar to what is programmed in HaTeX, where a programmer would write LaTeX commands as text line by line. One of their examples is as follows:</p>\n\n<pre><code>-- Body with a section.\ntheBody :: Monad m =&gt; LaTeXT_ m\ntheBody = do\n    maketitle\n    section \"Hello\"\n    \"This is a simple example using the \"\n    hatex\n    \" library. \"\n    -- 'textbf' turns characters to bold font (as you already may know).\n    textbf \"Enjoy!\"\n    \" \"\n</code></pre>\n\n<p>Full example:\n<a href=\"https://github.com/Daniel-Diaz/HaTeX/blob/master/Examples/simple.hs\" rel=\"nofollow noreferrer\">https://github.com/Daniel-Diaz/HaTeX/blob/master/Examples/simple.hs</a></p>\n\n<p>So far I have achieved the following:</p>\n\n<pre><code>module Main \nwhere import System.IO\n\n\nwriteContent :: String \nwriteContent = do\n    \"Some text. \"\n    ++ \"Some more text. \"\n    ++ \"This should all compile into a single line \"\n    ++ \"and be output to the screen.\"\n\nmain :: IO ()\nmain = do\n    putStr $ writeContent\n</code></pre>\n\n<p>But I'd really like to get rid of the <code>++</code> operators.</p>\n\n<p>I'm aware that <code>Strings</code> and <code>++</code> are less efficient than <code>Text</code>, so will change that eventually once I learn a bit more. Am still quite new to Haskell. I've tried looking through HaTeX source code, but there are parts where too many steps are achieved in a single line, so wanted to build this up small steps at a time.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1546558832, "creation_date": 1546558832, "answer_id": 54031308, "question_id": 54031205, "link": "https://stackoverflow.com/questions/54031205/converting-from-one-representation-of-a-shape-to-another/54031308#54031308", "title": "Converting from one representation of a &quot;Shape&quot; to another", "body": "<p>If efficiency is no concern, you could consider this approach:</p>\n\n<ol>\n<li>Figure out the largest x coordinate (call it w), and the largest y coordinate (call it h).</li>\n<li>Create a rectangular list of lists, length w by h, with a list comprehension or similar. At each position, look through the entire list of points for one with a matching position, and use its color if you find one (<code>Nothing</code> otherwise).</li>\n</ol>\n\n<p>If efficiency is a concern, you could consider a more complicated approach:</p>\n\n<ol>\n<li>Turn your <code>[AltShape]</code> into an <code>IntMap (IntMap Colour)</code>, e.g. using <a href=\"https://stackoverflow.com/q/12398458/791604\">this technique</a>, which maps y and x to colour.</li>\n<li>Iterate over occupied rows with <code>toAscList</code>; within each, iterate over occupied columns with <code>toAscList</code>. You will need to manually pad unoccupied rows with <code>[]</code> and unoccupied columns with <code>Nothing</code>.</li>\n</ol>\n\n<p>An advantage (or possibly disadvantage, depending on your goals!) of the second approach is that it will naturally produce \"ragged\" <code>Shape</code>s which omit trailing <code>Nothing</code>s.</p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "edited": false, "score": 0, "creation_date": 1546563280, "post_id": 54031635, "comment_id": 94899880, "body": "Thanks for the reply, however I don&#39;t think I am supposed to use any libraries except the basic one (Data.List, Char etc...). Looks good tho :)"}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "edited": false, "score": 0, "creation_date": 1546563561, "post_id": 54031635, "comment_id": 94899929, "body": "It\u2019s up to you which libraries to use, but for the record, <code>Data.Array</code> is <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch14.html#x22-20100014\" rel=\"nofollow noreferrer\">part of the language spec</a> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/8.6.2-notes.html#included-libraries\" rel=\"nofollow noreferrer\">included in GHC</a>."}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": false, "score": 1, "last_activity_date": 1546561450, "creation_date": 1546561450, "answer_id": 54031635, "question_id": 54031205, "link": "https://stackoverflow.com/questions/54031205/converting-from-one-representation-of-a-shape-to-another/54031635#54031635", "title": "Converting from one representation of a &quot;Shape&quot; to another", "body": "<p>If you want an efficient solution, the <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array.html#v:accumArray\" rel=\"nofollow noreferrer\"><code>accumArray</code></a> function does almost exactly what you need (after computing the appropriate bounds).</p>\n\n<pre><code>\u03bb&gt; arr = accumArray (const Just) Nothing ((0, 0), (2, 1)) [((y, x), c) | P c (x, y) &lt;- lShape]\n\u03bb&gt; arr\narray ((0,0),(2,1)) [((0,0),Just Red),((0,1),Nothing),((1,0),Just Red),((1,1),Nothing),((2,0),Just Red),((2,1),Just Red)]\n\u03bb&gt; elems arr\n[Just Red,Nothing,Just Red,Nothing,Just Red,Just Red]\n</code></pre>\n\n<p>Now the problem is reduced to <a href=\"https://stackoverflow.com/q/25617970/115030\">split elements into groups</a>.</p>\n\n<pre><code>\u03bb&gt; chunksOf 2 (elems arr)\n[[Just Red,Nothing],[Just Red,Nothing],[Just Red,Just Red]]\n</code></pre>\n\n<p>For a real application you\u2019d probably want to leave it as an array, since array indexing is fast (<em>O</em>(1)) and list indexing is slow (<em>O</em>(<em>n</em>)).</p>\n"}], "owner": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546561450, "creation_date": 1546558024, "question_id": 54031205, "link": "https://stackoverflow.com/questions/54031205/converting-from-one-representation-of-a-shape-to-another", "title": "Converting from one representation of a &quot;Shape&quot; to another", "body": "<p>The following definitions represent a shape composed of coloured squares at specific coordinates on a grid:</p>\n\n<pre><code>type AltShape = [Point]\ndata Point = P Colour (Int,Int)  deriving Eq\ndata Colour = Black | Red | Green | Blue  deriving Eq\n</code></pre>\n\n<p>I should asume that coordinates always are positive and the coordinate (0,0) refers to the top left square of the picture, and the y-coordinates grow downwards</p>\n\n<p>A Red L-shape could be represented by</p>\n\n<pre><code>lShape = [P Red (0,0), P Red (0,1), P Red (0,2), P Red (1,2)]\n</code></pre>\n\n<p>A different way to represent such shapes is as a list-of-lists, one list for each row:</p>\n\n<pre><code>type Shape = [Row] \ntype Row   = [Square]\ntype Square = Maybe Colour\n</code></pre>\n\n<p>For example, the red L-shape above would be represented by the following value of type Shape:</p>\n\n<pre><code>lShape2 = [[x,o]\n          ,[x,o]\n          ,[x,x]] where x = Just Red\n                        o = Nothing\n</code></pre>\n\n<p>My task is to define a function <code>toShape :: AltShape -&gt; Shape</code> that converts from a AltShape to an Shape. I had another task to define a function <code>fromShape :: Shape -&gt; AltShape</code> but where <code>data Shape = S [Row]</code>. I found that rather simple and wrote it like this: </p>\n\n<pre><code>    fromShape :: Shape -&gt; AltShape\n    fromShape (S rows) = [ P c (x,y) | (y,row) &lt;- index rows, (x,Just c) &lt;- index row]\n     where index = zip [0..]\n</code></pre>\n\n<p>However, I am having more trouble with this one. I started by creating the function </p>\n\n<pre><code>colourAndCoords :: Point -&gt; (Colour,(Int,Int))\ncolourAndCoords ( P c (x,y) ) = (c,(x,y))\n</code></pre>\n\n<p>I then created a function </p>\n\n<pre><code>coords :: [Point] -&gt; [(Int,Int)]\ncoords ps = map snd (map colourAndCoords ps)\n</code></pre>\n\n<p>My thought was to compare this list to another list of all possible coordinations and where there was a match add the right colour, and where there wasn't I would add Nothing. However, my teacher said I was making it too complicated and that I should think of another solution. But I am having a hard time thinking of one. So I guess my question is what is the easier way? I am not asking for a solution, just a nudge in the right direction.</p>\n\n<p>Thanks a ton for anyone taking the time to read this and respond!!</p>\n\n<p>If I come up with a solution I will come back and update this thread.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1546557161, "post_id": 54031060, "comment_id": 94898474, "body": "Do you have any ideas of your own?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1546557430, "post_id": 54031060, "comment_id": 94898550, "body": "Try yourself first. Show us where you get stuck, and tell us why you think it&#39;s impossible to make progress there. We will help you over that hump, and then you can iterate."}], "answers": [{"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 3, "last_activity_date": 1546590538, "creation_date": 1546590538, "answer_id": 54035408, "question_id": 54031060, "link": "https://stackoverflow.com/questions/54031060/word-count-with-common-words-haskell/54035408#54035408", "title": "Word count with common words - haskell", "body": "<p>Since you are new to haskell and StackOverflow, let me give you some hints. The full solution is up to you. </p>\n\n<ul>\n<li>First you need to remove punctuation marks in order to avoid <code>is!</code> to be different from <code>is</code>. Check <code>filter</code> function </li>\n<li>Once you have your phrase \"mark-less\" you can count how many words there are. check function <code>words</code></li>\n<li>if you have a list of common words you can intersect it with your list of words and count how many are in both lists. check <code>Data.List</code> library, you'll find useful functions for doing so.</li>\n</ul>\n\n<p>If you get stacked, update the question and <strong>post your attempt</strong></p>\n"}], "owner": {"reputation": 15, "user_id": 10788233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ad85dcf8e62779e801ce73be91908e?s=128&d=identicon&r=PG", "display_name": "llllollll", "link": "https://stackoverflow.com/users/10788233/llllollll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1546624962, "creation_date": 1546557077, "last_edit_date": 1546609542, "question_id": 54031060, "link": "https://stackoverflow.com/questions/54031060/word-count-with-common-words-haskell", "title": "Word count with common words - haskell", "body": "<p>I am working on a little project using Haskell. I want to count the number of words in a paragraph or a few sentences, along with any common words according\nto the Oxford English Corpus (OEC) rank.</p>\n\n<p>I have some code to work from however I am new to Haskell and would require some help. </p>\n\n<pre><code> &lt;your code here&gt;\n\n text = \"the best book in the world is harry potter. my favourite author is \n JK Rowling.\"\n\n  main = do\n   let wordCount = toWordCount text\n   putStrLn \"Report:\"\n   putStrLn (\"\\t\" ++ (show $ length wordlist) ++ \" words\")\n   putStrLn (\"\\t\" ++ (show $ countCommonWords wordlist) ++ \" common words\")\n</code></pre>\n\n<p>expected outcome should be something like this</p>\n\n<pre><code> Report:\n  15 words\n   5 common words\n</code></pre>\n\n<p>help would be appreciated to get me started on this new language.</p>\n\n<p>thanks</p>\n\n<p>so far the only attempt i have been able to make is,</p>\n\n<pre><code> import Data.List (nub) \n import Data.Char (toLower)\n\n toWordCount ns xs = map (\\x -&gt; length (filter (==x) xs)) ns\n nubl = nub . map (map toLower) -- to lowercase\n\n wordCount ws =  zip ns (countCommonWords ns ws)\n where ns = nubl ws\n</code></pre>\n\n<p>that's the best attempt i have made, any solutions would be helpful</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1546553816, "creation_date": 1546553816, "answer_id": 54030559, "question_id": 54030077, "link": "https://stackoverflow.com/questions/54030077/lifting-a-lens-traversal-to-fix/54030559#54030559", "title": "Lifting a (Lens) Traversal to Fix", "body": "<p>In <code>directions</code> we need to traverse the <code>p</code> with <code>a2fb</code> too. Since <code>p</code> is a parameter, we can take its traversal as a parameter. In addition, the <code>f</code> you've defined is really a traversal of <code>PathComponent</code>, that we can pull out as well.</p>\n\n<p>First, the traversal of <code>PathComponent a p</code>, which is parameterized by a traversal of <code>p</code> (and generalized so the source and target types can vary):</p>\n\n<pre><code>data PathComponent d a = Directions d | Alt [a] deriving (Show, Functor, Foldable, Traversable)\n\n{- Morally\n\ntraversePC ::\n  Traversal pa pb a b -&gt;\n  Traversal (PathComponent a pa) (PathComponent b pb) a b\n\n   But the following type is both simpler (rank 1) and more general.\n-}\ntraversePC ::\n  Applicative m =&gt;\n  LensLike m pa pb a b -&gt;\n  LensLike m (PathComponent a pa) (PathComponent b pb) a b\ntraversePC _tp f (Directions d) = Directions &lt;$&gt; f d\ntraversePC  tp f (Alt pas) = Alt &lt;$&gt; (traverse . tp) f pas\n</code></pre>\n\n<p>In the <code>Directions</code> case, we transform the <code>a</code> to a <code>b</code> directly.\nIn the <code>Alt</code> case, we have a list of <code>pa</code>, so we compose a traversal of that list (<code>traverse</code>) with the parameter traversal (<code>tp</code>).</p>\n\n<p>The traversal of <code>Path</code> passes <code>tp</code> to <code>traversePC</code>.</p>\n\n<pre><code>newtype Path d a = Path [PathComponent d a] deriving (Show, Functor, Foldable, Traversable)\n\n{- Same idea about the types.\n\ndirections :: Traversal pa pb a b -&gt; Traversal (Path a pa) (Path b pb) a b\n\n-}\n\ndirections ::\n  Applicative m =&gt;\n  LensLike m pa pb a b -&gt;\n  LensLike m (Path a pa) (Path b pb) a b\ndirections tp f (Path l) = Path &lt;$&gt; (traverse . traversePC tp) f l\n</code></pre>\n\n<p>And finally, to traverse <code>Fix (Path a)</code>, this unpacks to <code>h :: Path a (Fix (Path a))</code>, and we pass down the toplevel traversal for <code>Fix (Path a)</code> recursively.</p>\n\n<pre><code>directions' :: Traversal (Fix (Path a)) (Fix (Path b)) a b\ndirections' f (Fix h) = Fix &lt;$&gt; directions directions' f h\n</code></pre>\n\n<p>In fact, there is a general pattern here for any <code>Fix</code>. If you have a functor <code>f</code> (here <code>Path a</code>), and there is a traversal of <code>f x</code> parameterized by a traversal of <code>x</code>, then you can tie a knot to get a traversal <code>traverseFix'</code> of <code>Fix f</code>, applying the parameterized traversal to <code>traverseFix'</code> itself.</p>\n\n<pre><code>{-\n\ntraverseFix ::\n  (forall x y. Traversal x y a b -&gt; Traversal (f x) (g y) a b) -&gt;\n  Traversal (Fix f) (Fix g) a b\n\n-}\n\ntraverseFix ::\n  Functor m =&gt;\n  (forall x y. LensLike m x y a b -&gt; LensLike m (f x) (g y) a b) -&gt;\n  LensLike m (Fix f) (Fix g) a b\ntraverseFix traverseF = traverseFix' where\n  traverseFix' f (Fix h) = Fix &lt;$&gt; traverseF traverseFix' f h\n</code></pre>\n\n<p>So we can redefine <code>directions'</code> as follows:</p>\n\n<pre><code>directions'' :: Traversal (Fix (Path a)) (Fix (Path b)) a b\ndirections'' = traverseFix directions\n</code></pre>\n\n<p><a href=\"https://gist.github.com/Lysxia/d9cfc12526f8f2dcedc8cabf31fdc615\" rel=\"nofollow noreferrer\">Full gist</a></p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 54030559, "answer_count": 1, "score": 1, "last_activity_date": 1546553816, "creation_date": 1546551083, "question_id": 54030077, "link": "https://stackoverflow.com/questions/54030077/lifting-a-lens-traversal-to-fix", "title": "Lifting a (Lens) Traversal to Fix", "body": "<p>I've got the following code. As you can see the last function is <code>undefined</code>.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, DeriveFunctor, DeriveTraversable #-}\n\nmodule Example where\n\nimport Control.Lens\nimport Data.Functor.Foldable\n\ndata PathComponent d a = Directions d | Alt [a] deriving (Show, Functor, Foldable, Traversable)\n\nmakePrisms ''PathComponent\n\nnewtype Path d a = Path [PathComponent d a] deriving (Show, Functor, Foldable, Traversable)\n\ndirections :: Traversal (Path a p) (Path b p) a b\ndirections a2fb (Path l) = Path &lt;$&gt; traverse f l where\n    f (Directions d) = Directions &lt;$&gt; a2fb d\n    f (Alt p) = (pure . Alt) p\n\ndirections' :: Traversal (Fix (Path a)) (Fix (Path b)) a b\ndirections' = undefined\n</code></pre>\n\n<p>What I ultimately want to do is map every <code>a</code> to a <code>b</code> recursively in the structure. I was hoping I could do this by lifting <code>directions</code> but I seem to be held back by a) the fact the function declares <code>p</code> in the <code>s</code> and <code>t</code> positions and also b) the fact that <code>_Wrapping</code> is an <code>Iso'</code> not a <code>Iso</code>. Is there an elegant way to fix this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 5, "creation_date": 1546542150, "post_id": 54028258, "comment_id": 94892918, "body": "Use <code>Maybe</code>. Catching errors is monadic\u2014you can&#39;t <i>not</i> &quot;force [it] to be monadic.&quot; It is monadic via its properties."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 10, "creation_date": 1546542434, "post_id": 54028258, "comment_id": 94893045, "body": "Write your own <code>data Ok a = No | Yes a</code>, don&#39;t write a <code>Monad</code> instance for it, and write a <code>safeHead :: [a] -&gt; Ok a</code>. Then realize that you actually want it to be a <code>Monad</code> because being a <code>Monad</code> is really useful. Then use <code>Maybe</code> instead."}, {"owner": {"reputation": 642, "user_id": 5903220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/291d29cf6adac0a479244f2f8cc82e54?s=128&d=identicon&r=PG&f=1", "display_name": "cdelmas", "link": "https://stackoverflow.com/users/5903220/cdelmas"}, "edited": false, "score": 1, "creation_date": 1546596212, "post_id": 54028258, "comment_id": 94908605, "body": "Not sure to understand clearly your question. Can you be more precise, with an example of what you want to avoid? If it is only for <code>head</code>, you can use <code>Data.Maybe.listToMaybe</code>."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546684935, "post_id": 54028258, "comment_id": 94936768, "body": "That would be specialized to Maybe, would require me to rewrite code (which in may case comes from SML), and any other exception could still be thrown. I want to make sure that a value of type a is indeed effect free by handling exception."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1546544784, "post_id": 54028550, "comment_id": 94893989, "body": "Instead of a custom <code>listElim</code> it may be worth suggesting <code>foldr</code>: <code>headDef = foldr const</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1546544953, "post_id": 54028550, "comment_id": 94894057, "body": "I mean I could have just written it with pattern matching, but this was more fun."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546685860, "post_id": 54028550, "comment_id": 94936999, "body": "The problem is : exception are handled in <code>IO</code> but generated in pure code."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546686056, "post_id": 54028550, "comment_id": 94937048, "body": "The usage of monadic was, maybe, not clear enough : I do not want to sequence my code in a particular way. Not all code using a maybe is structured as a sequence of steps propagating an optional value by wrapping/unwrapping, as CPS/monad does"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 7, "last_activity_date": 1546543386, "creation_date": 1546543386, "answer_id": 54028550, "question_id": 54028258, "link": "https://stackoverflow.com/questions/54028258/how-to-catch-error-in-pure-haskell-code-with-no-monad/54028550#54028550", "title": "How to catch error in pure haskell code with no monad", "body": "<p>There is no way to use <code>catch</code> in pure code. This is by design: exceptions are handled by the IO system. That's why the type of <code>catch</code> uses <code>IO</code>. If you want to handle failure in pure code, you should use a type to represent the possibility of failure. In this case, the failure is that the value can sometimes not exist.</p>\n\n<p>The type we use in Haskell to denote a value that can either exist or not is called <code>Maybe</code>. <code>Maybe</code> is an instance of <code>Monad</code>, so it is \"monadic\", but that should not dissuade you from using it for its intended purpose. So the function you want is <code>headMay</code> from the <em>safe</em> package: <code>headMay :: [a] -&gt; Maybe a</code>.</p>\n\n<p>That said, if you want to avoid monads you can instead use a function that unpacks the list:</p>\n\n<pre><code>listElim :: b -&gt; (a -&gt; [a] -&gt; b) -&gt; [a] -&gt; b\nlistElim nil _ [] = nil\nlistElim _ cons (x:xs) = cons x xs\n</code></pre>\n\n<p>As you can see, this replaces a <code>[]</code> with <code>nil</code> and a <code>:</code> with a call to <code>cons</code>. Now you can write a safe head that lets you specify a default:</p>\n\n<pre><code>headDef :: a -&gt; [a] -&gt; a\nheadDef def = listElim def const\n</code></pre>\n\n<p>Unfortunately, functions are an instance of <code>Monad</code>, so it turns out that you have been \"force[d] to be monadic\" after all! There is truly no escaping the monad, so perhaps it is better to learn how to use them productively instead.</p>\n"}, {"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546686202, "post_id": 54029110, "comment_id": 94937086, "body": "That&#39;s all right, my (imported) code is unsafe to begin with, and I am fine with that. Hopefully me handling errors won&#39;t make it <i>more</i> unsafe but less so  :))"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1546546252, "creation_date": 1546546252, "answer_id": 54029110, "question_id": 54028258, "link": "https://stackoverflow.com/questions/54028258/how-to-catch-error-in-pure-haskell-code-with-no-monad/54029110#54029110", "title": "How to catch error in pure haskell code with no monad", "body": "<p>If you want to live dangerously, you can use <code>unsafePerformIO</code>:</p>\n\n<pre><code>catch'Pure'\n  :: Exception e   \n  =&gt; a \n  -&gt; (e -&gt; a)\n  -&gt; a\ncatch'Pure' v h = unsafePerformIO $\n  evaluate v `catch` (pure . h)\n</code></pre>\n\n<p>The problem is that this isn't guaranteed to be at all well-behaved. For example, if you pass it the value</p>\n\n<pre><code>(let a = a in a) `seq` error \"hallo!\"\n</code></pre>\n\n<p>the compiler is entitled to produce an infinite loop sometimes and an error message other times, violating the fundamental expectation of purity. There are reasons to use code that looks sort of like this, but great care is required to make it behave well.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1546570545, "post_id": 54031709, "comment_id": 94901204, "body": "<code>spoon</code> uses a combination of <code>unsafePerformIO</code> and <code>deepseq</code> that I would definitely not recommend for serious use. If you want a <code>head</code> that returns a <code>Maybe</code>, you can use the one in the &#39;safe&#39; package."}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1546572157, "post_id": 54031709, "comment_id": 94901460, "body": "@ReinHenrichs I wouldn\u2019t <i>recommend</i> it either, but the OP did say \u201cwhich I do not want to make pure for real, nor force to be monadic\u201d, and at least <code>spoon</code> (or <code>teaspoon</code>, if you don\u2019t want the <code>deepseq</code>) is safer than writing <code>unsafePerformIO</code> directly."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546575626, "post_id": 54031709, "comment_id": 94902067, "body": "How is returning a Maybe via unsafe magic any less &quot;monadic&quot; than just returning a Maybe the usual way? If they&#39;re ok with Maybe, why not just suggest headMay?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546575691, "post_id": 54031709, "comment_id": 94902078, "body": "In fact, isn&#39;t it <i>more</i> monadic since it uses IO under the hood?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1546575904, "post_id": 54031709, "comment_id": 94902113, "body": "Then again, I confess that I often don&#39;t know what people mean when they say &quot;monadic&quot; (or, for that matter, &quot;pure&quot;)."}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1546576643, "post_id": 54031709, "comment_id": 94902256, "body": "@ReinHenrichs I\u2019m imagining that the OP has some kind of giant complicated computation with a <code>head</code> deep buried inside layers and layers of functions that were all built with the assumption that the <code>head</code> would never receive an empty list\u2014an assumption that for some reason has now changed. The hard part of fixing this the right way isn\u2019t getting a <code>Maybe</code> back from <code>head</code>\u2014that\u2019s easy\u2014the hard part is tediously fixing all the layers of functions to plumb the <code>Maybe</code> all the way back to the outer caller monadically. And so, I imagine, the OP is looking for a quick and dirty shortcut."}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1546577119, "post_id": 54031709, "comment_id": 94902364, "body": "Obviously, this is a terrible software engineering decision and it\u2019s probably going to come back to bite them. But some one-off projects don\u2019t require good software engineering. Or at least that\u2019s what I tell myself when I\u2019m trying not to be cynical about the entire field of computer science\u2026"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546577212, "post_id": 54031709, "comment_id": 94902392, "body": "That is... a bit of a stretch? \ud83d\ude00"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546685483, "post_id": 54031709, "comment_id": 94936910, "body": "@ReinHenrichs Your recommendation compares safe code VS unsafe code. the problem here is &quot;how to deal with unsafe code&quot;, and we should not be fooled by Haskell&#39;s pure type which are in reality not pure at all (<code>head</code> being just one example)"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546685786, "post_id": 54031709, "comment_id": 94936975, "body": "@AndersKaseorg That&#39;s exactly the situation. It&#39;s good that haskell is promoting purity, but it&#39;s also true that we need practical ways to deal with haskell lies about it. The imported code is throwing exception somewhere, I know why, and I have no desire to rewrite the whole damn thing just to make it work, when this could be reached in one step."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1546686402, "post_id": 54031709, "comment_id": 94937129, "body": "@ReinHenrichs monadic in that context meant giving an explicit sequencing of operations in the syntax, which is sometimes necessary, and often not. I can imagine it&#39;s an overloaded term, I should have made it more clear."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1546707797, "post_id": 54031709, "comment_id": 94942627, "body": "@nicolas It definitely wasn&#39;t clear to me that your question wanted this sort of answer, but I&#39;m glad you got some good answers."}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": false, "score": 2, "last_activity_date": 1546562028, "creation_date": 1546562028, "answer_id": 54031709, "question_id": 54028258, "link": "https://stackoverflow.com/questions/54028258/how-to-catch-error-in-pure-haskell-code-with-no-monad/54031709#54031709", "title": "How to catch error in pure haskell code with no monad", "body": "\n\n<p><a href=\"http://hackage.haskell.org/package/spoon-0.3.1/docs/Control-Spoon.html\" rel=\"nofollow noreferrer\"><code>Control.Spoon</code></a> from the <a href=\"http://hackage.haskell.org/package/spoon-0.3.1\" rel=\"nofollow noreferrer\">spoon package</a> provides a <a href=\"https://stackoverflow.com/q/14710928/115030\">mostly</a>-safe wrapper around the unsafe operations required for this.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; spoon (head [1,2,3])\nJust 1\n\u03bb&gt; spoon (head [])\nNothing\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 54029110, "answer_count": 3, "score": 2, "last_activity_date": 1578582552, "creation_date": 1546541892, "last_edit_date": 1578582552, "question_id": 54028258, "link": "https://stackoverflow.com/questions/54028258/how-to-catch-error-in-pure-haskell-code-with-no-monad", "title": "How to catch error in pure haskell code with no monad", "body": "<p>It's probably been asked to death, but would anyone know the least intrusive way to \"catch\"</p>\n\n<pre><code>catch\n:: Exception e   \n=&gt; IO a \n-&gt; (e -&gt; IO a)  \n-&gt; IO a\n</code></pre>\n\n<p>error in \"pure\" <code>haskell</code> computations ?</p>\n\n<p>(say, some code containing <code>head []</code>, not safe, which I do not want to make pure for real, nor force to be monadic)</p>\n\n<p>PS : of course if you can and want to design from scratch, <strong>do bake that in</strong> (with a maybe type). The question here is that I do knowingly <strong>want</strong> to keep it unsafe (to keep a simple translation from an unsafe language) and wonder what the nicest/least ugly way to do so.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1546540064, "post_id": 54027671, "comment_id": 94891995, "body": "I doubt that <code>fromInt</code> compiles. Could you produce an MCVE to show your problem?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1546540546, "post_id": 54027671, "comment_id": 94892218, "body": "According to your definition <code>IntNat t = Int</code> for all <code>t</code>. Your signatures are exactly equivalent to <code>incNat :: Int-&gt;Int</code> and <code>fromInt :: Int-&gt;Int</code>. <code>four</code> has types <code>IntNat (Nat 0), IntNat (Nat 1), ...</code>, all of them actually being <code>Int</code>. For some reason, the type inference engine prefer the form <code>IntNat t</code>, as if it were the most general type (it is, but so are all the others). Note that, crucially, you are using a type synonym and not a <code>newtype</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1546541525, "post_id": 54027671, "comment_id": 94892640, "body": "It is quite clear that <code>fromInt :: Int -&gt; IntNat t</code> so any time you apply it to a value of type Int you will get a value of type <code>IntNat t</code>.  You seem to be wanting dependent types."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1546548972, "creation_date": 1546548972, "answer_id": 54029685, "question_id": 54027671, "link": "https://stackoverflow.com/questions/54027671/constructing-a-nat-type/54029685#54029685", "title": "Constructing a Nat type", "body": "<p>Because you defined a type synonym, and not a newtype, the meaning is quite different than what you seem to think.  Roughly, <code>IntNat _</code> will unify with <code>Int</code> and thus any other <code>IntNat _</code>.  </p>\n\n<p>You can try this out by defining other intnats and see them unify in, say, a list:</p>\n\n<pre><code>*Main&gt; let five = 5 :: IntNat 99\n*Main&gt; let xs = [four, five] :: [IntNat 42]\n*Main&gt; :t xs\nxs :: [IntNat 42]\n</code></pre>\n\n<p>or using a single intnat:</p>\n\n<pre><code>*Main&gt; let four' = four :: IntNat 1000\n*Main&gt; :t four'\nfour' :: IntNat 1000\n</code></pre>\n\n<p>Instead consider using a newtype, such as <code>newtype IntNat (n :: Nat) = IN Int</code>.  You'd get an error like:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018t\u2019 with \u20180\u2019\n  \u2018t\u2019 is a rigid type variable bound by\n    the type signature for:\n      fromInt :: forall (t :: Nat). Int -&gt; IntNat t\n    at so.hs:12:1-26\n  Expected type: IntNat t\n    Actual type: IntNat 0\n\u2022 In the expression: IN 0 :: IntNat 0\n  In an equation for \u2018fromInt\u2019: fromInt 0 = IN 0 :: IntNat 0\n\u2022 Relevant bindings include\n    fromInt :: Int -&gt; IntNat t (bound at so.hs:13:1)\n</code></pre>\n\n<p>This is because <code>t</code> and <code>0</code> are not the same - <code>t</code> is universal not existential.  The offending lines are:</p>\n\n<pre><code>fromInt :: Int -&gt; IntNat t\nfromInt 0 = 0 :: IntNat 0 \n</code></pre>\n\n<p><code>forall t. t == 0</code> is a hard proof to write</p>\n"}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 54029685, "answer_count": 1, "score": 0, "last_activity_date": 1546548972, "creation_date": 1546539354, "question_id": 54027671, "link": "https://stackoverflow.com/questions/54027671/constructing-a-nat-type", "title": "Constructing a Nat type", "body": "<p>I'm currently learning about using Nat from GHC.TypeLits</p>\n\n<p>I am trying to lift an integer to the type level for testing via these definitions:</p>\n\n<pre><code>type IntNat (t::Nat) = Int\n\nincNat :: IntNat t -&gt; IntNat (t + 1)\nincNat n = n + 1\n\nfromInt :: Int -&gt; IntNat t\nfromInt(0) = (0 :: IntNat 0)\nfromInt(n) = incNat (fromInt(n-1))\n\nfour = fromInt 4\n</code></pre>\n\n<p>From my understanding this should result in:</p>\n\n<pre><code>four = 4 :: IntNat (Nat 4)\n</code></pre>\n\n<p>However I am getting:</p>\n\n<pre><code>four = 4 :: IntNat t\n</code></pre>\n\n<p>Where am I going wrong, is it just that <code>fromInt</code> is erasing the type information?</p>\n"}, {"tags": ["haskell", "types", "instance"], "comments": [{"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "edited": false, "score": 1, "creation_date": 1546527652, "post_id": 54024128, "comment_id": 94885899, "body": "The problem here isn&#39;t that ghc doesn&#39;t use the type variable a. It does! You can tell it has inferred that 0 should have the type <code>a</code>, because it is complaining that <code>a</code> (arising from the literal 0) is not known to be an instance of <code>Num</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1546526349, "post_id": 54024340, "comment_id": 94885084, "body": "For future visitors with similar error messages: another solution is to leave the method definitions the same, but add the required constraint to the instance context, as in <code>instance (Num a, Bits a) =&gt; Bits [a] where ...</code>. It&#39;s not the right solution in this case, but in other similar cases it frequently is."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1546525983, "creation_date": 1546525983, "answer_id": 54024340, "question_id": 54024128, "link": "https://stackoverflow.com/questions/54024128/how-to-use-type-variable-in-haskell-instance-where/54024340#54024340", "title": "How to use type variable in Haskell instance-where", "body": "<p>There are different ways to write \"zero\" in different contexts.</p>\n\n<p>You only have a constraint <code>Bits a</code>, then one way to write \"zero\" is <code>zeroBits</code>.</p>\n\n<p><code>0</code> is the \"zero\" for types that have a <code>Num a</code> instance.</p>\n"}], "owner": {"reputation": 31, "user_id": 9745980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea249dd10658dff791d6eb1a13f52f30?s=128&d=identicon&r=PG&f=1", "display_name": "Bob Green", "link": "https://stackoverflow.com/users/9745980/bob-green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 54024340, "answer_count": 1, "score": 1, "last_activity_date": 1546525983, "creation_date": 1546525162, "question_id": 54024128, "link": "https://stackoverflow.com/questions/54024128/how-to-use-type-variable-in-haskell-instance-where", "title": "How to use type variable in Haskell instance-where", "body": "<p>I try to use type variable in the where-body of the type instance. But GHC\n don't use the type variable for the functions in the type instance.</p>\n\n<p>I try to implement type class <code>Bits</code> for <code>[a]</code>.</p>\n\n<pre><code>instance forall a. Bits a =&gt; Bits [a] where\n    xor = zipWith xor\n    rotateL list dis = keeped .|. overlap\n    where\n        overlap = tail moved ++ [head moved] \n        (keeped, moved) = unzip $ map (\\n -&gt; let rot = rotate n dis in (rot.&amp;.mask, rot.&amp;.filter)) list\n        mask = (complement 0) `shiftL` dis -- this line\n        filter = complement mask\n</code></pre>\n\n<p>GHC says:</p>\n\n<pre><code>Could not deduce (Num a) arising from the literal \u20180\u2019\n</code></pre>\n\n<p>Expected:</p>\n\n<p>That <code>0</code> is expected to be as type <code>a</code>, which is the type variable as defined in <code>instance forall a. Bits a =&gt; Bits [a]</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546525433, "post_id": 54023700, "comment_id": 94884523, "body": "Do you actually need the elements of <code>l</code>, or just its length?"}, {"owner": {"reputation": 35, "user_id": 9158474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e56715806d96ef4350afd6a45c5fa7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Mironski", "link": "https://stackoverflow.com/users/9158474/jordan-mironski"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546525986, "post_id": 54023700, "comment_id": 94884850, "body": "yea the function <code>f</code> is just for the example in my case its something that uses the elements"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 6, "last_activity_date": 1546524012, "creation_date": 1546524012, "answer_id": 54023789, "question_id": 54023700, "link": "https://stackoverflow.com/questions/54023700/finding-the-index-of-current-element-in-a-map-function/54023789#54023789", "title": "Finding the index of current element in a map function", "body": "<p>You can <code>zip</code> your list with a list of indices before <code>map</code>ping. There also is a shorthand <code>zipWith</code> for <code>zip</code> followed by <code>map</code>.</p>\n\n<pre><code>zipWith (\\i x -&gt; f (5 + i)) [0 ..] l\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 9158474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e56715806d96ef4350afd6a45c5fa7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Mironski", "link": "https://stackoverflow.com/users/9158474/jordan-mironski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 54023789, "answer_count": 1, "score": 1, "last_activity_date": 1546524035, "creation_date": 1546523684, "last_edit_date": 1546524035, "question_id": 54023700, "link": "https://stackoverflow.com/questions/54023700/finding-the-index-of-current-element-in-a-map-function", "title": "Finding the index of current element in a map function", "body": "<p>I have a list with elements that can have duplicates and i want to</p>\n\n<p>map a function for example: <code>map (\\x -&gt; f (5 + (elemIndex x l))) l</code>\nThe problem is that if the list has duplicate elements <code>elemIndex</code> returns the index of the first one. I want it to be the index of <code>x</code> in <code>l</code> ,where <code>x</code> is the current element.</p>\n\n<p>I guess I am looking for a function to replace <code>elemIndex</code> in my code</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546519940, "post_id": 54022574, "comment_id": 94881354, "body": "You cannot do this. The closest solution is to make one instance of <code>P</code> for each type to decide whether it should use <code>A</code> or <code>B</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546520118, "post_id": 54022574, "comment_id": 94881467, "body": "Having OR constraints would require the type checker to check if <code>A x</code> can be satisfied, and otherwise backtrack and check <code>B x</code> instead. This can easily lead to an exponential blowup, in the general case with many typeclasses. I think the Haskell designers avoided OR constraints intentionally to keep the complexity sane."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1546520208, "post_id": 54022574, "comment_id": 94881519, "body": "Can you elaborate on &quot;I encountered this when dealing with natural numbers, Max and Min functions&quot;? Perhaps this is an XY problem."}, {"owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546520387, "post_id": 54022574, "comment_id": 94881628, "body": "@chi That makes quite a bit of sense, I had assumed that the constraint checked ended up something like prolog. I fixed it in the case of the Max and Min, by ensuring each case doesn&#39;t overlap, I was just wondering if there was a better solution to the more general problem."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546522159, "post_id": 54022574, "comment_id": 94882622, "body": "It is indeed similar to Prolog, but there are some key differences. One is ensured termination (unless extensions are used to relax it), another is no-nondeterminism (no backtracking). Further, in Haskell the order of the clauses does not matter. Some extensions can affect some of these features (overlapping instances cause a form of non determinism / gives a kind of priority to clauses, roughly)."}], "answers": [{"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": true, "score": 0, "last_activity_date": 1546678534, "creation_date": 1546678534, "answer_id": 54050478, "question_id": 54022574, "link": "https://stackoverflow.com/questions/54022574/overlapping-instances-and-oring-constraints/54050478#54050478", "title": "Overlapping instances and ORing constraints", "body": "<p>@Li-yaoXia is correct to say you can't do this. @Chi's explanation isn't what's going on. The <code>=&gt;</code> in an instance decl is not implication (at least not in the Prolog sense).</p>\n\n<pre><code>instance A x =&gt; P x\n</code></pre>\n\n<p>Means <code>x</code> is an instance of class <code>P</code>. Typically the <code>x</code> will be a concrete type like <code>Int</code>, or at least a type constructor with argument variables like <code>Maybe a</code>. The <code>=&gt;</code> then says: for type <code>x</code> an instance of <code>P</code>, require <code>A x</code>. That is, the implication goes the opposite way to how it looks.</p>\n\n<p>It's a (common) newbie mistake to think it means 'first check all constraints hold then check if the instance head holds.' </p>\n\n<p>Then also having</p>\n\n<pre><code>instance B x =&gt; P x\n</code></pre>\n\n<p>means <code>x</code> is an instance of <code>P</code>; also require <code>B x</code>. So if your two instances were to compile, you'd be requiring <code>(P x) IMPLIES ((A x) AND (B x))</code>. That is, the same as</p>\n\n<pre><code>instance (A x, B x) =&gt; P x\n</code></pre>\n\n<p>But your instances don't compile. Because their two heads are identical <code>P x</code>; that's a repeat. (I expect not an overlapping instances error, but a repeated instance error.)</p>\n\n<p>Overlapping instances are nothing to do with what's going on here. (But @Chi is wrong to suggest they require any sort of indeterminism: if you try to write indeterministic overlapping instances, usually the program gets rejected. Unless you switch on all sorts of dangerous extensions.)</p>\n"}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54050478, "answer_count": 1, "score": 0, "last_activity_date": 1546678534, "creation_date": 1546519527, "question_id": 54022574, "link": "https://stackoverflow.com/questions/54022574/overlapping-instances-and-oring-constraints", "title": "Overlapping instances and ORing constraints", "body": "<p>I want to have a class which represents a property <code>P x</code> and I have an implication of the form <code>A x \\or B x =&gt; P x</code>.</p>\n\n<p>I have tried to implement this as follows:</p>\n\n<pre><code>class P x \ninstance A x =&gt; P x\ninstance B x =&gt; P x\n</code></pre>\n\n<p>However this fails with overlapping instances if both <code>A x</code> and <code>B x</code> hold.</p>\n\n<p>(I encountered this when dealing with natural numbers, Max and Min functions)</p>\n\n<p>What is the correct way of expressing this constraint?</p>\n"}, {"tags": ["haskell", "types", "type-level-computation", "data-kinds", "heterogeneous-array"], "comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 5, "creation_date": 1546511108, "post_id": 54020335, "comment_id": 94876727, "body": "Data kinds, promoted constructors: <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/kind-polymorphism-and-promotion.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1546520092, "post_id": 54020335, "comment_id": 94881448, "body": "You may also like <a href=\"https://stackoverflow.com/a/53815871/791604\">Confused on DataKinds extension</a>."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1546528184, "post_id": 54020773, "comment_id": 94886219, "body": "It&#39;s also possible to write <code>&#39; [&#39;A, &#39;B, &#39;C]</code> to disambiguate your example."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1546512721, "last_edit_date": 1546512721, "creation_date": 1546512391, "answer_id": 54020773, "question_id": 54020335, "link": "https://stackoverflow.com/questions/54020335/what-is-and-in-haskell/54020773#54020773", "title": "What is &#39;[] and &#39;: in Haskell?", "body": "<p><code>DataKinds</code> allows one to use term-level constructors at the type level.</p>\n\n<p>After</p>\n\n<pre><code>data T = A | B | C\n</code></pre>\n\n<p>one can write types indexed by a value of <code>T</code></p>\n\n<pre><code>data U (t :: T) = ...\nfoo :: U A -&gt; U B -&gt; ...\n</code></pre>\n\n<p>Here, however, <code>A</code> and <code>B</code> are used as types, not as values. Hence, they have to be \"promoted\" using a quote:</p>\n\n<pre><code>data U (t :: T) = ...\nfoo :: U 'A -&gt; U 'B -&gt; ...\n</code></pre>\n\n<p>The same happens with the familiar list syntax. <code>'[]</code> is an empty list, promoted at the type level. <code>'[a,b,c]</code> is the same as <code>a ': b ': c ': '[]</code>, a list promoted at the type level.</p>\n\n<pre><code>type           :: kind\n'[]            :: [k]   -- polykinded! works for any kind k\n'[ 'A, 'B, 'C] :: [T]   -- mind the spaces, we do not want the char '['\n'A ': '[]      :: [T]\n'[ Int, Bool ] :: [*]   -- a list of types\n'[ Int ]       :: [*]   -- a list of types with only one element\n[Int]          :: *     -- a type \"list of Int\"\n</code></pre>\n\n<p>Note the last two cases, where the quote disambiguates the syntax.</p>\n"}, {"tags": [], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "is_accepted": false, "score": 1, "last_activity_date": 1546584320, "creation_date": 1546584320, "answer_id": 54034192, "question_id": 54020335, "link": "https://stackoverflow.com/questions/54020335/what-is-and-in-haskell/54034192#54034192", "title": "What is &#39;[] and &#39;: in Haskell?", "body": "<p>The book</p>\n\n<p><strong><em>Thinking with Types</em></strong> by Sandy Maguire (<a href=\"http://thinkingwithtypes.com\" rel=\"nofollow noreferrer\">http://thinkingwithtypes.com</a>)</p>\n\n<p>could be a good resource on topic of type-level programming in Haskell in general.\nThe chapter \"Lifting Restrictions\" deals with <code>DataKinds</code> and promoted constructors.</p>\n\n<p>(Disclaimer: No affiliation.)</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "accepted_answer_id": 54020773, "answer_count": 2, "score": 6, "last_activity_date": 1580199144, "creation_date": 1546510899, "last_edit_date": 1580199144, "question_id": 54020335, "link": "https://stackoverflow.com/questions/54020335/what-is-and-in-haskell", "title": "What is &#39;[] and &#39;: in Haskell?", "body": "<p>I've seen this <code>'[]</code> and <code>':</code> syntax in a few places, most notably in heterogeneous lists packages like <a href=\"https://hackage.haskell.org/package/HList\" rel=\"nofollow noreferrer\">HList</a> or <a href=\"https://hackage.haskell.org/package/hvect-0.3.0.0/docs/Data-HVect.html\" rel=\"nofollow noreferrer\">HVect</a>.</p>\n\n<p>For example, the heterogeneous vector <code>HVect</code> is defined as</p>\n\n<pre><code>data HVect (ts :: [*]) where\n    HNil :: HVect '[]\n    (:&amp;:) :: !t -&gt; !(HVect ts) -&gt; HVect (t ': ts)\n</code></pre>\n\n<p>In GHCi, with extension <code>TemplateHaskell</code> or <code>DataKinds</code>, I get this</p>\n\n<pre><code>&gt; :t '[]\n'[] :: template-haskell-2.13.0.0:Language.Haskell.TH.Syntax.Name\n&gt; :t '(:)\n'(:) :: template-haskell-2.13.0.0:Language.Haskell.TH.Syntax.Name\n</code></pre>\n\n<p>I had the impression that this has to do with dependent types and kinds, etc., not with template haskell.</p>\n\n<p>The search engines, and <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a>, and <a href=\"https://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">hayoo</a>, handle queries with <code>'[]</code> or <code>':</code> rather badly, hence the question: <strong>What is the name of these <code>'[]</code> and <code>':</code> things?</strong> Pointers to documentation or tutorials would be most welcome.</p>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1546509924, "creation_date": 1546509924, "answer_id": 54020051, "question_id": 54019789, "link": "https://stackoverflow.com/questions/54019789/where-is-the-monoid-instance-on-comparison-defined/54020051#54020051", "title": "Where is the Monoid instance on Comparison defined?", "body": "<p>For <code>newtype</code>s, with <code>GeneralizedNewtypeDeriving</code> enabled, the instance is obtained using the instance of the underlying type.</p>\n\n<p>So, <code>mempty @ a -&gt; a -&gt; Ordering</code> is used (ditto for <code>mappend</code>), and then rewrapped as <code>mappend :: Comparison a</code>.</p>\n\n<p>Note that this ultimately involves the semigroup/monoid instances for function types <code>b -&gt; c</code> and the ones for <code>Ordering</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1546528342, "last_edit_date": 1546528342, "creation_date": 1546510065, "answer_id": 54020095, "question_id": 54019789, "link": "https://stackoverflow.com/questions/54019789/where-is-the-monoid-instance-on-comparison-defined/54020095#54020095", "title": "Where is the Monoid instance on Comparison defined?", "body": "<p>The <code>Comparison</code> type is just a <code>newtype</code> over <code>a -&gt; a -&gt; Ordering</code>.</p>\n\n<p><code>Ordering</code> is a <code>Semigroup</code> instance defined in, I think, <code>GHC.Base</code>.</p>\n\n<p>Another relevant instance of <code>Semigroup</code> is:</p>\n\n<pre><code>Semigroup b =&gt; Semigroup (a -&gt; b)\n</code></pre>\n\n<p>That is, any function type <code>a -&gt; b</code> has a <code>Semigroup</code> instance if <code>b</code> has a <code>Semigroup</code> instance.</p>\n\n<p>You can think of <code>a -&gt; a -&gt; Ordering</code> as <code>a -&gt; (a -&gt; Ordering)</code>, i.e. a function that takes <code>a</code> as input, and returns <code>(a -&gt; Ordering)</code> as output. Since <code>(a -&gt; Ordering)</code> is a <code>Semigroup</code> instance, then <code>a -&gt; (a -&gt; Ordering)</code> is, too.</p>\n\n<p>The same line of reasoning applies to <code>Monoid</code>.</p>\n\n<p>Finally, as chi wrote in <a href=\"https://stackoverflow.com/a/54020051/126014\">another answer</a>, <code>GeneralizedNewtypeDeriving</code> takes care of the rest.</p>\n"}], "owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 54020051, "answer_count": 2, "score": 3, "last_activity_date": 1546528342, "creation_date": 1546508944, "last_edit_date": 1546510142, "question_id": 54019789, "link": "https://stackoverflow.com/questions/54019789/where-is-the-monoid-instance-on-comparison-defined", "title": "Where is the Monoid instance on Comparison defined?", "body": "<p><code>newtype Comparison a</code> is defined in <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Functor.Contravariant.html#Comparison\" rel=\"nofollow noreferrer\"><code>Data.Functor.Contravariant</code></a>.</p>\n\n<p>In the version of this module defined in <a href=\"http://hackage.haskell.org/package/contravariant-1.5/docs/src/Data.Functor.Contravariant.html#Comparison\" rel=\"nofollow noreferrer\"><code>contravariant-1.5</code></a>, the <code>Monoid</code> instance on <code>Contravariant</code> is defined as follows:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>instance Monoid (Comparison a) where\n  mempty = Comparison (\\_ _ -&gt; EQ)\n  mappend (Comparison p) (Comparison q) = Comparison $ mappend p q\n</code></pre>\n\n<p><code>Data.Functor.Contravariant</code> is also defined in base (as of GHC 8.6.1, apparently). \nIn base, the <code>Monoid</code> instance on <code>Comparison</code> is defined <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Functor.Contravariant.html#Comparison\" rel=\"nofollow noreferrer\">as follows</a>:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>deriving instance Semigroup (Comparison a)\nderiving instance Monoid (Comparison a)\n</code></pre>\n\n<p>What enables the instance for <code>Monoid (Comparison a)</code> to be automatically derived in base?</p>\n\n<p>And where should I look to see the definitions of <code>mempty</code> and <code>mappend</code> for it?</p>\n"}, {"tags": ["haskell", "fold", "foldleft"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501378, "post_id": 54018129, "comment_id": 94872572, "body": "What is your queation?"}, {"owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501468, "post_id": 54018129, "comment_id": 94872601, "body": "@n.m. I&#39;ve made the question clearer"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1546501522, "post_id": 54018129, "comment_id": 94872621, "body": "Regardless of anything, you are using the list backwards. The natural way to implement a stack is to have the stack top at the head of the list, not at the end."}, {"owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501647, "post_id": 54018129, "comment_id": 94872673, "body": "@n.m. it feels more natural to me to implement the stack using ascending indices as opposed to constantly appending to head"}, {"owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501824, "post_id": 54018129, "comment_id": 94872741, "body": "@n.m. would the way I&#39;ve implemented it be incompatible with using foldl?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501862, "post_id": 54018129, "comment_id": 94872757, "body": "Fold takes a function that works with two things, and makes it into a function that works with a list of things. So if you want a function that works with a list of numbes, you start with a function that works with two numbers."}, {"owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546501989, "post_id": 54018129, "comment_id": 94872794, "body": "@n.m. this was my understanding too, but the task at hand insists I use the step function in the form i described above"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1546502176, "post_id": 54018129, "comment_id": 94872872, "body": "Your feeling is distorted by your lack of experience."}, {"owner": {"reputation": 305, "user_id": 10066169, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6hmLsdcSAMc/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oit-3hlyBT7a__eViHT2T7mIAoyw/mo/photo.jpg?sz=128", "display_name": "Denis Babochenko", "link": "https://stackoverflow.com/users/10066169/denis-babochenko"}, "edited": false, "score": 0, "creation_date": 1546502271, "post_id": 54018129, "comment_id": 94872901, "body": "You are trying to implement postfix notation, that way question becomes much simpler. Also your <code>step</code> function is essentially <code>foldr</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546502369, "post_id": 54018129, "comment_id": 94872936, "body": "Sorry you can use a fold of course, you are not folding a list of numbers but an RPN list pf strings. Sorry about the confusion. The point about the stack still remains. You are doing it backwards."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1546503185, "post_id": 54018129, "comment_id": 94873213, "body": "Stack operations map 1:1 to primitive list operations. <code>empty = []; top = head; push = (:); pop = tail</code>. All of those are O(1). <code>last</code>, <code>init</code> and <code>(++)</code> are not primitive operations, all of them are O(N)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546550583, "post_id": 54018129, "comment_id": 94896312, "body": "Reversing the list also lets you use pattern matching to define <code>x</code>, <code>y</code>, and <code>remaining</code> without the need for a <code>where</code> clause: <code>step (x:y:remaining) &quot;*&quot; = x*y : remaining</code>, etc."}], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "edited": false, "score": 0, "creation_date": 1546502825, "post_id": 54018375, "comment_id": 94873084, "body": "<code>last</code> is <code>O(n)</code> but <code>head</code> is <code>O(1)</code> same for <code>init</code>/<code>tail</code>"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "edited": false, "score": 0, "creation_date": 1546502915, "post_id": 54018375, "comment_id": 94873117, "body": "Also <code>init</code> required memory for new copy of the list, while <code>tail</code> is just return pointer to immutable structure."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 1, "last_activity_date": 1546502716, "last_edit_date": 1546502716, "creation_date": 1546502295, "answer_id": 54018375, "question_id": 54018129, "link": "https://stackoverflow.com/questions/54018129/haskell-function-composition-using-foldl/54018375#54018375", "title": "Haskell function composition using foldl", "body": "<pre><code>foldl step [] [\"10\",  \"4\", \"3\", \"+\", \"2\", \"*\", \"-\"]\n</code></pre>\n\n<p><code>[]</code> here is initial stack.</p>\n\n<p>If you rewrite your step in the following way it will work faster:</p>\n\n<pre><code>step :: [Int] -&gt; [Char] -&gt; [Int]\nstep stack str\n        | str == \"*\" =  (x*y):remaining \n        | str == \"+\" =  (x+y):remaining\n        | str == \"-\" =  (x-y):remaining\n        | str == \"/\" =  (x `div` y):remaining\n        | otherwise = (read str :: Int):stack\n        where x = head $ tail stack\n              y = head stack\n              remaining = tail $ tail stack\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 54018375, "answer_count": 1, "score": 0, "last_activity_date": 1546503198, "creation_date": 1546500943, "last_edit_date": 1546503198, "question_id": 54018129, "link": "https://stackoverflow.com/questions/54018129/haskell-function-composition-using-foldl", "title": "Haskell function composition using foldl", "body": "<p>I have defined the following function in haskell:</p>\n\n<pre><code>step :: [Int] -&gt; [Char] -&gt; [Int]\nstep stack str\n    | str == \"*\" =  remaining ++ [x*y] \n    | str == \"+\" =  remaining ++ [x+y]\n    | str == \"-\" =  remaining ++ [x-y]\n    | str == \"/\" =  remaining ++ [x `div` y]\n    | otherwise = stack ++ [read str :: Int] \n    where x = (last . init) stack\n          y = (last stack)\n          remaining = (init . init) stack\n</code></pre>\n\n<p>This functions takes and integer array <code>[10, 4, 3]</code> and a string operator <code>*</code> and applies the operator to the last two items in the array and returns the following array <code>[10, 7]</code>.</p>\n\n<p>This is makes up part of an intermediary function, the end result is a reverse polish notation evaluator function.</p>\n\n<p><strong>How can I utilise the <code>step</code> function I've defined and <code>foldl</code> to do the following</strong>:</p>\n\n<p>Take the examples string: <code>\"10 4 3 + 2 * -\"</code>.</p>\n\n<p>Add each element onto the string until the first operator is encountered as so:</p>\n\n<p><code>10, 4, 3</code> Then apply the operator to the two elements onto top the stack and place the result on the stack:</p>\n\n<p><code>10, 7</code>.</p>\n\n<p>Continue as so until the final answer is evaluated (<code>-4</code>)</p>\n\n<p><strong>Answer:</strong></p>\n\n<p>For the sake of completeness this was the function I arrived at with the help of @talex</p>\n\n<pre><code>rpn :: String -&gt; Int\nrpn input = head result\n    where arr = words input\n          result = foldl step [] arr\n</code></pre>\n"}, {"tags": ["haskell", "garbage-collection", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1546495945, "post_id": 54017037, "comment_id": 94870892, "body": "So an object header (for say a type like <code>data Foo = Foo {-# UNPACK #-} !Int String</code>) contains an offset indicating the number of non-pointer words?"}, {"owner": {"reputation": 141, "user_id": 8858744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce6af5055f7fcb64b18f6060237fc77?s=128&d=identicon&r=PG&f=1", "display_name": "zenhack", "link": "https://stackoverflow.com/users/8858744/zenhack"}, "reply_to_user": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1546498276, "post_id": 54017037, "comment_id": 94871526, "body": "The object header is really just a pointer to a struct with those call(actually called entry)/scavenge/evacuate functions, followed some implementation-specific data. The general-purpose implementation would contain lengths/offsets (though the pointer section is actually first), but for super common layouts you might just have the function pointers point to specialized versions that don&#39;t need to look up this info. See also section 7.1 in the paper I linked."}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1546499137, "post_id": 54017037, "comment_id": 94871782, "body": "But that section (and a majority of your answer) is about how functions are implemented, whereas my question was primarily about plain values (like <code>Foo</code>), not functions/closures. I thought there was be a difference in implementation between the two, as you wouldn&#39;t need functions for <code>entry</code>/<code>scavenge</code>/<code>evacuate</code> for a plain value like <code>Foo 1 &quot;Hi&quot;</code>."}, {"owner": {"reputation": 141, "user_id": 8858744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce6af5055f7fcb64b18f6060237fc77?s=128&d=identicon&r=PG&f=1", "display_name": "zenhack", "link": "https://stackoverflow.com/users/8858744/zenhack"}, "reply_to_user": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1546500183, "post_id": 54017037, "comment_id": 94872164, "body": "@theindigamer, it&#39;s actually the same, because of laziness; I made a few edits to try to make this more clear/explicit in my answer."}], "tags": [], "owner": {"reputation": 141, "user_id": 8858744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce6af5055f7fcb64b18f6060237fc77?s=128&d=identicon&r=PG&f=1", "display_name": "zenhack", "link": "https://stackoverflow.com/users/8858744/zenhack"}, "is_accepted": false, "score": 6, "last_activity_date": 1546500150, "last_edit_date": 1546500150, "creation_date": 1546495083, "answer_id": 54017037, "question_id": 54016849, "link": "https://stackoverflow.com/questions/54016849/how-does-the-haskell-runtime-distinguish-between-pointers-and-unboxed-word-sized/54017037#54017037", "title": "How does the Haskell runtime distinguish between pointers and unboxed word-sized values?", "body": "<p>The short version is: values are allocated with all of the pointers and all of the non-pointers grouped together, and include a bit of metadata so that the GC knows what to follow.</p>\n\n<p>Note that the Haskell report actually allows <code>Int</code> to be 31 or 63 bits, making the OCaml strategy valid -- but it's not what GHC does.</p>\n\n<p>The slightly longer version is that said \"metadata\" is really a couple of functions that are used by the garbage collector. To give a rough sketch you could think of values in Haskell as being represented at runtime as an OO-style object with methods:</p>\n\n<pre><code>class Fn:\n    # By far the most used; this evaluates the value:\n    enter(...) -&gt; ...\n    # Used by the garbage collector:\n    scavenge(...) -&gt; ...\n    evacuate(...) -&gt; ...\n</code></pre>\n\n<p>The upshot of this is that values know enough about themselves to do the bookkeeping, and for some common layouts GHC defines specialized versions of these functions; the garbage collector can be mostly oblivious to exactly how scavenge and evacuate work. The segregating of pointers &amp; non-pointers is so that a generic implementation can be made and shared for the common case.</p>\n\n<p>Note that the 'enter' function exists even for Haskell values that are not \"functions,\" since laziness means that even if the type is e.g. Int, evaluation may still involve computation.</p>\n\n<p>If you want the very long version, I suggest reading:</p>\n\n<p><a href=\"https://www.microsoft.com/en-us/research/publication/implementing-lazy-functional-languages-on-stock-hardware-the-spineless-tagless-g-machine/\" rel=\"nofollow noreferrer\">https://www.microsoft.com/en-us/research/publication/implementing-lazy-functional-languages-on-stock-hardware-the-spineless-tagless-g-machine/</a></p>\n\n<p>which goes into quite a lot of detail on how Haskell gets mapped to hardware. It's a fascinating read, and there's a lot of neat stuff in there that differs substantially from how most (strict) functional languages are implemented. The paper is old, but still relevant.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1546514798, "creation_date": 1546514798, "answer_id": 54021394, "question_id": 54016849, "link": "https://stackoverflow.com/questions/54016849/how-does-the-haskell-runtime-distinguish-between-pointers-and-unboxed-word-sized/54021394#54021394", "title": "How does the Haskell runtime distinguish between pointers and unboxed word-sized values?", "body": "<p>Essentially, this is described in the GHC <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/HeapObjects#TypesofPayloadLayout\" rel=\"nofollow noreferrer\">RTS documentation</a>, when it details the format of the heap objects, comprising a header and a payload.</p>\n\n<p>The header describes which words of the payload are pointers, so that garbage collection can work.</p>\n\n<p>This means that there is, roughly, an overhead of a word for any heap object.</p>\n"}], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 54021394, "answer_count": 2, "score": 4, "last_activity_date": 1546514798, "creation_date": 1546493770, "question_id": 54016849, "link": "https://stackoverflow.com/questions/54016849/how-does-the-haskell-runtime-distinguish-between-pointers-and-unboxed-word-sized", "title": "How does the Haskell runtime distinguish between pointers and unboxed word-sized values?", "body": "<p>On a 64-bit platform, OCaml's <code>int</code> type is 63-bits due to pointer tagging. This allows ints to be unboxed and still be distinguishable from pointers at runtime, allowing for a precise GC. IIRC, the GC in the GHC RTS is precise too, but GHC's Ints are 64-bit and they can be unboxed. If that's the case, then how the runtime system distinguish between Ints and pointers? It seems the same problem would arise with distinguishing between other unboxed word-sized values and pointers too.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1546493773, "post_id": 54016841, "comment_id": 94870308, "body": "<a href=\"https://www.stackage.org/haddock/lts-12.8/bytestring-0.10.8.2/Data-ByteString.html#v:readFile\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-12.8/bytestring-0.10.8.2/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 1, "creation_date": 1546494550, "post_id": 54016919, "comment_id": 94870513, "body": "It read <code>ByteString</code> which is in fact array of <code>Word8</code> which is smart way to name byte."}, {"owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 0, "creation_date": 1546494836, "post_id": 54016919, "comment_id": 94870593, "body": "So you mean I don&#39;t need to import <code>ByteString</code> to read <code>Word8</code> which like <code>Byte</code> in Java ?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 0, "creation_date": 1546495079, "post_id": 54016919, "comment_id": 94870650, "body": "Easiest way to check that is to try, but yes, you don&#39;t need to import it."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1546496402, "post_id": 54016919, "comment_id": 94870997, "body": "@talex the readFile in prelude reads into a <code>String</code>. It appears the question asker wants to read into bytes rather then characters. I think <code>ByteString</code> is the correct thing for that."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1546496595, "post_id": 54016919, "comment_id": 94871039, "body": "@Potato44 then proper (<code>Data.ByteString</code>) function should be imported."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 2, "last_activity_date": 1546496710, "last_edit_date": 1546496710, "creation_date": 1546494254, "answer_id": 54016919, "question_id": 54016841, "link": "https://stackoverflow.com/questions/54016841/how-to-read-byte-array-from-file-in-haskell/54016919#54016919", "title": "How to read byte array from file in Haskell?", "body": "<p>Use <code>readFile</code></p>\n\n<pre><code>import Data.ByteString(readFile)\n\nmain = do \n    content &lt;-  Data.ByteString.readFile \"path/to/file\"\n    print content\n</code></pre>\n\n<p>It read the file and print it content on screen.</p>\n"}], "owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 54016919, "answer_count": 1, "score": 2, "last_activity_date": 1546496710, "creation_date": 1546493667, "question_id": 54016841, "link": "https://stackoverflow.com/questions/54016841/how-to-read-byte-array-from-file-in-haskell", "title": "How to read byte array from file in Haskell?", "body": "<p>When I want read bytes from a file in Java, I can do like this:</p>\n\n<pre><code>InputStream is = new FileInputStream(...);\nwhile((int b = is.read()) != -1){\n    //...analysis the bytes.\n}\n</code></pre>\n\n<p>And how do it in Haskell? I don't see any function witch can read bytes module System.IO and Data.ByteString.</p>\n"}, {"tags": ["haskell", "recursion", "math", "gadt", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1566963921, "post_id": 54018233, "comment_id": 101815190, "body": "Sorry for the mix-up. The <code>&lt;&gt;</code> above is in common notion."}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 1, "last_activity_date": 1566963887, "last_edit_date": 1566963887, "creation_date": 1546501532, "answer_id": 54018233, "question_id": 54016517, "link": "https://stackoverflow.com/questions/54016517/recursion-through-nat-kinds/54018233#54018233", "title": "Recursion through Nat-kinds", "body": "<p>A slight change of <code>go</code> and <code>f</code> solved the problem:</p>\n\n<pre><code>instance KnownNat n =&gt; Semigroup (Symmetric n) where\n    x &lt;&gt; y = go y [] n where\n        n = toInteger (natVal (Proxy :: Proxy n))\n        go :: forall m. Symmetric m -&gt; [(Integer,Integer)] -&gt; Integer -&gt; Symmetric m\n        go S1 _ _ = S1\n        go (_ :. xs) j m = let\n            i = sIndex y (sIndex x (n-m))\n            ix = foldr f i j\n            in Cyclic ix :. go xs ((ix,m) :j) (m-1)\n        f (j,m) i = let\n            ix = (i - j) `mod` m - 1\n            in if 0 &lt;= ix then ix else ix + m\n</code></pre>\n\n<p>The key idea is to introduce a dummy parameter. Also note that <code>Cyclic</code> was used instead of <code>cyclic</code>.</p>\n\n<p>Unfortunately, it turns out that I did some math wrong. It is to be corrected.</p>\n\n<p><strong>EDIT:</strong> Here is the corrected <code>sIndex</code>, which completes the instance:</p>\n\n<pre><code>sIndex :: forall n. KnownNat n =&gt; Symmetric n -&gt; Integer -&gt; Integer\nsIndex xs m = let\n    n = toInteger (natVal (Proxy :: Proxy n))\n    in sIndex_ xs (m `mod` n) n\n  where\n    sIndex_ :: Symmetric m -&gt; Integer -&gt; Integer -&gt; Integer\n    sIndex_ S1 _ _ = 0\n    sIndex_ (x :. _) 0 _ = cIndex x\n    sIndex_ (x :. xs) m n = let\n        i = cIndex x + sIndex_ xs (m-1) (n-1) + 1\n        in if n &lt;= i then i - n else i\n</code></pre>\n"}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 54018233, "answer_count": 1, "score": 1, "last_activity_date": 1566963887, "creation_date": 1546491049, "last_edit_date": 1546501406, "question_id": 54016517, "link": "https://stackoverflow.com/questions/54016517/recursion-through-nat-kinds", "title": "Recursion through Nat-kinds", "body": "<p>This question is a sequel to the following question. Refer to it first:\n<a href=\"https://stackoverflow.com/q/54000646/4540658\">Overlapping instances via Nat-kind</a></p>\n\n<p>Now it's time to make the instance of <code>Group Symmetric</code>. After some savage math, I've come up to an instance that works in principle, but actually doesn't:</p>\n\n<pre><code>sIndex :: forall n. KnownNat n =&gt; Symmetric n -&gt; Integer -&gt; Integer\nsIndex xs m = sIndex_ xs (m `mod` n)\n  where\n    n = toInteger (natVal (Proxy :: Proxy n))\n    sIndex_ :: Symmetric m -&gt; Integer -&gt; Integer\n    sIndex_ S1 _ = 0\n    sIndex_ (x :. _) 0 = cIndex x\n    sIndex_ (x :. xs) m = let\n        i = cIndex x + sIndex_ xs (m-1)\n        in if i &lt; n then i else i - n\n\ninstance KnownNat n =&gt; Semigroup (Symmetric n) where\n    x &lt;&gt; y = go [] n where\n        n = toInteger (natVal (Proxy :: Proxy n))\n        go :: forall m. [(Integer,Integer)] -&gt; Integer -&gt; Symmetric m\n        go j m\n            | 0 == m = S1\n            | otherwise = let\n                i = sIndex y (sIndex x (n-m))\n                ix = foldr f i j\n                in cyclic ix :. go ((ix,m) :j) (m-1)\n        f (j,m) i = (i - j) `mod` m - 1\n</code></pre>\n\n<p>The <code>go</code> function inside the <code>Semigroup</code> instance should build the result by having recursion though <code>Symmetric n</code>, <code>Symmetric (n-1)</code>, and so on until <code>Symmetric 1</code>. But GHC doesn't know how to do it and outputs the following error message:</p>\n\n<pre><code>Group_Symmetric.hs:89:24: error:\n    \u2022 Couldn't match type \u2018m\u2019 with \u20181\u2019\n      \u2018m\u2019 is a rigid type variable bound by\n        the type signature for:\n          go :: forall (m :: Nat).\n                [(Integer, Integer)] -&gt; Integer -&gt; Symmetric m\n        at Group_Symmetric.hs:87:9-69\n      Expected type: Symmetric m\n        Actual type: Symmetric 1\n</code></pre>\n\n<p>So what would the workaround be? Is it possible for <code>go</code> to be able to return any instantation of <code>Symmetric m</code> (<code>m</code> from 1 to <code>n</code>)?</p>\n"}, {"tags": ["haskell", "functional-programming", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "edited": false, "score": 0, "creation_date": 1546488099, "post_id": 54016112, "comment_id": 94869113, "body": "Awesome! It seems that <code>(e, a)</code> can be seen as the computation of <code>a</code> in the context of <code>e</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546506118, "post_id": 54016112, "comment_id": 94874294, "body": "This is called the &quot;writer monad&quot;, in case you want to look up more about this. (Strictly speaking I should point out it&#39;s only a monad if <code>e</code> is an instance of the <code>Monoid</code> class.) It&#39;s one of the standard Haskell monad instances, so you can find lots of information about it, eg <a href=\"https://wiki.haskell.org/All_About_Monads#The_Writer_monad\" rel=\"nofollow noreferrer\">wiki.haskell.org/All_About_Monads#The_Writer_monad</a> and <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Writer-Lazy.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mtl-2.2.2/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1546488221, "last_edit_date": 1546488221, "creation_date": 1546487376, "answer_id": 54016112, "question_id": 54016061, "link": "https://stackoverflow.com/questions/54016061/what-does-e-mean-in-haskell/54016112#54016112", "title": "What does `((,) e` mean in Haskell?", "body": "<p><code>((,) e)</code> is not a typeclass; it's just a type. And indeed, it <em>is</em> a sectioned tuple. The idea here is that you can think of <code>(e, a)</code> as a \"container\" holding a value of type <code>a</code> and an \"annotation\" of type <code>e</code>. The <code>fmap</code> for <code>((,) e)</code> modifies the <em>values</em>, but not the <em>annotations</em>. In the \"functor as container\" analogy, the annotation is part of the <em>container</em>, rather than part of its <em>contents</em>.</p>\n\n<p>Let's consider a sort of tree:</p>\n\n<pre><code>data Tree f a\n  = Leaf\n  | Node (Tree f a) (f a) (Tree f a)\n\ninstance Functor f =&gt; Functor (Tree f) where\n  fmap _ Leaf = Leaf\n  fmap f (Node l fa r) = Node (fmap f l) (fmap f fa) (fmap f r)\n</code></pre>\n\n<p>What do these look like? <code>Tree Identity a</code> is a plain binary tree of elements of type <code>a</code>. It could represent, e.g., a set of values. <code>Tree ((,) k) a</code>, on the other hand, is a binary tree of <em>pairs</em>. It could represent a map from keys of type <code>k</code> to values of type <code>a</code>. Mapping over the tree with <code>fmap</code> will modify the values, but leave the keys alone.</p>\n"}], "owner": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 54016112, "answer_count": 1, "score": 4, "last_activity_date": 1546488221, "creation_date": 1546486910, "question_id": 54016061, "link": "https://stackoverflow.com/questions/54016061/what-does-e-mean-in-haskell", "title": "What does `((,) e` mean in Haskell?", "body": "<p>I'm reading the <a href=\"https://wiki.haskell.org/Typeclassopedia#Functor\" rel=\"nofollow noreferrer\">typeclassopedia</a> on Haskell wiki. When I came across the typeclass <code>((,) e)</code> which is an instance of functor, I was quite confused. According to the author</p>\n\n<blockquote>\n  <p><code>((,) e)</code> represents a container which holds an \u201cannotation\u201d of type e along with the actual value it holds.</p>\n</blockquote>\n\n<p>However, I can't quite understand the meaning of this sentence since I can only see a sectioned tuple here. I also searched this typeclass on Hoogle but found nothing.</p>\n"}]