[{"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470868059, "post_id": 38884259, "comment_id": 65129856, "body": "Can you tell me what the type of <code>userForm</code> is?"}, {"owner": {"reputation": 986, "user_id": 6700717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da8a4ff1780a7ea82e53a910913f746?s=128&d=identicon&r=PG&f=1", "display_name": "Takao", "link": "https://stackoverflow.com/users/6700717/takao"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470869391, "post_id": 38884259, "comment_id": 65130232, "body": "It is <code>Maybe User -&gt; Html -&gt; MForm Handler (FormResult User, Widget)</code>. First argument is an user instance I use to fill in already stored data, second is <code>extra</code> value. I&#39;ve edit the post example a little."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1470870645, "creation_date": 1470870645, "answer_id": 38884962, "question_id": 38884259, "link": "https://stackoverflow.com/questions/38884259/creation-of-monadic-yesod-form-without-hamlet/38884962#38884962", "title": "Creation of monadic yesod form without hamlet", "body": "<p>Use <code>lift</code> with <code>widgetToPageContent</code>:</p>\n\n<pre><code>userForm :: Maybe MyUser -&gt; Html -&gt; MForm Handler (FormResult MyUser, Widget)\nuserForm u extra = do\n  (nameR, nameV) &lt;- mreq textField \"\" (myUserName &lt;$&gt; u)\n  (passR, passV) &lt;- mreq passwordField \"\" Nothing\n  nameContents &lt;- lift $ widgetToPageContent (fvInput nameV)\n  passContents &lt;- lift $ widgetToPageContent (fvInput passV)\n  let userRes = MyUser &lt;$&gt; nameR &lt;*&gt; passR\n  let widget = do\n        toWidget $ \\render -&gt; do\n          extra\n          pageBody nameContents render\n          pageBody passContents render\n          H.input H.! A.type_ \"submit\" H.! A.value \"Submit\"\n  return (userRes, widget)\n</code></pre>\n"}], "owner": {"reputation": 986, "user_id": 6700717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da8a4ff1780a7ea82e53a910913f746?s=128&d=identicon&r=PG&f=1", "display_name": "Takao", "link": "https://stackoverflow.com/users/6700717/takao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 38884962, "answer_count": 1, "score": 1, "last_activity_date": 1470870645, "creation_date": 1470866327, "last_edit_date": 1470869457, "question_id": 38884259, "link": "https://stackoverflow.com/questions/38884259/creation-of-monadic-yesod-form-without-hamlet", "title": "Creation of monadic yesod form without hamlet", "body": "<p>My goal is to write a monadic yesod form without usage of hamlet.</p>\n\n<p>Let's say I have such example form:</p>\n\n<pre><code>userForm :: Maybe User -&gt; Html -&gt; MForm Handler (FormResult User, Widget)\nuserForm u extra = do\n  (nameR, nameV) &lt;- mreq textField \"\" (userName &lt;$&gt; u)\n  (passR, passV) &lt;- mreq passwordField \"\" Nothing\n  let userRes = User &lt;$&gt; nameR &lt;*&gt; passR\n  let widget = do\n    toWidget $ \\render -&gt; do\n      extra\n      -- fvInput nameV?\n      -- fvInput passV?\n      H.input ! type_ \"submit\" ! value \"Submit\"\n  return (userRes, widget)\n</code></pre>\n\n<p>In the case of hamlet usage it will be like that:</p>\n\n<pre><code>let widget = do\n  toWidget [whamlet|\n            ^{fvInput nameV}\n            ^{fvInput passV}\n           |]\n</code></pre>\n\n<p>But the return type of fvInput is <code>FieldView App</code> and I need to convert it to Html to compose with blaze well.</p>\n\n<p>Perhaps, it will be easier to use Input Form for this task(i.e. implementing forms without w/hamlet), but the docs on yesodbook say it doesn't have a proper handling of the wrong input case. I tend to use monadic form here since I want a recreation of user input in the case of failed validation \"for free\" here. Will it work this way?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1470893630, "post_id": 38883268, "comment_id": 65136370, "body": "Well you obviously <i>did</i> find a way to implement it, as you linked to one. All you have to do now is convert that into some template/widget code, which should be almost one-to-one and which is well documented in the book. So... what is missing? Is there a specific point where you are struggling?"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1470914995, "post_id": 38883268, "comment_id": 65149239, "body": "I&#39;m looking for the <i>logic</i> that&#39;s missing, like giving an <code>active</code> class for the active menu item, or different items per user. I was expecting something like <code>YesodBreadcrumbs</code> but for menus"}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1470937459, "post_id": 38901009, "comment_id": 65164409, "body": "thanks, I&#39;ve indeed gone over the cookbook, didn&#39;t find anything there. I&#39;m also writing a lot of decoupled sites, but I&#39;m looking at the &quot;base&quot; functionality of yesod, to see what we have out of the box.  So regarding my task, do you know what would be the right way to get the current handler/ route?"}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "reply_to_user": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1470942482, "post_id": 38901009, "comment_id": 65167230, "body": "@amitaibu Simple: if your handler is running, then it&#39;s the current one. But please ask new questions as separate questions so they are easier to find."}], "tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 1, "last_activity_date": 1470930673, "creation_date": 1470930673, "answer_id": 38901009, "question_id": 38883268, "link": "https://stackoverflow.com/questions/38883268/navigation-menu-in-yesod/38901009#38901009", "title": "Navigation menu in Yesod", "body": "<p>The problem description sounds like something I would mostly handle on the client-side with js and possibly ajax or even with form elements + clever css.</p>\n\n<p>I assume most sites that are built with Yesod these days don't have more than maybe a half dozen navigation entries so a separate subsystem just for menues wasn't something many people needed. But maybe I overlooked something, so <a href=\"https://github.com/yesodweb/yesod-cookbook/tree/master/cookbook\" rel=\"nofollow\">take</a> a <a href=\"https://hackage.haskell.org/packages/#cat:Yesod\" rel=\"nofollow\">look</a> yourself.</p>\n\n<p>That being said, it should be relatively simple to develop your own subsystem if you really need it. After all, all you need is for some little piece of hamlet to change based on an enum or something.</p>\n"}, {"tags": [], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "is_accepted": false, "score": 0, "last_activity_date": 1471804380, "creation_date": 1471804380, "answer_id": 39067581, "question_id": 38883268, "link": "https://stackoverflow.com/questions/38883268/navigation-menu-in-yesod/39067581#39067581", "title": "Navigation menu in Yesod", "body": "<p>Here is a simplified example of what I've ended up with:</p>\n\n<pre><code>-- Foundation.hs\n\ndata MenuItem = MenuItem\n  { _menuItemLabel :: Text\n  , _menuItemRoute :: Route App\n  , _menuItemAccessCallback :: Bool\n  } deriving (Show)\n\ninstance Yesod App where\n  -- ...\n\n  defaultLayout widget = do\n      -- ...\n      muser &lt;- maybeAuthPair\n      mcurr &lt;- getCurrentRoute\n\n      -- All the menu items.\n     let menuItems =\n          [ MenuItem\n            { _menuItemLabel = \"Home\"\n            , _menuItemRoute = HomeR\n            -- Always show menu item.\n            , _menuItemAccessCallback = True\n            }\n          , MenuItem\n            { _menuItemLabel = \"People\"\n            , _menuItemRoute = PeopleR\n            -- Example for item that shows only if user is authenticated.\n            , _menuItemAccessCallback = isJust muser\n            }\n          ]\n\n      -- Filter items to show only accessible items\n      let filteredMenuItems = [x | x &lt;- menuItems, _menuItemAccessCallback x == True]\n</code></pre>\n\n<p>And inside the default template file:</p>\n\n<pre><code>-- default-layout.hamlet\n&lt;nav&gt;\n  $forall MenuItem label route _ &lt;- filteredMenuItems\n    &lt;a class=\"item\" :Just route == mcurr:.active href=\"@{route}\"&gt;#{label}\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1471804404, "creation_date": 1470862160, "last_edit_date": 1471804404, "question_id": 38883268, "link": "https://stackoverflow.com/questions/38883268/navigation-menu-in-yesod", "title": "Navigation menu in Yesod", "body": "<p>I'm looking at implementing a menu (something like <a href=\"http://semantic-ui.com/collections/menu.html\" rel=\"nofollow\">this</a>). What is the right way to do it? I didn't find any examples in Yesod itself, nor other libraries that do it.</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 6, "last_activity_date": 1470861489, "creation_date": 1470861489, "answer_id": 38883102, "question_id": 38882950, "link": "https://stackoverflow.com/questions/38882950/applicative-instance-for-hypercuboid/38883102#38883102", "title": "Applicative instance for hypercuboid", "body": "<p>You can define separate instances for <code>Hyper '[]</code> and <code>Hyper (f ': fs)</code> (which is a sort of \"type-level case\".)</p>\n\n<p>You can't define a single instance <code>Applicative (Hyper fs)</code> that behaves how you want because it would violate parametricity. Certainly I can define <code>isScalar :: Hyper fs -&gt; Bool</code> in the obvious way; then what is <code>isScalar (pure ())</code>?</p>\n\n<p>(Here, you wouldn't be able to define a single instance <code>Applicative (Hyper fs)</code> anyways for the reason that you will need a constraint on <code>f</code> in the <code>Hyper (f ': fs)</code> case.)</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1470914638, "last_edit_date": 1470914638, "creation_date": 1470911193, "answer_id": 38893733, "question_id": 38882950, "link": "https://stackoverflow.com/questions/38882950/applicative-instance-for-hypercuboid/38893733#38893733", "title": "Applicative instance for hypercuboid", "body": "<p>You can't do type level case, but you can do value-level case that reifies type-level information. Normally you define a singleton like this:</p>\n\n<pre><code>data Shapely (fs :: [* -&gt; *]) where\n    ShZ :: Shapely '[]\n    ShS :: (Dim f) =&gt; Shapely fs -&gt; Shapely (f ': fs)\n</code></pre>\n\n<p>and a type class like this:</p>\n\n<pre><code>class SShapely (fs :: [* -&gt; *]) where\n    shapely :: Shapely fs\n\ninstance SShapely '[] where\n    shapely = ShZ\n\ninstance (Dim f, SShapely fs) =&gt; SShapely (f ': fs) where\n    shapely = ShS shapely\n</code></pre>\n\n<p>This way the type class actually provide value-level information which allows to perform pattern matching like you want. I.e. you can now define something like</p>\n\n<pre><code>pureSh :: Shapely fs -&gt; a -&gt; Hyper fs a\npureSh  ShZ    x = Scalar x\npureSh (ShS s) x = Prism (pureSh s (pure x))\n\ninstance SShapely fs =&gt; Applicative (Hyper fs) where\n    pure = pureSh shapely\n</code></pre>\n\n<p>The <code>ShZ</code> pattern match reveals that <code>fs ~ '[]</code>, so <code>fs</code> gets rewritten to <code>'[]</code> at the type level and <code>Scalar x</code> now is accepted. In the <code>ShS</code> case things work similarly.</p>\n\n<p>However this doesn't really type check, because <code>Prism</code> also has the <code>SShapely fs</code> constraint which cannot be deduced from just <code>Shapely fs</code> (well, it can, but <a href=\"http://ideone.com/zKhDK8\" rel=\"nofollow\">not in a very nice way</a>), so here is an improved encoding:</p>\n\n<pre><code>data Shapely (fs :: [* -&gt; *]) where\n    ShZ :: Shapely '[]\n    ShS :: (Dim f, SShapely fs) =&gt; Shapely (f ': fs)\n\nclass SShapely (fs :: [* -&gt; *]) where\n    shapely :: Shapely fs\n\ninstance SShapely '[] where\n    shapely = ShZ\n\ninstance (Dim f, SShapely fs) =&gt; SShapely (f ': fs) where\n    shapely = ShS\n\npureSh :: Shapely fs -&gt; a -&gt; Hyper fs a\npureSh ShZ x = Scalar x\npureSh ShS x = Prism (pureSh shapely (pure x))\n\ninstance SShapely fs =&gt; Applicative (Hyper fs) where\n    pure = pureSh shapely\n</code></pre>\n\n<p><code>ShS</code> in <code>Shapely</code> now doesn't receive a first-order <code>Shapely fs</code>, but has the <code>SShapely fs</code> constraint instead, from which a <code>Shapely fs</code> can always be recovered. Now the types match properly.</p>\n\n<p><a href=\"http://ideone.com/iWcfLJ\" rel=\"nofollow\">The code</a>.</p>\n"}], "owner": {"reputation": 2139, "user_id": 465100, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/debe4d3217980e495cf1f15e7e4b4c9f?s=128&d=identicon&r=PG", "display_name": "Artem Pelenitsyn", "link": "https://stackoverflow.com/users/465100/artem-pelenitsyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "accepted_answer_id": 38883102, "answer_count": 2, "score": 4, "last_activity_date": 1470914638, "creation_date": 1470860899, "question_id": 38882950, "link": "https://stackoverflow.com/questions/38882950/applicative-instance-for-hypercuboid", "title": "Applicative instance for hypercuboid", "body": "<p>I'm working through <a href=\"http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/apl-extabs.pdf\" rel=\"nofollow\">extended abstract by Prof. J.Gibbons</a> on APL-like programming in Haskell. I stuck with defining <code>Applicative</code> instance for hypercuboid datatype, though the paper states that it is perfectly doable. Simplified example is <a href=\"https://ideone.com/9JnzJD\" rel=\"nofollow\">as follows</a>.</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, GADTs, TypeFamilies, TypeOperators, MultiParamTypeClasses, DataKinds #-}\n\nimport Control.Applicative\nimport Data.Traversable (Traversable)\n\nclass (Applicative f, Traversable f) =&gt; Dim f\n\nclass Shapely (fs :: [* -&gt; *])\ninstance Shapely '[]\ninstance (Dim f, Shapely fs) =&gt; Shapely (f ': fs)\n\n-------------------------------------\n--            Hypercuboid datatype\n-------------------------------------\ndata Hyper :: [* -&gt; *] -&gt; * -&gt; * where\n    Scalar :: a -&gt; Hyper '[] a\n    Prism  :: (Dim f, Shapely fs) =&gt; \n                Hyper fs (f a) -&gt; Hyper (f ': fs) a\n\ninstance Functor (Hyper fs) where\n    fmap f (Scalar a) = Scalar $ f a\n    fmap f (Prism p)  = Prism $ fmap (fmap f) p\n\ninstance Applicative (Hyper fs) where\n    pure a = undefined \n{- `pure a = Scalar a` gives:\n            Couldn't match type \u2018fs\u2019 with \u2018'[]\u2019\n                  \u2018fs\u2019 is a rigid type variable bound by\n                       the instance declaration\n            Expected type: Hyper fs a\n              Actual type: Hyper '[] a\n-}\n</code></pre>\n\n<p>Recalling what is known about <code>Applicative</code> instance for <code>Vector n a</code> type (e.g. a list type-indexed by its length) I tried to think about <code>pure</code> as <code>replicate</code> (n-ary replication of a given value). But seems like this requires typelevel case (e.g. <code>pure a = case fs of '[] -&gt; Scalar a; (f ': gs) -&gt; &lt;something using the fact that Applicative f&gt;</code>) which is not avalilable in Haskell as far as I know.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1470863055, "post_id": 38882322, "comment_id": 65127909, "body": "I think the answer to &quot;How can I do it?&quot; very much depends on what <code>T</code> is and what you are expecting to happen."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1470863206, "post_id": 38882452, "comment_id": 65127982, "body": "I think your claim (&quot;you need to define a lifting operation&quot;) is much too strong. Indeed, few monads have a sensible way to be &quot;lifted&quot; into <code>IO</code>. My guess is that the answer to the question is going to involve one of the <code>run*</code> family of functions -- but it&#39;s almost impossible to know until jonaprieto says a bit more about what he wants to do."}], "tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": false, "score": 2, "last_activity_date": 1470911340, "last_edit_date": 1470911340, "creation_date": 1470859099, "answer_id": 38882452, "question_id": 38882322, "link": "https://stackoverflow.com/questions/38882322/using-in-io-monad-a-function-from-other-monad/38882452#38882452", "title": "Using in IO monad, a function from other monad", "body": "<p>In <code>do</code> notation, when you do </p>\n\n<pre><code>x = do\n  y &lt;- z\n  ....\n</code></pre>\n\n<p>Then if <code>x :: (Monad m) =&gt; m a</code>, then <code>z :: (Monad m) =&gt; m b</code> were <code>m</code> is the same monad.</p>\n\n<p>That is pretty logical after all : imagine if your <code>T</code> monad was list, what should your <code>seeF1</code> return? Or if your <code>T</code> monad was <code>Maybe</code>, <code>seeF1</code> wouldn't be able to print anything in case it encountered a <code>Nothing</code> since the result would be undefined.</p>\n\n<p>Therefore in general, what you are asking for is not possible. But if you are a bit more specific about your <code>T</code>, then you might find a way to get an <code>IO a</code> from your <code>T a</code>. For instance if you look at the monads defined in <a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow\">transformers</a>, many have a <code>run</code> function that transform them, and from which you can get an <code>IO</code>.</p>\n"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470911340, "creation_date": 1470858661, "question_id": 38882322, "link": "https://stackoverflow.com/questions/38882322/using-in-io-monad-a-function-from-other-monad", "title": "Using in IO monad, a function from other monad", "body": "<p>If I have a function like, in a monad T, <code>f1 :: T String</code>, and I want to use its outcome, print it, for example.</p>\n\n<pre><code>seeF1 :: IO String\nseeF1 = do\n  res &lt;- f1\n  print res\n</code></pre>\n\n<p>Why is it wrong?. It seems that I can't use f1 because it is not in the monad IO. So, How can I do it? lifting?</p>\n"}, {"tags": ["performance", "sorting", "haskell", "matrix"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1470866962, "post_id": 38881870, "comment_id": 65129513, "body": "It might just be the boxing. Try it in C++ as an array of pointers to individually allocated rows rather than a multidimensional array (I&#39;m assuming here) and compare. I don&#39;t think multidimensional vectors are supported, so if this is what&#39;s going on you&#39;ll have to do a little abstraction work to represent matrices as vectors of size n*m."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1470868261, "post_id": 38881870, "comment_id": 65129916, "body": "Building on @luqui, C++ multidimensional arrays are still one contiguous block in memory while here you have a vector of references to unboxed vectors. I expect you&#39;d get considerably better performance if you used <a href=\"https://hackage.haskell.org/package/array\" rel=\"nofollow noreferrer\"><code>array</code></a> or <a href=\"https://hackage.haskell.org/package/repa\" rel=\"nofollow noreferrer\"><code>repa</code></a>."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 1, "creation_date": 1470902179, "post_id": 38881870, "comment_id": 65140898, "body": "I am comparing against std::vector&lt;std::vector&lt;int&gt; &gt; in C++, so the same as Vector  (Vector Int) in Haskell, ie a vector of pointers to vectors. I thought of packing my matrix as a Vector Int of size n*m, but then I have no sort that can swap blocks of Ints at once. And even if I had that block swap, I guess it would be less efficient than sorting pointers to vectors (too many writes in memory)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470956238, "post_id": 38881870, "comment_id": 65173158, "body": "The Haskell still has one extra indirection to the unboxed vectors. Edward Kmett&#39;s gotten good results by using <code>unsafeCoerce#</code> (note the <code>#</code>) to stick the pointers in directly, rather than putting in wrappers around the pointers."}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 2, "last_activity_date": 1473685981, "last_edit_date": 1473685981, "creation_date": 1470951194, "answer_id": 38906491, "question_id": 38881870, "link": "https://stackoverflow.com/questions/38881870/haskell-matrix-sorting-much-slower-than-vector-sorting/38906491#38906491", "title": "Haskell : matrix sorting much slower than vector sorting", "body": "<p>Following dfeuer's advice, implementing a vector of vectors as an <code>ArrayArray#</code> is 4 times faster than Vector (Unboxed.Vector Int) and only 40% slower than sorting a c++ <code>std::vector&lt;std::vector&lt;int&gt; &gt;</code> :</p>\n\n<pre><code>import Control.Monad.Primitive\nimport Data.Primitive.ByteArray\nimport qualified Data.Vector.Generic.Mutable.Base as GM(MVector(..))\nimport GHC.Prim\n\ndata MutableArrayArray s a = MutableArrayArray (MutableArrayArray# s)\n\ninstance GM.MVector MutableArrayArray ByteArray where\n  {-# INLINE basicLength #-}\n  basicLength (MutableArrayArray marr) = I# (sizeofMutableArrayArray# marr)\n\n  {-# INLINE basicUnsafeRead #-}\n  basicUnsafeRead (MutableArrayArray marr) (I# i) = primitive $ \\s -&gt; case readByteArrayArray# marr i s of\n    (# s1, bar #) -&gt; (# s1, ByteArray bar #)\n\n  {-# INLINE basicUnsafeWrite #-}\n  basicUnsafeWrite (MutableArrayArray marr) (I# i) (ByteArray bar) = primitive $ \\s -&gt;\n    (# writeByteArrayArray# marr i bar s, () #)\n</code></pre>\n\n<p>For example, sorting a matrix of integers will then use</p>\n\n<pre><code>sortIntArrays :: ByteArray -&gt; ByteArray -&gt; Ordering\nsortIntArrays x y = let h1 = indexByteArray x 0 :: Int\n                        h2 = indexByteArray y 0 :: Int in\n                    compare h1 h2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1471035928, "creation_date": 1471035928, "answer_id": 38926449, "question_id": 38881870, "link": "https://stackoverflow.com/questions/38881870/haskell-matrix-sorting-much-slower-than-vector-sorting/38926449#38926449", "title": "Haskell : matrix sorting much slower than vector sorting", "body": "<p>As Edward Kmett as explained to me, the Haskell version has one extra layer of indirection. A <code>UV.Vector</code> looks something like</p>\n\n<pre><code>data Vector a = Vector !Int !Int ByteArray#\n</code></pre>\n\n<p>So each entry in your vector of vectors is actually a pointer to a record holding slice indices and a pointer to an array of bytes. This is an extra indirection that the C++ code doesn't have. The solution is to use an <code>ArrayArray#</code>, which is an array of direct pointers to byte arrays or to further <code>ArrayArray#</code>s. If you need <code>vector</code>, you'll have to figure out what to do about the slicing machinery. Another option is to switch to <code>primitive</code>, which offers simpler arrays.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 2, "accepted_answer_id": 38926449, "answer_count": 2, "score": 5, "last_activity_date": 1473685981, "creation_date": 1470856884, "last_edit_date": 1470857590, "question_id": 38881870, "link": "https://stackoverflow.com/questions/38881870/haskell-matrix-sorting-much-slower-than-vector-sorting", "title": "Haskell : matrix sorting much slower than vector sorting", "body": "<p>I have to sort the lines of large integer matrices in Haskell and I started benchmarking with random data. I found that Haskell is 3 times slower than C++. </p>\n\n<p>Because of the randomness, I expect line comparison to always terminate at the first column (which should have no duplicates). So I narrowed the matrix to a single column implemented as a Vector (Unboxed.Vector Int) and compared its sorting to a usual Vector Int.</p>\n\n<p>Vector Int sorts as fast as C++ (good news !), but again, the column matrix is 3 times slower. Do you have an idea why ? Please find the code below.</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as UV(Vector, fromList)\nimport qualified Data.Vector as V(Vector, fromList, modify)\nimport Criterion.Main(env, bench, nf, defaultMain)\nimport System.Random(randomIO)\nimport qualified Data.Vector.Algorithms.Intro as Alg(sort)\n\nrandomVector :: Int -&gt; IO (V.Vector Int)\nrandomVector count = V.fromList &lt;$&gt; mapM (\\_ -&gt; randomIO) [1..count]\n\nrandomVVector :: Int -&gt; IO (V.Vector (UV.Vector Int))\nrandomVVector count = V.fromList &lt;$&gt; mapM (\\_ -&gt; do\n                                               x &lt;- randomIO\n                                               return $ UV.fromList [x]) [1..count]\n\nbenchSort :: IO ()\nbenchSort = do\n  let bVVect = env (randomVVector 300000) $ bench \"sortVVector\" . nf (V.modify Alg.sort)\n      bVect = env (randomVector 300000) $ bench \"sortVector\" . nf (V.modify Alg.sort)\n  defaultMain [bVect, bVVect]\n\nmain = benchSort\n</code></pre>\n"}, {"tags": ["haskell", "overlapping-instances"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1470854359, "post_id": 38880858, "comment_id": 65123371, "body": "This is called <code>MonoLocalBinds</code> (I think you can turn it off with <code>-XNoMonoLocalBinds</code>) - basically, when the values are bound in a <code>let</code> block, the constraint is solved seperately for that binding (and it finds a constraint which can be discharged immediately through the first instance, so it does that). Such an instance will perpetually cause you these problems - its existence is a design flaw."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1470858214, "post_id": 38880858, "comment_id": 65125471, "body": "@user2407038 It seems like you got it backwards, turning ON MonoLocalBinds actually fixed my issue. It only breaks when it is turned off. But either way thanks, It works now! As for the design flaw aspect, I don&#39;t see another way to get the behavior I want, and I really don&#39;t see what is so bad about it. Regardless this is for designing a complex algorithm which I will then have to convert into C++, so I don&#39;t really mind if it is a design flaw, as the code will not be directly used in a production environment."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1470863655, "post_id": 38880858, "comment_id": 65128161, "body": "@semicolon &quot;I don&#39;t see another way to get the behavior I want&quot;: define an instance for every type, even if it is the trivial <code>view = show</code> instance. There are safe extensions that make this even easier. &quot;I really don&#39;t see what is so bad about it&quot;: if you write enough code with these instances lying around, you will inevitably write something that uses the wrong instance -- that is, you will execute a <i>different piece of code</i> than the one you were expecting to execute. Depending on the consumer of the value, this problem could range anywhere from an inconvenience to a security-critical bug."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470868219, "post_id": 38880858, "comment_id": 65129904, "body": "@DanielWagner If I avoid orphan instances isn&#39;t that pretty easy to make impossible? Particularly if it&#39;s a class I wrote in my application code, because then no library can possibly export instances for it because they have no idea my application exists. I can see how such a class would be dangerous in a library, but IMO it isn&#39;t dangerous in an application."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470871495, "post_id": 38880858, "comment_id": 65130767, "body": "@semicolon If you never turn on <code>IncoherentInstances</code>, and you never write an orphan instance, you may be okay. Do you trust yourself to remember these restrictions, while you are keeping in mind all the other details of your program? What about twelve months from now when it comes time to maintain your program some -- are you sure you&#39;ll remember then?"}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470872251, "post_id": 38880858, "comment_id": 65130947, "body": "@DanielWagner Yes I do very much trust myself to not turn on something with word &quot;Incoherent&quot; in the name, particularly seeing as everyone knows it is a very dangerous extension. Likewise I avoid orphan instances because it is pretty well known that they cause problems. So yeah I absolutely will remember."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470873419, "post_id": 38880858, "comment_id": 65131233, "body": "@semicolon I&#39;m mildly skeptical. You&#39;re happy enough using overlapping instances when they serve a need, despite the fact that they&#39;re one of the less safe extensions. And it&#39;s not just you, of course -- anybody who inherits the code will need to make these judgments as well. Of course in the end the risk is your decision, but make sure you&#39;re choosing the risk with care. To me it seems a no-brainer: the safe solution is only a few lines of easily-written code away; probably less than two minutes of effort."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470875124, "post_id": 38880858, "comment_id": 65131655, "body": "@DanielWagner I mean <code>IncoherentInstances</code> is orders of magnitudes more dangerous than <code>OverlappingInstances</code>, it can straight up lead to incorrect behavior, whereas <code>OverlappingInstances</code> at worst ends up with different or unexpected behavior, and only if used carelessly. Also defining an orphan instance within a single application when you actually defined the class within said application just seems... moronic."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470892854, "post_id": 38880858, "comment_id": 65136059, "body": "Using <code>OverlappingInstances</code> today means that years down the line when it&#39;s really getting in your users&#39; way and driving you batty, you won&#39;t be able to get rid of it because you structured your whole interface around it. Use closed type families and MPTC instead; it sucks but less."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470925028, "post_id": 38880858, "comment_id": 65156621, "body": "@dfeuer I mean there aren&#39;t any users... it&#39;s an internal application. I mean it&#39;s not even going to be put into a prod environment, it&#39;s basically a reference implementation for an algorithm I have been tasked to write that will eventually end up as C++. With that said how would I do this with closed type families and multi param type classes?"}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1471212747, "post_id": 38903345, "comment_id": 65249264, "body": "Can you explain a little what is going on here? This seems really... indirect... Is there any way to just have a true closed type class?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1471481171, "post_id": 38903345, "comment_id": 65368327, "body": "@semicolon, the idea is to <i>name</i> each instance by switching to a multi-parameter type class one of whose parameters is the name. Then the type family selects the appropriate instance, instead of really using Haskell&#39;s usual instance selection mechanism. There are a few minor variations on the technique (e.g., you could use an auxiliary type class to push the equality constraint into an instance constraint instead of putting it on a binding). There is no such thing as a true closed type class; this sort of thing is the best you can do."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1471491246, "post_id": 38903345, "comment_id": 65370783, "body": "Ok I think that makes sense, is there any chance that Haskell will get some form of true closed type classes? Because that would be really nice. Or is there any reason why they should not exist?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1471493275, "post_id": 38903345, "comment_id": 65371283, "body": "@semicolon, some years ago a now-defunct research group came up with &quot;instance chains&quot; as a better-behaved approach to overlapping. I don&#39;t know of any plans to add those, or anything similar, to GHC."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1488348212, "post_id": 38903345, "comment_id": 72184871, "body": "I have since done a lot more with <code>TypeFamilies</code> so this makes a lot more sense now. Couldn&#39;t you just have two <code>Name</code>s, <code>Default</code> and <code>Override</code>, then <code>instance Show a =&gt; View &#39;Default a</code> and <code>instance View &#39;Override &lt;Type1&gt;</code>, <code>instance View &#39;Override &lt;Type2&gt;</code>. To limit the boilerplate a little?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1488373118, "post_id": 38903345, "comment_id": 72200434, "body": "@semicolon, I really don&#39;t know what you mean. Can you explain more (or, better, try it and see if it compiles and report back)?"}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1488397361, "post_id": 38903345, "comment_id": 72216956, "body": "<a href=\"http://pastebin.com/raw/1f72vbTe\" rel=\"nofollow noreferrer\">pastebin.com/raw/1f72vbTe</a> is what I was more or less thinking of. Looks like my change may have forced me to use undecidable instances though, hmm. Perhaps you need extra types to deal with pairs and such if you don&#39;t want undecidable instances."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1470955778, "last_edit_date": 1470955778, "creation_date": 1470938938, "answer_id": 38903345, "question_id": 38880858, "link": "https://stackoverflow.com/questions/38880858/moving-function-call-into-where-clause-breaks-type-checker-with-overlappinginsta/38903345#38903345", "title": "Moving function call into where clause breaks type checker with OverlappingInstances", "body": "<p>The type family approach looks like this:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, MultiParamTypeClasses,\n    FlexibleInstances, DataKinds, KindSignatures,\n    ScopedTypeVariables #-}\n\nimport Data.Proxy\n\n\ndata Name = Default | Booly | Inty | Pairy Name Name\n\ntype family ViewF (a :: *) :: Name where\n  ViewF Bool = 'Booly\n  ViewF Int = 'Inty\n  ViewF Integer = 'Inty --you can use one instance many times\n  ViewF (a, b) = 'Pairy (ViewF a) (ViewF b)\n  ViewF a = 'Default\n\nclass View (name :: Name) a where\n  view' :: proxy name -&gt; a -&gt; String\n\ninstance (Show a, Num a) =&gt; View 'Inty a where\n  view' _ x = \"Looks Inty: \" ++ show (x + 3)\n\ninstance a ~ Bool =&gt; View 'Booly a where\n  view' _ x = \"Looks Booly: \" ++ show (not x)\n\ninstance Show a =&gt; View 'Default a where\n  view' _ x = \"Looks fishy: \" ++ show x\n\ninstance (View n1 x1, View n2 x2) =&gt; View ('Pairy n1 n2) (x1, x2) where\n  view' _ (x, y) = view' (Proxy :: Proxy n1) x ++ \",\" ++ view' (Proxy :: Proxy n2) y\n\n\nview :: forall a name .\n        (ViewF a ~ name, View name a)\n     =&gt; a -&gt; String\nview x = view' (Proxy :: Proxy name) x\n\n-- Example:\n\nhello :: String\nhello = \"(\" ++ view True ++ view (3 :: Int)\n        ++ view \"hi\" ++ \")\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "is_accepted": true, "score": 0, "last_activity_date": 1472421520, "creation_date": 1472421520, "answer_id": 39196177, "question_id": 38880858, "link": "https://stackoverflow.com/questions/38880858/moving-function-call-into-where-clause-breaks-type-checker-with-overlappinginsta/39196177#39196177", "title": "Moving function call into where clause breaks type checker with OverlappingInstances", "body": "<p>Thanks @dfeuer for providing an alternative approach, but I figured I should write the fairly quick fix for the question itself:</p>\n\n<pre><code>{-# LANGUAGE MonoLocalBinds #-}\n</code></pre>\n\n<p>Once that is put at the top of the file everything works just fine. From the research I did it seems like certain extensions (I guess including <code>OverlappingInstances</code>) poke holes in local binding type checking, and <code>MonoLocalBinds</code> sacrifices using local binds polymorphically in order to fix those holes.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "accepted_answer_id": 39196177, "answer_count": 2, "score": 3, "last_activity_date": 1472421520, "creation_date": 1470853323, "question_id": 38880858, "link": "https://stackoverflow.com/questions/38880858/moving-function-call-into-where-clause-breaks-type-checker-with-overlappinginsta", "title": "Moving function call into where clause breaks type checker with OverlappingInstances", "body": "<p>I was using <code>OverlappingInstances</code> to make a pretty print class that would default to <code>Show</code> whenever I didn't provide a custom instance for some type.</p>\n\n<p>For some reason this seems to break whenever you use a <code>where</code> clause or a <code>let</code> expression.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nclass View a where\n    view :: a -&gt; String\n\ninstance {-# OVERLAPS #-} Show a =&gt; View a where\n    view = show\n\n-- Works just fine\ninstance (View a, View b) =&gt; View (a, b) where\n    view (a, b) = \"(\" ++ view a ++ \", \" ++ view b ++ \")\"\n\n-- Does not work\ninstance (View a, View b) =&gt; View (a, b) where\n    view (a, b) = \"(\" ++ a' ++ \", \" ++ b' ++ \")\"\n      where\n        a' = view a\n        b' = view b\n\n-- Does not work\ninstance (View a, View b) =&gt; View (a, b) where\n    view (a, b) = let\n        a' = view a\n        b' = view b\n        in \"(\" ++ a' ++ \", \" ++ b' ++ \")\"\n</code></pre>\n\n<p>Now if I remove the default overlapping instance all of the other instances work just fine.</p>\n\n<p>I am hoping someone could explain to me why this happens, or is it just a bug?</p>\n\n<p>The specific errors I get for each of them are:</p>\n\n<pre><code>Could not deduce (Show a) arising from a use of \u2018view\u2019 from the context (View a, View b) bound by the instance declaration at ...\nCould not deduce (Show b) arising from a use of \u2018view\u2019 from the context (View a, View b) bound by the instance declaration at ...\n</code></pre>\n\n<p>So for some reason <code>where</code> / <code>let</code> are tricking the type checker into thinking <code>View</code> requires <code>Show</code>, when it doesn't.</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470852433, "post_id": 38880458, "comment_id": 65122270, "body": "Great. I was perfectly happy not knowing about Unicode Mathematical Alphanumeric Symbols; now I&#39;m going to feel compelled to use them."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470852635, "post_id": 38880458, "comment_id": 65122394, "body": "@chepner oh my is it that you can&#39;t see those symbols? I didn&#39;t realize that until I checked this question on my phone just now."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470852692, "post_id": 38880458, "comment_id": 65122427, "body": "No, it&#39;s that I <i>can</i> seem them, and I was so amazed to see italicized text in a code block that I had to them up. They&#39;re a pain to type, but they look <i>so</i> right. :)"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1470852788, "post_id": 38880458, "comment_id": 65122471, "body": "I think what you&#39;re hitting upon is the difference between a strictly-evaluated lambda calculus (your reduction steps) and a lazily-evaluated lambda calculus (the book&#39;s reduction steps)."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470852804, "post_id": 38880458, "comment_id": 65122482, "body": "@chepner But that Unicode is not working on my iPhone. Maybe you should not get too obsessed with it lol."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470852860, "post_id": 38880458, "comment_id": 65122513, "body": "@chepner: I have these mapped to <code>\\a</code> <code>\\b</code> ... in my Emacs configuration. Good fun, though utterly pointless (and it&#39;s indeed still not web-safe, and <i>certainly</i> not safe for anything where you&#39;re not sure if it even uses a proper encoding like UTF-8)."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1470853750, "post_id": 38880458, "comment_id": 65123021, "body": "@haoformayor Hi I guess that&#39;s exactly what I&#39;m thinking about."}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470853666, "post_id": 38880677, "comment_id": 65122966, "body": "Hi! Thanks for answering, I&#39;ve used up my brain today. 2:26 Am and gotta sleep. I think I&#39;ll have to read your answer again tomorrow when my brain actually exists. lol."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854219, "post_id": 38880677, "comment_id": 65123295, "body": "Okay my way of thinking is, when I get to ( \\z -&gt; (\\n -&gt; z) ((\\p -&gt; p) z) ), can I do like: bind z to (\\p -&gt; p) z) and get (\\n -&gt; ((\\p -&gt; p) z))  and bind n to z and get ((\\p -&gt; p) z) and then (\\p -&gt; p)?"}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854648, "post_id": 38880677, "comment_id": 65123531, "body": "Sorry ((\\p -&gt; p) z) should be z, my bad. So it means &quot;bind z to (\\p -&gt; p) z)&quot; is wrong. Why?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854711, "post_id": 38880677, "comment_id": 65123562, "body": "No, you can&#39;t bind <code>z</code> to anything at all because it still comes from out of the scope. Hence my remark about the legibility of lambda syntax. <code>\u03bba . b c d</code> is just shorthand for <code>\u03bba . ((b c) d)</code>, i.e. the <code>a</code>-lambda is <i>always</i> at the very outside; nothing comes after it that you could bind it to."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1470854738, "post_id": 38880677, "comment_id": 65123570, "body": "I personally find this a lot harder to read than the &quot;weird&quot; lambda notation lol. Still, nice work on a well-explained answer \uff3e\uff3f\uff3e"}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854976, "post_id": 38880677, "comment_id": 65123692, "body": "@leftaroundabout By scope you mean the parenthesis above right? I think I&#39;m getting it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1470853384, "last_edit_date": 1470853384, "creation_date": 1470852689, "answer_id": 38880677, "question_id": 38880458, "link": "https://stackoverflow.com/questions/38880458/lambda-calculus-beta-reduction-specific-steps-and-why/38880677#38880677", "title": "Lambda calculus beta reduction specific steps and why", "body": "<p>Lambda notation is a bit weird to parse. IMO Haskell syntax is clearer:</p>\n\n<pre><code>\\z -&gt; (\\m -&gt; \\n -&gt; m) z ((\\p -&gt; p) z)\n</code></pre>\n\n<p>or, even more explicit</p>\n\n<pre><code>\\z -&gt; (\n        (\n           ( \\m -&gt; (\\n -&gt; m) )\n           z\n        )\n        ( (\\p -&gt; p) z )\n      )\n</code></pre>\n\n<p>The first reduction step is</p>\n\n<pre><code>\\z -&gt; (\n        (\n           (\\n -&gt; z)\n        )\n        ( (\\p -&gt; p) z )\n      )\n</code></pre>\n\n<p>or</p>\n\n<pre><code>\\z -&gt; (\n        (\\n -&gt; z)\n        ( (\\p -&gt; p) z )\n      )\n</code></pre>\n\n<p>then you can indeed bind <code>((\\p -&gt; p) z)</code> \u2013 not to <code>z</code> but to <code>n</code>! (Which isn't actually used at all though.)</p>\n\n<pre><code>\\z -&gt; (\n        (z)\n      )\n</code></pre>\n\n<p>or simply <code>\\z -&gt; z</code>. So, we <em>still</em> have that <code>z</code> lambda, which as the book said is irredicible. We just don't have anything else!</p>\n\n<hr>\n\n<p>...I'm not sure if that was actually your question. If it was rather: why must we not <em>first</em> see if we can reduce <code>((\\p -&gt; p) z)</code>, then the answer is, I think, lambda calculus as such doesn't define this at all (it just defines what transformation you <em>can</em> apply, not in which order you <em>should</em> do it.<sup>Actually I'm not sure about this, correct me if I'm wrong</sup>). In a strict language like Scheme, you would indeed first reduce <code>((\\p -&gt; p) z)</code>; Haskell wouldn't do that since there's no need. Either way, it doesn't really matter, because the result is discarded anyway.</p>\n\n<pre><code>   ( \\z -&gt; (\\n -&gt; z) ((\\p -&gt; p) z) )\n\u2261  ( \\z -&gt; (\\n -&gt; z) z )\n\u2261  ( \\z -&gt; (\\n -&gt; z) foo )\n\u2261  ( \\z -&gt; z )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1470853443, "last_edit_date": 1470853443, "creation_date": 1470852887, "answer_id": 38880726, "question_id": 38880458, "link": "https://stackoverflow.com/questions/38880458/lambda-calculus-beta-reduction-specific-steps-and-why/38880726#38880726", "title": "Lambda calculus beta reduction specific steps and why", "body": "<p>The key is that <em>n</em> is never used in the abstraction. <code>n</code> is still bound to <code>((\u03bbp.p)z)</code>, but it is immediately discarded.</p>\n\n<pre><code>\u03bbz.(\u03bbm.\u03bbn.m)(z)((\u03bbp.p)z) = \u03bbz.(\u03bbn.z)((\u03bbp.p)z)  Replacing m with z\n                         = \u03bbz.z                Replacing n with ((\u03bbp.p)z)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854509, "post_id": 38881062, "comment_id": 65123445, "body": "I get it. If I do [n := ((\u03bbp.p)z)] the answer would be \u03bbz.z"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854632, "post_id": 38881062, "comment_id": 65123515, "body": "You could do <code>[n := anything]</code> and the answer would still be <code>z</code> because there is not <code>n</code> in <code>\u03bbn.z</code>&#39;s term"}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470854835, "post_id": 38881062, "comment_id": 65123615, "body": "At the second reduction, I thought I could do <code>[z := ((\u03bbp.p)z)]</code> and get <code>z</code> at last."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470855010, "post_id": 38881062, "comment_id": 65123709, "body": "That&#39;s not how it&#39;s evaluated tho. You have an application of <code>(\u03bbn.z)</code> to <code>((\u03bbp.p)z)</code>. <code>(\u03bbn.z)</code> only binds <code>n</code>, not <code>z</code>."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470855118, "post_id": 38881062, "comment_id": 65123771, "body": "I meant the <code>\u03bbz</code> in <code>\u03bbz.(\u03bbn.z) </code>"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "edited": false, "score": 0, "creation_date": 1470855295, "post_id": 38881062, "comment_id": 65123866, "body": "<code>\u03bbz</code> is never applied to another lambda term. At least not in the example you provided."}, {"owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1470855343, "post_id": 38881062, "comment_id": 65123897, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/120627/discussion-between-allen-and-naomik\">continue this discussion in chat</a>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1470859530, "post_id": 38881062, "comment_id": 65126140, "body": "I&#39;m mildly agitated to see the statement &quot;lambda calculus uses normal order evaluation&quot;. Various <i>implementations</i> of lambda calculus use particular evaluation strategies (and many would not reduce under a lambda at all) , but the &quot;lambda calculus&quot; per se does not commit to any specific strategy."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1470859798, "post_id": 38881062, "comment_id": 65126291, "body": "@pigworker I did mention that evaluation under <code>\u03bbz</code> wouldn&#39;t take place until it&#39;s applied. I misspoke when I said lambda calculus uses normal order evaluation. It&#39;s the only evaluation strategy I&#39;ve seen in my learnings, but I suppose there&#39;s no reason other strategies couldn&#39;t be used. I will adapt my answer to avoid spreading misinformation. Thank you for your comment."}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": true, "score": 6, "last_activity_date": 1470860361, "last_edit_date": 1470860361, "creation_date": 1470854011, "answer_id": 38881062, "question_id": 38880458, "link": "https://stackoverflow.com/questions/38880458/lambda-calculus-beta-reduction-specific-steps-and-why/38881062#38881062", "title": "Lambda calculus beta reduction specific steps and why", "body": "<p>Using normal order evaluation, you can get the answer in two beta reductions</p>\n\n<pre><code>// beta reduction 1\n\u03bbz.(<b>\u03bbm.</b>\u03bbn.<b>m</b>)(<b>z</b>)((\u03bbp.p)z) \u2192\u03b2 (\u03bbn.m) [m := z]\n\u03bbz.(<del>\u03bbm.</del>\u03bbn.<b>z</b>)<del>(z)</del>((\u03bbp.p)z)\n\n// beta reduction 2\n\u03bbz.(<b>\u03bbn.</b>z)(<b>(\u03bbp.p)z</b>)       \u2192\u03b2 z      [n := ((\u03bbp.p)z)]\n\u03bbz.<del>(\u03bbn.</del>z<del>)((\u03bbp.p)z)</del>\n\n// result\n\u03bbz.z\n</code></pre>\n\n<p>The second reduction might seem tricky because <code>n</code> is bound to <code>((\u03bbp.p)z)</code> but the expression is just <code>z</code>, so <code>n</code> is thrown away.</p>\n\n<hr>\n\n<p>Using applicative order evaluation, it takes one extra step</p>\n\n<pre><code>// beta reduction 1\n\u03bbz.(\u03bbm.\u03bbn.m)(z)((<b>\u03bbp.p</b>)<b>z</b>) \u2192\u03b2 p      [p := z]\n\u03bbz.(\u03bbm.\u03bbn.m)(z)(<del>(\u03bbp.</del><b>z</b><del>)z</del>)\n\n// beta reduction 2\n\u03bbz.(<b>\u03bbm.</b>\u03bbn.<b>m</b>)(<b>z</b>)(z)       \u2192\u03b2 (\u03bbn.m) [m := z]\n\u03bbz.(<del>\u03bbm.</del>\u03bbn.<b>z</b>)<del>(z)</del>(z)\n\n// beta reduction 3\n\u03bbz.(<b>\u03bbn.</b>z)(<b>z</b>)             \u2192\u03b2 z      [n := z]\n\u03bbz.<del>(\u03bbn.</del>z<del>)(z)</del>\n\n// result\n\u03bbz.z\n</code></pre>\n\n<hr>\n\n<p>In this scenario, whether we use normal order evaluation or applicative order evaluation, the result is the same. Differing evaluation strategies sometimes evaluate to different results.</p>\n\n<p>An important note, the reduction steps we've done above will not take place <em>until</em> <code>\u03bbz</code> is applied (depending on the implementation). In the example code you have provided, <code>\u03bbz</code> is never applied, therefore simplifying <code>\u03bbz</code>'s term is just for exercise, in this case.</p>\n\n<p>All we've done is demonstrate lambda <em>equivalence</em> (under two different evaluation strategies)</p>\n\n<pre><code>\u03bbz.(\u03bbm.\u03bbn.m)(z)((\u03bbp.p)z) &lt;=&gt; \u03bbz.z\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 5536260, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-9fktmaOQsc4/AAAAAAAAAAI/AAAAAAAAAbE/ey9Vdq7dRDE/photo.jpg?sz=128", "display_name": "Allen", "link": "https://stackoverflow.com/users/5536260/allen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 829, "favorite_count": 2, "accepted_answer_id": 38881062, "answer_count": 3, "score": 1, "last_activity_date": 1470860361, "creation_date": 1470851894, "question_id": 38880458, "link": "https://stackoverflow.com/questions/38880458/lambda-calculus-beta-reduction-specific-steps-and-why", "title": "Lambda calculus beta reduction specific steps and why", "body": "<p>From a book I'm recently reading:</p>\n\n<p>First:</p>\n\n<p><code>\ud835\udf06\ud835\udc67.(\ud835\udf06\ud835\udc5a.\ud835\udf06\ud835\udc5b.\ud835\udc5a)(\ud835\udc67)((\ud835\udf06\ud835\udc5d.\ud835\udc5d)\ud835\udc67)</code>\nThe outermost lambda binding \ud835\udc67 is, at this point, irreducible because it has no argument to apply to. What remains is to go inside the terms one layer at a time until we find something reducible.</p>\n\n<p>Next:</p>\n\n<p><code>\ud835\udf06\ud835\udc67.(\ud835\udf06\ud835\udc5b.\ud835\udc67)((\ud835\udf06\ud835\udc5d.\ud835\udc5d)\ud835\udc67)</code>\nWe can apply the lambda binding \ud835\udc5a to the argument \ud835\udc67. We keep searching for terms we can apply. The next thing we can apply is the lambda binding \ud835\udc5b to the lambda term <code>((\ud835\udf06\ud835\udc5d.\ud835\udc5d)\ud835\udc67)</code>.</p>\n\n<p>I don't get it. In the first section, it says <code>\ud835\udf06\ud835\udc67</code> has no argument to apply to, that I can probably understand, but then at the Next section I think the <code>z</code> can be bound to <code>((\ud835\udf06\ud835\udc5d.\ud835\udc5d)\ud835\udc67)</code> because as you can see, <code>\ud835\udf06\ud835\udc67.(\ud835\udf06\ud835\udc5b.\ud835\udc67)</code>, the body of <code>\ud835\udf06\ud835\udc67</code> clearly has a <code>z</code> argument which can be bound. But the book just ignored the head <code>\ud835\udf06\ud835\udc67</code> and directly bound <code>n</code> to <code>((\ud835\udf06\ud835\udc5d.\ud835\udc5d)\ud835\udc67)</code>. I mean <code>\ud835\udf06\ud835\udc5b.\ud835\udc67</code> doesn't have an <code>n</code> argument, why does it get to be bound?</p>\n\n<p>Can somebody explain to me about this?</p>\n"}, {"tags": ["haskell", "caching", "lazy-evaluation", "frege"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1470849792, "post_id": 38879778, "comment_id": 65120760, "body": "The question is indeed interesting when <code>primes</code> is polymorphic. On the other hand, if you had <code>primes :: [Int]</code>, then <code>primes</code> would only be calculated once."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1470991235, "post_id": 38879778, "comment_id": 65184313, "body": "For Frege, Alec&#39;s brilliant answer applies accordingly. A polymorphic value is actually a function that takes instances (i.e. records of functions) which it uses to fulfill its tasks."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1470851024, "post_id": 38880106, "comment_id": 65121429, "body": "Unless I\u2019m missing something, I think the first two sentences of your answer might be inverted (that is, I think the first sentence should end with \u201cyes\u201d but the second should end with \u201cno\u201d). Nice answer, though. :)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1470851108, "post_id": 38880106, "comment_id": 65121486, "body": "@AlexisKing He is co-answering the question."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1470851191, "post_id": 38880106, "comment_id": 65121530, "body": "The general rule of thumb is that monomorphic CAFs may be shared while polymorphic CAFs cannot, for the reasons you mention. Also, be aware that the monomorphism restriction will turn some seemingly polymorphic CAFs into monomorphic ones, e.g., <code>primes</code> without an explicit annotation."}, {"owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "edited": false, "score": 0, "creation_date": 1470854030, "post_id": 38880106, "comment_id": 65123177, "body": "If the functions above had remained polymorphic, would a simple <code>where</code> clause (or just anywhere in the current module) defining monomorphic versions of the functions suffice? e.g. <code>main = ... where integerPrimes = primes :: [Integer]</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "edited": false, "score": 0, "creation_date": 1470854503, "post_id": 38880106, "comment_id": 65123441, "body": "@AliciaRose Yes, provided you then used <code>integerPrimes</code> everywhere. Also, would you mind changing the signatures in the question back to their polymorphic forms? It&#39;s a great question and other people won&#39;t be able to understand what is going on now that the signatures are all different."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470854911, "post_id": 38880106, "comment_id": 65123652, "body": "@Alec - Does use of the SPECIALIZE pragma have an effect here?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470858842, "post_id": 38880106, "comment_id": 65125775, "body": "@ErikR Yep it does (when compiling with <code>-O2</code>)."}, {"owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "edited": false, "score": 0, "creation_date": 1471017715, "post_id": 38880106, "comment_id": 65201073, "body": "@Alec so if <code>primes</code> were to remain polymorphic, would monomorphic functions that use <code>primes</code> (or monomorphic functions that use functions that use <code>primes</code>, and so on) be thunked, and <code>primes</code> would only be evaluated once for said thunk?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "edited": false, "score": 0, "creation_date": 1471018393, "post_id": 38880106, "comment_id": 65201449, "body": "@AliciaRose No, but if you do something like <code>let primesInt = primes in ...</code> where the context of the use implies <code>primesInt :: [Int]</code> then <code>primesInt</code> will be only evaluated once."}, {"owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "edited": false, "score": 0, "creation_date": 1471025337, "post_id": 38880106, "comment_id": 65204865, "body": "@Alec Suppose I have a function <code>a</code> that calls a function <code>b</code> that calls ... that calls <code>primes</code>. Could I still do <code>let aInts = a in ...</code> or something, where <code>aInts</code> is implied to be <code>[Int]</code> or something like in your example, where <code>primes</code> is still evaluated only once? I ask this because I&#39;m still a little unsure how &quot;deep&quot; Haskell will go before it stops thunking."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1470859479, "last_edit_date": 1495539864, "creation_date": 1470850761, "answer_id": 38880106, "question_id": 38879778, "link": "https://stackoverflow.com/questions/38879778/does-haskell-frege-ever-recalcuate-elements-of-a-lazy-list/38880106#38880106", "title": "Does Haskell/Frege ever recalcuate elements of a lazy list?", "body": "<p>In your case (for Haskell GHC) the answer is that <code>primes</code> is recalculated. Yet, if you had a monomorphic signature like <code>primes :: [Int]</code>, that wouldn't be the case. Here's a way to debug this: import <code>Debug.Trace</code> and add the <code>trace</code> function to <code>primes</code></p>\n\n<pre><code>primes :: (Enum \u03b1, Integral \u03b1) =&gt; [\u03b1]\nprimes = trace \"call to primes\" $ sieve [2..]\n  where sieve :: (Integral \u03b1) =&gt; [\u03b1] -&gt; [\u03b1]\n        sieve []     = undefined\n        sieve (x:xs) = x : (sieve $ filter ((/= 0) . (flip mod x)) xs)\n</code></pre>\n\n<p>Now, every time <code>primes</code> is called, you will see \"call to primes\" printed out. Compiling your program (with or without optimizations), I get two calls to <code>primes</code>.</p>\n\n<h3>But why?</h3>\n\n<p>Haskell actually compiles your version of <code>primes</code> to a function that takes one type argument, and so the use of <code>primes</code> inside <code>sumOfPrimesLessThan</code> and <code>productOfPrimesLessThan</code> is actually a function call (and function calls are not in general memoized in Haskell, for pretty obvious reasons). When you call <code>sumOfPrimesLessThan 1000 :: Integer</code>, for example, you actually give it two arguments: the value <code>1000</code> and the type argument <code>Integer</code>. <code>sumOfPrimesLessThan</code> then passes this second argument on to primes.</p>\n\n<p>On the other hand, if you had type signatures that were monomorphic, like <code>primes :: [Int]</code>, <code>sumOfPrimesLessThan :: Int -&gt; Int</code>, and <code>productOfPrimesLessThan :: Int -&gt; Int</code>, Haskell compiles <code>primes</code> down to just a regular thunk value, so it only gets evaluated once.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/38248771/what-does-core-haskell-applying-types-to-functions-mean/38249762#38249762\">Here</a> is another explanation of how Haskell represents values and functions on the inside I gave not long ago.</p>\n\n<h3><code>SPECIALIZE</code> pragma (specific to GHC)</h3>\n\n<p>Sometimes you would like to be able to tell GHC that even if your expression is polymorphic, you'd like it to be treated as monomorphic for a couple types. (So you kind of wish you had a second version <code>primes :: [Integer]</code> even if in general <code>primes :: (Enum \u03b1, Integral \u03b1) =&gt; [\u03b1]</code>.) You can specify this using the <code>SPECIALIZE</code> pragma:</p>\n\n<pre><code>{-# SPECIALIZE primes :: [Integer] #-}\nprimes :: (Enum a,Integral a) =&gt; [a]\nprimes = ...\n</code></pre>\n\n<p>And now, just for the <code>Integer</code> type, <code>primes</code> will only be computed once. For other types (like <code>Int</code>), we will still get the same behavior as before.</p>\n\n<h3>In response to addendums</h3>\n\n<p>For multiple calls to <code>prime = flip elem primes</code> where <code>prime</code> is monomorphic (\"instantiated\"), you would still have only one call to <code>primes</code>. Once <code>primes</code> is monomorphic, it can be shared everywhere. Also, beware the monomorphism restriction in your <code>allPrime = all prime</code> example - you'll need to specify which instance of <code>Foldable</code> want (<code>allPrime = all prime</code> is subtly different from <code>allPrime xs = all prime xs</code>).</p>\n"}], "owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 38880106, "answer_count": 1, "score": 3, "last_activity_date": 1470859479, "creation_date": 1470849556, "last_edit_date": 1470858648, "question_id": 38879778, "link": "https://stackoverflow.com/questions/38879778/does-haskell-frege-ever-recalcuate-elements-of-a-lazy-list", "title": "Does Haskell/Frege ever recalcuate elements of a lazy list?", "body": "<p>Suppose I have a list of all primes, defined as</p>\n\n<pre><code>primes :: (Enum \u03b1, Integral \u03b1) =&gt; [\u03b1]\nprimes = sieve [2..]\n  where sieve :: (Integral \u03b1) =&gt; [\u03b1] -&gt; [\u03b1]\n        sieve []     = undefined\n        sieve (x:xs) = x : (sieve $ filter ((/= 0) . (flip mod x)) xs)\n</code></pre>\n\n<p>and I want to feed <code>primes</code> through multiple, different functions like:</p>\n\n<pre><code>sumOfPrimesLessThan :: (Integral \u03b1) =&gt; \u03b1 -&gt; \u03b1\nsumOfPrimesLessThan n = sum $ takeWhile (&lt; n) primes\n</code></pre>\n\n<p>or</p>\n\n<pre><code>productOfPrimesLessThan :: (Integral \u03b1) =&gt; \u03b1 -&gt; \u03b1\nproductOfPrimesLessThan n = foldl (*) 1 $ takeWhile (&lt; n) primes\n</code></pre>\n\n<p>or something, as if by doing</p>\n\n<pre><code>main = do print (sumOfPrimesLessThan     1000 :: Integer)\n          print (productOfPrimesLessThan 1000 :: Integer)\n</code></pre>\n\n<p>Would Haskell, at any point in time, recalculate <code>primes</code>, or any part thereof? What would cached? What wouldn't be cached?</p>\n\n<p><strong>Addendum 0:</strong> Suppose I had another function</p>\n\n<pre><code>prime = flip elem primes\n</code></pre>\n\n<p>If <code>prime</code> were to be evaluated with different arguments, would each evaluation re-evaluate <code>primes</code>? For example:</p>\n\n<pre><code>allPrime = all prime\n</code></pre>\n"}, {"tags": ["haskell", "pandoc"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1470864201, "post_id": 38878260, "comment_id": 65128444, "body": "so what exactly have you tried? where exactly do you want to set the geometry...? (there are multiple ways, e.g. yaml metadata) Also, take a look at (my) <a href=\"https://github.com/mb21/pandoc-placetable\" rel=\"nofollow noreferrer\">pandoc-placetable</a> filter if you want to include CSV data with pandoc..."}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1470868189, "post_id": 38878260, "comment_id": 65129892, "body": "Why use Pandoc at all? Not that it&#39;s bad or anything, but its current strengths lie in texts, not tables. Instead you could use something more specialized like LibreOffice calc - which, as far as I know, has a CLI too if you need something automatic."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1470889024, "post_id": 38878260, "comment_id": 65134894, "body": "@mb21, I generated a code-fence with csv inline in that code fence, and then passed it to pandoc after passing it through pandoc-csv2table. What I am trying to figure out is that if I have haskell code instead to generate <code>pandoc</code> from csv using <code>table</code> api, how do I set the geometry such as <code>paperwidth</code> in haskell code with <code>xelatex</code> engine? I have <code>Fuel.hs</code> from Bayhac 2014 that I am using as the base solution (with default latex template)."}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1470914119, "post_id": 38891527, "comment_id": 65148698, "body": "I need to do it in haskell code since this is used in a Haskell websocket server for automatic document processing. It is more reliable error handling through API call instead of making a system call from Haskell."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1470967584, "post_id": 38891527, "comment_id": 65175689, "body": "I just tried your <code>makePDF</code> suggestion with <code>Fuel.hs</code> from BayHac2014 by adding geometry variables to <code>export</code> function. Then, I looked at the PDF size using inspector tool on Preview in mac, but still don&#39;t see it being set to new size. The new size shows up fine when using the command line. Perhaps I missed something here? The template is default latex template."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1472490399, "post_id": 38891527, "comment_id": 65761856, "body": "I have fixed the errors in the solution so that I can now accept it. I have also added some more details in my answer below so it might help others."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 1, "last_activity_date": 1472490340, "last_edit_date": 1495535352, "creation_date": 1470905222, "answer_id": 38891527, "question_id": 38878260, "link": "https://stackoverflow.com/questions/38878260/setting-geometry-through-pandoc-api/38891527#38891527", "title": "Setting geometry through Pandoc API", "body": "<h3>Using pandoc as a library</h3>\n\n<p>See <a href=\"https://stackoverflow.com/a/34485073/214446\">this answer</a> for details, but basically you use the <a href=\"https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc/Writers/LaTeX.hs#L82\" rel=\"nofollow noreferrer\"><code>writeLaTeX</code></a> function with the right <a href=\"https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc/Options.hs#L336\" rel=\"nofollow noreferrer\"><code>WriterOptions</code></a>.</p>\n\n<pre><code>makePDF \"xelatex\" $ writeLaTeX opts document\n  where\n    opts = def {\n      writerVariables = [(\"geometry\",\"paperwidth=20in\"), (\"geometry\", \"margin=.1in\")]\n    }\n</code></pre>\n\n<h3>How it works under the hood</h3>\n\n<p>Firstly, <code>geometry</code> is a template variable and not part of the document metadata (see <a href=\"https://stackoverflow.com/a/26490978/214446\">this answer</a>). As you can see in the <a href=\"https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc/Writers/LaTeX.hs#L246\" rel=\"nofollow noreferrer\">LaTeX Writer</a>, the final output is generated with:</p>\n\n<pre><code>renderTemplate' template context\n</code></pre>\n\n<p>This uses the <code>renderTemplate'</code> function from <a href=\"https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc/Templates.hs\" rel=\"nofollow noreferrer\">pandoc's own templating system</a>. At the beginning of that file there's an extensive example and documentation how to use it programatically.</p>\n\n<p>But basically something along the lines of:</p>\n\n<pre><code>import Text.Pandoc.Writers.Shared (defField)\nimport Text.Pandoc.Templates (renderTemplate')\nimport Data.Aeson (Value(Object))\nimport GHC.Exts (fromList)\n\nlet context = defField \"geometry:paperwidth\" \"20in\"\n            $ defField \"geometry:margin\" \".1in\"\n            $ Object $ fromList []\nrenderTemplate' template context\n</code></pre>\n\n<h3>Is it necessary?</h3>\n\n<p>I'm still not sure why you want to do all that in haskell code, since <a href=\"http://pandoc.org/scripting.html\" rel=\"nofollow noreferrer\">pandoc filters</a> were explicitly designed to let you easily include data (like CSV with e.g. the <a href=\"https://github.com/mb21/pandoc-placetable\" rel=\"nofollow noreferrer\">pandoc-placetable filter</a>) in a document, without essentially having to reimplementing pandoc and its templating system etc.</p>\n"}, {"tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": false, "score": 0, "last_activity_date": 1472490437, "last_edit_date": 1472490437, "creation_date": 1472486520, "answer_id": 39210505, "question_id": 38878260, "link": "https://stackoverflow.com/questions/38878260/setting-geometry-through-pandoc-api/39210505#39210505", "title": "Setting geometry through Pandoc API", "body": "<p>Fixed now. The key is to pass the variables in the format as below:</p>\n\n<pre><code>makePDF \"xelatex\" $ writeLaTeX opts document\n  where\n    opts = def {\n      writerVariables = [(\"geometry\",\"paperwidth=30in\"), (\"geometry\", \"margin=.1in\")]\n    }\n</code></pre>\n\n<p>For <code>Fuel.hs</code>, the <code>export</code> code becomes:</p>\n\n<pre><code>    export :: (MonadIO m) =&gt; String -&gt;  Pandoc -&gt; m (Either BL.ByteString BL.ByteString)\n    export tmpl pdoc = liftIO $ makePDF \"xelatex\" \n      writeLaTeX (def { writerStandalone = True, writerTemplate = tmpl,\n      writerVariables = [(\"geometry\",\"paperwidth=30in\"), (\"geometry\", \n      \"margin=.1in\")]}) pdoc\n</code></pre>\n\n<p>I have fixed @mb21's answer to reflect the fix.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 38891527, "answer_count": 2, "score": 0, "last_activity_date": 1472490437, "creation_date": 1470844463, "last_edit_date": 1472486342, "question_id": 38878260, "link": "https://stackoverflow.com/questions/38878260/setting-geometry-through-pandoc-api", "title": "Setting geometry through Pandoc API", "body": "<p>I have a really wide table that I converted to a pandoc table format and used pandoc command line tool to set paperwidth to 20in like below (for pdf output) - just a prototype using pandoc command line tool:</p>\n\n<pre><code>&lt;processed input piped to pandoc here&gt; | pandoc -V geometry:margin=.1in \n-V geometry:paperwidth=20in &lt;other options&gt;\n</code></pre>\n\n<p>Is there any way to set those variables using Pandoc haskell api? I will like to parse the CSV to pandoc (using <a href=\"https://gist.github.com/stephenjbarr/11c23e99febd19dccfbd\" rel=\"nofollow\"><code>Fuel.hs</code></a> from Bayhac 2014 which also includes pandoc generated default latex template), and then export to pdf after setting the paperwidth (calculated based on max length across rows in pdf) and margin. </p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 986, "user_id": 6700717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da8a4ff1780a7ea82e53a910913f746?s=128&d=identicon&r=PG&f=1", "display_name": "Takao", "link": "https://stackoverflow.com/users/6700717/takao"}, "edited": false, "score": 0, "creation_date": 1470860547, "post_id": 38879249, "comment_id": 65126673, "body": "If I want to use a monadic form instead of applicative, is it possible to expand FieldView to Html there too to use it in a widget definition?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 986, "user_id": 6700717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da8a4ff1780a7ea82e53a910913f746?s=128&d=identicon&r=PG&f=1", "display_name": "Takao", "link": "https://stackoverflow.com/users/6700717/takao"}, "edited": false, "score": 0, "creation_date": 1470863816, "post_id": 38879249, "comment_id": 65128245, "body": "Please open up a new question for this with the appropriate code example - thanks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1470847635, "creation_date": 1470847635, "answer_id": 38879249, "question_id": 38875994, "link": "https://stackoverflow.com/questions/38875994/how-to-compose-widgets-with-blaze-code-in-yesod/38879249#38879249", "title": "How to compose widgets with blaze code in Yesod?", "body": "<p>Use the <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.23/docs/Yesod-Core.html#v:widgetToPageContent\" rel=\"nofollow\"><code>widgetToPageContent</code></a> function.</p>\n\n<p>You then get at the <code>Html</code> by calling <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.23/docs/Yesod-Core-Types.html#t:PageContent\" rel=\"nofollow\"><code>pageBody</code></a> and applying the <code>render</code> function.</p>\n\n<pre><code>getPageR :: Handler Html -- same as: HandlerT App IO Html\ngetPageR = do\n  ((_, widget), enctype') &lt;- runFormGet sampleForm\n  content &lt;- widgetToPageContent widget\n  defaultLayout $ do\n    toWidgetBody $ \\render -&gt; do\n      H.div ! A.id \"form\" $ do\n        H.form ! A.method \"post\" ! A.action (action' render)\n                                 ! A.enctype (enct' enctype') $ \"\"\n        pageBody content render\n        H.button \"Submit!\"\n   where\n     action' = \\render -&gt; toValue $! render (PageR) []\n     enct'   = toValue . renderHtml . toHtml\n     (!) = (H.!)\n     toValue = H.toValue\n</code></pre>\n"}], "owner": {"reputation": 986, "user_id": 6700717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da8a4ff1780a7ea82e53a910913f746?s=128&d=identicon&r=PG&f=1", "display_name": "Takao", "link": "https://stackoverflow.com/users/6700717/takao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 38879249, "answer_count": 1, "score": 3, "last_activity_date": 1470847635, "creation_date": 1470838659, "question_id": 38875994, "link": "https://stackoverflow.com/questions/38875994/how-to-compose-widgets-with-blaze-code-in-yesod", "title": "How to compose widgets with blaze code in Yesod?", "body": "<p>I'm trying to write an yesod application without any hamlet parts. My question is about forms: I can generate a form using Applicative, but I cannot use it directly in my blaze code.</p>\n\n<p>Here is a hamlet version example:</p>\n\n<pre><code>-- actual form example\nuserForm :: Form User\nuserForm = renderDivs $ User\n  &lt;$&gt; areq textField \"Login\" Nothing\n-- usage example\ngetPageR :: Handler Html\ngetPageR = do\n  ((_, widget), enctype') &lt;- runFormGet userForm\n  defaultLayout [whamlet|\n                 &lt;form method=post action=@{PageR} enctype=#{enctype'}&gt;\n                 ^{widget} -- This widget include.\n                 &lt;button&gt;Submit|]\n</code></pre>\n\n<p>But how can I rewrite it without hamlet? My current code is like this:</p>\n\n<pre><code>getPageR = do\n  ((_, widget), enctype') &lt;- runFormGet userForm\n  defaultLayout $ do\n    toWidgetBody $ \\render -&gt; do\n      H.div ! A.id \"form\" $ do\n        H.form ! A.method \"post\" ! A.action (action' render) ! A.enctype (enct' enctype) $ \"\"\n        -- widget include?\n        H.button \"Submit!\"\n   where\n     action' = \\render -&gt; toValue $! render (PageR) []\n     enct'   = toValue . renderHtml . toHtml\n</code></pre>\n\n<p>Obvously, type of the blaze code is Html, but userForm type is a Widget, so it cannot be connected. I can only add widget after <code>toWidgetBody</code> function, but then form will be after all content. Is there a way to include forms within blaze combinators(by rendering it to Html, maybe?) without hamlet <code>^{widget}</code> construct?</p>\n"}, {"tags": ["ruby", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 1, "creation_date": 1470837191, "post_id": 38874527, "comment_id": 65112137, "body": "FYI this is generally (in the language-agnostic sense) referred to as destructuring or destructuring bind, not pattern matching. <a href=\"https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node252.html\" rel=\"nofollow noreferrer\">cs.cmu.edu/Groups/AI/html/cltl/clm/node252.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "is_accepted": false, "score": 2, "last_activity_date": 1470834980, "creation_date": 1470834980, "answer_id": 38874579, "question_id": 38874527, "link": "https://stackoverflow.com/questions/38874527/ruby-array-pattern-matching/38874579#38874579", "title": "Ruby array pattern matching", "body": "<p>Pretty much the same. Try</p>\n\n<pre><code>fst, snd = str.split(\"_\", 2)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 5, "creation_date": 1470835546, "post_id": 38874699, "comment_id": 65110896, "body": "This is the only answer here so far, that answers the question as it stated and sheds a light on the difference between \u201cparallel assignment\u201d and \u201cpattern matching.\u201d BTW, the Haskell snippet in the OP is not a pattern matching example in the strict meaning."}, {"owner": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "edited": false, "score": 0, "creation_date": 1517622427, "post_id": 38874699, "comment_id": 84183572, "body": "It <i>is</i> very interesting. Now we just need the case/matching behavior in Ruby."}], "tags": [], "owner": {"reputation": 2374, "user_id": 1941418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8940942c798e82d460e0c058acfb3b7?s=128&d=identicon&r=PG", "display_name": "smefju", "link": "https://stackoverflow.com/users/1941418/smefju"}, "is_accepted": true, "score": 9, "last_activity_date": 1470835330, "creation_date": 1470835330, "answer_id": 38874699, "question_id": 38874527, "link": "https://stackoverflow.com/questions/38874527/ruby-array-pattern-matching/38874699#38874699", "title": "Ruby array pattern matching", "body": "<p>This is a parallel assignment in Ruby. You can assign an array to variables this way:</p>\n\n<pre><code>fst, snd = str.split(\"_\", 2)\n</code></pre>\n\n<p>You can also achieve head / tail behavior from Haskell by assigning rest of the array to a single variable:</p>\n\n<pre><code>head, *tail = \"foo_bar_baz\".split(\"_\")\n# head =&gt; \"foo\"\n# tail =&gt; [\"bar\", \"baz\"]\n</code></pre>\n\n<p>Without star in <code>tail</code>, it would assign only <code>bar</code> string and <code>baz</code> would \"disappear\".</p>\n"}, {"tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 2, "last_activity_date": 1470844870, "last_edit_date": 1470844870, "creation_date": 1470843991, "answer_id": 38878104, "question_id": 38874527, "link": "https://stackoverflow.com/questions/38874527/ruby-array-pattern-matching/38878104#38878104", "title": "Ruby array pattern matching", "body": "<p>@smefju's answer is nice but I'll just share a way that you can do even more <strong>destructuring assignment</strong> using ruby</p>\n\n<pre><code>def foo &amp;f\n  # watch the array get destructured in the block below\n  f.call [1,2,3,4,5], :sweet, :candy\nend\n\n# first block param is array, so we can destructure it if you want\nfoo do |(x,*xs),y,z|\n  puts %Q{\n    x: #{x}\n    xs: #{xs}\n    y: #{y}\n    z: #{z}\n  }\nend\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>x: 1\nxs: [2, 3, 4, 5]\ny: sweet\nz: candy\n</code></pre>\n\n<hr>\n\n<p>This is useful in all sorts of ways</p>\n\n<pre><code>hash = {a: 1, b: 2, c: 3}\nhash.reduce({}) do |acc,(k,v)|\n  puts %Q{\n    acc: #{acc}\n    k: #{k}\n    v: #{v}\n  }\n  acc.merge(k =&gt; v * v)\nend\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>acc: {}\nk: a\nv: 1\n\nacc: {:a=&gt;1}\nk: b\nv: 2\n\nacc: {:a=&gt;1, :b=&gt;4}\nk: c\nv: 3\n\n=&gt; {:a=&gt;1, :b=&gt;4, :c=&gt;9}\n</code></pre>\n\n<p>Aside from destructuring arrays tho, Ruby is pretty lacking in this department. You don't get true hash destructuring and there's no such thing as actual <strong>pattern matching</strong> in Ruby.</p>\n"}], "owner": {"reputation": 815, "user_id": 1873549, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ffe48c12d925ecdcfd9c5ae5e46e53a8?s=128&d=identicon&r=PG", "display_name": "Fraser Price", "link": "https://stackoverflow.com/users/1873549/fraser-price"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 1, "accepted_answer_id": 38874699, "answer_count": 3, "score": 3, "last_activity_date": 1470844870, "creation_date": 1470834847, "question_id": 38874527, "link": "https://stackoverflow.com/questions/38874527/ruby-array-pattern-matching", "title": "Ruby array pattern matching", "body": "<p>I am new to programming in Ruby and have seen that it has some functional capabilities. Was wondering if there is a way to pattern match on arrays; I am looking to accomplish the following:</p>\n\n<pre><code>split_string = str.split(\"_\", 2)\nfst = repo_branch_split.first\nsnd = repo_branch_split.second\n</code></pre>\n\n<p>in a Haskell-like manner:</p>\n\n<pre><code>split_string@(fst : snd) = str.split(\"_\", 2)\n</code></pre>\n\n<p>Is there anything similar in ruby or not?</p>\n"}, {"tags": ["haskell", "smallcheck"], "comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1470830298, "post_id": 38872094, "comment_id": 65107068, "body": "The practice seems do declare instances in production code, which I dislike too. For Arbitrary or Serial, in my personal projects, I think I can live with orphan instance. But It might be interesting do include theses instance in your production code, because it would be easier for other people to build new tests around your data types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1470839836, "post_id": 38872094, "comment_id": 65114333, "body": "@Jean-BaptistePotonnier, the <code>Arbitrary</code> instance used for internal testing may <i>intentionally</i> be different from the one you want to expose. It may, for example, want to make sure a balanced tree implementation works even for maximally unbalanced trees."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470857270, "post_id": 38872094, "comment_id": 65124970, "body": "@dfeuer I see ! I could imagine do make some performance test too, having different instances for different distributions of data."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1470839883, "creation_date": 1470839883, "answer_id": 38876486, "question_id": 38872094, "link": "https://stackoverflow.com/questions/38872094/testing-tasty-smallcheck-and-file-organisation-and-avoiding-orphan-instances/38876486#38876486", "title": "testing (tasty-smallcheck) and file organisation and avoiding orphan instances", "body": "<blockquote>\n  <p>How bad convention it is to leave orphan instances in testing related code?</p>\n</blockquote>\n\n<p>Not very. I agree with @Potonnier here. Orphan instances are unpleasant due to <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html#id608052\" rel=\"nofollow\">Haskell's open-world assumption</a>, but I would argue that your testing executable target is a fairly closed world. We can reasonably expect that nobody will import the modules provided by the test executable package, and that the modules there are the \"leaves\" of their dependency graph. As long as that much is true, it is hard to imagine a scenario where orphan instances would lead to the worst-case scenario: something like a false positive, where the test passes due to an orphan instance when in fact it should have failed. It is not a binary decision, but I think the cost-benefit analysis here weighs against including the testing libraries as dependencies.</p>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 38876486, "answer_count": 1, "score": 1, "last_activity_date": 1470839883, "creation_date": 1470828217, "last_edit_date": 1495540298, "question_id": 38872094, "link": "https://stackoverflow.com/questions/38872094/testing-tasty-smallcheck-and-file-organisation-and-avoiding-orphan-instances", "title": "testing (tasty-smallcheck) and file organisation and avoiding orphan instances", "body": "<p>A library is in src-directory and there is a data definition A. Code related to testing is in test-directory, as suggested in many tutorials, and that includes  Serial instance to generate the test cases, see links below:</p>\n\n<pre><code>instance Monad m =&gt; Serial m A where ...\n</code></pre>\n\n<p><code>cabal test</code> warns that this is an orphan instance. Is this unavoidable or is there an established convention to organize libs, e.g., move serial instance definition to where data A is defined? The latter one somehow feels a bit wrong as it would be nice to keep testing related stuff at test-directory. If this is typical way, in what ways one can avoid exposing the testing related stuff at the public interface? Write 'internal' version of all tested modules (that the public ones and the actual testing program would use)? Something similar was suggested in <a href=\"https://stackoverflow.com/questions/33620178/unit-testing-can-module-re-exports-avoid-having-to-expose-all-testable-module\">unit-testing question</a>.</p>\n\n<p>Or does this matter at all? How bad convention it is to leave orphan instances in testing related code?</p>\n\n<hr>\n\n<p><a href=\"https://stackoverflow.com/questions/20581177/smallcheck-making-types-instance-of-typeclass-serial\">SmallCheck: Making types instance of typeclass Serial</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/16555291/how-to-use-smallcheck-in-haskell\">How to use SmallCheck in Haskell?</a></p>\n"}, {"tags": ["algorithm", "haskell", "time-complexity"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 1, "creation_date": 1470815141, "post_id": 38867130, "comment_id": 65097112, "body": "As the input is only ASCII, you should try using <code>ByteString</code> everywhere instead of <code>String</code> to get O(1) indexing instead of O(n) in <code>sortFn</code> and much faster I/O."}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 2, "creation_date": 1470815253, "post_id": 38867130, "comment_id": 65097187, "body": "I am not familiar with Haskel, but what is the approach you are using, maybe u can briefly explain it ? The problem can be solved in <code>O(n)</code> and <code>O(n*log(n))</code> time and both should easily pass the test."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470815427, "post_id": 38867130, "comment_id": 65097283, "body": "This looks like at least <code>O(n^2)</code> as there&#39;s <code>O(n)</code> indexing inside the <code>O(n)</code> <code>minimumBy</code> callback, likely worse as the callback is calling itself."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470815883, "post_id": 38867130, "comment_id": 65097568, "body": "Ye, it is O(n^2) if you count in the string comparing algorithm."}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 6, "creation_date": 1470815921, "post_id": 38867130, "comment_id": 65097597, "body": "@FordO. If it is <code>O(n^2)</code> then the problem is the algorithm, not the language"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470816232, "post_id": 38867130, "comment_id": 65097781, "body": "@Dogbert Oh I didn&#39;t know that bytestring has O(1) indexing, I was considering to use text, which has <b>inefficient</b> index according to docs, so I used listArray + String instead. Problem is that if I use ByteString, I will have to use <code>B.pack . show</code> and I am afraid that it will slow down my algorithm too much."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 0, "creation_date": 1470816426, "post_id": 38867130, "comment_id": 65097892, "body": "@Yerken Are you sure? The sortFn is basically <code>string1 &gt; string2</code>."}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 2, "creation_date": 1470816565, "post_id": 38867130, "comment_id": 65097975, "body": "Pretty sure <code>O(n^2)</code> for a string of length <code>1e5</code> is already an order of <code>1e10</code> operations which is roughly a few seconds even in the best optimised <code>C</code> code on a powerful machine."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 0, "creation_date": 1470816858, "post_id": 38867130, "comment_id": 65098131, "body": "@Yerken Wow, in that case the solution is a bit more tricky than I thought. Thanks, I will try to find better algorithm."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470816922, "post_id": 38867130, "comment_id": 65098168, "body": "@FordO. where would you have to use <code>B.pack . show</code>? You can use the I/O functions in the <code>ByteString</code> module."}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 3, "creation_date": 1470816941, "post_id": 38867130, "comment_id": 65098181, "body": "Normally if you see a time limit of 0.5s, such as this problem you need to strive for a solution which is either linear or <code>O(n*log(n))</code>, if you want I can provide you with the approach, but then again it would be off-topic given the original topic is asking for troubleshooting haskell code :P"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470817298, "post_id": 38867130, "comment_id": 65098382, "body": "@Dogbert If I want to use <code>interact $ unlines . fmap ..</code> I need to be able to create [ByteString]. Do you have any solution, that doesn&#39;t use <code>interact</code> but keeps the elegancy?"}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470817478, "post_id": 38867130, "comment_id": 65098490, "body": "@FordO. There&#39;s <code>ByteString.interact</code>, <code>ByteString.Char8.unlines</code> and <code>ByteString.Char8.lines</code>."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470817646, "post_id": 38867130, "comment_id": 65098581, "body": "@Dogbert Ye, but the function I pass to fmap must be <code>fn :: ByteString -&gt; ByteString</code>, which means I will need to call <code>pack . show</code> (check how is the <code>proccess</code> function written)."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470818626, "post_id": 38867130, "comment_id": 65099160, "body": "@FordO. ah, you can make <code>proccess :: ByteString -&gt; String</code>. The only place you&#39;ll use <code>String</code> then is when converting the <code>Int</code> to a <code>String</code>, which should be fast enough as it&#39;s only going to be called once per line. The main performance killer here is the O(n) indexing in <code>compare</code> which will become O(1) with <code>ByteString</code>."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470818668, "post_id": 38867130, "comment_id": 65099181, "body": "@FordO. also, from the comment, it looks like you can just use <code>compare</code> on <code>String</code> or <code>ByteString</code>? Does that give a different result?"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470820861, "post_id": 38867130, "comment_id": 65100666, "body": "@Dogbert No I cant, that was just simplification for people who dont understand Haskell. Is the built in method that much faster than my function?"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1470821337, "post_id": 38867130, "comment_id": 65101074, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/120581/discussion-between-ford-o-and-dogbert\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 1, "creation_date": 1470845718, "post_id": 38876700, "comment_id": 65118461, "body": "much simpler - take the string x, and attach it to itself, x -&gt; x + x. Now build the suffix array and among them pick the minimum suffix with starting index from range [0..n-1]"}], "tags": [], "owner": {"reputation": 7985, "user_id": 475100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ozk6.jpg?s=128&g=1", "display_name": "Chris Kuklewicz", "link": "https://stackoverflow.com/users/475100/chris-kuklewicz"}, "is_accepted": false, "score": 0, "last_activity_date": 1478163702, "last_edit_date": 1478163702, "creation_date": 1470840403, "answer_id": 38876700, "question_id": 38867130, "link": "https://stackoverflow.com/questions/38867130/poor-runtime-of-on2-algorithm/38876700#38876700", "title": "Poor runtime of O(n^2) algorithm", "body": "<p>Your worst case is string with all elements equal, looks like <code>minimumDisjoin</code> is <em>O(n^2)</em>.</p>\n\n<p>Perhaps this would work, and may be <em>O(n)</em>:</p>\n\n<p>One pass over string to find list of indices of the minimal element.</p>\n\n<p>But rather than a list you want start position and length of consecutive runs of indices : run length encoded</p>\n\n<p>Handling wrap around goes next.</p>\n\n<p>Then take position(s) after the longest length run(s).</p>\n\n<p>Next pass needs to compare points after set of longest run only.  Worst case is this is half size of original list, and is comparing nonoverlapping strings, much more efficient than original overlapping problem.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1478163702, "creation_date": 1470814944, "last_edit_date": 1470817373, "question_id": 38867130, "link": "https://stackoverflow.com/questions/38867130/poor-runtime-of-on2-algorithm", "title": "Poor runtime of O(n^2) algorithm", "body": "<p>I am trying to solve <a href=\"http://www.spoj.com/problems/BEADS/\" rel=\"nofollow\">SPOJ Beads</a> with Haskell but I'm exceeding the time limit. I am <strike>pretty sure</strike> my algorithm complexity is the best I can get. Therefore I am suspicious that Haskell itself is the problem (library, strictness etc.), but I have no clue what it could be.</p>\n\n<pre><code>import           Data.Array\nimport           Data.List\n\nmain :: IO ()\nmain = do\n    x &lt;- readLn\n    interact $ unlines . fmap proccess . take x . lines\n\nproccess :: String -&gt; String\nproccess line = show $ minimumDisjoint line\n\nminimumDisjoint :: String -&gt; Int\nminimumDisjoint s = minimumBy sortFn [1..len] -- gets minimum elem from list O(n)\n    where\n    len = length s\n    str = listArray (1, len) s\n    sortFn i1 i2 = foo i1 i2  -- basically 'string1 &gt; string2' O(n)\n        where\n        foo i3 i4\n            | i3 &gt; len      = foo 1 i4\n            | i4 &gt; len      = foo i3 1\n            | i3 == i1 -1   = ord\n            | ord == EQ     = foo (i3+1) (i4+1)\n            | otherwise     = ord\n            where\n            ord = compare (str ! i3) (str ! i4)\n</code></pre>\n\n<p>Thank you for any advice!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1470814900, "post_id": 38866940, "comment_id": 65096959, "body": "<code>Maybe</code> is already an instance of <code>Monad</code>. It&#39;s also generally unclear what you&#39;re talking about. Does this code compile?"}, {"owner": {"reputation": 31, "user_id": 5659263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ee8854ca17ddf86fe99698c065ad905?s=128&d=identicon&r=PG&f=1", "display_name": "Devitect", "link": "https://stackoverflow.com/users/5659263/devitect"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470817334, "post_id": 38866940, "comment_id": 65098408, "body": "If this was compiling and working i would be less inclined to come onto stack overflow....  this isnt a standard maybe monad...Im logging stuff to the database  return x = Just $ sideEffects x   Just x &gt;&gt;= f  = f $ sideEffects x    My question is whether this is the correct approach to handle side effects  And because &gt;&gt;= can return nothing is: handle :: Input -&gt; Output or  handle :: Input -&gt; Maybe Output the correct signature"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1470822117, "post_id": 38866940, "comment_id": 65101625, "body": "What does <code>LogEventToDatabase</code> do? This probably doesn&#39;t pass the monad laws. To answer your question: no, this is not the right way to handle side effects in Haskell."}, {"owner": {"reputation": 31, "user_id": 5659263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ee8854ca17ddf86fe99698c065ad905?s=128&d=identicon&r=PG&f=1", "display_name": "Devitect", "link": "https://stackoverflow.com/users/5659263/devitect"}, "edited": false, "score": 0, "creation_date": 1470825756, "post_id": 38866940, "comment_id": 65104046, "body": "(LogEventToDatabase a) Inserts contents of &quot;a&quot; to the database and returns a."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470831637, "post_id": 38866940, "comment_id": 65107989, "body": "@Devitect It does this outside of IO?"}], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 1, "last_activity_date": 1470831926, "last_edit_date": 1495540013, "creation_date": 1470831926, "answer_id": 38873382, "question_id": 38866940, "link": "https://stackoverflow.com/questions/38866940/structuring-a-haskell-program/38873382#38873382", "title": "Structuring a Haskell program", "body": "<p><code>handle</code> should be of type <code>Input -&gt; IO Output</code> if you really want to do side-effects.</p>\n\n<p>But it's better to write a pure parser that keeps a list of all your error messages around. If they are just <code>String</code>s, and for example <a href=\"http://learnyouahaskell.com/for-a-few-monads-more\" rel=\"nofollow noreferrer\">using the Writer monad</a>:</p>\n\n<pre><code>handle :: Input -&gt; Writer [String] Output\n</code></pre>\n\n<p>Also, have you considered <a href=\"https://stackoverflow.com/a/6311338/214446\">using Parsec</a>, which is monad transformer?</p>\n"}], "owner": {"reputation": 31, "user_id": 5659263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ee8854ca17ddf86fe99698c065ad905?s=128&d=identicon&r=PG&f=1", "display_name": "Devitect", "link": "https://stackoverflow.com/users/5659263/devitect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470831926, "creation_date": 1470814365, "question_id": 38866940, "link": "https://stackoverflow.com/questions/38866940/structuring-a-haskell-program", "title": "Structuring a Haskell program", "body": "<p>Im trying to structure a haskell module as best i can and this is what i have come up with.</p>\n\n<p>The inputs can be Fix or Twitter\nand the output from the parsers can be maybe output, I want to tag the output from the parsers as either Structured or Unstructured.</p>\n\n<p>Is this the right type signatures? Am i using the maybe monad instance class correctly? Is this the right way to handle side effects in haskell?  </p>\n\n<pre><code>module Parsers.Parser(\n      handle\n    ) where\n\ndata Input = FIX Text\n        | Twitter Text\n\ndata Output = StructuredDataEvent Quote \n            | UnStructuredDataEvent  Text\n\nhandle :: Input -&gt; Output\nhandle (FIX r)      = fixParser  r &gt;&gt;=   StructuredDataEvent  \nhandle (Twitter r)  = twitterParser  r &gt;&gt;=  UnStructuredDataEvent\n\nsideEffects:: Output -&gt; Output\nsideEffects   a = LogEventToDatabase a\n\ninstance Monad Maybe where  \n    return x = Just $ sideEffects x  \n    Nothing &gt;&gt;= f = Nothing  \n    Just x &gt;&gt;= f  = f $ sideEffects x  \n    fail _ =  Nothing  \n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 7, "last_activity_date": 1470806884, "creation_date": 1470806884, "answer_id": 38864903, "question_id": 38864854, "link": "https://stackoverflow.com/questions/38864854/whats-stacks-default-template/38864903#38864903", "title": "What&#39;s stack&#39;s default template?", "body": "<p>As seen in the <a href=\"https://github.com/commercialhaskell/stack/blob/aac2c81dd020e399b49894c566075a495240baaf/src/Stack/New.hs#L355\" rel=\"noreferrer\">source code</a>, it's the template named <code>new-template</code>.</p>\n\n<p>It's located here: <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/new-template.hsfiles\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack-templates/blob/master/new-template.hsfiles</a></p>\n\n<p>In fact, when you try out your command - it says so:</p>\n\n<pre><code>sibi { ~ }-&gt; stack new foo\nDownloading template \"new-template\" to create project \"foo\" in foo/ ...\n</code></pre>\n"}], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 1, "accepted_answer_id": 38864903, "answer_count": 1, "score": 5, "last_activity_date": 1470806884, "creation_date": 1470806588, "question_id": 38864854, "link": "https://stackoverflow.com/questions/38864854/whats-stacks-default-template", "title": "What&#39;s stack&#39;s default template?", "body": "<p>When you don't specify the template, what is the default?</p>\n\n<p>i.e. when running the command <code>stack new foo</code>.</p>\n"}, {"tags": ["haskell", "lambda"], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1470807651, "post_id": 38864663, "comment_id": 65093066, "body": "Thanks, I wonder why would you need pattern matching for a single value that you know apriori."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 1, "creation_date": 1470807978, "post_id": 38864663, "comment_id": 65093207, "body": "@dimid You don&#39;t. I guess it makes the code a bit cleaner. You might not want to write <code>\\x -&gt; return n</code> because then the reader goes looking for where <code>x</code> is used when in reality it is just thrown away."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1470808686, "post_id": 38864663, "comment_id": 65093474, "body": "I see, so can it be simplified to <code>tick = fetch &gt;&gt;= (\\n -&gt; store (n + 1) &gt;&gt;= (return n))</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 1, "creation_date": 1470808800, "post_id": 38864663, "comment_id": 65093529, "body": "@dimid No: <code>return n</code> is the monadic action that does nothing interesting and produces <code>n</code>, whereas <code>\\() -&gt; return n</code> (or <code>\\x -&gt; return n</code> or <code>\\_ -&gt; return n</code>) is the function that ignores its argument, then does nothing interesting and produces <code>n</code>."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470808949, "post_id": 38864663, "comment_id": 65093592, "body": "@DanielWagner, thanks, now I finally understand it. Alec, could you add Daniel&#39;s comment to your answer?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1470810964, "post_id": 38864663, "comment_id": 65094702, "body": "@DanielWagner <code>\\() -&gt; ...</code> does <i>not</i> ignore its argument, unlike the other two. It evaluates the argument and compares it to <code>()</code>. <code>(\\_ -&gt; 0) undefined</code> is <code>0</code>; <code>(\\() -&gt; 0) undefined</code> throws an error."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1470812834, "post_id": 38864663, "comment_id": 65095757, "body": "@AlexeyRomanov That&#39;s true in theory, but generally not in practice. Pattern matching on <code>()</code> is pretty much always written just to clarify that the unit type really is what&#39;s being used, rather than because the difference between <code>\\_ -&gt; </code> and <code>\\() -&gt;</code> is expected to matter. It&#39;s almost never used as &quot;this could be <code>()</code>, or it could be a nonterminating value, and I&#39;ll check to make sure it&#39;s <code>()</code>&quot;; checking for that by pattern matching is pretty useless because you don&#39;t actually get to <i>handle</i> the error case if there is one; you just make a bigger error."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1470834090, "post_id": 38864663, "comment_id": 65109782, "body": "Using <code>(\\ () -&gt; ...)</code> instead of <code>(\\ _ -&gt; ...)</code> is a clarity that has a performance cost.  There has to be a call to evaluate the argument (unless the compiler can prove it&#39;s already evaluated), which is cheap, but not free."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1470835352, "post_id": 38864663, "comment_id": 65110752, "body": "you can use <code>&gt;&gt;</code> instead of <code>&gt;&gt;=</code> in cases where the previous value isn&#39;t used. e.g. <code>tick = fetch &gt;&gt;= \\n -&gt; store (n + 1) &gt;&gt; return n</code>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1470811093, "last_edit_date": 1470811093, "creation_date": 1470805648, "answer_id": 38864663, "question_id": 38864578, "link": "https://stackoverflow.com/questions/38864578/what-is-lambda-unit-in-haskell/38864663#38864663", "title": "What is lambda unit in haskell?", "body": "<p>Technically, the arguments to a lambda expression are actually patterns in Haskell (check out the first case of the EBNF for <code>exp</code> in the <a href=\"https://www.haskell.org/onlinereport/exps.html\" rel=\"nofollow\">Haskell 98 report</a>). So I can write a function like <code>\\(x,y) -&gt; x + y</code> which does the same thing as <code>\\t -&gt; fst t + snd t</code>. In this case, <code>\\() -&gt; return n</code> is pattern matching on the only possible value of type <code>()</code> - <code>()</code> itself.</p>\n\n<hr>\n\n<p>Here's the analogy spelled out explicitly. The same way I can write a function</p>\n\n<pre><code>f :: Num a =&gt; (a,a) -&gt; a\nf t = fst t + snd t\n</code></pre>\n\n<p>I can also write this function using <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow\">pattern matching</a></p>\n\n<pre><code>f' :: Num a =&gt; (a,a) -&gt; a\nf' (x,y) = x + y\n</code></pre>\n\n<p>Well the same holds for lambda expressions: I could write <code>\\(x,y) -&gt; x + y</code>. Then, the lambda <code>\\() -&gt; return n</code> is the same thing, except that pattern matching on values of type <code>()</code> is trivial: the only possible value is <code>()</code>.</p>\n\n<h2>EDIT</h2>\n\n<p>Just in case it isn't clear, <code>return :: Monad m =&gt; a -&gt; m a</code> is regular function that puts a value into a minimal monadic context, nothing to do with the <code>return</code> keyword present in many imperative languages.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "accepted_answer_id": 38864663, "answer_count": 1, "score": 2, "last_activity_date": 1470811093, "creation_date": 1470805198, "question_id": 38864578, "link": "https://stackoverflow.com/questions/38864578/what-is-lambda-unit-in-haskell", "title": "What is lambda unit in haskell?", "body": "<p>I'm a haskell beginner and trying to understand this definition of a counter based on a StateMonad. I know lambdas usually have variables, e.g.</p>\n\n<pre><code>(\\n -&gt; n + 1)\n</code></pre>\n\n<p>is a function  that takes an argument <code>n</code>, increments its value by 1, and returns the result. However, in this case instead of a variable there's a value, an empty tuple (unit).</p>\n\n<pre><code>tick :: StateMonad Int Int\ntick = fetch &gt;&gt;= (\\n -&gt; store (n + 1) &gt;&gt;= (\\() -&gt; return n))\n</code></pre>\n\n<p>It's taken from <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.29.4575\" rel=\"nofollow\">Generalising Monads to Arrows</a> page 5.</p>\n"}, {"tags": ["haskell", "conduit", "haskell-pipes"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1470803788, "last_edit_date": 1470803788, "creation_date": 1470802959, "answer_id": 38864188, "question_id": 38863820, "link": "https://stackoverflow.com/questions/38863820/how-do-you-save-a-file-using-conduit/38864188#38864188", "title": "How do you save a file using Conduit?", "body": "<p>A small minimal example of what you are trying to do using the <code>conduit</code> library:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-6.7\n     --install-ghc\n     runghc\n     --package conduit-extra\n     --package resourcet\n     --package conduit\n -}\n\nimport Data.Conduit.Binary (sinkFile, sourceFile)\nimport Control.Monad.Trans.Resource\nimport Data.Conduit (($$), await, Conduit, (=$), yield)\nimport Data.Monoid ((&lt;&gt;))\nimport Control.Monad.IO.Class\n\nmyConduit = do\n  str &lt;- await\n  case str of\n    Just x -&gt; do\n              liftIO $ print \"some processing\"\n              yield x\n              myConduit\n    Nothing -&gt; return ()\n\n\nsaveFile :: FilePath -&gt; FilePath -&gt; IO ()\nsaveFile f1 f2 = runResourceT $ sourceFile f1 $$ myConduit =$ sinkFile f2\n\nmain :: IO ()                 \nmain = saveFile \"test.txt\" \"atest.txt\"\n</code></pre>\n\n<blockquote>\n  <p>How should I implement the saveFile function so that when the strings xxs are fully processed, I can write it to disk? </p>\n</blockquote>\n\n<p>You implement that in your <code>myConduit</code> function. Note that in your example you are using <code>readFile</code> function call which will read the file lazily. Conduit provides it's own abstraction for reading and writing files, you should use that.</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 1, "accepted_answer_id": 38864188, "answer_count": 1, "score": 3, "last_activity_date": 1470803788, "creation_date": 1470800317, "question_id": 38863820, "link": "https://stackoverflow.com/questions/38863820/how-do-you-save-a-file-using-conduit", "title": "How do you save a file using Conduit?", "body": "<p>How do you save a file using conduit's library? I looked through conduit's tutorial but can't seem to find anything, here is my use case:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  xxs  &lt;- lines &lt;$&gt; (readFile filePath)\n  sourceList xxs =$ pipe $$ saveFile\n\npipe :: Monad m =&gt; Conduit String m String\npipe = undefined\n</code></pre>\n\n<p>So there's two question here:</p>\n\n<ol>\n<li><p>Does it make sense to use <code>lines</code> to convert a string into a list of\nstrings and then feeding it to <code>sourceList</code>?</p></li>\n<li><p>How should I implement the <code>saveFile</code> function so that when the strings\n<code>xxs</code> are fully processed, I can write it to disk? </p></li>\n</ol>\n"}, {"tags": ["haskell", "conduit", "haskell-pipes"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470798916, "post_id": 38863636, "comment_id": 65090595, "body": "What about using <code>lines</code> to break up <code>xxs</code> into a list of lines? See  <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#g:19\" rel=\"nofollow noreferrer\">Breaking into lines and words</a>"}, {"owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470799430, "post_id": 38863636, "comment_id": 65090689, "body": "That is neat, just to check the list of strings is lazily generated by <code>lines</code> right? So the whole list never exists in memory, each line is output and immediately consumed by sourceList, and any downstream conduits ..."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470800823, "post_id": 38863636, "comment_id": 65091000, "body": "Are you looking only for answers using \u201cconduit\u201d or as the tags imply are you also open to answers using \u201cpipes\u201d?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470800901, "post_id": 38863636, "comment_id": 65091023, "body": "If <code>TIO</code> refers to Data.Text.Lazy.IO, then yes. If <code>TIO</code> refers to Data.Text.IO then <code>readFile</code> will read the entire file into memory. In either case <code>lines</code> will still construct the list of lines lazily will allows for the possibility that only one line is resident in memory at a time."}, {"owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470800909, "post_id": 38863636, "comment_id": 65091025, "body": "@RowanBlush Open to using pipes, but strongly biased to using conduit. I figured people who used pipes have also used conduit so I was trying to cast a wider net."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470801125, "post_id": 38863636, "comment_id": 65091074, "body": "Perhaps you are looking for <code>lines</code> from Data.Conduit.Text: <a href=\"https://hackage.haskell.org/package/conduit-1.0.2/docs/Data-Conduit-Text.html#v:lines\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/conduit-1.0.2/docs/&hellip;</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1470803318, "post_id": 38863636, "comment_id": 65091580, "body": "Why do you want to make it like a list ? Just write your won conduit function to stream it without memory leak: <a href=\"http://stackoverflow.com/a/38864188/1651941\">stackoverflow.com/a/38864188/1651941</a>"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1470803612, "creation_date": 1470803612, "answer_id": 38864318, "question_id": 38863636, "link": "https://stackoverflow.com/questions/38863636/how-do-you-make-the-output-of-a-readfile-function-into-source-for-conduit/38864318#38864318", "title": "How do you make the output of a `readfile` function into source for conduit?", "body": "<blockquote>\n  <p>How do you make the output of a <code>readfile</code> function into source for conduit?</p>\n</blockquote>\n\n<p>The source function for reading files already exists in the package <a href=\"https://hackage.haskell.org/package/conduit-extra\">conduit-extra</a> in the form of <a href=\"https://hackage.haskell.org/package/conduit-extra-1.1.13.2/docs/Data-Conduit-Binary.html#v:sourceFile\">sourceFile</a>. You can also see various other combinators in that module like <code>conduitFile</code>, etc.</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 1, "accepted_answer_id": 38864318, "answer_count": 1, "score": 2, "last_activity_date": 1470803612, "creation_date": 1470798659, "question_id": 38863636, "link": "https://stackoverflow.com/questions/38863636/how-do-you-make-the-output-of-a-readfile-function-into-source-for-conduit", "title": "How do you make the output of a `readfile` function into source for conduit?", "body": "<p>I am opening some .txt file via:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  xxs  &lt;- TIO.readFile pathToFile\n  return ()\n</code></pre>\n\n<p>The .txt file is of form </p>\n\n<pre><code>str_1 \\n str_2 \\n ... str_m\n</code></pre>\n\n<p>And I would like to make xxs into a source so that it might look like:</p>\n\n<pre><code>sourceList [str_1, str_2, ..., str_m]\n</code></pre>\n\n<p>Does the conduit API provide a way to do it without doing some string manipulation on <code>xxs</code> first, thus making it into the form <code>[str_1, str_2, ..., str_m]</code>? </p>\n"}, {"tags": ["haskell", "esqueleto"], "comments": [{"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "edited": false, "score": 2, "creation_date": 1470799194, "post_id": 38863285, "comment_id": 65090655, "body": "It is not clear what you want, do you want the Haskell equivalent of this written in Esqueleto, or do you want to know how to write this with the <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3\" rel=\"nofollow noreferrer\">esqueleto</a> DSL?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "edited": false, "score": 0, "creation_date": 1470851282, "post_id": 38863285, "comment_id": 65121588, "body": "I realised there is no a <code>DATE_ADD</code> function. If I will need to implement it myself, any help would be appreciated."}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1470798837, "creation_date": 1470795826, "question_id": 38863285, "link": "https://stackoverflow.com/questions/38863285/haskell-esqueleto-function-to-compare-with-a-time-offset", "title": "Haskell Esqueleto function to compare with a time offset", "body": "<p>How could I do something similar to this in Esqueleto:</p>\n\n<pre><code>DATE_ADD(myDate, INTERVAL 2 HOUR) &gt; otherDate\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470797390, "post_id": 38863005, "comment_id": 65090308, "body": "You might want to take a look at <a href=\"https://ghc.haskell.org/trac/ghc/wiki/SharedLibraries/PlatformSupport\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/SharedLibraries/PlatformSuppor&zwnj;&#8203;t</a> and the <code>-ghc-options</code> parameter to <code>stack build</code>"}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 9, "last_activity_date": 1470806354, "creation_date": 1470806354, "answer_id": 38864812, "question_id": 38863005, "link": "https://stackoverflow.com/questions/38863005/how-do-i-get-stack-to-use-dynamic-linking/38864812#38864812", "title": "How do I get stack to use dynamic linking?", "body": "<p>Add '-dynamic' to <code>ghc-options</code> in your .cabal file.</p>\n\n<p>For example, in a project generated by <code>stack new simple-example simple</code>, the <code>simple</code> executable was 1.0M before adding '-dynamic' to <code>ghc-options</code>. It reduced to 12K after the change.</p>\n\n<p>Here's the relevant part of the <code>simple-example.cabal</code>:</p>\n\n<pre><code>executable simple-example\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n  ghc-options:         -dynamic\n</code></pre>\n\n<p>Build with <code>stack build</code> (no options are required).</p>\n\n<p>To show which libraries it's dynamically linked against, you can use the <code>ldd</code> tool (or <code>otool -L</code> on Mac).</p>\n\n<pre><code>$ otool -L .stack-work/install/x86_64-osx/lts-6.10/7.10.3/bin/simple-example\n.stack-work/install/x86_64-osx/lts-6.10/7.10.3/bin/simple-example:\n        @rpath/libHSbase-4.8.2.0-HQfYBxpPvuw8OunzQu6JGM-ghc7.10.3.dylib (compatibility version 0.0.0, current version 0.0.0)\n        @rpath/libHSinteger-gmp-1.0.0.0-2aU3IZNMF9a7mQ0OzsZ0dS-ghc7.10.3.dylib (compatibility version 0.0.0, current version 0.0.0)\n        @rpath/libHSghc-prim-0.4.0.0-8TmvWUcS1U1IKHT0levwg3-ghc7.10.3.dylib (compatibility version 0.0.0, current version 0.0.0)\n        @rpath/libHSrts-ghc7.10.3.dylib (compatibility version 0.0.0, current version 0.0.0)\n        @rpath/libffi.dylib (compatibility version 7.0.0, current version 7.2.0)\n        /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)\n</code></pre>\n"}], "owner": {"reputation": 1243, "user_id": 679688, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/688b35f9becc72d8ca0d2fbc76749119?s=128&d=identicon&r=PG", "display_name": "Joshua Chia", "link": "https://stackoverflow.com/users/679688/joshua-chia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2111, "favorite_count": 2, "answer_count": 1, "score": 11, "last_activity_date": 1470809389, "creation_date": 1470793688, "last_edit_date": 1470809389, "question_id": 38863005, "link": "https://stackoverflow.com/questions/38863005/how-do-i-get-stack-to-use-dynamic-linking", "title": "How do I get stack to use dynamic linking?", "body": "<p>I'm using <code>stack</code> to build projects and find that the generated executables are pretty large (10M) even for simple programs. In order to reduce the executable size, how can i get <code>stack</code> to build shared libraries and generate executables that dynamically link to shared libraries?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1470787981, "post_id": 38862276, "comment_id": 65088376, "body": "I temporarily closed this as a duplicate of &quot;<a href=\"http://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\">What is the monomorphism restriction?</a>&quot;. That question addresses how a <code>Num</code> instance is chosen for <code>a</code>, but I think does not address how a <code>Monad</code> instance is chosen for <code>m</code>. So I think it is not quite a duplicate, and deserves a careful answer."}, {"owner": {"reputation": 14152, "user_id": 1219414, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NNsne.jpg?s=128&g=1", "display_name": "Juan", "link": "https://stackoverflow.com/users/1219414/juan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1470788069, "post_id": 38862276, "comment_id": 65088394, "body": "Actually I&#39;m asking how a particular instance of monad is chosen for a generic monad. I&#39;m guessing it used list&#39;s <code>&gt;&gt;=</code> but I&#39;m not sure why."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470788910, "post_id": 38862276, "comment_id": 65088566, "body": "I suspect it might be the IO-monad. Normally ghci tries to <code>print</code> the REPL result, but if it encounters an IO-action it <i>executes</i> it instead and prints the result returned by the action. A type like <code>(Monad m, Num a) =&gt; m a</code> is compatible with <code>IO a</code>, and perhaps that is criteria it is using to decide whether to execute vs. print the current REPL expression."}, {"owner": {"reputation": 1596, "user_id": 5483583, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/58e00258c68a02aeb27dd3bb73728821?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian Schmitthenner", "link": "https://stackoverflow.com/users/5483583/fabian-schmitthenner"}, "edited": false, "score": 1, "creation_date": 1470789664, "post_id": 38862276, "comment_id": 65088731, "body": "I think this has nothing to do with monomorphism restriction, but is a combination of Int for defaulting (<a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.3.4\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/decls.html#sect4.3.4</a>) and using the io monad as repl"}], "answers": [{"comments": [{"owner": {"reputation": 14152, "user_id": 1219414, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NNsne.jpg?s=128&g=1", "display_name": "Juan", "link": "https://stackoverflow.com/users/1219414/juan"}, "edited": false, "score": 0, "creation_date": 1470790104, "post_id": 38862528, "comment_id": 65088813, "body": "So using any ambiguous expression that uses a typeclass other than the monad should give me an error instead of picking a default one?"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 14152, "user_id": 1219414, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NNsne.jpg?s=128&g=1", "display_name": "Juan", "link": "https://stackoverflow.com/users/1219414/juan"}, "edited": false, "score": 0, "creation_date": 1470790423, "post_id": 38862528, "comment_id": 65088873, "body": "@Juan, if for instance I type <code>return mempty</code> in <code>ghci</code> I get an ambiguous type error, so if I understand your question correctly, then yes."}, {"owner": {"reputation": 1596, "user_id": 5483583, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/58e00258c68a02aeb27dd3bb73728821?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian Schmitthenner", "link": "https://stackoverflow.com/users/5483583/fabian-schmitthenner"}, "edited": false, "score": 0, "creation_date": 1470790981, "post_id": 38862528, "comment_id": 65088987, "body": "But <code>mempty</code> (without the <code>return</code>) works and defaults to the <code>()</code> type"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14152, "user_id": 1219414, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NNsne.jpg?s=128&g=1", "display_name": "Juan", "link": "https://stackoverflow.com/users/1219414/juan"}, "edited": false, "score": 0, "creation_date": 1470791147, "post_id": 38862528, "comment_id": 65089030, "body": "@Juan No; see the question I <a href=\"http://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\">linked above</a> for details on the extended defaulting rules that are in play in ghci. If it is ambiguous, doesn&#39;t use <code>Monad</code>, and those rules don&#39;t apply, <i>then</i> you should get an error."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1596, "user_id": 5483583, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/58e00258c68a02aeb27dd3bb73728821?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian Schmitthenner", "link": "https://stackoverflow.com/users/5483583/fabian-schmitthenner"}, "edited": false, "score": 1, "creation_date": 1470791221, "post_id": 38862528, "comment_id": 65089040, "body": "@Fabian Check out <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/interactive-evaluation.html\" rel=\"nofollow noreferrer\">this</a> and search for <code>-XExtendedDefaultRules</code>. Note the third point &quot;The unit type () is added to the start of the standard list of types which are tried when doing type defaulting&quot; and the fact that we have a <code>Monoid</code> instance for <code>IO</code> and for <code>()</code>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1470789744, "creation_date": 1470789744, "answer_id": 38862528, "question_id": 38862276, "link": "https://stackoverflow.com/questions/38862276/how-does-ghci-pick-an-instance-of-the-monad-type-class-to-use-for-polymorphic-ac/38862528#38862528", "title": "How does GHCi pick an instance of the Monad type class to use for polymorphic actions?", "body": "<p>This follows the idea that GHCi is sort of like a giant <code>do</code> block of <code>IO</code>.  Whenever you type in something that is an expression it first tries to see if the type of the result can be specialized to something of the form <code>IO a</code>. If it can, it executes the <code>IO</code> action and just prints the result. Only otherwise does it print the result of the expression itself.</p>\n\n<p>To force GHCi to go to whatever specific monad you want, you can add a type annotation. Notice how <code>IO</code> gets treated differently (and the same way as the expression would have been treated without any annotation).</p>\n\n<pre><code>ghci&gt; return 10 &gt;&gt;= return :: Maybe Int\nJust 10\nghci&gt; return 10 &gt;&gt;= return :: [Int]\n[10]\nghci&gt; return 10 &gt;&gt;= return :: IO Int\n10\n</code></pre>\n\n<hr>\n\n<p>As an aside, there is an entirely different problem regarding what instance of <code>Num</code> is chosen, and that one has everything to do with defaulting rules and the monomorphism restriction.</p>\n"}], "owner": {"reputation": 14152, "user_id": 1219414, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NNsne.jpg?s=128&g=1", "display_name": "Juan", "link": "https://stackoverflow.com/users/1219414/juan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 38862528, "answer_count": 1, "score": 3, "last_activity_date": 1470820885, "creation_date": 1470787408, "last_edit_date": 1470820885, "question_id": 38862276, "link": "https://stackoverflow.com/questions/38862276/how-does-ghci-pick-an-instance-of-the-monad-type-class-to-use-for-polymorphic-ac", "title": "How does GHCi pick an instance of the Monad type class to use for polymorphic actions?", "body": "<p>I'm new to Haskell so this might be a noob question.</p>\n\n<p>When I do <code>return 10 &gt;&gt;= return</code> GHCi shows <code>10</code>. When I check the type of <code>return 10</code> with <code>:t</code> it just says <code>return 10 :: (Monad m, Num a) =&gt; m a</code>, and of I do <code>typeOf return 10</code> I get an error. </p>\n\n<p>But as far as I understand, Haskell must have used a particular instance of <code>&gt;&gt;=</code> to evaluate <code>return 10 &gt;&gt;= return</code>, so which instance did it use and how did it decide which one to use?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 3, "last_activity_date": 1470784598, "creation_date": 1470784598, "answer_id": 38861896, "question_id": 38861598, "link": "https://stackoverflow.com/questions/38861598/cannot-compile-a-module-importing-foreign-r/38861896#38861896", "title": "Cannot compile a module importing Foreign.R", "body": "<p>I've found <a href=\"http://tweag.github.io/HaskellR/docs/faq.html\" rel=\"nofollow\">a fix here</a>.</p>\n\n<p>On Ubuntu, I did:</p>\n\n<pre><code>sudo update-alternatives --install \"/usr/bin/ld\" \"ld\" \"/usr/bin/ld.gold\" 20\n</code></pre>\n\n<p>There's no error anymore when I compile now. </p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 38861896, "answer_count": 1, "score": 2, "last_activity_date": 1470784598, "creation_date": 1470782620, "question_id": 38861598, "link": "https://stackoverflow.com/questions/38861598/cannot-compile-a-module-importing-foreign-r", "title": "Cannot compile a module importing Foreign.R", "body": "<p>Here is a minimal module importing <code>Foreign.R</code> (note that it even doesn't use it):</p>\n\n<pre><code>-- test.hs\n{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Test where\n\nimport Foreign\nimport Foreign.R \n\nforeign export ccall testR :: Ptr (Double) -&gt; IO ()\n\ntestR :: Ptr (Double) -&gt; IO ()\ntestR result = do\n  poke result $ 1\n</code></pre>\n\n<p>This compilation fails:</p>\n\n<pre><code>ghc -fPIC -shared  -dynamic -lHSrts-ghc7.10.3 test.hs -o test.so\n</code></pre>\n\n<p>It gives:</p>\n\n<pre><code>Linking test.so ...\n/usr/bin/ld: test.o: r\u00e9adressage R_X86_64_PC32 vers symbole \u00ab\u00a0Test_testR_closure\u00a0\u00bb ne peut pas \u00eatre utilis\u00e9 en cr\u00e9ant un objet partag\u00e9 ; recompil\u00e9 avec -fPIC\n/usr/bin/ld\u00a0: \u00e9chec de l'\u00e9dition de liens finale\u00a0: Mauvaise valeur\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Sorry for French... In English it should look like: </p>\n\n<pre><code>Linking test.so ...\n/usr/bin/ld: test.o: relocation R_X86_64_PC32 to symbol  \u00ab\u00a0Test_testR_closure\u00a0\u00bb cannot be used by creating a shared object; recompile with -fPIC\n/usr/bin/ld\u00a0: failure edit final link\u00a0: Bad value\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>There's no problem if I remove <code>import Foreign.R</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1470770882, "post_id": 38858857, "comment_id": 65081945, "body": "<code>filter (flip elem &quot;aeiou&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4454161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4534a188f3bfd736909f688c58dc1fe9?s=128&d=identicon&r=PG&f=1", "display_name": "Fergus2k8", "link": "https://stackoverflow.com/users/4454161/fergus2k8"}, "edited": false, "score": 0, "creation_date": 1470771408, "post_id": 38858917, "comment_id": 65082235, "body": "I&#39;ve got it now thanks. Yeah I&#39;m aware that there are better ways to go about doing this but I&#39;m just using list comprehensions just to answer this question."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 10, "last_activity_date": 1470771559, "last_edit_date": 1470771559, "creation_date": 1470770840, "answer_id": 38858917, "question_id": 38858857, "link": "https://stackoverflow.com/questions/38858857/getting-vowels-from-a-string-and-printing-them-in-haskell/38858917#38858917", "title": "Getting Vowels from a String and printing them in Haskell", "body": "<h2>First of all</h2>\n\n<p>you're almost there </p>\n\n<pre><code>vowels xs = [ x | x &lt;- xs , x == 'a' ||\n                            x == 'e' ||\n                            x == 'i' ||\n                            x == 'o' ||\n                            x == 'u' ]\n</code></pre>\n\n<h2>But what is the actual error?</h2>\n\n<ol>\n<li>you were using the function as an input to your list</li>\n<li><code>String</code> litterals are surrounded by <code>\"</code> where <code>Char</code> litterals have <code>'</code> and internally <code>String</code>s in Haskell are just <code>[Char]</code> so you need to use characters.</li>\n</ol>\n\n<p>But haskell is known for conciseness and expressivity - list comprehensions are a nice way but can we do better?</p>\n\n<h2>yes we can!</h2>\n\n<p>What you actually, do is implement a <code>filter</code>, so let us analyze what you are filtering - vowels, so let us extract that part:</p>\n\n<pre><code>isVowel x = x == 'a' || ... || x == 'u'\n</code></pre>\n\n<p>well this is still not elegant, but there is a function called <code>elem</code> that checks whether something is contained in a list.</p>\n\n<pre><code>isVowel x = x `elem` ['a','e','i','o','u']\n</code></pre>\n\n<p>and knowing that <code>String</code> = <code>[Char]</code> we can rewrite that (using so called backtick-syntax which allows to use functions of 2 parameters as an infix function)</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel x = x `elem` \"aeiou\"\n</code></pre>\n\n<p>then coming back to the original problem now that we have a function telling us what a vowel is...</p>\n\n<pre><code>vowel :: String -&gt; String\nvowel = filter isVowel\n</code></pre>\n\n<p>now you might be interested where is the <code>xs</code> - well since haskell has a great type system it can derive that there is one parameter missing on both sides of the <code>=</code> sign, you don't need to write that yourself (this style is called pointfree).</p>\n"}], "owner": {"reputation": 69, "user_id": 4454161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4534a188f3bfd736909f688c58dc1fe9?s=128&d=identicon&r=PG&f=1", "display_name": "Fergus2k8", "link": "https://stackoverflow.com/users/4454161/fergus2k8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2298, "favorite_count": 1, "accepted_answer_id": 38858917, "answer_count": 1, "score": 3, "last_activity_date": 1470771559, "creation_date": 1470770614, "last_edit_date": 1470770758, "question_id": 38858857, "link": "https://stackoverflow.com/questions/38858857/getting-vowels-from-a-string-and-printing-them-in-haskell", "title": "Getting Vowels from a String and printing them in Haskell", "body": "<p>I've just started learning Haskell and I'm a bit stuck.</p>\n\n<p><a href=\"https://gyazo.com/b70aee3b5a031a6d65ea2fe993ea0824\" rel=\"nofollow\">https://gyazo.com/b70aee3b5a031a6d65ea2fe993ea0824</a></p>\n\n<p>I've made an attempt at it and I don't really know how to get my head around where I'm going wrong.</p>\n\n<pre><code>vowels :: String -&gt; String\nvowels [] = []\nvowels xs = [] ==  [ x | x &lt;- vowels , x == \"a\" || x == \"e\" || x == \"i\" || x == \"o\" ||  x == \"u\" ]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470765327, "post_id": 38857382, "comment_id": 65079034, "body": "Try <code>:set -XFlexibleContexts</code> at the GHCi prompt."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470765486, "post_id": 38857382, "comment_id": 65079109, "body": "@RowanBlush Thank you, it works. But then I can&#39;t print <code>x</code> (error when I type <code>x</code> at the prompt). Is it expected ?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470765770, "post_id": 38857382, "comment_id": 65079258, "body": "Ah! Fool me once, GHC... Alec has the best answer down below."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470766960, "post_id": 38857382, "comment_id": 65079900, "body": "@RowanBlush Alec&#39;s answer doesn&#39;t work, I already tried such things before posting my question. Is it possible to use <code>:set -XFlexibleContexts</code> in a module ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470767293, "post_id": 38857382, "comment_id": 65080062, "body": "I see, in a module I have to set <code>{-# LANGUAGE FlexibleContexts #-}</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470765979, "post_id": 38857510, "comment_id": 65079357, "body": "This gives ` Couldn&#39;t match expected type \u2018Int\u2019 with actual type \u2018[Integer]\u2019` and many other error messages."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766340, "post_id": 38857510, "comment_id": 65079551, "body": "I tried <code>[Int]</code> instead of <code>Int</code> but this doesn&#39;t work."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766367, "post_id": 38857510, "comment_id": 65079565, "body": "Hmmm what about <code>Int32</code>?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766616, "post_id": 38857510, "comment_id": 65079722, "body": "Not in scope. I also tried <code>[Double]</code>, this doesn&quot;t work."}, {"owner": {"reputation": 10175, "user_id": 848277, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d5cdc781dc896e21c88f1cd5ad1cc6b1?s=128&d=identicon&r=PG", "display_name": "pyCthon", "link": "https://stackoverflow.com/users/848277/pycthon"}, "edited": false, "score": 1, "creation_date": 1470768989, "post_id": 38857510, "comment_id": 65080907, "body": "Try adding the import <code>import Data.Int (Int32)</code>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1470766297, "last_edit_date": 1470766297, "creation_date": 1470765541, "answer_id": 38857510, "question_id": 38857382, "link": "https://stackoverflow.com/questions/38857382/create-a-sexp-vector-using-fromlist/38857510#38857510", "title": "Create a SEXP vector using fromList", "body": "<p>Try doing this instead:</p>\n\n<pre><code>&gt; let x = Data.Vector.SEXP.fromList ([2,3] :: [Int])\n</code></pre>\n\n<p>The problem is that in Haskell, number literals are overloaded, so <code>[2,3]</code> has type <code>Num a =&gt; [a]</code> instead of <code>[Int]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1470766233, "post_id": 38857538, "comment_id": 65079489, "body": "I can&#39;t enter your first two lines. Even when I add <code>let</code> before, I get a parse error at the second line."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766493, "post_id": 38857538, "comment_id": 65079643, "body": "Many errors such as ` Not in scope: type constructor or class \u2018V.Vector\u2019`."}, {"owner": {"reputation": 10175, "user_id": 848277, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d5cdc781dc896e21c88f1cd5ad1cc6b1?s=128&d=identicon&r=PG", "display_name": "pyCthon", "link": "https://stackoverflow.com/users/848277/pycthon"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766514, "post_id": 38857538, "comment_id": 65079655, "body": "@St&#233;phaneLaurent I&#39;ll put the correct qualified imports for you"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470766859, "post_id": 38857538, "comment_id": 65079852, "body": "still an error after the imports: &quot;Data constructor \u2018R.Real\u2019 cannot be used here       (Perhaps you intended to use DataKinds) &quot;"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470767095, "post_id": 38857538, "comment_id": 65079959, "body": "I managed to define <code>idvec</code> after setting <code>:set -XDataKinds</code>."}, {"owner": {"reputation": 10175, "user_id": 848277, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d5cdc781dc896e21c88f1cd5ad1cc6b1?s=128&d=identicon&r=PG", "display_name": "pyCthon", "link": "https://stackoverflow.com/users/848277/pycthon"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470767123, "post_id": 38857538, "comment_id": 65079973, "body": "try adding <code>{-# LANGUAGE DataKinds #-}</code> at the top"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1470767257, "post_id": 38857538, "comment_id": 65080050, "body": "I&#39;m in GHCI, so I set <code>:set -XDataKinds</code> and not <code>{-# LANGUAGE DataKinds #-}</code>. Now I can enter your code, but then I type <code>v</code> and I get something very strange. <code>fromList</code> appears in the console and GHCI is crashed."}], "tags": [], "owner": {"reputation": 10175, "user_id": 848277, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d5cdc781dc896e21c88f1cd5ad1cc6b1?s=128&d=identicon&r=PG", "display_name": "pyCthon", "link": "https://stackoverflow.com/users/848277/pycthon"}, "is_accepted": false, "score": 0, "last_activity_date": 1470766601, "last_edit_date": 1470766601, "creation_date": 1470765657, "answer_id": 38857538, "question_id": 38857382, "link": "https://stackoverflow.com/questions/38857382/create-a-sexp-vector-using-fromlist/38857538#38857538", "title": "Create a SEXP vector using fromList", "body": "<p>Another way taken from the <a href=\"https://github.com/tweag/HaskellR/blob/master/inline-r/tests/vector.hs\" rel=\"nofollow\">HaskllR unittests</a> is to specific a data type</p>\n\n<pre><code>import qualified Foreign.R as R\nimport qualified Data.Vector.SEXP as V\n\nidVec :: V.Vector s 'R.Real Double -&gt; V.Vector s 'R.Real Double\nidVec = id\n</code></pre>\n\n<p>Then:</p>\n\n<p><code>let v = idVec $ V.fromList [-1.9,-0.1,-2.9]</code></p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1470766601, "creation_date": 1470765075, "question_id": 38857382, "link": "https://stackoverflow.com/questions/38857382/create-a-sexp-vector-using-fromlist", "title": "Create a SEXP vector using fromList", "body": "<p>I'm trying to use the <a href=\"https://www.stackage.org/haddock/lts-6.10/inline-r-0.8.0.1/Data-Vector-SEXP.html\" rel=\"nofollow\">Data.Vector.SEXP</a> module. I am a newbie in Haskell. \nHere is what I do and get:</p>\n\n<pre><code>&gt; let x = Data.Vector.SEXP.fromList [2,3]\n\n&lt;interactive&gt;:35:5:\n    Non type-variable argument in the constraint: Num (ElemRep s ty)\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018x\u2019 has the inferred type\n      x :: forall s (ty :: Foreign.R.Type.SEXPTYPE).\n           (ty\n            Foreign.R.Constraints.:\u2208 '['Foreign.R.Type.Char,\n                                       'Foreign.R.Type.Logical, 'Foreign.R.Type.Int,\n                                       'Foreign.R.Type.Real, 'Foreign.R.Type.Complex,\n                                       'Foreign.R.Type.String, 'Foreign.R.Type.Vector,\n                                       'Foreign.R.Type.Expr, 'Foreign.R.Type.WeakRef,\n                                       'Foreign.R.Type.Raw],\n            Num (ElemRep s ty), Storable (ElemRep s ty),\n            Data.Singletons.SingI ty) =&gt;\n           Data.Vector.SEXP.Vector s ty (ElemRep s ty)\n</code></pre>\n\n<p>I am lost. I'd like to have an example of a SEXP vector created from a list.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470763859, "post_id": 38855360, "comment_id": 65078305, "body": "You mean the &quot;mime-mail-ses&quot; package, correct?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470764275, "post_id": 38855360, "comment_id": 65078502, "body": "@RowanBlush, yep, correct. Fixed it."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470765013, "post_id": 38855360, "comment_id": 65078896, "body": "Hm... I can&#39;t reproduce! <a href=\"https://gist.github.com/e1876b24d0e856dacd2c1dbe6f8161b5\" rel=\"nofollow noreferrer\">gist</a>. Do you get the same error if you load my parts.hs in GHCi and attempt to show <code>rendered</code>? If so I would guess it has to be a versioning issue..."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470765457, "post_id": 38855360, "comment_id": 65079087, "body": "@RowanBlush, indeed versioning issue. Fixed, and posted in the answer."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": true, "score": 2, "last_activity_date": 1470919469, "last_edit_date": 1470919469, "creation_date": 1470765438, "answer_id": 38857479, "question_id": 38855360, "link": "https://stackoverflow.com/questions/38855360/renderparts-error-in-mime-mail-package/38857479#38857479", "title": "renderParts error in mime-mail package", "body": "<p>This is a versioning issue. I had a local patched copy of <code>http-client</code> from github (to add some streaming validation that wasn't in <code>stackage</code> yet) which seems to be the culprit here. I fixed it by changing the http-client to point to <code>http-client</code> on stackage with the release version that had my fixes (<code>0.4.31</code>). Now, it works fine.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 38857479, "answer_count": 1, "score": 2, "last_activity_date": 1470919469, "creation_date": 1470757977, "last_edit_date": 1470764266, "question_id": 38855360, "link": "https://stackoverflow.com/questions/38855360/renderparts-error-in-mime-mail-package", "title": "renderParts error in mime-mail package", "body": "<p>I am trying to figure out how to send an email message through <code>AWS SES</code> using <a href=\"https://github.com/yesodweb/yesod/blob/master/demo/auth/email_auth_ses_mailer.hs#L114\" rel=\"nofollow\"><code>mime-mail-ses</code></a> package. I used <code>renderSendMailSES</code> example from <a href=\"https://github.com/yesodweb/yesod/blob/master/demo/auth/email_auth_ses_mailer.hs#L114\" rel=\"nofollow\"><code>Yesod wiki</code></a> to try the code below - I am using <code>renderMail</code> here to debug the error in <code>mail</code> body validation:</p>\n\n<pre><code>    *Main&gt; let textPart = Part {partType = \"text/plain; charset=utf-8\", \npartEncoding = None, partFilename = Nothing, partHeaders = [], partContent = \"Testing\"}\n    *Main&gt; let htmlPart = Part { partType = \"text/html; charset=utf-8\", \npartEncoding = None, partFilename = Nothing, partHeaders = [], partContent = \"Testing\"}\n    *Main&gt; renderMail' (emptyMail $ Address Nothing \"noreply@example.com\") {\n mailTo = [Address Nothing \"test@example.com\"] , mailHeaders =  [ (\"Subject\", \n\"Testing email address\")], mailParts = [[textPart, htmlPart]]}\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>*** Exception: renderParts called with null parts\n</code></pre>\n\n<p>This is quite head-scratcher because the above example doesn't seem any different from <code>Yesod Wiki</code>. I can't add attachment either because of the above error. An attachment if I am not mistaken, will look like this for <code>mailParts</code>:</p>\n\n<pre><code>mailParts = [[textPart,htmlPart],[attachment1]]\n</code></pre>\n\n<p>I looked in the code that is causing the error but can't figure out what is wrong.</p>\n\n<p>I will very much appreciate pointers to resolve this error.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1470770926, "post_id": 38853867, "comment_id": 65081966, "body": "Be sure to read <a href=\"http://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}], "answers": [{"tags": [], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "is_accepted": false, "score": 3, "last_activity_date": 1470754709, "last_edit_date": 1470754709, "creation_date": 1470754095, "answer_id": 38854005, "question_id": 38853867, "link": "https://stackoverflow.com/questions/38853867/haskell-transform-letters-into-numbers/38854005#38854005", "title": "Haskell - Transform letters into numbers", "body": "<p>You're looking for <code>ord</code> from <code>Data.Char</code>. This interpreter code does what you need:</p>\n\n<pre><code>ghci&gt; import Data.Char\nghci&gt; map ord \"Hi\"\n[72, 105]\n</code></pre>\n\n<p>You can create a function from this:</p>\n\n<pre><code>import Data.Char\n\ntoAscii :: [Char] -&gt; [Int]\ntoAscii str = map ord str\n</code></pre>\n\n<p>If you want to map letters to numbers so that e.g. <code>A=1</code> and <code>z=58</code>, you can do this:</p>\n\n<pre><code>import Data.Char\n\ntoOrder :: [Char] -&gt; [Int]\ntoOrder str = map (\\x -&gt; x - 64) $ map ord str\n-- or using composition of `toAscii`\ntoOrder str = map (\\x -&gt; x - 64) $ toAscii str\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 871, "user_id": 3422027, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uVM5L.jpg?s=128&g=1", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/3422027/brian-moreno"}, "edited": false, "score": 0, "creation_date": 1470755102, "post_id": 38854014, "comment_id": 65072816, "body": "Thanks, this is what I needed."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 3, "last_activity_date": 1470754123, "creation_date": 1470754123, "answer_id": 38854014, "question_id": 38853867, "link": "https://stackoverflow.com/questions/38853867/haskell-transform-letters-into-numbers/38854014#38854014", "title": "Haskell - Transform letters into numbers", "body": "<p>your counting might be one off</p>\n\n<pre><code>&gt; import Data.Char(ord,toUpper)\n&gt; map (\\x -&gt; ord (toUpper x) - ord 'A' + 6) \"Hi\"\n[13,14]\n</code></pre>\n"}], "owner": {"reputation": 871, "user_id": 3422027, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uVM5L.jpg?s=128&g=1", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/3422027/brian-moreno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 884, "favorite_count": 0, "accepted_answer_id": 38854014, "answer_count": 2, "score": -2, "last_activity_date": 1565664336, "creation_date": 1470753684, "last_edit_date": 1565664336, "question_id": 38853867, "link": "https://stackoverflow.com/questions/38853867/haskell-transform-letters-into-numbers", "title": "Haskell - Transform letters into numbers", "body": "<p>I'm very new to Haskell and would like to make a program to turn characters in a string into numbers. Something like this:</p>\n\n<pre><code>A = 06\nB = 07\nC = 08\n... Z\n</code></pre>\n\n<p>So for example:</p>\n\n<pre><code>Input: Hi \nOutput: 14 15\n</code></pre>\n\n<p>Does anyone know how I can go about doing this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1470753861, "post_id": 38853256, "comment_id": 65071828, "body": "@mb21 It&#39;s just a Reader wrapped around a Manager. If that&#39;s an indication that sharing the manager should be all that&#39;s needed, then I guess my problem is somewhere else."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470754124, "post_id": 38853256, "comment_id": 65072019, "body": "Did you see the section on <a href=\"https://hackage.haskell.org/package/http-client-0.5.1/docs/Network-HTTP-Client.html#g:14\" rel=\"nofollow noreferrer\">cookies</a>?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470754272, "post_id": 38853256, "comment_id": 65072140, "body": "@RowanBlush I did but it doesn&#39;t say whether I should update the cookie jar manually or what."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470754295, "post_id": 38853256, "comment_id": 65072160, "body": "Yeah, you&#39;ve gotta plumb that sucker around yourself."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470754390, "post_id": 38853256, "comment_id": 65072231, "body": "@RowanBlush Hmm, ok. I guess it&#39;s a good thing that the porting from <code>wreq</code> to <code>http-client</code> left my code in a way that doing this is pretty easy. If you&#39;re sure about this and want to make it an answer I&#39;ll gladly accept it."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1470754768, "creation_date": 1470754768, "answer_id": 38854245, "question_id": 38853256, "link": "https://stackoverflow.com/questions/38853256/sessions-with-http-client/38854245#38854245", "title": "Sessions with http-client", "body": "<p>It looks like you have to manage the cookie jar yourself with the functions <a href=\"https://hackage.haskell.org/package/http-client-0.5.1/docs/Network-HTTP-Client.html#v:createCookieJar\" rel=\"noreferrer\">createCookieJar</a>, <a href=\"https://hackage.haskell.org/package/http-client-0.5.1/docs/Network-HTTP-Client.html#v:updateCookieJar\" rel=\"noreferrer\">updateCookieJar</a> and <a href=\"https://hackage.haskell.org/package/http-client-0.5.1/docs/Network-HTTP-Client.html#v:insertCookiesIntoRequest\" rel=\"noreferrer\">insertCookiesIntoRequest</a>.</p>\n\n<p>Some example code:</p>\n\n<pre><code>import Network.HTTP.Client\nimport Network.HTTP.Types.Status (statusCode)\nimport Data.Time.Clock\n\nmain :: IO ()\nmain = do\n  manager &lt;- newManager defaultManagerSettings\n\n  now1 &lt;- getCurrentTime\n  request1 &lt;- parseRequest \"http://cnn.com\"\n  response1 &lt;- httpLbs request1 manager\n\n  putStrLn $ \"The status code was: \" ++ (show $ statusCode $ responseStatus response1)\n  -- print $ responseBody response\n\n  let (jar1, _) = updateCookieJar response1 request1 now1 (createCookieJar [])\n  putStrLn $ \"new jar: \" ++ show jar1\n\n  req2 &lt;- parseRequest \"http://cnn.com\"\n  now2 &lt;- getCurrentTime\n  let (request2, jar2) = insertCookiesIntoRequest req2 jar1 now2\n\n  response2 &lt;- httpLbs request2 manager\n\n  putStrLn $ \"\\nThe status code was: \" ++ (show $ statusCode $ responseStatus response2)\n  -- print $ responseBody response2\n</code></pre>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 1, "accepted_answer_id": 38854245, "answer_count": 1, "score": 1, "last_activity_date": 1470754768, "creation_date": 1470752117, "question_id": 38853256, "link": "https://stackoverflow.com/questions/38853256/sessions-with-http-client", "title": "Sessions with http-client", "body": "<p>Say I want to make two requests. The first one sends login information to the server and the second one retrieves some data that requires authentication.</p>\n\n<p>Is there anything special I need to do to get this behavior with <code>http-client</code>? The way it worked with <code>wreq</code> is by sharing the same <code>Session</code> value in both requests. The cookies and everything got handled automatically.</p>\n\n<p>I assumed the same would be true with <code>http-client</code> if I share the same <code>Manager</code> but this doesn't seem to be the case. I get a response indicating that I'm not logged in.</p>\n\n<p>Unfortunately I can't really provide a compilable code sample for various reasons.</p>\n"}, {"tags": ["haskell", "tuples"], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 9, "last_activity_date": 1470743476, "creation_date": 1470743476, "answer_id": 38849944, "question_id": 38849850, "link": "https://stackoverflow.com/questions/38849850/short-way-to-write-x-y-f-x-g-y/38849944#38849944", "title": "Short way to write (\\(x, y) -&gt; (f x, g y))", "body": "<p>You can use <code>(***)</code> from <code>Control.Arrow</code> i.e.</p>\n\n<pre><code>f *** g\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 7, "last_activity_date": 1470743813, "creation_date": 1470743813, "answer_id": 38850060, "question_id": 38849850, "link": "https://stackoverflow.com/questions/38849850/short-way-to-write-x-y-f-x-g-y/38850060#38850060", "title": "Short way to write (\\(x, y) -&gt; (f x, g y))", "body": "<p>Try</p>\n\n<pre><code>import Control.Arrow\n\nanswer = f *** g $ (a, c)\n</code></pre>\n\n<p>e.g.</p>\n\n<pre><code>import Control.Arrow\n\nf :: Int -&gt; Int\nf = (+1)\n\ng :: Double -&gt; String\ng = show\n\nanswer = f *** g $ (10, 3.5)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1470764235, "post_id": 38851007, "comment_id": 65078482, "body": "Sadly, that is not exactly the <code>Bifunctor</code> instance. It&#39;s actually <code>bimap f g ~(x, y) = (f x, g y)</code>, which is only &quot;morally correct&quot; and can cause a space leak if you&#39;re not careful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470764523, "post_id": 38851007, "comment_id": 65078636, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Bifunctor.html#line-78\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470764537, "post_id": 38851007, "comment_id": 65078645, "body": "Oops, I <i>thought</i> I had copied it from <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/src/Data-Bifunctor.html\" rel=\"nofollow noreferrer\">here</a>, but apparently not. My eye must have glossed over the <code>~</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 16, "last_activity_date": 1470754225, "last_edit_date": 1470754225, "creation_date": 1470746363, "answer_id": 38851007, "question_id": 38849850, "link": "https://stackoverflow.com/questions/38849850/short-way-to-write-x-y-f-x-g-y/38851007#38851007", "title": "Short way to write (\\(x, y) -&gt; (f x, g y))", "body": "<p>The <code>Bifunctor</code> instance of <code>(,)</code> is what you are looking for:</p>\n\n<pre><code>instance Bifunctor (,) where\n  bimap f g (a, b) = (f a, g b)\n</code></pre>\n\n<p><code>bimap</code> applies two functions to a tuple, one to each element.</p>\n\n<pre><code>&gt; import Data.Bifunctor\n&gt; bimap (+1) (*5) (1,1)\n(2, 5)\n</code></pre>\n\n<hr>\n\n<p>You might be wondering what the difference between <code>bimap</code> and <code>(***)</code> is. </p>\n\n<pre><code>&gt; :t bimap\nbimap :: Bifunctor p =&gt; (a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d\n&gt; :t (***)\n(***) :: Arrow a =&gt; a b c -&gt; a b' c' -&gt; a (b, b') (c, c')\n</code></pre>\n\n<p>With <code>bimap</code>, you can restrict the type to tuples rather than an arbitrary bifunctor <code>p</code>, so that with <code>p ~ (,)</code>, the type of <code>bimap</code> becomes</p>\n\n<pre><code> (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d).\n</code></pre>\n\n<p>With <code>(***)</code>, you can restrict the type to functions rather than an arbitrary arrow <code>a</code>, so that with <code>a ~ (-&gt;)</code>, the type of <code>(***)</code> becomes</p>\n\n<pre><code> (b -&gt; c) -&gt; (b' -&gt; c') -&gt; (b, b') -&gt; (c, c')\n</code></pre>\n\n<p>A close look reveals the two restricted types are equivalent.</p>\n"}], "owner": {"reputation": 7961, "user_id": 482601, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52578189717d3748d30828c5fff42ba9?s=128&d=identicon&r=PG", "display_name": "fabian789", "link": "https://stackoverflow.com/users/482601/fabian789"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "accepted_answer_id": 38851007, "answer_count": 3, "score": 7, "last_activity_date": 1470754225, "creation_date": 1470743213, "question_id": 38849850, "link": "https://stackoverflow.com/questions/38849850/short-way-to-write-x-y-f-x-g-y", "title": "Short way to write (\\(x, y) -&gt; (f x, g y))", "body": "<p>For functions <code>f :: a \u2192 b</code>, <code>g :: c \u2192 d</code>, how do I write the lambda</p>\n\n<pre><code>\\(x, y) \u2192 (f x, g y) :: (a, b) \u2192 (c, d)\n</code></pre>\n\n<p>more concisely? I tried <code>(f, g)</code> but \u2013 as was to be expected I guess \u2013 without success.</p>\n"}, {"tags": ["haskell", "syntax", "operators"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 3, "creation_date": 1470709143, "post_id": 38839838, "comment_id": 65047710, "body": "<a href=\"https://hackage.haskell.org/package/containers-unicode-symbols-0.3.1.1/docs/Data-Set-Unicode.html\" rel=\"nofollow noreferrer\">There&#39;s a library for this</a> ;)"}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1470798149, "post_id": 38839838, "comment_id": 65090459, "body": "@ MarLinn Wow! Thanks so much!"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470698893, "post_id": 38839885, "comment_id": 65045517, "body": "As the other answer indicates, the capitalization is also wrong."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 6, "last_activity_date": 1470699158, "last_edit_date": 1470699158, "creation_date": 1470698583, "answer_id": 38839885, "question_id": 38839838, "link": "https://stackoverflow.com/questions/38839838/how-to-create-an-alias-for-a-function-using-unicode-characters-in-haskell/38839885#38839885", "title": "How to create an alias for a function using Unicode characters in Haskell", "body": "<p>Just like when defining any other infix operator point-free, you need to wrap the operator in parentheses at its point of definition:</p>\n\n<pre><code>(\u2229) = Set.intersection\n(\u222a) = Set.union\n(\u2286) = Set.isSubsetOf\n(\u228a) = Set.isProperSubsetOf\n(\u2208) = Set.member\n</code></pre>\n\n<p>Because these characters are all classified as symbols, they are treated as infix operators, with or without <code>UnicodeSyntax</code> (which simply allows certain unicode characters in places reserved as language syntax, such as <code>::</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": true, "score": 5, "last_activity_date": 1470698652, "creation_date": 1470698652, "answer_id": 38839896, "question_id": 38839838, "link": "https://stackoverflow.com/questions/38839838/how-to-create-an-alias-for-a-function-using-unicode-characters-in-haskell/38839896#38839896", "title": "How to create an alias for a function using Unicode characters in Haskell", "body": "<p>You need to surround your new functions with parantheses when you declare them:</p>\n\n<pre><code>(\u2229) = Set.intersection\n</code></pre>\n\n<p>Note that you also need to remove capital letters from the function you import from <code>Data.Set</code>, because <code>Set.Intersection</code> is seen as a data constructor and not as a function (and doesn't exist in fact).</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 1, "accepted_answer_id": 38839896, "answer_count": 2, "score": 1, "last_activity_date": 1470735202, "creation_date": 1470698270, "last_edit_date": 1470735202, "question_id": 38839838, "link": "https://stackoverflow.com/questions/38839838/how-to-create-an-alias-for-a-function-using-unicode-characters-in-haskell", "title": "How to create an alias for a function using Unicode characters in Haskell", "body": "<p>I want to create Unicode aliases for some standard functions in the Haskell library. Here was my attempt. </p>\n\n<pre><code>{-# LANGUAGE UnicodeSyntax #-}\n{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport qualified Data.List as List\nimport qualified Data.Map  as Map\nimport qualified Data.Set  as Set\n\n\n-- Convenient aliases for common operations via Unicode symbols.\n\u2229 = Set.intersection\n\u222a = Set.union\n\u2286 = Set.isSubsetOf\n\u228a = Set.isProperSubsetOf\n\u2208 = Set.member \n\nmain = putStrLn \"Hello World!\"\n</code></pre>\n\n<p>When I try to compile this, I get the error</p>\n\n<pre><code>[~/Desktop]$ ghc --make test.hs\n[1 of 1] Compiling Main             ( test.hs, test.o )\n\ntest.hs:10:1: parse error on input \u2018\u2229\u2019\n[~/Desktop]$ \n</code></pre>\n\n<p>I want to use these unicode symbols as infix operators, and hopefully without the backticks. How does one do this? </p>\n"}, {"tags": ["haskell", "package", "cabal"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470696522, "post_id": 38839348, "comment_id": 65044907, "body": "What exactly do you mean by &quot;place it in your .yaml file&quot;? Can you give an example?"}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 15, "last_activity_date": 1506045050, "last_edit_date": 1506045050, "creation_date": 1470697449, "answer_id": 38839760, "question_id": 38839348, "link": "https://stackoverflow.com/questions/38839348/stack-yaml-file-cabal-file-differences/38839760#38839760", "title": "stack.yaml file &amp; .cabal file differences?", "body": "<p>All of the dependencies for your project go into the <code>.cabal</code> file. You are correct, though, that sometimes you also list packages in the <code>stack.yaml</code> file, which can be understandably confusing. Why is that?</p>\n\n<p>Well, the <code>.cabal</code> file always expresses your dependencies upon packages, but the <code>stack.yaml</code> file effectively configures <em>where those packages come from</em>. Usually, when using <code>stack</code>, packages come from Stackage based on the <em>resolver</em> you specify in the <code>stack.yaml</code> file. However, Stackage does not include all the packages in Hackage, and it is not intended to\u2014when you need packages that live outside of Stackage, you have to specify them in the <code>stack.yaml</code> file.</p>\n\n<p>Why is this? Well, the resolver automatically couples two important pieces of information together: package names <em>and</em> package versions. Stackage resolvers provide a (weak) guarantee that all of the packages within a single resolver will work together, so when a package comes from a resolver, there is no need to manually pick which version you want. Instead, Stackage will decide for you.</p>\n\n<p>When pulling packages from Hackage, you do not have this luxury, so you need to specify packages <em>and</em> their versions using <code>extra-deps</code>. For example, you might have something like this:</p>\n\n<pre><code>extra-deps:\n- crypto-pubkey-openssh-0.2.7\n- data-bword-0.1\n- data-dword-0.3\n</code></pre>\n\n<p>This entry determines specifically which versions of which packages should be pulled from Hackage rather than Stackage.</p>\n\n<hr>\n\n<p>When building an application, this might seem a little redundant\u2014you can specify version constraints in the <code>.cabal</code> file, too, so why duplicate them in the <code>stack.yaml</code> file? However, when building a library, the distinction is a little more significant: the <code>.cabal</code> file expresses the actual version constraints of your library (if any), but the <code>stack.yaml</code> file specifies precisely which versions to actually install when developing locally.</p>\n\n<p>In this sense, the <code>stack.yaml</code> file serves a purpose similar to the <code>Gemfile.lock</code> or <code>npm-shrinkwrap.json</code> files of other package managers, though the responsibilities are not nearly as clear-cut with <code>stack</code> (in part due to historical reasons around how Haskell\u2019s package system works and some of the problems it\u2019s had in the past).</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 2, "accepted_answer_id": 38839760, "answer_count": 1, "score": 8, "last_activity_date": 1506045050, "creation_date": 1470694761, "last_edit_date": 1470696589, "question_id": 38839348, "link": "https://stackoverflow.com/questions/38839348/stack-yaml-file-cabal-file-differences", "title": "stack.yaml file &amp; .cabal file differences?", "body": "<p>I have recently started using stack for Haskell, when specifying external dependencies for your project. Sometimes you place it in the .cabal file while other times you place it in the .yaml file.</p>\n\n<p>Am I right in thinking that when you put it in the cabal file it only looks in the stackage repository for your packages. However when you place it in your .yaml file it also searches in the Hackage server, if it cannot find it in any of the snapshots?</p>\n"}, {"tags": ["haskell", "avl-tree", "display"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6693065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac93aa56ff87bb44f20f9d482f3928ef?s=128&d=identicon&r=PG&f=1", "display_name": "PremiumWall", "link": "https://stackoverflow.com/users/6693065/premiumwall"}, "edited": false, "score": 0, "creation_date": 1470696936, "post_id": 38839441, "comment_id": 65045039, "body": "Thanks for the quick help! Could you explain how the Data.Tree goes about doing this? And also, for this line  <code>test = putStrLn $ T.drawTree (toTree avl)</code>  what does the &#39;putStrLn $&#39; do exactly?  Sorry if it&#39;s an obvious answer, as I&#39;m used to just calling out the function and giving parameters like in the example inputs above"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 21, "user_id": 6693065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac93aa56ff87bb44f20f9d482f3928ef?s=128&d=identicon&r=PG&f=1", "display_name": "PremiumWall", "link": "https://stackoverflow.com/users/6693065/premiumwall"}, "edited": false, "score": 0, "creation_date": 1470699281, "post_id": 38839441, "comment_id": 65045601, "body": "<code>putStrLn $ ...</code> is the same as <code>putStr (...)</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1470695327, "creation_date": 1470695327, "answer_id": 38839441, "question_id": 38839217, "link": "https://stackoverflow.com/questions/38839217/i-need-help-on-display-an-avl-tree-in-haskell/38839441#38839441", "title": "I need help on display an AVL Tree in Haskell", "body": "<p>You can use use the Data.Tree library by first converting your AVL tree to\na Data.Tree.Tree:</p>\n\n<pre><code>import qualified Data.Tree as T\n\ndata AVL t = Empty | Node t (AVL t) (AVL t) Int\n                 deriving (Eq, Ord, Show)\n\ntoTree :: Show t =&gt; AVL t -&gt; T.Tree String\ntoTree Empty = T.Node \"Empty\" [] \ntoTree (Node t left right a)\n  = T.Node (show t ++ \" \" ++ show a) [toTree left, toTree right]\n\navl = Node 2 (Node 1 Empty Empty 0) (Node 3 Empty (Node 4 Empty Empty 0) (-1)) (-1)\n\ntest = putStrLn $ T.drawTree (toTree avl)\n</code></pre>\n\n<p>Running <code>test</code> prints:</p>\n\n<pre><code>2 -1\n|\n+- 1 0\n|  |\n|  +- Empty\n|  |\n|  `- Empty\n|\n`- 3 -1\n   |\n   +- Empty\n   |\n   `- 4 0\n      |\n      +- Empty\n      |\n      `- Empty\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 6693065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac93aa56ff87bb44f20f9d482f3928ef?s=128&d=identicon&r=PG&f=1", "display_name": "PremiumWall", "link": "https://stackoverflow.com/users/6693065/premiumwall"}, "edited": false, "score": 0, "creation_date": 1470698810, "post_id": 38839762, "comment_id": 65045494, "body": "Hi, thanks for the response! However I neglected to mention that I would like to have an implementation that wouldn&#39;t have to rely on the likes of Data.Tree (answer above) or PrettyPrint. Any suggestions?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 21, "user_id": 6693065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac93aa56ff87bb44f20f9d482f3928ef?s=128&d=identicon&r=PG&f=1", "display_name": "PremiumWall", "link": "https://stackoverflow.com/users/6693065/premiumwall"}, "edited": false, "score": 0, "creation_date": 1470699869, "post_id": 38839762, "comment_id": 65045757, "body": "@PremiumWall Updated. (Checked by brain, not by compiler.)"}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 4, "last_activity_date": 1470699820, "last_edit_date": 1470699820, "creation_date": 1470697462, "answer_id": 38839762, "question_id": 38839217, "link": "https://stackoverflow.com/questions/38839217/i-need-help-on-display-an-avl-tree-in-haskell/38839762#38839762", "title": "I need help on display an AVL Tree in Haskell", "body": "<p>What you're looking for is a pretty printer! I always use the &ldquo;<a href=\"http://hackage.haskell.org/package/pretty\" rel=\"nofollow\">pretty</a>&rdquo; package on Hackage.</p>\n\n<pre><code>import Text.PrettyPrint\n</code></pre>\n\n<p>Your tree is a pretty simple structure, so I'm just going to define it all in one shot. There are many helpful combinators in <code>Text.PrettyPrint</code> though, so check them out! They're very easy to use in GHCi too, so when you don't understand the documentation, just give it a whirl.</p>\n\n<pre><code>prettyTree :: Show t =&gt; AVL t -&gt; Doc\nprettyTree Empty          = text \"Empty\"\nprettyTree (Node t l r _) = text (show t)\n                            $+$ nest 1 (prettyTree l)\n                            $+$ nest 1 (prettyTree r)\n</code></pre>\n\n<p><code>Doc</code> has a <code>Show</code> instance that you will probably be fine with, or you can use the more powerful styling functions.</p>\n\n<pre><code>\u03bb let tree = Node 2 (Node 1 Empty Empty 0) (Node 3 Empty (Node 4 Empty Empty 0) (-1)) (-1)\n\u03bb prettyTree (tree :: AVL Int)\n2\n 1\n  Empty\n  Empty\n 3\n  Empty\n  4\n   Empty\n   Empty\n</code></pre>\n\n<hr>\n\n<p>If you wanted to do this without any external dependencies, just crib the style but sub in your own shims for the combinators.</p>\n\n<pre><code>type Doc = [String]\n\ntext :: String -&gt; Doc\ntext = pure\n\nindent :: Doc -&gt; Doc\nindent = map (' ':)\n\nvertical :: Doc -&gt; Doc -&gt; Doc\nvertical = (++)\n\nprettyTree :: Show t =&gt; AVL t -&gt; Doc\nprettyTree Empty          = text \"Empty\"\nprettyTree (Node t l r _) = vertical (text (show t))\n                                     (indent (vertical (prettyTree l)\n                                                       (prettyTree r)))\n\nrender :: Doc -&gt; String\nrender = concat\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6693065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac93aa56ff87bb44f20f9d482f3928ef?s=128&d=identicon&r=PG&f=1", "display_name": "PremiumWall", "link": "https://stackoverflow.com/users/6693065/premiumwall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1470699820, "creation_date": 1470693898, "last_edit_date": 1470698645, "question_id": 38839217, "link": "https://stackoverflow.com/questions/38839217/i-need-help-on-display-an-avl-tree-in-haskell", "title": "I need help on display an AVL Tree in Haskell", "body": "<pre><code>data AVL t = Empty | Node t (AVL t) (AVL t) Int\n                 deriving (Eq, Ord, Show)\n\n\ninsertNode :: (Ord a) =&gt; a -&gt; AVL a -&gt; AVL a\ninsertNode x Empty = Node x Empty Empty 0\ninsertNode x (Node n left right balanceFactor)\n    | x &lt; n = let leftNode = insertNode x left\n              in\n               balanceTree (Node n leftNode right ((treeHeight leftNode) - (treeHeight right)))\n    | otherwise = let rightNode = insertNode x right\n                  in\n                   balanceTree (Node n left rightNode ((treeHeight left) - (treeHeight rightNode)))\n\nfindNode :: AVL a -&gt; a\nfindNode Empty = error \"findNode from Empty\"\nfindNode (Node a _ _ _) = a\n\nfindLeftNode :: AVL a -&gt; AVL a\nfindLeftNode Empty = error \"findLeftNode from Empty\"\nfindLeftNode (Node _ left _ _) = left\n\nfindRightNode :: AVL a -&gt; AVL a\nfindRightNode Empty = error \"findRightNode from Empty\"\nfindRightNode (Node _ _ right _) = right\n\nfindBalanceFactor :: AVL a -&gt; Int\nfindBalanceFactor Empty = 0\nfindBalanceFactor (Node _ _ _ bf) = bf\n\ntreeHeight :: AVL a -&gt; Int\ntreeHeight Empty = 0\ntreeHeight (Node _ left right _) = 1 + (max (treeHeight left) (treeHeight right))\n\nbalanceTree :: AVL a -&gt; AVL a\nbalanceTree Empty = Empty\nbalanceTree (Node r Empty Empty bf) = Node r Empty Empty bf\nbalanceTree (Node r left right bf)\n    | bf == -2 &amp;&amp; rbf == -1 = let rl = (findLeftNode right)\n                              in\n                               (Node (findNode right)                                                               -- This is for the\n                               (Node r left rl ((treeHeight left) - (treeHeight rl)))                               -- \"right right\" case\n                               (findRightNode right)\n                               ((1 + (max (treeHeight left) (treeHeight rl))) - (treeHeight (findRightNode right)))\n                               )\n    | bf == -2 &amp;&amp; rbf == 1 = let rl = findLeftNode right\n                                 rr = findRightNode right\n                             in\n                              (Node (findNode (rl))                                                                 -- This is for the\n                              (Node r left (findLeftNode rl) ((treeHeight left) - (treeHeight (findLeftNode rl))))  -- \"right left\" case\n                              (Node (findNode right) (findRightNode rl) rr ((treeHeight (findRightNode rl)) - (treeHeight rr)))\n                              ((max (treeHeight left) (treeHeight (findLeftNode rl))) - (max (treeHeight (findRightNode rl)) (treeHeight rr)))\n                              )\n    | bf == 2 &amp;&amp; lbf == 1 = let lr = findRightNode left\n                            in\n                             (Node (findNode left)                                                                  -- This is for the\n                             (findLeftNode left)                                                                    -- \"left left\" case\n                             (Node r lr right ((treeHeight lr) - (treeHeight right)))\n                             ((treeHeight (findLeftNode left)) - (1 + (max (treeHeight lr) (treeHeight right))))\n                             )\n    | bf == 2 &amp;&amp; lbf == -1 = let lr = findRightNode left\n                                 ll = findLeftNode left\n                             in\n                              (Node (findNode lr)                                                                              -- This is for the\n                              (Node (findNode left) ll (findLeftNode lr) ((treeHeight ll) - (treeHeight (findLeftNode lr))))   -- \"left right\" case\n                              (Node r (findRightNode lr) right ((treeHeight (findRightNode lr)) - (treeHeight right)))\n                              ((max (treeHeight ll) (treeHeight (findLeftNode lr))) - (max (treeHeight(findRightNode lr)) (treeHeight right)))\n                              )\n    | otherwise = (Node r left right bf)\n    where rbf = findBalanceFactor right\n          lbf = findBalanceFactor left\n</code></pre>\n\n<p>This is the current state of my implementation of an AVL Tree. The normal input is usually:</p>\n\n<pre><code>insertNode 4 (Node 2 (Node 1 Empty Empty 0) (Node 3 Empty Empty 0) 0)\n</code></pre>\n\n<p>which results in:</p>\n\n<pre><code>Node 2 (Node 1 Empty Empty 0) (Node 3 Empty (Node 4 Empty Empty 0) (-1)) (-1)\n</code></pre>\n\n<p>I want to now have a function to display an inputted tree in a neat fashion, for example, the tree directly above:</p>\n\n<pre><code>2\n 1\n  Empty\n  Empty\n 3\n  Empty\n  4\n   Empty\n   Empty\n</code></pre>\n\n<p>Does anyone have any suggestions as to how this could be implemented? I wish for the Nodes to be displayed only, and once it reaches the end of a branch it prints \"Empty\". I've hit quite a brick wall and tried a few attempts with little success.</p>\n\n<p>EDIT: Hi guys, thanks for the quick responses. Your suggestions do work, however, I would like an implementation of displaying the tree without the use of packages or libraries. Sorry for not clarifying this!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470691749, "post_id": 38838688, "comment_id": 65043194, "body": "You can also use <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3E\" rel=\"nofollow noreferrer\">hayoo</a> to search for info on Haskell operations and functions."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1470693040, "post_id": 38838688, "comment_id": 65043733, "body": "Be sure to read <a href=\"http://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1470707536, "post_id": 38838688, "comment_id": 65047315, "body": "You may want to check out <a href=\"https://haskell-lang.org/tutorial/operators\" rel=\"nofollow noreferrer\">haskell-lang.org/tutorial/operators</a>"}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 15, "last_activity_date": 1470693479, "last_edit_date": 1470693479, "creation_date": 1470692481, "answer_id": 38838948, "question_id": 38838688, "link": "https://stackoverflow.com/questions/38838688/what-is-the-meaning-of-the-haskell-operator/38838948#38838948", "title": "What is the meaning of the Haskell operator &quot;&lt;&gt;&quot;?", "body": "<p>It's an alias for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#v:mappend\" rel=\"noreferrer\"><code>mappend</code></a>, from the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"noreferrer\"><code>Data.Monoid</code></a> module.</p>\n\n<pre><code>(&lt;&gt;) :: Monoid m =&gt; m -&gt; m -&gt; m\n(&lt;&gt;) = mappend\n</code></pre>\n\n<p><code>mappend</code> smashes two monoidal values together. For example, using the list monoid,</p>\n\n<pre><code>ghci&gt; [1,2,3] &lt;&gt; [4,5,6]\n[1,2,3,4,5,6]\n</code></pre>\n\n<p>When you see a function you don't recognise, you can often find it on API search engines like <a href=\"http://hoogle.haskell.org/?hoogle=%3C%3E&amp;scope=set%3Astackage\" rel=\"noreferrer\">Hoogle</a> or <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3E\" rel=\"noreferrer\">Hayoo</a>.</p>\n"}], "owner": {"reputation": 123, "user_id": 1505104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dfc3b53cdedd788963fb9f91261f061?s=128&d=identicon&r=PG", "display_name": "Greg Howard", "link": "https://stackoverflow.com/users/1505104/greg-howard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5432, "favorite_count": 0, "accepted_answer_id": 38838948, "answer_count": 1, "score": 9, "last_activity_date": 1470693479, "creation_date": 1470691173, "last_edit_date": 1470691405, "question_id": 38838688, "link": "https://stackoverflow.com/questions/38838688/what-is-the-meaning-of-the-haskell-operator", "title": "What is the meaning of the Haskell operator &quot;&lt;&gt;&quot;?", "body": "<p>In Haskell, what is the meaning of the <code>&lt;&gt;</code> operator (as distinct from <code>&lt;*&gt;</code> or <code>&lt;$&gt;</code>). I am seeing references to it while researching <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"noreferrer\">the optparse-applicative package</a>. Neither Google nor LYAH seem to have any information.</p>\n"}, {"tags": ["haskell", "haskell-diagrams"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470685834, "post_id": 38836730, "comment_id": 65040402, "body": "What happens if you explicitly give <code>mywedge</code> the same type as <code>annularWedge</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1470685812, "creation_date": 1470685812, "answer_id": 38837406, "question_id": 38836730, "link": "https://stackoverflow.com/questions/38836730/how-to-combine-annularwedge-and-wedge-from-haskells-diagrams-package/38837406#38837406", "title": "How to combine `annularWedge` and `wedge` from Haskell&#39;s diagrams package?", "body": "<p>Just follow the suggestions that GHC gives you:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Diagrams\nimport Diagrams.TwoD.Arc\n\nmywedge r2 r1 d a\n  | r1 == 0   = wedge r2 d a\n  | otherwise = annularWedge r2 r1 d a\n</code></pre>\n\n<p>In general, though, I prefer to use a <code>&lt;=</code> comparison when dealing\nwith floating point numbers, i.e. something like:</p>\n\n<pre><code>  | r1 &lt;= 1e-10 = wedge r2 d 1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1470687791, "last_edit_date": 1495540843, "creation_date": 1470686444, "answer_id": 38837559, "question_id": 38836730, "link": "https://stackoverflow.com/questions/38836730/how-to-combine-annularwedge-and-wedge-from-haskells-diagrams-package/38837559#38837559", "title": "How to combine `annularWedge` and `wedge` from Haskell&#39;s diagrams package?", "body": "<p>The solution is simple. As ErikR said, add <code>{-# LANGUAGE FlexibleContexts, TypeFamilies #-}</code> to the top of your file. To be clear, these are both safe extensions to add (some extensions, like overlapping instances or undecidable instances should make you pause before you enable them, but these extensions are <a href=\"https://stackoverflow.com/questions/18229572/what-are-the-pitfalls-of-using-flexiblecontexts-and-flexibleinstances\">mostly</a> safe)</p>\n\n<p>Although it isn't obvious, the <code>wedge</code> signature's constraints are strictly weaker than the <code>annularWedge</code>s ones.</p>\n\n<h3>If you are curious as to why the signatures look so different, read on...</h3>\n\n<p>For starters, the constraints, once you track them down, aren't all that different. Let's start with <code>wedge</code>.</p>\n\n<pre><code>(InSpace V2 n t, OrderedField n, TrailLike t)\n</code></pre>\n\n<p>Looking at the definition of <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-Core-V.html#t:InSpace\" rel=\"nofollow noreferrer\"><code>InSpace</code></a>, you see that it has no functions, it's essentially like a synonym: <code>(V a ~ v, N a ~ n, Additive v, Num n) =&gt; InSpace v n a</code>. Then, we can expand <code>InSpace V2 n t</code> to <code>(V t ~ V2, N t ~ n, Additive V2, Num n)</code>. Similarly, <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-Core-Envelope.html#t:OrderedField\" rel=\"nofollow noreferrer\"><code>OrderedField</code></a> turns out to just be shorthand for <code>(Floating n, Ord n)</code>. Now, the constraint for <code>wedge</code> looks like</p>\n\n<pre><code>(TrailLike t, V t ~ V2, N t ~ n, Additive V2, Num n, Floating n, Ord n)\n</code></pre>\n\n<p>However, it turns out that we can even drop the <code>Additive V2</code> constraint, since that instance is defined <a href=\"https://hackage.haskell.org/package/linear-1.20.5/docs/Linear-Vector.html#t:Additive\" rel=\"nofollow noreferrer\">where <code>Additive</code> is defined in <code>Linear.Vector</code></a> and <code>Num n</code> is redundant, given that <code>Num n =&gt; Fractional n =&gt; Floating n</code>. That leaves us with the much simpler constraint for <code>wedge</code></p>\n\n<pre><code>(TrailLike t, V t ~ V2, N t ~ n, Floating n, Ord n)\n</code></pre>\n\n<p>Which looks a whole lot like the constraint for <code>annularWedge</code>. In fact, the only difference is that <code>wedge</code> constrains <code>(Floating n, Ord n)</code> compared to <code>annularWedge</code> constraining <code>RealFloat n</code>. At this point, the constraints are similar enough to make it worth looking at the code for <code>wedge</code>. It turns out that <code>wedge</code> makes use of <code>_theta</code>, defined in <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-Angle.html#t:HasTheta\" rel=\"nofollow noreferrer\"><code>HasTheta</code></a> and the <a href=\"http://projects.haskell.org/diagrams/haddock/src/Diagrams-TwoD-Types.html#line-50\" rel=\"nofollow noreferrer\">corresponding <code>V2</code> instance</a> uses an arctangent function (which, you get after chasing through a couple more dependencies).</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1476901321, "creation_date": 1470683123, "last_edit_date": 1476901321, "question_id": 38836730, "link": "https://stackoverflow.com/questions/38836730/how-to-combine-annularwedge-and-wedge-from-haskells-diagrams-package", "title": "How to combine `annularWedge` and `wedge` from Haskell&#39;s diagrams package?", "body": "<p>It turns out that the <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-TwoD-Arc.html\" rel=\"nofollow\"><code>annularWedge</code></a> function of the diagrams package cannot take a radius of 0 for the inner radius. You must use <code>wedge</code> instead. </p>\n\n<p>To me, an inner radius of 0 is just the degenerate case of <code>annularWedge</code> and should behave like <code>wedge</code>, so I tried to combine them:</p>\n\n<pre><code>mywedge r2 r1 d a\n  | r1 == 0   = wedge r2 d a\n  | otherwise = annularWedge r2 r1 d a\n</code></pre>\n\n<p>Of course, it doesn't work, and I cannot figure out what the error means:</p>\n\n<pre><code>Non type-variable argument in the constraint: RealFloat (N t)\n(Use FlexibleContexts to permit this)\nWhen checking that \u2018mywedge\u2019 has the inferred type\n  mywedge :: forall t.\n             (RealFloat (N t), TrailLike t, V t ~ V2) =&gt;\n             N t -&gt; N t -&gt; Direction V2 (N t) -&gt; Angle (N t) -&gt; t\n</code></pre>\n\n<p>In fact, it turns out that <code>annularWedge</code> and <code>wedge</code> have different constraints, which surprised me:</p>\n\n<pre><code>annularWedge :: (TrailLike t, V t ~ V2, N t ~ n, RealFloat n) =&gt; n -&gt; n -&gt; Direction V2 n -&gt; Angle n -&gt; t\n\nwedge :: (InSpace V2 n t, OrderedField n, TrailLike t) =&gt; n -&gt; Direction V2 n -&gt; Angle n -&gt; t\n</code></pre>\n\n<p>So how do I combine these two functions into a sane one that accepts an inner radius of 0 and does the right thing?</p>\n"}, {"tags": ["haskell", "graphviz", "dot", "digraphs"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1470666458, "post_id": 38831700, "comment_id": 65028970, "body": "Please describe what you&#39;ve tried so far and what hasn&#39;t worked for you. As it sits now, your question reads more like a &quot;I don&#39;t want to do any work, do this for me.&quot; kind of question."}, {"owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1470666900, "post_id": 38831700, "comment_id": 65029275, "body": "@jkeuhlen, I am looking for a function that takes this type of graph and returns nodes and edges.  let ab = graphNodes xDotGraph  let ab1 = graphEdges xDotGraph"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470667178, "post_id": 38831700, "comment_id": 65029471, "body": "Does <a href=\"https://hackage.haskell.org/package/graphviz-2999.18.1.2/docs/Data-GraphViz-Types.html#v:graphNodes\" rel=\"nofollow noreferrer\"><b>graphNodes</b></a> work?"}, {"owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470667834, "post_id": 38831700, "comment_id": 65029967, "body": "@ErikR myProject5.hs:71:38:     Expected a type,       but \u2018DotRepr [] (G.DotGraph String)\u2019 has kind \u2018GHC.Prim.Constraint\u2019     In an expression type signature: DotRepr [] (G.DotGraph String)     In the expression:         graphNodes xDotGraph :: DotRepr [] (G.DotGraph String)     In an equation for \u2018ab\u2019:         ab = graphNodes xDotGraph :: DotRepr [] (G.DotGraph String)"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1470669177, "creation_date": 1470669177, "answer_id": 38832822, "question_id": 38831700, "link": "https://stackoverflow.com/questions/38831700/how-to-access-nodes-edges-of-dot-format-graph-generalised-in-haskell/38832822#38832822", "title": "How to access nodes edges of dot format graph (Generalised ) in haskell", "body": "<p>This works for me (mostly identical to your code but there are a few changes):</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack runghc --resolver lts-6.0 --package graphviz\n -}\nimport Data.GraphViz\nimport Data.Text.IO as T\nimport qualified Data.Text.Lazy as B\nimport qualified Data.Text.Lazy.IO as L\nimport qualified Data.GraphViz.Types.Generalised as G\nimport Data.GraphViz.Printing\nimport Data.GraphViz.Types\n\nmain = do\n  xDotText &lt;- L.readFile \"example.dot\"\n  let xDotGraph = parseDotGraph xDotText :: G.DotGraph String\n  L.putStrLn $ renderDot $ toDot xDotGraph\n  print $ graphNodes xDotGraph\n  print $ graphEdges xDotGraph\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 38832822, "answer_count": 1, "score": -2, "last_activity_date": 1470669177, "creation_date": 1470666046, "question_id": 38831700, "link": "https://stackoverflow.com/questions/38831700/how-to-access-nodes-edges-of-dot-format-graph-generalised-in-haskell", "title": "How to access nodes edges of dot format graph (Generalised ) in haskell", "body": "<p>I want to access the nodes, edges and properties of 'xDotGraph' (G.DotGraph) and set those again. Here is Haskell code that prints dot format graph using graphviz: </p>\n\n<pre><code>$ cat example.dot\n digraph {\n     a [type1=\"\", type2=\"\"];\n     b [type1=\"\", type2=\"\"];\n     a -&gt; b [label=\"\"];\n }\n\nimport Data.GraphViz\nimport Data.Text.IO as T\nimport qualified Data.Text.Lazy as B\nimport qualified Data.Text.Lazy.IO as L\nimport qualified Data.GraphViz.Types.Generalised as G\nimport Data.GraphViz.Printing\n\nxDotText &lt;- L.readFile \"example.xdot\"\nlet xDotGraph = parseDotGraph xDotText :: G.DotGraph String\nT.putStrLn $ renderDot $ toDot xDotGraph\n</code></pre>\n"}, {"tags": ["haskell", "io", "monad-transformers", "maybe"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470665070, "post_id": 38831036, "comment_id": 65027898, "body": "How did you &#39;execute&#39; it? Did you use <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Maybe.html#runMaybeT\" rel=\"nofollow noreferrer\"><code>runMaybeT</code></a> ?"}, {"owner": {"reputation": 4435, "user_id": 3157209, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/f09e0aa62a26ffcf34ba27a698880238?s=128&d=identicon&r=PG&f=1", "display_name": "zimmerrol", "link": "https://stackoverflow.com/users/3157209/zimmerrol"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470665434, "post_id": 38831036, "comment_id": 65028169, "body": "No, I did not know, that I have to call runMaybeT... But I tried it now, and it did not solve the real problem (see the EDIT)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470665565, "post_id": 38831036, "comment_id": 65028279, "body": "you should show us the definition of <code>Person</code>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470665605, "post_id": 38831036, "comment_id": 65028308, "body": "You probably want to use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-Read.html#v:readMaybe\" rel=\"nofollow noreferrer\"><code>readMaybe</code></a>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470666195, "post_id": 38831036, "comment_id": 65028763, "body": "ps. note that you&#39;re lifting every operation inside your <code>do</code> block. You&#39;re never doing anything in the actual <code>Maybe</code> monad."}, {"owner": {"reputation": 4435, "user_id": 3157209, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/f09e0aa62a26ffcf34ba27a698880238?s=128&d=identicon&r=PG&f=1", "display_name": "zimmerrol", "link": "https://stackoverflow.com/users/3157209/zimmerrol"}, "edited": false, "score": 0, "creation_date": 1470667373, "post_id": 38831036, "comment_id": 65029602, "body": "Oh, this is true, but how can I read these values inside the <code>Maybe</code> monad? This does not work: <code>gender &lt;- maybeRead genderStr::Gender</code>, as I do not know, how to properly cast the read value."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470672502, "post_id": 38832674, "comment_id": 65033062, "body": "In the first, <code>return (Person &lt;$&gt; pure name &lt;*&gt; readMaybe a &lt;*&gt; readMaybe g)</code> is also idiomatic, I think. In the second we can also use applicative-style, but I actually prefer it as you wrote it since each line is already nontrivial."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1470672622, "post_id": 38832674, "comment_id": 65033110, "body": "The pure in your comment confuses me. Aren&#39;t we already in the right context from the usr of return and fmap?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1470672881, "post_id": 38832674, "comment_id": 65033264, "body": "Oh, I get it now. I missed what was going on with the readMaybe calls."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1470669080, "last_edit_date": 1470669080, "creation_date": 1470668779, "answer_id": 38832674, "question_id": 38831036, "link": "https://stackoverflow.com/questions/38831036/maybet-maybe-and-io-failsafe-reading-of-information/38832674#38832674", "title": "MaybeT/Maybe and IO: Failsafe reading of information", "body": "<p>If you are doing the validation only after you have asked for all of the input, I would just use the IO monad and return a Maybe:</p>\n\n<pre><code>import Text.Read\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.IO.Class\n\naskPerson :: IO (Maybe Person)\naskPerson = do\n  name &lt;- putStr \"Name? \" &gt;&gt; getLine\n  a &lt;- putStr \"Age? \" &gt;&gt; getLine\n  g &lt;- putStr \"Gender? \" &gt;&gt; getLine\n  return $ do age &lt;- readMaybe a\n              gender &lt;- readMaybe g\n              return $ Person name age gender\n</code></pre>\n\n<p>Note how we are using the Maybe monad in the <code>return</code> statement.</p>\n\n<p>I would use MaybeT if you want to quit asking for input once they enter an invalid value --</p>\n\n<pre><code>askPersonT :: MaybeT IO Person\naskPersonT = do\n  name   &lt;- liftIO $ putStr \"Name? \" &gt;&gt; getLine\n  age    &lt;- MaybeT $ fmap readMaybe $ putStr \"Age? \" &gt;&gt; getLine\n  gender &lt;- MaybeT $ fmap readMaybe $ putStr \"Gender? \" &gt;&gt; getLine\n  return $ Person name age gender\n\ndoit = runMaybeT askPersonT\n</code></pre>\n\n<p>If the user enters an invalid age they won't be asked for a gender.</p>\n"}], "owner": {"reputation": 4435, "user_id": 3157209, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/f09e0aa62a26ffcf34ba27a698880238?s=128&d=identicon&r=PG&f=1", "display_name": "zimmerrol", "link": "https://stackoverflow.com/users/3157209/zimmerrol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 453, "favorite_count": 1, "accepted_answer_id": 38832674, "answer_count": 1, "score": 5, "last_activity_date": 1470672125, "creation_date": 1470664362, "last_edit_date": 1470672125, "question_id": 38831036, "link": "https://stackoverflow.com/questions/38831036/maybet-maybe-and-io-failsafe-reading-of-information", "title": "MaybeT/Maybe and IO: Failsafe reading of information", "body": "<p>I am trying to read information entered by the user and to parse it into the type <code>Person</code>, which uses the type <code>Gender</code>. To do so, I use this code:</p>\n\n<pre><code>data Person = Person String Int Gender String\ndata Gender = Male | Female | NotSpecified deriving Read\n\ninstance Show Gender where\n    show Male = \"male\"\n    show Female = \"female\"\n    show NotSpecified = \"not specified\"\n\ninstance Show Person where\n    show (Person n a g j) = \"Person {name: \" ++ n ++ \", age: \" ++ show a ++ \n        \", gender: \" ++ show g ++ \", job: \" ++ j ++ \"}\"\n\nreadPersonMaybeT :: MaybeT IO ()\nreadPersonMaybeT = do\n    putStrLn \"Name?:\"\n    name &lt;- getLine\n    putStrLn \"Age?:\"\n    ageStr &lt;- getLine\n    putStrLn \"Gender?:\"\n    genderStr &lt;- getLine\n    putStrLn \"Job?:\"\n    job &lt;- getLine\n\n    let newPerson = Person name (read ageStr) (read genderStr) job\n    putStrLn $ show newPerson\n</code></pre>\n\n<p>Now I would like to make this more failsafe - to achieve this I tried to use the MaybeT monad. using this, I got this code:</p>\n\n<pre><code>readPersonMaybeT :: MaybeT IO ()\nreadPersonMaybeT = do\n    lift $ putStrLn \"Name?:\"\n    name &lt;- lift getLine\n    lift $ putStrLn \"Age?:\"\n    ageStr &lt;- lift getLine\n    lift $ putStrLn \"Gender?:\"\n    genderStr &lt;- lift getLine\n    lift $ putStrLn \"Job?:\"\n    job &lt;- lift getLine\n\n    let newPerson = Person name (read ageStr) (read genderStr) job\n    lift $ putStrLn \"show newPerson\"\n</code></pre>\n\n<p>It get compiles/loaded by the GHCI, but when I try to execute the <code>readPersonMaybeT</code> function I get the error-message</p>\n\n<blockquote>\n  <p>No instance for (Data.Functor.Classes.Show1 IO)\n    arising from a use of `print'\n  In a stmt of an interactive GHCi command: print it</p>\n</blockquote>\n\n<p>How can I solve this issue? Writing this code, I used the <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow\">wikibook</a> about Monad Transformers.</p>\n\n<p>EDIT: When I try to 'run' it with <code>runMaybeT</code> it gets executed, but it is not failsafe at all. Entering nonsense for the age for example still results in a output like</p>\n\n<blockquote>\n  <p>Person {name: 85, age: *** Exception: Prelude.read: no parse.</p>\n</blockquote>\n"}, {"tags": ["haskell", "newtype"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 15, "last_activity_date": 1470662580, "creation_date": 1470662580, "answer_id": 38830380, "question_id": 38830145, "link": "https://stackoverflow.com/questions/38830145/newtype-behaviour-in-haskell/38830380#38830380", "title": "newtype behaviour in Haskell", "body": "<p>You can do <code>1 :: T</code> if and only if <code>T</code> is an instance of <code>Num</code>. <code>1 :: Product Int</code> works because <code>Product</code> defines an instance <code>instance Num a =&gt; Num (Product a)</code> (i.e. if <code>a</code> is an instance of <code>Num</code>, <code>Product a</code> is also an instance of <code>Num</code>).</p>\n\n<blockquote>\n  <p>Do I have to put Num constraint on a or something?</p>\n</blockquote>\n\n<p>You have to define a <code>Num</code> instance for <code>Stuff Int</code> (or better for <code>Num a =&gt; Stuff a</code>).</p>\n\n<p>You can either do this manually (using <code>instance</code>) or automatically using <code>deriving Num</code> and the <code>GeneralizedNewtypeDeriving</code> extension, which will define a <code>Num</code> instance for <code>Num a =&gt; Stuff a</code> that acts exactly like the <code>Num</code> instance for the given <code>a</code>.</p>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 1, "accepted_answer_id": 38830380, "answer_count": 1, "score": 6, "last_activity_date": 1470662670, "creation_date": 1470661931, "question_id": 38830145, "link": "https://stackoverflow.com/questions/38830145/newtype-behaviour-in-haskell", "title": "newtype behaviour in Haskell", "body": "<p>I have discovered that I can do this <code>1 :: Product Int</code> and get <code>Product {getProduct = 1}</code> as a result.</p>\n\n<p><code>Product</code> is a <code>newtype</code> defined in <code>Data.Monoid</code>. Than I have tried defining my own <code>newtype</code> like so :</p>\n\n<pre><code>newtype Stuff a = Stuff {getStuff :: a} deriving (Show)\n</code></pre>\n\n<p>But if I try to do <code>1 :: Stuff Int</code> I get an error :</p>\n\n<pre><code>&lt;interactive&gt;:20:1: error:\n* No instance for (Num (Stuff Int)) arising from the literal `1'\n* In the expression: 1 :: Stuff Int\n  In an equation for `it': it = 1 :: Stuff Int\n</code></pre>\n\n<p>Do I have to put <code>Num</code> constraint on <code>a</code> or something? Why doesn't this work?</p>\n"}, {"tags": ["haskell", "list-comprehension", "primes", "lazy-evaluation", "prime-factoring"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1470654415, "post_id": 38827147, "comment_id": 65020834, "body": "Note that the list <code>[x | x &lt;- primes, 10 `mod` x == 0]</code> is <i>not</i> <code>[2,5]</code>, but something like <code>2:5:infiniteLoop</code>, because after <code>5</code> infinitely many primes <code>x</code> will be tried since they might pass the test. Of course we know they won&#39;t, but the list comprehension does not know that. Then <code>takeWhile</code> gets stuck in the loop."}, {"owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470654911, "post_id": 38827147, "comment_id": 65021140, "body": "@chi Yes, I am aware of that it will be an infinite list, thank you. But I thought that <code>takeWhile</code> would stop evaluating the infinite list when the predicate does not hold anymore."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1470655871, "post_id": 38827147, "comment_id": 65021747, "body": "Nope. It is not an infinite list. On that <code>takeWhile</code> would have no problems. Try <code>takeWhile (&lt;=10) [1..]</code> and <code>takeWhile (&lt;=10) (1:2:5:let f n = f (n+1) in f 3)</code>. Here <code>[1..]</code> is an infinite list, while <code>1:2:5:...</code>  is not -- it is a list with an undefined spine after its 3rd element. In an infinite list, <code>take n list</code> will always return, instead when the spine is undefined it will not."}], "answers": [{"comments": [{"owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "edited": false, "score": 0, "creation_date": 1470654639, "post_id": 38827444, "comment_id": 65020973, "body": "Your code worked well, thanks. But I am not sure  I understood the <code>takeWhile</code> situation. Where does actually it stops? Or is it the list comprehension that causes the infinity?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "edited": false, "score": 1, "creation_date": 1470655133, "post_id": 38827444, "comment_id": 65021277, "body": "@D.Jones It&#39;s both. Consider: <code>takeWhile p xs</code>, if <code>xs</code> is finite than <code>takeWhile p xs</code> is finite too, however if  <code>xs</code> is infinite than <code>takeWhile p xs</code> <i>might</i> be finite or infinite, depending on whether there exist a finite prefix of <code>xs</code> where <code>p</code> becomes false. In your case the list comprehension will yield a finite prefix where all elements make <code>p</code> true, and after that no more elements are generated <i>however</i> the list-comprehension keeps trying the primes forever."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1470660690, "post_id": 38827444, "comment_id": 65024871, "body": "It is important to distinguish between &quot;finite&quot; (a.k.a. terminating) lists and lists that only have a finite number of elements. E.g. <code>1:2:3:[]</code> is finite (terminating) and <code>1:2:3:infiniteLoop</code> is not though it only ever has 3 elements. So the list comprehension doesn&#39;t terminate, even though it only produces a finite number of elements; and <code>takeWhile</code> doesn&#39;t terminate, because the condition never becomes <code>false</code> and the list argument (the list comprehension) doesn&#39;t terminate."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 7, "last_activity_date": 1470653885, "creation_date": 1470653885, "answer_id": 38827444, "question_id": 38827147, "link": "https://stackoverflow.com/questions/38827147/haskell-does-not-evaluate-lazily-takewhile/38827444#38827444", "title": "Haskell Does Not Evaluate Lazily takeWhile", "body": "<p><code>takeWhile</code> never terminates for composite arguments. If <code>n</code> is composite, it has no prime factors <code>&gt;= n</code>, so <code>takeWhile</code> will just sit there.</p>\n\n<p>Apply <code>takeWhile</code> to the primes list and then filter the result with n <code>mod</code> x, like this:</p>\n\n<pre><code>primeFactors n = [x | x &lt;- takeWhile (&lt;= n) primes, n `mod` x == 0]\n</code></pre>\n\n<p>(<code>&lt;=</code> is used instead of <code>&lt;</code> for maximum correctness, so that prime factors of a prime number would consist of that number).</p>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1470673276, "creation_date": 1470673276, "answer_id": 38834130, "question_id": 38827147, "link": "https://stackoverflow.com/questions/38827147/haskell-does-not-evaluate-lazily-takewhile/38834130#38834130", "title": "Haskell Does Not Evaluate Lazily takeWhile", "body": "<p>Have an illustration of what happens:</p>\n\n<p><a href=\"http://sketchtoy.com/67338195\" rel=\"nofollow\">http://sketchtoy.com/67338195</a></p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1470698897, "creation_date": 1470698897, "answer_id": 38839919, "question_id": 38827147, "link": "https://stackoverflow.com/questions/38827147/haskell-does-not-evaluate-lazily-takewhile/38839919#38839919", "title": "Haskell Does Not Evaluate Lazily takeWhile", "body": "<p>Your problem isn't directly <code>takeWhile</code>, but rather the list comprehension.</p>\n\n<pre><code>[x | x &lt;- primes, n `mod` x == 0]\n</code></pre>\n\n<p>For <code>n = 24</code>, we get <code>24 `mod` 2 == 0</code> and <code>24 `mod` 3 == 0</code>, so the value of this list comprehension starts with <code>2 : 3 : ...</code>. But consider the <code>...</code> part.</p>\n\n<p>The list comprehension has to keep pulling values from <code>primes</code> and checking <code>24 `mod` x == 0</code>. Since there are no more prime factors of <code>24</code> nothing will ever pass that test and get emitted as the third value of the list comprehension. But since there's always another prime to test, it will never stop and conclude that the remaining tail of the list is empty.</p>\n\n<p>Because this is lazily evaluated, if you only ever ask for the first two elements of this list then you're fine. But if your program ever needs the third one (or even just to know whether or not there <em>is</em> a third element), then the list comprehension will just spin forever trying to come up with one.</p>\n\n<p><code>takeWhile (&lt; 24)</code> keeps pulling elements from its argument until it finds one that is not <code>&lt; 24</code>. <code>2</code> and <code>3</code> both pass that test, so <code>takeWhile (&lt; 24)</code> <em>does</em> need to know what the third element of the list comprehension is.</p>\n\n<p>But it's not really a problem with <code>takeWhile</code>; the problem is that you've written a list comprehension to find all of the prime factors (and nothing else), and then trying to use a filter on the <em>results</em> of that to cut off the infinite exploration of all the higher primes that can't possibly be factors. That doesn't really make sense if you stop to think about it; by definition anything that isn't a prime factor can't be an element of that list, so you can't filter out the non-factors larger than <code>n</code> from that list. Instead you need to filter the <em>input</em> to that list comprehension so that it doesn't try to explore an infinite space, as @n.m's answer shows.</p>\n"}], "owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 1, "accepted_answer_id": 38827444, "answer_count": 3, "score": 5, "last_activity_date": 1470698897, "creation_date": 1470653011, "question_id": 38827147, "link": "https://stackoverflow.com/questions/38827147/haskell-does-not-evaluate-lazily-takewhile", "title": "Haskell Does Not Evaluate Lazily takeWhile", "body": "<pre><code>isqrt :: Integer -&gt; Integer\nisqrt = floor . sqrt . fromIntegral\n\nprimes :: [Integer]\nprimes = sieve [2..] where\n sieve (p:ps) = p : sieve [x | x &lt;- ps, x `mod` p &gt; 0]\n\nprimeFactors :: Integer -&gt; [Integer]\nprimeFactors n = takeWhile (&lt; n) [x | x &lt;- primes, n `mod` x == 0]\n</code></pre>\n\n<p>Here is my code. I think you guessed what I am trying to do: A list of prime factors of a given number using infinite list of prime numbers. But this code does not evaluate lazily.</p>\n\n<p>When I use <code>ghci</code> and <code>:l mycode.hs</code> and enter <code>primeFactors 24</code>, the result is <code>[2, 3</code> ( and the cursor constantly flashing there) there isn't a further <code>Prelude&gt;</code> prompt. I think there is a problem there. What am I doing wrong?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "case"], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "edited": false, "score": 0, "creation_date": 1470648740, "post_id": 38825605, "comment_id": 65017240, "body": "Thanks your answer very much. However, I couldn&#39;t use <code>if</code> because there are many cases not in this code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "edited": false, "score": 0, "creation_date": 1470649079, "post_id": 38825605, "comment_id": 65017456, "body": "I see. In such case, use a guard in the <code>case</code> as done above."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1470648779, "last_edit_date": 1470648779, "creation_date": 1470648509, "answer_id": 38825605, "question_id": 38824883, "link": "https://stackoverflow.com/questions/38824883/a-value-is-not-fixed-in-case-of/38825605#38825605", "title": "A value is not fixed in `case ~ of`", "body": "<p>The <code>case</code></p>\n\n<pre><code>case cIID of\n        xID -&gt; ...\n        _ -&gt; ...\n</code></pre>\n\n<p>introduces a new local variable named <code>xID</code>, which is unrelated to the global <code>xID</code>. Further, since it is a variable it catches everything: the branch <code>_ -&gt; ...</code> will never be taken.</p>\n\n<p>Use this instead:</p>\n\n<pre><code>case cIID of\n        xID' | xID' == xID -&gt; ...\n        _ -&gt; ...\n</code></pre>\n\n<p>or, more simply,</p>\n\n<pre><code>if cIID == xID\nthen ...\nelse ...\n</code></pre>\n\n<hr>\n\n<p>About \"why\" it works in this way:</p>\n\n<p>Consider the code</p>\n\n<pre><code>foo :: Either Int String -&gt; Int\nfoo e = case e of\n   Left x  -&gt; x\n   Right y -&gt; length y\n</code></pre>\n\n<p>This is a nice total function: it will always return an <code>Int</code> whatever is the value of the argument <code>e</code>.</p>\n\n<p>Now suppose I add to the code, much later on,</p>\n\n<pre><code>x :: Int\nx = 42\n</code></pre>\n\n<p>This should NOT break <code>foo</code>! Yet, if the <code>x</code> in <code>Left x</code> is now interpreted to be <code>42</code>, then function <code>foo</code> will crash on e.g. <code>Left 43</code>.</p>\n\n<p>For this reason, pattern matching always introduces new variables, it never performs equality checks with pre-existing variables. To do that, use a guard like <code>x | x == y -&gt; ...</code>.</p>\n"}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 38825605, "answer_count": 1, "score": 1, "last_activity_date": 1470648779, "creation_date": 1470646285, "last_edit_date": 1470647568, "question_id": 38824883, "link": "https://stackoverflow.com/questions/38824883/a-value-is-not-fixed-in-case-of", "title": "A value is not fixed in `case ~ of`", "body": "<h1>My situation:</h1>\n\n<p>In my code, a value <code>xID</code> seems to be variable in <code>case ~ of</code> structure.</p>\n\n<pre><code>import Debug.Trace\n\ndata I = I\n  { iID :: Int } deriving Show\ndata C = C\n  { i :: I} deriving Show\n\nx = I 0\naC2 = C (I 2)\naC3 = C (I 3)\naC5 = C (I 5)\n\nxID = iID x\n\ncConverter aC =\n  trace ((show cIID) ++ (if cIID == xID then \"==\" else \"/=\") ++ (show xID) ++ \" when \" ++ (show x)) $\n    \"Point: \" ++ pID\n  where\n    pID :: String\n    pID =\n      case cIID of\n        xID -&gt; trace ((show cIID) ++ (if cIID == xID then \"==\" else \"/=\") ++ (show xID) ++ \" when \" ++ (show x)) \"X\"\n        _ -&gt; show cIID\n    cIID = iID . i $ aC\n    -- xID = iID x\n</code></pre>\n\n<h2>What I expect</h2>\n\n<p>I expected that when I run <code>cConverter aC2</code>, I'll get <code>\"2\"</code> because <code>2</code> in <code>aC2 = C (I 2)</code> is not equal to <code>0</code> in <code>x = I 0</code>.</p>\n\n<h2>What happens</h2>\n\n<p>However, I've faced the strange result when I run <code>cConvert aC2</code> like:</p>\n\n<pre><code>Main&gt; cConverter aC2\n\"2/=0 when I {iID = 0}\nPoint: 2==2 when I {iID = 0}\nX\"\n</code></pre>\n\n<p>Why I get <code>\"X\"</code> instead of <code>\"2\"</code>?\nMore precisely, Why <code>xID</code> is <code>2</code> when <code>cIID</code> is <code>2</code>, and <code>xID</code> is <code>3</code> when <code>cIID</code> is <code>3</code>?</p>\n\n<p>I think <code>xID</code> always be <code>0</code> in this code, but does <code>xID</code> means something other when I use this in the condition of the case?</p>\n\n<h1>Clear sample</h1>\n\n<p>Here is more clear code without debugging message</p>\n\n<pre><code>data I = I\n  { iID :: Int } deriving Show\ndata C = C\n  { i :: I} deriving Show\n\nx = I 0\naC2 = C (I 2)\naC3 = C (I 3)\naC5 = C (I 5)\n\nxID = iID x\n\ncConverter aC =\n  \"Point: \" ++ pID\n  where\n    pID :: String\n    pID =\n      case cIID of\n        xID -&gt; \"X\"\n        _ -&gt; show cIID\n    cIID = iID . i $ aC\n    -- xID = iID x\n</code></pre>\n\n<h1>Point 1</h1>\n\n<p>GHCi warns me like:</p>\n\n<pre><code>Bug.hs:22:7: Warning:\n    Pattern match(es) are overlapped\n    In a case alternative: _ -&gt; ...\n</code></pre>\n\n<p>It seems to be <code>xID</code> overlaps <code>_</code>.<br>\nBut why xID overlaps hole?</p>\n\n<p>Anyway, I avoid this problem by using a guard instead of <code>case</code>.\nHowever, I could not understand what happens with my code.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 1, "creation_date": 1470670717, "post_id": 38824676, "comment_id": 65031988, "body": "If there is no other way you could always just drop stack and use plain cabal. It&#39;s not ideal, but a good last resort if stack gets stuck."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470678599, "post_id": 38824676, "comment_id": 65036464, "body": "I don&#39;t think <code>stack</code> calls the cabal binary - at least not stack-1.1.2. I would try asking on the <a href=\"https://groups.google.com/forum/#!forum/haskell-stack\" rel=\"nofollow noreferrer\">haskell-stack mailing list</a> or compile using a cabal sandbox."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1470684166, "post_id": 38824676, "comment_id": 65039487, "body": "Are you looking for stack setup --upgrade-cabal?"}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470691020, "post_id": 38824676, "comment_id": 65042883, "body": "<code>stack setup --upgrade-cabal</code> might be just what I need, but it errors out due to that same bug."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1470692500, "post_id": 38824676, "comment_id": 65043505, "body": "OK, I managed to upgrade cabal by disabling and re-enabling the rootless feature (<a href=\"http://osxdaily.com/2015/10/05/disable-rootless-system-integrity-protection-mac-os-x/\" rel=\"nofollow noreferrer\">osxdaily.com/2015/10/05/&hellip;</a>). While that didn&#39;t get rid of the original problem (still errors out due to the same bug), I&#39;d say your tip qualifies as the answer to this question, @MichaelSnoyman, so feel free to make an answer off this."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470692928, "post_id": 38824676, "comment_id": 65043680, "body": "(That bug seems not only to be inherent to <code>Cabal</code>, but also to GHC &lt; 7.10, because of <code>unix</code>, so there&#39;s that...)"}], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470690950, "post_id": 38837134, "comment_id": 65042851, "body": "I&#39;m trying to compile the <code>helium</code> compiler, but only have GHC 7.10 installed globally, which doesn&#39;t compile. Installing GHC 7.8 side-by-side would be too much of a hassle (I&#39;d rather not try <code>helium</code> then), so I tried to use <code>stack</code>, which would obviously fit the bill if not for that bug."}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470691601, "post_id": 38837134, "comment_id": 65043137, "body": "@SebastianGraf with <code>stack</code>, there&#39;s no hassle installing GHC 7.10. Just run <code>stack setup</code> and it&#39;ll install ghc inside <code>~&#47;.stack</code>, without polluting your path. Upon next run of <code>stack build</code>, it&#39;ll figure out to use that GHC even if it&#39;s not on your PATH."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470692092, "post_id": 38837134, "comment_id": 65043335, "body": "Yeah, I know. But <code>helium</code> doesn&#39;t build with 7.10, so I either have to use lts-2.22 or install 7.8 manually in a way that doesn&#39;t pollute my path."}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470724826, "post_id": 38837134, "comment_id": 65052447, "body": "@SebastianGraf sorry, I meant 7.8, or 8.0, or whatever is needed. Just do <code>stack setup --resolver=lts-2.2</code> or run <code>stack setup</code> inside a helium proj with <code>stack.yaml</code>. Stack handles multiple GHC&#39;s installed side by side inside <code>~&#47;.stack</code>"}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 1, "creation_date": 1470725884, "post_id": 38837134, "comment_id": 65052988, "body": "That&#39;s exactly what I&#39;m doing right know, but I hit the bug I mentioned in the OP. That&#39;s why I wanted to use the same LTS (e.g. 2.22, one with GHC 7.8.4), but with a newer cabal version, because I thought that bug was inherent to <code>Cabal</code>. It turns out, that <code>stack setup --upgrade-cabal</code> was what I was looking for (see the comments of the OP), but it doesn&#39;t help because the bug is in <code>unix</code>, which is also used by GHC, I think. Anyway, still could not compile <code>helium</code> without going rootless (which helped). Seems like that&#39;s the only way to get what I want."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470725959, "post_id": 38837134, "comment_id": 65053038, "body": "Regardless, <code>stack setup --upgrade-cabal</code> together with going rootless for the time of the installation is the answer to this question. It just doesn&#39;t help with the concrete problem I&#39;m facing."}], "tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 1, "last_activity_date": 1470684715, "creation_date": 1470684715, "answer_id": 38837134, "question_id": 38824676, "link": "https://stackoverflow.com/questions/38824676/override-the-cabal-version-of-an-lts/38837134#38837134", "title": "Override the cabal version of an LTS", "body": "<p>I think the problem is related not just to <code>Cabal</code> library version (btw, stack doesn't use or need <code>cabal-install</code>), but also to GHC version. Stack's FAQ mentions an <a href=\"https://docs.haskellstack.org/en/stable/faq/#why-do-i-get-a-usrbinar-permission-denied-error\" rel=\"nofollow\">item about this error</a>, but I think it didn't help for me and I just upgraded to 7.10.2 at the time.</p>\n"}, {"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470698700, "post_id": 38839178, "comment_id": 65045475, "body": "Thanks, but this doesn&#39;t really answer the question I asked and also doesn&#39;t help with the concrete problem I&#39;m facing, because the bug is present in <code>unix &lt; 2.7.1.0</code>, which both <code>Cabal</code> and <code>ghc</code> &lt; 7.10 depend upon. The only real workaround is to disable rootless mode, from what I can tell."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1470699008, "post_id": 38839178, "comment_id": 65045541, "body": "But  you can rebuild the version of unix that you need with this version of ghc."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470693675, "creation_date": 1470693675, "answer_id": 38839178, "question_id": 38824676, "link": "https://stackoverflow.com/questions/38824676/override-the-cabal-version-of-an-lts/38839178#38839178", "title": "Override the cabal version of an LTS", "body": "<p>Here's a recipe for installing ghc-7.8.4 into the directory of your choice:</p>\n\n<ol>\n<li>Download the \"bindist\" from <a href=\"https://www.haskell.org/ghc/download_ghc_7_8_4#macosx_x86_64\" rel=\"nofollow\">https://www.haskell.org/ghc/download_ghc_7_8_4#macosx_x86_64</a></li>\n<li>Untar it into a scratch directory</li>\n<li>Create the destination directory, e.g. <code>$HOME/my-prefix</code>.</li>\n<li><p>In the scratch directory run:</p>\n\n<pre><code>$ ./configure --prefix=$HOME/my-prefix\n$ make install\n</code></pre></li>\n</ol>\n\n<p>Now ghc may be found in <code>$HOME/my-prefix/bin</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 1, "last_activity_date": 1471023960, "last_edit_date": 1495541390, "creation_date": 1471023960, "answer_id": 38923752, "question_id": 38824676, "link": "https://stackoverflow.com/questions/38824676/override-the-cabal-version-of-an-lts/38923752#38923752", "title": "Override the cabal version of an LTS", "body": "<p>As noted in <a href=\"https://stackoverflow.com/questions/38824676/override-the-cabal-version-of-an-lts#comment65039487_38824676\">Michael Snoyman's comment</a>, there is <code>stack setup --upgrade-cabal</code> to do just that. That's it for the answer to this question.</p>\n\n<hr>\n\n<p>In my specific case (XY problem), for that to work I had to do the usual work-around for <a href=\"https://github.com/haskell/cabal/issues/2653\" rel=\"nofollow noreferrer\">that El Capitano related bug</a>, which is explained <a href=\"https://apple.stackexchange.com/a/196226/67442\">here</a>. So I enabled rootless, ran the upgrade command and re-enabled rootless. </p>\n\n<p>To no avail I'm afraid: The bug is specific to <code>unix &lt; 2.7.1.0</code>, which GHC 7.8.4 also depends on. So even after upgrading cabal, I can't compile anything in lts-2 unless I disable rootless, which is pretty annoying.</p>\n\n<p>Actually it's kinda depressing that <a href=\"https://ghc.haskell.org/trac/ghc/blog/weekly20150721#MacOSXElCapitansupport\" rel=\"nofollow noreferrer\">the GHC folks decided not to file a new minor release</a> with the updated <code>unix</code> package. This means that no realistic/recent OS X configuration can build anything which involves GHC &lt; 7.10.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 38923752, "answer_count": 3, "score": 3, "last_activity_date": 1471023960, "creation_date": 1470645617, "last_edit_date": 1470698856, "question_id": 38824676, "link": "https://stackoverflow.com/questions/38824676/override-the-cabal-version-of-an-lts", "title": "Override the cabal version of an LTS", "body": "<p>I have a project that I want to compile with LTS 2, but I'm stuck trying to work around <a href=\"https://github.com/haskell/cabal/issues/2653\" rel=\"nofollow\">this well-known bug in OS X 10.11</a>.</p>\n\n<p>Can I somehow specify a newer version of <code>Cabal</code> to use with <code>ghc-7.8.4</code>? Note that the project only really compiles with GHC 7.8.*.</p>\n\n<p>Edit:</p>\n\n<p>Really meant <code>Cabal</code>, not <code>cabal-install</code>.</p>\n\n<p>Edit 2:</p>\n\n<p>Actually, the answer to this question doesn't really solve my concrete problem (compiling <code>helium</code>, which requires GHC &lt;= 7.8.4), because the bug is not specific to <code>Cabal</code>, but rather to <code>unix</code>, which GHC &lt; 7.10 depends upon.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 2, "creation_date": 1470639921, "post_id": 38822917, "comment_id": 65012339, "body": "its not clear (at least for me) how do you process the list, I mean what is the relation about the list, the max num and the output?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1470640836, "post_id": 38822917, "comment_id": 65012841, "body": "Yes, I&#39;m also unclear about what you are intending. Can you give a few examples of the input and desired output?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470643951, "post_id": 38822917, "comment_id": 65014506, "body": "Note that <code>length (h:hs) == 0</code> is never true, and <code>(h:hs) &#47;= []</code> is always true. Same for <code>length (h:hs) &gt; 0</code>."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6659649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c17df95770096cf81fd449d1e54ef9d?s=128&d=identicon&r=PG&f=1", "display_name": "JPrado", "link": "https://stackoverflow.com/users/6659649/jprado"}, "edited": false, "score": 0, "creation_date": 1470665376, "post_id": 38824994, "comment_id": 65028124, "body": "Perfect explanation. Thank you!"}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 4, "last_activity_date": 1470680004, "last_edit_date": 1470680004, "creation_date": 1470646652, "answer_id": 38824994, "question_id": 38822917, "link": "https://stackoverflow.com/questions/38822917/haskell-receiving-a-list-and-iterate-several-times/38824994#38824994", "title": "Haskell: receiving a list and iterate several times", "body": "<p>When your code gets so hairy that you can't debug it, it's good to take a step back and try a new approach to the problem. Preferably one building off smaller, testable components.</p>\n\n<p>In this case, you're trying to generate a vertical bar chart given a list of heights. As you've discovered, doing so is <em>hard</em>. But we can easily generate a horizontal bar, right? That's just <code>n</code> repetitions of the <code>*</code> character.</p>\n\n<pre><code>bar :: Int -&gt; String\nbar n = replicate n '*'\n\n-- bar 5 = \"*****\"\n</code></pre>\n\n<p>The next tricky bit is rotating it so that it's vertical. What would that look like as a Haskell value? Instead of a simple <code>String</code>, we'd have a list of <code>String</code>s that each represent a row. So if we have <code>[replicate n '*']</code> as a single row of length n, what we want is <code>replicate n ['*']</code>, or n rows of length 1. We can use that definition directly, but it turns out that this operation is just transposing a matrix, provided by the function <code>Data.List.transpose</code>.</p>\n\n<pre><code>verticalBar :: Int -&gt; [String]\nverticalBar n = transpose [bar n]\n\n-- verticalBar 5 = [\"*\",\"*\",\"*\",\"*\",\"*\"]\n</code></pre>\n\n<p>This should point us at how to turn a list of horizontal bars into a vertical graph. </p>\n\n<pre><code>transpose . map bar\n</code></pre>\n\n<p>But this isn't quite right, as we lose some elements and the graph appears to be upside down! We need to pad out each row so that our horizontally laid out graph isn't ragged before we transpose it.</p>\n\n<pre><code>graph :: [Int] -&gt; String\ngraph heights = unlines . transpose . map draw $ heights\n  where\n    maxHeight = maximum heights\n    draw height = replicate (maxHeight - height) ' ' ++ replicate height '*' ++ \"-\"\n</code></pre>\n\n<p>And now we have our graph!</p>\n\n<pre><code>\u03bb putStrLn $ graph [0,0,0,5,5,5,3,3,3,2,4,4,0]\n   ***\n   ***    **\n   ****** **\n   *********\n   *********\n-------------\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6659649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c17df95770096cf81fd449d1e54ef9d?s=128&d=identicon&r=PG&f=1", "display_name": "JPrado", "link": "https://stackoverflow.com/users/6659649/jprado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 38824994, "answer_count": 1, "score": 2, "last_activity_date": 1470680004, "creation_date": 1470639286, "question_id": 38822917, "link": "https://stackoverflow.com/questions/38822917/haskell-receiving-a-list-and-iterate-several-times", "title": "Haskell: receiving a list and iterate several times", "body": "<p>I'm trying to draw something in the screen.</p>\n\n<p>My function receiving a list of int by parameter (for instance [0,0,0,5,5,5,3,3,3,2,4,4,0] ) and I've to iterate several times from the largest number ([0,0,0,5,5,5,3,3,3,2,4,4,0]) --> 5) until 0</p>\n\n<p>In each iteration I've to examine the entire list, and generate a String (concatenating \" \", \"-\" and \"\\n\"). Writing the result is suppose to be something like this:</p>\n\n<pre><code>   ***\n   ***    **\n   ****** **\n   *********\n   *********\n-------------\n</code></pre>\n\n<p>My function is:</p>\n\n<pre><code>generateSTR (x:xs) = daux (x:xs) (maximum (x:xs)) (x:xs) \"\"\n  where daux (h:hs) mh (y:ys) strdib\n           |  mh /= 0 &amp;&amp; length(h:hs) == 0       = daux (y:ys) (mh-1) (y:ys) \"\\n\" ++ strdib\n           | mh &gt; h &amp;&amp; mh &gt; 0 &amp;&amp; (h:hs) /= []    = daux hs mh (y:ys) \"\" ++ strdib\n           | mh &lt;= h &amp;&amp; mh &gt; 0 &amp;&amp; (h:hs) /= []   = daux hs mh (y:ys) \"*\" ++ strdib\n           | mh == 0 &amp;&amp; length(h:hs) &gt; 0         = daux hs mh hs \"-\" ++ strdib\n        daux [] 0 [] strdib = strdib\n        daux [] _ _ strdib = strdib\n</code></pre>\n\n<p>The problem is that I'm only getting the first line in the draw (b is a blank \"\").  </p>\n\n<pre><code>bbb***bbbbbbb\n</code></pre>\n\n<p>This first line is OK, but I don't know why my program stops. For sure I'm doing something wrong when I'm trying to restore de original list (the third parameter in the function). </p>\n\n<p>The third parameter is suppose to \"save\" the original list and after consume the entire list, concatenate a \"\\n\" and restore the original list, continue with the next iteration until 0.</p>\n\n<p>What I'm doing wrong?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1470638959, "post_id": 38821865, "comment_id": 65011894, "body": "Your transcription is missing a very important part. The second line of the <code>let</code> should be <code>SM (a, s&#39;) = x&#39; s</code>."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1470641099, "creation_date": 1470641099, "answer_id": 38823419, "question_id": 38821865, "link": "https://stackoverflow.com/questions/38821865/understanding-statemonad/38823419#38823419", "title": "understanding StateMonad", "body": "<p>First you need to understand the type of <code>&gt;&gt;=</code>; I'll assume you do since it's on page 2 of that paper and you got past that.</p>\n\n<p>The definition for bind may be easier to understand if we define <code>runState</code>. </p>\n\n<pre><code>newtype SM s a = SM (s -&gt; (a, s))\n\nrunState ::  SM a  -&gt; s -&gt; (a, s)\nrunState    (SM f)    s =  f s\n-- this is equivalent to\n-- runState (SM f) =  f\n</code></pre>\n\n<p><code>runState</code> runs a state monad by extracting the function <code>f</code> that transforms the state and applying it to the initial state <code>s</code>. The function <code>f</code> returns a tuple of type <code>(a, s)</code>. The tuple contains the value (of type <code>a</code>) that depended on the state, and a new state (of type <code>s</code>). The following are equivalent</p>\n\n<pre><code>let (a, s') = runState x s\nin ...\n\nlet SM x' = x\n    (a, s') = x' s\nin ...\n</code></pre>\n\n<p>Both of these extract the function <code>x'</code> for how the state is transformed from <code>x</code>, then apply it to an initial state <code>s</code>. The resulting tuple <code>(a, s')</code> holds the state-dependent value <code>a</code>, and the new state <code>s'</code>.</p>\n\n<p>We can replace the <code>SM</code> pattern matching in the definition of <code>&gt;&gt;=</code> with <code>runState</code>.</p>\n\n<pre><code> x &gt;&gt;= f = SM (\\s -&gt; let\n                         (a, s')  = runState x     s\n                         (b, s'') = runState (f a) s'\n                     in  (b, s''))\n</code></pre>\n\n<p>Now we'll go through it piece by piece.</p>\n\n<p>Bind constructs a new <code>StateMonad</code> with a function that depends on some initial state <code>s</code>. It returns a state-dependent value <code>b</code> and a new state <code>s''</code>:</p>\n\n<pre><code> x &gt;&gt;= f = SM (\\s -&gt; let\n                         ...\n                     in  (b, s''))\n</code></pre>\n\n<p>The state-dependent value <code>a</code> and a new state <code>s'</code> are computed by running the state monad <code>x</code> with the initial state <code>s</code>:</p>\n\n<pre><code>                     let\n                         (a, s')  = runState x     s\n</code></pre>\n\n<p>A new state monad <code>f a</code> is determined from the user-supplied function <code>f</code> and the state-dependent value <code>a</code>. This second state monad is run with the intermediate state <code>s'</code>. It computes another state-dependent value <code>b</code> and a final state <code>s''</code>.</p>\n\n<pre><code>                         (b, s'') = runState (f a) s'   \n</code></pre>\n\n<p>The second state-dependent value <code>b</code> and the final state <code>s''</code> are what's returned by the function constructed for the new <code>StateMonad</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 1, "last_activity_date": 1470715945, "creation_date": 1470715945, "answer_id": 38841916, "question_id": 38821865, "link": "https://stackoverflow.com/questions/38821865/understanding-statemonad/38841916#38841916", "title": "understanding StateMonad", "body": "<p>A slightly shorter answer to complement <code>Cirdec</code>'s... </p>\n\n<p>First, recall that in <code>x &gt;&gt;= f</code>, <code>x</code> is a state monad, <code>f</code> is a fn that returns a state monad, and <code>x &gt;&gt;= f</code> is also a state monad. </p>\n\n<p>The basic idea is as follows. Given some current state <code>s</code> (that will be supplied later when we run the state monad represented by <code>x &gt;&gt;= f</code>), we first want to run <code>x</code> with <code>s</code>, which will yield some value <code>a</code>, along with a new state <code>s'</code>. Then we want to run <code>f a</code>, which gives us another state monad. We don't just want to run this resulting state monad <code>f a</code> with <em>any</em> state though; rather, we want to run it with the state that resulted from <code>x</code>, namely <code>s'</code>, giving us some new value <code>b</code> and some new state <code>s''</code>. <code>x &gt;&gt;= f</code> will represent this computation from <code>s -&gt; (b, s'')</code>. </p>\n\n<p>Remember: the whole point of using a state monad is to avoid explicitly passing state along as another parameter to all of our functions (that would get really messy, really quickly). So the idea here is to have the state threaded through properly behind the scenes whenever we bind actions to a state monad.</p>\n\n<p>To do this, we (1) pattern match on <code>x</code> to get the fn inside, then (2) run this function with the current state <code>s</code> to get a result <code>a</code> and some new state <code>s'</code>. Then we (3) compute <code>f a</code>, which returns a state monad, and pattern match on this monad to get the fn inside; then (4) run the fn with the state <code>s'</code> to get a value <code>b</code> and some final state <code>s''</code>. (1) through (4) correspond to the four lines immediately following <code>let</code> in your code. What do you know, we've just defined a fn from <code>s</code> to <code>(b, s'')</code>, which properly passes along state behind the scenes. Now we'll just wrap that in a constructor and we're done. <code>x &gt;&gt;= f</code> now represents a computation that we can run later by supplying an initial state.  </p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 2, "accepted_answer_id": 38823419, "answer_count": 2, "score": 3, "last_activity_date": 1470715945, "creation_date": 1470634187, "last_edit_date": 1470649578, "question_id": 38821865, "link": "https://stackoverflow.com/questions/38821865/understanding-statemonad", "title": "understanding StateMonad", "body": "<p>I'm a haskell beginner and trying to understand this definition of a StateMonad, specifically the bind operation. It's taken from <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.29.4575\" rel=\"nofollow\">Generalising Monads to Arrows</a> page 4.</p>\n\n<pre><code>instance Monad (StateMonad s) where\n     return a = SM (\\s -&gt; (a, s))\n     x &gt;&gt;= f = SM (\\s -&gt; let\n                             SM x' = x\n                             (a, s') = x' s\n                             SM f' = f a\n                             (b, s'') = f' s'\n                         in (b, s''))\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1470616313, "post_id": 38819801, "comment_id": 65006380, "body": "Because it isn&#39;t looking for <code>MonadState (SlackState BotState) BotState</code>, it is looking for <code>MonadState (SlackState BotState) ((-&gt;) BotState)</code>. Seems like a precedence issue due to <code>$</code> and <code>&gt;&gt;=</code> - try explicit parenthesization."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470641845, "post_id": 38819801, "comment_id": 65013399, "body": "You&#39;re right, it was due to the <code>$</code> in <code>uses Slack.userState $ view appState</code>. Changing that to <code>uses Slack.userState (view appState)</code> fixes the problem. I would love to understand what happened there? Why did the <code>$</code> not behave as expected in this particular situation?  Thanks for your help by the way, if you want to collect the points, write it up as an answer and receive an upvote /accept :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470649770, "post_id": 38819801, "comment_id": 65017941, "body": "Very roughly, one can think of <code>$</code> as adding parentheses to the very end of the expression. So, <code>uses Slack.userState $ stuff1 &gt;&gt;= stuff2</code> is <code>uses Slack.userState (stuff1 &gt;&gt;= stuff2)</code> which was not intended. Note that in a <code>do</code> block you wouldn&#39;t have this problem: try <code>do state &lt;- uses Slack.userState $ view appState ; modifying Slack.userState $ set appState $ f state</code>. You can use a newline instead of <code>;</code>, as long as you indent it correctly (<code>state &lt;-</code> and <code>modifying</code> should start in the same column)"}], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": true, "score": 2, "last_activity_date": 1470642855, "creation_date": 1470642855, "answer_id": 38823908, "question_id": 38819801, "link": "https://stackoverflow.com/questions/38819801/missing-monadstate-instance/38823908#38823908", "title": "Missing Monadstate instance", "body": "<p><code>$</code> operator has fixity 0, while <code>&gt;&gt;=</code> has fixity <code>1</code>, so code like this would work:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  putStrLn \"hello world\" &gt;&gt;= \\_ -&gt; putStrLn \"hi\"\n</code></pre>\n\n<p>But not this one:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  putStrLn $ \"hello world\" &gt;&gt;= \\_ -&gt; putStrLn \"hi\"\n</code></pre>\n\n<p>It's being interpreted as:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  putStrLn (\"hello world\" &gt;&gt;= \\_ -&gt; putStrLn \"hi\")\n</code></pre>\n\n<p>To see fixity info, use <code>ghci</code>'s <code>:info</code> command:</p>\n\n<pre><code> :info $\n($) ::\n  forall (r :: ghc-prim-0.5.0.0:GHC.Types.RuntimeRep) a (b :: TYPE\n                                                                r).\n  (a -&gt; b) -&gt; a -&gt; b\n    -- Defined in \u2018GHC.Base\u2019\ninfixr 0 $\n :info &gt;&gt;=\nclass Applicative m =&gt; Monad (m :: * -&gt; *) where\n  (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n  ...\n    -- Defined in \u2018GHC.Base\u2019\ninfixl 1 &gt;&gt;=\n</code></pre>\n\n<p>Also, if you're not sure, good old parentheses are always here for the rescue :)</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 1, "accepted_answer_id": 38823908, "answer_count": 1, "score": 0, "last_activity_date": 1470642855, "creation_date": 1470615931, "last_edit_date": 1470642074, "question_id": 38819801, "link": "https://stackoverflow.com/questions/38819801/missing-monadstate-instance", "title": "Missing Monadstate instance", "body": "<p>I am attempting to build a slackbot using this library: <a href=\"https://hackage.haskell.org/package/slack-api\" rel=\"nofollow\">https://hackage.haskell.org/package/slack-api</a>, just to learn a little bit more haskell, and hopefully, finally understand monads -_-.</p>\n\n<p>I then have the following types:</p>\n\n<pre><code>data BotState = BotState\n  { \n    _appState :: AppState\n  }\n\nmakeLenses ''BotState\n\n\ntype AppState = HM.Map String ChannelState\n\nemptyState :: AppState\nemptyState = HM.empty\n\ndata ChannelState = ChannelState\n{ _counter :: Int}\n\ntype Bot = Slack.Slack BotState\n</code></pre>\n\n<p>and I run my bot with:</p>\n\n<pre><code>initApp = lookupEnv \"SLACK_API_TOKEN\" &gt;&gt;=\n  \\apiToken -&gt; case apiToken of\n    Nothing -&gt; throwM ApiTokenMissingException\n    Just t -&gt; void $ Slack.runBot (Slack.SlackConfig t) runApp $ BotState emptyState\n</code></pre>\n\n<p>where:</p>\n\n<pre><code>runApp :: Slack.Event -&gt; Bot ()\nrunApp m@(Slack.Message cid uid body _ _ _) = sendMessage cid \"GAH I CAN HAZ CHZBURGHER!\" \n</code></pre>\n\n<p>This runs fine, now I wish to add the ability to update the system state (by incrementing the counter, or in other ways).</p>\n\n<p>so I add a modifyState function to my Bot:</p>\n\n<pre><code>modifyState :: (AppState -&gt; AppState) -&gt; Bot ()\nmodifyState f = uses Slack.userState $ view appState &gt;&gt;=\n  \\state -&gt; modifying Slack.userState $ set appState $ f state \n</code></pre>\n\n<p>This breaks with:</p>\n\n<pre><code> No instance for (Control.Monad.State.Class.MonadState\n                           (Slack.SlackState BotState) ((-&gt;) BotState))\n          arising from a use of \u2018modifying\u2019\n        In the expression: modifying Slack.userState\n        In the expression:\n          modifying Slack.userState $ set appState $ f state\n        In the second argument of \u2018(&gt;&gt;=)\u2019, namely\n          \u2018\\ state -&gt; modifying Slack.userState $ set appState $ f state\u2019\n</code></pre>\n\n<p>Which makes sense given the signature for <code>modifying</code>:</p>\n\n<pre><code>modifying :: MonadState s m =&gt; ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()\n</code></pre>\n\n<p>However, upon looking at the documentation for <code>Slack.userState</code>:</p>\n\n<pre><code>userState :: forall s s. Lens (SlackState s) (SlackState s) s s Source\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>data SlackState s\n\n ... Constructor ...\n    Instances\nShow s =&gt; Show (SlackState s)Source  \nMonadState (SlackState s) (Slack s)Source   \n</code></pre>\n\n<p>So then why isn't the <code>BotState</code> already an instance of <code>MonadState</code>? How could I fix this?</p>\n"}, {"tags": ["haskell", "servant", "postgresql-simple"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 3, "creation_date": 1470605601, "post_id": 38818478, "comment_id": 65004374, "body": "Your concepts seem a little muzzy. Consider only pure Haskell. Does <code>mkUser :: User -&gt; User</code> make sense? You need to allow clients to pass you a message that has only the info necessary to create a <code>User</code>. E.g., <code>data CreateUser = CreateUser { givenName :: Text, surName :: Text }</code>, <code>type API = &quot;users&quot; :&gt; ReqBody &#39;[JSON] CreateUser :&gt; Post &#39;[JSON] User</code>."}, {"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470606580, "post_id": 38818478, "comment_id": 65004540, "body": "I have considered that, but having to make an extra datatype for every endpoint like this seems a super non-optimal solution. I was hoping there was some other way to do it. I did implement this actually and found myself using a pattern like User, UserI (UserInput), but this represents just the omission of one field, and it seems like a bad idea to have the input type and the saved type be different. What if refactor User but forget to change UserI? Isn&#39;t this part of what servant tries to avoid?"}, {"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470606746, "post_id": 38818478, "comment_id": 65004563, "body": "This POST request represents passing a User to the server, which it then saves. Semantically I would want to keep them the same type, or have UserI be derived from User at compile time, or something.  And my concepts are not muzzy, I am not inexperienced at Haskell. I realize that the types mean what they mean, but I was just trying to justify the use of servant by making a proof of concept with the simplest API imaginable (CRUD of one resource - users), something which would e.g. be done in Rails for you automatically. And I was surprised at how non-trivial it is."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470609551, "post_id": 38818478, "comment_id": 65005149, "body": "I don&#39;t know Rails from Adam, but I would assume the trick there is that Ruby allows the ID field to be null (<code>nil</code>, right?). The impedance mismatch here is that a user without an ID is a different thing from a user with a nullable ID is a different thing than a user with a non-nullable ID. There&#39;s not really a way to get the type system to lie. I suppose you could come up with a Template Haskell solution that allows you to effectively knock out fields on an existing datatype to produce a new one. I&#39;m not too quick with the TH though so I hope someone else comes along to snipe the answer."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1470611718, "post_id": 38818478, "comment_id": 65005558, "body": "@asg0451 You can use a parametrized datatype holding the id and the saved element. I think you can read this from the persistent library : <a href=\"http://www.yesodweb.com/book/persistent#persistent_insert\" rel=\"nofollow noreferrer\">yesodweb.com/book/persistent#persistent_insert</a>"}, {"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470675325, "post_id": 38818478, "comment_id": 65034663, "body": "@RowanBlush I actually had a stab at that last night, and while doable definitely seems like a pain to create and (possibly) to use. But yeah, ruby lets any field be nil for better or for worse."}], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1470675540, "post_id": 38819717, "comment_id": 65034800, "body": "Well if a User object has no ID field, the type of the response to an index or show (/users,  /users/:id) request would have to return Entities also, because the client will need that ID. So at that point what is a User good for? It seems to me that in every interacting-with-the-world context except for the POST request in my question, I need that ID."}, {"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1470675751, "post_id": 38819717, "comment_id": 65034926, "body": "I&#39;ve defined a user in my database as having the id only as the primary key. I definitely want to reflect this in the code, so really I should additionally write a custom Eq instance that only checks IDs. You see what I&#39;m saying? I really think that ID is an integral part of a User, not just an artefact of the database system."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1470687583, "post_id": 38819717, "comment_id": 65041274, "body": "You basically have the choice here to encode the specificity of this id field in the type system, or use a Maybe and deal with the Nothing value. This one is what you typically find in dynamic languages, you then have to manage a convention for this field when saving to your database. My experience is that programming by convention does not work well in Haskell."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1470687964, "post_id": 38819717, "comment_id": 65041471, "body": "Some other use cases where it could be useful are validation, or form generation."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1470688129, "post_id": 38819717, "comment_id": 65041540, "body": "Another thing is if later, for example you want to factorise this id generation logic for other things, you will have a very hard time ! Maybe it could be easier if Haskell had polymorphic variants like OCaml, but it is not the case !"}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1565898040, "post_id": 38819717, "comment_id": 101498582, "body": "@Jean-BaptistePotonnier what are OCaml&#39;s polymorphic variants like? If it&#39;s like polymorphism in haskell, I solve OPs problem with types like <code>data User a = {id :: a, ...}</code>, and then the <code>id</code> can come through as a Persistent id, or an Int, or a Maybe. Ultimately, I think these are all &quot;ugly&quot; solutions that would be made elegant by perahps row types or proper sub-types. Thoughts?"}], "tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": false, "score": 4, "last_activity_date": 1470615358, "last_edit_date": 1470615358, "creation_date": 1470614935, "answer_id": 38819717, "question_id": 38818478, "link": "https://stackoverflow.com/questions/38818478/database-backed-rest-api-with-servant/38819717#38819717", "title": "Database-backed REST API with servant?", "body": "<p>First you need to understand that a User and a row in a table corresponding to this User are two different things.</p>\n\n<p>A row has an id, a user does not. For example, you can imagine to compare two users without dealing with ids, or the fact that they are saved or not.</p>\n\n<p>Once convinced, you will have to explain this to the type system, or you will have to deal with Maybe fields, which I think is not the solution here.</p>\n\n<p>Some people talked about Template Haskell, I think it would be overkill here, and you need to solve the problem first.</p>\n\n<p>What you can do is use a data type to represent a saved row in your database. Let's call it an Entity.</p>\n\n<pre><code>newtype PrimaryKey = PrimaryKey Int\n\ndata Entity b = Entity PrimaryKey b\n</code></pre>\n\n<p>Then the function saving a User row in your database could take a <code>user</code> as parameter and return a <code>PrimaryKey</code> (In you database monad, of course).\nOther functions reading from the database would return something using <code>Entity User</code>  </p>\n\n<p>Your field declarations are not duplicated, since you are reusing the User type as a parameter.</p>\n\n<p>You will have to adapt FromRow/ToRow and FromJSON/ToJSON accordingly.</p>\n"}], "owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 863, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1470615358, "creation_date": 1470603364, "question_id": 38818478, "link": "https://stackoverflow.com/questions/38818478/database-backed-rest-api-with-servant", "title": "Database-backed REST API with servant?", "body": "<p>I am running into a problem setting up a simple proof of concept servant API. This is my User datatype and my API type:</p>\n\n<pre><code>data User = User { id :: Int, first_name :: String, last_name :: String } deriving (Eq, Show, Generic)\ninstance FromRow User\ninstance ToRow User\n$(deriveJSON defaultOptions ''User)\n\ntype API = \"users\" :&gt; ReqBody '[JSON] User :&gt; Post '[JSON] User\n</code></pre>\n\n<p>The handler method for this uses postgresql-simple like this:</p>\n\n<pre><code>create u = liftIO $ head &lt;$&gt; returning connection \"insert into users (first_name, last_name) values (?,?) returning id\" [(first_name u, last_name u)]\n</code></pre>\n\n<p>Boilerplate code such as connecting to the db and the routing method has been elided.\nThe problem is that if I make a POST request, what I want to be doing is creating a new user, so I would supply the JSON:</p>\n\n<pre><code>{ \"first_name\": \"jeff\", \"last_name\": \"lebowski\" }\n</code></pre>\n\n<p>but then my program fails at runtime with</p>\n\n<pre><code>Error in $: When parsing the record User of type Lib.User the key id was not present. \n</code></pre>\n\n<p>This makes sense because the API specified a User which has an id field. But I do not want to have to pass a bogus id in the request (since they are assigned by postgres sequentially) because that is gross. I also can't move the id field out of the User datatype because then postgres-simple fails because of a model-database mismatch when making a GET request to a different endpoint (which does the obvious thing: get by id. Not included above).\nWhat do I do here? Write a custom FromJson instance? I already tried setting the Data.Aeson.TH options flag omitNothingFields to True and setting the id field to be a Maybe Int, but that didn't work either.\nAny advice would be appreciated.</p>\n"}, {"tags": ["haskell", "dictionary", "maybe"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470602609, "post_id": 38817925, "comment_id": 65003642, "body": "Note that, even if that worked, it is considered non idiomatic in Haskell. In many imperative programming languages it is somehow common to find methods like <code>obj.getX()</code> which will throw an exception unless one checks <code>obj.hasX()</code> beforehand. This is frowned upon in Haskell, since it is easy to forget the check: in your code, if you used <code>f</code> without checking <code>k == Nothing</code> first, you would crash the program. Fortunately, pattern matching provides a better way to solve it: in a <code>case</code> we are prodded to consider all the constructors, and act accordingly -- this is always safe."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470602818, "post_id": 38817925, "comment_id": 65003690, "body": "I&#39;d also recommend to read about <a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow noreferrer\">boolean blindness</a>."}], "answers": [{"tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": false, "score": 1, "last_activity_date": 1470599887, "creation_date": 1470599887, "answer_id": 38817992, "question_id": 38817925, "link": "https://stackoverflow.com/questions/38817925/data-map-with-functions-as-values-in-haskell/38817992#38817992", "title": "Data.Map with functions as values in Haskell", "body": "<p>Indeed, the function <code>(== Nothing)</code> as type <code>(Eq a) =&gt; Maybe a -&gt; Bool</code>, in your case, functions not being a member of the <code>Eq</code> typeclass, this doesn't compile.</p>\n\n<p>However you can use the <code>isNothing</code> function from <code>Data.Maybe</code>, or you can define it yourself like this:</p>\n\n<pre><code>isNothing :: Maybe a -&gt; Bool\nisNothing Nothing = True\nisNothing (Just _) = False\n</code></pre>\n\n<p>Because you are pattern-matching on the constructor and therefore not using <code>(==)</code>, you don't need <code>a</code> to be an instance of <code>Eq</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3744, "user_id": 4096199, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/70fa3e2f5ecf1f49a17a617e5d62dc49?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/4096199/ben"}, "edited": false, "score": 0, "creation_date": 1470600926, "post_id": 38817994, "comment_id": 65003203, "body": "Thanks! Great answer. Thanks for also explaining why this has nothing to do with lazy evaluation. And point taken on my double use of the variable <code>f</code>!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3744, "user_id": 4096199, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/70fa3e2f5ecf1f49a17a617e5d62dc49?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/4096199/ben"}, "edited": false, "score": 1, "creation_date": 1470616925, "post_id": 38817994, "comment_id": 65006519, "body": "@Ben: I&#39;d add that more generally, things like equality comparisons are eschewed in Haskell. <a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow noreferrer\">Boolean blindness</a> is the keyword: you rely on expressions of unspecific types like <code>Bool</code> to decide how more specific types like <code>Maybe (Int -&gt; Int -&gt; Int)</code>. The preferred solution is to work <i>only</i> with the specific, meaningful types; this prevents a lot of bugs. Pattern matching is great in this regard."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1470621079, "post_id": 38817994, "comment_id": 65007349, "body": "&quot;an instance of <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code>&quot; means a value whose types is <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1470632733, "post_id": 38817994, "comment_id": 65009696, "body": "@immibis That sentence continues &quot;<i>not <code>(Just (+))</code> or <code>Nothing</code></i>&quot;, but those are values of type <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code>. That makes no sense."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1470634087, "post_id": 38817994, "comment_id": 65010023, "body": "@melpomene Indeed, the thing following it doesn&#39;t make sense."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 9, "last_activity_date": 1470599894, "creation_date": 1470599894, "answer_id": 38817994, "question_id": 38817925, "link": "https://stackoverflow.com/questions/38817925/data-map-with-functions-as-values-in-haskell/38817994#38817994", "title": "Data.Map with functions as values in Haskell", "body": "<p>The problem is this expression: <code>k == Nothing</code></p>\n\n<p>It requires <code>k</code> to support equality testing. The type of <code>k</code> is <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code>. <code>Maybe T</code> supports equality testing if <code>T</code> does, but <code>Integer -&gt; Integer -&gt; Integer</code> doesn't: You can't compare functions for equality. So the whole expression doesn't typecheck.</p>\n\n<p>I don't know what you mean by \"<em>an instance of <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code></em>\": Classes have instances (which are types), but <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code> is not a class, it's an ordinary type. The class in question is <code>Eq</code> (which provides the <code>==</code> method). The issue is that function types don't have an <code>Eq</code> instance. This has nothing to do with lazy evaluation, either.</p>\n\n<hr>\n\n<p>The solution is to just use pattern matching instead:</p>\n\n<pre><code>f key v1 v2 =\n    case Map.lookup key d of\n        Nothing -&gt; 0\n        Just f  -&gt; f v1 v2\n        -- but consider naming 'f' something else;\n        -- the surrounding function is already called 'f'\n</code></pre>\n\n<p>Alternatively you can use one of the <code>Maybe</code> helper functions:</p>\n\n<pre><code>f key v1 v2 =\n    maybe 0 (\\f -&gt; f v1 v2) (Map.lookup key d)\n</code></pre>\n\n<p>Or even:</p>\n\n<pre><code>f key v1 v2 =\n    fromMaybe (\\_ _ -&gt; 0) (Map.lookup key d) v1 v2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": false, "score": 1, "last_activity_date": 1470599971, "creation_date": 1470599971, "answer_id": 38818001, "question_id": 38817925, "link": "https://stackoverflow.com/questions/38817925/data-map-with-functions-as-values-in-haskell/38818001#38818001", "title": "Data.Map with functions as values in Haskell", "body": "<p>This is because you're using <code>k</code> of type <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code> in a comparison expression. Haskell does not know how to compare two functions.</p>\n\n<p>A solution is to 'unpack' the return of lookup.</p>\n\n<pre><code>import qualified Data.Map as Map                                                                 \n\nd = Map.fromList [('+', (+))]                                                                    \n\nf :: Char -&gt; Integer -&gt; Integer -&gt; Integer                                                       \nf key v1 v2 =                                                                                    \n  case Map.lookup key d of                                                                       \n    Nothing -&gt; 0                                                                                 \n    Just f -&gt; f v1 v2\n</code></pre>\n\n<p>.</p>\n\n<pre><code>\u03bb&gt; f '-' 1 2                                                                                     \n0                                                                                                \n\u03bb&gt; f '+' 1 2                                                                                     \n3                                                                                                \n\u03bb&gt;  \n</code></pre>\n"}], "owner": {"reputation": 3744, "user_id": 4096199, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/70fa3e2f5ecf1f49a17a617e5d62dc49?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/4096199/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1323, "favorite_count": 0, "accepted_answer_id": 38817994, "answer_count": 3, "score": 1, "last_activity_date": 1470601159, "creation_date": 1470599449, "last_edit_date": 1470601159, "question_id": 38817925, "link": "https://stackoverflow.com/questions/38817925/data-map-with-functions-as-values-in-haskell", "title": "Data.Map with functions as values in Haskell", "body": "<p>I'm a Haskell newbie trying to understand how to work with the <code>Data.Map</code> structure, lazy evaluation, and the <code>Maybe</code> type. </p>\n\n<p>In Python I can define a dictionary structure whose values are functions. Given a key I can then use the corresponding function:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>d = {\"+\": lambda x,y: x+y}\n\ndef f(key, v1, v2):\n    if key in d:\n        return d[key](v1, v2)\n    else:\n        return 0\n</code></pre>\n\n<p>I've tried to do a similar thing in Haskell but it does not compile.</p>\n\n<pre><code>d = Map.fromList [('+', (+))]\n\nf :: Char -&gt; Integer -&gt; Integer -&gt; Integer\nf key v1 v2 =\n    if k == Nothing\n        then 0\n        else f v1 v2\n    where\n        k = Map.lookup key d\n        (Just f) = k\n</code></pre>\n\n<p>This doesn't compile and returns an error like </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>No instance for (Eq (Integer -&gt; Integer -&gt; Integer))\n</code></pre>\n\n<p>I believe it's because <code>Map.lookup '+' d</code> only returns an instance of <code>Maybe (Integer -&gt; Integer -&gt; Integer)</code> not <code>(Just (+))</code> or <code>Nothing</code>. And I assume this has to do with lazy evaluation.</p>\n\n<p>Is there a Haskell-like way to do this kind of thing? Am I working with the Maybe type incorrectly? Can I force evaluation of the lookup?</p>\n\n<p>This came up because I was trying to implement a reverse polish calculator in Haskell. I used the dictionary to organize the possible functions I could be using. I found a nice solution (<a href=\"https://rosettacode.org/wiki/Parsing/RPN_calculator_algorithm#Haskell\" rel=\"nofollow\">https://rosettacode.org/wiki/Parsing/RPN_calculator_algorithm#Haskell</a>) without a dictionary but now I just want to understand how to properly access values in a Haskell <code>Data.Map</code>. </p>\n"}, {"tags": ["haskell", "monads", "free-monad", "comonad"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1470593774, "post_id": 38816993, "comment_id": 65001228, "body": "<code>Num</code> is a type class, not a type. Something like <code>Cofree [] Int</code> would be more appropriate. Also note, with this type, that the type of the constructor becomes <code>(:&lt;) :: Int -&gt; [Cofree [] Int] -&gt; Cofree [] Int</code>, so the second argument should be a list of cofree values. A simple example would be <code>let a = 1 :&lt; []</code>. Another small example would be <code>let a = 1 :&lt; [x]</code>, where <code>x</code> is another <code>Cofree [] Int</code> value."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1470594279, "post_id": 38816993, "comment_id": 65001389, "body": "@DavidYoung Awesome, that helped with a major chunk of my understanding, and I edited my post. I still miss an intuition of cofree, but I see now that <code>1 :&lt; [2, 3]</code> makes the 1, 2, 3 somehow get coerced to some funky type I don&#39;t know how to interpret in my mind, and I want the <code>a</code> in <code>Cofree f a</code> to just by <code>Int</code>, not some funky type. Thanks!"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1470602351, "post_id": 38816993, "comment_id": 65003571, "body": "I think the best way to build up intuition for Cofree is to try it out on a bunch of functors. Cofree Identity is an infinite stream. Cofree Maybe is a non-empty stream. Cofree ((-&gt;) b) is (a bad encoding of) a potentially-infinite Moore machine. Cofree [] is a rose tree, equivalent to the one in Data.Tree."}, {"owner": {"reputation": 19939, "user_id": 325727, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e098b1ade159310d7a4d6405eebd930a?s=128&d=identicon&r=PG&f=1", "display_name": "JK.", "link": "https://stackoverflow.com/users/325727/jk"}, "edited": false, "score": 1, "creation_date": 1470714945, "post_id": 38816993, "comment_id": 65048933, "body": "Of course you cannot grok it. You have not even consumed it yet."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470603917, "post_id": 38817843, "comment_id": 65003968, "body": "More on annihilation of matter and antimatter <a href=\"http://comonad.com/reader/2008/the-cofree-comonad-and-the-expression-problem/\" rel=\"nofollow noreferrer\">on Kmett&#39;s blog</a>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1470611281, "post_id": 38817843, "comment_id": 65005482, "body": "@pigworker For the free-cofree &quot;cancellation&quot; to work, does it require some particular property from the category in which the functors live?"}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1470671833, "post_id": 38817843, "comment_id": 65032649, "body": "awesome because of <code>data Cofree nodeOf label = label :&lt; nodeOf (Cofree nodeOf label)</code>, explaining ties to co-kleisli arrows, and foldable, as well as the motivating example of the game (plus a useful exercise at the end). Thanks!"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1470730966, "post_id": 38817843, "comment_id": 65055887, "body": "@danidiaz You seem to be alluding to something. Just say what you mean. In my mind, Haskell gives me (too much, but at least) enough semantics to run pure total programs in the category of sets and functions. In that setting, it&#39;s important to distinguish inductive types (like free monads: the client has a terminating mission) from coinductive types (like cofree comonads: the server must stick around however long the client wants). My preprocessor lets me write <code>codata</code> as a keyword, for documentation."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 34033, "user_id": 178060, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e61aa9f3d632781569b0115b9f3154fd?s=128&d=identicon&r=PG", "display_name": "wheaties", "link": "https://stackoverflow.com/users/178060/wheaties"}, "edited": false, "score": 0, "creation_date": 1471525824, "post_id": 38817843, "comment_id": 65388578, "body": "@wheaties I don&#39;t see why not. It may take a while to get around to it."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 60, "last_activity_date": 1470730656, "last_edit_date": 1470730656, "creation_date": 1470598885, "answer_id": 38817843, "question_id": 38816993, "link": "https://stackoverflow.com/questions/38816993/what-are-some-motivating-examples-for-cofree-comonad-in-haskell/38817843#38817843", "title": "What are some motivating examples for Cofree CoMonad in Haskell?", "body": "<p>Let's just recap the definition of the <code>Cofree</code> datatype.</p>\n\n<pre><code>data Cofree f a = a :&lt; f (Cofree f a)\n</code></pre>\n\n<p>That's at least enough to diagnose the problem with the example. When you wrote</p>\n\n<pre><code>1 :&lt; [2, 3]\n</code></pre>\n\n<p>you made a small error that's reported rather more subtly than is helpful. Here, <code>f = []</code> and <code>a</code> is something numeric, because <code>1 :: a</code>. Correspondingly you need</p>\n\n<pre><code>[2, 3] :: [Cofree [] a]\n</code></pre>\n\n<p>and hence</p>\n\n<pre><code>2 :: Cofree [] a\n</code></pre>\n\n<p>which <em>could</em> be ok if <code>Cofree [] a</code> were also and instance of <code>Num</code>. Your definition thus acquires a constraint which is unlikely to be satisfied, and indeed, when you <em>use</em> your value, the attempt to satisfy the constraint fails.</p>\n\n<p>Try again with</p>\n\n<pre><code>1 :&lt; [2 :&lt; [], 3 :&lt; []]\n</code></pre>\n\n<p>and you should have better luck.</p>\n\n<p>Now, let's see what we've got. Start by keeping it simple. What's <code>Cofree f ()</code>? What, in particular, is <code>Cofree [] ()</code>? The latter is isomorphic to the fixpoint of <code>[]</code>: the tree structures where each node is a list of subtrees, also known as \"unlabelled rose trees\". E.g.,</p>\n\n<pre><code>() :&lt; [  () :&lt; [  () :&lt; []\n               ,  () :&lt; []\n               ]\n      ,  () :&lt; []\n      ]\n</code></pre>\n\n<p>Similarly, <code>Cofree Maybe ()</code> is more or less the fixpoint of <code>Maybe</code>: a copy of the natural numbers, because <code>Maybe</code> gives us either zero or one position into which to plug a subtree.</p>\n\n<pre><code>zero :: Cofree Maybe ()\nzero = () :&lt; Nothing\nsucc :: Cofree Maybe () -&gt; Cofree Maybe ()\nsucc n = () :&lt; Just n\n</code></pre>\n\n<p>An important trivial case is <code>Cofree (Const y) ()</code>, which is a copy of <code>y</code>. The <code>Const y</code> functor gives <em>no</em> positions for subtrees.</p>\n\n<pre><code>pack :: y -&gt; Cofree (Const y) ()\npack y = () :&lt; Const y\n</code></pre>\n\n<p>Next, let's get busy with the other parameter. It tells you what sort of label you attach to each node. Renaming the parameters more suggestively</p>\n\n<pre><code>data Cofree nodeOf label = label :&lt; nodeOf (Cofree nodeOf label)\n</code></pre>\n\n<p>When we label up the <code>(Const y)</code> example, we get <em>pairs</em></p>\n\n<pre><code>pair :: x -&gt; y -&gt; Cofree (Const y) x\npair x y = x :&lt; Const y\n</code></pre>\n\n<p>When we attach labels to the nodes of our numbers, we get <em>nonempty</em> lists</p>\n\n<pre><code>one :: x -&gt; Cofree Maybe x\none = x :&lt; Nothing\ncons :: x -&gt; Cofree Maybe x -&gt; Cofree Maybe x\ncons x xs = x :&lt; Just xs\n</code></pre>\n\n<p>And for lists, we get <em>labelled</em> rose trees.</p>\n\n<pre><code>0 :&lt; [  1 :&lt; [  3 :&lt; []\n             ,  4 :&lt; []\n             ]\n     ,  2 :&lt; []\n     ]\n</code></pre>\n\n<p>These structures are always \"nonempty\", because there is at least a top node, even if it has no children, and that node will always have a label. The <code>extract</code> operation gives you the label of the top node.</p>\n\n<pre><code>extract :: Cofree f a -&gt; a\nextract (a :&lt; _) = a\n</code></pre>\n\n<p>That is, <code>extract</code> throws away the <em>context</em> of the top label.</p>\n\n<p>Now, the <code>duplicate</code> operation <em>decorates</em> every label with <em>its own</em> context.</p>\n\n<pre><code>duplicate :: Cofree f a -&gt; Cofree f (Cofree f a)\nduplicate a :&lt; fca = (a :&lt; fca) :&lt; fmap duplicate fca  -- f's fmap\n</code></pre>\n\n<p>We can get a <code>Functor</code> instance for <code>Cofree f</code> by visiting the whole tree</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Cofree f a -&gt; Cofree f b\nfmap g (a :&lt; fca) = g a :&lt; fmap (fmap g) fca\n    --                     ^^^^  ^^^^\n    --                 f's fmap  ||||\n    --                           (Cofree f)'s fmap, used recursively\n</code></pre>\n\n<p>It's not hard to see that</p>\n\n<pre><code>fmap extract . duplicate = id\n</code></pre>\n\n<p>because <code>duplicate</code> decorates every node with its context, then <code>fmap extract</code> throws away the decoration.</p>\n\n<p>Note that <code>fmap</code> gets to look only at the labels of the input to compute the labels of the output. Suppose we wanted to compute output labels depending on each input label <em>in its context</em>? E.g., given an unlabelled tree, we might want to label each node with the size of its entire subtree. Thanks to the <code>Foldable</code> instance for <code>Cofree f</code>, we should be able to count nodes with.</p>\n\n<pre><code>length :: Foldable f =&gt; Cofree f a -&gt; Int\n</code></pre>\n\n<p>So that means</p>\n\n<pre><code>fmap length . duplicate :: Cofree f a -&gt; Cofree f Int\n</code></pre>\n\n<p>The key idea of comonads is that they capture \"things with some context\", and they let you apply context-dependent maps everywhere.</p>\n\n<pre><code>extend :: Comonad c =&gt; (c a -&gt; b) -&gt; c a -&gt; c b\nextend f = fmap f       -- context-dependent map everywhere\n           .            -- after\n           duplicate    -- decorating everything with its context\n</code></pre>\n\n<p>Defining <code>extend</code> more directly saves you the trouble of duplication (although that amounts only to sharing).</p>\n\n<pre><code>extend :: (Cofree f a -&gt; b) -&gt; Cofree f a -&gt; Cofree f b\nextend g ca@(_ :&lt; fca) = g ca :&lt; fmap (extend g) fca\n</code></pre>\n\n<p>And you can get <code>duplicate</code> back by taking</p>\n\n<pre><code>duplicate = extend id -- the output label is the input label in its context\n</code></pre>\n\n<p>Moreover, if you pick <code>extract</code> as the thing to do to each label-in-context, you just put each label back where it came from:</p>\n\n<pre><code>extend extract = id\n</code></pre>\n\n<p>These \"operations on labels-in-context\" are called \"co-Kleisli arrows\",</p>\n\n<pre><code>g :: c a -&gt; b\n</code></pre>\n\n<p>and the job of <code>extend</code> is to interpret a co-Kleisli arrow as a function on whole structures. The <code>extract</code> operation is the identity co-Kleisli arrow, and it's interpreted by <code>extend</code> as the identity function. Of course, there is a co-Kleisli composition</p>\n\n<pre><code>(=&lt;=) :: Comonad c =&gt; (c s -&gt; t) -&gt; (c r -&gt; s) -&gt; (c r -&gt; t)\n(g =&lt;= h) = g . extend h\n</code></pre>\n\n<p>and the comonad laws ensure that <code>=&lt;=</code> is associative and absorbs <code>extract</code>, giving us the co-Kleisli category. Moreover we have</p>\n\n<pre><code>extend (g =&lt;= h)  =  extend g . extend h\n</code></pre>\n\n<p>so that <code>extend</code> is a <em>functor</em> (in the categorical sense) from the co-Kleisli category to sets-and-functions. These laws are not hard to check for <code>Cofree</code>, as they follow from the <code>Functor</code> laws for the node shape.</p>\n\n<p>Now, one useful way to see a structure in a cofree comonad is as a kind of \"game server\". A structure</p>\n\n<pre><code>a :&lt; fca\n</code></pre>\n\n<p>represents the state of the game. A move in the game consists either of \"stopping\", in which case you get the <code>a</code>, or of \"continuing\", by choosing a subtree of the <code>fca</code>. For example, consider</p>\n\n<pre><code>Cofree ((-&gt;) move) prize\n</code></pre>\n\n<p>A client for this server must either stop, or continue by giving a <code>move</code>: it's a <em>list</em> of <code>move</code>s. The game is played out as follows:</p>\n\n<pre><code>play :: [move] -&gt; Cofree ((-&gt;) move) prize -&gt; prize\nplay []       (prize :&lt; _) = prize\nplay (m : ms) (_     :&lt; f) = play ms (f m)\n</code></pre>\n\n<p>Perhaps a <code>move</code> is a <code>Char</code> and the <code>prize</code> is the result of parsing the character sequence.</p>\n\n<p>If you stare hard enough, you'll see that <code>[move]</code> is a version of <code>Free ((,) move) ()</code>. Free monads represent client strategies. The functor <code>((,) move)</code> amounts to a command interface with only the command \"send a <code>move</code>\". The functor <code>((-&gt;) move)</code> is the corresponding structure \"respond to the sending of a <code>move</code>\".</p>\n\n<p>Some functors can be seen as capturing a command interface; the free monad for such a functor represents programs that make commands; the functor will have a \"dual\" which represents how to respond to commands; the cofree comonad of the dual is the general notion of environment in which programs that make commands can be run, with the label saying what to do if the program stops and returns a value, and the substructures saying how to carry on running the program if it issues a command.</p>\n\n<p>For example,</p>\n\n<pre><code>data Comms x = Send Char x | Receive (Char -&gt; x)\n</code></pre>\n\n<p>describes being allowed to send or receive characters. Its dual is</p>\n\n<pre><code>data Responder x = Resp {ifSend :: Char -&gt; x, ifReceive :: (Char, x)}\n</code></pre>\n\n<p>As an exercise, see if you can implement the interaction</p>\n\n<pre><code>chatter :: Free Comms x -&gt; Cofree Responder y -&gt; (x, y)\n</code></pre>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4615, "favorite_count": 18, "accepted_answer_id": 38817843, "answer_count": 1, "score": 40, "last_activity_date": 1470730656, "creation_date": 1470592784, "last_edit_date": 1470608991, "question_id": 38816993, "link": "https://stackoverflow.com/questions/38816993/what-are-some-motivating-examples-for-cofree-comonad-in-haskell", "title": "What are some motivating examples for Cofree CoMonad in Haskell?", "body": "<p>I've been playing with <code>Cofree</code>, and can't quite grok it.</p>\n\n<p>For example, I want to play with <code>Cofree [] Num</code> in ghci and can't quite get any interesting examples.</p>\n\n<p>For example, if I construct a Cofree type:</p>\n\n<pre><code>let a = 1 :&lt; [2, 3]\n</code></pre>\n\n<p>I would expect <code>extract a == 1</code>, but instead I get this error:</p>\n\n<pre><code>No instance for (Num (Cofree [] a0)) arising from a use of \u2018it\u2019\n    In the first argument of \u2018print\u2019, namely \u2018it\u2019\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>And a type of:</p>\n\n<pre><code>extract a :: (Num a, Num (Cofree [] a)) =&gt; a\n</code></pre>\n\n<p>Can I get some simple examples, even trivial, for how to use Cofree with, say, functors: <code>[]</code>, or <code>Maybe</code>, or <code>Either</code>, that demonstrates </p>\n\n<ul>\n<li><code>extract</code></li>\n<li><code>extend</code></li>\n<li><code>unwrap</code></li>\n<li><code>duplicate</code>?</li>\n</ul>\n\n<p>Cross Posted: <a href=\"https://www.reddit.com/r/haskell/comments/4wlw70/what_are_some_motivating_examples_for_cofree/\">https://www.reddit.com/r/haskell/comments/4wlw70/what_are_some_motivating_examples_for_cofree/</a></p>\n\n<p>EDIT: Guided by David Young's comment, here are some better examples that show where my first attempts were misguided, however I'd still love some examples that can guide an intuition of Cofree:</p>\n\n<pre><code>&gt; let a = 1 :&lt; []\n&gt; extract a\n    1\n&gt; let b = 1 :&lt; [(2 :&lt; []), (3 :&lt; [])]\n&gt; extract b\n    1\n&gt; unwrap b\n    [2 :&lt; [],3 :&lt; []]\n&gt; map extract $ unwrap b\n    [2,3]\n</code></pre>\n"}, {"tags": ["linux", "bash", "haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470587588, "post_id": 38816153, "comment_id": 64999591, "body": "How are you running the program? Also what are you expecting to happen? GHCI seems to execute anything piped in so I&#39;m not sure you could ever re-read stdin."}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "edited": false, "score": 2, "creation_date": 1470588154, "post_id": 38816153, "comment_id": 64999748, "body": "This looks related to your problem: <a href=\"http://stackoverflow.com/questions/38776023/handle-is-semi-closed-error-in-haskell\" title=\"handle is semi closed error in haskell\">stackoverflow.com/questions/38776023/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1470588169, "post_id": 38816153, "comment_id": 64999751, "body": "<code>interact</code> and GHCi do not mix well, IIRC. <code>interact</code> wants ALL the stdin for itself, and GHCi can not get it back."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "edited": false, "score": 0, "creation_date": 1470592027, "post_id": 38816153, "comment_id": 65000742, "body": "@villou24 not really, because I did not try to read from stdin twice."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1470592120, "post_id": 38816153, "comment_id": 65000767, "body": "@FordO. The suggestion is that you implicitly tried to read from stdin twice - once for the REPL (ghci) and once for your explicit <code>interact</code> call."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470635727, "post_id": 38819087, "comment_id": 65010531, "body": "Thanks, The control code literals are really pain, because I cant make any typo... Windows ghci somehow managed to interpret them in the right way so I am confused why linux ghci cannot."}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 3, "last_activity_date": 1470608442, "creation_date": 1470608442, "answer_id": 38819087, "question_id": 38816153, "link": "https://stackoverflow.com/questions/38816153/reading-stdin-in-ghci-on-linux-is-broken/38819087#38819087", "title": "Reading stdin in ghci on Linux is broken", "body": "<p>Regarding the control code literals, this is because you've managed to escape all of the line editors (readline, Haskeline) that would usually interpret your key presses.</p>\n\n<p>I don't know the particulars, but invoking GHCi is something like starting a subshell with <code>bash --noediting</code>. This allows GHCi to receive raw key presses without interference from the readline library. This is done because Haskeline&mdash;which GHCi uses in place of readline&mdash;can be configured with things like tab completion for available functions more easily (you knew GHCi provided tab completion, right?).</p>\n\n<p>Calling <code>getLine</code> from GHCi then effectively drops through a trap door and dodges Haskeline completely by going straight to stdin. There is, after all, only one stdin. You're now typing directly into an unbuffered terminal.</p>\n\n<p>Getting back to your first concern, there being only one stdin is also why GHCi immediately keels over after printing the <code>Prelude&gt;</code> prompt. <code>interact</code> (which uses <code>hGetContents</code> behind the scenes) claims that it will address all of the input that will ever come through the handle (stdin) as one big lazy <code>String</code>. Effectively there can be no remaining input on the handle that <code>interact</code> hasn't already claimed to deal with, so the handle is immediately put into a &ldquo;semi-closed&rdquo; state. It's not closed (there could still be more input that will be read as part of that lazy <code>String</code> <code>interact</code> gets!) but it <em>is</em> closed to any newcomers, otherwise input would get duplicated (<code>interact</code> and new readers of the handle such as <code>getLine</code> would get the same line!).</p>\n\n<p>Back to GHCi, after having used <code>interact</code>, stdout is still fine so the prompt gets printed as usual, then GHCi leans on Haskeline to return a line for processing. Haskeline (as a line editor) calls a blocking <code>getChar</code> (iirc) to either add a character to the line or perform some line editing command and dies because it's addressing a semi-closed handle. Thus a weaker creature does fall and the great wheel of life rolls on.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 38819087, "answer_count": 1, "score": 0, "last_activity_date": 1470648982, "creation_date": 1470586926, "last_edit_date": 1470648982, "question_id": 38816153, "link": "https://stackoverflow.com/questions/38816153/reading-stdin-in-ghci-on-linux-is-broken", "title": "Reading stdin in ghci on Linux is broken", "body": "<p>Comming from Windows, I have recently installed linux distribution named Peppermint and Haskell-Platform via bash (ghc 7.10) but there must be something wrong with ghci stdin in ghci because :</p>\n\n<p><code>interact $ take 0</code>\nthrows an error but\n<code>interact $ take 1</code>\ndoes not.</p>\n\n<p>Furthermore, if I use <code>backspace</code>, <code>arrows</code> or any other control button when writing into stdin, it <em>enters the char symbol</em>. For example backspace <strong>enters <code>^?</code></strong> into ghci <strong>instead of deleting</strong> the last char typed...</p>\n\n<blockquote>\n<pre><code>...@... ~ $ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; interact $ take 0\nPrelude&gt; \n&lt;stdin&gt;: hGetChar: illegal operation (handle is closed)\n...@... ~ $ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; readLn :: IO String \neuoe^?^?^[[1;5C^[[D^[[B -- here I tried to delete 'euoe'\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470594091, "post_id": 38815948, "comment_id": 65001328, "body": "The type of <code>readsPrec</code> is just <code>Int -&gt; String -&gt; [(a, String)]</code>. You can return the empty list to denote a read failure, or the singleton <code>[(x, &quot;&quot;)]</code> where <code>x</code> is the parse result to denote success. If you already have a <code>Parsec</code> parser for your type, or any other parser, just run this parser and convert its output to the appropriate form."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470636395, "post_id": 38815948, "comment_id": 65010775, "body": "But this <code>&quot;&quot;</code> looks wrong: it won&#39;t return the rest of the string that is not parsed, right?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1470595852, "post_id": 38817257, "comment_id": 65001813, "body": "<code>readsPrec _ str = [(parsecRead str, &quot;&quot;)]</code> seems like a bad idea. It completely ignores parse errors, and doesn&#39;t compose well with functions that expect <code>readsPrec</code> to return the unparsed bits of the string. And what&#39;s more, it&#39;s not even necessary to be bad in these ways: parsec is perfectly capable of reporting parse errors and perfectly capable of returning the unparsed part of the input string."}, {"owner": {"reputation": 298, "user_id": 6683971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166e3700254b59411c77efc7ba60267b?s=128&d=identicon&r=PG&f=1", "display_name": "Elias Riedel G&#229;rding", "link": "https://stackoverflow.com/users/6683971/elias-riedel-g%c3%a5rding"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470601592, "post_id": 38817257, "comment_id": 65003379, "body": "@DanielWagner That sounds like it would be an improvement! Could you provide an example? I am not very familiar with parsec and I can&#39;t find an obvious way to return the unparsed part in the documentation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470624161, "post_id": 38817257, "comment_id": 65007908, "body": "<a href=\"http://lpaste.net/175029\" rel=\"nofollow noreferrer\">Here&#39;s a proof of concept.</a> In ghci, <code>parsecToReads (char &#39;a&#39; &lt;|&gt; char &#39;b&#39;) &quot;abc&quot;</code> produces <code>[(&#39;a&#39;,&quot;bc&quot;)]</code>."}], "tags": [], "owner": {"reputation": 298, "user_id": 6683971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166e3700254b59411c77efc7ba60267b?s=128&d=identicon&r=PG&f=1", "display_name": "Elias Riedel G&#229;rding", "link": "https://stackoverflow.com/users/6683971/elias-riedel-g%c3%a5rding"}, "is_accepted": true, "score": 6, "last_activity_date": 1470594675, "creation_date": 1470594675, "answer_id": 38817257, "question_id": 38815948, "link": "https://stackoverflow.com/questions/38815948/how-to-implement-a-read-instance-with-the-actual-parsing-already-complete-in-ha/38817257#38817257", "title": "How to implement a Read instance with the actual parsing already complete, in Haskell?", "body": "<p>I've been wondering about this for some time, and your question prompted me to look into it.</p>\n\n<p><strong>Summary:</strong> Easiest way to do it manually:</p>\n\n<pre><code>instance Read Tree where\n    readsPrec _ str = [(parsecRead str,\"\")]\n</code></pre>\n\n<p>But <code>deriving</code> is the safer option; the above doesn't work with <code>[Tree]</code> and other data types. My understanding is that <code>Show</code> and <code>Read</code> are <strong>not intended to be implemented manually</strong>; they <strong>should be derived</strong> and work on <strong>syntactically correct Haskell expressions</strong>.</p>\n\n<hr>\n\n<p>It looks like the reason that <code>Read</code> isn't as simple as</p>\n\n<pre><code>class Read a where\n    read :: String -&gt; a\n</code></pre>\n\n<p>is that there is system of parser combinators, similar to but distinct from Parsec, that's designed to be modular, recursive, and so on. But since we are already using a different parser combinator library, Parsec, I'd think it's best to mess with the other system as little as possible.</p>\n\n<p>The Prelude documentation says that a minimal complete implementation of <code>Read</code> is <code>readsPrec</code> or <code>readPrec</code>. The latter is described as \"Proposed replacement for readsPrec using new-style parsers (GHC only)\". This smells like trouble to me, so let's go with implementing <code>readsPrec</code>.</p>\n\n<p>The type is</p>\n\n<pre><code>readsPrec :: Read a =&gt; Int -&gt; ReadS a\ntype ReadS a = String -&gt; [(a,String)]\n</code></pre>\n\n<p>and the documentation for <code>ReadS</code> reads \"A parser for a type <code>a</code>, represented as a function that takes a <code>String</code> and returns a list of possible parses as <code>(a,String)</code> pairs\". To me, it's not entirely obvious what a \"parse\" is, but a peek at the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Text.Read.html#read\" rel=\"noreferrer\">source code for <code>read</code> in <code>Text.Read</code></a> is revealing:</p>\n\n<pre><code>read :: Read a =&gt; String -&gt; a\nread s = either errorWithoutStackTrace id (readEither s)\n\nreadEither :: Read a =&gt; String -&gt; Either String a\nreadEither s =\n    -- minPrec is defined as 0 in Text.ParserCombinators.ReadPrec\n    case [ x | (x,\"\") &lt;- readPrec_to_S read' minPrec s ] of\n      [x] -&gt; Right x\n      []  -&gt; Left \"Prelude.read: no parse\"\n      _   -&gt; Left \"Prelude.read: ambiguous parse\"\n  where\n   read' = -- read' :: P.ReadPrec a\n     do x &lt;- readPrec\n        lift P.skipSpaces -- P is Text.ParserCombinators.ReadP\n        return x\n</code></pre>\n\n<p>I tried to expand the definitions of <code>readPrec_to_S</code> etc., but I  felt it wasn't worth it. I think the definition makes clear that we should return <code>[(x,\"\")]</code> as a successful parse.</p>\n\n<p>The integer argument to <code>readsPrec</code> seems to be the \"precedence context\". My guess is that it is  safe to ignore it if we just want to parse one tree at a time, but that ignoring it will cause problems later if we try to parse instances of <code>[Tree]</code> for example. I will ignore it because I don't think it's worth the trouble.</p>\n\n<p>In short, if we have <code>parsecRead :: String -&gt; Tree</code> as defined in the post you refer to (the author called it <code>read'</code>)</p>\n\n<pre><code>instance Read Tree where\n    readsPrec _ str = [(parsecRead str,\"\")]\n</code></pre>\n\n<p>If we check how this works in a program (using the <code>Show</code> instance that the original asker provided):</p>\n\n<pre><code>main = do\n    print (read \"ABC(DE)F\" == example)\n    print ([read \"ABC(DE)F\", read \"ABC(DE)F\"] :: [Tree])\n    print (read \"[ABC(DE)F,ABC(DE)F]\" :: [Tree])\n</code></pre>\n\n<p>we get</p>\n\n<pre><code>True\n[ABC(DE)F,ABC(DE)F]\nTest.hs: Prelude.read: no parse\n</code></pre>\n\n<p>The complexity and lack of documentation here actually makes me think that <code>deriving (Read)</code> is actually the only safe option, unless you are willing to dive into the details of precedence levels.\nI think I've read somewhere that <code>Show</code> and <code>Read</code> are actually <strong>mainly intended to be derived</strong>, and that the strings are intended to be <strong>syntactically correct Haskell expressions</strong> (please correct me if I'm wrong). For more general parsing, libraries like <code>Parsec</code> are probably the better option.</p>\n\n<p>If you have the energy to look into the source code yourself, the relevant modules appear to be</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Text.Read.html#read\" rel=\"noreferrer\"><code>Text.Read</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Read.html\" rel=\"noreferrer\"><code>GHC.Read</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Text.ParserCombinators.ReadP.html\" rel=\"noreferrer\"><code>Text.ParserCombinators.ReadP</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Text.ParserCombinators.ReadPrec.html\" rel=\"noreferrer\"><code>Text.ParserCombinators.ReadPrec</code></a></li>\n</ul>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 1, "accepted_answer_id": 38817257, "answer_count": 1, "score": 6, "last_activity_date": 1470594675, "creation_date": 1470585596, "last_edit_date": 1495541858, "question_id": 38815948, "link": "https://stackoverflow.com/questions/38815948/how-to-implement-a-read-instance-with-the-actual-parsing-already-complete-in-ha", "title": "How to implement a Read instance with the actual parsing already complete, in Haskell?", "body": "<p>In <a href=\"https://stackoverflow.com/questions/10408046/implementing-read-for-a-left-associative-tree-in-haskell/10410178#10410178\">this answer</a>, one finds the statement that it would not be very hard to implement a <code>Read</code> instance for the datatype <code>Tree</code>, with the actual parsing already complete.  </p>\n\n<p>However, I am having a hard time to understand how such a function as <code>read</code> works: AFAIK, I should implement a <code>readsPrec</code> function instead of <code>read</code> and this <code>readsPrec</code> should perform the reading for strings consisting of only one character. Is this correct?<br>\nIf that is the case, then how should one implement a <code>Read</code> instance of <code>Tree</code> when the parsing is done via <code>ParsecT</code>? Can we break the parsing word by word, or is there any need to do so?  </p>\n\n<p>I didn't think of <code>read</code> as a difficult feature in Haskell, but now I find it quite perplexed and confusing, and I am lost in searching <code>Hoogle</code> for all such unfamiliar things as <code>readP_to_S</code>, <code>readS</code>, etc.  </p>\n\n<p>Any help or reference will be greatly appreciated.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1470576506, "post_id": 38814229, "comment_id": 64996407, "body": "Have the package <code>glib</code> locally at your system and point to it under the <code>packages</code> section in <code>stack.yaml</code>."}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1470579760, "post_id": 38814229, "comment_id": 64997340, "body": "@Sibi Is there no other elegant way to handle this? At least I think, that approach throw out advantages using package manager and make project losing portability, isn&#39;t it?"}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1470584770, "post_id": 38814229, "comment_id": 64998835, "body": "@JunyoungClareJang what do you think would be a more elegant way?"}], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 2, "last_activity_date": 1470584717, "creation_date": 1470584717, "answer_id": 38815811, "question_id": 38814229, "link": "https://stackoverflow.com/questions/38814229/how-can-i-fix-wrong-cabal-file-of-dependent-package-in-haskell-stack/38815811#38815811", "title": "How can I fix wrong .cabal file of dependent package in Haskell Stack?", "body": "<p>Stack lets you use a dependency from a local directory, or a github repo. So feel free to fork the project, do the fixes, maybe even do a PR, and then put this into your stack.yaml under \"packages\" section:</p>\n\n<pre><code>- location:\n    git: https://github.com/user/repo\n    commit: a1b3559090e9c75ce1d46969085fe4f918b2fa82\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470584717, "creation_date": 1470573601, "question_id": 38814229, "link": "https://stackoverflow.com/questions/38814229/how-can-i-fix-wrong-cabal-file-of-dependent-package-in-haskell-stack", "title": "How can I fix wrong .cabal file of dependent package in Haskell Stack?", "body": "<p>I use Haskell Stack in Windows 10</p>\n\n<p>When I try to install gtk as dependency of my own package, I got following messages.</p>\n\n<pre><code>glib-0.13.2.2: configure\nglib-0.13.2.2: build\nProgress: 1/5\n--  While building package glib-0.13.2.2 using:\n      C:\\Users\\junyoung\\AppData\\Local\\Temp\\stack6012\\glib-0.13.2.2\\.stack-work\\dist\\2672c1f3\\setup\\setup --builddir=.stack-work\\dist\\2672c1f3 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: C:\\Users\\junyoung\\Documents\\HaskellProject\\StackProject\\Hotepad\\.stack-work\\logs\\glib-0.13.2.2.log\n\n    [1 of 2] Compiling SetupWrapper     ( SetupWrapper.hs, C:\\Users\\junyoung\\AppData\\Local\\Temp\\stack6012\\glib-0.13.2.2\\.stack-work\\dist\\2672c1f3\\setup\\SetupWrapper.o )\n    [2 of 2] Compiling Main             ( C:\\Users\\junyoung\\AppData\\Local\\Temp\\stack6012\\glib-0.13.2.2\\Setup.hs, C:\\Users\\junyoung\\AppData\\Local\\Temp\\stack6012\\glib-0.13.2.2\\.stack-work\\dist\\2672c1f3\\setup\\Main.o )\n    Linking C:\\Users\\junyoung\\AppData\\Local\\Temp\\stack6012\\glib-0.13.2.2\\.stack-work\\dist\\2672c1f3\\setup\\setup.exe ...\n    [1 of 2] Compiling Gtk2HsSetup      ( Gtk2HsSetup.hs, dist\\setup-wrapper\\Gtk2HsSetup.o )\n    [2 of 2] Compiling Main             ( SetupMain.hs, dist\\setup-wrapper\\Main.o )\n    Linking dist/setup-wrapper\\setup.exe ...\n    Configuring glib-0.13.2.2...\n    Building glib-0.13.2.2...\n    Preprocessing library glib-0.13.2.2...\n    .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_utils.o:StoreValue_hsc_utils.c:(.text+0x0): multiple definition of `__debugbreak'\n    .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_make.o:StoreValue_hsc_make.c:(.text+0x0): first defined here\n    collect2.exe: error: ld returned 1 exit status\n    linking .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_make.o failed (exit code 1)\n    command was: C:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\mingw\\bin\\gcc.exe .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_make.o .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_utils.o -o .stack-work\\dist\\2672c1f3\\build\\System\\Glib\\StoreValue_hsc_make.exe -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib -LC:/msys64/mingw64/lib -lgobject-2.0 -lglib-2.0 -lintl -LC:\\Users\\junyoung\\AppData\\Roaming\\stack\\snapshots\\f21484d8\\lib\\x86_64-windows-ghc-7.10.3\\utf8-string-1.0.1.1-L8eKHa7Iv9q7FVKUYW6u4b -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib -LC:\\Users\\junyoung\\AppData\\Roaming\\stack\\snapshots\\64a043b0\\lib\\x86_64-windows-ghc-7.10.3\\text-1.2.2.1-HmqVQnZSpjaC156ABqPhne -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\binar_3uXFWMoAGBg0xKP9MHKRwi -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\conta_2C3ZI8RgPO2LBMidXKTvIU -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\bytes_6VWy06pWzJq9evDvK2d4w6 -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\deeps_6vMKxt5sPFR0XsbRWvvq59 -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\array_67iodizgJQIIxYVTp4emlA -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\base_HQfYBxpPvuw8OunzQu6JGM -lwsock32 -luser32 -lshell32 -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\integ_2aU3IZNMF9a7mQ0OzsZ0dS -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib\\ghcpr_8TmvWUcS1U1IKHT0levwg3 -LC:\\Users\\junyoung\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\lib/rts -lm -lwsock32 -lgdi32 -lwinmm\n</code></pre>\n\n<p>I found that this messages is because of glib.cabal files bug at glib-0.13.2.2, so when I try to install glib separately, I edit glib.cabal (remove <code>-D___attribute__(A)=</code> option on cpp) and install clearly.</p>\n\n<p>However, when I try to install it using stack, <code>stack install gtk</code> command always takes Hackage one instead of installed glib package.</p>\n\n<p>For short, therefore, my question is, how can I using separately installed glib? Or, is there any way to modify packages .cabal file while installing it, using options or whatever?</p>\n"}, {"tags": ["haskell", "emacs", "haskell-mode", "intero"], "answers": [{"comments": [{"owner": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "edited": false, "score": 0, "creation_date": 1470906207, "post_id": 38814422, "comment_id": 65143283, "body": "I knew about <code>intero-restart</code> but it doesn&#39;t seem to affect an open intero-ghci session. I currently need to close the buffer to force the ghci buffer to pick the changes. Do you know anything about that ?"}, {"owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "reply_to_user": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "edited": false, "score": 0, "creation_date": 1470907720, "post_id": 38814422, "comment_id": 65144359, "body": "I don&#39;t think ghci can reload binary dependencies, so it would be necessary to restart ghci in any case."}, {"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1497271875, "post_id": 38814422, "comment_id": 75993149, "body": "I&#39;m having a similar issue: I added new dependencies in cabal file and can&#39;t get my module to pass compilation. When I do <code>C-c C-l</code> I get compilation error. I&#39;ve tried to do <code>intero-restart</code> but didn&#39;t work... Any ideas?"}, {"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1497271976, "post_id": 38814422, "comment_id": 75993227, "body": "Here&#39;s the <a href=\"https://gist.github.com/galderz/20696510d29ab68348b9a36f479bba79\" rel=\"nofollow noreferrer\">output</a>."}, {"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1497273270, "post_id": 38814422, "comment_id": 75994201, "body": "Actually, my bad, I had put the file in the wrong place."}], "tags": [], "owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "is_accepted": true, "score": 5, "last_activity_date": 1470574946, "creation_date": 1470574946, "answer_id": 38814422, "question_id": 38814153, "link": "https://stackoverflow.com/questions/38814153/update-intero-flycheck-after-changing-cabal-file/38814422#38814422", "title": "Update Intero flycheck after changing cabal file", "body": "<p>All that is necessary is to run</p>\n\n<pre><code>M-x intero-restart\n</code></pre>\n\n<p>in emacs.</p>\n\n<p>Intero uses stack which has its own private sandbox for each package you are developing, so <code>cabal install --dependencies-only</code> isn't needed or useful.</p>\n"}], "owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 0, "accepted_answer_id": 38814422, "answer_count": 1, "score": 2, "last_activity_date": 1474305962, "creation_date": 1470573009, "last_edit_date": 1474305962, "question_id": 38814153, "link": "https://stackoverflow.com/questions/38814153/update-intero-flycheck-after-changing-cabal-file", "title": "Update Intero flycheck after changing cabal file", "body": "<p>I am using Intero under emacs to edit my new Haskell project. I added an import to a third-party library to my code to see if Intero would automatically add the necessary dependency, but it didn't. So I edited the <code>.cabal</code> file manually to add the necessary dependency. Now what do I do - short of restarting emacs?</p>\n\n<p>I've tried running <code>cabal install --dependencies-only; cabal configure</code> at the command line and they ran successfully, but the flycheck buffer still shows an error.</p>\n"}, {"tags": ["scala", "haskell", "typescript", "f#", "ocaml"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1470572294, "post_id": 38814022, "comment_id": 64995318, "body": "Not very commonly used: <a href=\"http://hackage.haskell.org/package/oneOfN-0.1.0.1/docs/Data-OneOfN.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/oneOfN-0.1.0.1/docs/&hellip;</a>"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470572742, "post_id": 38814022, "comment_id": 64995449, "body": "good enough, thanks"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470573602, "post_id": 38814022, "comment_id": 64995660, "body": "I&#39;m fond of the name <code>Threeither</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1470584847, "post_id": 38814022, "comment_id": 64998856, "body": "What do you want this for? Even <code>Either</code> is often a bit vague; once you need three constructors you&#39;re almost certainly better of defining a new type whose name and constructor names describe what they&#39;re supposed to mean in context."}, {"owner": {"reputation": 2671, "user_id": 941384, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6bb2c086a1c4aca9803526929d9b2428?s=128&d=identicon&r=PG", "display_name": "AlexG", "link": "https://stackoverflow.com/users/941384/alexg"}, "edited": false, "score": 1, "creation_date": 1470589389, "post_id": 38814022, "comment_id": 65000039, "body": "Providing you want a sum type of non primitives, the idiomatic typescript code would be something like:      type MyChoice = { name: &#39;choice1&#39; } | { name: &#39;choice2&#39; } | { name: &#39;choice3&#39; }  Where each sum type can have its own data. You can then type guard efficiently when using TS 2.0"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "reply_to_user": {"reputation": 2671, "user_id": 941384, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6bb2c086a1c4aca9803526929d9b2428?s=128&d=identicon&r=PG", "display_name": "AlexG", "link": "https://stackoverflow.com/users/941384/alexg"}, "edited": false, "score": 1, "creation_date": 1470592442, "post_id": 38814022, "comment_id": 65000875, "body": "@AlexG that&#39;s right, all I asked is a name for it"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1470592535, "post_id": 38814022, "comment_id": 65000904, "body": "@dfeuer because i need to return one of 3 possible things out of a function and i think that a dedicated data type is an overkill for this single use case"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470623630, "post_id": 38814022, "comment_id": 65007815, "body": "<code>Either () (Either () ())</code> is a type with exactly 3 distinct values: <code>Left ()</code>, <code>Right (Left ())</code>, and <code>Right (Right ())</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 0, "creation_date": 1470573929, "post_id": 38814188, "comment_id": 64995745, "body": "i am using TypeScript (which doesn&#39;t have a standard lib other than that of JavaScript which lacks types), so I am getting inspired by what other languages have"}], "tags": [], "owner": {"reputation": 28776, "user_id": 2314532, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/90ade367b50c6f2a4796a03c82b1a4a1?s=128&d=identicon&r=PG", "display_name": "rmunn", "link": "https://stackoverflow.com/users/2314532/rmunn"}, "is_accepted": false, "score": 3, "last_activity_date": 1470573281, "creation_date": 1470573281, "answer_id": 38814188, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases/38814188#38814188", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>Which language are you using? If it's F#, there's a three-way <a href=\"https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/core.choice%5b&#39;t1,&#39;t2,&#39;t3%5d-union-%5bfsharp%5d\" rel=\"nofollow\"><code>Choice&lt;'T1,'T2,'T3&gt;</code> type</a>. (Also a 4-, 5-, 6- and 7-way Choice type in addition to the more \"standard\" two-way type).</p>\n"}, {"tags": [], "owner": {"reputation": 3705, "user_id": 459950, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/41a6b438156185e1c71cc419dc2f714c?s=128&d=identicon&r=PG", "display_name": "gregghz", "link": "https://stackoverflow.com/users/459950/gregghz"}, "is_accepted": false, "score": 3, "last_activity_date": 1470580415, "creation_date": 1470580415, "answer_id": 38815188, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases/38815188#38815188", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>For scala there's the <code>Either3</code> from Scalaz: <a href=\"https://github.com/scalaz/scalaz/blob/scalaz-seven/core/src/main/scala/scalaz/Either3.scala\" rel=\"nofollow\">https://github.com/scalaz/scalaz/blob/scalaz-seven/core/src/main/scala/scalaz/Either3.scala</a></p>\n"}, {"comments": [{"owner": {"reputation": 814, "user_id": 5063469, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206292909974171/picture?type=large", "display_name": "Mattias Martens", "link": "https://stackoverflow.com/users/5063469/mattias-martens"}, "edited": false, "score": 0, "creation_date": 1617726246, "post_id": 38816045, "comment_id": 118383007, "body": "This appears to be the only answer that actually answers the question. I thought I was on Quora for a second there! Anyways, thank you."}], "tags": [], "owner": {"reputation": 26162, "user_id": 1596545, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f0b6a45e63d51bc49612282891c49526?s=128&d=identicon&r=PG&f=1", "display_name": "flavian", "link": "https://stackoverflow.com/users/1596545/flavian"}, "is_accepted": false, "score": 7, "last_activity_date": 1470586292, "creation_date": 1470586292, "answer_id": 38816045, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases/38816045#38816045", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>These are called co-products really an <code>Either</code> is simply a 2 argument co-product. You can use helpers from the shapeless library to build arbitrary length co-products using:</p>\n\n<pre><code>type CP = Int :+: String :+: Boolean :+: CNil\n\nval example = Coproduct[CP](\"foo\")\n</code></pre>\n\n<p>You can then use all the fun <code>poly</code> magic to map them or perform other operations:</p>\n\n<pre><code>object printer extends Poly1 {\n  implicit def caseInt = at[Int](i =&gt; i -&gt; s\"$i is an int\")\n  implicit def caseString = at[String](s =&gt; s -&gt; s\"$s is a string\")\n  implicit def caseBoolean = at[Boolean](b =&gt; s -&gt; s\"$b is a bool\")\n}\nval mapped = example map printer\nmapped.select[(String, String)] shouldEqual \"foo is a string\"\n</code></pre>\n\n<p>Scala.JS + Shapeless can work together as far as I know, so that may give you what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": false, "score": 17, "last_activity_date": 1470587560, "creation_date": 1470587560, "answer_id": 38816257, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases/38816257#38816257", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>I think that heavily relying on type like this is an anti-pattern.</p>\n\n<p>One of the nicest things you get from using algebraic data types is that the resulting type tells you something about the domain that you are working with. With a generic type like <code>Choice&lt;T1, T2, T3&gt;</code>, you are really not saying anything about the domain.</p>\n\n<p>I think <code>option&lt;T&gt;</code> (aka <code>Maybe</code>) is quite clear in that it says that a value of type <code>T</code> is either there or it is missing for some reason. I think <code>Either&lt;'T, exn&gt;</code> is still quite clear in that it says you get a value or an exception. However when you have more than two cases, it becomes quite hard to understand what is meant by the cases and so explicitly defining a type with names to match the domain might be a good idea.</p>\n\n<p>(I do use <code>Choice&lt;T1, T2, T3&gt;</code> in F# occasionally, but the usage is typically limited to a small scope - less than 50 lines of code - so that I can easily find what the meaning is in the surroundings of the code that consumes it.)</p>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 9, "last_activity_date": 1470630922, "last_edit_date": 1470630922, "creation_date": 1470606872, "answer_id": 38818919, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases/38818919#38818919", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>In recent Haskell, I'd switch on a bit of kitchen sink.</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, DataKinds, GADTs, KindSignatures,\n    TypeOperators, PatternSynonyms #-}\n</code></pre>\n\n<p>Then I'd define type-level list membership</p>\n\n<pre><code>data (:&gt;) :: [x] -&gt; x -&gt; * where\n  Ze ::            (x ': xs) :&gt; x\n  Su :: xs :&gt; x -&gt; (y ': xs) :&gt; x\n</code></pre>\n\n<p>and now I have all the finite sums, without cranking out a whole raft of OneOfN type definitions:</p>\n\n<pre><code>data Sum :: [*] -&gt; * where\n  (:-) :: xs :&gt; x -&gt; x -&gt; Sum xs\n</code></pre>\n\n<p>But, to address Tomas's issue about readability, I'd make use of pattern synonyms. Indeed, this sort of thing is the reason I've been banging on about pattern synonyms for years.</p>\n\n<p>You can have a funny version of <code>Maybe</code>:</p>\n\n<pre><code>type MAYBE x = Sum '[(), x]\n\npattern NOTHING :: MAYBE x\npattern NOTHING = Ze :- ()\n\npattern JUST :: x -&gt; MAYBE x\npattern JUST x = Su Ze :- x\n</code></pre>\n\n<p>and you can even use <code>newtype</code> to build recursive sums.</p>\n\n<pre><code>newtype Tm x = Tm (Sum '[x, (Tm x, Tm x), Tm (Maybe x)])\n\npattern VAR :: x -&gt; Tm x\npattern VAR x = Tm (Ze :- x)\n\npattern APP :: Tm x -&gt; Tm x -&gt; Tm x\npattern APP f s = Tm (Su Ze :- (f, s))\n\npattern LAM :: Tm (Maybe x) -&gt; Tm x\npattern LAM b = Tm (Su (Su Ze) :- b)\n</code></pre>\n\n<p>The newtype wrapper also lets you make <code>instance</code> declaration for types built that way.</p>\n\n<p>You can, of course, also use pattern synonyms to hide an iterated <code>Either</code> nicely.</p>\n\n<p>This technique is not exclusive to sums: you can do it for products, too, and that's pretty much what happens in de Vries and L\u00f6h's <a href=\"https://hackage.haskell.org/package/generics-sop\">Generics-SOP</a> library.</p>\n\n<p>The big win from such an encoding is that the description of data is itself (type-level) data, allowing you to cook up lots of <code>deriving</code>-style functionality without hacking the compiler.</p>\n\n<p>In the future (if I have my way), all datatypes will be <em>defined</em>, not <em>declared</em>, with datatype descriptions made of data specifiying both the algebraic structure (allowing generic equipment to be computed) of the data and its appearance (so you can see what you're doing when working with a specific type).</p>\n\n<p>But the future is sort of here already.</p>\n"}], "owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1263, "favorite_count": 4, "answer_count": 5, "score": 11, "last_activity_date": 1470630922, "creation_date": 1470572054, "last_edit_date": 1470578560, "question_id": 38814022, "link": "https://stackoverflow.com/questions/38814022/standard-name-of-a-sum-type-like-either-but-for-3-cases", "title": "Standard name of a sum type like Either but for 3 cases?", "body": "<p>Is there a standard sum type like Either but for 3 cases? Haskell has <code>These</code> but it's not quite that.</p>\n"}, {"tags": ["haskell", "cabal", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": true, "score": 1, "last_activity_date": 1470584899, "creation_date": 1470584899, "answer_id": 38815835, "question_id": 38813804, "link": "https://stackoverflow.com/questions/38813804/haskell-cabal-install-parsec-errors/38815835#38815835", "title": "Haskell - Cabal Install parsec errors", "body": "<p>I suggest using <code>stack</code> tool with its stackage infrastructure. Please see <a href=\"http://haskellstack.org\" rel=\"nofollow\">http://haskellstack.org</a> for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1470617627, "creation_date": 1470617627, "answer_id": 38819939, "question_id": 38813804, "link": "https://stackoverflow.com/questions/38813804/haskell-cabal-install-parsec-errors/38819939#38819939", "title": "Haskell - Cabal Install parsec errors", "body": "<p>You could try installing <code>parsec</code> in a sandbox.</p>\n\n<pre><code>$ mkdir asdf\n$ cd asdf\n$ cabal sandbox init\ncabalWriting a default package environment file to\n/Users/steshaw/Projects/asdf/cabal.sandbox.config\nCreating a new sandbox at /Users/steshaw/Projects/asdf/.cabal-sandbox\n$ cabal install parsec\nResolving dependencies...\nNotice: installing into a sandbox located at\n/Users/steshaw/Projects/steshaw/asdf/.cabal-sandbox\nConfiguring mtl-2.2.1...\nConfiguring text-1.2.2.1...\nBuilding text-1.2.2.1...\nBuilding mtl-2.2.1...\nInstalled mtl-2.2.1\nInstalled text-1.2.2.1\nConfiguring parsec-3.1.11...\nBuilding parsec-3.1.11...\nInstalled parsec-3.1.11\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 38815835, "answer_count": 2, "score": 1, "last_activity_date": 1470617627, "creation_date": 1470570431, "question_id": 38813804, "link": "https://stackoverflow.com/questions/38813804/haskell-cabal-install-parsec-errors", "title": "Haskell - Cabal Install parsec errors", "body": "<p>I've been trying to install the parsec library for haskell but I'm running in to a lot of errors. Im very new to haskell &amp; cabal and i don't quite understand the output of the log file.</p>\n\n<p>the output of the log file is here:\n<a href=\"http://pastebin.com/6hPQN1W4\" rel=\"nofollow\">http://pastebin.com/6hPQN1W4</a></p>\n\n<p>I tried installing the packages that the log file said that it could not find, but i keep getting errors when trying to install the packages.</p>\n\n<p>I reinstalled cabal and also ran cabal update, but this did not resolve the issue</p>\n\n<p>any help will be appreciated?</p>\n"}, {"tags": ["multithreading", "haskell", "asynchronous"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1470565925, "post_id": 38813012, "comment_id": 64993792, "body": "Your <code>collect</code> doesn&#39;t return until all the <code>Async</code>s in the list have completed. Is that what you&#39;re after?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470592534, "post_id": 38813012, "comment_id": 65000903, "body": "No. I didn&#39;t realized that. My implementation is indeed wrong. My idea was having <code>collect</code> return a result as soon as the asynchronous thread is ready. I&#39;ll edit my answer accordingly."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1470591970, "post_id": 38813404, "comment_id": 65000730, "body": "I do not want to sort the <code>Async</code> values by completion time, but be able to start processing as soon as a result becomes available. Thanks for pointing this out. I&#39;ll add this clarification to my question."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 0, "last_activity_date": 1470572673, "last_edit_date": 1495541285, "creation_date": 1470567376, "answer_id": 38813404, "question_id": 38813012, "link": "https://stackoverflow.com/questions/38813012/collecting-the-async-results-as-they-become-available/38813404#38813404", "title": "Collecting the Async results as they become available", "body": "<p>I'm reading your question as \"is it possible to sort a list of <code>Async</code>s by their completion time?\". If that's what you meant, the answer is yes.</p>\n\n<pre><code>import Control.Applicative (liftA2)\nimport Control.Concurrent (threadDelay)\nimport Control.Concurrent.Async\nimport Data.Functor (($&gt;))\nimport Data.List (sortBy)\nimport Data.Ord (comparing)\nimport Data.Time (getCurrentTime)\n\n\nsortByCompletion :: [Async a] -&gt; IO [a]\nsortByCompletion = fmap (fmap fst . sortBy (comparing snd)) . mapConcurrently withCompletionTime\n    where withCompletionTime async = liftA2 (,) (wait async) getCurrentTime\n\nmain = do\n    asyncs &lt;- traverse async [threadDelay 2000000 $&gt; \"bar\", threadDelay 1000000 $&gt; \"foo\"]\n    sortByCompletion asyncs\n-- [\"foo\", \"bar\"], after two seconds\n</code></pre>\n\n<p>Using <code>mapConcurrently</code> we wait for each <code>Async</code> on a separate thread. Upon completion we get the current time - the time at which the <code>Async</code> completed - and use it to sort the results. This is O(n log n) complexity because we are sorting the list. (Your original algorithm was effectively a <a href=\"https://en.wikipedia.org/wiki/Selection_sort\" rel=\"nofollow noreferrer\">selection sort</a>.)</p>\n\n<p>Like your <code>collect</code>, <code>sortByCompletion</code> doesn't return until all the <code>Async</code>s in the list have completed. If you wanted to <em>stream</em> results onto the main thread as they become available, well, lists aren't a very good tool for that. I'd use a streaming abstraction like <a href=\"https://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\"><code>conduit</code></a> or <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\"><code>pipes</code></a>, or, working at a lower level, a <a href=\"https://hackage.haskell.org/package/stm-2.4.4.1/docs/Control-Concurrent-STM-TQueue.html\" rel=\"nofollow noreferrer\"><code>TQueue</code></a>. See <a href=\"https://stackoverflow.com/a/38813892/1523776\">my other answer</a> for an example.</p>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 1, "last_activity_date": 1470579230, "last_edit_date": 1495539859, "creation_date": 1470571024, "answer_id": 38813892, "question_id": 38813012, "link": "https://stackoverflow.com/questions/38813012/collecting-the-async-results-as-they-become-available/38813892#38813892", "title": "Collecting the Async results as they become available", "body": "<p>As I mentioned in <a href=\"https://stackoverflow.com/a/38813404/1523776\">my other answer</a>, streaming results out of a list of <code>Async</code>s as they become available is best achieved using a stream processing library. Here's an example using <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\"><code>pipes</code></a>.</p>\n\n<pre><code>import Control.Concurrent (threadDelay)\nimport Control.Concurrent.Async\nimport Control.Concurrent.STM\nimport Data.Functor (($&gt;))\nimport Pipes\nimport Pipes.Concurrent  -- from the pipes-concurrency package\nimport qualified Pipes.Prelude as P\n\n\nasCompleted :: MonadIO m =&gt; [Async a] -&gt; Producer a m ()\nasCompleted asyncs = do\n    (o, i, seal) &lt;- liftIO $ spawn' unbounded\n    liftIO $ forkIO $ do\n        forConcurrently asyncs (\\async -&gt; atomically $ waitSTM async &gt;&gt;= send o)\n        atomically seal\n    fromInput i\n\nmain = do\n    actions &lt;- traverse async [threadDelay 2000000 $&gt; \"bar\", threadDelay 1000000 $&gt; \"foo\"]\n    runEffect $ asCompleted actions &gt;-&gt; P.print\n-- after one second, prints \"foo\", then \"bar\" a second later\n</code></pre>\n\n<p>Using <a href=\"https://hackage.haskell.org/package/pipes-concurrency\" rel=\"nofollow noreferrer\"><code>pipes-concurrency</code></a>, we <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#v:spawn-39-\" rel=\"nofollow noreferrer\"><code>spawn'</code></a> an <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#t:Output\" rel=\"nofollow noreferrer\"><code>Output</code></a>-<a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#t:Input\" rel=\"nofollow noreferrer\"><code>Input</code></a> pair and immediately convert the <code>Input</code> to a <a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes.html#t:Producer\" rel=\"nofollow noreferrer\"><code>Producer</code></a> using <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#v:fromInput\" rel=\"nofollow noreferrer\"><code>fromInput</code></a>. Asynchronously, we <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#v:send\" rel=\"nofollow noreferrer\"><code>send</code></a> items as they become available. When all the <code>Async</code>s have completed we <code>seal</code> the inbox to close down the <code>Producer</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 1, "last_activity_date": 1470580639, "creation_date": 1470580639, "answer_id": 38815224, "question_id": 38813012, "link": "https://stackoverflow.com/questions/38813012/collecting-the-async-results-as-they-become-available/38815224#38815224", "title": "Collecting the Async results as they become available", "body": "<p>Implemented via <code>TChan</code>, additionally implemented a version which can react immediately, but it is more complex and also might have problems with exceptions (if you want to receive exceptions, use <code>SlaveThread.fork</code> instead of <code>forkIO</code>), so I commented that code in case you're not interested in it:</p>\n\n<pre><code>import           Control.Concurrent       (threadDelay)\nimport           Control.Concurrent       (forkIO)\nimport           Control.Concurrent.Async\nimport           Control.Concurrent.STM\nimport           Control.Monad\n\ncollect :: [Async a] -&gt; IO [a]\ncollect = atomically . collectSTM\n\ncollectSTM :: [Async a] -&gt; STM [a]\ncollectSTM as = do\n    c &lt;- newTChan\n    collectSTMChan c as\n\ncollectSTMChan :: TChan a -&gt; [Async a] -&gt; STM [a]\ncollectSTMChan chan as = do\n    mapM_ (waitSTM &gt;=&gt; writeTChan chan) as\n    replicateM (length as) (readTChan chan)\n\nmain :: IO ()\nmain = do\n    a1 &lt;- async (threadDelay 2000000 &gt;&gt; putStrLn \"slept 2 secs\" &gt;&gt; return 2)\n    a2 &lt;- async (threadDelay 3000000 &gt;&gt; putStrLn \"slept 3 secs\" &gt;&gt; return 3)\n    a3 &lt;- async (threadDelay 1000000 &gt;&gt; putStrLn \"slept 1 sec\" &gt;&gt; return 1)\n    res &lt;- collect [a1,a2,a3]\n    putStrLn (show res)\n\n    -- -- reacting immediately\n    -- a1 &lt;- async (threadDelay 2000000 &gt;&gt; putStrLn \"slept 2 secs\" &gt;&gt; return 2)\n    -- a2 &lt;- async (threadDelay 3000000 &gt;&gt; putStrLn \"slept 3 secs\" &gt;&gt; return 3)\n    -- a3 &lt;- async (threadDelay 1000000 &gt;&gt; putStrLn \"slept 1 sec\" &gt;&gt; return 1)\n    -- c &lt;- collectChan [a1,a2,a3]\n    -- replicateM_ 3 (atomically (readTChan c) &gt;&gt;= \\v -&gt; putStrLn (\"Received: \" ++ show v))\n\n-- collectChan :: [Async a] -&gt; IO (TChan a)\n-- collectChan as = do\n--     c &lt;- newTChanIO\n--     forM_ as $ \\a -&gt; forkIO ((atomically . (waitSTM &gt;=&gt; writeTChan c)) a)\n--     return c\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 38813892, "answer_count": 3, "score": 2, "last_activity_date": 1470593085, "creation_date": 1470564168, "last_edit_date": 1470593085, "question_id": 38813012, "link": "https://stackoverflow.com/questions/38813012/collecting-the-async-results-as-they-become-available", "title": "Collecting the Async results as they become available", "body": "<p>How would you collect the results of a list of <code>Async a</code> in Haskell <strong><em>as they become available</em></strong>? The idea is to start processing the results of asynchronous tasks as soon as they are available. </p>\n\n<p>The best I could come up with is the following function:</p>\n\n<pre><code>collect :: [Async a] -&gt; IO [a]\ncollect [] = return []\ncollect asyncs = do\n  (a, r) &lt;- waitAny asyncs\n  rs &lt;- collect (filter (/= a) asyncs)\n  return (r:rs)\n</code></pre>\n\n<p>However, this function does not exhibits the desired behavior since, as pointed out in the comment below, it doesn't return till all the asynchronous tasks are completed. Furthermore, <code>collect</code> runs in <code>O(n^2)</code> since I'm filtering the list at each recursive step. This could be improved by using a more efficient structure (and maybe indexing the position of the <code>Async</code> values in the list).</p>\n\n<p>Maybe there are library functions that take care of this, but I could not find them in the <code>Control.Concurrent.Async</code> module and I wonder why.</p>\n\n<p><strong><em>EDIT</em></strong>: after thinking the problem a bit more carefully, I'm wondering whether such function is a good idea. I could just use <code>fmap</code> on the asynchronous tasks. Maybe it is a better practice to wait for the results when there is no other choice.</p>\n"}, {"tags": ["haskell", "non-deterministic", "monadplus"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470565399, "post_id": 38812627, "comment_id": 64993687, "body": "What happens if you pass <code>[1,2,3]</code> as the argument?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470592834, "post_id": 38812627, "comment_id": 65000983, "body": "It works by chance, try <code>[1..4]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470593089, "post_id": 38813996, "comment_id": 65001058, "body": "That&#39;s just chance, see <code>mergeSortM (liftCmp (&lt;=)) [1,2,3] :: [[Int]]</code>\u21d2  <code>[[1,2,3],[2,1,3],[2,3,1],[1,3,2],[3,1,2],[3,2,1]]</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470593472, "post_id": 38813996, "comment_id": 65001154, "body": "@RowanBlush Interesting. Still, the definition of <code>deinterleave</code> does affect the end result. I wonder which one was used by the authors -- and indeed, if there&#39;s a sensible definition which really produces the intended behaviour."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1470593517, "last_edit_date": 1470593517, "creation_date": 1470571829, "answer_id": 38813996, "question_id": 38812627, "link": "https://stackoverflow.com/questions/38812627/non-deterministic-merge-sort-doesnt-order-permutations-lexicographically/38813996#38813996", "title": "Non-Deterministic Merge Sort Doesn&#39;t Order Permutations Lexicographically", "body": "<p>Let's try a variant of <code>deinterleave</code>, which splits the first and last half of the list, instead of splitting even- and odd- indexed elements as in the posted code:</p>\n\n<pre><code>deinterleave :: [a] -&gt; ([a], [a])\ndeinterleave ys = splitAt (length ys `div` 2) ys\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&gt; mergeSortM (liftCmp (&lt;=)) [2,1,3] :: [[Int]]\n[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]\n</code></pre>\n\n<p>Unfortunately, this does not solve the issue as I first hoped, as Rowan Blush points out below. :-/</p>\n"}], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1613796453, "creation_date": 1470561020, "last_edit_date": 1613796453, "question_id": 38812627, "link": "https://stackoverflow.com/questions/38812627/non-deterministic-merge-sort-doesnt-order-permutations-lexicographically", "title": "Non-Deterministic Merge Sort Doesn&#39;t Order Permutations Lexicographically", "body": "<p>I've been trying to reproduce an aside mentioned in <a href=\"http://informatik.uni-kiel.de/%7Esad/icfp2016-preprint.pdf\" rel=\"nofollow\">All Sorts of Permutations (Functional Pearl)</a> by Christiansen, Danilenko and Dylus, a paper for the upcoming ICFP 2016. Section 8 (&ldquo;Final Remarks&rdquo;) claims that by choosing a particular non-deterministic predicate, a monadic merge sort can produce all permutations of a sequence in lexicographical order.</p>\n\n<blockquote>\n  <p>We did only consider the non-deterministic predicate <em>coinCmp</em>, while there are other non-deterministic predicates that can be used to affect the order of enumeration. For example, the following function lifts a predicate <em>cmp</em> to a non-deterministic context.</p>\n\n<pre><code>liftCmp :: MonadPlus \u03bc\n        \u21d2 (\u03b1 \u2192 \u03b1 \u2192 Bool) \u2192 Cmp \u03b1 \u03bc\nliftCmp p x y = return (p x y) \u2295 return (not (p x y))\n</code></pre>\n  \n  <p>When we use this function to lift a comparison function and pass it to a monadic version of merge sort, we get a special kind of permutation function: it enumerates permutations in lexicographical order.</p>\n</blockquote>\n\n<p>I'm pretty sure what I've written here is merge sort, but when run the ordering isn't as advertised.</p>\n\n<pre><code>import Control.Applicative (Alternative((&lt;|&gt;)))\nimport Control.Monad (MonadPlus, join)\nimport Data.Functor.Identity (Identity)\n\n-- Comparison in a context\ntype Comparison a m = a -&gt; a -&gt; m Bool\n\n-- Ordering lifted into the Boring Monad\nboringCmp :: (a -&gt; a -&gt; Bool) -&gt; Comparison a Identity\nboringCmp p x y = return (p x y)\n\n-- Arbitrary ordering in a non-deterministic context\ncmp :: MonadPlus m =&gt; Comparison a m\ncmp _ _ = return True &lt;|&gt; return False\n\n-- Ordering lifted into a non-deterministic context\nliftCmp :: MonadPlus m =&gt; (a -&gt; a -&gt; Bool) -&gt; Comparison a m\nliftCmp p x y = let b = p x y in return b &lt;|&gt; return (not b)\n\nmergeM :: Monad m =&gt; Comparison a m -&gt; [a] -&gt; [a] -&gt; m [a]\nmergeM _ ls         []         = return ls\nmergeM _ []         rs         = return rs\nmergeM p lls@(l:ls) rrs@(r:rs) = do\n    b &lt;- p l r\n    if b\n    then (l:) &lt;$&gt; mergeM p ls rrs\n    else (r:) &lt;$&gt; mergeM p lls rs\n\nmergeSortM :: Monad m =&gt; Comparison a m -&gt; [a] -&gt; m [a]\nmergeSortM _ []  = return []\nmergeSortM _ [x] = return [x]\nmergeSortM p xs  = do\n    let (ls, rs) = deinterleave xs\n    join $ mergeM p &lt;$&gt; mergeSortM p ls &lt;*&gt; mergeSortM p rs\n  where\n    deinterleave :: [a] -&gt; ([a], [a])\n    deinterleave [] = ([], [])\n    deinterleave [l] = ([l], [])\n    deinterleave (l:r:xs) = case deinterleave xs of (ls, rs) -&gt; (l:ls, r:rs)\n</code></pre>\n\n<blockquote>\n<pre><code>\u03bb mergeSortM (boringCmp (&lt;=)) [2,1,3] :: Identity [Int]\nIdentity [1,2,3]\n\n\u03bb mergeSortM cmp [2,1,3] :: [[Int]]\n[[2,3,1],[2,1,3],[1,2,3],[3,2,1],[3,1,2],[1,3,2]]\n\n\u03bb mergeSortM (liftCmp (&lt;=)) [2,1,3] :: [[Int]]\n[[1,2,3],[2,1,3],[2,3,1],[1,3,2],[3,1,2],[3,2,1]]\n</code></pre>\n</blockquote>\n\n<p>And the actual lexicographic ordering for reference&mdash;</p>\n\n<blockquote>\n<pre><code>\u03bb sort it\n[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]\n</code></pre>\n</blockquote>\n"}, {"tags": ["multithreading", "haskell", "asynchronous"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1470644930, "post_id": 38818009, "comment_id": 65014999, "body": "Actually, <code>mapConcurrently</code> is defined in terms of <code>concurrently</code>! So I would expect both versions to spawn the same number of threads."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1470647110, "post_id": 38818009, "comment_id": 65016225, "body": "You know what, I think you&#39;re right. I must have had a brain fart while I was looking at the <code>Concurrently</code> instances. For some reason I thought there was a fancy <code>wait___</code> combinator for more than two <code>Async</code>s, but I must have hallucinated it."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1470648449, "post_id": 38818009, "comment_id": 65017068, "body": "It took me a while to &quot;unfold&quot; the implementation of <code>mapConcurrently</code> using <code>traverse</code>, <code>&lt;$&gt;</code>, and <code>&lt;*&gt;</code>. It is a tricky implementation..."}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 2, "last_activity_date": 1470647245, "last_edit_date": 1470647245, "creation_date": 1470600032, "answer_id": 38818009, "question_id": 38812494, "link": "https://stackoverflow.com/questions/38812494/how-many-threads-are-spawned-by-this-program-geturls9-hs/38818009#38818009", "title": "How many threads are spawned by this program (geturls9.hs)", "body": "<p>All guesses are wrong! There are in fact <strong>six</strong> threads spawned.</p>\n\n<p>Let's bring out the sledgehammer&mdash;</p>\n\n<pre><code>import Control.Concurrent.Async\nimport Control.Concurrent (myThreadId)\n\nimport qualified Data.ByteString as B\n\n-----------------------------------------------------------------------------\n\nsites = [\"http://www.google.com\",\n         \"http://www.wikipedia.com/wiki/Spade\",\n         \"http://www.wikipedia.com/wiki/Shovel\"]\n\ngetURL _ = return B.empty\n\nannotate :: IO a -&gt; IO a\nannotate action = do\n    tid &lt;- myThreadId\n    putStrLn $ \"I'm a thread and my ID is: \" ++ show tid\n    action\n\n-- &lt;&lt;main\nmain = do\n  xs &lt;- foldr conc (return []) (map getURL sites)\n  print (map B.length xs)\n where\n  conc ioa ioas = do\n    (a,as) &lt;- concurrently (annotate ioa) (annotate ioas)\n    return (a:as)\n-- &gt;&gt;\n</code></pre>\n\n<p>All of the actions passed to <code>concurrently</code> will be wrapped with <code>annotate</code>, which causes the thread to barf its <code>ThreadId</code> to stdout. Running this I get&mdash;</p>\n\n<blockquote>\n<pre><code>+$ ./geturls9\nI'm a thread and my ID is: ThreadId 5\nI'm a thread and my ID is: ThreadId 6\nI'm a thread and my ID is: ThreadId 8\nI'm a thread and my ID is: ThreadId 9\nI'm a thread and my ID is: ThreadId 10\nI'm a thread and my ID is: ThreadId 7\n[0,0,0]\n</code></pre>\n</blockquote>\n\n<p>Your result for the same program will almost certainly differ in the particulars of ID number and ordering due to differences in GHC versions and racing, of course.</p>\n\n<p>So, your intuition was good! Your analysis is only off by one because the entire expression <code>g0 `conc` (g1 `conc` (g2 `conc` (return [])))</code> isn't itself passed to <code>concurrently</code>, so your <code>thread0</code> is of course just the main thread, not one created by the async library.</p>\n\n<p>Note that async provides <a href=\"http://hackage.haskell.org/package/async-2.1.0/docs/Control-Concurrent-Async.html#v:mapConcurrently\" rel=\"nofollow\"><code>mapConcurrently</code></a> for concurrently processing any <code>Traversable</code> so you don't have to build your own using <code>foldr</code>. Why this function isn't mentioned in <em>Parallel and Concurrent Programming in Haskell</em>, I'm not sure. It was introduced in async-2.0.1.0, and the Haskell Platform version 2012.4.0.0 (which the introduction to <em>PCPH</em> mentions all the code was tested with) includes async-2.0.1.3. Probably a pedagogical reason, maybe the usual delays in publishing combined with the code having been developed against an older version of the platform/library, who knows. The same introduction mentions that &ldquo;sample code will be updated as new versions of the platform are released.&rdquo; If you feel strongly, submit an <a href=\"http://www.oreilly.com/catalog/errata.csp?isbn=0636920026365\" rel=\"nofollow\">erratum</a>!</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 1, "accepted_answer_id": 38818009, "answer_count": 1, "score": 2, "last_activity_date": 1470647245, "creation_date": 1470560021, "question_id": 38812494, "link": "https://stackoverflow.com/questions/38812494/how-many-threads-are-spawned-by-this-program-geturls9-hs", "title": "How many threads are spawned by this program (geturls9.hs)", "body": "<p>I'm reading Chapter 11 of <a href=\"http://community.haskell.org/~simonmar/pcph/\" rel=\"nofollow\">Parallel and Concurrent Programming in Haskell</a>. In that book, the following <a href=\"https://github.com/simonmar/parconc-examples/blob/master/geturls9.hs\" rel=\"nofollow\">program</a> is used to get URL's concurrently:</p>\n\n<pre><code>main = do\n  xs &lt;- foldr conc (return []) (map getURL sites)\n  print (map B.length xs)\n where\n  conc ioa ioas = do\n    (a,as) &lt;- concurrently ioa ioas\n    return (a:as)\n</code></pre>\n\n<p>Assume that the \"get URL\" jobs are <code>[g0, g1, g2]</code>. As far as I understand, <code>xs</code> will be bound to the following structure:</p>\n\n<pre><code>g0 `conc` (g1 `conc` (g2 `conc` (return [])))\n</code></pre>\n\n<p>Now, my question is how many threads will be created in this case. My guess is that 7 threads will be created (as opposed to the 4 that I would expect to use for this job):</p>\n\n<pre><code> thread0: g0 `conc` (g1 `conc` (g2 `conc` (return [])))\n   thread1: g0\n   thread2: (g1 `conc` (g2 `conc` (return [])))\n     thread3: g1\n     thread4: (g2 `conc` (return []))\n       thread5: g2\n       thread6: return []\n</code></pre>\n\n<p>Is this reasoning correct?</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470539356, "post_id": 38810398, "comment_id": 64989062, "body": "In your example, do you mean it should return <code>2</code>?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1470549832, "post_id": 38810398, "comment_id": 64990559, "body": "Writing your own implementation is a great way to learn.  After that it is also useful to look for, and understand instead of simply accept, alternative implementations.  In this case I encourage you to look at @Andrey&#39;s answer and consider  <code>eBefore n xs = lookup n (zip (drop 1 xs) xs)</code>"}, {"owner": {"reputation": 112, "user_id": 5281186, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b0e455c66ee5ba3919b3d86fc21261c?s=128&d=identicon&r=PG&f=1", "display_name": "Th3Dark0", "link": "https://stackoverflow.com/users/5281186/th3dark0"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470554762, "post_id": 38810398, "comment_id": 64991425, "body": "@RowanBlush yes it should return 2. I am sorry for confusion."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470552522, "post_id": 38810546, "comment_id": 64991009, "body": "You need <code>| x2 == n   = Just x1</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470556396, "post_id": 38810546, "comment_id": 64991738, "body": "@chi I bet you have enough reputation to make that edit yourself. ;-)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470567827, "post_id": 38810546, "comment_id": 64994229, "body": "@DanielWagner Yes, I actually wondered whether that was appropriate -- this was probably a simple thing to do, but in general I might be wrong, and I don&#39;t like to introduce errors in others&#39; answers, so I am bit conservative in editing."}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470569784, "post_id": 38810546, "comment_id": 64994708, "body": "@chi, Daniel, thank you for correcting my negligence."}], "tags": [], "owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "is_accepted": true, "score": 2, "last_activity_date": 1470556367, "last_edit_date": 1470556367, "creation_date": 1470539584, "answer_id": 38810546, "question_id": 38810398, "link": "https://stackoverflow.com/questions/38810398/return-the-element-just-before-the-occurrence-of-another-element-in-haskell/38810546#38810546", "title": "Return the element just before the occurrence of another element in haskell", "body": "<p>You can match more elaborated patterns:</p>\n\n<pre><code>eBefore n [] = Nothing\neBefore n [_] = Nothing\neBefore n (x1:xs@(x2:_))\n    | x2 == n   = Just x1\n    | otherwise = eBefore n xs\n</code></pre>\n\n<p>Here we return <code>Nothing</code> for lists containing zero or one elements because they contain no member with another one preceding them. <code>(x1:xs@(x2:_))</code> is a pattern that matches a <code>x1:xs</code>, where <code>xs</code> in turn matches <code>x2:_</code>, that is, a list with at least two elements, the first element is bound to <code>x1</code>, the second to <code>x2</code>, the residue is unimportant (matched by <code>_</code>).</p>\n\n<p>We also might write thus:</p>\n\n<pre><code>eBefore n [] = Nothing\neBefore n [_] = Nothing\neBefore n (x1:x2:xs)\n    | x2 == n   = Just x1\n    | otherwise = eBefore n (x2:xs)\n</code></pre>\n\n<p>However, this variant might be worse in terms of performance. <code>(x1:x2:xs)</code> is equivalent to <code>(x1:(x2:xs))</code>, and we see that <code>(x2:xs)</code> repeated again as an argument to recursive call. But the compiler may fail to recognize the identity of the two expressions and create a new node. That's a waste. By using the <code>@</code>-notation in the former variant, we give that <code>(x2:_)</code> from the pattern a name, <code>xs</code>, and pass it to the recursive call as a ready whole.</p>\n\n<p>The difficult moment here is what we should return in case <code>n</code> is equal to the head of the list, e. g. <code>eBefore 3 [3,4,5,6,3]</code>. The definition above will skip the first occurrence of 3 and return 6.</p>\n"}], "owner": {"reputation": 112, "user_id": 5281186, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b0e455c66ee5ba3919b3d86fc21261c?s=128&d=identicon&r=PG&f=1", "display_name": "Th3Dark0", "link": "https://stackoverflow.com/users/5281186/th3dark0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 1, "accepted_answer_id": 38810546, "answer_count": 1, "score": 0, "last_activity_date": 1470556367, "creation_date": 1470537702, "last_edit_date": 1470555359, "question_id": 38810398, "link": "https://stackoverflow.com/questions/38810398/return-the-element-just-before-the-occurrence-of-another-element-in-haskell", "title": "Return the element just before the occurrence of another element in haskell", "body": "<p>I want to write a code in Haskell, to return an element just before the occurrence of another element in a list. For ex:</p>\n\n<p>eBefore 3 [1,2,3,4,5] should return 2</p>\n\n<p>I am quiet new to haskell. The code that i've written up till now is :</p>\n\n<pre><code>eBefore :: Eq a =&gt; a -&gt; [a] -&gt; Maybe a\neBefore n [] = Nothing\neBefore n (x:xs) = if x == n then Just x else eBefore n xs\n</code></pre>\n\n<p>I would be highly obliged if some one could help me understand the approach or help me out with the problem. Thank you!</p>\n"}, {"tags": ["csv", "haskell", "libraries", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470531467, "post_id": 38809383, "comment_id": 64988106, "body": "This means your package db is broken in one way or another - if you can&#39;t figure out how, you can still nuke the package db and try from the beginning."}, {"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470582935, "post_id": 38809383, "comment_id": 64998344, "body": "@user2407038 Do you mean that I should remove cabal and try again, or remove everything remotely related to Haskell and start anew? o_O"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470593816, "post_id": 38809383, "comment_id": 65001240, "body": "Neither, just delete the <i>package database</i>. See <a href=\"http://stackoverflow.com/questions/12048352/my-cabal-packages-are-fubar-how-can-i-purge-them-and-start-over\">here</a> for an explanation of how to do so."}, {"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470601052, "post_id": 38809383, "comment_id": 65003231, "body": "Oh, okay. Thanks. Actually I removed every trace of Haskell and reinstalled it. Worked :) Good thing I didn&#39;t have a huge setup"}], "answers": [{"comments": [{"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1470582881, "post_id": 38809446, "comment_id": 64998327, "body": "I ran that command and posted the output in my question-- I have only one parsec it seems. And as for the linked question, sorry, I can&#39;t figure out which part of it I can use to help me (I&#39;m still new to Haskell/Cabal)."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1470524090, "last_edit_date": 1495539859, "creation_date": 1470524090, "answer_id": 38809446, "question_id": 38809383, "link": "https://stackoverflow.com/questions/38809383/cabal-exitfailure-1/38809446#38809446", "title": "Cabal ExitFailure 1", "body": "<p>This SO thread might be relevant:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/26188796/requested-module-differs-from-name-found-in-the-interface-file\">&quot;requested module differs from name found in the interface file&quot;</a></p>\n\n<p>I would run <code>ghc-pkg list</code> and see if you have multiple installs of the parsec package.</p>\n"}], "owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 838, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470582795, "creation_date": 1470523311, "last_edit_date": 1470582795, "question_id": 38809383, "link": "https://stackoverflow.com/questions/38809383/cabal-exitfailure-1", "title": "Cabal ExitFailure 1", "body": "<p>I'm getting this error when trying to install <a href=\"https://hackage.haskell.org/package/csv\" rel=\"nofollow\">csv</a> using Cabal (OS X):</p>\n\n<pre><code>Resolving dependencies...\nConfiguring csv-0.1.2...\nBuilding csv-0.1.2...\nFailed to install csv-0.1.2\nBuild log ( /Users/roshnal/.cabal/logs/csv-0.1.2.log ):\nConfiguring csv-0.1.2...\nBuilding csv-0.1.2...\nPreprocessing library csv-0.1.2...\n[1 of 1] Compiling Text.CSV         ( Text/CSV.hs, dist/build/Text/CSV.o )\n\nText/CSV.hs:70:1:\n    Bad interface file: /Library/Haskell/ghc-7.10.2-x86_64/lib/parsec-3.1.9/Text/ParserCombinators/Parsec.hi\n        Something is amiss; requested module  parsec-3.1.9@parse_8fSmqig53hOL2SEu1k9Tv0:Text.ParserCombinators.Parsec differs from name found in the interface file AwpZ7A1As1bGsDMsWSTZ1J:Text.ParserCombinators.Parsec\ncabal: Error: some packages failed to install:\ncsv-0.1.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I tried updating Cabal, <code>ghc-pkg recache</code>, and as another answer on SO suggested, setting <code>library-profiling</code> to <code>False</code> (in <code>~/.cabal/config</code>). None of them are working.</p>\n\n<p>Any idea what I can do to install this package? Earlier I have installed other packages using <code>cabal install</code> successfully.</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>As ErirR suggested in his answer, I ran <code>ghc-pkg list</code> and this is the output I got. I don't appear to be having multiple installs of <code>parsec</code>.</p>\n\n<pre><code>/Library/Frameworks/GHC.framework/Versions/7.10.2-x86_64/usr/lib/ghc-7.10.2/package.conf.d\nCabal-1.22.4.0\nGLURaw-1.5.0.1\nGLUT-2.7.0.1\nHTTP-4000.2.20\nHUnit-1.2.5.2\nObjectName-1.1.0.0\nOpenGL-2.12.0.1\nOpenGLRaw-2.5.1.0\nQuickCheck-2.8.1\nStateVar-1.1.0.0\narray-0.5.1.0\nasync-2.0.2\nattoparsec-0.13.0.1\nbase-4.8.1.0\nbin-package-db-0.0.0.0\nbinary-0.7.5.0\nbytestring-0.10.6.0\ncase-insensitive-1.2.0.4\ncgi-3001.2.2.2\ncontainers-0.5.6.2\ndeepseq-1.4.1.1\ndirectory-1.2.2.0\nexceptions-0.8.0.2\nfgl-5.5.2.1\nfilepath-1.4.0.0\nghc-7.10.2\nghc-prim-0.4.0.0\nhashable-1.2.3.3\nhaskeline-0.7.2.1\nhaskell-src-1.0.2.0\nhoopl-3.10.0.2\nhpc-0.6.0.2\nhscolour-1.23\nhtml-1.0.1.2\ninteger-gmp-1.0.0.0\nmtl-2.2.1\nmultipart-0.1.2\nnetwork-2.6.2.1\nnetwork-uri-2.6.0.3\nold-locale-1.0.0.7\nold-time-1.1.0.3\nparallel-3.2.0.6\nparsec-3.1.9  // &lt;-- Here's parsec\npretty-1.1.2.0\nprimitive-0.6\nprocess-1.2.3.0\nrandom-1.1\nregex-base-0.93.2\nregex-compat-0.95.1\nregex-posix-0.95.2\nrts-1.0\nscientific-0.3.3.8\nsplit-0.2.2\nstm-2.4.4\nsyb-0.5.1\ntemplate-haskell-2.10.0.0\nterminfo-0.4.0.1\ntext-1.2.1.3\ntf-random-0.5\ntime-1.5.0.1\ntransformers-0.4.2.0\ntransformers-compat-0.4.0.4\nunix-2.7.1.0\nunordered-containers-0.2.5.1\nvector-0.11.0.0\nxhtml-3000.2.1\nzlib-0.5.4.2\n</code></pre>\n"}, {"tags": ["haskell", "ghcjs-dom"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470543704, "post_id": 38808804, "comment_id": 64989644, "body": "I don&#39;t think you are approaching this the right way, but to get this to compile you&#39;d probably need <code>RankNTypes</code> and add <code>mapping :: [(GType, forall a. IO (a -&gt; String))]</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470579034, "post_id": 38808804, "comment_id": 64997105, "body": "@Alec any better way to approach it? If I switched based off node name, it would not be type safe."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470672903, "post_id": 38808804, "comment_id": 65033279, "body": "Rereading my comment, it should really have read <code>mapping :: [(GType, forall a . a -&gt; IO String))]</code>. But regarding your question, I&#39;m not sure what the best way would be... I guess you could make a typeclass <code>class Contents a where { getContents :: a -&gt; IO String }</code> then make instances like <code>instance Contents  HTMLSourceElement where { getContents = HTMLSourceElement.getSrc }</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470675436, "post_id": 38808804, "comment_id": 65034725, "body": "@Alec unfortunately an HTMLSourceElement my have the type HTMLElement. You cannot tell from the type what kind of element it is."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470676672, "post_id": 38808804, "comment_id": 65035366, "body": "I&#39;m starting to see why you were initially trying what you were... How do the types for that work out? I&#39;m not sure I understand how something can be <code>HTMLSourceElement</code> and <code>HTMLElement</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470677788, "post_id": 38808804, "comment_id": 65036011, "body": "@Alec You can use <code>toHTMLElement :: IsHTMLElement o =&gt; o -&gt; HTMLElement</code> to convert from <code>HTMLSourceElement</code> to <code>HTMLElement</code> and <code>castToHTMLSourceElement :: GObjectClass obj =&gt; obj -&gt; HTMLSourceElement</code> to unsafely convert <code>HTMLElement</code> to a <code>HTMLSourceElement</code>. You can check the type using <code>isA :: GObjectClass o =&gt; o -&gt; GType -&gt; Bool</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471187566, "post_id": 38808804, "comment_id": 65242042, "body": "@Alec if only there was a <code>castToX :: GObjectClass obj =&gt; obj -&gt; Maybe X</code>"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470964288, "post_id": 38840744, "comment_id": 65175032, "body": "Downvoter, would you care to justify the down vote? I&#39;d be interested in feedback..."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 0, "last_activity_date": 1470706649, "creation_date": 1470706649, "answer_id": 38840744, "question_id": 38808804, "link": "https://stackoverflow.com/questions/38808804/map-of-gtype-to-function-transforming-a-type-to-an-io-string/38840744#38840744", "title": "Map of GType to function transforming a type to an IO String", "body": "<p>I think the right way to approach the problem is to just make one <code>toString</code> function that does the branching based on the GType.</p>\n\n<pre><code>toString :: GObjectClass obj =&gt; obj -&gt; IO String\ntoString obj | obj `isA` gTypeHTMLSourceElement = getSrc . castToHTMLSourceElement\n             | obj `isA` gTypeHTMLObjectElement = getData . castToHTMLObjectElement\n             | obj `isA` gTypeHTMLTimeElement = getDateTime . castToHTMLTimeElement\n             | obj `isA` gTypeHTMLElement = getInnerText . castToHTMLElement\n             | ...\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 38840744, "answer_count": 1, "score": 3, "last_activity_date": 1470710379, "creation_date": 1470518312, "last_edit_date": 1470710379, "question_id": 38808804, "link": "https://stackoverflow.com/questions/38808804/map-of-gtype-to-function-transforming-a-type-to-an-io-string", "title": "Map of GType to function transforming a type to an IO String", "body": "<p>This map is between a GType and an function that transforms an instance of that GType to an IO String. I am making a function that takes an element and gets a string representation of that element.</p>\n\n<pre><code>mapping =\n    [ (Types.gTypeHTMLSourceElement, HTMLSourceElement.getSrc   )\n    , (Types.gTypeHTMLObjectElement, HTMLObjectElement.getData  )\n    , (Types.gTypeHTMLTimeElement  , HTMLTimeElement.getDateTime)\n    , (Types.gTypeHTMLElement      , HTMLElement.getInnerText   )\n    , ...\n    ]\n</code></pre>\n\n<p>Gives this error:</p>\n\n<pre><code>Couldn't match type \u2018HTMLObjectElement\u2019 with \u2018HTMLSourceElement\u2019\n</code></pre>\n\n<p>I am using ghcjs-dom. How can I get this code to compile without errors? Am I approaching the problem in the right way?</p>\n\n<p>If anyone can come up with answer better than Alec's answer I will accept their answer.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1470495578, "post_id": 38805482, "comment_id": 64979897, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html#v:catMaybes\" rel=\"nofollow noreferrer\"><code>catMaybes :: [Maybe a] -&gt; [a]</code></a> can help out here."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470501990, "post_id": 38805482, "comment_id": 64981500, "body": "The function <code>f = maybe [] (:[]) . getDbDate2</code> returns a singleton list of the time when there is one, and an empty list otherwise. <code>filterDbDate</code> is then simply <code>foldMap f</code>."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470496030, "post_id": 38805558, "comment_id": 64980008, "body": "That raises the question of whether there is an established way to generically derive functions like <code>pickUTCTme</code> for an arbitrary ADT. Perhaps something in the lens library?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1470499950, "post_id": 38805558, "comment_id": 64980967, "body": "You just need <code>makePrisms</code> and you get <code>_DbDate</code> ; then <code>(^? _DbDate) :: DatabaseItem -&gt; Maybe UTCTime</code> , <code>toListOf (traverse . _DbDate) :: [DataBaseItem] -&gt; [UTCTime]</code> and so on."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 2, "last_activity_date": 1470495551, "last_edit_date": 1470495551, "creation_date": 1470495164, "answer_id": 38805558, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell/38805558#38805558", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>List is a monad. So we can use the functions of the <code>Monad</code> type-class.</p>\n\n<pre><code>utcTimes :: [UTCTime]\nutcTimes =\n  theDatabase &gt;&gt;=\n  \\ item -&gt;\n    case item of\n      DbDate utcTime -&gt; [utcTime]\n      _ -&gt; []\n</code></pre>\n\n<p>The <code>(&gt;&gt;=)</code> function here is the key. It is essentially the same thing as \"flatMap\" in other languages, if that rings a bell.</p>\n\n<p>The following is the same as the above expressed in the Do-notation:</p>\n\n<pre><code>utcTimes :: [UTCTime]\nutcTimes =\n  do\n    item &lt;- theDatabase\n    case item of\n      DbDate utcTime -&gt; [utcTime]\n      _ -&gt; []\n</code></pre>\n\n<p>In fact, we can even generalize this to a function, which will work for any monad over <code>UTCTime</code> (well, <code>MonadPlus</code>, really):</p>\n\n<pre><code>pickUTCTime :: MonadPlus m =&gt; DatabaseItem -&gt; m UTCTime\npickUTCTime item =\n  case item of\n    DbDate utcTime -&gt; return utcTime\n    _ -&gt; mzero\n\nutcTimes :: [UTCTime]\nutcTimes =\n  theDatabase &gt;&gt;= pickUTCTime\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 1, "last_activity_date": 1470496159, "creation_date": 1470496159, "answer_id": 38805702, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell/38805702#38805702", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>A simple way to do it is as follows</p>\n\n<pre><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate db = filterDbDate' [] db\n  where filterDbDate' :: [UTCTime] -&gt; [DatabaseItem] -&gt; [UTCTime]\n        filterDbDate' rest ((DbDate utcTime):xs) = filterDbDate' (rest ++ [utcTime]) xs\n        filterDbDate' rest (_:xs) = filterDbDate' rest xs\n        filterDbDate' rest _      = rest\n</code></pre>\n\n<p>That is, you pass along another argument which contains the values you want to keep. If you look closely, you'll see that this is exactly what the type of <code>foldl</code> indicates too <code>foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b</code> (You can also do it with <code>foldr</code>, but I'll leave that to you), except it expects one element at a time. So let's rewrite <code>filterDbDate'</code> to do that too.</p>\n\n<pre><code>filterDbDate2 :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate2 db = foldl filterDbDate'' [] db\n   where filterDbDate'' :: [UTCTime] -&gt; DatabaseItem -&gt; [UTCTime]\n         filterDbDate'' rest (DbDate utcTime) = (rest ++ [utcTime])\n         filterDbDate'' rest _                = rest\n</code></pre>\n\n<p>This is not the most efficient function, but hopefully you'll see how to translate functions to using folds. Try it with <code>foldr</code>!</p>\n"}, {"comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1470500376, "post_id": 38805980, "comment_id": 64981075, "body": "What if <code>xs</code> also contains <code>DbString</code>s or <code>DbNumber</code>s?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 2, "creation_date": 1470503155, "post_id": 38805980, "comment_id": 64981791, "body": "@Code-Apprentice, this list comprehension will still work."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1470516281, "post_id": 38805980, "comment_id": 64985311, "body": "A list comprehension is just syntactic sugar for a monadic computation. When <code>DbDate x</code> matches, it returns <code>[x]</code>; otherwise, the <code>fail</code> function from the <code>Monad</code> class returns an empty list. The concatenation of each of the lists produces the final list, consisting only of <code>x</code>s from <code>DbDate</code> values."}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 8, "last_activity_date": 1470498159, "creation_date": 1470498159, "answer_id": 38805980, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell/38805980#38805980", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>A simple list comprehension will do</p>\n\n<pre><code>filterDbDate xs = [ x | DbDate x &lt;- xs ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 1, "creation_date": 1470509480, "post_id": 38807172, "comment_id": 64983607, "body": "I selected this as &#39;the&#39; answer because of pedagogical reasons. I also liked the answer by @Phyx because it is very close to what the book explained so far (also forcing to focus on types). Nikita-Volkov also gave an answer that I more or less understand but I still haven&#39;t come to the Monad chapter in the book (and have no idea what MonadPlus is). The list comprehension answer by Franky is also great, reads just like Python ;) (but again, does not serve very well of my understanding of folding)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1470529044, "last_edit_date": 1470529044, "creation_date": 1470505961, "answer_id": 38807172, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell/38807172#38807172", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>There are several other answers here covering good suggestions about <em>other</em> ways to think about the problem: using <code>catMaybes</code> to munge the data a second time after picking out <code>Maybe UTCTime</code>s; using list comprehensions and the handy syntax they have for filtering out non-matching patterns; using the monadic structure of lists to include or skip results; and writing a bespoke recursive function. In this answer, I will address your direct question, showing how to use the program structure you already have without completely rethinking your approach to list manipulations -- calling <code>foldr</code> with a helper function that does everything you need in one go.</p>\n\n<p>First of all, I observe that all your existing attempts send <code>foldr</code> a function which unconditionally calls <code>(:)</code>:</p>\n\n<pre><code>foldr ((:) . getDbDate1) [] (filter isDbDate database)\nfoldr ((:) . getDbDate2) [] database\n</code></pre>\n\n<p>The thing about this pattern is that this means the list you get out of the <code>foldr</code> will have the same length as the function you pass in -- since every <code>(:)</code> in the input list gets turned into a <code>(:)</code> in the output list. In your first solution, you handled this by removing some entries you didn't care about from the input list; in your second solution, you handled this by having extra uninteresting elements in your output list.</p>\n\n<p>A third solution is to look at the list element before deciding whether to call <code>(:)</code> or not. Here is how one might do that:</p>\n\n<pre><code>conditionalCons :: DatabaseItem -&gt; [UTCTime] -&gt; [UTCTime]\nconditionalCons (DbDate t) ts = t:ts\nconditionalCons _          ts =   ts\n</code></pre>\n\n<p>Note in particular that in the second clause, we do not call <code>(:)</code> -- this filters out the non-matching elements of the list. We also have no concern about missing patterns. Now we can write</p>\n\n<pre><code>filterDbDate3 :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate3 = foldr conditionalCons []\n</code></pre>\n\n<p>Testing it in ghci:</p>\n\n<pre><code>&gt; filterDbDate3 theDatabase\n[1911-05-01 09:28:43 UTC,1921-05-01 09:28:43 UTC]\n</code></pre>\n\n<p>Perfect!</p>\n"}, {"comments": [{"owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 0, "creation_date": 1470594627, "post_id": 38812086, "comment_id": 65001483, "body": "Another excellent and enlightening answer! (Though, right now, I have no idea about NoImplicitPrelude, ClassPrelude, etc. mentioned in the final paragraph. Food for thought. A lot of thought! :)"}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "reply_to_user": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 1, "creation_date": 1470614418, "post_id": 38812086, "comment_id": 65006068, "body": "@EmreSevin&#231; The default prelude must make some compromises. The ClassyPrelude is one of several alternative ones that tries to choose a different set of compromises for different use cases. You can always do without it (eg <i>cons</i> originally comes from Data.Sequences), and it&#39;s not the best choice for libraries or teaching but it can be convenient for larger, self-contained applications. The main reason I chose it here is that its authors have thought long and hard about which libraries are used most often in practice, so I can rely on them giving me a useful <i>cons</i>."}], "tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 4, "last_activity_date": 1470556285, "creation_date": 1470556285, "answer_id": 38812086, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell/38812086#38812086", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>There are some good answers but I would like to add another approach how you can find solutions to such tasks.</p>\n\n<p>First, <strong>write the simplest possible solution</strong>, i.e. a solution with direct recursion.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate ((DbDate time):items) = time:(filterDbDate items)\nfilterDbDate ( _           :items) =       filterDbDate items\n</code></pre>\n\n<p>This helps understand the structures involved and allows you to familiarize yourself with the actual steps needed. It's not the most performant version, but it's easy to write and it's often enough for the task at hand.</p>\n\n<p>The next step would be to <strong>make the code more performant with tail recursion</strong>. It's a simple, almost mechanical transformation.</p>\n\n<ol>\n<li><p>Determine the accumulator type. This is often also the return type; in this case, a list. That gives you the new first lines</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate = go []\n  where ...\n</code></pre></li>\n<li><p>Now take the original function and turn it into the internal <code>go</code> function by replacing every recursive call with the accumulator and then putting the result into a recursive call to <code>go</code>.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>    go acc ((DbDate time):items) = go (time:acc) items\n    go acc ( _           :items) = go       acc  items\n</code></pre></li>\n<li><p>Add handling of the end case. Beware that the order of operations will be reversed.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>    go acc  []                   = reverse acc\n</code></pre></li>\n<li><p>Move the handling of the end case into the original call. This is not necessary if you want to stop here, but it helps on the way to a fold.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>filterDbDate = reverse . go []\n  where \n    go acc  [] = acc\n    ...\n</code></pre></li>\n</ol>\n\n<p>Now to <strong>turn that into a fold</strong>. The accumulator is the same the fold will be using and the transformation, again, is almost mechanical.</p>\n\n<ol>\n<li><p>Replace the call to <code>go</code> with a call to a fold.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate = reverse . foldl f []\n</code></pre></li>\n<li><p>Turn <code>go</code> into <code>f</code> by removing the list-part of the pattern matches, the end case, and the recursive calls.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>  where f acc (DbDate time) = time:acc\n        f acc  _            =      acc\n</code></pre></li>\n<li><p>Ponder if it would be better to reverse the direction of recursion.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate = foldr f []\n  where f (DbDate time) = (time:)\n        f _             = id\n</code></pre></li>\n</ol>\n\n<p>Now for final cleanup, <strong>extra brownie points</strong> and to enrage Haskell teachers make it as generic as you can without breaking stuff.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE NoImplicitPrelude, GADTs #-}\nimport ClassyPrelude\n\nfilterDbDate :: ( MonoFoldable items, Element items ~ DatabaseItem\n                , Monoid times, SemiSequence times, Element times ~ UTCTime)\n             =&gt; items -&gt; times\nfilterDbDate = foldr f mempty\n   where f (DbDate time) = cons time\n         f _             = id\n</code></pre>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 0, "accepted_answer_id": 38807172, "answer_count": 5, "score": 8, "last_activity_date": 1470556285, "creation_date": 1470494645, "question_id": 38805482, "link": "https://stackoverflow.com/questions/38805482/how-to-get-only-a-particular-type-of-elements-from-a-list-in-haskell", "title": "How to get only a particular type of elements from a list in Haskell?", "body": "<p>I'm studying <a href=\"http://haskellbook.com/\">Haskell Book</a>, and in Chapter 10 (Folding Lists), I'm trying to solve an exercise regarding getting only one particular type of element from a list that includes different types of elements.</p>\n\n<p>The authors give the following code:</p>\n\n<pre><code>import Data.Time\n\ndata DatabaseItem = DbString String\n                  | DbNumber Integer\n                  | DbDate   UTCTime\n                  deriving (Eq, Ord, Show)\n\ntheDatabase :: [DatabaseItem]\ntheDatabase = [ DbDate (UTCTime\n                        (fromGregorian 1911 5 1)\n                        (secondsToDiffTime 34123))\n              , DbNumber 9001\n              , DbString \"Hello, world!\"\n              , DbDate (UTCTime\n                        (fromGregorian 1921 5 1)\n                        (secondsToDiffTime 34123))\n              ]\n</code></pre>\n\n<p>and the first question is:</p>\n\n<blockquote>\n  <p>Write a function that filters for DbDate values and returns a list of\n  the UTCTime values inside them.</p>\n</blockquote>\n\n<pre><code>filterDbDate :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate = undefined\n</code></pre>\n\n<p>Since the chapter is all about folding lists, I assume it can be done using, for example, <code>foldr</code>.</p>\n\n<p>My initial attempt has been to first write some helper functions and use them in a <code>foldr</code>, such as:</p>\n\n<pre><code>getDbDate1 :: DatabaseItem -&gt; UTCTime\ngetDbDate1 (DbDate utcTime) = utcTime\n\nisDbDate :: DatabaseItem -&gt; Bool\nisDbDate (DbDate _) = True\nisDbDate _ = False\n\nfilterDbDate1 :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate1 database = foldr ((:) . getDbDate1) [] (filter isDbDate database)\n</code></pre>\n\n<p>This seems to do the job, because:</p>\n\n<pre><code>\u03bb&gt; filterDbDate1 theDatabase\n[1911-05-01 09:28:43 UTC,1921-05-01 09:28:43 UTC]\n</code></pre>\n\n<p>But I'm not comfortable with this solution, because first of all, it gives the following warning:</p>\n\n<pre><code>/Users/emre/code/haskell/chapter10_folding_lists/database.hs:36:1: Warning: \u2026\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018getDbDate1\u2019:\n        Patterns not matched:\n            DbString _\n            DbNumber _\n</code></pre>\n\n<p>And I'm using two helper functions, one to help with filtering out the values that are not DbDate, another to get at the <code>UTCTime</code> component.</p>\n\n<p>So, to get rid of non-exhaustive pattern matching warning and use a single helper function, I've decided to write it like:</p>\n\n<pre><code>getDbDate2 :: DatabaseItem -&gt; Maybe UTCTime\ngetDbDate2 (DbDate utcTime) = Just utcTime\ngetDbDate2 _ = Nothing\n\nfilterDbDate2 :: [DatabaseItem] -&gt; [UTCTime]\nfilterDbDate2 database = foldr ((:) . getDbDate2) [] database\n</code></pre>\n\n<p>But, of course, the above does not compile, because it does not type check, because, for example:</p>\n\n<pre><code>\u03bb&gt; foldr ((:) . getDbDate2) [] theDatabase\n[Just 1911-05-01 09:28:43 UTC,Nothing,Nothing,Just 1921-05-01 09:28:43 UTC]\n</code></pre>\n\n<p>In other words, it can return a list of <code>Just UTCTime</code> values, together with <code>Nothing</code> values, and not only a list of <code>UTCTime</code> values.</p>\n\n<p>So my question is: how can I write a (helper?) function that, in one go (so that I don't have to use the <code>filter</code>), checks if its value is <code>DbNumber</code>, and if so returns the <code>UTCTime</code> component? (And if not... it also has to return something (e.g. <code>Nothing</code>?), and this is where I'm having trouble, that is using <code>Maybe UTCTime</code>, and then getting <code>Just UTCTime</code> values, etc.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "edited": false, "score": 0, "creation_date": 1470480425, "post_id": 38803389, "comment_id": 64975697, "body": "please write a better, more precise title."}], "answers": [{"comments": [{"owner": {"reputation": 11333, "user_id": 819742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39e2199f9782b9b9abab588071c20e68?s=128&d=identicon&r=PG", "display_name": "randominstanceOfLivingThing", "link": "https://stackoverflow.com/users/819742/randominstanceoflivingthing"}, "edited": false, "score": 0, "creation_date": 1470481218, "post_id": 38803469, "comment_id": 64975898, "body": "Thanks, that answers it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1470480924, "creation_date": 1470480924, "answer_id": 38803469, "question_id": 38803389, "link": "https://stackoverflow.com/questions/38803389/different-behavior-when-invoking-function-in-ghci-with-variable-vs-literal-numbe/38803469#38803469", "title": "Different behavior when invoking function in ghci with variable vs literal number", "body": "<p><code>abs -10</code> actually means <code>abs - 10</code>, the subtraction of <code>abs</code> and <code>10</code>. </p>\n\n<p>You want <code>abs (-10)</code>.</p>\n"}], "owner": {"reputation": 11333, "user_id": 819742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39e2199f9782b9b9abab588071c20e68?s=128&d=identicon&r=PG", "display_name": "randominstanceOfLivingThing", "link": "https://stackoverflow.com/users/819742/randominstanceoflivingthing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 38803469, "answer_count": 1, "score": 0, "last_activity_date": 1470480924, "creation_date": 1470480263, "last_edit_date": 1470480624, "question_id": 38803389, "link": "https://stackoverflow.com/questions/38803389/different-behavior-when-invoking-function-in-ghci-with-variable-vs-literal-numbe", "title": "Different behavior when invoking function in ghci with variable vs literal number", "body": "<p>I defined a simple function to find the absolute value of a number:</p>\n\n<pre><code>let abs n | n &gt;= 0 = n | otherwise = -n \n</code></pre>\n\n<p>Calling the function with a variable</p>\n\n<pre><code>Prelude&gt; let x = -10\nPrelude| \nPrelude&gt; abs x\n10\n</code></pre>\n\n<p>Calling the function with a value</p>\n\n<pre><code>Prelude&gt; abs -10\n&lt;interactive&gt;:65:1:\n  Non type-variable argument in the constraint: Num (a -&gt; a)\n  (Use FlexibleContexts to permit this)\n  When checking that \u2018it\u2019 has the inferred type\n    it :: forall a. (Num a, Num (a -&gt; a), Ord a) =&gt; a -&gt; a\n</code></pre>\n\n<p>I don't understand the failure of the second invocation. I am using GHCi, version 7.10.2.</p>\n"}, {"tags": ["haskell", "atom-editor"], "answers": [{"tags": [], "owner": {"reputation": 10249, "user_id": 1329116, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e58c33b56b00d4148810d427a04e21e0?s=128&d=identicon&r=PG", "display_name": "idleberg", "link": "https://stackoverflow.com/users/1329116/idleberg"}, "is_accepted": true, "score": 1, "last_activity_date": 1471718001, "last_edit_date": 1471718001, "creation_date": 1470520564, "answer_id": 38809062, "question_id": 38803166, "link": "https://stackoverflow.com/questions/38803166/how-to-launch-atom-installed-package-haskell-repl-and-cabal/38809062#38809062", "title": "How to launch atom installed package - haskell repl and cabal", "body": "<p>The Haskell REPL package does not provide a graphical interface for the commands it provides. However, you can call them from the <a href=\"http://flight-manual.atom.io/getting-started/sections/atom-basics/#command-palette\" rel=\"nofollow\">Command Palette</a>, one of the central interfaces of editors such as Atom or Sublime Text.</p>\n\n<p>Launch the command palette using the default shortcut (<kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> on OS X, <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> elsewhere) or from the menu (<em>Packages > Command Palette > Toggle</em>) and type any of the commands mentioned in the package's <code>README.md</code>. The command palette will also reveal the default <a href=\"https://github.com/atom-haskell/ide-haskell-repl/blob/master/keymaps/ide-haskell-repl.cson\" rel=\"nofollow\">keyboard shortcuts</a> for each command.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 38809062, "answer_count": 1, "score": 1, "last_activity_date": 1471718001, "creation_date": 1470478846, "last_edit_date": 1470479690, "question_id": 38803166, "link": "https://stackoverflow.com/questions/38803166/how-to-launch-atom-installed-package-haskell-repl-and-cabal", "title": "How to launch atom installed package - haskell repl and cabal", "body": "<p>Have installed Haskell atom repl from <a href=\"https://atom.io/packages/ide-haskell-repl\" rel=\"nofollow noreferrer\">https://atom.io/packages/ide-haskell-repl</a> and also installed cabal package.</p>\n\n<p>How to launch the repl and cabal ? </p>\n\n<p>There does not appear to be an option to open from menu, in same way SublimeText exposes installed packages. Atom probably exposes this functionality differently ?</p>\n\n<p>Here my installed Haskell packages : </p>\n\n<p><a href=\"https://i.stack.imgur.com/PrGkZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PrGkZ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1470473141, "post_id": 38801907, "comment_id": 64973827, "body": "Lol I&#39;m just going to be a jerk for a second and say don&#39;t capitalize HASKELL like that. It&#39;s just Haskell. :-)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470487741, "post_id": 38801907, "comment_id": 64977744, "body": "<code>daux</code> looks more complicated than it needs to be. The third argument is always the same as the first, and is never actually used."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1470470654, "creation_date": 1470470654, "answer_id": 38801980, "question_id": 38801907, "link": "https://stackoverflow.com/questions/38801907/passing-a-list-as-parameter/38801980#38801980", "title": "Passing a list as parameter", "body": "<p>Because of the outer parentheses, this line:</p>\n\n<pre><code>where daux ((x:xs) mh y:ys strdib)  \n</code></pre>\n\n<p>says that daux takes one parameter. Perhaps you meant:</p>\n\n<pre><code>where daux (x:xs) mh (y:ys) strdib\n</code></pre>\n\n<p>which says that it takes four parameters. Note the parens added around <code>y:ys</code>.</p>\n\n<p>You'll also have to fix where you call <code>daux</code> in your main function, e.g.:</p>\n\n<pre><code>generateSTR (x) = daux (x (maximum x) x \"\") \n                       ^                  ^ - remove these\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1470472025, "last_edit_date": 1470472025, "creation_date": 1470471546, "answer_id": 38802120, "question_id": 38801907, "link": "https://stackoverflow.com/questions/38801907/passing-a-list-as-parameter/38802120#38802120", "title": "Passing a list as parameter", "body": "<p>This Haskell syntax <code>f x y z</code> is <em>not</em> just a different syntax for what other languages write as <code>f(x,y,z)</code>. It is equivalent to that, yes, but only in the sense it is also equivalent to <code>f(z,y,x)</code>: you still need to make a distinction.</p>\n\n<p>Haskell functions are usually written <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow\">curried</a>. That means, if <code>f</code> \u201caccepts three parameters\u201d, what it actually does is accept <em>one</em> parameter, then another, then another:</p>\n\n<pre><code>f x y z \u2261 ((f x) y) z\n</code></pre>\n\n<p>In other words, <code>f</code> is a function whose result is a function, whose result is a function. Only the result of that third function is \u201cthe final result\u201d. Hence, you obviously can't write it <code>f (x y z)</code> \u2013 that would be something completely different, namely <code>f</code> applied to the result of applying <em>the function <code>x</code></em> to <code>y</code> and <code>z</code>.</p>\n\n<p>Perhaps all of this sounds complicated, but you will find many situation where currying allows you to write extremely concise and powerful code, and otherwise you just don't need to worry about it... simply write no parentheses that don't actually group independent subexpressions!</p>\n\n<p>Applied to your example \u2013 this is the correct  way to write it:</p>\n\n<pre><code>generateSTR :: [Int] -&gt; String\ngenerateSTR [] = \"\"  \ngenerateSTR x = daux x (maximum x) x \"\"\n  where daux (x:xs) mh y:ys strdib\n           | mh == 0 = daux xs mh ys $ strdib ++ \"-\"\n           | mh &lt;= h = daux xs mh ys $ strdib ++ \"*\"\n           | mh &gt; h  = daux xs mh ys $ strdib ++ \" \"\n           | mh == 0 &amp;&amp; length lh == 0  -- note: this actually doesn't work, `lh` is not in scope here.\n                     = daux xs (mh-1) ys $ strdib ++ \"\\n\"\n        daux [] mh lh strdib   = strdib\n</code></pre>\n\n<p>If you've not come across the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Function.html#v:-36-\" rel=\"nofollow\"><code>$</code></a> operator yet: it has the same effect as putting both sides of it in parentheses, i.e.</p>\n\n<pre><code>      daux xs mh ys $ strdib ++ \"-\"\n   \u2261 (daux xs mh ys) (strdib ++ \"-\")\n</code></pre>\n\n<p>...and as I said, <code>(f x y z) w</code> is actually the same as <code>f x y z w</code>, so in this case it's the same as <code>daux xs mh ys (strdib ++ \"-\")</code>. But not the same as <code>daux (xs mh ys (strdib ++ \"-\"))</code>, which would instead mean you apply the function <code>xs</code> to <code>mh</code>, then <code>ys</code> etc., which of course doesn't work because <code>xs</code> is a list!</p>\n"}], "owner": {"reputation": 21, "user_id": 6659649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c17df95770096cf81fd449d1e54ef9d?s=128&d=identicon&r=PG&f=1", "display_name": "JPrado", "link": "https://stackoverflow.com/users/6659649/jprado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5776, "favorite_count": 0, "accepted_answer_id": 38802120, "answer_count": 2, "score": 0, "last_activity_date": 1470484009, "creation_date": 1470470071, "last_edit_date": 1470484009, "question_id": 38801907, "link": "https://stackoverflow.com/questions/38801907/passing-a-list-as-parameter", "title": "Passing a list as parameter", "body": "<p>I have this function that receives a list of integers and should return a String</p>\n\n<pre><code>generateSTR :: [Int] -&gt; String\ngenerateSTR ([]) = \"\"  \ngenerateSTR (x) = daux (x (maximum x) x \"\") \n  where daux ((x:xs) mh y:ys strdib)  \n           | mh == 0 = daux xs mh ys (strdib ++ \"-\")\n           | mh &lt;= h = daux (xs mh ys (strdib ++ \"*\"))\n           | mh &gt; h  = daux (xs mh ys (strdib ++ \" \"))\n           | mh == 0 &amp;&amp; length(lh) == 0 = daux xs (mh-1) ys (strdib ++ \"\\n\")\n        daux ([] mh lh strdib)   = strdib\n</code></pre>\n\n<p>The problem is that I'm getting an error:</p>\n\n<pre><code>\"Parse error in pattern: (x : xs)\"\n</code></pre>\n\n<p>But I can't see what I'm doing wrong.</p>\n\n<p>For sure It's a silly error, but I'm newbie in HASKELL and I think I'm going crazy!.</p>\n"}, {"tags": ["haskell", "docker", "yesod", "haskell-stack", "keter"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1470446850, "creation_date": 1470446850, "answer_id": 38799732, "question_id": 38799405, "link": "https://stackoverflow.com/questions/38799405/haskell-yesod-stack-build-runnable-file/38799732#38799732", "title": "Haskell Yesod stack build runnable file", "body": "<p>It should work (assuming architectures are the same.)</p>\n\n<p>Things to check:</p>\n\n<ol>\n<li>Run <code>ldd</code> (<code>otool -L</code> on OS X) on the binary to see what shared libraries it references.</li>\n<li>Make sure you've copied over any templates and data files.</li>\n<li>Have a look at the section on <strong>keter</strong> in the Yesod book: <a href=\"http://www.yesodweb.com/book/deploying-your-webapp\" rel=\"nofollow\">http://www.yesodweb.com/book/deploying-your-webapp</a></li>\n</ol>\n\n<p>The section on keter is valuable not only for info\non keter but also because it talks about the files you need to deploy\nfor a Yesod app.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 38799732, "answer_count": 1, "score": 0, "last_activity_date": 1470446850, "creation_date": 1470443275, "question_id": 38799405, "link": "https://stackoverflow.com/questions/38799405/haskell-yesod-stack-build-runnable-file", "title": "Haskell Yesod stack build runnable file", "body": "<p>I was looking for ways to deploy my <strong>Yesod</strong> project, and while reading some tutorials (Keter and Docker way), I realised that, <code>stack build</code> generates a runnable file which can be executed directly and listen for requests, is there any reason I should not use it in production in the beginning? I think it would be great if it was that simple... I would run it in a Debian server hosted on Google Cloud.</p>\n"}, {"tags": ["haskell", "typeclass", "free-monad", "overlapping-instances"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1470437437, "post_id": 38798660, "comment_id": 64967749, "body": "You can wrap it in a <code>newtype</code> and control the instances yourself. I don&#39;t think there&#39;s a cleaner way to do it. The instances for <code>FreeT</code> assume you won&#39;t be providing any of the mtl classes provided by other transformers."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1470437813, "post_id": 38798660, "comment_id": 64967814, "body": "How is this different from the last line of the first code block?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1470437977, "post_id": 38798660, "comment_id": 64967848, "body": "@JohnF.Miller In your example, <code>DataStore</code> is just a type alias, not a <code>newtype</code>, which gives you all of <code>Free</code>\u2019s instances automatically. However, if you make it a <code>newtype</code> instead, you can use <code>GeneralizedNewtypeDeriving</code> to pick and choose which instances you want to inherit, and you can define your own <code>MonadError</code> instance."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470441178, "post_id": 38798660, "comment_id": 64968520, "body": "You could just enable overlapping instances (or add the <code>{-# OVERLAPS #-}</code> pragma to your instance, if you have a sufficiently recent GHC version). With this, e.g. <code>throwError undefined :: DataStore ()</code> would use your instance. Unless you are for some reason unwilling to use this feature, this is certainly the simplest solution (the addition of a single line fixes your problem)."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470442584, "post_id": 38798660, "comment_id": 64968770, "body": "@user2407038 that solved my problem without any large rewrite! (We&#39;ll see if the enchanted brooms flood my basement later) If you put write this as an answer, I will accept it."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1470460921, "post_id": 38798660, "comment_id": 64971415, "body": "By the way, your definition of <code>catchError</code> seems dubious to me; I&#39;d expect that <code>catchError</code> would also catch errors that aren&#39;t the first step taken by the action."}], "answers": [{"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470438764, "post_id": 38798883, "comment_id": 64967990, "body": "What does the builtin instance do?  I looked at it, but I cannot fulfill the requirement that <code>DataStoreF</code> be an <code>MonadError</code> because it is in fact not a monad."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470438865, "post_id": 38798883, "comment_id": 64968006, "body": "@JohnF.Miller The default instance just says that <code>Free</code> is a <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html\" rel=\"nofollow noreferrer\">monad transformer</a> that happens to preserve <code>MonadError</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 1, "creation_date": 1470438931, "post_id": 38798883, "comment_id": 64968027, "body": "@JohnF.Miller Right, it only works if <code>DataStoreF</code> is already a monad, which sort of defeats the whole purpose of the common use-case for using <code>Free</code>. It\u2019s not much of an issue, though, given that a <code>newtype</code> works just as well."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470439370, "post_id": 38798883, "comment_id": 64968125, "body": "@AlexisKing, ok, I&#39;m just not looking forward to adding the <code>newtype</code> annotation to three different interpreters + helper functions *  16 instructions each."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470439520, "post_id": 38798883, "comment_id": 64968170, "body": "@JohnF.Miller Yeah, it\u2019s a little syntactically inconvenient. In general, I would avoid type aliases in Haskell\u2014they tend to cause more problems than they solve, and they don\u2019t really add any safety. Almost always prefer <code>newtype</code>s."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470441054, "post_id": 38798883, "comment_id": 64968489, "body": "@JohnF.Miller You shouldn&#39;t have to unpack the <code>newtype</code> for every case of your base functor! If your interpreters work <a href=\"https://en.wikipedia.org/wiki/Principle_of_compositionality\" rel=\"nofollow noreferrer\">compositionally</a> you should be able to use <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/Control-Monad-Free.html#v:iterM\" rel=\"nofollow noreferrer\"><code>iterM</code></a> to tear down your free monad (a bit like <a href=\"http://stackoverflow.com/documentation/haskell/2984/recursion-schemes/10137/folding-up-a-structure-one-layer-at-a-time\"><code>cata</code></a>) and write an algebra that doesn&#39;t worry about the free monad."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1470442709, "post_id": 38798883, "comment_id": 64968799, "body": "Actually the requirement is that the base monad (here <code>Identity</code>) needs to be an instance of <code>MonadError</code>. OP might be able to use a free monad transformer on an error monad rather than defining the <code>Error</code> action as part of <code>DataStoreF</code>."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 5, "last_activity_date": 1470438445, "creation_date": 1470438445, "answer_id": 38798883, "question_id": 38798660, "link": "https://stackoverflow.com/questions/38798660/monaderror-instance-for-a-free-monad/38798883#38798883", "title": "MonadError instance for a Free Monad", "body": "<p>The <code>Free</code> type already provides a <code>MonadError</code> instance for <em>all</em> free monads:</p>\n\n<pre><code>instance (Functor m, MonadError e m) =&gt; MonadError e (Free m) where { ... }\n</code></pre>\n\n<p>When you write <code>type DataStore = ...</code>, you are simply defining a <em>type alias</em>, which is basically a type-level macro. All uses of the <code>DataStore</code> type are replaced with its definition. This means that using <code>DataStore</code> is indistinguishable from using <code>Free DataStoreF</code> directly, so when you do this:</p>\n\n<pre><code>instance MonadError String DataStore where { ... }\n</code></pre>\n\n<p>\u2026you are actually doing this:</p>\n\n<pre><code>instance MonadError String (Free DataStoreF) where { ... }\n</code></pre>\n\n<p>\u2026and that conflicts with the instance defined above.</p>\n\n<p>To circumvent that, you should define a <code>newtype</code> to produce an entirely fresh type that can have its own instances on it, unrelated to the ones defined on <code>Free</code>. If you use the <code>GeneralizedNewtypeDeriving</code> extension, you can avoid a lot of the boilerplate that would otherwise be required by a separate <code>newtype</code>:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving -}\n\ndata DataStoreF next = ...\n\nnewtype DataStore a = DataStore (Free DataStoreF a)\n  deriving (Functor, Applicative, Monad)\n\ninstance MonadError String DataStore where { ... }\n</code></pre>\n\n<p>This should avoid the overlapping instance problem without the need to write out all the <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances manually.</p>\n"}, {"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1470511712, "post_id": 38800148, "comment_id": 64984219, "body": "To future readers: Alexis King&#39;s answer is probably the more appropriate choice in an ideal world, and should be strongly considered before using a somewhat suspect language extension like <code>{-# OVERLAPS #-}</code>, but this so elegantly and quickly addressed my issue in an already extensive code base that I have chosen it as my accepted answer. Thank you to both (as of 2016-08-06) of you who responded."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1470452645, "creation_date": 1470452645, "answer_id": 38800148, "question_id": 38798660, "link": "https://stackoverflow.com/questions/38798660/monaderror-instance-for-a-free-monad/38800148#38800148", "title": "MonadError instance for a Free Monad", "body": "<p>Your instance and the instance given by the library:</p>\n\n<pre><code>instance (Functor m, MonadError e m) =&gt; MonadError e (Free m)\n</code></pre>\n\n<p>are indeed overlapping, but this does not mean that they are incompatible. Note that the above instance is 'more general' in a sense than yours - any type which would match your instance would match this one. When one uses the <code>OverlappingInstances</code> extension (or with modern GHC, an <code>{-# OVERLAP{S/PING/PABLE} #-}</code> pragma), instances may overlap, and the most specific (<em>least</em> general) instance will be used. </p>\n\n<p>Without the extension, e.g. <code>throwError \"x\" :: DataStore ()</code> gives the type error:</p>\n\n<pre><code>* Overlapping instances for MonadError [Char] (Free DataStoreF)\n    arising from a use of `throwError'\n  Matching instances:\n    instance [safe] (Functor m, MonadError e m) =&gt;\n                    MonadError e (Free m)\n      -- Defined in `Control.Monad.Free'\n    instance [safe] MonadError String DataStore\n</code></pre>\n\n<p>but with the addition of a pragma</p>\n\n<pre><code>instance {-# OVERLAPS #-} \n  MonadError String DataStore where\n</code></pre>\n\n<p>the expression <code>throwError \"x\" :: DataStore ()</code> <em>still</em> matches both instances, but since one is more specific than the other (the one you wrote) it is selected:</p>\n\n<pre><code>&gt;throwError \"x\" :: DataStore ()\nFree (Error \"x\")\n</code></pre>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 2, "accepted_answer_id": 38800148, "answer_count": 2, "score": 3, "last_activity_date": 1470452645, "creation_date": 1470436801, "question_id": 38798660, "link": "https://stackoverflow.com/questions/38798660/monaderror-instance-for-a-free-monad", "title": "MonadError instance for a Free Monad", "body": "<p>I have created a very useful Free Monad out of a sum data type. That abstracts access to a persistent data store:</p>\n\n<pre><code>data DataStoreF next = \n     Create    Asset                           ( String -&gt; next)\n  |  Read      String                          ( Asset  -&gt; next)\n  |  Update    Asset                           ( Bool   -&gt; next)\n  |  UpdateAll [Asset]                         ( Bool   -&gt; next)\n  |  Delete    Asset                           ( Bool   -&gt; next)\n  |  [...] -- etc. etc.\n  |  Error     String\n\ntype DataStore = Free DataStoreF\n</code></pre>\n\n<p>I would like to make <code>DataStore</code> an instance of <code>MonadError</code> with the error message handled as <code>(Free (Error str))</code>:</p>\n\n<pre><code>instance MonadError String DataStore where\n  throwError str = errorDS str\n  catchError (Free (ErrorDS str)) f = f str\n  catchError x _ = x\n</code></pre>\n\n<p>But I am running into Overlapping Instances errors.</p>\n\n<p>What is the proper way to make the <code>DataStore</code> monad and instance of <code>MonadError</code>?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1470430849, "post_id": 38797613, "comment_id": 64965722, "body": "It\u2019s a little bit unclear to me what exactly you want, but it looks like maybe you need to shuffle the type variables from <code>DerivedColumn</code> to have the container type, <code>a</code>, last? So the definition should be <code>data DerivedColumn c b a = ...</code>? The <code>Column</code> typeclass expects a type that it can apply a container type to in order to get a concrete type."}, {"owner": {"reputation": 4013, "user_id": 317984, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03acf15ac1b2ad1a70e50fe985e11441?s=128&d=identicon&r=PG", "display_name": "martingw", "link": "https://stackoverflow.com/users/317984/martingw"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1470431268, "post_id": 38797613, "comment_id": 64965864, "body": "Yes, that makes sense, thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "reply_to_user": {"reputation": 4013, "user_id": 317984, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03acf15ac1b2ad1a70e50fe985e11441?s=128&d=identicon&r=PG", "display_name": "martingw", "link": "https://stackoverflow.com/users/317984/martingw"}, "edited": false, "score": 0, "creation_date": 1470431503, "post_id": 38797710, "comment_id": 64965952, "body": "I added some explanation. Let me know if you have questions."}], "tags": [], "owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "is_accepted": true, "score": 2, "last_activity_date": 1470431451, "last_edit_date": 1470431451, "creation_date": 1470430865, "answer_id": 38797710, "question_id": 38797613, "link": "https://stackoverflow.com/questions/38797613/haskell-instance-for-data-multiple-type-variables/38797710#38797710", "title": "Haskell: Instance for data multiple type variables?", "body": "<p>I think what you want instead is this:</p>\n\n<pre><code>data DerivedColumn c a b = DerivedColumn {\n    dcBase   :: c a, \n    dcDerive :: a -&gt; b\n}\n\ninstance Column c =&gt; Column (DerivedColumn c a) where\n    at dc i = dcDerive $ at (dcBase dc) i\n</code></pre>\n\n<p>To expand a bit, if you look at your <code>Column</code> class, you'll see that <code>c</code> has kind <code>* -&gt; *</code>, and the <code>a</code> in <code>c a</code> is the type of the values that <code>c</code> contains. I assume that the value of the columns that <code>DerivedColumn a b c</code> contains should have type <code>b</code>, so it should really be the last value you pass to the type constructor for you to define an instance of <code>Column</code>.</p>\n"}], "owner": {"reputation": 4013, "user_id": 317984, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03acf15ac1b2ad1a70e50fe985e11441?s=128&d=identicon&r=PG", "display_name": "martingw", "link": "https://stackoverflow.com/users/317984/martingw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 38797710, "answer_count": 1, "score": 0, "last_activity_date": 1470431451, "creation_date": 1470430365, "question_id": 38797613, "link": "https://stackoverflow.com/questions/38797613/haskell-instance-for-data-multiple-type-variables", "title": "Haskell: Instance for data multiple type variables?", "body": "<p>I want to create a type class for various types of \"columns of stuff\", so something like this:</p>\n\n<pre><code>class Column c where\n     at :: c a -&gt; Int -&gt; a\n\ndata ListColumn a = ListColumn {\n     lcContent :: [a]\n}\n\ninstance Column ListColumn where\n  at c i = lcContent c !! i\n</code></pre>\n\n<p>Now I want to derive one column from another. Say I have a column of customers, and I want to derive a column of customer names from that. So I wrote:</p>\n\n<pre><code>data DerivedColumn a b c = DerivedColumn {\n    dcBase   :: c a, \n    dcDerive :: a -&gt; b\n}\n</code></pre>\n\n<p><code>a</code> being the customer, <code>b</code> the customer name in the example above. Now I thought I could write something like this:</p>\n\n<pre><code>instance Column (DerivedColumn a b) where\n    at c i = dcDerive c $ at (dcBase c) i\n</code></pre>\n\n<p>But ghc does not seem to like it (<code>Column should have kind * -&gt; *, but DerivedColumn a b has kind (* -&gt; *) -&gt; *</code>). Can someone please point in the right direction...?</p>\n"}, {"tags": ["haskell", "cabal", "yesod", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1470430820, "post_id": 38797612, "comment_id": 64965708, "body": "I will try this other way, there is no need for it to be from source"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 2, "last_activity_date": 1470430357, "creation_date": 1470430357, "answer_id": 38797612, "question_id": 38797540, "link": "https://stackoverflow.com/questions/38797540/haskell-adding-a-package-from-source-to-a-yesod-project/38797612#38797612", "title": "Haskell - adding a package from source to a Yesod project", "body": "<p>Is there any reason that you can\u2019t use <a href=\"https://hackage.haskell.org/packages/search?terms=libsndfile\" rel=\"nofollow\">any of these libraries that are already on Hackage</a>? It will probably be much easier, safer, and more predictable if you\u2019re using a package from an actual package catalog rather that just using a tarball.</p>\n\n<p>If you <em>really</em> want to use that library you found, and you\u2019re using stack, you can add it to the <code>packages</code> section of your <code>stack.yaml</code> file:</p>\n\n<pre><code>packages:\n- '.'\n- location: http://www.mega-nerd.com/libsndfile/files/libsndfile-1.0.27.tar.gz\n  extra-dep: true\n</code></pre>\n\n<p>Then you can add a dependency on <code>libsndfile</code> to your <code>.cabal</code> file. However, I would be wary on depending on packages from arbitrary URLs, so I would probably, at the very least, download that package and untar it. Then you can just point to a local path instead of a remote URL:</p>\n\n<pre><code>packages:\n- '.'\n- location: ./some/path/to/libsndfile\n  extra-dep: true\n</code></pre>\n\n<p>For more information, see the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow\">documentation for the <code>stack.yaml</code> file</a>.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 38797612, "answer_count": 1, "score": 0, "last_activity_date": 1470438598, "creation_date": 1470429950, "last_edit_date": 1470438598, "question_id": 38797540, "link": "https://stackoverflow.com/questions/38797540/haskell-adding-a-package-from-source-to-a-yesod-project", "title": "Haskell - adding a package from source to a Yesod project", "body": "<p>I have found a good audio library to deal with audio on server side, but I am having trouble while actually making it part of yesod (maybe because I don't understand cabal/stack very well yet).</p>\n\n<p>I am trying to include this module <code>Sound.File.Sndfile</code> and I have downloaded its source files from here <a href=\"http://www.mega-nerd.com/libsndfile/files/libsndfile-1.0.27.tar.gz\" rel=\"nofollow\">http://www.mega-nerd.com/libsndfile/files/libsndfile-1.0.27.tar.gz</a>. Which are the steps to get it done?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I tried to make this steps</p>\n\n<pre><code>runhaskell Setup.hs configure --ghc\nrunhaskell Setup.hs build\nrunhaskell Setup.hs install\n</code></pre>\n\n<p>But it doesn't have a <code>Setup.hs</code> file.</p>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>I have added the dependency <code>hsndfile</code> as suggested by Alexis King, but I am getting the following error while buiding:</p>\n\n<pre><code>[ 1 of 59] Compiling Enums            ( Enums.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.7.0/build/Enums.o )\n&lt;command line&gt;: can't load .so/.DLL for: libsndfile.so (libsndfile.so: cannot open shared object file: No such file or directory)\n\n--  While building package Fastwork-0.0.0 using:\n      /home/geppetto/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.22.7.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.7.0 build lib:Fastwork exe:Fastwork --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I have downloaded <code>libsndfile-1.0.25.tar.gz</code> and I extracted it, and ran, ./configure, make, make install. When I tried to do a <code>stack build</code> again in my Yesod project, the error was the same. What am I missing?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1470422028, "post_id": 38795707, "comment_id": 64961783, "body": "It may be worth mentioning: this gives you the guarantee you want outside the system, but not inside it. That is, GHC won&#39;t infer from <code>IsInt a</code> that <code>a ~ Int</code>. This can occasionally require annoying additional type annotations. I don&#39;t think that can be helped purely within H98 (or H2010), though."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470422199, "post_id": 38795707, "comment_id": 64961868, "body": "@DanielWagner, yes, it is definitely inferior to GHC&#39;s approach. If equality constraints are ever standardized, I will definitely prefer them. But <code>containers</code> generally tries to be as &quot;portable&quot; as possible, so if I can do what I need without an extension, I will."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1470427043, "post_id": 38795707, "comment_id": 64964124, "body": "@DanielWagner, I think it&#39;s also worth noting that this implementation is compatible with GHC&#39;s, in that you can apply <code>fromIntF</code> to <code>Refl :: Int :~: Int</code> to get something of type <code>IsInt a =&gt; Int :~: a</code>. Indeed, this will work for any similar equality type, regardless of how it fits into the language."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1470421783, "creation_date": 1470421783, "answer_id": 38795707, "question_id": 38795706, "link": "https://stackoverflow.com/questions/38795706/how-can-i-define-an-instance-for-a-specific-type-application-in-haskell-98/38795707#38795707", "title": "How can I define an instance for a specific type application in Haskell 98?", "body": "<p>This is possible using an idea I think I first encountered in a paper by Oleg Kiselyov, and which underlies <code>Control.Lens.Equality</code>.</p>\n\n<pre><code>import Data.Functor.Identity\n\nclass IsInt a where\n  fromIntF :: f Int -&gt; f a\n\ninstance IsInt Int where\n  fromIntF fx = fx\n\ntoIntF :: IsInt a =&gt; g a -&gt; g Int\ntoIntF = unf . fromIntF . F $ id\n\nnewtype F g a b = F {unf :: g b -&gt; a}\n\nfromInt :: IsInt a =&gt; Int -&gt; a\nfromInt = runIdentity . fromIntF . Identity\n\ntoInt :: IsInt a =&gt; a -&gt; Int\ntoInt = runIdentity . toIntF . Identity\n</code></pre>\n\n<p>Now I can use</p>\n\n<pre><code>instance IsInt a =&gt; Arbitrary (Set a)\n</code></pre>\n\n<p>and be confident that I'm really dealing with <code>Int</code>. For convenience, I can constrain the <code>IsInt</code> class with any classes I need of which <code>Int</code> is an instance:</p>\n\n<pre><code>class (Show a, Read a, Integral a, Arbitrary a) =&gt; IsInt a where ...\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1470422796, "creation_date": 1470421783, "last_edit_date": 1470422796, "question_id": 38795706, "link": "https://stackoverflow.com/questions/38795706/how-can-i-define-an-instance-for-a-specific-type-application-in-haskell-98", "title": "How can I define an instance for a specific type application in Haskell 98?", "body": "<p>I noticed that the test suite for <code>Data.Set</code> only really defines <code>Arbitrary Set a</code> sensibly for <code>a ~ Int</code>, but to avoid the GHC special <code>~</code> it uses</p>\n\n<pre><code>instance Enum a =&gt; Arbitrary (Set a)\n</code></pre>\n\n<p>How can I make sure only the <code>Arbitrary (Set Int)</code> instance is used without needing any GHC extensions? In GHC-only code, I'd use either <code>FlexibleInstances</code> or <code>GADTs</code> and then either</p>\n\n<pre><code>instance Arbitrary (Set Int)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>instance a ~ Int =&gt; Arbitrary (Set a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1470420040, "post_id": 38795236, "comment_id": 64960780, "body": "Make <code>ParseResult</code> a <code>newtype</code> instead of a type alias. That way, you can define your own instances on it without conflicting with the ones that are already defined for <code>Either</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470420080, "post_id": 38795236, "comment_id": 64960796, "body": "If you can change your data type to <code>Either [CompileError] ([CompilerWarning], a)</code>, you can simply <code>fmap</code> twice: <code>(fmap . fmap) (+1) (Right ([], 1))</code> evaluates to <code>Right ([], 2)</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1470421686, "post_id": 38795236, "comment_id": 64961615, "body": "I don&#39;t really understand how TypeSynonymInstances causes so much confusion. All it does is replace a type synonym in an instance head with its expansion. You can just as well do that yourself, so you can never need TypeSynonymInstances."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470424676, "post_id": 38795236, "comment_id": 64963085, "body": "Aside from the evil of redefinition, there is absolutely no way to define a <code>Functor</code> instance for <code>Either</code> that does what you want. I urge you to switch to a newtype, or even a data type without <code>Either</code>, and consider where you want to draw the abstraction line to make your package make sense and reuse as much existing code as you can."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470424919, "post_id": 38795236, "comment_id": 64963185, "body": "Consider something like <code>data CompResult a = CompFailed [CompilerError] | CompSucceeded a [CompilerWarning] deriving (Functor)</code>. You can easily write <code>Either</code>-like <code>Applicative</code>, <code>Monad</code>, and probably <code>MonadError</code> instances."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1470430450, "post_id": 38795236, "comment_id": 64965573, "body": "You may like the existing <code>WriterT [CompilerWarning] (Except [CompilerError])</code> monad. It offers <code>throwError</code> in place of your <code>Left</code>, <code>return</code> in place of your <code>Right . flip (,) []</code>, and <code>tell</code> in place of your <code>Right . (,) ()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1470429097, "last_edit_date": 1470429097, "creation_date": 1470420244, "answer_id": 38795384, "question_id": 38795236, "link": "https://stackoverflow.com/questions/38795236/redefine-instance-for-either-with-specific-type/38795384#38795384", "title": "redefine instance for Either with specific type", "body": "<p>You can take advantage of both <code>Either</code> and <code>(,)</code> being <em>bifunctors</em>, not just functors. This means using <code>second . first</code> instead of <code>fmap</code> to apply a function to the value of type <code>a</code>.</p>\n\n<pre><code>&gt; import Data.Bifunctor\n&gt; (second . first) (+1) (Right (1, []))\nRight (2, [])\n&gt; (second . first) (+1) (Left [\"oops\"])\nLeft [\"oops\"]\n</code></pre>\n\n<p><code>first f (x, y)</code> is equivalent to <code>(f x, y)</code>.</p>\n\n<p><code>second f (Right x)</code> is equivalent to <code>Right f x</code>, while <code>second f (Left y)</code> is equivalent to <code>Left y</code>.</p>\n\n<p>Putting them together, you can see that</p>\n\n<pre><code>(second . first) (+1) (Right (1, [])) == second (first (+1)) (Right (1, []))\n                                      == Right $ first (+1) (1, [])\n                                      == Right ((+1) 1, [])\n                                      == Right (2, [])\n</code></pre>\n\n<p>If you have a <code>Left</code> instead, nothing happens.</p>\n\n<pre><code>(second . first) (+1) (Left [\"oops\"]) == second (first (+1)) (Left [\"oops\"])\n                                      == Left [\"oops\"]\n</code></pre>\n\n<hr>\n\n<p>Since <code>fmap</code> is the same as <code>second</code> for <code>Either</code>, this means you can still  use <code>fmap</code>. You just need to wrap the function with <code>first</code> before using it.</p>\n\n<pre><code>(second . first) f == second (first f)\n                   == fmap (first f)\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code>&gt; import Data.Bifunctor\n&gt; fmap (first (+1)) (Right (1, []))\nRight (2, [])\n&gt; fmap (first (+1)) (Left [\"oops\"])\nLeft [\"oops\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 5, "last_activity_date": 1470422213, "creation_date": 1470422213, "answer_id": 38795809, "question_id": 38795236, "link": "https://stackoverflow.com/questions/38795236/redefine-instance-for-either-with-specific-type/38795809#38795809", "title": "redefine instance for Either with specific type", "body": "<p>You can't redefine existing instances (and it would be terrible if you could).</p>\n\n<p>Your options are:</p>\n\n<ul>\n<li><p>Make <code>ParseResult</code> a real type, either using <code>newtype</code> or something like</p>\n\n<pre><code>data ParseResult a = Failure [CompilerError] | Success a [CompilerWarning]\n</code></pre>\n\n<p>and define instances for it.</p></li>\n<li><p>Don't bother with type classes at all, and just define functions like</p>\n\n<pre><code>mapParseResult :: (a -&gt; b) -&gt; ParseResult a -&gt; ParseResult b\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 38795384, "answer_count": 2, "score": 0, "last_activity_date": 1470429097, "creation_date": 1470419687, "last_edit_date": 1495535246, "question_id": 38795236, "link": "https://stackoverflow.com/questions/38795236/redefine-instance-for-either-with-specific-type", "title": "redefine instance for Either with specific type", "body": "<p>I have this type synonym :  </p>\n\n<pre><code>type ParseResult a = Either [CompilerError] (a, [CompilerWarning])\n</code></pre>\n\n<p>Where <code>CompilerError</code> and <code>CompilerWarning</code> are data types. </p>\n\n<p>Now I know that Either has instance for <code>Functor</code> and <code>Applicative</code> but the instance for <code>Functor</code> applies <code>fmap</code> on the tuple <code>(a,[CompilerWarning])</code>, I want to redefine the instance for this type synonym so that <code>fmap</code> applies on <code>a</code> not the whole tuple, the same goes for <code>Applicative</code>.  </p>\n\n<p>If I use <code>newtype</code> I will have to put <code>ParseResult</code> all over the place and I've written a lot of code already.  </p>\n\n<p>I'm aware I need <code>TypeSynonymInstances</code> but I faced the same problem in <a href=\"https://stackoverflow.com/questions/16059948/multi-parameter-type-synonym-instances\">this</a> question, from the question I think I need to define my type synonym like this :  </p>\n\n<pre><code>type ParseResult = ...\n</code></pre>\n\n<p>I need to fill <code>...</code>, I don't know how to make the right side of kind <code>* -&gt; *</code> with <code>Either</code> and the <code>tuple</code>, I tried <code>Either [CompilerError] ((,) [CompilerWarning])</code> but this has two problems : first <code>CompilerWarning</code> is the first element and I need it to be the second(so that I don't have to change a lot of code), second I get this message :  </p>\n\n<blockquote>\n  <p>\u2022 Expecting one more argument to \u2018(,) [CompilerWarning]\u2019\n        Expected a type, but \u2018(,) [CompilerWarning]\u2019 has kind \u2018* -> *\u2019\n      \u2022 In the second argument of \u2018Either\u2019, namely\n          \u2018(,) [CompilerWarning]\u2019\n        In the type \u2018Either [CompilerError] ((,) [CompilerWarning])\u2019\n        In the type declaration for \u2018ParseResult\u2019</p>\n</blockquote>\n\n<p>What's the best, least expensive solution to this problem ?</p>\n"}, {"tags": ["postgresql", "haskell", "opaleye"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470413512, "post_id": 38793460, "comment_id": 64957545, "body": "What&#39;s the context for this question? What packages / libraries are you using? What are your imports?"}, {"owner": {"reputation": 13, "user_id": 5569484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rr5s2.jpg?s=128&g=1", "display_name": "Tommy Engstr&#246;m", "link": "https://stackoverflow.com/users/5569484/tommy-engstr%c3%b6m"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470419518, "post_id": 38793460, "comment_id": 64960522, "body": "sorry. The only import needed here except Opaleye is Data.Profunctor.Product.TH  (makeAdaptorAndInstance)"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1470431788, "post_id": 38793460, "comment_id": 64966068, "body": "How about <code>type KeyN = Key&#39; (Column (Nullable PGInt8))</code>?"}, {"owner": {"reputation": 13, "user_id": 5569484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rr5s2.jpg?s=128&g=1", "display_name": "Tommy Engstr&#246;m", "link": "https://stackoverflow.com/users/5569484/tommy-engstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1470640477, "post_id": 38793460, "comment_id": 65012647, "body": "Okay, so I defined the key like that and the write key as <code>Key&#39; (Maybe (Column (Nullable PGInt8)))</code>. Then I ran into: <code>No instance for (Default QueryRunner (Key&#39; (Column (Nullable PGInt8))) (Maybe Key))</code>. Is that expected? I just assumed I had done something wrong in defining the types since I thought that default instance would be available to me."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1470766754, "post_id": 38793460, "comment_id": 65079797, "body": "As @ForestPhoenix says below, you need to convert to <code>Key&#39; (Maybe Int64)</code>."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1470766804, "post_id": 38793460, "comment_id": 65079826, "body": "Also, on the Opaleye side it should be <code>Key&#39; (Column (Nullable PGInt8))</code> (no <code>Maybe</code> in there)."}], "answers": [{"tags": [], "owner": {"reputation": 125, "user_id": 2596349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f216090d551a7da10d849915bc3f6b2?s=128&d=identicon&r=PG", "display_name": "ForestPhoenix", "link": "https://stackoverflow.com/users/2596349/forestphoenix"}, "is_accepted": false, "score": 0, "last_activity_date": 1470752826, "creation_date": 1470752826, "answer_id": 38853519, "question_id": 38793460, "link": "https://stackoverflow.com/questions/38793460/how-to-reference-newtyped-key-in-opaleye-as-nullable/38853519#38853519", "title": "How to reference newtyped key in Opaleye as nullable?", "body": "<p>Opaleye has a default instance for <code>Nullable PGInt8</code> to <code>Maybe Int64</code>.</p>\n\n<p>What you are trying to do is converting from <code>Key' (Column (Nullable PGInt8))</code> to <code>Maybe Key = Maybe (Key' Int64)</code>.</p>\n\n<p>For the default instances to work, you need to either convert</p>\n\n<ul>\n<li><p>from <code>Key' (Column (Nullable PGInt8)))</code> to <code>Key' (Maybe Int64)</code></p></li>\n<li><p>from <code>Column (Nullable (Key' PGInt8))</code> to <code>Maybe Key = Maybe (Key' Int64)</code></p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 5569484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rr5s2.jpg?s=128&g=1", "display_name": "Tommy Engstr&#246;m", "link": "https://stackoverflow.com/users/5569484/tommy-engstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1470814515, "post_id": 38857907, "comment_id": 65096732, "body": "Thank you very much for all the help, and for writing this sweet library!"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "reply_to_user": {"reputation": 13, "user_id": 5569484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rr5s2.jpg?s=128&g=1", "display_name": "Tommy Engstr&#246;m", "link": "https://stackoverflow.com/users/5569484/tommy-engstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1470815590, "post_id": 38857907, "comment_id": 65097381, "body": "@TommyEngstr&#246;m You&#39;re welcome.  Let me know if you need any more help."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": true, "score": 0, "last_activity_date": 1470767675, "last_edit_date": 1470767675, "creation_date": 1470767119, "answer_id": 38857907, "question_id": 38793460, "link": "https://stackoverflow.com/questions/38793460/how-to-reference-newtyped-key-in-opaleye-as-nullable/38857907#38857907", "title": "How to reference newtyped key in Opaleye as nullable?", "body": "<p>To combine my comments with @ForestPhoenix's answer:</p>\n\n<p>Opaleye allows you to convert <code>Column PGInt8</code> into <code>Int64</code> when you run the query.</p>\n\n<p>That means it <em>also</em> allows you to convert <code>Column (Nullable PGInt8)</code> into <code>Maybe Int64</code>.</p>\n\n<p>You are wrapping <code>Column (Nullable PGInt8)</code> in the <code>Key'</code> newtype (for type safety) which gives you <code>Key' (Column (Nullable PGInt8))</code>.  That means when you run the query you need to read it as a <code>Key' (Maybe Int64)</code>.</p>\n\n<p>Maybe this little table makes the correspondence clearer:</p>\n\n<pre><code>Opaleye side                  | Haskell side\n----------------------------- | -------------\nColumn PGInt8                 | Int64\nColumn (Nullable PGInt)       | Maybe Int64\nKey' (Column (Nullable PGInt) | Key' (Maybe Int64) \n</code></pre>\n\n<p>In general:</p>\n\n<pre><code>Opaleye side                    | Haskell side\n------------------------------- | -------------\nColumn o                        | h\nColumn (Nullable o)             | Maybe h\nMyNewype' (Column (Nullable o)) | MyNewType' (Maybe h)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5569484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rr5s2.jpg?s=128&g=1", "display_name": "Tommy Engstr&#246;m", "link": "https://stackoverflow.com/users/5569484/tommy-engstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 38857907, "answer_count": 2, "score": 1, "last_activity_date": 1470815574, "creation_date": 1470412837, "last_edit_date": 1470815574, "question_id": 38793460, "link": "https://stackoverflow.com/questions/38793460/how-to-reference-newtyped-key-in-opaleye-as-nullable", "title": "How to reference newtyped key in Opaleye as nullable?", "body": "<p>I'm using newtyped keys for all my tables</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Key' a = Key a deriving (Show, Generic, Functor)\ntype Key = Key' Int64\ntype KeyR = Key' (Column PGInt8)\ntype KeyW = Key' (Maybe (Column PGInt8))\n$(makeAdaptorAndInstance \"pKey\" ''Key')\n</code></pre>\n\n<p>I now want to have a nullable referece to such a key in a different table but I'm struggling. How can I reference a key as nullable?</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470412062, "post_id": 38793111, "comment_id": 64956644, "body": "How large of a list are you creating?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470413078, "post_id": 38793111, "comment_id": 64957249, "body": "Over 10M of either floats or integers. Actually, it is a parser for multidimensional arrays for a <a href=\"http://futhark-lang.org//\" rel=\"nofollow noreferrer\">compiler project</a>. The one it has now is by Happy and it is far too slow for the larger inputs, so I am hoping to replace it. My functional programming experience is in F# rather than Haskell so I am a bit taken aback here. The biggest hurdle here seems to be how to make use of a resizable array."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470413080, "post_id": 38793111, "comment_id": 64957250, "body": "The default definition of <b>many</b> is may be found <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-701\" rel=\"nofollow noreferrer\">here</a>. Of course, Parsec has it&#39;s own many combinator."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470413348, "post_id": 38793111, "comment_id": 64957438, "body": "What kind of operations are you going perform on the values? I presume you want a Vector just for the space economy - not for random access. What does your code do now when the values are returned as a list?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470413782, "post_id": 38793111, "comment_id": 64957705, "body": "Convert them into the internal primitive type and pass them onto the later stages in the compiler. You are right that I want arrays for the space economy, but lists are slow in addition to that. I am not sure if the compiler converts the list of values to a Vector if that is what you are asking. In general, the parser it currently has is quite inefficient and takes up 2.6Gb when loaded in GHCI. Until recently, we&#39;ve even suspected it to be related to a space leak in <code>ghc-mod</code> but that turned out not to be the case. It might be worth redoing completely."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1470414521, "post_id": 38793111, "comment_id": 64958071, "body": "Not sure if it would be an improvement over simply <code>fmap</code>ing <code>Data.Vector.fromList</code>, but what about using <code>Data.Vector.Fusion.Bundle.Monadic.unfoldrM</code> and (not exposed, though) <code>Data.Vector.Generic.unstreamM</code>? It looks like there may be fusion that could avoid the intermediate list."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1470415394, "post_id": 38793111, "comment_id": 64958449, "body": "That sounds interesting. First time hearing about these functions. I was under the impression that fusion is done under the hood by the Haskell compiler. I should emphasize that I am not affiliated with the aforementioned compiler project and that my knowledge of Haskell is pretty rudimentary. For me, it might be worth looking at how <code>Vector</code>&#39;s unfold is made under the hood since if that is at all done efficiently, it necessarily has to have array resizing mechanisms inside."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1470415760, "post_id": 38793111, "comment_id": 64958657, "body": "Though that might be worth barking up the wrong tree. Right now, I&#39;d do better with an explanation of the <code>many</code> function. First I need to figure out how is the parser even getting applied."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1470422309, "post_id": 38793111, "comment_id": 64961925, "body": "@MarkoGrdinic My understanding of fusion is that it&#39;s sort of like rewrite rules - the compiler will apply it automatically but you have to indicate where it <i>can be</i> applied. The Vector library, because it aims to be performant, should be structured to make use of it. It appears to use &quot;Bundle&quot; and/or &quot;Stream&quot; to facilitate the fusion but I don&#39;t know in what scenarios they will be superior enough to warrant the complexity of using them directly."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1470424496, "last_edit_date": 1470424496, "creation_date": 1470416441, "answer_id": 38794402, "question_id": 38793111, "link": "https://stackoverflow.com/questions/38793111/how-to-make-a-custom-attoparsec-parser-combinator-that-returns-a-vector-instead/38794402#38794402", "title": "How to make a custom Attoparsec parser combinator that returns a Vector instead of a list?", "body": "<p><code>Vector</code>s are arrays, under the hood. The tricky thing about arrays is that they are fixed-length. You pre-allocate an array of a certain length, and the only way of extending it is to copy the elements into a larger array.</p>\n\n<p>This makes linked lists simply <em>better</em> at representing variable-length sequences. (It's also why list implementations in imperative languages amortise the cost of copying by allocating arrays with extra space and copying only when the space runs out.) If you don't know in advance how many elements there are going to be, your best bet is to use a list (and perhaps copy the list into a <code>Vector</code> afterwards using <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#v:fromList\" rel=\"nofollow\"><code>fromList</code></a>, if you need to). That's why <code>many</code> returns a list: it runs the parser as many times as it can with no prior knowledge of how many that'll be.</p>\n\n<p>On the other hand, if you happen to know how many numbers you're parsing, then a <code>Vector</code> could be more efficient. Perhaps you know <em>a priori</em> that there are always <code>n</code> numbers, or perhaps the protocol specifies before the start of the sequence how many numbers there'll be. Then you can use <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#v:replicateM\" rel=\"nofollow\"><code>replicateM</code></a> to allocate and populate the vector efficiently.</p>\n"}, {"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1470419835, "post_id": 38794879, "comment_id": 64960681, "body": "Those aren&#39;t bad ideas. In regard to the later two I should have mentioned that the fast parser is for the value syntax. The approach I am going to go for here is figure out how Attoparsec internals work, and once I figure out how to trigger the parser, just apply it repeatedly inside a Vector.unfoldr."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470424018, "post_id": 38794879, "comment_id": 64962784, "body": "On the point of writing one&#39;s own list operations: if you define a <code>newtype</code> for <code>[Vector a]</code> (or just use <a href=\"https://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Compose</code></a>) the derived <code>Foldable</code> and <code>Traversable</code> instances will do the right thing"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470418266, "creation_date": 1470418266, "answer_id": 38794879, "question_id": 38793111, "link": "https://stackoverflow.com/questions/38793111/how-to-make-a-custom-attoparsec-parser-combinator-that-returns-a-vector-instead/38794879#38794879", "title": "How to make a custom Attoparsec parser combinator that returns a Vector instead of a list?", "body": "<p>Some ideas:</p>\n\n<h2>Data Structures</h2>\n\n<p>I think the most practical data structure to use for the list of Ints is something like <code>[Vector Int]</code>. If each component Vector is sufficiently long (i.e. has length 1k) you'll get good space economy. You'll have\nto write your own \"list operations\" to traverse it, but you'll avoid re-copying data that you would have to perform to return the data in a single <code>Vector Int</code>.</p>\n\n<p>Also consider using a <a href=\"https://hackage.haskell.org/package/dequeue-0.1.12/docs/Data-Dequeue.html\" rel=\"nofollow\"><strong>Dequeue</strong></a> instead of a list.</p>\n\n<h2>Stateful Parsing</h2>\n\n<p>Unlike Parsec, Attoparsec does not provide for user state. However, you\nmight be able to make use of the <code>runScanner</code> function <a href=\"http://hackage.haskell.org/package/attoparsec-0.13.0.2/docs/Data-Attoparsec-ByteString.html#v:runScanner\" rel=\"nofollow\">(link)</a>:</p>\n\n<pre><code>runScanner :: s -&gt; (s -&gt; Word8 -&gt; Maybe s) -&gt; Parser (ByteString, s)\n</code></pre>\n\n<p>(It also returns the parsed ByteString which in your case may be problematic since it will be very large. Perhaps you can write an alternate version which doesn't do this.)</p>\n\n<p>Using <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#v:unsafeFreeze\" rel=\"nofollow\"><strong>unsafeFreeze</strong></a> and <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#v:unsafeThaw\" rel=\"nofollow\"><strong>unsafeThaw</strong></a> you can incrementally fill in a Vector. Your <code>s</code> data structure might look\nsomething like:</p>\n\n<pre><code>data MyState = MyState \n             { inNumber   :: Bool           -- True if seen a digit\n             , val        :: Int            -- value of int being parsed\n             , vecs       :: [ Vector Int ] -- past parsed vectors \n             , v          :: Vector Int     -- current vector we are filling\n             , vsize      :: Int            -- number of items filled in current vector\n             }\n</code></pre>\n\n<p>Maybe instead of a <code>[Vector Int]</code> you use a <code>Dequeue (Vector Int)</code>.</p>\n\n<p>I imagine, however, that this approach will be slow since your parsing function will get called for every single character.</p>\n\n<h2>Represent the list as a single token</h2>\n\n<p>Parsec can be used to parse a stream of tokens, so how about writing\nyour own tokenizer and letting Parsec create the AST.</p>\n\n<p>The key idea is to represent these large sequences of Ints as a single token. This gives you a lot more latitude in how you parse them.</p>\n\n<h2>Defer Conversion</h2>\n\n<p>Instead of converting the numbers to Ints at parse time, just have <code>parseManyNumbers</code> return a ByteString and defer the conversion until\nyou actually need the values. This much enable you to avoid reifying\nthe values as an actual list.</p>\n"}, {"tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 2, "last_activity_date": 1470424951, "creation_date": 1470424951, "answer_id": 38796460, "question_id": 38793111, "link": "https://stackoverflow.com/questions/38793111/how-to-make-a-custom-attoparsec-parser-combinator-that-returns-a-vector-instead/38796460#38796460", "title": "How to make a custom Attoparsec parser combinator that returns a Vector instead of a list?", "body": "<p>There is a growable vector implementation in Haskell, which is based on the great AMT algorithm: <a href=\"http://hackage.haskell.org/package/persistent-vector\" rel=\"nofollow\">\"persistent-vector\"</a>. Unfortunately, the library isn't that much known in the community so far. However to give you a clue about the performance of the algorithm, I'll say that it is the algorithm that drives the standard vector implementations in Scala and Clojure.</p>\n\n<p>I suggest you implement your parser around that data-structure under the influence of the list-specialized implementations. Here the functions are, btw:</p>\n\n<pre><code>-- | One or more.\nsome :: f a -&gt; f [a]\nsome v = some_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (fmap (:) v) &lt;*&gt; many_v\n\n-- | Zero or more.\nmany :: f a -&gt; f [a]\nmany v = many_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (fmap (:) v) &lt;*&gt; many_v\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1470424951, "creation_date": 1470411752, "question_id": 38793111, "link": "https://stackoverflow.com/questions/38793111/how-to-make-a-custom-attoparsec-parser-combinator-that-returns-a-vector-instead", "title": "How to make a custom Attoparsec parser combinator that returns a Vector instead of a list?", "body": "<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Attoparsec.Text\nimport Control.Applicative(many)\nimport Data.Word\n\nparseManyNumbers :: Parser [Int] -- I'd like many to return a Vector instead\nparseManyNumbers = many (decimal &lt;* skipSpace)\n\nmain :: IO ()\nmain = print $ parseOnly parseManyNumbers \"131 45 68 214\"\n</code></pre>\n\n<p>The above is just an example, but I need to parse a large amount of primitive values in Haskell and need to use arrays instead of lists. This is something that possible in the <a href=\"http://www.quanttec.com/fparsec/reference/primitives.html#members.Inline..Many\" rel=\"nofollow\">F#'s Fparsec</a>, so I've went as far as looking at Attoparsec's source, but I can't figure out a way to do it. In fact, I can't figure out where <code>many</code> from <code>Control.Applicative</code> is defined in the <code>base</code> Haskell library. I thought it would be there as that is where documentation on Hackage points to, but no such luck.</p>\n\n<p>Also, I am having trouble deciding what data structure to use here as I can't find something as convenient as a resizable array in Haskell, but I would rather not use inefficient tree based structures.</p>\n\n<p>An option to me would be to skip Attoparsec and implement an entire parser inside the ST monad, but I would rather avoid it except as a very last resort.</p>\n"}, {"tags": ["haskell", "let"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1470411042, "post_id": 38792853, "comment_id": 64956022, "body": "because <code>let</code> cannot be in the same column as your function&#39;s, in this case column 1. just add a space in the beginning of lines starting 5."}, {"owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1470413405, "post_id": 38792853, "comment_id": 64957481, "body": "A bit unreladely to your question, but it could help you somehow if you are learning haskell: Note that this algorithm is not really quicksort. It doesn&#39;t  use constant memory. <a href=\"http://augustss.blogspot.cz/2007/08/quicksort-in-haskell-quicksort-is.html\" rel=\"nofollow noreferrer\">augustss.blogspot.cz/2007/08/&hellip;</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1578413688, "post_id": 38792853, "comment_id": 105426575, "body": "@user1747134 also <a href=\"https://stackoverflow.com/q/14786904/849891\">this</a> and its links."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 14, "last_activity_date": 1470411059, "creation_date": 1470411059, "answer_id": 38792903, "question_id": 38792853, "link": "https://stackoverflow.com/questions/38792853/how-to-use-let-keyword-to-define-multiple-variables-in-haskell/38792903#38792903", "title": "How to use &quot;let&quot; keyword to define multiple variables in Haskell", "body": "<p>You need to indent the <code>let</code> expression, since it is a continuation of the previous line.</p>\n\n<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]\nquicksort [] = []\nquicksort (x:xs) =\n  let smaller = quicksort [a | a &lt;- xs, a &lt;= x]\n      bigger  = quicksort [a | a &lt;- xs, a &gt; x]\n  in smaller ++ [x] ++ bigger\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 13490754, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1-dx27ZeMZo/AAAAAAAAAAI/AAAAAAAAAAA/AAKWJJON4ANyFz5tT23U9S4lVYfcGSz2wQ/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u041d\u0438\u043a\u043e\u043b\u0430\u0439", "link": "https://stackoverflow.com/users/13490754/%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9-%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9"}, "is_accepted": false, "score": 2, "last_activity_date": 1588858066, "last_edit_date": 1588858066, "creation_date": 1588853336, "answer_id": 61657438, "question_id": 38792853, "link": "https://stackoverflow.com/questions/38792853/how-to-use-let-keyword-to-define-multiple-variables-in-haskell/61657438#61657438", "title": "How to use &quot;let&quot; keyword to define multiple variables in Haskell", "body": "<p>Another way to do this You can write it in one line using braces and semicolons <code>{ ; ; ; }</code>:</p>\n\n<p><code>quicksort (x:xs) = let {smaller = quicksort [a | a &lt;- xs, a &lt;= x]; bigger  = quicksort [a | a &lt;- xs, a &gt; x]} in smaller ++ [x] ++ bigger</code></p>\n"}], "owner": {"reputation": 71, "user_id": 5332733, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oCjIDr4z-Xk/AAAAAAAAAAI/AAAAAAAAACs/YvyvEY4H700/photo.jpg?sz=128", "display_name": "Lyndon", "link": "https://stackoverflow.com/users/5332733/lyndon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6874, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1588858066, "creation_date": 1470410890, "last_edit_date": 1578302011, "question_id": 38792853, "link": "https://stackoverflow.com/questions/38792853/how-to-use-let-keyword-to-define-multiple-variables-in-haskell", "title": "How to use &quot;let&quot; keyword to define multiple variables in Haskell", "body": "<p>I've the below code snippet in Haskell to implement the quicksort algorithm.</p>\n\n<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]\nquicksort [] = []\nquicksort (x:xs) =\nlet smaller = quicksort [a | a &lt;- xs, a &lt;= x]\n    bigger  = quicksort [a | a &lt;- xs, a &gt; x]\nin smaller ++ [x] ++ bigger\n</code></pre>\n\n<p>However, GHCi rejects the program telling me that line 5 has a syntax error. But I've checked the Haskell syntax for the \"let\" keyword and it seems OK.</p>\n\n<p>Is there anyone who can help me with this problem? Thanks a lot.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6667042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29937ac068a9ffc4d372505480b47a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/6667042/tristan"}, "edited": false, "score": 0, "creation_date": 1470565636, "post_id": 38798930, "comment_id": 64993739, "body": "Unfortunately your solutions didn&#39;t work. I&#39;ve added some comments to my question to describe my experience."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1470572165, "last_edit_date": 1470572165, "creation_date": 1470438834, "answer_id": 38798930, "question_id": 38791455, "link": "https://stackoverflow.com/questions/38791455/compiling-haskell-package-using-c-and-stack-cabal/38798930#38798930", "title": "Compiling Haskell package using c++ and stack/cabal", "body": "<p>Try this simpler custom Setup.hs file:</p>\n\n<pre><code>import Distribution.Simple\nimport System.Environment\n\nmain = do\n  args &lt;- getArgs\n  defaultMainArgs $ [\"--with-gcc=c++\"] ++ args\n</code></pre>\n\n<p><strong>Original Answer</strong></p>\n\n<p>Some ideas:</p>\n\n<p>(1) Create a wrapper script called <code>gcc</code> which invokes <code>g++</code>. Put the script early in your PATH so that running <code>gcc</code> will run your script instead of the real <code>gcc</code>. Perhaps you have this wrapper script in place only when you are building the clipper package.</p>\n\n<p>(2) Write a custom Setup.hs.</p>\n\n<ol>\n<li>Modify the <code>build-type</code> field in the clipper.cabal file to be <code>Custom</code> instead of <code>Simple</code></li>\n<li><p>Replace the Setup.hs file with:</p>\n\n<pre><code>import Distribution.Simple\nimport Distribution.Simple.Setup\nimport Distribution.Simple.LocalBuildInfo\nimport Distribution.PackageDescription\nimport Text.Show.Pretty\n\nmain = do\n  let hooks = simpleUserHooks\n\n      myBuild :: PackageDescription -&gt; LocalBuildInfo -&gt; UserHooks -&gt; BuildFlags -&gt; IO ()\n      myBuild pkgd buildinfo uhooks flags = do\n        putStrLn $ ppShow flags\n        let flags' = flags { buildProgramPaths = [(\"gcc\",\"g++\")] ++ (buildProgramPaths flags) }\n        buildHook hooks pkgd buildinfo uhooks flags'\n        putStrLn $ ppShow flags'\n      hooks' = hooks { buildHook = myBuild }\n\n  defaultMainWithHooks hooks'\n</code></pre></li>\n</ol>\n\n<p>Note: The import of Text.Show.Pretty is not necessary, so you can remove it and the ppShow calls if you don't have it installed.</p>\n\n<p>The above Setup.hs should have the same effect as calling cabal with <code>--with-gcc=g++</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 6667042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29937ac068a9ffc4d372505480b47a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/6667042/tristan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 38798930, "answer_count": 1, "score": 1, "last_activity_date": 1483478044, "creation_date": 1470406591, "last_edit_date": 1483478044, "question_id": 38791455, "link": "https://stackoverflow.com/questions/38791455/compiling-haskell-package-using-c-and-stack-cabal", "title": "Compiling Haskell package using c++ and stack/cabal", "body": "<p>There's a package clipper <a href=\"http://hackage.haskell.org/package/clipper\" rel=\"nofollow\">http://hackage.haskell.org/package/clipper</a> that I want to use to detect intersection of complex polygons. It's an FFI to a C++ package. It works fine if you run </p>\n\n<p><code>cabal build --with-gcc=/usr/bin/g++</code></p>\n\n<p>but not otherwise. Is there some way to put that gcc option into the cabal file or otherwise get my stack project to build the dependency with g++?</p>\n\n<p>Setting the $PATH for some reason doesn't work:</p>\n\n<pre><code>%  cabal build --with-gcc=g++\nBuilding clipper-0.0.1...\nPreprocessing library clipper-0.0.1...\n[1 of 1] Compiling Algebra.Clipper  ( dist/build/Algebra/Clipper.hs, dist/build/Algebra/Clipper.o )\nIn-place registering clipper-0.0.1...\n\n%  PATH=$(pwd):$PATH gcc\ng++: fatal error: no input files\ncompilation terminated.\n\n%  PATH=$(pwd):$PATH cabal build \nBuilding clipper-0.0.1...\nPreprocessing library clipper-0.0.1...\nIn file included from Clipper.hsc:27:0:\ncbits/clipper.hpp:29:18: fatal error: vector: Dosiero a\u016d dosierujo ne ekzistas\ncompilation terminated.\ncompiling dist/build/Algebra/Clipper_hsc_make.c failed (exit code 1)\ncommand was: /usr/bin/gcc -c dist/build/Algebra/Clipper_hsc_make.c -o dist/build/Algebra/Clipper_hsc_make.o -fno-stack-protector -D__GLASGOW_HASKELL__=710 -Dlinux_BUILD_OS=1 -Dx86_64_BUILD_ARCH=1 -Dlinux_HOST_OS=1 -Dx86_64_HOST_ARCH=1 -Icbits -Idist/build/autogen -include dist/build/autogen/cabal_macros.h -I/usr/local/haskell/ghc-7.10.2-x86_64/lib/ghc-7.10.2/base_GDytRqRVSUX7zckgKqJjgw/include -I/usr/local/haskell/ghc-7.10.2-x86_64/lib/ghc-7.10.2/integ_2aU3IZNMF9a7mQ0OzsZ0dS/include -I/usr/local/haskell/ghc-7.10.2-x86_64/lib/ghc-7.10.2/include -I/usr/local/haskell/ghc-7.10.2-x86_64/lib/ghc-7.10.2/include/\n</code></pre>\n\n<p>Similarly, changing the Setup.hs as proposed by the @ErikR below didn't help.</p>\n\n<pre><code>% runghc Setup.hs build\n\"Hello, I am running\"\nfomg\nBuildFlags\n  { buildProgramPaths = []\n  , buildProgramArgs = []\n  , buildDistPref = Flag \"dist\"\n  , buildVerbosity = Flag Normal\n  , buildNumJobs = NoFlag\n  , buildArgs = []\n }\nfimg\nBuildFlags\n  { buildProgramPaths = [ ( \"gcc\" , \"/usr/bin/g++\" ) ]\n  , buildProgramArgs = []\n  , buildDistPref = Flag \"dist\"\n  , buildVerbosity = Flag Normal\n  , buildNumJobs = NoFlag\n  , buildArgs = []\n  }\nBuilding clipper-0.0.1...\nPreprocessing library clipper-0.0.1...\nIn file included from Clipper.hsc:27:0:\n(etc)\n</code></pre>\n\n<p>Note that it crashes at the buildHook line, so in order to get the flags printed I needed to change the order around.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 1, "creation_date": 1470407281, "post_id": 38791510, "comment_id": 64953510, "body": "Sorry if this is really elementary, but does that mean (in your example) <code>st &quot;A&quot;</code> is the <code>(String-&gt;Int)</code> part (i.e. <code>State</code>) of the <code>extend</code> type? If yes, then should it be followed by a String?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 1, "creation_date": 1470407443, "post_id": 38791510, "comment_id": 64953612, "body": "Right. In the call <code>extend st &quot;A&quot; 5</code>, <code>st</code> needs to have type <code>String -&gt; Int</code>. In the expression <code>let st &quot;A&quot; = 3</code>, I&#39;m using pattern matching to define a partial function <code>st</code> that returns 3 on an input of &quot;A&quot;. <code>st</code> is not defined for any other input value. If you define <code>extend</code> properly, <code>st&#39;</code> is <i>also</i> not defined for any other input, and <code>st&#39;&#39;</code> is defined only for &quot;A&quot; and &quot;B&quot;."}, {"owner": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 0, "creation_date": 1470408437, "post_id": 38791510, "comment_id": 64954285, "body": "Actually I was wondering if <code>st &quot;A&quot;</code> in <code>extend st &quot;A&quot; 5</code> has type (String -&gt; Int), then shouldn&#39;t it be followed by a <code>String</code> as the type of <code>extend</code> is <code>(String -&gt; Int) [which is st &quot;A&quot;] -&gt; String -&gt; Int ...</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 0, "creation_date": 1470409261, "post_id": 38791510, "comment_id": 64954925, "body": "<code>extend</code> has type <code>State -&gt; String -&gt; Int -&gt; State</code>, so <code>extend st</code> has type <code>String -&gt; Int -&gt; State</code>, and <code>extend st &quot;A&quot;</code> has type <code>Int -&gt; State</code>. That leaves <code>extend st &quot;A&quot; 2</code> having type <code>State</code>, meaning if you give <code>extend</code> and old state, a string, and an integer, you get back a new state."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 0, "creation_date": 1470413424, "post_id": 38791510, "comment_id": 64957492, "body": "@Liumx31 There&#39;s no <code>st &quot;A&quot;</code> in <code>extend st &quot;A&quot; 5</code>: there the function <code>st</code> (which has type <code>String-&gt;Int</code>) is not applied to anything, it is passed as the first argument to <code>extend</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1470409196, "last_edit_date": 1470409196, "creation_date": 1470406754, "answer_id": 38791510, "question_id": 38791405, "link": "https://stackoverflow.com/questions/38791405/cis-194-exercise-confusion/38791510#38791510", "title": "CIS 194 exercise confusion", "body": "<p>Close. Given</p>\n\n<pre><code>type State = String -&gt; Int\nextend :: State -&gt; String -&gt; Int -&gt; State\n</code></pre>\n\n<p>the \"real\" type of <code>extend</code> is (note the parentheses)</p>\n\n<pre><code>extend :: (String -&gt; Int) -&gt; String -&gt; Int -&gt; (String -&gt; Int)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>-- because -&gt; is right-associative\nextend :: (String -&gt; Int) -&gt; String -&gt; Int -&gt; String -&gt; Int\n</code></pre>\n\n<p>The first argument to <code>extend</code> is a function of type <code>String -&gt; Int</code>, not just a <code>String</code> value.</p>\n\n<hr>\n\n<p><code>extend</code> isn't meant to look up a value of \"A\"; it's meant to create a new state in which the value of \"A\" has a given value. For instance:</p>\n\n<pre><code>let st' = let st \"A\" = 3 in extend st \"A\" 5 \nlet st'' = extend \"B\" 2 st'\n</code></pre>\n\n<p>Looking up \"A\" in <code>st'</code> should produce a value of 5, not 3. Likewise, \"B\" is not defined in <code>st'</code>, but is in <code>st''</code>.</p>\n\n<pre><code>&gt;&gt;&gt; st' \"A\"\n5\n&gt;&gt;&gt; st'' \"A\"\n5\n&gt; st' \"B\"\n*** Exception: &lt;interactive&gt;:2:5-15: Non-exhaustive patterns in function st'\n&gt;&gt;&gt; st'' \"B\"\n2    \n</code></pre>\n"}], "owner": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 38791510, "answer_count": 1, "score": 0, "last_activity_date": 1470409196, "creation_date": 1470406440, "question_id": 38791405, "link": "https://stackoverflow.com/questions/38791405/cis-194-exercise-confusion", "title": "CIS 194 exercise confusion", "body": "<p>I am learning Haskell on my own and I got confused by an exercise in a <a href=\"http://www.seas.upenn.edu/~cis194/hw/03-ADTs.pdf\" rel=\"nofollow\">homework</a> in CIS 194:</p>\n\n<blockquote>\n  <p>Exercise 1. Before we can start evaluating Expressions and Statements we need some way to store and look up the state of a variable. We define a State to be a function of type String -> Int. This makes it very easy to look up the value of a variable; to look up the value of\n  \"A\" in state, we simply call state \"A\". Whenever we assign a variable, we want to update the program State. Implement the following function:\n  extend :: State -> String -> Int -> State</p>\n  \n  <p>Hint: You can use the input State as a black box for variables other\n  than the one you are assigning. </p>\n  \n  <p>Example:\n   let st\u2019 = extend st \"A\" 5\n   in st\u2019 \"A\" == 5</p>\n</blockquote>\n\n<p>I fundamentally don't understand what it's asking and the example. How does this provide a way to look up value of \"A\"? Since <code>State</code> is defined as <code>type State = String -&gt; Int</code>, does <code>extend</code> have type <code>String-&gt;Int-&gt;String-&gt;Int-&gt;State</code>?</p>\n"}, {"tags": ["java", "haskell", "frege"], "answers": [{"comments": [{"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1470400652, "post_id": 38788926, "comment_id": 64948951, "body": "@Nicholas Filotto same idea but I used &#39;java -cp .:../frege3.jar Hello&#39; . thanks"}, {"owner": {"reputation": 38836, "user_id": 1997376, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3AtSv.png?s=128&g=1", "display_name": "Nicolas Filotto", "link": "https://stackoverflow.com/users/1997376/nicolas-filotto"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1470402234, "post_id": 38788926, "comment_id": 64950028, "body": "That&#39;s why I added the note &quot;Assuming that...&quot;"}], "tags": [], "owner": {"reputation": 38836, "user_id": 1997376, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3AtSv.png?s=128&g=1", "display_name": "Nicolas Filotto", "link": "https://stackoverflow.com/users/1997376/nicolas-filotto"}, "is_accepted": true, "score": 4, "last_activity_date": 1470399930, "last_edit_date": 1470399930, "creation_date": 1470399006, "answer_id": 38788926, "question_id": 38788867, "link": "https://stackoverflow.com/questions/38788867/how-to-run-generated-frege-java-code-on-jvm/38788926#38788926", "title": "How to run generated frege java code on jvm?", "body": "<p>You need to add <code>frege3.jar</code> in your classpath also when you launch the command, so try this:</p>\n\n<pre><code>java -cp .:frege3.jar Hello\n</code></pre>\n\n<p>Assuming that <code>frege3.jar</code> and <code>Hello.class</code> are both in the current directory</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 0, "last_activity_date": 1470445478, "creation_date": 1470445478, "answer_id": 38799622, "question_id": 38788867, "link": "https://stackoverflow.com/questions/38788867/how-to-run-generated-frege-java-code-on-jvm/38799622#38799622", "title": "How to run generated frege java code on jvm?", "body": "<ol>\n<li>You don't need an extra javac compilation, this is automatically done by the frege compiler (unless suppressed by a flag).</li>\n<li>Yes, there is a getting started document here: <a href=\"https://github.com/Frege/frege/wiki/Getting-Started\" rel=\"nofollow\">https://github.com/Frege/frege/wiki/Getting-Started</a></li>\n</ol>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 38788926, "answer_count": 2, "score": 2, "last_activity_date": 1470445478, "creation_date": 1470398785, "question_id": 38788867, "link": "https://stackoverflow.com/questions/38788867/how-to-run-generated-frege-java-code-on-jvm", "title": "How to run generated frege java code on jvm?", "body": "<p>hello world in haskell frege : </p>\n\n<p>hello.fr : </p>\n\n<pre><code>module Hello where\n\nmain args = do\n    putStrLn \"Hello, World!\"\n</code></pre>\n\n<p>This code generates hello.java : </p>\n\n<pre><code>/*\n  Source code is in UTF-8 encoding. The following symbols may appear, among others:\n  \u03b1 \u03b2 \u03b3 \u03b4 \u03b5 \u03b6 \u03b7 \u03b8 \u03b9 \u03ba \u03bb \u03bc \u03bd \u03be \u03bf \u03c0 \u03c1 \u03c2 \u03c3 \u03c4 \u03c5 \u03c6 \u03c7 \u03c8 \u03c9 \u00ab \u2022 \u00a6 \u00bb \u2200 \u2203 \u2237 \u2026 \u2192 \u2190 \ufb01 \ufb02 \u0192\n  If you can't read this, you're out of luck. This code was generated with the frege compiler version 3.24.80\n  from hello.fr Do not edit this file! Instead, edit the source file and recompile.\n*/\n\nimport frege.run8.Func;\nimport frege.run8.Lazy;\nimport frege.run8.Thunk;\nimport frege.run.Kind;\nimport frege.run.RunTM;\nimport frege.runtime.Meta;\nimport frege.runtime.Phantom.RealWorld;\nimport frege.Prelude;\nimport frege.control.Category;\nimport frege.control.Semigroupoid;\nimport frege.java.IO;\nimport frege.java.Lang;\nimport frege.java.Util;\nimport frege.java.util.Regex;\nimport frege.prelude.Maybe;\nimport frege.prelude.PreludeArrays;\nimport frege.prelude.PreludeBase;\nimport frege.prelude.PreludeIO;\nimport frege.prelude.PreludeList;\nimport frege.prelude.PreludeMonad;\nimport frege.prelude.PreludeText;\n\n@SuppressWarnings(\"unused\")\n@Meta.FregePackage(\n  source=\"hello.fr\", time=1470398249962L, jmajor=1, jminor=8,\n  imps={\n    \"frege.Prelude\", \"frege.prelude.PreludeArrays\", \"frege.prelude.PreludeBase\", \"frege.prelude.PreludeIO\",\n    \"frege.prelude.PreludeList\", \"frege.prelude.PreludeMonad\", \"frege.prelude.PreludeText\", \"frege.java.util.Regex\"\n  },\n  nmss={\"Prelude\", \"PreludeArrays\", \"PreludeBase\", \"PreludeIO\", \"PreludeList\", \"PreludeMonad\", \"PreludeText\", \"Regexp\"},\n  symas={}, symcs={}, symis={}, symts={},\n  symvs={@Meta.SymV(offset=20, name=@Meta.QName(pack=\"Hello\", base=\"main\"), stri=\"s(u)\", sig=1, depth=1, rkind=49)},\n  symls={},\n  taus={\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"[]\")}),\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"StringJ\")}),\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"Char\")}),\n    @Meta.Tau(kind=0, suba=1, subb=2), @Meta.Tau(kind=0, suba=0, subb=3),\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"ST\")}),\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"RealWorld\")}),\n    @Meta.Tau(kind=0, suba=5, subb=6),\n    @Meta.Tau(kind=2, suba=0, tcon={@Meta.QName(kind=0, pack=\"frege.prelude.PreludeBase\", base=\"()\")}),\n    @Meta.Tau(kind=0, suba=7, subb=8)\n  },\n  rhos={@Meta.Rho(rhofun=false, rhotau=4), @Meta.Rho(rhofun=false, rhotau=9), @Meta.Rho(sigma=0, rhotau=1)},\n  sigmas={@Meta.Sigma(rho=0), @Meta.Sigma(rho=2)}, exprs={@Meta.Expr()}\n)\nfinal public class Hello  {\n\n\n\n\n\nfinal public static Func.U&lt;RealWorld, Short&gt; $main(final Lazy&lt;PreludeBase.TList&lt;String/*&lt;Character&gt;*/&gt;&gt; arg$1) {\n  return Prelude.putStrLn(\"Hello, World!\");\n}\n\n  public static void main(final java.lang.String[] argv) {\n    try {\n      frege.run.RunTM.argv = argv;\n\n        PreludeBase.TST.&lt;Short&gt;performUnsafe($main\n               (Thunk.lazy(PreludeArrays.IListSource_JArray.&lt;String/*&lt;Character&gt;*/&gt;toList(argv)))\n          ).call();\n      frege.runtime.Runtime.stdout.get().close();\n      frege.runtime.Runtime.stderr.get().close();\n\n    } finally { frege.run.Concurrent.shutDownIfExists(); }\n  }\n}\n</code></pre>\n\n<p>I then compile the generated java code with no error : </p>\n\n<pre><code>javac -cp frege3.jar build/Hello.class\n</code></pre>\n\n<p>I then attempt to run the code :</p>\n\n<pre><code>cd build\njava Hello\n</code></pre>\n\n<p>But this returns an error : </p>\n\n<pre><code>Error: A JNI error has occurred, please check your installation and try again\nException in thread \"main\" java.lang.NoClassDefFoundError: frege/run8/Lazy\n    at java.lang.Class.getDeclaredMethods0(Native Method)\n    at java.lang.Class.privateGetDeclaredMethods(Class.java:2701)\n    at java.lang.Class.privateGetMethodRecursive(Class.java:3048)\n    at java.lang.Class.getMethod0(Class.java:3018)\n    at java.lang.Class.getMethod(Class.java:1784)\n    at sun.launcher.LauncherHelper.validateMainClass(LauncherHelper.java:544)\n    at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:526)\nCaused by: java.lang.ClassNotFoundException: frege.run8.Lazy\n    at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n    ... 7 more\n</code></pre>\n\n<p>How to run the generated frege java code on jvm ?</p>\n\n<p>I'm using java8</p>\n"}, {"tags": ["haskell", "optimization", "iteration"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 4, "creation_date": 1470399593, "post_id": 38788221, "comment_id": 64948228, "body": "<code>Prelude.map</code>, like many <code>Prelude</code> functions is subject to build/foldr fusion, not stream fusion. This is just as fast as stream fusion but covers a different range of cases;  in particular build/foldr fusion is not pathological with things like <code>concatMap</code> as stream fusion is."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1470400478, "post_id": 38788221, "comment_id": 64948831, "body": "To see how the fusion works, see that map is temporarily rewritten as here github.com/ghc/ghc/blob/master/libraries/base/GHC/Base.hs#L9&zwnj;&#8203;26 This permits removal of the list with the usual foldr/build rule here github.com/ghc/ghc/blob/master/libraries/base/GHC/Base.hs#L8&zwnj;&#8203;49 If the resulting internal foldr does not fuse with a build, everthing reverts to the standard recursive map as we see here github.com/ghc/ghc/blob/master/libraries/base/GHC/Base.hs#L9&zwnj;&#8203;27"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470420722, "post_id": 38788221, "comment_id": 64961140, "body": "FYI, the paper is extremely readable: <a href=\"http://citeseer.ist.psu.edu/viewdoc/download?doi=10.1.1.104.7401&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">citeseer.ist.psu.edu/viewdoc/&hellip;</a>"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470637945, "post_id": 38788221, "comment_id": 65011400, "body": "@Michael A bit off topic: What makes than text faster than string, when all loop operations are fused into one?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470663510, "post_id": 38788221, "comment_id": 65026790, "body": "I&#39;m not sure of all the factors, but <code>Text</code> gives a more compact, packed representation. In some cases of course, the fact that the whole text exists if the first Char exists will make it &#39;slower&#39;. E.g. <code>T.readFile &quot;&#47;usr&#47;share&#47;dict&#47;words &gt;&gt;= print . head</code> will be slower and use more memory."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470663562, "post_id": 38788221, "comment_id": 65026822, "body": "But in general, a (fully developed) <code>String</code> of a million characters contains an immense arrangement of pointers each pointing to the next Char and a pointer and so on; the corresponding text is an array without pointers closely packing the information content of a <code>Char</code>. See the little calculation in <a href=\"http://blog.johantibell.com/2011/06/memory-footprints-of-some-common-data.html\" rel=\"nofollow noreferrer\">blog.johantibell.com/2011/06/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470636505, "post_id": 38803488, "comment_id": 65010808, "body": "Thanks, but thats only part of the answer. You missed the second question - Why ghc cannot infer fusion on its own?"}], "tags": [], "owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "is_accepted": true, "score": 1, "last_activity_date": 1470481024, "creation_date": 1470481024, "answer_id": 38803488, "question_id": 38788221, "link": "https://stackoverflow.com/questions/38788221/how-stream-fusion-works-in-haskell/38803488#38803488", "title": "How stream fusion works in Haskell?", "body": "<p>Stream fusion in Haskell is done using rewrite rules <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/rewrite-rules.html\" rel=\"nofollow\">(see the ghc documentation for more info)</a>. These are rules that you can specify in code using the <code>RULES</code> pragma.</p>\n\n<p>The basic idea of rewirte rules is, that you specify a set of ways that code could be rewritten at compile time for example if you defined your own version of <code>map</code> as <code>map'</code>, you could do something like</p>\n\n<pre><code>{-# RULES \n   \"map'/map'\" forall f g xs. map' f (map' g xs) = map' (f . g) xs\n  #-}\n</code></pre>\n\n<p>This introduces a rewrite rule called <code>map'/map'</code>.\nWhat this rule would do, is that it would rewrite every mapping of a function <code>f</code> over a list that is in turn a <code>g</code> mapped over some <code>xs</code> into one single mapping of <code>(f . g)</code> over these xs.</p>\n\n<p>There are a number of further sublteties to using rewrite rules. For example you can specify at what phase in the compiler a rule is applied, and the compiler doesn't have a way to check if those rules are correct. </p>\n\n<p>The rewrite results are still typechecked, but if you did something semantically incorrect in a rewrite rule, that is purely on you.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 38803488, "answer_count": 1, "score": 3, "last_activity_date": 1470481024, "creation_date": 1470396698, "last_edit_date": 1470398703, "question_id": 38788221, "link": "https://stackoverflow.com/questions/38788221/how-stream-fusion-works-in-haskell", "title": "How stream fusion works in Haskell?", "body": "<p>Can I write my own map function that is subject to stream fusion in Haskell?</p>\n\n<p>Why recursive iteration over list isn't subject to fusion? That completely kills the nice expressiveness of Haskell pattern matching: <code>foo (x:xx) ...</code>!</p>\n\n<p>Are Prelude loop functions fused?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470386277, "post_id": 38780051, "comment_id": 64940031, "body": "Always add type signatures for your functions. They make the code more readable and idiomatic, and most importantly allow GHC to check your functions indeed return what you intended to, often greatly improving the type error messages. Further, in the future, when asking on SO, if you receive an error from the compiler, post it! It contains valuable information for us, even if it might tell little to you."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470365612, "post_id": 38780214, "comment_id": 64931964, "body": "Hi ErikR. Thank you for the reply. What i need to return in the end of all is a list of integers.   typing solvingProblem 103 [15, 20, 5, 45, 34] for example i must get: [45, 45, 5, 5]"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 1, "creation_date": 1470365982, "post_id": 38780214, "comment_id": 64932031, "body": "Add type signatures to all of your functions and I&#39;ll take another look at it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 1, "creation_date": 1470366105, "post_id": 38780214, "comment_id": 64932057, "body": "In fact, after you add type signatures it might make the problem a lot more obvious."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470364315, "creation_date": 1470364315, "answer_id": 38780214, "question_id": 38780051, "link": "https://stackoverflow.com/questions/38780051/error-trying-to-print-list-in-haskell/38780214#38780214", "title": "Error trying to &quot;print&quot; list in Haskell", "body": "<p>The problem is with the last guard clause in <code>createList</code>.</p>\n\n<p>The type you intended for <code>createList</code> seems to be:</p>\n\n<pre><code>createList :: Int -&gt; [Int] -&gt; Int -&gt; Int\n</code></pre>\n\n<p>but if you look at the last guard clause you have:</p>\n\n<pre><code>| otherwise = createList (max - ...) listOfValues (insert ...)\n                         ^^^^^^^^^^^ ^^^^^^^^^^^^ ^^^^^^^^^^^^\n                          Int        [Int]        [Int]\n</code></pre>\n\n<p>Even though GHC is very good at inferring types, always adding\ntype signatures to your code is a good way of catching these kinds\nof errors early.</p>\n"}, {"comments": [{"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470365454, "post_id": 38780263, "comment_id": 64931924, "body": "Hi villou24. Thank you for the reply. I think I understand what you said, but i changed solvingProblem max [] = 0 solvingProblem max listOfValues | max == 0 = 0  to solvingProblem max [] = [] solvingProblem max listOfValues | max == 0 = []  and it don&#39;t compile"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470365567, "post_id": 38780263, "comment_id": 64931957, "body": "Have you changed the <code>-1</code> with <code>result</code>? What is the error saying?"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470365727, "post_id": 38780263, "comment_id": 64931984, "body": "now i did (: . sorry for that. it compile now. the error now is  Non-exhaustive patterns in function insert, probably semantics problem. I&#39;ll try to solve this now. Thank you very very much"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470365798, "post_id": 38780263, "comment_id": 64931995, "body": "and about the functions that already exists, some of the ones you quote i already knew and some not, but i can&#39;t use any of them in this project. but thank you anyway for that tip"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 1, "creation_date": 1470365845, "post_id": 38780263, "comment_id": 64932003, "body": "No problem ;) Your non-exhaustive pattern matching is due to the fact that insert is not defined for empty lists, you can either add a case <code>insert x [] = [x]</code> or straight-away say <code>insert = (:)</code>"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470366008, "post_id": 38780263, "comment_id": 64932034, "body": "i was getting an error by using : but i think it was because of the problem you just solved. now it works and i don&#39;t need the insert funcion (: . once again, thank you very much and sorry for my english"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470366154, "post_id": 38780263, "comment_id": 64932067, "body": "if you don&#39;t bother i wanted to ask one more thing"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470366310, "post_id": 38780263, "comment_id": 64932106, "body": "Sure, what is it ?"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470366509, "post_id": 38780263, "comment_id": 64932141, "body": "i&#39;m using ((higher listOfValues):result), so i&#39;m getting [5,5,45,45]. so, to get [45,45,5,5] i tried to use (result:(higher listOfValues)), but it won&#39;t compile"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470366837, "post_id": 38780263, "comment_id": 64932209, "body": "That&#39;s normal, <code>(:)</code> appends an element at the beginning of a list, it takes an <code>a</code> on the left and <code>[a</code>] as the second argument, so flipping the arguments is a type error. If you want to have the list in the right order, you can either apply <code>reverse</code>  to <code>createList</code> in <code>solvingProblem</code> of use <code>(++)</code> which takes two list and concatenate them. Then you can call <code>result ++ [higher listOfValues]</code>, notice that I need to create a list with a single element <code>higher listOfValues</code> in order to be able to use <code>(++)</code>"}, {"owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "edited": false, "score": 0, "creation_date": 1470367642, "post_id": 38780263, "comment_id": 64932373, "body": "Thank you very much villou24. You saved me (: Have a good night"}], "tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": true, "score": 3, "last_activity_date": 1470365436, "last_edit_date": 1470365436, "creation_date": 1470364741, "answer_id": 38780263, "question_id": 38780051, "link": "https://stackoverflow.com/questions/38780051/error-trying-to-print-list-in-haskell/38780263#38780263", "title": "Error trying to &quot;print&quot; list in Haskell", "body": "<p>If I may begin with a bit of a side note, some of your functions already exist in Haskell (now that I come to think of it you might have written them for an exercise, but just in case it wouldn't be the case, let's discuss that): your <code>higher</code> is <code>maximum</code>, your <code>smaller</code> is <code>minimum</code> and your insert is just <code>(:)</code>, beacause like you write it yourself <code>insert x list = x:list</code>. Note that your version will fail if you give it the empty list because the pattern matching is non-exhaustive. Also you could write <code>remove</code> in terms of filter: <code>remove x list = filter (== x) list</code>.</p>\n\n<p>Now why doesn't your code load properly? <code>ghci</code> tells you:</p>\n\n<pre><code>\u2022 Non type-variable argument in the constraint: Num [a]\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    solvingProblem :: forall a.\n                      (Ord a, Num [a], Num a) =&gt;\n                      a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Which I agree is pretty cryptic, but what it's saying is that the return type of <code>solvingProblem</code> is a list of <code>a</code> and for some reason it is also an instance of the <code>Num</code> type class. The reason why it says it's an instance of <code>Num</code> is because one of the return value of <code>solvingProblem</code> is <code>0</code> which is a number, which is a bit odd because it is also a list. Changing the 0 with <code>[]</code> makes the code compile and work (if you change <code>insert</code> with <code>(:)</code> otherwise you get the non-exhaustive pattern matching I was talking about earlier).</p>\n\n<pre><code>\u03bb&gt; solvingProblem 103 [15,20, 5, 45, 34]\n[5,5,45,45]\nit :: (Ord t, Num t) =&gt; [t]\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 6545181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0397a77ce4c6ac836690b47f3d264901?s=128&d=identicon&r=PG&f=1", "display_name": "J&#250;lio C&#233;sar", "link": "https://stackoverflow.com/users/6545181/j%c3%balio-c%c3%a9sar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 38780263, "answer_count": 2, "score": 0, "last_activity_date": 1470365436, "creation_date": 1470362909, "question_id": 38780051, "link": "https://stackoverflow.com/questions/38780051/error-trying-to-print-list-in-haskell", "title": "Error trying to &quot;print&quot; list in Haskell", "body": "<p>I have the following problem: given a max(max) apacity, and given a list of values(listOfValues) i need to return a list with values from the listOfValues. The sum of the elements must be &lt;= max and i need to prioritize the higher values.</p>\n\n<p>Example: typing solvingProblem 103 [15, 20, 5, 45, 34] i must get: [45, 45, 5, 5]</p>\n\n<p>To solve the problem i create the following code:</p>\n\n<pre><code>solvingProblem max [] = 0\nsolvingProblem max listOfValues | max == 0 = 0\n                                | otherwise = createList max listOfValues []\n\n\ncreateList max [] result = -1\ncreateList max listOfValues result | smaller listOfValues &gt; max = -1\n                               | higher listOfValues &gt; max = createList max (remove (higher listOfValues) listOfValues) result\n                               | otherwise = createList (max - higher listOfValues) listOfValues (insert (higher listOfValues) result)\n\nhigher [a] = a\nhigher (a:b:x) | a &gt; b = higher (a:x)\n              | otherwise = higher (b:x)\n\nsmaller [a] = a\nsmaller (a:b:x) | a &lt; b = smaller (a:x)\n              | otherwise = smaller (b:x)\n\nremove x [] = []\nremove x (h:t) | x == h = remove x t\n                | otherwise = h : remove x t\n\ninsert x (h:t) = x : h : t\n</code></pre>\n\n<p>In the two lines where i'll returning \"-1\" should be the parameter \"result\", but if i change \"-1\" to \"result\" the code don't load on ghci.</p>\n\n<p>Can someone help me?</p>\n\n<p>Thank you and sorry for my bad english.</p>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1470349519, "post_id": 38778320, "comment_id": 64928044, "body": "I believe you are missing a <code>&lt;$&gt;</code>: <code>(+) &lt;$&gt; (+3) &lt;*&gt; (*100) $ 5</code>. It parses as <code>(((+) &lt;$&gt; (+3)) &lt;*&gt; (*100)) $ 5</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470349681, "post_id": 38778320, "comment_id": 64928097, "body": "@DanielWagner The <code>&lt;$&gt;</code>s got eaten by the markdown parser (but the <code>&lt;*&gt;</code>s didn\u2019t, for whatever reason). I\u2019ve added the necessary code escapes."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1470349805, "post_id": 38778320, "comment_id": 64928137, "body": "Ah i see thank you, i didn&#39;t know you had to escape the <code>&lt;$&gt;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 8, "last_activity_date": 1470350180, "creation_date": 1470350180, "answer_id": 38778460, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor/38778460#38778460", "title": "(r -&gt;) applicative functor", "body": "<p><code>&lt;$&gt;</code> is just another name for <code>fmap</code> and its definition for <code>(-&gt;) r</code> is <code>(.)</code> (the composition operator):</p>\n\n<pre><code>intance Functor ((-&gt;) r) where\n  fmap f g = f . g\n</code></pre>\n\n<p>You can basically work out the implementation for <code>&lt;*&gt;</code> just by looking at the types:</p>\n\n<pre><code>instance Applicative ((-&gt;) r) where\n  (&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n  f &lt;*&gt; g = \\x -&gt; f x (g x)\n</code></pre>\n\n<p>You have a function from <code>r</code> to <code>a</code> to <code>b</code> and a function from <code>r</code> to <code>a</code>. You want a funtion from <code>r</code> to <code>b</code> as a result. First thing you know is you return a function:</p>\n\n<pre><code>\\x -&gt;\n</code></pre>\n\n<p>Now you want to apply <code>f</code> since it is the only item which may return a <code>b</code>:</p>\n\n<pre><code>\\x -&gt; f _ _\n</code></pre>\n\n<p>Now the arguments for <code>f</code> are of type <code>r</code> and <code>a</code>. <code>r</code> is simply <code>x</code> (since it alrady is of type <code>r</code> and you can get an <code>a</code> by applying <code>g</code> to <code>x</code>:</p>\n\n<pre><code>\\x -&gt; f x (g x)\n</code></pre>\n\n<p>Aaand you're done. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-641\">Here's a link to the implementation in Haskell's Prelude</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1470350907, "post_id": 38778490, "comment_id": 64928425, "body": "Funny, how we have almost identical trains of thought. :D"}], "tags": [], "owner": {"reputation": 5331, "user_id": 3777428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sJ6pq.png?s=128&g=1", "display_name": "eigenchris", "link": "https://stackoverflow.com/users/3777428/eigenchris"}, "is_accepted": false, "score": 3, "last_activity_date": 1470350706, "last_edit_date": 1470350706, "creation_date": 1470350388, "answer_id": 38778490, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor/38778490#38778490", "title": "(r -&gt;) applicative functor", "body": "<p>Let's take a look at the types of these functions (and the definitions that we automatically get along with them):</p>\n\n<pre><code>(&lt;$&gt;) :: (a -&gt; b) -&gt; (r -&gt; a) -&gt; r -&gt; b\nf &lt;$&gt; g = \\x -&gt; f (g x)\n\n(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; r -&gt; b\nf &lt;*&gt; g = \\x -&gt; f x (g x)\n</code></pre>\n\n<p>In the first case, <code>&lt;$&gt;</code>, is really just function composition. A simpler definition would be <code>(&lt;$&gt;) = (.)</code>.</p>\n\n<p>The second case is a little more confusing. Our first input is a function <code>f :: r -&gt; a -&gt; b</code>, and we need to get an output of type <code>b</code>. We can provide <code>x :: r</code> as the first argument to <code>f</code>, but the only way we can get something of type <code>a</code> for the second argument is by applying <code>g :: r -&gt; a</code> to <code>x :: r</code>.</p>\n\n<hr>\n\n<p>As an interesting aside, <code>&lt;*&gt;</code> is really the <code>S</code> function from <a href=\"https://en.wikipedia.org/wiki/SKI_combinator_calculus\" rel=\"nofollow\">SKI combinatory calculus</a>, whereas <code>pure</code> for <code>(-&gt; r)</code> is the <code>K :: a -&gt; b -&gt; a</code> (constant) function.</p>\n"}, {"comments": [{"owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "edited": false, "score": 0, "creation_date": 1470367631, "post_id": 38778507, "comment_id": 64932367, "body": "When I tried to run <code>Maybe (+) &lt;*&gt; Maybe 1 &lt;*&gt; Maybe 2</code> in ghci (7.10.3 and 8.0.1), I got <code>Data constructor not in scope: Maybe ...</code>. Did I miss something?"}, {"owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "edited": false, "score": 0, "creation_date": 1470367672, "post_id": 38778507, "comment_id": 64932385, "body": "BTW, <code>Just (+) &lt;*&gt; Just 1 &lt;*&gt; Just 2</code> gives <code>Just 3</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "edited": false, "score": 0, "creation_date": 1470370741, "post_id": 38778507, "comment_id": 64933148, "body": "@LeeDuhem Oops, my bad, I don\u2019t know what I was thinking when I wrote that. Thanks for pointing that out!"}, {"owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "edited": false, "score": 0, "creation_date": 1470396625, "post_id": 38778507, "comment_id": 64946422, "body": "Thank you for this very helpful answer."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 6, "last_activity_date": 1470370720, "last_edit_date": 1470370720, "creation_date": 1470350570, "answer_id": 38778507, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor/38778507#38778507", "title": "(r -&gt;) applicative functor", "body": "<p>Consider the type signature of <code>&lt;*&gt;</code>:</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Compare this to the type signature for ordinary function application, <code>$</code>:</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>Notice that they are extremely similar! Indeed, the <code>&lt;*&gt;</code> operator effectively generalizes application so that it can be <em>overloaded</em> based on the types involved. This is easy to see when using the simplest <code>Applicative</code>, <code>Identity</code>:</p>\n\n<pre><code>ghci&gt; Identity (+) &lt;*&gt; Identity 1 &lt;*&gt; Identity 2\nIdentity 3\n</code></pre>\n\n<p>This can also be seen with slightly more complicated applicative functors, such as <code>Maybe</code>:</p>\n\n<pre><code>ghci&gt; Just (+) &lt;*&gt; Just 1 &lt;*&gt; Just 2\nJust 3\nghci&gt; Just (+) &lt;*&gt; Nothing &lt;*&gt; Just 2\nNothing\n</code></pre>\n\n<hr>\n\n<p>For <code>(-&gt;) r</code>, the <code>Applicative</code> instance performs a sort of function composition, which produces a new function that accepts a sort of \u201ccontext\u201d and threads it to all of the values to produce the function and its arguments:</p>\n\n<pre><code>ghci&gt; ((\\_ -&gt; (+)) &lt;*&gt; (+ 3) &lt;*&gt; (* 100)) 5\n508\n</code></pre>\n\n<p>In the above example, I have only used <code>&lt;*&gt;</code>, so I\u2019ve explicitly written out the first argument as ignoring its argument and always producing <code>(+)</code>. However, <code>Applicative</code> typeclass also includes the <code>pure</code> function, which has the same purpose of \u201clifting\u201d a pure value into an applicative functor:</p>\n\n<pre><code>ghci&gt; (pure (+) &lt;*&gt; (+ 3) &lt;*&gt; (* 100)) 5\n508\n</code></pre>\n\n<p>In practice, though, you will rarely see <code>pure x &lt;*&gt; y</code> because it is precisely equivalent to <code>x &lt;$&gt; y</code> by the <code>Applicative</code> laws, since <code>&lt;$&gt;</code> is just an infix synonym for <code>fmap</code>. Therefore, we have the common idiom:</p>\n\n<pre><code>ghci&gt; ((+) &lt;$&gt; (+ 3) &lt;*&gt; (* 100)) 5\n508\n</code></pre>\n\n<hr>\n\n<p>More generally, if you see any expression that looks like this:</p>\n\n<pre><code>f &lt;$&gt; a &lt;*&gt; b\n</code></pre>\n\n<p>\u2026you can read it more or less like the ordinary function application <code>f a b</code>, except in the context of a particular <code>Applicative</code> instance\u2019s idioms. In fact, an original formulation of <code>Applicative</code> proposed the idea of \u201cidiom brackets\u201d, which would add the following as syntactic sugar for the above expression:</p>\n\n<pre><code>(| f a b |)\n</code></pre>\n\n<p>However, Haskellers seem to be satisfied enough with the infix operators that the benefits of adding the additional syntax has not been deemed worth the cost, so <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> remain necessary.</p>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470351990, "post_id": 38778606, "comment_id": 64928700, "body": "It is not <code>\\x -&gt; f x g x</code>, it is <code>\\x -&gt; f x (g x)</code>"}], "tags": [], "owner": {"reputation": 2571, "user_id": 2716578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ofPGo.png?s=128&g=1", "display_name": "F&#225;bio Junqueira", "link": "https://stackoverflow.com/users/2716578/f%c3%a1bio-junqueira"}, "is_accepted": false, "score": 4, "last_activity_date": 1470352202, "last_edit_date": 1470352202, "creation_date": 1470351202, "answer_id": 38778606, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor/38778606#38778606", "title": "(r -&gt;) applicative functor", "body": "<p>As a Haskell newbie myself, i'll try to explain the best way i can</p>\n\n<p>The <code>&lt;$&gt;</code> operator is the same as mapping a function on to another function.</p>\n\n<p>When you do this:</p>\n\n<pre><code>(+) &lt;$&gt; (+3)\n</code></pre>\n\n<p>You are basically doing this:</p>\n\n<pre><code>fmap (+) (+3)\n</code></pre>\n\n<p>The above will call the Functor implementation of (->) r which is the following:</p>\n\n<pre><code>fmap f g = (\\x -&gt; f (g x))\n</code></pre>\n\n<p>So the result of <code>fmap (+) (+3)</code> is <code>(\\x -&gt; (+) (x + 3))</code></p>\n\n<p>Note that the result of this expression has a type of <code>a -&gt; (a -&gt; a)</code></p>\n\n<p>Which is an applicative! That is why you can pass the result of <code>(+) &lt;$&gt; (+3)</code> to the <code>&lt;*&gt;</code> operator!</p>\n\n<p>Why is it an applicative you might ask? Lets look the at the <code>&lt;*&gt;</code> definition:</p>\n\n<pre><code>f (a -&gt; b) -&gt; f a -&gt; f b \n</code></pre>\n\n<p>Notice that the first argument matches our returned function definition <code>a -&gt; (a -&gt; a)</code></p>\n\n<p>Now if we look at the <code>&lt;*&gt;</code> operator implementation, it looks like this:</p>\n\n<pre><code>f &lt;*&gt; g = (\\x -&gt; f x (g x))\n</code></pre>\n\n<p>So when we put all those pieces together, we get this:</p>\n\n<pre><code>(+) &lt;$&gt; (+3) &lt;*&gt; (+5)\n(\\x -&gt; (+) (x + 3)) &lt;*&gt; (+5)\n(\\y -&gt; (\\x -&gt; (+) (x + 3)) y (y + 5))\n(\\y -&gt; (+) (y + 3) (y + 5))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1470354967, "creation_date": 1470354967, "answer_id": 38779154, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor/38779154#38779154", "title": "(r -&gt;) applicative functor", "body": "<p>The <code>(-&gt;) e</code> <code>Functor</code> and <code>Applicative</code> instances tend to be a bit confusing. It may help to view <code>(-&gt;) e</code> as an \"undressed\" version of <code>Reader e</code>.</p>\n\n<pre><code>newtype Reader e a = Reader\n  { runReader :: e -&gt; a }\n</code></pre>\n\n<p>The name <code>e</code> is supposed to suggest the word \"environment\". The type <code>Reader e a</code> should be read as \"a computation that produces a value of type <code>a</code> given an environment of type <code>e</code>\".</p>\n\n<p>Given a computation of type <code>Reader e a</code>, you can modify its output:</p>\n\n<pre><code>instance Functor (Reader e) where\n  fmap f r = Reader $ \\e -&gt; f (runReader r e)\n</code></pre>\n\n<p>That is, first run the computation in the given environment, then apply the mapping function.</p>\n\n<pre><code>instance Applicative (Reader e) where\n  -- Produce a value without using the environment\n  pure a = Reader $ \\ _e -&gt; a\n\n  -- Produce a function and a value using the same environment;\n  -- apply the function to the value\n\n  rf &lt;*&gt; rx = Reader $ \\e -&gt; (runReader rf e) (runReader rx e)\n</code></pre>\n\n<p>You can use the usual <code>Applicative</code> reasoning for this as any other applicative functor.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 1, "accepted_answer_id": 38778460, "answer_count": 5, "score": 6, "last_activity_date": 1546706176, "creation_date": 1470349290, "last_edit_date": 1546706176, "question_id": 38778320, "link": "https://stackoverflow.com/questions/38778320/r-applicative-functor", "title": "(r -&gt;) applicative functor", "body": "<p>I am having some trouble understanding how the function instance <code>(-&gt;) r</code> of Applicative works in Haskell.</p>\n\n<p>For example if I have </p>\n\n<pre><code>(+) &lt;$&gt; (+3) &lt;*&gt; (*100) $ 5\n</code></pre>\n\n<p>I know you get the result 508, I sort of understand that you take the result of <code>(5 + 3)</code> and <code>(5 * 100)</code> and you apply the <code>(+)</code> function to both of these.</p>\n\n<p>However I do not quite understand what is going on. I assume that the expression is parenthesized as follows:</p>\n\n<pre><code>((+) &lt;$&gt; (+3)) &lt;*&gt; (*100)\n</code></pre>\n\n<p>From my understanding what is happening is that your mapping <code>(+)</code> over the eventual result of <code>(+3)</code> and then you are using the <code>&lt;*&gt;</code> operator to apply that function to the eventual result of <code>(*100)</code></p>\n\n<p>However I do not understand the implementation of <code>&lt;*&gt;</code> for the <code>(-&gt;) r</code> instance and why I cannot write:</p>\n\n<pre><code>(+3) &lt;*&gt; (*100)\n</code></pre>\n\n<p>How does the <code>&lt;*&gt;</code>, <code>&lt;$&gt;</code> operator work when it comes to <code>(-&gt;) r</code>?</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470421524, "post_id": 38777808, "comment_id": 64961546, "body": "Can you show us a full example in one file?  It seems like you are expecting the variables to be global or some such."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472112813, "post_id": 38778003, "comment_id": 65624333, "body": "Yes, that makes a lot of sense to me. Thanks for your explanation! Another question here is in the main module, the way I call <code>routes</code> is <code>(map (\\ (a, b) -&gt; dir a b) $ routes)</code> ,which maps the function <code>dir</code> to each tuple in <code>routes</code>. And <code>dir</code> takes in two elements in the tuple both as variables. How can I combine this with calling <code>routes</code> in main with variables that I&#39;ve bind?"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472170239, "post_id": 38778003, "comment_id": 65656608, "body": "If I understand your question correctly, you can simply apply <code>routes</code> to its arguments, so you can just write <code>map (\\(a,b) -&gt; dir a b) $ routes redirectUrlGraphEmail redirectUrlGraphPost\u2026</code>. Note that in your original formulation, you didn&#39;t need the <code>$</code>, writing <code>map (\\(a,b) -&gt; dir a b) routes</code> would have been fine ;)"}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472206017, "post_id": 38778003, "comment_id": 65670159, "body": "I see! Then do I need to add those variables in my routes function?          like                                                                                                           <code>routes :: [ (String, ServerPart Response)] routes staticDir redirectUrlGraphEmail redirectUrlGraphPost aboutContents privacyContents = [ (&quot;graph-fb&quot;, seeOther redirectUrlGraphEmail $ toResponse &quot;&quot;), (&quot;post-fb&quot;, seeOther redirectUrlGraphPost $ toResponse &quot;&quot;),                (&quot;about&quot;, aboutResponse aboutContents), (&quot;static&quot;, serveDirectory DisableBrowsing [] staticDir)]</code>"}], "tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": false, "score": 4, "last_activity_date": 1470347557, "creation_date": 1470347557, "answer_id": 38778003, "question_id": 38777808, "link": "https://stackoverflow.com/questions/38777808/how-to-define-a-variable-contained-in-a-tuple/38778003#38778003", "title": "How to define a variable contained in a tuple?", "body": "<p>I don't know happstack but it seems that your variables <code>redirectUrlGraphEmail</code> etc. are defined in your main (or in some monad at least), right? And then you want to define <code>route</code> as a separate function in your module.</p>\n\n<p>The thing is, the variables you define (that you bind with <code>&lt;-</code> to be precise) in your <code>main</code> are local to your <code>main</code>, so the rest of your program doesn't have access to them (which is why the compiler tells you they're not in scope when you try to use them in <code>routes</code>). If you want to make use of them, you need to define <code>routes</code> as a function taking them as parameters, so in your case:</p>\n\n<pre><code>routes redirectUrlGraphEmail redirectUrlGraphPost = [\n (\"graph-fb\", seeOther redirectUrlGraphEmail $ toResponse \"\"),\n (\"post-fb\", seeOther redirectUrlGraphPost $ toResponse \"\"),               \n (\"about\", aboutResponse aboutContents),\n (\"static\", serveDirectory DisableBrowsing [] staticDir)]\n</code></pre>\n\n<p>And then from your <code>main</code> call <code>routes</code> with the variables you've bind. Am I making sense?</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1470347727, "creation_date": 1470346691, "last_edit_date": 1470347727, "question_id": 38777808, "link": "https://stackoverflow.com/questions/38777808/how-to-define-a-variable-contained-in-a-tuple", "title": "How to define a variable contained in a tuple?", "body": "<p>Every time I tried to run this code, the compiler returns a 'not in scope' error for the variables <code>redirectUrlGraphEmail</code>, <code>redirectUrlGraphPost</code>, <code>aboutContents</code>, and <code>staticDir</code>:</p>\n\n<pre><code>routes :: [ (String, ServerPart Response)]\nroutes = [\n(\"graph-fb\", seeOther redirectUrlGraphEmail $ toResponse \"\"),\n(\"post-fb\", seeOther redirectUrlGraphPost $ toResponse \"\"),               \n(\"about\", aboutResponse aboutContents),\n(\"static\", serveDirectory DisableBrowsing [] staticDir)]\n</code></pre>\n\n<p>These variables are declared by:</p>\n\n<pre><code>staticDir &lt;- getStaticDir\nredirectUrlGraphEmail &lt;- retrieveAuthURL testUrl\nredirectUrlGraphPost &lt;- retrieveAuthURL testPostUrl\naboutContents &lt;- LazyIO.readFile $ markdownPath ++ \"README.md\"\nprivacyContents &lt;- LazyIO.readFile $ markdownPath ++ \"PRIVACY.md\"\n</code></pre>\n\n<p>but I am not sure where should I add these lines into the module. Any help here?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1470344066, "post_id": 38777046, "comment_id": 64925890, "body": "Can you give a sample input (even if drastically reduced)?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1470344330, "post_id": 38777046, "comment_id": 64925982, "body": "<code>length . filter</code> can be trivially shortened to a fold."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470344476, "post_id": 38777046, "comment_id": 64926052, "body": "What is the purpose of the <code>str</code> parameter to <code>matching</code>? It seems that <code>n</code> should equal <code>length refCol</code> or something like that."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470344788, "post_id": 38777046, "comment_id": 64926195, "body": "@pdexter: sample input added."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470344924, "post_id": 38777046, "comment_id": 64926273, "body": "@ErikR: There&#39;s the str which was passed in, which is transformed under the BW transform, and a reference column, which is the sorted version.  <code>zip str refCol</code> gives the two-character strings in the original input, and this algorithm keeps going back and forth between them in matching a pattern (potentially one with mutations)."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1470344985, "post_id": 38777046, "comment_id": 64926299, "body": "@ThreeFx: Thanks!  That was my next question, whether <code>length . filter ...</code> automatically folded things down upon execution, or whether it would traverse the list twice."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470345060, "post_id": 38777046, "comment_id": 64926337, "body": "I ask because except for <code>n = length str</code> the parameter <code>str</code> is never referenced in <code>matching</code>. So it seems we could also define <code>n = length refCol</code>, right?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470345116, "post_id": 38777046, "comment_id": 64926366, "body": "It shouldn&#39;t traverse twice with optimizations. However running your sample returns 0 for me."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470345347, "post_id": 38777046, "comment_id": 64926480, "body": "@ErikR , @pdexter: Oops, meant to call count using <code>str</code> instead of <code>refCol</code>.  Only <code>refFirstOcc</code> should use <code>refCol</code>.  That should fix both."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470346156, "post_id": 38777046, "comment_id": 64926830, "body": "Tried the <code>fold</code> method too.  Same problem - jumps to 20 seconds."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470346743, "post_id": 38777046, "comment_id": 64927043, "body": "You are compiling with optimizations, right?"}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470346996, "post_id": 38777046, "comment_id": 64927160, "body": "@Thomas: Yes, <code>ghc -O</code> (<code>-rtsopts -prof -fprof-auto</code>) to compile"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470355563, "post_id": 38777046, "comment_id": 64929621, "body": "So it seems that <code>refCol</code> is just a sorted version of <code>str</code>, right?"}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470355794, "post_id": 38777046, "comment_id": 64929675, "body": "@ErikR: Yes.  It&#39;s part of the calculation too, but that I seem to have relatively efficient."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470357213, "post_id": 38777046, "comment_id": 64930036, "body": "If you compute the counts of each letter you&#39;ll know the structure of the refCol string and you won&#39;t need to actually construct it. See the <code>matching</code>&#39; function in  <a href=\"http://lpaste.net/174292#line128\" rel=\"nofollow noreferrer\">lpaste.net/174292#line128</a>  for a version which only uses <code>str</code>."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470357657, "post_id": 38777046, "comment_id": 64930148, "body": "@ErikR: Yeah, that&#39;s pretty much how I have it right now."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470366019, "post_id": 38777046, "comment_id": 64932038, "body": "@nomicflux That&#39;s no way to compile if you&#39;re looking at performance numbers.  <code>-O2</code> gets you good benefits much of the time with tight code.  And <code>-prof</code> destroys most optimizations."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470366305, "post_id": 38777046, "comment_id": 64932105, "body": "@Thomas: yes, but I&#39;m trying to figure out what to change to get better numbers, and <code>prof</code> is how I&#39;m doing that.  And while I do plan on using <code>O2</code>, I&#39;m also trying to understand the algorithmic issues here rather than just shunting it all off to the compiler."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470372176, "post_id": 38777046, "comment_id": 64933516, "body": "@nomicflux But prof reports are misleading - it doesn&#39;t give you a very useful picture, or even gives you a down right misleading picture, as to the costs.  These costs can be vastly different after inlining, deforestation and all the other optimizations which are often prevented in order to preserve the cost centers needed by prof.  More-over, the actual run time changes drastically and in inconsistent ways so you can not believably argue one algorithm is faster than another."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470407274, "post_id": 38777046, "comment_id": 64953498, "body": "@Thomas: &quot;you can not believably argue one algorithm is faster than another&quot;.  I suspect that the entire field of algorithmic analysis would disagree.  But regardless, in this question, I am looking for <i>why</i> doing the repeated work costs less time than trying to do the work more efficiently, and (since the one algorithm is clearly and regularly slower than the other, <code>-prof</code> or not, <code>-O</code> or <code>-O2</code>) what I could do to code it more efficiently.  That is the point of the question.  I want understanding; the immediate performance of this chunk of code by any means possible is less important."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470408247, "post_id": 38777046, "comment_id": 64954156, "body": "@Thomas (cont) Also, thanks to @ErikR &#39;s efforts below, I was able to get this down to under a second for a million character string, using 5000 patterns of size up to 1000 (and that&#39;s under a second even using <code>-O -prof</code>.  So there <b>are</b> algorithmic strategies for dealing with this.  I&#39;m still looking for an answer as to what exactly is going on in the code to make it this wonky, but there are more things to try (and things far more helpful) than a new compiler flag."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470409463, "post_id": 38777046, "comment_id": 64955075, "body": "@nomicflux I don&#39;t get it.  Are you chewing me out for related comments?  I usually try to communicate two facts on performance threads, facts that matter tremendously in some cases (and not in others).  The one you seem to dislike is that using prof can change performance including the actual complexity of the resulting code (depending on GC specifics).  I&#39;m glad you found suitable answers, hopefully you&#39;ll accept them."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470410448, "post_id": 38777046, "comment_id": 64955683, "body": "@Thomas: In my first comment, I was willing to simply say, &quot;I&#39;m trying to understand the algorithmic issues here.&quot;  The point was not, how do I get this faster (using C would also work, but is not relevant), it was, what&#39;s going on code-wise which makes this slow?  So I understand the misunderstanding, it just wasn&#39;t what I was looking for.  Thanks for your time.   But you then went on to ignore that, and moreover argue with me that I can&#39;t actually do algorithmic analysis here.  So forgive the forthrightness, but I didn&#39;t feel like I was getting my point across in a subtler fashion."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470355006, "post_id": 38778554, "comment_id": 64929510, "body": "Code updated - I&#39;m pretty sure it is compatible with your algorithm. Try <code>test2</code> and <code>test3</code>. Also available at <a href=\"http://lpaste.net/174288\" rel=\"nofollow noreferrer\">lpaste.net/174288</a>"}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470356112, "post_id": 38778554, "comment_id": 64929741, "body": "Taking back my previous comment - evidently there was something wrong in my Array implementation.  Using an Array and <code>unfoldr</code> in a similar fashion to the above solves the time problem nicely.  Though now I have a memory problem, so still trying to figure out how to do this in place...."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470356856, "post_id": 38778554, "comment_id": 64929949, "body": "A lot depends on how you construct the Array. The Vector code above can compute the counts for an input of length 1 million in about 1/10 of a second."}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470443558, "post_id": 38778554, "comment_id": 64968964, "body": "Looking through this, is there a particular benefit to putting <code>narrow</code> as its own function separate from the recursion and putting it into a <code>foldl&#39;</code>?  Or is that more of a stylistic choice?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470445768, "post_id": 38778554, "comment_id": 64969331, "body": "It makes it easier to test - it is, after all, the crucial piece of logic in that loop. It also makes it more obvious that we are computing successive intervals."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470446035, "post_id": 38778554, "comment_id": 64969383, "body": "btw - if you make <code>narrow</code> return a Maybe you can use <code>foldM</code> to stop iterating once the empty interval (i.e. Nothing) has been returned by narrow. See a simplified example here: <a href=\"http://lpaste.net/174534\" rel=\"nofollow noreferrer\">lpaste.net/174534</a>"}, {"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470499203, "post_id": 38778554, "comment_id": 64980780, "body": "Great. That&#39;s helpful.  I think I&#39;m going to take some time to study what you did with this code - thanks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470354953, "last_edit_date": 1470354953, "creation_date": 1470350810, "answer_id": 38778554, "question_id": 38777046, "link": "https://stackoverflow.com/questions/38777046/haskell-optimizations-for-list-processing-stymied-by-lazy-evaluation/38778554#38778554", "title": "Haskell Optimizations for List Processing stymied by Lazy Evaluation", "body": "<p>It seems that the main point of the <code>match</code> routine is\nto transform a interval <code>(bottom,top)</code> to another interval\nbased on the current symbol <code>sym</code>. The formulas are\nbasically:</p>\n\n<pre><code>ref_fst = index of sym in ref_col\n  -- defined in an outer scope\n\nmatch :: Char -&gt; (Int,Int) -&gt; (Int,Int)\nmatch sym (bottom, top) | bottom &gt; top =  (bottom, top) -- if the empty interval\nmatch sym (bottom, top) =\n  let \n    top_count = count of sym in str from index 0 to top\n    bot_count = count of sym in str from index 0 to bottom\n    mid_count = top_count - bot_count\n  in if mid_count &gt; 0\n         then (ref_fst + bot_count, ref_fst + top_count)\n         else (1,0)  -- the empty interval\n</code></pre>\n\n<p>And then <code>matching</code> is just a fold over <code>pattern</code> using <code>match</code>\nwith the initial interval <code>(0, n-1)</code>.</p>\n\n<p>Both <code>top_count</code> and <code>bot_count</code> can be computed efficiently\nusing a precomputed lookup table, and below is code which\ndoes that.</p>\n\n<p>If you run <code>test1</code> you'll see a trace of how the interval\nis transformed via each symbol in the pattern.</p>\n\n<p>Note: There may be off-by-1 errors, and I've hard coded\n<code>ref_fst</code> to be 0 - I'm not sure how this fits into the\nlarger algorithm, but the basic idea should be sound.</p>\n\n<p>Note that once the <code>counts</code> vector has been created\nthere is no need to index into the original string anymore.\nTherefore, even though I use a ByteString here for\nthe (larger) DNA sequence, it's not crucial, and the\n<code>mkCounts</code> routine should work just as well if passed a String\ninstead.</p>\n\n<p>Code also available at <a href=\"http://lpaste.net/174288\" rel=\"nofollow\">http://lpaste.net/174288</a></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Vector.Unboxed ((!))\nimport qualified Data.Vector.Unboxed as UV\nimport qualified Data.Vector.Unboxed.Mutable as UVM\nimport qualified Data.ByteString.Char8 as BS\nimport Debug.Trace\nimport Text.Printf\nimport Data.List\n\nmkCounts :: BS.ByteString -&gt; UV.Vector (Int,Int,Int,Int)\nmkCounts syms = UV.create $ do\n  let n = BS.length syms\n  v &lt;- UVM.new (n+1)\n  let loop x i | i &gt;= n = return x\n      loop x i = let s = BS.index syms i\n                     (a,t,c,g) = x\n                     x' = case s of\n                            'A' -&gt; (a+1,t,c,g)\n                            'T' -&gt; (a,t+1,c,g)\n                            'C' -&gt; (a,t,c+1,g)\n                            'G' -&gt; (a,t,c,g+1)\n                            _   -&gt; x\n                 in do UVM.write v i x\n                       loop x' (i+1) \n  x &lt;- loop (0,0,0,0) 0\n  UVM.write v n x\n  return v\n\ndata DNA = A | C | T | G\n  deriving (Show)\n\ngetter :: DNA -&gt; (Int,Int,Int,Int) -&gt; Int\ngetter A (a,_,_,_) = a\ngetter T (_,t,_,_) = t\ngetter C (_,_,c,_) = c\ngetter G (_,_,_,g) = g\n\n-- narrow a window\nnarrow :: Int -&gt; UV.Vector (Int,Int,Int,Int) -&gt; DNA -&gt; (Int,Int) -&gt;  (Int,Int)\n\nnarrow refcol counts sym (lo,hi) | trace msg False = undefined\n  where msg = printf \"-- lo: %d  hi: %d  refcol: %d  sym: %s  top_cnt: %d  bot_count: %d\" lo hi refcol (show sym) top_count bot_count\n        top_count = getter sym (counts ! (hi+1))\n        bot_count = getter sym (counts ! lo)\n\nnarrow refcol counts sym (lo,hi) =\n  let top_count = getter sym (counts ! (hi+1))\n      bot_count = getter sym (counts ! (lo+0))\n      mid_count = top_count - bot_count\n  in if mid_count &gt; 0\n       then ( refcol + bot_count, refcol + top_count-1 )\n       else (lo+1,lo)  -- signal an wmpty window\n\nfindFirst :: DNA -&gt; UV.Vector (Int,Int,Int,Int)  -&gt; Int\nfindFirst sym v =\n  let n = UV.length v\n      loop i | i &gt;= n = n\n      loop i = if getter sym (v ! i) &gt; 0\n                 then i\n                 else loop (i+1)\n  in loop 0\n\ntoDNA :: String -&gt; [DNA]\ntoDNA str = map charToDNA str\n\ncharToDNA :: Char -&gt; DNA\ncharToDNA = go\n  where go 'A' = A\n        go 'C' = C\n        go 'T' = T\n        go 'G' = G\n\ndnaToChar A = 'A'\ndnaToChar C = 'C'\ndnaToChar T = 'T'\ndnaToChar G = 'G'\n\nfirst :: DNA -&gt; BS.ByteString -&gt; Int\nfirst sym str = maybe len id (BS.elemIndex (dnaToChar sym) str)\n  where len = BS.length str\n\ntest2 = do\n -- matching \"AT$TCTAGT\" \"$AACGTTTT\" \"TCG\"\n  let str    = \"AT$TCTAGT\"\n      refcol = \"$AACGTTTT\"\n      syms   = toDNA \"TCG\"\n\n      -- hard coded for now\n      -- may be computeed an memoized\n      refcol_G = 4\n      refcol_C = 3\n      refcol_T = 5\n\n      counts = mkCounts str\n      w0 = (0, BS.length str -1)\n\n      w1 = narrow refcol_G counts G w0\n      w2 = narrow refcol_C counts C w1\n      w3 = narrow refcol_T counts T w2\n\n      firsts = (first A refcol, first T refcol, first C refcol, first G refcol)\n\n  putStrLn $ \"firsts: \" ++ show firsts\n\n  putStrLn $ \"w0: \" ++ show w0\n  putStrLn $ \"w1: \" ++ show w1\n  putStrLn $ \"w2: \" ++ show w2\n  putStrLn $ \"w3: \" ++ show w3\n  let (lo,hi) = w3\n      len = if lo &lt;= hi then hi - lo + 1 else 0\n  putStrLn $ \"length: \" ++ show len\n\nmatching :: BS.ByteString -&gt; BS.ByteString -&gt; String -&gt; Int\nmatching  str refcol pattern = \n  let counts = mkCounts str\n      n = BS.length str\n      syms = toDNA (reverse pattern)\n      firsts = (first A refcol, first T refcol, first C refcol, first G refcol)\n\n      go (lo,hi) sym = narrow refcol counts sym (lo,hi)\n        where refcol = getter sym firsts\n\n      (lo, hi) = foldl' go (0,n-1) syms\n      len = if lo &lt;= hi then hi - lo + 1 else 0\n  in len\n\ntest3 = matching \"AT$TCTAGT\" \"$AACGTTTT\" \"TCG\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "edited": false, "score": 0, "creation_date": 1470443466, "post_id": 38799384, "comment_id": 64968950, "body": "Perfect - that was exactly what I was looking for.  Thanks a bunch!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1470442997, "creation_date": 1470442997, "answer_id": 38799384, "question_id": 38777046, "link": "https://stackoverflow.com/questions/38777046/haskell-optimizations-for-list-processing-stymied-by-lazy-evaluation/38799384#38799384", "title": "Haskell Optimizations for List Processing stymied by Lazy Evaluation", "body": "<p>I'm not sure lazy evaluation has much to do with the performance of the code. I think the main problem is the use of String - which is a linked list - instead of more performant string type.</p>\n\n<p>Note that this call in your <code>countBetween</code> function:</p>\n\n<pre><code>  let (topList, bottomList) = splitAt top list\n</code></pre>\n\n<p>will re-create the linked link corresponding to <code>topList</code> meaning\na lot more allocations.</p>\n\n<p>A Criterion benchmark to compare <code>splitAt</code> versus using <code>take n/drop n</code>\nmay be found here: <a href=\"http://lpaste.net/174526\" rel=\"nofollow\">http://lpaste.net/174526</a>. The <code>splitAt</code> version is\nabout 3 times slower and, of course, has a lot more allocations.</p>\n\n<p>Even if you don't want to \"pre-compute\" the counts you can improve\nmatters a great deal by simply switching to either ByteString or Text.</p>\n\n<p>Define:</p>\n\n<pre><code>countSyms :: Char -&gt; ByteString -&gt; Int -&gt; Int -&gt; Int\ncountSyms sym str lo hi =\n  length [ i | i &lt;- [lo..hi], BS.index str i == sym ]\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>countBetween :: ByteString -&gt; Char -&gt; Int -&gt; Int -&gt; (Int,Int)\ncountBetween str sym top bottom = (a,b)\n  where a = countSyms sym str 0 (top-1)\n        b = countSyms sym str top (bottom-1)\n</code></pre>\n\n<p>Also, don't use <code>reverse</code> on large lists - it will reallocate the\nentire list. Just index into a ByteString / Text in reverse.</p>\n\n<p>Memoizing counts may or may not help. It all depends on how it's done.</p>\n"}], "owner": {"reputation": 45, "user_id": 6679828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d5a315ca7ebf82be88367ef7ad1094?s=128&d=identicon&r=PG&f=1", "display_name": "nomicflux", "link": "https://stackoverflow.com/users/6679828/nomicflux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 38799384, "answer_count": 2, "score": 3, "last_activity_date": 1470442997, "creation_date": 1470343218, "last_edit_date": 1470412071, "question_id": 38777046, "link": "https://stackoverflow.com/questions/38777046/haskell-optimizations-for-list-processing-stymied-by-lazy-evaluation", "title": "Haskell Optimizations for List Processing stymied by Lazy Evaluation", "body": "<p>I'm trying to improve the efficiency of the following code.  I want to count all occurrences of a symbol before a given point (as part of pattern-matching using a Burrows-Wheeler transform).  There's some overlap in how I'm counting symbols.  However, when I have tried to implement what looks like it should be more efficient code, it turns out to be less efficient, and I'm assuming that lazy evaluation and my poor understanding of it is to blame.</p>\n\n<p>My first attempt at a counting function went like this:</p>\n\n<pre><code>count :: Ord a =&gt; [a] -&gt; a -&gt; Int -&gt; Int\ncount list sym pos = length . filter (== sym) . take pos $ list\n</code></pre>\n\n<p>Then in the body of the matching function itself:</p>\n\n<pre><code>matching str refCol pattern = match 0 (n - 1) (reverse pattern)\n  where n = length str\n        refFstOcc sym = length $ takeWhile (/= sym) refCol\n        match top bottom [] = bottom - top + 1\n        match top bottom (sym : syms) =\n          let topCt = count str sym top\n              bottomCt = count str sym (bottom + 1)\n              middleCt = bottomCt - topCt\n              refCt = refFstOcc sym\n          in if middleCt &gt; 0\n               then match (refCt + topCt) (refCt + bottomCt - 1) syms\n               else 0\n</code></pre>\n\n<p>(Stripped down for brevity - I'm memoizing first occurrences of symbols in refCol through a Map, and a couple other details as well).  </p>\n\n<p><strong>Edit</strong>: Sample use would be: </p>\n\n<pre><code>matching \"AT$TCTAGT\" \"$AACGTTTT\" \"TCG\"\n</code></pre>\n\n<p>which should be 1 (assuming I didn't mistype anything).</p>\n\n<p>Now, I'm recounting everything in the middle between the <code>top</code> pointer and the <code>bottom</code> twice, which adds up when I count a million character DNA string with only 4 possible choices for characters (and profiling tells me that this is the big bottleneck, too, taking 48% of my time for bottomCt and around 38% of my time for topCt).  For reference, when calculating this for a million character string and trying to match 50 patterns (each of which is between 1 and 1000 characters), the program takes about 8.5 to 9.5 seconds to run.</p>\n\n<p>However, if I try to implement the following function:</p>\n\n<pre><code>countBetween :: Ord a =&gt; [a] -&gt; a -&gt; Int -&gt; Int -&gt; (Int, Int)\ncountBetween list sym top bottom =\n  let (topList, bottomList) = splitAt top list\n      midList = take (bottom - top) bottomList\n      getSyms = length . filter (== sym)\n  in (getSyms topList, getSyms midList)\n</code></pre>\n\n<p>(with changes made to the matching function to compensate), the program takes between 18 and 22 seconds to run.</p>\n\n<p>I've also tried passing in a Map which can keep track of previous calls, but that also takes about 20 seconds to run and runs up the memory usage.</p>\n\n<p>Similarly, I've shorted <code>length . filter (== sym)</code> to a <code>fold</code>, but again - 20 seconds for <code>foldr</code>, and 14-15 for <code>foldl</code>.</p>\n\n<p>So what would be a proper Haskell way to optimize this code through rewriting it?  (Specifically, I'm looking for something that doesn't involve precomputation - I may not be reusing strings very much - and which explains something of why this is happening).</p>\n\n<p><strong>Edit</strong>: More clearly, what I am looking for is the following:</p>\n\n<p>a) Why does this behaviour happen in Haskell?  How does lazy evaluation play a role, what optimizations is the compiler making to rewrite the <code>count</code> and <code>countBetween</code> functions, and what other factors may be involved?</p>\n\n<p>b) What is a simple code rewrite which would address this issue so that I don't traverse the lists multiple times?  I'm looking specifically for something which addresses that issue, rather than a solution which sidesteps it.  If the final answer is, <code>count</code> is the most efficient possible way to write the code, why is that?</p>\n"}, {"tags": ["haskell", "io", "handle"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470340250, "post_id": 38776023, "comment_id": 64923892, "body": "<code>interact</code> puts stdin into a semi-closed state. I assume your function worked correctly the first time, and every other invocation after that failed? Either close and reopen GHCi or compile your program and execute it."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470340619, "post_id": 38776023, "comment_id": 64924113, "body": "Exactly, every read of <code>stdin</code> failed afterwards."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1470341097, "post_id": 38776023, "comment_id": 64924361, "body": "As a side note, is it possible to reopen closed handle to stdin in other way but closing and reopening ghci?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1470341276, "post_id": 38776023, "comment_id": 64924454, "body": "As @RowanBlush indicated, the <code>stdin</code> handle is put in a semi closed state by <code>interact</code> or any function which reads the entirety of stdin. Remember, your GHCI session is basically one big do block - and writing <code>main = getContents &gt;&gt; getContents</code> is equally as invalid. If you want to read <code>n</code> lines, just use <code>replicateM n getLine{readLn&#47;whatever}</code> - using a function which reads all of stdin will always close stdin afterwards. You cannot &quot;reopen&quot; <code>stdin</code> - it is just a unix file descriptor under the hood."}], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 8, "last_activity_date": 1470341385, "creation_date": 1470341385, "answer_id": 38776581, "question_id": 38776023, "link": "https://stackoverflow.com/questions/38776023/handle-is-semi-closed-error-in-haskell/38776581#38776581", "title": "Handle is semi-closed error in Haskell?", "body": "<p>What you're trying to do isn't possible with <code>interact</code>. Behind the scenes <code>interact</code> claims the entirety of <code>stdin</code> for itself with <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO.html#v:hGetContents\"><code>hGetContents</code></a>. This puts the handle into a &ldquo;semi-closed&rdquo; state, preventing you from attempting any further interaction with the handle besides closing it, as the entirety of its input has already been consumed (lazily).</p>\n\n<p>Try reading a finite number of lines with&mdash;</p>\n\n<pre><code>import Control.Monad (replicateM)\n\ngetLines :: Int -&gt; IO [String]\ngetLines n = replicateM n getLine\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1470341418, "creation_date": 1470341418, "answer_id": 38776589, "question_id": 38776023, "link": "https://stackoverflow.com/questions/38776023/handle-is-semi-closed-error-in-haskell/38776589#38776589", "title": "Handle is semi-closed error in Haskell?", "body": "<p>Conceptually <code>interact</code> consumes <em>all</em> of standard input. So it doesn't make any sense to call <code>readLn</code> afterwards.</p>\n\n<p>To only read a given number of lines, use something like:</p>\n\n<pre><code>import Control.Monad\n\nmain = do input &lt;- replicateM 10 getLine\n          ...\n</code></pre>\n\n<p>Here <code>input</code> will be a list of (exactly) 10 Strings.</p>\n\n<p>Things get more complicated if you want to allow for fewer lines or if you want to stop reading when you encounter a special condition.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 0, "accepted_answer_id": 38776581, "answer_count": 2, "score": 4, "last_activity_date": 1470341418, "creation_date": 1470339571, "last_edit_date": 1470340696, "question_id": 38776023, "link": "https://stackoverflow.com/questions/38776023/handle-is-semi-closed-error-in-haskell", "title": "Handle is semi-closed error in Haskell?", "body": "<p>I am getting this error in GHCI : </p>\n\n<p><code>*** Exception: &lt;stdin&gt;: hGetLine: illegal operation (handle is semi-closed)</code></p>\n\n<p>After running this code :</p>\n\n<pre><code>main = do\n    interact $ unlines . fmap proccess . take x . lines\n    readLn :: IO Int\n</code></pre>\n\n<p>And I am pretty sure the cause is <code>take x</code>. Is there any better way to read <strong>only</strong> x lines of input using interact <strong>or</strong> is <code>interact</code> just a solo player?</p>\n"}, {"tags": ["haskell", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470330090, "post_id": 38773278, "comment_id": 64918212, "body": "In <code>binary</code> this function is packaged as <code>isolate</code>.  Perhaps it is more sensible there since <code>binary</code> tracks the number of bytes consumed, but it strikes me as a good addition to the attoparsec API (in terms of tokens, not bytes, so Text would not be counting bytes for example)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1470331936, "last_edit_date": 1470331936, "creation_date": 1470329768, "answer_id": 38773278, "question_id": 38773151, "link": "https://stackoverflow.com/questions/38773151/transform-an-attoparsec-parser-into-a-parser-which-fails-if-the-number-of-bytes/38773278#38773278", "title": "Transform an attoparsec parser into a parser which fails if the number of bytes it consumes is not of a certain length", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/attoparsec-0.13.0.2/docs/Data-Attoparsec-ByteString.html#v:match\" rel=\"nofollow\">match</a> to implement it:</p>\n\n<pre><code>f n x = do\n    (bs, res) &lt;- match x\n    guard (BS.length bs &gt;= n)\n    return res\n</code></pre>\n\n<p>You should check that this interacts with <code>(&lt;|&gt;)</code> in an acceptable way before putting it to heavy use.</p>\n"}], "owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 38773278, "answer_count": 1, "score": 1, "last_activity_date": 1470331936, "creation_date": 1470329330, "question_id": 38773151, "link": "https://stackoverflow.com/questions/38773151/transform-an-attoparsec-parser-into-a-parser-which-fails-if-the-number-of-bytes", "title": "Transform an attoparsec parser into a parser which fails if the number of bytes it consumes is not of a certain length", "body": "<p>Say I have an attoparsec parser, <code>x</code>.</p>\n\n<p>I am looking to create a function <code>f :: Int -&gt; Parser a -&gt; Parser a</code>, such that if <code>y = f n x</code>, then:</p>\n\n<ul>\n<li><code>y</code> fails if <code>x</code> fails</li>\n<li><code>y</code> fails if <code>x</code> succeeds and <code>x</code> does not consume <code>n</code> bytes</li>\n<li><code>y</code> succeeds otherwise</li>\n</ul>\n\n<p>How would I go about doing this?</p>\n"}, {"tags": ["sockets", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1470384002, "post_id": 38771619, "comment_id": 64938707, "body": "I don&#39;t like dealing with IO here, but I guess it&#39;s the only way. Thanks!"}, {"owner": {"reputation": 113, "user_id": 2087644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/727d67b9f4a4ba23a04cefca7667c320?s=128&d=identicon&r=PG", "display_name": "Lars Petersen", "link": "https://stackoverflow.com/users/2087644/lars-petersen"}, "edited": false, "score": 1, "creation_date": 1471271245, "post_id": 38771619, "comment_id": 65268049, "body": "I just added the pure functions <code>inetAddressFromTuple</code> and <code>inetAddressToTuple</code> to the library. You&#39;ll find the new version on Hackage."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1470324666, "creation_date": 1470324666, "answer_id": 38771619, "question_id": 38770829, "link": "https://stackoverflow.com/questions/38770829/system-socket-custom-inetaddress/38771619#38771619", "title": "System.Socket custom InetAddress", "body": "<p>Not ideal since it runs in the IO-monad, but you can use <code>getAddressInfo</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport System.Socket\nimport System.Socket.Family.Inet\nimport System.Socket.Type.Stream\nimport System.Socket.Protocol.TCP\n\ntest = do (addr:_) &lt;- getAddressInfo (Just \"192.168.10.1\") Nothing aiNumericHost  :: IO [AddressInfo Inet Stream TCP]\n          return $ inetAddress (socketAddress addr)\n</code></pre>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 38771619, "answer_count": 1, "score": 0, "last_activity_date": 1472809376, "creation_date": 1470322593, "last_edit_date": 1592644375, "question_id": 38770829, "link": "https://stackoverflow.com/questions/38770829/system-socket-custom-inetaddress", "title": "System.Socket custom InetAddress", "body": "<p>I found that <a href=\"https://hackage.haskell.org/package/socket-0.6.0.1/docs/System-Socket-Family-Inet.html\" rel=\"nofollow noreferrer\">System.Socket.Family.Inet</a> module doesn't export constructor of <a href=\"https://hackage.haskell.org/package/socket-0.6.0.1/docs/System-Socket-Family-Inet.html#t:InetAddress\" rel=\"nofollow noreferrer\">InetAddress</a>. It only exports functions which create a specific addresses. But there is no function which can create a custom one like, for example, <code>&quot;192.168.1.1&quot;</code>.</p>\n<p>How to create a custom <code>InetAddress</code>?</p>\n<hr />\n<h3>Note</h3>\n<p>There are pure functions to work with custom addresses in new <a href=\"https://hackage.haskell.org/package/socket-0.6.2.0\" rel=\"nofollow noreferrer\">version 0.6.2.0</a>:</p>\n<ul>\n<li><code>inetAddressFromTuple</code></li>\n<li><code>inetAddressToTuple</code>.</li>\n</ul>\n"}, {"tags": ["mongodb", "haskell", "graphviz", "dot"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 3, "last_activity_date": 1470317121, "creation_date": 1470317121, "answer_id": 38768643, "question_id": 38768490, "link": "https://stackoverflow.com/questions/38768490/couldnt-match-expected-type-control-monad-trans-reader-readert-mongocontext-io/38768643#38768643", "title": "Couldn&#39;t match expected type &#39;Control.Monad.Trans.Reader.ReaderT MongoContext IO a0&#39; with actual type &#39;IO ()&#39;", "body": "<p>You need <code>liftIO $</code> to the left of <code>Prelude.putStrLn</code>, but next time paste the complete error with line numbers and such. Your do block is in the <code>ReaderT MongoContext IO</code> monad, which contains <code>IO</code> so you can do <code>IO</code> actions in it but you have to lift them first.</p>\n"}], "owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 38768643, "answer_count": 1, "score": 1, "last_activity_date": 1470318337, "creation_date": 1470316726, "last_edit_date": 1470318337, "question_id": 38768490, "link": "https://stackoverflow.com/questions/38768490/couldnt-match-expected-type-control-monad-trans-reader-readert-mongocontext-io", "title": "Couldn&#39;t match expected type &#39;Control.Monad.Trans.Reader.ReaderT MongoContext IO a0&#39; with actual type &#39;IO ()&#39;", "body": "<p>I want to print my dot graph taken from mongoDB and then convert into an image.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>run = do\n\n    docs &lt;- timeFilter -- function to fetch [Document] from mongoDB\n    let dot = onlyDot docs -- exclude extra field from the documents\n    let dotObject = getObjId dot -- convert into an object\n    -- converting dot graph to string and then string to text to pass it on to parseDotGraph function\n    let xDotGraph = parseDotGraph (B.pack (show dotObject)) :: G.DotGraph String\n    Prelude.putStrLn $ B.unpack $ renderDot $ toDot xDotGraph -- this is not working, want to print\n    -- addExtension (runGraphviz xDotGraph) Png \"graph\" -- this is not working, want to draw as an image\n    printDocs dot\n</code></pre>\n"}, {"tags": ["haskell", "parsec", "non-greedy"], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1470324682, "post_id": 38769015, "comment_id": 64914629, "body": "Hm, my problem is that I have to use <code>makeC</code> which takes a list of tokens. <code>makeC . return &lt;$&gt; anyToken</code> would work, but it looks ugly and just as inefficient as my current solution."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1470328018, "post_id": 38769015, "comment_id": 64916958, "body": "@Bergi, Here&#39;s how to make space to apply <code>make</code>. Further this way lay the <code>lens</code> library."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1470337444, "post_id": 38769015, "comment_id": 64922254, "body": "@Bergi Why do you believe <code>makeC . return &lt;$&gt; anyToken</code> is inefficient? It certainly won&#39;t be as inefficient as doing arbitrary lookahead as in your question."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1470338295, "post_id": 38769015, "comment_id": 64922768, "body": "I dunno, I guess I&#39;d have to test. Performance is a bit unpredicable in Haskelll. It&#39;s just that the only function to convert tokens that is exposed by the library I am using takes this list of tokens, so I thought it should be called with a larger number of tokens. It&#39;s exact type is <code>[Token] -&gt; Data.Text</code> if that helps."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1470338395, "post_id": 38769015, "comment_id": 64922838, "body": "Thanks for the functor approach, I guess I can make that work."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 3, "last_activity_date": 1470327665, "last_edit_date": 1470327665, "creation_date": 1470318024, "answer_id": 38769015, "question_id": 38762263, "link": "https://stackoverflow.com/questions/38762263/non-greedy-repetition-with-parsec/38769015#38769015", "title": "non-greedy repetition with Parsec", "body": "<p>You could let parseC consume exactly one token at a time:</p>\n\n<p><code>parseDatas = many $ parseA &lt;|&gt; parseB &lt;|&gt; (C . show &lt;$&gt; anyToken)</code></p>\n\n<p>and then, if you want, group adjacent <code>C</code>s into one to conserve semantics:</p>\n\n<pre><code>groupCs (C c) (C c':xs) = C (c ++ c') : xs\ngroupCs x xs = x : xs\nparseDatas = foldr groupCs [] &lt;$&gt; many (parseA &lt;|&gt; parseB &lt;|&gt; (C . show &lt;$&gt; anyToken))\n</code></pre>\n\n<p>If you want to apply some operation <code>make :: [Token] -&gt; String</code> on consecutive <code>C</code>s:</p>\n\n<pre><code>data Data c = A Int | B Char | C c deriving Functor\n\ngroupCs :: [Data a] -&gt; [Data [a]] -&gt; [Data [a]]\ngroupCs (C c) (C cs:xs) = C (c:cs) : xs\ngroupCs (C c) xs = C [c] : xs\ngroupCs x xs = x : xs\n\nparseDatas = (map.fmap) make . foldr groupCs [] &lt;$&gt; many (parseA &lt;|&gt; parseB &lt;|&gt; (C &lt;$&gt; anyToken))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 1, "last_activity_date": 1567178603, "creation_date": 1567178603, "answer_id": 57729462, "question_id": 38762263, "link": "https://stackoverflow.com/questions/38762263/non-greedy-repetition-with-parsec/57729462#57729462", "title": "non-greedy repetition with Parsec", "body": "<p>The\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a>\nparser combinator from\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>\ncan split a string into those parts that match a certain pattern and the rest.</p>\n\n<p>Try this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sepCap (parseA &lt;|&gt; parseB)\n</code></pre>\n\n<p>Or, if <code>parseA</code> and <code>parseB</code> are parsers for different types of things, then maybe use <a href=\"http://hackage.haskell.org/package/parser-combinators/docs/Control-Monad-Combinators.html#v:eitherP\" rel=\"nofollow noreferrer\"><code>eitherP</code></a>\nlike:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sepCap (eitherP parseA parseB)\n</code></pre>\n"}], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 581, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1567178603, "creation_date": 1470299436, "last_edit_date": 1495542156, "question_id": 38762263, "link": "https://stackoverflow.com/questions/38762263/non-greedy-repetition-with-parsec", "title": "non-greedy repetition with Parsec", "body": "<p>I am trying to split my input into those parts that match a certain pattern and the rest, let's say</p>\n\n<pre><code>data Data = A Int | B Char | C String\nparseDatas :: Parsec [Token] () a [Data]\n</code></pre>\n\n<p>I already have written two more-or-less complicated parsers</p>\n\n<pre><code>parseA :: Parsec [Token] () Data\nparseB :: Parsec [Token] () Data\n</code></pre>\n\n<p>that match the things I am looking for. Now the obvious solution is</p>\n\n<pre><code>parseDatas = many (parseA &lt;|&gt; parseB &lt;|&gt; parseC)\n</code></pre>\n\n<p>where the parser for the intermediate parts would look like this:</p>\n\n<pre><code>makeC :: [Token] -&gt; Data\nmakeC = C . concatMap show -- or something like this\nparseC :: Parsec [Token] () Data\nparseC = makeC &lt;$&gt; many anyToken\n</code></pre>\n\n<p>Meh, that throws a runtime <code>[ERROR] Text.ParserCombinators.Parsec.Prim.many: combinator 'many' is applied to a parser that accepts an empty string.</code> - ok, easily fixed:</p>\n\n<pre><code>parseC = makeC &lt;$&gt; many1 anyToken\n</code></pre>\n\n<p>But now <code>parseC</code> consumes the entire input (that starts with something I'm not looking for), ignoring any patterns that should yield an <code>A</code> or <code>B</code>!</p>\n\n<p><strong>If my patterns were regexes</strong><sup>1</sup><strong>, I would now have changed the <code>+</code> operator to the non-greedy <code>+?</code> operator. How can I do the same for the <code>many1</code> parser combinator?</strong></p>\n\n<p><sub>1: which I cannot use, as I'm operating on tokens not characters</sub></p>\n\n<hr>\n\n<p>A solution I found was </p>\n\n<pre><code>parseC = makeC &lt;$&gt; many1 (notFollowedBy (parseA &lt;|&gt; parseB) &gt;&gt; anyToken)\n</code></pre>\n\n<p>but that does look, uh, <em>suboptimal</em>. It's not really generic. There must be something better.</p>\n\n<p>I also had a look at <a href=\"https://stackoverflow.com/q/29549435/1048572\">Parsec how to find &quot;matches&quot; within a string</a> where the suggestion was to define a recursive parser, but that looks like a hazzle if I don't want to drop the intermediate tokens and collect them in a list instead.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1470294365, "post_id": 38760489, "comment_id": 64893111, "body": "Use: <code>ghc -Wall prog.hs</code> and ghc should tell you the pattern(s) which are not accounted for."}], "answers": [{"comments": [{"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1470294318, "post_id": 38760524, "comment_id": 64893088, "body": "Or maybe it was meant to be <code>longer [] _ = False</code> ?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 1, "creation_date": 1470294457, "post_id": 38760524, "comment_id": 64893187, "body": "I&#39;m leaving that for the OP. :)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1470294133, "creation_date": 1470294133, "answer_id": 38760524, "question_id": 38760489, "link": "https://stackoverflow.com/questions/38760489/haskell-non-exhaustive-patterns-in-function/38760524#38760524", "title": "Haskell: Non-exhaustive patterns in function", "body": "<p>You are not handling this case:</p>\n\n<pre><code>longer [] _ = undefined\n</code></pre>\n\n<p>The pattern <code>(_:[])</code> assumes that you have a minimum of one element in the list. In your code, you are missing the case when the first list is empty and the second list may not be empty.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1470317220, "last_edit_date": 1470317220, "creation_date": 1470315133, "answer_id": 38767881, "question_id": 38760489, "link": "https://stackoverflow.com/questions/38760489/haskell-non-exhaustive-patterns-in-function/38767881#38767881", "title": "Haskell: Non-exhaustive patterns in function", "body": "<p>You need 4 cases, but you don't need to treat two singleton lists as a separate case.</p>\n\n<pre><code>longer :: [a] -&gt; [a] -&gt; Bool\n\n-- 1) Two empty lists\nlonger [] [] = False\n-- 2) An non-empty list and an empty list\nlonger _ []  = True\n-- 3) An empty list and a non-empty list\nlonger [] _ = ???\n-- 4) Two non-empty lists\nlonger (_:xs) (_:ys) = longer xs ys\n</code></pre>\n\n<p>Actually, you only need 3 cases in the proper order, depending on what <code>longer [] _</code> is supposed to be.</p>\n\n<pre><code>-- First case: if longer [] _ is suppose to be True\nlonger :: [a] -&gt; [a] -&gt; Bool\nlonger [] [] = True\nlonger (_:xs) (_:ys) = longer xs ys\n-- We get this far if one is empty and the other is not,\n-- but we don't care which one is which.\nlonger _ _ = False\n\n-- Second case: if longer [] _ is supposed to be False\nlonger :: [a] -&gt; [a] -&gt; Bool\nlonger (_:xs) (_:ys) = longer xs ys\nlonger _ [] = True\nlonger [] _ = False -- This covers longer [] [] as well.\n</code></pre>\n"}], "owner": {"reputation": 3288, "user_id": 3128796, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a938da1334bd8a4de72edfe2740ac6e0?s=128&d=identicon&r=PG", "display_name": "asdfkjasdfjk", "link": "https://stackoverflow.com/users/3128796/asdfkjasdfjk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12258, "favorite_count": 0, "accepted_answer_id": 38760524, "answer_count": 2, "score": 0, "last_activity_date": 1470317220, "creation_date": 1470293983, "question_id": 38760489, "link": "https://stackoverflow.com/questions/38760489/haskell-non-exhaustive-patterns-in-function", "title": "Haskell: Non-exhaustive patterns in function", "body": "<p>I get non exhaustive patterns exception for the following code</p>\n\n<pre><code>--determine which list is longer\nlonger::[a]-&gt;[a]-&gt;Bool\nlonger [] [] = False\nlonger _ [] = True\nlonger (_:[]) (_:[]) = False\nlonger (_:xs) (_:ys) = longer xs ys\n</code></pre>\n\n<p>I don't understand what I am doing wrong here.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1470291838, "post_id": 38759832, "comment_id": 64891826, "body": "The type of <code>yieldInHorses</code> is actually <code>forall r. InHorses r =&gt; e -&gt; r</code>, which notably means that the <i>caller gets to decide</i> what <code>r</code> should be. What you are looking for is something like <code>exists</code> instead of <code>forall</code>, which is not directly available in Haskell, though <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">it is possible to encode something like them using other constructs</a>. However, this is such a contrived example that it is hard to give concrete advice\u2014why would you ever need a typeclass like <code>InHorses</code>, anyway?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470292214, "post_id": 38759832, "comment_id": 64892007, "body": "Instead of <code>InHorses r =&gt; e -&gt; r</code> just use <code>e -&gt; Horses</code> where <code>Horses</code> is a type which properly captures all of the information you want, probably <code>[Horse]</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470295945, "post_id": 38759832, "comment_id": 64894118, "body": "I wonder why you are using typeclasses. Do you really need them? If a typeclass will only have exactly one instance, you probably should scrap it and use the plain type directly."}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1470314853, "post_id": 38760082, "comment_id": 64906619, "body": "I think you either need to add <code>{-# LANGUAGE ConstrainedClassMethods #-}</code> or to put <code>(InHorses (R e)) =&gt; HasHorses e</code> into a class-definition to get this compiled in GHC 8.0.1"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1470317158, "post_id": 38760082, "comment_id": 64908392, "body": "Updated the answer with an alternative signature for yieldInHorses."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1470317075, "last_edit_date": 1470317075, "creation_date": 1470292594, "answer_id": 38760082, "question_id": 38759832, "link": "https://stackoverflow.com/questions/38759832/couldnt-match-expected-type-r-with-actual-type-horse/38760082#38760082", "title": "Couldn&#39;t match expected type \u2018r\u2019 with actual type \u2018Horse\u2019", "body": "<p>I think you are looking for <em>associated types</em>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nclass HasHorses e where\n  type R e  :: *\n  yieldInHorses :: (InHorses (R e)) =&gt; e -&gt; R e\n\nclass InHorses e\n\ndata Horse = Horse String\ndata Stable = Stable String\n\ninstance InHorses Horse\n\ninstance HasHorses Stable where\n  type R Stable = Horse\n  yieldInHorses e = (Horse \"Buttercup\")\n\ntest = yieldInHorses (Stable \"asd\")\n</code></pre>\n\n<p>Here when we define the HasHorses instance we also defined\nwhat the associated horse type is.</p>\n\n<p>As @Alexis King mentioned, your signature for <code>yieldInHorses</code> allows\nthe caller to determine what the return type is. For instance, they\ncould ask for:</p>\n\n<pre><code>yieldInHorses (Stable \"asd\") :: Int\n</code></pre>\n\n<p>But it seems you want to return a specific type based on the instance you are defining.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is anther way to write the signature for <code>yieldInHorses</code> which removes\nthe need for FlexibleContexts and works with GHC 8:</p>\n\n<pre><code>  yieldInHorses :: (InHorses r, r ~ R e) =&gt; e -&gt; r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 0, "last_activity_date": 1470317347, "creation_date": 1470317347, "answer_id": 38768733, "question_id": 38759832, "link": "https://stackoverflow.com/questions/38759832/couldnt-match-expected-type-r-with-actual-type-horse/38768733#38768733", "title": "Couldn&#39;t match expected type \u2018r\u2019 with actual type \u2018Horse\u2019", "body": "<p>As mentioned in a comment above, the type <code>(InHorses r) =&gt; e -&gt; r</code> of <code>yieldInHorses</code> means that if given a value of type <code>e</code>, it is able to return a value of <strong>any</strong> type <code>r</code> that satisfies the <code>InHorses</code> constraint. The implementation, however, always returns a specific <code>r</code>, <code>Horse</code>.</p>\n\n<p>It's hard to know what would work best for you since the example appears to be incomplete (the <code>Stable</code> value is ignored in the implementation of <code>yieldInHorses</code>). If a <code>Stable</code> can <em>only</em> produce <code>Horse</code>s, the functional dependency or type family approaches makes sense. If, however, a <code>Stable</code> maintains some state that can then be used to produce any <code>InHorses r =&gt; r</code>, perhaps a constructor approach could be useful. For example, if all <code>InHorses</code> are able to be constructed from a <code>String</code>:</p>\n\n<pre><code>class InHorses e where makeHorse :: String -&gt; e\ninstance InHorses Horse where makeHorse s = Horse s\n\ninstance HasHorses Stable where yieldInHorses e = makeHorse \"Buttercup\"\n</code></pre>\n"}], "owner": {"reputation": 5030, "user_id": 1021915, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/O3Ar0.jpg?s=128&g=1", "display_name": "Liam M", "link": "https://stackoverflow.com/users/1021915/liam-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 38760082, "answer_count": 2, "score": 2, "last_activity_date": 1470317347, "creation_date": 1470291640, "question_id": 38759832, "link": "https://stackoverflow.com/questions/38759832/couldnt-match-expected-type-r-with-actual-type-horse", "title": "Couldn&#39;t match expected type \u2018r\u2019 with actual type \u2018Horse\u2019", "body": "<p>I'm fiddling about with Haskell but struggling with a problem. The following code:</p>\n\n<pre><code>class HasHorses e where yieldInHorses :: (InHorses r) =&gt; e -&gt; r\nclass InHorses e\n\ndata Horse = Horse String\ndata Stable = Stable String\n\ninstance InHorses Horse\ninstance HasHorses Stable where yieldInHorses e = (Horse \"Buttercup\")\n</code></pre>\n\n<p>Gives me the following error:</p>\n\n<pre><code>source_file.hs:10:52: error:\n    \u2022 Couldn't match expected type \u2018r\u2019 with actual type \u2018Horse\u2019\n      \u2018r\u2019 is a rigid type variable bound by\n        the type signature for:\n          yieldInHorses :: forall r. InHorses r =&gt; Stable -&gt; r\n        at source_file.hs:10:33\n    \u2022 In the expression: (Horse \"Buttercup\")\n      In an equation for \u2018yieldInHorses\u2019:\n          yieldInHorses e = (Horse \"Buttercup\")\n      In the instance declaration for \u2018HasHorses Stable\u2019\n    \u2022 Relevant bindings include\n        yieldInHorses :: Stable -&gt; r\n          (bound at source_file.hs:10:33)\n</code></pre>\n\n<p>Where line 10 refers to the line where I <code>instance HasHorses Stable where ...</code>.</p>\n\n<p>Perhaps I've overlooked something, but I can't see why this should be an error. The actual Type Horse satisfies the constraint of r, which is that it should be InHorses.</p>\n\n<p>the Idea of the 'yieldInHorses' method is that for something that HasHorses, calling this method on it should tell me the Horses (well, horse, to begin with - This wil encompass lists soon), that it has.</p>\n\n<p>Have I made a simple error or misunderstood something more fundamental?</p>\n"}, {"tags": ["haskell", "frp", "netwire"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470295093, "post_id": 38759780, "comment_id": 64893567, "body": "Looking at this code might be helpful: <a href=\"https://github.com/crockeo/netwire-pong\" rel=\"nofollow noreferrer\">github.com/crockeo/netwire-pong</a>"}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470299093, "post_id": 38759780, "comment_id": 64896071, "body": "@ErikR, thanks for the link. I need sometime to understand how this works, but my first impression is that it isn&#39;t as concise as I was hoping."}], "answers": [{"tags": [], "owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "is_accepted": true, "score": 3, "last_activity_date": 1480158662, "last_edit_date": 1480158662, "creation_date": 1480106947, "answer_id": 40812115, "question_id": 38759780, "link": "https://stackoverflow.com/questions/38759780/how-to-implement-a-collision-with-netwire-5-0-1/40812115#40812115", "title": "How to implement a collision with Netwire (5.0.1)", "body": "<p>Disclaimer: I cannot comment on what is \"recommended\", but I can show a way that does what you want to do.</p>\n\n<p>I want to describe two methods:<br>\nThe first is using stateful wires, and is pretty similar to <a href=\"https://ocharles.org.uk/blog/posts/2013-08-01-getting-started-with-netwire-and-sdl.html\" rel=\"nofollow noreferrer\">this a bit outdated tutorial from 2013</a>, but based on Netwire 5.0.2.<br>\nThe second is using stateless wires. Because they are stateless they need to be fed back their previous values, which makes the wire's input types and the final combination of the wires a bit more convoluted. Otherwise they are pretty similar.</p>\n\n<p>The basic types that are involved in both examples are</p>\n\n<pre><code>type Collision = Bool\ntype Velocity = Float\ntype Position = Float\n</code></pre>\n\n<h2>Stateful</h2>\n\n<p>You can model your problem with two (stateful) wires that are then combined.</p>\n\n<p>One wire models the velocity, which is constant, and changes direction when a collision happens. The (simplified) type of this is <code>Wire s e m Collision Velocity</code>, i.e. it's input is if a collision happened and the output is the current velocity.</p>\n\n<p>The other one models the position, and handles collisions. The (simplified) type of this is <code>Wire s e m Velocity (Position, Collision)</code>, i.e. it takes a velocity, calculates the new position and returns that and if a collision happened.</p>\n\n<p>Finally the velocity is fed into the position wire, and the collision result from that is fed back into the velocity wire.</p>\n\n<p>Let's have a look at the details of the velocity wire:</p>\n\n<pre><code>-- stateful fixed velocity wire that switches direction when collision occurs\nvelocity :: Velocity -&gt; Wire s e m Collision Velocity\nvelocity vel = mkPureN $ \\collision -&gt;\n  let nextVel = if collision then negate vel else vel\n  in (Right nextVel, velocity nextVel)\n</code></pre>\n\n<p><code>mkPureN</code> creates a stateful wire that only depends on the input and its own state (not on a Monad, or time). The state is the current velocity, and the next velocity is negated if <code>Collision=True</code> is passed as input. The return value is a pair of the velocity value and the new wire with the new state.</p>\n\n<p>For the position it is no longer sufficient to use the <code>integral</code> wire directly. We want an enhanced, \"bounded\" version of <code>integral</code> which makes sure that the value stays lower than an upper bound and greater than 0, and returns the information if such a collision has happened.</p>\n\n<pre><code>-- bounded integral [0, bound]\npos :: HasTime t s =&gt; Position -&gt; Position -&gt; Wire s e m Velocity (Position, Collision)\npos bound x = mkPure $ \\ds dx -&gt;\n  let dt = realToFrac (dtime ds)\n      nextx' = x + dt*dx -- candidate\n      (nextx, coll)\n        | nextx' &lt;= 0 &amp;&amp; dx &lt; 0     = (-nextx', True)\n        | nextx' &gt;= bound &amp;&amp; dx &gt; 0 = (bound - (nextx' - bound), True)\n        | otherwise                 = (nextx', False)\n  in (Right (nextx, coll), pos bound nextx)\n</code></pre>\n\n<p><code>mkPure</code> is similar to <code>mkPureN</code>, but allows the wire to depend on time.<br>\n<code>dt</code> is the time difference.<br>\n<code>nextx'</code> is the new position, as it would be returned by <code>integral</code>.<br>\nThe following lines check the bounds and return the new position, if a collision has occurred and the new wire with the new state.</p>\n\n<p>Finally you feed them into each other using <code>rec</code> and <code>delay</code>. Full example:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nmodule Main where\n\nimport Control.Monad.Fix\nimport Control.Wire\nimport FRP.Netwire\n\ntype Collision = Bool\ntype Velocity = Float\ntype Position = Float\n\n-- bounded integral [0, bound]\npos :: HasTime t s =&gt; Position -&gt; Position -&gt; Wire s e m Velocity (Position, Collision)\npos bound x = mkPure $ \\ds dx -&gt;\n  let dt = realToFrac (dtime ds)\n      nextx' = x + dt*dx -- candidate\n      (nextx, coll)\n        | nextx' &lt;= 0 &amp;&amp; dx &lt; 0     = (-nextx', True)\n        | nextx' &gt;= bound &amp;&amp; dx &gt; 0 = (bound - (nextx' - bound), True)\n        | otherwise                 = (nextx', False)\n  in (Right (nextx, coll), pos bound nextx)\n\n-- stateful fixed velocity wire that switches direction when collision occurs\nvelocity :: Velocity -&gt; Wire s e m Collision Velocity\nvelocity vel = mkPureN $ \\collision -&gt;\n  let nextVel = if collision then negate vel else vel\n  in (Right nextVel, velocity nextVel)\n\nrun :: (HasTime t s, MonadFix m) =&gt; Position -&gt; Velocity -&gt; Position -&gt; Wire s () m a Position\nrun start vel bound = proc _ -&gt; do\n  rec\n    v &lt;- velocity vel &lt;&lt;&lt; delay False -&lt; collision\n    (p, collision) &lt;- pos bound start -&lt; v\n  returnA -&lt; p\n\nmain :: IO ()\nmain = testWire clockSession_ (run 0 5 20)\n</code></pre>\n\n<h2>Stateless</h2>\n\n<p>The stateless variant is very similar to the stateful one, except that the state wanders to the input type of the wires instead of being a parameter to the functions that create the wire.</p>\n\n<p>The velocity wire therefore takes a tuple <code>(Velocity, Collision)</code> as its input, and we can just lift a function to create it:</p>\n\n<pre><code>-- pure stateless independent from time\n-- output velocity is input velocity potentially negated depending on collision\nvelocity :: Monad m =&gt; Wire s e m (Velocity, Collision) Velocity\nvelocity = arr $ \\(vel, collision) -&gt; if collision then -vel else vel\n</code></pre>\n\n<p>You can also use the function <code>mkSF_</code> from <code>Control.Wire.Core</code> (and then get rid of the restriction to <code>Monad m</code>).</p>\n\n<p><code>pos</code> becomes</p>\n\n<pre><code>-- pure stateless but depending on time\n-- output position is input position moved by input velocity (depending on timestep)\npos :: HasTime t s =&gt; Position -&gt; Wire s e m (Position, Velocity) (Position, Collision)\npos bound = mkPure $ \\ds (x,dx) -&gt;\n  let dt = realToFrac (dtime ds)\n      nextx' = x + dt*dx -- candidate\n      (nextx, coll)\n        | nextx' &lt;= 0 &amp;&amp; dx &lt; 0     = (-nextx', True)\n        | nextx' &gt;= bound &amp;&amp; dx &gt; 0 = (bound - (nextx' - bound), True)\n        | otherwise                 = (nextx', False)\n  in (Right (nextx, coll), pos bound)\n</code></pre>\n\n<p>Here we still need to use mkPure, because there is no function that specifically can be used for stateless wires that <em>depend on time</em>.</p>\n\n<p>To connect the two wire we now must feed the output of velocity into itself and the position, and from the <code>pos</code> wire the position into itself and the collision information into the velocity wire.</p>\n\n<p>But actually with stateless wires you can also separate the \"integrating\" and the \"bounds checking\" parts of the <code>pos</code> wire. The <code>pos</code> wire then is a <code>Wire s e m (Position, Velocity) Position</code> that directly returns what is <code>nextx'</code> above, and the <code>boundedPos</code> wire is a <code>Wire s e m (Position, Velocity) (Position, Collision)</code> that gets the new position from <code>pos</code> and the velocity, and applies the bound check. That way the different logical parts become nicely separated.</p>\n\n<p>Full example:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nmodule Main where\n\nimport Control.Monad.Fix\nimport Control.Wire\nimport FRP.Netwire\n\ntype Collision = Bool\ntype Velocity = Float\ntype Position = Float\n\n-- pure stateless but depending on time\n-- output position is input position moved by input velocity (depending on timestep)\npos :: HasTime t s =&gt; Wire s e m (Position, Velocity) Position\npos = mkPure $ \\ds (x,dx) -&gt;\n  let dt = realToFrac (dtime ds)\n  in (Right (x + dt*dx), pos)\n\n-- pure stateless independent from time\n-- input position is bounced off the bounds\nboundedPos :: Monad m =&gt; Position -&gt; Wire s e m (Position, Velocity) (Position, Collision)\nboundedPos bound = arr $ \\(x, dx) -&gt;\n  let (nextx, collision)\n        | x &lt;= 0 &amp;&amp; dx &lt; 0 = (-x, True)\n        | x &gt;= bound &amp;&amp; dx &gt; 0 = (bound - (x - bound), True)\n        | otherwise          = (x, False)\n  in (nextx, collision)\n\n-- pure stateless independent from time\n-- output velocity is input velocity potentially negated depending on collision\nvelocity :: Monad m =&gt; Wire s e m (Velocity, Collision) Velocity\nvelocity = arr $ \\(vel, collision) -&gt; if collision then -vel else vel\n\n-- plug the wires into each other\nrun :: (HasTime t s, MonadFix m) =&gt; Position -&gt; Velocity -&gt; Position -&gt; Wire s () m a Position\nrun start vel bound = proc _ -&gt; do\n  rec\n    v &lt;- velocity &lt;&lt;&lt; delay (vel, False) -&lt; (v, collision)\n    lastPos &lt;- delay start -&lt; p'\n    p &lt;- pos -&lt; (lastPos, v)\n    (p', collision) &lt;- boundedPos bound -&lt; (p, v)\n  returnA -&lt; p'\n\nmain :: IO ()\nmain = testWire clockSession_ (run 0 5 20)\n</code></pre>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 40812115, "answer_count": 1, "score": 0, "last_activity_date": 1480158662, "creation_date": 1470291417, "question_id": 38759780, "link": "https://stackoverflow.com/questions/38759780/how-to-implement-a-collision-with-netwire-5-0-1", "title": "How to implement a collision with Netwire (5.0.1)", "body": "<p>I am trying to model moving objects using Netwire and would like to know the recommended way to implement something like the bouncing of a ball off a wall. I have encountered several possible ways to do this and I need some help actually getting them to work.</p>\n\n<p>The motion code looks like this:</p>\n\n<pre><code>type Pos = Float\ntype Vel = Float\n\ndata Collision = Collision | NoCollision\n           deriving (Show)\n\nmotion :: (HasTime t s, MonadFix m) =&gt; Pos -&gt; Vel -&gt; Wire s Collision m a Pos\nmotion x0 v0 = proc _ -&gt; do\n             rec\n                 v &lt;- vel &lt;&lt;&lt; delay 0 -&lt; x\n                 x &lt;- pos x0 -&lt; v\n             returnA -&lt; x\n\npos :: (HasTime t s, MonadFix m) =&gt; Pos -&gt; Wire s Collision m Vel Pos\npos x0 = integral x0\n\nmain :: IO ()\nmain = testWire clockSession_ (motion 0 5)\n</code></pre>\n\n<p>What is the recommended way to make a velocity arrow that causes a bounce at a certain position, eg x=20?</p>\n\n<p>I have seen three different ways that I might be able to do this: </p>\n\n<ul>\n<li><p>The netwire <code>--&gt;</code> function which seems the simplest. I have a prototype using this function but I don't know how to make a new velocity arrow based on the velocity at the time of the collision, I can only use a fixed value which is not useful if the object can accelerate.</p>\n\n<pre><code>vel :: (HasTime t s, MonadFix m) =&gt; Wire s Collision m Pos Vel\nvel = pure 5 . unless (&gt;20) --&gt; pure (-5)\n</code></pre></li>\n<li><p>Using the <code>Event</code> and <code>switch</code> in Netwire. I don't understand how to use this.</p></li>\n<li><p>Using the <code>(|||)</code> function available to arrows in general.</p></li>\n</ul>\n\n<p>The first two seem like the best options but I don't know how to implement them.</p>\n\n<p>I have seen other similar questions to this but the incompatibility between different versions of netwire have made the answers not useful for me.</p>\n"}, {"tags": ["haskell", "set", "quickcheck"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470294456, "post_id": 38757169, "comment_id": 64893185, "body": "You can generate occasionally overlapping sets by taking random subsets of a given set - the larger the subsets, the larger the probability of overlap. I think the same would apply to the ranges of the sets. I&#39;m not sure what dense and sparse areas of sets are."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1470301812, "post_id": 38757169, "comment_id": 64897923, "body": "If you want to check the implementation of Set I would have thought the best option would be to generate Arbitrary instances for its internal data structures."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470329353, "post_id": 38757169, "comment_id": 64917776, "body": "By &quot;balanced tree shapes&quot; it appears you mean satisfying the <a href=\"https://github.com/haskell/containers/blob/45bfe23ba21bb43b8c48ca8600c3becf5284cc1c/Data/Set/Base.hs#L1539\" rel=\"nofollow noreferrer\"><b>balanced</b> predicate</a>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470330129, "post_id": 38757169, "comment_id": 64918234, "body": "@ErikR, yes, that&#39;s what I mean."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1470352580, "post_id": 38757169, "comment_id": 64928868, "body": "@PaulJohnson, that&#39;s pretty close to what I&#39;m doing here. For each tree size, I&#39;m randomly choosing subtree sizes that satisfy the balance conditions. But the actual values must be strictly increasing, so I can&#39;t wing that as much. One option would be to generate arbitrary lists, sort them, remove duplicates, etc. Another option would be to try for something more Brownian-style picking random gaps. I don&#39;t know what&#39;s best."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470352927, "post_id": 38757169, "comment_id": 64928948, "body": "@user2407038, by dense and sparse I mean smaller and larger gaps between consecutive elements. These modify the probability of collision on insertion, union, intersection, difference, etc. Your random subsets idea is interesting; it may make sense to consider writing some of the set-combination tests to use <code>mkArb</code> to generate related sets rather than just grabbing two <code>arbitrary</code> ones. If I use that idea, how would you like to be credited?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470355065, "post_id": 38757169, "comment_id": 64929523, "body": "@dfeuer If you want sparse and dense sets, pass the sequence [x0, x1..] for <code>step</code>, where the difference between xi and x(i+1) is a random number between 1 and m. When m is close to 1, you get dense sets, and when it is large, you get sparse sets. (Credit? It seems to me if you use this idea, you are doing most of the work. Ideas themselves are a dime a dozen - implementation is hard)"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1470384108, "post_id": 38757169, "comment_id": 64938767, "body": "@dfeuer You do know that there is an &quot;orderedList&quot; generator in Test.QuickCheck.Arbitrary?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1470403286, "post_id": 38757169, "comment_id": 64950802, "body": "@PaulJohnson, yes, I do. It does not ensure the lists are <i>strictly</i> increasing, which I need. I also don&#39;t know what their distribution looks like at all. Do you know how I could find out?"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1470274783, "creation_date": 1470274783, "question_id": 38757169, "link": "https://stackoverflow.com/questions/38757169/how-should-i-populate-arbitrary-sets", "title": "How should I populate arbitrary sets?", "body": "<p><a href=\"https://github.com/haskell/containers/blob/110a6c435e3389c065cd1bcb353c3b8335e356f2/tests/set-properties.hs#L129\" rel=\"nofollow\">The current <code>Arbitrary</code> instance</a> used to test <code>Data.Set</code> is too complicated for my taste. I don't really understand it, so I don't really trust it. I came up with the idea of separating the <em>shape</em> generation from the <em>value</em> generation.</p>\n\n<p>Using</p>\n\n<pre><code>class Monad m =&gt; MonadGen m where\n  liftGen :: Gen a -&gt; m a\ninstance MonadGen Gen where\n  liftGen = id\ninstance MonadGen m =&gt; MonadGen (StateT s m) where\n  liftGen = lift . liftGen\n</code></pre>\n\n<p>I can write</p>\n\n<pre><code>mkArb :: MonadGen m =&gt; m a -&gt; Int -&gt; m (Set a)\nmkArb step n\n  | n &lt;= 0 = pure Tip\n  | n == 1 = singleton &lt;$&gt; step\n  | n == 2 = do\n     dir &lt;- liftGen arbitrary\n     p &lt;- step\n     q &lt;- step\n     if dir\n       then pure (Bin 2 q (singleton p) Tip)\n       else pure (Bin 2 p Tip (singleton q))\n  | otherwise = do\n      let upper = (3*(n - 1)) `quot` 4\n      let lower = (n + 2) `quot` 4\n      ln &lt;- liftGen $ choose (lower, upper)\n      let rn = n - ln - 1\n      (\\lt x rt -&gt; Bin n x lt rt) &lt;$&gt; mkArb step ln &lt;*&gt; step &lt;*&gt; mkArb step rn\n</code></pre>\n\n<p>Then I can use something like <code>StateT s Gen</code> to populate the set with strictly increasing elements.</p>\n\n<p>I have two questions:</p>\n\n<ol>\n<li><p>Do I successfully generate all balanced tree shapes? How can I check?</p></li>\n<li><p>What would be a good way to fill in values? I want sets with dense areas and with sparse areas. When I generate two sets I want them to overlap some times but not others, and their ranges to overlap some times but not others. I don't really have a good sense of how to accomplish these goals.</p></li>\n</ol>\n"}]