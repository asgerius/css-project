[{"tags": ["haskell", "lazy-evaluation", "io-monad"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441840750, "post_id": 32489732, "comment_id": 52841768, "body": "Does <code>h&#39;</code> call <code>h</code>? Can you actually show us the real code? Do you want it to only perform enough <code>IO</code> to produce the demanded results, or should it perform it all regardless?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441841093, "post_id": 32489732, "comment_id": 52841861, "body": "only to produce the demanded results, and the actual code is a lot lot bigger and messier, I still believe I am helping it when I paste simplified versions. <code>h</code> is not called from <code>h&#39;</code>"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441841272, "post_id": 32489732, "comment_id": 52841913, "body": "I am making mistakes, I should sleep on this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1441841618, "post_id": 32489732, "comment_id": 52842014, "body": "Ah, well, if you want evaluation to drive execution, <code>unsafeInterleaveIO</code> is your only option."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441839068, "post_id": 32489965, "comment_id": 52841317, "body": "I maybe oversimplified thinks, I will edit the original post."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1441837935, "last_edit_date": 1441837935, "creation_date": 1441836798, "answer_id": 32489965, "question_id": 32489732, "link": "https://stackoverflow.com/questions/32489732/lazy-list-wrapped-in-io/32489965#32489965", "title": "Lazy list wrapped in IO", "body": "<p>Yes, <code>IO</code> is to blame here. <code>&gt;&gt;=</code> for <code>IO</code> is strict in the \"state of the world\". If you write <code>m &gt;&gt;= h</code>, you'll get an action that first performs the action <code>m</code>, then applies <code>h</code> to the result, and finally performs the action <code>h</code> yields. It doesn't matter that your <code>f</code> action doesn't \"do anything\"; it has to be performed anyway. Thus you end up in an infinite loop starting the <code>f</code> action over and over.</p>\n\n<p>Thankfully, there is a way around this, because <code>IO</code> is an instance of <code>MonadFix</code>. You can \"magically\" access the result of an <code>IO</code> action from within that action. Critically, that access must be sufficiently lazy, or you'll throw yourself into an infinite loop.</p>\n\n<pre><code>import Control.Monad.Fix\nimport Data.Functor ((&lt;$&gt;))\n\nf :: IO [Int]\nf = mfix (\\xs -&gt; return (0 : xs))\n\n-- This `g` is just like yours, but prettier IMO\ng :: IO [Int]\ng = take 3 &lt;$&gt; f\n</code></pre>\n\n<p>There's even a bit of syntactic sugar in GHC for this letting you use <code>do</code> notation with the <code>rec</code> keyword or <code>mdo</code> notation.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nf' :: IO [Int]\nf' = do\n  rec res &lt;- (0:) &lt;$&gt; (return res :: IO [Int])\n  return res\n\nf'' :: IO [Int]\nf'' = mdo\n  res &lt;- f'\n  return (0 : res)\n</code></pre>\n\n<p>For more interesting examples of ways to use <code>MonadFix</code>, see the <a href=\"https://wiki.haskell.org/MonadFix\">Haskell Wiki</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441840206, "post_id": 32490464, "comment_id": 52841640, "body": "This seems to do the trick, thank you. Are there any drawbacks to using this, the name is not very reassuring ;)."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441840371, "post_id": 32490464, "comment_id": 52841678, "body": "Well, that&#39;s why I said I&#39;m not sure it&#39;s appropriate. unsafeInterleaveIO is okay sometimes, but is dangerous in general; find someone more experienced than I am to tell you whether this is a good idea."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 3, "creation_date": 1441843764, "post_id": 32490464, "comment_id": 52842500, "body": "@JakubDaniel The drawback is that it will screw up your intuition about how <code>IO</code> happens: normally, in <code>m &gt;&gt;= f</code>, we expect the <code>IO</code> of <code>m</code> to  happen before <code>f</code> is applied to an argument; but in <code>unsafeInterleaveIO m &gt;&gt;= f</code> the <code>IO</code> of <code>m</code> will be delayed. Translating this to your question context, this means the consumer of <code>h</code>&#39;s list decides which (if any!) iterations of <code>h&#39;</code> get performed. It&#39;s also fragile to compiler optimizations. So if you&#39;re doing something where you actually care about the <code>IO</code> that happens -- which is almost always -- it&#39;s a pretty bad idea!"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 2, "last_activity_date": 1441839665, "creation_date": 1441839665, "answer_id": 32490464, "question_id": 32489732, "link": "https://stackoverflow.com/questions/32489732/lazy-list-wrapped-in-io/32490464#32490464", "title": "Lazy list wrapped in IO", "body": "<p>I'm not sure if this is an appropriate usage, but <code>unsafeInterleaveIO</code> would get you the behavior you're asking for, by deferring the IO actions of <code>f</code> until the value inside of <code>f</code> is asked for:</p>\n\n<pre><code>module Tmp where\nimport System.IO.Unsafe (unsafeInterleaveIO)\n\nf :: IO [Int]\nf = unsafeInterleaveIO f &gt;&gt;= return . (0 :)\n\ng :: IO [Int]\ng = f &gt;&gt;= return . take 3\n\n*Tmp&gt; g\n[0,0,0]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441859303, "post_id": 32491251, "comment_id": 52846266, "body": "This seems like a pretty simple approach, but that library is a bit obnoxious--why doesn&#39;t it export the <code>ListT</code> constructor?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441873177, "post_id": 32491251, "comment_id": 52853016, "body": "Is it likely that one day this <code>ListT</code> replaces the one in <code>transformers</code> ?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441875722, "post_id": 32491251, "comment_id": 52854676, "body": "Can I anyhow transform lazily the <code>ListT IO (Either a b)</code> into <code>IO [Either a b]</code> so that I don&#39;t have to polute the callers with ListT things? I would have expected <code>toList</code> to be lazy but it seems not to be :/ I also wish to pick whether to use <code>take 3</code> or just identity, so I expected the stream to be potentially infinite."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441878428, "post_id": 32491251, "comment_id": 52856561, "body": "@JakubDaniel You may of course substitute <code>id</code> for <code>take 3</code> in the above definition of <code>main</code>, no problem. It is true that <code>toList</code> is not lazy in the sense of lazy IO -- which you should treat as a good thing for all the reasons I outlined on the other answer. You will need to decide whether you want to call <code>take 3</code> or <code>id</code> before calling <code>toList</code>. However, <code>toList</code> is indeed the correct way to turn a <code>ListT IO (Either a b)</code> into an <code>IO [Either a b]</code>."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441878842, "post_id": 32491251, "comment_id": 52856846, "body": "Yes but if i choose <code>id</code> then when the function does not terminate, the strictness causes that I cannot read the intermediate results :( which beats the purpose of using <code>ListT</code> instead of normal list as in my edit to the original question. It is often the case, that the function does not terminate."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441879988, "post_id": 32491251, "comment_id": 52857644, "body": "@JakubDaniel This is not correct: as my example shows, you can use <code>traverse_</code> to inspect intermediate values as they are available."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441884198, "post_id": 32491251, "comment_id": 52860328, "body": "I mean, you cannot do that lazily over the standard list, which I see as really a negative fact. As I said earlier, I was hoping for a solution that would produce <code>IO [Either a b]</code> which I could inspect lazily. The only way to get <code>IO [...]</code> from <code>ListT</code> seems to be <code>toList</code> which however is not lazy, so once you do that, you lose laziness. If you use <code>traverse_</code> you cannot keep constructing the lazy list <code>[...]</code>."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441891482, "post_id": 32491251, "comment_id": 52865496, "body": "So if your on-demand expansion of the list is very far (meaning over many calls to other <code>IO</code> actions) then you need to polute the whole stack with <code>ListT</code>, which prohibits you from concealing the implementation :/"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441949004, "post_id": 32491251, "comment_id": 52890386, "body": "@JakubDaniel, it&#39;s not really pollution, I don&#39;t think, so much as expressing the fact that values are consumed as they are produced. Hiding the fact that producing the items is effectful doesn&#39;t necessarily seem to be a good thing."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441952811, "post_id": 32491251, "comment_id": 52891924, "body": "I did not mean to be hiding the effect rather than hidding the source of laziness (<code>ListT</code>). Enlarging the stack of monads with another transformer seems to me as pollution."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1441845580, "creation_date": 1441845580, "answer_id": 32491251, "question_id": 32489732, "link": "https://stackoverflow.com/questions/32489732/lazy-list-wrapped-in-io/32491251#32491251", "title": "Lazy list wrapped in IO", "body": "<p>It sounds like you want a monad that mixes the capabilities of lists and <code>IO</code>. Luckily, that's just what <a href=\"http://hackage.haskell.org/package/list-t-0.4.5.1/docs/ListT.html\" rel=\"nofollow\"><code>ListT</code></a> is for. Here's your example in that form, with an <code>h'</code> that computes the Collatz sequence and asks the user how they feel about each element in the sequence (I couldn't really think of anything convincing that fit the shape of your outline).</p>\n\n<pre><code>import Control.Monad.IO.Class\nimport qualified ListT as L\n\nh :: Int -&gt; L.ListT IO (Either String ())\nh a = do\n  (r, a') &lt;- liftIO (h' a)\n  case r of\n    x@(Left  _) -&gt; L.cons x (h a')\n    y@(Right _) -&gt; return y\n\nh' :: Int -&gt; IO (Either String (), Int)\nh' 1 = return (Right (), 1)\nh' n = do\n  putStrLn $ \"Say something about \" ++ show n\n  s &lt;- getLine\n  return (Left s, if even n then n `div` 2 else 3*n + 1)\n\nmain = readLn &gt;&gt;= L.traverse_ print . L.take 3 . h\n</code></pre>\n\n<p>Here's how it looks in ghci:</p>\n\n<pre><code>&gt; main\n2\nSay something about 2\nsmall\nLeft \"small\"\nRight ()\n&gt; main\n3\nSay something about 3\nprime\nLeft \"prime\"\nSay something about 10\nnot prime\nLeft \"not prime\"\nSay something about 5\nfiver\nLeft \"fiver\"\n</code></pre>\n\n<p>I suppose modern approaches would use pipes or conduits or iteratees or something, but I don't know enough about them to talk about the tradeoffs compared to <code>ListT</code>.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 2, "accepted_answer_id": 32490464, "answer_count": 3, "score": 3, "last_activity_date": 1441845580, "creation_date": 1441835503, "last_edit_date": 1441841109, "question_id": 32489732, "link": "https://stackoverflow.com/questions/32489732/lazy-list-wrapped-in-io", "title": "Lazy list wrapped in IO", "body": "<p>Suppose the code</p>\n\n<pre><code>f :: IO [Int]\nf = f &gt;&gt;= return . (0 :)\n\ng :: IO [Int]\ng = f &gt;&gt;= return . take 3\n</code></pre>\n\n<p>When I run <code>g</code> in ghci, it cause stackoverflow. But I was thinking maybe it could be evaluated lazily and produce <code>[0, 0, 0]</code> wrapped in <code>IO</code>. I suspect <code>IO</code> is to blame here, but I really have no idea. Obviously the following works:</p>\n\n<pre><code>f' :: [Int]\nf' = 0 : f'\n\ng' :: [Int]\ng' = take 3 f'\n</code></pre>\n\n<hr>\n\n<p><strong>Edit:</strong> In fact I am not interested in having such a simple function <code>f</code>, original code looked more along the lines:</p>\n\n<pre><code>h :: a -&gt; IO [Either b c]\nh a = do\n    (r, a') &lt;- h' a\n    case r of\n        x@(Left  _) -&gt; h a' &gt;&gt;= return . (x :)\n        y@(Right _) -&gt; return [y]\n\nh' :: IO (Either b c, a)\n-- something non trivial\n\nmain :: IO ()\nmain = mapM_ print . take 3 =&lt;&lt; h a\n</code></pre>\n\n<p><code>h</code> does some <code>IO</code> computations and stores invalid (<code>Left</code>) responses in a list until a valid response (<code>Right</code>) is produced. The attempt is to construct the list lazily even though we are in the <code>IO</code> monad. So that someone reading the result of <code>h</code> can start consuming the list even before it is complete (because it may even be infinite). And if the one reading the results cares only for the first <code>3</code> entries no matter what, the rest of the list does not even have to be constructed. And I am getting the feeling that this will not be possible :/.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441838775, "post_id": 32489464, "comment_id": 52841233, "body": "This is not directly related to your problem, but it sounds like you&#39;re using the tree as some sort of trie. There are libraries out there that offer tries, including <a href=\"https://hackage.haskell.org/package/bytestring-trie\" rel=\"nofollow noreferrer\">bytestring-trie</a> and <a href=\"https://hackage.haskell.org/package/word-trie\" rel=\"nofollow noreferrer\">word-trie</a>."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441864879, "post_id": 32489464, "comment_id": 52848313, "body": "@dfeuer you\u2019re right, it\u2019s a trie :-)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441865609, "post_id": 32489464, "comment_id": 52848633, "body": "Seems like loading a couple meg file should not be a big deal.  Look carefully at your loading code.  Are you using (lazy) <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Lazy.html\" rel=\"nofollow noreferrer\">bytestrings</a> to load the file?  I hope the file is already sorted?  Can you come up with a file representation that will store the tree in a state that takes very little computation to load; e.g. using <a href=\"https://hackage.haskell.org/package/binary-0.7.6.1/docs/Data-Binary.html\" rel=\"nofollow noreferrer\">Data.Binary</a>? Crazy idea: implement a trie based on <a href=\"https://hackage.haskell.org/package/mmap\" rel=\"nofollow noreferrer\">mmap</a>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1441865746, "post_id": 32489464, "comment_id": 52848702, "body": "Obviously if you are precomputing a gigantic AST, you should have optimization turned off for that module."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441866379, "post_id": 32489464, "comment_id": 52848995, "body": "@luqui yes, it\u2019s a gigantic AST ;-) The file is already sorted. I do not use (lazy) bytestrings, I use the standard readFile. I once tried to use Text functions to load the file, but it didn\u2019t make any difference."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441866515, "post_id": 32489464, "comment_id": 52849070, "body": "@luqui turning off optimization didn\u2019t help. About the crazy idea: I\u2019m not that advanced in Haskell ;-)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441884702, "post_id": 32489464, "comment_id": 52860697, "body": "@zigzou - I updated my answer with a pointer to some sample code."}], "answers": [{"comments": [{"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1441901248, "post_id": 32495357, "comment_id": 52872624, "body": "Though it didn\u2019t solve the TemplateHaskell memory problem, it\u2019s been of great help, thanks ! :-)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1441884636, "last_edit_date": 1441884636, "creation_date": 1441868942, "answer_id": 32495357, "question_id": 32489464, "link": "https://stackoverflow.com/questions/32489464/templatehaskell-memory-usage-when-compiling/32495357#32495357", "title": "TemplateHaskell memory usage when compiling", "body": "<p>Perhaps you can \"embed\" the trie into the executable to save on loading and creation time, but one problem I foresee is that conventional Haskell data structures are quite bloated compared to data structures in other languages.</p>\n\n<p>Also, most containers allow for insertion and deletion, but it looks like your data is constant so you'll only need the final data structure. Moreover you'll only be using it for queries like:</p>\n\n<ul>\n<li>Does this word exist in the dictionary?</li>\n<li>And, is this string a prefix of some word in the dictionary?</li>\n</ul>\n\n<p>You want a compact representation of the dictionary with some sort of pre-computed index to make lookups fast.</p>\n\n<p>Some options:</p>\n\n<blockquote>\n  <p>Option 1: Create a BerkeleyDB database.</p>\n</blockquote>\n\n<p>Such a database allows greater-than and less-than queries.</p>\n\n<p>Pros: No database load time.</p>\n\n<p>Cons: Queries require disk accesses. Although, once pages are read by the OS they should be cached and subsequent reads should be fast.</p>\n\n<p>Note - I've written a boggle solver in perl using a Berkeley DB, so this approach is very viable.</p>\n\n<p>Similar to a BerkeleyDB is a CDB (Constant Database) for which there is also a Haskell package. However, a CDB only supports equality queries, so it's probably not usable for your application.</p>\n\n<blockquote>\n  <p>Option 2. Represent the dictionary simply as the sorted file of the words. Create a custom index to make queries efficient.</p>\n</blockquote>\n\n<p>A simple index could just be a 26*26*26 element array indicating the offset into the file of each three-letter prefix. Such a small index can be compiled into the program. Load the dictionary as a single (strict) ByteString.</p>\n\n<p>Use the index and binary search within the byte string to resolve queries.\nPerhaps the ByteString functions will work well here, but as a last resort you can always use an Int offset into the loaded dictionary as a \"pointer\" which you can move around to find the beginning of the next word.</p>\n\n<p>You might be able to compile the dictionary ByteString into the executable, but loading 4 MB of data shouldn't take too long - especially if it is already in the OS cache.</p>\n\n<p><strong>Update:</strong> An example of this second idea may be found <a href=\"https://github.com/erantapaa/hoggle\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 32495357, "answer_count": 1, "score": 3, "last_activity_date": 1441884636, "creation_date": 1441834154, "question_id": 32489464, "link": "https://stackoverflow.com/questions/32489464/templatehaskell-memory-usage-when-compiling", "title": "TemplateHaskell memory usage when compiling", "body": "<p>I have a memory consumption problem when using TemplateHaskell in RuzzSolver, one of my Haskell project. <a href=\"https://github.com/Zigazou/RuzzSolver\" rel=\"nofollow\">Sources of RuzzSolver are available on GitHub </a>.</p>\n\n<p>To achieve good performance, I load a ~380000 words dictionary into a <code>Tree</code> structure (from the containers package). This greatly speeds up the solving of grids but the loading itself takes some time (between 1 and 2 seconds depending on the CPU).</p>\n\n<p>I would like to create the structure directly during compile-time with TemplateHaskell.</p>\n\n<p>Therefore I transformed the dictionary loading:</p>\n\n<pre><code>-- Dictionary.hs, line 155\ngetDictionary :: String -&gt; IO Dictionary\ngetDictionary dictionaryFilePath = do\n    content &lt;- readFile dictionaryFilePath\n    return $ foldl (+++) [] (createTree &lt;$&gt; lines content)\n</code></pre>\n\n<p>into this function:</p>\n\n<pre><code>-- Dictionary.hs, line 164\ngetDictionaryQ :: String -&gt; Q Exp\ngetDictionaryQ dictionaryFilePath = do\n    content &lt;- runIO $ readFile dictionaryFilePath\n    lift $ foldl (+++) [] (createTree &lt;$&gt; lines content)\n</code></pre>\n\n<p><a href=\"https://github.com/Zigazou/RuzzSolver/blob/master/src/Dictionary.hs\" rel=\"nofollow\">view Dictionary.hs</a></p>\n\n<p>It allowed me to go from:</p>\n\n<pre><code>-- ruzzSolver.hs, line 68\ndictionary &lt;- getDictionary \"dictionary/ruzzdictionary.txt\"\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>-- ruzzSolver.hs, line 68\nlet dictionary = $(getDictionaryQ \"dictionary/ruzzdictionary.txt\")\n</code></pre>\n\n<p><a href=\"https://github.com/Zigazou/RuzzSolver/blob/master/src/ruzzSolver.hs\" rel=\"nofollow\">view ruzzSolver.hs</a></p>\n\n<p>It (should) works but it requires too much memory to compile! On my 8 Gb PC, I had to stop GHC when it reached consumption of 12 GB. Reducing the dictionary to 38000 words lets it compile but it still needs 3 to 4 GB.</p>\n\n<p>Is there a way to make GHC use less memory when compiling this TemplateHaskell code? Or another way to embed this structure into the executable?</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1441828673, "post_id": 32487905, "comment_id": 52836868, "body": "Functions are deterministic and can not give you a random value.  Your <code>randomInt</code> operations needs either a seed, generator, or to have <code>IO</code>."}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441831421, "post_id": 32488751, "comment_id": 52838179, "body": "actually, conceptually speaking: you can get/create a <code>StdGen</code> or any other <code>IO a</code> value anywhere in pure code \u2014 you just can&#39;t tell the actual runtime IO system to actually perform it (safely) :)"}, {"owner": {"reputation": 1119, "user_id": 2796613, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1286068684/picture?type=large", "display_name": "Hernan", "link": "https://stackoverflow.com/users/2796613/hernan"}, "edited": false, "score": 0, "creation_date": 1441832289, "post_id": 32488751, "comment_id": 52838618, "body": "Sorry, i made a mistake, i forgot copy the line of code in witch System.Random had been import. I will edit that. Thanks"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441837066, "post_id": 32488751, "comment_id": 52840641, "body": "Actually, you can create a StdGen without IO - just use <code>mkStdGen 3</code>. You just can&#39;t create a <i>random</i> StdGen."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441844764, "post_id": 32488751, "comment_id": 52842730, "body": "@user5402 indeed. The OP wanted randomness, though."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 1, "last_activity_date": 1441831107, "creation_date": 1441831107, "answer_id": 32488751, "question_id": 32487905, "link": "https://stackoverflow.com/questions/32487905/random-binary-list-of-lists-of-numbers/32488751#32488751", "title": "Random binary list of lists of numbers", "body": "<p>As it was pointed out in a comment, you can't create a StdGen without IO, but you can create one in your main function and pass it along in a parameter to your randomInt function, in this way:</p>\n\n<pre><code>import System.Random\n\nmain = do\n    a &lt;- newStdGen\n    putStrLn . show . randomInt 0 1 $ a\n\nrandomInt:: Int -&gt; Int -&gt; StdGen -&gt; (Int, StdGen)\nrandomInt x y s = do \n          randomR (x, y) s\n</code></pre>\n\n<p>The error message that you got about RandomR was caused by not importing System.Random.</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 1119, "user_id": 2796613, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1286068684/picture?type=large", "display_name": "Hernan", "link": "https://stackoverflow.com/users/2796613/hernan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441832379, "creation_date": 1441827697, "last_edit_date": 1441832379, "question_id": 32487905, "link": "https://stackoverflow.com/questions/32487905/random-binary-list-of-lists-of-numbers", "title": "Random binary list of lists of numbers", "body": "<p>I am trying to get a function that returns a list of lists of zeros or ones, obviously in a random way. </p>\n\n<p>Example:</p>\n\n<pre><code>getBinaryRandomList::Int-&gt;Int-&gt;[[Int]]\n\nPrelude&gt; getBinaryRandomList 4 3\n[[1,0,0,1],[1,1,0,1],[0,0,0,1], [0,1,0,1]]\n</code></pre>\n\n<p>So far, i have done this functions:</p>\n\n<pre><code>--tuns an `Int` into a `[Int]`. The [Int] would represent a binary number\nint2bin :: Int -&gt; [Int]\nint2bin 0 = []\nint2bin n = mod n 2 : int2bin (div n 2)\n</code></pre>\n\n<p>I have got stuck here, it throws an error at compilation time:</p>\n\n<pre><code>--returns a random number\nimport System.Random\nrandomInt::(Int,Int)-&gt;Int\nrandomInt x y = do \n                newStdGen\n                randomR(x, y) getStdGen\n</code></pre>\n\n<p>Compiling...</p>\n\n<pre><code>[1 of 1] Compiling Main             ( ag.hs, interpreted )\n\nag.hs:8:25: parse error on input `randomR'\n</code></pre>\n\n<p>The \"main\" function would be like this:</p>\n\n<pre><code>--n lists number\n--d digit number\ngetBinaryRandomList::Int-&gt;Int-&gt;[[Int]]\ngetBinaryRandomList d 0 = []\ngetBinaryRandomList d n = take d (int2bin(randomInt(0,50))) : getBinaryRandomList(n-1)\n</code></pre>\n\n<p>My approach is the next:</p>\n\n<ol>\n<li>Coding a function that creates an aleatory Int number between 0 an n. </li>\n</ol>\n\n<blockquote>\n<pre><code>randomInt::(Int,Int)-&gt;Int\n</code></pre>\n</blockquote>\n\n<ol start=\"2\">\n<li>Coding a function that converts those aleatory numbers into a list of binaries.</li>\n</ol>\n\n<blockquote>\n<pre><code>int2bin::Int-&gt;[Int]  % Already done\n</code></pre>\n</blockquote>\n\n<ol start=\"3\">\n<li>Forming a list with those numbers</li>\n</ol>\n\n<blockquote>\n<pre><code> getBinaryRandomList::Int-&gt;Int-&gt;[[Int]]\n</code></pre>\n</blockquote>\n\n<p>How could I implement that in Haskell?</p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1441832335, "creation_date": 1441832335, "answer_id": 32489068, "question_id": 32487111, "link": "https://stackoverflow.com/questions/32487111/entering-relations-to-database-using-persistent/32489068#32489068", "title": "Entering relations to database using Persistent", "body": "<p>The main trick here isn't in pulling out the function, that is easy:</p>\n\n<pre><code>f (g, t) = do\n  gid &lt;- insert g\n  tid &lt;- insert t\n  insert (GameTag gid tid)\n</code></pre>\n\n<p>The trick is knowing how to use this....  Standard <code>map</code> won't work alone, because the function is defined in a monad (you can use it, it will just give you a list of actions back without running them).</p>\n\n<pre><code>map f taggings -- returns just a list, type [ResourceT IO a], doesn't run anything\n</code></pre>\n\n<hr>\n\n<p>Here are two ways to actually run the actions from within main.</p>\n\n<pre><code>sequence (map f taggings) --sequentially runs the actions in the list\n</code></pre>\n\n<p>or, the more readable</p>\n\n<pre><code>forM taggings f\n</code></pre>\n\n<p>or, in the slightly more verbose</p>\n\n<pre><code>forM taggings $ \\tagging -&gt; do\n  f tagging\n</code></pre>\n\n<p>You also might want to look at <code>mapM</code>.  Also also should learn about <code>forM_</code> and <code>sequence_</code> to supress the (often useless) return values.</p>\n"}], "owner": {"reputation": 33, "user_id": 5314591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a66bb8dd1705d79be1eeccba1716a87b?s=128&d=identicon&r=PG&f=1", "display_name": "Niarn200", "link": "https://stackoverflow.com/users/5314591/niarn200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 32489068, "answer_count": 1, "score": 3, "last_activity_date": 1441832335, "creation_date": 1441824553, "question_id": 32487111, "link": "https://stackoverflow.com/questions/32487111/entering-relations-to-database-using-persistent", "title": "Entering relations to database using Persistent", "body": "<p>Starting out with Haskell and Yesod, probably getting a bit too far with Yesod relative to Haskell :) </p>\n\n<p>I build entities using Persistent via</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"][persistLowerCase|\nGame\n  title String\n  company String\n  UniqueTitle title\n  deriving Show\nTag\n  label String\n  description String Maybe\n  UniqueLabel label\n  deriving Show\nGameTag\n  gameId GameId\n  tagId TagId\n  UniqueGameTag gameId tagId\n|]\n\n-- Yesod related code ...\n</code></pre>\n\n<p>In main  I have</p>\n\n<pre><code>main :: IO ()\nmain = do\nlet taggings = fromFile :: [(Game, Tag)] -- fromFile code not included\nrunStderrLoggingT $ withSqlitePool \":inmemory:\" 10 $ \u03bbpool \u2192  liftIO $ do\nrunResourceT $ flip runSqlPool pool $ do\n  runMigration migrateAll\n  let (g, t) = head taggings\n  gid \u2190  insert g\n  tid \u2190  insert t\n  insert (GameTag gid tid)\nwarp 3000 $ App pool\n</code></pre>\n\n<p>Doing this I get the first relation into the database, and by selecting elements from the list I can add more 'by hand', but I can't figure out how to get all the relations into the database by somehow iterating over <code>taggings</code>. How do i define a function that I can map over <code>taggings ::[(Game, Tag)]</code> and inserts the game tags of the type <code>GameTag</code> constructed\nby Persistent?</p>\n"}, {"tags": ["haskell", "xml-conduit"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 2633351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dcbc02ff182062ac8f09635b9a4bf7c?s=128&d=identicon&r=PG", "display_name": "user2633351", "link": "https://stackoverflow.com/users/2633351/user2633351"}, "edited": false, "score": 0, "creation_date": 1442349879, "post_id": 32496514, "comment_id": 53044198, "body": "That solved it - (I was getting caught out by something else when I tried before!) I am continuously amazed by how nicely things in Haskell fit together!!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1441872825, "creation_date": 1441872825, "answer_id": 32496514, "question_id": 32486990, "link": "https://stackoverflow.com/questions/32486990/html-conduit-html-xhtml-in-haskell/32496514#32496514", "title": "html-conduit (HTML -&gt; XHTML in Haskell)", "body": "<p>You should be able to use the readFile function from html-conduit. What problems have you run into when trying to integrate the two libraries?</p>\n"}], "owner": {"reputation": 83, "user_id": 2633351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dcbc02ff182062ac8f09635b9a4bf7c?s=128&d=identicon&r=PG", "display_name": "user2633351", "link": "https://stackoverflow.com/users/2633351/user2633351"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441872825, "creation_date": 1441824080, "last_edit_date": 1441826510, "question_id": 32486990, "link": "https://stackoverflow.com/questions/32486990/html-conduit-html-xhtml-in-haskell", "title": "html-conduit (HTML -&gt; XHTML in Haskell)", "body": "<p>I am a beginner to Haskell.\nI have some code that uses xml-conduit, and it's all working well, I am able to transform it as I want.</p>\n\n<pre><code>let src_file = \"blah.xhtml\"\nDocument prologue root epilogue &lt;- readFile def{psDecodeEntities=decodeHtmlEntities} src_file\n\nlet root' = transform root\n\n-- And now we write out. Let's indent our output\nwriteFile def\n    { rsPretty = True\n    } \"output.xhtml\" $ Document prologue root' epilogue\n</code></pre>\n\n<p>The problem I have is that my input comes from html (from the web). I want to feed this into my function. Currently to do this, I have to run the commandline utility 'tidy' to normalise it to XHTML:</p>\n\n<pre><code>tidy -output blah.xhtml -asxhtml blah.html\n</code></pre>\n\n<p>This is working but is not obviously not ideal. I don't want to write a commandline wrapper around 'tidy' and I am sure that this must have been solved already! I have found the html-conduit package, but couldn't work out how to connect one to the other. \nIf someone could shed some light about how to go about this, or another library that would do what I want, I would be grateful. I tried reading the documentation for html-conduit but couldn't work out how the two libraries interoperate.</p>\n"}, {"tags": ["list", "haskell", "random", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1441820147, "post_id": 32485864, "comment_id": 52832706, "body": "Instead of storing a number in a reference and incrementing it, can you store the list of gauntlets in a reference and throw away the parts you&#39;ve already passed?"}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441831190, "post_id": 32485864, "comment_id": 52838061, "body": "@DanielWagner Maybe? How can a reference like that be made? How can I throw away parts of an infinite list?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1441834261, "post_id": 32485864, "comment_id": 52839574, "body": "Can you show some more code? I think @DanielWagner is suggesting that however you&#39;re holding the infinite list, you can drop the first element when you need to. This might mean having a recursive function call itself with the tail of the list, or it might mean modifying an <code>IORef</code> to take the head of the list it holds, or it might mean modifying the state in a <code>StateT</code>.... without seeing more code it&#39;s hard to make concrete suggestions."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1441835223, "post_id": 32485864, "comment_id": 52839927, "body": "@Qqwy: It should be pretty much analogous to however you are currently incrementing the <code>currentDistance</code>; but instead of using <code>(+)</code> to produce the new distance number, you would use <code>drop</code> to produce the new list of gauntlets."}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1441834301, "creation_date": 1441819782, "last_edit_date": 1441834301, "question_id": 32485864, "link": "https://stackoverflow.com/questions/32485864/haskell-procedurally-generating-level-without-slowing-down", "title": "Haskell: Procedurally generating level without slowing down", "body": "<p>To better learn Haskell, I'm trying to basically build a variant of the well-known Indie Game <a href=\"https://en.wikipedia.org/wiki/Super_Hexagon\" rel=\"nofollow\">Super Hexagon</a>.</p>\n\n<p>I am however having a problem with the level generation:</p>\n\n<p>Right now, level generation is done by having a list containing all different \"gauntlets\" (patterns of walls, implemented as <code>[[Bool]]</code>,a variable number of rows, each containing <code>True</code> or <code>False</code> for ); these are the building blocks of the level. Using the getStdGen() number generator, I'm able to create an infinite list of gauntlets.</p>\n\n<p>However, at a single time, we only want to render part of these. To keep track of if a gauntlet has already been passed or not, a second argument is introduced, containing the sum of the number of rows of all gauntlets before this one. (e.g,  <code>length (gauntletData currentRandomNumber) + snd $ randomGauntletList !! (n-1)</code>, where <code>randomGauntletList</code> has the type <code>[(Gauntlet,Integer)]</code></p>\n\n<p>The problem is in how this list is used in the rendering function and the updating function: <code>take 30 $ dropWhile (\\(_,distance) -&gt; currentDistance &gt; distance) randomGauntletList</code></p>\n\n<p>The <code>dropWhile</code> results in the program taking longer and longer to return the current 'starting point' of the list, therefore slowing down the game after +- 30 seconds.</p>\n\n<p>I'm out of my depth: Is there a way to solve this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1441813441, "post_id": 32483822, "comment_id": 52828730, "body": "It does <i>not</i> throw a pattern matching error. It throws a <i>type error</i>."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1441816720, "post_id": 32483822, "comment_id": 52830946, "body": "@pspencil: it&#39;s a misconception that <code>$</code> is a syntactic replacement for <code>()</code> \u2014 <code>$</code> is a function/operator; it&#39;s just the precedence rules that make <code>$</code> convenient in many cases \u2014 but there&#39;s no syntactic magic behind it."}], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 3329739, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lp_6UDfo3Ts/AAAAAAAAAAI/AAAAAAAABF8/vHuPrHMsgRw/photo.jpg?sz=128", "display_name": "sammex", "link": "https://stackoverflow.com/users/3329739/sammex"}, "is_accepted": false, "score": 4, "last_activity_date": 1441813671, "creation_date": 1441813671, "answer_id": 32484048, "question_id": 32483822, "link": "https://stackoverflow.com/questions/32483822/why-in-this-line-of-haskell-cannot-replace/32484048#32484048", "title": "Why in this line of haskell, $ cannot replace ()", "body": "<p>If I try to reproduce the error, it seems like GHC understands it like so:</p>\n\n<pre><code>(x : prime) $ filter (\\y -&gt; y `mod` x /= 0) xs\n</code></pre>\n\n<p>But you want it like that:</p>\n\n<pre><code>x : (prime $ filter (\\y -&gt; y `mod` x /= 0) xs)\n</code></pre>\n\n<p>So you just have to use bracket notation, I think.</p>\n"}, {"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1441817523, "post_id": 32484066, "comment_id": 52831398, "body": "<code>flip mod 0</code>? Are you sure? Shouldn&#39;t it be <code>flip mod x</code>? Moreover I&#39;d probably write <code>(&#47;= 0)</code> instead of <code>(&#47;=) 0</code>. And note that you calso replace <code>flip mod x</code> with <code>(`mod` x)</code>, so in the end: you get <code>((&#47;= 0) . (`mod` x))</code>"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 1, "last_activity_date": 1441822933, "last_edit_date": 1441822933, "creation_date": 1441813726, "answer_id": 32484066, "question_id": 32483822, "link": "https://stackoverflow.com/questions/32483822/why-in-this-line-of-haskell-cannot-replace/32484066#32484066", "title": "Why in this line of haskell, $ cannot replace ()", "body": "<p>When you write:</p>\n\n<pre><code>x : prime $ filter foo xs\n</code></pre>\n\n<p>It is interpreted as</p>\n\n<pre><code>(x : prime) $ filter foo xs\n</code></pre>\n\n<p>due to <code>(:)</code> having a higher precedence than <code>($)</code>. See the fixity declarations section of <a href=\"https://www.haskell.org/onlinereport/decls.html#Fixity_declarations\" rel=\"nofollow\">this report</a> for more.</p>\n\n<p>It fails because a list of functions (<code>(x:prime)</code>) is not a function, and cannot be used as such.</p>\n\n<hr>\n\n<p>If you want to make the function prettier, try this:</p>\n\n<pre><code>prime (x:xs) = x : prime (filter ((/= 0) . (`mod` x)) xs) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1441817374, "post_id": 32484484, "comment_id": 52831304, "body": "Or: <code>(x:) . prime $ ...</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1441817488, "post_id": 32484484, "comment_id": 52831378, "body": "@Bakuriu, I decided against that for this question."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1441815010, "creation_date": 1441815010, "answer_id": 32484484, "question_id": 32483822, "link": "https://stackoverflow.com/questions/32483822/why-in-this-line-of-haskell-cannot-replace/32484484#32484484", "title": "Why in this line of haskell, $ cannot replace ()", "body": "<p>Others have already explained the problem. Here is one solution:</p>\n\n<pre><code>prime (x:xs) = (x:) $ prime $ filter (\\y -&gt; y `mod` x /=0) xs\n</code></pre>\n\n<p>That is, you can use an <em>operator section</em> to express the application of <code>:</code> to <code>x</code> and then apply the result as you like.</p>\n"}, {"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 3, "last_activity_date": 1441829822, "last_edit_date": 1441829822, "creation_date": 1441816885, "answer_id": 32485068, "question_id": 32483822, "link": "https://stackoverflow.com/questions/32483822/why-in-this-line-of-haskell-cannot-replace/32485068#32485068", "title": "Why in this line of haskell, $ cannot replace ()", "body": "\n\n<p>First of all, it's a misconception that <code>$</code> is a syntactic replacement for <code>()</code> \u2014 <code>$</code> is a regular operator (which itself is a function that is simply infix by default); it's just the precedence rules that make <code>$</code> convenient in many cases \u2014 but there's no syntactic magic behind it.</p>\n\n<hr>\n\n<p>Now, ignoring the irrelevant bits, let's just concentrate on the part of the code that's causing the error:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>x :  prime (foo bar)\n</code></pre>\n\n<p>is the same as</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>x : (prime (foo bar))\n</code></pre>\n\n<p>because the <code>:</code> on the left has a lower precedence than the function application on the right.</p>\n\n<p>However</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>x : prime   $  foo bar\n</code></pre>\n\n<p>is the same as</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>(x : prime) $ (foo bar)\n</code></pre>\n\n<p>which is the same as</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>(x : prime)   (foo bar)\n</code></pre>\n\n<p>because the <code>:</code> on the left has a higher precedence than the <code>$</code> on the right.</p>\n\n<p>So the error comes from the fact that you're trying to apply the result of the expression <code>x : prime</code> to the argument <code>foo bar</code> as if <code>x : prime</code> were a function, but it's not, hence the type error.</p>\n\n<p>Solution? Either throw in some parentheses, or even better, don't use the <code>$</code> at all in this case. </p>\n"}], "owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 32485068, "answer_count": 4, "score": 0, "last_activity_date": 1441829822, "creation_date": 1441813059, "question_id": 32483822, "link": "https://stackoverflow.com/questions/32483822/why-in-this-line-of-haskell-cannot-replace", "title": "Why in this line of haskell, $ cannot replace ()", "body": "<p>The code is</p>\n\n<pre><code>prime (x:xs) = x:prime (filter (\\y -&gt; y `mod` x /=0) xs) \n</code></pre>\n\n<p>If I change it to </p>\n\n<pre><code>prime (x:xs) = x:prime $ filter (\\y -&gt; y `mod` x /=0) xs\n</code></pre>\n\n<p>There is a pattern matching error. </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1441810844, "post_id": 32482981, "comment_id": 52826928, "body": "Try this <code>stack exec -- myprogram-exe -i myfile.txt</code> ?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1441819187, "post_id": 32482981, "comment_id": 52832238, "body": "@sibi that&#39;s the correct approach. Can you write it in as an answer? <code>$(stack exec which foo)</code>  would also work on Unix shells"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 15, "last_activity_date": 1441849421, "creation_date": 1441849421, "answer_id": 32491722, "question_id": 32482981, "link": "https://stackoverflow.com/questions/32482981/how-do-i-pass-command-line-arguments-to-stack-exec/32491722#32491722", "title": "How do I pass command line arguments to stack exec", "body": "<p>Something like this should work:</p>\n\n<pre><code>stack exec -- myprogram-exe -i myfile.txt\n</code></pre>\n\n<p>Another way as Michael Snoyman says should be like this:</p>\n\n<pre><code>$(stack exec which foo)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14776, "user_id": 507423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ecee09b51d6a3d476e100119299fd01b?s=128&d=identicon&r=PG", "display_name": "lukad", "link": "https://stackoverflow.com/users/507423/lukad"}, "is_accepted": false, "score": 1, "last_activity_date": 1553505357, "creation_date": 1553505357, "answer_id": 55334526, "question_id": 32482981, "link": "https://stackoverflow.com/questions/32482981/how-do-i-pass-command-line-arguments-to-stack-exec/55334526#55334526", "title": "How do I pass command line arguments to stack exec", "body": "<p>You can also use <code>stack build</code> with the <code>--exec</code> flag to build and execute in one command. The arguments to the executable have to be included in the exec argument.</p>\n\n<pre><code>$ stack build --exec \"myexecutable arg1 arg2\"\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5356, "favorite_count": 2, "accepted_answer_id": 32491722, "answer_count": 2, "score": 11, "last_activity_date": 1553505357, "creation_date": 1441810618, "last_edit_date": 1488471044, "question_id": 32482981, "link": "https://stackoverflow.com/questions/32482981/how-do-i-pass-command-line-arguments-to-stack-exec", "title": "How do I pass command line arguments to stack exec", "body": "<p>I'm building a Haskell program that uses a command line argument parser using option-applicative library. Since I'm using stack to build and test my project, I would like to execute my program passing command line arguments using stack exec, like</p>\n\n<pre><code>stack exec myprogram-exe -i myfile.txt\n</code></pre>\n\n<p>but when I try to execute, Stack gives me the following message:</p>\n\n<pre><code>Usage: stack exec CMD [-- ARGS (e.g. stack ghc -- X.hs -o x)] ([--plain] |\n              ([--ghc-package-path] | [--no-ghc-package-path])\n              ([--stack-exe] | [--no-stack-exe]) [--package ARG])\n</code></pre>\n\n<p>Is there a way in which I can pass command line arguments to a program executed using Stack?</p>\n"}, {"tags": ["haskell", "idioms"], "comments": [{"owner": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 0, "creation_date": 1441809731, "post_id": 32481724, "comment_id": 52826058, "body": "Is your input only ever going to be one list?  If so, the former is clearly better.  By input I mean the list of numbers."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 0, "creation_date": 1441810449, "post_id": 32481724, "comment_id": 52826620, "body": "@itsbruce: Good point. Yes, only ever a single list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441815571, "post_id": 32481724, "comment_id": 52830280, "body": "Combining the <code>Applicative</code> or <code>Functor</code> instance for lists with <code>concat</code> feels very suspicious. <code>Functor+return+join=Monad</code>, and for lists, <code>concat=join</code>. So if you&#39;re mapping and then concatenating, <code>concatMap</code> or <code>=&lt;&lt;</code> may be more concise."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441815635, "post_id": 32481724, "comment_id": 52830323, "body": "@dfeuer: That sounds like it could be very enlightening (if I understood it; remember: beginner). Can you elaborate."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441815800, "post_id": 32481724, "comment_id": 52830438, "body": "<code>join :: Monad m =&gt; m (m a) -&gt; m a</code>. Can you implement that using <code>=&lt;&lt;</code>? Can you implement <code>=&lt;&lt;</code> using <code>fmap</code> and <code>join</code>? GHC&#39;s typed holes may help."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441816210, "post_id": 32481724, "comment_id": 52830671, "body": "@dfeuer: Now I&#39;m even more intrigued (but no more enlightened; remember: beginner!)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441817264, "post_id": 32481724, "comment_id": 52831246, "body": "I suggested some things in chat."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 0, "creation_date": 1441824622, "post_id": 32481724, "comment_id": 52834928, "body": "@itsbruce: Since it is only ever a single list, how about <code>mconcat</code> as suggested in @Lee&#39;s <a href=\"http://stackoverflow.com/a/32483045/656912\">answer</a>?"}, {"owner": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 1, "creation_date": 1441827421, "post_id": 32481724, "comment_id": 52836265, "body": "His is the best answer yet."}], "answers": [{"tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": false, "score": 9, "last_activity_date": 1441810231, "last_edit_date": 1441810231, "creation_date": 1441808716, "answer_id": 32482252, "question_id": 32481724, "link": "https://stackoverflow.com/questions/32481724/haskell-applicative-idiom/32482252#32482252", "title": "Haskell Applicative idiom?", "body": "<p>Personally for your example I would write</p>\n\n<pre><code>f = (^2)\ng = (+10)\n\nlet xs = [1,2,3,4,10]\nin (map f xs) ++ (map g . tail $ reverse xs)\n</code></pre>\n\n<p>In a very Applicative \"mood\", I would replace the part after <code>in</code> by</p>\n\n<pre><code>((++) &lt;$&gt; map f &lt;*&gt; map g . tail . reverse) xs\n</code></pre>\n\n<p>which I actually don't think is more readable in this case. If you don't directly understand what it means, spend some time on understanding the <code>Applicative</code> instance of <code>((-&gt;) a)</code> (<code>Reader</code>).</p>\n\n<p>I think the choice really depends on what you're trying to do, i.e. what your output is supposed to mean. In your example the task is very abstract (basically just showcasing what <code>Applicative</code> can do), so it's not directly obvious which version to use.</p>\n\n<p>The <code>Applicative</code> instance of <code>[]</code> intuitively relates to combinations, so I would use it in a situation like this:</p>\n\n<pre><code>-- I want all pair combinations of 1 to 5\n(,) &lt;$&gt; [1..5] &lt;*&gt; [1..5]\n</code></pre>\n\n<p>If you would have many functions, and you would want to try all combinations of these functions with a number of arguments, I would indeed use the <code>[]</code> instance of <code>Applicative</code>. But if what you're after is a concatenation of different transformations I would write it as such (which I did, above).</p>\n\n<p>Just my 2 cents as a medium-experience Haskeller.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1441809292, "creation_date": 1441809292, "answer_id": 32482476, "question_id": 32481724, "link": "https://stackoverflow.com/questions/32481724/haskell-applicative-idiom/32482476#32482476", "title": "Haskell Applicative idiom?", "body": "<p>I sometimes struggle with the similar problem. You have single element but multiple functions.</p>\n\n<p>Usually we have multiple elements, and single function: so we do:</p>\n\n<pre><code>map f xs\n</code></pre>\n\n<p>But it's not the problem in Haskell. The dual is as easy:</p>\n\n<pre><code>map ($ x) fs\n</code></pre>\n\n<p>The fact, that your <code>x</code> is actually a list, and you want to <code>concat</code> after the <code>map</code>, so you do</p>\n\n<pre><code>concatMap ($ xs) fs\n</code></pre>\n\n<hr>\n\n<p>I cannot really understand what happens in the second equation directly, even I can reason it does the same as first one using applicative laws.</p>\n"}, {"comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 1, "creation_date": 1441813187, "post_id": 32483045, "comment_id": 52828544, "body": "This is quite interesting. It did take me some time to understand, but <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-255\" rel=\"nofollow noreferrer\">the source for the function instance of <code>Monoid</code></a> clears things up.  <code>(f &lt;$&gt;)</code> evaluates to <code>([f] &lt;*&gt;)</code> which has type <code>[a] -&gt; [a]</code>, its return type <code>[a]</code> is an instance of <code>Monoid</code>, making the function an instance of <code>Monoid</code> itself."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1441825493, "post_id": 32483045, "comment_id": 52835332, "body": "@SamvanHerwaarden: I see that <code>(f &lt;$&gt;) :: [a] -&gt; [a]</code> but am having trouble visualizing what kind of a function <code>mconcat [(f &lt;$&gt;), (g &lt;$&gt;).tail.reverse]</code> is. I see that it must be <code>(Num b) =&gt; [b] -&gt; [b]</code>, but can&#39;t quite visualize what it &quot;looks&quot; like."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 1, "creation_date": 1441826072, "post_id": 32483045, "comment_id": 52835606, "body": "I said <code>[a] -&gt; [a]</code> but you&#39;re right about the <code>Num</code> constraint, that holds here as well (I was sloppy and omitted it). <code>mconcat</code> intersperses a list with <code>mappend</code> so we get <code>mconcat [(f &lt;$&gt;), (g &lt;$&gt;) . tail . reverse] = \\x -&gt; (([f] &lt;$&gt;) x) `mappend` (((g &lt;$&gt;) . tail . reverse) x)</code> so all functions in the list are supplied with the argument supplied to <code>mconcat func</code>, the outputs of these functions are then concatenated with <code>mappend</code>. In our case the functions output lists so <code>mappend = (++)</code>, for other monoids the corresponding <code>mappend</code> would be used."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1441827376, "post_id": 32483045, "comment_id": 52836247, "body": "@SamvanHerwaarden: Yeah, I guess what feels weird (and also cool and powerful) is that <code>mappend</code> not only &quot;concatenates&quot; functions, but also the outputs of the functions. It&#39;s also a bit weird that application of &quot;concatenated&quot; functions even works (because I think of it naively as still being a list of functions rather than one). Should those aspects be obvious, or are they merely a consequence of how <code>mappend</code> is implanted for functions?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 1, "creation_date": 1441829716, "post_id": 32483045, "comment_id": 52837352, "body": "It was not obvious to me, I only got it after checking the <code>Monoid</code> instance for functions. Still, I think there are not many other ways to implement the instance meaningfully, so in that sense I would say it is the &#39;obvious&#39; implementation. I agree that it seems weird, cool and powerful, personally I wouldn&#39;t quickly use it in code I expect other people to read later on."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 1, "creation_date": 1441831888, "post_id": 32483045, "comment_id": 52838417, "body": "I was too fast saying I wouldn&#39;t use it in code I expect people to read. I will probably run into situations where this pattern expresses exactly what I intend to do. (Maybe I would add a comment to clarify what&#39;s going on though ;) )"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1441833139, "post_id": 32483045, "comment_id": 52839088, "body": "@SamvanHerwaarden: Exactly. It&#39;s not that obvious to me either, except in the sense that there really aren&#39;t that many other rational ways to implement it (given the required signature). Also, I agree about use, and here I think it&#39;s perfect."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1441921015, "post_id": 32483045, "comment_id": 52883035, "body": "@SamvanHerwaarden: One clarification, now that I ponder this: you say that the outputs of the <code>mappend</code>ed functions are themselves <code>mappend</code>ed. Does that mean that for <code>(f &lt;&gt; g) x</code> to work, not only must <code>f</code> and <code>g</code> be Monoids (which functions are); but also that <code>f x</code> and <code>f g</code> must be Monoids also (which they are here, since <code>[]</code> is a Monoid)?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1441922048, "post_id": 32483045, "comment_id": 52883471, "body": "@raxacoricofallapatorius - Functions are only monoids if the return type <code>b</code> is a monoid, see update."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441922787, "post_id": 32483045, "comment_id": 52883721, "body": "Excellent, thanks! So <code>((+1) &lt;&gt; (^2)) 5</code> won&#39;t work because nether <code>+</code> nor <code>^</code> return Monoids (<code>Int</code> is not a Monoid?; I thought it was)?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441923088, "post_id": 32483045, "comment_id": 52883832, "body": "@raxacoricofallapatorius - Plain <code>Int</code>s are not monoids, you need to wrap them in <code>Sum</code> or <code>Product</code> to select the monoid instance you want e.g. <code>getSum $ Sum . (+1) &lt;&gt; Sum . (^2) $ 4</code>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441923436, "post_id": 32483045, "comment_id": 52883960, "body": "Ah good, so it makes sense at least: a plain <code>Int</code> <i>isn&#39;t</i> a Monoid (though lots of sites say \u2014 somewhat imprecisely I gather \u2014 that they are)."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1441924842, "post_id": 32483045, "comment_id": 52884383, "body": "@raxacoricofallapatorius - Monoids comprise of a set, an associative binary operation and an identity element for the operation so it is imprecise to state that some type is a monoid without also specifying the operation as well. <code>Int</code>s form monoids in a few ways e.g <code>+</code> and <code>*</code>, and Haskell uses <code>newtype</code> wrappers to let you choose the instance you want. There are similar wrappers for <code>Bool</code> and <code>Maybe a</code> defined in <code>Data.Monoid</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441925630, "post_id": 32483045, "comment_id": 52884623, "body": "That makes sense. So when people say &quot;<code>Int</code> forms a Monoid&quot;, they don&#39;t mean it <i>is a</i> Monoid, but that it <i>can be</i>, suitably wrapped and packaged with a suitable operation."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 10, "last_activity_date": 1441922024, "last_edit_date": 1441922024, "creation_date": 1441810780, "answer_id": 32483045, "question_id": 32481724, "link": "https://stackoverflow.com/questions/32481724/haskell-applicative-idiom/32483045#32483045", "title": "Haskell Applicative idiom?", "body": "<p>Both your functions <code>(f &lt;$&gt;)</code> and <code>(g &lt;$&gt;).tail.reverse</code> return a monoid type (list in this case) so you can use <code>mconcat</code> to convert them into a single function. Then you can apply this function directly to the input list instead of wrapping it in another list and using <code>concatMap</code>:</p>\n\n<pre><code>mconcat [(f &lt;$&gt;), (g &lt;$&gt;).tail.reverse] $ [1,2,3,4,10]\n</code></pre>\n\n<p>To expand on this, a function <code>a -&gt; b</code> is an instance of <code>Monoid</code> if <code>b</code> is a monoid. The <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-255\" rel=\"nofollow\">implementation</a> of <code>mappend</code> for such functions is:</p>\n\n<pre><code>mappend f g x = f x `mappend` g x\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>mappend f g = \\x -&gt; (f x) `mappend` (g x)\n</code></pre>\n\n<p>so given two functions <code>f</code> and <code>g</code> which return a monoid type <code>b</code>, <code>f</code>mappend<code>g</code> returns a function which applies its argument to <code>f</code> and <code>g</code> and combines the results using the <code>Monoid</code> instance of <code>b</code>.</p>\n\n<p><code>mconcat</code> has type <code>Monoid a =&gt; [a] -&gt; a</code> and combines all the elements of the input list using <code>mappend</code>.</p>\n\n<p>Lists are monoids where <code>mappend</code> == <code>(++)</code> so</p>\n\n<pre><code>mconcat [(f &lt;$&gt;), (g &lt;$&gt;).tail.reverse]\n</code></pre>\n\n<p>returns a function like</p>\n\n<pre><code>\\x -&gt; (fmap f x) ++ (((fmap g) . tail . reverse) x)\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "accepted_answer_id": 32483045, "answer_count": 3, "score": 8, "last_activity_date": 1441922024, "creation_date": 1441807427, "last_edit_date": 1441817524, "question_id": 32481724, "link": "https://stackoverflow.com/questions/32481724/haskell-applicative-idiom", "title": "Haskell Applicative idiom?", "body": "<p>I'm new to Haskell and am puzzling over how to best express some operations in the most idiomatic and clear way. Currently (there will be more to come) I'm puzzling over <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\"><code>&lt;*&gt;</code></a> (I'm not even sure what to call that).</p>\n\n<p>For example, if I have, say</p>\n\n<pre><code>f = (^2)\ng = (+10)\n</code></pre>\n\n<p>as representative functions (in practice they are more complex, but the key thing here is that they are different and distinct), then</p>\n\n<pre><code>concatMap ($ [1,2,3,4,10]) [(f &lt;$&gt;), (g &lt;$&gt;) . tail . reverse] \n</code></pre>\n\n<p>and</p>\n\n<pre><code>concat $ [(f &lt;$&gt;), (g &lt;$&gt;) . tail . reverse] &lt;*&gt; [[1,2,3,4,10]]\n</code></pre>\n\n<p>accomplish the same thing. </p>\n\n<p>Is one of these more idiomatic Haskell, does one imply something an experienced reader of Haskell that the other does not. Perhaps there are additional (better) ways to express exactly the same thing. Are there conceptual differences between the two approaches that a novice Haskeller like myself may be missing?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441839784, "post_id": 32481418, "comment_id": 52841526, "body": "How does knowing that something is in the union of <code>as</code> and <code>bs</code> help you if you don&#39;t know where it is in that union? I&#39;d be interested in seeing some of the actual code."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 4, "creation_date": 1441854217, "post_id": 32481418, "comment_id": 52844953, "body": "If you just want to know if it &#39;Has&#39; a given element then what you are doing is sound. If what you wanted instead was the first match for the field then you&#39;d have a problem. e.g. if instead of giving back a Bool it gave back an offset into the HList you&#39;d not be able to use unsafeCoerceConstraint."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1441886423, "post_id": 32481418, "comment_id": 52861948, "body": "@EdwardKMETT, thanks. That pretty much answers my question concerning the safety of the approach."}], "answers": [{"comments": [{"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1441838550, "post_id": 32488218, "comment_id": 52841153, "body": "Cool approach. This very neatly sidesteps the issue I was running into.  I will update my question to explain more about the motivation for this."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1441842525, "post_id": 32488218, "comment_id": 52842233, "body": "This is definitely the right approach for this problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1441912507, "post_id": 32488218, "comment_id": 52878915, "body": "Thanks, @EdwardKMETT. What do you think of the GADT approach I added? Is there a better way to do that? I&#39;m not a big fan of the <code>First x (y &#39;: ys) ~ Just (S n)</code> constraint, since it doesn&#39;t build on <code>First x ys ~ Just n</code>, but I don&#39;t see a way around it as yet."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1441974173, "post_id": 32488218, "comment_id": 52904400, "body": "Nice. I read the hasochism paper very recently, so this is a good example for me to see. Just to make sure that I correctly understand, is the class <code>ElemGC</code> (which isn&#39;t used in your GHCi example) used to implicitly create an <code>ElemG</code> (like what NATTY is in the hasochism paper)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 1, "creation_date": 1441974906, "post_id": 32488218, "comment_id": 52904877, "body": "@AndrewThaddeusMartin, it is used in the example! I used the <code>elemG</code> function. Yes, it implicitly creates an <code>ElemG</code>. I&#39;ve not read the paper yet, but I guess I should."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1441988015, "post_id": 32488218, "comment_id": 52913644, "body": "@dfeuer Ah, indeed it is used! Sorry I missed that."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442282950, "post_id": 32488218, "comment_id": 53008104, "body": "If you want to avoid closed type families you can use overlapping instances:       instance {-# OVERLAPPABLE #-} ElemGC x (x &#39;: xs) where elemG _ _ = Here;      instance {-# OVERLAPS #-} ElemGC x ys =&gt; ElemGC x (y &#39;: ys) where elemG p _ = There (elemG p (Proxy :: Proxy ys));"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1442285738, "post_id": 32488218, "comment_id": 53008809, "body": "@EdwardKMETT, I finally realized just now how the new <code>OVERLAPS</code> and <code>OVERLAPPABLE</code> improve over the old <code>OverlappingInstances</code> for this. Thanks!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1442282276, "last_edit_date": 1442282276, "creation_date": 1441829013, "answer_id": 32488218, "question_id": 32481418, "link": "https://stackoverflow.com/questions/32481418/unsafe-entailment-with-haskell-constraints/32488218#32488218", "title": "Unsafe entailment with Haskell constraints", "body": "<p>I don't know if this will suit your other needs, but it accomplishes this particular purpose. I'm not too good with type families myself, so it's not clear to me what your type family can actually be used for.</p>\n\n<pre><code>{-# LANGUAGE ...., UndecidableInstances #-}\ntype family Or (x :: Bool) (y :: Bool) :: Bool where\n  Or 'True x = 'True\n  Or x 'True = 'True\n  Or x y = 'False\n\ntype family Is (x :: k) (y :: k) where\n  Is x x = 'True\n  Is x y = 'False\n\ntype family HasElem (x :: k) (xs :: [k]) :: Bool where\n  HasElem x '[] = 'False\n  HasElem x (y ': z) = Or (Is x y) (HasElem x z)\n\ncontainerEntailsLarger :: proxy1 x -&gt; proxy2 xs -&gt; proxy3 b -&gt;\n                          (HasElem x xs ~ 'True) :- (HasElem x (b ': xs) ~ 'True)\ncontainerEntailsLarger _p1 _p2 _p3 = Sub Dict\n</code></pre>\n\n<h3>An approach using GADTs</h3>\n\n<p>I've been having trouble letting go of this problem. Here's a way to use a GADT to get good evidence while using type families and classes to get a good interface.</p>\n\n<pre><code>-- Lots of extensions; I don't think I use ScopedTypeVariables,\n-- but I include it as a matter of principle to avoid getting\n-- confused.\n{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, UndecidableInstances #-}\n{-# LANGUAGE TypeFamilies, TypeOperators #-}\n{-# LANGUAGE DataKinds, PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE GADTs #-}\n\n-- Some natural numbers\ndata Nat = Z | S Nat deriving (Eq, Ord, Show)\n\n-- Evidence that a type is in a list of types\ndata ElemG :: k -&gt; [k] -&gt; * where\n  Here :: ElemG x (x ': xs)\n  There :: ElemG x xs -&gt; ElemG x (y ': xs)\nderiving instance Show (ElemG x xs)\n\n-- Take `ElemG` to the class level.\nclass ElemGC (x :: k) (xs :: [k]) where\n  elemG :: proxy1 x -&gt; proxy2 xs -&gt; ElemG x xs\n\n-- There doesn't seem to be a way to instantiate ElemGC\n-- directly without overlap, but we can do it via another class.\ninstance ElemGC' n x xs =&gt; ElemGC x xs where\n  elemG = elemG'\n\ntype family First (x :: k) (xs :: [k]) :: Nat where\n  First x (x ': xs) = 'Z\n  First x (y ': ys) = 'S (First x ys)\n\nclass First x xs ~ n =&gt; ElemGC' (n :: Nat) (x :: k) (xs :: [k]) where\n  elemG' :: proxy1 x -&gt; proxy2 xs -&gt; ElemG x xs\n\ninstance ElemGC' 'Z x (x ': xs) where\n  elemG' _p1 _p2 = Here\n\ninstance (ElemGC' n x ys, First x (y ': ys) ~ 'S n) =&gt; ElemGC' ('S n) x (y ': ys) where\n  elemG' p1 _p2 = There (elemG' p1 Proxy)\n</code></pre>\n\n<p>This actually seems to work, at least in simple cases:</p>\n\n<pre><code>*Hello&gt; elemG (Proxy :: Proxy Int) (Proxy :: Proxy '[Int, Char])\nHere\n\n*Hello&gt; elemG (Proxy :: Proxy Int) (Proxy :: Proxy '[Char, Int, Int])\nThere Here\n\n*Hello&gt; elemG (Proxy :: Proxy Int) (Proxy :: Proxy '[Char, Integer, Int])\nThere (There Here)\n</code></pre>\n\n<p>This doesn't support the precise entailment you desire, but I believe the <code>ElemGC'</code> recursive case is probably the closest you can get with such an informative constraint, at least in GHC 7.10.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 1, "accepted_answer_id": 32488218, "answer_count": 1, "score": 14, "last_activity_date": 1442282276, "creation_date": 1441806658, "last_edit_date": 1441839535, "question_id": 32481418, "link": "https://stackoverflow.com/questions/32481418/unsafe-entailment-with-haskell-constraints", "title": "Unsafe entailment with Haskell constraints", "body": "<p>I'm playing around with the <code>constraints</code> package (for GHC Haskell). I have a type family for determining if a type-level list contains an element:</p>\n\n<pre><code>type family HasElem (x :: k) (xs :: [k]) where\n  HasElem x '[] = False                                                                               \n  HasElem x (x ': xs) = True                                                                          \n  HasElem x (y ': xs) = HasElem x xs\n</code></pre>\n\n<p>This works, but one thing it doesn't give me is the knowledge that</p>\n\n<pre><code>HasElem x xs   entails   HasElem x (y ': xs)\n</code></pre>\n\n<p>since the type family isn't an inductive definition of the \"is element of\" statement (like you would have in agda). I'm pretty sure that, until GADTs are promotable to the type level, there is no way to express list membership with a data type.</p>\n\n<p>So, I've used the <code>constraints</code> package to write this:</p>\n\n<pre><code>containerEntailsLarger :: Proxy x -&gt; Proxy xs -&gt; Proxy b -&gt; (HasElem x xs ~ True) :- (HasElem x (b ': xs) ~ True)\ncontainerEntailsLarger _ _ _ = unsafeCoerceConstraint\n</code></pre>\n\n<p>Spooky, but it works. I can pattern match on the entailment to get what I need. What I'm wondering is if it can ever cause a program to crash. It seems like it couldn't, since <code>unsafeCoerceConstraint</code> is defined as:</p>\n\n<pre><code>unsafeCoerceConstraint = unsafeCoerce refl\n</code></pre>\n\n<p>And in GHC, the type level is elided at runtime. I thought I'd check though, just to make sure that doing this is ok.</p>\n\n<p>--- EDIT ---</p>\n\n<p>Since no one has given an explanation yet, I thought I would expand the question a little. In the unsafe entailment I'm creating, I only expect a type family. If I did something that involved typeclass dictionaries instead like this: </p>\n\n<pre><code>badEntailment :: Proxy a -&gt; (Show a) :- (Ord a)\nbadEntailment _ = unsafeCoerceConstraint\n</code></pre>\n\n<p>I assume that this would almost certainly be capable of causing a segfault. Is this true? and if so, what makes it different from the original?</p>\n\n<p>--- EDIT 2 ---</p>\n\n<p>I just wanted to provide a little background for why I am interested in this. One of my interests is making a usable encoding of relational algebra in Haskell. I think that no matter how you define functions to work on type-level lists, there will be obvious things that aren't proved correctly. For example, a constraint (for semijoin) that I've had before looked like this (this is from memory, so it might not be exact):</p>\n\n<pre><code>semijoin :: ( GetOverlap as bs ~ Overlap inAs inBoth inBs\n            , HasElem x as, HasElem x (inAs ++ inBoth ++ inBs)) =&gt; ...\n</code></pre>\n\n<p>So, it should be obvious (to a person) that if I take union of two sets, that it contains an element <code>x</code> that was in <code>as</code>, but I'm not sure that it's possible the legitimately convince the constraint solver of this. So, that's my motivation for doing this trick. I create entailments to cheat the constraint solver, but I don't know if it's actually safe.</p>\n"}, {"tags": ["haskell", "leksah"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 1666821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a98e29984d87477d870b6498e3305f?s=128&d=identicon&r=PG", "display_name": "tshinbum", "link": "https://stackoverflow.com/users/1666821/tshinbum"}, "is_accepted": false, "score": 1, "last_activity_date": 1452246755, "last_edit_date": 1495540319, "creation_date": 1452246755, "answer_id": 34674027, "question_id": 32478513, "link": "https://stackoverflow.com/questions/32478513/run-a-single-file-and-access-console-in-leksah/34674027#34674027", "title": "run a single file and access console in leksah", "body": "<p>I came the same path a few days ago.\nI did not find a way to use leksah in a ghci-with-gui-like mode, so i decided to go along the leksah way.</p>\n\n<p>First, I downloaded the manual, which is a bit hidden at <a href=\"http://leksah.org/leksah_manual.pdf\" rel=\"nofollow noreferrer\">http://leksah.org/leksah_manual.pdf</a>.</p>\n\n<p>In chapter 3, Hello world example, there is a Hello World example which explains the creation of a workspace and a package. Then you just put your file into the src directory. For very small examples, just add the code to Main.hs.\nThen follow the guideline in chapter 7, Debugger and Interpreter mode.\nFor example, to evaluate an expression you select it, rightclick and select Evaluate. The result is displayed in \u00b4the output window. \nSimilarly you get the type of expressions.</p>\n\n<p>However, there is no console window where you could type to provide input (stdin) for your program, see also <a href=\"https://stackoverflow.com/questions/7425184/using-leksah-debugger-with-programs-that-use-readln-and-similar\">Using Leksah debugger with programs that use readLn and similar</a>.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1452246755, "creation_date": 1441798623, "question_id": 32478513, "link": "https://stackoverflow.com/questions/32478513/run-a-single-file-and-access-console-in-leksah", "title": "run a single file and access console in leksah", "body": "<p>I am starting out in haskell (with learnyouahaskell.com) and used the GHCI console so far. Now I installed leksah but I cannot find a way of running my previous files without creating new workspaces/modules etc, which I do not know anything about yet. </p>\n\n<p>How can I run a simple file (like <code>:l</code> in GHCI) in leksah?</p>\n\n<p>After running the file, how can I access the console in leksah? (For e.g. using/testing the functions I created in that file.)</p>\n"}, {"tags": ["haskell", "functional-programming", "combinatorics", "cartesian-product"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 5, "creation_date": 1441791958, "post_id": 32476077, "comment_id": 52813155, "body": "<code>allProduct = sequence</code>."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1441792022, "post_id": 32476077, "comment_id": 52813199, "body": "@Zeta but Hoogle says the type is <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code> while I need <code>[[a]] -&gt; [[a]]</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441792081, "post_id": 32476077, "comment_id": 52813251, "body": "<code>m</code> is the list type constructor (<code>[]</code>), in this case. You can always make the type of <code>allProduct</code> more specific, if you want: <code>allProduct = sequence :: [[a]] -&gt; [[a]]</code>."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441792420, "post_id": 32476077, "comment_id": 52813498, "body": "@Jubobs wow it works... how should I search hoogle in the future in order to catch monadic types?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1441792519, "post_id": 32476077, "comment_id": 52813574, "body": "What did you try? Searching <a href=\"https://www.haskell.org/hoogle/?hoogle=%5B%5Ba%5D%5D+-%3E+%5B%5Ba%5D%5D\" rel=\"nofollow noreferrer\"><code>[[a]] -&gt; [[a]]</code></a> returns a hit for <code>sequence</code>."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441792614, "post_id": 32476077, "comment_id": 52813648, "body": "@Jubobs  I saw that the type was not exactly the same so I wrongly thought it was of no use to me. I will learn to check also similar types when searching hoogle, thanks for the tip :)"}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441792953, "post_id": 32476077, "comment_id": 52813862, "body": "@Jubobs I have another doubt: you say <i>You can always make the type of allProduct more specific</i> but how can <code>[[a]]</code> be more specific than anything if <code>a</code> already indicates any type?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1441793073, "post_id": 32476077, "comment_id": 52813954, "body": "<code>[[a]]</code> is more specific than <code>m [a]</code> and <code>[m a]</code>, because <code>m</code> (in the type signature of <code>sequence</code>) stands for <i>any</i> monad, but <code>[]</code> is just <i>one</i> instance of <code>Monad</code>."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441793312, "post_id": 32476077, "comment_id": 52814102, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/89147/discussion-between-caridorc-and-jubobs\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441793880, "post_id": 32476604, "comment_id": 52814475, "body": "<i>We use QuickCheck to prove that [...]</i> &quot;Proove&quot; is too strong a term. How about &quot;increase our confidence&quot;?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441794226, "post_id": 32476604, "comment_id": 52814711, "body": "@Jubobs Changed it to &quot;test that it&#39;s likely the same&quot; is more honest, I think. But I concur, that wasn&#39;t a &quot;proof&quot;."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 4, "creation_date": 1441795068, "post_id": 32476604, "comment_id": 52815250, "body": "This is a great answer."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441816643, "post_id": 32476604, "comment_id": 52830910, "body": "QuickCheck is like pseudo-proving compared to Agda&#39;s or Idris&#39; proper proofs."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1551574441, "post_id": 32476604, "comment_id": 96689804, "body": "<code>sequence</code> is wrong because <code>sequence []</code> is empty."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1551635290, "post_id": 32476604, "comment_id": 96702915, "body": "@PyRulez <code>allProduct []</code> isn&#39;t defined by OP, so it&#39;s ambiguous. That being said, the Ruby code ends up with the <code>nil</code> on the empty list, so there is no valid base case for a Haskell translation. The ambiguous behaviour is also mentioned in the answer, although not in detail: <i>&quot;Note that this variant isn&#39;t 100% correct, as <code>allProduct []</code> is <code>[[]]</code>&quot;</i>. Ask OP what <code>allProduct []</code> should be. &#175;\\_(\u30c4)_/&#175;"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 14, "last_activity_date": 1596185615, "last_edit_date": 1596185615, "creation_date": 1441793038, "answer_id": 32476604, "question_id": 32476077, "link": "https://stackoverflow.com/questions/32476077/cartesian-product-over-a-list-of-lists-in-haskell/32476604#32476604", "title": "Cartesian product over a list of lists in Haskell", "body": "<p><sub>Note: This post is written in literate Haskell. Save it as\n*.lhs and load it in GHCi.</sub></p>\n<pre><code>&gt; -- remove this line if you don't have QuickCheck installed\n&gt; import Test.QuickCheck \n</code></pre>\n<hr />\n<h1>A simple recursive variant</h1>\n<p>Lets start with a simple variant of <code>allProduct</code>:</p>\n<pre><code>&gt; allProductFirst :: [[a]] -&gt; [[a]]\n&gt; allProductFirst []     = [[]]\n&gt; allProductFirst (x:xs) =\n</code></pre>\n<p>Now <code>x</code> itself is a list again. Let's say that <code>allProduct xs</code> would give us the product of the other lists.</p>\n<pre><code>&gt;    let rest = allProductFirst xs\n</code></pre>\n<p>What do we need to do? We need to create a new list for every element in <code>x</code> and concat them together:</p>\n<pre><code>&gt;    in concatMap (\\k -&gt; map (k:) rest) x\n</code></pre>\n<p>Note that this variant isn't 100% correct, as <code>allProduct []</code> is <code>[[]]</code>.</p>\n<h1>A monadic variant</h1>\n<p>How would this look like if we were to use the <code>Monad</code> instance of <code>[]</code>?</p>\n<h2>Using <code>do</code> notation</h2>\n<pre><code>&gt; allProduct' :: [[a]] -&gt; [[a]]\n&gt; allProduct' []     = [[]]\n&gt; allProduct' (x:xs) = do\n</code></pre>\n<p>We want to take every element of <code>x</code></p>\n<pre><code>&gt;      elementOfX &lt;- x\n</code></pre>\n<p>and cons it onto all the possible suffixes our list can have:</p>\n<pre><code>&gt;      rest       &lt;- allProduct' xs\n&gt;      return $ elementOfX : rest\n</code></pre>\n<p>This means we're basically evaluation every action inside our list monad. But there's a function for that: <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code>. If we use <code>m ~ []</code>, its type can be specialized to <code>sequence :: [[a]] -&gt; [[a]]</code>.</p>\n<h2>Using <code>sequence</code></h2>\n<p>We end up with our last variant:</p>\n<pre><code>&gt; allProduct :: [[a]] -&gt; [[a]]\n&gt; allProduct = sequence\n</code></pre>\n<h1>Testing the result</h1>\n<p>We use QuickCheck to test that it's likely the same as <code>allProductFirst</code>\nand <code>allProduct'</code>:</p>\n<pre><code>&gt; main :: IO ()\n&gt; main = do\n&gt;   quickCheck $\n&gt;     forAll (choose (1,8)) $ \\n -&gt; -- number of lists\n&gt;     forAll (choose (1,4)) $ \\s -&gt; -- number of elements per list\n&gt;     forAll (vectorOf n $ vector s) $ \\xs -&gt;\n&gt;       allProduct'     xs === allProduct (xs :: [[Integer]]) .&amp;.\n&gt;       allProductFirst xs === allProduct xs\n</code></pre>\n<p>Use <code>:main</code> in GHCi, <code>runhaskell</code> or compile and run your program, and you\nshould end up with 100 passed tests.</p>\n"}], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1482, "favorite_count": 1, "accepted_answer_id": 32476604, "answer_count": 1, "score": 5, "last_activity_date": 1596185615, "creation_date": 1441791478, "last_edit_date": 1582787739, "question_id": 32476077, "link": "https://stackoverflow.com/questions/32476077/cartesian-product-over-a-list-of-lists-in-haskell", "title": "Cartesian product over a list of lists in Haskell", "body": "<p>Given a list of lists of length <code>x</code> where all the sublists have the same length <code>y</code>, output the <code>y^x</code> lists of length <code>x</code> that contain one item from each sublist.</p>\n\n<p>Example (<code>x = 3</code>, <code>y = 2</code>):</p>\n\n<pre><code>[ [1, 2], [3, 4], [5, 6] ]\n</code></pre>\n\n<p>Output (<code>2^3 == 8</code> different outputs):</p>\n\n<pre><code>[ [1, 3, 5], [1, 4, 5], [1, 3, 6], [1, 4, 6],\n  [2, 3, 5], [2, 4, 5], [2, 3, 6], [2, 4, 6] ]\n</code></pre>\n\n<h1>My research / Work</h1>\n\n<p><strong>Ruby</strong></p>\n\n<p>I wrote actual code to perform this task, but in Ruby, as it is the language I am most comfortable with.</p>\n\n<pre><code>def all_combinations(lst)\n   lst.inject {|acc, new| acc.product(new).map(&amp;:flatten) }\nend\n</code></pre>\n\n<p><strong>Type</strong></p>\n\n<p>Input is a list of lists that contains items of type a and so is the output.</p>\n\n<pre><code>allProduct :: [[a]] -&gt; [[a]]\n</code></pre>\n\n<p><strong>Cartesian product, flattening and folding</strong></p>\n\n<p>Looking at my Ruby solution makes me think that a good use of these functions may be enough to solve the problem. The problem is that while the Cartesian Product outputs a list of tuples but I need a list of lists.</p>\n"}, {"tags": ["haskell", "happstack"], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1441843500, "post_id": 32490187, "comment_id": 52842447, "body": "Yeah, something like that was my backup plan. It doesn&#39;t allow me to reuse existing <code>Indexable</code> instances, but I don&#39;t actually have an immediate use case for that. You&#39;re right that it&#39;s come out rather nice; maybe I will see if I can get it included upstream."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1441837955, "creation_date": 1441837955, "answer_id": 32490187, "question_id": 32473704, "link": "https://stackoverflow.com/questions/32473704/with-ixset-can-i-build-an-indexable-wrapper-around-an-arbitrary-indexable-type/32490187#32490187", "title": "With IxSet, can I build an Indexable wrapper around an arbitrary Indexable type?", "body": "<p>The <code>ixset</code> library seems to conflate \"key generation functions\" with \"indices\", which makes the <code>Indexable</code> class a bit more powerful than the author probably intended. (In particular, <code>empty</code> is allowed to already have some elements in it -- which makes the name <code>empty</code> a bit weird!) You can fix this client-side with a little work, by introducing a new type that is just for the functions (and therefore <em>cannot</em> contain any elements):</p>\n\n<pre><code>data IxFun a = forall key. (Typeable key, Ord key) =&gt; IxFun (a -&gt; [key])\n\nixFun' :: (Typeable key, Ord key) =&gt; (a -&gt; [key]) -&gt; IxFun a\nixFun' = IxFun\n\ninstance Contravariant IxFun where\n    contramap f (IxFun g) = IxFun (g . f)\n\nixFromIxFun :: IxFun a -&gt; Ix a\nixFromIxFun (IxFun f) = ixFun f\n</code></pre>\n\n<p>Then you can build some typeclass support, as in:</p>\n\n<pre><code>class IndexableFun a where funs :: [IxFun a]\n\n-- turn any IndexableFun into an Indexable\ndefaultEmpty :: IndexableFun a =&gt; IxSet a\ndefaultEmpty = ixSet (map ixFromIxFun funs)\n</code></pre>\n\n<p>Instances of this class look very similar to instances of <code>Indexable</code>, but instead of <code>empty = ixSet [ixFun foo, ...]</code> you now write <code>funs = [ixFun' foo, ...]</code>. Now it is easy to write your instance:</p>\n\n<pre><code>instance (IndexableFun a, Typeable a) =&gt; IndexableFun (Keyed a) where\n    funs = ixFun' (\\v -&gt; [key v]) : map (contramap value) funs\n\ninstance (IndexableFun a, Typeable a) =&gt; Indexable (Keyed a) where\n    empty = defaultEmpty\n</code></pre>\n\n<p>You can even readily adapt the implementation of <code>ixGen</code> to this type:</p>\n\n<pre><code> ixGen' :: forall proxy a b. (Data a, Ord b, Typeable b) =&gt; proxy b -&gt; IxFun a\n ixGen' _ = ixFun' (flatten :: a -&gt; [b])\n</code></pre>\n\n<p>Integrating this kind of approach into the <code>ixset</code> package itself would be a very nice touch, and shouldn't be too hard. Though do contact the maintainer first, as this could potentially be a somewhat invasive change: one would presumably want to modify the <code>Indexable</code> class itself rather than creating a convoluted extra-class-plus-default-instance setup like the one described above, which would not be backwards compatible.</p>\n"}], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1441837955, "creation_date": 1441784549, "question_id": 32473704, "link": "https://stackoverflow.com/questions/32473704/with-ixset-can-i-build-an-indexable-wrapper-around-an-arbitrary-indexable-type", "title": "With IxSet, can I build an Indexable wrapper around an arbitrary Indexable type?", "body": "<p>What I'd like to be able to do is something like the following:</p>\n\n<pre><code>import Data.IxSet\n\nnewtype Key a = Key Integer\n  deriving (Eq, Ord, Show)\n\ndata Keyed a = Keyed { key :: (Key a), value :: a }\n  deriving (Eq, Ord, Show)\n\ninstance Indexable a =&gt; Indexable (Keyed a)\n    where empty = ixSet $ ixFun (\\k -&gt; [key k]) : _somehow_reuse_indices_of_a_\n</code></pre>\n\n<p>The idea is that if some data structure is Indexable, I should be able to index a <code>Keyed</code> wrapping it by the same types (plus an index on <code>Key a</code>).</p>\n\n<p>It should be easy to convert the functions passed to <code>ixFun</code> in the wrapped type's indices to work with <code>Keyed</code> instead of <code>a</code>: just compose with <code>value</code>. But I can't find any way of actually getting at those functions.</p>\n\n<p>I also had a look at the ixset-typed package; the version of Indexable there actually provides a list of indices, rather than an empty IxSet. This would appear to be much more amenable to reusing the indices, but the \"list of indices\" is a custom type which doesn't export its constructors, so I don't appear to be able to get at them.</p>\n\n<p>Have I missed anything that would support this kind of usage?</p>\n"}, {"tags": ["haskell", "ghc", "existential-type"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1441790105, "post_id": 32473227, "comment_id": 52811834, "body": "Maybe you could get better answers if you explained <i>why</i> you want these scatter/gather functions?"}, {"owner": {"reputation": 2667, "user_id": 383188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b9f4333859c623061b3447a36ce6f97a?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/383188/andrew"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441799371, "post_id": 32473227, "comment_id": 52818185, "body": "It&#39;s to represent different languages within an interpreter, preserving the constraints from each kind of &quot;source&quot; in the typed languages. I think Sam has actually given me the answer that I&#39;m looking for, I just need to think about it for a bit before accepting it."}], "answers": [{"comments": [{"owner": {"reputation": 2667, "user_id": 383188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b9f4333859c623061b3447a36ce6f97a?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/383188/andrew"}, "edited": false, "score": 0, "creation_date": 1441799487, "post_id": 32474249, "comment_id": 52818268, "body": "I think this works. I may not need the phantom type, but the raw idea I can take is to construct a larger wrapper for the intermediate so that each of the different forms of intermediate can project onto it without loss."}, {"owner": {"reputation": 2667, "user_id": 383188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b9f4333859c623061b3447a36ce6f97a?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/383188/andrew"}, "edited": false, "score": 0, "creation_date": 1441799627, "post_id": 32474249, "comment_id": 52818372, "body": "Yup, this can be extended onto the full problem. Cheers, I hadn&#39;t thought of over-approximating the language in the middle that the gathers are defined. Very nice."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 0, "last_activity_date": 1441787062, "last_edit_date": 1441787062, "creation_date": 1441786140, "answer_id": 32474249, "question_id": 32473227, "link": "https://stackoverflow.com/questions/32473227/how-can-i-perform-a-scatter-gather-operation-on-types-in-haskell/32474249#32474249", "title": "How can I perform a scatter/gather operation on types in Haskell?", "body": "<p>If I understand you correctly you need something like the following:</p>\n\n<pre><code>module Main ( main ) where\n\n-- Different kinds of wrapper data types\ndata WrapperA = A Int | B String\ndata WrapperB = C Int | D Float\n\n-- A single intermediate data type (with phantom type)\ndata Intermediate a = E Int | F String\n\n-- Generic scatter and gather functions\nclass Wrapped a where\n  scatter :: Wrapped a =&gt; a -&gt; Intermediate a\n  gather :: Wrapped a =&gt; Intermediate a -&gt; String\n\n-- Specific scatter and gather implementations\ninstance Wrapped WrapperA where\n  scatter (A i) = E i\n  scatter (B s) = F s\n  gather (E i) = show i\n  gather (F s) = s\n\ninstance Wrapped WrapperB where\n  scatter (C i) = E i\n  scatter (D f) = F $ show f\n  gather (E i) = show i\n  gather (F s) = s ++ \" was a float\"\n\n-- Beautiful composability\ncombined :: Wrapped a =&gt; a -&gt; String\ncombined = gather . scatter\n\nwrapperAexample1 = A 10\nwrapperAexample2 = B \"testing\"\nwrapperBexample1 = C 11\nwrapperBexample2 = D 12.4\n\nmain :: IO ()\nmain = do print $ combined wrapperAexample1\n          print $ combined wrapperAexample2\n          print $ combined wrapperBexample1\n          print $ combined wrapperBexample2\n</code></pre>\n\n<p>The main issue seems to be that you have an intermediate type which can have different kinds of content, but this is constant for different wrappers. Still, depending on the kind of wrapper, you want the <code>gather</code> function to behave differently.</p>\n\n<p>To do this, I would define the <code>Intermediate</code> type to specify the kinds of values that can be held in the intermediate stage, and give it a phantom type parameter (to remember what kind of wrapper it originated from). You can then define a class to hold the <code>scatter</code> and <code>gather</code> functions, and define these differently for different kinds of wrappers.</p>\n\n<p>The code above compiles without errors for me, and gives the following output:</p>\n\n<pre><code>\"10\"\n\"testing\"\n\"11\"\n\"12.4 was a float\"\n</code></pre>\n\n<p>As you can see, the <code>WrapperB</code>/<code>D Float</code> input is treated differently than the <code>WrapperA</code>/<code>B String</code> (it is tagged as a float value, even after it has been converted to a String). This is because in the <code>Intermediate</code> representation it is remembered that the origin is a <code>WrapperB</code>: the one is of type <code>Intermediate WrapperA</code>, the other of <code>Intermediate WrapperB</code>.</p>\n\n<p>If, on the other hand, you don't actually want the gather function to behave differently for different wrappers, you can simply take that out of the class and take out the phantom type. The easiest way to let ghc know that the type in the intermediate stage can be <code>Int</code> or <code>String</code> seems to me to still define something like the <code>Intermediate</code> type, rather than use just <code>a</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 1, "last_activity_date": 1441791259, "creation_date": 1441791259, "answer_id": 32475995, "question_id": 32473227, "link": "https://stackoverflow.com/questions/32473227/how-can-i-perform-a-scatter-gather-operation-on-types-in-haskell/32475995#32475995", "title": "How can I perform a scatter/gather operation on types in Haskell?", "body": "<blockquote>\n  <p>The idea is that I can use (scatter.gather) :: Wrapping -> Output.\n  There will of course be several different variations on both the\n  scatter and the gather function (with each scatter variant having a\n  unique Wrappingn datatype, but the set of intermediate types will\n  always be the same) and I want to be able to cleanly compose them.</p>\n</blockquote>\n\n<p>If I understand correctly, you'd like to have different <code>Wrapping</code> types but the intermediate <code>a</code> type is constantly <code>Either Int String</code>. We can just reflect this information in our classes:</p>\n\n<pre><code>data Wrapping = A Int\n              | B String\n\nclass Fanout wrap where\n    scatter :: wrap -&gt; Either Int String\n\ninstance Fanout Wrapping where\n    scatter (A n) = Left n\n    scatter (B str) = Right str\n\nclass Fanin output where\n    gather :: Either Int String -&gt; output\n\ninstance Fanin String where\n    gather = either show id\n\ncombined :: Wrapping -&gt; String\ncombined = gather . scatter    \n</code></pre>\n\n<p>Also, this use case doesn't seem especially amenable to type classes, from what I can glean from the question. In particular, we can get rid of <code>Fanin</code>, and then <code>combined = either show id . scatter</code> looks better to my eyes than the previous definition. </p>\n\n<p>The type class solution makes sense here only if just a single <code>Either Int String -&gt; a</code> or <code>a -&gt; Either Int String</code> function makes sense for each <code>a</code>, and you'd like to enforce this. </p>\n"}], "owner": {"reputation": 2667, "user_id": 383188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b9f4333859c623061b3447a36ce6f97a?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/383188/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 32474249, "answer_count": 2, "score": 3, "last_activity_date": 1441791259, "creation_date": 1441783165, "question_id": 32473227, "link": "https://stackoverflow.com/questions/32473227/how-can-i-perform-a-scatter-gather-operation-on-types-in-haskell", "title": "How can I perform a scatter/gather operation on types in Haskell?", "body": "<p>I have tree that hold contains nodes of different types. These are tagged using a datatype:</p>\n\n<pre><code>data Wrapping = A Int\n              | B String \n</code></pre>\n\n<p>I want to write two functions:</p>\n\n<pre><code>scatter :: Wrapping -&gt; a\ngather :: a -&gt; Output\n</code></pre>\n\n<p>The idea is that I can use (scatter.gather) :: Wrapping -> Output. There will of course be several different variations on both the scatter and the gather function (with each scatter variant having a unique Wrappingn datatype, but the set of intermediate types will always be the same) and I want to be able to cleanly compose them.</p>\n\n<p>The issue that I have is that the type parameter a is not really free, it is a small explicit set of types (here it is {Int,String}). If I try to encode what I have so far into Haskell typeclasses then I get to:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\ndata Wrapping = A Int | B String\n\nclass Fanin a where\n        gather :: a -&gt; String\ninstance Fanin Int where\n        gather x = show x\ninstance Fanin String where\n        gather x = x\n\nclass Fanout a where\n        scatter :: Fanout a =&gt; Wrapping -&gt; a\ninstance Fanout Int where\n        scatter (A n) = n\ninstance Fanout String where\n        scatter (B x) = x\n\ncombined = gather.scatter\n</code></pre>\n\n<p>The two classes typecheck fine but obviously the final line throws errors because ghc knows that the type parameters do match on every case, only on the two that I have defined. I've tried various combinations of extending one class from the other:</p>\n\n<pre><code>class Fanin a =&gt; Fanout a where ...\nclass Fanout a =&gt; Fanin a where ...\n</code></pre>\n\n<p>Finally I've looked at GADTs and existential types to solve this but I am stumbling around in the dark. I can't find a way to express a legal qualified type signature to GHC, where I've tried combinations of:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nclass (forall a. Fanout a) =&gt; Fanin a where\nclass (forall a. Fanin a) =&gt; Fanout a where\n</code></pre>\n\n<p>Question: how do I express to GHC that I want to restrict <code>a</code> to only the two types in the set?</p>\n\n<p>I get the feeling that the solution lies in one of the techniques that I've looked at but I'm too lost to see what it is...</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441760625, "post_id": 32468799, "comment_id": 52800617, "body": "It&#39;s best to give some context. What led you to ask this question? What did you consider before asking?"}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": false, "score": 4, "last_activity_date": 1441757185, "creation_date": 1441757185, "answer_id": 32469013, "question_id": 32468799, "link": "https://stackoverflow.com/questions/32468799/need-help-understanding-what-this-haskell-function-does/32469013#32469013", "title": "Need help understanding what this Haskell function does", "body": "<p><code>f</code> and <code>id</code> remain the same throughout each recursive call, so let\u2019s simplify it a bit:</p>\n\n<pre><code>f0 [] = id\nf0 (x:xs) = f x (f0 xs)\n</code></pre>\n\n<p>That means <code>f0 xs</code> could expand to:</p>\n\n<pre><code>f x1 (f x2 (f x3 id))\n</code></pre>\n\n<p>which kind of looks like <code>foldr</code>. That\u2019s because it is <code>foldr</code>.</p>\n\n<pre><code>Prelude&gt; foldr (+) 0 [1, 2, 3]\n6\nPrelude&gt; f0 (+) 0 [1, 2, 3]\n6\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1441782670, "post_id": 32469016, "comment_id": 52807250, "body": "Clicked the review button for the first time, and guess which post came up?  Thanks for catching my typos."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 4, "last_activity_date": 1441782582, "last_edit_date": 1441782582, "creation_date": 1441757209, "answer_id": 32469016, "question_id": 32468799, "link": "https://stackoverflow.com/questions/32468799/need-help-understanding-what-this-haskell-function-does/32469016#32469016", "title": "Need help understanding what this Haskell function does", "body": "<p>All right.  Let\u2019s walk through it.  This is a recursive function with a base case and a recursion step.  It\u2019s named <code>f0</code> and has three arguments, <code>f</code>, <code>id</code> (which confusingly has the same name as a function in the Prelude), and <code>(x:xs)</code>.  Unfortunately, it has no type signature, but we can already tell that the third is some kind of list.  So its signature will be something like <code>f0 :: a -&gt; b -&gt; [c] -&gt; d</code></p>\n\n<p>The base case is simple: if the third argument is an empty list, the function returns <code>id</code>, which therefore has the type the function returns.  So these two types are the same and we can refine the type signature to <code>f0 :: a -&gt; b -&gt; [c] -&gt; b</code>.</p>\n\n<p>The recursive case gets called only when the list <code>(x:xs)</code> is not empty.  It calls <code>f</code>, which therefore must be a function of two arguments, with <code>x</code> (the head of the list) as the first argument to <code>f</code>, and a call to <code>f0</code> as the second argument.  Since the return value of <code>f</code> is a valid return value of <code>f0</code>, they must have the same return type.  We can therefore deduce at this point that, if <code>b</code> is the return type of <code>f0</code> and <code>[a]</code> the type of the third argument, the signature of this function must be:</p>\n\n<p><code>f0 :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></p>\n\n<p>Now, let\u2019s take a closer look at the second argument of <code>f</code> in the recursion step.  It calls <code>f0 f id xs</code>, which is the exact same call, but to the tail of the list.  (As a result, the list gets one element shorter with each step, until it\u2019s empty and we reach the base case, so the algorithm must terminate.)  Therefore, <code>f0 (+) 0.0 [1,2,3]</code> expands to <code>1 + (2 + (3 + 0.0) )</code>.  This is a function from the Prelude; can you tell which?</p>\n\n<p><strong>Edit:</strong> The other answer spoiled it, but I\u2019ll note that the names are hints, too.  <code>f0</code> and <code>f</code> are <em>functions</em>, <code>id</code> is short for <em>identity element</em> (because the intended model is that you add it to the last element of the list and get that same element back, the way that adding 3 + 0.0 gets you the floating-point number 3.0), and <em>x:xs</em> is the conventional way to refer to list arguments in recursive functions.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1441784734, "creation_date": 1441784734, "answer_id": 32473777, "question_id": 32468799, "link": "https://stackoverflow.com/questions/32468799/need-help-understanding-what-this-haskell-function-does/32473777#32473777", "title": "Need help understanding what this Haskell function does", "body": "<p>To decipher code I sometimes find it useful to exploit <code>Data.SimpleReflect</code> and run a few tests.</p>\n\n<pre><code>&gt; import Debug.SimpleReflect\n&gt; let f0 f id [] = id ; f0 f id (x:xs) = f x (f0 f id xs)\n&gt; f0 f a [b,c,d,e]\nf b (f c (f d (f e a)))\n</code></pre>\n\n<p>Looks familiar... is it <code>foldr</code>?</p>\n\n<pre><code>&gt; foldr f a [b,c,d,e]\nf b (f c (f d (f e a)))\n</code></pre>\n\n<p>OK, it is.</p>\n"}], "owner": {"reputation": 51, "user_id": 4556703, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ddb3e451925a47750a10b8b200b6aa20?s=128&d=identicon&r=PG&f=1", "display_name": "pcd13", "link": "https://stackoverflow.com/users/4556703/pcd13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 3, "score": -4, "last_activity_date": 1441784734, "creation_date": 1441755363, "question_id": 32468799, "link": "https://stackoverflow.com/questions/32468799/need-help-understanding-what-this-haskell-function-does", "title": "Need help understanding what this Haskell function does", "body": "<p>Not sure exactly what this does, or what to enter into the function to find a pattern in the outputs</p>\n\n<pre><code>f0 f id [] = id\n\nf0 f id (x:xs) = f x (f0 f id xs)\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "attoparsec"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441783958, "post_id": 32467696, "comment_id": 52807975, "body": "Please edit your question and make your code self-contained. In particular, add the required import statements. Also, have you considered using the applicative style for <code>parseLogEntry</code>? It wouldn&#39;t affect performance, but it would readability."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441754544, "post_id": 32468477, "comment_id": 52799216, "body": "It is definitely possible, in general, to get a <code>Partial</code>, feed it some more input, and get another <code>Partial</code>. The easiest way to run an <code>attoparsec</code> parser (if you&#39;re not using something like <code>pipes</code> or <code>conduit</code>, is to use <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.0.1/docs/Data-Attoparsec-ByteString.html#g:5\" rel=\"nofollow noreferrer\"><code>parseWith</code></a>, which will never return <code>Partial</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441755870, "post_id": 32468477, "comment_id": 52799551, "body": "Added solution based on <code>parseWith</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1441755796, "last_edit_date": 1441755796, "creation_date": 1441752795, "answer_id": 32468477, "question_id": 32467696, "link": "https://stackoverflow.com/questions/32467696/operating-on-parsed-data-with-attoparsec/32468477#32468477", "title": "Operating on parsed data with attoparsec", "body": "<p>You have to make your unit of parsing a single log entry rather than a list of log entries.</p>\n\n<p>It's not pretty, but here is an example of how to interleave parsing and processing:</p>\n\n<p>(Depends on <code>bytestring</code>, <code>attoparsec</code> and <code>mtl</code>)</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction, FlexibleContexts #-}\n\nimport qualified Data.ByteString.Char8 as BS\nimport qualified Data.Attoparsec.ByteString.Char8 as A\nimport Data.Attoparsec.ByteString.Char8 hiding (takeWhile)\nimport Data.Char\nimport Control.Monad.State.Strict\n\naWord :: Parser BS.ByteString\naWord = skipSpace &gt;&gt; A.takeWhile isAlphaNum\n\ngetNext :: MonadState [a] m =&gt; m (Maybe a)\ngetNext = do\n  xs &lt;- get\n  case xs of\n    [] -&gt; return Nothing\n    (y:ys) -&gt; put ys &gt;&gt; return (Just y)\n\nloop iresult =\n  case iresult of\n    Fail _ _ msg  -&gt; error $ \"parse failed: \" ++ msg\n    Done x' aword -&gt; do lift $ process aword; loop (parse aWord x')\n    Partial _     -&gt; do\n      mx &lt;- getNext\n      case mx of\n        Just y  -&gt; loop (feed iresult y)\n        Nothing -&gt; case feed iresult BS.empty of\n                     Fail _ _ msg  -&gt; error $ \"parse failed: \" ++ msg\n                     Done x' aword -&gt; do lift $ process aword; return ()\n                     Partial _     -&gt; error $ \"partial returned\"  -- probably can't happen\n\nprocess :: Show a =&gt; a -&gt; IO ()\nprocess w = putStrLn $ \"got a word: \" ++ show w\n\ntheWords = map BS.pack [ \"this is a te\", \"st of the emergency \", \"broadcasting sys\", \"tem\"]\n\n\nmain = runStateT (loop (Partial (parse aWord))) theWords\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li>We parse a <code>aWord</code> at a time and call <code>process</code> after each word is recognized.</li>\n<li>Use <code>feed</code> to feed the parser more input when it returns a <code>Partial</code>.</li>\n<li>Feed the parser an empty string when there is no more input left.</li>\n<li>When <code>Done</code> is return, process the recognized word and continue with <code>parse aWord</code>.</li>\n<li><code>getNext</code> is just an example of a monadic function which gets the next unit of input. Replace it with your own version - i.e. something that reads the next line from a file.</li>\n</ul>\n\n<h1>Update</h1>\n\n<p>Here is a solution using <code>parseWith</code> as @dfeuer suggested:</p>\n\n<pre><code>noMoreInput = fmap null get\n\nloop2 x = do\n  iresult &lt;- parseWith (fmap (fromMaybe BS.empty) getNext) aWord x\n  case iresult of\n    Fail _ _ msg  -&gt; error $ \"parse failed: \" ++ msg\n    Done x' aword -&gt; do lift $ process aword;\n                        if BS.null x'\n                           then do b &lt;- noMoreInput\n                                   if b then return ()\n                                        else loop2 x'\n                           else loop2 x'\n    Partial _     -&gt; error $ \"huh???\" -- this really can't happen\n\nmain2 = runStateT (loop2 BS.empty) theWords\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 0, "creation_date": 1441887244, "post_id": 32468597, "comment_id": 52862467, "body": "I <i>think</i> I understand this but I&#39;m not sure. I&#39;m interpreting this as: 1 - get array (I presume lazily) of lines from the input file; 2 - setup a foldl&#39; using a function &#39;go&#39;, with an initial value of &#39;initialStats&#39;, which I presume I&#39;d initialise as Stats record with all 0s; 3 - define the function &#39;go&#39;, which parses each line and either returns an error or calls a function that updates the initialStats record; 4 - I don&#39;t know what in stats&#39; is doing here. Am I understanding correctly up to the point at 4 where I don&#39;t? If not, are you able to clarify? Thanks for your help."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 0, "creation_date": 1441901637, "post_id": 32468597, "comment_id": 52872844, "body": "You&#39;ve got it right. <code>stats&#39;</code> is the updated version of <code>stats</code>. For instance, if <code>stats</code> is just a Int which is counting the number of lines parsed, then you can define <code>stats&#39;</code> as <code>stats+1</code>. Folds are the way you loop in Haskell while carrying around a piece of state from iteration to iteration. Also see <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow noreferrer\">this wiki page</a> for more information about strictness and folds."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1442075396, "post_id": 32468597, "comment_id": 52939314, "body": "fwiw I modified this for use with the standard streaming libraries below."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1441753815, "creation_date": 1441753815, "answer_id": 32468597, "question_id": 32467696, "link": "https://stackoverflow.com/questions/32467696/operating-on-parsed-data-with-attoparsec/32468597#32468597", "title": "Operating on parsed data with attoparsec", "body": "<p>If each log entry is exactly one line, here's a simpler solution:</p>\n\n<pre><code>do loglines &lt;- fmap BS.lines $ BS.readfile \"input-file.log\"\n   foldl' go initialStats loglines\n   where\n     go stats logline = \n        case parseOnly yourParser logline of\n          Left e  -&gt; error $ \"oops: \" ++ e\n          Right r -&gt; let stats' = ... combine r with stats ...\n                     in stats'\n</code></pre>\n\n<p>Basically you are just reading the file line-by-line and calling <code>parseOnly</code> on each line and accumulating the results.</p>\n"}, {"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1441975249, "last_edit_date": 1441975249, "creation_date": 1441972716, "answer_id": 32522999, "question_id": 32467696, "link": "https://stackoverflow.com/questions/32467696/operating-on-parsed-data-with-attoparsec/32522999#32522999", "title": "Operating on parsed data with attoparsec", "body": "<p>This is properly done with a streaming library</p>\n\n<pre><code>main = do\n  f:_ &lt;- getArgs\n  withFile f ReadMode $ \\h -&gt; do\n       result &lt;- foldStream $ streamProcess $ streamHandle h\n       print result\nwhere\n streamHandle  = undefined\n streamProcess = undefined\n foldStream    = undefined\n</code></pre>\n\n<p>where the blanks can be filled by any streaming library, e.g.</p>\n\n<pre><code> import qualified Pipes.Prelude as P\n import Pipes\n import qualified Pipes.ByteString as PB\n import Pipes.Group (folds)\n import qualified Control.Foldl as L\n import Control.Lens (view) -- or import Lens.Simple (view), or whatever\n\n streamHandle =  Pipes.ByteStream.fromHandle :: Handle -&gt; Producer ByteString IO ()\n</code></pre>\n\n<p>in that case we might then divide the labor further thus:</p>\n\n<pre><code> streamProcess :: Producer ByteString m r -&gt; Producer LogEntry m r\n streamProcess p =  streamLines p &gt;-&gt; lineParser\n\n streamLines :: Producer ByteString m r -&gt; Producer ByteString m r\n streamLines p = L.purely fold L.list (view (Pipes.ByteString.lines p)) &gt;-&gt; P.map B.toStrict\n\n lineParser :: Pipe ByteString LogEntry m r\n lineParser = P.map (parseOnly line_parser) &gt;-&gt; P.concat -- concat removes lefts\n</code></pre>\n\n<p>(This is slightly laborious because pipes is sensible persnickety about accumulating lines, and memory generally: we are just trying to get a producer of individual strict bytestring lines, and then to convert that into a producer of parsed lines, and then to throw out bad parses, if there are any. With io-streams or conduit, things will be basically the same, and that particular step will be easier.)</p>\n\n<p>We are now in a position to fold over our <code>Producer LogEntry IO ()</code>. This can be done explicitly using <code>Pipes.Prelude.fold</code>, which makes a strict left fold. Here we will just cop the structure from user5402</p>\n\n<pre><code> foldStream str = P.fold go initial_stats id\n  where\n   go stats_till_now new_entry = undefined\n</code></pre>\n\n<p>If you get used to the use of the <code>foldl</code> library and the application of a fold to a Producer with <code>L.purely fold some_fold</code>, then you can build <code>Control.Foldl.Fold</code>s for your LogEntries out of components and slot in different requests as you please.</p>\n\n<p>If you use <code>pipes-attoparsec</code> and include the newline bit in your parser, then you can just write</p>\n\n<pre><code> handleToLogEntries :: Handle -&gt; Producer LogEntry IO ()\n handleToLogEntries h = void $ parsed my_line_parser (fromHandle h) &gt;-&gt; P.concat\n</code></pre>\n\n<p>and get the <code>Producer LogEntry IO ()</code> more directly.  (This ultra-simple way of writing it will, however, stop at a bad parse; dividing on lines first will be faster than using attoparsec to recognize newlines.) This is very simple with io-streams too, you would write something like </p>\n\n<pre><code>import qualified System.IO.Streams as Streams\n\nio :: Handle -&gt; IO ()\nio h = do  \n    bytes &lt;- Streams.handleToInputStream h\n    log_entries &lt;- Streams.parserToInputStream my_line_parser bytes\n    fold_result &lt;- Stream.fold go initial_stats log_entries\n    print fold_result\n</code></pre>\n\n<p>or to keep with the structure above:</p>\n\n<pre><code> where \n  streamHandle = Streams.handleToInputStream\n  streamProcess io_bytes = \n      io_bytes &gt;&gt;= Streams.parserToInputStream my_line_parser\n  foldStream io_logentries =\n      log_entries &gt;&gt;= Stream.fold go initial_stats \n</code></pre>\n\n<p>Either way, <code>my_line_parser</code> should return a <code>Maybe LogEntry</code> and should recognize the newline. </p>\n"}], "owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 3, "accepted_answer_id": 32468597, "answer_count": 3, "score": 5, "last_activity_date": 1441975249, "creation_date": 1441748484, "question_id": 32467696, "link": "https://stackoverflow.com/questions/32467696/operating-on-parsed-data-with-attoparsec", "title": "Operating on parsed data with attoparsec", "body": "<h2>Background</h2>\n\n<p>I've written a logfile parser using attoparsec. All my smaller parsers succeed, as does the composed final parser. I've confirmed this with <a href=\"https://hackage.haskell.org/package/hspec-attoparsec-0.1.0.1/docs/Test-Hspec-Attoparsec.html\">tests</a>. But I'm stumbling over performing operations with the parsed stream.</p>\n\n<h2>What I've tried</h2>\n\n<p>I started by trying to pass the successfully parsed input to a function. But all the seems to get is <code>Done ()</code>, which I'm presuming means the logfile has been consumed by this point.</p>\n\n<pre><code>prepareStats :: Result Log -&gt; IO ()\nprepareStats r =\ncase r of\n    Fail _ _ _ -&gt; putStrLn $ \"Parsing failed\"\n    Done _ parsedLog -&gt; putStrLn \"Success\" -- This now has a [LogEntry] array. Do something with it.\n\nmain :: IO ()\nmain = do\n[f] &lt;- getArgs\nlogFile &lt;- B.readFile (f :: FilePath)\nlet results = parseOnly parseLog logFile\nputStrLn \"TBC\"\n</code></pre>\n\n<h2>What I'm trying to do</h2>\n\n<p>I want to accumulate some stats from the logfile as I consume the input. For example, I'm parsing response codes and I'd like to count how many 2** responses there were and how many 4/5** ones. I'm parsing the number of bytes each response returned as Ints, and I'd like to efficiently sum these (sounds like a <code>foldl'</code>?). I've defined a data type like this:</p>\n\n<pre><code>data Stats = Stats {\n    successfulRequestsPerMinute :: Int\n  , failingRequestsPerMinute    :: Int\n  , meanResponseTime            :: Int\n  , megabytesPerMinute          :: Int\n  } deriving Show\n</code></pre>\n\n<p>And I'd like to constantly update that as I parse the input. But the part of performing operations as I consume is where I got stuck. So far <code>print</code> is the only function I've successfully passed output to and it showed the parsing is succeeding by returning <code>Done</code> before printing the output.</p>\n\n<p>My main parser(s) look like this:</p>\n\n<pre><code>parseLogEntry :: Parser LogEntry\nparseLogEntry = do\nip &lt;- logItem\n_ &lt;- char ' '\nlogName &lt;- logItem\n_ &lt;- char ' '\nuser &lt;- logItem\n_ &lt;- char ' '\ntime &lt;- datetimeLogItem\n_ &lt;- char ' '\nfirstLogLine &lt;- quotedLogItem\n_ &lt;- char ' '\nfinalRequestStatus &lt;- intLogItem\n_ &lt;- char ' '\nresponseSizeB &lt;- intLogItem\n_ &lt;- char ' '\ntimeToResponse &lt;- intLogItem\nreturn $ LogEntry ip logName user time firstLogLine finalRequestStatus responseSizeB timeToResponse\n\ntype Log = [LogEntry]\n\nparseLog :: Parser Log\nparseLog = many $ parseLogEntry &lt;* endOfLine\n</code></pre>\n\n<h2>Desired outcome</h2>\n\n<p>I want to pass each parsed line to a function that will update the above data type. Ideally I want this to be very memory efficient because it'll be operating on large files.</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1441747554, "post_id": 32467352, "comment_id": 52796995, "body": "Have you tried anything?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1441748106, "post_id": 32467352, "comment_id": 52797213, "body": "That definition of <code>pop</code> terrifies me; its a deeply hidden partial function. I know it wouldn&#39;t be any better <code>fail</code>ing in <code>Identity</code> for a stack underflow, but it would be less terrifying."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1441748243, "post_id": 32467502, "comment_id": 52797277, "body": "Why do you think <code>s1</code> and <code>s2</code> aren&#39;t <code>Integer</code>s?"}, {"owner": {"reputation": 3, "user_id": 4867358, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nHGcG6JURP4/AAAAAAAAAAI/AAAAAAAABVA/PXpgqVnCKso/photo.jpg?sz=128", "display_name": "spiridoncha", "link": "https://stackoverflow.com/users/4867358/spiridoncha"}, "edited": false, "score": 0, "creation_date": 1441748409, "post_id": 32467502, "comment_id": 52797337, "body": "How can i get integer value from the type State in this place?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 3, "user_id": 4867358, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nHGcG6JURP4/AAAAAAAAAAI/AAAAAAAABVA/PXpgqVnCKso/photo.jpg?sz=128", "display_name": "spiridoncha", "link": "https://stackoverflow.com/users/4867358/spiridoncha"}, "edited": false, "score": 0, "creation_date": 1441748690, "post_id": 32467502, "comment_id": 52797447, "body": "<code>pop</code> is a <code>State Stack Integer</code>. When you <code>&gt;&gt;=</code> (pronounced bind) it to a function <code>\\x -&gt; ...</code> the <code>x</code> is an <code>Integer</code>. The <code>...</code> needs to be a <code>State Stack a</code> for some type <code>a</code>."}, {"owner": {"reputation": 3, "user_id": 4867358, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nHGcG6JURP4/AAAAAAAAAAI/AAAAAAAABVA/PXpgqVnCKso/photo.jpg?sz=128", "display_name": "spiridoncha", "link": "https://stackoverflow.com/users/4867358/spiridoncha"}, "edited": false, "score": 0, "creation_date": 1441748890, "post_id": 32467502, "comment_id": 52797522, "body": "Thank you!! yes, of course s1 and s2 are integer. i&#39;m just stupid :\\"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1441747554, "creation_date": 1441747554, "answer_id": 32467502, "question_id": 32467352, "link": "https://stackoverflow.com/questions/32467352/how-can-i-pop-two-elements-from-a-stack-and-then-push-in-stack-them-back-as-sum/32467502#32467502", "title": "how can i pop two elements from a stack and then push in stack them back as sum of values?", "body": "<p>The compiler can <a href=\"https://wiki.haskell.org/GHC/Typed_holes\" rel=\"nofollow\">figure out the type to fill in a blank</a>. If I add a hole <code>_</code> to the code</p>\n\n<pre><code>add = pop &gt;&gt;= \\s1 -&gt; pop &gt;&gt;= \\s2 -&gt; push _\n</code></pre>\n\n<p>The compiler tells me it should have the type <code>Integer</code>.</p>\n\n<pre><code>   Found hole `_' with type: Integer\n</code></pre>\n\n<p>What <code>Integer</code> could you put there that would be the sum of the values popped off the stack?</p>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 1683251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6fsxn.jpg?s=128&g=1", "display_name": "MaC", "link": "https://stackoverflow.com/users/1683251/mac"}, "is_accepted": false, "score": 0, "last_activity_date": 1441750563, "creation_date": 1441750563, "answer_id": 32468134, "question_id": 32467352, "link": "https://stackoverflow.com/questions/32467352/how-can-i-pop-two-elements-from-a-stack-and-then-push-in-stack-them-back-as-sum/32468134#32468134", "title": "how can i pop two elements from a stack and then push in stack them back as sum of values?", "body": "<p>You mean this?</p>\n\n<pre><code>popAndSum :: Int -&gt; [Int] -&gt; [Int]\npopAndSum elem list = fst xs ++ [sum']\n        where\n            xs = splitAt ((length list) - elem) list\n            sum' = foldl (+) 0 $ snd xs\n</code></pre>\n\n<p><code>popAndSum 2 [1,2,3,4,5]</code> = <code>[1,2,3,9]</code></p>\n\n<p><code>popAndSum 3 [1,2,3,4,5]</code> = <code>[1,2,12]</code></p>\n"}], "owner": {"reputation": 3, "user_id": 4867358, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nHGcG6JURP4/AAAAAAAAAAI/AAAAAAAABVA/PXpgqVnCKso/photo.jpg?sz=128", "display_name": "spiridoncha", "link": "https://stackoverflow.com/users/4867358/spiridoncha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 32467502, "answer_count": 2, "score": -4, "last_activity_date": 1441750563, "creation_date": 1441746869, "last_edit_date": 1441747411, "question_id": 32467352, "link": "https://stackoverflow.com/questions/32467352/how-can-i-pop-two-elements-from-a-stack-and-then-push-in-stack-them-back-as-sum", "title": "how can i pop two elements from a stack and then push in stack them back as sum of values?", "body": "<pre><code>import Control.Monad.State\n\ntype Stack = [Integer]\n\npop :: State Stack Integer\npop = state $ \\(x:xs) -&gt; (x, xs)\n\npush :: Integer -&gt; State Stack ()\npush x = state $ \\xs -&gt; ((), (x:xs))\n\nmain :: IO()\nmain = print $ runState `enter code here` [1,2,3,4]\n</code></pre>\n\n<blockquote>\n  <p>using \"pop >>= (\\s1 -> pop >>= (\\s2 -> push <code>enter code here</code>)\"\n  what should i write here?</p>\n</blockquote>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 0, "creation_date": 1441743322, "post_id": 32465974, "comment_id": 52794973, "body": "It seems I can resolve this by renaming the test module to &#39;Main&#39;, even though I already have a &#39;Main&#39; module. Seems a little counter-intuitive to me so I&#39;m going to raise an issue and see if anyone agrees."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441767518, "post_id": 32465974, "comment_id": 52802194, "body": "I doubt they will agree. The meaning of <code>main-is</code> is <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#executables\" rel=\"nofollow noreferrer\">quite clear in the documentation</a>."}], "answers": [{"comments": [{"owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 0, "creation_date": 1441824575, "post_id": 32471632, "comment_id": 52834903, "body": "Yep, I can&#39;t reproduce either. I must&#39;ve added the module line to Spec without thinking and before any commits. I&#39;m putting this down to a brain fart. Sorry for wasting your time with it."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1452362924, "last_edit_date": 1592644375, "creation_date": 1441777048, "answer_id": 32471632, "question_id": 32465974, "link": "https://stackoverflow.com/questions/32465974/haskell-stack-not-building-test-executable/32471632#32471632", "title": "Haskell stack not building test executable", "body": "<p>The content of the <code>test/Spec.hs</code> file from the template is:</p>\n<pre><code>main :: IO ()\nmain = putStrLn &quot;Test suite not yet implemented&quot;\n</code></pre>\n<p>You can see this content at <a href=\"https://github.com/commercialhaskell/stack-templates\" rel=\"nofollow noreferrer\">commercialhaskell/stack-templates</a> in <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/new-template.hsfiles#L48\" rel=\"nofollow noreferrer\">new-template.hsfiles</a>.</p>\n<p>I'm not sure where the <code>module ParserSpec where</code> line comes from (as brought up in <a href=\"https://github.com/commercialhaskell/stack/issues/958\" rel=\"nofollow noreferrer\">the Github issue</a>), but it's not part of the template. On my system, <code>stack new bar &amp;&amp; cd bar &amp;&amp; stack test</code> succeeds.</p>\n<p>As to the reason behind the <code>Main</code> module requirement: it comes from the Cabal library, and as I understand it was added due to limitations in other compilers Cabal supports. In other words, GHC could technically allow this code to compile, but Cabal does not pass in those arguments to remain compatible with other compilers.</p>\n"}], "owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1851, "favorite_count": 1, "accepted_answer_id": 32471632, "answer_count": 1, "score": 7, "last_activity_date": 1452362924, "creation_date": 1441741383, "last_edit_date": 1441742533, "question_id": 32465974, "link": "https://stackoverflow.com/questions/32465974/haskell-stack-not-building-test-executable", "title": "Haskell stack not building test executable", "body": "<h3>Background</h3>\n\n<p>I'm building a logfile parser in Haskell. I'm using stack to build it. Running the <code>stack build</code> command works happily and my project compiles. Running <code>stack test</code>, however, produces the following error:</p>\n\n<pre><code>parser-test: executable not found\n</code></pre>\n\n<p>I see the the following warning above the error message but I don't know how to avoid the redirect to which it refers.</p>\n\n<pre><code>Warning: output was redirected with -o, but no output will be generated because there is no Main module.\n</code></pre>\n\n<h2>Relevant files</h2>\n\n<p>I haven't written any tests yet so the test file is as it was created by <code>stack new</code>. My cabal file looks like this:</p>\n\n<pre><code>...\ncategory:            Executable\nbuild-type:          Simple\n-- extra-source-files:\ncabal-version:       &gt;=1.10\n\nlibrary\nhs-source-dirs:      src\nexposed-modules:     LogParser\nbuild-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                    , attoparsec\n                    , bytestring\n                    , old-locale\n                    , time\ndefault-language:    Haskell2010\n\nexecutable parser-exe\nhs-source-dirs:      app\nmain-is:             Main.hs\nghc-options:         -threaded -rtsopts -with-rtsopts=-N\nbuild-depends:       base\n                    , attoparsec\n                    , bytestring\n                    , old-locale\n                    , time\n                    , parser\ndefault-language:    Haskell2010\n\ntest-suite parser-test\ntype:                exitcode-stdio-1.0\nhs-source-dirs:      test\nmain-is:             Spec.hs\nbuild-depends:       base\n                    , attoparsec\n                    , bytestring\n                    , hspec\n                    , hspec-attoparsec\n                    , old-locale\n                    , time\n                    , parser\nghc-options:         -threaded -rtsopts -with-rtsopts=-N\ndefault-language:    Haskell2010\n\nsource-repository head\ntype:     git\n...\n</code></pre>\n\n<p>I presume I'm missing something but I can't find where what I'm missing is documented.</p>\n\n<h2>Desired behaviour</h2>\n\n<p>I should see the <code>Test suite not yet implemented</code> message outlined in the <a href=\"https://github.com/commercialhaskell/stack/blob/master/GUIDE.md#stack-test\" rel=\"noreferrer\">stack documentation</a>.</p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1441742755, "post_id": 32465776, "comment_id": 52794675, "body": "A more natural way of thinking for Haskell is: given the first row and the result of <code>diagonals</code> on the matrix consisting of the rest of the rows, how can we construct the result of <code>diagonals</code> on the entire original matrix?"}, {"owner": {"reputation": 5120, "user_id": 335918, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/35ca76160b03ee978b0b7b1d6e6c8c69?s=128&d=identicon&r=PG", "display_name": "xiamx", "link": "https://stackoverflow.com/users/335918/xiamx"}, "edited": false, "score": 0, "creation_date": 1444339414, "post_id": 32465776, "comment_id": 53874684, "body": "Math for it <a href=\"http://math.stackexchange.com/a/22396/5889\">math.stackexchange.com/a/22396/5889</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1441741887, "post_id": 32466093, "comment_id": 52794115, "body": "Thanks, I am impressed by the speed and clarity of this response. But please rename <code>f</code> to <code>diagonals</code> as Haskell already has enough single letter names ;P"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 4, "creation_date": 1441742082, "post_id": 32466093, "comment_id": 52794237, "body": "But I happen to be partial to that particular letter :P ---&gt;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1441745292, "post_id": 32466093, "comment_id": 52795932, "body": "I&#39;m sorry, but I have to say that I don&#39;t like this solution. First, there are too many <code>!!</code>, which should be avoided as much as possible on lists (unlike on vectors). Second, it loops over <code>y&lt;-[0..n-1]</code> only to find a solution to <code>x+y==k</code>, which has a very simple closed form. Third, the complexity of the solution should be stated. While one would hope a O(n^2) solution, the above looks O(n^5) to me."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441745457, "post_id": 32466093, "comment_id": 52796021, "body": "@chi Those are all valid points. I don&#39;t disagree with any of them. They do not affect my opinion of this particular solution, which is why I qualified it merely as &quot;one way&quot; to solve it. Feel free to optimize it as you desire."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 2, "last_activity_date": 1441741797, "creation_date": 1441741797, "answer_id": 32466093, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell/32466093#32466093", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<p>Here is one approach:</p>\n\n<pre><code>f :: [[a]] -&gt; [[a]]\nf vals = \n    let n = length vals\n    in [[(vals !! y) !! x | x &lt;- [0..(n - 1)], \n                            y &lt;- [0..(n - 1)], \n                            x + y == k] \n        | k &lt;- [0 .. 2*(n-1)]]\n</code></pre>\n\n<p>For example, using it in GHCi:</p>\n\n<pre><code>Prelude&gt; let f vals = [ [(vals !! y) !! x | x &lt;- [0..(length vals) - 1], y &lt;- [0..(length vals) - 1], x + y == k] | k &lt;- [0 .. 2*((length vals) - 1)]]\n\nPrelude&gt; f [ [1,2,3], [4,5,6], [7,8,9] ]\n[[1],[4,2],[7,5,3],[8,6],[9]]\n</code></pre>\n\n<p>Assuming a square <code>n</code> x <code>n</code> matrix, there will be <code>n + n - 1</code> diagonals (this is what <code>k</code> iterates over) and for each diagonal, the invariant is that the row and column index sum to the diagonal value (starting with a zero index for the upper left). You can swap the item access order (swap <code>!! y !! x</code> with <code>!! x !! y</code>) to reverse the raster scanning order over the matrix.</p>\n"}, {"tags": [], "owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "is_accepted": false, "score": 5, "last_activity_date": 1441749183, "last_edit_date": 1441749183, "creation_date": 1441744193, "answer_id": 32466695, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell/32466695#32466695", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<p>Here is a recursive version, assuming that the input is always well-formed:</p>\n\n<pre><code>diagonals []       = []\ndiagonals ([]:xss) = xss\ndiagonals xss      = zipWith (++) (map ((:[]) . head) xss ++ repeat [])\n                                  ([]:(diagonals (map tail xss)))\n</code></pre>\n\n<p>It works recursively, going from column to column. The values from one column are combined with the diagonals from the matrix reduced by one column, shifted by one row to actually get the diagonals. Hope this explanation makes sense.</p>\n\n<p>For illustration:</p>\n\n<pre><code>diagonals [[1,2,3],[4,5,6],[7,8,9]]\n= zipWith (++) [[1],[4],[7],[],[],...] [[],[2],[5,3],[8,6],[9]]\n= [[1],[4,2],[7,5,3],[8,6],[9]]\n</code></pre>\n\n<p>Another version that works on the rows instead of the columns, but based on the same idea:</p>\n\n<pre><code>diagonals []       = repeat []\ndiagonals (xs:xss) = takeWhile (not . null) $\n    zipWith (++) (map (:[]) xs ++ repeat [])\n                 ([]:diagonals xss)\n</code></pre>\n\n<p>Compared to the specified result, the resulting diagonals are reversed. This can of course be fixed by applying <code>map reverse</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1441748514, "post_id": 32467482, "comment_id": 52797374, "body": "I actually do not care about ordering"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441759196, "post_id": 32467482, "comment_id": 52800302, "body": "<code>rotate180</code> seems a bit odd. Won&#39;t <code>map reverse . reverse</code> do the trick?"}], "tags": [], "owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "is_accepted": false, "score": 5, "last_activity_date": 1441750989, "last_edit_date": 1441750989, "creation_date": 1441747450, "answer_id": 32467482, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell/32467482#32467482", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<pre><code>import Data.List\n\nrotate90 = reverse . transpose\nrotate180 = rotate90 . rotate90\n\ndiagonals = (++) &lt;$&gt; transpose . zipWith drop [0..]\n                 &lt;*&gt; transpose . zipWith drop [1..] . rotate180\n</code></pre>\n\n<p>It first gets the main (<code>[1,5,9]</code>) and upper diagonals (<code>[2,6]</code> and <code>[3]</code>); then the lower diagonals: <code>[8,4]</code> and <code>[7]</code>.</p>\n\n<p>If you care about ordering (i.e. you think it should say <code>[4,8]</code> instead of <code>[8,4]</code>), insert a <code>map reverse .</code> on the last line.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441773824, "post_id": 32469565, "comment_id": 52803685, "body": "Is the use of <code>tail</code> essential in some way?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441774743, "post_id": 32469565, "comment_id": 52803949, "body": "@dfeuer Not essential; but it doesn&#39;t seem terribly useful to always start with an empty list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441806309, "post_id": 32469565, "comment_id": 52823345, "body": "is there some other way to skip it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441819296, "post_id": 32469565, "comment_id": 52832300, "body": "@dfeuer Almost certainly! What have you got in mind?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441820452, "post_id": 32469565, "comment_id": 52832845, "body": "I just don&#39;t like using partial functions to implement total ones unless laziness demands it. In this case, I&#39;m guessing you can treat the first step specially to avoid it, but I haven&#39;t tried."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441822360, "post_id": 32469565, "comment_id": 52833780, "body": "@dfeuer You could certainly &quot;unroll&quot; the loop one step to avoid using <code>tail</code>. In this case, I think the totality argument is local enough (we call <code>tail</code> on <code>go</code>, which always starts with <code>(:)</code>) that it&#39;s reasonable to avoid repeating code in the way I did here. Another alternative would be to use <code>drop 1</code> in place of <code>tail</code>; perhaps if I had thought of it at the time I wrote this I would have, though I&#39;m not sure it warrants effort to change it now."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 11, "last_activity_date": 1441762528, "last_edit_date": 1441762528, "creation_date": 1441762124, "answer_id": 32469565, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell/32469565#32469565", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<p>Starting with <a href=\"http://hackage.haskell.org/package/universe-base-1.0.2.1\" rel=\"noreferrer\">universe-base-1.0.2.1</a>, you may simply call the <a href=\"http://hackage.haskell.org/package/universe-base-1.0.2.1/docs/Data-Universe-Helpers.html#v:diagonals\" rel=\"noreferrer\"><code>diagonals</code></a> function:</p>\n\n<pre><code>Data.Universe.Helpers&gt; diagonals [ [1,2,3], [4,5,6], [7,8,9] ]\n[[1],[4,2],[7,5,3],[8,6],[9]]\n</code></pre>\n\n<p>The implementation in full looks like this:</p>\n\n<pre><code>diagonals :: [[a]] -&gt; [[a]]\ndiagonals = tail . go [] where\n    -- it is critical for some applications that we start producing answers\n    -- before inspecting es_\n    go b es_ = [h | h:_ &lt;- b] : case es_ of\n        []   -&gt; transpose ts\n        e:es -&gt; go (e:ts) es\n        where ts = [t | _:t &lt;- b]\n</code></pre>\n\n<p>The key idea is that we keep two lists: a rectangular chunk we haven't started inspecting, and a pentagonal chunk (a rectangle with the top left triangle cut out!) that we have. For the pentagonal chunk, picking out the first element from each list gives us another diagonal. Then we can add a fresh row from the rectangular, un-inspected chunk to what's left after we delete that diagonal.</p>\n\n<p>The implementation may look a bit unnatural, but it's intended to be quite efficient and lazy: the only thing we do to lists is destructure them into a head and tail, so this should be O(n) in the total number of elements in the matrix; and we produce elements as soon as we finish the destructuring, so it's quite lazy/friendly to garbage collection. It also works well with infinitely large matrices.</p>\n\n<p>(I pushed this release just for you: the previous closest thing you could get was using <code>diagonal</code>, which would only give you <code>[1,4,2,7,5,3,8,6,9]</code> without the extra structure you want.)</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1441785986, "creation_date": 1441785986, "answer_id": 32474197, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell/32474197#32474197", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<p>One another solution:</p>\n\n<pre><code>diagonals = map concat\n          . transpose\n          . zipWith (\\ns xs -&gt; ns ++ map (:[]) xs)\n                    (iterate ([]:) [])\n</code></pre>\n\n<p>Basically, we turn</p>\n\n<pre><code>[1, 2, 3]\n[4, 5, 6]\n[7, 8, 9]\n</code></pre>\n\n<p>into</p>\n\n<pre><code>[[1], [2], [3]]\n[[] , [4], [5], [6]]\n[[] , [] , [7], [8], [9]]\n</code></pre>\n\n<p>then <code>transpose</code> and <code>concat</code> lists. Diagonals are in the reversed order.</p>\n\n<p>But that's not very efficient and doesn't work for infinite lists.</p>\n"}], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4637, "favorite_count": 2, "accepted_answer_id": 32469565, "answer_count": 5, "score": 13, "last_activity_date": 1441785986, "creation_date": 1441740687, "last_edit_date": 1592644375, "question_id": 32465776, "link": "https://stackoverflow.com/questions/32465776/getting-all-the-diagonals-of-a-matrix-in-haskell", "title": "Getting all the diagonals of a matrix in Haskell", "body": "<p>The two-dimensional list looks like:</p>\n<pre><code>1 | 2 | 3\n- - - - -\n4 | 5 | 6\n- - - - -\n7 | 8 | 9\n</code></pre>\n<p>Or in pure haskell</p>\n<pre><code>[ [1,2,3], [4,5,6], [7,8,9] ]\n</code></pre>\n<p>The expected output for <code>diagonals [ [1,2,3], [4,5,6], [7,8,9] ]</code> is</p>\n<pre><code>[ [1], [4, 2], [7, 5, 3], [8, 6], [9] ]\n</code></pre>\n<p>Writing <code>allDiagonals</code> (to include anti-diagonals) is then trivial:</p>\n<pre><code>allDiagonals :: [[a]] -&gt; [[a]]\nallDiagonals xss = (diagonals xss) ++ (diagonals (rotate90 xss))\n</code></pre>\n<h1>My research on this problem</h1>\n<p><strong>Similar question here at StackOverflow</strong></p>\n<ul>\n<li><p><a href=\"https://stackoverflow.com/questions/6313308/get-all-the-diagonals-in-a-matrix-list-of-lists-in-python\">Python</a> this question is about the same problem in Python, but Python and Haskell are very different, so the answers to that question are not relevant to me.</p>\n</li>\n<li><p><a href=\"https://stackoverflow.com/questions/3998891/what-is-the-best-way-to-extract-a-diagonal-from-a-matrix-in-haskell\">Only one</a> This question and answer are in Haskell, but are only about the central diagonal.</p>\n</li>\n</ul>\n<p><strong>Hoogle</strong></p>\n<p>Searching for <code>[[a]] -&gt; [[a]]</code> gave me no interesting result.</p>\n<p><strong>Independent thinking</strong></p>\n<p>I think the the indexing follows a kind of count in base x where x is the number of dimensions in the matrix, look at:</p>\n<pre><code>1 | 2\n- - -\n3 | 4\n</code></pre>\n<p>The diagonals are <code>[ [1], [3, 2], [4] ]</code></p>\n<ul>\n<li><code>1</code> can be found at <code>matrix[0][0]</code></li>\n<li><code>3</code> can be found at <code>matrix[1][0]</code></li>\n<li><code>2</code> can be found at <code>matrix[0][1]</code></li>\n<li><code>1</code> can be found at <code>matrix[1][1]</code></li>\n</ul>\n<p>That is similar to counting in base 2 up to 3, that is the matrix size minus one. But this is far too vague to be translated into code.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1441728696, "post_id": 32461957, "comment_id": 52787024, "body": "If you are using 7.10.2 then the monomorphism restriction is turned off by default, so the type of <code>[1..]</code> (without <code>:: Integer</code>) is polymorphic and thus the referred to answer applies."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441731956, "post_id": 32461957, "comment_id": 52788783, "body": "@user5402 I am using GHCi 7.8.3, and even if I launch it with <code>ghci -XNoMonomorphismRestriction</code> or <code>ghci -XMonomorphismRestriction</code> I still have the same problem. I suppose that <code>:sprint</code> should have been implemented to make this subtlety transparent for the user."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1441735025, "post_id": 32461957, "comment_id": 52790520, "body": "Apparently <code>ghci -XMonomorphismRestriction</code> doesn&#39;t turn on the monomorphism restriction. You need to <code>:set -XMonomorphismRestriction</code> from inside ghci. Confusing..."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1441737728, "post_id": 32461957, "comment_id": 52792043, "body": "@ReidBarton Thanks, it worked. I don&#39;t understand why this monomorphism restriction is still around generating lots of confusion. Anyway, with or without such restriction, the problem is that GHCi has inconsistencies regarding <code>:sprint</code> (see <a href=\"https://www.reddit.com/r/haskell/comments/3dznm2/question_about_the_behavoir_of_sprint_in_ghci/\" rel=\"nofollow noreferrer\">here</a>)."}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "closed_date": 1441727869, "answer_count": 0, "score": 0, "last_activity_date": 1441795309, "creation_date": 1441726897, "last_edit_date": 1441795309, "question_id": 32461957, "link": "https://stackoverflow.com/questions/32461957/behavior-of-ghci-sprint-command", "closed_reason": "Duplicate", "title": "Behavior of GHCI :sprint command", "body": "<p>In the tutorial <a href=\"http://dev.stephendiehl.com/hask/\" rel=\"nofollow\">What I Wish I Knew When Learning Haskell</a> there is this interaction inside GHCi regarding the use of the <code>:sprint</code> command to inspect the state of evaluation of some variable:</p>\n\n<pre><code>\u03bb: let a = [1..] :: [Integer]\n\u03bb: :sprint a\na = _\n\u03bb: a !! 4\n5\n\u03bb: :sprint a\na = 1 : 2 : 3 : 4 : 5 : _ \n</code></pre>\n\n<p>However, if we ommit the part <code>:: [Integer]</code> from the definition of <code>a</code>, the last call to <code>:sprint a</code> will return <code>a = _</code> and not <code>a = 1 : 2 : 3 : 4 : 5 : _</code>.</p>\n\n<p>Why?</p>\n\n<p><em>ANSWER</em>: the monomorphism restriction must be turned on/off inside GHCi via <code>:set -XMonomorphismRestriction</code> and <code>:set -XNoMonomorphismRestriction</code> (see Reid Barton's comment below). And the best explanation I found for <code>:sprint</code> behavior is <a href=\"https://www.reddit.com/r/haskell/comments/2j56e0/sprint_behaves_differently_in_ghc_783/\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": ["haskell", "linux-mint"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1441718696, "post_id": 32458924, "comment_id": 52780071, "body": "<code>sudo apt-get install libgmp10</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441718826, "post_id": 32458924, "comment_id": 52780168, "body": "also if you don&#39;t want the plattform you can use this <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">PPA</a>"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 0, "creation_date": 1441732870, "post_id": 32460489, "comment_id": 52789277, "body": "It appears that <code>libgmp10</code> is <b>already</b> installed. Is there anything else I can try.?"}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": false, "score": 2, "last_activity_date": 1441777848, "last_edit_date": 1441777848, "creation_date": 1441722747, "answer_id": 32460489, "question_id": 32458924, "link": "https://stackoverflow.com/questions/32458924/cant-install-cabal-install/32460489#32460489", "title": "Can&#39;t install cabal-install", "body": "<p>[edit] You already found that</p>\n\n<pre><code>sudo apt-get install libgmp-dev\n</code></pre>\n\n<p>should solve your problem (for Mint - for systems without <code>apt-get</code> you would need to use the resident package manager, and in other apt-get based system there could be variation in package names).</p>\n\n<p>If you run into similar errors in the future, here is the reasoning with which to solve the problem: <code>ld</code> is a linker, essentially linking libraries into a program which is being compiled. <code>-lgmp</code> is the argument supplied to <code>ld</code>, telling it to link in the library gmp. It cannot find this library, so either you need to:</p>\n\n<p>(a) tell it about its location in case you know you have the library (the cabal argument --extra-lib-dirs= is useful in this case), or</p>\n\n<p>(b) install the library (google the library name and your system).</p>\n\n<p>GMP is the GNU MP Bignum library which plays a role in providing the <code>Integer</code> and <code>Fractional</code> types.</p>\n"}], "owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1441777848, "creation_date": 1441718327, "last_edit_date": 1441733353, "question_id": 32458924, "link": "https://stackoverflow.com/questions/32458924/cant-install-cabal-install", "title": "Can&#39;t install cabal-install", "body": "<p>I've just installed Mint 17 on my laptop and followed this with haskell platform generic. (I chose generic instead of using <code>apt-get</code> because it was the only way I could get ghc 7.10) When I try:</p>\n\n<pre><code>cabal install cabal-install\n</code></pre>\n\n<p>I get this error: </p>\n\n<pre><code>Resolving dependencies...\nConfiguring cabal-install-1.22.6.0...\nFailed to install cabal-install-1.22.6.0\nBuild log ( /home/william/.cabal/logs/cabal-install-1.22.6.0.log ):\ncabal: Error: some packages failed to install:\ncabal-install-1.22.6.0 failed during the configure step. The exception was:\nuser error ('/usr/local/bin/ghc' exited with an error:\n/usr/bin/ld: cannot find -lgmp\ncollect2: error: ld returned 1 exit status\n)\n</code></pre>\n\n<p>Does anyone know how to fix this ?</p>\n\n<p>update:</p>\n\n<p>Fixed by installing <code>libgmp-dev</code></p>\n"}, {"tags": ["performance", "haskell", "primes"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 2, "creation_date": 1441718104, "post_id": 32458484, "comment_id": 52779653, "body": "I can&#39;t reproduce it, <code>prime</code> is 2x faster then <code>prime2</code> for me (ghc-7.10.1)"}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1441718339, "post_id": 32458484, "comment_id": 52779825, "body": "@Yuras Are you compiling with -O2? (My version of GHC is different:<code>Glasgow Haskell Compiler, Version 7.6.3, stage 2 booted by GHC version 7.6.3</code>"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 5, "creation_date": 1441718582, "post_id": 32458484, "comment_id": 52779989, "body": "Yes, I&#39;m compiling with <code>-O2</code>. Different compiler versions can explain different behavior though."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1441728122, "post_id": 32458484, "comment_id": 52786657, "body": "I don&#39;t understand a 2x slowdown, but keep in mind that <code>even</code> is doing a modulo operation as well -- so there&#39;s no reason to believe the second should be twice as fast! (It potentially <i>could</i> be twice as fast, if the compiler notices that there&#39;s a monomorphic modulo by a constant and replaces it by very fast bit operations. Modern GHCs should notice this -- especially with <code>-fllvm</code> -- but I guess it&#39;s by no means guaranteed.)"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457157627, "creation_date": 1457157627, "answer_id": 35810699, "question_id": 32458484, "link": "https://stackoverflow.com/questions/32458484/primality-check-change-that-seemed-optimization-turned-out-to-be-pessimization-i/35810699#35810699", "title": "Primality check change that seemed optimization turned out to be pessimization in Haskell", "body": "<p>As Daniel pointed out in comments, asking <code>even n</code> would do a <code>mod</code> operation just like in the second version. Furthermore, it would be the first case hit in the second version. So the second version has fewer case branches but the same efficiency. Remember Haskell is a non-strict language, so all the other <code>mod</code> operations won't get forced if the first already returns <code>True</code>.</p>\n"}], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1457157627, "creation_date": 1441717077, "question_id": 32458484, "link": "https://stackoverflow.com/questions/32458484/primality-check-change-that-seemed-optimization-turned-out-to-be-pessimization-i", "title": "Primality check change that seemed optimization turned out to be pessimization in Haskell", "body": "<p>I wrote two functions to check if a number is prime in Haskell:</p>\n\n<pre><code>prime :: Int -&gt; Bool\nprime 0 = False\nprime 1 = False\nprime 2 = True\nprime n | even n = False\nprime n = all (\\x -&gt; n `rem` x /= 0) [3,5..intSqrt]\n  where intSqrt = (floor . sqrt . fromIntegral) n\n\nprime2 :: Int -&gt; Bool\nprime2 0 = False\nprime2 1 = False\nprime2 n = all (\\x -&gt; n `rem` x /= 0) [2..intSqrt]\n  where intSqrt = (floor . sqrt . fromIntegral) n\n</code></pre>\n\n<p>The first version should, in average  do  half the calculations of the second one, because even numbers are skipped, but it turns out that the second version that seems slower is almost 2x faster! I include Terminal sessions timings verbatim.</p>\n\n<p>Prime 1 version:</p>\n\n<pre><code>$ ghc -O2 prime.hs\n[1 of 1] Compiling Main             ( prime.hs, prime.o )\nLinking prime ...\n$ time ./prime\n142913828922\n\nreal    0m4.617s\nuser    0m4.572s\nsys 0m0.040s\n</code></pre>\n\n<p>Now I use change the program to make use of the prime2 version:</p>\n\n<pre><code>$ ghc -O2 prime.hs\n[1 of 1] Compiling Main             ( prime.hs, prime.o )\nLinking prime ...\n$ time ./prime\n142913828922\n\nreal    0m2.288s\nuser    0m2.268s\nsys 0m0.020s\n$ \n</code></pre>\n\n<p>The code in <code>main</code> is simply:</p>\n\n<pre><code>main :: IO()\nmain = print $ sum $ filter prime2 [1..2000000]\n</code></pre>\n\n<p>Why is the second version faster if it does twice the number of modolus?</p>\n"}, {"tags": ["sql", "haskell", "persistence", "persistent", "esqueleto"], "comments": [{"owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "edited": false, "score": 0, "creation_date": 1441717262, "post_id": 32458062, "comment_id": 52779044, "body": "Use the appropriate data structure for SQL, which is a junction table, not a string containing a list."}], "answers": [{"comments": [{"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "edited": false, "score": 0, "creation_date": 1441732158, "post_id": 32460612, "comment_id": 52788897, "body": "Thank you for your answer!"}], "tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": false, "score": 1, "last_activity_date": 1441723067, "creation_date": 1441723067, "answer_id": 32460612, "question_id": 32458062, "link": "https://stackoverflow.com/questions/32458062/sql-list-field-contains-sublist/32460612#32460612", "title": "SQL: List-Field contains sublist", "body": "<p>By using <code>[String]</code>, persistent converts the entire list to a quoted string, making it very hard to work with from SQL.</p>\n\n<p>You can do something like:</p>\n\n<pre><code>mapM (\\cat -&gt;\n         where_ (x ^. Category `like` (%) ++. val (show cat) ++. (%)))\n     [\"personal\", \"algebra\"]\n</code></pre>\n\n<p>But this is very fragile (may break when the categories contain <code>\"</code>, etc.).</p>\n\n<p>Better approaches are:</p>\n\n<ol>\n<li><p>You could do the filtering in Haskell if the database is small enough.</p></li>\n<li><p>It would be much easier to model your data as:</p>\n\n<p>Objects:</p>\n\n<pre><code>ID  ... \n0   ...\n1   ...\n2   ...\n</code></pre>\n\n<p>ObjectCategories:</p>\n\n<pre><code>ObjectID  Category\n0   math\n0   algebra\n1   personal\n1   life\n2   algebra\n2   university\n2   personal\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "edited": false, "score": 0, "creation_date": 1441732140, "post_id": 32462248, "comment_id": 52788885, "body": "thank you very much for your elaborate answer! I will restructure my DB similar to what you suggest!"}], "tags": [], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "is_accepted": false, "score": 3, "last_activity_date": 1441727713, "creation_date": 1441727713, "answer_id": 32462248, "question_id": 32458062, "link": "https://stackoverflow.com/questions/32458062/sql-list-field-contains-sublist/32462248#32462248", "title": "SQL: List-Field contains sublist", "body": "<p>Expanding on the comment of Gordon Linoff and the previous answer:</p>\n\n<p>SQL databases are sometimes limited in their power. Since the order of your Strings in <code>[String]</code> does not seem to matter, you are trying to put something like a <code>set</code> into a relational database and for your query you suggest something like a <code>is a subset of</code> operator.</p>\n\n<p>If there was a database engine that provides those structures, there would be nothing wrong about using it (I don't know any). However, approximating your set logic (or any logic that is not natively supported by the database) has disadvantages:</p>\n\n<ul>\n<li>You have to explicitly deal with edge cases (cf. xnyhps' answer)</li>\n<li>Instead of hiding the complexity of storing data, you need to explicitly deal with it in your code</li>\n<li>You need to study the database engine rather than writing your Haskell code</li>\n<li>The interface between database and Haskell code becomes blurry</li>\n</ul>\n\n<p>A mightier approach is to reformulate your storing task to something that fits easily into the relational database concept. I.e. try to put it in terms of relations.\nEntities and relations are simple, thus you avoid edge cases. You don't need to bother <em>how</em> exactly the db backend stores your data. You don't have to bother with the database much at all. And your interface is reduced to rather straightforward queries (making use of joins). Everything that cannot be (comparatively) easily realized with a query, belongs (probably) into the Haskell code.</p>\n\n<p>Of course, the details differ based on the specific circumstances.</p>\n\n<p>In your specific case, you could use something like this:</p>\n\n<pre><code>Table: Category\nID Description\n0  math\n1  algebra\n2  personal\n3  life\n4  university\n\nTable: CategoryGroup\nID  CategoryID\n0   0\n0   1\n1   2\n1   3\n2   1\n2   4\n2   2\n</code></pre>\n\n<p>... where the foreign key relation allows to have groups of categories. Here, you are using a relational database where it excels. In order to query for <code>CategoryGroup</code> you would join the two tables, resulting in a result of type</p>\n\n<pre><code>[(Entity CategoryGroup, Entity Category)]\n</code></pre>\n\n<p>which I would transform in Haskell to something like</p>\n\n<pre><code>[(Entity CategoryGroup, [Entity Category])]\n</code></pre>\n\n<p>Where the <code>Category</code> entities are collected for each <code>CategoryGroup</code> (that requires <code>deriving (Eq, Ord)</code> in your <code>CategoryGroup</code>-Model).</p>\n\n<p>The set-logic as described above, for a given List <code>cs :: [Entity Category]</code>, would then go like</p>\n\n<pre><code>import qualified Data.Set as Set\nimport Data.Set (isSubsetOf)\nlet s = Set.fromList [\"personal\", \"algebra\"]\nlet s0 = Set.fromList $ map (categoryDescription . entityVal) cs\nif s `isSubsetOf` s0 -- ... ?\n</code></pre>\n\n<p>Getting used to the restrictions of relational databases can be annoying in the beginning. I guess, for something of central importance (persisting data) a robust concept is often better than a mighty one and it pays out to always know what your database is doing <em>exactly</em>.</p>\n"}], "owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1441727713, "creation_date": 1441715816, "last_edit_date": 1441716528, "question_id": 32458062, "link": "https://stackoverflow.com/questions/32458062/sql-list-field-contains-sublist", "title": "SQL: List-Field contains sublist", "body": "<p>Quick preface: I use the SQL implementation <a href=\"https://hackage.haskell.org/package/persistent\" rel=\"nofollow\">persistent</a> (Haskell) and <a href=\"http://hackage.haskell.org/package/esqueleto\" rel=\"nofollow\">esqueleto</a>.</p>\n\n<p>Anyway, I want to have a SQL table with a column of type <code>[String]</code>, i.e. a list of strings. Now I want to make a query which gives me all the records where a given list is a sublist of the one in the record.</p>\n\n<p>For instance the table with</p>\n\n<pre><code>ID  Category\n0   [\"math\", \"algebra\"]\n1   [\"personal\", \"life\"]\n2   [\"algebra\", \"university\", \"personal\"]\n</code></pre>\n\n<p>with a query of  <code>[\"personal\", \"algebra\"]</code> would return only the record with ID=2, since <code>[\"personal\", \"algebra\"]</code> is a sublist of <code>[\"algebra\", \"university\", \"personal\"]</code>.</p>\n\n<p>Is a query like this possible with variable-length of my sought-after sublist and \"basic\" SQL operators?</p>\n\n<p>If someone knows their way around persistent/esqueleto that would of course be awesome.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "ghc", "typeclass", "maybe", "foldable"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1441713260, "post_id": 32456758, "comment_id": 52776207, "body": "what GHC/base version are you using? because yes with base-4.8.x it&#39;s <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:null\" rel=\"nofollow noreferrer\"><code>t a -&gt; Bool</code></a> but <a href=\"https://hackage.haskell.org/package/base-4.7.0.1/docs/Prelude.html#v:null\" rel=\"nofollow noreferrer\"><code>null</code> used to be <code>[a] -&gt; Bool</code></a>"}, {"owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441713494, "post_id": 32456758, "comment_id": 52776371, "body": "@Carsten Yep, that was exactly it - Ubuntu Vivid is apparently still shipping <a href=\"http://packages.ubuntu.com/vivid/ghc\" rel=\"nofollow noreferrer\">ghc 7.6.3</a>, which was released April  2013 and has an older version of base."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1441714964, "post_id": 32456758, "comment_id": 52777348, "body": "yeah sorry - saw your answer to late - btw you can use <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">Herbert V. Riedels PPA-Sources</a> :D"}], "answers": [{"comments": [{"owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "edited": false, "score": 0, "creation_date": 1441712504, "post_id": 32456836, "comment_id": 52775664, "body": "Thanks - but that doesn&#39;t seem to work - I get <code>Module &#39;Data.Foldable&#39; does not export &#39;null&#39;</code>"}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "reply_to_user": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "edited": false, "score": 0, "creation_date": 1441712647, "post_id": 32456836, "comment_id": 52775765, "body": "@WanderNauta My mistake. Fixed."}, {"owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "edited": false, "score": 0, "creation_date": 1441713250, "post_id": 32456836, "comment_id": 52776198, "body": "It turns out updating GHC was enough to fix the problem - thanks again, though!"}], "tags": [], "owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "is_accepted": false, "score": 3, "last_activity_date": 1441712616, "last_edit_date": 1441712616, "creation_date": 1441712361, "answer_id": 32456836, "question_id": 32456758, "link": "https://stackoverflow.com/questions/32456758/why-cant-i-do-null-just-5-in-haskell/32456836#32456836", "title": "Why can&#39;t I do `null (Just 5)` in Haskell?", "body": "<p>There are multiple functions called <code>null</code>. The one you're getting in ghci is from the <code>Prelude</code>, and it is <code>null :: [a] -&gt; Bool</code>. The reason this happens is that everything from the <code>Prelude</code> is imported implicitly.</p>\n\n<p>To get the right one you need to <code>import Data.Foldable (Foldable(null))</code>*, and to prevent ambiguity with the wrong one you need to <code>import Prelude hiding (null)</code>. Re-importing the <code>Prelude</code> explicitly like this prevents the implicit import that would happen otherwise.</p>\n\n<p>*Or <code>import Data.Foldable (Foldable(..))</code> to get all of <code>Foldable</code>'s methods.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1441714713, "post_id": 32457125, "comment_id": 52777174, "body": "This is due to the <a href=\"https://wiki.haskell.org/Foldable_Traversable_In_Prelude\" rel=\"nofollow noreferrer\">burning bridges proposal</a>. Just in case you were wondering why <code>Foldable</code> gained so many additional functions and <code>Prelude</code>&#39;s types changed so much between 7.8 and 7.10."}], "tags": [], "owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "is_accepted": true, "score": 8, "last_activity_date": 1441713178, "creation_date": 1441713178, "answer_id": 32457125, "question_id": 32456758, "link": "https://stackoverflow.com/questions/32456758/why-cant-i-do-null-just-5-in-haskell/32457125#32457125", "title": "Why can&#39;t I do `null (Just 5)` in Haskell?", "body": "<p>As it turns out, I was running an older version of GHC (the default version for my OS), while the documentation was for the newest version (of course).</p>\n\n<p>In GHC 7.10.2 at least, the <code>null</code> that you get out of Prelude supports Foldables (like Maybe) without having to import anything:</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t null\nnull :: Foldable t =&gt; t a -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 32457125, "answer_count": 2, "score": 4, "last_activity_date": 1458384818, "creation_date": 1441712112, "last_edit_date": 1458384818, "question_id": 32456758, "link": "https://stackoverflow.com/questions/32456758/why-cant-i-do-null-just-5-in-haskell", "title": "Why can&#39;t I do `null (Just 5)` in Haskell?", "body": "<p>The Hackage documentation for Maybe lists Foldable as one of Maybe's typeclasses. It also lists the following function:</p>\n\n<pre><code>null :: Maybe a -&gt; Bool\n</code></pre>\n\n<p>It even links to this function's implementation (from <code>Foldable</code>):</p>\n\n<pre><code>null :: t a -&gt; Bool\nnull = foldr (\\_ _ -&gt; False) True\n</code></pre>\n\n<p>...which seems rather reasonable. It works, too: I can, if I <code>import qualified Data.Foldable</code>, use <code>foldr</code> on Maybe values.</p>\n\n<p>However, when I try to call <code>null</code> on a Maybe, Haskell thinks I want to use the null designed for lists:</p>\n\n<pre><code>Prelude&gt; :t null\nnull :: [a] -&gt; Bool\nPrelude&gt; null Nothing\n&lt;interactive&gt;:3:6:\n    Couldn't match expected type `[a0]' with actual type `Maybe a1'\n    In the first argument of `null', namely `Nothing'\n    In the expression: null Nothing\n    In an equation for `it': it = null Nothing\n</code></pre>\n\n<p>I know there is <code>isJust</code>, I'm just wondering how to call a function like <code>null</code> for any Foldable.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1441713441, "post_id": 32456499, "comment_id": 52776329, "body": "The last <code>aux</code> looks fine. For style, I&#39;d change <code>[(i,x)] ++ ...</code> into <code>(i,x) : ...</code>."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1441713823, "post_id": 32456499, "comment_id": 52776615, "body": "you don&#39;t need <code>enumerate [] = []</code> since you&#39;re already handling empty lists in <code>aux</code> function.  In fact you can just write <code>enumerate = aux 1</code>"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1441714126, "post_id": 32456499, "comment_id": 52776799, "body": "@homam and How  aux function will recognize the list ? And Thanks chi, that worked nice. I thought I could just use <code>:</code> in  <code>elem : list</code>"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1441714492, "post_id": 32456499, "comment_id": 52777044, "body": "<code>aux</code> is a function from <code>aux :: Int -&gt; [String] -&gt; [(Int, String)]</code>. Hence <code>aux 1</code> is a function from <code>[String] -&gt; [(Int, String)]</code>. That has the same signature as your <code>enumerate</code> function. Hence <code>enumerate list = aux 1 list</code> can be written  as <code>enumerate = aux 1</code> by eliminating the <code>list</code> argument."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1441714645, "post_id": 32456499, "comment_id": 52777131, "body": "@homam I tried it and got error ;s <code>aux is applied with too few arguments</code>"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 1, "creation_date": 1441714791, "post_id": 32456499, "comment_id": 52777227, "body": "<a href=\"https://glot.io/snippets/e71mmhxpcl\" rel=\"nofollow noreferrer\">glot.io/snippets/e71mmhxpcl</a>"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441714897, "post_id": 32456499, "comment_id": 52777301, "body": "Amazing ! It worked really nice. Ty"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1441719575, "post_id": 32456499, "comment_id": 52780760, "body": "<code>enumerate</code> function can operate on a list of any type; the argument doesn&#39;t have to be a list of strings. You can define it with a generic type: <code>enumerate :: [a] -&gt; [(Int, a)]</code> and <code>aux :: Int -&gt; [a] -&gt; [(Int, a)]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441712132, "post_id": 32456592, "comment_id": 52775419, "body": "I know. But I want to implement one... Just for matters of study. Could you give me a hands up ?"}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441712192, "post_id": 32456592, "comment_id": 52775463, "body": "@PlayHardGoPro So you mean you want to implement your own <code>zip</code> function ?"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 1, "creation_date": 1441712285, "post_id": 32456592, "comment_id": 52775522, "body": "Yeah... I want to improve my knowledge about recursion. Guess that is a way to go. I should told that at first, sorry about it. I&#39;ll update the question"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441712905, "post_id": 32456592, "comment_id": 52775962, "body": "Nice man ! But what if I don&#39;t want to change my function structure. I mean, keep using only the string function.. Then the only solution will be a support function, right ?"}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441712953, "post_id": 32456592, "comment_id": 52775995, "body": "@PlayHardGoPro Yes pretty much."}], "tags": [], "owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "is_accepted": false, "score": 1, "last_activity_date": 1441712418, "last_edit_date": 1441712418, "creation_date": 1441711638, "answer_id": 32456592, "question_id": 32456499, "link": "https://stackoverflow.com/questions/32456499/numeration-count-inside-a-recursive-function/32456592#32456592", "title": "Numeration count inside a recursive function", "body": "<p>There is already a function which does this called <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:zip\" rel=\"nofollow\"><code>zip</code></a> (<code>zip :: [a] -&gt; [b] -&gt; [(a,b)]</code>). Now for your function you just can pass a list with <code>1,2,...</code> as first argument and get your result, e.g.</p>\n\n<pre><code>enumerate :: [String] -&gt; [(Int, String)]\nenumerate = zip [1..]\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>If you also want to implement your own <code>zip</code> function, just use:</p>\n\n<pre><code>zip' :: [a] -&gt; [b] -&gt; [(a,b)]\nzip' _ [] = []\nzip' [] _ = []\nzip' (x:xs) (y:ys) = (x,y):zip' xs ys\n</code></pre>\n\n<p>You take two lists (<code>[a]</code> and <code>[b]</code>) and put each element into a tuple. Edge cases are of cores when one of the lists is empty you return an empty list. Otherwise you use pattern matching to get the first element of the list put them into a tuple and call <code>zip'</code> again with the tail of the list. </p>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1441712525, "post_id": 32456873, "comment_id": 52775681, "body": "just a few seconds too late :)"}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1441712474, "creation_date": 1441712474, "answer_id": 32456873, "question_id": 32456499, "link": "https://stackoverflow.com/questions/32456499/numeration-count-inside-a-recursive-function/32456873#32456873", "title": "Numeration count inside a recursive function", "body": "<p>As you clarified you wanted to implement your own zip:</p>\n\n<pre><code>zip' [] _ = []\nzip' _ [] = []\nzip' (x:xs) (y:ys) = (x,y) : zip' xs ys\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1441714238, "post_id": 32456934, "comment_id": 52776882, "body": "Check that out whenever you can and give me your feedback."}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 5, "last_activity_date": 1441714967, "last_edit_date": 1441714967, "creation_date": 1441712620, "answer_id": 32456934, "question_id": 32456499, "link": "https://stackoverflow.com/questions/32456499/numeration-count-inside-a-recursive-function/32456934#32456934", "title": "Numeration count inside a recursive function", "body": "<p>Don't be afraid to write a support function, in fact, see it as opportunity: Why the arbitrary starting value 1? Why not have a function</p>\n\n<pre><code>&gt;enumerateFrom 42 [\"banana\", \"potato\", \"ice\"]\n[(42, \"banana\"), (43, \"potato\"), (44, \"ice\")]\n</code></pre>\n\n<p>Once you have that, <code>enumerate</code> is easy.</p>\n\n<p><em>Edit</em>:\nEither give your <code>aux</code> function a real name, IMHO <code>enumerateFrom</code> is good or move it into a <code>where</code> clause if you know that already. And listen to chi, use <code>x : ...</code> instead of <code>[x] ++ ...</code></p>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1441714967, "creation_date": 1441711364, "last_edit_date": 1441713337, "question_id": 32456499, "link": "https://stackoverflow.com/questions/32456499/numeration-count-inside-a-recursive-function", "title": "Numeration count inside a recursive function", "body": "<p>I want do do something like:  </p>\n\n<pre><code>&gt;enumerate [\"banana\", \"potato\", \"ice\"]\n[(1, \"banana\"), (2, \"potato\"), (3, \"ice\")]\n</code></pre>\n\n<p>I wrote:</p>\n\n<pre><code>enumerate :: [String] -&gt; [(Int, String)]\nenumerate [] = []\n</code></pre>\n\n<p>How may I control/manage the int counter ? Is there a way to do that without a support function ?</p>\n\n<p><em>Update:</em> I know about <a href=\"http://zvon.org/other/haskell/Outputprelude/zip_f.html\" rel=\"nofollow\">Zip</a> function. But for matter of study, I want to implement my own zip function.</p>\n\n<p><em>Update 2: Currently Code</em> </p>\n\n<p>This is what I did so far, using a support function. Considering that:  </p>\n\n<p>1) I want to implement my own <code>zip</code> function;<br>\n2) I do not want to change the function struct:  </p>\n\n<pre><code>   enumerate :: [String] -&gt; [(Int, String)]  \n\nenumerate :: [String]-&gt;[(Int,String)]\nenumerate [] = []\nenumerate list = aux 1 list\n\n\naux :: Int-&gt;[String]-&gt;[(Int, String)]\naux _ [] = []\naux i (x:xs) = [(i, x)] ++ aux (i+1) xs\n</code></pre>\n\n<p>Is it possible to improve this function ? As I don't want to add one more last to the function, so I think support function is the only way to go, right ?</p>\n"}, {"tags": ["haskell", "types", "numbers", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441764405, "post_id": 32449479, "comment_id": 52801519, "body": "I don&#39;t understand your example, or what it&#39;s intended to show. What&#39;s happening that&#39;s not happening here: <code>let b = Bar &quot;foo&quot; :: Bar n in show b</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441768383, "post_id": 32449479, "comment_id": 52802369, "body": "@jberryman The important part is where <code>n</code> comes from.  How does the type <code>n</code> come to exactly match the value provided at run time?  Types exist only at compile time in Haskell, after all. <i>That</i> is what <code>someNatVal</code> does."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 3, "last_activity_date": 1441687993, "creation_date": 1441687993, "answer_id": 32449479, "question_id": 32448889, "link": "https://stackoverflow.com/questions/32448889/in-ghc-typelits-what-is-somenatval-good-for-which-we-cant-accomplish-with-natv/32449479#32449479", "title": "In GHC.TypeLits what is someNatVal good for (which we can&#39;t accomplish with natVal)?", "body": "<p>The main use of <code>someNatVal</code> is using a value at run time as if it was a type that wasn't known at compile time.</p>\n\n<p>My answer to <a href=\"https://stackoverflow.com/questions/30752653/can-i-have-an-unknown-knownnat/30762622#30762622\">Can I have an unknown KnownNat?</a> provides a really dumb example.  There are a million better ways to write a program that does the same thing as that one.  But it shows what <code>someNatVal</code> does.  It's essentially a function from value to type - with an existential limiting the scope of that type to places where it's not statically known.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1445268553, "last_edit_date": 1495539964, "creation_date": 1445184281, "answer_id": 33200084, "question_id": 32448889, "link": "https://stackoverflow.com/questions/32448889/in-ghc-typelits-what-is-somenatval-good-for-which-we-cant-accomplish-with-natv/33200084#33200084", "title": "In GHC.TypeLits what is someNatVal good for (which we can&#39;t accomplish with natVal)?", "body": "<p><code>SomeNat</code> is existentially quantified:</p>\n\n<pre><code>data SomeNat = forall n. KnownNat n =&gt; SomeNat (Proxy n)\n</code></pre>\n\n<p>which reads like <code>SomeNat</code> contains, well, \"some <code>n :: Nat</code>\". <code>Proxy</code> is a singleton that allows to lift that <code>n</code> to the type-level to satisfy the type system \u2014 in a dependently typed language we need such construction very rarely. We can define <code>SomeNat</code> in more explicit way using <code>GADTs</code>:</p>\n\n<pre><code>data SomeNat where\n    SomeNat :: forall n. KnownNat n =&gt; Proxy n -&gt; SomeNat\n</code></pre>\n\n<p>So <code>SomeNat</code> contains a <code>Nat</code>, which is not known statically.</p>\n\n<p>Then</p>\n\n<pre><code>someNatVal :: Integer -&gt; Maybe SomeNat\n</code></pre>\n\n<p>reads like \"<code>someNatVal</code> receives an <code>Integer</code> and <code>Maybe</code> returns a hiden <code>Nat</code>\". We can't return a <code>KnownNat</code>, because <code>Known</code> means \"known at the type level\", but there is nothing we know about an arbitrary <code>Integer</code> at the type level.</p>\n\n<p>The inverse (modulo <code>SomeNat</code> wrapper and a <code>proxy</code> instead of the <code>Proxy</code>) of <code>someNatVal</code> is</p>\n\n<pre><code>natVal :: forall n proxy. KnownNat n =&gt; proxy n -&gt; Integer\n</code></pre>\n\n<p>Reads like \"<code>natVal</code> receives something that have a <code>Nat</code> in its type and returns that <code>Nat</code> converted to <code>Integer</code>\".</p>\n\n<p>Existentially quantified data types are usually <a href=\"https://stackoverflow.com/a/13246864/3237465\">used</a> for wrapping runtime values. Say you want to read a <code>Vec</code> (a list with statically known length) from <code>STDIN</code>, but how would you statically compute the length of input? There is no way. So you wrap a list, that you've read, in the corresponding existentially quantified data type, thus saying \"I don't know the length, but there exists one\".</p>\n\n<p>However it's overkill in many cases. To do something with existentially quantified data type you need to be general: e.g. if you need to find the sum of elements of a <code>SomeVec</code> you have to define <code>sumVec</code> for <code>Vec</code>s with arbitrary length. Then you unwrap the <code>SomeVec</code> and apply <code>sumVec</code>, thus saying \"I don't know the length of a wrapped <code>Vec</code>, but <code>sumVec</code> doesn't care\". But instead of this wrapping-unwrapping you can <a href=\"https://stackoverflow.com/a/27070207/3237465\">directly</a> use CPS.</p>\n\n<p>However because of this generality you'll need to enable <a href=\"https://stackoverflow.com/questions/33092864/what-is-predicativity\"><code>ImpredicativeTypes</code></a> to be able to define, say, a list with such continuations. In that case a list with existentially quantified data is a <a href=\"https://stackoverflow.com/a/33106169/3237465\">common pattern</a> that allows to get round <code>ImpredicativeTypes</code>.</p>\n\n<p>As to your example, with properly defined <code>Nat</code>s, a version that compares <code>Nat</code>s is <a href=\"https://stackoverflow.com/a/33020263/3237465\">lazier</a>, than a version that compares <code>Integer</code>s.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 3, "answer_count": 2, "score": 11, "last_activity_date": 1445268553, "creation_date": 1441683332, "question_id": 32448889, "link": "https://stackoverflow.com/questions/32448889/in-ghc-typelits-what-is-somenatval-good-for-which-we-cant-accomplish-with-natv", "title": "In GHC.TypeLits what is someNatVal good for (which we can&#39;t accomplish with natVal)?", "body": "<p>I'm trying to understand <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\"><code>GHC.TypeLits</code></a>, and specifically <code>someNatVal</code>. I understand the way it's used in this blog <a href=\"http://snak.tumblr.com/post/110021257487/convert-a-type-level-natural-number-to-a-value\" rel=\"noreferrer\">post here</a>, but as mentioned the same example could have been implemented using <code>natVal</code>, like:</p>\n\n<pre><code>isLength :: forall len a. KnownNat len =&gt; Integer -&gt; List len a -&gt; Bool\nisLength n _ = n == natVal (Proxy :: Proxy len)\n</code></pre>\n\n<p>Are there any uses of <code>someNatVal</code> that can't be rewritten with <code>natVal</code>?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1441659050, "post_id": 32445876, "comment_id": 52755252, "body": "I\u2019m not sure the last paragraph and code block are terribly clear, but I can\u2019t think of a better way to explain it right now."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441659895, "post_id": 32445876, "comment_id": 52755531, "body": "We can build things up with applicative parsers too, without being able to do that, but for now, most popular parsing libraries are monadic."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441660207, "post_id": 32445876, "comment_id": 52755621, "body": "@dfeuer: I was more saying that that value needs to go somewhere if it\u2019s going to be useful, because otherwise you end up with something having only the power of <code>&gt;&gt;</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1441697195, "post_id": 32445876, "comment_id": 52765893, "body": "If all results are used only in the final <code>return</code>, then <code>Applicative</code> is enough: <code>parseTwoOf p = (,) &lt;$&gt; p &lt;*&gt; p</code>."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1441760044, "post_id": 32445876, "comment_id": 52800484, "body": "@user3237465: As I was saying to dfeuer, yes, I\u2019m well aware <code>Applicative</code> is sufficient\u2014I was not trying to say the power of <code>Monad</code> was necessary, but rather that if you want <code>&gt;&gt;=</code> to be able to do anything more than <code>&gt;&gt;</code> can do, you cannot discard the value of <code>a</code>."}], "tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 3, "last_activity_date": 1441658976, "creation_date": 1441658976, "answer_id": 32445876, "question_id": 32445803, "link": "https://stackoverflow.com/questions/32445803/haskell-using-list-comprehension-in-sequencing-a-monad/32445876#32445876", "title": "Haskell: Using list comprehension in sequencing a Monad", "body": "<p>The type of <code>(&gt;&gt;=)</code>, instantiated with the monad <code>Parser</code>, has this type signature:</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n</code></pre>\n\n<p>Hence, when defining <code>p &gt;&gt;= f</code>, <code>p</code> has type <code>Parser a</code> and <code>f</code> has type <code>a -&gt; Parser b</code>. That\u2019s why <code>f a</code> is a parser and not <code>f</code>: <code>f</code> is a function from <code>a</code> to <code>Parser b</code>s.</p>\n\n<p>The reason it\u2019s that way is that without it, we could combine parsers\u2026 but we would never be able to use the result of the previous parser in the next parse! By passing the result of the previous parser forward, we can build up data out of the results of multiple parsers, e.g.:</p>\n\n<pre><code>parseTwoOf :: Parser a -&gt; Parser (a, a)\nparseTwoOf p = p &gt;&gt;= \\first -&gt; p &gt;&gt;= \\second -&gt; return (first, second)\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 4959635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90cf059a3d64b60823745f54aa8a5ecf?s=128&d=identicon&r=PG&f=1", "display_name": "mavavilj", "link": "https://stackoverflow.com/users/4959635/mavavilj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 32445876, "answer_count": 1, "score": 0, "last_activity_date": 1441658976, "creation_date": 1441658598, "question_id": 32445803, "link": "https://stackoverflow.com/questions/32445803/haskell-using-list-comprehension-in-sequencing-a-monad", "title": "Haskell: Using list comprehension in sequencing a Monad", "body": "<p>I'm reading this paper regarding a <a href=\"https://www.cs.nott.ac.uk/~gmh/pearl.pdf\" rel=\"nofollow\">monadic parser in Haskell</a> and as a newbie I cannot understand the following construct:</p>\n\n<pre><code>newtype Parser a = Parser (String -&gt; [(a, String)])\n\ninstance Monad Parser where\n  return a = Parser (\\cs -&gt; [(a,cs)])\n  p &gt;&gt;= f  = Parser (\\cs -&gt; concat [parse (f a) cs\u2019 |\n                               (a,cs\u2019) &lt;- parse p cs])\n\nparse :: Parser a -&gt; String -&gt; [(a,String)]\nparse (Parser p) = p\n</code></pre>\n\n<p>It says in the text that:</p>\n\n<blockquote>\n  <p>Using a deconstructor function for parsers defined by parse (Parser p) = p, the parser p >>= f first applies the parser p to the argument string cs to give a list of results of the form (a,cs\u2019), where a is a value and cs\u2019 is a string. For each such pair, f a is a parser which is applied to the string cs\u2019.</p>\n</blockquote>\n\n<p>Why is (f a) and not f a parser? And why is passing the 'a' necessary?</p>\n"}, {"tags": ["haskell", "memory-leaks", "space-leak"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1441656528, "post_id": 32445309, "comment_id": 52754305, "body": "You have not prevented an unbounded number of threads from running simultaneously. Read your program carefully."}, {"owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1441656741, "post_id": 32445309, "comment_id": 52754384, "body": "@ReidBarton : I think I get it: forkIO returns immediately, making the semaphore useless. Back to the design table :)"}], "answers": [{"comments": [{"owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "edited": false, "score": 0, "creation_date": 1441656801, "post_id": 32445475, "comment_id": 52754410, "body": "My goal is to limit the number of concurrent threads, but now I see why it doesn&#39;t work. The infinite list is by design, because I&#39;d like my program to be able to handle an infinite stream of actions."}, {"owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "edited": false, "score": 0, "creation_date": 1441658465, "post_id": 32445475, "comment_id": 52755024, "body": "Thanks a lot. I just needed a little extra help to understand that I needed wait and signal on the two sides of forkIO, which is why (if I understand correctly) with can&#39;t be used in this case."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 6, "last_activity_date": 1441657420, "last_edit_date": 1441657420, "creation_date": 1441656738, "answer_id": 32445475, "question_id": 32445309, "link": "https://stackoverflow.com/questions/32445309/why-does-my-parallel-traversal-haskell-program-leak-memory/32445475#32445475", "title": "Why does my parallel traversal Haskell program leak memory?", "body": "<p>First of all, you have an evident mistake in the following piece:</p>\n\n<pre><code>Sem.with sem (forkIO $ action value)\n</code></pre>\n\n<p>You're addressing the semaphore from the master thread around the \"fork\" operation instead of the action there. Following is the proper way to implement it:</p>\n\n<pre><code>forkIO (Sem.with sem (action value))\n</code></pre>\n\n<p>I.e., to address the semaphore from the context of the forked thread.</p>\n\n<p>Secondly, in the following code you're calling the <code>parallelTraverse</code> operation on an infinite list:</p>\n\n<pre><code>parallelTraverse nThreads print [(1::Int)..]\n</code></pre>\n\n<p>Which results in the infinite forking of threads. And since the <code>forkIO</code> operation is roughly instantaneous for the calling thread, it's pretty much no surprise that you're running out of resources quite soon.</p>\n\n<hr>\n\n<p>To use the semaphore to limit the number of worker threads the <code>with</code> pattern simply won't do in your case. Instead you should use the explicit combination of <code>wait</code> and <code>signal</code> and not forget to treat the exceptions properly (in case you expect them). E.g.,:</p>\n\n<pre><code>parallelTraverse :: Foldable a =&gt; Int -&gt; (b -&gt; IO()) -&gt; a b -&gt; IO ()\nparallelTraverse n action values = do\n  sem &lt;- Sem.new n\n  forM_ values $ \\value -&gt; do\n    Sem.wait sem\n    forkIO $ finally (action value) (Sem.signal sem)\n</code></pre>\n"}], "owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "accepted_answer_id": 32445475, "answer_count": 1, "score": 3, "last_activity_date": 1441657420, "creation_date": 1441655919, "question_id": 32445309, "link": "https://stackoverflow.com/questions/32445309/why-does-my-parallel-traversal-haskell-program-leak-memory", "title": "Why does my parallel traversal Haskell program leak memory?", "body": "<p>Consider the following Haskell program (I'm doing this mostly for learning purposes):</p>\n\n<pre><code>import qualified Control.Concurrent.MSem as Sem\nimport System.Environment (getArgs)\nimport Control.Concurrent (forkIO)\nimport Control.Monad\n\n-- Traverse with maximum n threads\nparallelTraverse :: Foldable a =&gt; Int -&gt; (b -&gt; IO()) -&gt; a b -&gt; IO ()\nparallelTraverse n action values = do\n  sem &lt;- Sem.new n\n  forM_ values $ \\value -&gt; Sem.with sem (forkIO $ action value)\n\nmain :: IO ()\nmain = do\n  args &lt;- getArgs\n  let nThreads = read . head $ args :: Int\n  parallelTraverse nThreads print [(1::Int)..]\n</code></pre>\n\n<p>when I run it, memory quickly climbs to several GB. I tried various combinations to make sure I discard the results of intermediate computations (the print actions). Why is it still leaking space?</p>\n"}, {"tags": ["haskell", "dll", "sandbox", "cabal", "conduit"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441653869, "post_id": 32444762, "comment_id": 52753335, "body": "One thing that can make cabal go boom is if you fail to list one of your modules in the cabal file. This doesn&#39;t look likely to be the problem here, but I figured I&#39;d mention it anyway. <code>cabal clean</code> is sometimes helpful, but it sounds like you&#39;ve already tried more extreme measures. Another fairly extreme one is nuking your <code>.ghc</code> directory."}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441653903, "post_id": 32444762, "comment_id": 52753351, "body": "@dfeuer I did that about an hour ago with the haskell reinstall"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484333539, "post_id": 32444762, "comment_id": 70482874, "body": "@dfeuer - I <a href=\"https://github.com/rampion/cabal-linking-bug\" rel=\"nofollow noreferrer\">can reliably produce a &quot;can&#39;t load .so/.DLL&quot; error when a dependency fails to list a module in the cabal file</a>, is that what you&#39;re talking about? And do you know if it already has a bug report?"}], "answers": [{"comments": [{"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "edited": false, "score": 0, "creation_date": 1441680195, "post_id": 32448268, "comment_id": 52760042, "body": "I completely removed the platform install, reinstalled it, new folder, new sandbox, newly reinstalled dependencies, same problem"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "edited": false, "score": 0, "creation_date": 1441683908, "post_id": 32448268, "comment_id": 52760835, "body": "Right. So I&#39;m saying the problem may be the platform, and recommending you install something else. I&#39;ve linked to two alternative installation methods"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1441678480, "creation_date": 1441678480, "answer_id": 32448268, "question_id": 32444762, "link": "https://stackoverflow.com/questions/32444762/cabal-repl-wont-run-cant-load-so-dll-for/32448268#32448268", "title": "Cabal repl won&#39;t run, &quot;can&#39;t load .so/.DLL for: ...&quot;", "body": "<p>Given that this report refers to a problem loading hashable, and <a href=\"https://github.com/snoyberg/conduit/issues/225\" rel=\"nofollow\">the Github report</a> refers to a problem loading exceptions, both of which are packages provided by the platform and not GHC, I have a feeling there's a problem with the platform installer. Can you try again with either <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow\">GHC for Mac OS X</a> or <a href=\"https://github.com/commercialhaskell/stack#readme\" rel=\"nofollow\">stack</a> and see if it resolves the issue?</p>\n\n<p>Note that, if you go the stack route, you'll want to run <code>stack init &amp;&amp; stack build --install-ghc &amp;&amp; stack ghci</code> in your project. In either case: you'll probably be safer if you completely remove the platform install first.</p>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1052, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1441678480, "creation_date": 1441652940, "last_edit_date": 1441658727, "question_id": 32444762, "link": "https://stackoverflow.com/questions/32444762/cabal-repl-wont-run-cant-load-so-dll-for", "title": "Cabal repl won&#39;t run, &quot;can&#39;t load .so/.DLL for: ...&quot;", "body": "<p>I am trying to get a project running that uses <code>conduit</code> and <code>conduit-extra</code>. This is the main module:</p>\n\n<pre><code>import Data.Conduit\n\nmain = do\n    putStrLn \"Done\"\n</code></pre>\n\n<p>The cabal file requires base, conduit and conduit-extra:</p>\n\n<pre><code>...\n\nbuild-depends:     base &gt;=4.8 &amp;&amp; &lt;4.9,\n                   conduit &gt;=1.2.5 &amp;&amp; &lt;1.3,\n                   conduit-extra &gt;= 1.1.9.1 &amp;&amp; &lt;1.2\n...\n</code></pre>\n\n<p>Yet when I run <code>cabal repl</code>,  this happens:</p>\n\n<pre><code>Johns-iMac:The-Project john$ cabal repl\nPreprocessing executable 'The-Project' for The-Project-0.1.0.0...\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n&lt;command line&gt;: can't load .so/.DLL for: /Library/Haskell/ghc-7.10.2-x86_64/lib/exceptions-0.8.0.2/libHSexceptions-0.8.0.2-8GsEeHgaIks3pVGk6GaELJ-ghc7.10.2.dylib (dlopen(/Library/Haskell/ghc-7.10.2-x86_64/lib/exceptions-0.8.0.2/libHSexceptions-0.8.0.2-8GsEeHgaIks3pVGk6GaELJ-ghc7.10.2.dylib, 5): Library not loaded: @rpath/libHStransformers-compat-0.4.0.4-DCQioW2d4vYEa3T0AmFBPv-ghc7.10.2.dylib\n  Referenced from: /Library/Haskell/ghc-7.10.2-x86_64/lib/exceptions-0.8.0.2/libHSexceptions-0.8.0.2-8GsEeHgaIks3pVGk6GaELJ-ghc7.10.2.dylib\n  Reason: image not found)\n</code></pre>\n\n<p>I just completely reinstalled the Haskell Platform, and it's all sandboxed, so there shouldn't be any problems with competing dependencies.</p>\n\n<p>What is happening, and how do I fix it?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I deleted the sandbox (cabal.sandbox.config, .cabal-sandbox), and reinstalled the dependencies:</p>\n\n<pre><code>cabal sandbox init\ncabal install --only-dependencies\ncabal repl\n</code></pre>\n\n<p>We now have a new but very similar error:</p>\n\n<pre><code>Johns-iMac:The-Project john$ cabal repl\nPreprocessing executable 'The-Project' for The-Project-0.1.0.0...\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n&lt;command line&gt;: can't load .so/.DLL for: /Library/Haskell/ghc-7.10.2-x86_64/lib/hashable-1.2.3.3/libHShashable-1.2.3.3-2GTZqecVp8NJZrNuKzGxfy-ghc7.10.2.dylib (dlopen(/Library/Haskell/ghc-7.10.2-x86_64/lib/hashable-1.2.3.3/libHShashable-1.2.3.3-2GTZqecVp8NJZrNuKzGxfy-ghc7.10.2.dylib, 5): Library not loaded: @rpath/libHStext-1.2.1.3-1l1AN4I48k37RaQ6fm6CEh-ghc7.10.2.dylib\n  Referenced from: /Library/Haskell/ghc-7.10.2-x86_64/lib/hashable-1.2.3.3/libHShashable-1.2.3.3-2GTZqecVp8NJZrNuKzGxfy-ghc7.10.2.dylib\n  Reason: image not found)\n</code></pre>\n"}, {"tags": ["haskell", "serialization", "types"], "comments": [{"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1441650311, "post_id": 32444236, "comment_id": 52751993, "body": "I\u2019m curious about the answer for its own sake, but I\u2019d be worried that any method like this is going to make it hard to, say, refactor by moving a type into a different module, or renaming it."}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "edited": false, "score": 0, "creation_date": 1441653850, "post_id": 32444236, "comment_id": 52753324, "body": "It would help if you gave more information about the type. There are serialization libraries for a lot of different types of data."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1441668460, "post_id": 32445263, "comment_id": 52757581, "body": "Thanks, that was very helpful! It occurs to me that if I want to answer &quot;is this the correct/same/requested type?&quot;, I need to decide &quot;correct type&quot; with respect to what aspect of the data (as both the internal representations and exposed bits of a type change over versions, and even across architectures). In my case I&#39;m dealing with hashes. I&#39;m thinking of adding a method something like <code>typeIdentity :: UUID</code> to the <a href=\"http://hackage.haskell.org/package/hashabler-1.0/docs/Data-Hashabler.html#t:Hashable\" rel=\"nofollow noreferrer\"><code>Hashable</code></a> class. Might take some further explanation why I think that&#39;s justified."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441683414, "post_id": 32445263, "comment_id": 52760738, "body": "@jberryman, it kind of sounds like your use case was pretty different from what I imagined. Now I&#39;m curious what those phantoms are about."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441684235, "post_id": 32445263, "comment_id": 52760892, "body": "It&#39;s a bloom filter. We constrain it to a single type <code>BloomFilter Things</code> because our hashing library cannot ensure the well-behavedness of hashes of two different types with respect to each other (i.e. &quot;similar&quot; objects of different types might hash to the same value, which you might consider a collision). Of course no values of type <code>Things</code> appear in <code>BloomFilter</code> since it&#39;s just a byte array. Incidentally I&#39;m also considering type-level nat parameters for length etc. so that it can be a Monoid, but I&#39;m not sure that&#39;s going to be feasible"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1441686178, "post_id": 32445263, "comment_id": 52761298, "body": "@jberryman, this is strongly reminiscent of what Ed Kmett&#39;s hyperloglog does. Read the GitHub source-it&#39;s been cleaned up quite a lot since the last release."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1441655647, "creation_date": 1441655647, "answer_id": 32445263, "question_id": 32444236, "link": "https://stackoverflow.com/questions/32444236/serialisable-stable-representation-of-a-type/32445263#32445263", "title": "Serialisable stable representation of a type", "body": "<p>You might be able to play games with <code>Typeable</code>, as the <a href=\"https://hackage.haskell.org/package/binary-typed\" rel=\"nofollow\">binary-typed</a> package does. It allows you to remove and reconstruct fingerprints as needed. I'm not sure if that will work for types manufactured on the fly. Another option is to manufacture some tags yourself, as long as you know or can figure out which values have the same phantoms. An extreme approach might be to build a <code>Map</code> of the <code>TypeRep</code>s you see along the way, mapping them to unique <code>Int</code> values. On the other end, you can make an <code>IntMap</code> from the tags to functions that wrap up the values properly.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 32445263, "answer_count": 1, "score": 4, "last_activity_date": 1452980661, "creation_date": 1441650128, "last_edit_date": 1452980661, "question_id": 32444236, "link": "https://stackoverflow.com/questions/32444236/serialisable-stable-representation-of-a-type", "title": "Serialisable stable representation of a type", "body": "<p>I'm working on a data structure that I would like to serialize, with an API like:</p>\n\n<pre><code>serialize :: Foo a -&gt; ByteString\ndeserialize :: ByteString -&gt; Maybe (Foo a)\n</code></pre>\n\n<p>In my case <code>a</code> is a phantom parameter; there are no values in <code>Foo</code> to witness that type, but preserving the type is important.</p>\n\n<p>GHC provides <code>Typeable</code> which can give me a <code>TypeRep</code> form which I can extract a <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-Fingerprint-Type.html#v:Fingerprint\" rel=\"nofollow\"><code>Fingerprint</code> </a>, but I don't believe that representation is necessarily stable across different architectures and versions of GHC.</p>\n\n<p>Is there some way I can reliably serialize a type representation, perhaps with the new static pointers thing, or something else in <code>base</code>?</p>\n\n<p><strong>EDIT</strong>: I've implemented this type versioning functionality (sort of \"hashing of types\") in <a href=\"http://hackage.haskell.org/package/hashabler-1.2.1\" rel=\"nofollow\">hashabler</a>; see <code>TypeHash</code>.</p>\n"}, {"tags": ["list", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 5310065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803533c68dce8a808a5e29a9706e1ee0?s=128&d=identicon&r=PG&f=1", "display_name": "AnimeBear", "link": "https://stackoverflow.com/users/5310065/animebear"}, "edited": false, "score": 0, "creation_date": 1441650929, "post_id": 32444220, "comment_id": 52752213, "body": "Can I find the unzip implementation? I searched for it but got no sucess."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 41, "user_id": 5310065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803533c68dce8a808a5e29a9706e1ee0?s=128&d=identicon&r=PG&f=1", "display_name": "AnimeBear", "link": "https://stackoverflow.com/users/5310065/animebear"}, "edited": false, "score": 0, "creation_date": 1441651077, "post_id": 32444220, "comment_id": 52752266, "body": "@AnimeBear: Well, the implementation that GHC uses can be found by clicking the \u201cSource\u201d link on the right-hand-side of the <code>unzip</code> header in the documentation I linked to, which points to <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.List.html#unzip\" rel=\"nofollow noreferrer\">this source</a>. It\u2019s not very enlightening, though; an implementation with explicit recursion might look like <code>unzip [] = []; unzip ((a,b):xs) = (a:as, b:bs) where (as,bs) = unzip xs</code>."}], "tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 8, "last_activity_date": 1441650025, "creation_date": 1441650025, "answer_id": 32444220, "question_id": 32444196, "link": "https://stackoverflow.com/questions/32444196/converting-a-list-of-tuples-to-a-tuple-of-lists-recursively/32444220#32444220", "title": "Converting a list of tuples to a tuple of lists recursively", "body": "<p>You\u2019re looking for <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:unzip\"><code>unzip</code></a>:</p>\n\n<pre><code>unzip :: [(a, b)] -&gt; ([a], [b])\n</code></pre>\n\n<p>As general advice, when you know a type signature and you\u2019re wondering if there\u2019s any already-existing function that has that type signature, <a href=\"https://www.haskell.org/hoogle/\">Hoogle</a> is a good bet; <a href=\"https://www.haskell.org/hoogle/?hoogle=%5B%28a%2C+b%29%5D+-%3E+%28%5Ba%5D%2C+%5Bb%5D%29\">searching for that type signature</a> finds <code>unzip</code> as its first and only result.</p>\n"}], "owner": {"reputation": 41, "user_id": 5310065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803533c68dce8a808a5e29a9706e1ee0?s=128&d=identicon&r=PG&f=1", "display_name": "AnimeBear", "link": "https://stackoverflow.com/users/5310065/animebear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1209, "favorite_count": 0, "accepted_answer_id": 32444220, "answer_count": 1, "score": 3, "last_activity_date": 1441650356, "creation_date": 1441649876, "last_edit_date": 1441650356, "question_id": 32444196, "link": "https://stackoverflow.com/questions/32444196/converting-a-list-of-tuples-to-a-tuple-of-lists-recursively", "title": "Converting a list of tuples to a tuple of lists recursively", "body": "<p>I need a recursive function that returns a tuple of lists from a list of tuples. In other words, its type signature would be</p>\n\n<pre><code>func :: [(a,b)] -&gt; ([a],[b])\n</code></pre>\n\n<p>Here is an example:</p>\n\n<pre><code>\u03bb&gt; func [(1,3), (2,4)]\n([1,2], [3,4])\n</code></pre>\n\n<p>I made two functions to return a list of the first and second elements from the tuples and joining them, but I want only one recursive function to do it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441649005, "post_id": 32443925, "comment_id": 52751525, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/31503707/strange-haskell-expression-with-type-num-char-t-t\">Strange Haskell expression with type Num (&#91;Char&#93; -&gt; t) =&gt; t</a>"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1441652179, "post_id": 32443925, "comment_id": 52752671, "body": "@jberryman The logic behind the type derivations is similar, but both questions are very good and different examples of Haskell&#39;s expressive power. Their answers are very informative and deserve to be independent questions."}], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1441649955, "post_id": 32444024, "comment_id": 52751848, "body": "I am beginning to understand all this Haskell power, but I expect that all this power is not used in real-world code, if anything else, because I do not see how this could be useful in practice. Does anyone know of useful examples of this?"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1441650181, "post_id": 32444024, "comment_id": 52751943, "body": "Another question. Can you change your answer to provide a type derivation for (+) (-) in a mathematical way, that is, in a way that Haskell uses itself?"}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 5, "creation_date": 1441650183, "post_id": 32444024, "comment_id": 52751944, "body": "In answer to your first question - yes! For example, the paper <a href=\"http://conal.net/papers/beautiful-differentiation/\" rel=\"nofollow noreferrer\">Beautiful Differentiation</a> by Conal Elliott presents an Automatic Differentiation algorithm that takes advantage of the <code>Num</code> instance for functions, and is particularly clear and simple to read (hence &quot;beautiful&quot; differentiation). Since automatic differentiation is used in optimization, machine learning, aeronautics and finance, I claim that this is an example of something both &quot;useful&quot; and &quot;real-world&quot;."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1441650568, "post_id": 32444024, "comment_id": 52752073, "body": "In answer to your second question, I just provided the derivation."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1441651999, "post_id": 32444024, "comment_id": 52752611, "body": "Thanks a lot! There&#39;s so much stuff here to grok. I did not know the syntax you are using in <code>(f + g) r = ...</code> ?! I have only seen so far (I am a newbie) functions defined as <code>f a b c = ...</code> and <code>f . g = ...</code>. So, in Haskell we can have any kind of expression on the LHS of an equation? Is there an accessible place to learn the full Haskell syntax? I have read &quot;Learn you a Haskell ... &quot; and I am reading &quot;Real World Haskell&quot; and never saw this syntax. Clarify please."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1441657651, "post_id": 32444024, "comment_id": 52754730, "body": "@mljrg No, you can&#39;t have just any kind of expression on the LHS, that would add a lot of complexity. This is just a shorthand for writing <code>f + g = \\r -&gt; ...</code> or <code>(+) f g r = ...</code>."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1441705101, "post_id": 32444024, "comment_id": 52770684, "body": "@DavidYoung So the syntax <code>(f ...) ... = ...</code> is just syntactic sugar that allows to express functions with a more mathematical notation."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1441712878, "post_id": 32444024, "comment_id": 52775943, "body": "@mljrg Yes. You presumably already know that writing the expression <code>a + b</code> is just syntactic sugar for <code>(+) a b</code>. The same is true when defining a function, so <code>(f + g) r = ...</code> is syntactic sugar for <code>((+) f g) r = ...</code> which is equivalent to <code>(+) f g r = ...</code>. It&#39;s just a slightly nicer way of defining the function <code>(+)</code>. I could also have written <code>f + g = \\r -&gt; ...</code> and it would mean the same thing."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": true, "score": 20, "last_activity_date": 1441650554, "last_edit_date": 1441650554, "creation_date": 1441649058, "answer_id": 32444024, "question_id": 32443925, "link": "https://stackoverflow.com/questions/32443925/haskell-weird-expression/32444024#32444024", "title": "Haskell weird expression", "body": "<p>It's not an \"unfortunate consequence\". In fact, some might see it as a feature! The types of <code>(+)</code> and <code>(-)</code> are</p>\n\n<pre><code>&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n&gt; :t (-)\n(-) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>It's important to realize that this is valid for <em>any</em> type <code>a</code>, even if <code>a</code> is a function type. So, for example, if the type <code>b -&gt; b -&gt; b</code> has a <code>Num</code> instance, then you could restrict <code>(+)</code> to</p>\n\n<pre><code>(+) :: Num (b -&gt; b -&gt; b) =&gt; (b -&gt; b -&gt; b) -&gt; (b -&gt; b -&gt; b) -&gt; b -&gt; b -&gt; b\n</code></pre>\n\n<p>by simply setting <code>a = b -&gt; b -&gt; b</code>. Because of currying, the parentheses around the last three <code>b</code>s are unnecessary (you could write them in but they would be redundant).</p>\n\n<p>Now, <code>Num b =&gt; b -&gt; b -&gt; b</code> is exactly the type of <code>(-)</code> (with the proviso that <code>b</code> itself has to have a <code>Num</code> instance), so the function <code>(-)</code> fills the first \"slot\" of <code>(+)</code> and the type of <code>(+) (-)</code> is</p>\n\n<pre><code>(+) (-) :: (Num b, Num (b -&gt; b -&gt; b)) -&gt; (b -&gt; b -&gt; b) -&gt; b -&gt; b -&gt; b\n</code></pre>\n\n<p>which is what you observed.</p>\n\n<hr>\n\n<p>This raises the question of why on earth it might be useful to have a <code>Num</code> instance for functions at all. In fact, does it even make sense to define a <code>Num</code> instance for functions?</p>\n\n<p>I claim that it does! You can define</p>\n\n<pre><code>instance Num a =&gt; Num (r -&gt; a) where\n    (f + g) r = f r + g r\n    (f - g) r = f r - g r\n    (f * g) r = f r * g r\n    abs f r = abs (f r)\n    signum f r  = signum (f r) \n    fromInteger n r = fromInteger n\n</code></pre>\n\n<p>which makes perfect sense as a <code>Num</code> instance. And in fact, this is precisely the instance you need to interpret your expression <code>e</code> -</p>\n\n<pre><code>&gt; let e = (+) (-)\n&gt; e 3 2 1\n4\n</code></pre>\n\n<p>Buh?!?</p>\n\n<p>What happened is the following. Since <code>(Num a) =&gt; r -&gt; a</code> is a valid <code>Num</code> instance for any <code>r</code>, you can replace <code>r</code> with <code>a -&gt; a</code>, which shows that <code>(Num a) =&gt; a -&gt; a -&gt; a</code> is also a valid <code>Num</code> instance. So you have</p>\n\n<pre><code>-- Remember that (+) f = \\g r -&gt; f r + g r\n\n  (+) (-) 3 2 1\n= (\\g r s -&gt; (-) r s + g r s) 3 2 1 -- definition of (+) on functions\n= (\\  r s -&gt; (-) r s + 3 r s) 2 1   -- beta reduction\n= (\\    s -&gt; (-) 2 s + 3 2 s) 1     -- beta reduction\n=            (-) 2 1 + 3 2 1        -- beta reduction\n=            (2 - 1) + 3            -- since (3 2) = 3 and (3 1) = 3\n=               1    + 3\n=               4\n</code></pre>\n\n<p>A little convoluted (in particular, make sure you understand why <code>3 2 = 3</code>) but not too confusing once you've expanded all the definitions out!</p>\n\n<hr>\n\n<p>You asked for the derivation of the type of <code>(+) (-)</code> that Haskell uses. It relies on the idea of \"unification\" of type variables. It goes something like this -</p>\n\n<ol>\n<li>You know that <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code> and <code>(-) :: Num b =&gt; b -&gt; b -&gt; b</code> (I use different letters because we will want to mash these together).</li>\n<li>If you are going to put <code>(-)</code> into the first slot of <code>(+)</code> you must have <code>a ~ b -&gt; b -&gt; b</code>, so the combined type is</li>\n<li><code>(+) (-) :: (Num a, Num b, a ~ b -&gt; b -&gt; b) =&gt; (b -&gt; b -&gt; b) -&gt; (b -&gt; b -&gt; b)</code></li>\n<li>Now you \"unify\" <code>a</code> with <code>b -&gt; b -&gt; b</code> (as indicated on the left of the fat arrow, by the <code>~</code> sign) which leaves you with</li>\n<li><code>(+) (-) :: (Num (b -&gt; b -&gt; b), Num b) =&gt; (b -&gt; b -&gt; b) -&gt; (b -&gt; b -&gt; b)</code></li>\n<li>If we remove the right-most parentheses (because they are redundant) and rename <code>b</code> to <code>a</code>, this is the type signature that Haskell infers.</li>\n</ol>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 1, "accepted_answer_id": 32444024, "answer_count": 1, "score": 17, "last_activity_date": 1441650554, "creation_date": 1441648570, "question_id": 32443925, "link": "https://stackoverflow.com/questions/32443925/haskell-weird-expression", "title": "Haskell weird expression", "body": "<p>I would like to understand why the following is a valid expression in Haskell:</p>\n\n<pre><code>Prelude&gt; let e = (+) (-)\nPrelude&gt; :type e\ne :: (Num (a -&gt; a -&gt; a), Num a) =&gt; (a -&gt; a -&gt; a) -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>More strange is that any expression in the form</p>\n\n<pre><code>e 1 2 3 4 ... N\n</code></pre>\n\n<p>whatever N are all valid expressions of uncomprehensible type. For example,</p>\n\n<pre><code>Prelude&gt; :t e 1 2 3 4 5\ne 1 2 3 4 5\n  :: (Num ((a -&gt; a1 -&gt; t) -&gt; (a -&gt; a1 -&gt; t) -&gt; a -&gt; a1 -&gt; t),\n      Num (a -&gt; a1 -&gt; t), Num a1, Num a) =&gt;\n     t\n</code></pre>\n\n<p>Is this an unfortunate consequence of currying and type inference?</p>\n\n<p>Clarifications are welcome.</p>\n"}, {"tags": ["haskell", "intellij-idea", "cabal", "ghc-mod"], "comments": [{"owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "edited": false, "score": 0, "creation_date": 1448006972, "post_id": 32442723, "comment_id": 55408947, "body": "Are you still experiencing this issue?  Have you submitted this on the HaskForce and/or ghc-mod issue trackers?"}, {"owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "reply_to_user": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "edited": false, "score": 0, "creation_date": 1448013050, "post_id": 32442723, "comment_id": 55412369, "body": "@pyrospade: Carry Robbins has just released a new version of haskforce that is supposed to work with ghc-mod 5.4. I have to test it."}, {"owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "edited": false, "score": 0, "creation_date": 1448034827, "post_id": 32442723, "comment_id": 55426612, "body": "Here&#39;s a twist...I <i>am</i> Cary.  It seems that your error is related to the installation of ghc-mod.  You could, alternatively, build ghc-mod from source using stack or install it in a cabal sandbox."}, {"owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "reply_to_user": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "edited": false, "score": 0, "creation_date": 1448742030, "post_id": 32442723, "comment_id": 55708327, "body": "@pyrospade: it works now."}], "answers": [{"tags": [], "owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "is_accepted": true, "score": 1, "last_activity_date": 1448742017, "creation_date": 1448742017, "answer_id": 33976028, "question_id": 32442723, "link": "https://stackoverflow.com/questions/32442723/ghc-modi-and-cabal-version/33976028#33976028", "title": "ghc-modi and cabal version", "body": "<p>Updated Haskforce plugin (0.3-beta24) seems to work correctly with following ghc-mod:</p>\n\n<pre><code>ghc-mod version 5.4.0.0 compiled by GHC 7.10.2\n</code></pre>\n"}], "owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 1, "accepted_answer_id": 33976028, "answer_count": 1, "score": 1, "last_activity_date": 1448742017, "creation_date": 1441642701, "question_id": 32442723, "link": "https://stackoverflow.com/questions/32442723/ghc-modi-and-cabal-version", "title": "ghc-modi and cabal version", "body": "<p>(Haskell newbie here)</p>\n\n<p>I'm trying to configure HaskForce plugin into IntelliJ IDEA, configured \"ghc-mod\" with \"legacy-interactive\" in \"GHC Modi\" <code>Flags</code>. The root problem seems to be related to cabal version, although when I try autocompleting on any Haskell symbol, I get this:</p>\n\n<pre><code>ghc-modi error\n           Unable to parse problems from ghc-modi: cabal-helper-wrapper.exe: ghc: readCreateProcess: does not exist (No such file or directory)\n\n           ghc-mod: readCreateProcess: C:\\ACME\\projects\\htest\\.cabal-sandbox\\cabal-helper-0.5.3.0-553kah86RQN6BuDX6XLBiX\\cabal-helper-wrapper.exe \"C:\\\\ACME\\\\projects\\\\htest\" \"C:\\\\ACME\\\\projects\\\\htest\\\\dist\" (exit 1): failed\n</code></pre>\n\n<p>When I run this last command (<code>C:\\ACME\\projects\\htest\\.cabal-sandbox\\cabal-helper-0.5.3.0-553kah86RQN6BuDX6XLBiX\\cabal-helper-wrapper.exe \"C:\\\\ACME\\\\projects\\\\htest\" \"C:\\\\ACME\\\\projects\\\\htest\\\\dist\"</code>), it tries to install cabal 1.18:</p>\n\n<pre><code>cabal-helper-wrapper.exe: Installing Cabal version 1.18.1.3 failed.\n</code></pre>\n\n<p>I already have cabal, of version 1.22 (installed via Haskell Platform v7.10.2-a, released recently in August). </p>\n\n<p>Is there any way to work around this issue (i.e. still use <code>ghc-mod</code> / <code>ghc-modi</code>)?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "edited": false, "score": 0, "creation_date": 1441644379, "post_id": 32442639, "comment_id": 52749773, "body": "I answered your question, but I&#39;m not sure I got you last sentence. Do you mean we have the guarantee that the value in the <code>ExceptT B m (Either A ())</code> will never be <code>Right (Right ())</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441644629, "post_id": 32442639, "comment_id": 52749874, "body": "One option is to <code>catch</code> the inner exception and propagate it outward. It&#39;s a little unclear what your ultimate goal is. Dealing with multiple types of failure is generally awkward. I don&#39;t know, but there might be some prism tools in <code>lens</code> that could help."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441645074, "post_id": 32442639, "comment_id": 52750040, "body": "Yes there is guarantee that the rightmost option will never occur."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441645391, "post_id": 32442639, "comment_id": 52750171, "body": "So why do you need the <code>Either</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441645546, "post_id": 32442639, "comment_id": 52750230, "body": "<code>Either a ()</code> is essentially the same as <code>Maybe a</code>. If you can&#39;t get <code>Nothing</code>, just use <code>a</code> instead."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441645634, "post_id": 32442639, "comment_id": 52750264, "body": "I have some value that is of type <code>ExceptT B m ()</code>. That value may be either left or right. However, then I do <code>forever x</code> and then it becomes left at some point (<code>m</code> is <code>StateT</code>) or it never terminates. I cannot use <code>Maybe</code> because the exceptional value <code>Nothing</code> does not carry information, <code>Either a ()</code> has the opposite roles of individual type parameters."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441645030, "post_id": 32443064, "comment_id": 52750016, "body": "Exactly what I thought, I just did not know whether I wasn&#39;t missing some trick."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": false, "score": 1, "last_activity_date": 1441644277, "creation_date": 1441644277, "answer_id": 32443064, "question_id": 32442639, "link": "https://stackoverflow.com/questions/32442639/extract-left-values-of-nested-exceptt-monad-transfomers/32443064#32443064", "title": "Extract left values of nested ExceptT monad transfomers", "body": "<p>Short answer: that's not possible.</p>\n\n<p>Long answer: <code>ExceptT e m a</code> contains a <code>m (Either e a)</code>, so <code>ExceptT A (ExceptT B m) ()</code> contains a <code>ExceptT B m (Either A ())</code>, which in turn contain a <code>m (Either B (Either A ()))</code>. The question is: how can we get a <code>m (Either B A)</code>from there?</p>\n\n<p>Let's forget about the <code>m</code>, because it doesn't matter. We want a function with that does:</p>\n\n<pre><code>awesomeFunction :: Either B (Either A ()) -&gt; Either B A\n</code></pre>\n\n<p>A value of type <code>Either B (Either A ())</code> can be <code>Left b</code>, <code>Right (Left a)</code> or <code>Right (Right ())</code>, meaning you can have a <code>A</code>, a <code>B</code> or nothing.</p>\n\n<p>A value of type <code>Either B A</code> can be <code>Left b</code> or <code>Right a</code>. Let's try to implement <code>awesomeFunction</code>.</p>\n\n<pre><code>awesomeFunction (Left b) = Left b\nawesomeFunction (Right (Left a)) = Right a\nawesomeFunction (Right (Right ()) = ???\n</code></pre>\n\n<p>In the situation were we have nothing (a <code>Right (Right ()</code>), we can't create an <code>A</code> from thin air, so it's impossible to create this function.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1441651994, "last_edit_date": 1441651994, "creation_date": 1441647092, "answer_id": 32443611, "question_id": 32442639, "link": "https://stackoverflow.com/questions/32442639/extract-left-values-of-nested-exceptt-monad-transfomers/32443611#32443611", "title": "Extract left values of nested ExceptT monad transfomers", "body": "<p>The OP clarified in a comment:</p>\n\n<blockquote>\n  <p>I have some value [<code>x</code>] that is of type <code>ExceptT B m ()</code>. That value may be either left or right. However, then I do <code>forever x</code> and then it becomes left at some point (<code>m</code> is <code>StateT</code>) or it never terminates.</p>\n</blockquote>\n\n<p>The problem is that you prematurely fixed the type of the result to <code>()</code>. When you run an action <code>forever</code>, you get any result type you want. In particular, you can fix the left and right sides to the same type, and suddenly everything just works. That is, you can write something like</p>\n\n<pre><code>either return return =&lt;&lt; runExceptT (forever x)\n</code></pre>\n\n<p>and you'll end up with an action that returns the exception if one occurs.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 32443611, "answer_count": 2, "score": 2, "last_activity_date": 1441651994, "creation_date": 1441642331, "question_id": 32442639, "link": "https://stackoverflow.com/questions/32442639/extract-left-values-of-nested-exceptt-monad-transfomers", "title": "Extract left values of nested ExceptT monad transfomers", "body": "<p>Is it possible to create a function of the following signature?</p>\n\n<pre><code>ExceptT A (ExceptT B m) () -&gt; ExceptT B m A\n</code></pre>\n\n<p>My idea was something along these lines, for <code>x</code> being the parameter of the above mentioned function (and I suck with monads, so its most probably wrong).</p>\n\n<pre><code>runExceptT x :: ExceptT B m (Either A ())\n</code></pre>\n\n<p>But then I am stuck at getting anything like <code>Either A () -&gt; A</code> which would inherently have to account for <code>Right</code> and thus either fail or return some constant of <code>A</code> (which I dont have).</p>\n\n<p>However, I know that the original value of <code>x</code> is exactly one of the left values because otherwise the definition loops indefinitely.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 2, "creation_date": 1441645622, "post_id": 32442398, "comment_id": 52750254, "body": "By the way, why is this an anti-pattern?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 4, "creation_date": 1441646480, "post_id": 32442398, "comment_id": 52750582, "body": "@Yuuri, because it makes it look like you&#39;ll always get a result or <code>Nothing</code>, but you might get, say, a network timeout exception."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441677396, "post_id": 32442398, "comment_id": 52759434, "body": "I don&#39;t see why you think it looks like \u201calways a result of <code>Nothing</code>\u201d. Most Haskellers should be familiar enough with monad transformers to know how they work \u201cinside out\u201d."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441679647, "post_id": 32442398, "comment_id": 52759933, "body": "@leftaroundabout, I was certain I&#39;d read a diatribe against that style, but I can&#39;t seem to find it. I haven&#39;t really found my own favorite error handling approach yet--they all seem to suck differently (and the same is true across all languages)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1441641406, "creation_date": 1441641406, "answer_id": 32442398, "question_id": 32442173, "link": "https://stackoverflow.com/questions/32442173/chaining-functions-of-type-io-maybe-a/32442398#32442398", "title": "Chaining functions of type IO (Maybe a )", "body": "<p>Some consider this an anti-pattern, but you could use <code>MaybeT IO a</code> instead of <code>IO (Maybe a)</code>. The problem is that you only deal with one of the ways <code>getLocation</code> can fail&mdash;it could also throw an <code>IO</code> exception. From that perspective, you might as well drop the <code>Maybe</code> and just throw your own exception if decoding fails, catching it wherever you like.</p>\n"}, {"comments": [{"owner": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "edited": false, "score": 0, "creation_date": 1441671116, "post_id": 32442429, "comment_id": 52758124, "body": "Appreciate the response, however this results in a function with of type: runMyLocation:: IO (Maybe (IO (Maybe Weather))).  Any way to avoid the nesting of IO (Maybe (IO Maybe v)) ?"}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "edited": false, "score": 0, "creation_date": 1441713674, "post_id": 32442429, "comment_id": 52776499, "body": "Apologies, I misread the type of <code>getWeather</code> to be <code>IpResponse -&gt; Weather</code> rather than <code>IpResponse :: IO (Maybe Weather)</code>. I&#39;ll provide a clarifying edit."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 5, "last_activity_date": 1441714207, "last_edit_date": 1441714207, "creation_date": 1441641510, "answer_id": 32442429, "question_id": 32442173, "link": "https://stackoverflow.com/questions/32442173/chaining-functions-of-type-io-maybe-a/32442429#32442429", "title": "Chaining functions of type IO (Maybe a )", "body": "<p>You can happily nest <code>do</code> blocks that correspond to different monads, so it's just fine to have a block of type <code>Maybe Weather</code> in the middle of your <code>IO (Maybe Weather)</code> block.</p>\n\n<p>For example,</p>\n\n<pre><code>runMyLocation :: IO (Maybe Weather)\nrunMyLocation = do\n    r &lt;- getLocation\n    return $ do ip &lt;- r; return (getWeather ip)\n  where\n    getWeather = run . (uncurry constructQuery) . (city &amp;&amp;&amp; region)\n</code></pre>\n\n<p>This simple pattern <code>do a &lt;- r; return f a</code> indicates that you don't need the monad instance for <code>Maybe</code> at all though - a simple <code>fmap</code> is enough</p>\n\n<pre><code>runMyLocation :: IO (Maybe Weather)\nrunMyLocation = do\n    r &lt;- getLocation\n    return (fmap getWeather r)\n  where\n    getWeather = run . (uncurry constructQuery) . (city &amp;&amp;&amp; region)\n</code></pre>\n\n<p>and now you see that the same pattern appears again, so you can write</p>\n\n<pre><code>runMyLocation :: IO (Maybe Weather)\nrunMyLocation = fmap (fmap getWeather) getLocation\n  where\n    getWeather = run . (uncurry constructQuery) . (city &amp;&amp;&amp; region)\n</code></pre>\n\n<p>where the outer <code>fmap</code> is mapping over your <code>IO</code> action, and the inner <code>fmap</code> is mapping over your <code>Maybe</code> value.</p>\n\n<hr>\n\n<p>I misinterpreted the type of <code>getWeather</code> (see comment below) such that you will end up with <code>IO (Maybe (IO (Maybe Weather)))</code> rather than <code>IO (Maybe Weather)</code>.</p>\n\n<p>What you need is a \"join\" through a two layer monad stack. This is essentially what a monad transformer provides for you (see @dfeuer's answer) but it is possible to write this combinator manually in the case of <code>Maybe</code> -</p>\n\n<pre><code>import Data.Maybe (maybe)\n\nflatten :: (Monad m) =&gt; m (Maybe (m (Maybe a))) -&gt; m (Maybe a)\nflatten m = m &gt;&gt;= fromMaybe (return Nothing)\n</code></pre>\n\n<p>in which case you can write</p>\n\n<pre><code>runMyLocation :: IO (Maybe Weather)\nrunMyLocation = flatten $ fmap (fmap getWeather) getLocation\n  where\n    getWeather = run . (uncurry constructQuery) . (city &amp;&amp;&amp; region)\n</code></pre>\n\n<p>which should have the correct type. If you are going to chain multiple functions like this, you will need multiple calls to <code>flatten</code>, in which case it maybe be easier to build a monad transformer stack instead (with the caveat's in @dfeuer's answer).</p>\n\n<p>There is probably a canonical name for the function I've called \"flatten\" in the transformers or mtl libraries, but I can't find it at the moment.</p>\n\n<p>Note that the function <code>fromMaybe</code> from <code>Data.Maybe</code> essentially does the case analysis for you, but abstracts it into a function.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441756908, "post_id": 32462615, "comment_id": 52799780, "body": "I&#39;m not sure  what you&#39;re trying to say here, but whatever it is seems to be missing."}, {"owner": {"reputation": 1, "user_id": 5312551, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-34NhZQ470kw/AAAAAAAAAAI/AAAAAAAAAGk/q_F5H-AOogo/photo.jpg?sz=128", "display_name": "Massyl Nait", "link": "https://stackoverflow.com/users/5312551/massyl-nait"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441803743, "post_id": 32462615, "comment_id": 52821433, "body": "change getWeather to have Maybe IpResponse-&gt;IO.. and use &gt;&gt;= to implement it and then you can do getLocation &gt;&gt;= getWeather. The &gt;&gt;= in getWeather is the one from Maybe, that will deal with Just and Nothing and the other getLocation&gt;&gt;= getWeather the one from IO"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441806230, "post_id": 32462615, "comment_id": 52823295, "body": "You can edit your answer to include this suggestion. I don&#39;t personally like it, but it&#39;s legitimate. As it stands, your answer is not an answer."}, {"owner": {"reputation": 1, "user_id": 5312551, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-34NhZQ470kw/AAAAAAAAAAI/AAAAAAAAAGk/q_F5H-AOogo/photo.jpg?sz=128", "display_name": "Massyl Nait", "link": "https://stackoverflow.com/users/5312551/massyl-nait"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441807296, "post_id": 32462615, "comment_id": 52824070, "body": "I agree it&#39;s not elegant, but i don&#39;t like also your suggestion, to use transfomers just for this case. Anyway."}, {"owner": {"reputation": 1, "user_id": 5312551, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-34NhZQ470kw/AAAAAAAAAAI/AAAAAAAAAGk/q_F5H-AOogo/photo.jpg?sz=128", "display_name": "Massyl Nait", "link": "https://stackoverflow.com/users/5312551/massyl-nait"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441807386, "post_id": 32462615, "comment_id": 52824129, "body": "with my suggestion you can even abstract from Maybe. getWeather :: Monad m -&gt; m IpResponse -&gt; IO .. and will work"}], "tags": [], "owner": {"reputation": 1, "user_id": 5312551, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-34NhZQ470kw/AAAAAAAAAAI/AAAAAAAAAGk/q_F5H-AOogo/photo.jpg?sz=128", "display_name": "Massyl Nait", "link": "https://stackoverflow.com/users/5312551/massyl-nait"}, "is_accepted": false, "score": 0, "last_activity_date": 1441810890, "last_edit_date": 1441810890, "creation_date": 1441728901, "answer_id": 32462615, "question_id": 32442173, "link": "https://stackoverflow.com/questions/32442173/chaining-functions-of-type-io-maybe-a/32462615#32462615", "title": "Chaining functions of type IO (Maybe a )", "body": "<p>change getWeather to have <code>Maybe IpResponse-&gt;IO..</code> and use <code>&gt;&gt;=</code> to implement it and then you can do <code>getLocation &gt;&gt;= getWeather</code>. The <code>&gt;&gt;=</code> in getWeather is the one from Maybe, that will deal with Just and Nothing and the other <code>getLocation&gt;&gt;= getWeather</code> the one from IO.<br>\nyou can even abstract from Maybe and use any <code>Monad: getWeather :: Monad m -&gt; m IpResponse -&gt; IO ..</code> and will work.</p>\n"}], "owner": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1441810890, "creation_date": 1441640493, "last_edit_date": 1441670369, "question_id": 32442173, "link": "https://stackoverflow.com/questions/32442173/chaining-functions-of-type-io-maybe-a", "title": "Chaining functions of type IO (Maybe a )", "body": "<p>I am writing a small library for interacting with a few external APIs. One set of functions will construct a valid request to the yahoo api and parse the result to a data type. Another set of functions will look up the users current location based on IP and return a data type representing the current location. While the code works, it seems having to explicitly pattern match to sequence multiple functions of type IO (Maybe a). </p>\n\n<pre><code>-- Yahoo API\n\nconstructQuery :: T.Text -&gt; T.Text -&gt; T.Text\nconstructQuery city state = \"select astronomy,  item.condition from weather.forecast\" &lt;&gt;\n                            \" where woeid in (select woeid from geo.places(1)\" &lt;&gt;\n                            \" where text=\\\"\" &lt;&gt; city &lt;&gt; \",\" &lt;&gt; state &lt;&gt; \"\\\")\"\n\nbuildRequest :: T.Text -&gt; IO ByteString\nbuildRequest yql = do\n    let root = \"https://query.yahooapis.com/v1/public/yql\"\n        datatable = \"store://datatables.org/alltableswithkeys\"\n        opts = defaults &amp; param \"q\" .~ [yql]\n                          &amp; param \"env\" .~ [datatable]\n                          &amp; param \"format\" .~ [\"json\"]\n    r &lt;- getWith opts root\n    return $ r ^. responseBody\n\nrun :: T.Text -&gt; IO (Maybe Weather)\nrun yql = buildRequest yql &gt;&gt;= (\\r -&gt; return $ decode r :: IO (Maybe Weather))\n\n\n-- IP Lookup\ngetLocation:: IO (Maybe IpResponse)\ngetLocation = do\n    r &lt;- get \"http://ipinfo.io/json\"\n    let body = r ^. responseBody\n    return (decode body :: Maybe IpResponse)\n</code></pre>\n\n<p>-- Combinator </p>\n\n<pre><code>runMyLocation:: IO (Maybe Weather)\nrunMyLocation = do\n    r &lt;- getLocation\n    case r of\n        Just ip -&gt; getWeather ip\n        _ -&gt;  return Nothing\n    where getWeather = (run . (uncurry constructQuery) . (city &amp;&amp;&amp; region))\n</code></pre>\n\n<p>Is it possible to thread getLocation and run together without resorting to explicit pattern matching to \"get out\" of the Maybe Monad?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441639633, "post_id": 32441928, "comment_id": 52747709, "body": "You may use <code>quot</code> or <code>div</code> depending which way you want the rounding to go."}, {"owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441639789, "post_id": 32441928, "comment_id": 52747779, "body": "Problem is I need the answers to be fractional (they will all be between 0 and 1)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1441640102, "post_id": 32441928, "comment_id": 52747945, "body": "@Mossmyr Then you&#39;ll have to cast it from <code>Int</code> to <code>Float</code> or <code>Double</code>.  You can use the <code>fromIntegral</code> function for this."}, {"owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441640274, "post_id": 32441928, "comment_id": 52748006, "body": "@bheklilr I&#39;ve done this in 3 different variations with the same result, see the post."}], "answers": [{"comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441640428, "post_id": 32442035, "comment_id": 52748090, "body": "Your code seems to be working for me. Are you sure you are refreshing your scripts? If you are loading a script from the file into your ghci. You can use <code>:r</code> to reload the saved script."}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441640520, "post_id": 32442035, "comment_id": 52748143, "body": "In my ghci I posted the following.  let moseqs = [1,2,3]  let makeProfileMatrix a = [[(&#39;a&#39;,1)]]  profileMatrix = map (map (\\x -&gt; (fst x, (fromIntegral (snd x)) / (fromIntegral (length molseqs))))) (makeProfileMatrix molseqs)  and I got back [[(&#39;a&#39;, 0.33)]]"}, {"owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441640575, "post_id": 32442035, "comment_id": 52748173, "body": "Yes, I&#39;ve been saving the script between edits and reloading it with :r. Are you also using ghci?"}, {"owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441640748, "post_id": 32442035, "comment_id": 52748230, "body": "This is really strange. When I enter the code into GHCI directly, it doesn&#39;t give me any errors (in fact it gives me exactly what I want), but when I try to compile my script with the code in it, I get the errors."}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441640944, "post_id": 32442035, "comment_id": 52748316, "body": "It sounds like a simple error. Maybe you aren&#39;t saving your script like you think you are. Maybe you are compiling an older script. Try commenting out everything in the file and save and see if you get a different error."}], "tags": [], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "is_accepted": false, "score": 2, "last_activity_date": 1441639870, "creation_date": 1441639870, "answer_id": 32442035, "question_id": 32441928, "link": "https://stackoverflow.com/questions/32441928/no-instance-of-fractional-int-arising-from-use-of/32442035#32442035", "title": "No instance of (Fractional Int) arising from use of &#39;/&#39;", "body": "<p><strong>:t (/)</strong> Takes to fractionals</p>\n\n<p><strong>:t length</strong> Returns an integer</p>\n\n<p>You could use the <code>div</code> instruction instead. But I don't think you will get rounding.</p>\n\n<p>Or you could wrap the return result of length into fromIntegral function.</p>\n\n<p>Here's an example in my ghci. </p>\n\n<p>(3) / (fromIntegral $ length [1,2,3])</p>\n\n<p>I think fromIntegral will get you the rounding you want.</p>\n"}, {"comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1441641195, "post_id": 32442292, "comment_id": 52748425, "body": "Definitely more readable and by breaking up the code into different functions, easier to test."}, {"owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "edited": false, "score": 0, "creation_date": 1441641691, "post_id": 32442292, "comment_id": 52748625, "body": "Thank you so much, this solved it. I get the results I want now, though I still don&#39;t know what was wrong with my previous code."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": true, "score": 2, "last_activity_date": 1441641002, "creation_date": 1441641002, "answer_id": 32442292, "question_id": 32441928, "link": "https://stackoverflow.com/questions/32441928/no-instance-of-fractional-int-arising-from-use-of/32442292#32442292", "title": "No instance of (Fractional Int) arising from use of &#39;/&#39;", "body": "<p>I don't know what <code>makeProfileMatrix</code> does, or indeed what the type of <code>molseqs</code> is but here's something plausible that works -</p>\n\n<pre><code>&gt; import Data.List (group)\n&gt; let molseqs = [\"aaabb\", \"aabbcc\", \"aabccc\"]\n&gt; let rle = map (\\g -&gt; (head g, length g)) . group\n&gt; let makeProfileMatrix = map rle\n</code></pre>\n\n<p>There's a slightly nicer way to define your original function</p>\n\n<pre><code>&gt; let innerFunc xs = map $ \\(a,b) -&gt; (a, b / length xs)\n&gt; let pfm molseqs = map (innerFunc molseqs) (makeProfileMatrix molseqs)\n</code></pre>\n\n<p>which results in the error \"Could not deduce (Fractional Int) arising from...\" error that you noticed. One way is to use <code>fromIntegral</code> to cast everything to a double first</p>\n\n<pre><code>&gt; let innerFunc xs = map $ \\(a,b) -&gt; (a, fromIntegral b / fromIntegral (length xs))\n&gt; let pfm molseqs = map (innerFunc molseqs) (makeProfileMatrix molseqs)\n</code></pre>\n\n<p>and now you should hopefully see something that you expect -</p>\n\n<pre><code>&gt; makeProfileMatrix molseqs\n[[('a',3),('b',2)],[('a',2),('b',2),('c',2)],[('a',2),('b',1),('c',3)]]\n\n&gt; pfm molseqs\n[[('a',1.0),('b',0.6666666666666666)],[('a',0.6666666666666666),('b',0.6666666666666666),('c',0.6666666666666666)],[('a',0.6666666666666666),('b',0.3333333333333333),('c',1.0)]]\n</code></pre>\n"}], "owner": {"reputation": 756, "user_id": 4265645, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e5787fe72f50f68310d33d0a5bb53895?s=128&d=identicon&r=PG&f=1", "display_name": "Mossmyr", "link": "https://stackoverflow.com/users/4265645/mossmyr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2041, "favorite_count": 0, "accepted_answer_id": 32442292, "answer_count": 2, "score": 1, "last_activity_date": 1441641002, "creation_date": 1441639426, "question_id": 32441928, "link": "https://stackoverflow.com/questions/32441928/no-instance-of-fractional-int-arising-from-use-of", "title": "No instance of (Fractional Int) arising from use of &#39;/&#39;", "body": "<p>I've run up against a wall.</p>\n\n<p>This code</p>\n\n<pre><code>profileMatrix = map (map (\\x -&gt; (fst x, (snd x) / (length molseqs)))) (makeProfileMatrix molseqs)\n</code></pre>\n\n<p>gives me this error</p>\n\n<pre><code>No instance of (Fractional Int) arising from a use of '/'\nIn the expression: (snd x) / (length molseqs)\nIn the expression: (fst x, (snd x) / (length molseqs))\nIn the first arguemnt of 'map' namely\n  '(\\x -&gt; (fst x, (snd x) / (length molseqs)))'\n</code></pre>\n\n<p>Using fromIntegral also gives me an error:</p>\n\n<pre><code>profileMatrix = map (map (\\x -&gt; (fst x, (fromIntegral (snd x)) / (fromIntegral (length molseqs))))) (makeProfileMatrix molseqs)\n</code></pre>\n\n<p>Even different combinations of fromIntegral gives the error:</p>\n\n<pre><code>profileMatrix = map (map (\\x -&gt; (fst x, (snd x) / (fromIntegral (length molseqs))))) (makeProfileMatrix molseqs)\n\nprofileMatrix = map (map (\\x -&gt; (fst x, (fromIntegral (snd x)) / (length molseqs)))) (makeProfileMatrix molseqs)\n</code></pre>\n\n<p>Some clarifications:</p>\n\n<ul>\n<li><code>makeProfileMatrix molseqs</code> returns a <code>[[(Char, Int)]]</code> (a list of lists of touples, pairing Chars to Ints).</li>\n<li>This means that 'x' in the code will be a touple i.e <code>('A', 3)</code>, and this is confirmed to be working properly.</li>\n</ul>\n\n<p>How do I solve this? Any help is appreciated.</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1441635338, "last_edit_date": 1441635338, "creation_date": 1441633425, "answer_id": 32440193, "question_id": 32439935, "link": "https://stackoverflow.com/questions/32439935/num-and-integral-type-classes-haskell/32440193#32440193", "title": "Num and Integral type classes - Haskell", "body": "<p>In cases like this use ghci to check the types, for example it will tell you for your first input:</p>\n\n<pre><code>Prelude&gt; :t 4 + 3.2\n4 + 3.2 :: Fractional a =&gt; a\n</code></pre>\n\n<p>here the <code>fromInteger</code> is implicit (the <code>4</code>) used.</p>\n\n<p>In the second case you have the problem, that <code>length</code> is <code>:: [a] -&gt; Int</code> (a bit different in newer GHCs) and <code>3.2</code> is still <code>:: Fractional a =&gt; a</code> but <code>(+)</code> is <code>:: Num a =&gt; a -&gt; a -&gt; a</code> (it needs the same type of parameters <code>a</code>) - now <code>Int</code> is not an instance of <code>Fractional</code> and you get the error.</p>\n\n<hr>\n\n<h2>How to find the classes a type is instance of</h2>\n\n<p>PS (the original answer to that is gone) - the easiest way is using GHCi using <code>:i</code> itself:</p>\n\n<pre><code>Prelude&gt; :i Int\ndata Int = GHC.Types.I# GHC.Prim.Int#   -- Defined in \u2018GHC.Types\u2019\ninstance Bounded Int -- Defined in \u2018GHC.Enum\u2019\ninstance Enum Int -- Defined in \u2018GHC.Enum\u2019\ninstance Eq Int -- Defined in \u2018GHC.Classes\u2019\ninstance Integral Int -- Defined in \u2018GHC.Real\u2019\ninstance Num Int -- Defined in \u2018GHC.Num\u2019\ninstance Ord Int -- Defined in \u2018GHC.Classes\u2019\ninstance Read Int -- Defined in \u2018GHC.Read\u2019\ninstance Real Int -- Defined in \u2018GHC.Real\u2019\ninstance Show Int -- Defined in \u2018GHC.Show\u2019\n</code></pre>\n\n<p>but please remember that this will depend on the loaded modules - for example when you <code>import Test.QuickCheck</code> you will see that <code>Int</code> now instance of <code>Arbitrary</code> too:</p>\n\n<pre><code>Prelude Test.QuickCheck&gt; :i Int\ndata Int = GHC.Types.I# GHC.Prim.Int#   -- Defined in \u2018GHC.Types\u2019\ninstance Bounded Int -- Defined in \u2018GHC.Enum\u2019\ninstance Enum Int -- Defined in \u2018GHC.Enum\u2019\ninstance Eq Int -- Defined in \u2018GHC.Classes\u2019\ninstance Integral Int -- Defined in \u2018GHC.Real\u2019\ninstance Num Int -- Defined in \u2018GHC.Num\u2019\ninstance Ord Int -- Defined in \u2018GHC.Classes\u2019\ninstance Read Int -- Defined in \u2018GHC.Read\u2019\ninstance Real Int -- Defined in \u2018GHC.Real\u2019\ninstance Show Int -- Defined in \u2018GHC.Show\u2019\ninstance [overlap ok] [safe] CoArbitrary Int\n  -- Defined in \u2018Test.QuickCheck.Arbitrary\u2019\ninstance [overlap ok] [safe] Arbitrary Int\n  -- Defined in \u2018Test.QuickCheck.Arbitrary\u2019\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 0, "last_activity_date": 1441635378, "creation_date": 1441635378, "answer_id": 32440787, "question_id": 32439935, "link": "https://stackoverflow.com/questions/32439935/num-and-integral-type-classes-haskell/32440787#32440787", "title": "Num and Integral type classes - Haskell", "body": "<p><code>length</code> fixes its output type as <code>Int</code> (which is incompatible with <code>3.2</code>) rather than any <code>Num</code>. The function you are looking for is:</p>\n\n<pre><code>genericLength :: Num i =&gt; [b] -&gt; i\n</code></pre>\n"}], "owner": {"reputation": 697, "user_id": 3512580, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/61ed531a40f85c37801cdd6feffd9ab7?s=128&d=identicon&r=PG&f=1", "display_name": "Adi", "link": "https://stackoverflow.com/users/3512580/adi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 1, "accepted_answer_id": 32440193, "answer_count": 2, "score": 3, "last_activity_date": 1441635378, "creation_date": 1441632647, "question_id": 32439935, "link": "https://stackoverflow.com/questions/32439935/num-and-integral-type-classes-haskell", "title": "Num and Integral type classes - Haskell", "body": "<p>I am reading Type classes, <a href=\"http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101\" rel=\"nofollow\">Chapter 2 of Learn You Haskell For Great Good</a>. My question is why 4 + 3.2 works but not length [1, 2, 3, 4] + 3.2, why do we need to use <em>fromIntegral</em> function in second case. Is there no relation between <em>Num</em> and <em>Integral</em> type classes. How do I find what classes a type is instance of ?</p>\n"}, {"tags": ["haskell", "record", "typeclass", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "edited": false, "score": 0, "creation_date": 1441652698, "post_id": 32439953, "comment_id": 52752861, "body": "Too bad, I guess I have to stick to my workaround. Thank you for your quick answer."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1441632698, "creation_date": 1441632698, "answer_id": 32439953, "question_id": 32439605, "link": "https://stackoverflow.com/questions/32439605/using-record-update-syntax-with-constrained-gadt-records/32439953#32439953", "title": "Using record update syntax with constrained GADT records", "body": "<p>I'm afraid this is not yet possible; there's a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/2595\" rel=\"noreferrer\">seven year old outstanding feature request</a>.</p>\n"}], "owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "accepted_answer_id": 32439953, "answer_count": 1, "score": 7, "last_activity_date": 1441632698, "creation_date": 1441631507, "question_id": 32439605, "link": "https://stackoverflow.com/questions/32439605/using-record-update-syntax-with-constrained-gadt-records", "title": "Using record update syntax with constrained GADT records", "body": "<p>I stumbled upon the following small problem. I am using Haskell record syntax, together with GADTs:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Test a where \n  Test :: {someString :: String, someData :: a} -&gt; Test a\n</code></pre>\n\n<p>Now I want to create a new <code>Test</code> value with a different type for <code>someData</code>, but the same value for <code>someString</code> (to justify the usage of the record update syntax):</p>\n\n<pre><code>test :: Test a -&gt; Test Bool\ntest t = t {someData = True}\n</code></pre>\n\n<p>Suppose I add another field to the <code>Test</code> constructor:</p>\n\n<pre><code>data Test a where \n  Test :: {someString :: String, someData :: a, someMoreData :: a} -&gt; Test a\n</code></pre>\n\n<p>Then I have to change both fields to keep my code type-correct:</p>\n\n<pre><code>test :: Test a -&gt; Test Bool\ntest t = t {someData = True, someMoreData = False}\n</code></pre>\n\n<p>Until now, I didn't need the GADT, but now I want to add a type-class constraint to the data type, for example <code>Eq</code>:</p>\n\n<pre><code>data Test a where \n  Test :: Eq a =&gt; {someString :: String, someData :: a} -&gt; Test a\n</code></pre>\n\n<p>When trying to \"update\" the <code>someData</code> field, like in the first example, I suddenly get a compiler error:</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018Bool\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for test :: Test a -&gt; Test Bool at Test.hs:18:9\nExpected type: Test Bool\n  Actual type: Test a\nRelevant bindings include\n  t :: Test a (bound at Test.hs:19:6)\n  test :: Test a -&gt; Test Bool (bound at Test.hs:19:1)\nIn the expression: t\nIn the expression: t {someData = True}\n</code></pre>\n\n<p>I suspect this to be the same \"problem\" as in the case before with two fields of type <code>a</code>, but a little more implicit. I guess the dictionary for the <code>Eq</code> type class is treated like an argument of the constructor, just like if I had a field <code>{eqDict :: Eq a}</code>. If I am right, then I also had to \"update\" the \"dictionary field\" somehow, although I don't know how to do this. The question is, is there a way to use record update syntax when type classes are involved like this?</p>\n"}, {"tags": ["windows", "haskell", "cabal"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441627826, "post_id": 32437317, "comment_id": 52740959, "body": "this seems strange: <i>Skipping download: Local and remote files match.</i> - I doubt that even this step succeeds. It&#39;s probably your env.setting :("}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441628196, "post_id": 32437317, "comment_id": 52741217, "body": "btw: AFAIK cabal should use your system-settings (works on windows for me)"}], "answers": [{"tags": [], "owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "is_accepted": true, "score": 0, "last_activity_date": 1441630005, "creation_date": 1441630005, "answer_id": 32439134, "question_id": 32437317, "link": "https://stackoverflow.com/questions/32437317/cabal-proxy-downloading-packages-from-hackage/32439134#32439134", "title": "cabal + proxy: downloading packages from hackage", "body": "<p>I may have found the cause, when using <code>cabal -v update</code>, it displays path like </p>\n\n<p><code>\\\\ACME.NET\\UserData\\username\\RF\\AppData\\Roaming\\cabal\\packages\\hackage.haskell.org\\00-index.tar.gz</code></p>\n\n<p>while other uses of cabal use path like <code>C:\\Users\\username\\AppData\\..</code>, but <em>without</em> the <code>RF</code> folder in the displayed path. Must be my company network server config. Anyway, I updated paths like <code>remote-repo-cache</code> to use another folder in <code>cabal/config</code> and it works better now.</p>\n"}], "owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "accepted_answer_id": 32439134, "answer_count": 1, "score": 0, "last_activity_date": 1441630005, "creation_date": 1441624453, "question_id": 32437317, "link": "https://stackoverflow.com/questions/32437317/cabal-proxy-downloading-packages-from-hackage", "title": "cabal + proxy: downloading packages from hackage", "body": "<p>I'm using Haskell Platform 7.10.2-a (64-bit) on Windows:</p>\n\n<pre><code>&gt;cabal -V\ncabal-install version 1.22.6.0\nusing version 1.22.4.0 of the Cabal library\n</code></pre>\n\n<p>My proxy requires (basic HTTP) authentication:</p>\n\n<pre><code>&gt;set http_proxy=http://user:passwd@acme.com:port\n</code></pre>\n\n<p>It seems to work for <code>cabal update</code>:</p>\n\n<pre><code>&gt; cabal update\nDownloading the latest package list from hackage.haskell.org\nSkipping download: Local and remote files match.\n</code></pre>\n\n<p>However, when I try to install any package, it fails:</p>\n\n<pre><code>&gt; cabal get ghc-mod\nWarning: The package list for 'hackage.haskell.org' does not exist. Run 'cabal\nupdate' to download it.\ncabal: There is no package named 'ghc-mod'.\n\n&gt;cabal install shelltestrunner\nWarning: The package list for 'hackage.haskell.org' does not exist. Run 'cabal\nupdate' to download it.\ncabal: There is no package named 'shelltestrunner'.\nYou may need to run 'cabal update' to get the latest list of available\npackages.\n</code></pre>\n\n<p>How can I get <code>get</code> or <code>install</code> to actually use the proxy? Or is there some other problem preventing installation of packages from hackage?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "edited": false, "score": 0, "creation_date": 1441641641, "post_id": 32440990, "comment_id": 52748602, "body": "Thanks, good to know. So would this be the recommended solution for unoptimized builds?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "edited": false, "score": 0, "creation_date": 1441676158, "post_id": 32440990, "comment_id": 52759202, "body": "Yes, it&#39;s exactly what I do during development."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1441636008, "creation_date": 1441636008, "answer_id": 32440990, "question_id": 32434499, "link": "https://stackoverflow.com/questions/32434499/how-to-have-multiple-build-flavors-with-stack/32440990#32440990", "title": "How to have multiple build flavors with stack?", "body": "<p>Actually, <code>stack build --ghc-options=-O0</code> will apply -O0 to only the local packages, not to the snapshot packages. For more information, see:</p>\n\n<p><a href=\"https://github.com/commercialhaskell/stack/blob/master/GUIDE.md#ghc-options\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/blob/master/GUIDE.md#ghc-options</a></p>\n"}], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 32440990, "answer_count": 1, "score": 4, "last_activity_date": 1441636008, "creation_date": 1441615530, "question_id": 32434499, "link": "https://stackoverflow.com/questions/32434499/how-to-have-multiple-build-flavors-with-stack", "title": "How to have multiple build flavors with stack?", "body": "<p>When developing, I want to build everything with <code>-O0</code> to save time.</p>\n\n<p>But when building the same package on a CI system, I want to use <code>-O</code>.</p>\n\n<p>One option I see would be to have two different <code>stack.yaml</code> files differing in their <code>ghc-options</code>, but then I'd have to make all changes to <code>stack.yaml</code> in two places.</p>\n\n<p>Having an alias for <code>stack --ghc-options=-O0</code> doesn't work, because I want <code>-O0</code> to apply only to local packages, not the snapshot, and there's no way to specify that on the command line, from what I know.</p>\n\n<p>Are there any better options?</p>\n"}, {"tags": ["haskell", "types", "event-sourcing"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441616061, "post_id": 32434339, "comment_id": 52734041, "body": "so you are searching something like the Observable pattern for your events right? IMO you can implement it just like you would do in OO (using <code>IORef</code> or whatever if you want <code>Subscribe</code> like behavior - or giving the handlers at creation if you don&#39;t want to) - the question is: do you really need it or should your <i>commands/-handler</i> be responsible for this?"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1441619825, "post_id": 32434339, "comment_id": 52736237, "body": "@Carsten sort of, yes. For the actual plumbing I plan to use <code>TChan</code> which have the nice property of providing pub/sub capabilities, but that&#39;s not really my problem. I am more concerned about the overall design approach, this looks like I am trying to implement something like typed actors, or reinvent discrete-time FRP but I am confused."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1441765672, "post_id": 32434339, "comment_id": 52801792, "body": "What is the problem you are trying to solve? Your question is asking how to solve a problem a specific way, not how to solve the problem. It&#39;s quite possible the solution is something that already exists: oo style events, observables, FRP, or concurrent pipes."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1441784999, "post_id": 32434339, "comment_id": 52808600, "body": "You are right, my question is specifically on how to implement a specific solution to the general problem of designing &quot;complex&quot; applications in such a way as to reduce coupling and increase cohesion. I have already settled to use event sourcing as the core principle application is based on and my problem is now one of moving from a synchronous (e.g. function-call based) solution to an asynchronous (e.g. event queue, actors,...) based solution."}], "answers": [{"comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 1, "creation_date": 1441785249, "post_id": 32471919, "comment_id": 52808768, "body": "Thanks for the suggestion, this looks like what I am looking for except for one missing part: How to define  a <code>Handler m a</code> in such a way that it can be passed to a <code>Source m b</code> where <code>a :&lt; b</code> for some &quot;sub-typing&quot; relation. But writing that sentence it occurs to me I can simply define <code>class a :&lt; b</code> and provide correct instances..."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1441802025, "post_id": 32471919, "comment_id": 52820086, "body": "Actually what I am trying to do does not seem that simple because it would mean being able to coerce some <code>a</code> into a sum type <code>b</code>, then dispatch to relevant <code>Handler c</code> such that <code>a :&lt; c </code>. Does not seem to make much sense."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1441778369, "creation_date": 1441778369, "answer_id": 32471919, "question_id": 32434339, "link": "https://stackoverflow.com/questions/32434339/how-to-write-an-event-bus-in-haskell/32471919#32471919", "title": "How to write an event bus in Haskell?", "body": "<p>An source of events carrying <code>a</code>s that can be subscribed to has the following type</p>\n\n<pre><code>type Source m a = (a -&gt; m ()) -&gt; m (m ())\n                   |             |  ^--- how to unsubscribe             \n                   |             ^--- how to subscribe\n                   ^--- what to do when an `a` happens\n</code></pre>\n\n<p>A consumer or handler of events is naively something that accepts an event source and subscribes to it</p>\n\n<pre><code>type Handler m a = (Source m a             ) -&gt; m ()\n                 = ((a -&gt; m ()) -&gt; m (m ())) -&gt; m ()\n                                                ^-- set up the consumer.\n</code></pre>\n\n<p>This is a bit convoluted, we can invert things and get a nicer representation for an event handler:</p>\n\n<pre><code>type Handler m a = m () -&gt; m (a -&gt; m ())\n                   |       |  ^-- what to do when an `a` happens\n                   |       ^-- set up the consumer\n                   ^-- how to unsubscribe\n</code></pre>\n\n<p>The original event source was a bit tricky to use; a subscriber might want to unsubscribe in response to an event happening, in which case they'd need to recursively get the resulting unsubscribe action into what to do when an event happens. Starting with the nicer definition of a <code>Handler</code> we don't have this problem. An event source is now something that accepts an event handler and publishes to it.</p>\n\n<pre><code>type Source m a = (Handler m a          ) -&gt; m ()\n                = (m () -&gt; m (a -&gt; m ())) -&gt; m ()\n                                             ^-- how to subscribe\n</code></pre>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1058, "favorite_count": 5, "accepted_answer_id": 32471919, "answer_count": 1, "score": 10, "last_activity_date": 1442204109, "creation_date": 1441615002, "last_edit_date": 1442204109, "question_id": 32434339, "link": "https://stackoverflow.com/questions/32434339/how-to-write-an-event-bus-in-haskell", "title": "How to write an event bus in Haskell?", "body": "<p>I am struggling with a design problem in Haskell that I cannot seem to solve in an elegant and satisfying way. I have a system which at its core is based on the concept of <strong>event sourcing</strong>: the state of the system results from the application of a sequence of events to an initial state. There are different types of events, each type being related to a specific component of the system through a type family:</p>\n\n<pre><code>class Model a where\n   data Event a :: * \n   apply :: Event a -&gt; a -&gt; a\n\ninstance Model Foo where\n   data Event Foo = Foo Int\n   ...\n\ninstance Model Bar where\n   data Event Bar = Bar String\n   ...\n</code></pre>\n\n<p>Currently the system is 100% synchronous and coupled, each model having access to all other model's events and this is quickly becoming a mess, so I want to decouple things through the introduction of an <strong>event bus</strong> <code>Bus Events</code> in such a way I should be able to write something like \n<code>dispatch :: Bus Events -&gt; Consumer (Event Foo) -&gt; Bus Events</code> to attach some consumer of <code>Event Foo</code> to a <code>Bus Events</code> assuming there is some form of subtyping or subsumption between <code>Event Foo</code> and <code>Events</code>.\nThen I can add asynchronicity by ensure consumers each run in their own threads.</p>\n\n<p>From a system point of view, this would allow me to ensure each component is independently packagable, limiting dependencies to a subset of all events. <code>Events</code> type would be defined at the whole application level. \nThis problem looks deceptively similar to discrete-time FRP yet I cannot seem to be able to wrap my head around it...</p>\n\n<p>Has anyone already dealt with something similar and if yes, how?</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>I came up with the following code, which makes no use of <code>Source</code> but is greatly inspired by @Cirdec's proposal:</p>\n\n<pre><code>import           Control.Applicative\nimport           Control.Concurrent\nimport           Control.Concurrent.STM\nimport           Control.Monad.Reader\nimport qualified Data.Vector            as V\n\ntype Handlers e = V.Vector (Handler e)\n\ndata EventBus e = EventBus { handlers    :: Handlers e\n                           , eventQueue  :: TChan e\n                           , eventThread :: MVar ThreadId\n                           }\n\nnewBus :: IO (EventBus e)\nnewBus = do\n  chan &lt;- newTChanIO\n  var &lt;- newEmptyMVar\n  return $ EventBus V.empty chan var\n\naddHandler :: Handler e -&gt; EventBus e -&gt; EventBus e\naddHandler h b@EventBus{..} = b { handlers = V.snoc handlers h }\n\nremoveHandler :: Int -&gt; EventBus e -&gt; EventBus e\nremoveHandler idx b@EventBus{..} = b { handlers = let (h,t) = V.splitAt idx handlers\n                                                  in h V.++ V.tail t }\n\nstartBus :: EventBus e -&gt; IO (EventBus e)\nstartBus b@EventBus{..} = do\n  tid &lt;- forkIO (runBus b)\n  putMVar eventThread tid\n  return b\n\nrunBus :: EventBus e -&gt; IO ()\nrunBus b@EventBus{..} = do\n  _ &lt;- takeMVar eventThread\n  forever $ do\n    e &lt;- liftIO $ atomically $ readTChan eventQueue\n    v &lt;- newTVarIO b\n    runReaderT (runEvents $ publish e) v\n\n-- | A monad to handle pub/sub of events of type @e@\nnewtype Events e a = Events { runEvents :: ReaderT (TVar (EventBus e)) IO a }\n                   deriving (Applicative, Functor, Monad, MonadIO, MonadReader (TVar (EventBus e)))\n\nnewtype Handler e = Handler { handle :: Events e ()                 -- Unsubscription function\n                                     -&gt; Events e (e -&gt; Events e ())  -- what to do with events @e@\n                            }\n\n\n-- | Register a new @Handler e@ within given @Events e@ context\nsubscribe :: Handler e -&gt; Events e ()\nsubscribe h = do\n  bus &lt;- ask\n  liftIO $ atomically $ modifyTVar' bus (addHandler h)\n\nunsubscribe :: Int -&gt; Events e ()\nunsubscribe idx = do\n  bus &lt;- ask\n  liftIO $ atomically $ modifyTVar' bus (removeHandler idx)\n\npublishBus :: EventBus e -&gt; e -&gt; IO ()\npublishBus EventBus{..} = atomically . writeTChan eventQueue\n\npublish :: e -&gt; Events e ()\npublish event = do\n  EventBus{..} &lt;- ask &gt;&gt;= liftIO . atomically . readTVar\n  forM_ (zip (V.toList handlers) [0..]) (dispatch event)\n\ndispatch :: e -&gt; (Handler e, Int) -&gt; Events e ()\ndispatch event (Handler h, idx) = do\n  hdl &lt;- h (unsubscribe idx)\n  hdl event\n\nprinter :: (Show s) =&gt; String -&gt; Handler s\nprinter prefix = Handler ( \\ _ -&gt; return $ \\ e -&gt; liftIO (putStrLn $ prefix ++ show e))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1441612746, "post_id": 32431719, "comment_id": 52732225, "body": "btw in the appliced case you could also use <code>filter (\\x -&gt; elem x [1,2,3]) [5,3,2]</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441658905, "post_id": 32431719, "comment_id": 52755198, "body": "<code>ff p xs ys = foldr ((++).(`filter`ys).p) [] xs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441694110, "post_id": 32431764, "comment_id": 52764133, "body": "no, <code>intersectBy</code> keeps the elements from the first list, not the second."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441696234, "post_id": 32431764, "comment_id": 52765321, "body": "@WillNess Does that matter in <code>==</code> case ? I think I&#39;m misunderstanding something here. And if we really want to keep elements from the second list, we can just flip the parameter ?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441701373, "post_id": 32431764, "comment_id": 52768432, "body": "this should work with <code>(&lt;)</code> too (or <code>((==).(2*))</code>). simple flipping didn&#39;t work for me with both."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 11, "last_activity_date": 1441604411, "creation_date": 1441604411, "answer_id": 32431764, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter/32431764#32431764", "title": "Haskell multifilter", "body": "<p>You can use <code>intersectBy</code>:</p>\n\n<pre><code>\u03bb&gt; :t intersectBy\nintersectBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\n\u03bb&gt; intersectBy (==) [1,2,3] [5,3,2]\n[2,3]\n</code></pre>\n\n<p>You can use <a href=\"https://www.haskell.org/hoogle/?q=%28a%20-%3E%20a%20-%3E%20Bool%29%20-%3E%20[a]%20-%3E%20[a]%20-%3E%20[a]\">hoogle</a> to search functions using type signature and finding them.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441694418, "post_id": 32431776, "comment_id": 52764298, "body": "no, <code>intersectBy</code> keeps the elements from the first list, not the second."}], "tags": [], "owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "is_accepted": false, "score": 1, "last_activity_date": 1441604481, "creation_date": 1441604481, "answer_id": 32431776, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter/32431776#32431776", "title": "Haskell multifilter", "body": "<p>Simply use Hoogle to find it out via the signature <code>(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]</code></p>\n\n<p><a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+a+-%3E+Bool%29+-%3E+%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D\" rel=\"nofollow\">https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+a+-%3E+Bool%29+-%3E+%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D</a></p>\n\n<p>yields <code>intersectBy</code>:</p>\n\n<pre><code>intersectBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 125, "user_id": 3577498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NXy7r.jpg?s=128&g=1", "display_name": "dos", "link": "https://stackoverflow.com/users/3577498/dos"}, "edited": false, "score": 0, "creation_date": 1441608743, "post_id": 32432064, "comment_id": 52730038, "body": "@dos The ultimate choice is yours, of course, but I feel Sibi&#39;s answer is more worthy of the accept. An easily available function from the libraries that does exactly what you want is overall a better solution than a hand-rolled one (even if writing your own can be useful for learning). Besides that, <code>intersectBy</code> didn&#39;t cross my mind before seeing his answer."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441635800, "post_id": 32432064, "comment_id": 52745672, "body": "<code>multifilter f xs ys = filter (\\x -&gt; any (f x) ys) xs</code> retains values from <code>xs</code> when the original question retained values from <code>ys</code>. Solving the more general <code>multifilter :: (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; [b]</code> would help detect this mistake."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441651782, "post_id": 32432064, "comment_id": 52752543, "body": "@gallais I followed the words and example in the question rather than the implementation there. The inconsistency (that admittedly neither myself nor the other answerers using <code>intersectBy</code> had spotted) already lies in the question. That being so, I will not change this answer, but link to yours instead, as it makes a relevant point. See also my comments to your answer."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 125, "user_id": 3577498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NXy7r.jpg?s=128&g=1", "display_name": "dos", "link": "https://stackoverflow.com/users/3577498/dos"}, "edited": false, "score": 0, "creation_date": 1441652407, "post_id": 32432064, "comment_id": 52752751, "body": "@dos By the way, one simple test that illustrates the issue gallais and I are discussing is <code>multifilter ((==).(2*)) [2,3,12,1] [5,3,2,6]</code>. Between the four implementations in your question and our two answers there are three different results."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1441650915, "last_edit_date": 1495541680, "creation_date": 1441605924, "answer_id": 32432064, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter/32432064#32432064", "title": "Haskell multifilter", "body": "<p><em>Note: This answer implements the specification expressed by the words and example in the question, rather than the different one given by the implementation of <code>multifilter</code> there. For the latter possibility, see <a href=\"https://stackoverflow.com/a/32441089/2751851\">gallais' answer</a>.</em></p>\n\n<p><a href=\"https://stackoverflow.com/a/32431764/2751851\">Sibi's answer</a> shows how you should actually do it. In any case, it is instructive to consider how you might write your function using <code>filter</code>. To begin with, we can establish two facts about it:</p>\n\n<ul>\n<li><code>multifilter</code> can be expressed directly as <code>filter pred</code> for some appropriate choice of <code>pred</code>. Given a fixed \"predicate list\", whether an element of the list you are multifiltering will be in the result only depends on the value of that element.</li>\n<li>In <code>multifilter f xs ys</code>, the list you are filtering is <code>xs</code>, and the \"predicate list\" is <code>ys</code>. Were it not so, you would get <code>[3,2]</code> rather than <code>[2,3]</code> in your (quite well-chosen) example.</li>\n</ul>\n\n<p>So we have:</p>\n\n<pre><code>multifilter :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\nmultifilter f xs ys = filter pred xs\n    where\n    pred = undefined -- TODO\n</code></pre>\n\n<p>All we need to do is implementing <code>pred</code>. Given an element <code>x</code>, <code>pred</code> should produce <code>True</code> if, for some element <code>y</code> of <code>ys</code>, <code>f x y</code> is true. We can conveniently express that using <code>any</code>:</p>\n\n<pre><code>pred x = any (\\y -&gt; f x y) ys\n\n-- Or, with less line noise:\npred x = any (f x) ys\n</code></pre>\n\n<p>Therefore, <code>multifilter</code> becomes...</p>\n\n<pre><code>multifilter :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\nmultifilter f xs ys = filter pred xs\n    where\n    pred x = any (f x) ys\n\n-- Or, more compactly:\nmultifilter :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\nmultifilter f xs ys = filter (\\x -&gt; any (f x) ys) xs\n</code></pre>\n\n<p>... which is essentially equivalent to <code>intersectBy</code>, as you can see by looking at <code>intersectBy</code>'s implementation.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441660932, "post_id": 32432807, "comment_id": 52755831, "body": "nice catch about liftM2! so IOW, <code>relate p = (join .) . liftM2 (\\x y-&gt; [y|p x y])</code>. and shouldn&#39;t we be keeping <code>snd</code>, not <code>fst</code> (<code>y</code>s, not <code>x</code>s)?"}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 4, "last_activity_date": 1441624509, "last_edit_date": 1441624509, "creation_date": 1441609086, "answer_id": 32432807, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter/32432807#32432807", "title": "Haskell multifilter", "body": "<p>A third option is to use a list comprehension:</p>\n\n<pre><code>multifilter rel xs ys = [ x | x &lt;- xs, y &lt;- ys, x `rel` y ]\n</code></pre>\n\n<p>or, if you want partial application:</p>\n\n<pre><code>multifilter p xs ys = [ x | x &lt;- xs, let f = p x, y &lt;- ys, f y ]\n</code></pre>\n\n<p>If you want to use filter,</p>\n\n<pre><code>relate rel xs ys = filter (uncurry rel) $ liftM2 (,) xs ys\n</code></pre>\n\n<p>(and throw in <code>map fst</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441651775, "post_id": 32441089, "comment_id": 52752539, "body": "The root of the difference between our answers is that the question itself is inconsistent. Your first implementation doesn&#39;t preserve the order of the list being filtered, <code>ys</code>, which would be very surprising behaviour for a filtering function (that is a relevant issue, as the OP says &quot;I want to filter a list&quot;). As for your second implementation, it doesn&#39;t match the usage example in the question, as you have pointed out. P.S.: I suggest mentioning that the <code>(x,)</code> syntax in the first implementation requires the TupleSections extension."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441693248, "post_id": 32441089, "comment_id": 52763719, "body": "@duplode I think the order <i>is</i> preserved by the 1st impl-n; 2nd does something completely different, it includes each <code>y</code> of <code>ys</code> <i>at most once</i> in the result (the wording of the question indeed may be interpreted that way)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1441693294, "post_id": 32441089, "comment_id": 52763743, "body": "@WillNess With the first implementation, <code>multifilter ((==).(2*)) [9,3,14,1] [5,3,2,6]</code> results in <code>[6,2]</code> -- the elements come from <code>ys</code> but are in the order of the matches in <code>xs</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441693403, "post_id": 32441089, "comment_id": 52763796, "body": "@duplode that <i>is</i> what the OP code does too. if we go with the <i>wording</i>, then it implies an additional <code>or</code>, which the 2nd impl-n captures."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1441693860, "post_id": 32441089, "comment_id": 52764024, "body": "@WillNess Exactly. That explains how I got from the wording of the question to an implementation equivalent to <code>intersectBy</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441694449, "post_id": 32441089, "comment_id": 52764321, "body": "@duplode but <code>intersectBy</code> keeps the elements of the first list, not the second, and the OP wants to filter the <i>second</i> list, i.e. to keep (or not) <i>its</i> elements."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1441695088, "post_id": 32441089, "comment_id": 52764646, "body": "@WillNess But <code>intersectBy (==) [1,2,3] [5,3,2]</code> is <code>[2,3]</code>, matching the usage example given by the OP. The ambiguity lies in the question itself."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441695151, "post_id": 32441089, "comment_id": 52764690, "body": "@duplode  try (&lt;) to see the difference. so the OP chose (==) not wisely. it happens. :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1441695373, "post_id": 32441089, "comment_id": 52764810, "body": "@WillNess Yup, the choice of operator is also part of the problem."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441695577, "post_id": 32441089, "comment_id": 52764930, "body": "@duplode I have to disagree, it being a parameter to a function, the solution must accomodate <i>any</i> operator."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1441695653, "post_id": 32441089, "comment_id": 52764982, "body": "@WillNess Certainly; I meant part of the problem of how the question is formulated."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 2, "last_activity_date": 1441636379, "creation_date": 1441636379, "answer_id": 32441089, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter/32441089#32441089", "title": "Haskell multifilter", "body": "<p>The answer you have accepted provides a function distinct from the one defined in your post: it retains elements from <code>xs</code> when yours retains elements from <code>ys</code>. You can spot this mistake by using a more general type for <code>multifilter</code>:</p>\n\n<pre><code>multifilter :: (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; [b]\n</code></pre>\n\n<p>Now, this can be implemented following the specification described in your post like so:</p>\n\n<pre><code>multifilter p xs ys = fmap snd\n                    $ filter (uncurry p)\n                    $ concatMap (\\ x -&gt; fmap (x,) ys) xs\n</code></pre>\n\n<p>If you don't mind retaining the values in the order they are in in <code>ys</code> then you can have an even simpler definition:</p>\n\n<pre><code>multifilter' :: (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; [b]\nmultifilter' p xs = filter (flip any xs . flip p)\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 3577498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NXy7r.jpg?s=128&g=1", "display_name": "dos", "link": "https://stackoverflow.com/users/3577498/dos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 32432064, "answer_count": 5, "score": 4, "last_activity_date": 1441650915, "creation_date": 1441604145, "question_id": 32431719, "link": "https://stackoverflow.com/questions/32431719/haskell-multifilter", "title": "Haskell multifilter", "body": "<p>I want to filter a list by predicates curried from another list.\nFor instance:</p>\n\n<pre><code>multifilter :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]\nmultifilter _ _ [] = []\nmultifilter _ [] _ = []\nmultifilter f (x:xs) ys = (filter (f x) ys) ++ (multifilter f xs ys)\n</code></pre>\n\n<p>With usage such as:</p>\n\n<pre><code>prelude&gt; multifilter (==) [1,2,3] [5,3,2]\n[2,3]\n</code></pre>\n\n<p>Is there a standard way to do this?</p>\n"}, {"tags": ["parsing", "haskell", "aeson"], "comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 2, "creation_date": 1441624266, "post_id": 32431606, "comment_id": 52738742, "body": "Have you tried stream-based parsers, like <a href=\"https://hackage.haskell.org/package/json-stream\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/json-stream</a> ?"}, {"owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "edited": false, "score": 2, "creation_date": 1441651341, "post_id": 32431606, "comment_id": 52752365, "body": "You can parse to something more &quot;freeform&quot; and then access random properties using <a href=\"https://hackage.haskell.org/package/aeson-lens\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-lens</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1441758255, "post_id": 32431606, "comment_id": 52800081, "body": "@Yuuri, could you make that an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 1, "last_activity_date": 1574182563, "creation_date": 1574182563, "answer_id": 58939213, "question_id": 32431606, "link": "https://stackoverflow.com/questions/32431606/how-else-but-aeson/58939213#58939213", "title": "How else but aeson?", "body": "<p><a href=\"https://hackage.haskell.org/package/json-stream\" rel=\"nofollow noreferrer\">json-stream</a> is a stream based parser. This is a bit out of date (2015), but they took the benchmarks from <code>aeson</code> and compared the two libraries: <a href=\"https://www.reddit.com/r/haskell/comments/3j25zp/jsonstream_incremental_json_streaming_parser_any/\" rel=\"nofollow noreferrer\">aeson and json-stream performance comparison</a>. There is one case where <code>json-stream</code> is significantly worse than <code>aeson</code>.</p>\n\n<p>If you just want a faster <code>aeson</code> (not streaming), <a href=\"https://github.com/kccqzy/haskell-sajson\" rel=\"nofollow noreferrer\">haskell-sajson</a> looks interesting. It wraps a performant C++ library in Haskell and returns <code>Value</code> from <code>aeson</code>.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 2, "accepted_answer_id": 58939213, "answer_count": 1, "score": 7, "last_activity_date": 1574182563, "creation_date": 1441603439, "question_id": 32431606, "link": "https://stackoverflow.com/questions/32431606/how-else-but-aeson", "title": "How else but aeson?", "body": "<p><code>aeson</code> seems to take a somewhat simple-minded approach to parsing JSON: it parses a top-level JSON value (an object or array) to its own fixed representation and then offers facilities to help users convert that representation to their own. This approach works pretty well when JSON objects and arrays are small. When they're very large, things start to fall apart, because user code can't do anything until JSON values are completely read and parsed. This seems particularly unfortunate since JSON seems to be designed for recursive descent parsers&mdash; it seems like it should be fairly simple to allow user code to step in and say how each piece should be parsed. Is there a deep reason <code>aeson</code> and the earlier <code>json</code> work this way, or should I try to make a new library for more flexible JSON parsing?</p>\n"}, {"tags": ["string", "list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1441604306, "post_id": 32431540, "comment_id": 52728320, "body": "<code>rep = concat . zipWith replicate [1..]</code> is a bit shorter."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1441604613, "post_id": 32431540, "comment_id": 52728437, "body": "@user3237465 You&#39;re right. No idea why it didn&#39;t come to my mind that I should have used it."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 5, "last_activity_date": 1441610012, "last_edit_date": 1441610012, "creation_date": 1441603032, "answer_id": 32431540, "question_id": 32431400, "link": "https://stackoverflow.com/questions/32431400/repeating-each-successive-element-in-the-input-list-one-more-than-the-previous-e/32431540#32431540", "title": "Repeating each successive element in the input list one more than the previous element", "body": "<p>You could first <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:zip\" rel=\"nofollow\"><code>zip</code></a> the list <code>[1..]</code> with your list, then apply <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:replicate\" rel=\"nofollow\"><code>replicate</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:concat\" rel=\"nofollow\"><code>concat</code></a> the results:</p>\n\n<pre><code>rep xs = concatMap (uncurry replicate) $ zip [1..] xs\n</code></pre>\n\n<p>Example run:</p>\n\n<pre><code>Prelude&gt; let rep xs = concatMap (uncurry replicate) $ zip [1..] xs\nPrelude&gt; rep \"abcd\"\n\"abbcccdddd\"\n</code></pre>\n\n<p>The idea is simple, we associate to every element the number of times it should be repeated.</p>\n\n<p>The <code>zip</code> function has type <code>[a] -&gt; [b] -&gt; [(a, b)]</code>, so it takes two lists and returns one list of pairs where the first element is from the first list and the second element is from the second list. In our case we have that the result has type <code>[(Int, a)]</code> with <code>a</code> depending on the argument.</p>\n\n<p>The <code>replicate :: Int -&gt; a -&gt; [a]</code> function takes an integer that represents a length and an element <code>x</code> and produces a list <code>[x, x, x, ..., x]</code> of the given length.</p>\n\n<p>The <code>uncurry</code> function takes a function with type <code>a -&gt; b -&gt; c</code>, i.e. with two arguments, and transforms it into a function with type <code>(a, b) -&gt; c</code>, i.e. with one argument that is a tuple. So <code>uncurry replicate</code> has type <code>(Int, a) -&gt; [a]</code>.</p>\n\n<p>Now the types match and you could <code>map</code> the function over the <code>zip</code>ed lists obtaining a <code>[[a]]</code> and then using <code>concat</code> to concatenate the results. <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow\"><code>concatMap</code></a> is simply a shorthand for <code>concat . map</code>.</p>\n\n<p>Alternatively instead of using <code>zip</code> and then <code>map</code>ing you can use the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow\"><code>zipWith</code></a> function:</p>\n\n<pre><code>rep xs = concat $ zipWith replicate [1..] xs\n</code></pre>\n\n<hr>\n\n<p>Note that your solution seems to work correctly:</p>\n\n<pre><code>Prelude&gt; let rep [] = []; rep (x:xs) = [ (x:xs)!! y | y &lt;- [0..length xs], _&lt;-[1..y+1]]\nPrelude&gt; rep [1,2,3]\n[1,2,2,3,3,3]\nPrelude&gt; rep \"abcd\"\n\"abbcccdddd\"\n</code></pre>\n\n<p>If you have an example where it doesn't produce the correct result please <em>post it in your question</em>.</p>\n\n<p>However it is inefficient. You should avoid using <code>!!</code> and <code>length</code> when working with lists and prefer things like <code>map</code> and <code>fold</code>s.</p>\n\n<p>Moreover I don't believe that the above function can produce the correct result for <code>[Int]</code> but not for <code>String</code> for one simple reason: the function is polymorphic and thus by parametricity it doesn't matter the type of elements that the list contains, it only matter its length, the result will always have the same shape (if you see the function is never \"looking at\"/\"operating on\" the elements, it simply moves them; it does exactly the same thing independently of their specific type.)</p>\n"}], "owner": {"reputation": 117, "user_id": 4941189, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-SGY_jQ94r9U/AAAAAAAAAAI/AAAAAAAABTQ/aHie06qBLeM/photo.jpg?sz=128", "display_name": "yeshika Senadeera", "link": "https://stackoverflow.com/users/4941189/yeshika-senadeera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 32431540, "answer_count": 1, "score": 2, "last_activity_date": 1441610012, "creation_date": 1441602252, "last_edit_date": 1441603877, "question_id": 32431400, "link": "https://stackoverflow.com/questions/32431400/repeating-each-successive-element-in-the-input-list-one-more-than-the-previous-e", "title": "Repeating each successive element in the input list one more than the previous element", "body": "<p>I want to repeat each successive character in the input string one more than the previous character ,starting with a single occurrence of the first character:</p>\n\n<p>for example</p>\n\n<pre><code>rep \"abcd\" == \"abbcccdddd\"\n</code></pre>\n\n<p>I did this code for ,but this don't work for <code>String</code> but produces the correct result for <code>Int</code> and <code>Char</code>.</p>\n\n<pre><code>rep [] =[]\nrep (x:xs) =[ (x:xs)!!y| y&lt;-[0..(length xs)]  , _&lt;- [1..y+1]]\n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["json", "haskell", "code-duplication", "typing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441603634, "post_id": 32431296, "comment_id": 52728097, "body": "Can you explain what duplication in particular you wish to remove?"}, {"owner": {"reputation": 6944, "user_id": 71858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2689ef6ed6006970c3d153075df3df18?s=128&d=identicon&r=PG", "display_name": "Jigar", "link": "https://stackoverflow.com/users/71858/jigar"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441604311, "post_id": 32431296, "comment_id": 52728325, "body": "@dfeuer clarified the question in the post itself. thanks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441604653, "post_id": 32431296, "comment_id": 52728451, "body": "Why not just use <code>parse</code> directly?  For the input language, I don&#39;t know of a better way. You have to know what your commands are."}, {"owner": {"reputation": 6944, "user_id": 71858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2689ef6ed6006970c3d153075df3df18?s=128&d=identicon&r=PG", "display_name": "Jigar", "link": "https://stackoverflow.com/users/71858/jigar"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441605056, "post_id": 32431296, "comment_id": 52728586, "body": "@dfeuer yes I can inline parse method in exeTuple. But I will have to keep modifying the exeTuple method. Is there an alternative to not modifying exeTuple every time a new (Request p) is added?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441606687, "post_id": 32431296, "comment_id": 52729166, "body": "If you need to add more requests in another module, say, then that module can define its own <code>exeTuple2</code> that calls yours as a fall-back. But in any case, you need some way to dispatch based on those strings; I think your current approach is likely as good as any."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441637505, "post_id": 32431296, "comment_id": 52746579, "body": "You might consider combining <code>exe</code> and the <code>parse...</code> functions because then the compositions will all have the same type: <code>ByteString -&gt; String</code> and that will allow you to write <code>exeTuple</code> as a lookup into a Map."}], "owner": {"reputation": 6944, "user_id": 71858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2689ef6ed6006970c3d153075df3df18?s=128&d=identicon&r=PG", "display_name": "Jigar", "link": "https://stackoverflow.com/users/71858/jigar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1441604233, "creation_date": 1441601514, "last_edit_date": 1441604233, "question_id": 32431296, "link": "https://stackoverflow.com/questions/32431296/haskell-parsing-and-processing-stream-of-json-requests", "title": "Haskell: Parsing and processing stream of json requests", "body": "<p>Following code tries to execute a stream of Request objects.</p>\n\n<pre><code>{-# LANGUAGE  DeriveGeneric, DeriveDataTypeable #-}\n--OverloadedStrings,\n\nimport Data.Aeson\nimport Data.Data\nimport Data.ByteString.Lazy.Internal\nimport GHC.Generics\nimport qualified Data.Map as Map\n\ndata Request a = Request {\n  name         :: String,\n  payload      :: a\n} deriving (Show, Generic)\ninstance FromJSON a =&gt; FromJSON (Request a)\ninstance ToJSON a =&gt; ToJSON (Request a)\n\nclass Exe a where\n  exe :: (Request a) -&gt; String\n\ndata Createuser = Createuser {\n  userName       :: String\n} deriving (Show, Generic)\ninstance FromJSON Createuser\ninstance ToJSON Createuser\ninstance Exe Createuser where\n  exe r = \"creating user\"\n\nparseCreateUser json = parse json :: Request Createuser\n\ndata Deleteuser = Deleteuser {\n  userName2       :: String\n} deriving (Show, Generic)\ninstance FromJSON Deleteuser\ninstance ToJSON Deleteuser\ninstance Exe Deleteuser where\n  exe r = \"deleting user\"\n\nparseDeleteUser json = parse json :: Request Deleteuser\n\ntojson name payload = encode (Request name payload)\nparse bs = let Just p = decode bs in p\n\n\nsampleDeleteUser = tojson \"deleteUser\" (Deleteuser \"Jigar Gosar\")\nsampleCreateUser = tojson \"createUser\" (Createuser \"Jigar Gosar\")\n\nexeTuple tuple = case tuple of\n              (\"createUser\", a) -&gt; exe $ parseCreateUser $ a\n              (\"deleteUser\", a) -&gt; exe $ parseDeleteUser $ a\n\nmain = do\n-- This list would be read from socket.\n  let tuples = [(\"createUser\", sampleCreateUser), (\"deleteUser\", sampleDeleteUser)]\n\n  putStr $ unlines [exeTuple tup | tup &lt;- tuples]\n\n  print \"end\"\n</code></pre>\n\n<p>Is there any way to remove the following duplication? </p>\n\n<pre><code>parseCreateUser json = parse json :: Request Createuser\nparseDeleteUser json = parse json :: Request Deleteuser\n</code></pre>\n\n<p>I will have to write this for every (Request p) I create.</p>\n\n<p>Also I will have to keep modifying following function every time I create new (Request p)</p>\n\n<pre><code>exeTuple tuple = case tuple of\n              (\"createUser\", a) -&gt; exe $ parseCreateUser $ a\n              (\"deleteUser\", a) -&gt; exe $ parseDeleteUser $ a\n</code></pre>\n\n<p>Is this idiomatic haskell code? </p>\n"}, {"tags": ["debugging", "haskell", "lambda"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1441594107, "post_id": 32430304, "comment_id": 52725916, "body": "Not really in Haskell, this sort of information gets erased at compile time.  You could use template haskell to implement it, probably, but that&#39;s not simple."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441596787, "post_id": 32430304, "comment_id": 52726410, "body": "There are plenty of resources on implementing the lambda calculus out there. <a href=\"http://www.cis.upenn.edu/~bcpierce/tapl/\" rel=\"nofollow noreferrer\">TaPL</a> is a particularly good one, and includes implementations of calculi of varying levels of sophistication. There also seem to be some smallish implementations on Hackage which you could play with."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441621941, "post_id": 32430304, "comment_id": 52737456, "body": "Haskell is a statically typed language. It&#39;s actually not that deeply involved lambda calculus, except insofar as lambdas happen to be a useful way to write the expressions of a cartesian closed category. But it&#39;s far more productive to directly use types to get an idea of what a function does, rather than looking at some equivalent lambda expression. For what you&#39;re trying to achieve, a language like Scheme would be more suitable."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1441814818, "post_id": 32430304, "comment_id": 52829741, "body": "Does <a href=\"http://okmij.org/ftp/tagless-final/course/TDPE.hs\" rel=\"nofollow noreferrer\">this</a> help?"}], "answers": [{"tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": false, "score": 2, "last_activity_date": 1441617838, "last_edit_date": 1441617838, "creation_date": 1441616447, "answer_id": 32434787, "question_id": 32430304, "link": "https://stackoverflow.com/questions/32430304/haskell-debugging-an-arbitrary-lambda-expression/32434787#32434787", "title": "Haskell debugging an arbitrary lambda expression", "body": "<p>I think the way to do this would be to define a small lambda calculus DSL in Haskell (or use an existing implementation). This way, instead of using the native Haskell formulation, you would write something like</p>\n\n<pre><code>k = Lam \"x\" (Lam \"y\" (App (Var \"x\") (Var \"y\")))\ns = Lam \"x\" (Lam \"y\" (Lam \"z\" (App (App (Var \"x\") (Var \"z\")\n                                   (App (Var \"y\") (Var \"z\"))))\n</code></pre>\n\n<p>and similarly for <code>s</code> and <code>i</code>. You would then write/use an evaluation function so that you could write</p>\n\n<pre><code>debug e = eval e\ndebug (App s k)\n</code></pre>\n\n<p>which would give you the final form in your own syntax. Additionally you would need a sort of interpreter to convert your DSL syntax to Haskell, so that you can actually use the functions in your code.</p>\n\n<p>Implementing this does seem like quite a lot of (tricky) work, and it's probably not exactly what you had in mind (especially if you need the evaluation for typed syntax), but I'm sure it would be a great learning experience. A good reference would be <a href=\"http://dev.stephendiehl.com/fun/005_evaluation.html\" rel=\"nofollow\">chapter 6 of \"Write you a Haskell\"</a>. Using an existing implementation would be a lot easier (but less fun :)).</p>\n\n<p>If this is merely for debugging purposes you might benefit from looking at the core syntax ghc compiles to. See <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow\">chapter 25 of Real world Haskell</a>, the ghc flag to use is -ddump-simpl. But this would mean looking at generated code rather than generating a representation inside your program. I'm also not sure to what extent you would be able to identify specific functions in the Core code easily (I have no experience with this so YMMV).</p>\n\n<p>It would of course be pretty cool if using show on functions would give the kind of output you describe but there are probably very good reasons functions are not an instance of Show (I wouldn't be able to tell you).</p>\n"}, {"comments": [{"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1441643977, "post_id": 32438917, "comment_id": 52749617, "body": "I&#39;m sorry, but my solution seems to be wrong. <code>reify</code>ing the variable declaration doesn&#39;t actually contain its definition, so <code>showDef</code> shows only the type. That&#39;s what documentation says about the body: &quot;At present, this value is <i>always</i> Nothing: returning the RHS has not yet been implemented because of lack of interest.&quot;"}], "tags": [], "owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "is_accepted": false, "score": 1, "last_activity_date": 1441629875, "last_edit_date": 1441629875, "creation_date": 1441629300, "answer_id": 32438917, "question_id": 32430304, "link": "https://stackoverflow.com/questions/32430304/haskell-debugging-an-arbitrary-lambda-expression/32438917#32438917", "title": "Haskell debugging an arbitrary lambda expression", "body": "<p>You can actually achieve that by utilising pretty-printing from Template Haskell, which comes with GHC out of the box.</p>\n\n<p>First, the formatting function should be defined in separate module (that's a TH restriction):</p>\n\n<pre><code>module LambdaPrint where\n\nimport Control.Monad\nimport Language.Haskell.TH.Ppr\nimport Language.Haskell.TH.Syntax\n\nshowDef :: Name -&gt; Q Exp\nshowDef = liftM (LitE . StringL . pprint) . reify\n</code></pre>\n\n<p>Then use it:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport LambdaPrint\n\ny :: a -&gt; a\ny = \\a -&gt; a\n$(return []) --workaround for GHC 7.8+\n\ntest = $(showDef 'y)\n</code></pre>\n\n<p>The result is more or less readable, not counting fully qualified names:</p>\n\n<pre><code>*Main&gt; test\n\"Main.y :: forall a_0 . a_0 -&gt; a_0\"\n</code></pre>\n\n<p>Few words about what's going on. <code>showDef</code> is a macro function which reifies the definition of some name from the environment and pretty-prints it in a string literal expression. To use it, you need to quote the name of the lambda (using <code>'</code>) and splice the result (which is a quoted string expression) into some expression (using <code>$(...)</code>).</p>\n"}], "owner": {"reputation": 212, "user_id": 5256155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/256361f7b47667f6da3621049300dff9?s=128&d=identicon&r=PG&f=1", "display_name": "crb233", "link": "https://stackoverflow.com/users/5256155/crb233"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1441629875, "creation_date": 1441592569, "question_id": 32430304, "link": "https://stackoverflow.com/questions/32430304/haskell-debugging-an-arbitrary-lambda-expression", "title": "Haskell debugging an arbitrary lambda expression", "body": "<p>I have a set of lambda expressions which I'm passing to other lambdas. All lambdas rely only on their arguments, they don't call any outside functions. Of course, sometimes it gets quite confusing and I'll pass an function with the incorrect number of arguments to another, creating a GHCi exception.</p>\n\n<p>I want to make a debug function which will take an arbitrary lambda expression (with an unknown number of arguments) and return a string based on the structure and function of the lambda.</p>\n\n<p>For example, say I have the following lambda expressions:</p>\n\n<pre><code>i = \\x -&gt; x\nk = \\x y -&gt; x\ns = \\x y z -&gt; x z (y z)\n</code></pre>\n\n<p><code>debug (s k)</code> should return <code>\"\\a b -&gt; b\"</code></p>\n\n<p><code>debug (s s k)</code> should return <code>\"\\a b -&gt; a b a\"</code> (if I simplified that correctly)</p>\n\n<p><code>debug s</code> should return <code>\"\\a b c -&gt; a c (b c)\"</code></p>\n\n<p>What would be a good way of doing this?</p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441602514, "post_id": 32429766, "comment_id": 52727742, "body": "That behaviour sounds quite surprising. In principle, you shouldn&#39;t be able to <code>stack build</code> without <i>process</i> in the <code>build-depends</code> of the .cabal file. My guess would be that the real issue here is that the file you created in <code>&#47;src</code> was not added to the relevant sections of the .cabal-file (i.e. either <code>exposed-modules</code> or <code>other-modules</code>). If that is the case, your file is being ignored by <code>stack build</code> and the other commands."}, {"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441613761, "post_id": 32429766, "comment_id": 52732744, "body": "I think you&#39;ve pinpointed the problem. I&#39;ll update the answer I gave accordingly, but not immediately; feel free to edit it or post your own."}], "answers": [{"tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 1, "last_activity_date": 1441587304, "last_edit_date": 1441587304, "creation_date": 1441586936, "answer_id": 32429767, "question_id": 32429766, "link": "https://stackoverflow.com/questions/32429766/stack-ghci-doesnt-have-modules-imported-through-stack/32429767#32429767", "title": "Stack GHCI doesn&#39;t have modules imported through Stack", "body": "<p>When you run <code>stack new ...</code>, even with the <code>simple</code> template, you'll notice that several files are created which allow for stack to work. One of these is a <code>Proj_Name.cabal</code> file, and if you open it, you'll notice that under the <code>executable Proj_Name</code> section of the file there's a <code>main-is:       Main.hs</code> line. </p>\n\n<p>The default <code>main-is</code> file will be <code>Main.hs</code>, but it may be anything. Your imports should go within whatever file you want to act as your main file. So in this case, you can simply put whatever the name of that file you created (which has the <code>System.Process</code> import) in place of <code>Main.hs</code> in that line.</p>\n\n<p>Following this, run <code>stack build</code>, add whatever dependencies it tells you to under the <code>build-depends:   base &gt;= 4.7 &amp;&amp; &lt; 5</code> line in <code>Proj_Name.cabal</code>, which in this case will look like:</p>\n\n<pre><code>build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                   , process\n</code></pre>\n\n<p>run <code>stack build</code> again (if there are any further issues you might want to consult the <a href=\"https://www.fpcomplete.com/blog/2015/08/new-in-depth-guide-stack\" rel=\"nofollow\">stack guide</a>, and now <code>stack ghci</code> should have all the modules that you imported in that file available to it.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1442713407, "creation_date": 1442713407, "answer_id": 32674923, "question_id": 32429766, "link": "https://stackoverflow.com/questions/32429766/stack-ghci-doesnt-have-modules-imported-through-stack/32674923#32674923", "title": "Stack GHCI doesn&#39;t have modules imported through Stack", "body": "<p>While the information in Nicholas Monta\u00f1o's answer is correct, I believe it doesn't reach the root of the issue. The likely cause of the problem is that the newly created source file wasn't declared in the cabal file, leading stack to ignore it. Every source file in a project must be declared in a section of the cabal file, be it <code>exposed-modules</code> (for parts of libraries which you want to expose to the users of your code) or <code>other-modules</code> (for internal modules which you do not want to expose).</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 32674923, "answer_count": 2, "score": 0, "last_activity_date": 1442713407, "creation_date": 1441586936, "question_id": 32429766, "link": "https://stackoverflow.com/questions/32429766/stack-ghci-doesnt-have-modules-imported-through-stack", "title": "Stack GHCI doesn&#39;t have modules imported through Stack", "body": "<p>I created a new project using the <code>stack new Proj-Name simple</code> command, and in a file I created within the <code>/src</code> directory imported a module outside of GHC's base library, <code>import System.Process</code>. Running <code>stack build</code> was successful, and the file worked as I expected it to. However, when I ran <code>stack ghci</code> within the same directory it <em>did not</em> have <code>System.Process</code> listed as an importable module.</p>\n\n<p>How do I make it so that all my imported modules are importable within <code>stack ghci</code>?</p>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 11, "last_activity_date": 1520272819, "last_edit_date": 1520272819, "creation_date": 1441563944, "answer_id": 32426841, "question_id": 32426688, "link": "https://stackoverflow.com/questions/32426688/are-there-flipped-operators-for-applicative/32426841#32426841", "title": "Are there flipped operators for Applicative?", "body": "<p><em>lens</em> defines <a href=\"https://hackage.haskell.org/package/lens-4.11/docs/Control-Lens-Lens.html#v:-60--38--62-\" rel=\"nofollow noreferrer\"><code>(&lt;&amp;&gt;) = flip fmap</code></a>. It will be available from <a href=\"https://downloads.haskell.org/~ghc/8.4.1-rc1/docs/html/libraries/base-4.11.0.0/Data-Functor.html#v:-60--38--62-\" rel=\"nofollow noreferrer\"><code>Data.Functor</code> in <em>base</em>-4.11/GHC 8.4</a>. <code>Control.Applicative</code> has <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#v:-60--42--42--62-\" rel=\"nofollow noreferrer\"><code>(&lt;**&gt;)</code></a>, which takes the arguments in the opposite order but is <em>not</em> <code>flip (&lt;*&gt;)</code> because effects are still sequenced from left to right.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "accepted_answer_id": 32426841, "answer_count": 1, "score": 5, "last_activity_date": 1520272819, "creation_date": 1441562926, "question_id": 32426688, "link": "https://stackoverflow.com/questions/32426688/are-there-flipped-operators-for-applicative", "title": "Are there flipped operators for Applicative?", "body": "<p>The operators</p>\n\n<pre><code>$\n. or &lt;&lt;&lt;\n&lt;$&gt;\n&lt;*&gt;\n=&lt;&lt;\n&lt;=&lt;\n</code></pre>\n\n<p>Go very well together, each in some sense applying something on the left to something on the right. When thinking the other way, we have</p>\n\n<pre><code>&amp;\n&gt;&gt;&gt;\n&gt;&gt;=\n&gt;=&gt;\n</code></pre>\n\n<p>But are there flipped versions of <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code>?</p>\n"}, {"tags": ["debugging", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "edited": false, "score": 0, "creation_date": 1441560675, "post_id": 32426286, "comment_id": 52717903, "body": "You really can&#39;t debug in Haskell in the traditional sense, because Haskell, being a purely functional language, does not change state during execution. That said, I usually trace through recursive algorithms on paper."}, {"owner": {"reputation": 1443, "user_id": 3742750, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/15f53fbbfc39fbfcbec14bf8693dff5c?s=128&d=identicon&r=PG&f=1", "display_name": "KMC", "link": "https://stackoverflow.com/users/3742750/kmc"}, "reply_to_user": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "edited": false, "score": 0, "creation_date": 1441560852, "post_id": 32426286, "comment_id": 52717950, "body": "I tried tracing it on paper but it results in infinite loop. But when I run the function in haskell, it returns result. So, there&#39;s gotta be a point where Haskell stops evaluating the argument that I&#39;m passing and I don&#39;t know which."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "edited": false, "score": 3, "creation_date": 1441560879, "post_id": 32426286, "comment_id": 52717956, "body": "@Tetramputechture Not really. There is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\"><code>Debug.Trace</code></a>, and also there are the debugging commands in GHCi. That said, tracing algorithms on paper is a very good suggestion indeed."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441561764, "post_id": 32426286, "comment_id": 52718245, "body": "I also suggest using <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Debug-Trace.html#v:trace\" rel=\"nofollow noreferrer\">trace</a>"}, {"owner": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441563496, "post_id": 32426286, "comment_id": 52718774, "body": "@duplode thanks for the info! didn&#39;t know about that module."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1521138815, "last_edit_date": 1521138815, "creation_date": 1441561737, "answer_id": 32426501, "question_id": 32426286, "link": "https://stackoverflow.com/questions/32426286/debugging-haskell/32426501#32426501", "title": "Debugging Haskell", "body": "<p>You could do this (using <a href=\"https://hackage.haskell.org/package/base/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\"><code>Debug.Trace</code></a>):</p>\n\n<pre><code>import Debug.Trace (trace)\n\nrecur a | trace (\"recur \" ++ show a) False = undefined\nrecur a = if a&gt;100 then  a-10 else recur (recur (a+11))\n</code></pre>\n\n<p>This produces output each time the function <code>recur</code> is called (or rather, because Haskell is lazy, each time the result of applying <code>recur</code> is needed).</p>\n\n<p>Sample output (in ghci):</p>\n\n<pre><code>*Main&gt; recur 99\nrecur 99\nrecur 110\nrecur 100\nrecur 111\nrecur 101\n91\n</code></pre>\n"}], "owner": {"reputation": 1443, "user_id": 3742750, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/15f53fbbfc39fbfcbec14bf8693dff5c?s=128&d=identicon&r=PG&f=1", "display_name": "KMC", "link": "https://stackoverflow.com/users/3742750/kmc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 1, "accepted_answer_id": 32426501, "answer_count": 1, "score": 1, "last_activity_date": 1521138815, "creation_date": 1441560422, "last_edit_date": 1441560578, "question_id": 32426286, "link": "https://stackoverflow.com/questions/32426286/debugging-haskell", "title": "Debugging Haskell", "body": "<p>I'm new to functional programming and I'd like to debug a recursive function to see why I am getting particular value as return value. How do I accomplish that? I found some answers on this site as well as on online, but I can't get my head wrap around the idea of doing that. Any help would be appreciated.</p>\n\n<pre><code>recur = \\a -&gt; if a&gt;100 then  a-10 else recur (recur (a+11))\n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension", "fibonacci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441561751, "post_id": 32426102, "comment_id": 52718239, "body": "Note that <code>last [ x | _&lt;-times ]</code> will <i>always</i> either be <code>x</code> (or error out if <code>times</code> is empty). The list comprehension will build a list where the same element is repeated. There is no state going around in pure functional programming, so there is no point in calling the same function many times with the same argument."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 2566415, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b978087d47dde91a2a4145bc9d930eb?s=128&d=identicon&r=PG", "display_name": "user2566415", "link": "https://stackoverflow.com/users/2566415/user2566415"}, "edited": false, "score": 0, "creation_date": 1442052747, "post_id": 32426460, "comment_id": 52932923, "body": "Sorry for not replying earlier, I forgot :( Anyway, then I have used another implementation of the function to calculate Fibonacci series for some natural number, but I will try to work on my &quot;own&quot; implementation outside the school. Thanks for pointing out the problems, I will consider them :D"}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": true, "score": 4, "last_activity_date": 1441561456, "creation_date": 1441561456, "answer_id": 32426460, "question_id": 32426102, "link": "https://stackoverflow.com/questions/32426102/concerns-about-implementing-a-function-calculating-fibonacci-series/32426460#32426460", "title": "Concerns about implementing a function calculating Fibonacci series", "body": "<p>The definition</p>\n\n<pre><code>let a = insert' a\n</code></pre>\n\n<p>is a recursive definition; the <code>a</code> on the right hand side refers to the <code>a</code> you're defining.</p>\n\n<p>Here's what ghci says:</p>\n\n<pre><code>*Main&gt; retrieve fibl\n*** Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>(The interactive interpreter is a great way to test small parts of a program.)</p>\n\n<p>Try</p>\n\n<pre><code>retrieve a = let b = insert' a\n             in last b\n</code></pre>\n\n<p>There are other problems with your program once you fix that:</p>\n\n<pre><code>*Main&gt; fib 1\n1\n*Main&gt; fib 2\n1\n*Main&gt; fib 3\n1\n*Main&gt; fib 400\n1\n</code></pre>\n\n<p>doesn't look right, and a clue for this behaviour is here:</p>\n\n<pre><code>*Main&gt; [retrieve fibl | _ &lt;- goThrough 3]\n[1,1]\n*Main&gt; [retrieve fibl | _ &lt;- goThrough 6]\n[1,1,1,1,1]\n</code></pre>\n\n<p>The comprehension <code>[ x | _ &lt;- goThrough n]</code> creates a list with <code>n</code> copies of <code>x</code>.<br>\n(This isn't very surprising as the elements don't depend on the values in <code>goThrough n</code>, only its length.)</p>\n\n<p>I'm afraid there's no easy fix for this, as it's unclear how the code is intended to work.<br>\nMy only advice would be to stop thinking in terms of loops.</p>\n"}], "owner": {"reputation": 85, "user_id": 2566415, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b978087d47dde91a2a4145bc9d930eb?s=128&d=identicon&r=PG", "display_name": "user2566415", "link": "https://stackoverflow.com/users/2566415/user2566415"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 32426460, "answer_count": 1, "score": 0, "last_activity_date": 1441561570, "creation_date": 1441559190, "question_id": 32426102, "link": "https://stackoverflow.com/questions/32426102/concerns-about-implementing-a-function-calculating-fibonacci-series", "title": "Concerns about implementing a function calculating Fibonacci series", "body": "<p>I have problems with implementing a function that calculates Fibonacci series for all n>1 with list comprehensions. I have a lot of experience from OOP and I am not that used with programming functionally. But below you'll find my codes to the function I am trying to implement:</p>\n\n<pre><code>fib :: Int -&gt; Int\nnextLast :: [Int]-&gt;Int\ninsert' :: [Int]-&gt;[Int]\nretrieve :: [Int]-&gt;Int\ngoThrough :: Int-&gt;[Int]\n\nfibl = [0,1] --List of edge cases to be used in the iteration\nnextLast a = a !! (length a - 2)\ninsert' a = a ++ [last a + nextLast a] --How to create the pattern of Fibonacci series in a\n\nretrieve a = let a = insert' a\n             in last a\n\ngoThrough n = replicate (n-1) 0\n\nfib 0 = 0 --Edge case #1\nfib 1 = 1 --Edge case #2\nfib n = let times = goThrough n --n&gt;1, n = any natural number\n        in last [retrieve fibl | _&lt;-times]\n</code></pre>\n\n<p>I don't get compile errors or something like that, but when I run these codes, then nothing happens and it never terminates.</p>\n\n<p>Can someone explain why this happens and, eventually, recommend a solution to the problem?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441555277, "post_id": 32425415, "comment_id": 52716231, "body": "N.B.: You mean &quot;list&quot; rather than &quot;array&quot;."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441555311, "post_id": 32425415, "comment_id": 52716242, "body": "Are sure you want to use the <code>(&gt;&gt;&gt;)</code> operator, at this stage?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441556074, "post_id": 32425415, "comment_id": 52716494, "body": "@Jubobs Though it is rather unusual, I don&#39;t see any harm."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441556199, "post_id": 32425415, "comment_id": 52716533, "body": "@duplode Neither do I. I just find it weird that the OP would use such a relatively advanced operator at this stage of his/her Haskell learning."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1441556477, "post_id": 32425415, "comment_id": 52716603, "body": "well only the theory/implementation is advanced - the usage is trivial (and maybe the code is a bit easier to read than with <code>(.)</code> - so the teacher might have decided to introduce composition like this"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1441557869, "last_edit_date": 1441557869, "creation_date": 1441555477, "answer_id": 32425514, "question_id": 32425415, "link": "https://stackoverflow.com/questions/32425415/how-to-combine-map-and-replicate-on-an-array-of-integers/32425514#32425514", "title": "how to combine map and replicate on an array of integers", "body": "<p>you are on the right track, you just mixed up the functions a bit:</p>\n\n<ul>\n<li><code>replicate</code> will take a number <code>n</code> and repeat the second argument n-times into a list (so you just got the order wrong - you could use <code>flip</code> or an aux. function like I did bellow)</li>\n<li>you have to watch out if you want <code>Char</code> or <code>String</code> (<code>'='</code> VS <code>\"=\"</code> for example) - read the type-definitions (try <code>:t intercalate</code> or <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:intercalate\" rel=\"nofollow\">Hoogle</a>) carefully and remember: <code>String ~ [Char]</code>!</li>\n<li><code>intercalate</code> actually does the concatenation so you don't need concat at all</li>\n</ul>\n\n<p>Here is a almost working version:</p>\n\n<pre><code>eqSigns :: Int -&gt; String\neqSigns n = replicate n '='\n\nmixIn :: [Int] -&gt; String\nmixIn = intercalate \"+\" . map eqSigns\n</code></pre>\n\n<p>try it and see if you get the missing parts in there ;)</p>\n\n<hr>\n\n<p>here is the version with <code>flip</code> instead:</p>\n\n<pre><code>mixIn :: [Int] -&gt; String\nmixIn = intercalate \"+\" . map (flip replicate '=')\n</code></pre>\n\n<hr>\n\n<p>PS: are you coming from some ML/F# background?</p>\n"}], "owner": {"reputation": 137, "user_id": 4628687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1ee61a2e40c9cacd5f65490be4578b3?s=128&d=identicon&r=PG&f=1", "display_name": "Enzo", "link": "https://stackoverflow.com/users/4628687/enzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 32425514, "answer_count": 1, "score": 4, "last_activity_date": 1441557869, "creation_date": 1441554979, "last_edit_date": 1441555388, "question_id": 32425415, "link": "https://stackoverflow.com/questions/32425415/how-to-combine-map-and-replicate-on-an-array-of-integers", "title": "how to combine map and replicate on an array of integers", "body": "<p>For a school exercise i need to generate a series of symbols with a given array of numbers. given is  <code>[3,3,2,1]</code> output <code>\"+===+===+==+=+\"</code>.\nMy approach would be to use <code>map</code> and <code>replicate</code> \"=\" on the array then <code>intercalate</code> \"+\" and finally <code>concat</code> the array to a single string.</p>\n\n<p>My solution is something like this (while standing knee deep in errors)</p>\n\n<pre><code>printLine arr = map (replicate \"=\") arr &gt;&gt;&gt; intercalate '*' &gt;&gt;&gt; concat\n</code></pre>\n\n<p>what is the correct syntax? or shouldn't i use map at all?</p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441553101, "post_id": 32425024, "comment_id": 52715510, "body": "Please make your code self-contained. In particular, add your import statements and definitions for <code>Mesh</code>, <code>Cell</code>, etc. It will be easier for people to make sure that their point-free versions typecheck."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1441553612, "post_id": 32425024, "comment_id": 52715673, "body": "Have you tried the pointfree tool?"}, {"owner": {"reputation": 23, "user_id": 5306158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/krGcQ.jpg?s=128&g=1", "display_name": "Alexander Yushkov", "link": "https://stackoverflow.com/users/5306158/alexander-yushkov"}, "edited": false, "score": 0, "creation_date": 1441554965, "post_id": 32425024, "comment_id": 52716128, "body": "Thank you for an idea but it seems that it&#39;s too difficult for pointfree tool or I&#39;m doing something wrong"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441555869, "post_id": 32425354, "comment_id": 52716435, "body": "Reordering the arguments may not be an option, though."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441556322, "post_id": 32425354, "comment_id": 52716559, "body": "@Jubobs If it isn&#39;t, then don&#39;t :) (Or use <code>flip</code>, but I really don&#39;t feel like adding that to the answer. It gets ugly...)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441556377, "post_id": 32425354, "comment_id": 52716571, "body": "Yes, it gets ugly quickly. I was just nitpicking."}, {"owner": {"reputation": 23, "user_id": 5306158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/krGcQ.jpg?s=128&g=1", "display_name": "Alexander Yushkov", "link": "https://stackoverflow.com/users/5306158/alexander-yushkov"}, "edited": false, "score": 0, "creation_date": 1441586379, "post_id": 32425354, "comment_id": 52724475, "body": "Suddenly, <code>cell</code> and others returns <code>Maybe (Cell a)</code>, which is handled by <code>MaybeT</code> transformer, so applying gets results in <code>join $ (MaybeT . return) &lt;$&gt; gets (\\m -&gt; cell m id)</code> which is not much better"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23, "user_id": 5306158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/krGcQ.jpg?s=128&g=1", "display_name": "Alexander Yushkov", "link": "https://stackoverflow.com/users/5306158/alexander-yushkov"}, "edited": false, "score": 0, "creation_date": 1441587195, "post_id": 32425354, "comment_id": 52724627, "body": "@AlexanderYushkov You only need <code>MaybeT (gets (\\m -&gt; cell m ix))</code>.  The type of <code>MaybeT</code> is <code>m (Maybe a) -&gt; MaybeT m a</code>, so it can do the conversion you want on its own."}, {"owner": {"reputation": 23, "user_id": 5306158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/krGcQ.jpg?s=128&g=1", "display_name": "Alexander Yushkov", "link": "https://stackoverflow.com/users/5306158/alexander-yushkov"}, "edited": false, "score": 0, "creation_date": 1441588308, "post_id": 32425354, "comment_id": 52724902, "body": "Wow, thanks, that realy works as intended. So the problem was really not in pointfree conversion but in proper usage of libraries"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1441588183, "last_edit_date": 1441588183, "creation_date": 1441554604, "answer_id": 32425354, "question_id": 32425024, "link": "https://stackoverflow.com/questions/32425024/pointfree-conversion/32425354#32425354", "title": "Pointfree conversion", "body": "<p>Just use <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-State-Lazy.html#v:gets\" rel=\"nofollow\"><code>gets</code></a>, which returns a projection of the state specified by an arbitrary function on it, and <code>MaybeT</code>:</p>\n\n<pre><code>cellM ix = MaybeT (gets (\\m -&gt; cell m ix))\n\nneighbourM ix c = MaybeT (gets (\\m -&gt; neighbour m ix c))\n\nowner c = MaybeT (gets (\\m -&gt; owner m c))\n</code></pre>\n\n<p>(N.B.: I recommend not naming things <code>id</code>. The standard <code>id</code> function is too important, which makes the name clash very confusing.) </p>\n\n<p>To make that more pointfree, reorder the arguments of your functions as appropriate. For instance:</p>\n\n<pre><code>cell :: Int -&gt; Mesh a -&gt; Maybe (Cell a)\n\ncellM ix = MaybeT (gets (cell ix))\n</code></pre>\n\n<p>(You could go all the way and write <code>cellM = MaybeT . gets . cell</code> instead, but I feel that would excessively obscure what <code>cellM</code> does.)</p>\n\n<p>P.S.: Given that you are using <code>State</code>, odds are you are also interested in functions that modify a mesh. If you aren't, however, <code>Reader</code> would be more appropriate than <code>State</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 5306158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/krGcQ.jpg?s=128&g=1", "display_name": "Alexander Yushkov", "link": "https://stackoverflow.com/users/5306158/alexander-yushkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 32425354, "answer_count": 1, "score": 1, "last_activity_date": 1441588183, "creation_date": 1441552416, "last_edit_date": 1441553811, "question_id": 32425024, "link": "https://stackoverflow.com/questions/32425024/pointfree-conversion", "title": "Pointfree conversion", "body": "<p>I have some traverse/accessor functions to work with my mesh type:</p>\n\n<pre><code>cell :: Mesh a -&gt; Int -&gt; Maybe (Cell a)\nneighbour :: Mesh a -&gt; Int -&gt; Cell a -&gt; Maybe (Cell a)\nowner :: Mesh a -&gt; Cell a -&gt; Maybe (Cell a)\n</code></pre>\n\n<p>To avoid passing mesh to each function and to handle fails I've created monadic version of them via this compound monad:</p>\n\n<pre><code>type MMesh a b = MaybeT (State (Mesh a)) b\n</code></pre>\n\n<p>So, I have such monadic accessors:</p>\n\n<pre><code>getMesh = get :: MMesh a (Mesh a) -- just to remove type declarations\n\ncellM id = getMesh &gt;&gt;= (MaybeT . return) &lt;$&gt; (\\m -&gt; cell m id)\nneighbourM idx cell = getMesh &gt;&gt;= (MaybeT . return) &lt;$&gt; (\\m -&gt; neighbour m idx cell)\nownerM cell = getMesh &gt;&gt;= (MaybeT . return) &lt;$&gt; (\\m -&gt; owner m cell)\n</code></pre>\n\n<p>They obviously follow the same pattern and I would be glad to move common part to some external function, say <code>liftMesh</code> to rewrite the code above as:</p>\n\n<pre><code>cellM = liftMesh cell\nneighbourM = liftMesh neighbour\nownerM - liftMesh owner\n</code></pre>\n\n<p>But this first needs the functions to be rewritten in pointfree style to omit variable number of arguments. And that's where I'm stuck, so could anyone help to convert this to pointfree or find other ways achive the same result?</p>\n\n<p>Upd: adding the full text here: <a href=\"http://pastebin.com/nmJVNx93\" rel=\"nofollow\">http://pastebin.com/nmJVNx93</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "edited": false, "score": 0, "creation_date": 1441544048, "post_id": 32423687, "comment_id": 52712851, "body": "I think I see what you mean <code>let x = 3</code> =&gt; (x, x) :: (Int, Integer) =&gt; no type error. So <code>x</code> and <code>x</code> aren&#39;t necessarily the same type once displayed since a different <code>Num</code> dictionary could be passed. Interesting."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "edited": false, "score": 0, "creation_date": 1441548759, "post_id": 32423687, "comment_id": 52714275, "body": "@obadz, to confuse matters further, enabling certain type system extensions turns off let generalization, forcing the two to have the same type (unless you give a type signature). I don&#39;t know if that will change anything for GHCi though."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441550738, "post_id": 32423687, "comment_id": 52714803, "body": "@dfeuer Oh duh, that&#39;s why putting it in a file changes it, I should explain that."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441551436, "post_id": 32423687, "comment_id": 52715019, "body": "@dfeuer The other restriction you&#39;re probably thinking of, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/other-type-extensions.html#mono-local-binds\" rel=\"nofollow noreferrer\"><code>MonoLocalBinds</code></a>, doesn&#39;t change anything in this case because <code>x</code> is &quot;closed&quot;. Here&#39;s a version where it matters: <code>let f y = let x = (y `seq` trace &quot; Eval&#39;d!&quot; 6) in (x, x) in f 0</code>"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1441551103, "last_edit_date": 1441551103, "creation_date": 1441543410, "answer_id": 32423687, "question_id": 32423526, "link": "https://stackoverflow.com/questions/32423526/odd-reuse-in-the-evaluation-of-these-expressions/32423687#32423687", "title": "Odd reuse in the evaluation of these expressions", "body": "<p>They're <em>not</em> guaranteed to be the same type:</p>\n\n<pre><code>Prelude Debug.Trace&gt; :t let x = (trace \" Eval'd!\" (* 2)) 3 in (x, x)\nlet x = (trace \" Eval'd!\" (* 2)) 3 in (x, x)\n  :: (Num t, Num t1) =&gt; (t, t1)\n</code></pre>\n\n<p>Also, if you put it in a file, it only gets evaluated once, even when called from GHCi. (This is because in declarations in files but not GHCi, the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-930004.5.5\" rel=\"nofollow\">dreaded monomorphism restriction</a> is on by default):</p>\n\n<pre><code>import Debug.Trace\nmain = print $ let x = (trace \" Eval'd!\" (* 2)) 3 in (x, x)\n</code></pre>\n\n<p>Also,</p>\n\n<pre><code>let x = (trace \" Eval'd!\" 6) in (x,x)\n</code></pre>\n\n<p>behaves about the same, so it's really all in the type (class) ambiguity.</p>\n\n<p>The reason why it doesn't share all uses of <code>x</code> is because at GHC core level <code>x</code>, unoptimized, is really a <em>function</em> taking a <code>Num</code> typeclass dictionary argument. To share it, it has to do enough analysis to see that the types are the same.</p>\n\n<p>The reason why it doesn't realize is basically that GHCi is intended for fast code experimentation turnaround, not for creating good code, so it does nearly no optimization at <em>all</em>, so it's almost pure luck whether it detects such things or not.</p>\n\n<p>(There's also an <a href=\"https://ghc.haskell.org/trac/ghc/ticket/1257\" rel=\"nofollow\">outstanding hole</a> in the GHCi bytecode design that means you <em>cannot</em> enable optimization levels for it, even if you'd want to. Basically it doesn't support \"unboxed tuples\", which GHC optimization uses a lot.)</p>\n"}], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 32423687, "answer_count": 1, "score": 3, "last_activity_date": 1441551103, "creation_date": 1441542240, "last_edit_date": 1441543143, "question_id": 32423526, "link": "https://stackoverflow.com/questions/32423526/odd-reuse-in-the-evaluation-of-these-expressions", "title": "Odd reuse in the evaluation of these expressions", "body": "<p>I'm trying to use Debug.Trace.trace to figure out how many times a function is evaluated, and seeing some surprising results.</p>\n\n<pre><code>ghci&gt; import Debug.Trace\n\nghci&gt; let x = (trace \" Eval'd!\" (* 2)) 3 in (x, x)\n( Eval'd!\n6, Eval'd!\n6)\n\nghci&gt; let x = (trace \" Eval'd!\" (* 2)) 3 in x `seq` (x, x)\nEval'd!\n( Eval'd!\n6, Eval'd!\n6)\n\nghci&gt; let x = (trace \" Eval'd!\" (* 2)) (3 :: Int) in (x, x)\n( Eval'd!\n6,6)\n</code></pre>\n\n<p>I'm making the assumption that <code>Eval'd</code> is printed once for each evaluation of the <code>(* 2)</code> function. Is that a correct assumption?</p>\n\n<p>Secondly, why is the function ever printed more than once? I suspect that <code>x</code> being of some unspecified type of the <code>Num</code> typeclass has to do with it given that the third case works but I can't think of an explanation.</p>\n\n<p><code>(x, x) :: Num a =&gt; (a, a)</code> guarantees that the two elements of the tuples have the same value just as much as <code>(x, x) :: (Int, Int)</code>, so why eval <code>x</code> twice?</p>\n\n<p>UPDATE:</p>\n\n<p>Actually I had assumed that the type of <code>(x, x)</code> was <code>Num a =&gt; (a, a)</code>. But it's apparently <code>(x, x) :: (Num t, Num t1) =&gt; (t, t1)</code>.</p>\n\n<p>Why does GHC not realize that <code>t ~ t1</code> here? I suspect it's related to the answer to my question.</p>\n"}, {"tags": ["c++", "haskell", "cabal", "ffi", "hsc2hs"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1441541236, "post_id": 32423248, "comment_id": 52712007, "body": "I think you can try setting <code>-c g++ -l g++</code> in <code>hsc2hs-options</code>."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1441541637, "post_id": 32423248, "comment_id": 52712138, "body": "So I tried building with <code>cabal build --hsc2hs-options &#39;-c g++&#39; --hsc2hs-options &#39;-l g++&#39;</code>, but it didn&#39;t work."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1441546326, "post_id": 32423248, "comment_id": 52713559, "body": "I see that cabal is broken in this respect (it supplies its own cc and ld arguments that override yours). You may want to make your header file C-compatible instead. Don&#39;t include any C++ headers in it, or #ifdef out any C++ features. You need to make <code>foo</code> C-callable, so use <code>extern &quot;C&quot;</code> for it (also suitably #ifdef&#39;ed-out)."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1441562377, "post_id": 32423248, "comment_id": 52718416, "body": "@n.m. I can&#39;t do this, because I need a type definition from the C++ header. I can&#39;t define it in my own header, because it may change from platform to platform."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1441566319, "post_id": 32423248, "comment_id": 52719693, "body": "The shotgun approach <code>cabal build --with-gcc=g++ --with-ld=g++</code> works in the simple case, but you have to be extra c areful with it if you have other C sources. You still need to wrap the declaration of <code>foo</code> in <code>extern &quot;C&quot;</code> but you don&#39;t have to #ifdef it out."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1441566788, "post_id": 32423248, "comment_id": 52719824, "body": "OR you can use a wrapper for hsc2hs that calls the real hsc2hs but processes the options the way you want (i.e. discards the default --cc and --ld passed by cabal and uses those you provide). Haven&#39;t tried this method but I&#39;m pretty sure it will work (because it works when I call hsc2hs myself with the right options)."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1441570471, "post_id": 32423248, "comment_id": 52720875, "body": "@n.m. Specifying --with-gcc=g++ (and ld) works and doesn&#39;t cause problems, as I only have C++ sources. Thank you! It&#39;s not as nice for distributing, because I didn&#39;t find a way, to embed these options in the cabal file yet."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1456439769, "post_id": 32423248, "comment_id": 58961122, "body": "@n.m.since your comment resolved the question, maybe you should submit it as an answer?"}], "owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 300, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1441543666, "creation_date": 1441540376, "last_edit_date": 1441543666, "question_id": 32423248, "link": "https://stackoverflow.com/questions/32423248/hsc2hs-c-headers", "title": "hsc2hs c++ headers", "body": "<p>I'm trying to build a Haskell executable with an FFI against some C++ sources.</p>\n\n<p>I have a C header (cstuff/foo.h) like this:</p>\n\n<pre><code>#ifndef _FOO_H_\n#define _FOO_H_\n\n#include &lt;somecppheader.c&gt; // Some header outside of my control with C++ constructs\n\nvoid foo();\n\n#endif\n</code></pre>\n\n<p>The implementation of foo shouldn't matter. It does something and uses something declared in somecppheader.h along the way.</p>\n\n<p>The executable section in the Cabal file looks like this:</p>\n\n<pre><code>executable botprog\n  main-is:             Main.hsc\n  other-extensions:    ForeignFunctionInterface\n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8\n  build-tools:         hsc2hs\n  default-language:    Haskell2010\n  include-dirs:        cstuff\n  c-sources:           cstuff/foo.cpp\n  pkgconfig-depends:   somelib -- The one that contains somecppheader.h\n</code></pre>\n\n<p>Main.hsc looks something like this:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\n#include &lt;foo.h&gt;\nforeign import ccall \"foo.h foo\" :: IO ()\n\nmain = foo &gt;&gt; putStrLn \"Called foo.\"\n</code></pre>\n\n<p>hsc2hs isn't actually needed in this example, it's just used to, to trigger the error i'm trying to describe.</p>\n\n<p>The problem is that somecppheader.h is a C++ header with C++ specific constructs and the include of foo.h seems to compile it as a C header, which fails, because of C++ constructs, like class definitions.</p>\n\n<p>How can I tell hsc2hs or Cabal that foo.h needs to be compiled with g++, rather than gcc?</p>\n"}, {"tags": ["windows", "haskell", "lapack", "blas", "hmatrix"], "comments": [{"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1441757257, "post_id": 32423225, "comment_id": 52799859, "body": "I just ran into this problem as well. It seems we aren&#39;t the only ones. Did you have any luck fixing it? Also see: <a href=\"https://github.com/albertoruiz/hmatrix/issues/125\" rel=\"nofollow noreferrer\">github.com/albertoruiz/hmatrix/issues/125</a>"}, {"owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "reply_to_user": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1441914007, "post_id": 32423225, "comment_id": 52879689, "body": "I have fixed a bit OpenBLAS cabal support. But there are still a compilation issues: <a href=\"https://github.com/albertoruiz/hmatrix/pull/147\" rel=\"nofollow noreferrer\">github.com/albertoruiz/hmatrix/pull/147</a>"}], "answers": [{"comments": [{"owner": {"reputation": 950, "user_id": 2430739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fd47a57b46a46d55f7a8dde166ea3742?s=128&d=identicon&r=PG", "display_name": "holdenlee", "link": "https://stackoverflow.com/users/2430739/holdenlee"}, "edited": false, "score": 0, "creation_date": 1463713978, "post_id": 37164496, "comment_id": 62192059, "body": "I&#39;m getting <code>Missing C library: libopenblas</code> when running 6."}, {"owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "reply_to_user": {"reputation": 950, "user_id": 2430739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fd47a57b46a46d55f7a8dde166ea3742?s=128&d=identicon&r=PG", "display_name": "holdenlee", "link": "https://stackoverflow.com/users/2430739/holdenlee"}, "edited": false, "score": 0, "creation_date": 1464475375, "post_id": 37164496, "comment_id": 62503846, "body": "Ensure you have blas headers in your extra-include-dirs In my case: &#39;d:\\Programs\\openblas\\include&#39; there&#39;s <code>cblas.h</code>, <code>f77blas.h</code> etc."}, {"owner": {"reputation": 950, "user_id": 2430739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fd47a57b46a46d55f7a8dde166ea3742?s=128&d=identicon&r=PG", "display_name": "holdenlee", "link": "https://stackoverflow.com/users/2430739/holdenlee"}, "edited": false, "score": 0, "creation_date": 1464574045, "post_id": 37164496, "comment_id": 62526840, "body": "I do have the blas headers in the directory (for me, <code>C:&#47;PF&#47;openblas&#47;include</code>, so I do <code>cabal install --flags=openblas --extra-lib-dirs=C:&#47;PF&#47;openblas&#47;lib --extra-include-dirs=C:&#47;PF&#47;openblas&#47;include</code>). I cloned OpenBLAS as in step 2 which has the blas headers in the include directory."}, {"owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "reply_to_user": {"reputation": 950, "user_id": 2430739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fd47a57b46a46d55f7a8dde166ea3742?s=128&d=identicon&r=PG", "display_name": "holdenlee", "link": "https://stackoverflow.com/users/2430739/holdenlee"}, "edited": false, "score": 0, "creation_date": 1480617385, "post_id": 37164496, "comment_id": 69048129, "body": "I&#39;ve found some time to retry. Seems, that now it can be done in less steps with no need to build OpenBLAS and install hmatrix from sources. Hope this helps."}], "tags": [], "owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1480784953, "last_edit_date": 1480784953, "creation_date": 1462974097, "answer_id": 37164496, "question_id": 32423225, "link": "https://stackoverflow.com/questions/32423225/how-to-build-hmatrix-with-blas-and-lapack-under-windows/37164496#37164496", "title": "How to build hmatrix with BLAS and LAPACK under Windows?", "body": "<p>Try this:</p>\n\n<ol>\n<li>Install mingw from <a href=\"https://sourceforge.net/projects/mingw-w64/files/\" rel=\"nofollow noreferrer\">https://sourceforge.net/projects/mingw-w64/files/</a>, in my case <code>x86_64-posix-seh</code>). We need just <code>libgfortran-3.dll</code>, which is not present in ghc's mingw. Or you can get it from here: <a href=\"http://icl.cs.utk.edu/lapack-for-windows/libraries/VisualStudio/3.6.0/Dynamic-MINGW/Win64/libgfortran-3.dll\" rel=\"nofollow noreferrer\">http://icl.cs.utk.edu/lapack-for-windows/libraries/VisualStudio/3.6.0/Dynamic-MINGW/Win64/libgfortran-3.dll</a> (Replace Win64 with Win32 in url if necessary)</li>\n<li>Get OpenBLAS binaries from <a href=\"https://sourceforge.net/projects/openblas/files/\" rel=\"nofollow noreferrer\">https://sourceforge.net/projects/openblas/files/</a> (in my case <code>Win64-int32</code>).</li>\n<li>Place <code>libopenblas.dll</code> and <code>libgfortran-3.dll</code> in some folder, in my case <code>C:\\Programs\\lib</code></li>\n<li><code>cabal install hmatrix --flags=openblas --extra-lib-dirs=C:\\Programs\\lib</code></li>\n</ol>\n\n<p>That's all. You also have to pass libs to <code>ghci</code> (all libs must be in PATH, so in my case ghc's <code>mingw\\bin</code> and <code>C:\\Programs\\lib</code> are in PATH):</p>\n\n<p><code>ghci -llibopenblas -llibgfortran-3 -llibgcc_s_seh-1</code></p>\n\n<p>where <code>libgcc_s_seh-1.dll</code> is in ghc's mingw (in my case: <code>C:\\Programs\\ghc\\ghc-8.0.1\\mingw\\bin</code>)</p>\n\n<p><em>NOTE: tested with ghc-8.0.1</em><br>\n<em>UPDATE: i've found that now it can be done in less steps</em></p>\n"}], "owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1581, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1480784953, "creation_date": 1441540186, "last_edit_date": 1441760885, "question_id": 32423225, "link": "https://stackoverflow.com/questions/32423225/how-to-build-hmatrix-with-blas-and-lapack-under-windows", "title": "How to build hmatrix with BLAS and LAPACK under Windows?", "body": "<p>Windows 10 x64\nCabal 1.22</p>\n\n<p>I'm following steps in Windows section <a href=\"https://github.com/AlbertoRuiz/hmatrix/blob/master/INSTALL.md\" rel=\"nofollow\">https://github.com/AlbertoRuiz/hmatrix/blob/master/INSTALL.md</a></p>\n\n<p>I downloaded hmatrix sources and gsl-lapack-windows.zip.\nWhen I try to install hmatrix with:</p>\n\n<blockquote>\n  <p>D:\\Projects\\workspace\\hmatrix-0.16.1.5>cabal install\n  --extra-include-dirs=D:\\Projects\\workspace\\gsl-lapack-windows\\ --extra-lib-dirs=d:\\Projects\\workspace\\gsl-lapack-windows\\</p>\n</blockquote>\n\n<p>I got this message that I'm still cannot solve:</p>\n\n<blockquote>\n  <p>Configuring hmatrix-0.16.1.5... Failed to install hmatrix-0.16.1.5\n  Build log (\n  D:\\Projects\\workspace\\hmatrix-0.16.1.5.cabal-sandbox\\logs\\hmatrix-0.16.1.5.log\n  ): Configuring hmatrix-0.16.1.5...\n  setup-Simple-Cabal-1.22.4.0-x86_64-windows-ghc-7.10.2.exe: Missing\n  dependencies on foreign libraries:\n  * Missing C libraries: blas, lapack, blas, lapack This problem can usually be solved by installing the system packages that provide these\n  libraries (you may need the \"-dev\" versions). If the libraries are\n  already installed but in a non-standard location then you can use the\n  flags --extra-include-dirs= and --extra-lib-dirs= to specify where\n  they are. cabal: Error: some packages failed to install:\n  hmatrix-0.16.1.5 failed during the configure step. The exception was:\n  ExitFailure 1</p>\n</blockquote>\n\n<p>\"-dev versions\" I think is only for *nix based OSes. In folders I give to cabal there are blas.dll and lapack.dll.</p>\n\n<p>What could be the problem?</p>\n"}, {"tags": ["haskell", "command-line-arguments", "applicative", "optparse-applicative"], "answers": [{"comments": [{"owner": {"reputation": 19637, "user_id": 368821, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74a1a6b65bbe5ad874af0aa193dc76dc?s=128&d=identicon&r=PG", "display_name": "mgiuca", "link": "https://stackoverflow.com/users/368821/mgiuca"}, "edited": false, "score": 2, "creation_date": 1560127376, "post_id": 32422793, "comment_id": 99623841, "body": "Thanks! For some reason this example has been deleted from the README so this answer is the only way to learn how to do this very basic thing."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 19637, "user_id": 368821, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74a1a6b65bbe5ad874af0aa193dc76dc?s=128&d=identicon&r=PG", "display_name": "mgiuca", "link": "https://stackoverflow.com/users/368821/mgiuca"}, "edited": false, "score": 0, "creation_date": 1560150029, "post_id": 32422793, "comment_id": 99627997, "body": "@mgiuca You&#39;re welcome. To be fair, the wording has changed and the example is gone, but a description of <code>optional</code> can still be found at the end of <a href=\"https://github.com/pcapriotti/optparse-applicative/blob/master/README.md#alternative\" rel=\"nofollow noreferrer\">this section</a>."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 35, "last_activity_date": 1441551135, "last_edit_date": 1441551135, "creation_date": 1441537075, "answer_id": 32422793, "question_id": 32422339, "link": "https://stackoverflow.com/questions/32422339/how-to-parse-an-optional-flag-as-a-maybe-value/32422793#32422793", "title": "How to parse an optional flag as a Maybe value?", "body": "<p>See the following passage of the <a href=\"https://github.com/pcapriotti/optparse-applicative/blob/master/README.md\" rel=\"noreferrer\"><code>optparse-applicative</code> README</a>:</p>\n\n<blockquote>\n  <p>Parsers are instances of both <code>Applicative</code> and <code>Alternative</code>, and work\n  with any generic combinator, like <code>many</code> and <code>some</code>. For example, to make\n  a option return <code>Nothing</code> instead of failing when it's not supplied, you\n  can use the <code>optional</code> combinator in <code>Control.Applicative</code>:</p>\n\n<pre><code>optional $ strOption\n   ( long \"output\"\n  &lt;&gt; metavar \"DIRECTORY\" )\n</code></pre>\n</blockquote>\n\n<p>Accordingly, all you have to do is apply the <code>optional</code> combinator to the result of <code>strOption</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Options.Applicative\n\ndata Config = Config\n    { cIn  :: Maybe String\n    , cOut :: Maybe String\n    } deriving Show\n\nconfigParser :: Parser Config\nconfigParser = Config\n    &lt;$&gt; (optional $ strOption $ long \"in\" &lt;&gt; short 'i')\n    &lt;*&gt; (optional $ strOption $ long \"out\" &lt;&gt; short 'o')\n\nmain :: IO ()\nmain = do\n    conf &lt;- execParser (info configParser fullDesc)\n    print conf\n</code></pre>\n\n<p>Tests at the command line:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ main --in foo -o bar\nConfig {cIn = Just \"foo\", cOut = Just \"bar\"}\n$ main -i foo\nConfig {cIn = Just \"foo\", cOut = Nothing}\n</code></pre>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2620, "favorite_count": 5, "accepted_answer_id": 32422793, "answer_count": 1, "score": 25, "last_activity_date": 1537016184, "creation_date": 1441534074, "last_edit_date": 1537016184, "question_id": 32422339, "link": "https://stackoverflow.com/questions/32422339/how-to-parse-an-optional-flag-as-a-maybe-value", "title": "How to parse an optional flag as a Maybe value?", "body": "<p>I'm trying to use <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2\" rel=\"noreferrer\">optparse-applicative</a> to parse a <code>Maybe String</code> but I can't find anywhere how to deal with <code>Maybe</code>. The only thing I found is to add a default value but I really need a <code>Nothing</code> if user didn't supply an option instead of <code>\"\"</code>. Is there any way to achieve this ?</p>\n\n<p>Here is an example of working code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Options.Applicative\n\ndata Config = Config\n    { cIn :: String\n    , cOut :: String\n    } deriving Show\n\nconfigParser :: Parser Config\nconfigParser = Config\n    &lt;$&gt; strOption (long \"in\" &lt;&gt; short 'i')\n    &lt;*&gt; strOption (long \"out\" &lt;&gt; short 'o')\n\n\nmain :: IO ()\nmain = do\n    conf &lt;- execParser (info configParser fullDesc)\n    print conf\n</code></pre>\n\n<p>However, I would like the parameters to be optional and use <code>Maybe String</code> instead of <code>String</code> in <code>Config</code> :</p>\n\n<pre><code>data Config = Config\n    { cIn :: Maybe String\n    , cOut :: Maybe String\n    } deriving Show\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441532690, "post_id": 32421836, "comment_id": 52709705, "body": "Why shouldn&#39;t it be possible? Just parse it an kinda <code>fold</code> over the result to convert it to <code>[Person]</code>? But I have never used <code>aeson</code>. Maybe state what the problem is more clearly."}], "answers": [{"tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": true, "score": 7, "last_activity_date": 1441535674, "last_edit_date": 1441535674, "creation_date": 1441532232, "answer_id": 32422072, "question_id": 32421836, "link": "https://stackoverflow.com/questions/32421836/aeson-parsing-dynamic-keys-as-type-field/32422072#32422072", "title": "Aeson: parsing dynamic keys as type field", "body": "<p>You cannot define an instance for <code>[Person]</code> literally, because aeson already includes an instance for <code>[a]</code>, however you can create a newtype, and provide an instance for that.</p>\n\n<p>Aeson also includes the instance <code>FromJSON a =&gt; FromJSON (Map Text a)</code>, which means if aeson knows how to parse something, it knows how to parse a dict of that something.</p>\n\n<p>You can define a temporary datatype resembling a value in the dict, then use the Map instance to define <code>FromJSON PersonList</code>, where <code>newtype PersonList = PersonList [Person]</code>:</p>\n\n<pre><code>data PersonInfo = PersonInfo { infoName :: Text, infoAge :: Int }\n\ninstance FromJSON PersonInfo where\n    parseJSON (Object v) = PersonInfo &lt;$&gt; v .: \"name\" &lt;*&gt; v .: \"age\"\n    parseJSON _ = mzero\n\ndata Person = Person { id :: Text, name :: Text, age :: Int }\nnewtype PersonList = PersonList [Person]\n\ninstance FromJSON PersonList where\n    parseJSON v = fmap (PersonList . map (\\(id, PersonInfo name age) -&gt; Person id name age) . M.toList) $ parseJSON v\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 1, "creation_date": 1441534053, "post_id": 32422275, "comment_id": 52710089, "body": "Doesn&#39;t that produce inconsistent insances if, say, we were to instantiate <code>FromJSON Person</code>"}], "tags": [], "owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "is_accepted": false, "score": 3, "last_activity_date": 1441533582, "creation_date": 1441533582, "answer_id": 32422275, "question_id": 32421836, "link": "https://stackoverflow.com/questions/32421836/aeson-parsing-dynamic-keys-as-type-field/32422275#32422275", "title": "Aeson: parsing dynamic keys as type field", "body": "<p>If you enable <code>FlexibleInstances</code>, you can make instance for <code>[Person]</code>. You can parse your object to <code>Map Text Value</code> and then parse each element in map:</p>\n\n<pre><code>{-# LANGUAGE UnicodeSyntax, OverloadedStrings, FlexibleInstances #-}\n\nmodule Person (\n    ) where\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport Data.Text.Lazy\nimport Data.Text.Lazy.Encoding\nimport Data.Map (Map)\nimport qualified Data.Map as M\n\ndata Person = Person {\n    id \u2237 Text,\n    name \u2237 Text,\n    age \u2237 Int }\n        deriving (Eq, Ord, Read, Show)\n\ninstance FromJSON [Person] where\n    parseJSON v = do\n        objs \u2190 parseJSON v \u2237 Parser (Map Text Value)\n        sequence [withObject \"person\"\n            (\\v' \u2192 Person i &lt;$&gt; v' .: \"name\" &lt;*&gt; v' .: \"age\") obj | \n            (i, obj) \u2190 M.toList objs]\n\ntest \u2237 Text\ntest = \"{\\\"bob_id\\\":{\\\"name\\\":\\\"bob\\\",\\\"age\\\":20},\\\"jack_id\\\":{\\\"name\\\":\\\"jack\\\",\\\"age\\\":25}}\"\n\nres \u2237 Maybe [Person]\nres = decode (encodeUtf8 test)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1441753563, "last_edit_date": 1495535397, "creation_date": 1441555722, "answer_id": 32425560, "question_id": 32421836, "link": "https://stackoverflow.com/questions/32421836/aeson-parsing-dynamic-keys-as-type-field/32425560#32425560", "title": "Aeson: parsing dynamic keys as type field", "body": "<p><a href=\"https://stackoverflow.com/a/32422072/1477667\">mniip's answer</a> converts the JSON <code>Object</code> to a <code>Map</code>, which leads to a result list sorted by ID. If you don't need the results sorted in that fashion, it's probably better to use a more direct approach to speed things up. In particular, an <code>Object</code> is really just a <code>HashMap Text Value</code>, so we can use <code>HashMap</code> operations to work with it.</p>\n\n<p>Note that I renamed the <code>id</code> field to <code>ident</code>, because most Haskell programmers will assume that <code>id</code> refers to the identity function in <code>Prelude</code> or to the more general identity arrow in <code>Control.Category</code>.</p>\n\n<pre><code>module Aes where\nimport Control.Applicative\nimport Data.Aeson\nimport Data.Text (Text)\nimport qualified Data.HashMap.Strict as HMS\n\ndata PersonInfo = PersonInfo { infoName :: Text, infoAge :: Int }\n\ninstance FromJSON PersonInfo where\n-- Use mniip's definition here\n\ndata Person = Person { ident :: Text, name :: Text, age :: Int }\n\nnewtype PersonList = PersonList [Person]\n\ninstance FromJSON PersonList where\n  parseJSON (Object v) = PersonList &lt;$&gt; HMS.foldrWithKey go (pure []) v\n    where\n      go i x r = (\\(PersonInfo nm ag) rest -&gt; Person i nm ag : rest) &lt;$&gt;\n                     parseJSON x &lt;*&gt; r\n  parseJSON _ = empty\n</code></pre>\n\n<p>Note that, like <a href=\"https://stackoverflow.com/a/32422275/1477667\">Alexander VoidEx Ruchkin's answer</a>, this sequences the conversion from <code>PersonInfo</code> to <code>Person</code> explicitly within the <code>Parser</code> monad. It would therefore be easy to modify it to produce a parse error if the <code>Person</code> fails some sort of high-level validation. Alexander's answer also demonstrates the utility of the <code>withObject</code> combinator, which I'd have used if I'd known it existed.</p>\n"}], "owner": {"reputation": 2464, "user_id": 1076715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf07aa4cdf24f3a770c21cb26e61bc7f?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1076715/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 670, "favorite_count": 1, "accepted_answer_id": 32422072, "answer_count": 3, "score": 4, "last_activity_date": 1441753563, "creation_date": 1441530450, "question_id": 32421836, "link": "https://stackoverflow.com/questions/32421836/aeson-parsing-dynamic-keys-as-type-field", "title": "Aeson: parsing dynamic keys as type field", "body": "<p>Let's say there is a JSON like:</p>\n\n<pre><code>{\n  \"bob_id\" : {\n    \"name\": \"bob\",\n    \"age\" : 20\n  },\n  \"jack_id\" : {\n    \"name\": \"jack\",\n    \"age\" : 25\n  }\n}\n</code></pre>\n\n<p>Is it possible to parse it to <code>[Person]</code> with <code>Person</code> defined like below?</p>\n\n<pre><code>data Person = Person {\n   id   :: Text\n  ,name :: Text\n  ,age  :: Int\n}\n</code></pre>\n"}, {"tags": ["haskell", "fibonacci"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1441530677, "last_edit_date": 1441530677, "creation_date": 1441530276, "answer_id": 32421814, "question_id": 32421651, "link": "https://stackoverflow.com/questions/32421651/whats-wrong-with-my-fibonacci-implementation/32421814#32421814", "title": "What&#39;s wrong with my Fibonacci implementation?", "body": "<p>Your algorithm is wrong: in <code>y + (x-1) + (x-2)</code> you only add up consecutive numbers - not the numbers in the fib.series.</p>\n\n<p>It seems like you tried some kind of <em>pair-approach</em> (I think) - and yes it's a good idea and can be done like this:</p>\n\n<pre><code>fib :: Int -&gt; Int\nfib k = snd  $ fibIt k (0, 1)\n\nfibIt :: Int -&gt; (Int, Int) -&gt; (Int, Int)\nfibIt 0 x = x\nfibIt k (n,n') = fibIt (k-1) (n',n+n')\n</code></pre>\n\n<p>as you can see: this passes the two needed parts (the last and second-to-last number) around as a pair of numbers and keeps track of the iteration with <code>k</code>.</p>\n\n<p>Then it just gives back the second part of this tuple in <code>fib</code> (if you use  the first you will get <code>0,1,1,2,3,...</code> but of course you can adjust the initial tuple as well if you like (<code>fib k = fst  $ fibIt k (1, 1)</code>).</p>\n\n<hr>\n\n<p>by the way this idea directly leeds to this nice definition of the fib.sequence if you factor the iteration out to <code>iterate</code> ;)</p>\n\n<pre><code>fibs :: [Int]\nfibs = map fst $ iterate next (1,1)\n       where\n         next (n,n') = (n',n+n')\n\nfib :: Int -&gt; Int\nfib k = fibs !! k\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 4969650, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7f06fcfe8b5508d6c4d3d3c82bb73823?s=128&d=identicon&r=PG&f=1", "display_name": "Xeriotek", "link": "https://stackoverflow.com/users/4969650/xeriotek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 32421814, "answer_count": 1, "score": 1, "last_activity_date": 1441530677, "creation_date": 1441528868, "last_edit_date": 1441529868, "question_id": 32421651, "link": "https://stackoverflow.com/questions/32421651/whats-wrong-with-my-fibonacci-implementation", "title": "What&#39;s wrong with my Fibonacci implementation?", "body": "<p>I'm trying to transform my recursive Fibonacci function into an iterative solution. I tried the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fib_itt :: Int -&gt; Int\nfib_itt x = fib_itt' x 0\nwhere\n    fib_itt' 0 y = 0\n    fib_itt' 1 y = y + 1\n    fib_itt' x y = fib_itt' (x-1) (y + ((x - 1) + (x - 2)))\n</code></pre>\n\n<p>I want to save the result into variable <code>y</code> and return it when the <code>x</code> <code>y</code> matches with <code>1</code> <code>y</code>, but it doesn't work as expected. For <code>fib_itt 0</code> and <code>fib_itt 1</code>, it works correctly, but for <code>n &gt; 1</code>, it doesn't work. For example, <code>fib_rek 2</code> returns <code>1</code> and <code>fib_rek 3</code> returns <code>2</code>. </p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441508886, "post_id": 32419598, "comment_id": 52705227, "body": "This is the composition of two relations.  It seems like you are basing the code on a sorted merge, but this is really nothing like merging.  See <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a>.  For more efficiency, convert your lists to <code>Data.Map</code>s, which is closer to what they are representing."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441512768, "post_id": 32419598, "comment_id": 52705881, "body": "Not sure I understand. FYI im a haskell noob. Why should I convert my strucures to <code>Data.Map</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1441514536, "post_id": 32419598, "comment_id": 52706151, "body": "Can you explain just what you mean by &quot;merge&quot;? You gave a small example, but expressing it carefully in words will help."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1441523299, "post_id": 32419598, "comment_id": 52707563, "body": "@luqui It does not look as composition of relations: there&#39;s no <code>hi</code> in the second list, for instance. I fail to understand what the general rule is for this &quot;merge&quot;."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441551908, "post_id": 32419598, "comment_id": 52715176, "body": "Related: <a href=\"http://stackoverflow.com/questions/31298466/populating-a-list-of-tuples-in-a-semantic-way\" title=\"populating a list of tuples in a semantic way\">stackoverflow.com/questions/31298466/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441514356, "post_id": 32420088, "comment_id": 52706120, "body": "The fact that the current code is not tail recursive is not a problem at all. It&#39;s actually quite efficient. The problem is just that it doesn&#39;t do what it should. Haskell&#39;s evaluation is lazy, which means you have to reason about efficiency a bit differently."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441514890, "post_id": 32420088, "comment_id": 52706204, "body": "I think you misunderstood my answer, which was about how to make his solution correct, or I just was unclear.  What he wrote <i>is</i> in fact tail-recursive; it\u2019s just not correct.  But the correct solution is going to involve divide and conquer.  I\u2019ll move that sentence to the end so it\u2019s less confusing a digression."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441515349, "post_id": 32420088, "comment_id": 52706287, "body": "Or actually, I can think of some other approaches that would work equally well."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1441516296, "post_id": 32420088, "comment_id": 52706419, "body": "It doesnt seem like my code discards both x and y. It discards y only if it does not match x. which is the point of the merge, right?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1441516909, "post_id": 32420088, "comment_id": 52706509, "body": "Take another look at the last argument on the right-hand side of the <code>otherwise</code> case.  Where\u2019s <code>y</code>?"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 1, "last_activity_date": 1441514957, "last_edit_date": 1441514957, "creation_date": 1441514045, "answer_id": 32420088, "question_id": 32419598, "link": "https://stackoverflow.com/questions/32419598/algorithm-to-merge-two-lists/32420088#32420088", "title": "Algorithm to merge two lists", "body": "<p>Right now, if the <code>otherwise</code> clause doesn\u2019t match, your code discards both <code>x</code> and <code>y</code>.  It should be trying to merge <code>x</code> with the rest of <code>ys</code>.  Some hints: <code>[x]</code> is a list you can pass to <code>merge</code>, and if you can think of a way to divide and conquer the problem, you can concatenate a pair of lists with <code>++</code>.</p>\n\n<p>The correct solution is going to involve combining the results of different steps, and when you start doing that, the efficient approach is going to be tail-recursion.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1441514957, "creation_date": 1441508405, "question_id": 32419598, "link": "https://stackoverflow.com/questions/32419598/algorithm-to-merge-two-lists", "title": "Algorithm to merge two lists", "body": "<p>I'm trying to merge two lists of tuples, <code>x</code> and <code>y</code>. Basically is I have these lists:</p>\n\n<pre><code>[(\"hello\", \"hi\"), (\"foo\", \"baz\"), (\"this\", \"that\")]\n\n--and\n\n[(\"foo\", \"bar\"), (\"hello\", \"world\"), (\"goo\", \"boo\")]\n\n--the result should be\n\n[(\"hello\", \"world\"), (\"foo\", \"bar\"), (\"this\", \"that\")]\n</code></pre>\n\n<p>I've written this so far:</p>\n\n<pre><code>merge :: (Eq a) =&gt; [(a, b)] -&gt; [(a, b)] -&gt; [(a, b)]\nmerge [] _ = []\nmerge _ [] = []\nmerge (x:xs) (y:ys)\n    | fst x == fst y = (fst y, snd y) : merge xs ys\n    | otherwise = (fst x, snd x) : merge xs ys\n</code></pre>\n\n<p>The problem with this solution is that it only merges that are the same index. How can I efficiently iterate over the second list and merge it into the first?</p>\n"}, {"tags": ["haskell", "continuations", "callcc"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1441505524, "post_id": 32419145, "comment_id": 52704720, "body": "I know you have already read a lot, but this is another excellent resource on that: <a href=\"http://www.haskellforall.com/2012/12/the-continuation-monad.html\" rel=\"nofollow noreferrer\">haskellforall.com/2012/12/the-continuation-monad.html</a>"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1441508961, "post_id": 32419145, "comment_id": 52705240, "body": "Sibi, I like it except there is no mention of callCC. Also, [this][<a href=\"http://www.haskellforall.com/2014/04/how-continuation-monad-works.html]\" rel=\"nofollow noreferrer\">haskellforall.com/2014/04/how-continuation-monad-work&zwnj;&#8203;s.html]</a> was linked and was most edifying."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441514045, "post_id": 32419145, "comment_id": 52706075, "body": "Some of these questions ask &quot;Can I?&quot; Have you tried?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441523402, "post_id": 32419145, "comment_id": 52707580, "body": "Please revise the title as you deem fit (&quot;pieces of the ?&quot;)."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1441546751, "post_id": 32419145, "comment_id": 52713695, "body": "dfeuer, yes and I cannot get it to type check.  Does that mean that it cannot be done or merely that I am not doing it correctly?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1441613229, "post_id": 32419145, "comment_id": 52732493, "body": "You may find <a href=\"http://stackoverflow.com/a/25382352/477476\">this answer</a> useful"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441521746, "post_id": 32420769, "comment_id": 52707286, "body": "You have shown admirable focus in managing to write a sensible answer to <i>fourteen</i> questions. I started two separate drafts, but gave up on both."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441522368, "post_id": 32420769, "comment_id": 52707393, "body": "@duplode To keep it short, I did not really cover all the tricky cases, e.g. when <code>k</code> outlives its own <code>callCC</code>. I guess the OP is interested in those cases, which I dodged a bit."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1441522946, "last_edit_date": 1441522946, "creation_date": 1441521488, "answer_id": 32420769, "question_id": 32419145, "link": "https://stackoverflow.com/questions/32419145/the-contt-monad-putting-the-pieces-together/32420769#32420769", "title": "The ContT Monad: Putting the pieces together", "body": "<blockquote>\n  <ol>\n  <li>What determines the value and type of <code>output</code>?</li>\n  </ol>\n</blockquote>\n\n<p>It will be of the same type as <code>rval</code>. The value will also be the same, unless <code>inner_block</code> uses <code>k someValue</code> to escape the rest of the block. In that case, <code>output</code> will be <code>someValue</code>.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>What does the <code>b</code> mean in the type of <code>k</code>?</li>\n  </ol>\n</blockquote>\n\n<p>Roughly, <code>b</code> can be understood as \"anything at all\". That is, if <code>inner_block</code> is</p>\n\n<pre><code>...\nv &lt;- k someValue\nuse v\n</code></pre>\n\n<p>then <code>v :: b</code>. However, <code>k someValue</code> will never run the rest of the block since it will exit the <code>callCC</code> immediately. So, no concrete value for <code>v</code> will be ever returned. Because of this <code>v</code> can have any type: it does not matter if <code>use</code> requires a <code>String</code> or an <code>Int</code> -- it's not being executed anyway.</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>Where does the value given to <code>k</code> go?</li>\n  </ol>\n</blockquote>\n\n<p>As soon as the inner block runs <code>k someValue</code> the value is returned by the <code>callCC</code> as <code>output</code>, and the rest of the block is skipped.</p>\n\n<blockquote>\n  <ol start=\"4\">\n  <li>When is <code>inner_block</code> run? What version of the state does it see?</li>\n  </ol>\n</blockquote>\n\n<p>It is run as <code>callCC</code> is called, and sees the same state as we had at that point.</p>\n\n<blockquote>\n  <ol start=\"5\">\n  <li>Where does <code>rval</code> go and what its type?</li>\n  </ol>\n</blockquote>\n\n<p>Into <code>output</code>. Same type.</p>\n\n<blockquote>\n  <ol start=\"6\">\n  <li>What is the relationship between <code>k</code> and <code>rval</code>?</li>\n  </ol>\n</blockquote>\n\n<p><code>rval</code> has the same type as the argument of <code>k</code>.</p>\n\n<blockquote>\n  <ol start=\"7\">\n  <li>What happens when I apply <code>k</code> a) in <code>inner_block</code>, b) in <code>after_callcc</code>, c) outside of <code>block</code>?</li>\n  </ol>\n</blockquote>\n\n<p>a) See above.\nb) <code>k</code> is out of scope in <code>after_callcc</code>.\nc) Also out of scope.</p>\n\n<blockquote>\n  <ol start=\"8\">\n  <li>What is the version of the state in each of the above? </li>\n  </ol>\n</blockquote>\n\n<p>The state is the \"current\" one. (I am not sure what you exactly are asking for here)</p>\n\n<blockquote>\n  <ol start=\"9\">\n  <li>What do I need to do to get <code>k</code> out of <code>block</code>?</li>\n  </ol>\n</blockquote>\n\n<p>A recursive type is needed here, I guess. Here's an attempt:</p>\n\n<pre><code>import Control.Monad.Cont\nimport Control.Monad.State\nimport Control.Monad.Trans\n\ntype SomeState = String\ntype MyMonad r = ContT r (State SomeState)\n\nnewtype K a b r = K ((K a b r, a) -&gt; MyMonad r b)\n\nmain = do\n  print $ flip runState \"init\" $ runContT block return\n\nblock :: MyMonad r Int\nblock = do\n  lift $ modify (++ \":start\")\n  (K myK, output) &lt;- callCC $ \\k -&gt; do\n    s &lt;- lift $ get\n    lift $ modify (++ \":inner(\" ++ show (length s) ++\")\")\n    return (K k, 10)\n  lift $ modify (++ \":output=\" ++ show output)\n  s &lt;- lift $ get\n  when (length s &lt;50) $ myK (K myK, output+1)\n  return 5\n</code></pre>\n\n<p>This prints</p>\n\n<pre><code>(5,\"init:start:inner(10):output=10:output=11:output=12\")\n</code></pre>\n\n<blockquote>\n  <ol start=\"10\">\n  <li>Can I put <code>k</code> into the state?</li>\n  </ol>\n</blockquote>\n\n<p>I believe you need a recursive type for that, too.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 4, "accepted_answer_id": 32420769, "answer_count": 1, "score": 11, "last_activity_date": 1441546595, "creation_date": 1441502518, "last_edit_date": 1495540294, "question_id": 32419145, "link": "https://stackoverflow.com/questions/32419145/the-contt-monad-putting-the-pieces-together", "title": "The ContT Monad: Putting the pieces together", "body": "<p><strong>Preamble</strong></p>\n\n<p>I am trying to wrap my head around how to actually use <code>ContT</code> and <code>callCC</code> for something useful. I'm having trouble following information and control flows around the the code. (but, isn't that the point of a continuation?)</p>\n\n<p>There are a lot of different ways to move pieces around with this monad and a small handful of not very straight forward combinators. I will confess that I'm still uncomfortable with my understanding of how ContT works, but I will point to what I have read so far:</p>\n\n<ul>\n<li><a href=\"https://en.wikibooks.org/wiki/Haskell/Continuation_passing_style\" rel=\"noreferrer\">Haskell/Continuation passing style</a></li>\n<li><a href=\"https://stackoverflow.com/questions/3322540/how-and-why-does-the-haskell-cont-monad-work\">How and why does the Haskell Cont monad work?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/20536700/understanding-haskell-callcc-examples/20542256#20542256\">Understanding Haskell callCC examples</a></li>\n<li><a href=\"https://stackoverflow.com/questions/5193876/goto-in-haskell-can-anyone-explain-this-seemingly-insane-effect-of-continuation/5203603#5203603\">Goto in Haskell: Can anyone explain this seemingly insane effect of continuation monad usage?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/20451022/how-to-interpret-callcc-in-haskell\">How to interpret callCC in Haskell?</a></li>\n<li><a href=\"http://www.vex.net/~trebla/haskell/parsec-generally.xhtml\" rel=\"noreferrer\">Parsec Generally</a> (the article that started me down this path)</li>\n</ul>\n\n<p>What I would like to do is post a psudo-code example then ask some questions about it.  This represents the typical look of code using ContT</p>\n\n<p><strong>Psudo-Code</strong></p>\n\n<pre><code>type MyMonad r = ContT r (State SomeState)\n\nmain = do\n  runState s_init $ runContT block print\n\nblock :: MyMonad r a0\nblock = do\n  before_callcc\n  output &lt;- callCC $ \\k -&gt; do\n    rval &lt;- inner_block\n    return rval\n  after_callcc\n</code></pre>\n\n<p><strong>Questions</strong></p>\n\n<ol>\n<li>What determines the value and type of <code>output</code>?</li>\n<li>What does the <code>b</code> mean in the type of <code>k</code>?</li>\n<li>Where does the value given to <code>k</code> go?</li>\n<li>When is <code>inner_block</code> run? What version of the state does it see?</li>\n<li>Where does <code>rval</code> go and what its type?</li>\n<li>What is the relationship between <code>k</code> and <code>rval</code>?</li>\n<li>What happens when I apply <code>k</code> a) in <code>inner_block</code>, b) in <code>after_callcc</code>, c) outside of <code>block</code>?</li>\n<li>What is the version of the state in each of the above? </li>\n<li>What do I need to do to get <code>k</code> out of <code>block</code>?</li>\n<li>Can I put <code>k</code> into the state?</li>\n</ol>\n\n<hr>\n\n<p><strong>Color Coded for easier reading</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/f0PM0.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/f0PM0.png\" alt=\"Color Coded example\"></a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 1542181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e07a5df634f3661427bcb855886cd647?s=128&d=identicon&r=PG", "display_name": "Nol", "link": "https://stackoverflow.com/users/1542181/nol"}, "edited": false, "score": 1, "creation_date": 1441518908, "post_id": 32419092, "comment_id": 52706788, "body": "Thanks! That makes sense. As a follow up question - what would this look like if I did want to provide a base case for empty <code>xs</code>, and define <code>test</code> recursively over the whole list instead of just the head?"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 4, "last_activity_date": 1441501829, "creation_date": 1441501829, "answer_id": 32419092, "question_id": 32418382, "link": "https://stackoverflow.com/questions/32418382/constrain-elements-of-a-type-level-list-in-haskell/32419092#32419092", "title": "Constrain elements of a type-level list in Haskell", "body": "<p>The problem here is that <code>Head</code> does not reduce when fed <code>xs</code> in <code>test</code> so Haskell has no way to deduce <code>KnownSymbol (Head xs)</code> from <code>AllHave KnownSymbol xs</code>. And it shouldn't: what should happen in case <code>xs</code> is empty?</p>\n\n<p>To solve this problem, you can make it explicit that <code>xs</code> is not empty like so:</p>\n\n<pre><code>test :: AllHave KnownSymbol (x ': xs) =&gt; proxy (x ': xs) -&gt; String\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1441509371, "last_edit_date": 1495542121, "creation_date": 1441509371, "answer_id": 32419680, "question_id": 32418382, "link": "https://stackoverflow.com/questions/32418382/constrain-elements-of-a-type-level-list-in-haskell/32419680#32419680", "title": "Constrain elements of a type-level list in Haskell", "body": "<p>I don't know much about type families, so I'll point you to <a href=\"https://stackoverflow.com/a/32419092/1477667\">gallais's answer</a> for an explanation of what went wrong in your code. Here is a very different approach, with a number of demo functions. There might be better ways; I don't know.</p>\n\n<pre><code>data CList :: (k -&gt; Constraint) -&gt; [k] -&gt; * where\n  CNil :: CList c '[]\n  CCons :: c t =&gt; proxy t -&gt; CList c ts -&gt; CList c (t ': ts)\n\nmapCSimple :: (forall a . c a =&gt; Proxy a -&gt; b) -&gt; CList c as -&gt; [b]\nmapCSimple f CNil = []\nmapCSimple f (CCons (t :: proxy t) ts) = f (Proxy :: Proxy t) : mapCSimple f ts\n\ntoStrings :: CList KnownSymbol v -&gt; [String]\ntoStrings = mapCSimple symbolVal\n\nclass KnownSymbols (xs :: [Symbol]) where\n  known :: proxy xs -&gt; CList KnownSymbol xs\n\ninstance KnownSymbols '[] where\n  known _ = CNil\n\ninstance (KnownSymbol x, KnownSymbols xs) =&gt; KnownSymbols (x ': xs) where\n  known _ = CCons Proxy $ known Proxy\n\nexampleG :: KnownSymbols xs =&gt; proxy xs -&gt; String\nexampleG p = show . toStrings $ known p\n</code></pre>\n\n<p>This gives</p>\n\n<pre><code>&gt; putStrLn $ exampleG (Proxy :: Proxy '[\"Hello\", \"Darkness\"])\n[\"Hello\",\"Darkness\"]\n</code></pre>\n\n<p>To get something more like what you sought,</p>\n\n<pre><code>cHead :: CList c (a ': as) -&gt; Dict (c a)\ncHead (CCons prox _) = Dict\n\ntest :: forall x xs . CList KnownSymbol (x ': xs) -&gt; String\ntest xs = case cHead xs of Dict -&gt; symbolVal (Proxy :: Proxy x)\n\ntest2 :: (KnownSymbols xs, xs ~ (y ': ys)) =&gt; proxy xs -&gt; String\ntest2 prox = test (known prox)\n</code></pre>\n\n<p>This gets</p>\n\n<pre><code>&gt; putStrLn $ test2 (Proxy :: Proxy '[\"Hello\", \"Darkness\"])\nHello\n</code></pre>\n\n<p>And here's another fun function:</p>\n\n<pre><code>data HList :: (k -&gt; *) -&gt; [k] -&gt; * where\n  HNil :: HList f '[]\n  HCons :: f a -&gt; HList f as -&gt; HList f (a ': as)\n\nmapC :: (forall a . c a =&gt; Proxy a -&gt; f a) -&gt; CList c as -&gt; HList f as\nmapC f CNil = HNil\nmapC f (CCons (t :: proxy t) ts) = HCons (f (Proxy :: Proxy t)) (mapC f ts)\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 1542181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e07a5df634f3661427bcb855886cd647?s=128&d=identicon&r=PG", "display_name": "Nol", "link": "https://stackoverflow.com/users/1542181/nol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 2, "accepted_answer_id": 32419092, "answer_count": 2, "score": 2, "last_activity_date": 1441509371, "creation_date": 1441493204, "question_id": 32418382, "link": "https://stackoverflow.com/questions/32418382/constrain-elements-of-a-type-level-list-in-haskell", "title": "Constrain elements of a type-level list in Haskell", "body": "<p>I'm trying to write a type family I can use to constrain the elements of a type level list. I have this code:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, DataKinds, TypeOperators, TypeFamilies #-}\n\nimport GHC.TypeLits (KnownSymbol, symbolVal)\nimport GHC.Exts (Constraint)\nimport Data.Proxy (Proxy(..))\n\ntype family AllHave (c :: k -&gt; Constraint) (xs :: [k]) :: Constraint\ntype instance AllHave c '[] = ()\ntype instance AllHave c (x ': xs) = (c x, AllHave c xs)\n\ntype family Head (xs :: [k]) :: k where\n    Head (x ': xs) = x\n\nheadProxy :: proxy xs -&gt; Proxy (Head xs)\nheadProxy _ = Proxy\n\ntest :: AllHave KnownSymbol xs =&gt; proxy xs -&gt; String\ntest p = symbolVal (headProxy p)\n\nmain :: IO ()\nmain = putStrLn $ test (Proxy :: Proxy '[\"a\", \"b\"])\n</code></pre>\n\n<p>From what I understand this should work, but when I compile ghc spits out this:</p>\n\n<pre><code>Test.hs:18:10:\n    Could not deduce (KnownSymbol (Head xs))\n      arising from a use of \u2018symbolVal\u2019\n    from the context (AllHave KnownSymbol xs)\n      bound by the type signature for\n                 test :: AllHave KnownSymbol xs =&gt; proxy xs -&gt; String\n      at Test.hs:17:9-52\n    In the expression: symbolVal (headProxy p)\n    In an equation for \u2018test\u2019: test p = symbolVal (headProxy p)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441496361, "post_id": 32417881, "comment_id": 52703531, "body": "I was able to compile this one but not @Andr&#225;sKov&#225;cs, I&#39;m not sure what I&#39;m doing wrong."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441497545, "post_id": 32417881, "comment_id": 52703720, "body": "I was able to the other answer to <i>compile</i> - haven&#39;t tried running it: <a href=\"http://lpaste.net/140367\" rel=\"nofollow noreferrer\">lpaste.net/140367</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1441488719, "creation_date": 1441488719, "answer_id": 32417881, "question_id": 32417542, "link": "https://stackoverflow.com/questions/32417542/how-do-you-create-a-function-like-data-vector-modify-that-receives-a-list/32417881#32417881", "title": "How do you create a function like &quot;Data.Vector.modify&quot;, that receives a list?", "body": "<p>This works for me:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes #-}\n\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as MV\nimport Control.Monad.ST\n\nvmods :: [ forall s. ( V.MVector s a -&gt; ST s () ) ] -&gt; V.Vector a  -&gt; V.Vector a\nvmods [] v = v\nvmods (m:ms) v = vmods ms $ V.modify m v\n\nm1 v = MV.write v 0 'x'\nm2 v = MV.write v 1 'y'\nm3 v = MV.write v 2 'z'\n\ntest = vmods [m1,m2,m3] $ V.replicate 3 'a'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1441493120, "post_id": 32418044, "comment_id": 52702964, "body": "Is it actually possible to <i>call</i> that function? I would think the best approach would be the usual <code>newtype</code> trick, using a list of <code>newtype Modifier = Modifier (forall s . MV.MVector s Int -&gt; ST s ())</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441494545, "post_id": 32418044, "comment_id": 52703219, "body": "Not being able to call map sounds really bad."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441496264, "post_id": 32418044, "comment_id": 52703514, "body": "I wasn&#39;t able to compile a test for @Andr&#225;sKov&#225;cs example, but the Modifier trick works."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 1, "last_activity_date": 1441490027, "creation_date": 1441490027, "answer_id": 32418044, "question_id": 32417542, "link": "https://stackoverflow.com/questions/32417542/how-do-you-create-a-function-like-data-vector-modify-that-receives-a-list/32418044#32418044", "title": "How do you create a function like &quot;Data.Vector.modify&quot;, that receives a list?", "body": "<p>When type checking, GHC only ever instantiates type variables with monomorphic types. Since <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>, this already rules out your intended usage, since <code>a</code> would have to be instantiated to <code>forall s. MVector s a -&gt; ST s ()</code>, and that can't happen. This is one reason why <code>ImpredicativeTypes</code> is barely usable with GHC. </p>\n\n<p>Since we'cant use the usual higher-order flow control functions, we have to write out an explicit recursive function:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nunsafeModify :: [(forall s . MV.MVector s Int -&gt; ST s ())] -&gt; V.Vector Int -&gt; V.Vector Int\nunsafeModify mods vec = runST $ do\n  (mvec :: MV.MVector s Int) &lt;- V.unsafeThaw vec\n\n  let go :: [(forall s . MV.MVector s Int -&gt; ST s ())] -&gt; ST s (V.Vector Int)\n      go [] = V.unsafeFreeze mvec\n      go (mod:mods) = do\n        mod mvec\n        go mods\n\n  go mods\n</code></pre>\n\n<p><code>ScopedTypeVariables</code> is also necessary, because we want the <code>s</code> in the return type of <code>go</code> to be the same <code>s</code> with which we bind <code>mvec</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1441500219, "creation_date": 1441500219, "answer_id": 32418965, "question_id": 32417542, "link": "https://stackoverflow.com/questions/32417542/how-do-you-create-a-function-like-data-vector-modify-that-receives-a-list/32418965#32418965", "title": "How do you create a function like &quot;Data.Vector.modify&quot;, that receives a list?", "body": "<p>The usual trick is to box up your functions, thus:</p>\n\n<pre><code>data Box a = Box { unBox :: forall s. MVector s a -&gt; ST s () }\nmodifyAll :: [Box a] -&gt; Vector a -&gt; Vector a\nmodifyAll fs = modify (\\mvector -&gt; mapM_ (\\b -&gt; unBox b mvector) fs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441550188, "post_id": 32420472, "comment_id": 52714683, "body": "This idea was on the tip of my brain, but then I got confused. Excellent."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441553923, "post_id": 32420472, "comment_id": 52715778, "body": "This doesn&#39;t seem to work too, <a href=\"http://lpaste.net/140402\" rel=\"nofollow noreferrer\">lpaste.net/140402</a> ... edit: works with additional annotation on <code>fns</code>"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1441557132, "last_edit_date": 1441557132, "creation_date": 1441518580, "answer_id": 32420472, "question_id": 32417542, "link": "https://stackoverflow.com/questions/32417542/how-do-you-create-a-function-like-data-vector-modify-that-receives-a-list/32420472#32420472", "title": "How do you create a function like &quot;Data.Vector.modify&quot;, that receives a list?", "body": "<p>Change the type of <code>unsafeModify</code>. In particular, float the <code>forall s.</code> outside of the list. You want all your functions to share the same state token (which is determined by <code>runST</code>), therefore you don't need to have every function potentially using <em>another</em> <code>s</code>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport qualified Data.Vector.Mutable as MV\nimport qualified Data.Vector as V\nimport Control.Monad (mapM_)\nimport Control.Monad.ST\nimport Control.Monad.Primitive\n\nunsafeModify :: (forall s . [MV.MVector s Int -&gt; ST s ()]) -&gt; V.Vector Int -&gt; V.Vector Int\nunsafeModify mods vec = runST $ do\n    mvec &lt;- V.unsafeThaw vec\n    mapM_ ($ mvec) mods\n    V.unsafeFreeze mvec\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 32420472, "answer_count": 4, "score": 2, "last_activity_date": 1441557132, "creation_date": 1441486171, "question_id": 32417542, "link": "https://stackoverflow.com/questions/32417542/how-do-you-create-a-function-like-data-vector-modify-that-receives-a-list", "title": "How do you create a function like &quot;Data.Vector.modify&quot;, that receives a list?", "body": "<p>Data.Vector has the following function:</p>\n\n<pre><code>modify :: (forall s. MVector s a -&gt; ST s ()) -&gt; Vector a -&gt; Vector a\n</code></pre>\n\n<p>Is it possible to create a function such as:</p>\n\n<pre><code>modify :: [(forall s. MVector s a -&gt; ST s ())] -&gt; Vector a -&gt; Vector a\n</code></pre>\n\n<p>I've tried</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes #-}\n\nimport qualified Data.Vector.Mutable as MV\nimport qualified Data.Vector as V\nimport Control.Monad.ST\nimport Control.Monad.Primitive\n\nunsafeModify :: [(forall s . MV.MVector s Int -&gt; ST s ())] -&gt; V.Vector Int -&gt; V.Vector Int\nunsafeModify mods vec = runST $ do\n    mvec &lt;- V.unsafeThaw vec\n    sequence_ (map ($ mvec) mods)\n    V.unsafeFreeze mvec\n</code></pre>\n\n<p>But I get the error</p>\n\n<pre><code>Muts.hs:11:28:\n    Couldn't match type \u2018forall s1. V.MVector s1 Int -&gt; ST s1 ()\u2019\n                  with \u2018V.MVector s Int -&gt; ST s a0\u2019\n    Expected type: [V.MVector s Int -&gt; ST s a0]\n      Actual type: [forall s. V.MVector s Int -&gt; ST s ()]\n    Relevant bindings include\n      mvec :: V.MVector s Int (bound at Muts.hs:10:5)\n    In the second argument of \u2018map\u2019, namely \u2018mods\u2019\n    In the first argument of \u2018sequence\u2019, namely \u2018(map ($ mvec) mods)\u2019\n</code></pre>\n"}, {"tags": ["haskell", "impredicativetypes"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1441486563, "post_id": 32417521, "comment_id": 52701544, "body": "What error does the second one give?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1441486620, "post_id": 32417521, "comment_id": 52701558, "body": "Question updated. Sorry."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 7, "creation_date": 1441486692, "post_id": 32417521, "comment_id": 52701571, "body": "Basically due to the <code>forall</code> Rank2Type in your list. <code>$</code> has the (explicit) type <code>forall a b. (a -&gt; b) -&gt; a -&gt; b</code>, and <code>(a -&gt; b)</code> isn&#39;t compatible to <code>forall s. MV.Vector s Int -&gt; St s ()</code>. See <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/explicit-forall#rankntypes--rank2types--and-polymorphiccomponents\" rel=\"nofollow noreferrer\">this article</a> for a quick overview of RankNTypes."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1441492031, "post_id": 32417521, "comment_id": 52702739, "body": "<code>ImpredicativeTypes</code> doesn&#39;t actually work. If GHC suggests using it, don&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441519643, "post_id": 32420455, "comment_id": 52706903, "body": "The <code>????</code> part begs the question: why doesn&#39;t GHC instantiate the <code>s</code> in the polytype for <code>(mods !! 0)</code> to be the same as the (rigid) <code>s</code> in the type of <code>($ mvec)</code>? After all, when we do <code>(+) (length []) 10</code> the polytype of <code>10</code> gets instantiated correctly to <code>Int</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441549986, "post_id": 32420455, "comment_id": 52714623, "body": "<code>$</code> gets its own special case in the type checker."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1441518709, "last_edit_date": 1441518709, "creation_date": 1441518391, "answer_id": 32420455, "question_id": 32417521, "link": "https://stackoverflow.com/questions/32417521/why-does-this-equivalent-program-not-compile/32420455#32420455", "title": "Why does this equivalent program not compile?", "body": "<p><sub>Note: This post is written in literate Haskell. You can save it as Unsafe.lhs and try it in your GHCi.</sub></p>\n\n<hr>\n\n<p>Let's compare the types of the different lines:</p>\n\n<pre><code> mods                ::     [(forall s . MV.MVector s Int -&gt; ST s ())]\n(mods !! 0)          ::      (forall s . MV.MVector s Int -&gt; ST s ())\n(mods !! 0)  mvec    ::       forall s. ST s ()\n\n\n($ mvec)             ::     (MV.Vector s Int -&gt; b) -&gt; b\n         (mods !! 0) ::     (forall s . MV.MVector s Int -&gt; ST s ())\n($ mvec) (mods !! 0) ::     ????????????????????????\n</code></pre>\n\n<p>They aren't equivalent due to <code>$</code>'s type:</p>\n\n<pre><code>($) :: forall a b. (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>Whereas you would need something along</p>\n\n<pre><code>($)  :: (a ~ (forall s . MV.MVector s Int -&gt; ST s ())) =&gt;\n      (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>which isn't legal.</p>\n\n<p>However, let's have a look at what you actually want to do.</p>\n\n<pre><code>&gt; {-# LANGUAGE RankNTypes #-}\n\n&gt; import qualified Data.Vector.Mutable as MV\n&gt; import qualified Data.Vector as V\n&gt; import Control.Monad.ST\n&gt; import Control.Monad.Primitive\n\n  unsafeModify :: ??? -&gt; V.Vector Int -&gt; V.Vector Int\n\n&gt; unsafeModify mods vec = runST $ do\n&gt;   mvec &lt;- V.unsafeThaw vec\n&gt;   mapM_ ($ mvec) (mods !! 0)\n&gt;   V.unsafeFreeze mvec\n</code></pre>\n\n<p>Things got messy due to <code>unsafeModify</code>'s polymorphic first argument <code>mods</code>. Your original type</p>\n\n<pre><code>[(forall s . MV.MVector s Int -&gt; ST s ())]\n</code></pre>\n\n<p>tells us it is a list of functions, where every function is polymorphic the parameter <code>s</code>, so every function <em>could use another <code>s</code></em>. However, that's too much. It's fine if the <code>s</code> gets shared throuhgout the whole list:</p>\n\n<pre><code>(forall s. [MV.MVector s Int -&gt; ST s ()])\n</code></pre>\n\n<p>After all, we want to use all functions in the same <code>ST</code> computation, therefore the type of the stream state token <code>s</code> can be the same. We end up with</p>\n\n<pre><code>&gt; unsafeModify :: (forall s. [MV.MVector s Int -&gt; ST s ()]) -&gt; V.Vector Int -&gt; V.Vector Int\n</code></pre>\n\n<p>And now your code happily compiles, regardless of whether you use <code>($ mvec) (mods !! 0)</code>, <code>(mods !! 0) mvec</code> or <code>mapM_</code>, because <code>s</code> is now correctly fixed by <code>runST</code> throughout the whole list.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1441519710, "last_edit_date": 1441519710, "creation_date": 1441519316, "answer_id": 32420544, "question_id": 32417521, "link": "https://stackoverflow.com/questions/32417521/why-does-this-equivalent-program-not-compile/32420544#32420544", "title": "Why does this equivalent program not compile?", "body": "<p>(This should probably be a comment, but I need more space.)</p>\n\n<p>Sadly, impredicative types do not work very well in GHC, as @dfeuer pointed out.\nConsider this example:</p>\n\n<pre><code>{-# LANGUAGE ImpredicativeTypes, PartialTypeSignatures #-}\nimport qualified Data.Vector.Mutable as MV\nimport Control.Monad.ST\n\n-- myIndex :: [forall s. MV.MVector s Int -&gt; ST s ()] \n--         -&gt; Int\n--         -&gt; (forall s. MV.MVector s Int -&gt; ST s ())\nmyIndex = (!!) :: [forall s. MV.MVector s Int -&gt; ST s ()] -&gt; Int -&gt; _\n</code></pre>\n\n<p>It compiles successfully, albeit with a warning due to the type hole:</p>\n\n<pre><code>VectorTest.hs:9:69: Warning:\n    Found hole \u2018_\u2019 with type: forall s. MV.MVector s Int -&gt; ST s ()\n    Relevant bindings include\n      myIndex :: [forall s. MV.MVector s Int -&gt; ST s ()]\n                 -&gt; Int -&gt; forall s. MV.MVector s Int -&gt; ST s ()\n        (bound at VectorTest.hs:9:1)\n</code></pre>\n\n<p>We could try to remove the <code>PartialTypeSignatures</code> extension and fill the hole with its type <code>forall s. MV.MVector s Int -&gt; ST s ()</code>. But this fails horribly:</p>\n\n<pre><code>VectorTest.hs:9:11:\n    Couldn't match type \u2018forall s2. MV.MVector s2 Int -&gt; ST s2 ()\u2019\n                   with \u2018MV.MVector s1 Int -&gt; ST s1 ()\u2019\n    Expected type: [forall s. MV.MVector s Int -&gt; ST s ()]\n                   -&gt; Int -&gt; MV.MVector s1 Int -&gt; ST s1 ()\n      Actual type: [MV.MVector s1 Int -&gt; ST s1 ()]\n                   -&gt; Int -&gt; MV.MVector s1 Int -&gt; ST s1 ()\n</code></pre>\n\n<p>The last <code>forall</code> gets hoisted to the top-level, and now GHC infers that the first argument of <code>(!!)</code> must a be a list of monomorphic elements <code>[MV.MVector s1 Int -&gt; ST s1 ()]</code> <em>despite</em> our annotation! Basically, GHC has two choices:</p>\n\n<pre><code>-- Note the hoisted forall s1\nmyIndex = (!!) :: forall s1. [forall s. MV.MVector s Int -&gt; ST s ()] -&gt; Int \n               -- ^ first choice for instantiating the type of (!!)\n               -&gt; MV.MVector s1 Int -&gt; ST s1 ()\n               -- ^ second choice\n</code></pre>\n\n<p>GHC chooses the second, and fails. Only with a partial type signature I was able to remove the second choice so that GHC was forced to do the right thing.</p>\n\n<p>If only we had explicit type application like in GHC Core, we could have written <code>(!!) @ (forall s. ...)</code>, but alas we have not.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 32420455, "answer_count": 2, "score": 8, "last_activity_date": 1441529693, "creation_date": 1441486029, "last_edit_date": 1441529693, "question_id": 32417521, "link": "https://stackoverflow.com/questions/32417521/why-does-this-equivalent-program-not-compile", "title": "Why does this equivalent program not compile?", "body": "<p>This program:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes #-}\n\nimport qualified Data.Vector.Mutable as MV\nimport qualified Data.Vector as V\nimport Control.Monad.ST\nimport Control.Monad.Primitive\n\nunsafeModify :: [(forall s . MV.MVector s Int -&gt; ST s ())] -&gt; V.Vector Int -&gt; V.Vector Int\nunsafeModify mods vec = runST $ do\n    mvec &lt;- V.unsafeThaw vec\n    (mods !! 0) mvec\n    V.unsafeFreeze mvec\n</code></pre>\n\n<p>Compiles. This program:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes #-}\n\nimport qualified Data.Vector.Mutable as MV\nimport qualified Data.Vector as V\nimport Control.Monad.ST\nimport Control.Monad.Primitive\n\nunsafeModify :: [(forall s . MV.MVector s Int -&gt; ST s ())] -&gt; V.Vector Int -&gt; V.Vector Int\nunsafeModify mods vec = runST $ do\n    mvec &lt;- V.unsafeThaw vec\n    ($ mvec) (mods !! 0)\n    V.unsafeFreeze mvec\n</code></pre>\n\n<p>Does not compile with the following error:</p>\n\n<pre><code>Muts.hs:10:15:\n    Couldn't match type \u2018forall s1. UV.MVector s1 Int -&gt; ST s1 ()\u2019\n                  with \u2018UV.MVector s Int -&gt; ST s a0\u2019\n    Expected type: [UV.MVector s Int -&gt; ST s a0]\n      Actual type: [forall s. UV.MVector s Int -&gt; ST s ()]\n    Relevant bindings include\n      mvec :: UV.MVector s Int (bound at Muts.hs:9:5)\n    In the first argument of \u2018(!!)\u2019, namely \u2018mods\u2019\n    In the first argument of \u2018$ mvec\u2019, namely \u2018(mods !! 0)\u2019\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["haskell", "haddock", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441485301, "post_id": 32417076, "comment_id": 52701219, "body": "<code>--install-ghc --no-system-ghc</code> made it work, but I don&#39;t know why - as far as I can tell I have the docs for <code>base</code> and the other packages installed with the global GHC. I installed GHC and stack together using MinGHC 2015-08-13 64-bit. Any idea why this would cause this problem?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441507590, "post_id": 32417076, "comment_id": 52705040, "body": "No, I don&#39;t know off hand what would be causing it. I&#39;ll have a look at the MinGHC release."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441511685, "post_id": 32417076, "comment_id": 52705676, "body": "It looks like there&#39;s a problem with the MinGHC installer. In order to get more details, I&#39;ll need to ask more questions than the comment field here is amenable to. Can you open up an issue of MinGHC&#39;s Github issue tracker?"}, {"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 2, "creation_date": 1461457571, "post_id": 32417076, "comment_id": 61208270, "body": "This is a pretty old thread but I ran into this same thing. The fix is to install the ghc-doc package (available in most package managers)."}, {"owner": {"reputation": 468, "user_id": 1266963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1051036e07e42ee389b4d255645115?s=128&d=identicon&r=PG", "display_name": "Yuri Syro", "link": "https://stackoverflow.com/users/1266963/yuri-syro"}, "reply_to_user": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 0, "creation_date": 1469615541, "post_id": 32417076, "comment_id": 64607246, "body": "@mrenaud thank you! it is very difficult to conclude this from error report."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1441482613, "creation_date": 1441482613, "answer_id": 32417076, "question_id": 32416942, "link": "https://stackoverflow.com/questions/32416942/why-am-i-getting-build-plan-errors-running-stack-haddock-when-stack-test-wor/32417076#32417076", "title": "Why am I getting build plan errors running &quot;stack haddock&quot; when &quot;stack test&quot; works?", "body": "<p>A guess: you're using a GHC install that does not include documentation, or at least not as stack expects it to be discovered. Can you try with \"--install-ghc --no-system-ghc\"? I may have the specific flag names wrong.</p>\n\n<p>Also, how is GHC installed on your system?</p>\n"}, {"tags": [], "owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "is_accepted": false, "score": 2, "last_activity_date": 1476025943, "creation_date": 1476025943, "answer_id": 39945117, "question_id": 32416942, "link": "https://stackoverflow.com/questions/32416942/why-am-i-getting-build-plan-errors-running-stack-haddock-when-stack-test-wor/39945117#39945117", "title": "Why am I getting build plan errors running &quot;stack haddock&quot; when &quot;stack test&quot; works?", "body": "<p>I solved this by installing the <code>ghc-doc</code> package (available in most package managers).</p>\n"}], "owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 32417076, "answer_count": 2, "score": 2, "last_activity_date": 1476025943, "creation_date": 1441481466, "last_edit_date": 1495541211, "question_id": 32416942, "link": "https://stackoverflow.com/questions/32416942/why-am-i-getting-build-plan-errors-running-stack-haddock-when-stack-test-wor", "title": "Why am I getting build plan errors running &quot;stack haddock&quot; when &quot;stack test&quot; works?", "body": "<p>I'm creating a new Haskell project using Stack 0.1.3.1 on Windows 8. My <code>stack.yaml</code> file looks like this:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>flags: {}\npackages:\n- 'lazy-engine'\nextra-deps: []\nresolver: lts-3.4\n</code></pre>\n\n<p>When I run <code>stack build</code> or <code>stack test</code>, everything works beautifully. I can run <code>haddock</code> manually from the command line and that works, too. But when I run <code>stack haddock</code> I get output like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Setting codepage to UTF-8 (65001) to ensure correct output from GHC\nNOTE: the haddock command is functionally equivalent to 'build --haddock'\nWhile constructing the BuildPlan the following exceptions were encountered:\n\n--  Failure when adding dependencies:\n      base: needed (&gt;=4.5 &amp;&amp; &lt;4.9), latest is 4.8.1.0, but not present in build plan\n    needed for package: array-0.5.1.0\n\n--  While attempting to add dependency,\n    Could not find package base in known packages\n\n--  Failure when adding dependencies:\n      array: needed (-any), latest is 0.5.1.0, but couldn't resolve its dependencies\n      base: needed (&gt;=4.2 &amp;&amp; &lt;5), latest is 4.8.1.0, but not present in build plan\n      deepseq: needed (&gt;=1.2 &amp;&amp; &lt;1.5), latest is 1.4.1.2, but couldn't resolve its dependencies\n      ghc-prim: needed (-any), latest is 0.4.0.0, but not present in build plan\n    needed for package: containers-0.5.6.2\n\n--  Failure when adding dependencies:\n      array: needed (&gt;=0.3 &amp;&amp; &lt;0.6), latest is 0.5.1.0, but couldn't resolve its dependencies\n      base: needed (==4.3.* || &gt;=4.5 &amp;&amp; &lt;4.9), latest is 4.8.1.0, but not present in build plan\n    needed for package: deepseq-1.4.1.1\n\n--  While attempting to add dependency,\n    Could not find package ghc-prim in known packages\n\n--  Failure when adding dependencies:\n      base: needed (&gt;=4.7 &amp;&amp; &lt;5), latest is 4.8.1.0, but not present in build plan\n      containers: needed (==0.5.*), latest is 0.5.6.3, but couldn't resolve its dependencies\n    needed for package: lazy-engine-0.1.0.0\n\nRecommended action: try adding the following to your extra-deps in \n    C:\\Users\\Aaron\\Documents\\GitHub\\lazy-engine\\stack.yaml\n- base-4.8.1.0\n- ghc-prim-0.4.0.0\n\nYou may also want to try the 'stack solver' command\n</code></pre>\n\n<p>Obviously this is nonsense&mdash;I shouldn't have to add <code>base</code> to my <code>extra-deps</code>, especially since I'm working off an LTS package set! What is going on here?</p>\n\n<p><strong>Update:</strong> As discussed in <a href=\"https://stackoverflow.com/a/32417076/925960\">the answer below</a>, this seems to have been a bug in stack and should be fixed in newer versions. See <a href=\"https://github.com/fpco/minghc/issues/85\" rel=\"nofollow noreferrer\">https://github.com/fpco/minghc/issues/85</a>.</p>\n"}, {"tags": ["haskell", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1441481175, "creation_date": 1441481175, "answer_id": 32416901, "question_id": 32416537, "link": "https://stackoverflow.com/questions/32416537/cleaning-up-after-a-scotty-application-is-terminated/32416901#32416901", "title": "Cleaning up after a Scotty application is terminated", "body": "<p>The simplest principled way probably is using <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception.html#v:bracket\" rel=\"nofollow\"><code>bracket</code></a> from <code>Control.Exception</code>:</p>\n\n<pre><code>main = bracket acquireSock cleanupSock $ \\(sock, _) -&gt; do\n    listen sock maxListenQueue\n    scottySocket def sock $ do\n        ...\n    where\n    -- Acquiring the resource.\n    acquireSock = do\n        sock &lt;- socket AF_UNIX Stream 0\n        let sockPath = \"/tmp/my_app.sock\"\n        bind sock $ SockAddrUnix sockPath\n        return (sock, sockPath)\n    -- Releasing the resource.\n    cleanupSock (sock, sockPath) = do\n        removeFile sockPath\n        close sock\n</code></pre>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 32416901, "answer_count": 1, "score": 0, "last_activity_date": 1441481175, "creation_date": 1441478738, "question_id": 32416537, "link": "https://stackoverflow.com/questions/32416537/cleaning-up-after-a-scotty-application-is-terminated", "title": "Cleaning up after a Scotty application is terminated", "body": "<p>I have a Scotty application that listens on a Unix socket. I\u2019d like the application to delete the socket when it exits (i.e. when I type <kbd>Ctrl</kbd>-<kbd>C</kbd>), but I\u2019m not sure how to accomplish this. My <code>main</code> function looks like</p>\n\n<pre><code>main = do\n    sock &lt;- socket AF_UNIX Stream 0\n    bind sock $ SockAddrUnix \"/tmp/my_app.sock\"\n    listen sock maxListenQueue\n\n    scottySocket def sock $ do\n        ...\n\n    removeFile \"/tmp/my_app.sock\"\n</code></pre>\n\n<p>When I type <kbd>Ctrl</kbd>-<kbd>C</kbd> the <code>removeFile</code> function is not called\u2014that seems to be an interrupt that the Scotty framework does not or cannot catch. Is there any way to perform cleanup actions like this?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "is_accepted": true, "score": 8, "last_activity_date": 1441470532, "creation_date": 1441470532, "answer_id": 32415296, "question_id": 32415186, "link": "https://stackoverflow.com/questions/32415186/cannot-set-up-servant-app-using-stack-could-not-find-module-servant/32415296#32415296", "title": "Cannot set up servant app using stack - &quot;Could not find module \u2018Servant\u2019&quot;", "body": "<p>The <code>Servant</code> module comes from <em>servant-server</em>, as you can see <a href=\"http://hackage.haskell.org/package/servant-server\" rel=\"noreferrer\">here</a> in the module list. The handy <code>Servant</code> module reexports everything from the <em>servant</em> package (which has all the types to describe web APIs) as well as the key things for running servant web apps.</p>\n\n<p>Long story short: you need to add the <em>servant-server</em> package to your dependencies as well.</p>\n"}], "owner": {"reputation": 1376, "user_id": 11409, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2095818e4949d637dfe6024a0319e0a6?s=128&d=identicon&r=PG", "display_name": "mcveat", "link": "https://stackoverflow.com/users/11409/mcveat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1068, "favorite_count": 0, "accepted_answer_id": 32415296, "answer_count": 1, "score": 5, "last_activity_date": 1441470532, "creation_date": 1441469747, "question_id": 32415186, "link": "https://stackoverflow.com/questions/32415186/cannot-set-up-servant-app-using-stack-could-not-find-module-servant", "title": "Cannot set up servant app using stack - &quot;Could not find module \u2018Servant\u2019&quot;", "body": "<p>I'm trying to set up basic project using servant and stack loosely following official <a href=\"http://haskell-servant.github.io/tutorial/server.html\" rel=\"noreferrer\">servant tutorial</a> and <a href=\"https://github.com/commercialhaskell/stack/blob/master/GUIDE.md\" rel=\"noreferrer\">stack guide</a>. As soon as I add <code>import Servant</code> stack build fails with:</p>\n\n<pre><code>Could not find module \u2018Servant\u2019\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p>I've defined <code>servant</code> as a dependency of this module and stack noticed it as <code>stack dependencies</code> shows:</p>\n\n<pre><code>aeson 0.8.0.2\narray 0.5.1.0\nattoparsec 0.12.1.6\nbase 4.8.1.0\nbinary 0.7.5.0\nblaze-builder 0.4.0.1\nbytestring 0.10.6.0\nbytestring-conversion 0.3.1\ncase-insensitive 1.2.0.4\ncontainers 0.5.6.2\ndeepseq 1.4.1.1\ndlist 0.7.1.2\ndouble-conversion 2.0.1.0\nghc-prim 0.4.0.0\nhashable 1.2.3.3\nhttp-media 0.6.2\nhttp-types 0.8.6\ninteger-gmp 1.0.0.0\nmtl 2.2.1\nnetwork-uri 2.6.0.3\nparsec 3.1.9\nprimitive 0.6\nscientific 0.3.3.8\nservant 0.4.4.2\nstring-conversions 0.4\nsyb 0.5.1\ntemplate-haskell 2.10.0.0\ntext 1.2.1.3\ntforia-products 0.1.0.0\ntime 1.5.0.1\ntransformers 0.4.2.0\nunordered-containers 0.2.5.1\nutf8-string 1.0.1.1\nvector 0.10.12.3\n</code></pre>\n\n<p>Code of module:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule API\n    ( ProductAPI\n    , apiServer\n    ) where\n\nimport Data.Aeson\nimport GHC.Generics\nimport Servant\n\ndata Product = Product\n  { id :: String\n  , name :: String\n  } deriving (Eq, Show, Generic)\n\ninstance ToJSON Product\n\nproducts :: [Product]\nproducts =\n  [ Product \"id123\" \"shoes of some guy\"\n  , Product \"id234\" \"hat of some gal\"\n  ]\n\ntype ProductAPI = \"products\" :&gt; Get '[JSON] [Product]\n\napiServer :: Server UserAPI\napiServer = return products\n</code></pre>\n\n<p>Cabal definition of module:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     API\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , servant\n                     , aeson\n  default-language:    Haskell2010\n</code></pre>\n\n<p>I have no idea where else I have to define that dependency so stack/cabal is able to pick it up.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1441469202, "post_id": 32414922, "comment_id": 52696879, "body": "Irrelevant to your problem, but I&#39;d look into guards. They&#39;d make your function much cleaner (subjectively)."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1441478073, "post_id": 32414922, "comment_id": 52699334, "body": "I would also advocate for guards (<code>rec x | x &gt; 50 = x - 5</code>) and then I would suggest you also explain what you expect the function to return, because to me it seems working correctly."}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1441468757, "creation_date": 1441468757, "answer_id": 32415043, "question_id": 32414922, "link": "https://stackoverflow.com/questions/32414922/simple-recursion-in-haskell/32415043#32415043", "title": "Simple Recursion in Haskell", "body": "<p>For <code>x &lt;= 50</code>, your function is equivalent to:</p>\n\n<pre><code>rec' x = if x `mod` 5 == 0\n         then 50\n         else 45 + x `mod` 5\n</code></pre>\n\n<p>This can be checked by running a simple test:</p>\n\n<pre><code>all (\\ x -&gt; rec x == rec' x) [0..50]\n</code></pre>\n\n<p>As a consequence, you need to feed an input which is not a multiple of 5 to get an answer distinct from 50.</p>\n"}], "owner": {"reputation": 51, "user_id": 4159184, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7511cf8c0f3788979ab7bef261a51319?s=128&d=identicon&r=PG&f=1", "display_name": "user53073", "link": "https://stackoverflow.com/users/4159184/user53073"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1441487921, "creation_date": 1441468045, "last_edit_date": 1441487921, "question_id": 32414922, "link": "https://stackoverflow.com/questions/32414922/simple-recursion-in-haskell", "title": "Simple Recursion in Haskell", "body": "<p>I am trying to understand recursion in Haskell. I want to write a simple recursive function with the following properties: if <code>x &gt; 50</code> then <code>rec(x) = x - 5</code> and <code>rec(x) = rec(rec(x+10))</code> otherwise.\nThis is what I came up with:</p>\n\n<pre><code>rec x = if x &gt; 50\n    then x-5\n    else rec (rec (x+10))\n</code></pre>\n\n<p>The not recursive part seems to work fine, but the recursion doesn't. Every number less than 50 just return 50. For example <code>rec 60 = 55</code> <code>rec 40 = 50</code> <code>rec 25 = 50</code> </p>\n\n<p>Any suggestions on how to fix my code would be appreciated. </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441468043, "post_id": 32414751, "comment_id": 52696593, "body": "Why do you want this? Are some of those <code>Maybe</code>s supposed to be <code>Just</code>s?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441469589, "post_id": 32414751, "comment_id": 52696978, "body": "To clarify what @dfeuer is saying... why do you want to have a list containing both <code>RowF Identify</code> and <code>RowF Maybe</code> values? Show us some example code you would like to write if you could construct such a list."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1441586542, "last_edit_date": 1441586542, "creation_date": 1441471893, "answer_id": 32415519, "question_id": 32414751, "link": "https://stackoverflow.com/questions/32414751/how-can-you-put-these-two-datatypes-rowf-maybe-and-maybe-rowf-identity-in/32415519#32415519", "title": "How can you put these two datatypes: `RowF Maybe` and `Maybe (RowF Identity)` into the same List?", "body": "<p>There's a couple solutions.</p>\n\n<p>You could use <code>Either</code> to wrap the two types:</p>\n\n<pre><code>ghci&gt; let rm = RowF (Just \"hello\") Nothing :: RowF Maybe\nghci&gt; let mr = Just (RowF (Identity \"world\") (Identity 12.3)) :: Maybe Row\nghci&gt; :t [ Left rm, Right mr ]\n[ Left rm, Right mr ] :: [ Either (RowF Maybe) (Maybe Row) ]\n</code></pre>\n\n<p>Alternately, you could create some functions to convert back and forth</p>\n\n<pre><code>toRow :: Applicative f =&gt; RowF f -&gt; f Row\ntoRow (RowF fs fd) = (\\s d -&gt; RowF (Identity s) (Identity d)) &lt;$&gt; fs &lt;*&gt; fd\n\nfromRow :: Functor f =&gt; f Row -&gt; RowF f\nfromRow fr = RowF (runIdentity . rsidf &lt;$&gt; fr) (runIdentity . rtimef &lt;$&gt; fr)\n</code></pre>\n\n<p>Then just convert to one type to the other as needed.</p>\n\n<pre><code>ghci&gt; :t [ rm, fromRow mr ]\n[ rm, fromRow mr ] :: [RowF Maybe]\nghci&gt; :t [ toRow rm, mr ]\n[ toRow rm, mr ] :: [Maybe Row]\n</code></pre>\n\n<p>Alternately, you could create a wrapper that wraps all <code>RowF f</code>, and use that:</p>\n\n<pre><code>ghci&gt; :set -XRankNTypes -XConstraintKinds -XExistentialQuantification\nghci&gt; data RowC c = forall f. RowC { runRowC :: c f =&gt; RowF f }\nghci&gt; let ri = RowF (Identity \"world\") (Identity 12.3) :: Row \nghci&gt; :t [ RowC rm, RowC ri ] :: [ RowC Monad ]\n[ RowC rm, RowC ri ] :: [ RowC Monad ] :: [RowC Monad]\n</code></pre>\n\n<p>The drawback of this approach is once you convert a <code>RowF f</code> to a <code>RowC c</code>, you can't convert back, and you can't do anything\nwith the value outside of the operations defined by the constraint <code>c</code>.</p>\n\n<p>That last suggestion you got, to define</p>\n\n<pre><code>convert :: (forall x. f x -&gt; g x) -&gt; RowF f -&gt; RowF g\nconvert f2g (RowF fs fd) = RowF (f2g fs) (f2g fd)\n</code></pre>\n\n<p>Would allow you to convert from <code>Row</code> to <code>RowF Maybe</code> easily.</p>\n\n<pre><code>ghci&gt; :t convert (Just . runIdentity) ri\nconvert (Just . runIdentity) ri :: RowF Maybe\n</code></pre>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 32415519, "answer_count": 1, "score": 1, "last_activity_date": 1441586542, "creation_date": 1441466846, "question_id": 32414751, "link": "https://stackoverflow.com/questions/32414751/how-can-you-put-these-two-datatypes-rowf-maybe-and-maybe-rowf-identity-in", "title": "How can you put these two datatypes: `RowF Maybe` and `Maybe (RowF Identity)` into the same List?", "body": "<p>I have the following data types:</p>\n\n<pre><code>data RowF f = RowF { rsidf      :: f String\n                    , rtimef    :: f Double\n                   }\n\ntype Row    = RowF Identity\n\n\nrealizeRow :: RowF Maybe -&gt; Maybe Row\n</code></pre>\n\n<p>And I would like to have a list of both <code>Row</code> and <code>RowF Maybe</code>. That is to say I might have:</p>\n\n<pre><code>[RowF (Maybe \"hello\") Nothing, Maybe (RowF \"world\" 12.3)]\n</code></pre>\n\n<p>Someone suggested I should implement some function:</p>\n\n<pre><code>f :: (forall x. f x -&gt; g x) -&gt; RowF f -&gt; RowF g\n</code></pre>\n\n<p>But I am not sure what this is meant to do or how to implement it. </p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1441543452, "post_id": 32414121, "comment_id": 52712672, "body": "Due to the <a href=\"http://stackoverflow.com/q/11070690/791604\">nature of imprecise exceptions</a>, seeing that <code>f undefined</code> throws a different error than <code>undefined</code> is <i>not</i> good evidence that <code>f</code> is lazy. Even with <code>f x = x `seq` error &quot;bad&quot;</code>, a compiler is allowed to throw the &quot;bad&quot; exception instead of the one you get from <code>x</code> -- in a pinch, any old exception you have lying around will do."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441561429, "post_id": 32414121, "comment_id": 52718144, "body": "Thanks, I&#39;ve changed it to just return the string &quot;bad&quot;."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 3, "last_activity_date": 1441561400, "last_edit_date": 1441561400, "creation_date": 1441462893, "answer_id": 32414121, "question_id": 32414032, "link": "https://stackoverflow.com/questions/32414032/evaluation-or-none-at-all-of-function-argument/32414121#32414121", "title": "Evaluation (or none at all) of `_` Function Argument?", "body": "<p>No, the argument of <code>f</code> is not evaluated. An easy way to test this is to use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:undefined\" rel=\"nofollow\"><code>undefined</code></a>, which will throw an error as soon as it's touched:</p>\n\n<pre><code>&gt;&gt;&gt; undefined\n*** Exception: Prelude.undefined\n\n&gt;&gt;&gt; let f _ = \"bad\"\n\n&gt;&gt;&gt; f undefined\n\"bad\"\n</code></pre>\n\n<p>but you can write a similar function that does evaluate its argument to WHNF using <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:seq\" rel=\"nofollow\"><code>seq</code></a>:</p>\n\n<pre><code>&gt;&gt;&gt; let g a = a `seq` \"bad\"\n&gt;&gt;&gt; g undefined\n\"*** Exception: Prelude.undefined\n</code></pre>\n\n<p>or <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/bang-patterns.html\" rel=\"nofollow\"><code>BangPatterns</code></a>:</p>\n\n<pre><code>&gt;&gt;&gt; :set -XBangPatterns \n&gt;&gt;&gt; let h !_ = \"bad\"\n&gt;&gt;&gt; h undefined \n\"*** Exception: Prelude.undefined\n</code></pre>\n\n<p>or pattern match:</p>\n\n<pre><code>&gt;&gt;&gt; let k (Foo _) = \"bad\"\n&gt;&gt;&gt; k undefined \n\"*** Exception: Prelude.undefined\n</code></pre>\n\n<p>but you can do a <a href=\"https://wiki.haskell.org/Lazy_pattern_match\" rel=\"nofollow\">lazy pattern match</a> using <code>~</code>:</p>\n\n<pre><code>&gt;&gt;&gt; let j ~(Foo _) = \"bad\"\n&gt;&gt;&gt; j undefined \n\"bad\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": false, "score": 1, "last_activity_date": 1441463121, "creation_date": 1441463121, "answer_id": 32414152, "question_id": 32414032, "link": "https://stackoverflow.com/questions/32414032/evaluation-or-none-at-all-of-function-argument/32414152#32414152", "title": "Evaluation (or none at all) of `_` Function Argument?", "body": "<pre><code>Prelude&gt; let f _ = error(\"bad!\")\n</code></pre>\n\n<p>Haskell is <a href=\"http://www.seas.upenn.edu/~cis194/fall14/spring13/lectures/06-laziness.html\" rel=\"nofollow\">lazy</a>, the <code>_</code>param is not evaluated at all.</p>\n\n<blockquote>\n  <p>The slogan to remember is \u201cpattern matching drives evaluation\u201d. To\n  reiterate the important points:</p>\n\n<pre><code>Expressions are only evaluated when pattern-matched\n\n\u2026only as far as necessary for the match to proceed, and no farther!\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 4, "last_activity_date": 1441463224, "creation_date": 1441463224, "answer_id": 32414171, "question_id": 32414032, "link": "https://stackoverflow.com/questions/32414032/evaluation-or-none-at-all-of-function-argument/32414171#32414171", "title": "Evaluation (or none at all) of `_` Function Argument?", "body": "<p>The function \"f\" never evaluates its argument, as you say. This has nothing to do with whether the argument is an instance of \"Show\".</p>\n\n<p>You could also say</p>\n\n<pre><code>Prelude&gt; let f2 _ = \"Some value\"\n\nPrelude&gt; f2 (Foo 5)\n\"Some value\"\n</code></pre>\n\n<p>But the real point is that even if the argument to f2 is undefined it will not be evaluated, and so will not throw an exception</p>\n\n<pre><code>Prelude&gt; f2 undefined\n\"Some value\"\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 32414171, "answer_count": 3, "score": 2, "last_activity_date": 1441561400, "creation_date": 1441462315, "question_id": 32414032, "link": "https://stackoverflow.com/questions/32414032/evaluation-or-none-at-all-of-function-argument", "title": "Evaluation (or none at all) of `_` Function Argument?", "body": "<p>Given the data type, <code>Foo</code>:</p>\n\n<pre><code>Prelude&gt; data Foo a = Foo a\n</code></pre>\n\n<p>It does not implement <code>Show</code>, so it can't be printed.</p>\n\n<pre><code>Prelude&gt; Foo 5\n&lt;interactive&gt;:13:1:\n    No instance for (Show (Foo a0)) arising from a use of \u2018print\u2019\n</code></pre>\n\n<p>However, given a function that always throws:</p>\n\n<pre><code>Prelude&gt; let f _ = error(\"bad!\")\n</code></pre>\n\n<p><code>f</code> can be applied to it. </p>\n\n<pre><code>Prelude&gt; f (Foo 5)\n*** Exception: bad!\n</code></pre>\n\n<p>Since <code>f</code> always throws for its single argument, does that mean that its argument is never evaluated, not even to Weak Head Normal Form?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1441486490, "last_edit_date": 1441486490, "creation_date": 1441467101, "answer_id": 32414792, "question_id": 32413797, "link": "https://stackoverflow.com/questions/32413797/implementing-mymonad-free-f/32414792#32414792", "title": "Implementing `MyMonad Free f`", "body": "<p>In these kinds of situations, <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/typed-holes.html\" rel=\"nofollow\">typed holes</a> can help with how to proceed. They give information about the type the still unimplemented \"hole\" should have.</p>\n\n<p>Using a typed hole instead of <code>error</code> in your definition:</p>\n\n<pre><code>instance Functor f =&gt; MyMonad (Free f) where\n    ret                 = Var\n    flatMap (Var x)  g  = f x\n    flatMap (Node xs) g = _\n</code></pre>\n\n<p>Gives an error message like (here simplified):</p>\n\n<pre><code>Found hole `_' with type: Free f b\n...\nRelevant bindings include\n  g :: a -&gt; Free f b (bound at Main.hs:10:21)\n  xs :: f (Free f a) (bound at Main.hs:10:17)\n  flatMap :: Free f a -&gt; (a -&gt; Free f b) -&gt; Free f b\n    (bound at Main.hs:9:3)\n</code></pre>\n\n<p>That <code>Free f b</code> in the hole... which constructor should it have? <code>Var</code> or <code>Node</code>?</p>\n\n<p>Now, a value of type <code>Free a</code> is like a tree that has values of type <code>a</code> on the leaves (the <code>Var</code> constructor) and whose branching nodes are \"shaped\" by the functor <code>f</code>.</p>\n\n<p>What is <code>&gt;&gt;=</code> for <code>Free</code>? Think of it as taking a tree and \"grafting\" new trees on each of its leaves. These new trees are constructed from the values in the leaves using the function that is passed to <code>&gt;&gt;=</code>.</p>\n\n<p>This helps us continue: now we know that the constructor on the right of the   <code>flatMap (Node xs) f = _</code> pattern must be <code>Node</code>, because \"grafting\" new things onto the tree never collapses already existing nodes into leaves, it only expands leaves into whole new trees.</p>\n\n<p>Still using type holes:</p>\n\n<pre><code>instance Functor f =&gt; MyMonad (Free f) where\n    ret                 = Var\n    flatMap (Var x)  g  = f x\n    flatMap (Node xs) g = Node _\n\nFound hole `_' with type: f (Free f b)\n...\nRelevant bindings include\ng :: a -&gt; Free f b (bound at Main.hs:10:21)\nxs :: f (Free f a) (bound at Main.hs:10:17)\n</code></pre>\n\n<p>In <code>xs</code> we have a <code>Free f a</code> wrapped in a <code>f</code>, but <code>f</code> is a functor and we could easily map over it.</p>\n\n<p>But how to convert that <code>Free f a</code> into the <code>Free f b</code> required by the hole? Intuitively, this <code>Free f a</code> will be \"smaller\" that the one the <code>&gt;&gt;=</code> started with, because we have stripped one \"branching node\". Maybe it is even a leaf node, like the case covered by the other pattern-match! This suggests using recursion of some kind.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1441476838, "last_edit_date": 1592644375, "creation_date": 1441473091, "answer_id": 32415691, "question_id": 32413797, "link": "https://stackoverflow.com/questions/32413797/implementing-mymonad-free-f/32415691#32415691", "title": "Implementing `MyMonad Free f`", "body": "<p>Start by implementing the <code>Functor</code> instance. Then note that in general, a monad can be described as a functor that supports <code>return</code> and <code>join :: m (m a) -&gt; m a</code>. Can you see how to implement <code>join</code> using <code>=&lt;&lt;</code> and <code>return</code>? Can you see how to implement <code>=&lt;&lt;</code> using <code>fmap</code> and <code>join</code>?</p>\n<h3>Spoilers</h3>\n<p>As you indicated,</p>\n<pre><code>data Free f a = Var a | Node (f (Free f a))\n</code></pre>\n<p>So (as you could work out with typed holes)</p>\n<pre><code>join :: Functor f =&gt; Free f (Free f a) -&gt; Free f a\njoin (Var a) = a\njoin (Node m) = Node (fmap join m)\n</code></pre>\n<p>It might be useful to think about the geometry here. We descend the tree recursively, leaving the structure the same, until we get to the leaves, which we unwrap.</p>\n<p>Note: <code>=&lt;&lt;</code> is the flipped version of <code>&gt;&gt;=</code>; it's more consistent with the other composition operators. <code>$</code>, <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code>, <code>.</code>, <code>=&lt;&lt;</code>, and <code>&lt;=&lt;</code> all match up so you can read an expression using them from left to right or right to left without having to switch directions a few times in the middle.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 32414792, "answer_count": 2, "score": 0, "last_activity_date": 1441486490, "creation_date": 1441460931, "last_edit_date": 1495539843, "question_id": 32413797, "link": "https://stackoverflow.com/questions/32413797/implementing-mymonad-free-f", "title": "Implementing `MyMonad Free f`", "body": "<p>Typeclassopedia defines the <code>Free monad</code> data type. </p>\n\n<blockquote>\n  <p>data Free f a = Var a\n                 | Node (f (Free f a)) </p>\n</blockquote>\n\n<p>Given:</p>\n\n<pre><code>class (MyMonad m) where\n    ret     :: a         -&gt; m a\n    flatMap :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Here's my incomplete attempt at implementing the <code>MyMonad</code> instance of this typeclass.</p>\n\n<pre><code>instance Functor f =&gt; MyMonad (Free f) where\n  ret                 = Var\n  flatMap (Var x)  f  = f x \n  flatMap (Node xs) f = error\n</code></pre>\n\n<p>Please help me reason about what <code>&gt;&gt;=</code>/binding means over a <code>Free</code> monad. </p>\n\n<p>When I struggled with <a href=\"https://stackoverflow.com/questions/27527703/implementing-applicative-free-f\">implementing</a> <code>Applicative (Free f)</code>, I was encouraged to try to implement the <code>Monad</code> instance.</p>\n"}, {"tags": ["haskell", "io", "keyboard"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441468396, "post_id": 32413329, "comment_id": 52696672, "body": "You will get better answers if you give more context--what is your ultimate objective?"}, {"owner": {"reputation": 69, "user_id": 4394101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6542fcf97a0ec1a98baf00fb17958818?s=128&d=identicon&r=PG&f=1", "display_name": "scholar guy", "link": "https://stackoverflow.com/users/4394101/scholar-guy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469767591, "post_id": 32413329, "comment_id": 64683346, "body": "well, unfortunately, I think it&#39;s just pointless"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4394101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6542fcf97a0ec1a98baf00fb17958818?s=128&d=identicon&r=PG&f=1", "display_name": "scholar guy", "link": "https://stackoverflow.com/users/4394101/scholar-guy"}, "edited": false, "score": 0, "creation_date": 1441458247, "post_id": 32413354, "comment_id": 52693896, "body": "Sorry, but this is a little different, I actually reupdated the question to clarify it, but thank you"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1441484957, "post_id": 32413354, "comment_id": 52701131, "body": "The first version could also be written as <code>fmap swap getChar</code>"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 3, "last_activity_date": 1441485428, "last_edit_date": 1441485428, "creation_date": 1441458131, "answer_id": 32413354, "question_id": 32413329, "link": "https://stackoverflow.com/questions/32413329/how-to-swap-keyboard-chars-in-haskell/32413354#32413354", "title": "How to swap keyboard chars in haskell", "body": "<p>You can't modify <code>getChar</code>. However, you can do something like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; let swap :: Char -&gt; Char; swap 'b' = 'a'; swap c = c\nPrelude&gt; fmap swap getChar\nb'a'\n</code></pre>\n\n<p>If you want to delete the character <code>b</code> and replace it with the character <code>a</code> then you could do:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let getChar' :: IO Char;\nPrelude|     getChar' = do\nPrelude|         c &lt;- getChar\nPrelude|         if c == 'b'\nPrelude|             then do\nPrelude|                 putChar '\\b' -- delete the previous character\nPrelude|                 putChar 'a'  -- write a new character\nPrelude|                 return 'a'\nPrelude|             else return c\nPrelude| :}\nPrelude&gt; getChar'\na'a'              -- I typed in `a'\nPrelude&gt; getChar'\na'a'              -- I typed in `b'\nPrelude&gt; getChar'\nc'c'              -- I typed in `c'\n</code></pre>\n\n<p>More succinctly:</p>\n\n<pre><code>Prelude&gt; let replace c = putChar '\\b' &gt;&gt; putChar c &gt;&gt; return c\nPrelude&gt; let swap 'b' = replace 'a'; swap c = return c\nPrelude&gt; getChar &gt;&gt;= swap\na'a'                      -- I typed in `a'\nPrelude&gt; getChar &gt;&gt;= swap\na'a'                      -- I typed in `b'\nPrelude&gt; getChar &gt;&gt;= swap\nc'c'                      -- I typed in `c'\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 69, "user_id": 4394101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6542fcf97a0ec1a98baf00fb17958818?s=128&d=identicon&r=PG&f=1", "display_name": "scholar guy", "link": "https://stackoverflow.com/users/4394101/scholar-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441485428, "creation_date": 1441457875, "last_edit_date": 1441458149, "question_id": 32413329, "link": "https://stackoverflow.com/questions/32413329/how-to-swap-keyboard-chars-in-haskell", "title": "How to swap keyboard chars in haskell", "body": "<p>I want to change the charaters keys shown on the input of the I/O operation.\nFor example, let's say the key <code>'b'</code> is swapped to <code>'a'</code>, \n  then I want this result:\n  if I type the key <strong>b</strong>, I will get <strong>a</strong> </p>\n\n<pre><code>Prelude&gt; getChar\na   -- I actually typed the key b\n'a' \n</code></pre>\n\n<p>Thank you! </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1441458120, "post_id": 32413164, "comment_id": 52693854, "body": "Not directly related to your question, but see also <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO-Error.html#v:catchIOError\" rel=\"nofollow noreferrer\"><code>catchIOError</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "is_accepted": false, "score": 2, "last_activity_date": 1441463808, "last_edit_date": 1441463808, "creation_date": 1441462880, "answer_id": 32414117, "question_id": 32413164, "link": "https://stackoverflow.com/questions/32413164/how-to-use-catch/32414117#32414117", "title": "How to use catch", "body": "<p>Answering my own question, I first tried</p>\n\n<pre><code>(\\(e :: IOException) ...\n</code></pre>\n\n<p>and found that to do that you need to turn on <code>-XScopedTypeVariables</code>, and this is somewhat deprecated. Then I realised that the lambda expression is just that, an expression, and therefore you can apply a type specification to it:</p>\n\n<pre><code>-- checks if file is readable\ncheckFileAccess :: FilePath -&gt; IO Bool\ncheckFileAccess f = do\n  catch (fileAccess f True False False)\n        ((\\_ -&gt; return False) :: IOException -&gt; IO Bool)\n</code></pre>\n\n<p>This is a solution. And very elegant. Haskell always astonishes me with its deep coherence.</p>\n\n<p>Having said that, I feel the code to do this check is somehow not idiomatic Haskell. Is there a better way to do this check and deal with IO exceptions?</p>\n"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1441463808, "creation_date": 1441456840, "question_id": 32413164, "link": "https://stackoverflow.com/questions/32413164/how-to-use-catch", "title": "How to use catch", "body": "<p>The documentation on catch seems scanty, and examples few. I am trying to handle the case where a file check fails due to the file being non-existent. If you do not refer to the argument of the lambda in the body of the lambda with a type qualification the code will not compile (that is remove the let which does nothing). Why not?</p>\n\n<pre><code>-- checks if file is readable\ncheckFileAccess :: FilePath -&gt; IO Bool\ncheckFileAccess f = do\n  catch (fileAccess f True False False)\n            (\\e -&gt; do\n               let _ = e :: IOException\n               return False)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 1, "creation_date": 1441454649, "post_id": 32412743, "comment_id": 52692897, "body": "You don&#39;t say what functions are denoted by <code>inc</code> and <code>suc</code>, they&#39;re not standard Haskell. From the context, it is clear that <code>inc x</code> must be <code>x + 1</code> and <code>suc x</code> = <code>x - 1</code>. I would suggest to call that last function <code>pred</code> (predecessor) rather than <code>suc</code> which suggests &quot;successor&quot;  (like the function <code>succ</code> from the Standard Prelude)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1441455864, "post_id": 32412743, "comment_id": 52693231, "body": "What have you tried? You should post your own attempts to show some effort before asking people to hand you a solution to your exercise / homework."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1441458060, "post_id": 32412743, "comment_id": 52693833, "body": "I&#39;m voting to close this question as off-topic because it looks like homework and the OP hasn&#39;t posted any attempt."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1441468741, "post_id": 32412743, "comment_id": 52696776, "body": "Seconding the homework closed; This is a follow up to a question the op posted yesterday and in both cases there was clearly no effort on the ops side involved."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1441454984, "last_edit_date": 1441454984, "creation_date": 1441454883, "answer_id": 32412877, "question_id": 32412743, "link": "https://stackoverflow.com/questions/32412743/i-already-have-an-add-function-how-can-i-use-it-in-multiplication-function/32412877#32412877", "title": "I already have an add function how can I use it in multiplication function?", "body": "<p>The basic implementation is:</p>\n\n<pre><code>mul x 0 = 0\nmul x y = add x (mul x (y - 1))\n</code></pre>\n\n<p>you would need to replace <code>y - 1</code> with your decrement function (which is oddly named <code>suc</code>). Also this does not work for negative multipliers, but you can play with it.</p>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441483515, "post_id": 32414805, "comment_id": 52700783, "body": "what about <code>exp Zero Zero</code> :)?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441485503, "post_id": 32414805, "comment_id": 52701271, "body": "@JakubDaniel Anything raised to zero is one."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 2, "creation_date": 1441487491, "post_id": 32414805, "comment_id": 52701771, "body": "Except <code>0</code>. See <a href=\"http://www.wolframalpha.com/input/?i=0%5E0\" rel=\"nofollow noreferrer\">wolframalpha</a>. But I understand why it is not such a big deal, but still."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 3, "last_activity_date": 1441467227, "creation_date": 1441467227, "answer_id": 32414805, "question_id": 32412743, "link": "https://stackoverflow.com/questions/32412743/i-already-have-an-add-function-how-can-i-use-it-in-multiplication-function/32414805#32414805", "title": "I already have an add function how can I use it in multiplication function?", "body": "<p>If we define the natural numbers as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Nat where\n    Zero :: Nat        -- 0\n    Succ :: Nat -&gt; Nat -- \\n -&gt; n + 1\n</code></pre>\n\n<p>Then, we can define <code>add</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>add :: Nat -&gt; Nat -&gt; Nat\nadd n Zero     = n              -- n + 0 = n\nadd n (Succ m) = Succ (add n m) -- n + (m + 1) = (n + m) + 1\n</code></pre>\n\n<p>Next, we can define <code>mul</code> in terms of <code>add</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mul :: Nat -&gt; Nat -&gt; Nat\nmul n Zero     = Zero            -- n * 0 = 0\nmul n (Succ m) = add (mul n m) n -- n * (m + 1) = (n * m) + n\n</code></pre>\n\n<p>Similarly, we can define <code>exp</code> in terms of <code>mul</code>:</p>\n\n<pre><code>exp :: Nat -&gt; Nat -&gt; Nat\nexp n Zero     = Succ Zero       -- n ^ 0 = 1\nexp n (Succ m) = mul (exp n m) n -- n ^ (m + 1) = (n ^ m) * n\n</code></pre>\n\n<p>Notice a pattern here? This is known as <a href=\"https://en.wikipedia.org/wiki/Primitive_recursive_function\" rel=\"nofollow\">primitive recursion</a>.</p>\n"}], "owner": {"reputation": 79, "user_id": 2874977, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/90536e68c617ddc3dda445a05abffcd4?s=128&d=identicon&r=PG&f=1", "display_name": "user2874977", "link": "https://stackoverflow.com/users/2874977/user2874977"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 648, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1441467227, "creation_date": 1441453900, "question_id": 32412743, "link": "https://stackoverflow.com/questions/32412743/i-already-have-an-add-function-how-can-i-use-it-in-multiplication-function", "title": "I already have an add function how can I use it in multiplication function?", "body": "<p>So far I have the definitions for n-1 and n+1 with suc and inc respectively</p>\n\n<pre><code>add x y | y &gt; 0 = add (inc x) (suc y)\nadd x y | y &lt; 0 = add (suc x) (inc y)\nadd x 0 = x\nadd 0 y = y\n</code></pre>\n\n<p>How can I use this in my multiplication function using only recursion, if-then and no +, -, etc</p>\n\n<p>I know that the result of x * y is equal to adding y to the result of (x-1) * y</p>\n\n<p>But I just don't know how I can put it into the code. Thanks.</p>\n"}, {"tags": ["haskell", "emacs", "haskell-mode"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441453946, "post_id": 32412063, "comment_id": 52692706, "body": "Based on <a href=\"https://github.com/haskell/haskell-mode/blob/master/haskell-indentation.el\" rel=\"nofollow noreferrer\">the source</a> it looks like <code>2</code> is hardcoded in the file."}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1441605321, "post_id": 32412063, "comment_id": 52728680, "body": "@gallais Thx for your reply. I guess for the time being, I have to edit the source code directly then. Can you post this as an answer, so that I can acccept it?"}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 3, "last_activity_date": 1441619547, "creation_date": 1441619547, "answer_id": 32435748, "question_id": 32412063, "link": "https://stackoverflow.com/questions/32412063/customize-indentation-width-in-haskell-indentation-mode/32435748#32435748", "title": "Customize indentation width in haskell-indentation mode", "body": "<p>Based on <a href=\"https://github.com/haskell/haskell-mode/blob/master/haskell-indentation.el\" rel=\"nofollow\">the source</a> of <code>haskell-indentation</code>, it looks like <code>2</code> is hardcoded in the file so you'll have to edit it manually.</p>\n"}, {"comments": [{"owner": {"reputation": 1598, "user_id": 1509394, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d888a2c6f57b1e63cbd2eea151c112b?s=128&d=identicon&r=PG", "display_name": "Martinsos", "link": "https://stackoverflow.com/users/1509394/martinsos"}, "edited": false, "score": 0, "creation_date": 1563921706, "post_id": 32611854, "comment_id": 100859155, "body": "Worked great for me! I adjusted haskell-indentation-where-pre-offset and haskell-indentation-where-post-offset to 2 though, to achieve slightly different behaviour for where, but this is certainly the best solution I found."}], "tags": [], "owner": {"reputation": 568, "user_id": 1867082, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/582ce4225fd51413e5758c795263759b?s=128&d=identicon&r=PG&f=1", "display_name": "Gracjan Polak", "link": "https://stackoverflow.com/users/1867082/gracjan-polak"}, "is_accepted": false, "score": 6, "last_activity_date": 1506006448, "last_edit_date": 1506006448, "creation_date": 1442414643, "answer_id": 32611854, "question_id": 32412063, "link": "https://stackoverflow.com/questions/32412063/customize-indentation-width-in-haskell-indentation-mode/32611854#32611854", "title": "Customize indentation width in haskell-indentation mode", "body": "<p><code>haskell-indentation-mode</code> offers a couple of knobs you can turn to customize indentation offsets:</p>\n\n<pre><code>haskell-indentation-layout-offset\nhaskell-indentation-starter-offset\nhaskell-indentation-left-offset\nhaskell-indentation-ifte-offset\nhaskell-indentation-where-pre-offset\nhaskell-indentation-where-post-offset\n</code></pre>\n\n<p>All of those are customization variables so you can do <code>M-x customize-option RET</code> and customize any of those, or if you prefer programatically:</p>\n\n<pre><code>(custom-set-variables\n ;; Customization related to indentation.\n '(haskell-indentation-layout-offset 4)\n '(haskell-indentation-starter-offset 4)\n '(haskell-indentation-left-offset 4)\n '(haskell-indentation-where-pre-offset 4)\n '(haskell-indentation-where-post-offset 4)\n )\n</code></pre>\n"}], "owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 737, "favorite_count": 0, "accepted_answer_id": 32435748, "answer_count": 2, "score": 4, "last_activity_date": 1506006448, "creation_date": 1441449310, "question_id": 32412063, "link": "https://stackoverflow.com/questions/32412063/customize-indentation-width-in-haskell-indentation-mode", "title": "Customize indentation width in haskell-indentation mode", "body": "<p>I am currently using Emacs as my primary IDE for developing Haskell code and I am really satisfied so far. But at the moment I can't figure out one little detail, namely how to customize the indentation width to be 4 instead of 2.</p>\n\n<p>Currently I have turned on the <code>haskell-indentation</code> in <code>haskell-mode</code>, but I can't figure out what variable I have to set to customize the indentation width.\nSo far I have tried to set <code>'(haskell-indent-spaces 4)</code> but this doesn't seem to have any effect at all...</p>\n\n<p>Thx in advance for any help!</p>\n"}, {"tags": ["haskell", "memory", "memory-leaks"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441419459, "post_id": 32408862, "comment_id": 52685604, "body": "Arbitrary guess: does removing the <code>commit c</code> make a difference?"}, {"owner": {"reputation": 61, "user_id": 5302628, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sw2FnQBMVYI/AAAAAAAAAAI/AAAAAAAAsOM/uaikrZ9KqPc/photo.jpg?sz=128", "display_name": "Byron Hillis", "link": "https://stackoverflow.com/users/5302628/byron-hillis"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441420293, "post_id": 32408862, "comment_id": 52685722, "body": "No, the commit c doesn&#39;t make a difference at all. Also using a quickQuery&#39; instead of getTables causes the same memory leak."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 5302628, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sw2FnQBMVYI/AAAAAAAAAAI/AAAAAAAAsOM/uaikrZ9KqPc/photo.jpg?sz=128", "display_name": "Byron Hillis", "link": "https://stackoverflow.com/users/5302628/byron-hillis"}, "is_accepted": true, "score": 1, "last_activity_date": 1442567893, "creation_date": 1442567893, "answer_id": 32648322, "question_id": 32408862, "link": "https://stackoverflow.com/questions/32408862/haskell-hdbc-odbc-memory-leak/32648322#32648322", "title": "Haskell HDBC-ODBC Memory Leak?", "body": "<p>The issue was in the hdbc-odbc library. A new version v2.5 is available from the Git repo but the hdbc library also needs to be patched to work.</p>\n\n<p>More details available at <a href=\"https://github.com/hdbc/hdbc-odbc/issues/20\" rel=\"nofollow\">this bug report</a>.</p>\n"}], "owner": {"reputation": 61, "user_id": 5302628, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sw2FnQBMVYI/AAAAAAAAAAI/AAAAAAAAsOM/uaikrZ9KqPc/photo.jpg?sz=128", "display_name": "Byron Hillis", "link": "https://stackoverflow.com/users/5302628/byron-hillis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 32648322, "answer_count": 1, "score": 5, "last_activity_date": 1442567893, "creation_date": 1441418896, "question_id": 32408862, "link": "https://stackoverflow.com/questions/32408862/haskell-hdbc-odbc-memory-leak", "title": "Haskell HDBC-ODBC Memory Leak?", "body": "<p>When using the Haskell HDBC-ODBC library to connect to a Microsoft SQL Server I am experiencing a bad memory leak.</p>\n\n<pre><code>import           Database.HDBC        \nimport qualified Database.HDBC.ODBC   as ODBC\nimport           Control.Monad\n\n-- | Main application.\nmain :: IO ()\nmain = dbTest\n\ndbTest :: IO ()\ndbTest = do\n    let connStr = \"DSN=TESTDB;Uid=sa;Pwd=password\"\n    conn &lt;- ODBC.connectODBC connStr\n    replicateM_ 20000 (loop conn)\n    disconnect conn\n  where\n    loop c = do\n        result &lt;- getTables c\n        commit c\n        putStrLn $ show result\n</code></pre>\n\n<p>Running the heap profiler gives me constant memory usage but Window reports memory increasing to almost 100MB of usage.</p>\n\n<p><a href=\"http://i.stack.imgur.com/YkUTW.png\">http://i.stack.imgur.com/YkUTW.png</a></p>\n\n<p>To me this seems like the memory leak is in the Foreign Function interface of the ODBC driver, but this is my first time profiling code so I can't be certain. Does anyone have any further insight or suggestions for a fix? Calling System.Mem.performGC in the loop to try and clean up has no effect.</p>\n\n<p>Are there any alternatives to using HDBC-ODBC? If not, I might need to learn F#.</p>\n"}, {"tags": ["haskell", "esqueleto"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1441417751, "post_id": 32408156, "comment_id": 52685344, "body": "What should happen if the expression is <code>Nothing</code>?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 2, "creation_date": 1441418864, "post_id": 32408156, "comment_id": 52685521, "body": "<code>lower</code> has type <code>expr (Value a) -&gt; expr (Value a)</code>. It should work fine on a <code>Value (Maybe typ)</code>."}], "owner": {"reputation": 13, "user_id": 4242471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/913c89fb19b85babd998b23f6e708b36?s=128&d=identicon&r=PG", "display_name": "Nick Mojarovskiy", "link": "https://stackoverflow.com/users/4242471/nick-mojarovskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1441411328, "creation_date": 1441411328, "question_id": 32408156, "link": "https://stackoverflow.com/questions/32408156/esqueleto-how-to-apply-lower-to-maybe-field", "title": "Esqueleto: how to apply lower_ to maybe field?", "body": "<p>How to apply function <code>lower_</code> to <code>(Value (Maybe typ))</code>?\nI have maybe string field in db, so after <code>(^.)</code> operator I'll have expression with type: <code>SqlExpr (Value (Maybe String))</code>.\nLet us suppose lower_ is <code>SqlExpr (Value String) -&gt; SqlExpr (Value String)</code>.\nHow to apply <code>lower_</code> for this?</p>\n"}, {"tags": ["haskell", "typeclass", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "edited": false, "score": 0, "creation_date": 1441559893, "post_id": 32408286, "comment_id": 52717671, "body": "Thank you for your answer, I feared that it wasn&#39;t possible. I guess I will have to find a work-around."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 6, "last_activity_date": 1441412623, "creation_date": 1441412623, "answer_id": 32408286, "question_id": 32408110, "link": "https://stackoverflow.com/questions/32408110/datakinds-and-type-class-instances/32408286#32408286", "title": "DataKinds and type class instances", "body": "<p>No, this is not possible. In a context where you have \"just the type information\", at run-time, you really have <em>no</em> information. Type information is erased. So even for closed kinds, where it is in principle possible to show that given the type in question, you can always come up with a dictionary, you still need the class constraint. The class constraint ensures that at compile time, when GHC knows the type, it can select the appropriate instance to pass along. At run-time, the information which type it is is lost, and there's no chance to do the same. Writing a \"one size fits all\" instance does indeed work, because then the exact type does not matter for the choice anymore.</p>\n\n<p>I don't know the full picture, but it may be possible to work around this by explicitly bundling up either the class dictionary or the string itself with the value you are passing around ...</p>\n"}, {"comments": [{"owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "edited": false, "score": 0, "creation_date": 1441560092, "post_id": 32410412, "comment_id": 52717733, "body": "Something like this might prove to be useful, I will keep it in mind, thanks."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1441565229, "last_edit_date": 1441565229, "creation_date": 1441436334, "answer_id": 32410412, "question_id": 32408110, "link": "https://stackoverflow.com/questions/32408110/datakinds-and-type-class-instances/32410412#32410412", "title": "DataKinds and type class instances", "body": "<p>You can add another class.</p>\n\n<pre><code>class Kish (k :: K) where\n  toK :: proxy k -&gt; K\n\ninstance Kish A where\n  toK _ = A\n\ninstance Kish B where\n  toK _ = B\n\ninstance Kish k =&gt; Show (Proxy k) where\n  showsPrec n _ = case toK (Proxy :: Proxy k) of\n    A -&gt; ...\n    B -&gt; ...\n</code></pre>\n\n<p>Now you'll still be stuck with a context, but it's a more general one that might well be useful for other things too.</p>\n\n<p>If it turns out that you tend to need to distinguish the proxies a lot, then you should switch to a GADT that you can just inspect as needed instead of using a proxy.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441597725, "post_id": 32430533, "comment_id": 52726577, "body": "Couldn&#39;t <code>foo</code> learn <code>a</code> by pattern matching? Such information generally becomes available on the RHS of a GADT pattern match. Also, <code>KProxy</code> is probably a poor name since it&#39;s used in <code>Data.Proxy</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441599228, "post_id": 32430533, "comment_id": 52726916, "body": "@dfeuer You&#39;re quite right, <code>foo</code> can learn the type of <code>ky</code> by pattern matching on <code>kx</code>... so GADTs break parametricity?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441599795, "post_id": 32430533, "comment_id": 52727043, "body": "@dfeuer I suppose of course they do, that&#39;s a lot of the point. *sounds of mental models updating*"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441601406, "post_id": 32430533, "comment_id": 52727462, "body": "This is why Agda, as I understand it, distinguishes between a &quot;parameter&quot; and an &quot;index&quot;. This also relates to GHC&#39;s somewhat messy/limited &quot;type role&quot; mechanism."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1441614933, "last_edit_date": 1441614933, "creation_date": 1441595223, "answer_id": 32430533, "question_id": 32408110, "link": "https://stackoverflow.com/questions/32408110/datakinds-and-type-class-instances/32430533#32430533", "title": "DataKinds and type class instances", "body": "<p>Knowing that:</p>\n\n<ol>\n<li><code>a</code> is of kind <code>K</code></li>\n<li>the only types of kind <code>K</code> are <code>A</code> and <code>B</code></li>\n<li><code>Show (Proxy A)</code> holds</li>\n<li><code>Show (Proxy B)</code> holds</li>\n</ol>\n\n<p>is sufficient to prove that <code>Show (Proxy a)</code> holds. But a type class isn't just a proposition that we need to prove true to use with our type, it also provides implementations. To actually use <code>show (x :: Proxy a)</code> we need to not just prove that an implementation for <code>Show (Proxy a)</code> <em>exists</em>, we need to actually know which one it is.</p>\n\n<p>Haskell type variables (without constraints) are parametric: there's no way to be fully polymorphic in <code>a</code>, and also be able to inspect <code>a</code> to provide different behaviour for <code>A</code> and <code>B</code>. The \"different behaviour\" you want is about as \"close to parametric\" as you can possibly be without actually being parametric, since it's just the selection of a different instance for each type when you know there is one for each type. But it's still something that breaks the contract of what <code>test :: forall (a :: K). Proxy a -&gt; String</code> means.</p>\n\n<p>Type class constraints allow your code to be non-parametric in the constrained type variables, in as much as you can use the type class' mapping from types to implementations to switch how your code behaves based on the type it's invoked at. So <code>test :: forall (a :: K). Show (Proxy a) =&gt; Proxy a -&gt; String</code> works. (In terms of the actual implementation, the same ultimate caller who gets to choose the type <code>a</code> also provides the <code>Show (Proxy a)</code> instance for the code generated from your function to use).</p>\n\n<p>You can use your <code>instance Show (Proxy (a :: K))</code> idea; now your function that <em>is</em> parametric in a type <code>a :: K</code> can still use <code>show (x :: Proxy a)</code> because there is one instance that works for all <code>a :: K</code>. But the instance itself runs into the same problem; the implementation of <code>show</code> in the instance is parametric in <code>a</code>, and so can't inspect it in anyway in order to return a different string based on the type.</p>\n\n<p>You can use something like dfeuer's answer, where <code>Kish</code> exploits the non-parametricity of constrained type variables to basically allow you to inspect the type at runtime; the instance dictionary passed along to satisfy the <code>Kish a</code> constraint basically <em>is</em> a run time record of which type was chosen for the variable <code>a</code> (in a roundabout way). Pushing this idea further gets you all the way to <code>Typeable</code>. But you still need some sort of constraint to make your code non-parametric in <code>a</code>.</p>\n\n<p>You can also use a type that is explicitly a runtime representation of the choice of <code>A</code> or <code>B</code> (as opposed to <code>Proxy</code>, which is an empty value at runtime and only provides a compile-time representation of the choice), something like:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures, StandaloneDeriving #-}\n\ndata K = A | B\n\ndata KProxy (a :: K)\n  where KA :: KProxy A\n        KB :: KProxy B\n\nderiving instance Show (KProxy a)\n\ntest :: KProxy a -&gt; String\ntest = show\n</code></pre>\n\n<p>(Note here I can not only implement <code>Show (Kproxy a)</code>, I can actually derive it, although it does require standalone deriving)</p>\n\n<p>This is using a GADT <code>KProxy</code> to allow <code>test</code> to be non-parametric in <code>a</code>, essentially doing the same job as the <code>Kish</code> constraint from dfeuer's answer but avoiding the need to add an extra constraint to your type signatures. In an earlier version of this post I stated that <code>test</code> was able to do this while remaining \"just\" parametric in <code>a</code>, which was incorrect.</p>\n\n<p>Of course now to pass a proxy you have to actually write <code>KA</code> or <code>KB</code>. That's no bother where you were having to write <code>Proxy :: Proxy A</code> to actually choose the type (which is often the case with proxies, given that you usually only use them to fix a type that otherwise would be ambiguous). But where it would have been unambiguous anyway the compiler will catch you if you're inconsistent with the rest of the call, but you can't write just one symbol like <code>Proxy</code> and have the compiler infer the correct meaning. You can address <em>that</em> with a type class:</p>\n\n<pre><code>class KProxyable (a :: K)\n  where kproxy :: KProxy a\n\ninstance KProxyable A\n  where kproxy = KA\n\ninstance KProxyable B\n  where kproxy = KB\n</code></pre>\n\n<p>Then you can use <code>KA</code> instead of <code>Proxy :: Proxy A</code>, and <code>kproxy</code> instead of letting the compiler infer the type of a bare <code>Proxy</code>. Stupid example time:</p>\n\n<pre><code>foo :: KProxy a -&gt; KProxy a -&gt; String\nfoo kx ky = show kx ++ \" \" ++ show ky\n</code></pre>\n\n<p>GHCI:</p>\n\n<pre><code>\u03bb foo KA kproxy\n\"KA KA\"\n</code></pre>\n\n<p>Note I'm not actually needing to have a <code>KProxyable</code> constraint anywhere; I use <code>kproxy</code> at a point where the type <em>is</em> known. This still has to \"come in from the top\", though (exactly as the instance dictionary satisfying your <code>Show (Proxy a)</code> constraint would); there's no way to have a function parametric in a type <code>a :: K</code> come up with the relevant <code>KProxy a</code> on its own.</p>\n\n<p>Because it's the correspondence between the constructors and the type that makes this work, I don't believe you can make a generic proxy in this style the way you can with the empty-at-runtime <code>Proxy</code>. TemplateHaskell could certainly generate such proxy types for you though; I think the concept of <em>singletons</em> is the general idea here, and so the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">https://hackage.haskell.org/package/singletons</a> probably provides what you need, but I'm not very familiar with how to actually use that package.</p>\n"}], "owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 850, "favorite_count": 0, "accepted_answer_id": 32408286, "answer_count": 3, "score": 6, "last_activity_date": 1441614933, "creation_date": 1441410851, "last_edit_date": 1495535325, "question_id": 32408110, "link": "https://stackoverflow.com/questions/32408110/datakinds-and-type-class-instances", "title": "DataKinds and type class instances", "body": "<p>The following example is a boiled-down version of my real-life problem. It seems to be in some way similar to <a href=\"https://stackoverflow.com/questions/24387865/retreiving-information-from-datakinds-constrained-existential-types\">Retrieving information from DataKinds constrained existential types</a>, but I could not quite get the answers I was seeking.</p>\n\n<p>Suppose we have a finite, promoted DataKind <code>K</code> with types <code>A</code> and <code>B</code>, and a poly-kinded <code>Proxy</code> data-type to generate terms with types of kind *.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, PolyKinds, GADTs, FlexibleInstances, FlexibleContexts #-}\n\ndata K = A | B\n\ndata Proxy :: k -&gt; * where Proxy :: Proxy k\n</code></pre>\n\n<p>Now I want to write <code>Show</code>-instances for every type <code>Proxy a</code> where <code>a</code> is of kind <code>K</code>, which are exactly two:</p>\n\n<pre><code>instance Show (Proxy A) where show Proxy = \"A\"\ninstance Show (Proxy B) where show Proxy = \"B\"\n</code></pre>\n\n<p>But to use the <code>Show</code>-instance, I have to explicitly provide the context, even if the kind is restricted to <code>K</code>:</p>\n\n<pre><code>test :: Show (Proxy a) =&gt; Proxy (a :: K) -&gt; String\ntest p = show p\n</code></pre>\n\n<p>My goal is to get rid of the type-class constraint. This may seem unimportant, but in my real application, this has major implications.</p>\n\n<p>I could also define a single, but more general <code>Show</code>-instance like this:</p>\n\n<pre><code>instance Show (Proxy (a :: K)) where show p = \"?\"\n</code></pre>\n\n<p>This actually allows me to drop the constraint, but the new problem is to differentiate between the two types <code>A</code> and <code>B</code>.</p>\n\n<p>So, is there a way to eat my cake and have it too? That is, not having to provide a type-class constraint in the type of <code>test</code> (kind annotations are fine, though), and still having two different <code>show</code> implementations (e.g. by differentiating the types somehow)?</p>\n\n<p>Actually, it would also be okay to drop the entire type class, if I could simply associate the respective types (<code>A</code>, <code>B</code>) with their specific values (here: <code>\"A\"</code>, <code>\"B\"</code>) in a context where I just have the type information. I have no idea how to do this, though.</p>\n\n<p>I would be very thankful for any provided insights.</p>\n"}, {"tags": ["haskell", "functional-programming", "adt"], "comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441403774, "post_id": 32407085, "comment_id": 52682356, "body": "Two notes: 1. I know one obvious solution would be to just represent numbers as list of bools and emulate the float/int algos - but would that be the most efficient? 2. I guess the question is somewhat broad, a complete answer would be way too long, so obviously I&#39;m not asking for whole implementations. Just key insights and pointers would be very good!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1441405313, "post_id": 32407085, "comment_id": 52682835, "body": "\u201cMost efficient\u201d in what regard? I don&#39;t suppose there&#39;s any way to give a universally objective criterion, so it&#39;ll more or less boil down to \u201cwhat&#39;s most efficient in GHC\u201d. But then the answer will be, <i>anything that compiles to an equivalent of the standard native arithmetic</i>. Pretty sure that is possible without explicitly using native types. So, while I like the idea of this question, I don&#39;t think there can be a proper answer."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 6, "creation_date": 1441406038, "post_id": 32407085, "comment_id": 52683093, "body": "It depends highly on which operations you are performing. The data type <code>data N = OnePlusSum N N | Zero</code> can perform extremely well for some problems: it has <code>O(1)</code> operations for <code>n + 1</code>, <code>n + m + 1</code> and for checking to see that a number is non-zero. It won&#39;t do so well if you need to divide by two or subtract 1."}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 2388377, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lcQ83.jpg?s=128&g=1", "display_name": "numberten", "link": "https://stackoverflow.com/users/2388377/numberten"}, "is_accepted": false, "score": 4, "last_activity_date": 1441406604, "creation_date": 1441406604, "answer_id": 32407561, "question_id": 32407085, "link": "https://stackoverflow.com/questions/32407085/what-are-the-most-efficient-representations-of-numbers-without-native-types/32407561#32407561", "title": "What are the most efficient representations of numbers without native types?", "body": "<p>Leftaroundabout already commented on the ambiguity with respect to the term \"most efficient\" when referring to Haskell and ghc specifically. If what you're really asking is, \"What might a more efficient encoding of numbers using ADTs (algebraic datatypes) in a language that supports them look like?\", then I'd point you to the <a href=\"http://www.cis.upenn.edu/~bcpierce/sf/current/Basics.html#lab36\" rel=\"nofollow\">Basics chapter in Software Foundations</a>, where you're given an exercise in defining a binary representation of the natural numbers.</p>\n\n<p>A quote from the book:</p>\n\n<blockquote>\n  <p>Exercise: 3 stars (binary)</p>\n  \n  <p>Consider a different, more efficient representation of natural numbers\n  using a binary rather than unary system. That is, instead of saying\n  that each natural number is either zero or the successor of a natural\n  number, we can say that each binary number is either</p>\n  \n  <ul>\n  <li>zero,</li>\n  <li>twice a binary number,</li>\n  <li>or one more than twice a binary number.</li>\n  </ul>\n  \n  <p>(a) First, write an inductive definition of the type bin corresponding\n  to this description of binary numbers.</p>\n  \n  <p>(Hint: Recall that the definition of nat from class,</p>\n\n<pre><code>Inductive nat : Type :=\n  | O : nat\n  | S : nat \u2192 nat.\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 0, "last_activity_date": 1441447327, "creation_date": 1441447327, "answer_id": 32411801, "question_id": 32407085, "link": "https://stackoverflow.com/questions/32407085/what-are-the-most-efficient-representations-of-numbers-without-native-types/32411801#32411801", "title": "What are the most efficient representations of numbers without native types?", "body": "<p>As @Cirdec already commented, the question doesn't make sense with regard to programming languages. It makes only sense with regard to specific programming problems.</p>\n\n<p>For example, if you need exact numbers, you may want to represent rationals as continued fractions. Which, OTOH, may be suboptimal for book-keeping.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1441467914, "last_edit_date": 1495540328, "creation_date": 1441467914, "answer_id": 32414906, "question_id": 32407085, "link": "https://stackoverflow.com/questions/32407085/what-are-the-most-efficient-representations-of-numbers-without-native-types/32414906#32414906", "title": "What are the most efficient representations of numbers without native types?", "body": "<p>It depends very much on what you want to do with the numbers and what do you mean by <em>most efficient</em>.</p>\n\n<p>If you want to represent a natural number <em>n</em>, you need <em>log n</em> bits of information. And since an ADT can have only finitely many distinct constructors, it encodes a finite number of bits, so you need to have structure with at least <em>log n</em> nodes.</p>\n\n<p>I recommend you very much Chapter <em>Numerical Representations</em> from Chris Okasaki's <a href=\"https://rads.stackoverflow.com/amzn/click/com/0521663504\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Functional Data Structures</a> (the thesis is available online <a href=\"http://www.cs.cmu.edu/~rwh/theses/okasaki.pdf\" rel=\"nofollow noreferrer\">here</a>). It describes various tree-like data structures, supporting different sets of operations, and how they relate to natural numbers. Everything below is what I learned from the book.</p>\n\n<p>Expanding on Cirdec's comment: You can define</p>\n\n<pre><code>data N = Zero | Positive\ndata Positive = One | Add Positive Positive\n</code></pre>\n\n<p>This gives you <em>O(1)</em> addition and subtracting by one. On the other hand, the size of the structure will be <em>O(n)</em>.</p>\n\n<p>You can use a binary representation with <em>O(log n)</em> space, but then addition will be <em>O(log n)</em>:</p>\n\n<pre><code>data N = Zero | Positive\ndata Positive = One | Twice Positive | TwicePlusOne Positive\n</code></pre>\n\n<p>increment and decrement will be almost <a href=\"https://en.wikipedia.org/wiki/Amortized_analysis\" rel=\"nofollow noreferrer\">amortized</a> <em>O(1)</em>. A sequence of increments will go to depth <em>d</em> only every <em>2^d</em> operations, so in average, each increment will be <em>O(1)</em>. Similarly for decerements. I said <strong>almost</strong> above, because if you interchange increments and decrements, then you can flip between a <em>O(log n)</em> increment and decrement operations. A solution to this is to add some redundancy:</p>\n\n<pre><code>data N = Zero | Positive\ndata Positive = One | Twice Positive | TwicePlusOne Positive | TwicePlusTwo Positive\n</code></pre>\n\n<p>Now every time an operation needs to go one level deeper, it leaves the current node at <code>TwicePlusOne</code>, which means the next operation affecting the node will stop at it, regardless if it's an increment or decrement.</p>\n\n<p>If you want <strong>constant time addition</strong>, the data structure can be extended for that (look for <em>Lists With Efficient Catenation</em> in the book), but then again you can end up with <em>O(n)</em> memory, if the sequence of operations is bad. There is an open SO question <a href=\"https://stackoverflow.com/q/28729868/1333025\">How can natural numbers be represented to offer constant time addition?</a> asking if it's possible to get both.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 2, "answer_count": 3, "score": 2, "last_activity_date": 1441467914, "creation_date": 1441403558, "question_id": 32407085, "link": "https://stackoverflow.com/questions/32407085/what-are-the-most-efficient-representations-of-numbers-without-native-types", "title": "What are the most efficient representations of numbers without native types?", "body": "<p>On Haskell, most numeric types are natives - Int, Float, Word32 etc. There is also a popular representation of unary natural numbers with ADTs only - that is the Peano encoding:</p>\n\n<pre><code>data Nat = Succ Nat | Zero\n</code></pre>\n\n<p>That datatype, while elegant, is not very efficient. Multiplication, exponentiation, division with unary numbers are unpractical. My question is: if we didn't have native types to count on, what would be the <strong>most efficient</strong> representation of numbers - nats, ints, fracs, complex, etc. - in a pure functional language such as Haskell? What would the datatypes and the respective algorithms look like?</p>\n"}, {"tags": ["haskell", "logic", "addition"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1441381002, "post_id": 32401679, "comment_id": 52671811, "body": "I&#39;m voting to close this question as off-topic because it does not show what the author has tried so far and where they got stuck."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441381196, "post_id": 32401679, "comment_id": 52671929, "body": "Welcome to Stack Overflow. Please see the help center for advice on how to ask good questions here."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441383312, "post_id": 32401679, "comment_id": 52673170, "body": "@dfeuer I believe that falls under &quot;Too broad&quot;..."}, {"owner": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1444618369, "post_id": 32401679, "comment_id": 53962999, "body": "@dfeuer <a href=\"https://meta.stackoverflow.com/questions/283177/is-too-broad-a-valid-reason-to-close-a-question-that-doesnt-show-any-research/283185#283185\">That is not a valid reason to close a question.</a>"}, {"owner": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1444619067, "post_id": 32401679, "comment_id": 53963128, "body": "@Bakuriu &quot;Too broad: There are either too many possible answers, or good answers would be too long for this format&quot;. That does not apply, as you can see from the answers below."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "edited": false, "score": 0, "creation_date": 1444620986, "post_id": 32401679, "comment_id": 53963545, "body": "@Boann, the people who voted to close are people who answer a lot of questions with the Haskell tag (chi has a gold badge, I have silver, and all the rest have bronze). I think it&#39;s okay for different subcommunities here to enforce somewhat different standards depending on their particular needs."}], "answers": [{"tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 2, "last_activity_date": 1441381765, "creation_date": 1441381765, "answer_id": 32402013, "question_id": 32401679, "link": "https://stackoverflow.com/questions/32401679/how-to-make-an-add-function-using-n-1-and-n1/32402013#32402013", "title": "How to make an &#39;add&#39; function using n-1 and n+1", "body": "<p>Assuming <code>inc</code> and <code>dec</code> are your functions:</p>\n\n<pre><code>add x y | y &gt; 0     = add (inc x) (dec y)\nadd x y | y &lt; 0     = add (dec x) (inc y)\nadd x y | otherwise = x\n</code></pre>\n\n<p>And similarly for <code>subtract</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 3, "last_activity_date": 1441382402, "last_edit_date": 1441382402, "creation_date": 1441382010, "answer_id": 32402086, "question_id": 32401679, "link": "https://stackoverflow.com/questions/32401679/how-to-make-an-add-function-using-n-1-and-n1/32402086#32402086", "title": "How to make an &#39;add&#39; function using n-1 and n+1", "body": "<pre><code>inc :: Int -&gt; Int\ninc n = n + 1\n\ndec :: Int -&gt; Int\ndec n = n - 1\n\nadd :: Int -&gt; Int -&gt; Int\nadd n 0 = n\nadd n m = add (inc n) (dec m)\n</code></pre>\n\n<p>So you just increase one of the numbers every time you decrease the other. If you recurse you basically repeat this process until you hit some edge condition. This is when the decreased number drops to 0 (notice: works just for natural numbers, not negative integers). You could extend it to negative numbers using if-then-else and comparison with 0 (&lt;, >).</p>\n\n<p>In logic you would probably have a function <code>s</code>. Then you would axiomatize function <code>add</code> for example as:</p>\n\n<pre><code>add(x,y) = add(y,x)\nadd(x,0) = x\nadd(x,s(y)) = add(s(x),y)\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1441383255, "answer_count": 2, "score": -2, "last_activity_date": 1444618376, "creation_date": 1441380637, "last_edit_date": 1444618376, "question_id": 32401679, "link": "https://stackoverflow.com/questions/32401679/how-to-make-an-add-function-using-n-1-and-n1", "closed_reason": "Not suitable for this site", "title": "How to make an &#39;add&#39; function using n-1 and n+1", "body": "<p>I have two functions: <code>n = n-1</code> and <code>n = n+1</code>.</p>\n\n<p>How could I make an <code>add</code> function using these definitions by using recursion, if-then-else, <code>==</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1441382274, "post_id": 32401887, "comment_id": 52672569, "body": "Why inefficient? In any case, list cells before the replaced element must be copied, and after the element the tails can be shared with the input list, and the solution does just that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441382352, "post_id": 32401887, "comment_id": 52672621, "body": "@dfeuer It looks O(n^2), which is asymptotically optimal. Am I neglecting something? Any more effcient approach?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441383639, "post_id": 32401887, "comment_id": 52673346, "body": "If you map <code>null</code> over the result list, it will take O(n^2) to calculate. You can make it more incremental than that; the simplest way, using base 4.7.0.2 or later, is to zip <code>inits</code> with <code>tails</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1441381688, "last_edit_date": 1441381688, "creation_date": 1441381282, "answer_id": 32401887, "question_id": 32401109, "link": "https://stackoverflow.com/questions/32401109/how-do-i-make-a-list-of-all-possible-replaced-items-in-haskell/32401887#32401887", "title": "How do I make a list of all possible replaced items in Haskell?", "body": "<pre><code>replace :: [a] -&gt; a -&gt; [[a]]\nreplace []     _special = []\nreplace (x:xs) special  = (special:xs) : map (x:) (replace xs special)\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>&gt; replace [\"a\",\"b\",\"c\"] \"z\"\n[[\"z\",\"b\",\"c\"],[\"a\",\"z\",\"c\"],[\"a\",\"b\",\"z\"]]\n</code></pre>\n\n<p>Explanation:</p>\n\n<p>We want to produce all the lists in which exactly one element is replaced by the <code>special</code> one.</p>\n\n<p>If the list is empty, there's no way to insert <code>special</code>, so we return no options.</p>\n\n<p>If the list is instead <code>x:xs</code>, one option is to replace <code>x</code> and obtain <code>special:xs</code>. The other options can be computed by recursively taking any way to insert <code>special</code> in the tail <code>xs</code>, and finally prepend <code>x</code> in front of each of these.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1441388542, "last_edit_date": 1495541680, "creation_date": 1441383049, "answer_id": 32402364, "question_id": 32401109, "link": "https://stackoverflow.com/questions/32401109/how-do-i-make-a-list-of-all-possible-replaced-items-in-haskell/32402364#32402364", "title": "How do I make a list of all possible replaced items in Haskell?", "body": "<p>There is no efficient way to do this with lists; the best you can do, asymptotically, is</p>\n\n<pre><code>replace x xs = zipWith f (inits xs) (dropLast $ tails xs)\n  where\n    f front (_ : rear) = front ++ x : rear\n\ndropLast [] = []\ndropLast [_] = []\ndropLast (x:xs) = x : dropLast xs\n</code></pre>\n\n<p>Note: this is only reasonably efficient with base 4.7.0.2 or later (GHC 7.8.4 or later).</p>\n\n<p><a href=\"https://stackoverflow.com/a/32402969/1477667\">https://stackoverflow.com/a/32402969/1477667</a> demonstrates a cleaner way, using <code>tail</code> instead of <code>dropLast</code>.</p>\n\n<p>The tricky part here is hidden in <code>inits</code>, which in recent versions goes to great lengths to be both reasonably efficient and lazy.</p>\n\n<p>If you really want to make this operation fast, you have to give up on lists and use some other representation.</p>\n\n<pre><code>import Data.Sequence\n\nreplace :: a -&gt; Seq a -&gt; Seq (Seq a)\nreplace x xs = mapWithIndex f xs\n  where\n    f i _ = update i x xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1441385273, "creation_date": 1441385273, "answer_id": 32402969, "question_id": 32401109, "link": "https://stackoverflow.com/questions/32401109/how-do-i-make-a-list-of-all-possible-replaced-items-in-haskell/32402969#32402969", "title": "How do I make a list of all possible replaced items in Haskell?", "body": "<p>This looks like a homework problem so this answer may not help you, but I like to solve these kinds of problems using <code>inits</code> and <code>tails</code> from the <code>Data.List</code>.</p>\n\n<p>Have a look at how <code>inits</code> and <code>tail .tails</code> works:</p>\n\n<pre><code>as = inits [1..3]        = [ [],    [1], [1,2], [1,2,3] ]\nbs = tail (tails [1..3]) = [ [2,3], [3], [] ]\ncs = [1..3]              = [ 1,     2,     3]\n</code></pre>\n\n<p>Many of these kinds of problems are functions of the 3-way zip of these lists. For instance, a solution to this problem is:</p>\n\n<pre><code>[ a ++ \"z\" ++ b | (a,b) &lt;- zip as bs ]\n</code></pre>\n\n<p>Or, if you need to add 1 to each element:</p>\n\n<pre><code>[ a ++ [c+1] ++ b | (a,b,c) &lt;- zip3 as bs cs ]\n</code></pre>\n\n<p>Or remove each element:</p>\n\n<pre><code>[ a ++ b | (a,b) &lt;- zip as bs ]\n</code></pre>\n\n<p>Note that even though <code>as</code> is one longer than <code>bs</code> the zip will iterate over the correct number of elements.</p>\n"}], "owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 32401887, "answer_count": 3, "score": 1, "last_activity_date": 1441395257, "creation_date": 1441378691, "last_edit_date": 1441395257, "question_id": 32401109, "link": "https://stackoverflow.com/questions/32401109/how-do-i-make-a-list-of-all-possible-replaced-items-in-haskell", "title": "How do I make a list of all possible replaced items in Haskell?", "body": "<p>My input is an arbitrary list, such as</p>\n\n<pre><code>[\"a\",\"b\",\"c\"]\n</code></pre>\n\n<p>and another list element, say <code>\"z\"</code>. I want the output to look like:</p>\n\n<pre><code>[[\"z\",\"b\",\"c\"],[\"a\",\"z\",\"c\"],[\"a\",\"b\",\"z\"]]\n</code></pre>\n\n<p>How do I do this?</p>\n"}, {"tags": ["haskell", "variadic-functions", "function-parameter", "polyvariadic"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441375176, "post_id": 32399733, "comment_id": 52667962, "body": "Constants are polymorphic in Haskell, <code>1 :: Num a =&gt; a</code>. So, <code>1</code> could also be a pair, or a string, or anything else if someone adds a <code>Num</code> instance. Of course, that would be unadvisable, but the compiler has to cope with the possibility that such an instance is added later on, or in another module. I don&#39;t think there&#39;s a good solution for this issue, and having to add a type annotation is not a very big deal, IMHO."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441396617, "post_id": 32399733, "comment_id": 52679597, "body": "IMO, <code>printf</code>-like things are neat ways to show off the power of Haskell&#39;s type system, but generally bad for writing actual programs or libraries. My best advice on how to write this sort of thing is not to."}, {"owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "edited": false, "score": 0, "creation_date": 1441454947, "post_id": 32399733, "comment_id": 52692974, "body": "Could you give some details or examples why?"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "edited": false, "score": 2, "creation_date": 1441375912, "post_id": 32400034, "comment_id": 52668551, "body": "It&#39;s because of extension ExtendedDefaultRules, with it your sample with printf will work without errors."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1441375271, "creation_date": 1441375271, "answer_id": 32400034, "question_id": 32399733, "link": "https://stackoverflow.com/questions/32399733/printf-like-function/32400034#32400034", "title": "Printf-like function", "body": "<p>The problem is here:</p>\n\n<pre><code>The type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance Num Double -- Defined in \u2018GHC.Float\u2019\n  instance Num Float -- Defined in \u2018GHC.Float\u2019\n  ...\n</code></pre>\n\n<p>Recall that the literal <code>1</code> can be interpreted as a value any <code>Num</code> type, so GHC doesn't know which one to select - e.g. <code>Int</code>, <code>Double</code>, <code>Rational</code>, etc.</p>\n\n<p>The standard <code>Text.Printf</code> module has the same problem:</p>\n\n<pre><code>import Text.Printf\n\nmain = putStrLn $ printf \"%d\" 3\n</code></pre>\n\n<p>gives he same error.</p>\n\n<p>Note that if you won't get an error if you enter this code into ghci because there are defaulting rules which make the expression <code>1</code> monomorphic instead of polymorphic.</p>\n"}], "owner": {"reputation": 43, "user_id": 5300933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957584b608b4adae0fa131d8c2fed46?s=128&d=identicon&r=PG&f=1", "display_name": "Kirill Nesterov", "link": "https://stackoverflow.com/users/5300933/kirill-nesterov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 32400034, "answer_count": 1, "score": 2, "last_activity_date": 1441455160, "creation_date": 1441374448, "last_edit_date": 1441455160, "question_id": 32399733, "link": "https://stackoverflow.com/questions/32399733/printf-like-function", "title": "Printf-like function", "body": "<p>I'm trying to write a function with an arbitrary number of arguments. These arguments can be Int or String. And I have a problem with ints. For some reason (which I don't understand), the value 1 becomes a source of ambiguity. How to deal with this error and what is the source of it?</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport Data.Typeable\n\ndata PackArgTypes = PackInt Int | PackString String\n                              deriving Show\n\nclass PackArg t where\n  toPackArg :: t -&gt; PackArgTypes\n\ninstance PackArg Int where\n  toPackArg = PackInt . fromIntegral\ninstance PackArg Integer where\n  toPackArg = PackInt . fromIntegral\n\ninstance PackArg String where\n  toPackArg = PackString\n\nclass PackType t where\n  pack' :: String -&gt; [PackArgTypes] -&gt; t\n\ninstance PackType (IO a) where\n  pack' fmt acc = do\n    print fmt\n    mapM_ print acc\n    return undefined\n\ninstance (PackArg a, PackType r) =&gt; PackType (a -&gt; r) where\n    pack' fmt acc = \\x -&gt; pack' fmt $ acc ++ [toPackArg x]\n\npack :: (PackType t) =&gt; String -&gt; t\npack fmt = pack' fmt []\n\nmain :: IO ()\nmain = do\n  pack \"asd\" \"qwe\" \"asd\"(1 :: Int) -- Ok\n  pack \"asd\" \"qwe\" \"asd\" 1         -- Sad\n</code></pre>\n\n<p>In said case I've got the error</p>\n\n<pre><code>test1.hs:33:3-6: No instance for (PackArg a0) arising from a use of \u2018pack\u2019 \u2026\nThe type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance PackArg String\n    -- Defined at /home/knesterov/test1.hs:13:10\n  instance PackArg Int -- Defined at /home/knesterov/test1.hs:10:10\nIn a stmt of a 'do' block: pack \"asd\" \"qwe\" \"asd\" 1\nIn the expression: do { pack \"asd\" \"qwe\" \"asd\" 1 }\nIn an equation for \u2018main\u2019: main = do { pack \"asd\" \"qwe\" \"asd\" 1 }\ntest1.hs:33:26: No instance for (Num a0) arising from the literal \u20181\u2019 \u2026\nThe type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance Num Double -- Defined in \u2018GHC.Float\u2019\n  instance Num Float -- Defined in \u2018GHC.Float\u2019\n  instance Integral a =&gt; Num (GHC.Real.Ratio a)\n    -- Defined in \u2018GHC.Real\u2019\n  ...plus 7 others\nIn the fourth argument of \u2018pack\u2019, namely \u20181\u2019\nIn a stmt of a 'do' block: pack \"asd\" \"qwe\" \"asd\" 1\nIn the expression: do { pack \"asd\" \"qwe\" \"asd\" 1 }\nCompilation failed.\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Thanks to user5402 who pointed to the difference between ghci and ghc. Ghci enables extension ExtendedDefaultRules by <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow\">default</a></p>\n\n<p>So with three additional lines my sample works with no errors.</p>\n\n<pre><code>{-# LANGUAGE ExtendedDefaultRules #-}\ninstance PackArg Integer where\n  toPackArg = PackInt . fromIntegral\n</code></pre>\n"}, {"tags": ["postgresql", "haskell", "time"], "comments": [{"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1441373227, "post_id": 32398878, "comment_id": 52666517, "body": "I see now that a <code>ToField</code> instance exists, it&#39;s just <code>FromField</code> that&#39;s missing."}], "answers": [{"comments": [{"owner": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 0, "creation_date": 1443939856, "post_id": 32406222, "comment_id": 53687170, "body": "Yep, this is exactly why postgresql-simple doesn&#39;t contain an out-of-box <code>FromField</code> instance for <code>NominalDiffTime</code>.    On the other hand,  it would be nice to implement some sort of Haskell type that could faithfully represent postgresql&#39;s interval type.   And limited instance along these lines might be useful,  but I haven&#39;t given it much thought."}, {"owner": {"reputation": 707, "user_id": 646408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e62561db40e46118628b31cba87840d6?s=128&d=identicon&r=PG", "display_name": "lpsmith", "link": "https://stackoverflow.com/users/646408/lpsmith"}, "edited": false, "score": 0, "creation_date": 1443940680, "post_id": 32406222, "comment_id": 53687326, "body": "(Also, as an aside,  the reason why <code>2 days</code> isn&#39;t the same thing as <code>48 hours</code> is because in every timezone ever used by everyday people, not all days are 24 hours long.   (And the customer probably wants local time)   Most exceptions are 23 hours or 25 hours during daylight savings shifts,  but not all;  see the IANA tz database for a list of these oddballs.)"}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": true, "score": 2, "last_activity_date": 1441399004, "creation_date": 1441399004, "answer_id": 32406222, "question_id": 32398878, "link": "https://stackoverflow.com/questions/32398878/converting-postgres-interval-to-haskell-nominaltimediff-with-postgresql-simple/32406222#32406222", "title": "Converting Postgres interval to Haskell NominalTimeDiff with postgresql-simple", "body": "<p>First off, there are reasons not to provide such an instance. <code>NominalDiffTime</code> doesn't sensibly represent all values of <code>interval</code>. For example, <code>2 days</code> is different from <code>48 hours</code>. Particularly, <code>1 year</code> can't be expressed in days.</p>\n\n<p>Here's a <code>FromField</code> instance for <code>NominalDiffTime</code> that fails for intervals with components that are larger than an hour (something like 25:00:00 is ok, though).</p>\n\n<pre><code>instance FromField NominalDiffTime where\n    fromField f mdat =\n        if typeOid f /= typoid interval\n            then returnError Incompatible f \"\"\n            else case mdat of\n                Nothing  -&gt; returnError UnexpectedNull f \"\"\n                Just dat -&gt; case parseOnly (nominalDiffTime &lt;* endOfInput) dat of\n                    Left msg  -&gt; returnError ConversionFailed f msg\n                    Right t   -&gt; return t\n\n\nnominalDiffTime :: Parser NominalDiffTime\nnominalDiffTime = do\n    (h, m, s) &lt;- interval\n    return . fromRational . toRational $ s + 60*(fromIntegral m) + 60*60*(fromIntegral h)\n\n-- | Parse a limited postgres interval of the form [-]HHH:MM:SS.[SSSS] (no larger units than hours).\ninterval :: Parser (Int, Int, Pico)\ninterval = do\n    h &lt;- signed decimal &lt;* char ':'\n    m &lt;- twoDigits &lt;* char ':'\n    s &lt;- seconds\n    if m &lt; 60 &amp;&amp; s &lt;= 60\n        then return (h, m, s)\n        else fail \"invalid interval\"\n\n-- functions below borrowed from postgresql-simple\nseconds :: Parser Pico\ntwoDigits :: Parser Int\n</code></pre>\n"}], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 32406222, "answer_count": 1, "score": 1, "last_activity_date": 1441463866, "creation_date": 1441372076, "last_edit_date": 1441463866, "question_id": 32398878, "link": "https://stackoverflow.com/questions/32398878/converting-postgres-interval-to-haskell-nominaltimediff-with-postgresql-simple", "title": "Converting Postgres interval to Haskell NominalTimeDiff with postgresql-simple", "body": "<p>I (think I) need <a href=\"http://hackage.haskell.org/package/postgresql-simple/docs/Database-PostgreSQL-Simple-FromField.html#t:FromField\" rel=\"nofollow\">FromField</a> and <a href=\"http://hackage.haskell.org/package/postgresql-simple-0.4.10.0/docs/Database-PostgreSQL-Simple-ToField.html\" rel=\"nofollow\">ToField</a> instances for <a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-Clock.html\" rel=\"nofollow\">NominalDiffTime</a>, in order to interface with a Postgres table with a column of type <code>interval</code>.</p>\n\n<p>I've found the <a href=\"http://hackage.haskell.org/package/postgresql-simple-0.4.10.0/docs/Database-PostgreSQL-Simple-TypeInfo-Static.html#v:interval\" rel=\"nofollow\">interval</a> TypeInfo and am in the process of figuring out how to interface with <code>TypeInfo</code>, but hopefully there is an easier way?</p>\n"}, {"tags": ["haskell", "functional-programming", "monad-transformers", "state-monad", "imperative-programming"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1441374239, "post_id": 32398321, "comment_id": 52667243, "body": "You need to mix failure &quot;powers&quot; in, too. This will look like <code>EitherT</code> or <code>MaybeT</code> and so you&#39;ll want to look into monad transformer stacks. Or! If you just want to explore, take a look at this monad: <code>data M e s a = M { runM :: e -&gt; Either e (s, a) }</code> noting that it instantiates <code>MonadState s</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1441374324, "post_id": 32398321, "comment_id": 52667315, "body": "Try to rewrite your original piece of code so that it doesn&#39;t use <code>exit()</code>. Can you how to do the functional equivalent of that now?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1441374422, "post_id": 32398321, "comment_id": 52667377, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/32391924/stateful-loop-with-different-types-of-breaks\">Stateful loop with different types of breaks</a> - where is the difference?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441374710, "post_id": 32398321, "comment_id": 52667587, "body": "it is a refined version of the original question, the difference lies in removing the control-flow and rather chaining the operations directly, allowing them to fail. Now the exchanged information is not simply <code>True</code>, <code>False</code> but <code>Maybe something</code> giving rise to a different chaining. The <code>put1</code> and <code>put2</code> do not seem to offer an easy way of being rewritten to not cause the main function to return. The answers to the original question did involve a lot of if-then-else like code, this is an attempt to use <code>&gt;&gt;=</code> of <code>Maybe</code> and <code>Either</code> instead."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1441375236, "post_id": 32398321, "comment_id": 52668028, "body": "@JakubDaniel: Ah, thanks for the edits!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441377524, "post_id": 32398321, "comment_id": 52669605, "body": "When <code>put1</code> fails, do you want it to exit just the inner while loop or do you want it to exit both while loops?"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441377891, "post_id": 32398321, "comment_id": 52669853, "body": "Good question, I will change this in the original post. <code>put1</code> and <code>put2</code> are supposed to terminate the whole computation while <code>get</code> may produce <code>Nothing</code> which skips <code>put1</code> and breaks the inner loop."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1441380890, "post_id": 32398321, "comment_id": 52671751, "body": "I would recommend that you start by writing the whole thing out in Haskell by hand (without funny business like <code>exit</code> or especially <code>error</code>). That will give you a better sense of what the pretty abstractions you want actually need to support."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441381032, "post_id": 32398321, "comment_id": 52671828, "body": "I don&#39;t understand, the <code>exit</code> is what makes the concept hard for me. Writing actions over <code>State</code> monad is something I already did. Now I realize that I have problem allowing some of the actions also behave exceptionally."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441379328, "post_id": 32401061, "comment_id": 52670781, "body": "Thank you for your reply. Honestly this is the first time I see OCaml so I cannot judge the answer. Hopefully I will decode it one day :)"}, {"owner": {"reputation": 5188, "user_id": 2654678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2050bd47e48d2e94f3ae0e5b40286d32?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Le Barbier", "link": "https://stackoverflow.com/users/2654678/micha%c3%abl-le-barbier"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1441379679, "post_id": 32401061, "comment_id": 52671014, "body": "If you can read Haskell you can probably not write OCaml but could be fine reading it. (I do not know Haskell but can more or less read it). The <i>signature</i> expresses type constraints (IIRC this is what <code>::</code> are for in Haskell).  The functor is maybe new to you because it is parametrised by a module, but you can more or less forget about it \u2013 just assume it is a macro of some sort. So now, there is only the <code>let rec\u2026 and \u2026</code> which needs to be explained, and this is how mutually recursive functions are defined."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441380371, "post_id": 32401061, "comment_id": 52671431, "body": "I am just starting to learn Haskell so I would not say I can read it (I get lost in the level of abstraction occasionally)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1441380515, "post_id": 32401061, "comment_id": 52671524, "body": "@JakubDaniel, note also that ML applies type constructors backwards, so <code>int list</code> is a list of ints. An <code>option</code> is a Maybe, with <code>Some</code> and <code>None</code>."}], "tags": [], "owner": {"reputation": 5188, "user_id": 2654678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2050bd47e48d2e94f3ae0e5b40286d32?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Le Barbier", "link": "https://stackoverflow.com/users/2654678/micha%c3%abl-le-barbier"}, "is_accepted": false, "score": 1, "last_activity_date": 1441378551, "creation_date": 1441378551, "answer_id": 32401061, "question_id": 32398321, "link": "https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either/32401061#32401061", "title": "Stateful computation with different types of short-circuit (Maybe, Either)", "body": "<blockquote>\n  <p>However I am not yet good at combining different monads using transformers and the like.</p>\n</blockquote>\n\n<p>You do not really need to combine different monads with combinators, you only need to explicitly embed the Maybe monad in the State monad.  Once this is done, translating the snippet is straightforward, replacing loops by mutually recursive functions \u2013 the mutuality implements the branching conditions.</p>\n\n<p>Let us write a solution this with OCaml and the <a href=\"https://github.com/michipili/lemonade\" rel=\"nofollow\">sparkling monad library Lemonade</a> where the State monad is called Lemonade_Success.</p>\n\n<p>So, I assume that the type representing errors returned by <em>put1</em> and <em>put2</em> is a string, representing a diagnostic message, and we instantiate the Success monad on the String type:</p>\n\n<pre><code>Success =\n  Lemonade_Success.Make(String)\n</code></pre>\n\n<p>Now, the Success module represents monadic computation which can fail with a diagnostic.  See below for the complete signature of Success.  I write the translation of the snippet above, as a functor parametrised by your data, but of course, you can shortcut this and directly uses the implementation definition.  The data of your problem is described by a module Parameter having the signature P</p>\n\n<pre><code>module type P =\nsig\n    type t\n    val get : unit -&gt; t option\n    val put1 : t -&gt; unit Success.t\n    val put2 : unit -&gt; unit Success.t\nend\n</code></pre>\n\n<p>A possible implementation of the snippet above would be</p>\n\n<pre><code>module M(Parameter:P) =\nstruct\n    open Success.Infix\n\n    let success_get () =\n      match Parameter.get () with\n        | Some(x) -&gt; Success.return x\n        | None -&gt; Success.throw \"Parameter.get\"\n\n    let rec innerloop () =\n      Success.catch\n        (success_get () &gt;&gt;= Parameter.put1 &gt;&gt;= innerloop)\n        (Parameter.put2 &gt;=&gt; outerloop)\n    and outerloop () =\n      innerloop () &gt;&gt;= outerloop\nend\n</code></pre>\n\n<p>The function get_success maps the Maybe monad to the Success monad, providing an ad-hoc error description.  This is because you need this ad-hoc error description that you will not be able to do this transformation using only abstract monad combinators \u2013 or, to phrase this, more pedantically, there is no canonical mapping from Maybe into State because these mappings are parametrised by an error description.</p>\n\n<p>Once the success_get function is written, it is pretty straightforward to translate the branching conditions you described using mutually recursive functions and the Success.catch function, used to handle error conditions.</p>\n\n<p>I leave you the implementation in Haskell as an exercise. :)</p>\n\n<hr>\n\n<p>The complete signature of the Success module is</p>\n\n<pre><code>  module Success :\n  sig\n    type error = String.t\n    type 'a outcome =\n      | Success of 'a\n      | Error of error\n    type 'a t\n    val bind : 'a t -&gt; ('a -&gt; 'b t) -&gt; 'b t\n    val return : 'a -&gt; 'a t\n    val apply : ('a -&gt; 'b) t -&gt; 'a t -&gt; 'b t\n    val join : 'a t t -&gt; 'a t\n    val map : ('a -&gt; 'b) -&gt; 'a t -&gt; 'b t\n    val bind2 : 'a t -&gt; 'b t -&gt; ('a -&gt; 'b -&gt; 'c t) -&gt; 'c t\n    val bind3 : 'a t -&gt; 'b t -&gt; 'c t -&gt; ('a -&gt; 'b -&gt; 'c -&gt; 'd t) -&gt; 'd t\n    val bind4 :\n      'a t -&gt; 'b t -&gt; 'c t -&gt; 'd t -&gt; ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e t) -&gt; 'e t\n    val map2 : ('a -&gt; 'b -&gt; 'c) -&gt; 'a t -&gt; 'b t -&gt; 'c t\n    val map3 : ('a -&gt; 'b -&gt; 'c -&gt; 'd) -&gt; 'a t -&gt; 'b t -&gt; 'c t -&gt; 'd t\n    val map4 :\n      ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e) -&gt; 'a t -&gt; 'b t -&gt; 'c t -&gt; 'd t -&gt; 'e t\n    val dist : 'a t list -&gt; 'a list t\n    val ignore : 'a t -&gt; unit t\n    val filter : ('a -&gt; bool t) -&gt; 'a t list -&gt; 'a list t\n    val only_if : bool -&gt; unit t -&gt; unit t\n    val unless : bool -&gt; unit t -&gt; unit t\n    module Infix :\n      sig\n        val ( &lt;*&gt; ) : ('a -&gt; 'b) t -&gt; 'a t -&gt; 'b t\n        val ( &lt;$&gt; ) : ('a -&gt; 'b) -&gt; 'a t -&gt; 'b t\n        val ( &lt;* ) : 'a t -&gt; 'b t -&gt; 'a t\n        val ( &gt;* ) : 'a t -&gt; 'b t -&gt; 'b t\n        val ( &gt;&gt;= ) : 'a t -&gt; ('a -&gt; 'b t) -&gt; 'b t\n        val ( &gt;&gt; ) : 'a t -&gt; (unit -&gt; 'b t) -&gt; 'b t\n        val ( &gt;=&gt; ) : ('a -&gt; 'b t) -&gt; ('b -&gt; 'c t) -&gt; 'a -&gt; 'c t\n        val ( &lt;=&lt; ) : ('b -&gt; 'c t) -&gt; ('a -&gt; 'b t) -&gt; 'a -&gt; 'c t\n      end\n    val throw : error -&gt; 'a t\n    val catch : 'a t -&gt; (error -&gt; 'a t) -&gt; 'a t\n    val run : 'a t -&gt; 'a outcome\n  end\n</code></pre>\n\n<p>In order to stay succinct, I removed some type annotations and hid the natural transformation <code>T</code> from the signature.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 1, "last_activity_date": 1441383958, "creation_date": 1441383958, "answer_id": 32402625, "question_id": 32398321, "link": "https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either/32402625#32402625", "title": "Stateful computation with different types of short-circuit (Maybe, Either)", "body": "<p>Your question is a bit tricky, because you are asking an elegant way of something which is not really elegant. There is the <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html\" rel=\"nofollow\">Control.Monad.Loops</a> to write that type of loops. You'll probably need something like <code>whileJust'</code> or equivalent. Usually, we don't need to write <code>while</code> loops like that and plain old recursion is usually easiest.</p>\n\n<p>I tried to find an example of when I would need this type of code and I came with the following example. I want to build a list of list of strings entered by the user. Each line correspond to an entry in the list. An empty line starts a new list, and two empty lines stops the loop.</p>\n\n<p>Example</p>\n\n<pre><code>a\nb\nc\n\nd\ne\n\nf\n</code></pre>\n\n<p>Will give</p>\n\n<pre><code>[ [\"a\", \"b\", \"c\"\n, [\"d\", \"e\"]\n, [\"f\"]\n]\n</code></pre>\n\n<p>I would probably do the following in haskell</p>\n\n<pre><code>readMat :: IO [[String]]\nreadMat = reverse `fmap` go [[]]\n    where go sss = do\n                s &lt;- getLine\n                case s of\n                    \"\" -&gt; case sss of\n                        []:sss' -&gt; return sss' # the end\n                        _ -&gt; go ([]:sss)       # starts a new line\n                    _ -&gt; let (ss:ss') = sss\n                          in go ((ss ++ [s]):ss')\n</code></pre>\n\n<p>Just plain recursion.</p>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441393267, "post_id": 32402631, "comment_id": 52678079, "body": "except ghc complains there is no Control.Monad.Trans.Either :("}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1441395891, "post_id": 32402631, "comment_id": 52679267, "body": "@JakubDaniel, I think that&#39;s in the <code>either</code> package. Recent versions of <code>transformers</code> have <code>Control.Monad.Trans.Except</code>, which is pretty much the same."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1441400439, "post_id": 32402631, "comment_id": 52681217, "body": "If you use <code>ExceptT</code> instead of <code>EitherT</code> replace all of the <code>left</code>s with <code>throwE</code>, the <code>right</code>s with <code>return</code>, <code>runEitherT</code> with <code>runExceptT</code>, and <code>mapEitherT</code> with <code>mapExceptT</code>."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441434206, "post_id": 32402631, "comment_id": 52688017, "body": "what version of <code>ghc</code> (I am assuming these modules come with it) do you have? Or is it the <code>transformers</code>? again what version should I have?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1441436692, "post_id": 32402631, "comment_id": 52688511, "body": "<code>transformers</code> and <code>either</code> are both packages you can install. running <code>cabal update</code> and then <code>cabal install either</code> will install both of them."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1441384656, "last_edit_date": 1441384656, "creation_date": 1441383968, "answer_id": 32402631, "question_id": 32398321, "link": "https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either/32402631#32402631", "title": "Stateful computation with different types of short-circuit (Maybe, Either)", "body": "<p>You are looking for <a href=\"http://hackage.haskell.org/package/either/docs/Control-Monad-Trans-Either.html\" rel=\"noreferrer\"><code>EitherT</code></a> or <a href=\"http://hackage.haskell.org/package/mtl/docs/Control-Monad-Except.html\" rel=\"noreferrer\"><code>ExceptT</code></a>. It adds two ways to return to a transformer stack. The computation can either <code>return a</code> or <code>throwError e</code>. There are two differences between errors and returns. Errors are held on the <code>Left</code> and returns on the <code>Right</code>. When you <code>&gt;&gt;=</code> onto an error it short circuits.</p>\n\n<pre><code>newtype EitherT e m a = EitherT { runEitherT :: m (Either e a) }\n\nreturn :: a -&gt; EitherT e m a\nreturn a = EitherT $ return (Right a)\n\nthrowError :: e -&gt; EitherT e m a\nthrowError e = EitherT $ return (Left a)\n</code></pre>\n\n<p>We will also use the names <code>left = throwError</code> and <code>right = return</code>.</p>\n\n<p>Errors on the <code>Left</code> don't continue, we will use them to represent exiting from a loop. We will use the type <code>EitherT r m ()</code> to represent a loop that either stops with a breaking result <code>Left r</code> or continues with a <code>Right ()</code>. This is almost exactly <code>forever</code>, except we unwrap the <code>EitherT</code> and get rid of the <code>Left</code> around the returned value.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Either\n\nuntilLeft :: Monad m =&gt; EitherT r m () -&gt; m r\nuntilLeft = liftM (either id id) . runEitherT . forever   \n</code></pre>\n\n<p>We'll come back to how to use these loops after fleshing out your example.</p>\n\n<p>Since you want to see almost all of the logic disappear, we'll use <code>EitherT</code> for everything else too. The computation that gets data is either <code>Done</code> or returns the data.</p>\n\n<pre><code>import Control.Monad.Trans.Class\nimport Control.Monad.Trans.State\n\ndata Done = Done       deriving Show\n\n-- Gets numbers for a while.\nget1 :: EitherT Done (State Int) Int\nget1 = do\n    x &lt;- lift get\n    lift . put $ x + 1\n    if x `mod` 3 == 0\n    then left Done\n    else right x\n</code></pre>\n\n<p>The first computation that puts data is either a <code>Failure</code> or returns.</p>\n\n<pre><code>data Failure = Failure deriving Show\n\nput1 :: Int -&gt; EitherT Failure (State Int) ()\nput1 x = if x `mod` 16 == 0\n         then left Failure\n         else right ()\n</code></pre>\n\n<p>The second computation that puts data is either a <code>Success</code> or returns.</p>\n\n<pre><code>data Success = Success deriving Show\n\nput2 :: EitherT Success (State Int) ()\nput2 = do \n        x &lt;- lift get\n        if x `mod` 25 == 0\n        then left Success\n        else right ()\n</code></pre>\n\n<p>For your example, we will need to combine two or more computations that both stop exceptionally in different ways. We will represent this with two nested <code>EitherT</code>s.</p>\n\n<pre><code>EitherT o (EitherT i m) r\n</code></pre>\n\n<p>The outer <code>EitherT</code> is the one we are currently operating over. We can convert an <code>EitherT o m a</code> to an <code>EitherT o (EitherT i m) a</code> by adding an extra <code>EitherT</code> layer around every <code>m</code><sup>\u2020</sup>.</p>\n\n<pre><code>over :: (MonadTrans t, Monad m) =&gt; EitherT e m a -&gt; EitherT e (t m) a\nover = mapEitherT lift\n</code></pre>\n\n<p>The inner <code>EitherT</code> layer will be treated just like any other underlying monad in the transformer stack. We can <code>lift</code> an <code>EitherT i m a</code> to an <code>EitherT o (EitherT i m) a</code></p>\n\n<p>We can now build an overall computation that either succeeds or fails. Computations that would break the current loop are operated <code>over</code>. Computations that would break an outer loop are <code>lift</code>ed.</p>\n\n<pre><code>example :: EitherT Failure (State Int) Success\nexample =\n    untilLeft $ do\n        lift . untilLeft $ over get1 &gt;&gt;= lift . put1\n        over put2\n</code></pre>\n\n<p>Overall <code>Failure</code> is <code>lift</code>ed twice into the innermost loop. This example is sufficiently interesting to see a few different results.</p>\n\n<pre><code>main = print . map (runState $ runEitherT example) $ [1..30]\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup>If <code>EitherT</code> had an <a href=\"http://hackage.haskell.org/package/mmorph/docs/Control-Monad-Morph.html#t:MFunctor\" rel=\"noreferrer\"><code>MFunctor</code></a> instance, <code>over</code> would just be <code>hoist lift</code>, which is a pattern that is used so often it deserves its own well thought out name. Incidentally, I use <code>EitherT</code> over <code>ExceptT</code> primarily because it has a less loaded name. Whichever one provides an <code>MFunctor</code> instance first will, for me, finally win out as the either monad transformer.</p>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441471036, "post_id": 32415067, "comment_id": 52697360, "body": "What about execution along the lines <code>(get &gt;&gt;= put1) &gt;&gt; put2</code>? I think that is not supported by your translation into a single loop. For every invocation of <code>put2</code> you seem to require to consume input with <code>get</code> without passing it to <code>put1</code>, but what if there is one entry in the input that has to trigger both <code>put1</code> and <code>put2</code>? i.e. there is input which lets you into the first loop and <code>put1</code> is executed, which modifies the state so that no other entry is discovered and <code>put2</code> is executed."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441471875, "post_id": 32415067, "comment_id": 52697628, "body": "I think my answer is valid for the loop you have at the top of your question. Let me know if I am mistaken. If you have a different loop in mind let&#39;s discuss that in separate question."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441475074, "post_id": 32415067, "comment_id": 52698555, "body": "Hmmm..  perhaps we were both confused for a moment. Here&#39;s the deal: I am assuming that <code>put1</code> can exit but if it does it exits both loops. This is one of the reasons why I asked that question in the comments. If <code>put1</code> can  exit just the inner loop then you can have <code>get</code> followed by <code>put1</code> followed by <code>put2</code>. So I think my answer is valid if <code>put1</code> either exits both loops or returns back to <code>get</code>."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441475261, "post_id": 32415067, "comment_id": 52698617, "body": "But still, you introduce branching. My idea was that in my case the more important thing is that there is cycle that fetches data and reacts to them in some way. It does so while there are such data. And every time we are done with this we also perform some cleanup. the exact conditions can be hidden and abstracted away. What is important for me and for the readability in my case is the chaining of actions. If that makes sense."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441475319, "post_id": 32415067, "comment_id": 52698631, "body": "You were right with the transformation, I got confused for a while."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1441469263, "last_edit_date": 1441469263, "creation_date": 1441468937, "answer_id": 32415067, "question_id": 32398321, "link": "https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either/32415067#32415067", "title": "Stateful computation with different types of short-circuit (Maybe, Either)", "body": "<p>This might overlap a bit with @Cirdec 's answer, but it also might help you gain a better perspective of what's going on.</p>\n\n<p>The first thing to notice is that you really don't have doublely-nested loops. Without the exit statements, here is how you could write it as a simple loop:</p>\n\n<pre><code>example1 = forever $ do\n  x &lt;- getNext                -- get the next String\n  if (isPrefixOf \"break-\" x)  -- do we break out of the \"inner\" loop?\n    then put2 x\n    else put1 x\n  where\n    put1 x = putStrLn $ \"put1: \" ++ x\n    put2 x = putStrLn $ \"put2: \" ++ x\n</code></pre>\n\n<p>So now we just use the standard technique of using <code>runEitherT</code> for breaking out of a loop.</p>\n\n<p>First some imports:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Either\nimport Control.Monad.State.Strict\nimport Data.List\n</code></pre>\n\n<p>and our result type and a convenience function:</p>\n\n<pre><code>data Result = Success String | Fail String deriving (Show)\n\nexit = left\n</code></pre>\n\n<p>We then rewrite our loop lifting any IO actions and use <code>exit</code> when we want to break out of the loop:</p>\n\n<pre><code>example2 match =\n  let loop = runEitherT $ forever $ do\n        x &lt;- getNext\n        if isPrefixOf \"break-\" x\n          then put2 x\n          else put1 x\n        where\n          put1 \"fail\" = exit (Fail \"fail encountered\")\n          put1 x      = liftIO $ putStrLn $ \"put1: \" ++ x\n\n          put2 x      = if x == match\n                          then exit (Success $ \"found \" ++ match)\n                          else liftIO $ putStrLn $ \"put2: \" ++ x\n  in loop\n</code></pre>\n\n<p>Here are some tests:</p>\n\n<pre><code>-- get next item from the state list:\ngetNext = do (x:xs) &lt;- get; put xs; return x\n\ntest2a = evalStateT (example2 \"break-foo\") [ \"a\", \"b\", \"fail\" ]\ntest2b = evalStateT (example2 \"break-foo\") [ \"a\", \"b\", \"break-foo\", \"c\", \"fail\" ]\ntest2c = evalStateT (example2 \"break-foo\") [ \"a\", \"b\", \"break-xxx\", \"c\", \"fail\" ]\n</code></pre>\n\n<p>The output of these tests are:</p>\n\n<pre><code>ghci&gt; test2a\nput1: a\nput1: b\nLeft (Fail \"fail encountered\")\n\nghci&gt; test2b\nput1: a\nput1: b\nLeft (Success \"found break-foo\")\n\nghci&gt; test2c\nput1: a\nput1: b\nput2: break-xxx\nput1: c\nLeft (Fail \"fail encountered\")\n</code></pre>\n\n<p>In this example the returned value of <code>runEitherT</code> will always be <code>Left r</code> where <code>r</code> is the <code>Result</code> value, so the code calling one of these examples might look like:</p>\n\n<pre><code>Left r &lt;- test2a\ncase r of\n  Success ... -&gt;\n  Fail    ... -&gt; \n</code></pre>\n\n<p>Note that instead of a custom <code>Result</code> type you could just use <code>Either String String</code>:</p>\n\n<pre><code>type Result = Either String String\n</code></pre>\n\n<p>and use <code>Left</code> for <code>Fail</code> and <code>Right</code> for <code>Success</code>.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 32402631, "answer_count": 4, "score": 4, "last_activity_date": 1441469263, "creation_date": 1441370384, "last_edit_date": 1495541173, "question_id": 32398321, "link": "https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either", "title": "Stateful computation with different types of short-circuit (Maybe, Either)", "body": "<p>I am trying to find the most elegant way of converting the following stateful imperative piece of code to pure functional representation (preferably in Haskell to use abstraction that its Monad implementation offers). However I am not yet good at combining different monads using transformers and the like. It seems to me, that analyzing other's takes on such tasks helps the best when learning how to do it myself. The imperative code:</p>\n\n<pre><code>while (true) {\n  while (x = get()) { // Think of this as returning Maybe something\n    put1(x) // may exit and present some failure representation\n  }\n  put2() // may exit and present some success representation\n}\n</code></pre>\n\n<p>When <code>get</code> returns <code>Nothing</code> we need the execution to continue with <code>put2</code>, when <code>get</code> returns <code>Just x</code> we want the <code>x</code> to get passed to <code>put1</code> and short-circuit only if <code>put1</code> fails or loop otherwise. Basically <code>put1</code> and <code>put2</code> may terminate the whole thing or move to the following statement changing the underlying state somehow. <code>get</code> can either succeed and invoke <code>put1</code> and loop or fail and continue to <code>put2</code>.</p>\n\n<p>My idea was something along:</p>\n\n<pre><code>forever $ do\n  forever (get &gt;&gt;= put1)\n  put2\n</code></pre>\n\n<p>And why I was looking for something like that is because <code>(get &gt;&gt;= put1)</code> could simply short-circuit whenever <code>get</code> has nothing to return or <code>put1</code> terminates. Similarly <code>put2</code> terminates the outer loop. However I am not sure how to mix the <code>State</code> with the necessary <code>Maybe</code> and/or <code>Either</code> to achieve this.</p>\n\n<p>I think using transformers to combine <code>State</code> and the other monads is necessary and thus the code will most probably not be that succint. But I guess it as well might not be much worse.</p>\n\n<p>Any suggestion how to achieve the translation elegantly is welcome. This differs from \"<a href=\"https://stackoverflow.com/questions/32391924/stateful-loop-with-different-types-of-breaks\">Stateful loop with different types of breaks</a>\" in avoiding explicit control-flow using <code>if</code>, <code>when</code>, <code>while</code> and rather tries to encourage use of <code>Maybe</code>, <code>Either</code>, or some other handy <code>&gt;&gt;=</code> semantics. Also there is always a straight-forward way how to translate the code into a functional one, however it can hardly be considered elegant.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1441362711, "post_id": 32395570, "comment_id": 52660172, "body": "Where have you defined <code>B</code> and <code>C</code> ?"}, {"owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1441363700, "post_id": 32395570, "comment_id": 52660799, "body": "@Sibi Earlier in the code. Each is a <code>Data</code> with name, and some other relevant values. They each work individually."}, {"owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "edited": false, "score": 0, "creation_date": 1441364291, "post_id": 32395570, "comment_id": 52661155, "body": "Try to define dM directly in your typeclass as a default implementation. At the moment, you&#39;re trying to use the instance of B/C, inside the definition of the instance itself."}], "answers": [{"tags": [], "owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "is_accepted": true, "score": 0, "last_activity_date": 1441365214, "creation_date": 1441365214, "answer_id": 32396698, "question_id": 32395570, "link": "https://stackoverflow.com/questions/32395570/function-wont-read-from-two-typeclasses/32396698#32396698", "title": "Function won&#39;t read from two typeclasses", "body": "<p>I got it working now.</p>\n\n<pre><code>class A a where\n  name :: a -&gt; String\n  dMs :: [a] -&gt; [(String,String,Double)]\n\ninstance A B where\n  name s = B s\n  dMs a = dM a\n\ninstance A C where\n  name s = C s\n  dMs a = dM a\n\ndM :: (A a) =&gt; [a] -&gt; [(String,String,Double)]\n</code></pre>\n\n<p>So what did it was specifying in <code>Class</code> that it should take a list of <code>a</code>, like this: <code>[a]</code>.</p>\n\n<p>Thanks for the help everyone.</p>\n"}], "owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 32396698, "answer_count": 1, "score": 0, "last_activity_date": 1441365214, "creation_date": 1441361783, "last_edit_date": 1441361904, "question_id": 32395570, "link": "https://stackoverflow.com/questions/32395570/function-wont-read-from-two-typeclasses", "title": "Function won&#39;t read from two typeclasses", "body": "<p>I declared a class and two instances:</p>\n\n<pre><code>class A a where\n  name :: a -&gt; String\n  dMs :: a -&gt; [(String,String,Double)]\n\ninstance A B where\n  name s = B s\n  dMs a = dM a\n\ninstance A C where\n  name s = C s\n  dMs a = dM a\n\ndM :: (A a) =&gt; [a] -&gt; [(String,String,Double)]\n</code></pre>\n\n<p>But when I compile my with the header above I get an error:</p>\n\n<pre><code>Couldn't match expected type \u2018[a0]\u2019 with actual type \u2018C\u2019\n    In the first argument of \u2018dM\u2019, namely \u2018a\u2019\n    In the expression: dM a\n</code></pre>\n\n<p>I want the <code>dM</code> function to be able to take a list of types <code>B</code> or <code>C</code>.</p>\n\n<p>If I change the header to accept just one type (either just <code>B</code> or just <code>C</code>) the code compiles and works without a glitch.</p>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1441356727, "post_id": 32393864, "comment_id": 52656431, "body": "I have no idea, but I really hope they are equivalent. I&#39;d expect them to be."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1441357342, "post_id": 32393864, "comment_id": 52656790, "body": "I&#39;d also like to know about <code>a -&gt; b c, b -&gt; a c, c -&gt; a b</code> in relation..."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1441357517, "post_id": 32393864, "comment_id": 52656902, "body": "@Andr&#225;sKov&#225;cs Good point, I added it to the question."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1441359260, "post_id": 32393864, "comment_id": 52657954, "body": "I&#39;d start by reading the original fundep paper: <a href=\"http://web.cecs.pdx.edu/~mpj/pubs/fundeps-esop2000.pdf\" rel=\"nofollow noreferrer\">web.cecs.pdx.edu/~mpj/pubs/fundeps-esop2000.pdf</a>"}], "answers": [{"tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": false, "score": 1, "last_activity_date": 1441533797, "creation_date": 1441533797, "answer_id": 32422312, "question_id": 32393864, "link": "https://stackoverflow.com/questions/32393864/all-type-parameters-depending-on-each-other-in-functional-dependencies/32422312#32422312", "title": "All type parameters depending on each other in functional dependencies", "body": "<p>Operationally, all of the above are equivalent:</p>\n\n<p>First of all, <code>a -&gt; b c</code> is quite literally the same thing as <code>a -&gt; b, a -&gt; c</code>.</p>\n\n<p>Next, assume we got <code>Foo a b c =&gt; (a, b, c)</code>. Say, we realize that <code>a ~ A</code>. We find the <code>a -&gt; b</code> fundep and scan through instances to find <code>b ~ B</code>. Again we find the <code>b -&gt; c</code> fundep and realize <code>c ~ C</code>. Voila we got <code>(A, B, C)</code>.</p>\n\n<p>If instead we had <code>Bar a b c =&gt; (a, b, c)</code> with <code>a ~ A</code>, we would've found <code>a -&gt; b</code>, and <code>b ~ B</code>, however before finding <code>b -&gt; c</code>, we would have found <code>a -&gt; c</code>.</p>\n\n<p>The only difference is which fundep arrows are used to infer the types. <code>a -&gt; b, b -&gt; c</code> and <code>a -&gt; b, a -&gt; c</code> can't produce different results.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 4, "answer_count": 1, "score": 14, "last_activity_date": 1441533797, "creation_date": 1441356507, "last_edit_date": 1441357502, "question_id": 32393864, "link": "https://stackoverflow.com/questions/32393864/all-type-parameters-depending-on-each-other-in-functional-dependencies", "title": "All type parameters depending on each other in functional dependencies", "body": "<p>Let's say I have a type class with <em>n</em> type parameters and I want any of them to uniquely determine all the other ones. Is it enough to make the dependencies form a cycle like in</p>\n\n<pre><code>class Foo a b c | a -&gt; b, b -&gt; c, c -&gt; a\n</code></pre>\n\n<p>(linear) where there is a path from every parameter to every other one, or do I need to expand all possible paths like in</p>\n\n<pre><code>class Bar a b c | a -&gt; b, a -&gt; c, b -&gt; a, b -&gt; c, c -&gt; a, c -&gt; b\n</code></pre>\n\n<p>(quadratic)? Is there any observable difference between the two? And how about</p>\n\n<pre><code>class Baz a b c | a -&gt; b c, b -&gt; a c, c -&gt; a b\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1441356559, "post_id": 32393182, "comment_id": 52656320, "body": "Probably you&#39;ll find only a few packages making a use of mutually recursive modules. However, I have the felling that, even if GHC supported them perfectly, there would be still only a few of them. My guess is that module mutual recursion can be a symptom of bad design: one was not able to define a standalone module for the other to depend on, so the interfaces are broken and mutual dependencies arise."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1441370077, "post_id": 32393182, "comment_id": 52664435, "body": "As it stands this question isn&#39;t fit for SO. Provide an explicit <i>programming problem</i>. If you want to ask about statistics of GHC you should probably use some mailing list or irc channel related to haskell/ghc or use haskell&#39;s chat here on SO but not a SO question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441397622, "post_id": 32393182, "comment_id": 52680045, "body": "It&#39;s rare enough and hairy enough that I wouldn&#39;t be shocked if it eventually went away."}], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1441354224, "creation_date": 1441354224, "question_id": 32393182, "link": "https://stackoverflow.com/questions/32393182/mutually-recursive-modules-in-practice", "title": "Mutually recursive modules in practice", "body": "<p>Given that making GHC compile mutually recursive modules is a bit laborious, I'd like to know how this affects the use of mutually recursive modules in practice? </p>\n\n<p>Do people try to avoid them? \nDo we have any figures, for example, how many packages on Hackage use this feature?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1441352968, "post_id": 32391924, "comment_id": 52654236, "body": "You should look into <a href=\"https://hackage.haskell.org/package/either-4.4.1/docs/Control-Monad-Trans-Either.html\" rel=\"nofollow noreferrer\"><code>EitherT (State Env Result)</code></a>. Let me know if that hint is not enough and you need more details :)"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1441354202, "post_id": 32391924, "comment_id": 52654939, "body": "I get the feeling this might be what I need except I don&#39;t have the slightest idea how to use it in this scenario :(. If you would be so kind to elaborate I would be ever so grateful."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441354057, "post_id": 32392965, "comment_id": 52654845, "body": "Thank you, I hoped there was a way all the control-flow-like stuff (when) could be hidden in some abstraction (as maybe/either monads hide) also the two results are of different type, this example assumes both results to be IO String. I wish the whole thing to return either Success or Failure or never terminate."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441354340, "post_id": 32392965, "comment_id": 52655025, "body": "If the results are of different types, you can use <code>Either A B</code> instead of <code>String</code> so that you can use that as the common type, after some <code>Left&#47;Right</code> wrapping. You probably are already aware of that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441354781, "post_id": 32392965, "comment_id": 52655286, "body": "There might be some more elegant way to abstract everything using some clever looping combinator from some library. However, the code is pretty imperative and stateful: each line affects the state somehow. The imperative snippet is also quite simple -- I don&#39;t know if we can beat that in terms of clarity. Maybe someone else will come with a better solution."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441354898, "post_id": 32392965, "comment_id": 52655357, "body": "@JakubDaniel I also realized you only need <code>State</code> instead of <code>IO</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1441356149, "last_edit_date": 1441356149, "creation_date": 1441353495, "answer_id": 32392965, "question_id": 32391924, "link": "https://stackoverflow.com/questions/32391924/stateful-loop-with-different-types-of-breaks/32392965#32392965", "title": "Stateful loop with different types of breaks", "body": "<p>An almost literal, non elegant but effective translation.</p>\n\n<p>We exploit the <code>ContT</code> monad transformer to achieve the effect of \n\"early return\". I.e., we want to be able to break our loops at any point. This is achieved by using <code>callCC $ \\exit -&gt; ...</code> which roughly makes <code>exit</code> our magic function which let us escape from the inner blocks immediately.</p>\n\n<pre><code>import Control.Monad.Cont\n\naction :: IO String\naction = flip runContT return $ callCC $ \\exit -&gt; \n   forever $ do                   -- while (true)\n      let loop = do\n             r1 &lt;- lift $ get     -- if (get())\n             when r1 $ do\n                r2 &lt;- lift $ put1\n                when r2 $         -- if (put1())\n                   exit \"failImmediately\"\n                loop              -- \"repeat while\"\n      loop\n      r3 &lt;- lift $ put2\n      when r3 $\n         exit \"succeedImmediately\"\n\nget :: IO Bool\nget = readLn\n\nput1 :: IO Bool\nput1 = putStrLn \"put1 here\" &gt;&gt; readLn\n\nput2 :: IO Bool\nput2 = putStrLn \"put2 here\" &gt;&gt; readLn\n\nmain :: IO ()\nmain = action &gt;&gt;= putStrLn\n</code></pre>\n\n<p>We can also define some custom helpers to prettify the code:</p>\n\n<pre><code>action2 :: IO String\naction2 = flip runContT return $ callCC $ \\exit -&gt; \n   forever $ do                -- while (true)\n      whileM get $             -- while(get())\n         whenM put1 $          -- if (put1())\n            exit \"failImmediately\"\n      whenM put2 $             -- if (put2())\n         exit \"succeedImmediately\"\n\nwhenM :: (MonadTrans t, Monad m, Monad (t m)) =&gt; m Bool -&gt; t m () -&gt; t m ()\nwhenM condition a = do\n   r &lt;- lift condition\n   when r a\n\nwhileM :: (MonadTrans t, Monad m, Monad (t m)) =&gt; m Bool -&gt; t m () -&gt; t m ()\nwhileM condition a = whenM condition (a &gt;&gt; whileM condition a)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1441356243, "post_id": 32393543, "comment_id": 52656106, "body": "I agree -- <code>ContT</code> is a bit overkill for this."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1441367956, "post_id": 32393543, "comment_id": 52663183, "body": "Thank you, that seems to solve my original question (when I replace IO with State). Couldn&#39;t it be even simpler considering the &quot;edit&quot; of my original post?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1441368195, "post_id": 32393543, "comment_id": 52663314, "body": "There&#39;s probably a <code>MonadPlus</code>-based solution to that... maybe worth a separate question (with the reduced question scope)"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 6, "last_activity_date": 1441355508, "creation_date": 1441355508, "answer_id": 32393543, "question_id": 32391924, "link": "https://stackoverflow.com/questions/32391924/stateful-loop-with-different-types-of-breaks/32393543#32393543", "title": "Stateful loop with different types of breaks", "body": "<p>Using the kit from @chi's answer, just highlighting that you don't need the full power of <code>ContT</code>, the direct-short-circuiting semantics of <a href=\"https://hackage.haskell.org/package/either\"><code>EitherT</code></a> is enough:</p>\n\n<pre><code>import Control.Monad.Trans.Either\n\ndata Result a = Failure | Success a\n\nfoo :: EitherT (Result Int) IO Int\nfoo = forever $ do\n    whileM get $ do\n        whenM put1 $ do\n            left Failure\n    whenM put2 $ do\n        left $ Success 42\n\nrun :: (Monad m) =&gt; EitherT (Result a) m a -&gt; m (Maybe a)\nrun act = do\n    res &lt;- runEitherT act\n    return $ case res of\n        Left Failure -&gt; Nothing\n        Left (Success x) -&gt; Just x\n        Right x -&gt; Just x\n\n-- whenM / whileM and get/put1/put2 as per @chi's answeer\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 32393543, "answer_count": 2, "score": 5, "last_activity_date": 1441376659, "creation_date": 1441349940, "last_edit_date": 1495542124, "question_id": 32391924, "link": "https://stackoverflow.com/questions/32391924/stateful-loop-with-different-types-of-breaks", "title": "Stateful loop with different types of breaks", "body": "<p>I am trying to convert the following stateful imperative code into Haskell.</p>\n\n<pre><code>while (true) {\n  while (get()) {\n    if (put1()) {\n      failImmediately();\n    }\n  }\n  if (put2()) {\n    succeedImmediately();\n  }\n}\n</code></pre>\n\n<p>Both the <code>put1</code> and <code>put2</code> read a state of the system and modify it. <code>get</code> can for simplicity just read the state. <code>failImmediately</code> should break out of the endless-loop and present one type of result, <code>succeedImmediately</code> should also break out but present a different result.</p>\n\n<p>What I tried to use was <code>State Env Result</code> where <code>Env</code> represented the state of environment and <code>Result</code> was something like <code>Either Failure Success</code> for some custom <code>Failure</code> and <code>Success</code>.</p>\n\n<p>I struggle with the requirement that the whole resulting expression should collapse into the <code>Failure</code>/<code>Success</code> once one of them is produced (breaking the loop) and otherwise keep going.</p>\n\n<p>One idea I had was use <code>Either Exit ()</code> where <code>data Exit = Success | Failure</code> and use <code>StateT</code> somehow to behave upon <code>Left</code> of the <code>Either</code> as if <code>Either</code> was the monad being chained, i.e. ignoring any subsequent actions.</p>\n\n<p>I would really appreciate any inspiration or sample of haskell code that would achieve the same behaviour as the snippet above.</p>\n\n<p><strong>Edit:</strong> refined version moved to a separate question \"<a href=\"https://stackoverflow.com/questions/32398321/stateful-computation-with-different-types-of-short-circuit-maybe-either\">Stateful computation with different types of short-circuit (Maybe, Either)</a>\".</p>\n"}, {"tags": ["python", "haskell", "frp"], "comments": [{"owner": {"reputation": 1887, "user_id": 3999025, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f179f4542183c3253e22896da1a813be?s=128&d=identicon&r=PG&f=1", "display_name": "Yu Zhang", "link": "https://stackoverflow.com/users/3999025/yu-zhang"}, "edited": false, "score": 0, "creation_date": 1441341699, "post_id": 32390172, "comment_id": 52649349, "body": "Did your second &quot;this&quot; miss its link? I&#39;ve found this paper about <b>this</b> topic but I did not find any review about what is available."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1441341731, "post_id": 32390172, "comment_id": 52649355, "body": "The overwhelming majority of the python community has no particular interest in functional programming beyond basic operations like maps and folds perhaps. It&#39;s just not the kind of community where FRP, which is right now still arguably in the research stage, would become hugely popular."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1441341996, "post_id": 32390172, "comment_id": 52649438, "body": "@Cubic : interesting point."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4322779"}, "edited": false, "score": 1, "creation_date": 1441343669, "post_id": 32390172, "comment_id": 52649907, "body": "Note there is a difference between FRP and RP as pointed out by Andr&#233; Staltz at <a href=\"https://gist.github.com/staltz/868e7e9bc2a7b8c1f754\" rel=\"nofollow noreferrer\">gist.github.com/staltz/868e7e9bc2a7b8c1f754</a>, which is worth reading if you are interested in RP.  This is mentioned in the 2nd comment where he says that FRP is a fuctional programming variant of RP.  I understand this to mean that FRP is one way of implementing RP and both share a common set of traits such as event-driven, responsive, scalable and resilient in terms of TypeSafe&#39;s reactive manifesto, see <a href=\"http://www.slideshare.net/deanwampler/reactive-design-languages-and-paradigms\" rel=\"nofollow noreferrer\">slideshare.net/deanwampler/&hellip;</a>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1441344072, "post_id": 32390172, "comment_id": 52650014, "body": "I know Andre, we co-organize  <a href=\"http://www.meetup.com/Helsinki-Functional-Reactive-Programming-Meetup/\" rel=\"nofollow noreferrer\">meetup.com/Helsinki-Functional-Reactive-Programming-Meetup</a>. My question is restricted to FRP."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1441351051, "post_id": 32390172, "comment_id": 52653126, "body": "To closers : if you close this question, then please also close this too : <a href=\"http://stackoverflow.com/questions/13341937/whats-the-status-of-current-functional-reactive-programming-implementations\" title=\"whats the status of current functional reactive programming implementations\">stackoverflow.com/questions/13341937/&hellip;</a> , otherwise, please reopen because this question is useful, in my very humble opinion."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 2, "creation_date": 1441353350, "post_id": 32390172, "comment_id": 52654433, "body": "@jhegedus don&#39;t blame closers. I voted to reopen but it took me a while (and the link to the Haskell question) to decide this wasn&#39;t a &quot;too lazy to search&quot; question. That other question is much more specific. For example, it doesn&#39;t just link to some articles, it provides a summary of what&#39;s in them. As it is, your question forces people to go read the articles just to understand what you are asking. You still need to persuade two others, so I suggest you improve the question"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1441355851, "post_id": 32390172, "comment_id": 52655872, "body": "@PanagiotisKanavos, right, I agree. I try to improve the question."}], "answers": [{"tags": [], "owner": {"reputation": 443, "user_id": 4583360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/478ef0d11191c68763d6bb60f416d300?s=128&d=identicon&r=PG&f=1", "display_name": "Red Pill", "link": "https://stackoverflow.com/users/4583360/red-pill"}, "is_accepted": false, "score": 4, "last_activity_date": 1462975111, "creation_date": 1462975111, "answer_id": 37164923, "question_id": 32390172, "link": "https://stackoverflow.com/questions/32390172/what-is-the-status-of-functional-reactive-programming-in-python/37164923#37164923", "title": "What is the status of Functional Reactive Programming in Python?", "body": "<p><a href=\"https://github.com/ReactiveX/RxPY/tree/develop\" rel=\"nofollow\">\"The Reactive Extensions for Python (RxPY)\"</a> is imho coming closest to FRP with Python. </p>\n"}, {"tags": [], "owner": {"reputation": 30544, "user_id": 1612318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IqAVI.jpg?s=128&g=1", "display_name": "Rotareti", "link": "https://stackoverflow.com/users/1612318/rotareti"}, "is_accepted": false, "score": 1, "last_activity_date": 1522253802, "creation_date": 1522253802, "answer_id": 49539530, "question_id": 32390172, "link": "https://stackoverflow.com/questions/32390172/what-is-the-status-of-functional-reactive-programming-in-python/49539530#49539530", "title": "What is the status of Functional Reactive Programming in Python?", "body": "<p>There is also <a href=\"https://github.com/dbrattli/aioreactive\" rel=\"nofollow noreferrer\">aioreactive</a>, which utilizes newer language features such as async/await.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3606, "favorite_count": 4, "answer_count": 2, "score": 16, "last_activity_date": 1522253802, "creation_date": 1441341476, "last_edit_date": 1442516051, "question_id": 32390172, "link": "https://stackoverflow.com/questions/32390172/what-is-the-status-of-functional-reactive-programming-in-python", "title": "What is the status of Functional Reactive Programming in Python?", "body": "<p>I've found <a href=\"http://www.cs.jhu.edu/~roe/padl2014.pdf\" rel=\"noreferrer\">this</a> paper (\"Practical Functional Reactive Programming\")  , the authors (as far as I understand) try to create an FRP library in Python in the spirit of <a href=\"https://wiki.haskell.org/Yampa\" rel=\"noreferrer\">Yampa</a>. </p>\n\n<p>I've also found <a href=\"http://freepdfs.net/functional-reactive-python-on-introducing-cs-to-high-school/13b2333fdf7d721efe4a5e15cf25a28a/\" rel=\"noreferrer\">these</a> interesting slides featuring SPJ! The slides seem conclude that it is not so easy to implement FRP in a dynamically typed language - unfortunately the bullet points in those slides do not really explain why.</p>\n\n<p>Why are there, apparently, not so many FRP implementations in Python? Why is it more prevalent in Haskell? Is the static typing really needed for FRP? How much do we gain by static typing in FRP? Is it super essential or can one get by without it (if one is only writing a few thousand lines of FRP code)?</p>\n\n<p>I really wonder, if <a href=\"https://github.com/SodiumFRP/sodium\" rel=\"noreferrer\">SodiumFRP</a> can be implemented in C, Java, Haskell etc. then what is the problem with Python? </p>\n\n<p>It is relevant to note that in JS there is no real FRP implementation either at the moment (2015.08.04), so that suggests that the lack of static typing in Python is the reason, I am not convinced though, hence the question.</p>\n\n<p>UPDATE: \nInterestingly, I've came across <a href=\"https://wiki.python.org/moin/FlowBasedProgramming\" rel=\"noreferrer\">Flow Based Programming</a> in Python. How do FBP and FRP relate to each other ? They only seem to differ just a little bit, at least, I have that first impression when I compare the bottom of the acronyms' middle characters.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441339992, "post_id": 32389885, "comment_id": 52648894, "body": "Off-topic: as a lapsed chemist, my eyes gleamed when I realised what you are defining :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1441339994, "post_id": 32389885, "comment_id": 52648895, "body": "the Problem is not with <code>DoubleBond</code> it&#39;s that you have two constructors with the same name - if you just would write <code>x = Unknown</code> what should the type of <code>x</code> be? - IMO just write <code>UnknownPosition</code> and <code>UnknownGeometry</code> and you are fine ;) // PS: if you really want to do this you can still move the definitions in different modules"}, {"owner": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "edited": false, "score": 0, "creation_date": 1441340360, "post_id": 32389885, "comment_id": 52648979, "body": "I agree, but you could get around that issue by writing x = Unknown :: DBPosition."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1441340471, "post_id": 32389885, "comment_id": 52649005, "body": "You could simply remove <code>Unknown</code> from the constructors and use the <code>Maybe</code> type: <code>data DoubleBond = DoubleBond (Maybe DBPosition) (Maybe DBGeometry); data DBGeometry = Cis | Trans</code>. Then you can write <code>DoubleBond Nothing Nothing</code>. If you really want to use the word <code>Unknown</code>, simply define your own <code>Maybe</code> type."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1441340625, "post_id": 32389885, "comment_id": 52649053, "body": "@MichaelT That wouldn&#39;t work. Being specified (digression: is there a better word to use when talking about the relation between parameter-less constructors and the corresponding values?) through a constructor means that <code>Unknown</code> can have just one type. You <i>might</i> achieve a similar effect with a type class, but I strongly recommend against it -- it really, really isn&#39;t worth the trouble."}], "answers": [{"comments": [{"owner": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "edited": false, "score": 0, "creation_date": 1441340677, "post_id": 32390004, "comment_id": 52649074, "body": "Thanks for your reply. This is similar the approach I have used so far instead I made the type <code>Identity a = Unknown | Known a</code>. This is essentially the same as <code>Maybe</code> so perhaps it I should just use <code>Maybe</code> to avoid duplicating the same functionality."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "edited": false, "score": 0, "creation_date": 1441341369, "post_id": 32390004, "comment_id": 52649254, "body": "@MichaelT, yes I recommend it.  There are many useful functions defined for working with <code>Maybe</code>s in <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html\" rel=\"nofollow noreferrer\"><code>Data.Maybe</code></a> -- I find the few that relate <code>Maybe</code>s to lists to be especially useful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "edited": false, "score": 1, "creation_date": 1441341422, "post_id": 32390004, "comment_id": 52649272, "body": "@MichaelT, using <code>Maybe</code> will save time and make it easier for others to understand your code. Also, <code>Identity</code> would be assumed by most Haskellers to refer to <code>Data.Functor.Identity.Identity</code>, defined as <code>newtype Identity a = Identity {runIdentity :: a}</code>, a fairly popular type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1441341753, "post_id": 32390004, "comment_id": 52649361, "body": "<code>Maybe</code> is an instance of some pretty useful things like <code>Functor</code>, <code>Applicative</code>, <code>Alternative</code>, <code>Monad</code>, and <code>Traversable</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 10, "last_activity_date": 1441340382, "creation_date": 1441340382, "answer_id": 32390004, "question_id": 32389885, "link": "https://stackoverflow.com/questions/32389885/allowing-multiple-declarations-of-data-constructors/32390004#32390004", "title": "Allowing multiple declarations of data constructors", "body": "<p>As Carsten pointed out above, your definition does not work because you have two constructors with the same name. You'd need to use e.g. <code>UnknownDBPosition</code> and <code>UnknownDBGeometry</code>. However, I'd argue a better solution arises from recognising:</p>\n\n<ul>\n<li>That the concept of an unknown value works in precisely the same way no matter if you are talking about double bond positions, geometries, or whatever else; and</li>\n<li>That <code>Unknown</code> is not actually a variety of double bond geometry or position.</li>\n</ul>\n\n<p>That being so, I recommend that you remove both <code>Unknown</code> and use <code>Maybe</code> to specify lack of knowledge.</p>\n\n<pre><code>data DBPosition = Omega Integer\n                | Delta Integer\n                deriving (Show, Eq, Ord)\n\ndata DBGeometry = Cis | Trans\n                deriving (Show, Eq, Ord)\n\ndata DoubleBond = DoubleBond (Maybe DBPosition) (Maybe DBGeometry)\n                deriving (Show, Eq, Ord)\n</code></pre>\n"}], "owner": {"reputation": 945, "user_id": 4610065, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/BTON9.jpg?s=128&g=1", "display_name": "Michael T", "link": "https://stackoverflow.com/users/4610065/michael-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1153, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1441340382, "creation_date": 1441339526, "last_edit_date": 1441340125, "question_id": 32389885, "link": "https://stackoverflow.com/questions/32389885/allowing-multiple-declarations-of-data-constructors", "title": "Allowing multiple declarations of data constructors", "body": "<p>I am currently experimenting with data types and I've ran into an issue involving multiple declarations of data constructors. </p>\n\n<pre><code>data DBPosition = Unknown\n                | Omega Integer\n                | Delta Integer\n                deriving (Show, Eq, Ord)\n\ndata DBGeometry = Unknown | Cis | Trans\n                deriving (Show, Eq, Ord)\n\ndata DoubleBond = DoubleBond DBPosition DBGeometry\n                deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>If I was to make a value such as - <code>let bond = DoubleBond Unknown Unknown</code>, then it could be inferred that the first <code>Unknown</code> has a type of <code>DBPosition</code> while the second <code>Unknown</code> has a type of <code>DBPosition</code>. Unfortunately this is not the case:</p>\n\n<pre><code>test.hs:6:27:\nMultiple declarations of `Unknown'\nDeclared at: test.hs:1:27\n             test.hs:6:27\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Are there any language extensions that can be used to get around this?</p>\n"}, {"tags": ["scala", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 3647, "user_id": 371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e1caa49eebfe37ffe3ef64e19364b0b3?s=128&d=identicon&r=PG", "display_name": "Silly Freak", "link": "https://stackoverflow.com/users/371191/silly-freak"}, "edited": false, "score": 1, "creation_date": 1441347232, "post_id": 32389513, "comment_id": 52651241, "body": "Just wanted to note that <code>Any</code> and <code>Nothing</code> are dual in that they are exact opposites: <code>Any</code>is the universal super type, <code>Nothing</code> is the universal subtype. Naturally, no value can be of type <code>Nothing</code>: perfect for describing the left portion of a <code>Right</code>!"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 10, "last_activity_date": 1441336603, "last_edit_date": 1441336603, "creation_date": 1441336558, "answer_id": 32389513, "question_id": 32389453, "link": "https://stackoverflow.com/questions/32389453/right-5-in-haskell-and-scala/32389513#32389513", "title": "`Right 5` in Haskell and Scala", "body": "<p><code>a</code> is, like <code>b</code> in this example, a type variable. It can be instantiated with any type (whereas <code>b</code> can be instantiated with any type that satisfies the constraint that it is also an instance of <code>Num</code>). </p>\n\n<p>The scala example works quite differently due to scala's type system being quite different; There is no real concept of a value ever having a not fully instantiated type, so you need to assign a type to the <code>Left</code> possibility of your <code>Either</code> value. Barring further constraints, this just ends up being <code>Nothing</code>. Due to the way scala's type system works (<code>Nothing</code> being a subtype of any other type, so you can think of it as a dual to the <code>Any</code> type) an <code>Either[Nothing,B]</code> is also an <code>Either[A,B]</code>  for any <code>A</code>. </p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 32389513, "answer_count": 1, "score": 10, "last_activity_date": 1441336603, "creation_date": 1441335993, "question_id": 32389453, "link": "https://stackoverflow.com/questions/32389453/right-5-in-haskell-and-scala", "title": "`Right 5` in Haskell and Scala", "body": "<p>In <code>ghci</code>, I ran:</p>\n\n<pre><code>ghci&gt; :t Right 5\nRight 5 :: Num b =&gt; Either a b\n</code></pre>\n\n<p>What's the meaning of <code>a</code>?</p>\n\n<p>How does it compare with Scala's version?</p>\n\n<pre><code>scala&gt; Right(5)\nres0: scala.util.Right[Nothing,Int] = Right(5)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 8, "creation_date": 1441323220, "post_id": 32386920, "comment_id": 52644369, "body": "This is too much to ask.  Remember that type classes are <i>open</i>, which means that the code must continue to compile when new instances are added. We could easily add an instance for <code>O M</code>, which would make your expression ambiguous, and hence it must already be ambiguous in an open world.  However, the new <a href=\"https://wiki.haskell.org/GHC/Type_families#Closed_family_simplification\" rel=\"nofollow noreferrer\">closed type families</a> extension might do what you want -- I haven&#39;t worked with them much so I can&#39;t be sure."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1441324489, "post_id": 32386920, "comment_id": 52644663, "body": "And in fact (using <code>FlexibleInstances</code>) you can simply define <code>x :: O M =&gt; K; x = f (o :: M)</code> and then use <code>x</code> in another module that has an <code>instance O M</code>. So in that sense the choice of the type of <code>o</code> in the expression <code>f o</code> really is ambiguous."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1441333002, "post_id": 32386920, "comment_id": 52647290, "body": "@ReidBarton, do you mean <code>FlexibleContexts</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441355354, "post_id": 32386920, "comment_id": 52655622, "body": "To stress the point luqui makes: if in another module I do <code>import YourModule ; instance O M where ...</code> suddenly <code>f o</code> can be implemented in two ways. That should generate an error like &quot;I&#39;m sorry but adding such an instance makes some other code you did not write ambiguous&quot; -- raising eyebrows. This would also require the compiler to remember all these cases of potential problems across modules. Instead, Haskell was designed to reject these cases at the source."}], "answers": [{"tags": [], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "is_accepted": false, "score": 1, "last_activity_date": 1441348396, "last_edit_date": 1441348396, "creation_date": 1441347554, "answer_id": 32391311, "question_id": 32386920, "link": "https://stackoverflow.com/questions/32386920/why-is-this-expression-ambiguous/32391311#32391311", "title": "Why is this expression ambiguous?", "body": "<p><code>o</code> returns any type: <code>o :: a</code>.</p>\n\n<p>Feeding it to <code>f</code> yields</p>\n\n<pre><code>:t f o\n  f o :: F a b =&gt; b\n</code></pre>\n\n<p>Which means that <code>a</code> can be any type here. So <code>o</code> is ambiguous.</p>\n\n<p><code>f o :: K</code> states <code>b</code> to be <code>K</code> in <code>f :: a -&gt; b</code> in <code>F a b</code>. </p>\n\n<p>Both cases above yields a possible instance for <code>f</code></p>\n\n<pre><code>instance F a0 K\n</code></pre>\n\n<p>which has a two candidates</p>\n\n<pre><code>instance F L K\n\ninstance K M K\n</code></pre>\n\n<p><code>o</code> returns any instance of <code>O</code> class. There are only two instances defined:</p>\n\n<pre><code>instance O K\ninstance O L\n</code></pre>\n\n<p>So <code>f o :: K</code> is ambiguous 'cause <code>o</code> is ambiguous.</p>\n\n<hr/>\n\n<p>I think <code>GHC</code> infers types in such a way (only searching for suitable instances) in order to do not stuck in a loop. But I'm only started to learn it so I can be wrong here.</p>\n\n<p>There are a techniques described <a href=\"http://okmij.org/ftp/Haskell/HList-ext.pdf\" rel=\"nofollow\">here</a> and <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow\">here (shortly)</a> which helps compiler to infer a correct instances.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1441348396, "creation_date": 1441322648, "question_id": 32386920, "link": "https://stackoverflow.com/questions/32386920/why-is-this-expression-ambiguous", "title": "Why is this expression ambiguous?", "body": "<p>Here, I defined two classes <code>F</code> and <code>O</code>. <code>F</code> is for a polymorphic function <code>f</code>, and <code>O</code> is for a polymorphic value <code>o</code>.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n\nclass F a b where\n    f :: a -&gt; b\n\nclass O a where\n    o :: a\n\ndata K = K \ndata L = L \ndata M = M \n\ninstance O K where\n    o = K \n\ninstance O L where\n    o = L \n\ninstance F K L where\n    f K = L \n\ninstance F L K where\n    f L = K \n\ninstance F L L where\n    f L = L \n\ninstance F M K where\n    f M = K \n</code></pre>\n\n<p>To make it easy, here is a list of possible instances for either class:</p>\n\n<pre><code>F K L\nF L K\nF L L\nF M K\n\nO K\nO L\n</code></pre>\n\n<p>Now if I type in the following into GHCi:</p>\n\n<pre><code>f o :: K\n</code></pre>\n\n<p>I expect Haskell to figure out that since the end result has to be <code>K</code>, it means possible instances for <code>f</code> are <code>F M K</code> and <code>F L K</code>, but since <code>o</code> can only be a <code>L</code> but not <code>M</code>, it has to be the case that <code>o</code> is <code>L</code> and <code>f</code> is <code>F L K</code>. That is, without any other possibility the result should be <code>K</code>. However, it turns out Haskell can't figure this out:</p>\n\n<pre><code>*Main&gt; f o :: K\n\n&lt;interactive&gt;:2:1:\n    No instance for (F a0 K) arising from a use of `f'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance F M K -- Defined at hw.hs:28:10\n      instance F L K -- Defined at hw.hs:22:10\n    Possible fix: add an instance declaration for (F a0 K)\n    In the expression: f o :: K\n    In an equation for `it': it = f o :: K\n\n&lt;interactive&gt;:2:3:\n    No instance for (O a0) arising from a use of `o'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance O L -- Defined at hw.hs:16:10\n      instance O K -- Defined at hw.hs:13:10\n    In the first argument of `f', namely `o'\n    In the expression: f o :: K\n    In an equation for `it': it = f o :: K\n</code></pre>\n\n<p>Do you think it is because the compiler isn't intelligent enough, or do you think there's actual ambiguity in my expression?</p>\n"}, {"tags": ["haskell", "quickcheck", "existential-type"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1441321218, "post_id": 32386560, "comment_id": 52643891, "body": "Is it possible to have a value of that type? Also, isn&#39;t that a rank-2 type, not an existential type?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441323759, "post_id": 32386560, "comment_id": 52644500, "body": "Indeed, the only values of that type look at least as bad as <code>Foo a1 (const undefined, const a2)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1441332381, "creation_date": 1441332381, "answer_id": 32389019, "question_id": 32386560, "link": "https://stackoverflow.com/questions/32386560/generating-an-existential-type-with-quickcheck/32389019#32389019", "title": "Generating an Existential type with QuickCheck?", "body": "<p>It's a bit hard to tell what you're really trying to do, especially since your example type doesn't make a lot of sense. Consider something else:</p>\n\n<pre><code>newtype WrappedLens s t a b = WrappedLens (forall f . Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t)\n\nnewtype WL = WL (WrappedLens (Int, Int) (Int, Int) Int Int)\n</code></pre>\n\n<p>Is it possible to make an arbitrary <code>WL</code>? Sure! Just pass <code>fmap</code> explicitly and use the arbitrary function instance. Is it possible to make an arbitrary <code>WL</code> that's a law-abiding lens? Now that is a much taller order.</p>\n\n<p>I would speculate that the hard thing about making arbitrary values involving higher rank types is not the types so much as the fact that they tend to involve functions in some fashion, and it's hard to constrain arbitrary functions to the ones you actually want to consider.</p>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 32389019, "answer_count": 1, "score": 3, "last_activity_date": 1441332381, "creation_date": 1441320163, "question_id": 32386560, "link": "https://stackoverflow.com/questions/32386560/generating-an-existential-type-with-quickcheck", "title": "Generating an Existential type with QuickCheck?", "body": "<p>I'm struggling with this one - how could QuickCheck generate a value <em>for all</em> types? Maybe it could forge it, and only test types with the context <code>Arbitrary a =&gt; a</code>?</p>\n\n<p>I'm just wondering how someone could make an instance of arbitrary for data constructors with an existential type:</p>\n\n<pre><code>data Foo a = Foo a (forall b. (a -&gt; b, b -&gt; a))\n</code></pre>\n"}, {"tags": ["list", "haskell", "types"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1441313884, "post_id": 32385213, "comment_id": 52641284, "body": "One easy way is <code>data Curve  = Curve Point [Point]</code>. Besides, for performance reasons, you could use <code>newtype</code> instead of <code>data</code> to define <code>Point</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1441314150, "post_id": 32385213, "comment_id": 52641420, "body": "Existing types defined the way @Jubobs suggested: <a href=\"http://hackage.haskell.org/package/semigroups-0.16.2.2/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\">NonEmpty</a>, <a href=\"http://hackage.haskell.org/package/non-empty-0.2.1/docs/Data-NonEmpty.html\" rel=\"nofollow noreferrer\">T</a> (haddock warning: Thielemann), <a href=\"http://hackage.haskell.org/package/NonEmpty-0.1/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\">NonEmpty</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441333804, "post_id": 32385213, "comment_id": 52647453, "body": "@DanielWagner, why does Henning merit a warning? Is there something wrong with his libraries that I haven&#39;t noticed?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1441336168, "post_id": 32385213, "comment_id": 52647983, "body": "@dfeuer The haddocks are very hard to read because every type is named <code>T</code> and every class is named <code>C</code>. In code, that&#39;s fine, because his style is to import everything qualified (so things look like <code>NonEmpty.T</code> or <code>Ring.C</code>), but haddock doesn&#39;t really deal with that style gracefully, resulting in type signatures that look like <code>(C a, C b) =&gt; T a -&gt; T b -&gt; T -&gt; T</code> and other such illegible nonsense."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1441350556, "creation_date": 1441350556, "answer_id": 32392105, "question_id": 32385213, "link": "https://stackoverflow.com/questions/32385213/haskell-define-a-non-empty-list-datatype/32392105#32392105", "title": "Haskell define a non-empty list datatype", "body": "<p>The list <code>[Point]</code> will always contain 0 or more <code>Point</code>s, so if you store an extra one, you get 1 + (0 or more) = 1 or <a href=\"https://en.wikipedia.org/wiki/Ordinal_arithmetic#Addition\" rel=\"nofollow\">more</a> <code>Point</code>s:</p>\n\n<pre><code>data Curve = Curve Point [Point]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 2, "last_activity_date": 1441410105, "creation_date": 1441410105, "answer_id": 32408022, "question_id": 32385213, "link": "https://stackoverflow.com/questions/32385213/haskell-define-a-non-empty-list-datatype/32408022#32408022", "title": "Haskell define a non-empty list datatype", "body": "<p>The <a href=\"https://hackage.haskell.org/package/semigroups-0.16.2.2/docs/Data-List-NonEmpty.html\" rel=\"nofollow\"><code>Data.List.NonEmpty</code></a> module, in the popular <code>semigroups</code> library, implements a non-empty list type, and utility functions for it.</p>\n\n<p>The solution is effectively the same as Cactus' answer, a pair that contains an obligatory first element and then a list for the rest:</p>\n\n<pre><code>data NonEmpty a = a :| [a]\n</code></pre>\n\n<p>So Cactus' <code>Curve</code> type would be equivalent to <code>NonEmpty Point</code>.</p>\n"}], "owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1441411331, "creation_date": 1441313551, "last_edit_date": 1441411331, "question_id": 32385213, "link": "https://stackoverflow.com/questions/32385213/haskell-define-a-non-empty-list-datatype", "title": "Haskell define a non-empty list datatype", "body": "<p>I have defined a data type like this for representing a 2D point:</p>\n\n<pre><code>data Point = Point (Double, Double) deriving (Show)\n</code></pre>\n\n<p>And a data type Curve (curve is a list of points in 2D space that create a curve</p>\n\n<pre><code>data Curve  = Curve [Point] deriving (Show)\n</code></pre>\n\n<p>How can I set the Curve datatype to be nonempty? so that it always needs to have at least 1 Point in the list?</p>\n"}, {"tags": ["sql", "haskell", "subquery", "esqueleto"], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1446726181, "post_id": 33517387, "comment_id": 54868717, "body": "I&#39;ll try it out and get back"}], "tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": false, "score": 2, "last_activity_date": 1446627113, "creation_date": 1446627113, "answer_id": 33517387, "question_id": 32380467, "link": "https://stackoverflow.com/questions/32380467/how-to-compose-queries-subselect-with-esqueleto/33517387#33517387", "title": "How to compose queries/subselect with Esqueleto?", "body": "<p>It seems to work by moving the \"4 legs\" restriction to the <code>on</code> clause instead of the <code>where_</code> clause:</p>\n\n<pre><code>fetchFarmsByCity1 city = select . from $\n  \\(farm `LeftOuterJoin` pig) -&gt; do\n    on $\n        (pig ?. PigFkFarm ==. just (farm ^. FarmId)\n        &amp;&amp;. (pig ?. PigNumberOfLegs ==. just (val 4)))\n    where_ $\n      farm ^. FarmCity ==. val city\n    return (farm, pig)\n</code></pre>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1446627113, "creation_date": 1441296116, "last_edit_date": 1495541962, "question_id": 32380467, "link": "https://stackoverflow.com/questions/32380467/how-to-compose-queries-subselect-with-esqueleto", "title": "How to compose queries/subselect with Esqueleto?", "body": "<p>Based on <a href=\"https://stackoverflow.com/a/16609411/2925659\">this answer</a>, I conclude that Esqueleto does not allow to compose two queries with a <code>left outer join</code>. However, I hope there still is a solution to my problem, somewhere.</p>\n\n<p>I want to do a left outer join with a table that is additionally restricted. Consider my first approach:</p>\n\n<pre><code>fetchFarmsByCity1 city = runDb . select . from $\n  \\(farm `LeftOuterJoin` pig) -&gt; do\n    on $ pig ?. PigFkFarm ==. just (farm ^. FarmId)\n    where_ $\n          pig ?. PigNumberOfLegs ==. val 4\n      &amp;&amp;. farm ^. FarmCity ==. val city\n    return (farm, pig)\n</code></pre>\n\n<ul>\n<li>I get all the farms and their 4-legged pigs.</li>\n<li>I get farms even if they don't have any pigs at all (thanks to the left outer join).</li>\n<li>However, I don't get the farm that has pigs with 2, 3, or 5 legs, but this is what I need: if the pigs have 3 legs, I want the farm without any pigs.</li>\n</ul>\n\n<p>My second approach is an sql-motivated subquery that fails already during type checking, probably because of the restriction linked on the top of this post:</p>\n\n<pre><code>pigsQuery = from $ \\pig -&gt; do\n  where_ $ pig ^. PigNumberOfLegs ==. val 4\n  return pig\n\nfetchFarmsByCity2 city = runDb . select . from $\n  \\(farm `LeftOuterJoin` pig) -&gt; do\n    pigs &lt;- pigsQuery\n    on $ pig ?. PigFkFarm ==. just (farm ^. FarmId)\n    where_ $\n          farm ^. FarmCity ==. val city\n</code></pre>\n\n<p>Is there another way to solve this? Can I somehow move the number-of-legs-restriction in front of the outer join (in the first approach)? Splitting it up into two queries would be my measure of last resort.</p>\n\n<p>I feel that this is standard enough to have alternative solutions.</p>\n"}, {"tags": ["eclipse", "haskell", "functional-programming", "eclipse-fp"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1441311386, "post_id": 32380319, "comment_id": 52640005, "body": "Its not what you asked for, but have you tried leksah? Its a native Haskell IDE."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441311792, "post_id": 32380319, "comment_id": 52640191, "body": "It seems that <code>ghc-pkg-lib</code> doesn&#39;t specify upper bounds for its dependencies, and you are getting a newer version of <code>Cabal</code> than it can successfully build with. Consider adding an explicit constraint like <code>Cabal &lt;= 1.19</code> to your install line manually (you can see from the <a href=\"http://hackage.haskell.org/package/ghc-pkg-lib-0.3/reports/1\" rel=\"nofollow noreferrer\">Hackage build logs</a> that it has successfully built with <code>Cabal-1.18.1.3</code>); and do send a note/smack to the package maintainer."}, {"owner": {"reputation": 179, "user_id": 1044582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/036290b0672bf3d70443a9600e65b21c?s=128&d=identicon&r=PG", "display_name": "Yury Kochubeev", "link": "https://stackoverflow.com/users/1044582/yury-kochubeev"}, "edited": false, "score": 0, "creation_date": 1441311968, "post_id": 32380319, "comment_id": 52640279, "body": "Have found updated version of Package.hs on Github, and build this module successfully, but broken in next module... Also found mention on github that EclipseFP is no longer maintained..."}, {"owner": {"reputation": 179, "user_id": 1044582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/036290b0672bf3d70443a9600e65b21c?s=128&d=identicon&r=PG", "display_name": "Yury Kochubeev", "link": "https://stackoverflow.com/users/1044582/yury-kochubeev"}, "edited": false, "score": 0, "creation_date": 1441313589, "post_id": 32380319, "comment_id": 52641139, "body": "And yes, i&#39;ve installed Leksah, but seems that it has less features..."}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1442229941, "post_id": 32380319, "comment_id": 52982196, "body": "As a previous eclipsefp user, i now switch to emacs ,which may have the best support for haskell presently with various plugins to autocomplete,give type hints etc.."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449772995, "post_id": 32380319, "comment_id": 56163003, "body": "@DanielWagner Any idea how to do change the command line EclipseFP uses?  The problem is that it attempts to install buildwrapper in a private sandbox automatically, and doesn&#39;t seem to provide any options that I can see for changing the versions of components it downloads... note that ghc-pkg-lib seems to have been updated, but the same error also appears in buildwrapper-0.9.1."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458366585, "post_id": 32380319, "comment_id": 59840442, "body": "EclipseFP is no longer maintained or supported: <a href=\"http://jpmoresmau.blogspot.fr/2015/05/eclipsefp-end-of-life-from-me-at-least.html\" rel=\"nofollow noreferrer\">jpmoresmau.blogspot.fr/2015/05/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 150, "user_id": 967873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/018a814dc6bd6d990519b269260e32ac?s=128&d=identicon&r=PG", "display_name": "Ali Faradjpour", "link": "https://stackoverflow.com/users/967873/ali-faradjpour"}, "is_accepted": true, "score": 1, "last_activity_date": 1461483779, "creation_date": 1461483779, "answer_id": 36820537, "question_id": 32380319, "link": "https://stackoverflow.com/questions/32380319/eclipsefp-doesnt-working/36820537#36820537", "title": "EclipseFP doesn&#39;t working", "body": "<p>Because of frequently changes happens in EclipseFP and BuildWrapper, they have stopped supporting these 2 project and should use some Leskah too have an IDE\n<a href=\"http://jpmoresmau.blogspot.com.tr/2015/05/eclipsefp-end-of-life-from-me-at-least.html\" rel=\"nofollow\">http://jpmoresmau.blogspot.com.tr/2015/05/eclipsefp-end-of-life-from-me-at-least.html</a></p>\n"}], "owner": {"reputation": 179, "user_id": 1044582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/036290b0672bf3d70443a9600e65b21c?s=128&d=identicon&r=PG", "display_name": "Yury Kochubeev", "link": "https://stackoverflow.com/users/1044582/yury-kochubeev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "accepted_answer_id": 36820537, "answer_count": 1, "score": 4, "last_activity_date": 1461483779, "creation_date": 1441295651, "question_id": 32380319, "link": "https://stackoverflow.com/questions/32380319/eclipsefp-doesnt-working", "title": "EclipseFP doesn&#39;t working", "body": "<p>I am trying to install EclipseFP on Eclipse version: Mars Release (4.5.0) on Mac OS Yosemite 10.10.5.</p>\n\n<p>While Haskell perspective is appeared, nothing special for Haskell language is not working (Syntax highlight, hoogle search &amp; etc...)</p>\n\n<p><a href=\"https://i.stack.imgur.com/2Gg2V.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2Gg2V.png\" alt=\"Syntax highlight\"></a>\n<a href=\"https://i.stack.imgur.com/E4Gco.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/E4Gco.png\" alt=\"Hoogle Search\"></a></p>\n\n<p>Here is my Eclipse Preferences: \n<a href=\"https://i.stack.imgur.com/oz4SG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oz4SG.png\" alt=\"Eclipse preferences\"></a></p>\n\n<p>And it seems that problem is that not all necessary packages could be compiled (But sure that this is the root cause)</p>\n\n<p>For example, when I am pressing button \"Install from Hackage\" in the Haskell helper executables it is trying to compile it but fails because of <code>ghc-pkg-lib-0.3</code>:</p>\n\n<pre><code>Resolving dependencies...\nNotice: installing into a sandbox located at\n/Applications/Eclipse.app/Contents/MacOS/.eclipsefp/sandbox\nConfiguring ghc-pkg-lib-0.3...\nBuilding ghc-pkg-lib-0.3...\nFailed to install ghc-pkg-lib-0.3\nBuild log ( /Applications/Eclipse.app/Contents/MacOS/.eclipsefp/sandbox/logs/ghc-pkg-lib-0.3.log ):\nConfiguring ghc-pkg-lib-0.3...\nBuilding ghc-pkg-lib-0.3...\nPreprocessing library ghc-pkg-lib-0.3...\n[1 of 1] Compiling Language.Haskell.Packages ( src/Language/Haskell/Packages.hs, dist/dist-sandbox-b2e886dd/build/Language/Haskell/Packages.o )\n\nsrc/Language/Haskell/Packages.hs:170:13:\n    Couldn't match type \u2018[Char]\u2019\n                   with \u2018Distribution.ModuleName.ModuleName\u2019\n    Expected type: InstalledPackageInfo_\n                     Distribution.ModuleName.ModuleName\n      Actual type: InstalledPackageInfoString\n    In the expression: pkgconf\n    In the expression:\n      pkgconf {exposedModules = convert e, hiddenModules = convert h}\n\nsrc/Language/Haskell/Packages.hs:170:47:\n    Couldn't match type \u2018ExposedModule\u2019 with \u2018[Char]\u2019\n    Expected type: [String]\n      Actual type: [ExposedModule]\n    In the first argument of \u2018convert\u2019, namely \u2018e\u2019\n    In the \u2018exposedModules\u2019 field of a record\n\nsrc/Language/Haskell/Packages.hs:171:39:\n    Couldn't match type \u2018ExposedModule\u2019\n                   with \u2018Distribution.ModuleName.ModuleName\u2019\n    Expected type: [Distribution.ModuleName.ModuleName]\n      Actual type: [ExposedModule]\n    In the \u2018hiddenModules\u2019 field of a record\n    In the expression:\n      pkgconf {exposedModules = convert e, hiddenModules = convert h}\ncabal.real: Error: some packages failed to install:\nbuildwrapper-0.9.1 depends on ghc-pkg-lib-0.3 which failed to install.\nghc-pkg-lib-0.3 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>Could somebody please help me?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1441293551, "post_id": 32379533, "comment_id": 52629637, "body": "Please choose a better title. What is the title of your next related question going to be? &quot;noob ... (again)(again)(again)&quot;?"}, {"owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441293854, "post_id": 32379533, "comment_id": 52629842, "body": "ignore this whole thing for the moment, I don&#39;t understand my own question....how do I delete the question?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1441293865, "post_id": 32379533, "comment_id": 52629848, "body": "Type classes are not OO classes. For instance, the Haskell type system has no subtyping, which is crucial in OOP type systems: most other statically typed functional languages follow the same approach as Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1441293872, "creation_date": 1441293872, "answer_id": 32379744, "question_id": 32379533, "link": "https://stackoverflow.com/questions/32379533/noob-duplicate-instance-declarations-againagain/32379744#32379744", "title": "noob \u201cDuplicate instance declarations\u201d (again)(again)", "body": "<p>The way I understand it is that what <code>instance (Fizzy a) =&gt; Cola a</code> really means is, any <code>a</code> is a <code>Cola</code>, but fail if that <code>a</code> isn't a <code>Fizzy</code>. The context (<code>Fizzy a</code>) isn't taken into consideration when determining duplicates.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "is_accepted": false, "score": 0, "last_activity_date": 1441294083, "creation_date": 1441294083, "answer_id": 32379798, "question_id": 32379533, "link": "https://stackoverflow.com/questions/32379533/noob-duplicate-instance-declarations-againagain/32379798#32379798", "title": "noob \u201cDuplicate instance declarations\u201d (again)(again)", "body": "<p>please ignore my question, I didn't read a previous reply properly...if I do what I'm supposed to </p>\n\n<pre><code>&gt; class Drink a where\n\n&gt; class (Drink a) =&gt; DrinkWithCaffeine a where\n\n&gt; class (Drink a) =&gt; Fizzy a where\n\n&gt; class (Drink a) =&gt; Still a where\n\n&gt; class (DrinkWithCaffeine a,Fizzy a) =&gt; Cola a where\n</code></pre>\n\n<p>it works.</p>\n"}], "owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 0, "closed_date": 1441296547, "answer_count": 2, "score": 0, "last_activity_date": 1441294111, "creation_date": 1441293345, "question_id": 32379533, "link": "https://stackoverflow.com/questions/32379533/noob-duplicate-instance-declarations-againagain", "closed_reason": "Duplicate", "title": "noob \u201cDuplicate instance declarations\u201d (again)(again)", "body": "<p>(re post with a better example) with a na\u00efve OO head...we go....</p>\n\n<pre><code>&gt; class Drink a where\n\n&gt; class DrinkWithCaffeine a where\n\n&gt; class Fizzy a where\n\n&gt; class Still a where\n\n&gt; class Cola a where\n\n&gt; instance (Drink a) =&gt; DrinkWithCaffeine a\n&gt; instance (Drink a) =&gt; Fizzy a\n&gt; instance (Drink a) =&gt; Still a\n\n&gt; instance (Fizzy a) =&gt; Cola a\n&gt; instance (DrinkWithCaffeine a) =&gt; Cola a\n</code></pre>\n\n<p>and ghc goes</p>\n\n<pre><code>Duplicate instance declarations:\n    instance forall (k :: BOX) (a :: k). Fizzy a =&gt; Cola a\n    instance forall (k :: BOX) (a :: k). DrinkWithCaffeine a =&gt; Cola a\n</code></pre>\n\n<p>and you look it up...and there is a solution using witness types, that I could probably get to work BUT....I don't understand what the problem?</p>\n\n<p>allegedly the compiler matches the right hand side and bla bla...?</p>\n\n<p>I don't understand....I think I'm saying...if I have a type of typeclass Dog...then its also of typeclass Animal...so if I call methods foo etc then this is how to do it (in terms of a Dog)</p>\n\n<p>I'm missing something</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "edited": false, "score": 0, "creation_date": 1441293851, "post_id": 32379143, "comment_id": 52629839, "body": "you should try looking up <code>sqrt</code> in <a href=\"https://www.haskell.org/hoogle\" rel=\"nofollow noreferrer\">hoogle</a> once"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441294108, "post_id": 32379143, "comment_id": 52630032, "body": "The error with the added type annotation is usually more insightful, and should point to the actual issue. You should add it to your post."}, {"owner": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441294722, "post_id": 32379143, "comment_id": 52630454, "body": "@chi I see, so sqrt actually needs a Floating type variable. But if I write <code>isPrime :: Double -&gt; Double -&gt; Double</code>, for example, then the <code>mod</code> function stops working, since that needs Integral type numbers.."}, {"owner": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "reply_to_user": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "edited": false, "score": 0, "creation_date": 1441294925, "post_id": 32379143, "comment_id": 52630578, "body": "@MrTsjolder wow, I had no idea this existed, it is very useful!"}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "edited": false, "score": 0, "creation_date": 1441294814, "post_id": 32379557, "comment_id": 52630518, "body": "Thanks, this actually solved the problem, though I still don&#39;t understand how should I fix the code using sqrt"}, {"owner": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "edited": false, "score": 0, "creation_date": 1441295397, "post_id": 32379557, "comment_id": 52630873, "body": "I just saw your edit, and the function substitution with <code>go</code> is very useful! Also, originally I wrote it with <code>Bool</code>, just changed it for debugging."}, {"owner": {"reputation": 2177, "user_id": 684133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28e34bba8a34fc266d15ab1cebafd0a2?s=128&d=identicon&r=PG", "display_name": "Martin Vidner", "link": "https://stackoverflow.com/users/684133/martin-vidner"}, "edited": false, "score": 1, "creation_date": 1441295423, "post_id": 32379557, "comment_id": 52630895, "body": "Although inefficient, the way to compute the expression in non-integers is <code>fromIntegral</code>:  <code>i == (floor $ sqrt $ fromIntegral n)</code>"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "edited": false, "score": 0, "creation_date": 1441306541, "post_id": 32379557, "comment_id": 52637313, "body": "@PeterDam I was going to say that square root is generally a much slower operation than squaring an <code>Integer</code>... but then I tested briefly in GHCi and actually it was a bit faster... and even slightly with <code>Int</code>."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1441308670, "post_id": 32379557, "comment_id": 52638516, "body": "just going to leave a small ignorable unrelated note here that things like <code>if x then True else ..</code>, etc., are slightly redundant :)"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1441295655, "last_edit_date": 1441295655, "creation_date": 1441293393, "answer_id": 32379557, "question_id": 32379143, "link": "https://stackoverflow.com/questions/32379143/type-error-in-my-own-haskell-function/32379557#32379557", "title": "Type error in my own Haskell function", "body": "<p>The inequality</p>\n\n<pre><code>i &lt; sqrt n\n</code></pre>\n\n<p>can be rewritten without needing real numbers, and computed without needing an integer square root as</p>\n\n<pre><code>i^2 &lt; n\n</code></pre>\n\n<p>or</p>\n\n<pre><code>i*i &lt; n\n</code></pre>\n\n<p>This is enough to get your code to compile and work.</p>\n\n<pre><code>isPrime n i = \n    if n &lt; 2\n        then 0\n        else if n == 2 || n == 3\n             then 1\n             else if    (n `mod` i) == 0\n                  then 0\n                  else if i*i &lt; n\n                       then isPrime n (i + 1)\n                       else 1\n\nmain = print $ isPrime 13 2\n</code></pre>\n\n<p>You might want to change the signature so that it can be used more easily. If you change the return type to <code>Bool</code> and get rid of the second argument you can write things like <code>if isPrime 13 then ...</code> or <code>filter isPrime [1..30]</code>.</p>\n\n<pre><code>isPrime :: Integral a =&gt; a -&gt; Bool\nisPrime n = go n 2\n    where\n        go n i =\n            if n &lt; 2\n                then False\n                else if n == 2 || n == 3\n                     then True\n                     else if    (n `mod` i) == 0\n                          then False\n                          else if i*i &lt; n\n                               then go n (i + 1)\n                               else True\n\nmain = print $ filter isPrime [1..30]\n</code></pre>\n\n<p>This leads towards the solution where we only check that the primes up through <code>sqrt n</code> don't divide <code>n</code>.</p>\n\n<pre><code>primes :: [Integer]\nprimes = filter isPrime [1..]\n\nisPrime :: Integer -&gt; Bool\nisPrime n = if n &lt; 2\n                then False\n                else if n == 2 || n == 3\n                     then True\n                     else all (\\i -&gt; n `mod` i /= 0) . takeWhile (\\i -&gt; i*i &lt;= n) $ primes\n\nmain = print $ take 10 primes\n</code></pre>\n\n<p>Since we are going to calculate <code>i*i</code> many times, we can justify taking the <code>sqrt n</code> instead. <code>sqrt :: Floating a =&gt; a -&gt; a</code> operates on any <code>Floating</code> numbers. We can convert from integral numbers to any other number type with <code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code>.</p>\n\n<pre><code>primes :: [Integer]\nprimes = filter isPrime [1..]\n\nisPrime :: Integer -&gt; Bool\nisPrime n = if n &lt; 2\n                then False\n                else if n == 2 || n == 3\n                     then True\n                     else all (\\i -&gt; n `mod` i /= 0) . takeWhile (&lt;= root_n) $ primes\n            where\n                root_n = floor . sqrt . fromIntegral $ n\n\nmain = print $ take 10 primes\n</code></pre>\n"}], "owner": {"reputation": 189, "user_id": 5015755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4cb49c6a828349d0282819212279014f?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Dam", "link": "https://stackoverflow.com/users/5015755/peter-dam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 32379557, "answer_count": 1, "score": 1, "last_activity_date": 1441295655, "creation_date": 1441292387, "last_edit_date": 1441294334, "question_id": 32379143, "link": "https://stackoverflow.com/questions/32379143/type-error-in-my-own-haskell-function", "title": "Type error in my own Haskell function", "body": "<p>I just started learning Haskell, and after getting a basic grasp on some things about it, I tried to write a simple function which tests for the primality of a number n, and this is what I came up with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>isPrime n i = \nif n &lt; 2\n    then 0\n    else if n == 2 || n == 3\n         then 1\n         else if    (n `mod` i) == 0\n              then 0\n              else if i == floor(sqrt(n))\n                   then 1\n                   else isPrime n (i + 1)\n</code></pre>\n\n<p>The algorithm itself seems to work (I tested it in another language), however when trying to call it for any number (i.e. <em>isPrime 5 2</em>), I get the following error:</p>\n\n<pre><code>&lt;interactive&gt;:9:1:\nCould not deduce (Floating a10) arising from a use of `isPrime'\nfrom the context (Num a)\n  bound by the inferred type of it :: Num a =&gt; a\n  at &lt;interactive&gt;:9:1-11\nThe type variable `a10' is ambiguous\nNote: there are several potential instances:\n  instance Floating Double -- Defined in `GHC.Float'\n  instance Floating Float -- Defined in `GHC.Float'\nIn the expression: isPrime 5 2\nIn an equation for `it': it = isPrime 5 2\n\n&lt;interactive&gt;:9:9:\nCould not deduce (Num a10) arising from the literal `5'\nfrom the context (Num a)\n  bound by the inferred type of it :: Num a =&gt; a\n  at &lt;interactive&gt;:9:1-11\nThe type variable `a10' is ambiguous\nNote: there are several potential instances:\n  instance Integral a =&gt; Num (GHC.Real.Ratio a)\n    -- Defined in `GHC.Real'\n  instance Num Integer -- Defined in `GHC.Num'\n  instance Num Double -- Defined in `GHC.Float'\n  ...plus three others\nIn the first argument of `isPrime', namely `5'\nIn the expression: isPrime 5 2\nIn an equation for `it': it = isPrime 5 2\n</code></pre>\n\n<p>I have tried to specify the types, like</p>\n\n<pre><code>isPrime :: Integer -&gt; Integer -&gt; Integer\n</code></pre>\n\n<p>but that just returns a different error, and can't even compile.</p>\n\n<p>EDIT: here is the error of this version:</p>\n\n<pre><code>Prime.hs:10:48:\nNo instance for (RealFrac Integer) arising from a use of `floor'\nIn the second argument of `(==)', namely `floor (sqrt (n))'\nIn the expression: i == floor (sqrt (n))\nIn the expression:\n  if i == floor (sqrt (n)) then 1 else isPrime n (i + 1)\n\nPrime.hs:10:54:\nNo instance for (Floating Integer) arising from a use of `sqrt'\nIn the first argument of `floor', namely `(sqrt (n))'\nIn the second argument of `(==)', namely `floor (sqrt (n))'\nIn the expression: i == floor (sqrt (n))\n</code></pre>\n\n<p>Please help me, how should I change my code to make it work? Thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "edited": false, "score": 0, "creation_date": 1441285167, "post_id": 32376231, "comment_id": 52623426, "body": "really...I&#39;m not a complete noob...but I haven&#39;t done any Haskell for a whole...and I&#39;ve not dabbled with superclasses...let me have a go"}, {"owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "edited": false, "score": 0, "creation_date": 1441292453, "post_id": 32376231, "comment_id": 52628921, "body": "actually I still have the problem...I had the example the wrong way around...let me give a better exampe"}, {"owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "edited": false, "score": 0, "creation_date": 1441298609, "post_id": 32376231, "comment_id": 52632851, "body": "actually....you&#39;ve side stepped the answer....what IS the problem with what I&#39;ve written....I understand what you&#39;ve written....(na&#239;vely) a cannot be a mammal unless its an animal....ok,,,,but what I&#39;ve written is...if I have a mammal I can make an animal....I need to construct a better example"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1441299590, "last_edit_date": 1441299590, "creation_date": 1441284808, "answer_id": 32376231, "question_id": 32375983, "link": "https://stackoverflow.com/questions/32375983/noob-duplicate-instance-declarations-again/32376231#32376231", "title": "noob &quot;Duplicate instance declarations&quot; (again)", "body": "<p>Yup, you're missing something. Here's how you should have defined your class hierarchy:</p>\n\n<pre><code>class Animal a where\nclass Animal a =&gt; Mammal a where\nclass Animal a =&gt; Insect a where\n</code></pre>\n\n<p>This is how you express superclass relationships. Instance declarations are for actually making types instances of your classes.</p>\n\n<pre><code>instance Animal Ant where\ninstance Insect Ant where\n</code></pre>\n\n<h3>What goes wrong in the original</h3>\n\n<p>You wrote</p>\n\n<pre><code>instance (Mammal m) =&gt; Animal m\n\ninstance (Insect i) =&gt; Animal i\n</code></pre>\n\n<p>Haskell requires that there be only one instance for each class and type. Thus is determined only from the part to the right of the <code>=&gt;</code>. So it sees two declarations for</p>\n\n<pre><code>instance Animal a\n</code></pre>\n\n<p>and complains. You could have</p>\n\n<pre><code>instance Animal (Maybe a)\n</code></pre>\n\n<p>and also</p>\n\n<pre><code>instance Animal Int\n</code></pre>\n\n<p>But if you have</p>\n\n<pre><code>instance Animal a\n</code></pre>\n\n<p>then you can't have any other instance declarations for <code>Animal</code>.</p>\n"}], "owner": {"reputation": 51, "user_id": 5074739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4acdf04a6d36aaf1c925794c20e2affc?s=128&d=identicon&r=PG", "display_name": "nichom", "link": "https://stackoverflow.com/users/5074739/nichom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 1, "accepted_answer_id": 32376231, "answer_count": 1, "score": 4, "last_activity_date": 1441299590, "creation_date": 1441284141, "last_edit_date": 1592644375, "question_id": 32375983, "link": "https://stackoverflow.com/questions/32375983/noob-duplicate-instance-declarations-again", "title": "noob &quot;Duplicate instance declarations&quot; (again)", "body": "<p>yes...sorry this has been asked before, but usually about something so specific and complex that it in incomprehensible</p>\n<p>with a na\u00efve OO head...we go....</p>\n<blockquote>\n<p>class Animal a where</p>\n<p>class Mammal m where</p>\n<p>class Insect i where</p>\n<p>instance (Mammal m) =&gt; Animal m</p>\n<p>instance (Insect i) =&gt; Animal i</p>\n</blockquote>\n<p>and ghc goes</p>\n<p>Duplicate instance declarations:</p>\n<pre><code>  instance forall (k :: BOX) (m :: k). Mammal m =&gt; Animal m\n  instance forall (k :: BOX) (i :: k). Insect i =&gt; Animal i\n</code></pre>\n<p>and you look it up...and there is a solution using witness types, that I could probably get to work BUT....I don't understand what the problem?</p>\n<p>allegedly the compiler matches the right hand side and bla bla...?</p>\n<p>I don't understand....I think I'm saying...if I have a type of typeclass Dog...then its also of typeclass Animal...so if I call methods foo etc then this is how to do it (in terms of a Dog)</p>\n<p>I'm missing something</p>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1441281487, "post_id": 32374703, "comment_id": 52620729, "body": "what about using bytestring with utf16 text values decoded <a href=\"https://hackage.haskell.org/package/text-0.10.0.1/docs/Data-Text-Encoding.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/text-0.10.0.1/docs/&hellip;</a>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1441283103, "post_id": 32374703, "comment_id": 52621902, "body": "UTF-16 does not provide constant-time indexing of unicode codepoints.  In fact, I believe that due to surrogates, no encoding of unicode provides constant-time indexing."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1441291044, "post_id": 32374703, "comment_id": 52627890, "body": "@Carl, I believe UTF-32 does provide constant-time indexing of codepoints. That doesn&#39;t, however, get you constant-time indexing to glyphs."}, {"owner": {"reputation": 11, "user_id": 5296582, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0_yaaZQaSmw/AAAAAAAAAAI/AAAAAAAABmw/J6A48JE7t7Q/photo.jpg?sz=128", "display_name": "Asger Alstrup Palm", "link": "https://stackoverflow.com/users/5296582/asger-alstrup-palm"}, "edited": false, "score": 0, "creation_date": 1441369991, "post_id": 32374703, "comment_id": 52664366, "body": "It would be more precise to ask for UCS-2, since I am not concerned with surrogates. I am compiling a functional language to Haskell. This language uses 16-bit unicode codepoints, without surrogates. It requires constant time indexing into strings, so I&#39;m looking for the best Haskell library to fit this. It sounds like we have to build our own wrapper around bytestring. We will have to loop to search, because odd-index hits will be invalid, and things like that, but I guess it is managable. Btw. performance of the hand-written test cases are 3 times faster than the same in Java."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1441296042, "post_id": 32378908, "comment_id": 52631281, "body": "There was a GSoC investigating the switch (<a href=\"http://jaspervdj.be/files/text.html\" rel=\"nofollow noreferrer\">proposal</a>, <a href=\"http://jaspervdj.be/posts/2011-07-10-text-utf8-initial-results.html\" rel=\"nofollow noreferrer\">speed measurements</a>, <a href=\"http://jaspervdj.be/posts/2011-08-09-text-utf8-memory-usage.html\" rel=\"nofollow noreferrer\">memory measurements</a>, <a href=\"http://jaspervdj.be/posts/2011-08-19-text-utf8-the-aftermath.html\" rel=\"nofollow noreferrer\">conclusion</a>). In short: there would be a small win, but it would require so much compatibility and testing work that it isn&#39;t worth it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1441297559, "post_id": 32378908, "comment_id": 52632202, "body": "@DanielWagner, I&#39;m having trouble squaring half the memory for ASCII and cheap I/O in the common case with &quot;small win&quot;. What am I missing?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441299688, "post_id": 32378908, "comment_id": 52633439, "body": "Perhaps you are missing the actual measurements at the links I posted, which show that you do not get half the memory usage or cheap IO in the common case."}, {"owner": {"reputation": 11, "user_id": 5296582, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0_yaaZQaSmw/AAAAAAAAAAI/AAAAAAAABmw/J6A48JE7t7Q/photo.jpg?sz=128", "display_name": "Asger Alstrup Palm", "link": "https://stackoverflow.com/users/5296582/asger-alstrup-palm"}, "edited": false, "score": 0, "creation_date": 1441372502, "post_id": 32378908, "comment_id": 52666001, "body": "I am compiling a functional language to Haskell. This language uses 16-bit unicode codepoints, without surrogates. It requires constant time indexing into strings. How stable would the Internal thing be?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1441292855, "last_edit_date": 1441292855, "creation_date": 1441291681, "answer_id": 32378908, "question_id": 32374703, "link": "https://stackoverflow.com/questions/32374703/string-in-haskell-that-supports-utf-16-and-constant-time-indexing/32378908#32378908", "title": "String in Haskell that supports UTF-16 and constant time indexing", "body": "<p>The usual <code>text</code> interface doesn't support this because it's very rarely useful. However, the package maintainers have continued to use UTF-16 for years despite it being a silly encoding. Therefore, you might be justified in taking a gamble and importing <code>Data.Text.Internal</code> to get at the underlying <code>Array</code>. That said, this is so rarely the right thing to do that I suspect you may be asking the wrong question. Why do you need this?</p>\n\n<p>Note: this question inspired me to file <a href=\"https://github.com/bos/text/issues/133\" rel=\"nofollow\">an issue</a> suggesting that <code>text</code> switch to UTF-8. This will likely be denied, but I figured I should mention it.</p>\n"}], "owner": {"reputation": 11, "user_id": 5296582, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0_yaaZQaSmw/AAAAAAAAAAI/AAAAAAAABmw/J6A48JE7t7Q/photo.jpg?sz=128", "display_name": "Asger Alstrup Palm", "link": "https://stackoverflow.com/users/5296582/asger-alstrup-palm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1441292855, "creation_date": 1441280671, "question_id": 32374703, "link": "https://stackoverflow.com/questions/32374703/string-in-haskell-that-supports-utf-16-and-constant-time-indexing", "title": "String in Haskell that supports UTF-16 and constant time indexing", "body": "<p>I know of bytestring, compactstring, text, and a bunch of other Haskell strings, but I did not find any that supports UTF-16 and constant time indexing, like bytestring does.</p>\n\n<p>Does this exist?</p>\n"}, {"tags": ["haskell", "dynamic", "types", "configuration", "config"], "comments": [{"owner": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 2, "creation_date": 1441271992, "post_id": 32371458, "comment_id": 52614709, "body": "I&#39;d look at Template Haskell - it would let you generate the types from your config. Important question is how are going to use them? Do you intend to have another config file that describes what each action does? Then maybe you should consider using eDSL? If you want the types to be loaded from config in runtime then that&#39;s impossible - haskell&#39;s type exist for purpose of compilation"}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "reply_to_user": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 0, "creation_date": 1441272318, "post_id": 32371458, "comment_id": 52614900, "body": "To stick with the terms used in the example, the library that keeps track of actions is separate from the library that runs them. Each action would need a run-time implementation in code in the second library, while the first only needs to know the options so that an action can be represented. It&#39;s bad practice to put the options list, which has nothing to do with implementation and is likely to change, directly into the code."}, {"owner": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 1, "creation_date": 1441272627, "post_id": 32371458, "comment_id": 52615120, "body": "But those config files will effectively be source code (because types will be generated from them in compile time). You can&#39;t work around that (AFAIK). Besides, I don&#39;t really understand how you see this first library - if it has nothing to do with implementation then why does it need those types? If it just parses / prints those actions it already needs to be recompiled when you change the type set"}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "reply_to_user": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 0, "creation_date": 1441273870, "post_id": 32371458, "comment_id": 52615974, "body": "Defining it as a type rather than a list of strings allows one to take advantage of the type system to make errors pop up at compile time. I.e. if someone anywhere in the library tries to use an action that doesn&#39;t exist, the code won&#39;t compile, as opposed to finding out the problem at runtime. Ironically, the tests that would be needed to catch this at runtime before deployment, assuming they&#39;re written in Haskell, would also face the question of whether to hard-code or use config files for the types to test against."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1441315398, "creation_date": 1441315398, "answer_id": 32385647, "question_id": 32371458, "link": "https://stackoverflow.com/questions/32371458/dynamically-constructed-enumerated-types-in-haskell/32385647#32385647", "title": "Dynamically-constructed enumerated types in Haskell", "body": "<p>This sounds like a simple question of how to define an abstract data type. For module-level abstraction, you can use Haskell's mechanism for choosing what to export; for package-level abstraction, you can use Haskell's mechanism for choosing which modules to expose. I'll briefly discuss each below.</p>\n\n<p>For module-level abstraction, you would write something like this:</p>\n\n<pre><code>module Action (Action, act, allActions) where\n\nimport Environment\nimport Actor\n\ndata Action = Walk | Inspect\n\n-- give some way for other modules to construct actions\nallActions :: [Action]\nallActions = [Walk, Inspect]\n\n-- give some way for other modules to consume actions\nact :: Actor -&gt; Action -&gt; Environment -&gt; Environment\nact = undefined -- exercise for the reader\n</code></pre>\n\n<p>This would be your \"configuration file\". (I think your proposed configuration file -- which lists actions, but doesn't say what they mean -- is unreasonably minimal.) Other parts of your library -- that is, outside this module boundary -- will be forced to be <code>Action</code>-agnostic in the sense that they cannot depend on the specific list of actions available in a meaningful way. In particular, they will not be able to pattern match on <code>Action</code>s or create arbitrary <code>Action</code>s -- only <code>act</code> on some collection of actions chosen from <code>allActions</code>. So you can change the configuration in any way you like provided you maintain the <code>allActions</code> and <code>act</code> interface.</p>\n\n<p>Of course, in real projects, it can be a bit unwieldy to have all of the <code>Action</code>-specific operations in a single module. So when things get a bit bigger, it's probably better to use package-level abstraction. One common pattern in the Haskell community is to have an <code>Internal</code> module that exports everything, and a normal module that only exports the bits that should be available to consumers:</p>\n\n<pre><code>module Action.Internal (Action(..)) where\n\ndata Action = Walk | Inspect\n\nmodule Action (Action, allActions, act) where\n\nimport Action.Internal\nimport Environment\nimport Actor\n\nallActions = [Walk, Inspect]\nact = undefined\n</code></pre>\n\n<p>In your package's cabal file, one can then hide the <code>Internal</code> module from other packages:</p>\n\n<pre><code>library\n    exposed-modules: Action\n                     Actor\n                     Environment\n    other-modules:   Action.Internal\n</code></pre>\n\n<p>These days, though, it is becoming much more common to do this the Python way: expose all the modules, with the understanding that consumers that touch the <code>Internal</code> modules are consenting adults (and in particular understand that they may need to take care of internal invariants, that the API could change unpredictably, etc.).</p>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1441315398, "creation_date": 1441271369, "question_id": 32371458, "link": "https://stackoverflow.com/questions/32371458/dynamically-constructed-enumerated-types-in-haskell", "title": "Dynamically-constructed enumerated types in Haskell", "body": "<p>Say I were designing a game engine in which possible actions are stored as an enumerated type implemented with constructors. For example:</p>\n\n<pre><code>data Action = Walk | Attack | Drop | PickUp | DoMagic\n</code></pre>\n\n<p>This is simple enough, a game engine can be built using this as a fundamental building block. But say the designers wanted to set possible actions using a configuration file, of the following type:</p>\n\n<pre><code>[Actions]\n    Walk\n    Attack\n    Drop\n    PickUp\n    DoMagic\n[/Actions]\n</code></pre>\n\n<p>How does one turn a file like this into the <code>Action</code> type? In other words, how would I dynamically construct types based on config files?</p>\n"}]