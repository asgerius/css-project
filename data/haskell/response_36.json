[{"tags": ["haskell", "free-monad", "reader-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1442449459, "post_id": 32620311, "comment_id": 53091795, "body": "You should post the exact error. I bet it is actually somewhat more specific: I bet it says there&#39;s no instance of <code>MonadReader</code> for <code>MyDSL</code>, <i>not</i> for <code>Free MyDSL</code> as you claim in the question. That should be quite a strong hint about what is needed for this to work."}, {"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442451119, "post_id": 32620311, "comment_id": 53092154, "body": "@DanielWagner I&#39;m having trouble reproducing the exact error for various reasons, but the specifics don&#39;t really matter. I&#39;m just looking for any example that combines any mtl monad with Free."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442472333, "post_id": 32620311, "comment_id": 53098092, "body": "You&#39;d need <code>MyDSL</code> to be an instance of <code>MonadReader</code> for the appropriate environment type. <code>Free</code> doesn&#39;t <i>add</i> a reader effect; it just uses an underlying one. If you can&#39;t post your exact code and error message, it&#39;s hard to see how we can help you."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442502206, "post_id": 32625798, "comment_id": 53116136, "body": "Great job getting to the underlying issue there!"}], "tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": true, "score": 3, "last_activity_date": 1442478704, "creation_date": 1442478704, "answer_id": 32625798, "question_id": 32620311, "link": "https://stackoverflow.com/questions/32620311/how-do-i-leverage-the-monadreader-instance-of-free/32625798#32625798", "title": "How do I leverage the MonadReader instance of Free?", "body": "<p>As you linked above, there is an <code>MonadReader</code> instance for <code>Free</code>:</p>\n\n<pre><code>instance (Functor m, MonadReader e m) =&gt; MonadReader e (Free m) where\n</code></pre>\n\n<p>what this says is that given that <code>m</code> is a <code>Functor</code> and that there is a <code>MonadReader e</code> instance for <code>m</code>, we can also make use of the <code>MonadReader</code> instance inside of <code>Free</code>.  But this <strong>requires</strong> that there already is a <code>MonadReader</code> instance for <code>m</code> which in your case is your DSL Functor.  This is normally <strong>not</strong> what you want because this drastically limits the available choices for your DSL functor, given that it is no longer enough to be a functor and it also <strong>has to be</strong> a monad.</p>\n\n<p>I would therefore suggest instead of using <code>Free (ReaderT r DSL) a</code> you could just layer it the other way around, i.e.  <code>ReaderT r (Free DSL) a</code>, which has the benefit that <code>DSL</code> only has to be a functor.  To make this more concrete, and given that you did not state how your DSL looks like, let's use the <code>Teletype</code> DSL example:</p>\n\n<pre><code>data TeletypeF a = GetChar (Char -&gt; a) | PutChar Char a deriving Functor\n\ntype Teletype a = Free TeletypeF a\n\ngetChar :: Teletype Char\ngetChar = liftF (GetChar id)\n\nputChar :: Char -&gt; Teletype ()\nputChar c = liftF (PutChar c ())\n\nputStrLn :: String -&gt; Teletype ()\nputStrLn str = traverse putChar str &gt;&gt; putChar '\\n'\n\nrunTeletype :: Teletype a -&gt; IO a\nrunTeletype = foldFree go\n  where go (GetChar k) = k &lt;$&gt; IO.getChar\n        go (PutChar c k) = IO.putChar c &gt;&gt; return k\n</code></pre>\n\n<p><code>putStrLn</code> is a program derived from the DSL primitive <code>PutChar</code>.  We can interpret programs by using the <code>IO</code> monad.  Now we want to use the <code>ReaderT</code> monad transformer to be able to defer the choice of end-of-line separator in <code>putStrLn</code>.  So we proceed as follows:</p>\n\n<pre><code>type TeletypeReader a = ReaderT Char (Free TeletypeF) a\n\ngetChar' :: TeletypeReader Char\ngetChar' = lift getChar\n\nputChar' :: Char -&gt; TeletypeReader ()\nputChar' c = lift (putChar c)\n\nputStrLn' :: String -&gt; TeletypeReader ()\nputStrLn' str = do\n  traverse_ putChar' str\n  sep &lt;- ask\n  putChar' sep\n\nrunTeletypeReader :: Char -&gt; TeletypeReader a -&gt; IO a\nrunTeletypeReader sep = runTeletype . flip runReaderT sep\n</code></pre>\n\n<p>And now we can do:</p>\n\n<pre><code>\u03bb&gt; runTeletypeReader '\\n' (putStrLn' \"Hello\" &gt;&gt; putStrLn' \"World\")\nHello\nWorld\n\n\u03bb&gt; runTeletypeReader ':' (putStrLn' \"Hello\" &gt;&gt; putStrLn' \"World\")\nHello:World:\n</code></pre>\n"}], "owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 32625798, "answer_count": 1, "score": 1, "last_activity_date": 1442478704, "creation_date": 1442445702, "question_id": 32620311, "link": "https://stackoverflow.com/questions/32620311/how-do-i-leverage-the-monadreader-instance-of-free", "title": "How do I leverage the MonadReader instance of Free?", "body": "<p>I want to use Reader in my DSL that I created using a Free monad.</p>\n\n<p>I notice that there is a instance of MonadReader for Free here:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/src/Control-Monad-Free.html#line-264\" rel=\"nofollow\">https://hackage.haskell.org/package/free-4.12.1/docs/src/Control-Monad-Free.html#line-264</a></p>\n\n<p>If I try to call <code>ask</code> inside the program written in my EDSL, I get the the type error \"No such instance MonadReader Free MyDSL\"</p>\n\n<p>I will eventually want to use other Monads with my DSL such as MonadError and the Logging monad, but the Reader monad is just the first one I've tried.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442443808, "post_id": 32620006, "comment_id": 53090425, "body": "You need the functions <a href=\"https://www.haskell.org/hoogle/?hoogle=all\" rel=\"nofollow noreferrer\"><code>all</code></a> and <a href=\"https://www.haskell.org/hoogle/?hoogle=map\" rel=\"nofollow noreferrer\"><code>map</code></a>."}, {"owner": {"reputation": 93, "user_id": 3373360, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6609c270726f8d90ab6ba223f3edf459?s=128&d=identicon&r=PG&f=1", "display_name": "user3373360", "link": "https://stackoverflow.com/users/3373360/user3373360"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442443889, "post_id": 32620006, "comment_id": 53090450, "body": "Yes that&#39;s one thing I forgot to mention. We&#39;re given that we can use all, map, and filter."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 1, "last_activity_date": 1442444318, "creation_date": 1442444318, "answer_id": 32620106, "question_id": 32620006, "link": "https://stackoverflow.com/questions/32620006/checking-for-all-lowercase-combining-a-word-with-a-list-haskell/32620106#32620106", "title": "Checking for all lowercase &amp; Combining a Word with a List - Haskell", "body": "<p>Since this is clearly homework, I won't give you the answers, just a large nudge.</p>\n\n<p>First off, <code>String</code> is just a synonym for <code>[Char]</code>.</p>\n\n<p>These functions may be helpful:</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>This will concatenate two lists or strings.</p>\n\n<pre><code>import Data.Char\nisLower :: Char -&gt; Bool\n</code></pre>\n\n<p>This will test if a <code>Char</code> is lowercase or not</p>\n\n<pre><code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>This will test whether or not all of a lists elements satisfy a predicate.</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>This applies a function to all elements of a list.</p>\n\n<p>For your function <code>isWord</code>, you need to check that <code>all</code> of a strings elements are/<code>isLower</code>.</p>\n\n<p>For your function <code>prefixWords</code>, every element is concatenated with a given string.</p>\n"}], "owner": {"reputation": 93, "user_id": 3373360, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6609c270726f8d90ab6ba223f3edf459?s=128&d=identicon&r=PG&f=1", "display_name": "user3373360", "link": "https://stackoverflow.com/users/3373360/user3373360"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1442444318, "creation_date": 1442443696, "question_id": 32620006, "link": "https://stackoverflow.com/questions/32620006/checking-for-all-lowercase-combining-a-word-with-a-list-haskell", "title": "Checking for all lowercase &amp; Combining a Word with a List - Haskell", "body": "<p>I am having some trouble writing 2 separate functions. One of which \"isWord s\" is to take in a word and return \"true\" if all characters of the word are lowercase, otherwise return \"false\". Below is an example:</p>\n\n<pre><code>isWord \"foo\" = True; isWord \"fo3o\" = False\n</code></pre>\n\n<p>It must use this definition:</p>\n\n<pre><code>isWord :: String -&gt; Bool\nisWord s = \n</code></pre>\n\n<p>The other function \"prefixWords str strs\" which takes a word and a list of words and combines the two in a list with a \":\" between each word. Shown below as an example:</p>\n\n<pre><code>prefixWords \"word:\" [\"aa\", \"a3\", \"foo\"] = [\"word:aa\", \"word:foo\"]\n</code></pre>\n\n<p>It must use this definition:</p>\n\n<pre><code>prefixWords :: String -&gt; [String] -&gt; [String]\nprefixWords str strs =\n</code></pre>\n\n<p>Any help is greatly appreciated as I am brand new to Haskell and don't have any idea of where to start. Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1442440955, "post_id": 32619500, "comment_id": 53089542, "body": "Yeah, remove <code>tupleNums</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1442441017, "post_id": 32619500, "comment_id": 53089565, "body": "How can <code>splitWord</code> return a <code>[[String]]</code> if it calls <code>tupleNums</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442441489, "post_id": 32619500, "comment_id": 53089724, "body": "What is this code supposed to do? That information is required on this site in the text of any question seeking debugging help."}], "answers": [{"comments": [{"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442442158, "post_id": 32619664, "comment_id": 53089949, "body": "The 2nd code block is exactly what I needed, but can you explain what you are doing with the functions type signatures because I don&#39;t understand fully. Thank you!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1442507809, "last_edit_date": 1442507809, "creation_date": 1442441599, "answer_id": 32619664, "question_id": 32619500, "link": "https://stackoverflow.com/questions/32619500/couldnt-match-type-integer-string-with-string/32619664#32619664", "title": "Couldn&#39;t match type \u2018(Integer, [String])\u2019 with \u2018[String]\u2019", "body": "<p>As with most <em>type errors</em> the error can be at the <em>caller</em> or the <em>callee</em>, in this case I suspect it is with the <em>caller</em>.</p>\n\n<p>The most likely explanation is that you don't have to call <code>tupleNums</code>:</p>\n\n<pre><code>splitLines:: String -&gt; [[String]]\nsplitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords:: [String] -&gt; [[String]]\nsplitWords splitWordList = map words splitWordList\n</code></pre>\n\n<p>This simply works fine, you don't attach any \"line numbers\" (?) to your words.</p>\n\n<hr>\n\n<p>Another possibility is that you failed to <em>update</em> the type of <code>splitLines</code> and <code>splitWords</code> properly when you started adding line numbers:</p>\n\n<pre><code>splitLines:: (Enum a, Num a) =&gt; String -&gt; [(a,[String])]\nsplitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords:: (Enum a, Num a) =&gt; [String] -&gt; [(a,[String])]\nsplitWords splitWordList = tupleNums (map words splitWordList)\n\ntupleNums :: (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]\ntupleNums tupleNumList = zip [1..] tupleNumList\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>How to manipulate the type signature? Let's only discuss <code>splitWords</code> since the case for <code>splitLines</code> is equivalent. First let's take a look at the expression:</p>\n\n<pre><code>tupleNums (map words splitWordList)\n</code></pre>\n\n<p>with types:</p>\n\n<ul>\n<li><code>splitWordList :: String</code> (the input);</li>\n<li><code>words :: String -&gt; [String]</code> (library);</li>\n<li><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> (library);</li>\n<li><code>tupleNums :: (Enum c, Num c) =&gt; [d] -&gt; [(c, d)]</code> (defined).</li>\n</ul>\n\n<p>I've renamed <code>a</code> and <code>b</code> of <code>tupleNames</code> to <code>c</code> and <code>d</code> because of name clashes. Now how does Haskell reasons about the types?</p>\n\n<p>It has to fill in <code>a</code> and <code>b</code> of <code>map</code>. Now because the first argument of <code>map</code> has type <code>a -&gt; b</code> and <code>words :: String -&gt; [String]</code>, this means <code>a = String</code> and <code>b = [String]</code>. By doing so, the <code>map</code> we use (so to speak) collapses to:</p>\n\n<pre><code>map words :: [String] -&gt; [[String]]\n</code></pre>\n\n<p>now when we call this function on <code>splitWordList</code>, it further collapses to:</p>\n\n<pre><code>map words splitWordList :: [[String]]\n</code></pre>\n\n<p>Now the result of this expression will be a list of lists of <code>String</code>s.</p>\n\n<p>Haskell furthermore needs to guess the type of <code>tupleNums</code>. Since it has signature: <code>(Enum c, Num c) =&gt; [d] -&gt; [(c, d)]</code> and takes <code>map words splitWordList :: [[String]]</code> as the first parameter, this means that <code>d = [String]</code> (mind <code>c</code> is not <code>String</code>). So this collapses to:</p>\n\n<pre><code>tupleNums (map words splitWordList) :: (Enum c, Num c) =&gt; [[String]] -&gt; [(c, String)]\n</code></pre>\n\n<p>It cannot/should not reason about <code>c</code> because the aim is to keep functions as generic as possible.</p>\n\n<blockquote>\n  <p><strong>Note</strong> (type inference): mind however that Haskell (most of the time) does not need to be given the type. It has a type inference system that will generate the <em>most generic type signature possible</em>. If you feed your compiler this file:</p>\n\n<pre><code>splitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords splitWordList = tupleNums (map words splitWordList)\n\ntupleNums tupleNumList = zip [1..] tupleNumList\n</code></pre>\n  \n  <p>you can query the type Haskell has resolved with:</p>\n\n<pre><code>*Main&gt; :t splitWords\nsplitWords :: (Enum a, Num a) =&gt; [String] -&gt; [(a, [String])]\n</code></pre>\n  \n  <p>If what you say makes no sense from a type-perspective, it will fail to compile. Types can be useful to keep track of the items yourself. There are a few (GHC) language extensions that can make the type system fail to find the most generic type or let it get stuck in an infinite loop.</p>\n</blockquote>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 32619664, "answer_count": 1, "score": -1, "last_activity_date": 1442507809, "creation_date": 1442440781, "last_edit_date": 1442507738, "question_id": 32619500, "link": "https://stackoverflow.com/questions/32619500/couldnt-match-type-integer-string-with-string", "title": "Couldn&#39;t match type \u2018(Integer, [String])\u2019 with \u2018[String]\u2019", "body": "<p>Compiling this in GHCi:</p>\n\n<pre><code>splitLines:: String -&gt; [[String]]\nsplitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords:: [String] -&gt; [[String]]\nsplitWords splitWordList = tupleNums (map words splitWordList)\n\ntupleNums :: (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]\ntupleNums tupleNumList = zip [1..] tupleNumList\n</code></pre>\n\n<p>Gives the following error message:</p>\n\n<pre><code>Couldn't match type \u2018(Integer, [String])\u2019 with \u2018[String]\u2019\n\nExpected type: [[String]]\n\nActual type: [(Integer, [String])]\nIn the expression: tupleNums (map words splitWordList)\nIn an equation for \u2018splitWords\u2019:\nsplitWords splitWordList = tupleNums (map words splitWordList)\n</code></pre>\n\n<p>Anybody know how to fix this type error? I'm a beginner at this so the pointers are helpful. </p>\n"}, {"tags": ["haskell", "types", "haskell-lens"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 9, "creation_date": 1442435153, "post_id": 32617406, "comment_id": 53086755, "body": "Why does it need to be lens combinators specifically?"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442443166, "post_id": 32619461, "comment_id": 53090241, "body": "Two questions discussing the problem you mention at the end: <a href=\"http://stackoverflow.com/q/17528119\">stackoverflow.com/q/17528119</a> , <a href=\"http://stackoverflow.com/q/23321844\">stackoverflow.com/q/23321844</a> . In this specific case the relevant lens is legal, and so in principle it would be fine to define it from scratch, though it probably wouldn&#39;t be worth the trouble."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 2, "creation_date": 1442443333, "post_id": 32619461, "comment_id": 53090283, "body": "Manually writing it isn&#39;t that bad: <code>_ab f (Rec a b c) = f (a,b) &lt;&amp;&gt; \\(a&#39;,b&#39;) -&gt; Rec a&#39; b&#39; c</code>. Then the function is simply <code>_ab %~ \\(a,b) -&gt; (f a b, g a b)</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1442443824, "post_id": 32619461, "comment_id": 53090428, "body": "@cchalmers It isn&#39;t indeed; my &quot;not worth the trouble&quot; was only relative to the lens-less solution, and assuming the composed lens won&#39;t prove useful elsewhere."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 9, "last_activity_date": 1442445435, "last_edit_date": 1495541652, "creation_date": 1442440659, "answer_id": 32619461, "question_id": 32617406, "link": "https://stackoverflow.com/questions/32617406/applying-functions-that-depend-on-multiple-fields-using-the-lens/32619461#32619461", "title": "Applying functions that depend on multiple fields using the lens", "body": "<h3>Lenses</h3>\n\n<p>The lenses <code>a</code>, <code>b</code>, and <code>c</code> would be written out by hand in terms of <code>fmap</code> (<a href=\"http://hackage.haskell.org/package/lens/docs/Control-Lens-Lens.html#v:-60--38--62-\" rel=\"nofollow noreferrer\"><code>&lt;&amp;&gt;</code></a> is infix flipped fmap) as</p>\n\n<pre><code>a :: Functor f =&gt; (A -&gt; f A) -&gt; Rec -&gt; f Rec\na f (Rec a b c) = f a &lt;&amp;&gt; \\a' -&gt; Rec a' b c\n\nb :: Functor f =&gt; (B -&gt; f B) -&gt; Rec -&gt; f Rec\nb f (Rec a b c) = f b &lt;&amp;&gt; \\b' -&gt; Rec a b' c\n\nc :: Functor f =&gt; (C -&gt; f C) -&gt; Rec -&gt; f Rec\nc f (Rec a b c) = f c &lt;&amp;&gt; \\c' -&gt; Rec a b c'\n</code></pre>\n\n<p>As cchalmers points out, we can extend this pattern to write a lens for both the <code>_a</code> and <code>_b</code> fields at the same time</p>\n\n<pre><code>ab :: Functor f =&gt; ((A, B) -&gt; f (A, B)) -&gt; Rec -&gt; f Ref\nab f (Rec a b c) = f (a,b) &lt;&amp;&gt; \\(a',b') -&gt; Rec a' b' c\n</code></pre>\n\n<p>Combined with <code>&amp;&amp;&amp;</code> from <a href=\"https://hackage.haskell.org/package/base/docs/Control-Arrow.html\" rel=\"nofollow noreferrer\"><code>Control.Arrow</code></a> and <a href=\"http://hackage.haskell.org/package/lens/docs/Control-Lens-Setter.html#v:-37--126-\" rel=\"nofollow noreferrer\"><code>%~</code></a> we can write the desired function elegantly as</p>\n\n<pre><code>inAB :: ((A, B) -&gt; A) -&gt; ((A, B) -&gt; B) -&gt; Rec -&gt; Rec\ninAB f g = ab %~ (f &amp;&amp;&amp; g)\n</code></pre>\n\n<p>If you are very comfortable with the lens library you might prefer to use <code>(ab %~ (f &amp;&amp;&amp; g))</code> instead of <code>inAB f g</code>.</p>\n\n<p>There <a href=\"https://stackoverflow.com/a/23322201/414413\">isn't</a> a <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> function for building the lens <code>ab</code> from the lenses <code>a</code> and <code>b</code> since in general the product of two lenses onto the same underlying structure is not a lens for the product onto the one underlying structure; both of the two lenses might try to change the same underlying field and violate the lens laws.</p>\n\n<h3>No lenses</h3>\n\n<p>Without lenses, you can define a function to apply a function to the <code>_a</code> and <code>_b</code>  fields of the record.</p>\n\n<pre><code>onAB :: (A -&gt; B -&gt; c) -&gt; Rec -&gt; c\nonAB f r = f (_a r) (_b r)\n</code></pre>\n\n<p>A function that modifies both the <code>_a</code> and <code>_b</code> fields based on a function for each just sets <code>_a</code> and <code>_b</code> to the results of the two functions applied to the fields.</p>\n\n<pre><code>inAB' :: (A -&gt; B -&gt; A) -&gt; (A -&gt; B -&gt; B) -&gt; Rec -&gt; Rec\ninAB' f g r = r {_a = onAB f r, _b = onAB g r}\n</code></pre>\n\n<p>Tossing in a couple <code>curry</code>s we get exactly the type signature you want</p>\n\n<pre><code>inAB :: ((A, B) -&gt; A) -&gt; ((A, B) -&gt; B) -&gt; Rec -&gt; Rec\ninAB f g = inAB' (curry f) (curry g)\n</code></pre>\n\n<h3>Slower, less elegant lenses</h3>\n\n<p>With lenses we can also say that we are <code>set</code>ing <code>a</code> and <code>b</code>. It's not any more elegant than using the record constructor and it will need to construct the record twice.</p>\n\n<pre><code>inAB' :: (A -&gt; B -&gt; A) -&gt; (A -&gt; B -&gt; B) -&gt; Rec -&gt; Rec\ninAB' f g r = set b (onAB g r) . set a (onAB f r) $ r\n</code></pre>\n"}], "owner": {"reputation": 666, "user_id": 2316594, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PLyfY.jpg?s=128&g=1", "display_name": "Katty J.", "link": "https://stackoverflow.com/users/2316594/katty-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "accepted_answer_id": 32619461, "answer_count": 1, "score": 7, "last_activity_date": 1442445435, "creation_date": 1442432837, "question_id": 32617406, "link": "https://stackoverflow.com/questions/32617406/applying-functions-that-depend-on-multiple-fields-using-the-lens", "title": "Applying functions that depend on multiple fields using the lens", "body": "<p>Let <code>A, B, C</code> be types and there are two functions <code>f :: (A , B) -> A</code> and <code>g :: (A , B) -> B</code>. Consider following record type </p>\n\n<p><code>data Rec = Rec{_a :: A, _b :: B, _c :: C}</code>. </p>\n\n<p>What would be the most elegant way to define function that maps <code>(Rec a b c)</code> to <code>(Rec (f a b) (g a b) c)</code> using the <code>lens</code> combinators?  </p>\n"}, {"tags": ["haskell", "redirect", "http-status-code-301", "hakyll"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442441042, "post_id": 32617395, "comment_id": 53089576, "body": "The redirection must be set up in your old blog, and not in the new one. Even if your old blog were built with Hakyll, 301 redirects require either a dynamic site or server configuration adjustments, and so Hakyll wouldn&#39;t be involved anyway. According to <a href=\"http://stackoverflow.com/questions/24795465/use-301-redirect-in-google-blogger-blogspot\">the accepted answer of this question</a>, it is possible to set up redirects using the Blogger dashboard."}, {"owner": {"reputation": 257, "user_id": 2913145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a0a3d8b7764e3fdac9550564755cdde?s=128&d=identicon&r=PG&f=1", "display_name": "gallabytes", "link": "https://stackoverflow.com/users/2913145/gallabytes"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442452901, "post_id": 32617395, "comment_id": 53092603, "body": "The Blogger dashboard redirect options won&#39;t work - they can only redirect from blog.domain.com/FROM to blog.domain.com/TO. I need blog.domain.com/FROM to domain.com/posts/TO.  If 301 redirects won&#39;t work, what could I use in their place?"}, {"owner": {"reputation": 257, "user_id": 2913145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a0a3d8b7764e3fdac9550564755cdde?s=128&d=identicon&r=PG&f=1", "display_name": "gallabytes", "link": "https://stackoverflow.com/users/2913145/gallabytes"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442453469, "post_id": 32617395, "comment_id": 53092746, "body": "I could also just have the redirects be from domain.com/FROM to domain.com/TO and change the host records for blog.domain.com to redirect to domain.com, if that would make a difference. I&#39;m hoping to abandon Blogger entirely, so a solution that relies on Blogger isn&#39;t going to cut it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442454054, "post_id": 32617395, "comment_id": 53092888, "body": "(1) Ouch, I should have suspected that. There are a few tricks of dubious taste you might do, such as using JavaScript or meta-refresh in the source pages. See <a href=\"http://stackoverflow.com/q/9276817/2751851\">this question</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442454364, "post_id": 32617395, "comment_id": 53092970, "body": "(2) Your second comment sounds like a good plan. You will have to confirm whether it actually works, bur I think it is likely to. (3) That link in your edited question isn&#39;t going to help -- it is setting up redirects from a Hakyll site in which you can change the <code>.htaccess</code> file in your directory within the server."}, {"owner": {"reputation": 257, "user_id": 2913145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a0a3d8b7764e3fdac9550564755cdde?s=128&d=identicon&r=PG&f=1", "display_name": "gallabytes", "link": "https://stackoverflow.com/users/2913145/gallabytes"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442464723, "post_id": 32617395, "comment_id": 53095408, "body": "(3) Oy. I&#39;ll look into alternatives to Github pages then, as a Javascript redirect is not quite as desirable. The interesting thing is that it still doesn&#39;t work even when I&#39;m just using localhost."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442466212, "post_id": 32617395, "comment_id": 53095856, "body": "You will have the same problem in GitHub Pages or elsewhere, as the redirects will happen at Blogger no matter what. The best solution would definitely be changing the host records, as you say in the second comment, if that is actually possible in your case."}], "answers": [{"tags": [], "owner": {"reputation": 257, "user_id": 2913145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a0a3d8b7764e3fdac9550564755cdde?s=128&d=identicon&r=PG&f=1", "display_name": "gallabytes", "link": "https://stackoverflow.com/users/2913145/gallabytes"}, "is_accepted": true, "score": 1, "last_activity_date": 1442605295, "creation_date": 1442605295, "answer_id": 32659844, "question_id": 32617395, "link": "https://stackoverflow.com/questions/32617395/redirect-old-urls-and-subdomains-with-hakyll/32659844#32659844", "title": "Redirect old URLs (and subdomains) with Hakyll", "body": "<p>Solving this problem turned out to take a few different tricks.</p>\n\n<p>Part of it may be NameCheap specific, but all I had to do was set up a redirect from blog.domain.com to domain.com, as in <a href=\"https://www.namecheap.com/support/knowledgebase/article.aspx/385/77/how-do-i-set-up-url-forwarding-for-a-domain\" rel=\"nofollow\">this tutorial</a>.</p>\n\n<p>The other part was getting Hakyll to do the right thing for routing. After dealing with a peculiarity of the <code>gsubRoutes</code> function, this turned out to be fairly simple (code <a href=\"https://gist.github.com/GallagherCommaJack/86b729900c9ee8893467\" rel=\"nofollow\">here</a>).</p>\n"}], "owner": {"reputation": 257, "user_id": 2913145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a0a3d8b7764e3fdac9550564755cdde?s=128&d=identicon&r=PG&f=1", "display_name": "gallabytes", "link": "https://stackoverflow.com/users/2913145/gallabytes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 32659844, "answer_count": 1, "score": 0, "last_activity_date": 1442605295, "creation_date": 1442432807, "last_edit_date": 1442453907, "question_id": 32617395, "link": "https://stackoverflow.com/questions/32617395/redirect-old-urls-and-subdomains-with-hakyll", "title": "Redirect old URLs (and subdomains) with Hakyll", "body": "<p>I'm trying to migrate my site from Blogger to Hakyll (which I'll then deploy to Github pages), but I don't want all old links to break. Also, my old posts were all in blog.domain.com/, whereas now they'll be in domain.com/posts/. What's more, the URLs in Blogger only include the month and year, whereas in Hakyll they're including the day as well, which means I'll almost certainly have to do things manually. A quick Google search has not turned up answers, and I don't have enough knowledge of how-to-write-websites to solve my own problem.</p>\n\n<p>Example of the format I'm trying to redirect <em>from</em></p>\n\n<pre><code>blog.domain.com/2015/09/title.html\n</code></pre>\n\n<p>Which I would like to map <em>to</em></p>\n\n<pre><code>domain.com/posts/2015-09-08-title.html\n</code></pre>\n\n<p>EDIT: <a href=\"https://gist.github.com/jtanguy/8401281\" rel=\"nofollow\" title=\"Here&#39;s the gist\">I found something that ought to work, but doesn't</a>. After setting up my redirects exactly as in the example file, I get one of two errors:</p>\n\n<p>1) <code>unexpected character \\n</code></p>\n\n<p>OR</p>\n\n<p>2) <code>expected ListField but got StringField</code></p>\n"}, {"tags": ["list", "function", "haskell", "tuples"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1442433277, "post_id": 32617383, "comment_id": 53085707, "body": "Perhaps you should add another stage: a single tuple <code>(a, [b,c,d])</code> to the list <code>[(a,b), (a,c), (a,d)]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1442433833, "last_edit_date": 1442433833, "creation_date": 1442433243, "answer_id": 32617518, "question_id": 32617383, "link": "https://stackoverflow.com/questions/32617383/haskell-list-of-words-paired-with-a-number-in-a-tuple/32617518#32617518", "title": "Haskell: List of words paired with a number in a tuple", "body": "<p>All you have to do is apply a combination of <code>map</code> and <code>concat</code>. Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; let x = [(1,[\"a\", \"b\", \"b\", \"c\"]), (2,[\"a\", \"dd\"])]\n\u03bb&gt; map (\\(y,z) -&gt; map (\\a -&gt; (y,a)) z) x\n[[(1,\"a\"),(1,\"b\\\"),(1,\"b\"),(1,\"c\")],[(2,\"a\"),(2,\"dd\")]]\n</code></pre>\n\n<p>Note that I use two <code>map</code> functions. The outer <code>map</code> will traverse the elements of <code>x</code>. Each element of <code>x</code> (which is a tuple) is pattern matched by <code>(y,z)</code>. We know that <code>z</code> is a list. So, we use another <code>map</code> to traverse the list <code>z</code>. This inner <code>map</code> function will return a tuple of <code>(y,a)</code> where <code>a</code> is the current element which is being traversed in the list <code>z</code> and <code>y</code> is the first element of the tuple.</p>\n\n<p>Now all you need to do is apply <code>concat</code> function on the resulting list:</p>\n\n<pre><code>\u03bb&gt; concat $ map (\\(y,z) -&gt; map (\\a -&gt; (y,a)) z) x\n[(1,\"a\"),(1,\"b\"),(1,\"b\"),(1,\"c\"),(2,\"a\"),(2,\"dd\")]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1442434205, "post_id": 32617573, "comment_id": 53086221, "body": "Just a side note, <code>helper = uncurry (zip . repeat)</code>."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1442433930, "last_edit_date": 1442433930, "creation_date": 1442433438, "answer_id": 32617573, "question_id": 32617383, "link": "https://stackoverflow.com/questions/32617383/haskell-list-of-words-paired-with-a-number-in-a-tuple/32617573#32617573", "title": "Haskell: List of words paired with a number in a tuple", "body": "<p>We can design a function to take each element of that stage-4 list as so:</p>\n\n<pre><code>helper :: (Int, [a]) -&gt; [(Int, a)]\nhelper (num, xs) = zip (repeat num) xs\n</code></pre>\n\n<p>and then we can just use <code>concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code>:</p>\n\n<pre><code>fourToFive :: [(Int, [a])] -&gt; [(Int, a)]\nfourToFive = concatMap helper\n</code></pre>\n\n<p>And that is all. Here's an example:</p>\n\n<pre><code>\u03bb&gt; fourToFive [(1, [\"This\", \"is\", \"a\", \"line.\"]), (2,[\"This\",\"is\",\"another.\"])]\n[(1,\"This\"),(1,\"is\"),(1,\"a\"),(1,\"line.\"),(2,\"This\"),(2,\"is\"),(2,\"another.\")]\n</code></pre>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 32617518, "answer_count": 2, "score": 0, "last_activity_date": 1443551183, "creation_date": 1442432765, "last_edit_date": 1443551183, "question_id": 32617383, "link": "https://stackoverflow.com/questions/32617383/haskell-list-of-words-paired-with-a-number-in-a-tuple", "title": "Haskell: List of words paired with a number in a tuple", "body": "<p>I need help getting from stage 4 to stage 5. I'm not sure of a Haskell function that takes each element and puts it in a tuple. Perhaps I have do this manually, which I'm also not sure how to do. </p>\n\n<p>Here is my functions so far:</p>\n\n<pre><code>splitLines :: String -&gt; [[String]]\nsplitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords :: [String] -&gt; [[String]]\nsplitWords splitWordList = map words splitWordList\n\ntupleNums tupleNumList = zip [1..] tupleNumList\n</code></pre>\n\n<p>Stage 1: the original input, for example,</p>\n\n<pre><code>\"a&amp;b b c.\\na dd\\n\"\n</code></pre>\n\n<p>Stage 2: the original input, split into a list of lines, as in</p>\n\n<pre><code>[\"a&amp;b b c.\", \"a dd\"]\n</code></pre>\n\n<p>Stage 3: the list of lines, split further into a list of list of words, as in</p>\n\n<pre><code>[[\"a\", \"b\", \"b\", \"c\"], [\"a\", \"dd\"]]\n</code></pre>\n\n<p>Stage 4: the list of lists, \"tupled\" so that line numbers are attached to them, as in</p>\n\n<pre><code>[(1,[\"a\", \"b\", \"b\", \"c\"]), (2,[\"a\", \"dd\"])]\n</code></pre>\n\n<p>Stage 5: the list of words (all at the top level) where each is paired with its line number, as in</p>\n\n<pre><code>[(1,\"a\"), (1,\"b\"), (1,\"b\"), (1,\"c\"), (2,\"a\"), (2,\"dd\")]\n</code></pre>\n"}, {"tags": ["haskell", "zeromq"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1442432008, "post_id": 32616964, "comment_id": 53084998, "body": "You will have to use Software Transactional Memory structure in a separate thread with a <code>MVar</code>. The <code>MVar</code> starts with no value and is shared between threads. In the separate thread, block until <code>&#39;q&#39;</code> is pressed and place a token in the <code>MVar</code>. In your working thread you will poll at each recursive step if the <code>MVar</code> has a value."}, {"owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1442437251, "post_id": 32616964, "comment_id": 53087809, "body": "could you post this code directly, i do not know the syntax and which library or function should be used. Moreover, how to stop the zeropmq in haskell?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1442441606, "post_id": 32616964, "comment_id": 53089767, "body": "I&#39;m voting to close this question as off-topic because it shows no prior attempt at solving the problem."}, {"owner": {"reputation": 1, "user_id": 3666197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79fc6c23061326c7e6a6f82a1663634b?s=128&d=identicon&r=PG", "display_name": "user3666197", "link": "https://stackoverflow.com/users/3666197/user3666197"}, "edited": false, "score": 1, "creation_date": 1442493007, "post_id": 32616964, "comment_id": 53109730, "body": "You may want to <b>read whathaveyoutried.com &amp; show some respect to the StackOverflow Community</b>, which strongly encourages to post high quality questions, altogether with a <b>MCVE ( a Minimum-Complete-Verifiable-Example of code ) showing what-you-have-tried so far.</b> You may want to update your post, so as to meet this minimum reasonable level of quality &amp; to show your will to respect other StackOverflow contributing members. They are professionals who love to answer good questions on MCVE-related issues. <b>Enjoy being StackOverflow Contributing Member &amp; do support this Community Netiquette</b>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3666197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79fc6c23061326c7e6a6f82a1663634b?s=128&d=identicon&r=PG", "display_name": "user3666197", "link": "https://stackoverflow.com/users/3666197/user3666197"}, "is_accepted": false, "score": 1, "last_activity_date": 1442518322, "last_edit_date": 1442518322, "creation_date": 1442516908, "answer_id": 32638196, "question_id": 32616964, "link": "https://stackoverflow.com/questions/32616964/how-to-add-a-code-to-exit-this-zeromq-example-by-press-keyboard-q-button/32638196#32638196", "title": "how to add a code to exit this zeromq example by press keyboard q button", "body": "<h2>Process-to-process message passing is the very power of the ZeroMQ, so use it:</h2>\n\n<ol>\n<li>design a central <strong><code>aKbdMONITOR</code></strong>-thread, that monitors Keyboard and scans for <kbd><strong><code>Q</code></strong></kbd> | <kbd><strong><code>q</code></strong></kbd></li>\n</ol>\n\n<blockquote>\n<pre><code>async $ clientTask \"C\"\nasync $ aKbdMONITOR                    -- Add central-service async thread\n</code></pre>\n</blockquote>\n\n<ol start=\"2\">\n<li>equip this <code>aKbdMONITOR</code>-thread with a <strong><code>PUB</code></strong> service to broadcast to any <strong><code>SUB</code></strong>-side an appearance of such event</li>\n</ol>\n\n<blockquote>\n<pre><code>aKbdSCANNER &lt;- socket Pub              -- PUB-side adequate ZeroMQ Archetype\nbind aKbdSCANNER \"tcp://*:8123\"        -- yes, can serve even for remote hosts\n</code></pre>\n</blockquote>\n\n<ol start=\"3\">\n<li>equip all other threads with a <strong><code>SUB</code></strong> pattern part and review any subsequent arriving event-notification from <code>aKbdMONITOR</code>-thread to decide locally about self-termination in case <code>aKbdMONITOR</code>-thread announces such case as requested above to exit</li>\n</ol>\n\n<blockquote>\n<pre><code>aKbdSCANNER &lt;- socket Sub              -- SUB-side adequate ZeroMQ Archetype\nconnect aKbdSCANNER \"tcp://ipKBD:8123\" -- tcp transport-class remote ipKBD\n--\n-- + do not forget to subscribe\n-- + use poll to scan\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1442518322, "creation_date": 1442431343, "question_id": 32616964, "link": "https://stackoverflow.com/questions/32616964/how-to-add-a-code-to-exit-this-zeromq-example-by-press-keyboard-q-button", "title": "how to add a code to exit this zeromq example by press keyboard q button", "body": "<p><a href=\"http://zguide.zeromq.org/hs:asyncsrv\" rel=\"nofollow\">http://zguide.zeromq.org/hs:asyncsrv</a></p>\n\n<p>hope to terminate the program by press q to exit </p>\n\n<pre><code>main :: IO ()\nmain =\n    runZMQ $ do\n        async $ clientTask \"A\"\n        async $ clientTask \"B\"\n        async $ clientTask \"C\"\n        async serverTask\n\n        liftIO $ threadDelay $ 5 * 1000 * 1000\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1442430156, "post_id": 32616504, "comment_id": 53083973, "body": "I&#39;m more thinking fo passing the config file as a parameter , so I can chose which one to use. Does dyre as such options ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1442432161, "post_id": 32616504, "comment_id": 53085068, "body": "@mb14 If you look at the documentation, you will soon know the answer exactly as well as I do."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1442429571, "creation_date": 1442429571, "answer_id": 32616504, "question_id": 32616204, "link": "https://stackoverflow.com/questions/32616204/config-file-in-haskell/32616504#32616504", "title": "Config file in haskell", "body": "<p><a href=\"http://hackage.haskell.org/package/dyre-0.8.12/docs/Config-Dyre.html\" rel=\"nofollow\">dyre</a> looks like it fits the bill.</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 32616504, "answer_count": 1, "score": 1, "last_activity_date": 1442429571, "creation_date": 1442428647, "question_id": 32616204, "link": "https://stackoverflow.com/questions/32616204/config-file-in-haskell", "title": "Config file in haskell", "body": "<p>I would like to be able to provide to my Haskell app and config file written in Haskell. The reason why is because I would like the user to be able to provide a few custom functions.</p>\n\n<p>Is it possible to load a haskell file at runtime, even though it might depend on some type provided by the app itself.</p>\n\n<p>At the moment, I have a super main function, and I build a new executable per config file. The file basically, declares some hooks and call super main with them. The problem with that is, at the moment I have to define a new target for each config in my cabal file (I use a sandbox, and  I don't want to have to install any library part of my package). I thought using runghc instead but I do I make it works with the sandbox ? I've seen there is a 'plugin' package on hackage but it does't seem to be up to date. What is the common way to deal with this type of problem ? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 5, "creation_date": 1442426757, "post_id": 32615426, "comment_id": 53082139, "body": "You don&#39;t need the <code>if ... then True else False</code> in the definition of <code>testdate</code>.  The <code>1 &lt;= m &amp;&amp; ... &amp;&amp; y &gt;= 0</code> expression evaluates to <code>True</code> or <code>False</code> on its own, so your function can just be that."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1442429016, "post_id": 32615426, "comment_id": 53083342, "body": "Also, when you are comparing two things, you use the equality operator which is <code>==</code> not <code>=</code>. You are also comparing a function to a Bool, which doesn&#39;t make sense (as in, it doesn&#39;t type check). You probably meant to do this <code>testdate (Date m d y) == True</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1442431954, "post_id": 32615426, "comment_id": 53084974, "body": "The function <code>testDate</code> has the wrong type: it claims to return <code>Maybe Date</code>, but actually returns <code>Bool</code>. You&#39;ll need to give it the correct type (or omit the type entirely to let haskell infer it for you) in order to use it."}], "answers": [{"comments": [{"owner": {"reputation": 551, "user_id": 4289170, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/818805709/picture?type=large", "display_name": "Mike Henke", "link": "https://stackoverflow.com/users/4289170/mike-henke"}, "edited": false, "score": 0, "creation_date": 1442426689, "post_id": 32615536, "comment_id": 53082087, "body": "Thank you so much! Didn&#39;t realize it would be so simple. Appreciate the help"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1442444781, "post_id": 32615536, "comment_id": 53090692, "body": "Higher-level version: <code>betterdate = mfilter testdate . Just</code>. (<code>mfilter</code> is in <code>Control.Monad</code>.)"}], "tags": [], "owner": {"reputation": 205730, "user_id": 15055, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7f71287b47b7189d11fe6d3fbc7ed2fe?s=128&d=identicon&r=PG", "display_name": "Claudiu", "link": "https://stackoverflow.com/users/15055/claudiu"}, "is_accepted": true, "score": 5, "last_activity_date": 1442426446, "last_edit_date": 1442426446, "creation_date": 1442426305, "answer_id": 32615536, "question_id": 32615426, "link": "https://stackoverflow.com/questions/32615426/checking-function-in-haskell/32615536#32615536", "title": "Checking function in Haskell", "body": "<p>You want to pass your date to the <code>testdate</code> function. This should work:</p>\n\n<pre><code>betterdate d = if testdate d\n    then Just d\n    else Nothing\n</code></pre>\n\n<p>If you really want to unpack the <code>Date</code> in the parameter list then you can do this to avoid duplicating <code>(Date m d y)</code> everwhere:</p>\n\n<pre><code>betterdate date@(Date m d y) = if testdate date\n    then Just date\n    else Nothing\n</code></pre>\n"}], "owner": {"reputation": 551, "user_id": 4289170, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/818805709/picture?type=large", "display_name": "Mike Henke", "link": "https://stackoverflow.com/users/4289170/mike-henke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 32615536, "answer_count": 1, "score": 3, "last_activity_date": 1442426446, "creation_date": 1442425942, "question_id": 32615426, "link": "https://stackoverflow.com/questions/32615426/checking-function-in-haskell", "title": "Checking function in Haskell", "body": "<p>I'm working on some CS homework and this is my first experience with Haskell, so I have a question. </p>\n\n<p>I've declared a data type </p>\n\n<pre><code>data Date = Date Int Int Int deriving (Show)\n</code></pre>\n\n<p>and I have this function testdate:</p>\n\n<pre><code>testdate :: Date -&gt; Maybe Date\ntestdate (Date m d y) = if 1 &lt;= m &amp;&amp; m &lt;= 12 &amp;&amp; 1 &lt;= d &amp;&amp; d &lt;= 31 &amp;&amp; y &gt;= 0\n    then\n        True\n    else\n        False\n</code></pre>\n\n<p>I want to make a new function that checks to see if testdate is true or false, then returns to you the date.\nsomething like:</p>\n\n<pre><code>betterdate :: Date -&gt; Maybe Date\nbetterdate (Date m d y) if (testdate = True) //I know this part doesn't work\n     then Just (Date m d y) \n     else Nothing\n</code></pre>\n\n<p>How would I do this?</p>\n"}, {"tags": ["c++", "performance", "haskell", "ffi"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1442421541, "post_id": 32614044, "comment_id": 53079095, "body": "How long are those strings? How many of them? Aren&#39;t you able to provide a small example that reproduces the issue?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442423173, "post_id": 32614044, "comment_id": 53080045, "body": "How is your data represented to start with?"}, {"owner": {"reputation": 59, "user_id": 5343241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb30f6788bb14e5a0c3d56377e8a90b9?s=128&d=identicon&r=PG&f=1", "display_name": "ooblahman", "link": "https://stackoverflow.com/users/5343241/ooblahman"}, "edited": false, "score": 0, "creation_date": 1442453028, "post_id": 32614044, "comment_id": 53092640, "body": "It&#39;s a standard type with 5 fields, and I&#39;m converting to/from strings to pass to a database client in C. I&#39;ve additionally tried allocating all at once with mallocBytes and there seems to be just as slow. Another datapoint is that GHC&#39;s profiling indicated that ~15 GBs were being allocated for this ~100MB set of data."}, {"owner": {"reputation": 59, "user_id": 5343241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb30f6788bb14e5a0c3d56377e8a90b9?s=128&d=identicon&r=PG&f=1", "display_name": "ooblahman", "link": "https://stackoverflow.com/users/5343241/ooblahman"}, "edited": false, "score": 0, "creation_date": 1442453098, "post_id": 32614044, "comment_id": 53092653, "body": "Also tried standard marshalling with newCString (above) and using Data.Vector.Storable to store a list of Storable chars."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442503166, "post_id": 32614044, "comment_id": 53116815, "body": "Well it&#39;s hard to give advice about what you should do without any code, but one thing you definitely shouldn&#39;t do is process 100MB worth of <code>String</code>s, which will already account for at least 4GB of heap allocation."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457559466, "creation_date": 1457559466, "answer_id": 35903131, "question_id": 32614044, "link": "https://stackoverflow.com/questions/32614044/haskell-ffi-memory-allocation-performance-issue/35903131#35903131", "title": "Haskell FFI memory allocation performance issue", "body": "<p>As Reid Barton said in comments, if you have 100MB of strings, your allocation will be terrible to begin with, no matter what you do with it.</p>\n\n<p>Your slowdown isn't from the FFI, its from having 100MB of strings to begin with.</p>\n"}, {"tags": [], "owner": {"reputation": 448, "user_id": 4416280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c4e7c5ba681838526fb520fc8f36dec?s=128&d=identicon&r=PG&f=1", "display_name": "Zemyla", "link": "https://stackoverflow.com/users/4416280/zemyla"}, "is_accepted": false, "score": 0, "last_activity_date": 1488681314, "creation_date": 1488681314, "answer_id": 42603823, "question_id": 32614044, "link": "https://stackoverflow.com/questions/32614044/haskell-ffi-memory-allocation-performance-issue/42603823#42603823", "title": "Haskell FFI memory allocation performance issue", "body": "<p>You will probably have to make a custom data type, using a <a href=\"http://hackage.haskell.org/package/primitive-0.6.2.0/docs/Data-Primitive-ByteArray.html#t:MutableByteArray\" rel=\"nofollow noreferrer\"><code>MutableByteArray</code></a> allocated with <a href=\"http://hackage.haskell.org/package/primitive-0.6.2.0/docs/Data-Primitive-ByteArray.html#v:newAlignedPinnedByteArray\" rel=\"nofollow noreferrer\"><code>newAlignedPinnedByteArray</code></a>, and turned into something that can be passed to C with <a href=\"http://hackage.haskell.org/package/primitive-0.6.2.0/docs/Data-Primitive-ByteArray.html#v:mutableByteArrayContents\" rel=\"nofollow noreferrer\"><code>mutableByteArrayContents</code></a>.</p>\n\n<p>The alternative, if you can rewrite the C API you're interfacing with, is to give the C function a <code>FunPtr</code> which passes it a reasonable-sized chunk of the Haskell data you're working with at a time.</p>\n"}], "owner": {"reputation": 59, "user_id": 5343241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb30f6788bb14e5a0c3d56377e8a90b9?s=128&d=identicon&r=PG&f=1", "display_name": "ooblahman", "link": "https://stackoverflow.com/users/5343241/ooblahman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1488681314, "creation_date": 1442421063, "last_edit_date": 1456122779, "question_id": 32614044, "link": "https://stackoverflow.com/questions/32614044/haskell-ffi-memory-allocation-performance-issue", "title": "Haskell FFI memory allocation performance issue", "body": "<p>I'm using an FFI to C to send medium-large amounts of data (~100MB) to a C program -- just a list of strings. However, all of the methods I've used seem to take unreasonable amounts of time (~10 sec). Upon profiling, it appears to be the actual memory allocation that takes time. I've tried: </p>\n\n<ul>\n<li>sending as regular strings (<code>newCString</code>) </li>\n<li>conversion to ByteStrings (<code>unsafeUseAsCString</code>)</li>\n<li>conversion to vector of chars (<code>unsafeWith &gt;&gt;= withForeignPtr ...</code>)</li>\n</ul>\n\n<p>What is the fastest way to send data across a C FFI? </p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1442423267, "last_edit_date": 1495540921, "creation_date": 1442421874, "answer_id": 32614266, "question_id": 32612060, "link": "https://stackoverflow.com/questions/32612060/in-reactive-banana-is-it-safe-to-trigger-handler-actions-from-multiple-threads/32614266#32614266", "title": "In reactive-banana, is it safe to trigger handler actions from multiple threads?", "body": "<p>Firing the <code>fire</code> handler itself is safe; it reads an <code>IORef</code> that is being updated atomically and runs each of the added handlers in the current thread. Whether or not that's safe will depend on what handlers have been added to the <code>addHandler</code>.</p>\n\n<p>Using the <code>addHandler</code> in <code>interpretAsHandler</code>, <code>fromAddHandler</code>, or <code>fromChanges</code> should be safe. Nothing I know of in reactive-banana has any thread affinity, and even if it did, these are what <code>newAddHandler</code> was made for, so it should be safe anyway.</p>\n\n<p>What you need to be careful of is the <code>IO ()</code> actions executed by <code>reactimate</code>. If you need to reactimate <code>IO</code> actions that need to be run in a specific thread (for OpenGL output, etc), you need to only produce <code>IO ()</code> actions that will send their data to that thread. In this <a href=\"https://stackoverflow.com/a/26112094/414413\">complete OpenGL example for reactive-banana</a> the <code>IO ()</code> actions for OpenGL output, which have thread affinity, are run in the OpenGL thread. Instead of<code>reactimate</code>ing the <code>Event (IO ())</code> executing them directly they are added to an <code>IORef</code></p>\n\n<pre><code>whenIdleRef &lt;- newIORef (return ())\nlet\n    addWhenIdle :: IO () -&gt; IO ()\n    addWhenIdle y = atomicModifyIORef' whenIdleRef (\\x -&gt; (x &gt;&gt; y, ()))\n    runWhenIdle :: IO ()\n    runWhenIdle = atomicModifyIORef' whenIdleRef (\\x -&gt; (return (), x)) &gt;&gt;= id\n\nlet networkDescription  :: forall t. Frameworks t =&gt; Moment t ()\n    networkDescription  = do\n\n        reactimate $ fmap addWhenIdle (whenIdle outputs)\n                     ^                ^\n                     |                Event (IO ())\n                     Stuff the event into an IORef\n</code></pre>\n\n<p>The <code>IORef</code> holding which <code>IO ()</code> actions to run is read and each of all the actions are run in a context that I know is in the OpenGL thread.</p>\n\n<pre><code>idleCallback $= Just (do           -- will be executed in the OpenGL thread when it's idle\n    getCurrentTime &gt;&gt;= raiseTime\n    runWhenIdle                    -- run those `IO ()` actions in this thread\n    postRedisplay Nothing)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 4, "last_activity_date": 1442484199, "creation_date": 1442484199, "answer_id": 32627635, "question_id": 32612060, "link": "https://stackoverflow.com/questions/32612060/in-reactive-banana-is-it-safe-to-trigger-handler-actions-from-multiple-threads/32627635#32627635", "title": "In reactive-banana, is it safe to trigger handler actions from multiple threads?", "body": "<p>Yes, this is safe, but there is the caveat that @Cirdec mentioned.</p>\n\n<p>For conreteness, consider the following example that creates an event network using the <code>addHandler</code> in a separate thread and then calls <code>fire</code> repeatedly in the main thread</p>\n\n<pre><code>import Control.Concurrent (myThreadId, threadDelay, forkIO)\n\nmain = do\n    ...\n    (addHandler, fire) &lt;- newAddHandler\n\n    let networkDescription :: MomentIO ()\n        networkDescription = do\n           e &lt;- fromAddHandler addHandler\n           ...\n           reactimate $ (print =&lt;&lt; myThreadId) &lt;$ e   -- reactimate\n\n    forkIO $ do\n        network &lt;- compile networkDescription\n        actuate network\n    ...\n    forever $ do                                      -- event loop\n        threadDelay (10^6)\n        fire ()\n</code></pre>\n\n<p>(See the documentation <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Concurrent.html#g:12\" rel=\"nofollow\">\"Terminating the program\" in Control.Concurrent</a> for why I've put the event loop in the main thread as opposed to putting the network in the main thread.)</p>\n\n<p>In this and similar situations, the following will hold:</p>\n\n<ul>\n<li>The IO actions executed by the <code>reactimate</code> will be run in the thread that calls <code>fire</code>, <em>not</em> in the thread where the network was compiled. This is what @Cirdec already mentioned.</li>\n<li>If there were a second thread also calling <code>fire</code>, then it could potentially interleave with other calls to <code>fire</code>, i.e. the program could be calling <code>fire</code> twice concurrently. Then,\n\n<ul>\n<li>Reactive-banana uses a lock to ensure that Behaviors and Events are updated consistently. You can treat them as pure functions <code>Time -&gt; a</code> and lists <code>[(Time,a)]</code> as usual.</li>\n<li>However, the IO actions from the <code>reactimate</code>s may interleave. In other words, the pure FRP part will stay pure, but the actual IO is subject to concurrency as usual.</li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "accepted_answer_id": 32627635, "answer_count": 2, "score": 6, "last_activity_date": 1442484199, "creation_date": 1442415199, "last_edit_date": 1442418991, "question_id": 32612060, "link": "https://stackoverflow.com/questions/32612060/in-reactive-banana-is-it-safe-to-trigger-handler-actions-from-multiple-threads", "title": "In reactive-banana, is it safe to trigger handler actions from multiple threads?", "body": "<p>Is it safe to trigger the fire action in</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(addHandler, fire) &lt;- newAddHandler\n</code></pre>\n\n<p>from a different thread from which the reactive-banana graph was compiled?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 3602161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001472487586/picture?type=large", "display_name": "La&#39;tel", "link": "https://stackoverflow.com/users/3602161/latel"}, "edited": false, "score": 0, "creation_date": 1442418897, "post_id": 32612427, "comment_id": 53077356, "body": "This works. But one question - why is there 8 elements instead of 9 ?  The result should be something like  [6,8,10,12,15,16,20,20,25]. From what I read in documentation, it should allow duplicates also, same thing with [2,2,2] [4,4,4] results in [8,8,8] and not [8,8,8,8,8,8,8,8,8]. This seems strange to me."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 127, "user_id": 3602161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001472487586/picture?type=large", "display_name": "La&#39;tel", "link": "https://stackoverflow.com/users/3602161/latel"}, "edited": false, "score": 1, "creation_date": 1442419262, "post_id": 32612427, "comment_id": 53077589, "body": "From the <code>unionAll</code> documentation: &quot;The result will duplicate an element as many times as the maximum number of occurrences in any single list. Thus, the result is a set if and only if every inner list is a set&quot;"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 127, "user_id": 3602161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001472487586/picture?type=large", "display_name": "La&#39;tel", "link": "https://stackoverflow.com/users/3602161/latel"}, "edited": false, "score": 3, "creation_date": 1442419291, "post_id": 32612427, "comment_id": 53077617, "body": "@La&#39;tel <code>unionAll</code> only keeps duplicates <i>within</i> each list. If you want to keep <i>all</i> duplicates, use <code>mergeAll</code> instead."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1442419614, "last_edit_date": 1442419614, "creation_date": 1442416112, "answer_id": 32612427, "question_id": 32611665, "link": "https://stackoverflow.com/questions/32611665/data-list-ordered-unionallby-comparing-infinite-lists/32612427#32612427", "title": "Data.List.Ordered.unionAllBy comparing infinite lists", "body": "<p>The comparison passed to <code>unionAllBy</code> is a function with the same type and following the same rules as the <code>compare</code> function from an <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#t:Ord\" rel=\"nofollow\"><code>Ord</code></a> instance. If you have an <code>Ord</code> instance you can use <a href=\"https://hackage.haskell.org/package/data-ordlist/docs/Data-List-Ordered.html#v:unionAll\" rel=\"nofollow\"><code>unionAll</code></a> instead of <code>unionAllBy</code>.</p>\n\n<pre><code>unionAllBy ::          (a -&gt; a -&gt; Ordering) -&gt; [[a]] -&gt; [a]\nunionAll   :: Ord a =&gt;                         [[a]] -&gt; [a]\ncompare    :: Ord a =&gt;  a -&gt; a -&gt; Ordering\n\nunionAll = unionAllBy compare\n</code></pre>\n\n<p>A comparison function takes two objects and says what order they are in: <code>LT</code>, <code>EQ</code>, or <code>GT</code>. The best explanation of what <code>compare</code> should do is probably the default definition for it in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#verbatim-167\" rel=\"nofollow\"><code>Ord</code> class in the standard prelude</a></p>\n\n<blockquote>\n<pre><code>compare x y  \n     | x == y    =  EQ  \n     | x &lt;= y    =  LT  \n     | otherwise =  GT  \n\nx &lt;= y           =  compare x y /= GT  \nx &lt;  y           =  compare x y == LT  \nx &gt;= y           =  compare x y /= LT  \nx &gt;  y           =  compare x y == GT\n</code></pre>\n</blockquote>\n\n<p>The <code>unionAll</code> function will make a union of your <code>sequence2</code> lists in order removing duplicates from between lists. <code>unionAll</code> doesn't remove duplicates present in a single input list.</p>\n\n<pre><code>&gt; unionAll $ sequence2 [2,4,5] [3,4,5]\n[6,8,10,12,15,16,20,25]\n                 ^\n                 only one twenty\n</code></pre>\n\n<p>It will also flatten <code>sequence2</code> applied to infinite lists in order</p>\n\n<pre><code>&gt; take 12 . unionAll $ sequence2 [2,4..] [3,5..]\n[6,10,12,14,18,20,22,24,26,28,30,34]\n</code></pre>\n\n<p>If you want to keep duplicates, use <a href=\"https://hackage.haskell.org/package/data-ordlist/docs/Data-List-Ordered.html#v:mergeAll\" rel=\"nofollow\"><code>mergeAll</code></a> instead.</p>\n\n<pre><code>&gt; mergeAll $ sequence2 [2,4,5] [3,4,5]\n[6,8,10,12,15,16,20,20,25]\n                 ^  ^\n                 two twenties\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 3602161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001472487586/picture?type=large", "display_name": "La&#39;tel", "link": "https://stackoverflow.com/users/3602161/latel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 32612427, "answer_count": 1, "score": 4, "last_activity_date": 1442419614, "creation_date": 1442414196, "last_edit_date": 1442416271, "question_id": 32611665, "link": "https://stackoverflow.com/questions/32611665/data-list-ordered-unionallby-comparing-infinite-lists", "title": "Data.List.Ordered.unionAllBy comparing infinite lists", "body": "<p>So I have as inputs 2 sorted lists, that can be infinite. \nI have to write a function prod, that returns basically a product of cartesian product coordinates in sorted order. </p>\n\n<p>Example:</p>\n\n<pre><code>prod [2,4,5,10] [2,3] -&gt; [4,6,8,10,12,15,20,30]\n</code></pre>\n\n<p>For finite lists, it is as easy as</p>\n\n<pre><code>import Data.List\nprod xs ys = sort [x*y | x&lt;-xs, y&lt;-ys]\n</code></pre>\n\n<p>But problem is when I try to use it with infinite lists. I was thinking that because inputs are sorted, I can use <code>Data.List.Ordered.unionAllBy</code>, but I can't understand how to use it. The comparing option confuses me. </p>\n\n<p>So I Could use a function I wrote: </p>\n\n<pre><code>sequence2 xs ys = [[i*j| i&lt;-xs]|j&lt;-ys]\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>sequence2 [2,4,5] [3,4,5] -&gt; [[6,12,15],[8,16,20],[10,20,25]]\n</code></pre>\n\n<p>I imagine my solution would look something like:</p>\n\n<pre><code>Data.List.Ordered.unionAllBy (comparison) (sequence' xs ys)\n</code></pre>\n\n<p>Any hints how I can modify this to use infinite lists as well? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442415543, "post_id": 32611477, "comment_id": 53075034, "body": "Plese edit your question to add the definition of <code>beta</code>, so that we can run your code exactly as posted."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442416382, "post_id": 32611477, "comment_id": 53075682, "body": "<code>beta = 0.01</code> seems to fit the test cases."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1442446234, "last_edit_date": 1442446234, "creation_date": 1442415786, "answer_id": 32612294, "question_id": 32611477, "link": "https://stackoverflow.com/questions/32611477/function-cannot-handle-big-values-of-n-close-to-400/32612294#32612294", "title": "function cannot handle big values of n (close to 400)", "body": "<p>After a rethink, completely changing my answer:</p>\n\n<p>Your problem is that you are using <code>Float</code>, which only has single floating point precision, and already <code>0.25 ** 100 :: Float</code> is equal to <code>0</code>, which means no term with that high exponent will give <em>any</em> contribution to the sum. <code>0.75 == 1 - 0.25</code> lasts a little longer, but <code>0.75 ** 400 :: Float</code> is also <code>0</code>.</p>\n\n<p>As a result, your sum becomes far too low, in some cases so low that no interval is found that exceeds your <code>beta</code>, causing an infinite recursion.</p>\n\n<p>If you use the double precision <code>Double</code> instead, all your test cases will run, with the second one giving a different answer.  Mind you, if you go just a little further above <code>500</code>, even <code>Double</code> starts giving zeros.</p>\n\n<p>Addendum: I thought again and my previous reasoning was still a bit off. The problem also involves the binomial coefficients becoming too <em>large</em>. When your original second case answered <code>[19,30]</code>, <code>probaMet</code> actually returned an <code>Infinity</code> value, and some others tests combine both too large and too small to give the dreaded <code>NaN</code>. The reason is still the use of <code>Float</code>, though.</p>\n"}], "owner": {"reputation": 41, "user_id": 5342325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04478096a9a6671896a5aac56d3b788a?s=128&d=identicon&r=PG&f=1", "display_name": "melody123", "link": "https://stackoverflow.com/users/5342325/melody123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 32612294, "answer_count": 1, "score": 2, "last_activity_date": 1442446234, "creation_date": 1442413702, "last_edit_date": 1495541201, "question_id": 32611477, "link": "https://stackoverflow.com/questions/32611477/function-cannot-handle-big-values-of-n-close-to-400", "title": "function cannot handle big values of n (close to 400)", "body": "<p>This is from a project for statistics. I defined the functions below, but the second is slow when n grows close to 400. The first method is fine (some people here have helped me <a href=\"https://stackoverflow.com/questions/32608913/how-to-optimize-a-sum-over-list-comprehension\">in this question</a>)</p>\n\n<pre><code>import Math.Combinatorics.Exact.Binomial -- from `exact-combinatorics` package\n\nprobaMet :: [Integer] -&gt; Float-&gt; Integer -&gt; Float\nprobaMet [i,j] p n = sum [(p**fromIntegral l)*(fromIntegral(n `choose` l))*((1-p)**fromIntegral (n-l)) | l &lt;- [i,i+1..j]]\n\n\nindices :: [Int] -&gt; Float-&gt; Int -&gt; [Int]\nindices [] _ _      = [1,2]\nindices [i,j] p n\n  | probaMet [toInteger i,toInteger j] p (toInteger n) &gt;= beta  = [i,j]\n  | otherwise                       = indices [(i-1),(j+1)] p n\n</code></pre>\n\n<p>I am supposed to make a computation with n=500, so any help would be great. This is what happens</p>\n\n<pre><code> Main&gt; indexEstadisticos [24,25] 0.25 100\n[24,25]\n*Main&gt; indexEstadisticos [24,25] 0.25 250\n[19,30]\n*Main&gt; indexEstadisticos [24,25] 0.25 400\n</code></pre>\n"}, {"tags": ["haskell", "gcc", "clang", "ghc"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1442411119, "post_id": 32610089, "comment_id": 53071659, "body": "I think ghc is too tied to gcc. Why not use LLVM backend?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1442411488, "post_id": 32610089, "comment_id": 53071933, "body": "You can try -pgmc and friends, see <a href=\"https://downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/options-phases.html#replacing-phases\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/&hellip;</a> No guarantee that it will work though."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442412080, "post_id": 32610089, "comment_id": 53072378, "body": "You can certainly edit the <code>settings</code> file as described in that other answer. Another way to find it is <code>cat $(which ghc)</code> and look in the directory specified with the <code>-B</code> option."}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442413015, "post_id": 32610089, "comment_id": 53073125, "body": "To be precise: creating  ~/.ghc/x86_64-linux-7.6.3/settings with desired entries changes nothing on linux mint 17 or ubuntu 14.04, so I don&#39;t duplicate question. @ReidBarton could you clarify what you mean by   -B option, please?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442413170, "post_id": 32610089, "comment_id": 53073242, "body": "Have you read the output of <code>cat $(which ghc)</code>?"}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1442413318, "post_id": 32610089, "comment_id": 53073362, "body": "I&#39;m trying to use <code>shake</code> build system to compile code which is linked with other libraries cross compiled with clang on mac os. That&#39;s why I&#39;m trying to use clang on my machine."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442413382, "post_id": 32610089, "comment_id": 53073401, "body": "Actually you can ask ghc for the location directly: <code>ghc --print-libdir</code> (it is also in the <code>ghc --info</code> output)."}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442413499, "post_id": 32610089, "comment_id": 53073479, "body": "@ReidBarton yes, changing entry in <code>&#47;usr&#47;lib&#47;ghc&#47;settings</code> works. Thanks!"}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442413805, "post_id": 32610089, "comment_id": 53073704, "body": "@ReidBarton if you change your comment to an answer, I could mark it  as answered."}], "owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "closed_date": 1442418390, "answer_count": 0, "score": 3, "last_activity_date": 1450275807, "creation_date": 1442410366, "last_edit_date": 1495540337, "question_id": 32610089, "link": "https://stackoverflow.com/questions/32610089/change-c-compiler-command-in-ghc-on-linux", "closed_reason": "Duplicate", "title": "Change C compiler command in ghc on Linux", "body": "<p>How to switch compiler on linux in ghc from gcc to clang? <code>ghc --info</code> gives me </p>\n\n<pre><code>ghc --info\n[(\"Project name\",\"The Glorious Glasgow Haskell Compilation System\")\n,(\"GCC extra via C opts\",\" -fwrapv\")\n,(\"C compiler command\",\"/usr/bin/gcc\")\n...\n]\n</code></pre>\n\n<p>and I couldn't find a way to change path to compiler.\nThis question has been marked as duplicated, however <a href=\"https://stackoverflow.com/questions/20349104/using-gcc-instead-of-clang-in-ghci-or-ghc\">this answer</a> doesn't provide any solution as creating ~/.ghc/x86_64-linux-7.6.3/settings with desired entries changes nothing on linux mint 17 or ubuntu 14.04 - that answer probably solves problem only on Mac OS X. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1442407682, "post_id": 32608913, "comment_id": 53068978, "body": "Why is that returning a <code>Double</code>? All the operations are integral"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442407979, "post_id": 32608913, "comment_id": 53069201, "body": "Where do you define <code>choose</code>? The only version I can find on Hoogle is from QuickCheck and that type does not match so I&#39;m assuming it&#39;s your own implementation or an import? That seems to me the most likely place where the definition is inefficient."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442408196, "post_id": 32608913, "comment_id": 53069394, "body": "I assume it is something equivalent to <code>choose n l = product [n-l+1 .. n] `div` product [1..l]</code> in which case I have no trouble running e.g. <code>probaMetodo 200 300 0.6 500</code> in GHCi, it takes almost no time."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1442408508, "post_id": 32608913, "comment_id": 53069645, "body": "@BenjaminGruenbaum <code>p</code> is almost certainly a probability, so not integral."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442408519, "post_id": 32608913, "comment_id": 53069655, "body": "Hayoo points out <a href=\"http://hackage.haskell.org/package/math-functions-0.1.5.2/docs/Numeric-SpecFunctions.html#v:choose\" rel=\"nofollow noreferrer\"><code>Numeric.SpecFunctions.choose</code></a>, which indeed computes a binomial coefficient (and happens to return a <code>Double</code>)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442408574, "post_id": 32608913, "comment_id": 53069695, "body": "@duplode But then the code above wouldn&#39;t compile at all, due to the <code>fromIntegral</code>."}, {"owner": {"reputation": 41, "user_id": 5342325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04478096a9a6671896a5aac56d3b788a?s=128&d=identicon&r=PG&f=1", "display_name": "melody123", "link": "https://stackoverflow.com/users/5342325/melody123"}, "edited": false, "score": 1, "creation_date": 1442409446, "post_id": 32608913, "comment_id": 53070317, "body": "it is from this module:  Math.Combinatorics.Exact.Binomial"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442413064, "post_id": 32608913, "comment_id": 53073163, "body": "@&#216;rjanJohansen Oops, I had read it too quickly. @melody123 When trying it here, <code>probaMetodo 200 300 0.6 500</code> finishes near-instantly as &#216;rjan described even if using <a href=\"https://hackage.haskell.org/package/exact-combinatorics-0.2.0.8/docs/Math-Combinatorics-Exact-Binomial.html\" rel=\"nofollow noreferrer\">the same <code>choose</code> as you</a>. I guess we will need to know a little more about your scenario. Just to be 100% sure: have you tested <code>probaMetodo</code> separately from the rest of your code? If not, chances are sthat something else is blame for the slowness."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442413899, "post_id": 32608913, "comment_id": 53073791, "body": "@duplode: Sorry I was afraid this would happen. I went through this with melody123 and the problem is indeed not in this function. Because I thought my answer was no longer useful, I deleted it (with the comments). I suggested melody123 would write a different question and close this one or edit this one, he wrote a <a href=\"http://stackoverflow.com/questions/32611477/function-cannot-handle-big-values-of-n-close-to-400\">different one</a> but this one is not deleted yet (@melody123: I think this would be a good time for that)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442414848, "post_id": 32608913, "comment_id": 53074573, "body": "@SamvanHerwaarden Having a new question is not ideal, but I don&#39;t think deleting is necessary (specially given that deleting too many of your own questions early on can pave the way to a question ban). I suggest voting to close (none of the close reasons are a great fit, so I guess I&#39;ll just go with &quot;unclear what you are asking&quot;) and linking the new question to this one to provide context."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442417703, "post_id": 32608913, "comment_id": 53076527, "body": "@SamvanHerwaarden I read your comment too quickly and missed some of it (second time I do that in this question -- I probably need some coffee!), so I&#39;d better correct the &quot;not ideal&quot; I wrote above. Generally speaking, radically changing your question after someone has answered is <i>not</i> okay, as it causes confusion and wastes the time of the answerer. In such cases, asking a new question (without deleting the old one) tends to be better. This question is kind of an edge case, though, as the original issue wasn&#39;t a problem at all and you, the answerer, deleted the answer of your own accord."}], "owner": {"reputation": 41, "user_id": 5342325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04478096a9a6671896a5aac56d3b788a?s=128&d=identicon&r=PG&f=1", "display_name": "melody123", "link": "https://stackoverflow.com/users/5342325/melody123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 257, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442409704, "creation_date": 1442407275, "question_id": 32608913, "link": "https://stackoverflow.com/questions/32608913/how-to-optimize-a-sum-over-list-comprehension", "title": "How to optimize a sum over list comprehension", "body": "<p>I have to make a large computation (for statistics), but the following function is making haskell say nothing if n is close to 100, but I have to make n = 500. When I remove one of the factors (for example <code>(p**fromIntegral l))</code> things get better. Any idea how to make the sum more efficient? Also, the 'choose' function is from a library that is optimized (hackage said). Thanks a lot</p>\n\n<pre><code>probaMetodo :: Integral b =&gt; b -&gt; b -&gt; Double -&gt; b -&gt; Double\nprobaMetodo i j p n = sum [(p ** fromIntegral l) * (fromIntegral(n `choose` l)) * ((1-p) ** fromIntegral (n-l)) | l &lt;- [i,i+1..j]]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1442380875, "post_id": 32600304, "comment_id": 53053125, "body": "I wrote an entire answer to this, but you deleted the question before I could post it, so now it&#39;s gone. Please think and think again and think yet again before deleting a question. You can always <i>edit</i> your questions."}], "answers": [{"tags": [], "owner": {"reputation": 5642, "user_id": 2137996, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/dYdyn.jpg?s=128&g=1", "display_name": "Alex Reinking", "link": "https://stackoverflow.com/users/2137996/alex-reinking"}, "is_accepted": false, "score": 5, "last_activity_date": 1442380944, "creation_date": 1442380944, "answer_id": 32600348, "question_id": 32600304, "link": "https://stackoverflow.com/questions/32600304/compiler-rejects-type-signature-of-data-constructor/32600348#32600348", "title": "Compiler rejects type signature of data constructor", "body": "<p>There's no need to provide a type signature for <code>Nulltree</code>. It's already clear to the compiler what it is.</p>\n\n<p>If you want to create a particular empty tree, you could go:</p>\n\n<pre><code>emptyTree :: Bintree Int -- for example\nemptyTree = Nulltree\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1442401221, "post_id": 32600373, "comment_id": 53064465, "body": "Indeed, enabling <code>GATDs</code> would be inappropriate for a beginner. There is however the lesser extension <code>GADTSyntax</code> which enables only the new syntax without extending the expressive power of data type declarations (i.e., each constructor must return exactly a <code>Bintree a</code>)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1515010738, "last_edit_date": 1515010738, "creation_date": 1442381082, "answer_id": 32600373, "question_id": 32600304, "link": "https://stackoverflow.com/questions/32600304/compiler-rejects-type-signature-of-data-constructor/32600373#32600373", "title": "Compiler rejects type signature of data constructor", "body": "<p>In standard Haskell, you cannot give type signatures to data constructors. The line</p>\n\n<pre><code>data Bintree a = Nulltree | Node (Bintree a) a (Bintree a)\n</code></pre>\n\n<p>implies that <code>Nulltree :: BinTree a</code>. You don't need to say it yourself, and you can't. Using the <code>GADTSyntax</code> language extension, you could instead write</p>\n\n<pre><code>data Bintree a where\n  Nulltree :: BinTree a\n  Node :: Bintree a -&gt; a -&gt; Bintree a -&gt; Bintree a\n</code></pre>\n\n<p>(Thanks to chi for pointing out that <code>GADTSyntax</code> is sufficient, and the not-so-beginner-friendly <code>GADTs</code> extension is not required.)</p>\n"}], "owner": {"reputation": 43, "user_id": 4668263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea3d75c623a8a78aafd7aff7f36cfa99?s=128&d=identicon&r=PG&f=1", "display_name": "abhinav mehta", "link": "https://stackoverflow.com/users/4668263/abhinav-mehta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 32600373, "answer_count": 2, "score": 2, "last_activity_date": 1515010738, "creation_date": 1442380712, "last_edit_date": 1442383442, "question_id": 32600304, "link": "https://stackoverflow.com/questions/32600304/compiler-rejects-type-signature-of-data-constructor", "title": "Compiler rejects type signature of data constructor", "body": "<p>I am learning haskell. When I compile the code:</p>\n\n<pre><code>data Bintree a = Nulltree | Node (Bintree a) a (Bintree a)\nNulltree :: Bintree a\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>Invalid type signature: Nulltree :: Bintree a Should be of form &lt;variable&gt; :: &lt;type&gt;\n</code></pre>\n\n<p>So how do I prevent this. I tried writing:</p>\n\n<pre><code>data Bintree a = Nulltree | Node (Bintree a) a (Bintree a)\nNulltree :: a -&gt; Bintree a\n</code></pre>\n\n<p>but this gives the same error.</p>\n"}, {"tags": ["haskell", "exception-handling"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442377351, "post_id": 32598807, "comment_id": 53051967, "body": "What are these <code>main</code> and <code>intercept</code> you speak of? What are you actually trying to do?"}, {"owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442389534, "post_id": 32598807, "comment_id": 53057191, "body": "main and intercept are what the linked answer uses in its example"}], "answers": [{"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": true, "score": 1, "last_activity_date": 1442378812, "creation_date": 1442378812, "answer_id": 32599992, "question_id": 32598807, "link": "https://stackoverflow.com/questions/32598807/handling-exceptions-exceptt-in-chain-of-actions/32599992#32599992", "title": "Handling exceptions (ExceptT) in chain of actions", "body": "<p>The problem is that your call to <code>catchE</code> only covered the very last line of <code>dlAsset</code>. It needs to be moved to the left of the do-notation indentation level to cover all of the do notation.</p>\n"}], "owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 32599992, "answer_count": 1, "score": 0, "last_activity_date": 1442391119, "creation_date": 1442370933, "last_edit_date": 1495542572, "question_id": 32598807, "link": "https://stackoverflow.com/questions/32598807/handling-exceptions-exceptt-in-chain-of-actions", "title": "Handling exceptions (ExceptT) in chain of actions", "body": "<p>I am trying to use an exception to skip parts of the code here. Instead of getting caught by <code>catcheE</code> and resuming normal behavior all following actions in the <code>mapM_</code> chain get skipped.</p>\n\n<p>I looked at <a href=\"https://stackoverflow.com/questions/26385809/catch-someexception-with-exceptt\">this question</a> and it appears that <code>catchE</code> ~ <code>main</code> and <code>checkMaybe</code> ~ <code>intercept</code>.\nI also checked the implementation of <code>mapM_</code>to be sure it does what i want it to, but i don't understand how the Left value can escape <code>dlAsset</code> to affect the behavior of <code>mapM_</code>.</p>\n\n<p>I refactored this from a version where i simply used an empty string as an exception marker for the failed lookup. In that version <code>checkMaybe</code> just returned a <code>Right</code> value immediately and it worked (matching on <code>\"\"</code> to 'catch')</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.HashMap.Strict as HM hiding (map) \nimport qualified Data.ByteString.Lazy as BS\nimport qualified Data.ByteString.Char8 as BSC8\nimport qualified JSONParser as P -- my module\n\nretrieveAssets :: (Text -&gt; Text) -&gt; ExceptT Text IO ()\nretrieveAssets withName = withManager $ (lift ((HM.keys . P.assets)\n  &lt;$&gt; P.raw) ) &gt;&gt;= mapM_ f\n  where\n  f = \\x -&gt; dlAsset x \"0.1246\" (withName x)\n\ndlAsset :: Text -&gt; Text -&gt; Text -&gt; ReaderT Manager (ExceptT Text IO) ()\ndlAsset name size dest = do\n  req &lt;- lift $ (P.assetLookup name size &lt;$&gt; P.raw) &gt;&gt;= checkMaybe\n    name &gt;&gt;= parseUrl . unpack -- lookup of a url\n  res &lt;- httpLbs req \n  lift $ (liftIO $ BS.writeFile (unpack dest) $ responseBody res)\n    `catchE` (\\_ -&gt; return ()) -- always a Right value?\n    where \n      checkMaybe name a = case a of\n        Nothing -&gt; ExceptT $ fmap Left $ do\n          BSC8.appendFile \"./resources/images/missingFiles.txt\" $ \n            BSC8.pack $ (unpack name) ++ \"\\n\"\n          putStrLn $ \"lookup of \" ++ (unpack name) ++ \" failed\"\n          return name\n        Just x  -&gt; lift $ pure x\n</code></pre>\n\n<p>(had to reformat to become somewhat readable here)</p>\n\n<p>edit: i'd like to understand what actually happens here, that would probably help me more than knowing which part of the code is wrong.</p>\n"}, {"tags": ["xml", "haskell", "hxt"], "answers": [{"comments": [{"owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1442492933, "post_id": 32629006, "comment_id": 53109676, "body": "It seems that there&#39;s no <code>Functor</code> instance for <code>PU</code>. When you compile this you get: <code>No instance for (Functor PU) arising from a use of \u2018&lt;$\u2019</code>. I don&#39;t know what an <code>fmap</code> implementation for <code>PU</code> would do."}, {"owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "reply_to_user": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1442493678, "post_id": 32629006, "comment_id": 53110129, "body": "Ah yes, because it&#39;s constructing a reversible parser to go from <code>PU String</code> to <code>PU Property</code> requires two functions, one each way. Try <code>xpWrap (const A) (const &quot;a&quot;) $ xpTextAttr &quot;a</code>"}, {"owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1442940626, "post_id": 32629006, "comment_id": 53287483, "body": "Still haven&#39;t cracked this: giving the list argument to <code>xpAlt</code> as <code>[ xpWrap ( const A, const &quot;a&quot; ) $ xpTextAttr &quot;a&quot; , ... ]</code> results in serialising to <code>&lt;thing property=&quot;&quot; &#47;&gt;</code> and an <code>xpCheckEmptyAttributes: unprocessed XML attribute(s) detected</code> error on de-serialising."}, {"owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "reply_to_user": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1443022765, "post_id": 32629006, "comment_id": 53328517, "body": "Ah. That is the right way to use <code>xpWrap</code> now but it was the wrong way to use <code>xpTextAttr</code> and <code>xpAttr</code>. In fact you don&#39;t want to use <code>xpAttr</code> at all here, you just want to use <code>xpTextAttr</code> with first parameter being &quot;property&quot; and second parameter being the pickler for the actual text."}, {"owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "reply_to_user": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "edited": false, "score": 0, "creation_date": 1443043770, "post_id": 32629006, "comment_id": 53340280, "body": "Oh, also, the tags should be 0 and 1, not 1 and 2!"}], "tags": [], "owner": {"reputation": 1617, "user_id": 2239956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cc5132d21c85f66d0d10ab0c8069c59?s=128&d=identicon&r=PG", "display_name": "drquicksilver", "link": "https://stackoverflow.com/users/2239956/drquicksilver"}, "is_accepted": true, "score": 0, "last_activity_date": 1443044121, "last_edit_date": 1443044121, "creation_date": 1442488584, "answer_id": 32629006, "question_id": 32597014, "link": "https://stackoverflow.com/questions/32597014/hxt-xpickle-deserialising-between-attribute-values-and-value-constructors/32629006#32629006", "title": "HXT xpickle (de)serialising between attribute values and value constructors", "body": "<p>This isn't using <code>xpTextAttr</code> correctly. First of all its first parameter should be the attribute name <code>\"property\"</code> and secondly, it returns the text it matches.</p>\n\n<p>You want to return the constructor <code>A</code> or <code>B</code> respectively.</p>\n\n<p>You need to use <code>xpWrap</code> to specify the mapping (both ways) between the text contents of the property (<code>\"a\"</code> or <code>\"b\"</code>) and those constructors. And the tags are 0-based I believe, so 0 and 1.</p>\n\n<pre><code>where\n  tag A = 0\n  tag B = 1\n  ps = [ xpWrap (const A,const \"a\") $ xpTextAttr \"property\"\n       , xpWrap (const B,const \"b\") $ xpTextAttr \"property\"\n       ]\n</code></pre>\n\n<p>Then the call to <code>xpAttr</code> is wrong. Honestly I'm not sure what <code>xpAttr</code> is for, something to do with qualified names. In fact sufficient code for <code>xpProperty</code> is</p>\n\n<pre><code>xpProperty :: PU (Maybe Property)\nxpProperty = xpOption $ xpPropertyValue\n</code></pre>\n"}], "owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 32629006, "answer_count": 1, "score": 1, "last_activity_date": 1443044121, "creation_date": 1442357889, "question_id": 32597014, "link": "https://stackoverflow.com/questions/32597014/hxt-xpickle-deserialising-between-attribute-values-and-value-constructors", "title": "HXT xpickle (de)serialising between attribute values and value constructors", "body": "<p>I'm trying to write an xpickle which serialises the value constructors of some type into XML attribute values of a specific attribute and de-serialises the XML attribute values back into value constructors of the type.</p>\n\n<p>I have the follow data:</p>\n\n<pre><code>module Main where\n\nimport Text.XML.HXT.Core\n\nnewtype Things = Things [Thing]\ndata Thing = Thing (Maybe Property)\ndata Property = A | B\n\nsomeThings :: Things\nsomeThings = Things [ Thing (Just A)\n                    , Thing Nothing\n                    , Thing (Just B)\n                    ]\n</code></pre>\n\n<p>And I'd like to serialise this into something like:</p>\n\n<pre><code>&lt;things&gt;\n  &lt;thing property=\"a\" /&gt;\n  &lt;thing /&gt;\n  &lt;thing property=\"b\" /&gt;\n&lt;/things&gt;\n</code></pre>\n\n<p>Here's the approach I'm taking:</p>\n\n<pre><code>instance XmlPickler Things where\n  xpickle = xpWrap ( \\things -&gt; Things things , \\(Things things) -&gt; things ) $\n            xpElem \"things\" $\n            xpThings\n\nxpThings :: PU [Thing]\nxpThings = xpList xpickle\n\ninstance XmlPickler Thing where\n  xpickle = xpElem \"thing\" $\n            xpWrap ( \\p -&gt; Thing p , \\(Thing p) -&gt; p ) $\n            xpProperty\n\nxpProperty :: PU (Maybe Property)\nxpProperty = xpOption $ xpAttr \"property\" xpPropertyValue\n\nxpPropertyValue :: PU Property\nxpPropertyValue = xpAlt tag ps\n  where\n    tag A = 1\n    tag B = 2\n    ps = [ xpTextAttr \"a\"\n         , xpTextAttr \"b\"\n         ]\n\nmain :: IO ()\nmain = do\n  putStrLn $ showPickled [ withIndent yes ] someThings\n  return ()\n</code></pre>\n\n<p>Here, <code>xpProperty</code> creates or reads an <code>@property</code> attribute and then uses <code>xpPropertyValue</code> to work out the value. <code>xpPropertyValue</code> determines the value depending on the value constructor of the value: <code>A</code> gives <code>\"a\"</code> and <code>B</code> gives <code>\"b\"</code> and the values are constructed using the <code>xpTextAttr</code> function. The problem here is that <code>xpTextAttr</code> is <code>String -&gt; PU String</code> and I'm trying to use it where I need a <code>PU Property</code>. But I can't work out an alternative way of generating a <code>PU Property</code> value that's dependent on the value constructor of a <code>Property</code> value.</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442355877, "post_id": 32596665, "comment_id": 53046622, "body": "Indeed, adding <code>( ::Int-&gt;Int-&gt;Int)</code> to the <code>(+)</code> of the original code makes the rest compile just fine."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1442371803, "post_id": 32596665, "comment_id": 53050603, "body": "It appears I oversimplified my example -- my apologies. I updated my post with an example where adding the type <code>:: b -&gt; b -&gt; b</code> to <code>(+)</code> (along with <code>-XScopedTypeVars</code> and an explicit forall) doesn&#39;t fix the problem."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1442408836, "post_id": 32596665, "comment_id": 53069888, "body": "Thanks for updating your answer, and for your clear explanation!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1442411376, "last_edit_date": 1442411376, "creation_date": 1442355715, "answer_id": 32596665, "question_id": 32596138, "link": "https://stackoverflow.com/questions/32596138/using-nominal-roles-for-type-inference/32596665#32596665", "title": "Using Nominal Roles for Type Inference", "body": "<p>Let's start by looking at a few types:</p>\n\n<pre><code>coerce (+) :: (Num n, Coercible (n -&gt; n -&gt; n) b) =&gt; b\nmyf :: F c d\n</code></pre>\n\n<p>The first problem is that GHC has no hope of pinning down <code>n</code> so it can choose an implementation of <code>(+)</code>.</p>\n\n<p>Let's see what happens if we use scoped type variables to attempt a simple solution:</p>\n\n<pre><code>myzip :: forall a b . Num b =&gt; F a b -&gt; F a b\nmyzip = coerce ((+) :: b -&gt; b -&gt; b) myf\n</code></pre>\n\n<p>This is not accepted. Why? Because the type of <code>myf</code> is ambiguous! We can see this more clearly if we expand out <code>myzip</code> with another argument:</p>\n\n<pre><code>myzip x = coerce ((+) :: b -&gt; b -&gt; b) myf x\n</code></pre>\n\n<p>From the way <code>Coercible</code> works with type constructors (<code>-&gt;</code>, in this case), we can line everything up and conclude that the type of <code>myf</code> must be coercible with <code>b</code>, where <code>x :: F a b</code>. But the type of <code>myf</code> in this context is ambiguous. GHC therefore has no way to select the appropriate <code>Coercible</code> instance between <code>b</code> and a type for <code>myf</code>. Because <code>coerce</code> is really the identity function under the hood, it doesn't <em>matter</em> which one is chosen, but GHC simply won't choose an instance based on an ambiguous type variable. To make this work, you need something like</p>\n\n<pre><code>myzip :: forall a b . Num b =&gt; F a b -&gt; F a b\nmyzip = (coerce ((+) :: b -&gt; b -&gt; b)) (myf :: F a b)\n</code></pre>\n\n<h3>Type roles</h3>\n\n<p>Type roles cannot (at least at present) guide instance resolution in any way. All they can do is determine what <code>Coercible</code> instances are <em>generated</em>. Given</p>\n\n<pre><code>class c =&gt; X d\n</code></pre>\n\n<p>GHC will conclude that <code>X d</code> entails <code>c</code>. But given</p>\n\n<pre><code>instance c =&gt; X d\n</code></pre>\n\n<p>GHC will <em>not</em> conclude that <code>X d</code> entails <code>c</code>. I'm not sure of the details of why, but that has always been the case.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 32596665, "answer_count": 1, "score": 5, "last_activity_date": 1442411376, "creation_date": 1442353192, "last_edit_date": 1442372348, "question_id": 32596138, "link": "https://stackoverflow.com/questions/32596138/using-nominal-roles-for-type-inference", "title": "Using Nominal Roles for Type Inference", "body": "<p>I have a <code>newtype</code> with a phantom type, but I'm having trouble making easy use of it.</p>\n\n<p>Consider the following example:</p>\n\n<pre><code>import Data.Coerce\n\nnewtype F a b = F b\n\nmyzip :: (Num b) =&gt; F a b -&gt; F a b\nmyzip = (coerce (+)) myf\n\nmyf :: F a b\nmyf = undefined\n</code></pre>\n\n<p>GHC complains that it <code>Couldn't match representation of type \u2018a0\u2019 with that of \u2018Int\u2019</code>. Basically, the type of <code>coerce (+)</code> is <code>F a0 -&gt; F a -&gt; F a</code>, rather than the type I want, which is <code>F a -&gt; F a -&gt; F a</code>.</p>\n\n<p>Given <code>a</code>'s current role of <code>phantom</code>, this is reasonable. I'm wondering if there's a simple way to get type inference (I don't want to have to write out signatures, that's why I'm using <code>coerce</code> in the first place!) by some other method.\nIn particular, I expected that if I restricted the role of the parameter <code>a</code> to nominal, then GHC would be able to tell that the only possible choice for the signature was the one I wanted. No such luck: GHC gives the same error.</p>\n\n<p>In the event it matters, in my real code the role of <code>a</code> must be at least representational, and <code>b</code> must be nominal.</p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442351237, "post_id": 32595609, "comment_id": 53044839, "body": "<i>SourceGraph</i> is not a library; it is an application. Cf. <a href=\"https://hackage.haskell.org/package/SourceGraph\" rel=\"nofollow noreferrer\">its documentation at Hackage</a>. When you do <code>cabal instal foo</code>, <code>foo</code> is not a module, but a package. Library packages, in turn, <i>contain</i> modules which you can import."}], "answers": [{"comments": [{"owner": {"reputation": 658, "user_id": 3810038, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gGQN3.png?s=128&g=1", "display_name": "John Red", "link": "https://stackoverflow.com/users/3810038/john-red"}, "edited": false, "score": 0, "creation_date": 1442354248, "post_id": 32595694, "comment_id": 53046083, "body": "Oh God. I cannot believe I was so stupid. I tried it and fixed it. I was able to run run it, but alas! There&#39;s a problem in the package itself. Sad. Really sad.   But thank you anyways."}, {"owner": {"reputation": 658, "user_id": 3810038, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gGQN3.png?s=128&g=1", "display_name": "John Red", "link": "https://stackoverflow.com/users/3810038/john-red"}, "edited": false, "score": 0, "creation_date": 1442355899, "post_id": 32595694, "comment_id": 53046635, "body": "Edit: I got it to work. The problem was that I had to install graphviz for windows using the installer and update the PATH variable to add the folder that contained dot.exe."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 3, "last_activity_date": 1442351408, "creation_date": 1442351408, "answer_id": 32595694, "question_id": 32595609, "link": "https://stackoverflow.com/questions/32595609/why-cant-i-import-this-haskell-module-package/32595694#32595694", "title": "Why can&#39;t I import this Haskell module/package?", "body": "<p><code>SourceGraph</code> is not a library, it is a program to be run on the command line.</p>\n\n<p>See it's <a href=\"http://hackage.haskell.org/package/SourceGraph\" rel=\"nofollow\">hackage page</a></p>\n\n<p>There it says (with added <code>$</code>s for the bash prompt):</p>\n\n<blockquote>\n  <p>To use SourceGraph, call it as either:</p>\n\n<pre><code>$ SourceGraph path/to/Foo.cabal\n</code></pre>\n  \n  <p>Or, if your project doesn't use Cabal, then there is limited support for > using an overall module from your program/library:</p>\n\n<pre><code>$ SourceGraph path/to/Foo.hs\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 658, "user_id": 3810038, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gGQN3.png?s=128&g=1", "display_name": "John Red", "link": "https://stackoverflow.com/users/3810038/john-red"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1007, "favorite_count": 0, "accepted_answer_id": 32595694, "answer_count": 1, "score": 2, "last_activity_date": 1442351408, "creation_date": 1442351095, "question_id": 32595609, "link": "https://stackoverflow.com/questions/32595609/why-cant-i-import-this-haskell-module-package", "title": "Why can&#39;t I import this Haskell module/package?", "body": "<p>I installed the <code>SourceGraph</code> package using cabal:<br>\n<code>cabal install SourceGraph</code><br>\nIt was installed perfectly without any errors.<br>\nNow, I've created a file called <code>Test.hs</code> to test if I am able to import this package and use it. These are the contents of <code>Test.hs</code>:  </p>\n\n<pre><code>    module Test where\n\n    import SourceGraph\n\n    main = putStrLn \"Hello World!\"  \n</code></pre>\n\n<p>When I do <code>ghc Test</code> I get the following error:<br>\n<code>Could not find the module 'SourceGraph'</code>  </p>\n\n<p>When I do <code>ghc-pkg list</code> I cannot find <code>SourceGraph</code> in the list, though all dependencies installed along with it are visible.<br>\nI checked in <code>C:\\Users\\MyName\\AppData\\Roaming\\cabal\\packages\\hackage.haskell.org</code> and I can see the <code>SourceGraph</code> folder there.<br>\nBut there is no <code>.conf</code> file for <code>SourceGraph</code> in <code>C:\\Users\\MyName\\AppData\\Roaming\\ghc\\x86_64-mingw32-7.10.2\\package.conf.d</code>.<br>\nAlso, all the <code>.log</code> files in <code>C:\\Users\\MyName\\AppData\\Roaming\\cabal\\logs</code> have a line <code>In-place registering packagename-version...</code> at the end, but <code>SourceGraph-0.7.0.7,log</code> doesn't.  </p>\n\n<p>Help please?  </p>\n\n<p>[System Specifications: GHCi version 7.10.2, Cabal Version: 1.22.4.0, OS: Windows 8 Pro, Processor: Intel Core i5 (64 bit)]</p>\n"}, {"tags": ["function", "haskell", "if-statement", "types"], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442351225, "post_id": 32594907, "comment_id": 53044831, "body": "It is worth mentioning the languages that <i>do</i> support dependent types, such as <a href=\"http://www.idris-lang.org/\" rel=\"nofollow noreferrer\">idris</a>, which is very similar to Haskell."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 1, "last_activity_date": 1442348367, "creation_date": 1442348367, "answer_id": 32594907, "question_id": 32594854, "link": "https://stackoverflow.com/questions/32594854/making-the-type-of-a-function-depend-on-input/32594907#32594907", "title": "Making the type of a function depend on input", "body": "<p>Making the type of a function depend on its values is exactly what <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow\">dependent types</a> are for. Unfortunately, Haskell does not have dependent types so this cannot be done.</p>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1442349412, "post_id": 32595010, "comment_id": 53043954, "body": "Yes, what you describe is how Integer is implemented already. Any value within the range of <code>Int</code> is stored in the same way as <code>Int</code>, values outside that range have their data stored in a <code>ByteArray</code> field. Adding another layer of the same kind on top probably won&#39;t help :)"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 5, "last_activity_date": 1442348788, "creation_date": 1442348788, "answer_id": 32595010, "question_id": 32594854, "link": "https://stackoverflow.com/questions/32594854/making-the-type-of-a-function-depend-on-input/32595010#32595010", "title": "Making the type of a function depend on input", "body": "<p>It can't be done. There are things you can do however:</p>\n\n<ol>\n<li><p>Make the type more generic: <code>factorial :: Num a =&gt; a -&gt; a</code>;\nThis allows the  user of your function to decide what runtime penalties he wants to occur vs. what range of numbers is permissible.</p></li>\n<li><p>Use a sum type like <code>data PossiblyBig = Small Int | Big Integer</code>, and then have an implementation <code>instance Num PossiblyBig</code> that encodes things that fit into <code>Int</code> as <code>Small</code>, and things that don't fit as <code>Big</code>; AFAIK <code>Integer</code> already works like that (look up the GMP implementation if you want to know for sure), so this is more of a general example than advice as to what you should do in this particular situation.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 9, "creation_date": 1442351727, "post_id": 32595015, "comment_id": 53045054, "body": "In GHC we have that <a href=\"http://hackage.haskell.org/package/integer-gmp-1.0.0.0/docs/GHC-Integer-GMP-Internals.html#t:Integer\" rel=\"nofollow noreferrer\"><code>Integer</code></a> is exactly a sum type, with small values using a more efficient representation. Hence, adding another sum on top would likely make things worse."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1442412320, "post_id": 32595015, "comment_id": 53072571, "body": "I&#39;d rather write <code>selectiveFactorial :: Int -&gt; Integer; selectiveFactorial i | i &lt; 20    = fromIntegral (factorial i) | otherwise = factorial (fromIntegral i)</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 11, "last_activity_date": 1442348798, "creation_date": 1442348798, "answer_id": 32595015, "question_id": 32594854, "link": "https://stackoverflow.com/questions/32594854/making-the-type-of-a-function-depend-on-input/32595015#32595015", "title": "Making the type of a function depend on input", "body": "<p>You can make a hackish solution without dependent types by using either a sum type and growing when needed or delaying the cast to <code>Integer</code> till the end in some cases.  I don't expect either solution would perform better than using <code>Integer</code> - do not fear the Integer, gmp and mpir are quite good.</p>\n\n<p>The casting solution is something like:</p>\n\n<pre><code>selectiveFactorial :: Integer -&gt; Integer\nselectiveFactorial i\n    | i &lt; 20 = fromIntegral $ factorial (fromIntegral i :: Int)\n    | otherwise = factorial i\n\nfactorial :: Integral a =&gt; a -&gt; a\nfactorial 0 = 1\nfactorial n = n * factorial (n - 1)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1442400149, "post_id": 32595411, "comment_id": 53063807, "body": "The <a href=\"http://lpaste.net/141109\" rel=\"nofollow noreferrer\">same</a> in Haskell with singletons (works for me only if I replace <code>:&lt;=</code> and <code>%:&lt;=</code> with <code>:==</code> and <code>%:==</code>)."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1442406173, "post_id": 32595411, "comment_id": 53067855, "body": "You probably can return <code>Either Int Integer</code>, but I guess <code>Integer</code> is already <code>Either Int BigInt</code> ..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1443729992, "last_edit_date": 1495540705, "creation_date": 1442350371, "answer_id": 32595411, "question_id": 32594854, "link": "https://stackoverflow.com/questions/32594854/making-the-type-of-a-function-depend-on-input/32595411#32595411", "title": "Making the type of a function depend on input", "body": "<p>As <a href=\"https://stackoverflow.com/a/32594907/1477667\">Rein Henrichs said</a> you could do these things in a language with dependent types, which Haskell does not (yet, quite) have. In Idris, say, it would look something like</p>\n\n<pre><code>factorial : (n : Int) -&gt; if n &lt;= 20 then Int else Integer\nfactorial n with (n &lt;= 20)\n  factorial n | True = thisfactorial n\n  factorial n | False = thatfactorial n\n</code></pre>\n\n<p>But how will you <em>use</em> this result? Well, you'll need to do the comparison to figure out what type to expect, and when all is said and done, I don't see how you've won anything. For completeness, the use site could look something like this:</p>\n\n<pre><code>use : Int -&gt; Integer\nuse n with (factorial n)\n  use n | fn with (n &lt;= 20)\n    use n | fn | False = fn\n    use n | fn | True = cast fn\n</code></pre>\n\n<p>Note that the order of the <code>with</code> clauses is significant! The <code>fn</code> binding gets type <code>if n &lt;= 20 then Int else Integer</code>; for reasons I don't entirely understand, the <code>n &lt;= 20</code> test must be to the right of that in order for the pattern match to affect its type.</p>\n"}], "owner": {"reputation": 755, "user_id": 5323311, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh5.googleusercontent.com/-v8SDvlJNQBU/AAAAAAAAAAI/AAAAAAAAAD4/IT0tDo9PwT4/photo.jpg?sz=128", "display_name": "Tshimanga", "link": "https://stackoverflow.com/users/5323311/tshimanga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 1, "accepted_answer_id": 32595015, "answer_count": 4, "score": 6, "last_activity_date": 1443729992, "creation_date": 1442348185, "last_edit_date": 1442383584, "question_id": 32594854, "link": "https://stackoverflow.com/questions/32594854/making-the-type-of-a-function-depend-on-input", "title": "Making the type of a function depend on input", "body": "<p>So I noticed that after n=20 the factorial function given in LearnYouAHaskell (below) craps out because of the finite work range of the Int type.</p>\n\n<pre><code>factorial :: Int -&gt; Int\nfactorial 0 = 1\nfactorial n * factorial (n-1)\n</code></pre>\n\n<p>Using <code>factorial :: Integer -&gt; Integer</code> fixes the issue nicely, but it brought to mind the question. Supposedly Integer is slightly slower than Int so ideally (and I know I'm pinching pennies here) I'd want my factorial function to only resort to Integer when the input is greater than 20 and retain the <code>Int-&gt;Int</code> type for the smaller numbers. Seems like there should be an elegant solution for this using if-then-else or guards, but keep running into syntactic pepper (error messages)</p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 6701, "user_id": 3591273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e9f02f036080c8be4e2abfcf753be75?s=128&d=identicon&r=PG", "display_name": "Nikos M.", "link": "https://stackoverflow.com/users/3591273/nikos-m"}, "edited": false, "score": 0, "creation_date": 1442346491, "post_id": 32594379, "comment_id": 53042456, "body": "use transpose maybe?"}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "reply_to_user": {"reputation": 6701, "user_id": 3591273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e9f02f036080c8be4e2abfcf753be75?s=128&d=identicon&r=PG", "display_name": "Nikos M.", "link": "https://stackoverflow.com/users/3591273/nikos-m"}, "edited": false, "score": 0, "creation_date": 1442346994, "post_id": 32594379, "comment_id": 53042696, "body": "@Nikos. You mean transpose on the last (minus x mu)? I did that with same outcome."}, {"owner": {"reputation": 6701, "user_id": 3591273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e9f02f036080c8be4e2abfcf753be75?s=128&d=identicon&r=PG", "display_name": "Nikos M.", "link": "https://stackoverflow.com/users/3591273/nikos-m"}, "edited": false, "score": 0, "creation_date": 1442348422, "post_id": 32594379, "comment_id": 53043430, "body": "using transposition and where exactly either on first or last vector is a matter of convention, try both, in any case this is the issue as far as i can tell"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442348461, "post_id": 32594379, "comment_id": 53043458, "body": "I&#39;m a bit lost myself. Among other things, it looks like the error message doesn&#39;t match either the requirements of matrix multiplication or the code that implements the matrix multiplication."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442349154, "post_id": 32594379, "comment_id": 53043830, "body": "What version of <code>bed-and-breakfast</code> are you using?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442349329, "post_id": 32594379, "comment_id": 53043920, "body": "And what version of ghc are you using?"}], "answers": [{"comments": [{"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442349839, "post_id": 32595173, "comment_id": 53044166, "body": "please share. I think it is strange that a package should create an out of bounds error if the expression is mathematically legal. I got the same when trying to multiply parts of the expression separately."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442351442, "post_id": 32595173, "comment_id": 53044928, "body": "thank you. I think I might try REPA in the morning (hMatrix doesn&#39;t work on my computer) as well, but I think that its nice for others to see your solution too."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1442351228, "last_edit_date": 1442351228, "creation_date": 1442349418, "answer_id": 32595173, "question_id": 32594379, "link": "https://stackoverflow.com/questions/32594379/how-to-correctly-perform-this-sequence-of-matrices-multiplications/32595173#32595173", "title": "how to correctly perform this sequence of matrices multiplications?", "body": "<p>Your code will work unmodified if you use bed-and-breakfast-0.4.3.</p>\n\n<p>When I used version 0.1.2 I get index out of bounds errors.</p>\n\n<p>However, to get 0.4.3 to compile using GHC 7.10.2 requires some hacking of the source. I can provide the details if you are interested.</p>\n\n<h1>build instructions for 0.5</h1>\n\n<p>Start with version \"0.5\" from the github repo:</p>\n\n<pre><code>https://github.com/scravy/bed-and-breakfast\n</code></pre>\n\n<p>In <code>src/Numeric/Matrix.hs</code> add <code>foldMap</code> to the list of imports to hide from the Prelude:</p>\n\n<pre><code>-import Prelude hiding (any, all, read, map)\n+import Prelude hiding (any, all, read, map, foldMap)\n</code></pre>\n\n<p>Install as usual, e.g. with stack:</p>\n\n<pre><code>stack init &amp;&amp; stack install\n</code></pre>\n\n<p>or with cabal:</p>\n\n<pre><code>cabal install\n</code></pre>\n"}], "owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 32595173, "answer_count": 1, "score": 1, "last_activity_date": 1442351228, "creation_date": 1442346326, "question_id": 32594379, "link": "https://stackoverflow.com/questions/32594379/how-to-correctly-perform-this-sequence-of-matrices-multiplications", "title": "how to correctly perform this sequence of matrices multiplications?", "body": "<p>This is probably very easy but I can not seem to figure it out. I have attempted to implement a Mahalanobis distance calculation below, but are performing illegal matrix operations (<code>numRows a' and</code>numCols b' don't match). The calculation should be [1.0, 2.2] * [[0.95,-0.15] [-0.15 0.55]] * [[1.0],[2.2]], and give 2.952 as an answer. Does anybody see what I am going wrong?</p>\n\n<pre><code>import Numeric.Matrix as M\nimport Data.Maybe \n\ncreate :: [[Float]] -&gt; Matrix Float \n\ncreate m = M.fromList m\n\nmahalanobisDistance mu x = (transpose (minus x mu)) \n`times` (fromJust (M.inv coVarMatrix)) \n`times` (minus x mu) \nwhere \n    coVarMatrix = create [[1.1, 0.3], [0.3, 1.9]]\n\ndistanceW1 = mahalanobisDistance (create [[1.0], [1.0]])\n\ndistanceW2 = mahalanobisDistance (create [[1.5], [1.5]])\n\nmain = do \n    let x = create [[1.0], [2.2]]\n    print $ distanceW1\u00a0x\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching", "lisp", "wolfram-mathematica"], "comments": [{"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 1, "creation_date": 1442346256, "post_id": 32594260, "comment_id": 53042320, "body": "This <i>is</i> stackoverflow."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 0, "creation_date": 1442346426, "post_id": 32594260, "comment_id": 53042425, "body": "@ScottHunter Fixed here is the link to Mathematica.se post <a href=\"http://mathematica.stackexchange.com/questions/94720/duplicate-mathematica-functionality-in-mathematica-clone-or-lisp\" title=\"duplicate mathematica functionality in mathematica clone or lisp\">mathematica.stackexchange.com/questions/94720/&hellip;</a>"}, {"owner": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442362735, "post_id": 32594260, "comment_id": 53048492, "body": "Mind telling us what that Mathematica code <i>does</i>?  And what you&#39;ve tried that didn&#39;t work?"}, {"owner": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442362862, "post_id": 32594260, "comment_id": 53048538, "body": "It sounds like maybe you want <a href=\"http://www.lispworks.com/documentation/HyperSpec/Body/f_substc.htm\" rel=\"nofollow noreferrer\"><b>subst-if</b></a>."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442364868, "post_id": 32594260, "comment_id": 53049012, "body": "@JoshuaTaylor It replaces all instances of <code>f[{x_, &quot;[&quot;, y__, &quot;]&quot;}]</code> where x_ represents a single variable and y__ represents one or more variables."}, {"owner": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442365008, "post_id": 32594260, "comment_id": 53049053, "body": "@William OK, but <code>f[{x_, &quot;[&quot;, y__, &quot;]&quot;}]</code> isn&#39;t a Lisp object.  What would the lisp counterpart be?  Something like &quot;every list of the form <code>(f x (y...))</code> is replaced by <code>(x y...)</code>?"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442365151, "post_id": 32594260, "comment_id": 53049092, "body": "@JoshuaTaylor I think <code>(f (x_ &quot;[&quot; y__ &quot;]&quot;))</code> is the closest you can get without knowing the proper syntax for doing multiple or single replacements."}, {"owner": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442365178, "post_id": 32594260, "comment_id": 53049102, "body": "so actual &quot;[&quot; and &quot;]&quot; strings in there?"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442365204, "post_id": 32594260, "comment_id": 53049111, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/89751/discussion-between-william-and-joshua-taylor\">continue this discussion in chat</a>."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442366402, "post_id": 32594260, "comment_id": 53049387, "body": "@JoshuaTaylor Yes.  Give me a couple minutes and I&#39;ll post a self contained example."}, {"owner": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442405647, "post_id": 32594260, "comment_id": 53067427, "body": "<b>and get a return value of <code>((x y), (f (x y y2)))</code>.</b>   What does the comma represent in that return value?"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 80605, "user_id": 1281433, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/O8XCE.png?s=128&g=1", "display_name": "Joshua Taylor", "link": "https://stackoverflow.com/users/1281433/joshua-taylor"}, "edited": false, "score": 0, "creation_date": 1442419188, "post_id": 32594260, "comment_id": 53077534, "body": "@JoshuaTaylor ignore the comma"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 3169, "user_id": 2797269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e40c8c15c4e5a25afb96db886fa916d2?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/2797269/bill"}, "edited": false, "score": 0, "creation_date": 1442515977, "post_id": 32594260, "comment_id": 53124347, "body": "@Bill Sed just includes regex parsing(from my knowledge).  If anything does this it will probably a lisp or maybe some variant of Haskell or something."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "reply_to_user": {"reputation": 3169, "user_id": 2797269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e40c8c15c4e5a25afb96db886fa916d2?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/2797269/bill"}, "edited": false, "score": 0, "creation_date": 1442532828, "post_id": 32594260, "comment_id": 53131666, "body": "@Bill <a href=\"http://hyperpolyglot.org/lisp#lisp-macros\" rel=\"nofollow noreferrer\">hyperpolyglot.org/lisp#lisp-macros</a>  It doesn&#39;t look that is natively supported."}], "answers": [{"comments": [{"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1442590864, "post_id": 32646654, "comment_id": 53158474, "body": "Thank you for the answer but I&#39;m looking for pattern matching not REGEX."}, {"owner": {"reputation": 8904, "user_id": 977052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc6943c19244ba8c9644629ad9b2b525?s=128&d=identicon&r=PG", "display_name": "Vsevolod Dyomkin", "link": "https://stackoverflow.com/users/977052/vsevolod-dyomkin"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 1, "creation_date": 1442809699, "post_id": 32646654, "comment_id": 53219012, "body": "@William regex is pattern matching on strings. :)"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443234079, "post_id": 32646654, "comment_id": 53424546, "body": "You really shouldn&#39;t parse a gramar with REGEX <a href=\"http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags\" title=\"regex match open tags except xhtml self contained tags\">stackoverflow.com/questions/1732348/&hellip;</a>"}, {"owner": {"reputation": 8904, "user_id": 977052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc6943c19244ba8c9644629ad9b2b525?s=128&d=identicon&r=PG", "display_name": "Vsevolod Dyomkin", "link": "https://stackoverflow.com/users/977052/vsevolod-dyomkin"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443374273, "post_id": 32646654, "comment_id": 53457897, "body": "is there a grammar behind this? where&#39;s its spec?"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443378594, "post_id": 32646654, "comment_id": 53459307, "body": "The wolfram language spec(at least the basics of the grammar) I believe are described <a href=\"http://library.wolfram.com/infocenter/MathSource/5216/Wolfram%20Programming%20Language%20Fundamentals.pdf\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 8904, "user_id": 977052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc6943c19244ba8c9644629ad9b2b525?s=128&d=identicon&r=PG", "display_name": "Vsevolod Dyomkin", "link": "https://stackoverflow.com/users/977052/vsevolod-dyomkin"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443452297, "post_id": 32646654, "comment_id": 53487643, "body": "I don&#39;t see a description of the <code>Replace</code> function there, however"}], "tags": [], "owner": {"reputation": 8904, "user_id": 977052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc6943c19244ba8c9644629ad9b2b525?s=128&d=identicon&r=PG", "display_name": "Vsevolod Dyomkin", "link": "https://stackoverflow.com/users/977052/vsevolod-dyomkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1442571363, "last_edit_date": 1442571363, "creation_date": 1442562692, "answer_id": 32646654, "question_id": 32594260, "link": "https://stackoverflow.com/questions/32594260/a-replace-function-in-lisp-that-duplicates-mathematica-functionality/32646654#32646654", "title": "A Replace Function in Lisp That Duplicates Mathematica Functionality", "body": "<p>Oh boy, how Mathematica manages to obfuscate everything by applying its renown NIH approach.</p>\n\n<p>Basically, you're looking for a function to perform string replacement according to some pattern. In most languages, this is accomplished with regular expressions.</p>\n\n<p>For instance, in Common Lisp using the <a href=\"http://weitz.de/cl-ppcre/\" rel=\"nofollow\">cl-ppcre</a> library it will look something like this:</p>\n\n<pre><code>(cl-ppcre:regex-replace-all\n ;; regular expression you match against with groups\n \"f\\\\[{(x[^ ]*), \\\"\\\\[\\\", ((y[^ ]* ?)+), \\\"\\\\]\\\"}\\\\]\"\n ;; your string\n \"{f[{x, \\\"[\\\", y, \\\"]\\\"}], f@f[{x, \\\"[\\\", y, y2, \\\"]\\\"}]}\"\n ;; substitution expression using groups 1 &amp; 2 \n \"\\\\1[\\\\2]\")\n</code></pre>\n\n<p>Surely, you can write a specialized 20-line function for this problem of matching and substituting subtrees using <code>subst</code> and recursion, but if all that you want is cases similar to the presented one you can get away with a simple regex-based approach.</p>\n"}, {"comments": [{"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1442592045, "post_id": 32654459, "comment_id": 53159245, "body": "+1 but it appears at first glance that the function only works with replacements list at depth 1.  In addition I was hopeful to have something over the form <code>(replace list search rule)</code> similar to M."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1442828593, "post_id": 32654459, "comment_id": 53227336, "body": "@William Surely it should not be too difficult to modify the implementation to suit your need, but the at the moment I don&#39;t have much time and I am not sure to know exactly what you need. I never used Mathematica, and the reference I get when looking for Replace is this one: <a href=\"https://reference.wolfram.com/language/ref/Replace.html\" rel=\"nofollow noreferrer\">reference.wolfram.com/language/ref/Replace.html</a>. I would gladly be shown another reference if you have one. It says that  &quot;[Replace] does not map down to subparts&quot;, though there is an  optional <i>levelspec</i> argument. Also, I don&#39;t see anything similar to <code>(replace list search rule)</code>."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1442872389, "post_id": 32654459, "comment_id": 53253776, "body": "Technically it is <code>Replace[expr,rules,levelspec]</code> but because rules are two parts in would translate into something like <code>Replace[expr,rule1,rule2,levelspec]</code> so it would be <code>(replace expr rule1 rule2 levelspec)</code>.  <code>levelspec</code> because I believe your example only works for 1 level spec."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1442915457, "post_id": 32654459, "comment_id": 53269788, "body": "@William I made some changes. I hope this is sufficient for your need."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443111070, "post_id": 32654459, "comment_id": 53371287, "body": "I&#39;m going to let it automatically award you half the bounty because I appreciate the help but as it stands it doesn&#39;t work correctly all the time.  For example try running the following <code>(match-replace &#39;(a b                      (f (x &quot;[&quot; 1 2 3 &quot;]&quot;))                     (f (x &quot;[&quot; 1 2 3 &quot;]&quot;))                 c d)                #&#39;match-ugly-funcall                :infinity)</code> it only replaces the first match and not both.  I&#39;m still amazed lisp doesn&#39;t have such functionality more or less built in to the program.  <code>match-replace</code> looks quiet complex."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443115374, "post_id": 32654459, "comment_id": 53373936, "body": "@William Oh... I thought Replace should quit as soon as one rule matched (vs. ReplaceAll; note the secondary return value which tells you if a match was found), so I tried very hard to stop as soon as possible (I don&#39;t have Mathematica to test things). Otherwise it would be simpler (mapcar). Lisp has subst-if, subst, which make sense for Lisp, but Mathematica is designed for other needs and you won&#39;t find exactly the same features without having to reimplement them. In particular, dealing with levelspec was verbose, but not difficult."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443115706, "post_id": 32654459, "comment_id": 53374097, "body": "You can install <a href=\"https://github.com/mathics/Mathics/wiki/Installing\" rel=\"nofollow noreferrer\">mathics</a> if you you don&#39;t have Mathematica it supports most of the basic commands.  I&#39;ll go ahead and give you the bounty if you don&#39;t mind fixing <code>match-replace</code> to replace all values."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443119346, "post_id": 32654459, "comment_id": 53375960, "body": "@William Thanks for the link. I modified the answer."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 1, "creation_date": 1443134959, "post_id": 32654459, "comment_id": 53383345, "body": "It appears to work thanks!  Is there a way to use a lambda instead of creating another function?"}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 1, "creation_date": 1443136491, "post_id": 32654459, "comment_id": 53383837, "body": "I have another question what would happen if you had something like <code>f[a_,b_,c_,x_,y__,z___]</code> would that be to complex for your example?"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1443165107, "post_id": 32654459, "comment_id": 53391956, "body": "@William Thanks. The case for rules as functions is to avoid limiting ourselves with what rules can match: you can rely on closures and generic functions too, if needed. Regarding your example, the one thing that is somewhat tricky is <code>y__</code> followed by <code>z__</code>, since there could be multiple ways to partition a list and bind the variables to different sublists. This can be done, but details matter. Depending on your needs, maybe Prolog is a better option. If you could narrow the scope of your question and tell us why you need this, you would certainly have more useful answers."}, {"owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1444367220, "post_id": 32654459, "comment_id": 53882675, "body": "I&#39;m trying to understand your code and I&#39;m getting <code>undefined-function: LAST-ELT</code>"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "edited": false, "score": 0, "creation_date": 1444368150, "post_id": 32654459, "comment_id": 53882974, "body": "@Willam You can replace <code>(last-elt args)</code> with <code>(first(last args))</code> because <code>last</code> returns the last cons-cell. <code>last-elt</code> is part of the alexandria library."}], "tags": [], "owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "is_accepted": true, "score": 4, "last_activity_date": 1444370380, "last_edit_date": 1444370380, "creation_date": 1442586331, "answer_id": 32654459, "question_id": 32594260, "link": "https://stackoverflow.com/questions/32594260/a-replace-function-in-lisp-that-duplicates-mathematica-functionality/32654459#32654459", "title": "A Replace Function in Lisp That Duplicates Mathematica Functionality", "body": "<p>Let's give it another try.</p>\n\n<p>First, install  <a href=\"https://www.quicklisp.org/beta/\" rel=\"nofollow\"><code>quicklisp</code></a> and use it to fetch, install and load <a href=\"https://github.com/m2ym/optima\" rel=\"nofollow\"><code>optima</code></a> and <a href=\"https://common-lisp.net/project/alexandria/draft/alexandria.html\" rel=\"nofollow\"><code>alexandria</code></a>. </p>\n\n\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(ql:quickload :optima)\n(ql:quickload :alexandria)\n(use-package :alexandria)\n</code></pre>\n\n<p>The functions from <code>alexandria</code> referenced below are <code>ensure-list</code> and <code>last-elt</code>. If you don't have them installed, you can use the following definitions:</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(defun ensure-list (list) (if (listp list) list (list list)))\n(defun last-elt (list) (car (last list)))\n</code></pre>\n\n<p>We define rules as functions from one form to another.\nBelow, the function tries to destructure the input as <code>(f (&lt;X&gt; \"[\" &lt;ARGS&gt; \"]\")</code>, where <code>&lt;ARGS&gt;</code> is zero or more form. If destructuring fails, we return <code>NIL</code> (we expect non-matching filters to return <code>NIL</code> hereafter).</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(defun match-ugly-funcall (form)\n  (optima:match form\n    ((list 'f (cons x args))\n     (unless (and (string= \"[\" (first args))\n                  (string= \"]\" (last-elt args)))\n       (optima:fail))\n     `(,x ,@(cdr (butlast args))))))\n\n(match-ugly-funcall '(f (g \"[\" 1 3 5 4 8 \"]\")))\n; =&gt; (G 1 3 5 4 8)\n</code></pre>\n\n<p>Then, we mimic Mathematica's Replace with this function, which takes a form and a list of rules to be tried. It is possible to pass a single rule (thanks to <code>ensure-list</code>). If a list of list of rules is given, a list of matches should be returned (to be done).</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(defun match-replace (form rules &amp;optional (levelspec '(0)))\n  (setf rules (ensure-list rules))\n  (multiple-value-bind (match-levelspec-p recurse-levelspec-p)\n      (optima:ematch levelspec\n        ((list n1 n2) (if (some #'minusp (list  n1 n2))\n                          (optima:fail)\n                          (values (lambda (d) (&lt;= n1 d n2))\n                                  (lambda (d) (&lt; d n2)))))\n        ((list n) (if (minusp n)\n                      (optima:fail)\n                      (values (lambda (d) (= d n))\n                              (lambda (d) (&lt; d n)))))\n        (:infinity (values (constantly t) (constantly t))))\n    (labels\n        ((do-replace (form depth)\n           (let ((result\n                   (and (funcall match-levelspec-p depth)\n                        (some (lambda (r) (funcall r form)) rules))))\n             (cond\n               (result (values result t))\n               ((and (listp form)\n                     (funcall recurse-levelspec-p depth))\n                (incf depth)\n                (do (newlist\n                     (e (pop form) (pop form)))\n                    ((endp form) (values form nil))\n                  (multiple-value-bind (result matchedp) (do-replace e depth)\n                    (if matchedp\n                        (return (values (nconc (nreverse newlist) \n                                               (list* result form)) t))\n                        (push e newlist)))))\n               (t (values form nil))))))\n      (do-replace form 0))))\n</code></pre>\n\n<p>And a test:</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(match-replace '(a b (f (x \"[\" 1 2 3 \"]\")) c d)\n               #'match-ugly-funcall\n               :infinity)\n; =&gt; (A B (X 1 2 3) C D)\n;    T\n</code></pre>\n\n<p>In order to replace all expressions instead of the first matching one, use this instead:</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>  (defun match-replace-all (form rules &amp;optional (levelspec '(0)))\n      (setf rules (ensure-list rules))\n      (multiple-value-bind (match-levelspec-p recurse-levelspec-p)\n          (optima:ematch levelspec\n            ((list n1 n2) (if (some #'minusp (list  n1 n2))\n                              (optima:fail)\n                              (values (lambda (d) (&lt;= n1 d n2))\n                                      (lambda (d) (&lt; d n2)))))\n            ((list n) (if (minusp n)\n                          (optima:fail)\n                          (values (lambda (d) (= d n))\n                                  (lambda (d) (&lt; d n)))))\n            (:infinity (values (constantly t) (constantly t))))\n        (labels\n            ((do-replace (form depth)\n               (let ((result\n                       (and (funcall match-levelspec-p depth)\n                            (some (lambda (r) (funcall r form)) rules))))\n                 (cond\n                   (result result)\n                   ((and (listp form)\n                         (funcall recurse-levelspec-p depth))\n                    (incf depth)\n                    (mapcar (lambda (e) (do-replace e depth)) form))\n                   (t form)))))\n          (do-replace form 0))))\n</code></pre>\n"}], "owner": {"reputation": 12664, "user_id": 422252, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/rUirn.jpg?s=128&g=1", "display_name": "Lime", "link": "https://stackoverflow.com/users/422252/lime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 1, "accepted_answer_id": 32654459, "answer_count": 2, "score": 6, "last_activity_date": 1444370380, "creation_date": 1442345934, "last_edit_date": 1442899083, "question_id": 32594260, "link": "https://stackoverflow.com/questions/32594260/a-replace-function-in-lisp-that-duplicates-mathematica-functionality", "title": "A Replace Function in Lisp That Duplicates Mathematica Functionality", "body": "<p>What is the easiest way to accomplish the following in a Mathematica clone or in any version of Lisp(any language is probably okay actually even Haskell)?  It doesn't appear any lisps <a href=\"http://hyperpolyglot.org/lisp\" rel=\"nofollow\">have a similar replace function</a>.</p>\n\n<pre><code>Replace[{\n  f[{x, \"[\", y, \"]\"}],\n  f@f[{x, \"[\", y, y2, \"]\"}]\n  }\n , f[{x_, \"[\", y__, \"]\"}] :&gt; x[y],\n Infinity]\n</code></pre>\n\n<p>and a return value of  <code>{x[y], f[x[y, y2]]}</code></p>\n\n<p>It replaces all instances of <code>f[{x_, \"[\", y__, \"]\"}]</code> in args where <code>x_</code> represents a single variable and <code>y__</code> represents one or more variables.</p>\n\n<p>In lisp the function and replacement would probably be the equivalent(forgive me I am not the best with Lisp).  I'm looking for a function of the form <code>(replace list search replace)</code>.</p>\n\n<pre><code>(replace\n  '(\n   (f (x \"[\" y \"]\"))\n   (f (f '(x \"[\" y y2 \"]\")))\n  )\n  '(f (x_ \"[\" y__ \"]\"))\n  '(x y)\n)\n</code></pre>\n\n<p>and get a return value of <code>((x y) (f (x y y2)))</code>.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442345262, "post_id": 32594037, "comment_id": 53041775, "body": "Are you sure? If I enable <code>FlexibleInstances</code>, and define an instance on <code>(a, a)</code>, I can get it to work (e.g. <code>foo (x,y) = (x * 2, y * 7)</code> with the instance restricted to <code>Num a</code>). I can then use <code>foo</code> on values of type <code>(Int, Int)</code>, but not <code>(Int, Float)</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442345402, "post_id": 32594037, "comment_id": 53041847, "body": "@SamvanHerwaarden That&#39;s with <code>FlexibleInstances</code>, which is a GHC specific extension, not vanilla Haskell. Besides, the question seems to rule out the extension anyway."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 6, "last_activity_date": 1442347279, "last_edit_date": 1442347279, "creation_date": 1442345098, "answer_id": 32594037, "question_id": 32593576, "link": "https://stackoverflow.com/questions/32593576/is-it-possible-to-make-a-a-a-member-of-typeclass-in-haskell/32594037#32594037", "title": "Is it possible to make (a, a) a member of typeclass in Haskell", "body": "<p><strong>There are no ways to directly enforce the relationship of <code>(a, b)</code> in an instance (without <code>FlexibleInstances</code> or other extensions), but they may be equivalent.</strong></p>\n\n<p>This means that if <code>Fooable (a, b)</code> is an instance, then if <code>a</code> can equal <code>b</code>, <code>Fooable (a,a)</code> is also an instance. Consider as gaining more instances.</p>\n\n<p>However, there is somewhat of a way around:</p>\n\n<pre><code>newtype Tuple a = Tuple {unTuple :: (a, a)}\n\ninstance Fooable (Tuple a) where\n    foo = id\n</code></pre>\n\n<p>It's not the prettiest or nicest thing on the planet, but at least at runtime it will behave as if there were no wrapper.</p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442345502, "post_id": 32594124, "comment_id": 53041889, "body": "Isn&#39;t that an extension? I had certainly forgotten about that!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442345533, "post_id": 32594124, "comment_id": 53041902, "body": "@AJFarmar, it certainly is an extension, as the first line says!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442345580, "post_id": 32594124, "comment_id": 53041926, "body": "I can&#39;t seem to find any documentation on it when I search for Type Equality, only the package?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442345759, "post_id": 32594124, "comment_id": 53042021, "body": "@AJFarmar, you can win that particular constraint with either <code>GADTs</code> or <code>TypeFamilies</code>. The type-level version, <code>:~:</code>, comes from <code>Data.Type.Equality</code> (re-exported by <code>Data.Typeable</code>)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1442346229, "last_edit_date": 1495540685, "creation_date": 1442345403, "answer_id": 32594124, "question_id": 32593576, "link": "https://stackoverflow.com/questions/32593576/is-it-possible-to-make-a-a-a-member-of-typeclass-in-haskell/32594124#32594124", "title": "Is it possible to make (a, a) a member of typeclass in Haskell", "body": "<p>If you want to use other extensions instead, you can write</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n-- and/or\n{-# LANGUAGE TypeFamilies #-}\n\ninstance a ~ b =&gt; Fooable (a, b) where\n  foo (a, b) = (b, a)\n</code></pre>\n\n<p>This will make <code>Fooable (a, a)</code> an instance, and ensure that no other pairs can be instances (without <code>OverlappingInstances</code>). <a href=\"https://stackoverflow.com/a/32594037/1477667\">AJFarmar's answer</a> has a rather more pleasant feel to it, however.</p>\n"}], "owner": {"reputation": 101, "user_id": 4142419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/864e365e477de72345e2c14a580ed5b1?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4142419/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 32594037, "answer_count": 2, "score": 2, "last_activity_date": 1442347279, "creation_date": 1442343456, "question_id": 32593576, "link": "https://stackoverflow.com/questions/32593576/is-it-possible-to-make-a-a-a-member-of-typeclass-in-haskell", "title": "Is it possible to make (a, a) a member of typeclass in Haskell", "body": "<p>Here's a code in Haskell:</p>\n\n<pre><code>class Fooable a where\n    foo :: a -&gt; a\n\ninstance Fooable (a, a) where \n    foo = ...\n</code></pre>\n\n<p>Code like this would not compile in traditional Haskell without <code>FlexibleInstances</code> extension. The error message would say:</p>\n\n<pre><code>Illegal instance declaration for \u2018Fooable (a, a)\u2019\n  (All instance types must be of the form (T a1 ... an)\n   where a1 ... an are *distinct type variables*,\n   and each type variable appears at most once in the instance head.\n   Use FlexibleInstances if you want to disable this.)\nIn the instance declaration for \u2018Fooable (a, a)\u2019\n</code></pre>\n\n<p>The question is, is it actually impossible to make tuple <code>(a, a)</code> a member of any typeclass, since <code>each type variable appears at most once in the instance head</code>?</p>\n"}, {"tags": ["haskell", "import", "build", "cabal"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442345285, "post_id": 32593554, "comment_id": 53041789, "body": "You <i>could</i> copy-and-paste, and then comment in the necessary links and such. I imagine that your IDE looks at hackage, and then just reads the necessary type signatures and so on."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442345454, "post_id": 32593554, "comment_id": 53041869, "body": "With <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow noreferrer\">stack</a> you can keep a package install local and load it by running <code>stack ghci</code> in your project directory. I realize this is not really an answer to your question but maybe it can still be of use."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442350136, "post_id": 32593554, "comment_id": 53044321, "body": "It&#39;s pretty easy to make a temporary package database, install to that database, and point ghci at that package database. In fact, this is such a common wish, that the steps are rolled up into the <code>cabal repl</code> command; or you can run just the ghci step with <code>cabal exec ghci</code> (which will not rebuild your package when it&#39;s dirty, using whatever existing build has been done)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442363323, "post_id": 32593554, "comment_id": 53048681, "body": "Soon, soon, this should all get easier. &quot;No-reinstall cabal&quot; is in public beta; it brings Nix ideas to the package database, so making a new sandbox won&#39;t generally need a &quot;get a cup of coffee&quot; step."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 143, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1442351751, "creation_date": 1442343357, "last_edit_date": 1442351751, "question_id": 32593554, "link": "https://stackoverflow.com/questions/32593554/is-there-a-way-to-import-modules-from-a-haskell-package-build-without-installing", "title": "Is there a way to import modules from a Haskell package build without installing it?", "body": "<p>Is there a way to import (using either <code>import</code> or <code>m +</code>) a module from a Haskell package that has been built locally, but not installed (e.g., with Cabal)?</p>\n\n<p>For example, if I built a package in a local directory, so that, say, <code>MyPkg/dist/build/</code> contains all of the same <code>.dyn_hi</code>, <code>.hi</code>, <code>.a</code>, and <code>.dylib</code> files and subfolders that a Cabal-installed version would have in (for example) <code>MyPkg-0.0.1.0</code>, is there a way to import a module from that with</p>\n\n<pre><code>import MyPkg.Sub \n</code></pre>\n\n<p>or </p>\n\n<pre><code>:m + MyPkg.Sub\n</code></pre>\n\n<p>as I would if it had been installed?</p>\n\n<p>I've tried <code>cd</code>ing (both before and within GHCi) to <code>MyPkg/dist/build/</code> (and every place along the way) and have also tried <code>ghci -i...</code> and <code>:set -i...</code> to the same locations. But in all cases the only way I can get <code>import</code> or <code>:m +</code> to work, is by installing the package.</p>\n\n<p>I understand how to install, as well as how to install using a sandbox. But is there a way to import (given that the files are \"right there\") without installing? </p>\n\n<hr>\n\n<p>I know that the answer to this must be (perhaps a qualified) \"yes\", because my IDE accomplishes this somehow: Within the same project, I can include applications that use <code>import</code> successfully, without having to install the package from which the modules are imported.</p>\n"}, {"tags": ["parsing", "haskell", "error-handling", "parsec", "parse-error"], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1442414104, "post_id": 32594609, "comment_id": 53073983, "body": "Your answer was very informative, however <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Prim.html\" rel=\"nofollow noreferrer\"><b><code>Data.Parsec.Prim</code></b></a> does not export the <code>ParsecT</code> constructor. This makes most of the solutions you presented form the module&#39;s source unusable outside the library&#39;s exposed interface."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1442418944, "post_id": 32594609, "comment_id": 53077400, "body": "Glad to know that using <code>labels</code> worked out for you."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1442420511, "post_id": 32594609, "comment_id": 53078428, "body": "It&#39;s not perfect because I would prefer <code>Message</code> instead of <code>Expect</code> values, but is is probably as close as I will get. Plus the <code>fails</code> definition is short and sweet ;)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1519512772, "last_edit_date": 1519512772, "creation_date": 1442347192, "answer_id": 32594609, "question_id": 32592791, "link": "https://stackoverflow.com/questions/32592791/how-to-return-multiple-parse-failures-within-parsecs-monadic-context/32594609#32594609", "title": "How to return multiple parse failures within Parsec&#39;s monadic context?", "body": "<p><code>fail</code> in this case is equivalent to <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Prim.html#v:parserFail\" rel=\"nofollow noreferrer\"><code>parserFail</code></a> defined in <code>Text.Parsec.Prim</code>:</p>\n\n<pre><code>parserFail :: String -&gt; ParsecT s u m a\nparserFail msg\n    = ParsecT $ \\s _ _ _ eerr -&gt;\n      eerr $ newErrorMessage (Message msg) (statePos s)\n</code></pre>\n\n<p>Since <code>newErrorMessage</code> and <code>addErrorMessage</code> both create a <code>ParseError</code>,\nthis variation of <code>parserFail</code> should also work:</p>\n\n<pre><code>parserFail' :: String -&gt; ParsecT s u m a\nparserFail' msg\n    = ParsecT $ \\s _ _ _ eerr -&gt;\n      eerr $ theMessages s\nwhere\n  theMessages s =\n    addErrorMessage (Message \"blah\") $\n      addErrorMessage (Expect \"expected this\") $\n        newErrorMessage (Message msg) (statePos s)\n</code></pre>\n\n<p>which should push 3 messages onto the error message list.</p>\n\n<p>Also in that module, have a look at <code>label</code> and <code>labels</code> which is\nthe only place where <code>addErrorMessage</code> is used. <code>labels</code> is just a multi-message\nversion of the <code>&lt;?&gt;</code> operator. Note how it uses <code>foldr</code> to build up a compound\nerror message:</p>\n\n<pre><code>labels :: ParsecT s u m a -&gt; [String] -&gt; ParsecT s u m a\nlabels p msgs =\n    ParsecT $ \\s cok cerr eok eerr -&gt;\n    let eok' x s' error = eok x s' $ if errorIsUnknown error\n                  then error\n                  else setExpectErrors error msgs\n        eerr' err = eerr $ setExpectErrors err msgs\n\n    in unParser p s cok cerr eok' eerr'\n\n where\n   setExpectErrors err []         = setErrorMessage (Expect \"\") err\n   setExpectErrors err [msg]      = setErrorMessage (Expect msg) err\n   setExpectErrors err (msg:msgs)\n       = foldr (\\msg' err' -&gt; addErrorMessage (Expect msg') err')\n         (setErrorMessage (Expect msg) err) msgs\n</code></pre>\n\n<p>The only gatcha is that you need access to the <code>ParsecT</code> constructor which\nis not exported by <code>Text.Parsec.Prim</code>. Maybe you can find a way to use <code>labels</code>\nor another way around that problem. Otherwise you could always include your\nown hacked version of <code>parsec</code> with your code. </p>\n"}, {"tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": false, "score": 0, "last_activity_date": 1442414945, "creation_date": 1442414945, "answer_id": 32611969, "question_id": 32592791, "link": "https://stackoverflow.com/questions/32592791/how-to-return-multiple-parse-failures-within-parsecs-monadic-context/32611969#32611969", "title": "How to return multiple parse failures within Parsec&#39;s monadic context?", "body": "<p>We can leverage the fact that <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Prim.html#t:ParsecT\" rel=\"nofollow\"><strong><code>ParsecT</code></strong></a> is an instance of <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow\"><strong><code>MonadPlus</code></strong></a> to combine the definition of <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Monad.html#v:mzero\" rel=\"nofollow\"><strong><code>mzero</code></strong></a> with the function <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Prim.html#v:labels\" rel=\"nofollow\"><strong><code>labels</code></strong></a> to derive the desired result:</p>\n\n<pre><code>fails :: [String] -&gt; ParsecT s u m a\nfails = labels mzero\n</code></pre>\n\n<p><strong><em>Note:</em></strong> The <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Error.html#t:ParseError\" rel=\"nofollow\"><strong><code>ParseError</code></strong></a> has many <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Error.html#t:Message\" rel=\"nofollow\"><strong><code>Expect</code></strong></a> values, not many <a href=\"http://hackage.haskell.org/package/parsec-3.1.8/docs/Text-Parsec-Error.html#t:Message\" rel=\"nofollow\"><strong><code>Message</code></strong></a> values...</p>\n"}, {"tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": true, "score": 0, "last_activity_date": 1450491766, "last_edit_date": 1450491766, "creation_date": 1450491464, "answer_id": 34366582, "question_id": 32592791, "link": "https://stackoverflow.com/questions/32592791/how-to-return-multiple-parse-failures-within-parsecs-monadic-context/34366582#34366582", "title": "How to return multiple parse failures within Parsec&#39;s monadic context?", "body": "<p>I would recommend transitioning from <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow\"><strong><code>Parsec</code></strong></a> to newer and more extensible <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow\"><strong><code>Megaparsec</code></strong></a> library.</p>\n\n<p><a href=\"https://github.com/mrkkrp/megaparsec/issues/43\" rel=\"nofollow\">This exact issue</a> has been resolved since version <code>4.2.0.0</code>.</p>\n\n<p>Multiple parse error <a href=\"https://hackage.haskell.org/package/megaparsec-4.2.0/docs/Text-Megaparsec-Error.html#v:Message\" rel=\"nofollow\"><strong><code>Message</code></strong></a>s can easily be created with the following function:</p>\n\n<pre><code>fails :: MonadParsec m =&gt; [String] -&gt; m a\nfails = failure . fmap Message\n</code></pre>\n"}], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 34366582, "answer_count": 3, "score": 1, "last_activity_date": 1519512772, "creation_date": 1442340360, "last_edit_date": 1442414647, "question_id": 32592791, "link": "https://stackoverflow.com/questions/32592791/how-to-return-multiple-parse-failures-within-parsecs-monadic-context", "title": "How to return multiple parse failures within Parsec&#39;s monadic context?", "body": "<p>I have a grammar I am parsing which consists of <em>exactly two</em> required and unique logical parts, <code>Alpha</code> and <code>Beta</code>. These parts can be defined in any order, <code>Alpha</code> before <code>Beta</code> or visa-vera. I would like to provide robust error messages for the less tech-savvy users. </p>\n\n<p>In the example below there are cases where multiple parse failures exist. I concatenate the failure message <code>String</code>s with the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:unlines\" rel=\"nofollow\"><strong><code>unlines</code></strong></a> function and pass the resulting concatenation into the <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Monad.html#v:fail\" rel=\"nofollow\"><strong><code>fail</code></strong></a> combinator. This creates a  <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:ParseError\" rel=\"nofollow\"><strong><code>ParseError</code></strong></a> value with a <em>single</em> <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:Message\" rel=\"nofollow\"><strong><code>Message</code></strong></a> value when <a href=\"https://hackage.haskell.org/package/parsec-3.1.7/docs/Text-Parsec.html#v:parse\" rel=\"nofollow\"><strong><code>parse</code></strong></a> is called on <code>grammarDefinition</code>.</p>\n\n<p><strong>Example Scenario:</strong></p>\n\n<pre><code>import Data.Either                   (partitionEithers)\nimport Data.Set                      (Set)\nimport Text.Parsec                   (Parsec)\nimport Text.Parsec.Char\nimport Text.ParserCombinators.Parsec\n\ndata Result = Result Alpha Beta\ntype Alpha  = Set (Int,Float)\ntype Beta   = Set String\n\ngrammarDefinition :: Parsec String u Result\ngrammarDefinition = do\n    segments &lt;- partitionEithers &lt;$&gt; many segment\n    _        &lt;- eof\n    case segments of\n      (     [],      []) -&gt; fail $ unlines [missingAlpha, missingBeta]\n      (      _,      []) -&gt; fail $ missingBeta\n      (     [],       _) -&gt; fail $ missingAlpha\n      ((_:_:_), (_:_:_)) -&gt; fail $ unlines [multipleAlpha, multipleBeta]\n      (      _, (_:_:_)) -&gt; fail $ multipleBeta\n      ((_:_:_),       _) -&gt; fail $ multipleAlpha\n      (    [x],     [y]) -&gt; pure $ Result x y\n    where\n      missingAlpha     = message \"No\" \"alpha\"\n      missingBeta      = message \"No\" \"beta\"\n      multipleAlpha    = message \"Multiple\" \"alpha\"\n      multipleBeta     = message \"Multiple\" \"beta\"\n      message x y      = concat [x,\" \",y,\" defined in input, \",\"exactly one \",y,\" definition required\"]\n\n-- Type signature is important!\nsegment :: Parsec String u (Either Alpha Beta)\nsegment = undefined -- implementation irrelevant\n</code></pre>\n\n<p>I would like the <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:ParseError\" rel=\"nofollow\"><strong><code>ParseError</code></strong></a> to contain <em>multiple</em> <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:Message\" rel=\"nofollow\"><strong><code>Message</code></strong></a> values in the case of multiple failures. This should be possible due to the existence of the <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:addErrorMessage\" rel=\"nofollow\"><strong><code>addErrorMessage</code></strong></a> function. I am not sure hw to supply multiple failure within the Parsec monadic context, before the result is materialized by calling <a href=\"https://hackage.haskell.org/package/parsec-3.1.7/docs/Text-Parsec.html#v:parse\" rel=\"nofollow\"><strong><code>parse</code></strong></a>.</p>\n\n<p><strong>Example Function:</strong></p>\n\n<pre><code>fails :: [String] -&gt; ParsecT s u m a\nfails = undefined -- Not sure how to define this!\n</code></pre>\n\n<p><strong>How do I supply <em>multiple</em> <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:Message\" rel=\"nofollow\"></strong><code>Message</code><strong></a> values to the <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Error.html#t:ParseError\" rel=\"nofollow\"></strong><code>ParseError</code><strong></a> result <em>within</em> Parsec's monadic context?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1442338191, "post_id": 32592017, "comment_id": 53037938, "body": "<a href=\"https://stackoverflow.com/questions/14430397/about-the-function-monad\" title=\"about the function monad\">stackoverflow.com/questions/14430397/about-the-function-mona&zwnj;&#8203;d</a>"}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1442452070, "post_id": 32592218, "comment_id": 53092388, "body": "Oh, making a <code>Reader</code> type synonym like that really clarifies the explanation! That&#39;s a great idea. I&#39;m totally going to steal it next time I need to talk about the monad instance for <code>((-&gt;) r)</code> because that syntax is way too confusing :P."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 8, "last_activity_date": 1442338199, "creation_date": 1442338199, "answer_id": 32592218, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse/32592218#32592218", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>This works using the fact that <code>x -&gt; y</code> can be regarded as a kind of \"reader monad\". If we were to say</p>\n\n<pre><code>type Reader r x = r -&gt; x\n</code></pre>\n\n<p>then we have an instance of <code>Monad (Reader r)</code>. So we can see that</p>\n\n<pre><code>reverse :: [x] -&gt; [x]\n</code></pre>\n\n<p>is actually</p>\n\n<pre><code>reverse :: Reader [x] [x]\n</code></pre>\n\n<p>Similarly,</p>\n\n<pre><code>(==) :: [x] -&gt; [x] -&gt; Bool\n</code></pre>\n\n<p>can be written as</p>\n\n<pre><code>(==) :: [x] -&gt; Reader [x] Bool\n</code></pre>\n\n<p>Then <code>(&gt;&gt;=)</code> joins the two together.</p>\n\n<p>So... We start with <code>reverse</code>, which is a <code>Reader</code> action that reads a list and returns a list. We then use <code>&gt;&gt;=</code> to pass that to <code>==</code>, which is a function that takes a list, and returns a <code>Reader [x] Bool</code>.</p>\n\n<p>In short, the input list is duplicated by the action of <code>Reader</code>, which basically takes an input and passes it to <em>every</em> function in the chain. (That's what the reader monad <em>is</em>.)</p>\n\n<p>I hope that made some kind of sense... It took <em>me</em> a while to figure out!</p>\n"}, {"tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": false, "score": 5, "last_activity_date": 1442338206, "creation_date": 1442338206, "answer_id": 32592219, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse/32592219#32592219", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>Let's have a look at the Monad instance for <code>((-&gt;) r)</code>:</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    return = const\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<p>and then simply fill in your monadic code:</p>\n\n<pre><code>reverse &gt;&gt;= (==) = \\r -&gt; (==) (reverse r) r\n</code></pre>\n\n<p>which we can write in a more familiar way:</p>\n\n<pre><code>\\r -&gt; reverse r == r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 4, "last_activity_date": 1442339078, "last_edit_date": 1442339078, "creation_date": 1442338749, "answer_id": 32592375, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse/32592375#32592375", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>To add to other answers, here is another POV on this. Let's take a definition of bind via <code>fmap</code> and <code>join</code>:</p>\n\n<pre><code>m &gt;&gt;= act = join (fmap act m)\n</code></pre>\n\n<p>The expression <code>(==) &lt;$&gt; reverse</code> has type <code>Eq a =&gt; [a] -&gt; [a] -&gt; Bool</code> and is equivalent to <code>fmap (==) reverse</code>. Now, we pass it to <code>join :: m (m a) -&gt; m a</code> and for <code>(-&gt;) r</code> monad instance the type would be <code>([a] -&gt; [a] -&gt; Bool) -&gt; ([a] -&gt; Bool)</code>. That is, join is exactly <code>&lt;*&gt; id</code> part.</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 1, "last_activity_date": 1442341503, "creation_date": 1442341503, "answer_id": 32593063, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse/32593063#32593063", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>I think the easiest way to understand this is by looking at the types:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>specialized to the <code>((-&gt;) r)</code> instance:</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; r -&gt; b\n</code></pre>\n\n<p>You are not given an <code>a</code>. The only way to produce one is to apply the first function <code>r -&gt; a</code> to the <code>r</code> you are given. The only way to produce a <code>b</code> is to apply the second function to the <code>r</code> and the <code>a</code> you just produced. This means the only possible definition for this function<sup>*</sup> is:</p>\n\n<pre><code>f &gt;&gt;= g = \\a -&gt; g (f a) a\n</code></pre>\n\n<p>Plugging our arguments in, we get:</p>\n\n<pre><code>reverse &gt;&gt;= (==) \n\n-- definition of (&gt;&gt;=)\n= \\a -&gt; (==) (reverse a) a\n\n-- prefix to infix\n= \\a -&gt; reverse a == a\n</code></pre>\n\n<p>Parametricity is a powerful tool for reasoning about polymorphic functions.</p>\n\n<hr>\n\n<p>* other than bottom</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1442343959, "creation_date": 1442343959, "answer_id": 32593720, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse/32593720#32593720", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>The other answers confirm that the two behave the same, but don't explain where the <code>id</code> actually <em>went</em>. In this answer, I will attempt to do so. The punchline is that, for Reader, we have a curious <code>id</code>-removing equation: <code>id &gt;&gt;= return . f = f</code>. (A more beautiful form of this equation is that <code>(id &gt;&gt;=) = (&gt;&gt;= id)</code>; together with the monad laws the beautiful form implies the easily-usable form.) To make the explanation a bit simpler, instead of trying to convert from applicative form to monadic form, I will just take it for granted that you believe the following equation:</p>\n\n<pre><code>(==) &lt;$&gt; reverse &lt;*&gt; id\n= { too annoying to do carefully }\nreverse &gt;&gt;= \\xs -&gt; id &gt;&gt;= \\ys -&gt; return ((==) xs ys)\n</code></pre>\n\n<p>So we will start from that last line, and end at <code>reverse &gt;&gt;= (==)</code>. Along the way, it will be key to observe that <code>id</code> is the identity for <code>(.)</code> -- which just so happens to be <code>fmap</code> for the Reader monad. Here we go:</p>\n\n<pre><code>reverse &gt;&gt;= \\xs -&gt; id &gt;&gt;= \\ys -&gt; return ((==) xs ys)\n= { monad law }\nreverse &gt;&gt;= \\xs -&gt; fmap ((==) xs) id\n= { definition of fmap for Reader }\nreverse &gt;&gt;= \\xs -&gt; (.) ((==) xs) id\n= { id is the identity of fmap }\nreverse &gt;&gt;= \\xs -&gt; (==) xs\n= { eta reduction }\nreverse &gt;&gt;= (==)\n</code></pre>\n\n<p>So what is the meaning of <code>id &gt;&gt;= return . f = f</code>? Well, treating functions as \"indexed values\", we can understand <code>id</code> as being the value that equals its index; and <code>return</code> as being the value that is the same everywhere. So <code>id &gt;&gt;= return . f</code> says \"look at index <code>x</code>; then, (still at index <code>x</code>), return the value that ignores its index and has value <code>f x</code>\". It just so happens that the index we ignore and the value we hand to <code>f</code> match up -- so we might as well skip all that indirection and simply say \"look at index <code>x</code> and apply <code>f</code> to it\". This is the meaning of the equation.</p>\n"}], "owner": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 5, "score": 7, "last_activity_date": 1442343959, "creation_date": 1442337589, "question_id": 32592017, "link": "https://stackoverflow.com/questions/32592017/behavior-of-reverse", "title": "Behavior of reverse &gt;&gt;= (==)", "body": "<p>A function for determine if a string is a palindrome can be implemented in a pointfree applicative manner via </p>\n\n<pre><code>pal1 = (==) &lt;$&gt; reverse &lt;*&gt; id \n</code></pre>\n\n<p>And here is a monadic version </p>\n\n<pre><code>reverse &gt;&gt;= (==)\n</code></pre>\n\n<p>How does the modadic version work with no explicit call to id? I attempted to view the poinful representation using pointful and get back the same function.</p>\n"}, {"tags": ["haskell", "polymorphism", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 4, "creation_date": 1442328282, "post_id": 32588983, "comment_id": 53031736, "body": "See <a href=\"http://stackoverflow.com/questions/12468622/how-does-the-st-monad-work\">this</a> answer"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1442329560, "post_id": 32588983, "comment_id": 53032728, "body": "The compiler infers an implicit <code>forall</code> when it&#39;s a top-level declaration, but that&#39;s the only time."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1442333027, "post_id": 32588983, "comment_id": 53035112, "body": "Well, because if you write: <code>data A = A a</code> you could simply have forgotten to add the type parameter: <code>data A a = A a</code>. In fact I believe this is the most common case, so requiring an explicit <code>forall</code> removes the ambiguity and avoids bugs."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1442334433, "post_id": 32588983, "comment_id": 53035982, "body": "@LouisWasserman, also for class member declarations, GADT constructor declarations, and as a result of <code>let</code> generalization."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442334853, "post_id": 32588983, "comment_id": 53036214, "body": "And <code>let</code> with an explicit signature, I should&#39;ve said as well."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1442455839, "last_edit_date": 1442455839, "creation_date": 1442334012, "answer_id": 32591005, "question_id": 32588983, "link": "https://stackoverflow.com/questions/32588983/why-is-forall-required-to-have-a-polymorphic-type-in-data-definition/32591005#32591005", "title": "Why is `forall` required to have a polymorphic type in data definition?", "body": "<p>There are two different places the <code>forall</code> could go, only one of which is what you intend. The other is</p>\n\n<pre><code>data A = forall s . A (ST s (STUArray s Int Int))\n</code></pre>\n\n<p>Which is equivalent to the GADT syntax</p>\n\n<pre><code>data A where\n  A :: ST s (STUArray s Int Int) -&gt; A\n</code></pre>\n\n<p>This can be thought of as a box holding an <code>ST</code> state transformer with some <code>s</code> or other&mdash;completely useless. But the type checker isn't specially tailored to the needs of <code>ST</code>, and similar types are useful in other contexts.</p>\n"}], "owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 32591005, "answer_count": 1, "score": 4, "last_activity_date": 1442455839, "creation_date": 1442328176, "question_id": 32588983, "link": "https://stackoverflow.com/questions/32588983/why-is-forall-required-to-have-a-polymorphic-type-in-data-definition", "title": "Why is `forall` required to have a polymorphic type in data definition?", "body": "<p>It seems that I need to explicitly say <code>forall</code> to have a parametric type in data definition. For example, this</p>\n\n<pre><code>data A = A (forall s. ST s (STUArray s Int Int))\n</code></pre>\n\n<p>will work while this</p>\n\n<pre><code>data A = A (ST s (STUArray s Int Int))\n</code></pre>\n\n<p>won't.</p>\n\n<p>Maybe I'm asking something too obvious, but the reason for this is not clear to me because in most other cases you don't need an explicit <code>forall</code> to specify a parametric type; the compiler does it instead. So what is the difference here?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1442325945, "post_id": 32588114, "comment_id": 53029994, "body": "Why do you want to add type declarations? Haskell will always attach the most generic signature to the function. In this case: <code>(Enum a, Num a) =&gt; a -&gt; a</code>"}, {"owner": {"reputation": 339, "user_id": 5000430, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6de9dd22e8befaffb46827037b700be?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/5000430/jacob"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1442326439, "post_id": 32588114, "comment_id": 53030353, "body": "For testing purposes."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 2, "creation_date": 1442326994, "post_id": 32588114, "comment_id": 53030790, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/3093133/how-to-provide-explicit-type-declarations-for-functions-when-using-ghci\">How to provide explicit type declarations for functions when using GHCi?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442329095, "post_id": 32588452, "comment_id": 53032375, "body": "To be super picky, the reason this works is that it is one statement, a let statement containing two declarations. It parses as <code>let { factorial :: Integer -&gt; Integer; factorial n = product [1..n] }</code>."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 5, "last_activity_date": 1442329142, "last_edit_date": 1442329142, "creation_date": 1442326669, "answer_id": 32588452, "question_id": 32588114, "link": "https://stackoverflow.com/questions/32588114/function-definitions-in-haskell-interactive/32588452#32588452", "title": "function definitions in haskell interactive", "body": "<p>If you want to specify the type signature yourself you can do this in ghci using semicolons, i.e.:</p>\n\n<pre><code>let factorial :: Integer -&gt; Integer; factorial n = product [1..n]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442357156, "post_id": 32588994, "comment_id": 53047018, "body": "Tip: You can put a newline after the <code>let</code> and then don&#39;t need to indent the rest."}], "tags": [], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "is_accepted": false, "score": 5, "last_activity_date": 1442328209, "last_edit_date": 1495541653, "creation_date": 1442328209, "answer_id": 32588994, "question_id": 32588114, "link": "https://stackoverflow.com/questions/32588114/function-definitions-in-haskell-interactive/32588994#32588994", "title": "function definitions in haskell interactive", "body": "<p>Next to the multi-line settings explained <a href=\"https://stackoverflow.com/questions/2846050/how-to-define-a-function-in-ghci-across-multiple-lines\">here</a>, you can use this instead if you don't want to write semicolons.</p>\n\n<pre><code>\u03bb&gt; :{\n\u03bb&gt; | let factorial :: Integer -&gt; Integer\n\u03bb&gt; |     factorial n = product [1..n]\n\u03bb&gt; :}\n\u03bb&gt; :t factorial\nfactorial :: Integer -&gt; Integer\n</code></pre>\n"}], "owner": {"reputation": 339, "user_id": 5000430, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6de9dd22e8befaffb46827037b700be?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/5000430/jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 32588452, "answer_count": 2, "score": 1, "last_activity_date": 1442329142, "creation_date": 1442325708, "question_id": 32588114, "link": "https://stackoverflow.com/questions/32588114/function-definitions-in-haskell-interactive", "title": "function definitions in haskell interactive", "body": "<pre><code>factorial :: Integer -&gt; Integer\nfactorial n = product [1..n]\n</code></pre>\n\n<p>The following is fine:</p>\n\n<pre><code>let factorial n = product [1..n]\n</code></pre>\n\n<p>I do not see how to add type declarations in interactive shell.</p>\n"}, {"tags": ["haskell", "hmatrix"], "answers": [{"comments": [{"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442316756, "post_id": 32584885, "comment_id": 53023470, "body": "I wrote like this ghc --extra-lib-dirs=/usr/lib 2_12.hs, and got  ghc: unrecognised flag: --extra-lib-dirs=/usr/lib Usage: For basic information, try the `--help&#39; option."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 1, "creation_date": 1442316881, "post_id": 32584885, "comment_id": 53023564, "body": "Hmm maybe I remembered wrong and it&#39;s not a ghc flag but a cabal configuration option. Please try <code>cabal configure --extra-lib-dir=&#47;usr&#47;lib</code> before running ghc and let me know if that works (I will update my answer)."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442316925, "post_id": 32584885, "comment_id": 53023597, "body": "thanks, Yeah I saw the same in that link was just about to post."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442317084, "post_id": 32584885, "comment_id": 53023704, "body": "damn, cabal configure --extra-lib-dir=/usr/lib. cabal: No cabal file found. Please create a package description file &lt;pkgname&gt;.cabal"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442318078, "post_id": 32584885, "comment_id": 53024362, "body": "And what if you <code>cabal install hmatrix --extra-lib-dirs=&#47;usr&#47;lib</code>? Then at least hmatrix should be properly linked"}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442318756, "post_id": 32584885, "comment_id": 53024800, "body": "I wrote cabal install hmatrix --extra-lib-dirs=/usr/lib --reinstall without any change actually."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442319919, "post_id": 32584885, "comment_id": 53025604, "body": "I will try my luck with the bed-and-breakfast package for a while. Sad, I liked the translation of matlab to haskell commands in the hMatrix tutorial."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1442397251, "post_id": 32584885, "comment_id": 53061933, "body": "@hotGopher: I would recommend that you don&#39;t shy away from writing a .cabal file (and I even recommend writing a stack.yaml and using stack because that is even more convenient once you get used to it) - it might fix your problem, hmatrix is a great library, and &quot;cabal init&quot; makes writing a .cabal file very easy."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 1, "last_activity_date": 1442317085, "last_edit_date": 1442317085, "creation_date": 1442316589, "answer_id": 32584885, "question_id": 32584505, "link": "https://stackoverflow.com/questions/32584505/hmatrix-breaks-in-a-file-what-could-be-the-cause/32584885#32584885", "title": "hMatrix breaks in a file, what could be the cause?", "body": "<p>You probably have libiconv installed with MacPorts. The definitions in the MacPorts libiconv are (annoyingly) somehow different from the ones in the OS X libiconv. <a href=\"http://blog.omega-prime.co.uk/?p=96\" rel=\"nofollow\">Here</a> is some more explanation.</p>\n\n<p>I had the same problem and my solution was to pass the --extra-lib-dirs=/usr/lib argument to cabal (/usr/lib is where OS X keeps libiconv). You can use <code>cabal configure --extra-lib-dir=/usr/lib</code> before compiling, or most likely also <code>cabal install --extra-lib-dir=/usr/lib</code>. You can also add the extra-lib-dirs statement to your cabal file. /usr/lib is already always included, but normally the MacPorts library directory is searched first: by adding the --extra-lib-dirs argument you make sure that ghc searches /usr/lib before it searches the MacPorts library directory.</p>\n"}], "owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 32584885, "answer_count": 1, "score": 0, "last_activity_date": 1442317085, "creation_date": 1442315363, "question_id": 32584505, "link": "https://stackoverflow.com/questions/32584505/hmatrix-breaks-in-a-file-what-could-be-the-cause", "title": "hMatrix breaks in a file, what could be the cause?", "body": "<p>I have been using the hMatrix package in the ghci environment, and all works fine (I can for instance import Numeric.LinearAlgebra.HMatrix). However, when I attempt to import and utilise the same things in a script, everything breaks (I truncated the error message slightly for readability (longer list of _base_GHCiIO-errors)). For instance these two lines in a file creates the error(s) below. Does anybody know what could be the cause? I am on mac OS X Yosemite.</p>\n\n<pre><code>import Numeric.LinearAlgebra.HMatrix\n\nmain = print ((2&gt;&lt;1) [1.0::Float,1.0])\n\n$ ghc 2_12.hs \n[1 of 1] Compiling Main             ( 2_12.hs, 2_12.o )\nLinking 2_12 ...\nUndefined symbols for architecture x86_64:\n  \"_iconv\", referenced from:\n  _hs_iconv in libHSbase-4.7.0.2.a(iconv.o)\n (maybe you meant: _hs_iconv,\n  _base_GHCziIOziEncodingziIconv_iconvEncoding9_info ,\n  _base_GHCziIOziEncodingziIconv_iconvEncoding8_info,\n  _base_GHCziIOziEncodingziIconv_iconvEncoding9_closure ,\n  _hs_iconv_open , _hs_iconv_close ,\n  \"_iconv_close\", referenced from:\n  _hs_iconv_close in libHSbase-4.7.0.2.a(iconv.o)\n (maybe you meant: _hs_iconv_close)\n \"_iconv_open\", referenced from:\n _hs_iconv_open in libHSbase-4.7.0.2.a(iconv.o)\n (maybe you meant: _hs_iconv_open)\n \"_locale_charset\", referenced from:\n  _localeEncoding in libHSbase-4.7.0.2.a(PrelIOUtils.o)\n ld: symbol(s) not found for architecture x86_64\n clang: error: linker command failed with exit code 1 (use -v to see     \n invocation)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 5, "last_activity_date": 1442316407, "creation_date": 1442316407, "answer_id": 32584831, "question_id": 32584215, "link": "https://stackoverflow.com/questions/32584215/is-it-possible-to-debug-turtle-scripts-equivalent-of-x-flag-in-bash/32584831#32584831", "title": "Is it possible to debug Turtle scripts (equivalent of &quot;-x&quot; flag in bash)?", "body": "<p>Sadly, it is not possible, as turtle does not provide tracing. For example, <code>mv</code> is defined only with Haskell function (no shell call), so there is no way to print anything when it is ran:</p>\n\n<pre><code>mv :: MonadIO io =&gt; FilePath -&gt; FilePath -&gt; io ()\nmv oldPath newPath = liftIO (Filesystem.rename oldPath newPath)\n</code></pre>\n\n<hr>\n\n<p>This limitation mentioned in the documentation, where the author recommends to take a look at <a href=\"https://github.com/yesodweb/Shelly.hs#shelly\">Shelly</a>, which is similar but provide extra features:</p>\n\n<blockquote>\n  <p>turtle is designed to be beginner-friendly, but as a result lacks\n  certain features, like tracing commands. If you feel comfortable using\n  turtle then you should also check out the Shelly library which\n  provides similar functionality.</p>\n</blockquote>\n"}], "owner": {"reputation": 596, "user_id": 1528262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c99f85fbe3fd4389f61ad7c04cf3376?s=128&d=identicon&r=PG", "display_name": "Jan Hrcek", "link": "https://stackoverflow.com/users/1528262/jan-hrcek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 1, "accepted_answer_id": 32584831, "answer_count": 1, "score": 8, "last_activity_date": 1442316407, "creation_date": 1442314482, "question_id": 32584215, "link": "https://stackoverflow.com/questions/32584215/is-it-possible-to-debug-turtle-scripts-equivalent-of-x-flag-in-bash", "title": "Is it possible to debug Turtle scripts (equivalent of &quot;-x&quot; flag in bash)?", "body": "<p>I've recently started using Haskell <a href=\"https://hackage.haskell.org/package/turtle\" rel=\"noreferrer\">Turtle</a> library to replace some of my shell scripts.</p>\n\n<p>Is there a way to somehow enable echoing of built in Turtle commands (like cd) ala <code>set -x</code> in bash scripts? I find it quite problematic to debug Turtle scripts in cases where many commands are executed and one of them fails with exception (like <code>cp</code> command with <code>Exception:openBinaryFile: does not exist</code>). Alternatively do you have some recommendation how to quickly isolate problems like these, so that I don't have to intersperse <code>puStrLn/echo</code> commands throughout my script?</p>\n"}, {"tags": ["string", "list", "haskell", "max"], "answers": [{"tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 2, "last_activity_date": 1442312953, "creation_date": 1442312953, "answer_id": 32583741, "question_id": 32583480, "link": "https://stackoverflow.com/questions/32583480/find-the-longest-word-of-a-column-within-a-text-table-in-haskell/32583741#32583741", "title": "Find the longest word of a column within a text table in Haskell", "body": "<p>So I did this:</p>\n\n<ol>\n<li>Find length of each text item in the table with <code>map length</code>, but I mapped that over the entire table, so <code>map (map length)</code></li>\n<li>I transposed it so that I could find the maximum in each column</li>\n<li>Map that over the entire table:</li>\n</ol>\n\n<hr>\n\n<pre><code>Prelude&gt; import Data.List\nPrelude Data.List&gt; let table = [[\"asd\",\"ffdd\",\"12345\"],[\"dd ss aa\",\"123\",\"1dssd\"]]\nPrelude Data.List&gt; let lengths = map (map length) table\nPrelude Data.List&gt; map maximum $ transpose lengths\n[8,4,5]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1442328314, "post_id": 32585201, "comment_id": 53031766, "body": "Thanks @chi. I was trying to keep it simple to show the logical steps."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1442317404, "creation_date": 1442317404, "answer_id": 32585201, "question_id": 32583480, "link": "https://stackoverflow.com/questions/32583480/find-the-longest-word-of-a-column-within-a-text-table-in-haskell/32585201#32585201", "title": "Find the longest word of a column within a text table in Haskell", "body": "<p>As a variant of Arnon's answer, we can also transpose first and map later:</p>\n\n<pre><code>&gt; map maximum . map (map length) . transpose $ table\n[8,4,5]\n</code></pre>\n\n<p>We can further simplify the code above by exploiting the functor law for <code>map</code>, which states that <code>map f . map g = map (f . g)</code>:</p>\n\n<pre><code>&gt; map (maximum . map length) . transpose $ table\n[8,4,5]\n</code></pre>\n"}], "owner": {"reputation": 374, "user_id": 3439407, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/100000367904897/picture?type=large", "display_name": "Simon H", "link": "https://stackoverflow.com/users/3439407/simon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 32583741, "answer_count": 2, "score": 2, "last_activity_date": 1445781650, "creation_date": 1442312195, "last_edit_date": 1445781650, "question_id": 32583480, "link": "https://stackoverflow.com/questions/32583480/find-the-longest-word-of-a-column-within-a-text-table-in-haskell", "title": "Find the longest word of a column within a text table in Haskell", "body": "<p>I have a text table defined as a list of a list of strings:</p>\n\n<pre><code>type Field = String\ntype Row   = [Field]\ntype Table = [Row]\n</code></pre>\n\n<p>I want to create a function that can find the width of the longest word per column, like this:</p>\n\n<pre><code>columnWidths :: Table -&gt; [Int]\n</code></pre>\n\n<p>So if someone inputs a text table like this:</p>\n\n<pre><code>[\"asd\", \"ffdd\",\" 12345\"]\n[\"dd ss aa\",\"123\", \"1dssd\"]\n</code></pre>\n\n<p>It should give back the widths:\n<code>[8,4,5]</code></p>\n\n<p>I tried some things includings maps, maximum length and transpose but I can't seem to make it work.</p>\n"}, {"tags": ["haskell", "typeclass", "monad-transformers", "type-constraints", "lifting"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1442311027, "creation_date": 1442311027, "answer_id": 32583053, "question_id": 32582657, "link": "https://stackoverflow.com/questions/32582657/type-constraints-for-polymorphic-functions-like-lift/32583053#32583053", "title": "Type constraints for polymorphic functions like lift", "body": "<p>The solution is dropping the constraint from the <code>MyStateT</code> definition:</p>\n\n<pre><code>newtype MyStateT a b { runMyStateT :: StateT A a b }\n    deriving (Functor, Applicative, Monad, MonadIO, MonadState A)\n</code></pre>\n\n<p>Datatype constraints are essentially useless, as you need to put them in the function signatures anyway. For that reason, that feature is actually <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/data-type-extensions.html\" rel=\"nofollow\">deprecated</a>.</p>\n\n<blockquote>\n  <p>I think I need the constraint to be able to instantiate as follows:</p>\n</blockquote>\n\n<p>Not really; <code>instance MonadA a =&gt; MonadA (MyStateT a)</code> will work just fine without it.</p>\n\n<blockquote>\n  <p>Also would such an implementation of <code>f</code> work?</p>\n</blockquote>\n\n<p>It will. Note that, as you provided a <code>MonadTrans</code> instance for <code>MyStateT</code>, you don't actually need to wrap with <code>MyStateT</code> explicitly:</p>\n\n<pre><code>instance MonadA a =&gt; MonadA (MyStateT a) where\n    f = lift . f\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 32583053, "answer_count": 1, "score": 0, "last_activity_date": 1442324602, "creation_date": 1442309883, "last_edit_date": 1442324602, "question_id": 32582657, "link": "https://stackoverflow.com/questions/32582657/type-constraints-for-polymorphic-functions-like-lift", "title": "Type constraints for polymorphic functions like lift", "body": "<p>So I have this code</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport MonadA\n\ndata A = A\n\nnewtype MonadA a =&gt; MyStateT a b { runMyStateT :: StateT A a b }\n    deriving (Functor, Applicative, Monad, MonadIO, MonadState A)\n\ninstance MonadTrans MyStateT where\n    lift = MyStateT . lift\n</code></pre>\n\n<p>and I get the compiler complaining that it cannot prove the <code>m</code> from signature of <code>lift</code> is of type <code>MonadA</code> or thats how I read these cryptic error messages.</p>\n\n<pre><code>Could not deduce (MonadA m) arising from a use of `MyStateT'\nfrom the context (Monad m)\n  bound by the type signature for\n             lift :: Monad m =&gt; m a -&gt; MyStateT m a\n</code></pre>\n\n<p>is there a way to deal with this? I think I need the constraint to be able to instantiate as follows:</p>\n\n<pre><code>instance MonadA a =&gt; MonadA (MyStateT a) where\n    f = MyStateT . lift . f\n</code></pre>\n\n<p>Also would such an implementation of <code>f</code> work? (I did not get that far due to the above error). I hope <code>f</code> on the right side to resolve to <code>f</code> over the inner monad <code>a</code>.</p>\n\n<hr>\n\n<p><strong>Edit</strong>: It indeed helped to drop the type constraint in <code>newtype MonadA a =&gt; MyStateT ...</code> to avoid the exact error that I mentioned. However there was just another error which I previously attributed to the same thing, consider this continuation of the example code above (some parts are repeated, now without type constraints):</p>\n\n<pre><code>class MonadB m where\n    fB :: m ()\n\nnewtype MyStateT m a = MyStateT { runMyStateT :: StateT A m a}\n    deriving (... MonadState A ...)\n\ninstance MonadTrans MyStateT where\n    lift = MyStateT . lift\n\ninstance MonadA a =&gt; MonadA (MyStateT a) where\n    f = lift . f\n\ninstance MonadA a =&gt; MonadB (MyStateT a) where\n    fB = lift (modify (...))\n</code></pre>\n\n<p>the error is</p>\n\n<pre><code>Could not deduce (a ~ StateT A m0) from context (MonadA (MyStateT a), MonadA a)\n</code></pre>\n\n<p>in the implementation of <code>fB</code>. Earlier I tried <code>class MonadA m =&gt; MonadB m</code> to no avail. It doesn't even make sense to be matching <code>a</code> with <code>StateT A m</code>. Since <code>MyStateT</code> is an instance of <code>MonadState A</code> it should work, no?</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>OK, got it working:</p>\n\n<pre><code>fB = MyStateT (modify ...)\n</code></pre>\n\n<p>stupid me.</p>\n"}, {"tags": ["haskell", "tying-the-knot"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "edited": false, "score": 0, "creation_date": 1442310440, "post_id": 32582611, "comment_id": 53019449, "body": "In fact, it should be aux (x,m) [] = (m,[]). Thanks, it was quite silly of me write this."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442309720, "creation_date": 1442309720, "answer_id": 32582611, "question_id": 32582542, "link": "https://stackoverflow.com/questions/32582542/non-exhaustive-patterns-in-aux-function-for-tying-the-knot/32582611#32582611", "title": "Non-exhaustive patterns in aux function for tying the knot", "body": "<p>Should this case for <code>aux</code>:</p>\n\n<pre><code>aux (x,m) [[]] = (m,[[]])\n</code></pre>\n\n<p>really be:</p>\n\n<pre><code>aux (x,m) [] = (m,[[]])\n</code></pre>\n\n<p>Otherwise, there is no case for when the second argument is the empty list.</p>\n"}], "owner": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 32582611, "answer_count": 1, "score": 0, "last_activity_date": 1442309720, "creation_date": 1442309528, "last_edit_date": 1442309635, "question_id": 32582542, "link": "https://stackoverflow.com/questions/32582542/non-exhaustive-patterns-in-aux-function-for-tying-the-knot", "title": "Non-exhaustive patterns in aux function for tying the knot", "body": "<p>I am trying to write a function in Haskell that takes a table and pads up cells of each column according to the maximum size of a string in that column. The way I am doing this is by using the technique - tying the knot. Here is the function that I wrote:</p>\n\n<pre><code>type Row = [String]\ntype Table = [Row]\ntype Width = [Int]\n\naux :: (Width,Width) -&gt; Table -&gt; (Width,Table)\naux (x,m) [[]] = (m,[[]])\naux (x,m) (z:zs) = (y,t)\n    where\n        (xz,zs') = aux (x,m) zs\n        y = zipWith max (map length z) xz\n        z' = adjust x z\n        t = z':zs'\n\npipedTable :: Table -&gt; Table\npipedTable t = t'\n    where\n        (m,t') = aux (m,zeroWidth) t\n            where\n                zeroWidth = take (length $ head t) $ repeat 0\n\nadjust :: Width -&gt; Row -&gt; Row\nadjust [] [] = []\nadjust (w:ws) (r:rs) = (r ++ s):(adjust ws rs)\n    where\n        s = take (w-(length r)) $ repeat ' '\n</code></pre>\n\n<p>When I load this module and try to feed some input to the function pipedTable \neg.</p>\n\n<pre><code>*Main&gt; pipedTable [[\"I\",\"am\"],[\"You\",\"look\"],[\"Fine\",\"I\"]]\n</code></pre>\n\n<p>it gives,</p>\n\n<pre><code>[*** Exception: pipedTable.hs:(6,1)-(12,26): Non-exhaustive patterns in function aux.\n</code></pre>\n\n<p>I do not understand where is the problem.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 1, "creation_date": 1442299757, "post_id": 32579133, "comment_id": 53013215, "body": "Have you looked at <a href=\"https://hackage.haskell.org/package/MaybeT-0.1.2/docs/Control-Monad-Maybe.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/MaybeT-0.1.2/docs/&hellip;</a> ? It gives an example of the Maybe transformer on IO."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1442300607, "post_id": 32579133, "comment_id": 53013670, "body": "You can have <code>MaybeT IO</code>, but not <code>IOT Maybe</code>, because <code>IO</code>, when present, must always be at the bottom of the monad stack."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442443094, "post_id": 32579133, "comment_id": 53090217, "body": "The identity monad is commonly used as a base for a monad transformer stack to use code written more generally in a simple context. If you have code that works for <code>ContT r (ExceptT e m) a</code> for any <code>m</code>, you can use it in a pure context by letting <code>m</code> be <code>Identity</code>. This sort of thing is done, for instance, in streaming libraries, to use effectful streaming code in a situation where no effects ate needed."}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442307401, "post_id": 32579560, "comment_id": 53017465, "body": "Many thanks AJ, &quot;we can forget about that extra monadic layer, and just treat it as a normal monad&quot; exactly this is what I would like to see, a simple example why using <code>MaybeT</code> would make life easier ? I don&#39;t really see where and how I should use <code>MaybeT . getDatabaseResult </code>, could you please give an example ? Something that I could run ?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1442330316, "post_id": 32579560, "comment_id": 53033291, "body": "There are plenty of very useful functions that mix IO and Maybe. <a href=\"https://www.haskell.org/hoogle/?hoogle=a+-%3EIO+(Maybe+b)\" rel=\"nofollow noreferrer\">Hoogle helps.</a>"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 8, "last_activity_date": 1442613335, "last_edit_date": 1442613335, "creation_date": 1442300070, "answer_id": 32579560, "question_id": 32579133, "link": "https://stackoverflow.com/questions/32579133/simplest-non-trivial-monad-transformer-example-for-dummies-iomaybe/32579560#32579560", "title": "Simplest non-trivial monad transformer example for &quot;dummies&quot;, IO+Maybe", "body": "<p>Sure, the <code>MaybeT</code> monad transformer is:</p>\n\n<pre><code>newtype MaybeT m a = MaybeT {unMaybeT :: m (Maybe a)}\n</code></pre>\n\n<p>We can implement its monad instance as so:</p>\n\n<pre><code>instance (Monad m) =&gt; Monad (MaybeT m) where\n    return a = MaybeT (return (Just a))\n\n    (MaybeT mmv) &gt;&gt;= f = MaybeT $ do\n        mv &lt;- mmv\n        case mv of\n            Nothing -&gt; return Nothing\n            Just a  -&gt; unMaybeT (f a)\n</code></pre>\n\n<p>This will allow us to perform IO with the option of failing gracefully in certain circumstances.</p>\n\n<p>For instance, imagine we had a function like this:</p>\n\n<pre><code>getDatabaseResult :: String -&gt; IO (Maybe String)\n</code></pre>\n\n<p>We can manipulate the monads independently with the result of that function, but if we compose it as so:</p>\n\n<pre><code>MaybeT . getDatabaseResult :: String -&gt; MaybeT IO String\n</code></pre>\n\n<p>We can forget about that extra monadic layer, and just treat it as a normal monad.</p>\n"}, {"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442307596, "post_id": 32579989, "comment_id": 53017594, "body": "Ahha, now I start to get it. I have to play around this in the evening and try to write some code using this. Many thanks. Almost perfect, in order to get an easy understand It would be good to see a simple example of actually using the <code>MaybeOverM</code> on something, anything, in action, in ghci. I will try to figure out in the evening how to do that, but if you could give me some guidance on that, that would be great."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442612389, "post_id": 32579989, "comment_id": 53169236, "body": "in your <code>betterBind</code>, shouldn&#39;t it be <code>betterBind mia mf = MaybeOverIO $ do ...</code>? -- it would also be nice if you could add those missing definitions for <code>return</code> and <code>lift</code>, too, for that specific <code>MaybeOverIO</code> type, to have it all in one place, to have one complete example."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1442614039, "post_id": 32579989, "comment_id": 53169817, "body": "(okay, so I went ahead and fixed it...)"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 13, "last_activity_date": 1442613996, "last_edit_date": 1442613996, "creation_date": 1442301541, "answer_id": 32579989, "question_id": 32579133, "link": "https://stackoverflow.com/questions/32579133/simplest-non-trivial-monad-transformer-example-for-dummies-iomaybe/32579989#32579989", "title": "Simplest non-trivial monad transformer example for &quot;dummies&quot;, IO+Maybe", "body": "<p>Suppose you have to work with <code>IO</code> values that \"may fail\" in some sense, like  <code>foo :: IO (Maybe a)</code>, <code>func1 :: a -&gt; IO (Maybe b)</code> and <code>func2 :: b -&gt; IO (Maybe c)</code>.</p>\n\n<p>Manually checking for the presence of errors in a chain of binds quickly produces the dreaded \"staircase of doom\":</p>\n\n<pre><code>do\n    ma &lt;- foo\n    case ma of\n        Nothing -&gt; return Nothing\n        Just a -&gt; do\n            mb &lt;- func1 a\n            case mb of\n                Nothing -&gt; return Nothing\n                Just b -&gt; func2 b\n</code></pre>\n\n<p>How to \"automate\" this in some way? Perhaps we could devise a newtype around <code>IO (Maybe a)</code> with a bind function that automatically checks if the first argument is a <code>Nothing</code> inside <code>IO</code>, saving us the trouble of checking it ourselves. Something like</p>\n\n<pre><code>newtype MaybeOverIO a = MaybeOverIO { runMaybeOverIO :: IO (Maybe a) }\n</code></pre>\n\n<p>With the bind function:</p>\n\n<pre><code>betterBind :: MaybeOverIO a -&gt; (a -&gt; MaybeOverIO b) -&gt; MaybeOverIO b\nbetterBind mia mf = MaybeOverIO $ do\n       ma &lt;- runMaybeOverIO mia\n       case ma of\n           Nothing -&gt; return Nothing\n           Just a  -&gt; runMaybeOverIO (mf a)\n</code></pre>\n\n<p>This works! And, looking at it more closely, we realize that we aren't using any particular functions exclusive to the <code>IO</code> monad. Generalizing the newtype a little, we could make this work for any underlying monad!</p>\n\n<pre><code>newtype MaybeOverM m a = MaybeOverM { runMaybeOverM :: m (Maybe a) }\n</code></pre>\n\n<p>And this is, in essence, how the <code>MaybeT</code> transformer <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/src/Control-Monad-Trans-Maybe.html#MaybeT\" rel=\"noreferrer\">works</a>. I have left out a few details, like how to implement <code>return</code> for the transformer, and how to \"lift\" <code>IO</code> values into <code>MaybeOverM IO</code> values.</p>\n\n<p>Notice that <code>MaybeOverIO</code> has kind <code>* -&gt; *</code> while <code>MaybeOverM</code> has kind <code>(* -&gt; *) -&gt; * -&gt; *</code> (because its first \"type argument\" is a monad type constructor, that itself requires a \"type argument\").</p>\n"}, {"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442326341, "post_id": 32582127, "comment_id": 53030275, "body": "What if <code>a</code> in <code>runMaybeT :: MaybeT IO a -&gt; IO a</code>  is not a  <code>Maybe b</code> type? Is that not a problem? For example in  <code>survey2 :: IO (Maybe (String,String))</code> ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442327143, "post_id": 32582127, "comment_id": 53030878, "body": "I think you spotted a errror - I&#39;ll fix it.  <code>runMaybeT</code> should result in the <code>IO (Maybe a)</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442329745, "post_id": 32582127, "comment_id": 53032890, "body": "So basically, the composite monad(<code>MaybeT IO a</code>)&#39;s  result is an &quot;Exception&quot; aka as <code>Nothing</code> (more precisely : <code>MaybeT (return Nothing)</code>) if anywhere in the sequence of <code>MaybeT IO a</code> monadic actions an &quot;Exception&quot; aka <code>mzero</code> is &quot;thrown&quot; aka appears. Do I understand correctly ? Then this &quot;Exception&quot; is manifested by executing the two monad runners and we finally get &quot;Nothing&quot;. Much Ado About Nothing."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442330417, "post_id": 32582127, "comment_id": 53033373, "body": "I&#39;ve created this gist: <a href=\"https://gist.github.com/jhegedus42/26917d2abded3e82f427\" rel=\"nofollow noreferrer\">gist.github.com/jhegedus42/26917d2abded3e82f427</a> so that this little perl of code is not lost :)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442330957, "post_id": 32582127, "comment_id": 53033719, "body": "Yes, the <code>mzero</code> can even appear in a &quot;subroutine&quot; and exit the runMaybeT block with Nothing - to cast it in more conventional programming terms. So another way of understanding <code>MaybeT IO a</code> is that it is a computation which can use IO and which either results in an exception (Nothing) or in a value of type a (Just ...)."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442331792, "post_id": 32582127, "comment_id": 53034277, "body": "Yeah, and <code>mzero</code>  corresponds to throwing the exception. Sort of like a special monadic action. This is the essence of this composite monad then. Very happy to learn this finally."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442332313, "post_id": 32582127, "comment_id": 53034642, "body": "Added another example of using MaybeT and mzero to write a conventional while loop."}, {"owner": {"reputation": 49420, "user_id": 19479, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8c3227175520ab65a0a24d75e3317150?s=128&d=identicon&r=PG", "display_name": "Steve B.", "link": "https://stackoverflow.com/users/19479/steve-b"}, "edited": false, "score": 3, "creation_date": 1491330577, "post_id": 32582127, "comment_id": 73501499, "body": "Thanks for taking the trouble to write a thorough and well-explained example. +1"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 93, "last_activity_date": 1478262648, "last_edit_date": 1478262648, "creation_date": 1442308324, "answer_id": 32582127, "question_id": 32579133, "link": "https://stackoverflow.com/questions/32579133/simplest-non-trivial-monad-transformer-example-for-dummies-iomaybe/32582127#32582127", "title": "Simplest non-trivial monad transformer example for &quot;dummies&quot;, IO+Maybe", "body": "<p>This is available <a href=\"http://lpaste.net/8735951286651846656\">here</a> as a .lhs file.</p>\n\n<p>The <code>MaybeT</code> transformer will allow us to break out of a monad computation much like throwing an exception.</p>\n\n<p>I'll first quickly go over some preliminaries. Skip down to <strong>Adding Maybe powers to IO</strong> for a worked example.</p>\n\n<p>First some imports:</p>\n\n<pre><code> import Control.Monad\n import Control.Monad.Trans\n import Control.Monad.Trans.Maybe\n</code></pre>\n\n<p>Rules of thumb:</p>\n\n<blockquote>\n  <p>In a monad stack IO is always on the bottom.</p>\n</blockquote>\n\n<p>Other IO-like monads will also, as a rule, always appear on the bottom, e.g. the state transformer monad <code>ST</code>.</p>\n\n<blockquote>\n  <p><code>MaybeT m</code> is a new monad type which adds the power of the Maybe monad to the monad <code>m</code> - e.g. <code>MaybeT IO</code>.</p>\n</blockquote>\n\n<p>We'll get into what that power is later. For now, get used to thinking of <code>MaybeT IO</code> as the maybe+IO monad stack.</p>\n\n<blockquote>\n  <p>Just like <code>IO Int</code> is a monad expression returning an <code>Int</code>, <code>MaybeT IO Int</code> is a <code>MaybeT IO</code> expression returning an <code>Int</code>.</p>\n</blockquote>\n\n<p>Getting used to reading compound type signatures is half the battle to understanding monad transformers.</p>\n\n<blockquote>\n  <p>Every expression in a <code>do</code> block must be from the same monad.</p>\n</blockquote>\n\n<p>I.e. this works because each statement is in the IO-monad:</p>\n\n<pre><code> greet :: IO ()                               -- type:\n greet = do putStr \"What is your name? \"      -- IO ()\n            n &lt;- getLine                      -- IO String\n            putStrLn $ \"Hello, \" ++ n         -- IO ()\n</code></pre>\n\n<p>This will not work because <code>putStr</code> is not in the <code>MaybeT IO</code> monad:</p>\n\n<pre><code>mgreet :: MaybeT IO ()\nmgreet = do putStr \"What is your name? \"    -- IO monad - need MaybeT IO here\n            ...\n</code></pre>\n\n<p>Fortunately there is a way to fix this.</p>\n\n<blockquote>\n  <p>To transform an <code>IO</code> expression into a <code>MaybeT IO</code> expression use <code>liftIO</code>.</p>\n</blockquote>\n\n<p><code>liftIO</code> is polymorphic, but in our case it has the type:</p>\n\n<pre><code>liftIO :: IO a -&gt; MaybeT IO a\n\n mgreet :: MaybeT IO ()                             -- types:\n mgreet = do liftIO $ putStr \"What is your name? \"  -- MaybeT IO ()\n             n &lt;- liftIO getLine                    -- MaybeT IO String\n             liftIO $ putStrLn $ \"Hello, \" ++ n     -- MaybeT IO ()\n</code></pre>\n\n<p>Now all of the statement in <code>mgreet</code> are from the <code>MaybeT IO</code> monad.</p>\n\n<blockquote>\n  <p>Every monad transformer has a \"run\" function.</p>\n</blockquote>\n\n<p>The run function \"runs\" the top-most layer of a monad stack returning\na value from the inside layer.</p>\n\n<p>For <code>MaybeT IO</code>, the run function is:</p>\n\n<pre><code>runMaybeT :: MaybeT IO a -&gt; IO (Maybe a)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>ghci&gt; :t runMaybeT mgreet \nmgreet :: IO (Maybe ())\n\nghci&gt; runMaybeT mgreet\nWhat is your name? user5402\nHello, user5402\nJust ()\n</code></pre>\n\n<p>Also try running: </p>\n\n<pre><code>runMaybeT (forever mgreet)\n</code></pre>\n\n<p>You'll need to use Ctrl-C to break out of the loop.</p>\n\n<p>So far <code>mgreet</code> doesn't do anything more than what we could do in IO.\nNow we'll work on an example which demonstrates the power of mixing \nthe Maybe monad with IO.</p>\n\n<h1>Adding Maybe powers to IO</h1>\n\n<p>We'll start with a program which asks some questions:</p>\n\n<pre><code> askfor :: String -&gt; IO String\n askfor prompt = do\n   putStr $ \"What is your \" ++ prompt ++ \"? \"\n   getLine\n\n survey :: IO (String,String)\n survey = do n &lt;- askfor \"name\"\n             c &lt;- askfor \"favorite color\"\n             return (n,c)\n</code></pre>\n\n<p>Now suppose we want to give the user the ability to end the survey\nearly by typing END in response to a question. We might handle it\nthis way:</p>\n\n<pre><code> askfor1 :: String -&gt; IO (Maybe String)\n askfor1 prompt = do\n   putStr $ \"What is your \" ++ prompt ++ \" (type END to quit)? \"\n   r &lt;- getLine\n   if r == \"END\"\n     then return Nothing\n     else return (Just r)\n\n survey1 :: IO (Maybe (String, String))\n survey1 = do\n   ma &lt;- askfor1 \"name\"\n   case ma of\n     Nothing -&gt; return Nothing\n     Just n  -&gt; do mc &lt;- askfor1 \"favorite color\"\n                   case mc of\n                     Nothing -&gt; return Nothing\n                     Just c  -&gt; return (Just (n,c))\n</code></pre>\n\n<p>The problem is that <code>survey1</code> has the familiar staircasing issue which\ndoesn't scale if we add more questions.</p>\n\n<p>We can use the MaybeT monad transformer to help us here.</p>\n\n<pre><code> askfor2 :: String -&gt; MaybeT IO String\n askfor2 prompt = do\n   liftIO $ putStr $ \"What is your \" ++ prompt ++ \" (type END to quit)? \"\n   r &lt;- liftIO getLine\n   if r == \"END\"\n     then MaybeT (return Nothing)    -- has type: MaybeT IO String\n     else MaybeT (return (Just r))   -- has type: MaybeT IO String\n</code></pre>\n\n<p>Note how all of the statemens in <code>askfor2</code> have the same monad type.</p>\n\n<p>We've used a new function:</p>\n\n<pre><code>MaybeT :: IO (Maybe a) -&gt; MaybeT IO a\n</code></pre>\n\n<p>Here is how the types work out:</p>\n\n<pre><code>                  Nothing     :: Maybe String\n           return Nothing     :: IO (Maybe String)\n   MaybeT (return Nothing)    :: MaybeT IO String\n\n                 Just \"foo\"   :: Maybe String\n         return (Just \"foo\")  :: IO (Maybe String)\n MaybeT (return (Just \"foo\")) :: MaybeT IO String\n</code></pre>\n\n<p>Here <code>return</code> is from the IO-monad.</p>\n\n<p>Now we can write our survey function like this:</p>\n\n<pre><code> survey2 :: IO (Maybe (String,String))\n survey2 =\n   runMaybeT $ do a &lt;- askfor2 \"name\"\n                  b &lt;- askfor2 \"favorite color\"\n                  return (a,b)\n</code></pre>\n\n<p>Try running <code>survey2</code> and ending the questions early by typing END as a response to either question.</p>\n\n<h1>Short-cuts</h1>\n\n<p>I know I'll get comments from people if I don't mention the following short-cuts.</p>\n\n<p>The expression:</p>\n\n<pre><code>MaybeT (return (Just r))    -- return is from the IO monad\n</code></pre>\n\n<p>may also be written simply as:</p>\n\n<pre><code>return r                    -- return is from the MaybeT IO monad\n</code></pre>\n\n<p>Also, another way of writing <code>MaybeT (return Nothing)</code> is:</p>\n\n<pre><code>mzero\n</code></pre>\n\n<p>Furthermore, two consecutive <code>liftIO</code> statements may always combined into a single <code>liftIO</code>, e.g.:</p>\n\n<pre><code>do liftIO $ statement1\n   liftIO $ statement2 \n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>liftIO $ do statement1\n            statement2\n</code></pre>\n\n<p>With these changes our <code>askfor2</code> function may be written:</p>\n\n<pre><code>askfor2 prompt = do\n  r &lt;- liftIO $ do\n         putStr $ \"What is your \" ++ prompt ++ \" (type END to quit)?\"\n         getLine\n  if r == \"END\"\n    then mzero      -- break out of the monad\n    else return r   -- continue, returning r\n</code></pre>\n\n<p>In a sense, <code>mzero</code> becomes a way of breaking out of the monad - like throwing an exception.</p>\n\n<h1>Another example</h1>\n\n<p>Consider this simple password asking loop:</p>\n\n<pre><code>loop1 = do putStr \"Password:\"\n           p &lt;- getLine\n           if p == \"SECRET\"\n             then return ()\n             else loop1\n</code></pre>\n\n<p>This is a (tail) recursive function and works just fine.</p>\n\n<p>In a conventional language we might write this as a infinite while loop with a break statement:</p>\n\n<pre><code>def loop():\n    while True:\n        p = raw_prompt(\"Password: \")\n        if p == \"SECRET\":\n            break\n</code></pre>\n\n<p>With MaybeT we can write the loop in the same manner as the Python code:</p>\n\n<pre><code>loop2 :: IO (Maybe ())\nloop2 = runMaybeT $\n          forever $\n            do liftIO $ putStr \"Password: \"\n               p &lt;- liftIO $ getLine\n               if p == \"SECRET\"\n                 then mzero           -- break out of the loop\n                 else return ()\n</code></pre>\n\n<p>The last <code>return ()</code> continues execution, and since we are in a <code>forever</code> loop, control passes back to the top of the do block. Note that the only value that <code>loop2</code> can return is <code>Nothing</code> which corresponds to breaking out of the loop.</p>\n\n<p>Depending on the situation you might find it easier to write <code>loop2</code> rather than the recursive <code>loop1</code>.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6925, "favorite_count": 30, "accepted_answer_id": 32582127, "answer_count": 3, "score": 46, "last_activity_date": 1478262648, "creation_date": 1442298518, "last_edit_date": 1442302170, "question_id": 32579133, "link": "https://stackoverflow.com/questions/32579133/simplest-non-trivial-monad-transformer-example-for-dummies-iomaybe", "title": "Simplest non-trivial monad transformer example for &quot;dummies&quot;, IO+Maybe", "body": "<p>Could someone give a super simple (few lines) monad transformer example, which is non-trivial (i.e. not using the Identity monad - that I understand).</p>\n\n<p>For example, how would someone create a monad that does IO and can handle failure (Maybe)? </p>\n\n<p>What would be the simplest example that would demonstrate this?</p>\n\n<p>I have skimmed through a few monad transformer tutorials and they all seem to use State Monad or Parsers or something complicated (for a newbee). I would like to see something simpler than that. I think IO+Maybe would be simple, but I don't really know how to do that myself.</p>\n\n<p>How could I use an IO+Maybe monad stack?\nWhat would be on top? What would be on bottom? Why?</p>\n\n<p>In what kind of use case would one want to use the IO+Maybe monad or the Maybe+IO monad? Would that make sense to create such a composite monad at all? If yes, when, and why?</p>\n"}, {"tags": ["haskell", "monads", "yesod", "persistent"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1442340798, "post_id": 32577814, "comment_id": 53039363, "body": "This is a bit hard to understand. What would you expect/like to be retured from the last items query? Something like all items belonging to a given list authored by a given user?"}, {"owner": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1442346674, "post_id": 32577814, "comment_id": 53042534, "body": "select * from items where item_list_id == &lt;list_id&gt; and user_id = &lt;user_lists id&gt;;  Does that make any more sense?  All I&#39;m really trying to do is run one query based off of two previous queries in the same do block."}], "owner": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1442291882, "creation_date": 1442291882, "question_id": 32577814, "link": "https://stackoverflow.com/questions/32577814/haskell-persistent-one-to-many-query", "title": "Haskell persistent one to many query", "body": "<p>While using Persistent in Yesod I was thinking about how the monad do notation chains off of the previous value:</p>\n\n<pre><code>getListR :: ListId -&gt; Handler Html\ngetListR listId =  do\n  list &lt;- runDB $ get404 listId\n  items &lt;- runDB $ selectList [ItemListId ==. listId] [Desc ItemId]\n  defaultLayout $ do\n    $(widgetFile \"list\")\n</code></pre>\n\n<p>Rather than accepting a (listId list) of type (Key List) in the filter it accepts listId of type List -> Key List and just chains. Does this mean I can only pass queried values to selectList via the previous query? How does this work if I need to filter based off of multiple past queries? </p>\n\n<p>For example I'm thinking to this effect:</p>\n\n<pre><code>getListR :: ListId -&gt; UserId -&gt; Handler Html\ngetListR listId userId =  do\n  list &lt;- runDB $ get404 listId\n  user_lists &lt;- runDB $ selectList [UserId ==. userId] [Desc UserListsId]\n  items &lt;- runDB $ selectList [ItemListId ==. listId list, UserId ==. userId user_lists] [Desc ItemId]\n  defaultLayout $ do\n    $(widgetFile \"list\")\n</code></pre>\n\n<p>Is this even possible? Thank you for any help!</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 1978, "user_id": 3100352, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Cgkdf.png?s=128&g=1", "display_name": "Tiago Marinho", "link": "https://stackoverflow.com/users/3100352/tiago-marinho"}, "edited": false, "score": 1, "creation_date": 1442286243, "post_id": 32577005, "comment_id": 53008935, "body": "<a href=\"http://codereview.stackexchange.com\">codereview.stackexchange.com</a> is a better place to ask for reviews of code that&#39;s already working."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 1978, "user_id": 3100352, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Cgkdf.png?s=128&g=1", "display_name": "Tiago Marinho", "link": "https://stackoverflow.com/users/3100352/tiago-marinho"}, "edited": false, "score": 0, "creation_date": 1442286298, "post_id": 32577005, "comment_id": 53008953, "body": "Thanks for the information."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1442286442, "post_id": 32577005, "comment_id": 53008980, "body": "(Perhaps you can simply <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">memoize</a> <code>main</code>.)"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1442287499, "post_id": 32577005, "comment_id": 53009227, "body": "@Mauris In fact I have used memo1, which I omit to show because it turned out not very useful in this case: there was not much difference. Or are you suggesting I use some sort of memo_n to recursively memorise it??"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442290740, "post_id": 32577005, "comment_id": 53009959, "body": "Two possible explanations: the coefficients grow in complexity so quickly as to outweigh the cost of recomputing earlier coefficients, or you did the memoization wrong (not hard to do)."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442303230, "post_id": 32577005, "comment_id": 53015145, "body": "@ReidBarton After I tried Daniel&#39;s answer, the code does generate results fast enough, so I think I might have &quot;memorised&quot; the function wrongly."}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1442303325, "post_id": 32578234, "comment_id": 53015189, "body": "Thanks for the answer: this is the first time I heard of inits and its use. Thanks for this great answer then! :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1442294342, "creation_date": 1442294342, "answer_id": 32578234, "question_id": 32577005, "link": "https://stackoverflow.com/questions/32577005/a-more-haskellian-way-to-write-this-recursion/32578234#32578234", "title": "A more haskellian way to write this recursion?", "body": "<p>The meat of the function looks like this:</p>\n\n<pre><code>main 0 = 0\nmain n = f [main n' | n' &lt;- [0..n-1]]\n</code></pre>\n\n<p>You've told us a little bit about <code>f</code>, but not really enough to do much with <code>f</code> itself. Even so, as you say we can memoize some stuff by attacking the recursive calls:</p>\n\n<pre><code>mains = 0 : map f (inits mains)\nmain = (mains!!)\n</code></pre>\n\n<p>In fact, in your code, your specialization of <code>f</code> happens to never look at the head of the list it's provided (and you internalize this by computing <code>[1..n-1]</code> instead of <code>[0..n-1]</code>). We can push this concern through into <code>mains</code>, if we like, by:</p>\n\n<pre><code>mains = 0 : map (f' . drop 1) (inits mains)\n-- corresponds to the specification:\n-- main 0 = 0\n-- main n = f' [main n' | n' &lt;- [1..n-1]]\n</code></pre>\n\n<p>Though I think it may actually be cleaner to leave that to <code>f</code>.</p>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 32578234, "answer_count": 1, "score": 1, "last_activity_date": 1442294342, "creation_date": 1442285919, "question_id": 32577005, "link": "https://stackoverflow.com/questions/32577005/a-more-haskellian-way-to-write-this-recursion", "title": "A more haskellian way to write this recursion?", "body": "<p>I wrote a code to compute the coefficients of the quotient of two infinite series, using reduction, as follows:</p>\n\n<pre><code>main :: Int -&gt; PInt\nmain 0 = 0\nmain n = cancel x3\n    where\n    x1 = someOtherFunction\n    x2 = expression involving x1\n    x3 = x2 - (foldr \n        (\\y z -&gt; z + (someOtherFunction y) * (main (n - y))) 0 [1..(n - 1)])\n</code></pre>\n\n<p>(I have defined a data called PInt, which is an instance of Num and Fractional, and there is an auxiliary function \"cancel\" to perform a reduction.) My problem is the expression in the fold in x3: it seems not very efficient, as it has to calculate every main k for lower values of k.</p>\n\n<p>I am thinking maybe I can use an implementation such as </p>\n\n<pre><code>fib = 1 : 1 : zipWith (+) fib (tail fib)\n</code></pre>\n\n<p>for fibonacci numbers to calculate the recursion above, which is more efficient. Unfortunately I have no clue as to where to start.</p>\n\n<p>Thanks for any help in advance.</p>\n\n<p>P.S. The code takes a significant amount of time to compute the value at 20, which behavior seems to imply the exponential growth of time?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1442303276, "post_id": 32576983, "comment_id": 53015163, "body": "In Haskell, when you say things like &quot;so fast&quot;, you sort of have to qualify what you mean.  <i>evaluating</i> <code>fibs</code> is not &quot;fast&quot;...it literally takes an infinite amount of time!  It&#39;ll never end.  evaluating a specific item in the list, that&#39;s something you can talk about.  in this case you can manually expand <code>fibs</code> out to the index you want, and see what evaluations are necessary to evaluate it."}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1442320793, "post_id": 32576983, "comment_id": 53026221, "body": "I meant it grows fast in Big-O. I did manually expand it in my example. That wouldn&#39;t have helped because as the answers seems to clarify below, the compiler is smart enough to not recompute fibs from start."}], "answers": [{"comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 1, "creation_date": 1442320533, "post_id": 32577196, "comment_id": 53026041, "body": "Then it sounds like the compiler is smart enough to reuse the existing list it&#39;s building instead of starting all over like I&#39;m doing it when I expand manually."}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": true, "score": 8, "last_activity_date": 1442287539, "creation_date": 1442287539, "answer_id": 32577196, "question_id": 32576983, "link": "https://stackoverflow.com/questions/32576983/big-0-of-fibonacci-number-using-scanl-haskell/32577196#32577196", "title": "Big 0 of fibonacci number using scanl Haskell", "body": "<p>The definition of <code>scanl</code> is (almost equivalent to):</p>\n\n<pre><code>scanl           :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\nscanl f q ls    = q : (case ls of\n                           []   -&gt; []\n                           x:xs -&gt; scanl f (f q x) xs)\n</code></pre>\n\n<p>So <code>fibs</code> expands to:</p>\n\n<pre><code>  fibs\n= 1 : scanl (+) 1 fibs\n</code></pre>\n\n<p>We've computed the head of <code>fibs</code> in memory, so <code>scanl</code> knows its <code>x</code> -- a <code>1</code>. Then <code>f q x</code> is <code>1 + 1 = 2</code>:</p>\n\n<pre><code>= 1 : (1 : scanl (+) 2 (tail fibs))\n</code></pre>\n\n<p>Now, we have computed the head of <code>tail fibs</code> in memory, so <code>scanl</code> can fetch another <code>x</code> -- the second <code>1</code>. Then <code>f q x</code> is <code>1 + 2 = 3</code>:</p>\n\n<pre><code>= 1 : (1 : (2 : scanl (+) 3 (tail $ tail fibs)))\n</code></pre>\n\n<p>The <code>2</code> we've just added to the list is simultaneously the head of the list <code>scanl</code> is accumulating down (currently <code>tail $ tail fibs</code>) -- we can retrieve it instantly!</p>\n\n<p>The trick is that the computation of <code>fibs</code> doesn't restart from the first <code>1</code>. Instead, <code>scanl</code> can look down the very list it's used in, and find the values it needs just in time! (I write <code>tail $ tail fibs</code> etc., but as we step through the computation, nowhere does <code>scanl</code> need to access the entirety of <code>fibs</code> \"from the top\" -- in the recursive call the head is simply chopped off, and the tail conveniently starts at the value we just calculated, which is now ready to use immediately in the next step.)</p>\n"}], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 32577196, "answer_count": 1, "score": 3, "last_activity_date": 1442320859, "creation_date": 1442285751, "last_edit_date": 1442320859, "question_id": 32576983, "link": "https://stackoverflow.com/questions/32576983/big-0-of-fibonacci-number-using-scanl-haskell", "title": "Big 0 of fibonacci number using scanl Haskell", "body": "<p>I'm trying to understand how a list that computes fibonacci is so fast in haskell.</p>\n\n<p>The list definition is</p>\n\n<pre><code>fibs = 1 : scanl (+) 1 fibs\n\n 1 :: (1: scanl (+) 1 fibs) !! 0\n:1 :: (1: scanl (+) 1 fibs) !! 1\n:1+(1 :: (1: scanl (+) 1 (1: scanl (+) 1 fibs)!!0)!!2\n:2+(1 :: (1: scanl (+) 1 (1: scanl (+) 1 fibs))!!1)!!3\n:3+(2 :: (1: scanl (+) 1 (1: scanl (+) 1 (1: scanl (+) 1 fibs)!!0)!!2)!!4\n:5+(3 :: (1: scanl (+) 1 (1: scanl (+) 1 (1: scanl (+) 1 fibs)!!1)!!3)!!5\n:8+(5 :: (1: scanl (+) 1 (1: scanl (+) 1 (1: scanl (+) 1 (1: scanl (+) 1 fibs)!!0)!!2)!!4)!!6\n</code></pre>\n\n<p>This is the best way I know how to expand the list definition in a way that gets my question across.</p>\n\n<p>So my question is why does this list expand so fast?\nI'm very hazy on how to calculate big-O these days but intuitively the way I expand it, it seems that the stack would grow astronomically huge with the way the function keeps expanding for each iteration of the fibonacci sequence. In fact, it looks to me that for every 3 numbers a new sub fibonacci sequence is created.</p>\n\n<p>Yet, when I run the function it is very fast.\nWiki says it is an O(n) function.\n<a href=\"https://wiki.haskell.org/The_Fibonacci_sequence#With_scanl\" rel=\"nofollow\">https://wiki.haskell.org/The_Fibonacci_sequence#With_scanl</a></p>\n\n<p>Is it that the compiler is doing special tricks so that it doesn't stupidly keep expanding the function like I do by hand?</p>\n\n<p>Also, is there a special name for this type of recursion? I guess it's some type of tail-recursion, but I feel very fuzzy about this function.</p>\n"}, {"tags": ["haskell", "category-theory", "type-theory"], "answers": [{"comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1442300202, "post_id": 32578222, "comment_id": 53013454, "body": "Ahh, I had thought of using currying to get <code>((a, b) -&gt; c)</code>, but not of switching the order of arguments, somehow -- that did the trick!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1442306617, "post_id": 32578222, "comment_id": 53016959, "body": "You can also take <code>f</code> to be the covariant hom-functor instead of <code>Id</code>: <code>(a -&gt; b -&gt; c) -&gt; b -&gt; c</code> ~ <code>((a, b) -&gt; c) -&gt; (-&gt;) b c</code> ~ <code>b -&gt; (a, b)</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442881654, "post_id": 32578222, "comment_id": 53256509, "body": "could you please fully parenthesize the <code>forall b a. (b -&gt; a) -&gt; b -&gt; forall c. (a -&gt; b -&gt; c) -&gt; c</code> type, for the scope of each <code>forall</code> to be explicitly seen?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442919178, "post_id": 32578222, "comment_id": 53272133, "body": "@WillNess the scope extends to the far right, in the same way as lambda abstraction: <code>\\a b -&gt; .... \\c -&gt; ...</code>."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 14, "last_activity_date": 1442303857, "last_edit_date": 1442303857, "creation_date": 1442294286, "answer_id": 32578222, "question_id": 32576956, "link": "https://stackoverflow.com/questions/32576956/how-do-i-show-that-a-haskell-type-is-inhabited-by-one-and-only-one-function/32578222#32578222", "title": "How do I show that a Haskell type is inhabited by one and only one function?", "body": "<p>You can apply <a href=\"https://en.wikipedia.org/wiki/Sequent_calculus\">sequent calculus</a>.</p>\n\n<p>Short example, with type <code>a -&gt; a</code>, we could construct term like: <code>\\x -&gt; (\\y -&gt; y) x</code>, but that still normalises to <code>\\x -&gt; x</code> which is <code>id</code>. In sequent calculus the system prohibites from constructing \"reducable\" proofs.</p>\n\n<p>Your type is <code>(b -&gt; a) -&gt; (a -&gt; b -&gt; c) -&gt; b -&gt; c</code>, informally:</p>\n\n<pre><code>f: b -&gt; a\ng: a -&gt; b -&gt; c\nx: b\n--------------\nGoal: c\n</code></pre>\n\n<p>And there aren't many ways to proceed:</p>\n\n<pre><code>apply g\n\nf: b -&gt; a\ng: a -&gt; b -&gt; c\nx: b\n---------------\nSubgoal0: a\nSubgoal1: b\n\n\napply f\n\nf: b -&gt; a\ng: a -&gt; b -&gt; c\nx: b\n---------------\nSubgoal0': b\nSubgoal1: b\n\n\n-- For both\napply x\n</code></pre>\n\n<p>So in the end, seems that <code>g (f x) x</code> is the only inhabitant of that type.</p>\n\n<hr>\n\n<p>Yoneda lemma approach, have to be careful to actually have <code>forall x</code>!</p>\n\n<pre><code> (b -&gt; a) -&gt; (a -&gt; b -&gt; c) -&gt; b -&gt; c\n forall b a. (b -&gt; a) -&gt; b -&gt; forall c. (a -&gt; b -&gt; c) -&gt; c\n</code></pre>\n\n<p>Let concentrate on the end:</p>\n\n<pre><code> (a -&gt; b -&gt; c) -&gt; c ~ ((a,b) -&gt; c) -&gt; c\n</code></pre>\n\n<p>That is isomorphic to <code>(a, b)</code>, so whole type reduces to</p>\n\n<pre><code>(b -&gt; a) -&gt; b -&gt; (a, b)\n</code></pre>\n\n<p>Take <code>f = Compose (Reader b) (,b)</code></p>\n\n<pre><code>(b -&gt; a) -&gt; f a ~ f b ~ b -&gt; (b,b)\n</code></pre>\n\n<p>And that is unique by taking <code>HP a = (a,a)</code> functor:</p>\n\n<pre><code>b -&gt; (b,b) ~ (() -&gt; b) -&gt; HP b ~ HP () ~ ()\n</code></pre>\n\n<hr>\n\n<p><em>EDIT</em> the first approach feels a bit more hand-wavy, but feels somehow more direct: Given the restricted set of rules, how the proof can be constructed, how many proofs we can construct?</p>\n"}], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 8, "accepted_answer_id": 32578222, "answer_count": 1, "score": 16, "last_activity_date": 1442870798, "creation_date": 1442285602, "last_edit_date": 1592644375, "question_id": 32576956, "link": "https://stackoverflow.com/questions/32576956/how-do-i-show-that-a-haskell-type-is-inhabited-by-one-and-only-one-function", "title": "How do I show that a Haskell type is inhabited by one and only one function?", "body": "<p>In <a href=\"https://stackoverflow.com/a/12230918/257418\">this answer</a>, Gabriel Gonzalez shows how to show that <code>id</code> is the only inhabitant of <code>forall a. a -&gt; a</code>. To do so (in the most formal iteration of the proof), he shows that the type is isomorphic to <code>()</code> using the <a href=\"https://en.wikipedia.org/wiki/Yoneda_lemma\" rel=\"noreferrer\">Yoneda lemma</a>, and since <code>()</code> has only one value in it, so must the type of <code>id</code>. Summarized, his proof is like this:</p>\n<blockquote>\n<p>Yoneda says:</p>\n<pre><code>Functor f =&gt; (forall b . (a -&gt; b) -&gt; f b) ~ f a\n</code></pre>\n<p>If <code>a = ()</code> and <code>f = Identity</code>, this becomes:</p>\n<pre><code>(forall b. (() -&gt; b) -&gt; b) ~ ()\n</code></pre>\n<p>And since trivially <code>() -&gt; b ~ b</code>, the LHS is basically the type of <code>id</code>.</p>\n</blockquote>\n<p>This feels like a bit of a &quot;magic trick&quot; that works well for <code>id</code>. I'm trying to do the same thing for a more complex function type:</p>\n<pre><code>(b -&gt; a) -&gt; (a -&gt; b -&gt; c) -&gt; b -&gt; c\n</code></pre>\n<p>but I have no idea where to start. I know it is inhabited by <code>\\f g x = g (f x) x</code>, and if you ignore ugly <code>\u22a5</code>/<code>undefined</code> stuff, I'm pretty sure there are no other functions of this type.</p>\n<p>I don't think Gabriel's trick will <em>immediately</em> apply here whichever way I pick the types. Are there other approaches (that are equally formal!) with which I can show the isomorphism between this type and <code>()</code>?</p>\n"}, {"tags": ["list", "function", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 1, "creation_date": 1442284170, "post_id": 32576757, "comment_id": 53008430, "body": "That&#39;s it! Thank you! I used tupleNums tupleNumList = zip [1..] tupleNumList"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1442283993, "creation_date": 1442283993, "answer_id": 32576757, "question_id": 32576645, "link": "https://stackoverflow.com/questions/32576645/haskell-using-tuples-and-preexisting-nested-lists/32576757#32576757", "title": "Haskell: Using Tuples and preexisting nested lists", "body": "<p>Hint 1: You can generate an infinite list of integer numbers with the following syntax:</p>\n\n<pre><code>[1..]\n</code></pre>\n\n<p>Hint 2: There is a function called <code>zip</code> with a very suggestive type:</p>\n\n<pre><code>zip :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 32576757, "answer_count": 1, "score": 0, "last_activity_date": 1443551028, "creation_date": 1442283127, "last_edit_date": 1443551028, "question_id": 32576645, "link": "https://stackoverflow.com/questions/32576645/haskell-using-tuples-and-preexisting-nested-lists", "title": "Haskell: Using Tuples and preexisting nested lists", "body": "<p>So far I have these two functions:</p>\n\n<pre><code>splitLines :: String -&gt; [[String]]\nsplitLines splitLinesStr = splitWords (lines splitLinesStr)\n\nsplitWords :: [String] -&gt; [[String]]\nsplitWords splitWordStr = map words splitWordStr\n</code></pre>\n\n<p>Both work to aid in completing step 1-3. However I do not know how to how to create a tuple of an int and a list within a list (as stated by step 4). How would one go about doing this?</p>\n\n<hr>\n\n<p>stage 1: the original input, for example,</p>\n\n<pre><code>\"a&amp;b b c.\\na dd\\n\"\n</code></pre>\n\n<p>stage 2: the original input, split into a list of lines, as in</p>\n\n<pre><code>[\"a&amp;b b c.\", \"a dd\"]\n</code></pre>\n\n<p>stage 3: the list of lines, split further into a list of list of words, as in</p>\n\n<pre><code>[[\"a\", \"b\", \"b\", \"c\"], [\"a\", \"dd\"]]\n</code></pre>\n\n<p>stage 4: the list of lists, \"tupled\" so that line numbers are attached to them, as in </p>\n\n<pre><code>[(1,[\"a\", \"b\", \"b\", \"c\"]), (2,[\"a\", \"dd\"])]\n</code></pre>\n\n<p>stage 5: the list of words (all at the top level) where each is paired with its line number, as in</p>\n\n<pre><code>[(1,\"a\"), (1,\"b\"), (1,\"b\"), (1,\"c\"), (2,\"a\"), (2,\"dd\")]\n</code></pre>\n"}, {"tags": ["haskell", "data-structures"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 5, "creation_date": 1442280807, "post_id": 32576173, "comment_id": 53007577, "body": "<code>repeat 1</code> is an example of a lazy spine and strict leaves."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442289091, "post_id": 32576173, "comment_id": 53009546, "body": "I&#39;m guessing the author just meant something like <code>data List a = Empty | Cons !a (List a)</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442434911, "post_id": 32576173, "comment_id": 53086637, "body": "@user5402 What about <code>repeat (1 + 3)</code> ? I guess it has lazy spine and lazy leaf then ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1442440240, "post_id": 32576173, "comment_id": 53089228, "body": "Perhaps. Note if <code>1+3</code> is not polymorphic then GHC may decide to evaluate it itself. How about this: <code>repeat undefined</code>.  This program will run without throwing an exception: <code>print $ length $ take 10 $ repeat undefined</code>. If you don&#39;t like <code>undefined</code>, you can substitute <code>repeat (error &quot;boo!&quot;)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1442281167, "last_edit_date": 1442281167, "creation_date": 1442280812, "answer_id": 32576306, "question_id": 32576173, "link": "https://stackoverflow.com/questions/32576173/example-of-a-data-structure-with-lazy-spine-and-strict-leaves/32576306#32576306", "title": "Example of a data structure with lazy spine and strict leaves", "body": "<p>\"Lazy in the spine, strict in the leaves\" is a property of the <em>API</em>, not (just) a property of the data structure. Here's an example of how it might look for lists:</p>\n\n<pre><code>module StrictList (StrictList, runStrictList, nil, cons, uncons, repeat) where\n\nnewtype StrictList a = StrictList { runStrictList :: [a] }\n\nnil :: StrictList a\nnil = StrictList []\n\ncons :: a -&gt; StrictList a -&gt; StrictList a\ncons x (StrictList xs) = x `seq` StrictList (x:xs)\n\nuncons :: StrictList a -&gt; Maybe (a, StrictList a)\nuncons (StrictList []) = Nothing\nuncons (StrictList (x:xs)) = Just (x, StrictList xs)\n\nrepeat :: a -&gt; StrictList a\nrepeat x = x `seq` StrictList (let xs = x:xs in xs)\n</code></pre>\n\n<p>Note that compared to built-in lists, this API is a quite impoverished -- that's just to keep the illustration small, not for a fundamental reason. The key point here is that you can still support things like <code>repeat</code>, where the spine is necessarily lazy (it's infinite!) but all the leaves are evaluated before anything else happens. Many of the other list operations that can produce infinite lists can be adapted to leaf-strict versions (though not all, as you observe).</p>\n\n<p>You should also notice that it is not necessarily possible to take a leaf-lazy, spine-lazy structure and turn it into a leaf-strict, spine-lazy one in a natural way; e.g. one could not write a generic <code>fromList :: [a] -&gt; StrictList a</code> such that:</p>\n\n<ul>\n<li><code>fromList (repeat x) = repeat x</code> and</li>\n<li><code>runStrictList (fromList xs) = xs</code> for all finite-length <code>xs</code>.</li>\n</ul>\n\n<p>(Forgive my punning, I'm a <code>repeat</code> offender).</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1442291105, "post_id": 32577309, "comment_id": 53010046, "body": "first let me say: very good remark/answer - thanks! But while you said when a function is <b>strict</b> you did not say when a structure is - maybe you should add this? // OT: IMO this stuff is almost as <i>crazy</i> (commonly misunderstood) as the weak vs. strong typing <i>definition</i> (which AFAIK does not exist) - for example <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy#Normal_order\" rel=\"nofollow noreferrer\">wikipedia</a> gives <i>strict</i> not only for the semantics but also to differentiate between the major evaluation strategies and I think most programmers get this too (fewer know about the semantics stuff)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1442288424, "creation_date": 1442288424, "answer_id": 32577309, "question_id": 32576173, "link": "https://stackoverflow.com/questions/32576173/example-of-a-data-structure-with-lazy-spine-and-strict-leaves/32577309#32577309", "title": "Example of a data structure with lazy spine and strict leaves", "body": "<p>This bit of advice mixes up two related, but distinct, ideas. Haskell programmers are often sloppy about the distinction, but it matters here.</p>\n\n<h3>Strict vs. non-strict</h3>\n\n<p>This is a semantic distinction. A function <code>f</code> is <em>strict</em> if <code>f _|_ = _|_</code>, and non-strict otherwise.</p>\n\n<h3>Eager (call by value) vs. lazy (call by need)</h3>\n\n<p>This is a matter of implementation, and can have major performance implications. Lazy evaluation is one way to implement non-strict semantics.</p>\n\n<h3>What the claim really means</h3>\n\n<p>It actually means that the data structure should be <em>strict</em> and <em>lazy</em>. The right amount of laziness in the spine of a data structure can be very helpful. Sometimes it gives asymptotic improvements in performance. It can also improve cache utilization and cut garbage collection costs. On the other hand, too much laziness (even in the spine, in some cases!) can lead to a harmful accumulation of deferred computations. From an API standpoint, it can be very helpful to ensure that insertion operations are eager (and therefore strict), so that you know that everything stored in the structure has been forced.</p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 4, "accepted_answer_id": 32576306, "answer_count": 2, "score": 6, "last_activity_date": 1442288424, "creation_date": 1442279849, "question_id": 32576173, "link": "https://stackoverflow.com/questions/32576173/example-of-a-data-structure-with-lazy-spine-and-strict-leaves", "title": "Example of a data structure with lazy spine and strict leaves", "body": "<p>One of the performance trick mentioned <a href=\"https://news.ycombinator.com/item?id=10209798\" rel=\"noreferrer\">here</a> is this:</p>\n\n<blockquote>\n  <p>As a safe default: lazy in the spine, strict in the leaves.</p>\n</blockquote>\n\n<p>I'm having trouble imagining such a data structure.</p>\n\n<p>If I take Lists as an example, and if I make it strict in the leaves then won't the spine will be automatically strict ?</p>\n\n<p>Is there any data structure example where the spine is lazy and leaves are strict ?</p>\n"}, {"tags": ["haskell", "constraints", "memoization"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442283008, "post_id": 32576018, "comment_id": 53008116, "body": "Well, you could consider storing a <code>Dynamic</code>-alike at the leaves of your <code>TypeRep</code> trie. But can you actually make a <code>TypeRep</code> trie? (Can you even enumerate the <code>TypeRep</code>s, which seems like a strictly easier task than creating a trie?)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442283138, "post_id": 32576018, "comment_id": 53008154, "body": "I can make a <code>TypeRep</code> trie; it&#39;s easier than enumerating them. Storing a <code>Dynamic</code> at the leaves of it is how you memoize <code>forall a. Typeable a =&gt; f a</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442283341, "post_id": 32576018, "comment_id": 53008215, "body": "I&#39;m incredibly curious. Can you share some code?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442283847, "post_id": 32576018, "comment_id": 53008353, "body": "The stupid-simple way is to use the <code>TypeRep</code>&#39;s <code>Fingerprint</code>, which is what the <a href=\"https://hackage.haskell.org/package/base-4.4.0.0/docs/Data-Typeable-Internal.html\" rel=\"nofollow noreferrer\"><code>Internal</code></a> implementation has used for <code>Eq</code> since forever. In base 4.8.0.0 you can can get to it through <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Typeable.html#v:typeRepFingerprint\" rel=\"nofollow noreferrer\"><code>typeRepFingerprint</code></a>. It&#39;s as good as <code>TypeRep</code>&#39;s <code>==</code> which is good enough for me."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442284988, "post_id": 32576018, "comment_id": 53008641, "body": "But that&#39;s not enough -- it&#39;s just step one. You have to somehow go from a <code>Fingerprint</code> to a <code>Typeable</code> instance to make the <code>Dynamic</code> value of the appropriate actual concrete type."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442285785, "post_id": 32576018, "comment_id": 53008826, "body": "I got confused about which pieces I&#39;ve solved which ways, forgot about that problem, and claimed a step too far. I&#39;ll edit the Motivation section of the question and link to more code."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442325857, "post_id": 32576018, "comment_id": 53029930, "body": "@DanielWagner I&#39;ve added a section From <code>TypeRep</code> to <code>Typeable</code> to the end of <a href=\"http://stackoverflow.com/a/32577838/414413\">my evil answer</a> with a somewhat evil way to go from the <code>TypeRep</code> to a <code>Typeable a</code> instance."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442334119, "post_id": 32576018, "comment_id": 53035788, "body": "Ah, yup, with manual management of insertions and stuff I can see how it could work."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1524238552, "post_id": 32576018, "comment_id": 86906595, "body": "Several years on, I find this question very puzzling. What you ask for doesn&#39;t seem hard at all with no unsafety: in your example, if you remove <code>c =&gt;</code> from the <code>Memoized</code> constructor and add <code>TracedC  a =&gt;</code> to the signature of <code>example</code>, the program compiles and only prints <code>tracedC :: String</code> once. This changes the interface to the &quot;memoization constructor&quot; by demanding the class dictionary be available at that time; but your proposal also appears to make this API change. Is this still a problem you face? If so, does my proposal meet your needs, or is there another unstated requirement?"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1442454576, "post_id": 32577838, "comment_id": 53093013, "body": "&quot;Either <code>UpToSingle</code> is evil for assuming dictionaries are unique or <code>give</code> is evil for constructing new non-unique dictionaries.&quot; Why not both?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1492410237, "post_id": 32577838, "comment_id": 73948501, "body": "<code>give</code> is the evil one. Incoherent instances break brains. I&#39;m curious why you use something as heavy as an <code>MVar</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1492412523, "post_id": 32577838, "comment_id": 73949427, "body": "In this case, I think you should be able to use an <code>IORef (Maybe a)</code> instead of an <code>MVar a</code>, and avoid synchronization costs. The worst that could happen, I believe, is that the value could be calculated by two different threads. If that&#39;s a concern, you might use a <code>TMVar a</code> (just a wrapper around <code>TVar (Maybe a)</code>) which gets you thread safety without here-unnecessary fairness guarantees."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1492412551, "post_id": 32577838, "comment_id": 73949438, "body": "@dfeuer I don&#39;t know either. I must have had <code>MVar</code>s on my mind from something; I&#39;d use an <code>IORef</code> if I were doing it right now. It&#39;s likely that I was worried about unique initialization, since I was worried about it just now re-reading my answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1492460893, "post_id": 32577838, "comment_id": 73974128, "body": "For extra evil, use a Kmettian trick: create a single, heavily <code>NOINLINE</code>d top-level value to serve as a &quot;null pointer&quot;, and then use <code>reallyUnsafePtrEquality# a nullObj</code> to check for null. This lets you just use <code>IORef a</code>, initialized to <code>nullObj</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1492493805, "post_id": 32577838, "comment_id": 73984148, "body": "For the record, I don&#39;t actually think there&#39;s anything evil about what you&#39;re doing here. I wonder if special compiler support could make this really efficient. In the mean time, here&#39;s my attempt at a bit of an improvement. I do not guarantee that this will always work; ekmett could probably give some tips on that. <a href=\"http://lpaste.net/2030192553617260544\" rel=\"nofollow noreferrer\">lpaste.net/2030192553617260544</a>"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 5, "last_activity_date": 1442325740, "last_edit_date": 1442325740, "creation_date": 1442292047, "answer_id": 32577838, "question_id": 32576018, "link": "https://stackoverflow.com/questions/32576018/memoize-the-result-of-satisfying-a-constraint/32577838#32577838", "title": "Memoize the result of satisfying a constraint", "body": "<h3>Pure Evil</h3>\n\n<p>We make a strict constructor around a value that's missing a constraint and an <code>MVar</code>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ConstraintKinds #-}\n\nimport System.IO.Unsafe (unsafePerformIO)\nimport Control.Concurrent.MVar\n\ndata UpToSingle c a = UpToSingle (c =&gt; a) !(MVar a)\n</code></pre>\n\n<p>It will only be used by smart constructors and deconstructors. In a module we wouldn't export the <code>UpToSingle</code> constructor.</p>\n\n<p>We provide a smart constructor for it; constructing the constructor is equivalent to allocating the <code>MVar</code>.</p>\n\n<pre><code>upToSingle :: (c =&gt; a) -&gt; UpToSingle c a\nupToSingle a = UpToSingle a $ unsafePerformIO newEmptyMVar\n</code></pre>\n\n<p>We also provide a smart deconstructor. It uses whatever value's there or computes one with the provided dictionary. It relies on there being a single possible dictionary for <code>c</code>.</p>\n\n<pre><code>fillMVar :: MVar a -&gt; a -&gt; IO a\nfillMVar mvar a = do\n    tryPutMVar mvar a\n    readMVar mvar\n\nwithSingle :: c =&gt; UpToSingle c a -&gt; a\nwithSingle (UpToSingle a mvar) = unsafePerformIO $ fillMVar mvar a\n</code></pre>\n\n<h3>Evil Exemplified</h3>\n\n<p>Using the same example traced code as in the question.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nimport Debug.Trace (trace)\n\nclass TracedC a where\n    tracedC :: () -&gt; a  -- The () argument keeps a from being memoized in the dictionary for `TracedC a`\n\ninstance TracedC [Char] where\n    tracedC _ = trace \"tracedC :: String\" \"Yes\"\n</code></pre>\n\n<p>And <code>UpToSingle</code> in place of <code>Memoized</code>, <code>upToSingle</code> in place of the <code>Memoized</code> constructor, and <code>withSingle</code> in place of <code>getMemoized</code></p>\n\n<pre><code>example :: UpToSingle (TracedC a) a\nexample = upToSingle (tracedC ())\n\nmain = do\n    let memo = example :: UpToSingle (TracedC [Char]) String\n    putStrLn $ withSingle memo\n    putStrLn $ withSingle memo\n</code></pre>\n\n<p>We get the desired output</p>\n\n<pre><code>tracedC :: String\nYes\nYes\n</code></pre>\n\n<h3>Doubly Evil</h3>\n\n<p>Combined with <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow\">reflection</a> the evil of either <code>UpToSingle</code> or <code>Given</code> is revealed. Both of the last two lines should print the same thing. By substitution they are both <code>give 9 (withSingle (upToSingle given))</code>.</p>\n\n<pre><code>main = do\n    let g1 = upToSingle given :: UpToSingle (Given Integer) Integer\n    let g2 = upToSingle given :: UpToSingle (Given Integer) Integer\n    print $ give 7 (withSingle g1)\n    print $ give 9 (withSingle g2)\n    print $ give 9 (withSingle g1)\n</code></pre>\n\n<p>They actually print the following:</p>\n\n<pre><code>7\n9\n7\n</code></pre>\n\n<p>The <code>give 7</code> evaluated before the <code>give 9</code> passed a different <code>Given Integer</code> dictionary to <code>g1</code> than the <code>give 9</code> would and had the side effect of changing the result of <code>give 9 (withSingle (upToSingle given))</code>. Either <code>UpToSingle</code> is evil for assuming dictionaries are unique or <code>give</code> is evil for constructing new non-unique dictionaries.</p>\n\n<h3>From TypeRep to Typeable</h3>\n\n<p>We can use the same trick of delaying when a constraint is discovered to build the leaves of a memo trie for <code>Typeable a =&gt; f a</code>. Conceptually the leaves of the trie are each one of the following <code>GDynamic</code>s.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Typeable\nimport Control.Monad (liftM)\n\ndata GDynamic f where\n    GDynamic :: Typeable a =&gt; f a -&gt; GDynamic f\n\nunGDynamic :: Typeable a =&gt; GDynamic f -&gt; Maybe (f a)\nunGDynamic (GDynamic f) = gcast f\n</code></pre>\n\n<p>When constructing the trie, we don't have the <code>Typeable a</code> instances needed to construct the <code>GDynamic</code>s. We only have a <code>TypeRep</code>. Instead we will steal the <code>Typeable a</code> instance provided when the value is accessed. A <code>GDynamic</code> value up to a <code>Typeable a</code> instance is the <code>TypeRep</code>, the definition of the value <code>forall a.</code> and an <code>MVar</code> to hold the actual <code>GDynamic</code>.</p>\n\n<pre><code>data UpToTypeable f = UpToTypeable TypeRep (forall a. Typeable a =&gt; f a) !(MVar (GDynamic f))\n</code></pre>\n\n<p>We don't export the <code>UpToTypeable</code> constructor, instead exporting only a smart constructor and deconstructor. When <code>UpToTypeable</code> is constructed we allocate the <code>MVar</code>.</p>\n\n<pre><code>upToTypeable :: TypeRep -&gt; (forall a. Typeable a =&gt; f a) -&gt; UpToTypeable f\nupToTypeable r f = UpToTypeable r f $ unsafePerformIO newEmptyMVar\n</code></pre>\n\n<p>When it is deconstructed the user provides a <code>Typeable a</code> instance. If it has the same <code>TypeRep</code> as that stored in the <code>UpToTypeable</code> we accept that as proof that the types are equal and use the provided <code>Typeable a</code> instance to fill in the value of the <code>GDynamic</code>.</p>\n\n<pre><code>withTypeable :: forall f a. Typeable a =&gt; UpToTypeable f -&gt; Maybe (f a)\nwithTypeable (UpToTypeable r f mvar) = unsafePerformIO $ do\n    if typeRep (Proxy :: Proxy a) == r\n    then liftM unGDynamic $ fillMVar mvar (GDynamic (f :: f a))\n    else return Nothing\n</code></pre>\n\n<p>This should be safe since future GHC versions will forbid user provided instances for <code>Typeable</code>. </p>\n"}], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "answer_count": 1, "score": 10, "last_activity_date": 1442325740, "creation_date": 1442278582, "last_edit_date": 1442287369, "question_id": 32576018, "link": "https://stackoverflow.com/questions/32576018/memoize-the-result-of-satisfying-a-constraint", "title": "Memoize the result of satisfying a constraint", "body": "<p>I am searching for a function</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ConstraintKinds #-}\n\nmemoC :: (c =&gt; a) -&gt; (c =&gt; a)\n</code></pre>\n\n<p>such that the resulting <code>a</code>s is only evaluated once for the supplied constraint.</p>\n\n<h3>Another short version</h3>\n\n<p>How can I make a value of some type <code>a</code> that can only be inspected in the presence of a proof of some constraint <code>c</code>?</p>\n\n<h3>Motivation</h3>\n\n<p>I have long sought after a general solution to memoizing values of the form:</p>\n\n<pre><code>C a =&gt; a\n</code></pre>\n\n<p>Where <code>C</code> is some constraint and <code>a</code> ranges over all types. With a <code>Typeable</code> constraint on <code>a</code> and some smart constructors it would be possible to safely memoize the spine of a trie for <code>Typeable a =&gt; b</code> by building a trie over <code>TypeRep</code>s. This question is about the harder part, what to put at the leaves of such a trie.</p>\n\n<p>If we can somehow get <code>a</code> into the leaves, the leaves of the trie would need to initially have a value <code>C a =&gt; a</code> for some concrete type <code>a</code>, since dictionaries for classes can't be looked up from the type. Looking up values from the trie would require the dictionary for <code>C a</code>. This would seem to amount to modifying the value held at the leaf of the trie based on the passed in dictionary.</p>\n\n<p>If we can't somehow get <code>a</code> into the leaves, the leaves would have an even scarier type <code>C a =&gt; b</code> for a single <code>b</code>, and, in providing the dictionary we'd need to prove that the type <code>a</code> (and thus the dictionary) can be determined by what is held in <code>b</code>, which won't be any more powerful than a <code>TypeRep</code>.</p>\n\n<h3>Evil</h3>\n\n<p>It's tempting to reach into the <a href=\"https://hackage.haskell.org/package/base/docs/System-IO-Unsafe.html\">bag of evil</a> to build a constructor to hold at the leaves of a trie. Modifying the value held at the leaf of the trie based on the passed in dictionary isn't evil if there's only ever a single dictionary possible for each constraint.</p>\n\n<p>Any \"solution\" to this could be extremely evil. I am assuming that there's only ever a single dictionary for any constraint. Reflection <a href=\"https://hackage.haskell.org/package/reflection/docs/Data-Reflection.html#t:Given\"><code>give</code>s us another evil</a> that can construct more than one dictionary for a constraint.</p>\n\n<p>Disuade me from this evil.</p>\n\n<h3>Example</h3>\n\n<p>The following should not (and doesn't) memoize the result of providing the constraint <code>TracedC String</code>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Debug.Trace (trace)\n\nclass TracedC a where\n    tracedC :: () -&gt; a  -- The () argument keeps a from being memoized in the dictionary for `TracedC a`\n\ninstance TracedC [Char] where\n    tracedC _ = trace \"tracedC :: String\" \"Yes\"\n\nnewtype Memoized c a = Memoized { getMemoized :: c =&gt; a }\n\nexample :: Memoized (TracedC a) a\nexample = Memoized (tracedC ())\n\nmain = do\n    let memo = example :: Memoized (TracedC [Char]) String\n    putStrLn $ getMemoized memo\n    putStrLn $ getMemoized memo\n</code></pre>\n\n<p>The output is</p>\n\n<pre><code>tracedC :: String\nYes\ntracedC :: String\nYes\n</code></pre>\n\n<p>A solution would admit a similar example but only evaluate <code>tracedC () :: TracedC [Char] -&gt; String</code> once outputting only</p>\n\n<pre><code>tracedC :: String\nYes\nYes\n</code></pre>\n\n<h3>Related attempts</h3>\n\n<p><a href=\"https://gist.github.com/Cedev/83162cdfe4dfff6b0d63\">A map from types to values <code>f a</code></a> which could be used in <a href=\"https://hackage.haskell.org/package/monad-memo\">monadic memoization</a> with explicit side effects.</p>\n"}, {"tags": ["algorithm", "performance", "haskell", "time-complexity"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1442275761, "post_id": 32575685, "comment_id": 53006440, "body": "If you can sort the points list first, you can do it pretty quickly: for each interval, find the index in the points list of its lower bound and of its upper bound, and subtract. This comes out to something like <code>O(log(nPoints) * max(nPoints, nRanges))</code>, which is a bit better. Linear time is hard to imagine, but maybe I&#39;m missing a clever solution."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442288105, "post_id": 32575685, "comment_id": 53009325, "body": "I guess research towards efficient collision detection algorithms would be relevant here. But you should state what you actually know about the distribution of your points and intervals: if the endpoints are uniformly distributed over some interval of the reals then we can say something about the probability of overlapping intervals. Conversely if we say they are randomly distributed over the real line, then... I guess that&#39;s either ill-posed, or we get a probability of overlap of 0."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442288348, "post_id": 32575685, "comment_id": 53009384, "body": "Consider that we can write a trivial algorithm that runs in linear time when all the intervals overlap precisely."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442289014, "post_id": 32575685, "comment_id": 53009530, "body": "If there are many more points than intervals then the natural approach is (1) convert the intervals to half-open ones (2) take all the new endpoints of and sort them (3) cover the line with half-open intervals with these endpoints (4) compute a histogram of how the points fall into these new intervals (5) take partial sums to obtain counts of points in intervals from -infinity and (6) subtract two such sums for each original interval. This is O(log intervals * (intervals + points)). Maybe a fancier segment tree data structure can do better, but I think only in constant factors."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1442289233, "post_id": 32575685, "comment_id": 53009583, "body": "Oh and maybe you&#39;d like to consider a probabilistic algorithm :)"}], "answers": [{"comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1442276889, "post_id": 32575829, "comment_id": 53006657, "body": "Is there a pre-defined binary search function in Haskell or do I have to implement it? Also binary search requires random access, does that mean I need to switch to <code>Vector</code>?"}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1442276974, "post_id": 32575829, "comment_id": 53006679, "body": "The only one I can find is <code>Data.Vector.Algorithms.Search.binarySearch</code>, which operates on <code>MVector</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442277308, "post_id": 32575829, "comment_id": 53006745, "body": "You don&#39;t <i>need</i> random access to use binary search here, you could just build a balanced binary search tree after sorting the list of points. The constant factor would be better with an array though."}, {"owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "edited": false, "score": 1, "creation_date": 1442277388, "post_id": 32575829, "comment_id": 53006761, "body": "I think you could use an <code>IntMap</code> to map points to their index and then use <code>lookupLE</code> or <code>lookupGE</code> for the lookup."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442285206, "post_id": 32575829, "comment_id": 53008684, "body": "I suppose you could do slightly better -- O(m log m + n) -- using linear-time sorting: include both points and interval endpoints in the list of things you sort in O(m+n) time, then use one pass on the result to produce a map from interval endpoints to point indices in O(m+n) time, then do the lookups you suggested in O(m log m) time. I wonder if it&#39;s possible to get rid of that final log m somehow...?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1442350116, "post_id": 32575829, "comment_id": 53044311, "body": "@trVoldemort: The <code>vector-algorithms</code> library comes with a <a href=\"https://hackage.haskell.org/package/vector-algorithms-0.7.0.1/docs/Data-Vector-Algorithms-Search.html\" rel=\"nofollow noreferrer\"><code>binarySearch</code></a> operation, as well as various sorting algorithms. This requires using the <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\"><code>vector</code></a> library, which may be a good choice anyway if you&#39;re really concerned about performance. It will also require using the <code>ST</code> or <code>IO</code> type."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1442276785, "creation_date": 1442276785, "answer_id": 32575829, "question_id": 32575685, "link": "https://stackoverflow.com/questions/32575685/how-do-i-efficiently-count-a-list-of-intervals-against-a-list-of-points/32575829#32575829", "title": "How do I efficiently count a list of intervals against a list of points?", "body": "<p>If you can sort the points list first, you can do it pretty quickly: for each interval, find the index in the points list of its lower bound and of its upper bound, and subtract. Those lookups take log(nPoints) time, and you are doing nRanges of them, so the overall performance will be governed either by the initial sort (n log n) or by the lookups (m log n). </p>\n\n<p>This comes out to <code>O(log(nPoints) * max(nPoints, nRanges))</code>, which is certainly better than quadratic time. It's as good as I'd expect to be able to get, too: I don't see any clever way to get down to linear time, and a log factor is pretty small.</p>\n\n<p>The main drawback is that it requires having the entire points list in memory at once, for the sort, whereas you can imagine that a lazy solution could exist that would use less space. </p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1485178926, "creation_date": 1442275441, "last_edit_date": 1485178926, "question_id": 32575685, "link": "https://stackoverflow.com/questions/32575685/how-do-i-efficiently-count-a-list-of-intervals-against-a-list-of-points", "title": "How do I efficiently count a list of intervals against a list of points?", "body": "<p>So I have a list of intervals, let's say on a real line,</p>\n\n<pre><code>let intervals = [(1, 12), (2, 5), (3, 24), (7, 8)]\n</code></pre>\n\n<p>Note that the I use parentheses only because I store them as pairs, the intervals are actually inclusive (closed).</p>\n\n<p>And I have a list of points,</p>\n\n<pre><code>let points = [13, 2, 7, 3, 14]\n</code></pre>\n\n<p>I am trying to count the number of points that fall into each interval, this should be an <code>[Integer]</code> that has length <code>length intervals</code>,</p>\n\n<pre><code>counts == [3, 2, 4, 1]\n</code></pre>\n\n<p>Now the problem is in reality both <code>intervals</code> and <code>points</code> are <em>really</em> long, so using a iterative algorithm that takes <code>O(length intervals * length points)</code> would take forever. Thus I'm consider using some kind of segment tree to make it <code>O(log (length intervals) * length points)</code>. Currently I'm looking at the package <a href=\"https://hackage.haskell.org/package/SegmentTree-0.3\" rel=\"nofollow\">SegmentTree</a>. However, my limited Haskell knowledge wasn't enough for me to come up with a complete solution.</p>\n\n<p>I understand that if the objective were to count the number of intervals that cover each point then then solution is straight forward:</p>\n\n<pre><code>import qualified Data.SegmentTree as S\nmap (S.countingQuery $ S.fromList intervals) points\n</code></pre>\n\n<p>But I can't think of a way to do the reverse. To me it seems that in order to do it efficiently a mutable data structure has to be used, and that is just going to open a Pandora Box.</p>\n\n<p>What could be a solution?</p>\n"}, {"tags": ["haskell", "recursion", "list-comprehension", "powerset"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 4, "creation_date": 1442276389, "post_id": 32575630, "comment_id": 53006562, "body": "It&#39;s fine not to get all of the homework problems. 10 out of 11 is great work by any measure! You&#39;ll learn the best by giving it your best shot yourself and then seeing what the answer is which I&#39;m sure they will go over in class."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1442278924, "post_id": 32575630, "comment_id": 53007111, "body": "Have you tried looking at one of the solutions that doesn&#39;t use list comprehension and converting it to do so? You will probably learn a lot even if you don&#39;t implement the power-set algorithm totally on your own."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1442302427, "creation_date": 1442302427, "answer_id": 32580253, "question_id": 32575630, "link": "https://stackoverflow.com/questions/32575630/powerset-of-a-set-with-list-comprehension-in-haskell/32580253#32580253", "title": "Powerset of a set with list comprehension in Haskell", "body": "<p>The text says \"use direct recursion\". So, when you need to compute <code>subsets (x:xs)</code> you can start with considering <code>subsets xs</code> as a recursive call. Is there any way to turn the subsets of <code>xs</code> into those of <code>x:xs</code>, perhaps using list comprehensions?</p>\n"}, {"comments": [{"owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "edited": false, "score": 0, "creation_date": 1442360748, "post_id": 32580863, "comment_id": 53047979, "body": "Actually I am analizing the following solution I got from our class forum but I do not know what f = (:) x means, can you please explain?  I perfectly understand the rest of the code:                                                       powerSet (x:xs) = map f p ++ p    where p = powerSet xs         f = (:) x powerSet [] = [[]]"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "edited": false, "score": 1, "creation_date": 1442376578, "post_id": 32580863, "comment_id": 53051741, "body": "@user3059248 yes I can: <code>(:) x = \\ys -&gt; [ x:y | y &lt;- ys]</code> - see <code>(:)</code> is the <i>cons</i> operator you already know from lists: <code>(:) x xs = x:xs</code> and there is even a syntax that is easier to crasp (called a <i>section</i>): <code>(:) x = (x:)</code>"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1442304404, "creation_date": 1442304404, "answer_id": 32580863, "question_id": 32575630, "link": "https://stackoverflow.com/questions/32575630/powerset-of-a-set-with-list-comprehension-in-haskell/32580863#32580863", "title": "Powerset of a set with list comprehension in Haskell", "body": "<p>Ok here is my go at a hint:</p>\n\n<p>If you look at something like <code>(x:xs)</code> you now have a choice to either <em>include</em> <code>x</code> in your subset or not.</p>\n\n<p>Somehow have to <em>use</em> both choices (probably with <code>(++)</code> ;)) ... </p>\n\n<p>Now remember the other hints (recursion ... <code>xs</code> ....) and maybe you get an idea if you think about <code>[x:ys | ys &lt;- ...]</code></p>\n\n<hr>\n\n<p>BTW: it's almost cheating but if you found a solution using <code>do</code> notation: this is really easy to translate into list comprehensions ;) - maybe you can post your progress a bit?</p>\n"}, {"comments": [{"owner": {"reputation": 741, "user_id": 4231018, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f51592aad5b0b2737b14f3066a08f252?s=128&d=identicon&r=PG&f=1", "display_name": "Michael McKenna", "link": "https://stackoverflow.com/users/4231018/michael-mckenna"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1474063761, "post_id": 39539472, "comment_id": 66395467, "body": "@WillNess I got it working by doing this, but if your suggestion can make it less redundant, feel free to edit it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1474065780, "post_id": 39539472, "comment_id": 66395964, "body": "are you sure it&#39;s working? it doesn&#39;t for me: <a href=\"http://lpaste.net/199034\" rel=\"nofollow noreferrer\">lpaste.net/199034</a> . And what is <code>Set</code>?"}, {"owner": {"reputation": 741, "user_id": 4231018, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f51592aad5b0b2737b14f3066a08f252?s=128&d=identicon&r=PG&f=1", "display_name": "Michael McKenna", "link": "https://stackoverflow.com/users/4231018/michael-mckenna"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1474079417, "post_id": 39539472, "comment_id": 66398244, "body": "Try the updated solution @WillNess  Also: type Set a = [a]"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1474107555, "post_id": 39539472, "comment_id": 66403789, "body": "now it&#39;s OK. -- it&#39;s also <code>[r | ps&lt;-powerset xs, r&lt;-[(x:ps),ps]]</code>, for your amusement; but your version might be less memory hungry."}], "tags": [], "owner": {"reputation": 741, "user_id": 4231018, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f51592aad5b0b2737b14f3066a08f252?s=128&d=identicon&r=PG&f=1", "display_name": "Michael McKenna", "link": "https://stackoverflow.com/users/4231018/michael-mckenna"}, "is_accepted": false, "score": 6, "last_activity_date": 1474106827, "last_edit_date": 1474106827, "creation_date": 1474056964, "answer_id": 39539472, "question_id": 32575630, "link": "https://stackoverflow.com/questions/32575630/powerset-of-a-set-with-list-comprehension-in-haskell/39539472#39539472", "title": "Powerset of a set with list comprehension in Haskell", "body": "<p>Using direct recursion and list comprehension:</p>\n\n<pre><code>type Set a = [a]\n\npowerset :: Set a -&gt; Set (Set a)\npowerset [] = [[]]\npowerset (x:xs) = [x:ps | ps &lt;- powerset xs] ++ powerset xs\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8440, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1474134037, "creation_date": 1442274891, "last_edit_date": 1474134037, "question_id": 32575630, "link": "https://stackoverflow.com/questions/32575630/powerset-of-a-set-with-list-comprehension-in-haskell", "title": "Powerset of a set with list comprehension in Haskell", "body": "<p>I am a complete beginner in Haskell and I have 11 exercises for homework, 10 of which I have already solved. I have found several solutions to get the powerset of a set, but none of them includes list comprehension. I know I should not ask for a complete answer in this case (because it is homework) but I would very much appreciate any feedback/clue.</p>\n\n<blockquote>\n  <p>The powerset of set <strong>S</strong> is a set containing all subsets of <strong>S</strong>. Write a recursive function <code>powerset</code> that returns a set containing all subsets of a given set. Use direct recursion and list comprehension.</p>\n</blockquote>\n"}, {"tags": ["haskell", "import", "module", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1442268093, "post_id": 32574394, "comment_id": 53004369, "body": "Use a Cabal sandbox and <code>cabal repl</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1442268243, "post_id": 32574394, "comment_id": 53004434, "body": "@Jubobs: That&#39;s not the path I&#39;m on. The question is how to get the import working &quot;among my other packages&quot;."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1442268351, "post_id": 32574394, "comment_id": 53004481, "body": "@Jubobs: Man \u2014 I <i>see the answer</i> out of the corner of my eye: not <code>import Exos</code> but <code>import Cryo.Exos</code>! (Very embarrassing!) The other part of the question remains though, why won&#39;t <code>ghc-pkg unregister Exos-0.0.1.0</code> do anything?"}], "answers": [{"tags": [], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "is_accepted": true, "score": 0, "last_activity_date": 1442329133, "creation_date": 1442329133, "answer_id": 32589329, "question_id": 32574394, "link": "https://stackoverflow.com/questions/32574394/how-do-i-install-and-test-a-haskell-package-that-im-developing-locally/32589329#32589329", "title": "How do I install and test a Haskell package that I&#39;m developing locally?", "body": "<p>The error is a simple one: If you look at the <code>Main.hs</code> example where you have successfully imported the module you have</p>\n\n<pre><code>import Cryos.Expos\n</code></pre>\n\n<p>and not</p>\n\n<pre><code>import Expos    -- wrong\n</code></pre>\n\n<p>that's because, the <em>module</em> you are importing is <code>Cryos.Expos</code> from the <em>package</em> <code>Expos</code>.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 1, "accepted_answer_id": 32589329, "answer_count": 1, "score": 0, "last_activity_date": 1442329133, "creation_date": 1442266867, "question_id": 32574394, "link": "https://stackoverflow.com/questions/32574394/how-do-i-install-and-test-a-haskell-package-that-im-developing-locally", "title": "How do I install and test a Haskell package that I&#39;m developing locally?", "body": "<p>I'm developing a Haskell package and would like to test it as if it were an installed package. That is, I'd like to be able to install it among my other packages and then either <code>import</code> or <code>:m +</code>.</p>\n\n<p>I can successfully build my package and (apparently) can successfully install it using</p>\n\n<pre><code>cabal install\n</code></pre>\n\n<p>which reports</p>\n\n<pre><code>Resolving dependencies...\nConfiguring Exos-0.0.1.0...\nBuilding Exos-0.0.1.0...\nInstalled Exos-0.0.1.0\n</code></pre>\n\n<p>but all attempts to import the package then fail with something like (e.g. in GHCi)</p>\n\n<pre><code>&lt;no location info&gt;:\n    Could not find module \u2018Exos\u2019\n    It is not a module in the current program, or in any known package.\n</code></pre>\n\n<p>even though I can see a populated <code>Exos-0.0.1.0</code> folder in my Haskell <code>lib</code> directory. (Even \"uninstalling\" fails with <code>ghc-pkg unregister</code>, which reports <code>ghc-pkg: cannot find package Exos-0.0.1.0</code>.) </p>\n\n<p>How do I install and test a package that I'm developing locally, so that it behaves like part of my collection of installed Haskell packages \u2014\u00a0specifically so that I can import it (and \"uninstall\" it) like any other?</p>\n\n<hr>\n\n<p>My package has the structure </p>\n\n<pre><code>Exos.cabal\nExos/\n    Cryo/\n        Exos.hs\n        Exos/\n            Display.hs\n            Core.hs\n</code></pre>\n\n<p>with (relevant) contents in <code>Exos.cabal</code></p>\n\n<pre><code>name:                   Exos\nversion:                0.0.1.0\nbuild-type:             Simple\n- ...\n\nlibrary\n    exposed-modules:    Cryo.Exos,\n                        Cryo.Exos.Display\n    other-modules:      Cryo.Exos.Core\n    -- other-extensions:\n    build-depends:      base &gt;=4.8,\n                        containers &gt;= 0.5.5.1,\n                        split &gt;= 0.2.2,\n                        MissingH &gt;= 1.3.0.1\n    -- hs-source-dirs:\n    default-language:   Haskell2010\n</code></pre>\n\n<p>in <code>Exos.hs</code></p>\n\n<pre><code>module Cryo.Exos\n    (\n        f,\n        g,\n        otherFunc\n    ) where\n\nimport Cryo.Exos.Core\n-- ...\n</code></pre>\n\n<p>in <code>Core.hs</code></p>\n\n<pre><code>module Cryo.Exos.Core where\n-- ...\n</code></pre>\n\n<p>and in <code>Display.hs</code></p>\n\n<pre><code>module Cryo.Exos.Display\n    (\n        showSomething,\n        showSomethingElse\n    ) where\n\nimport Data.Char\n-- ...\n\nimport Cryo.Exos.Core\nimport Cryo.Exos\n</code></pre>\n\n<hr>\n\n<p>FWIW, inside my IDE, I can write an and successfully run \"Application\" with the following section in the above <code>.cabal</code> file</p>\n\n<pre><code>executable enigma-hs\n    main-is:            Main.hs\n    build-depends:      base &gt;=4.8,\n                        Exos\n    hs-source-dirs:     tests\n    default-language:   Haskell2010\n</code></pre>\n\n<p>and the following (relevant) code in <code>Exos/tests/Main.hs</code></p>\n\n<pre><code>module Main where\n\nimport System.IO\n\nimport Cryo.Exos\nimport Cryo.Exos.Display\n\nmain :: IO ()\nmain = do\n    putStr $ showSomething\n    putStr $ showSomethingElse\n    -- ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1442270220, "post_id": 32573798, "comment_id": 53005081, "body": "A more basic way of writing what @bheklilr is suggesting is: <code>singletons xs = map (\\x -&gt; [x]) xs</code>"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 2, "creation_date": 1442295809, "post_id": 32573798, "comment_id": 53011430, "body": "Or just <code>singletons = map (:[])</code>"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1442266378, "post_id": 32573858, "comment_id": 53003670, "body": "I actually prefer <code>fmap (: [])</code> because it isn&#39;t always obvious which Monad or Applicative instance is being used with <code>return</code> or <code>pure</code>. Also, since the question is how to construct a singleton list, <code>pure</code> isn&#39;t really more general than <code>return</code>: they are both specialized to <code>a -&gt; [a]</code>."}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1468822293, "post_id": 32573858, "comment_id": 64265510, "body": "Late to the party, but... @ReinHenrichs True, this might be overkill for the question, but &quot;forgetting&quot; which specific type you&#39;re working with must be the epitome of coding things general / generic. :-)"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 6, "last_activity_date": 1442264421, "creation_date": 1442264421, "answer_id": 32573858, "question_id": 32573798, "link": "https://stackoverflow.com/questions/32573798/creating-a-singleton-list/32573858#32573858", "title": "Creating a Singleton List", "body": "<p>Just use <code>fmap return</code>, since <code>return x :: [a] == [x]</code>, and <code>fmap</code> for lists is just <code>map</code>, but <code>fmap</code> is preferred since it's more general.</p>\n\n<p>In fact, you could go as general as possible and use</p>\n\n<pre><code>fmap pure :: (Functor f, Applicative g) =&gt; f a -&gt; f (g a)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4647229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/943c56b148d0a0647678b2bd35d94251?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4647229/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2518, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1546604449, "creation_date": 1442264236, "last_edit_date": 1546604449, "question_id": 32573798, "link": "https://stackoverflow.com/questions/32573798/creating-a-singleton-list", "title": "Creating a Singleton List", "body": "<p>I want to create a singleton list from each element in the list, with the type declaration </p>\n\n<p><code>single :: [a] -&gt; [[a]]</code>. For Example <code>single [a,b,c] = [[a],[b],[c]]</code></p>\n\n<p>I was wondering if there is a simple way to do it, like using <code>concat</code> which does the opposite of what I want.</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1442265411, "post_id": 32573516, "comment_id": 53003220, "body": "My usual approach is to (nicely) harass the library devs until they update the library. Sometimes it&#39;s a matter of letting them know that someone still cares about the library. In this case, it appears the problem might be as simple as changing the <code>base</code> dependency in the cabal file, noted <a href=\"https://hackage.haskell.org/package/strict-concurrency-0.2.4.1/revisions/\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1442265498, "post_id": 32573516, "comment_id": 53003254, "body": "@Eric : I tried fixing the dependencies, but it turns out they are there for a reason. If you look closely you&#39;ll see they actually made them more restrictive, not the contrary."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1442265756, "post_id": 32573516, "comment_id": 53003387, "body": "Ah, I see that now. In that case, why not ping Don? He can update the library or tell you why he isn&#39;t bothering these days and give you an alternative."}], "owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442265214, "creation_date": 1442263165, "last_edit_date": 1442265214, "question_id": 32573516, "link": "https://stackoverflow.com/questions/32573516/is-there-a-modern-replacement-for-the-strict-concurrency-package", "title": "Is there a modern replacement for the strict-concurrency package?", "body": "<p>Real World Haskell mentions the <a href=\"http://book.realworldhaskell.org/read/concurrent-and-multicore-programming.html\" rel=\"nofollow\">strict-concurrency library</a> that provides strict versions of Chan and MVar. That sounds handy, but unfortunately the library doesn't compile with recent GHC (<a href=\"https://hackage.haskell.org/package/strict-concurrency\" rel=\"nofollow\">it's limited to base&lt;4.6</a>). What do people use nowadays?</p>\n"}, {"tags": ["regex", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442261757, "post_id": 32573049, "comment_id": 53001497, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/8881263/dynamic-loading-of-haskell-abstract-syntax-expression\">Dynamic loading of Haskell abstract syntax expression</a>. In general, questions under the [ghc-api] and [template-haskell] tags might prove useful."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1442261714, "creation_date": 1442261714, "answer_id": 32573169, "question_id": 32573049, "link": "https://stackoverflow.com/questions/32573049/how-to-convert-an-expression-in-haskell-to-a-tree-structure-to-get-information-i/32573169#32573169", "title": "How to convert an expression in Haskell to a Tree structure to get information in the expression?", "body": "<p>You could use <a href=\"https://wiki.haskell.org/Template_Haskell\">Template Haskell</a>:</p>\n\n<pre><code>Language.Haskell.TH&gt; runQ [e|3 + 5|]\nInfixE (Just (LitE (IntegerL 3))) (VarE GHC.Num.+) (Just (LitE (IntegerL 5)))\n</code></pre>\n\n<p>Or <a href=\"http://hackage.haskell.org/package/haskell-src-exts\"><code>haskell-src-exts</code></a>:</p>\n\n<pre><code>Language.Haskell.Exts&gt; parse \"3 + 5\" :: ParseResult Exp\nParseOk (InfixApp (Lit (Int 3)) (QVarOp (UnQual (Symbol \"+\"))) (Lit (Int 5)))\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2712982"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442261714, "creation_date": 1442261263, "question_id": 32573049, "link": "https://stackoverflow.com/questions/32573049/how-to-convert-an-expression-in-haskell-to-a-tree-structure-to-get-information-i", "title": "How to convert an expression in Haskell to a Tree structure to get information in the expression?", "body": "<p>is there a way to convert an expression in <strong>Haskell</strong> language to a Tree like format and extract information from each node. Or Generate all possible trees for a given expression ?\nEx: <strong>add 5 3</strong> \nThis is tree where, 3 and 5 are leaf nodes and \"<strong>add</strong>\" as the root. So what I need is to get decompose the above expression so that I can do further analysis on the expression. \neg: * <em>to know what are the values that I'm going to \"add\".</em>\n    * <em>to know what is the operation that I'm performing over the given numbers (here \"add\", also it could be \"subtraction\", \"multiplication\" etc.</em>)\n    Really appreciate your help :)</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "hackage"], "answers": [{"comments": [{"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1442261466, "post_id": 32573086, "comment_id": 53001371, "body": "This still gives the <code>Could not find module \u2018MyPlugin\u2019</code> error message."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1442261860, "post_id": 32573086, "comment_id": 53001538, "body": "@MikeIzbicki You can ask <code>cabal</code> which exact <code>ghc</code> command it&#39;s running by setting the verbosity high enough. I recommend you try that, then manually play with the ghc invocation yourself until you figure out what needs to change to make it work; then we can work out how to get <code>cabal</code> to invoke ghc in the way that works."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442273042, "post_id": 32573086, "comment_id": 53005820, "body": "I guess <code>--ghc-option=&quot;-package MyPluginPackage&quot;</code> <i>might</i> work. At least I can&#39;t think of a specific reason why it wouldn&#39;t work (given that the plugin package is already installed)."}, {"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1442274938, "post_id": 32573086, "comment_id": 53006274, "body": "After playing around with cabal sandboxes a bit, I managed to get this to work by passing the <code>package-id</code> and <code>package-db</code> flags to GHC via <code>-ghc-option</code> cabal flag."}, {"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1442275041, "post_id": 32573086, "comment_id": 53006293, "body": "I also managed to get a hacked together solution to the second part by creating a script that recusively calling <code>cabal install --dry-run</code>.  It&#39;s not very efficient, and doesn&#39;t take advantage of cabal&#39;s parallelism, but it works."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1442261390, "creation_date": 1442261390, "answer_id": 32573086, "question_id": 32572831, "link": "https://stackoverflow.com/questions/32572831/how-can-i-cabal-install-every-package-on-hackage-with-a-custom-plugin/32573086#32573086", "title": "How can I `cabal install` every package on hackage with a custom plugin", "body": "<p>I'm not sure about the second part, but the first part should be possible with a command-line flag to cabal:</p>\n\n<pre><code>cabal install --ghc-option=-fplugin=MyPlugin\n</code></pre>\n"}], "owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 32573086, "answer_count": 1, "score": 1, "last_activity_date": 1442261390, "creation_date": 1442260471, "question_id": 32572831, "link": "https://stackoverflow.com/questions/32572831/how-can-i-cabal-install-every-package-on-hackage-with-a-custom-plugin", "title": "How can I `cabal install` every package on hackage with a custom plugin", "body": "<p>I'm working on a custom <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/users_guide/compiler-plugins.html\" rel=\"nofollow\">ghc plugin</a>.  In order to test it out, I want to run it on every package on hackage.  I'm running into two difficulties with this.</p>\n\n<hr>\n\n<p>First, I need to pass the <code>-fplugin=MyPlugin</code> option to ghc when installing packages.  The only way I've found to do this is to create the file <code>myghc.sh</code> that contains: </p>\n\n<pre><code>#!/bin/sh\nghc -fplugin=MyPlugin $@\n</code></pre>\n\n<p>And then run <code>cabal install --with-compiler=./myghc.sh</code>.  But then when I run that command, I get the error </p>\n\n<pre><code>Could not find module 'MyPlugin'\nit is a member of the hidden package...\n</code></pre>\n\n<p>So is there a special flag I can pass to <code>cabal install</code> to use my plugin without having to modify every packages' cabal file?</p>\n\n<hr>\n\n<p>Second, I want my plugin to record information about the package it is compiling, so I need a way for my package to know this information.</p>\n\n<p>It seems like there might be a number of ways to do this, but here's what I've come up with so far.  I want a list of hackage packages ordered so that all the dependencies of a package are guaranteed to come before it in the list?  Then, when I run <code>cabal install</code>, I can pass the name of the package it is installing to the plugin.  Since the dependencies are already installed, I wouldn't have to worry about them getting installed under the wrong name.</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad", "newtype", "lifting"], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1442260163, "post_id": 32572657, "comment_id": 53000759, "body": "Thank you very much, this is a great answer. Can I somehow do without language extensions such as <code>GeneralizedNewtypeDeriving</code>?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1442260266, "post_id": 32572657, "comment_id": 53000814, "body": "@JakubDaniel Sure, you can write all the instances by hand. But you don&#39;t want to (and will probably mess one up), thus <code>GeneralizedNewtypeDeriving</code>."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1464917672, "post_id": 32572657, "comment_id": 62693736, "body": "To see the actual code that is deriving run the command <code>:set -ddump-deriv</code> in GHCi, it shows you all the code GHC generously writes for you.   <code>data AB = A | B deriving Eq</code> dumps <code>instance GHC.Classes.Eq Ghci5.AB where (GHC.Classes.==) Ghci5.A Ghci5.A = GHC.Types.True; (GHC.Classes.==) Ghci5.B Ghci5.B = GHC.Types.True; (GHC.Classes.==) _ _ = GHC.Types.False</code>"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1492785124, "post_id": 32572657, "comment_id": 74142754, "body": "@Cirdec I tried to write the instance by hand and failed miserably. Thanks!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 11, "last_activity_date": 1442260195, "last_edit_date": 1442260195, "creation_date": 1442259773, "answer_id": 32572657, "question_id": 32572152, "link": "https://stackoverflow.com/questions/32572152/tidying-up-monads-turning-application-of-a-monad-transformer-into-newtype-mona/32572657#32572657", "title": "Tidying up Monads - turning application of a monad transformer into newtype monad", "body": "<p>The normal pattern is to define a newtype for your complete transformer stack.</p>\n\n<pre><code>data A = A\ndata E = E\n\nnewtype MyBranchT m a = MyBranchT { getMyBranchT :: ExceptT E (StateT A m) a }\n</code></pre>\n\n<p>If there are any pieces of the stack that add meaningful new capabilities on their own you'd also define newtypes for those pieces.</p>\n\n<p>Then you use <code>GeneralizedNewtypeDeriving</code> to get instances for all of the various monad classes.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\n-- base\nimport Control.Applicative\nimport Control.Monad\n\n-- transformers\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.Except\nimport Control.Monad.Trans.State.Lazy\n\n-- mtl classes\nimport Control.Monad.Cont.Class\nimport Control.Monad.Error.Class\nimport Control.Monad.Reader.Class\nimport Control.Monad.State.Class\nimport Control.Monad.Writer.Class\n\ndata A = A\ndata E = E\n\nnewtype MyBranchT m a = MyBranchT { getMyBranchT :: ExceptT E (StateT A m) a }\n    deriving (Functor, Applicative, Monad, MonadIO,     -- classes from base and transformers\n              {- Alternative, MonadPlus, -}             -- if E is a monoid\n              MonadState A, MonadError E,               -- classes from mtl that MyBranchT provides\n              MonadCont, MonadReader r, MonadWriter w)  -- classes from mtl that might be available from m\n</code></pre>\n\n<p>You'll have to write the <code>MonadTrans</code> instance by hand. <code>lift</code> is always just <code>lift</code> once for each of the transformers in the stack.</p>\n\n<pre><code>instance MonadTrans MyBranchT where\n    lift = MyBranchT . lift . lift\n</code></pre>\n\n<p>If there are any pieces of the stack that add meaningful new capabilities <code>X</code> on their own you'd also define a new <code>MonadX</code> class for those capabilities, write <code>MonadX</code> instances for each of the monad transfomers (<code>StateT</code>, <code>ExceptT</code>, <code>ContT</code>, etc) if possible, and derive the <code>MonadX</code> instance for your transformer stack (<code>MyBranchT</code>).</p>\n\n<p>You'll also usually make a type synonym for <code>MyBranchT Identity</code> and functions to <code>runMyBranchT</code> and <code>runMyBranch</code></p>\n\n<pre><code>import Data.Functor.Identity\n\ntype MyBranch a = MyBranchT Identity a\n\nrunMyBranchT :: MyBranchT m a -&gt; A -&gt; m (Either E a, A)\nrunMyBranchT mb s = runStateT (runExceptT (getMyBranchT mb)) s\n\nrunMyBranch :: MyBranch a -&gt; A -&gt; (Either E a, A)\nrunMyBranch mb s = runIdentity $ runMyBranchT mb s\n</code></pre>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 3, "accepted_answer_id": 32572657, "answer_count": 1, "score": 9, "last_activity_date": 1492785162, "creation_date": 1442257784, "question_id": 32572152, "link": "https://stackoverflow.com/questions/32572152/tidying-up-monads-turning-application-of-a-monad-transformer-into-newtype-mona", "title": "Tidying up Monads - turning application of a monad transformer into newtype monad", "body": "<p>I am trying to take e.g. <code>ExceptT a (StateT A M)</code>, for some concrete type <code>A</code> and monad <code>M</code>, and wrap them up into my new custom monads.</p>\n\n<p>First I identified that <code>StateT A M</code> appears often in other contexts and thus I decided it would be best to wrap that alone in a monad <code>M1</code> and then wrap <code>ExceptT a M1</code> into <code>M2</code>.</p>\n\n<p>The desired property is to make <code>M1</code> and <code>M2</code> instances of <code>MonadState</code> and the class of <code>M</code> (lets assume it is called <code>MyMonadClass</code>). Also <code>M2</code> should be an instance of <code>MonadError</code>.</p>\n\n<p>First I started by simple type synonyms:</p>\n\n<pre><code>type MyState    = StateT A M\ntype MyBranch a = ExceptT a MyState\n</code></pre>\n\n<p>then I thought that I would first sketch the instance declarations (without implementing the instance) and thats where I first got stuck. <code>instance MonadState A (MyState)</code> seemed to not be the right syntax. I thought I would have to create <code>newtype MyState' a = StateT a M</code> and then <code>type MyState = MyState A</code> (Lets not use language extensions where not necessary).</p>\n\n<p>However once I started converting the synonyms into <code>newtype</code> declarations I started to lose the connection to the <code>StateT A M</code> and <code>ExceptT ...</code> types.</p>\n\n<pre><code>newtype MyState' s a = MyState' { runMyState :: s -&gt; (s, a) }\ntype MyState = MyState' A\nnewtype MyBranch e a = MyBranch { runMyBranch :: MyState (Either e a) }\n</code></pre>\n\n<p>Now the transformers that are already implemented disappeared and I think I am trying to do something that does not make much sense. So my question is: How would one correctly wrap this kind of behaviour into new compound monads that make accessible the layers underneath so that one avoids unnecessary lifting and keeps things clear and well-organized.</p>\n"}, {"tags": ["haskell", "dictionary", "text"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 2, "creation_date": 1442253440, "post_id": 32570604, "comment_id": 52997140, "body": "You are using the wrong data structure. Have you considered using a <a href=\"https://en.wikipedia.org/wiki/Trie\" rel=\"nofollow noreferrer\"><b>Trie</b></a> from <a href=\"http://hackage.haskell.org/package/bytestring-trie-0.2.3/docs/Data-Trie.html\" rel=\"nofollow noreferrer\"><b><code>Data.Trie</code></b></a>, not a <b>Tree</b>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442254163, "post_id": 32570604, "comment_id": 52997534, "body": "How did you find out that <code>train</code> is the bottleneck? There is no way to discover that using just the usage example in the question, so I guess you must have tested/benchmarked it in some other way."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442254523, "post_id": 32570604, "comment_id": 52997765, "body": "What was your input to get to 1 GB?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1442254950, "post_id": 32570604, "comment_id": 52997987, "body": "TDFA is really slow. It would be nice if there was a fast, native <code>Text</code> version of TDFA but there currently is not (the tdfa-text just converts to <code>String</code> before processing). You should consider using a more optimized regex package, even though most of them have some undesirable behavior and are backed by a C library."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442255888, "post_id": 32570604, "comment_id": 52998518, "body": "@duplode I just timed various statements. Nothing too deep, I know, but after a while I realized that I must have gotten wrong all the implementation, because there&#39;s an abyss between this version and the Python one. I&#39;ll rewrite it using tries and report back."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442255936, "post_id": 32570604, "comment_id": 52998550, "body": "@user5402 I loaded words from Norvig&#39;s <code>big.txt</code> file and played with the functions in the interpreter."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1442256052, "post_id": 32570604, "comment_id": 52998616, "body": "@ThomasM.DuBuisson That&#39;s unfortunate. I chose it after reading <a href=\"https://wiki.haskell.org/Regular_expressions\" rel=\"nofollow noreferrer\">this page</a> on Haskell&#39;s wiki. In the table <code>regex-tdfa</code> is reported as fast."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1442256282, "post_id": 32570604, "comment_id": 52998743, "body": "@ThomasM.DuBuisson Given that the regex here is just <code>[a-z]+</code>, I wonder if a regex library is necessary at all. Perhaps <code>filter (not null &amp;&amp; all isLetter) . words</code> (or an equivalent thereof for <code>Text</code>, if/when the OP switches to that) would be enough?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1442256520, "post_id": 32570604, "comment_id": 52998863, "body": "compile the regex, and don&#39;t try to look at performance of things from GHCi"}], "answers": [{"comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1442262853, "post_id": 32572961, "comment_id": 53002019, "body": "@ThomasM.DuBuisson : since I can read minds, I know that you are referring to lazy IO :-p ... so, the readFile would take 0.7 seconds if it were not lazy. I just measured it with evaluate and force. Still no big deal, compared to the other tasks."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1442306600, "post_id": 32572961, "comment_id": 53016950, "body": "Thank you Michael! Indeed, regex search was quite slow and memory hogging. Replacing it with a pure Haskell function improves the performance quite a bit."}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1442261514, "last_edit_date": 1442261514, "creation_date": 1442260892, "answer_id": 32572961, "question_id": 32570604, "link": "https://stackoverflow.com/questions/32570604/haskell-version-of-peter-norvigs-spelling-corrector-is-unbelievably-slow/32572961#32572961", "title": "Haskell version of Peter Norvig&#39;s spelling corrector is unbelievably slow", "body": "<p>IMHO, it's not that slow as it seems. The most time is consumed in <code>nwords</code>. The other function, <code>correct</code>, is actually quite fast. On my machine, <code>nwords</code> takes about 6.5s, and <code>correct</code> takes less then 0.1s, which matches the processing speed of 10 words per seconds, which was Peter Norvigs target.</p>\n\n<p>I could make a 20% performance improvement by <code>force</code>ing the input and output  of the <code>train</code> function.</p>\n\n<p>I compiled the program with <code>ghc -o Spl -O2 Spl.hs</code>.</p>\n\n<pre><code>module Main (nwords, correct, main)\n    where\n\nimport Data.Char (toLower)\nimport Data.Ord (comparing)\nimport Data.List (maximumBy, splitAt, foldl')\nimport Text.Regex.TDFA (getAllTextMatches, (=~))\n\nimport Control.DeepSeq (deepseq, force)\nimport Control.Exception (evaluate)\nimport Data.Time.Clock.POSIX\n\nimport qualified Data.Set as Set\nimport qualified Data.Map.Strict as Map\n\ntype NWords = Map.Map String Int\n\n\nalphabet :: String\nalphabet = enumFromTo 'a' 'z'\n\nnwords :: String -&gt; Map.Map String Int\nnwords = train . words'\n\nuniqueElems :: Ord a =&gt; [a] -&gt; [a]\nuniqueElems = uniq' Set.empty\n    where uniq' _ [] = []\n          uniq' seen (x:xs)\n            | x `Set.member` seen = uniq' seen xs\n            | otherwise           = x:uniq' (x `Set.insert` seen) xs\n\nwords' :: String -&gt; [String]\nwords' = getAllTextMatches . flip (=~) \"[a-z]+\" . map toLower\n\n-- have a 20% performance improvement by using 'force' on input and output\ntrain :: [String] -&gt; NWords\ntrain = force . foldl' populate Map.empty . force\n    where populate m feature = Map.insertWith (+) feature 1 m\n\nedits :: String -&gt; [String]\nedits word = uniqueElems $ concat [dels, trans, repl, ins]\n    where dels   = [a ++ tail b | (a,b) &lt;- splits, nn b]\n          trans  = [ a ++ (b!!1):head b:tail (tail b) | (a,b) &lt;- splits\n                   , length b &gt; 1]\n          repl   = [a ++ c:tail b | (a,b) &lt;- splits, c &lt;- alphabet, nn b]\n          ins    = [a ++ c:b | (a,b) &lt;- splits, c &lt;- alphabet]\n          splits = [splitAt n word | n &lt;- [0..length word]]\n          nn     = not . null\n\nknownEdits :: NWords -&gt; String -&gt; [String]\nknownEdits nw word = uniqueElems [ e2 | e1 &lt;- edits word, e2 &lt;- edits e1\n                                 , Map.member e2 nw]\n\nknown :: NWords -&gt; [String] -&gt; [String]\nknown nw = uniqueElems . filter (`Map.member` nw)\n\ncorrect :: NWords -&gt; String -&gt; String\ncorrect nw word = fst $ maximumBy (comparing snd) candidates\n    where candidates = [(w, Map.findWithDefault 0 w nw) | w &lt;- result]\n          result     = head $ filter (not . null) start\n          start      = [ known nw [word], known nw $ edits word\n                       , knownEdits nw word , [word]]\n\nmain = do\n    time0 &lt;- getPOSIXTime\n    t &lt;- readFile \"big.txt\"\n    time1 &lt;- getPOSIXTime\n    putStrLn $ \":: readFile: \"++(show $ time1-time0)\n\n    let nw = nwords t\n    evaluate $ force nw\n    time2 &lt;- getPOSIXTime\n    putStrLn $ \":: nwords: \" ++ (show $ time2-time1)\n\n    putStrLn $ correct nw \"speling\"\n    putStrLn $ correct nw \"miracl\"\n    putStrLn $ correct nw \"helllo\"\n    putStrLn $ correct nw \"rabit\"\n    putStrLn $ correct nw \"kitteen\"\n    putStrLn $ correct nw \"breaks\"\n    putStrLn $ correct nw \"sometheeng\"\n    putStrLn $ correct nw \"clessical\"\n    putStrLn $ correct nw \"theater\"\n    putStrLn $ correct nw \"dishis\"\n    time3 &lt;- getPOSIXTime\n    putStrLn $ \":: correcting: \" ++ (show $ time3-time2)\n\n    let a = time1-time0\n    let b = time2-time1\n    let c = time3-time2\n    let total = time3 - time0\n    putStrLn $ \":: total:  \"++(show $ time3-time0)\n</code></pre>\n\n<p>And this is my output:</p>\n\n<pre><code>:: readFile: 0.000202s\n:: nwords: 6.063617s\nspelling\nmiracle\nhello\nhabit\nkitten\nbreaks\nsomething\nclassical\ntheater\ndishes\n:: correcting: 0.749441s\n:: total:  6.81326s\n</code></pre>\n\n<p>Furthermore, the <code>nwords</code> function becomes twice as fast if you don't use regexes:</p>\n\n<pre><code>words' :: String -&gt; [String]\nwords' str = map (map toLower) $ words str\n    where words str = if (null a)\n                        then (if null b then [] else words f)\n                        else a:(words d)\n                            where (a,b) = span  isAlpha str\n                                  (c,d) = break isAlpha b\n                                  (e,f) = break isAlpha str\n</code></pre>\n\n<p>Interestingly, if you try to correct unknown words, it takes much longer to correct them.</p>\n\n<p>(I'm a haskell beginner, and I'm trying to learn the language by answering stackoverflow questions, and by writing some toy programs.)</p>\n\n<hr>\n\n<p>about the memory consumption:</p>\n\n<p>This version just takes 21MB at most, at my system. It seems that there is a space leak if you either use regexes, or if you use <code>force</code> in <code>train</code>. If you omit both, it behaves fine. I think it has to do with the fact that the self-written <code>words'</code> function is more lazy than the regex-<code>words'</code> function.</p>\n\n<pre><code>module Main (nwords, correct, main)\n    where\n\nimport Data.Char (toLower)\nimport Data.Ord (comparing)\nimport Data.List (maximumBy, splitAt, foldl')\n\nimport Control.DeepSeq (force)\nimport Control.Exception (evaluate)\nimport Data.Time.Clock.POSIX\nimport Data.Char (isAlpha)\n\nimport qualified Data.Set as Set\nimport qualified Data.Map.Strict as Map\n\ntype NWords = Map.Map String Int\n\n\nalphabet :: String\nalphabet = enumFromTo 'a' 'z'\n\nnwords :: String -&gt; Map.Map String Int\nnwords = train . words'\n\nuniqueElems :: Ord a =&gt; [a] -&gt; [a]\nuniqueElems = uniq' Set.empty\n    where uniq' _ [] = []\n          uniq' seen (x:xs)\n            | x `Set.member` seen = uniq' seen xs\n            | otherwise           = x:uniq' (x `Set.insert` seen) xs\n\nwords' :: String -&gt; [String]\nwords' str = map (map toLower) $ words str\n    where words str = if (null a)\n                        then (if null b then [] else words f)\n                        else a:(words d)\n                            where (a,b) = span isAlpha str\n                                  (c,d) = break isAlpha b\n                                  (e,f) = break isAlpha str\n\ntrain :: [String] -&gt; NWords\ntrain = foldl' populate Map.empty\n    where populate m feature = Map.insertWith (+) feature 1 m\n\nedits :: String -&gt; [String]\nedits word = uniqueElems $ concat [dels, trans, repl, ins]\n    where dels   = [a ++ tail b | (a,b) &lt;- splits, nn b]\n          trans  = [ a ++ (b!!1):head b:tail (tail b) | (a,b) &lt;- splits\n                   , length b &gt; 1]\n          repl   = [a ++ c:tail b | (a,b) &lt;- splits, c &lt;- alphabet, nn b]\n          ins    = [a ++ c:b | (a,b) &lt;- splits, c &lt;- alphabet]\n          splits = [splitAt n word | n &lt;- [0..length word]]\n          nn     = not . null\n\nknownEdits :: NWords -&gt; String -&gt; [String]\nknownEdits nw word = uniqueElems [ e2 | e1 &lt;- edits word, e2 &lt;- edits e1\n                                 , Map.member e2 nw]\n\nknown :: NWords -&gt; [String] -&gt; [String]\nknown nw = uniqueElems . filter (`Map.member` nw)\n\ncorrect :: NWords -&gt; String -&gt; String\ncorrect nw word = fst $ maximumBy (comparing snd) candidates\n    where candidates = [(w, Map.findWithDefault 0 w nw) | w &lt;- result]\n          result     = head $ filter (not . null) start\n          start      = [ known nw [word], known nw $ edits word\n                       , knownEdits nw word , [word]]\n\nmain = do\n    time0 &lt;- getPOSIXTime\n    t &lt;- readFile \"big.txt\"\n    time1 &lt;- getPOSIXTime\n    putStrLn $ \":: readFile: \"++(show $ time1-time0)\n\n    let nw = nwords t\n    evaluate $ force nw\n    time2 &lt;- getPOSIXTime\n    putStrLn $ \":: nwords: \" ++ (show $ time2-time1)\n\n    putStrLn $ correct nw \"speling\"\n    putStrLn $ correct nw \"miracl\"\n    putStrLn $ correct nw \"helllo\"\n    putStrLn $ correct nw \"rabit\"\n    putStrLn $ correct nw \"kitteen\"\n    putStrLn $ correct nw \"breaks\"\n    putStrLn $ correct nw \"sometheeng\"\n    putStrLn $ correct nw \"clessical\"\n    putStrLn $ correct nw \"theater\"\n    putStrLn $ correct nw \"dishis\"\n    time3 &lt;- getPOSIXTime\n    putStrLn $ \":: correcting: \" ++ (show $ time3-time2)\n\n    let a = time1-time0\n    let b = time2-time1\n    let c = time3-time2\n    let total = time3 - time0\n    putStrLn $ \":: total:  \"++(show $ time3-time0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442282344, "post_id": 32574828, "comment_id": 53007942, "body": "Could <code>wrds</code> be improved by using <code>let (w, r2) = T.span isAlpha . T.dropWhile (not . isAlpha)</code>, because at least that has a chance of fusing? I&#39;d also write <code>wrds</code> as an unfold instead of direct recursion."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442284811, "post_id": 32574828, "comment_id": 53008597, "body": "That would be something to investigate. The code is available <a href=\"https://goo.gl/uymtjV\" rel=\"nofollow noreferrer\">here</a> if you want to play around with it. The main point is that you can do reasonably well with a direct approach if you employ the right data structures. There are trade-offs using lazy text vs text in terms of speed and memory used and there are alternate hash map implementations which can be used."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442285452, "post_id": 32574828, "comment_id": 53008737, "body": "@Cactus - seems to shave about .1 secs off of the loading time - see Test4b in the repo."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1442388813, "post_id": 32574828, "comment_id": 53056822, "body": "Apparently <code>String</code>s are awful in term of performance, compared to <code>Text</code>. I wonder why they&#39;re the default then. Your version is much better than mine. I could probably try Tries also. That way it would consume less memory, wouldn&#39;t it? In any case, as of now memory consuption dropped considerably and it&#39;s not an issue. Probably regexes and Strings were the culprit."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1442393454, "post_id": 32574828, "comment_id": 53059482, "body": "It&#39;s an historical accident. See <a href=\"http://stackoverflow.com/a/13866019/866915\">stackoverflow.com/a/13866019/866915</a> for more details."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442454913, "post_id": 32574828, "comment_id": 53093087, "body": "@user5402: So... 5% improvement? I think it&#39;s worth changing it in your original answer."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1442270986, "last_edit_date": 1442270986, "creation_date": 1442269174, "answer_id": 32574828, "question_id": 32570604, "link": "https://stackoverflow.com/questions/32570604/haskell-version-of-peter-norvigs-spelling-corrector-is-unbelievably-slow/32574828#32574828", "title": "Haskell version of Peter Norvig&#39;s spelling corrector is unbelievably slow", "body": "<p>My main suggestions are:</p>\n\n<ul>\n<li>use an efficient string type (i.e. Text / ByteString or their lazy variants)</li>\n<li>use a better hash map implementation - something like <code>Data.HashMap.Strict</code></li>\n<li>write a custom word parser instead of using regexs</li>\n</ul>\n\n<p>The following code can load all of <code>big.txt</code> into a <code>Data.Hashmap.Strict</code> in about 2 secs. Memory usage is about 25 MB (on a 64-bit system):</p>\n\n<pre><code>import qualified Data.HashMap.Strict as H\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport Data.List\n\nisAlpha ch = ('a' &lt;= ch &amp;&amp; ch &lt;= 'z') || ('A' &lt;= ch &amp;&amp; ch &lt;= 'Z')\n\nwrds :: T.Text -&gt; [ T.Text ]\nwrds bs =\n  let\n      (_, r1) = T.span (not . isAlpha) bs\n      (w, r2) = T.span isAlpha r1\n  in if T.null w then [] else T.toLower w : wrds r2\n\nreadDict = do\n  allwords &lt;- fmap wrds $ T.readFile \"big.txt\"\n  let h = foldl' add H.empty all words\n      add h w = let c = H.lookupDefault (0 :: Int)  w h\n                in  H.insert w (c+1) h\n      member = \\k -&gt; H.member k h\n      frequency = \\k -&gt; H.lookupDefault 0 k h\n  return (member, frequency)\n</code></pre>\n\n<p>It might be more efficient to use lazy Text - something to investigate.</p>\n\n<p>Here's the rest of my implementation - pretty much follows Norvig but I've made some other choices which you might find interesting:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule SpellText\nwhere\n\nimport qualified Data.Text as T\nimport Data.Text (Text)\nimport Data.Monoid\nimport Data.List.Ordered (nubSort)\nimport Data.Ord\nimport Data.List\nimport Control.Monad\n\ntype Dict = ( Text -&gt; Bool, Text -&gt; Int )\n\nsingles :: [ Text ]\nsingles = map T.singleton ['a'..'z']\n\nedits :: Text -&gt; [ Text ]\nedits w = deletes &lt;&gt; nubSort (transposes &lt;&gt; replaces) &lt;&gt; inserts\n  where\n    splits     = zip (T.inits w) (T.tails w)\n    deletes    = [ a &lt;&gt; (T.drop 1 b) | (a,b) &lt;- splits, T.length b &gt; 0 ]\n    transposes = [ a &lt;&gt; c &lt;&gt; (T.drop 2 b) | (a,b) &lt;- splits, T.length b &gt; 1,\n                   let c = T.pack [ T.index b 1, T.index b 0 ] ]\n    replaces   = [ a &lt;&gt; c &lt;&gt; (T.drop 1 b) | (a,b) &lt;- splits, T.length b &gt; 1,\n                    c &lt;- singles ]\n    inserts    = [ a &lt;&gt; c &lt;&gt; b | (a,b) &lt;- splits, c &lt;- singles ]\n\norElse :: [a] -&gt; [a] -&gt; [a]\norElse [] bs = bs\norElse as _  = as\n\n-- | Correct a word. 'isMember' and 'frequency' are functions to\n--   determine if a word is in the dictionary and to lookup its\n--   frequency, respectively.\ncorrect :: Dict -&gt; Text -&gt; Text \ncorrect (isMember,frequency) w0 = \n  let ed0 = [ w0 ]\n      ed1 = edits w0\n      ed2 = [ e2 | e1 &lt;- ed1, e2 &lt;- edits e1 ]\n\n      kn0 = filter isMember ed0\n      kn1 = filter isMember ed1\n      kn2 = filter isMember ed2\n\n      candidates = kn0 `orElse` (kn1 `orElse` (kn2 `orElse` [w0]))\n  in maximumBy (comparing frequency) candidates\n</code></pre>\n\n<p>Usage goes like this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport ... -- import the above code\n\nmain = do\n  dictfns &lt;- readDict\n  print $ correct dictfns \"howwa\"\n</code></pre>\n\n<p>My measured correction time is comparable to the Python version - perhaps 10% faster.</p>\n"}], "owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 32574828, "answer_count": 2, "score": 2, "last_activity_date": 1442270986, "creation_date": 1442252130, "question_id": 32570604, "link": "https://stackoverflow.com/questions/32570604/haskell-version-of-peter-norvigs-spelling-corrector-is-unbelievably-slow", "title": "Haskell version of Peter Norvig&#39;s spelling corrector is unbelievably slow", "body": "<p>As an exercise, I wrote Peter Norvig's <a href=\"http://norvig.com/spell-correct.html\" rel=\"nofollow\">spelling corrector algorithm</a> in Haskell:</p>\n\n<pre><code>module Spl (nwords, correct)\n    where\n\nimport Data.Char (toLower)\nimport Data.Ord (comparing)\nimport Data.List (maximumBy, splitAt, foldl')\nimport Text.Regex.TDFA (getAllTextMatches, (=~))\n\nimport qualified Data.Set as Set\nimport qualified Data.Map.Strict as Map\n\ntype NWords = Map.Map String Int\n\n\nalphabet :: String\nalphabet = enumFromTo 'a' 'z'\n\nnwords :: String -&gt; Map.Map String Int\nnwords = train . words'\n\nuniqueElems :: Ord a =&gt; [a] -&gt; [a]\nuniqueElems = uniq' Set.empty\n    where uniq' _ [] = []\n          uniq' seen (x:xs)\n            | x `Set.member` seen = uniq' seen xs\n            | otherwise           = x:uniq' (x `Set.insert` seen) xs\n\nwords' :: String -&gt; [String]\nwords' = getAllTextMatches . flip (=~) \"[a-z]+\" . map toLower\n\ntrain :: [String] -&gt; NWords\ntrain = foldl' populate Map.empty\n    where populate m feature = Map.insertWith (+) feature 1 m\n\nedits :: String -&gt; [String]\nedits word = uniqueElems $ concat [dels, trans, repl, ins]\n    where dels   = [a ++ tail b | (a,b) &lt;- splits, nn b]\n          trans  = [ a ++ (b!!1):head b:tail (tail b) | (a,b) &lt;- splits\n                   , length b &gt; 1]\n          repl   = [a ++ c:tail b | (a,b) &lt;- splits, c &lt;- alphabet, nn b]\n          ins    = [a ++ c:b | (a,b) &lt;- splits, c &lt;- alphabet]\n          splits = [splitAt n word | n &lt;- [0..length word]]\n          nn     = not . null\n\nknownEdits :: NWords -&gt; String -&gt; [String]\nknownEdits nw word = uniqueElems [ e2 | e1 &lt;- edits word, e2 &lt;- edits e1\n                                 , Map.member e2 nw]\n\nknown :: NWords -&gt; [String] -&gt; [String]\nknown nw = uniqueElems . filter (`Map.member` nw)\n\ncorrect :: NWords -&gt; String -&gt; String\ncorrect nw word = fst $ maximumBy (comparing snd) candidates\n    where candidates = [(w, Map.findWithDefault 0 w nw) | w &lt;- result]\n          result     = head $ filter (not . null) start\n          start      = [ known nw [word], known nw $ edits word\n                       , knownEdits nw word , [word]]\n</code></pre>\n\n<p><strong>Usage</strong><br>\nThis is how I would use it:</p>\n\n<pre><code>ghci&gt; t &lt;- readFile \"big.txt\"\nghci&gt; let nw = nwords t\nghci&gt; correct nw \"speling\"\n\"spelling\"\n</code></pre>\n\n<p>The <code>big.txt</code> file is available on Peter Norvig's site (direct link, 6.2MB):\n<a href=\"http://norvig.com/big.txt\" rel=\"nofollow\">http://norvig.com/big.txt</a></p>\n\n<p><strong>Problems</strong></p>\n\n<ul>\n<li>Building the words map takes <em>ages</em>. The <code>train</code> function is much slower, than <code>words'</code>, so it's the bottleneck.</li>\n<li>Memory usage is insane. After playing for a while I got it to almost 1 GB.</li>\n</ul>\n\n<p>So, where did I get it wrong? Do I have a memory leak somewhere?</p>\n"}, {"tags": ["list", "haskell", "type-systems", "dependent-type"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1442251455, "post_id": 32570183, "comment_id": 52996082, "body": "Are you OK with adding another tool to the toolbox? Liquid Haskell can encode such a property easily, but the GHC Haskell type system would require a new type, such as a GADT with Peano numbers."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1442252861, "post_id": 32570183, "comment_id": 52996841, "body": "Using a length-indexed list type also makes your functions incompatible with functions that work on ordinary lists, and you lose (or have to reimplement) GHC&#39;s list fusion."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442253535, "post_id": 32570183, "comment_id": 52997199, "body": "Thomas, thanks for the suggestion of Liquid Haskell (also mentioned in Justin&#39;s answer). Providing it is mature (i.e., not experimental), and does not adversely affect the performance of the compiled code, I would not be against adding toolkits to solve the answer. Reid, thanks for your observation; loosing compatibility with existing functions/list-fusion is something that I&#39;m keen to avoid."}], "answers": [{"comments": [{"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442252595, "post_id": 32570471, "comment_id": 52996698, "body": "Many thanks, Justin, this looks like what I want, although I&#39;ll need a moment to understand your answer. In the mean time, I wonder if you could add a comment: if you were to implement <code>f</code> and <code>g</code>, is this how you choose to implement them yourself, or would you prefer to leave them &quot;unannotated&quot; (i.e., as typed in my original question)?"}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 1, "creation_date": 1442254256, "post_id": 32570471, "comment_id": 52997587, "body": "For anyone else, I believe that the <code>V</code> type in this answer refers to: <a href=\"http://hackage.haskell.org/package/linear-1.20.1/docs/Linear-V.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/linear-1.20.1/docs/Linear-V.html</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442255716, "post_id": 32570471, "comment_id": 52998423, "body": "Sometimes you can also &quot;prove&quot; things that the compiler is not able to infer by adding some code so to build a suitable &quot;proof&quot;. This more or less requires one to pretend Haskell is more like Agda (albeit with different types). This is not for the faint of heart, of course, but can avoid the unsafe coercion you mention at the end of the answer."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442302978, "post_id": 32570471, "comment_id": 53015003, "body": "@user196429 There are a lot of situations where I&#39;ve benefited greatly from having type safety in list lengths.  Typically these are situations where an entire <i>class</i> of buggy implementations/programs are completely eliminated.  The situation that you mentioned (you want to annotate that your function takes same-length lists) does happen, but what happens more for me is I write the annotation first and then attempt to implement it; GHC will then <i>guarantee</i> that my implementation is correct.  this eliminates scores of bad implementations off the bat, and I think this is often a great benefit."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442526313, "post_id": 32570471, "comment_id": 53129582, "body": "@justinL Thanks for your answer and comments. I like the cleanness of the type-definitions of <code>f</code> and <code>g</code> in your answer, but I was unable to create a MWE using Linear.V to solve my problem. The reason, assuming I understand it correctly, I was a little slow to grasp. While the writing of <code>f</code> was trivial, I was unable to instantiate a <code>V n a</code> object because I didn&#39;t know its dimensions at compile time (I was reading data from a file), and so while <code>f</code> can be polymorphic on <code>n</code>, the instance of <code>V</code> itself cannot (as I understand it). ... awkward!"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442909379, "post_id": 32570471, "comment_id": 53265782, "body": "@sircolinton actually, you can, using existential types.  There isn&#39;t one built in in <i>linear</i>, but you can make a <code>data AnyV a where AV :: KnownNat n =&gt; V n a -&gt; AnyV a</code>, which you can pattern match on using case statements, etc.; you just need to make sure that whatever you <i>do</i> with the <code>V n a</code> is something you can do with <i>any</i> <code>n</code>...so you are fine to use things like <code>f</code> and <code>g</code> on it in case statements."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442929748, "post_id": 32570471, "comment_id": 53279697, "body": "@JustinL. Ah :-) I didn&#39;t realise, thanks! I&#39;ve not had a chance to try this out yet, but wouldn&#39;t <code>f</code> (and <code>g</code>) then need to be defined in terms of <code>AnyV a</code> instead of <code>V n a</code>, and if so, wouldn&#39;t that cause it to loose its ability to ensure that the lengths of both its parameters are equal?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442958555, "post_id": 32570471, "comment_id": 53297383, "body": "@sircolinton you can define f and g in the &quot;safe&quot; way, and then apply then to an AnyV using pattern matching and case statements: <code>case av of AV v -&gt; AV (f v)</code>.  The way to make the most of this is similar to the philosophy of pure/impure code etc: write as much of your logic as possible in the safe way, where it&#39;s composable and ghc-verifiable and typesafe, and then use it on AV&#39;s as one-shots using case statements at the barrier of &quot;pure&quot;  and &quot;impure&quot;  code."}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": 6, "last_activity_date": 1442252165, "last_edit_date": 1442252165, "creation_date": 1442251649, "answer_id": 32570471, "question_id": 32570183, "link": "https://stackoverflow.com/questions/32570183/haskell-specifying-equal-length-constraints-of-lists-in-the-type-system/32570471#32570471", "title": "Haskell: Specifying equal-length constraints of lists in the type system", "body": "<p>The lack you observe is because the information of length is not a part of the <em>type</em> of the list; because the type checker is meant to reason about types, you can't specify invariants in your functions <em>unless</em> the invariants are in the <em>type</em> of the arguments themselves, or on typeclass constraints or type family-based equalities.  (There are some haskell pre-processors, though, like Liquid Haskell, that allow you to annotate functions with invariants like this that will be checked on compilation.)</p>\n\n<p>there are many haskell libraries that offer list-like data structures with length encoded in the type.  Some notable ones are <em>linear</em> (with <code>V</code>) and <em>fixed-vector</em>.</p>\n\n<p>The interface for <code>V</code> goes something like this:</p>\n\n<pre><code>f :: V n a -&gt; V n a -&gt; V n a\ng :: V n a -&gt; V n a -&gt; [a]\n-- or --\ng :: V n a -&gt; V n a -&gt; V ?? a -- if ?? can be determined at compile-time\n</code></pre>\n\n<p>Note the particular pattern of our first type signature for <code>g</code>: We take two types where we care about the lengths, and return a type that <em>doesn't</em> care about the length, losing information.</p>\n\n<p>In the second case, if we <em>do</em> care about the length of the result, the length has to be known at compile-time for this to make sense.</p>\n\n<p>Note that <code>V</code> from linear actually doesn't wrap a list, but a Vector from the vectors library.  It also requires <em>lens</em> (the linear library, that is), which is admittedly a huge dependency to pull in if all you want is length-encoded vectors.  I think the vector type from <em>fixed-vectors</em> does use something more equivalent to a normal haskell list...but I'm not totally sure.  In any case, it has a <code>Foldable</code> instance, so you can convert it to a list.</p>\n\n<p>Do remember of course that if you plan to encode lengths in your functions like this...Haskell/GHC has to be able to see that your implementation typechecks!  For most of these libraries, Haskell will be able to typecheck things like this (if you stick with things like zipping and fmapping, binding, ap-ping).  For most useful cases this is true...however, sometimes your implementation just can't be \"proven\" by the compiler, so you'll have to \"prove\" it to yourself in your head, and use some sort of unsafe coercion.</p>\n"}, {"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 2, "creation_date": 1442251950, "post_id": 32570481, "comment_id": 52996334, "body": "Note that this definition isn&#39;t really too usable in real code, because it forbids Functor, Appilcative, Traversable, Foldable, Monad, etc. instances, which end to be the most effective ways to work with types like these because they all offer length-preserving or length-agnostic operations.  Also, in modern haskell, using <code>DataKinds</code> to create a Nat <i>kind</i> is preferred too because it prevents some meaningless <code>List</code> type instantiations."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442252903, "post_id": 32570481, "comment_id": 52996863, "body": "Many thanks, Sam. This, as well as Justin&#39;s answer, looks like what I want (although it will take me a while to fully understand your answer). Presently, I think I prefer Justin&#39;s as his types for <code>f</code> and <code>g</code> feel more intuitive to me. I wonder if I could ask you the same as I asked Justin; that is, if you were to implement <code>f</code> and <code>g</code>, would you annotate them as in your code snippet (and thanks, by the way, for the MWE), or would you leave them unannotated, with the types initially given in my question?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442253996, "post_id": 32570481, "comment_id": 52997463, "body": "I&#39;m not sure what you mean by the annotations, could you explain?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442256382, "post_id": 32570481, "comment_id": 52998793, "body": "To clarify Justin L.&#39;s comment a bit, you can improve your type by changing the order of its arguments from <code>List a n</code> to <code>List n a</code>."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442257204, "post_id": 32570481, "comment_id": 52999251, "body": "I meant, if you were to need to implement the functions <code>f</code> and <code>g</code>, would you bother trying to specify their length-related constraints in the type system? In the past, I have always just defined <code>f</code> with the type <code>[a] -&gt; [a]</code> and added a comment in the code that its result shall be of equal length to its argument. Today, for whatever reason, I felt more inclined than normal to provide a guarantee that this would be the case (i.e., by means of the type system). How do you normally deal with the likes of <code>f</code> and <code>g</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1442257972, "post_id": 32570481, "comment_id": 52999610, "body": "In modern GHC it&#39;s preferable to use <code>DataKinds</code> and <code>data Nat = Z | S Nat</code>. Also, as dfeuer pointed out, the type parameters should be flipped, so we can create the usual instances (and I should mention that <code>Eq</code>, <code>Ord</code>, <code>Foldable</code>, <code>Functor</code> and <code>Traversable</code> are all derivable with <code>StandaloneDeriving</code>)."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 0, "creation_date": 1442260143, "post_id": 32570481, "comment_id": 53000745, "body": "Thanks for the comments, I updated the answer. @user196429: I think it&#39;s very situational whether you want the same-length guarantee on the type-level. It&#39;s really all about how important it is to you to get the error at compile-time. Personally I would probably go for the monadic (/applicative) failure option in most situations, because as Reid Barton and others mention it&#39;s quite a hassle to change the whole list type."}, {"owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "edited": false, "score": 1, "creation_date": 1442526913, "post_id": 32570481, "comment_id": 53129824, "body": "@SamvanHerwaarden Thanks for your answer and comments. If I understand correctly, I&#39;m unable to define <code>readList :: FilePath -&gt; List n c</code>, which I perhaps should have realised a little earlier (&quot;the length of the list must be known at <i>compile time</i>&quot;!), and so it unfortunately it&#39;s not exactly what I want, but I&#39;m getting the impression that I cannot do exactly what I want with present-day Haskell."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 8, "last_activity_date": 1442260244, "last_edit_date": 1442260244, "creation_date": 1442251679, "answer_id": 32570481, "question_id": 32570183, "link": "https://stackoverflow.com/questions/32570183/haskell-specifying-equal-length-constraints-of-lists-in-the-type-system/32570481#32570481", "title": "Haskell: Specifying equal-length constraints of lists in the type system", "body": "<p>The following code is adapted from <a href=\"http://www.haskellforall.com/2012/06/gadts.html\" rel=\"noreferrer\">Gabriel Gonzalez's blog</a> in combination with some information supplied in the comments:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds #-}\n\ndata Nat = Z | S Nat\n\n-- A List of length 'n' holding values of type 'a'\ndata List n a where\n    Nil  :: List Z a\n    Cons :: a -&gt; List m a -&gt; List (S m) a\n\n-- Just for visualization (a better instance would work with read)\ninstance Show a =&gt; Show (List n a) where\n    show Nil = \"Nil\"\n    show (Cons x xs) = show x ++ \"-\" ++ show xs\n\ng :: (a -&gt; b -&gt; c) -&gt; List n a -&gt; List n b -&gt; List n c\ng f (Cons x xs) (Cons y ys) = Cons (f x y) $ g f xs ys\ng f Nil Nil = Nil\n\nl1 = Cons 1 ( Cons 2 ( Nil ) ) :: List (S (S Z)) Int\nl2 = Cons 3 ( Cons 4 ( Nil ) ) :: List (S (S Z)) Int\nl3 = Cons 5 (Nil) :: List (S Z) Int\n\nmain :: IO ()\nmain = print $ g (+) l1 l2\n       -- This causes GHC to throw an error:\n       -- print $ g (+) l1 l3\n</code></pre>\n\n<p>This alternative list definition (using GADTs and DataKinds) encodes the length of a list in its type. If you then define your function <code>g :: List n a -&gt; List n a -&gt; ...</code> the type system will complain if the lists are not of the same length.</p>\n\n<p>In case this would (understandably) be too much extra complication for you, I'm not sure using the type system would be the way to go. The easiest is to define <code>g</code> using a monad/applicative (e.g. <code>Maybe</code> or <code>Either</code>), let <code>g</code> add elements to your list depending on both inputs, and sequence the result. I.e.</p>\n\n<pre><code>g :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; Maybe [c]\ng f l1 l2 = sequence $ g' f l1 l2\n  where g' f (x:xs) (y:ys) = (Just $ f x y) : g' f xs ys\n        g' f [] [] = []\n        g' f _ _ = [Nothing]\n\nmain :: IO ()\nmain = do print $ g (+) [1,2] [2,3,4] -- Nothing\n          print $ g (+) [1,2,3] [2,3,4] -- Just [3,5,7]\n</code></pre>\n"}], "owner": {"reputation": 5446, "user_id": 196429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0df62a310a2cf98d043c3f21e1889cee?s=128&d=identicon&r=PG", "display_name": "sircolinton", "link": "https://stackoverflow.com/users/196429/sircolinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 2, "accepted_answer_id": 32570481, "answer_count": 2, "score": 9, "last_activity_date": 1442260244, "creation_date": 1442250471, "last_edit_date": 1442253101, "question_id": 32570183, "link": "https://stackoverflow.com/questions/32570183/haskell-specifying-equal-length-constraints-of-lists-in-the-type-system", "title": "Haskell: Specifying equal-length constraints of lists in the type system", "body": "<p>In Haskell, I often have a function like <code>f</code>, which accepts a list and returns a list of equal length:</p>\n\n<pre><code>f :: [a] -&gt; [a]  -- length f(xs) == length xs\n</code></pre>\n\n<p>Similarly, I might have a function like <code>g</code>, which accepts two lists that should be of equal length:</p>\n\n<pre><code>g :: [a] -&gt; [a] -&gt; ...\n</code></pre>\n\n<p>If <code>f</code> and <code>g</code> are typed as above, then run-time errors may result if their length-related constraints are not satisfied. I would therefore like to encode these constraints in the type system. How might I do this?</p>\n\n<p>Please note that I'm looking for a practical framework that may be used in everyday situations, adding as little intuitive overhead to the code as possible. I am particularly interested to know how you would deal with <code>f</code> and <code>g</code> yourself; that is, would you attempt to add the length-related constraints to their types, as asked here, or would you leave them with the types as given above for simplicity of code?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1442249740, "post_id": 32569852, "comment_id": 52995108, "body": "The power of monads extends far beyond knowing what is and is not pure.  Keep trying, you&#39;ll get it."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1442249859, "post_id": 32569852, "comment_id": 52995173, "body": "A clear advantage is that using monads gives you a clear abstraction to use the same functions across many different monads.  Just look at all the functions in <code>Control.Monad</code> and elsewhere, there are dozens of combinators that work with <code>Monad m =&gt; ...</code>, regardless of which monad it is.  This lets you reuse powerful tools in a lot of cases."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442250144, "post_id": 32569852, "comment_id": 52995326, "body": "Your question appears to assume that the only point in separating pure things from impure ones is enabling the compiler to do more oprimisations. However, tracking side effects is useful not only just for the compiler, but also for the humans writing and reading code. Tracking side-effects with types gives us reliable and easily accessible information about their presence or absence, information which is extremely useful when structuring programs."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1442250402, "post_id": 32569852, "comment_id": 52995451, "body": "I&#39;ve always found it more useful to look at what constitutes a monad (based on the type signature and the laws). Cute analogies like &quot;it&#39;s kind of like containers&quot; and &quot;it&#39;s used for sequencing actions&quot; work well for some particular instances, but aren&#39;t generally useful to understanding what&#39;s actually going on."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1442250749, "post_id": 32569852, "comment_id": 52995659, "body": "@Cubic I see monads as a way to process the sequence of functions in <code>a &gt;&gt; ... &gt;&gt; z</code> into whatever we need and finally <code>return ...</code> the result of such processing. What I am not getting is how such thing can be so powerfull as people say."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1442250974, "post_id": 32569852, "comment_id": 52995817, "body": "Because that&#39;s not what a monad is. <code>Monad</code> is a much higher level abstraction than just sequencing. &quot;Just sequencing&quot; is basically what you get from <code>Monoid</code> (or rather, <code>Semigroup</code> but that&#39;s not in base (yet)). If you want to stay within the sequencing analogy, a <code>Monad</code> is an <code>Applicative</code> functor with the ability to sequence and branch on previous &#39;results&#39;."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1442251418, "post_id": 32569852, "comment_id": 52996058, "body": "@Cubic When I said to &quot;process the sequence&quot; I meant that the monad consumes <code>a &gt;&gt; b ... &gt;&gt; z</code> by this order, but it can process them internally at will and do whatever the monad was designed to do, for example, when calling <code>return</code> at the end of the <code>do</code> block. As such, the monad can be used to implement some processing strategy for the a, b, and zs. Isn&#39;t this what a monad is supposed to be used?"}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1598977214, "post_id": 32569852, "comment_id": 112628207, "body": "More information needed: you mention &quot;some order would be necessary&quot;, but haven&#39;t specified how your implementation selects which order to use e.g. <code>(print &quot;World!&quot;, print &quot;Hello, &quot;)</code> or <code>(print &quot;Hello, &quot;, print &quot;World!&quot;)</code> - a language like Haskell is <i>nonstrict</i>, so you cannot rely on syntactic ordering as you would for e.g. Standard ML."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1442250508, "post_id": 32570080, "comment_id": 52995513, "body": "&quot;Its a myth that Haskell monads are about impurity&quot; is a very important remark. <code>Monad</code> is a very general and abstract (which makes it a little tricky to grasp at first) but ultimately quite simple interface. IO just happens to be one of its many use cases."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 4, "last_activity_date": 1442250067, "creation_date": 1442250067, "answer_id": 32570080, "question_id": 32569852, "link": "https://stackoverflow.com/questions/32569852/how-does-the-monad-based-io-design-of-haskell-contrasts-with-one-based-on-tagg/32570080#32570080", "title": "How does the &quot;monad-based IO&quot; design of Haskell contrasts with one based on tagging pure/impure code?", "body": "<p>Haskell does something like this with the IO type. However the Haskell type system is more general. You can think of a monad as a declaration of the potential scope of side effects, so rather than having a binary pure/impure flag you can have a much more sophisticated system.</p>\n\n<p>Of course its a myth that Haskell monads are about \"impurity\". IO is a bit of a special case of course, but all the other monads are written in Haskell with a perfectly pure implementation of \"bind\". (Well, maybe ST and STM need a bit of magic from the run-time system for efficiency, but they <em>could</em> be written in Haskell).</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1442250067, "creation_date": 1442249262, "last_edit_date": 1442250059, "question_id": 32569852, "link": "https://stackoverflow.com/questions/32569852/how-does-the-monad-based-io-design-of-haskell-contrasts-with-one-based-on-tagg", "title": "How does the &quot;monad-based IO&quot; design of Haskell contrasts with one based on tagging pure/impure code?", "body": "<p>The IO Monad is known to separate pure from impure code in Haskell, such that a signature like <code>f :: ... -&gt; IO ?</code> represents an action with side-effects, otherwise it is a pure function.</p>\n\n<p>In addition, monads are used in Haskell as a purely functional mechanism to sequence actions, which otherwise could be unexpectedly reordered by a compiler that is designed to deal with only pure functions.</p>\n\n<p>The trouble with a design around monads is that they seem hard to understand to many, perhaps including myself, so I wonder if they are the best way to separate the pure from impure code in software development.</p>\n\n<p>I suppose that if we had a language where all primitives would be tagged as pure and impure, a compiler could easily infer the purity of any function using the primitives directly or indirectly, which would be a much simpler design. Such compiler would then know which parts of the code could be reordered because they are pure, or some order would be necessary due to the presence of side-effects.</p>\n\n<p>So, my question is:</p>\n\n<p>What are the advantages/disadvantages of \"monad-based IO\" design in comparison to one based on tagging pure/impure primitives in the language, that I described above?</p>\n"}, {"tags": ["haskell", "version", "atom-editor", "cabal", "haskell-platform"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 7, "creation_date": 1442232819, "post_id": 32564426, "comment_id": 52983971, "body": "That&#39;s the wrong way. Upgrade <code>ghc-mod</code>, don&#39;t downgrade cabal."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1456439227, "creation_date": 1456439227, "answer_id": 35639662, "question_id": 32564426, "link": "https://stackoverflow.com/questions/32564426/how-to-downgrade-cabal-version-in-haskell-platform/35639662#35639662", "title": "How to downgrade cabal version in Haskell platform?", "body": "<p>The ./activate-hs script only switches between different already installed platform versions. So if you don't have a prior version of the platform installed it won't help. More generally, you should not probably not downgrade cabal versions, as often compilers are coupled to particular releases of cabal.</p>\n\n<p>But if you did want to, the correct way would just be to create a sandbox and then run <code>cabal-install cabal-install-1.20.2.0</code> or the like. You can then take the resultant binary and move it into your path directly.</p>\n"}], "owner": {"reputation": 183, "user_id": 1106282, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/fc860b68d1e8e2d7b6252377f7e7e347?s=128&d=identicon&r=PG", "display_name": "Marcelo Concei&#231;&#227;o", "link": "https://stackoverflow.com/users/1106282/marcelo-concei%c3%a7%c3%a3o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1510, "favorite_count": 0, "accepted_answer_id": 35639662, "answer_count": 1, "score": 3, "last_activity_date": 1484848628, "creation_date": 1442232515, "last_edit_date": 1484848628, "question_id": 32564426, "link": "https://stackoverflow.com/questions/32564426/how-to-downgrade-cabal-version-in-haskell-platform", "title": "How to downgrade cabal version in Haskell platform?", "body": "<p>I've installed the Haskell platform which came with the <code>7.10.2</code> version of ghc and the <code>1.22.6.0</code> version of cabal. My favorite editor is Atom, so I've installed the <code>ide-haskell</code> and <code>haskell-ghc-mod</code>. Since the <code>ghc-mod</code> has some problems with <code>cabal&gt;=1.22</code>, I need to downgrade cabal. Haskel platform came with an <code>activate-hs</code> script to switch versions but I didn't understand how it works. </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442232630, "post_id": 32563737, "comment_id": 52983844, "body": "In OOP, same-name methods are allowed because the type of the <code>this</code> object can disambiguate among them. In Haskell, there&#39;s no <code>this</code> around: methods for <code>Foo a</code> do not implicitly take an <code>a</code> argument. Even if they did, type inference would become quite complicated, since you need to compute the type of <code>this</code> <i>before</i> you can know the type of the method. In most OOP languages, there&#39;s no or little type inference w.r.t. functional languages, so this is not a problem there."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1442236532, "post_id": 32563737, "comment_id": 52986529, "body": "Also, these are functions not methods, to be precise."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1442237795, "post_id": 32563737, "comment_id": 52987464, "body": "@Erik Alik: Actually, even though it&#39;s very different from the OO concept, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"nofollow noreferrer\">the word &#39;method&#39; is technically correct</a>."}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 9, "creation_date": 1442236564, "post_id": 32563738, "comment_id": 52986552, "body": "So it&#39;s &quot;yes, you can, if ...&quot; not &quot;no you cannotl :)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1442266692, "post_id": 32563738, "comment_id": 53003807, "body": "@ErikAllik They literally can&#39;t have the same names. Qualifying causes them to have different names."}], "tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 4, "last_activity_date": 1442273189, "last_edit_date": 1442273189, "creation_date": 1442230308, "answer_id": 32563738, "question_id": 32563737, "link": "https://stackoverflow.com/questions/32563737/can-two-different-typeclasses-have-the-same-method-names/32563738#32563738", "title": "Can two different typeclasses have the same method names?", "body": "<p>No, you cannot, at least within the same module. You <em>can</em> declare <code>class Foo</code> and <code>class Bar</code> in two different modules and import each of them into the same file, but you'll still have to <code>qualify</code> at least one of those imports to avoid conflicts.</p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 5771177, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f66c6628f434a7998195c89f2af5427b?s=128&d=identicon&r=PG&f=1", "display_name": "suffi", "link": "https://stackoverflow.com/users/5771177/suffi"}, "edited": false, "score": 1, "creation_date": 1476547506, "post_id": 32573055, "comment_id": 67396393, "body": "In your example you mean <code>Map.map</code>, or <code>import qualified Data.Map as Data</code>,  right?"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 5, "last_activity_date": 1442261271, "creation_date": 1442261271, "answer_id": 32573055, "question_id": 32563737, "link": "https://stackoverflow.com/questions/32563737/can-two-different-typeclasses-have-the-same-method-names/32573055#32573055", "title": "Can two different typeclasses have the same method names?", "body": "<p>This question has a subtle \"no but yes\" kind of answer, which requires going into three concepts:</p>\n\n<ol>\n<li>Qualified names vs. unqualified names</li>\n<li>Modules and imports</li>\n<li>Aliasing</li>\n</ol>\n\n<p>Point 1: every definition in Haskell has both a short, unqualified name like <code>map</code>, and a long, qualified name like <code>Data.List.map</code>.  </p>\n\n<p>Point 2: when you import a module into another, you can do either a qualified or an unqualified import.  When you use unqualified import, the foreign module's names that you bring in will be aliased under their short names.  When you do a qualified import, they will only be available under a modified name:</p>\n\n<pre><code>import qualified Data.Map as Map\n</code></pre>\n\n<p>Now in the module where this appeared, the <code>Data.Map.map</code> function is visible under the alias <code>Data.map</code>.</p>\n\n<p>Third point: this means that every Haskell definition has a fully qualified name determined by its short name and the module where it's defined, but also unqualified or partially qualified aliases in each module where it is imported.</p>\n\n<p>Now, your question has two answers:</p>\n\n<ol>\n<li>Two different classes <strong>cannot</strong> have methods that share the same <em>fully qualified</em> name.  So if you define your <code>Foo</code> and <code>Bar</code> classes in the same module, that will fail.</li>\n<li>Two different classes <strong>can</strong> have methods that share the same <em>unqualified name</em>, as long as their fully qualified names are different\u2014i.e., they're defined in different modules.  To use both within one client module, however, you will need at least one qualified import so the aliases from the import don't clash.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1476, "user_id": 700597, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/rWtor.jpg?s=128&g=1", "display_name": "runeks", "link": "https://stackoverflow.com/users/700597/runeks"}, "is_accepted": false, "score": 0, "last_activity_date": 1476523184, "creation_date": 1476523184, "answer_id": 40057281, "question_id": 32563737, "link": "https://stackoverflow.com/questions/32563737/can-two-different-typeclasses-have-the-same-method-names/40057281#40057281", "title": "Can two different typeclasses have the same method names?", "body": "<p>The following compiles without any errors:</p>\n\n<p>Main.hs:</p>\n\n<pre><code>module Main where\n\nimport qualified Foo\nimport Bar\n\ninstance Foo.Foo Char where\n    c1 ++= c2 = c1\n\ninstance Bar Char where\n    f ++= c = f c\n\nmain = do\n    putStrLn $ [ 'a' Foo.++= 'b' ] \n</code></pre>\n\n<p>Foo.hs:</p>\n\n<pre><code>module Foo where\n\nclass Foo a where\n    (++=) :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>Bar.hs:</p>\n\n<pre><code>module Bar where\n\nclass Bar a where\n    (++=) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>So, in other words, we don't need to reference <code>++=</code> using its fully qualified name inside the instance declaration, but when used inside <code>main</code>, we need to specify which <code>++=</code> we're talking about. In the instance declaration, we've already defined the scope for <code>++=</code>, while <code>main</code> wouldn't know which one was being referred to, if we used unqualified imports. Therefore, if all we wanted to do was to define class instances, then we wouldn't need the qualified import.</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 0, "accepted_answer_id": 32573055, "answer_count": 3, "score": 11, "last_activity_date": 1476523184, "creation_date": 1442230308, "last_edit_date": 1442231333, "question_id": 32563737, "link": "https://stackoverflow.com/questions/32563737/can-two-different-typeclasses-have-the-same-method-names", "title": "Can two different typeclasses have the same method names?", "body": "<p>Suppose I have</p>\n\n<pre><code>class Foo a where\n    (++=) :: a -&gt; a -&gt; a\n    cool  :: (a -&gt; b -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>and want to make </p>\n\n<pre><code>class Bar a where\n    (++=) :: (a -&gt; b) -&gt; a -&gt; b\n    magic :: a -&gt; b\n</code></pre>\n\n<p>which has an overlapping method name, <code>(++=)</code>. Is there some way I can do this? </p>\n"}, {"tags": ["haskell", "where"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 19, "last_activity_date": 1442252674, "last_edit_date": 1442252674, "creation_date": 1442227196, "answer_id": 32562766, "question_id": 32562614, "link": "https://stackoverflow.com/questions/32562614/is-something-in-the-where-clause-in-haskell-only-calculated-once/32562766#32562766", "title": "Is something in the &#39;where&#39; clause in Haskell only calculated once?", "body": "<p>Maybe it's not evaluated at all (the joy of laziness) - but if it is, it should only be evaluated once - if you like, you can try for yourself with <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Debug-Trace.html#v:trace\" rel=\"noreferrer\"><code>trace</code></a>:</p>\n\n<pre><code>import Debug.Trace(trace)\n\nfunc n = m ++ [1] ++ m ++ [0] ++ m\n  where m = func2 n\n\nfunc2 n = trace \"called...\" [n]\n</code></pre>\n\n<p>Here is an example in GHCi:</p>\n\n<pre><code>\u03bb&gt; func 3\ncalled...\n[3,1,3,0,3]\n</code></pre>\n\n<p>And here is one where you see that it might not get called (till you finally need to evaluate it):</p>\n\n<pre><code>\u03bb&gt; let v = func 4\n\n\u03bb&gt; v\ncalled...\n[4,1,4,0,4]\n</code></pre>\n\n<p>See: at first it is not called - only when you finally evaluate <code>v</code> (to print it) you get the call.</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1442253954, "post_id": 32567718, "comment_id": 52997430, "body": "thanks - very good point - I indeed did not think of  this here at all. It&#39;s really hard to give correct answers on Haskell when it comes to details like this - there is usually an extension that renders your intuition worthless :*("}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 8, "last_activity_date": 1442253754, "last_edit_date": 1442253754, "creation_date": 1442241928, "answer_id": 32567718, "question_id": 32562614, "link": "https://stackoverflow.com/questions/32562614/is-something-in-the-where-clause-in-haskell-only-calculated-once/32567718#32567718", "title": "Is something in the &#39;where&#39; clause in Haskell only calculated once?", "body": "<p>Carsten's answer (the value will be computed at most once) is correct as long as you have not disabled the monomorphism restriction. If you have, then <code>m</code> might have a polymorphic inferred type that involves a type class, and then <code>m</code> is not really a normal value, but rather a function that takes a type class dictionary and produces a value. Consider this example.</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Debug.Trace(trace)\n\nfunc n = m ++ [1] ++ m ++ [0] ++ m\n  where m = func2 n                     -- m :: Monad t =&gt; t a (where n :: a)\n\nfunc2 n = trace \"called...\" (return n)  -- func2 :: Monad t =&gt; a -&gt; t a\n</code></pre>\n\n<p>Then evaluating <code>func 3</code> in ghci prints</p>\n\n<pre><code>called...\n[3,1called...\n,3,0called...\n,3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442257389, "post_id": 32571158, "comment_id": 52999345, "body": "Are you compiling with optimizations enabled? I only have 7.10.1, but I see <code>called</code> printed 3 times when compiled as well. But certainly optimizations can also affect this behavior in general."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442261105, "post_id": 32571158, "comment_id": 53001216, "body": "Yes - I was compiling with -O2. I&#39;ll clarify the answer."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1442261124, "last_edit_date": 1442261124, "creation_date": 1442254098, "answer_id": 32571158, "question_id": 32562614, "link": "https://stackoverflow.com/questions/32562614/is-something-in-the-where-clause-in-haskell-only-calculated-once/32571158#32571158", "title": "Is something in the &#39;where&#39; clause in Haskell only calculated once?", "body": "<p>To add to @Carstan's and @Reid Barton's answers, it also depends on whether or not you are running compiled code or not, e.g.:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Debug.Trace(trace)\n\nfunc n = m ++ [1] ++ m ++ [0] ++ m\n  where m = func2 n                     -- m :: Monad t =&gt; t a (where n :: a)\n\nfunc2 n = trace \"called...\" (return n)\n\nmain = let xs = func 3 :: [Int]\n       in print xs\n</code></pre>\n\n<p>In <code>ghci</code> running <code>main</code> prints out <code>called</code> 3 times. When compiled, however, it only prints out <code>called</code> once when using <code>-O2</code>. (Tested with 7.10.2.)</p>\n"}], "owner": {"reputation": 261, "user_id": 5165551, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NBdFX.jpg?s=128&g=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/5165551/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 2, "accepted_answer_id": 32562766, "answer_count": 3, "score": 17, "last_activity_date": 1442261124, "creation_date": 1442226715, "last_edit_date": 1442252614, "question_id": 32562614, "link": "https://stackoverflow.com/questions/32562614/is-something-in-the-where-clause-in-haskell-only-calculated-once", "title": "Is something in the &#39;where&#39; clause in Haskell only calculated once?", "body": "<p>When I have the following code:</p>\n\n<pre><code>func n = m ++ [1] ++ m ++ [0] ++ m\n    where m = func2 n\n</code></pre>\n\n<p>How many times is the func2 function called? Only once, in the where clause? Or is it just calculated again every time I use m?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1442208900, "post_id": 32557836, "comment_id": 52971691, "body": "This works fine (as in &quot;it type checks&quot;, as it will remove all except the <code>t</code> lines). Did you accidentally use <code>==&#39;t&#39;</code> instead of <code>== &quot;t&quot;</code> in your original code?"}, {"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442208985, "post_id": 32557836, "comment_id": 52971716, "body": "whoops, it originally was just &#39;t&#39;. I tried &quot;t&quot; but the problem I had with &quot;t&quot; is it filters out everything so the list becomes empty"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1442209143, "post_id": 32557836, "comment_id": 52971775, "body": "@shamu11 Not everything, just all lines that are not <code>&quot;t&quot;</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442209144, "post_id": 32557836, "comment_id": 52971777, "body": "That&#39;s because <code>filter p \u2026</code> will throw away ever <code>x</code> where <code>p x</code> is <code>False</code>, e.g. every line that&#39;s not &quot;t&quot;."}, {"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442209255, "post_id": 32557836, "comment_id": 52971809, "body": "so how do I just remove a &quot;t&quot; from each element in the list and the the whole line?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1442209429, "post_id": 32557836, "comment_id": 52971867, "body": "do you want to remove all <code>&#39;t&#39;</code> (then you don&#39;t need the lines at all) or just the first <code>&#39;t&#39;</code> in each line?"}, {"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442209697, "post_id": 32557836, "comment_id": 52971948, "body": "I just need practice filtering t&#39;s from a list of strings so I need to remove any t&#39;s from all elements in the list"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1442209789, "post_id": 32557836, "comment_id": 52971983, "body": "than your function is just <code>createIndex = filter (&#47;= &#39;t&#39;)</code> (type: <code>String -&gt; String</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442210396, "post_id": 32558091, "comment_id": 52972190, "body": "I need to remove t&#39;s from each one of the string elements in the strings list created by splitLines. what is the best way to do that?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "edited": false, "score": 0, "creation_date": 1442210761, "post_id": 32558091, "comment_id": 52972320, "body": "@shamu11 I answered this above - you don&#39;t really need to split here at all - and if you insist on doing you can use <code>fmap (filter (&#47;= &#39;t&#39;))</code>"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442214544, "post_id": 32558091, "comment_id": 52973854, "body": "Right, of course, <code>filter (&#47;= &#39;t&#39;)</code>, not <code>filter (not . (== &#39;t&#39;))</code>, edited. I was half sleeping :)"}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 3, "last_activity_date": 1442214504, "last_edit_date": 1442214504, "creation_date": 1442210096, "answer_id": 32558091, "question_id": 32557836, "link": "https://stackoverflow.com/questions/32557836/haskell-couldnt-match-type-char-with-char/32558091#32558091", "title": "Haskell: Couldn&#39;t match type \u2018Char\u2019 with \u2018[Char]\u2019", "body": "<p>The problem is in your definition of <code>removeT</code>. The type of <code>removeT</code> is <code>[String] -&gt; [String]</code>, meaning it works on a list of lists of characters. Then, in your <code>filter</code>, you compare each list of characters (i.e., each <code>String</code> in the list) to a <code>Char</code> (<code>'t'</code>). This is not allowed (you cannot check values with different types for equality).</p>\n\n<p>How to change your code really depends on what you intend to do. It's not entirely clear if you want to remove lines containing t's, if you want to keep lines containing t's, if you want to remove t's, or if you want to keep t's. Depending on what you want to achieve, your code will have to be modified accordingly.</p>\n\n<p>Some pointers:</p>\n\n<ul>\n<li><p>If you change the type of <code>removeT</code> to <code>String -&gt; String</code> you can look at one line at a time. You would then have to replace <code>removeT</code> in the definition of <code>createIndex</code> by <code>map removeT</code> (because you're applying the function to each line)). In this case, the filter would deal with <code>Char</code> values so comparing with a 't' is allowed.</p></li>\n<li><p>If you want to do something with lines containing t's, <code>(== 't')</code> is not the way to go, you will want to use <code>('t' `elem`)</code> (meaning \"'t' is an element of\").</p></li>\n<li><p><code>filter</code> keeps elements matching the predicate. So if you want to remove t's from a string for example, you use <code>filter (/= 't')</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 1895, "user_id": 3621754, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/2dc5c4eed3ed0e149b0bd6783a07fe0b?s=128&d=identicon&r=PG&f=1", "display_name": "sanic", "link": "https://stackoverflow.com/users/3621754/sanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7449, "favorite_count": 0, "accepted_answer_id": 32558091, "answer_count": 1, "score": 1, "last_activity_date": 1442226412, "creation_date": 1442208585, "last_edit_date": 1592644375, "question_id": 32557836, "link": "https://stackoverflow.com/questions/32557836/haskell-couldnt-match-type-char-with-char", "title": "Haskell: Couldn&#39;t match type \u2018Char\u2019 with \u2018[Char]\u2019", "body": "<p>I'm a Haskell beginner and I'm wrestling using functions to modify a list and then return it back to a string. I'm running into this error however. Any advice?</p>\n<blockquote>\n<p>Couldn't match type 'Char' with '[Char]'</p>\n<p>Expected type: String</p>\n<p>Actual type: Char</p>\n</blockquote>\n<pre><code>createIndex:: String -&gt; String\ncreateIndex str = unLine (removeT (splitLines str))\n\nsplitLines:: String -&gt; [String]\nsplitLines splitStr = lines splitStr\n\nremoveT:: [String] -&gt; [String]\nremoveT strT = filter (=='t') strT\n\nunLine:: [String] -&gt; String\nunLine unLinedStr = unlines unLinedStr\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1442226518, "post_id": 32557024, "comment_id": 52980186, "body": "poor birds... not a vegan post..."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 0, "creation_date": 1442203247, "post_id": 32557100, "comment_id": 52970210, "body": "Thank you!   What does this accomplish ? : subTwoLists :: Num a =&gt; [a] -&gt; [a] -&gt; [a]"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 1, "creation_date": 1442203400, "post_id": 32557100, "comment_id": 52970233, "body": "@Genesis It&#39;s a type signature telling that the function <code>subTwoLists</code> accepts two lists as input and gives one list as output. Usually, writing type signature is not mandatory but it helps a lot while reading the code."}, {"owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 0, "creation_date": 1442204213, "post_id": 32557100, "comment_id": 52970410, "body": "[a] -&gt; [a] -&gt; [a] -&gt; [a] Would this accept 3 lists and output a list?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 3, "creation_date": 1442205211, "post_id": 32557100, "comment_id": 52970682, "body": "@Genesis: you don&#39;t have to write the function on your own - there is a nice HOF doing it for you: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow noreferrer\"><code>zipWith</code></a>: <code>subTwoLists = zipWith (-)</code> ;)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1442207513, "post_id": 32557100, "comment_id": 52971288, "body": "@Carsten That&#39;s nicer!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1442224080, "post_id": 32557100, "comment_id": 52978828, "body": "Since the OP is using this in linear algebra, the OP is only calling <code>subTwoLists</code> with same-length lists. If by mistake lists are not of the same length, then <code>subTwoLists</code> will silently truncate the longer list so to make them even. If this is undesired, and the OP would prefer a runtime error instead, one can return <code>error &quot;uneven lists&quot;</code> instead of <code>[]</code> in the first two equations."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1442203049, "creation_date": 1442203049, "answer_id": 32557100, "question_id": 32557024, "link": "https://stackoverflow.com/questions/32557024/haskell-array-subtraction/32557100#32557100", "title": "Haskell Array Subtraction", "body": "<p>There is a problem with this code:</p>\n\n<pre><code>subTwoLists :: Num a =&gt; [a] -&gt; [a] -&gt; [a]\nsubTwoLists (x:xs) (y:ys) = (x-y) : (subTwoLists xs ys)\n</code></pre>\n\n<p>You are not handling the base case. In recursion, you always have to \nhandle the base case. Something like this should work:</p>\n\n<pre><code>subTwoLists :: Num a =&gt; [a] -&gt; [a] -&gt; [a]\nsubTwoLists [] _ = []\nsubTwoLists _ [] = []\nsubTwoLists (x:xs) (y:ys) = (x-y) : (subTwoLists xs ys)\n</code></pre>\n\n<blockquote>\n  <p>Do these just mean for all elements in a and all elements in b?</p>\n</blockquote>\n\n<p>Yes. But Why don't you try it yourself in ghci?</p>\n\n<blockquote>\n  <p>(x-y) : Should compute a[0] - b[0] = c[0] right? </p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>Also, note that you are using <code>Lists</code>, not arrays.</p>\n"}], "owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 997, "favorite_count": 0, "accepted_answer_id": 32557100, "answer_count": 1, "score": 1, "last_activity_date": 1442203049, "creation_date": 1442202360, "last_edit_date": 1442203004, "question_id": 32557024, "link": "https://stackoverflow.com/questions/32557024/haskell-array-subtraction", "title": "Haskell Array Subtraction", "body": "<p>I'm trying to brush up on my Linear Algebra skills and am also learning Haskell and thought...why not learn by doing one on the other! (Two birds one stone)</p>\n\n<pre><code>-- Vector\n\na = [1,0,0]\nb = [2,0,4]\n\nsubTwoLists (x:xs) (y:ys) = (x-y) : (subTwoLists xs ys)\n</code></pre>\n\n<p>What I'd really like to understand:</p>\n\n<ul>\n<li><p><code>(x:xs)</code> and <code>(y:ys)</code>  :  Do these just mean for all elements in a and all elements in b?</p></li>\n<li><p><code>= (x-y)</code> : Should compute <code>a[0] - b[0] = c[0]</code>, right?  </p></li>\n</ul>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442207743, "post_id": 32555360, "comment_id": 52971357, "body": "&quot;a pure <code>isAdmin</code> function&quot; -- Terminology nitpicking: something that doesn&#39;t take arguments isn&#39;t a function. A better wording would be &quot;a pure <code>isAdmin</code> value&quot;. If you were talking about the monadic <code>isAdmin</code> you actually have, you could also say &quot;an <code>isAdmin</code> computation&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 1442, "user_id": 562970, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/68f7e7b66b24dced485f06444a7841bd?s=128&d=identicon&r=PG", "display_name": "Igor Deruga", "link": "https://stackoverflow.com/users/562970/igor-deruga"}, "edited": false, "score": 0, "creation_date": 1442232870, "post_id": 32557632, "comment_id": 52984004, "body": "duplode, thanks for your answer. Well, it&#39;s just like I thought :) As for why I called my approach a hack, is that isAdmin is supposed to be a kind of &quot;static helper function&quot;, if you allow me this metaphor from Java. But with my current approach, I have to initialize a variable in every Handler that corresponds to the hamlet file I wish to use it in.  Concerning the function name, I just took what was written in the article I cited :)"}, {"owner": {"reputation": 1442, "user_id": 562970, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/68f7e7b66b24dced485f06444a7841bd?s=128&d=identicon&r=PG", "display_name": "Igor Deruga", "link": "https://stackoverflow.com/users/562970/igor-deruga"}, "edited": false, "score": 0, "creation_date": 1442232952, "post_id": 32557632, "comment_id": 52984058, "body": "I&#39;ll let it hang for a day or so in case someone else has an idea of how to organize this in yesod. If not, I&#39;ll be accepting your answer :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1442, "user_id": 562970, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/68f7e7b66b24dced485f06444a7841bd?s=128&d=identicon&r=PG", "display_name": "Igor Deruga", "link": "https://stackoverflow.com/users/562970/igor-deruga"}, "edited": false, "score": 1, "creation_date": 1442253555, "post_id": 32557632, "comment_id": 52997207, "body": "@Igor The moral equivalent to <code>isadmin &lt;- isAdmin</code> with a static method in Java would be something like <code>bool isadmin = SomeClass.isAdmin();</code> (i.e. calling the static method somewhere and stroring the result in a local variable). If I&#39;m right in thinking you wouldn&#39;t bat an eyelid when doing the latter in Java, then using <code>&lt;-</code> to give local names to values when using monads should feel just as natural."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1442207270, "last_edit_date": 1592644375, "creation_date": 1442207270, "answer_id": 32557632, "question_id": 32555360, "link": "https://stackoverflow.com/questions/32555360/check-for-admin-permissions-in-yesod-using-database/32557632#32557632", "title": "Check for admin permissions in Yesod using database", "body": "<p><em>N.B.: I don't actually know Yesod; this answer is based on general Haskell practice.</em></p>\n<blockquote>\n<p>Is there a way to still have a pure isAdmin function even if I make a call to the database (I seriously doubt that</p>\n</blockquote>\n<p>It is not possible indeed. Access to an external database must, in one way or another, live in <code>IO</code>; there is no way around it.</p>\n<blockquote>\n<p>Currently, I am using a hack in the handler module:</p>\n<p><code>isadmin &lt;- isAdmin</code></p>\n<p>So, I can write in the hamlet corresponding to that handler:</p>\n<p><code>$if isadmin</code></p>\n</blockquote>\n<p>That is not a hack; it is one of the standard ways of using the result from a monadic computation. In fact, in the Yesod book page you linked to, right before the <code>isAdmin</code> example you mentioned, there is a snippet that runs a database query and uses the result with <code>$if</code> in a very similar way to what you are doing now:</p>\n<pre><code>getBlogR :: Handler Html\ngetBlogR = do\n    -- etc.\n    entries &lt;- runDB $ selectList [] [Desc EntryPosted]\n    -- etc.\n$if null entries\n    -- etc.\n</code></pre>\n<p>P.S.:</p>\n<blockquote>\n<p>N.B.: I don't want to pass any parameters to isAdmin</p>\n</blockquote>\n<p>I wonder why you don't want to do so. Perhaps it is because your only need to check whether a single specific user is an admin. In that case, you should consider renaming your computation to <code>isCurrentUserAdmin</code> (or whatever makes sense in your use case). Seeing a name like <code>isAdmin</code> begs the question  &quot;<em>who</em> is an admin?&quot;, and so it is rather surprising that something with that name doesn't take any arguments.</p>\n"}], "owner": {"reputation": 1442, "user_id": 562970, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/68f7e7b66b24dced485f06444a7841bd?s=128&d=identicon&r=PG", "display_name": "Igor Deruga", "link": "https://stackoverflow.com/users/562970/igor-deruga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 32557632, "answer_count": 1, "score": 0, "last_activity_date": 1442207501, "creation_date": 1442185415, "last_edit_date": 1442207501, "question_id": 32555360, "link": "https://stackoverflow.com/questions/32555360/check-for-admin-permissions-in-yesod-using-database", "title": "Check for admin permissions in Yesod using database", "body": "<p>I'm trying to implement the <code>isAdmin</code> function in a similar fashion to <a href=\"http://www.yesodweb.com/book/blog-example-advanced\" rel=\"nofollow\">these Yesod book examples</a>. The problem is that I want to keep my 'admin' emails in the database, but when I make a database query, <code>isAdmin</code> loses its purity, so I have to return <code>Handler-something IO Bool</code> instead of just <code>Bool</code>. Now, this scraps the very nice syntax sugar in hamlet that allows to do so:</p>\n\n<pre><code>$if isAdmin\n    &lt;p ...\n</code></pre>\n\n<p>Is there a way to still have a pure <code>isAdmin</code> function even if I make a call to the database (I seriously doubt that... by the way, I don't want to pass any parameters to <code>isAdmin</code>)? Or maybe I could still use the <code>$if</code> syntax with the impure function?</p>\n\n<p>P.S.: Currently, I am using a hack in the handler module:</p>\n\n<pre><code>isadmin &lt;- isAdmin\n</code></pre>\n\n<p>So, I can write in the hamlet corresponding to that handler:</p>\n\n<pre><code>$if isadmin\n</code></pre>\n\n<p>But it is not universal and I like the first method more.</p>\n"}, {"tags": ["algorithm", "haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 41174, "user_id": 270287, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1GwpB.jpg?s=128&g=1", "display_name": "IVlad", "link": "https://stackoverflow.com/users/270287/ivlad"}, "edited": false, "score": 1, "creation_date": 1442181988, "post_id": 32554838, "comment_id": 52965964, "body": "Related: There is a C++ implementation of the 4 pegs version and a Haskell implementation of the even more general <code>k</code> pegs version in my question and its answers here: <a href=\"http://stackoverflow.com/questions/3607161/towers-of-hanoi-with-k-pegs\" title=\"towers of hanoi with k pegs\">stackoverflow.com/questions/3607161/towers-of-hanoi-with-k-p&zwnj;&#8203;egs</a> Note that this is an open problem, and it is not known if an efficient algorithm will produce an optimal solution."}], "owner": {"reputation": 629, "user_id": 1795600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0F3Z1.png?s=128&g=1", "display_name": "stefkin", "link": "https://stackoverflow.com/users/1795600/stefkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 636, "favorite_count": 1, "closed_date": 1442182173, "answer_count": 0, "score": 1, "last_activity_date": 1442180678, "creation_date": 1442180678, "question_id": 32554838, "link": "https://stackoverflow.com/questions/32554838/reves-puzzle-recursive-solution", "closed_reason": "Duplicate", "title": "Reve&#39;s puzzle recursive solution", "body": "<p>The classic <a href=\"https://en.wikipedia.org/wiki/Tower_of_Hanoi\" rel=\"nofollow\">tower of hanoi</a> problem has quite elegant solution in haskell:</p>\n\n<pre><code>type Peg = String\ntype Move = (Peg, Peg)\nhanoi :: Integer -&gt; Peg -&gt; Peg -&gt; Peg -&gt; [Move]\nhanoi 0 _ _ _ = []\nhanoi n from to via = (hanoi (n - 1) from via to) ++ [(from, to)] ++ (hanoi (n - 1) via to from)\n</code></pre>\n\n<p>I'm struggling to find a solution for the same problem with four pegs (also known as Reve's puzzle) in as few moves as possible.</p>\n\n<p>It's widely known that minimal amount of steps for three pegs is 2^n-1. For 15 disks it's 32676, while for four pegs it's only 129 as mentioned in <a href=\"https://www.seas.upenn.edu/~cis194/spring13/hw/01-intro.pdf\" rel=\"nofollow\">cis194 homework#1 ex. 6</a>. Here is my take on the task:</p>\n\n<pre><code>hanoiiii :: Integer -&gt; Peg -&gt; Peg -&gt; Peg -&gt; Peg -&gt; [Move]\nhanoiiii n from to via1 via2\n  | n == 0 = []\n  | n == 1 = [(from, to)]\n  | n == 3 = [(from, via1), (from, via2), (from, to), (via2, to), (via1, to)]\n  | otherwise = (hanoiiii (n - 1) from via1 to via2) ++ [(from, to)] ++ (hanoiiii (n - 1) via1 to from via2)\n</code></pre>\n\n<blockquote>\n  <p>length $ hanoiiii 15 \"a\" \"b\" \"c\" \"d\" </p>\n  \n  <p>24575</p>\n</blockquote>\n\n<p>As you can see it's suboptimal, if even working. Please help me to find proper solution.</p>\n"}, {"tags": ["list", "haskell", "tree"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442205745, "post_id": 32554725, "comment_id": 52970817, "body": "I believe this is pretty inefficient, because each level is built up using <code>++</code>, and the left argument is not generally smaller than the right argument."}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 5, "last_activity_date": 1442180433, "last_edit_date": 1442180433, "creation_date": 1442179738, "answer_id": 32554725, "question_id": 32554573, "link": "https://stackoverflow.com/questions/32554573/haskell-list-of-lists-from-a-tree/32554725#32554725", "title": "Haskell, list of lists from a tree", "body": "<p>You recursively compute the levels and always merge lists from two subtrees point-wise (thus all the slices in the same depth get merged together).</p>\n\n<pre><code>f :: Tree a -&gt; [[a]]\nf EmptyT = []\nf (NodeT a t1 t2) = [a] : merge (f t1) (f t2)\n\nmerge :: [[a]] -&gt; [[a]] -&gt; [[a]]\nmerge [] ys = ys\nmerge xs [] = xs\nmerge (x:xs) (y:ys) = (x ++ y) : merge xs ys\n</code></pre>\n\n<p>If the tree were complete (all the paths from the root to a list are of the same length) then you could use <code>zipWith (++)</code> as <code>merge</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 3, "last_activity_date": 1442182623, "last_edit_date": 1442182623, "creation_date": 1442180878, "answer_id": 32554854, "question_id": 32554573, "link": "https://stackoverflow.com/questions/32554573/haskell-list-of-lists-from-a-tree/32554854#32554854", "title": "Haskell, list of lists from a tree", "body": "<p>Slightly more complicated solution, than the one which was accepted, but I think mine might be better in terms of memory consumption (it's a bit late, so please check yourself).</p>\n\n<p>Intuition goes from a wonderful paper of <a href=\"http://www.westpoint.edu/eecs/SiteAssets/SitePages/Faculty%20Publication%20Documents/Okasaki/icfp00bfn.pdf\" rel=\"nofollow\">Chris Okasaki \"Breadth-First Numbering: Lessons from a Small Exercise in Algorithm Design\"</a>. You can get general intuition on breadth-first tree traversals of trees in functional languages in detail.</p>\n\n<p>I did somewhat ugly addition to add the \"list of lists\" splitting, there might be a better way:</p>\n\n<pre><code>module Main where\n\ndata Tree a = NodeT a (Tree a) (Tree a) | EmptyT\n\n--      1\n--     / \\\n--   2     3\n--  / \\   / \\\n-- 4   5 6   7     \n\nf :: Tree a -&gt; [[a]]\nf t = joinBack (f' [(t, True)])\n\ntype UpLevel = Bool\n\nf' :: [(Tree a, UpLevel)] -&gt; [(a, UpLevel)]\nf' [] = []\nf' ((EmptyT, _) : ts) = f' ts\nf' ((NodeT a t1 t2, up) : ts) = (a, up) : f' (ts ++ [(t1, up)] ++ [(t2, False)])\n\njoinBack :: [(a, UpLevel)] -&gt; [[a]]\njoinBack = go []\n  where\n    go acc [] = [reverse acc]\n    go acc ((x, False) : xs) = go (x : acc) xs\n    go acc ((x, True) : xs) = reverse acc : go [] ((x, False):xs)\n\nmain :: IO ()\nmain = do\n  let tree = NodeT 1 (NodeT 2 (NodeT 4 EmptyT EmptyT) (NodeT 5 EmptyT EmptyT))\n                     (NodeT 3 (NodeT 6 EmptyT EmptyT) (NodeT 7 EmptyT EmptyT))\n             :: Tree Int\n  print (tail (f tree))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1442211696, "post_id": 32557863, "comment_id": 52972685, "body": "Thanks for great &quot;Discussion&quot; section. I should note that I&#39;m rather more concerned in Jakub Daniel&#39;s solution of a memory-complexity, since trees tend to be big sometimes, and it&#39;s always nice to see approach which &quot;generates&quot; answer piece by piece co-inductively, giving your memory a some foot-print. I didn&#39;t review your solution in-depth, but it looks nice also."}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1442211990, "post_id": 32557863, "comment_id": 52972787, "body": "Looks beautiful, something I couldn&#39;t get :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1442212077, "post_id": 32557863, "comment_id": 52972813, "body": "Thanks, @KostiantynRybnikov."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442223718, "post_id": 32557863, "comment_id": 52978641, "body": "Nice. I wonder -- can we correctly say that the above <code>level&#39;</code> function takes a tree and returns a difference list? If so, would this be any more efficient than, say, using Jakub&#39;s answer but doing all the concatenations using <code>DList</code>s ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442236620, "post_id": 32557863, "comment_id": 52986592, "body": "@chi, I&#39;m pretty sure those are equally good when forced all the way; what&#39;s less clear is whether they&#39;re equally incremental."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442255923, "post_id": 32557863, "comment_id": 52998540, "body": "@chi, I fleshed that idea out a bit. I <i>think</i> it ends up about the same, but I&#39;m not 100% sure."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1442271214, "last_edit_date": 1495541043, "creation_date": 1442208725, "answer_id": 32557863, "question_id": 32554573, "link": "https://stackoverflow.com/questions/32554573/haskell-list-of-lists-from-a-tree/32557863#32557863", "title": "Haskell, list of lists from a tree", "body": "<h3>Answer</h3>\n\n<pre><code>levels :: Tree a -&gt; [[a]]\nlevels t = levels' t []\n\nlevels' :: Tree a -&gt; [[a]] -&gt; [[a]]\nlevels' EmptyT rest = rest\nlevels' (NodeT a l r) [] = [a] : levels' l (levels r)\nlevels' (NodeT a l r) (x : xs) = (a : x) : levels' l (levels' r xs)\n</code></pre>\n\n<p>A slightly more complicated, but lazier, implementation of <code>levels'</code>:</p>\n\n<pre><code>levels' EmptyT rest = rest\nlevels' (NodeT a l r) rest = (a : front) : levels' l (levels' r back)\n  where\n    (front, back) = case rest of\n       [] -&gt; ([], [])\n       (x : xs) -&gt; (x, xs)\n</code></pre>\n\n<p>Fans of folds will note that these are structured as catamorphisms:</p>\n\n<pre><code>cata :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ncata n e = go\n  where\n    go EmptyT = e\n    go (NodeT a l r) = n a (go l) (go r)\n\nlevels t = cata br id t []\n  where\n    br a l r rest = (a : front) : l (r back)\n      where\n        (front, back) = case rest of\n          [] -&gt; ([], [])\n          (x : xs) -&gt; (x, xs)\n</code></pre>\n\n<p>As <a href=\"https://stackoverflow.com/users/3234959/chi\">chi</a> <a href=\"https://stackoverflow.com/questions/32554573/haskell-list-of-lists-from-a-tree/32557863#comment52978641_32557863\">points out</a>, there seems to be some connection between this general approach and the result of using Jakub Daniel's solution with difference lists as intermediate forms. This could look something like</p>\n\n<pre><code>import Data.Monoid\n\nlevels :: Tree a -&gt; [[a]]\nlevels = map (flip appEndo []) . (cata br [])\n  where\n    br :: a -&gt; [Endo [a]] -&gt; [Endo [a]] -&gt; [Endo [a]]\n    br a l r = Endo (a :) : merge l r\n\nmerge :: Monoid a =&gt; [a] -&gt; [a] -&gt; [a]\nmerge [] ys = ys\nmerge (x : xs) ys = (x &lt;&gt; y) : merge xs ys'\n   where\n     (y,ys') =\n       case ys of\n         [] -&gt; (mempty, [])\n         p : ps -&gt; (p, ps)\n</code></pre>\n\n<p>I'm not entirely sure just how this compares with the more direct approaches.</p>\n\n<h3>Discussion</h3>\n\n<p>Kostiantyn Rybnikov's <a href=\"https://stackoverflow.com/a/32554854/1477667\">answer</a> cites Okasaki's <a href=\"http://www.westpoint.edu/eecs/SiteAssets/SitePages/Faculty%20Publication%20Documents/Okasaki/icfp00bfn.pdf\" rel=\"nofollow noreferrer\">Breadth-First Numbering: Lessons from a Small Exercise in Algorithm Design</a>, an excellent paper that highlights many functional programmers' \"blind spots\" and offers good arguments for making abstract data types easy enough to use that they won't be missed. However, the problem that paper describes is significantly more complex than this one; not so much machinery is required here. Also, the paper notes that level-oriented solutions are actually slightly faster than queue-based ones in ML; I'd expect to see a larger difference in a lazy language like Haskell.</p>\n\n<p>Jakub Daniel's <a href=\"https://stackoverflow.com/a/32554725/1477667\">answer</a> attempts a level-oriented solution, but unfortunately has an efficiency problem. It builds each level by repeatedly appending one list to another, and those lists may all be of equal length. Thus in the worst case, if I am calculating this correctly, it takes <code>O(n log n)</code> to process a tree with <code>n</code> elements.</p>\n\n<p>The approach I chose is level-oriented, but avoids the pain of concatenation by passing each left subtree the levels of its right sibling and cousins. Each node/leaf of the tree is processed exactly once. That processing involves <code>O(1)</code> work: pattern matching on that node/leaf, and, if it is a node, pattern matching on the list derived from the right sibling and cousins. Thus the total time is <code>O(n)</code> to process a tree with <code>n</code> elements.</p>\n"}], "owner": {"reputation": 53, "user_id": 5331757, "user_type": "registered", "profile_image": "https://graph.facebook.com/143320726014838/picture?type=large", "display_name": "Dick Burns", "link": "https://stackoverflow.com/users/5331757/dick-burns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 3, "accepted_answer_id": 32554725, "answer_count": 3, "score": 5, "last_activity_date": 1442271214, "creation_date": 1442178576, "question_id": 32554573, "link": "https://stackoverflow.com/questions/32554573/haskell-list-of-lists-from-a-tree", "title": "Haskell, list of lists from a tree", "body": "<p>I have this data structure for a tree:</p>\n\n<p>data Tree a = NodeT a (Tree a) ( Tree a) | EmptyT</p>\n\n<p>I need to create a function that returns a list of lists where each element of the list represents a level of the tree. For instance, from this:</p>\n\n<pre><code>          1\n         / \\\n       2     3\n      / \\   / \\\n     4   5 6   7     \n</code></pre>\n\n<p>to this: [[1],[2,3],[4,5,6,7]] </p>\n\n<p>The function must have the following form: </p>\n\n<pre><code>                     f :: Tree a -&gt; [[a]]\n</code></pre>\n\n<p>How to do it using recursion? </p>\n\n<p>anyone?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "syntax", "functional-programming", "parameter-passing"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 2, "creation_date": 1442170716, "post_id": 32553370, "comment_id": 52962557, "body": "I don&#39;t think that would type-check in Haskell&#39;s type system. Maybe with variations like <code>unlist1</code>, <code>unlist2</code>, <code>unlist3</code>, etc. In that case, <code>unlist3 f [a, b, c] = f a b c</code> and use like <code>unlist3 f x</code> or using infix to looks like a function &quot;call&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1442171530, "post_id": 32553370, "comment_id": 52962839, "body": "There is <a href=\"http://okmij.org/ftp/Haskell/polyvariadic.html#polyvar-fn\" rel=\"nofollow noreferrer\">a trick</a> to persuade the type system to let you write polyvariadic functions. It is relatively non-trivial and heavyweight, and so you won&#39;t see it often. The best known use case is <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Printf.html\" rel=\"nofollow noreferrer\"><code>Text.Printf</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442172309, "post_id": 32553510, "comment_id": 52963119, "body": "Is there a way to fix my naive approach so that it looks less like I&#39;m shouting (there are a lot of !!!!!!!s in it!)?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 2, "creation_date": 1442172345, "post_id": 32553510, "comment_id": 52963138, "body": "That&#39;s fine as far as it goes, but in general, try to avoid <code>!!</code> unless it&#39;s necessary. E.g. use pattern matching instead of <code>!!</code> to access elements at small known indices: <code>let [a, b, c, d] = [1,2,3,4] in f a b c d</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 2, "creation_date": 1442172614, "post_id": 32553510, "comment_id": 52963233, "body": "@raxacoricofallapatorius ... and to access elements at <i>large</i> known indices in most cases you should switch to a different data structure, as <code>(!!)</code>, beyond being partial, is also <i>O(n)</i> in the index."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442173332, "post_id": 32553510, "comment_id": 52963491, "body": "@AlexeyRomanov: I like that approach but it doesn&#39;t work for me. If I replace <code>readsPrec _ s = [(f (x!!0) (x!!1) (x!!2) (x!!3), &quot;&quot;)] where x = words s</code> (which works perfectly; <code>f</code> does validation) with <code>readsPrec _ s = [(f c w s r, &quot;&quot;)] where [c, w, s, r] = words s</code> execution just hangs. Not sure what I&#39;m missing there."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1442173660, "post_id": 32553510, "comment_id": 52963595, "body": "@raxacoricofallapatorius, you reused the variable name <code>s</code>..."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1442173710, "post_id": 32553510, "comment_id": 52963610, "body": "@ReidBarton: Ah. Ooops!"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442177778, "post_id": 32553510, "comment_id": 52964774, "body": "@raxacoricofallapatorius Note also that <code>[a, b, c, d]</code> pattern verifies that you have exactly 4 elements; use <code>(a : b : c : d : _)</code> otherwise."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 6, "last_activity_date": 1442171836, "last_edit_date": 1442171836, "creation_date": 1442171334, "answer_id": 32553510, "question_id": 32553370, "link": "https://stackoverflow.com/questions/32553370/how-do-i-unpack-a-list-as-individual-arguments-in-haskell/32553510#32553510", "title": "How do I &quot;unpack&quot; a list as individual arguments in Haskell?", "body": "<p>It wouldn't be particularly useful in Haskell type system:</p>\n\n<ol>\n<li>As Mephy points out, you'd need a separate function for each list length, and it would fail at runtime when passed a list with wrong length;</li>\n<li>All arguments would have to have the same type.</li>\n</ol>\n\n<p>Given this, use of tuples makes more sense than lists, as it avoids both problems; the standard library includes <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:uncurry\" rel=\"noreferrer\"><code>uncurry</code></a> which does this for functions of 2 arguments, and you could define <code>uncurry3</code>, etc. by analogy:</p>\n\n<pre><code>uncurry3                 :: (a -&gt; b -&gt; c -&gt; d) -&gt; ((a, b, c) -&gt; d)\nuncurry3 f (a, b, c)     =  f a b c\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2755, "favorite_count": 1, "closed_date": 1442177743, "accepted_answer_id": 32553510, "answer_count": 1, "score": 6, "last_activity_date": 1442173653, "creation_date": 1442170494, "last_edit_date": 1442173653, "question_id": 32553370, "link": "https://stackoverflow.com/questions/32553370/how-do-i-unpack-a-list-as-individual-arguments-in-haskell", "closed_reason": "Duplicate", "title": "How do I &quot;unpack&quot; a list as individual arguments in Haskell?", "body": "<p>Is there builtin or idiomatic way in Haskell to \"unpack\" the elements of a list and treat them as individual arguments to a function?</p>\n\n<p>For example, if I have <code>f :: a -&gt; b -&gt; c -&gt; d -&gt; e</code> is there something compact like</p>\n\n<pre><code>f (unlist x)\n</code></pre>\n\n<p>accomplishes </p>\n\n<pre><code>let x = [1,2,3,4] in f (x!!0) (x!!1) (x!!2) (x!!3) \n</code></pre>\n\n<p>or at least a less \"shouty\" (too many <code>!!</code> repetitions) way to unpack a list of known length in general (so that it can be used as arguments to a function, in this case).</p>\n\n<hr>\n\n<p>Essentially what I'm looking for is something like what <code>Sequence@@</code> does in Mathematica:</p>\n\n<pre><code>f[Sequence@@{1, 2, 3, 4}]\n</code></pre>\n"}, {"tags": ["haskell", "reactive-banana"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1442183533, "last_edit_date": 1442183533, "creation_date": 1442165870, "answer_id": 32552609, "question_id": 32552022, "link": "https://stackoverflow.com/questions/32552022/reactive-banana-change-status-in-data/32552609#32552609", "title": "Reactive Banana: Change status in data", "body": "<p>The type of <code>accumB</code> is:</p>\n\n<pre><code>accumB :: a -&gt; Event t (a -&gt; a) -&gt; Behavior t a\n</code></pre>\n\n<p>So if you want to define a <code>Behavior t Counter</code> with it you need to use events that carry <code>Counter -&gt; Counter</code> functions:</p>\n\n<pre><code>-- For the sake of convenience...\noverCount :: (Int -&gt; Int) -&gt; Counter -&gt; Counter\noverCount f c = c { count = f (count c) }\n</code></pre>\n\n\n\n<pre><code>counter = accumB Counter { count = 0 } $\n    (overCount (+1) &lt;$ eup) `union` (overCount (subtract 1) &lt;$ edown) \n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 32552609, "answer_count": 1, "score": 1, "last_activity_date": 1442226713, "creation_date": 1442162494, "last_edit_date": 1442226713, "question_id": 32552022, "link": "https://stackoverflow.com/questions/32552022/reactive-banana-change-status-in-data", "title": "Reactive Banana: Change status in data", "body": "\n\n<p>Starting from the Counter example in Reactive Banana Wx that uses a normal <code>Int</code> to keep the counter status:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let networkDescription :: forall t. Frameworks t =&gt; Moment t () \n    networkDescription = do\n    eup   &lt;- event0 bup   command\n    edown &lt;- event0 bdown command\n\n    let\n        counter :: Behavior t Int\n        counter = accumB 0 $ ((+1) &lt;$ eup) `union` (subtract 1 &lt;$ edown)\n\n    sink output [text :== show &lt;$&gt; counter]\n\nnetwork &lt;- compile networkDescription\nactuate network\n</code></pre>\n\n<p>how can I replace and update the <code>Int</code> counter with a more generic <code>data</code> like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Counter = Counter {\n     count :: Int\n } deriving (Show)\n\nlet\n    counter :: Behavior t Counter\n    counter = accumB Counter { count = 0 } $ ??????\n\nsink output [text :== show &lt;$&gt; count counter]\n</code></pre>\n\n<p>I don't know how to refer to the internal <code>count</code> function with something like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>count = count mycounter + 1\n</code></pre>\n\n<p>Any idea?</p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442161203, "post_id": 32551751, "comment_id": 52959473, "body": "<code>data Cell0 = Cell0 ...</code> defines a <code>Cell0</code> constructor, then <code>data Acell = Cell0 | Cell1</code> does so again. Maybe change it to <code>data Acell = ACell0 Cell0 | ACell1 Cell1</code>?"}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "reply_to_user": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442161517, "post_id": 32551751, "comment_id": 52959581, "body": "that works but too redundant.."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442161645, "post_id": 32551751, "comment_id": 52959623, "body": "One option is to use <code>Either</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442165625, "post_id": 32551751, "comment_id": 52960987, "body": "Do you definitely need separate <code>Cell0</code>, <code>Cell1</code>, and <code>Cell2</code> types? Perhaps you should just have one <code>Cell</code> type with three constructors, instead."}], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1442161752, "post_id": 32551777, "comment_id": 52959664, "body": "so how to modify the code in the minimal way to make it work? the most straight forward way might be that: data Cell0=Cell0c {c0str::Text,c0uid::Uid}            deriving (Data,Typeable,Show)"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442161952, "post_id": 32551777, "comment_id": 52959728, "body": "If you do that, <code>data Acell = Cell0 | Cell1</code> will still not work, because <code>Cell0</code> will not refer to the type, it will be interpreted as a constructor. If you don&#39;t want that, move the <code>Cell0</code> declaration into the <code>Acell</code> definition, i.e. <code>data Acell = Cell0 {c0str...} | Cell1 {c1start...}</code>"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1442162812, "post_id": 32551777, "comment_id": 52960025, "body": "@doofin I&#39;d give each type a more descriptive name to describe its purpose. For example, what&#39;s the difference between the <code>0</code> and <code>1</code> variants of <code>Cell</code>?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1442163041, "post_id": 32551777, "comment_id": 52960107, "body": "@doofin Also note that if your intent in the last type is to refer to the previously constructors, where <code>ACell</code> can either be a type <code>Cell0</code> or <code>Cell1</code>, it doesn&#39;t work like that."}], "tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 0, "last_activity_date": 1442162883, "last_edit_date": 1442162883, "creation_date": 1442161120, "answer_id": 32551777, "question_id": 32551751, "link": "https://stackoverflow.com/questions/32551751/multiple-declaration-errors-of-algebraic-data-type/32551777#32551777", "title": "multiple declaration errors of algebraic data type", "body": "<p>In the first example, you are in fact declaring the constructor <code>Cell0</code> twice; once in the first type, and once in the last. You're doing the same for <code>Cell1</code> aswell, but the compiler hasn't gotten there to produce an error. It doesn't matter that the constructors are of a different type; all constructors must have unique names (the same goes for record fields; an unfortunate part of Haskell). </p>\n\n<p>In your second example, you never try to redeclare a constructor, so it compiles. </p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1442186144, "creation_date": 1442186144, "answer_id": 32555443, "question_id": 32551751, "link": "https://stackoverflow.com/questions/32551751/multiple-declaration-errors-of-algebraic-data-type/32555443#32555443", "title": "multiple declaration errors of algebraic data type", "body": "<pre><code>data Acell=Cell0|Cell1\n</code></pre>\n\n<p>That's not how ADTs work.</p>\n\n<p>What you're thinking when you write that seems to be \"an Acell is either a Cell0 or a Cell1\". But the Haskell spec says that this actually means \"introduce a new type Acell, and introduce a new constructor Cell0 that takes no arguments, and introduce a new constructor Cell1 that takes no arguments\".</p>\n\n<p>Thus your type definition contains no references at all to the type Cell0, but it introduces a new constructor Cell0 that clashes with the existing constructor named Cell0. Hence the error.</p>\n\n<p>Your second example with <code>data AB=A|B</code> does <em>not</em> work. It compiles, but if you'd tried it you'd see that you cannot put an element of the type <code>A</code> in the type <code>AB</code>. An AB is either the constructor A (containing no other data), or the constructor B (containing no other data); totally unrelated to the types A and B.</p>\n\n<p>The problem is that ADTs have <em>tagged</em> unions; in every branch of a <code>data</code> declaration (separated by <code>|</code>) there must be a new constructor and <em>then</em> the types that will be stored in the constructor. So, for example, you could say:</p>\n\n<pre><code>data Acell = Acell0 Cell0 | Acell1 Cell1\n</code></pre>\n\n<p>The constructors function as \"tags\" and allow you to tell which \"branch\" is being used without looking at the data inside, and even if the branches actually store the same data (e.g. <code>data Foo = L Integer | R Integer</code>). There's no way to have untagged unions and leave out the constructors.</p>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 32555443, "answer_count": 2, "score": 1, "last_activity_date": 1442186144, "creation_date": 1442160955, "question_id": 32551751, "link": "https://stackoverflow.com/questions/32551751/multiple-declaration-errors-of-algebraic-data-type", "title": "multiple declaration errors of algebraic data type", "body": "<p>some algebraic data types..</p>\n\n<pre><code>data Cell0=Cell0 {c0str::Text,c0uid::Uid}\n           deriving (Data,Typeable,Show)\ndata Cell1=Cell1 {c1start::Uid,c1end::Uid,c1str::Text,c1uid::Int}\n           deriving (Data,Typeable,Show)\ndata Cell2=Cell2 {c2start::Uid,c2end::Uid,c2str::Text,c2uid::Int}\n           deriving (Data,Typeable,Show)\ndata Acell=Cell0|Cell1\n</code></pre>\n\n<p>but the last line induces a compile error \"multiple declarations of Cell0\"</p>\n\n<p>I also tried sth like this:</p>\n\n<pre><code>data A=Aasdfdsf {sdf::Text}\n      deriving (Data,Typeable,Show)\ndata B=Bsdfsd\ndata AB=A|B\n</code></pre>\n\n<p>It compiles! so weired..</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442159724, "post_id": 32551523, "comment_id": 52958964, "body": "So what is the module name of your module (thats the word that follows <code>module </code> in its source code)? and what is the filename? Please make sure that you copy&amp;paste these answers, because upper/lowercase-issues are important here."}, {"owner": {"reputation": 191, "user_id": 5232754, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8e5aef7c9851ca25cbcf8820217638d7?s=128&d=identicon&r=PG&f=1", "display_name": "manwholikesspritekit", "link": "https://stackoverflow.com/users/5232754/manwholikesspritekit"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442160090, "post_id": 32551523, "comment_id": 52959075, "body": "The name of the .hs file is just NewModule.hs at the moment, as I am just testing things. The file is completely empty."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442160143, "post_id": 32551523, "comment_id": 52959090, "body": "the file should contain at least the line <code>module NewModule;</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442160602, "post_id": 32551523, "comment_id": 52959247, "body": "&quot;The Haskell app for OS X&quot; doesn&#39;t mean anything. Are you talking about GHC, GHCi, cabal, stack, or something weird?"}, {"owner": {"reputation": 191, "user_id": 5232754, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8e5aef7c9851ca25cbcf8820217638d7?s=128&d=identicon&r=PG&f=1", "display_name": "manwholikesspritekit", "link": "https://stackoverflow.com/users/5232754/manwholikesspritekit"}, "edited": false, "score": 0, "creation_date": 1442161227, "post_id": 32551523, "comment_id": 52959486, "body": "Nevermind, I got it working with the help of Michael. There is an app on the Mac appstore just called &#39;Haskell&#39; which is what I use. It&#39;s just a Haskell IDE. Sorry for being vague."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 5232754, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8e5aef7c9851ca25cbcf8820217638d7?s=128&d=identicon&r=PG&f=1", "display_name": "manwholikesspritekit", "link": "https://stackoverflow.com/users/5232754/manwholikesspritekit"}, "edited": false, "score": 0, "creation_date": 1442160522, "post_id": 32551673, "comment_id": 52959227, "body": "That didn&#39;t work, but I used &#39;module NewModule where&#39; and it worked. What does the &#39;where&#39; part mean?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 191, "user_id": 5232754, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8e5aef7c9851ca25cbcf8820217638d7?s=128&d=identicon&r=PG&f=1", "display_name": "manwholikesspritekit", "link": "https://stackoverflow.com/users/5232754/manwholikesspritekit"}, "edited": false, "score": 0, "creation_date": 1442160705, "post_id": 32551673, "comment_id": 52959281, "body": "@manwholikesspritekit <code>where</code> introduces a block of declarations. For example when you define a function you can say: <code>f x y = ... where a = ...</code> so the <code>where a = ...</code> defines some names that can be used in the body of the function. The whole module can be seen as such a block."}, {"owner": {"reputation": 558, "user_id": 5423827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l9wEa.jpg?s=128&g=1", "display_name": "suhao399", "link": "https://stackoverflow.com/users/5423827/suhao399"}, "edited": false, "score": 0, "creation_date": 1531367512, "post_id": 32551673, "comment_id": 89571301, "body": "&quot;In particular, there is no connection between module names and file names, and more than one module could conceivably reside in a single file (one module may even span several files). Of course, a particular implementation will most likely adopt conventions that make the connection between modules and files more stringent.&quot;    This is from document of GHC, in this case if file name not same as module name,   i dont know how GHC will look for file to import when I import module X from file Y.hs.   <a href=\"https://www.haskell.org/tutorial/modules.html\" rel=\"nofollow noreferrer\">haskell.org/tutorial/modules.html</a>"}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": true, "score": 7, "last_activity_date": 1442160546, "last_edit_date": 1442160546, "creation_date": 1442160360, "answer_id": 32551673, "question_id": 32551523, "link": "https://stackoverflow.com/questions/32551523/haskell-file-name-and-path-do-not-match-module-name/32551673#32551673", "title": "Haskell: file name and path do not match module name", "body": "<p>The error message tells you that the module name and the file name should be the same.</p>\n\n<p>E.g.: If the file name is <code>NewModule.hs</code>, the module name should be <code>NewModule</code>.\nE.g.</p>\n\n<pre><code>-- NewModule.hs:\n\nmodule NewModule where\n\n-- you may define functions here...\n</code></pre>\n\n<p>So, you just have to use the <code>module</code> directive.</p>\n"}], "owner": {"reputation": 191, "user_id": 5232754, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8e5aef7c9851ca25cbcf8820217638d7?s=128&d=identicon&r=PG&f=1", "display_name": "manwholikesspritekit", "link": "https://stackoverflow.com/users/5232754/manwholikesspritekit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4685, "favorite_count": 1, "accepted_answer_id": 32551673, "answer_count": 1, "score": 3, "last_activity_date": 1442160546, "creation_date": 1442159576, "question_id": 32551523, "link": "https://stackoverflow.com/questions/32551523/haskell-file-name-and-path-do-not-match-module-name", "title": "Haskell: file name and path do not match module name", "body": "<p>I am using the Haskell app for OS X, and have created a Haskell project, and when I create another file in the project, Haskell tells me that the file name and path do not match the module name! I am new to Haskell, what does this mean?</p>\n\n<p>It is telling me also that it is expecting the name of the file as the module name.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "memoization"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442158019, "post_id": 32551255, "comment_id": 52958427, "body": "Do ya wanna sort out that formatting? I don&#39;t think many people can read it..."}, {"owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442158684, "post_id": 32551255, "comment_id": 52958648, "body": "@AJFarmar How should I sort out the formatting? Questions before code?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442159104, "post_id": 32551255, "comment_id": 52958780, "body": "If it were valid haskell code, that&#39;d be nice, but I think I could do it for you now. I&#39;ll edit for a moment."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442159185, "post_id": 32551255, "comment_id": 52958797, "body": "I guess he is talking about the indentation. But I would also simplify the code and drop &quot;a&quot;: I would say <code>syrs n = listArray (1,n) ...</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1442161235, "post_id": 32551255, "comment_id": 52959492, "body": "Please post your own broken code in full. It&#39;s very hard to do mental multiple search/replace while reading code."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442161986, "post_id": 32551255, "comment_id": 52959738, "body": "#14? That sounds... familiar: <a href=\"http://stackoverflow.com/questions/22416292/project-euler-14-tips-in-haskell\" title=\"project euler 14 tips in haskell\">stackoverflow.com/questions/22416292/&hellip;</a>. That being said, if you have <i>working</i> code, <a href=\"http://codereview.stackexchange.com\">codereview.stackexchange.com</a> could be a better place."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442162147, "post_id": 32551255, "comment_id": 52959794, "body": "@AJFarmar Your edit changed the formatting from what was on the Haskell wiki. It&#39;s no longer a real quote."}, {"owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442193965, "post_id": 32551255, "comment_id": 52968413, "body": "@Michael Actually that is my question 1. It turns out that adding <code>a</code> boosts performance in a way that I don&#39;t know."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442209826, "post_id": 32551255, "comment_id": 52971998, "body": "@pspencil - you should compile with <code>-O2</code> if you want to measure anything. 1) compiling with <code>-O2</code> has a bigger performance impact that wether you inline <code>a</code> or not. 2) If you compile with <code>-O2</code> I&#39;m sure that it will not have any performance impact wether you inline <code>a</code> or not. 3) I&#39;m still a Haskell beginner, so I cannot just answer all your questions..."}, {"owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442217784, "post_id": 32551255, "comment_id": 52975482, "body": "@Michael I tried to compile with <code>ghc -O2 -o TEST TEST.hs</code>. I deleted a and changed <code>a ! x&#39;</code> to <code>(syrs n) ! x&#39;</code> (if this is what you mean). Before change, it finishes in 1 second. After, however, it did not finish in 1 minute, which I don&#39;t know why."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1442251777, "post_id": 32551255, "comment_id": 52996247, "body": "By the way, when you say &quot;mine runs forever&quot;, do you mean that it runs a long time, or that there&#39;s an infinite loop and it never terminates?"}, {"owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1442385898, "post_id": 32551255, "comment_id": 53055223, "body": "@JustinL. As my point 2 points out, I think there is an infinite loop. Bit by bit, I modified my code to look like what was given as the answer and at certain point, when those differ by the difference in point 2, there is an infinite loop error. (previously, there is no notification)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442406269, "post_id": 32551255, "comment_id": 53067926, "body": "... and you still haven&#39;t included your code in the question. it is impossible to answer then. voting to close. SO is not your personal service (no offense intended), the Q&amp;A entries must make sense on their own, to a casual reader 10 years from now. (to your question above, if you replace <code>a ! ...</code> with <code>(syrs n) ! ...</code>, you destroy memoization and cause recalculation, i.e. computation explosion. <code>a</code> stores the previously calculated result, without it there is no memoization."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442406683, "post_id": 32551255, "comment_id": 53068233, "body": "your <code>syr</code> must be able to refer to <i>the same</i> array when processing different arguments, so the results are stored in that array, and not recalculated; to be able to refer to the <i>same</i> array you must <i>name</i> it and refer to it by its name. <a href=\"http://stackoverflow.com/a/11466959/849891\">&quot;if you name it, it will stay&quot;</a>."}, {"owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442475081, "post_id": 32551255, "comment_id": 53099474, "body": "@WillNess Thank you for your answer. As my program only differed from the given answer by tiny little details, I thought it would be better to point out those details than to leave it for you to spot the difference, not to mention the pain in corresponding variable names. Anyway, now, question 1 &amp; 2 have already been solved and question 3 does not require my code so it doesn&#39;t matter now. I have re-edited the question. Is that clear enough now? (I want to keep the older questions as reference, but failed to find a strikethrough format)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1442487685, "post_id": 32551255, "comment_id": 53106689, "body": "I&#39;ve edited to remove all the irrelevant, draft stuff, to make the question specific."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1442487451, "last_edit_date": 1442487451, "creation_date": 1442486219, "answer_id": 32628281, "question_id": 32551255, "link": "https://stackoverflow.com/questions/32551255/questions-regarding-haskell-solution-of-project-euler-14/32628281#32628281", "title": "Questions regarding Haskell solution of Project Euler 14", "body": "<p>Haskell98 Report <a href=\"https://www.haskell.org/onlinereport/array.html\" rel=\"nofollow\">states</a>, <em>\" <code>array</code> is strict in the bounds argument and in the indices of the association list, but nonstrict in the values\"</em>. <code>listArray</code> is similar.</p>\n\n<p>What this means is that the <em>structure</em> of an array is created right away &ndash; i.e. the <em>n</em> <em>\"cells\"</em> that are to hold the values &ndash; but the <em>values</em> themselves are lazy, as is usual in Haskell. </p>\n\n<p>Your function's definition, simplified, is</p>\n\n<pre><code>import Data.Array\nimport Data.List\nimport Data.Ord (comparing)\n\nsyrs n = \n    a\n    where \n    a = listArray (1,n) $ 0 : map syr [2..n]\n    syr x = \n        if y &lt;= n then 1 + a ! y else 1 + syr y\n        where \n        y = if even x then x `div` 2 else 3 * x + 1\n</code></pre>\n\n<p>With it,</p>\n\n<pre><code>a ! i === (0 : map syr [2..n]) !! (i-1) , i = 1..n\n      === if i==1 then 0\n                  else (map syr [2..n]) !! (i-2) , i = 2..n\n      === if i==1 then 0\n                  else syr i\n</code></pre>\n\n<p>When the value <code>a ! 10</code> is <em>needed</em>, it is calculated according to the above definition, and then stored under the index <code>10</code> in the array <code>a</code>. Calculating it will proceed in the usual fashion, viz. <code>a ! 5</code> will be demanded, triggering <em>its</em> calculation, and conditionally storing the result in the array. </p>\n\n<p>So, in pseudocode,</p>\n\n<pre><code>syr x = a ! x     , if already calculated and stored in the array\n      = 1 + syr y , storing the result in the array under x, if x &lt;= n\n      = 1 + syr y , otherwise\n  where\n  y = ....\n</code></pre>\n\n<p>The usual, recursive, lazy evaluation of Haskell.</p>\n"}], "owner": {"reputation": 295, "user_id": 2729218, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fabbdf91c68b4919131bc31a05a57ebc?s=128&d=identicon&r=PG", "display_name": "pspencil", "link": "https://stackoverflow.com/users/2729218/pspencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 32628281, "answer_count": 1, "score": 2, "last_activity_date": 1442487451, "creation_date": 1442157918, "last_edit_date": 1442486461, "question_id": 32551255, "link": "https://stackoverflow.com/questions/32551255/questions-regarding-haskell-solution-of-project-euler-14", "title": "Questions regarding Haskell solution of Project Euler 14", "body": "<p>This is the <a href=\"https://projecteuler.net/problem=14\" rel=\"nofollow\">Question 14</a>.</p>\n\n<pre><code>import Data.Array\nimport Data.List\nimport Data.Ord (comparing)\n\nsyrs n = a\n  where \n\n    -- For those who don't want to lookup array in the reference\n    -- the following line creates an array indexed from 1 to n \n    -- using the list provided. And a ! x is the syntax for a[x] in some other languages.\n\n    a = listArray (1,n) $ 0 : [1 + syr n x | x &lt;- [2..n]]   -------- 2\n    syr n x = if x' &lt;= n                                    -------- 1\n            then a ! x'                                     -------- 1\n            else 1 + syr n x'                               \n      where \n        x' = if even x\n             then x `div` 2\n             else 3 * x + 1\n\nmain = print $ maximumBy (comparing snd) $ assocs $ syrs 1000000\n</code></pre>\n\n<p>Above is the suggested solution for <a href=\"https://wiki.haskell.org/Euler_problems/11_to_20#Problem_14\" rel=\"nofollow\">Project Euler Q14 on wiki.haskell.org</a>. The algorithm is largely the same to mine (but mine runs forever while this runs in 2sec).  </p>\n\n<p>Question: </p>\n\n<p>In line 2, it calls <code>syr n x</code>. Suppose <code>x = 3</code>, <code>x' = 10</code>, <code>10 &lt; n</code>, it will proceed with <code>then</code> clause : <code>a ! 10</code>. But at this time, <code>a ! 10</code> is not yet calculated. How does the program proceed then?</p>\n\n<hr>\n\n\n"}, {"tags": ["haskell", "monads", "monad-transformers", "lifting"], "comments": [{"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442160703, "post_id": 32551152, "comment_id": 52959280, "body": "See the <a href=\"http://dev.stephendiehl.com/hask/#newtype-deriving\" rel=\"nofollow noreferrer\">What I Wish I Knew When Learning Haskell section on Newtype Deriving</a>, it gives some example code for flattening a transformer stack."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442260431, "post_id": 32551152, "comment_id": 53000900, "body": "And see also <a href=\"http://stackoverflow.com/questions/32572152/tidying-up-monads-turning-application-of-a-monad-transformer-into-newtype-mona\">this newer SO answer</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1442160810, "last_edit_date": 1442160810, "creation_date": 1442160242, "answer_id": 32551644, "question_id": 32551152, "link": "https://stackoverflow.com/questions/32551152/flatten-monad-stack/32551644#32551644", "title": "Flatten monad stack", "body": "<p>The usual approach is to use the <code>mtl</code> library rather than using <code>transformers</code> directly. I'm not sure what the story behind your <code>t</code> is, but the usual <code>mtl</code> approach is to use very general type signatures at definition sites, like</p>\n\n<pre><code>foo :: (MonadError e m, MonadState s m) =&gt; m Int\n</code></pre>\n\n<p>Then fix the actual transformer stacks at the call sites. A common recommendation is to wrap up the stack in a newtype to avoid muddying things up where they're used.</p>\n\n<p>If this isn't your style (and it's not for everyone), you can still use the <code>mtl</code> methods to perform operations, while giving an explicit transformer stack. This should cut down on the manual lifting substantially. The advantage of this approach is that it gives you a better view of the interactions of effects at the definition sites; the disadvantage is that more code needs all the information.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442162114, "post_id": 32551875, "comment_id": 52959785, "body": "I gather that effect systems have their own serious limitations."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1442162143, "post_id": 32551875, "comment_id": 52959793, "body": "The problem is that I do not really have too many occurrences of the exact same stack. It&#39;s just that I often have some stacks and plenty of lifting therefore."}, {"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442162267, "post_id": 32551875, "comment_id": 52959838, "body": "@dfeuer I&#39;m sure they do. I don&#39;t have any first-hand experience with effect systems though so I can&#39;t speak to that."}], "tags": [], "owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "is_accepted": true, "score": 6, "last_activity_date": 1442161691, "last_edit_date": 1495539949, "creation_date": 1442161691, "answer_id": 32551875, "question_id": 32551152, "link": "https://stackoverflow.com/questions/32551152/flatten-monad-stack/32551875#32551875", "title": "Flatten monad stack", "body": "<p>This is a well-known problem with monad transformers in general. Researchers have devised various ways of handling it, none of which is clearly \"best\". Some of the known solutions include:</p>\n\n<ul>\n<li>The <a href=\"http://hackage.haskell.org/package/mtl\" rel=\"nofollow noreferrer\"><code>mtl</code></a> approach, which automatically lifts type classes of monads over its built-in monad transformers (and <em>only</em> its built-in monad transformers). This allows you to just write <code>f :: (MonadState A m, MonadError () m) =&gt; m C</code> if those are the only features of the monad that your function is using. Due to its extreme non-portability and a few other reasons, <code>mtl</code> is generally considered pseudo-deprecated. See <a href=\"https://wiki.haskell.org/Monad_Transformer_Library\" rel=\"nofollow noreferrer\">this page</a> and <a href=\"https://stackoverflow.com/questions/2769487/mtl-transformers-monads-fd-monadlib-and-the-paradox-of-choice\">this question</a> for the gory details.</li>\n<li>If you have a <em>particular</em> monad stack you are using over and over again, you can wrap it in a <code>newtype</code> and write instances of the various monad type classes it supports manually. For <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, and any other type classes implemented by the top-level transformer in your stack, you can use <code>GeneralizedNewtypeDeriving</code> to have the compiler write the instances for you automatically; for other type classes, you will have to insert the appropriate number of <code>lift</code> calls for each method. The advantage of this approach is that it's more general and simpler to understand while giving you the same flexibility at the call site as <code>mtl</code>. The big problem with this approach is that it encourages using a single \"mega-monad\" for all operations rather than specifying only the needed operations, since adding any new monad transformer to the stack requires writing a whole new list of instances.</li>\n<li>In most cases, you don't really want a monad that has \"some arbitrary state of type <code>A</code>\" and \"some arbitrary exception-throwing capability\". Rather, the different features offered by your monad stack have some semantic meaning in your mental model of your program. A variation of the previous approach is to create custom type classes for the effects beyond the basic <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> and write instances for the custom type classes on your <code>newtype</code>'d monad instead. This has a major advantage over the other approaches listed here: you can have a stack with multiple copies of the same monad transformer in it at different positions. This is the strategy I've used the most in my own programs so far.</li>\n<li>A completely different approach is <em>effect systems</em>. Normally, an effect system has to be built in to a language's type system, but it's possible to <a href=\"http://www.doc.ic.ac.uk/~dorchard/publ/haskell14-effects.pdf\" rel=\"nofollow noreferrer\">encode an effect system in Haskell's type system</a>. See the <a href=\"https://hackage.haskell.org/package/effect-monad\" rel=\"nofollow noreferrer\">effect-monads</a> package.</li>\n</ul>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 0, "accepted_answer_id": 32551875, "answer_count": 2, "score": 4, "last_activity_date": 1442161691, "creation_date": 1442157293, "last_edit_date": 1442158396, "question_id": 32551152, "link": "https://stackoverflow.com/questions/32551152/flatten-monad-stack", "title": "Flatten monad stack", "body": "<p>So I have this sort of code all over my first serious haskell project:</p>\n\n<pre><code>f :: (MonadTrans t) =&gt; ExceptT () (t (StateT A B)) C\nf = do mapExceptT lift $ do\n    lift $ do\n        ...\n        lift $ do\n            ...\n            r &lt;- ...\n            ...\n            return r\n    &gt;&gt;= \\r -&gt; ...\n</code></pre>\n\n<p>There definitely may be something wrong about how I try to achieve my goals (there might be simpler ways how to do it) but currently I am interested in learning how to handle a stack of monad transformers in some nicer way, if there is one. This is the only way I figured out how to get <code>r</code> in the context of <code>B</code> and lift it to a monad higher in the stack. Lifting whole blocks instead of initial statements is as far as I could get on my own.</p>\n\n<p>What I also often end up with are chains of <code>lift</code> which I found out can be avoided with <code>liftIO</code> if the deep monad is <code>IO</code>. I am not aware of a generic way for other monads though.</p>\n\n<p>Is there a pattern that one can follow when he ends up dealing with such stacks, and having to extract one value at some level, a different value at a different level, combine these and affect any of the two levels or maybe yet another one?</p>\n\n<p>Can the stack be manipulated somehow without neither lifting whole blocks (which causes <code>let</code> and bound variables to be scoped and restricted to the inner block) nor having to <code>lift . lift . ... lift</code> individual actions?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": false, "score": 0, "last_activity_date": 1442157604, "creation_date": 1442157604, "answer_id": 32551203, "question_id": 32551144, "link": "https://stackoverflow.com/questions/32551144/inverting-list-elements-in-haskell/32551203#32551203", "title": "Inverting List Elements in Haskell", "body": "<p>Examine the following solution:</p>\n\n<pre><code>invert :: [[a]] -&gt; [[a]]\ninvert = fmap conditionallyInvert\n  where\n    conditionallyInvert xs\n      | lengthOfTwo xs = reverse xs\n      | otherwise      = xs\n    lengthOfTwo (_:_:_) = True\n    lengthOfTwo      _  = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 1, "last_activity_date": 1442157620, "creation_date": 1442157620, "answer_id": 32551206, "question_id": 32551144, "link": "https://stackoverflow.com/questions/32551144/inverting-list-elements-in-haskell/32551206#32551206", "title": "Inverting List Elements in Haskell", "body": "<p>I would do this:</p>\n\n<pre><code>solution ([a,b]:xs) = [b,a] : solution xs\nsolution (x:xs)     = x : solution xs\nsolution []         = []\n</code></pre>\n\n<p>This explicitly handles 2-element lists, leaving everything else alone. </p>\n\n<p>Yes, you could do this with <code>map</code> and an auxiliary function, but for a beginner, understanding the recursion behind it all may be valuable.</p>\n\n<p>Note that your 'empty list case' is <em>not</em> empty. <code>length [[]]</code> is 1.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1442157629, "creation_date": 1442157629, "answer_id": 32551209, "question_id": 32551144, "link": "https://stackoverflow.com/questions/32551144/inverting-list-elements-in-haskell/32551209#32551209", "title": "Inverting List Elements in Haskell", "body": "<p>Your inert function just operations on each element individually, so you can express it as a <code>map</code>:</p>\n\n<pre><code>invert xs = map go xs\n  where go = ...\n</code></pre>\n\n<p>Here <code>go</code> just inverts a single list according to your rules, i.e.:</p>\n\n<pre><code>go [1,2] = [2,1]\ngo [4,5,6] = [4,5,6]\ngo []    = []\n</code></pre>\n\n<p>The definition of <code>go</code> is pretty straight-forward:</p>\n\n<pre><code>go [a,b] = [b,a]\ngo xs    = xs     -- go of anything else is just itself\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1442157678, "creation_date": 1442157678, "answer_id": 32551219, "question_id": 32551144, "link": "https://stackoverflow.com/questions/32551144/inverting-list-elements-in-haskell/32551219#32551219", "title": "Inverting List Elements in Haskell", "body": "<p>Here's one way to do this:</p>\n\n<p>First we define a function to invert one list (if it has two elements; otherwise we return the list unchanged):</p>\n\n<pre><code>invertOne :: [a] -&gt; [a]\ninvertOne [x, y] = [y, x]\ninvertOne xs = xs\n</code></pre>\n\n<p>Next we apply this function to all elements of an input list:</p>\n\n<pre><code>invert :: [[a]] -&gt; [[a]]\ninvert xs = map invertOne xs\n</code></pre>\n\n<p>(Because that's exactly what <code>map</code> does: it applies a function to all elements of a list and collects the results in another list.)</p>\n"}], "owner": {"reputation": 99, "user_id": 3055141, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a1214f2f78a71c96e8dbc28c503a73cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3055141", "link": "https://stackoverflow.com/users/3055141/user3055141"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 32551219, "answer_count": 4, "score": 0, "last_activity_date": 1488823561, "creation_date": 1442157263, "last_edit_date": 1442157637, "question_id": 32551144, "link": "https://stackoverflow.com/questions/32551144/inverting-list-elements-in-haskell", "title": "Inverting List Elements in Haskell", "body": "<p>I am trying to invert two-elements lists in <code>xs</code>. For example, <code>invert [[1,2], [5,6,7], [10,20]]</code> will return <code>[[2,1], [5,6,7], [20,10]]</code>. It doesn't invert <code>[5,6,7]</code> because it is a 3 element list.</p>\n\n<p>So I have written this so far:</p>\n\n<pre><code>invert :: [[a]] -&gt; [[a]]\ninvert [[]] = [[]]\n</code></pre>\n\n<p>which is just the type declaration and an empty list case. I am new to Haskell so any suggestions on how to implement this problem would be helpful. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1442154881, "post_id": 32550691, "comment_id": 52957423, "body": "<code>$</code> is the apply operator. It applies a function on the left hand side of <code>$</code> to the argument on the right hand side. Often this allows <code>$</code> to replace parentheses around the last argument. However if the function and argument don&#39;t match <code>$</code>&#39;s type signature, you can&#39;t apply the arguments to the function, even if there were parentheses around argument."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442155256, "post_id": 32550691, "comment_id": 52957550, "body": "<b><code>($)</code> is a function!</b>"}], "answers": [{"comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 2, "creation_date": 1442155096, "post_id": 32550756, "comment_id": 52957501, "body": "Note also that <code>($)</code> is a very plain kind of syntactic sugar: It is just a completely ordinary Haskell function defined as <code>($) f x = f x</code> and made infix with the lowest right-associative presedence (<code>infixr 0</code>)."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155452, "post_id": 32550756, "comment_id": 52957617, "body": "Which is kind of what makes it tricky to beginners, IMHO. The sugar is in <code>infixr</code>, not the function definition."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 6, "creation_date": 1442155476, "post_id": 32550756, "comment_id": 52957627, "body": "@gspr It used to be just a plain function, but GHC nowadays treats <code>$</code> used infix as actual syntactic sugar. This makes it work a little better with advanced type extensions."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442155554, "post_id": 32550756, "comment_id": 52957647, "body": "@&#216;rjanJohansen: TIL! Takk :)"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442155730, "post_id": 32550756, "comment_id": 52957689, "body": "@&#216;rjanJohansen Oh my, as if it was confusing enough already. Would you happen to have some link documenting this? You&#39;ve got my curiosity piqued too, here :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1442156704, "post_id": 32550756, "comment_id": 52958045, "body": "See <a href=\"http://stackoverflow.com/questions/9468963/runst-and-function-composition\">this question</a>, especially hammar&#39;s answer."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 1, "creation_date": 1442157229, "post_id": 32550756, "comment_id": 52958215, "body": "Thanks! I&#39;ll add a direct link to <a href=\"https://www.mail-archive.com/glasgow-haskell-users@haskell.org/msg18923.html\" rel=\"nofollow noreferrer\">the ghc-users post</a> for the curious."}], "tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": true, "score": 6, "last_activity_date": 1442154942, "creation_date": 1442154942, "answer_id": 32550756, "question_id": 32550691, "link": "https://stackoverflow.com/questions/32550691/confusion-about-in-haskell-example-where-does-not-plainly-substitute-pa/32550756#32550756", "title": "Confusion about ($) in Haskell: example where ($) does not plainly substitute parentheses", "body": "<p><code>$</code> <em>is</em> syntaxic sugar for parentheses, but it doesn't apply at the level you expect.</p>\n\n<pre><code>go acc book = acc + priceAsDouble $ bookPrice book\n</code></pre>\n\n<p>is actually interpreted as</p>\n\n<pre><code>go acc book = (acc + priceAsDouble) (bookPrice book)\n</code></pre>\n\n<p>But <code>acc + priceAsDouble</code> doesn't make sense as a function to GHC.</p>\n\n<p>Ironically, you'd need more parentheses to make it work:</p>\n\n<pre><code>go acc book = acc + (priceAsDouble $ bookPrice book)\n</code></pre>\n"}], "owner": {"reputation": 703, "user_id": 2688424, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c854b2c7c2dc30bd2ee91dd7f53e6589?s=128&d=identicon&r=PG&f=1", "display_name": "madison54", "link": "https://stackoverflow.com/users/2688424/madison54"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 32550756, "answer_count": 1, "score": 2, "last_activity_date": 1442154942, "creation_date": 1442154576, "question_id": 32550691, "link": "https://stackoverflow.com/questions/32550691/confusion-about-in-haskell-example-where-does-not-plainly-substitute-pa", "title": "Confusion about ($) in Haskell: example where ($) does not plainly substitute parentheses", "body": "<p>Suppose I have data types</p>\n\n<pre><code>data Price = Price Double\ndata Book = Book {title :: String, bookPrice :: Price}\n</code></pre>\n\n<p>with a function extracting the numerical price</p>\n\n<pre><code>priceAsDouble :: Price -&gt; Double\npriceAsDouble (Price doubleValue) = doubleValue\n</code></pre>\n\n<p>Now, I want to write an accumulator for a fold over a book list, such as</p>\n\n<pre><code>go :: Double -&gt; Book -&gt; Double\ngo acc book = acc + priceAsDouble (bookPrice book)\n</code></pre>\n\n<p>which is fine and compiles.</p>\n\n<p>However, if I change the last line to </p>\n\n<pre><code>go acc book = acc + priceAsDouble $ bookPrice book\n</code></pre>\n\n<p>I get the following contradicting compiler error:</p>\n\n<pre><code>&lt;interactive&gt;:10:51:\nCouldn't match expected type \u2018Price -&gt; Double\u2019\n            with actual type \u2018Double\u2019\nThe first argument of ($) takes one argument,\nbut its type \u2018Double\u2019 has none\nIn the expression: acc + priceAsDouble $ bookPrice book\nIn an equation for \u2018go\u2019:\n    go acc book = acc + priceAsDouble $ bookPrice book\n\n&lt;interactive&gt;:10:57:\nCouldn't match expected type \u2018Double\u2019\n            with actual type \u2018Price -&gt; Double\u2019\nProbable cause: \u2018priceAsDouble\u2019 is applied to too few arguments\nIn the second argument of \u2018(+)\u2019, namely \u2018priceAsDouble\u2019\nIn the expression: acc + priceAsDouble\n</code></pre>\n\n<p><strong>Question</strong>: I thought that ($) is nothing else but syntactical sugar for parentheses (). Evidently, I was wrong. Where is the mistake in my thought?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1442154541, "post_id": 32550638, "comment_id": 52957295, "body": "based on <a href=\"https://downloads.haskell.org/~ghc/7.6.1/docs/html/users_guide/release-7-6-1.html\" rel=\"nofollow noreferrer\">release notes</a>, <code>MultiWayIf</code> extension was added in 7.6.1. so it will not work on ghc 7.4."}], "answers": [{"tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": true, "score": 5, "last_activity_date": 1442154732, "creation_date": 1442154732, "answer_id": 32550718, "question_id": 32550638, "link": "https://stackoverflow.com/questions/32550638/haskell-how-to-resolve-this-error-unsupported-extension-multiwayif/32550718#32550718", "title": "Haskell how to resolve this error: Unsupported extension: MultiWayIf", "body": "<p>MultiWayIf was introduced in the 7.6 branch of GHC. You're going to have to upgrade the compiler or patch the library.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 32550718, "answer_count": 1, "score": 2, "last_activity_date": 1442154732, "creation_date": 1442154255, "question_id": 32550638, "link": "https://stackoverflow.com/questions/32550638/haskell-how-to-resolve-this-error-unsupported-extension-multiwayif", "title": "Haskell how to resolve this error: Unsupported extension: MultiWayIf", "body": "<p>while trying to install the <code>friday</code> package, I got the error </p>\n\n<pre><code>Preprocessing library friday-0.2.2.0...\n\nsrc/Vision/Detector/Edge.hs:3:14: Unsupported extension: MultiWayIf\ncabal: Error: some packages failed to install:\nfriday-0.2.2.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>How to resolve this error?</p>\n\n<p>I am using ghc version 7.4.1 and </p>\n\n<pre><code>cabal-install version 0.14.0\nusing version 1.14.0 of the Cabal library \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1442154729, "post_id": 32550568, "comment_id": 52957372, "body": "Adding an explicit type signature to <code>hello</code> will clarify things a lot!"}, {"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155195, "post_id": 32550568, "comment_id": 52957531, "body": "I tried that, but without succes. Could you please indicate me how to do that correctly?"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155239, "post_id": 32550568, "comment_id": 52957543, "body": "What do you <i>want</i> the type of <code>hello</code> to be? What are <code>i</code>, <code>j</code>, <code>p</code>, <code>n</code> and the return value? Think of an explicit case first (i.e. concrete types), and then we can think about typeclasses later. From your code I want to suggest (as a first version) that <code>i</code>, <code>j</code>  and <code>n</code> are <code>Integer</code>s and <code>p</code> is a <code>Double</code>."}, {"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155347, "post_id": 32550568, "comment_id": 52957587, "body": "i,j and n should be integers, and p any Num. I tried (Num t) =&gt; Integer -&gt; Integer -&gt; t -&gt; Integer -&gt; [t] and it does not work."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155497, "post_id": 32550568, "comment_id": 52957636, "body": "Right, let&#39;s say <code>p :: Double</code> do be concrete for now. Now <code>n choose l</code> must be <code>Integer</code> (check the signature of <code>choose</code>), and <code>p^l</code> is the same type as <code>p</code> , namley <code>Double</code> (check the signature of <code>(^)</code>). Thus you are trying to apply <code>(*)</code> to an <code>Integer</code> and a <code>Double</code>. This you cannot do. How about you pass the first argument of <code>(*)</code> through <code>fromIntegral</code>?"}, {"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442155700, "post_id": 32550568, "comment_id": 52957680, "body": "oh, that clarifies the problem"}, {"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1442156242, "post_id": 32550568, "comment_id": 52957859, "body": "thanks gspr, it works!"}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "edited": false, "score": 0, "creation_date": 1442155948, "post_id": 32550814, "comment_id": 52957749, "body": "Is there any way to make it work with Double o Floating? p is supposed to be a quantile of a distribution"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "edited": false, "score": 0, "creation_date": 1442157446, "post_id": 32550814, "comment_id": 52958277, "body": "@monalisa well, if you know what you&#39;re doing, there&#39;s nothing preventing you from lifting the <code>choose</code> code (or rewriting it altogether from other sources) so that its types fit what you want. It would be kind of weird to still name it &quot;choose&quot;, though."}], "tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": false, "score": 1, "last_activity_date": 1442155331, "creation_date": 1442155331, "answer_id": 32550814, "question_id": 32550568, "link": "https://stackoverflow.com/questions/32550568/type-issue-with-n-choose-k-in-haskell/32550814#32550814", "title": "type issue with n choose k in haskell", "body": "<p>It's a type issue deeper than can be solved:</p>\n\n<pre><code>\u03bb&gt; :t hello\nhello :: Integral b =&gt; b -&gt; b -&gt; b -&gt; b -&gt; [b]\n</code></pre>\n\n<p>Your <code>hello</code> function only works on integrals.  This is inherited from the <code>choose</code> function, which also only works on integrals:</p>\n\n<pre><code>\u03bb&gt; :t choose\nchoose :: Integral a =&gt; a -&gt; a -&gt; a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1442156084, "creation_date": 1442156084, "answer_id": 32550931, "question_id": 32550568, "link": "https://stackoverflow.com/questions/32550568/type-issue-with-n-choose-k-in-haskell/32550931#32550931", "title": "type issue with n choose k in haskell", "body": "<p>As @JB. pointed out, if you ask ghc (or ghci) for the type of <code>hello</code> it responds with:</p>\n\n<pre><code>hello :: Integral b =&gt; b -&gt; b -&gt; b -&gt; b -&gt; [b]\n</code></pre>\n\n<p>which says that <code>p</code> must be an integral value.</p>\n\n<p>There is a further problem, though. Suppose <code>p</code> is a Double and the rest or the arguments are <code>Int</code> values. Then we have the following types:</p>\n\n<ul>\n<li><code>choose n l</code> is an <code>Int</code></li>\n<li><code>p ^ l</code> is a <code>Double</code></li>\n<li><code>(1-p) ^ (n-l)</code> is a <code>Double</code></li>\n</ul>\n\n<p>and we are trying to multiple them all together. In Haskell you can't multiply an <code>Int</code> and a <code>Doulble</code> without converting one to the other's type. The way in Haskell to generically convert a integral value is to use <code>fromIntegral</code>, so you want to use:</p>\n\n<pre><code>(fromIntegral (choose n l)) * (p^l) * ((1-p) ^ (n-l))\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 4705110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ada610300cd4d32b87025c8c879cf3df?s=128&d=identicon&r=PG", "display_name": "monalisa", "link": "https://stackoverflow.com/users/4705110/monalisa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1442156084, "creation_date": 1442153800, "question_id": 32550568, "link": "https://stackoverflow.com/questions/32550568/type-issue-with-n-choose-k-in-haskell", "title": "type issue with n choose k in haskell", "body": "<p>I defined this in Haskell</p>\n\n<pre><code>import Math.Combinatorics.Exact.Binomial \nhello i j p n = [(n `choose` l)*(p^l)*((1-p)^(n-l)) | l &lt;- [i,i+1..j]]\n</code></pre>\n\n<p>It compiles but when I try to run 'hello' with a non integer p, ghci says:</p>\n\n<pre><code>No instance for (Fractional b0) arising from the literal `0.75'\nThe type variable `b0' is ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nNote: there are several potential instances:\n  instance Fractional Double -- Defined in `GHC.Float'\n  instance Fractional Float -- Defined in `GHC.Float'\n  instance Integral a =&gt; Fractional (GHC.Real.Ratio a)\n    -- Defined in `GHC.Real'\nIn the third argument of `hello', namely `0.75'\nIn the expression: hello 2 5 0.75 10\nIn an equation for `it': it = hello 2 5 0.75 10\n</code></pre>\n\n<p>Seems like it is a type issue but I am unable to resolve it. Any help is appreciated :)</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1442150979, "post_id": 32550132, "comment_id": 52956364, "body": "The type <code>A -&gt; B</code> can also be written <code>(-&gt;) A B</code>. For example, <code>negate :: (-&gt;) Integer Integer</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1442151232, "post_id": 32550132, "comment_id": 52956432, "body": "@melpomene: I can get that far, but what I&#39;n stumbling over is how it can be the same as <code>\\c -&gt; (negate c, (+5) c)</code>. For one thing, the result is <code>(c, c&#39;)</code>. (Headache!)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1442152328, "post_id": 32550132, "comment_id": 52956702, "body": "The <code>a</code> in the arrow signature is the equivalent of <code>-&gt;</code>.  If we could use infix syntax in type-signatures you could write: <code>(&amp;&amp;&amp;) :: b `a` c -&gt; b `a` c&#39; -&gt; b `a` (c, c&#39;)</code>.  So the first argument is a &quot;function&quot; from <code>b</code> to <code>c</code>, the second is a &quot;function&quot; from <code>b</code> to <code>c&#39;</code> and the result is a function from <code>b</code> to <code>(c, c&#39;)</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1442166328, "post_id": 32550132, "comment_id": 52961186, "body": "Just try <code>:type (negate &amp;&amp;&amp; (+5))</code>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1442166650, "post_id": 32550132, "comment_id": 52961303, "body": "@Bergi: Yes, clearly. But how did I get there?"}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442171464, "post_id": 32550244, "comment_id": 52962817, "body": "Your addendum is correct. That&#39;s exactly what I was missing: ` (-&gt;)` is distinct from the <code>-&gt;</code> in the type signatures I&#39;m used to, so that my <code>negate</code>, for example, isn&#39;t <code>a</code>, its <code>a b c</code>, or rather  <code>b -&gt; c</code> (or  <code>b ~&gt; c</code>). In other words, <code>negate</code> matches <i>all</i> of <code>a b c</code> as an <code>Arrow</code> that takes <code>b</code>s and produces <code>c</code>s ( <code>b ~&gt; c</code>) which happens to be a function that takes <code>b</code>s and produces <code>c</code>s (<code>b -&gt; c</code>). Right?"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442171960, "post_id": 32550244, "comment_id": 52962995, "body": "@raxacoricofallapatorius That&#39;s exactly it. <code>negate</code> is a function, you&#39;re using it as an argument to <code>&amp;&amp;&amp;</code> which expects arrows, and it works because functions are arrows. It returns a specific arrow of the kind you handed it with: another function."}], "tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": true, "score": 10, "last_activity_date": 1442154109, "last_edit_date": 1442154109, "creation_date": 1442151669, "answer_id": 32550244, "question_id": 32550132, "link": "https://stackoverflow.com/questions/32550132/how-to-make-sense-of-the-haskell-type-signature-for-control-arrows-operat/32550244#32550244", "title": "How to make sense of the Haskell type signature for Control.Arrow&#39;s &#39;&amp;&amp;&amp;&#39; operator", "body": "<p>I always think of <code>&amp;&amp;&amp;</code> as a split and apply operation. You've got an Arrow value, and you're going to apply two functions (sorry, arrows, but it works with functions and makes explanations easier) to it, and keep both results, thus splitting the stream.</p>\n\n<p>Dead simple example:</p>\n\n<pre><code>\u03bb&gt; (succ &amp;&amp;&amp; pred) 42\n(43,41)\n</code></pre>\n\n<p>Walking the type there, we've got</p>\n\n<pre><code>succ &amp;&amp;&amp; pred :: Arrow a, Enum b =&gt; a b (b,b)\n</code></pre>\n\n<p>A more complex example where it's not all b:</p>\n\n<pre><code>show &amp;&amp;&amp; (== 42) :: Arrow a, Show b, Eq b, Num b =&gt; a b (String,Bool)\n</code></pre>\n\n<p>So in plain english: <code>&amp;&amp;&amp;</code> takes two functions, and combines them into a single function that takes it input, applies both functions to it, and returns the result pair.</p>\n\n<p>But it's defined on arrows, not functions.  Yet it works exactly the same: it takes two arrows, and combines them into a single arrow that takes its input, applies both arrows to it, and returns the result pair.</p>\n\n<pre><code>arrowOne :: Arrow a =&gt; a b c\narrowTwo :: Arrow a =&gt; a b c'\narrowOne &amp;&amp;&amp; arrowTwo :: Arrow a =&gt; a b (c,c')\n</code></pre>\n\n<p>Addendum: part of what seems to confuse you is whether or not the <code>a</code> type still appears in the type signatures.  The rule of thumb here is that it works the same as for when you see the <code>-&gt;</code> in function types: it shows as long as it's not applied.</p>\n\n<p>I recall reading some Arrow literature that wrote arrows as <code>b ~&gt; c</code> (note the tilde not dash) instead of <code>a b c</code>, to make the parallel with functions more apparent.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442171468, "post_id": 32550390, "comment_id": 52962820, "body": "What I was missing was that ` (-&gt;)` is different from the <code>-&gt;</code> in the type signatures I&#39;m used to, so that my <code>negate</code>, for example, isn&#39;t <code>a</code>, its <code>a b c</code>. (Right?)"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442172138, "post_id": 32550390, "comment_id": 52963057, "body": "@raxacoricofallapatorius right, <code>negate</code> is <code>a b c</code>, and <code>(-&gt;)</code> is <code>a</code>, which is then consistent because negate is <code>b -&gt; c</code> the infix form of <code>(-&gt;) b c</code>."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 9, "last_activity_date": 1442153733, "last_edit_date": 1442153733, "creation_date": 1442152653, "answer_id": 32550390, "question_id": 32550132, "link": "https://stackoverflow.com/questions/32550132/how-to-make-sense-of-the-haskell-type-signature-for-control-arrows-operat/32550390#32550390", "title": "How to make sense of the Haskell type signature for Control.Arrow&#39;s &#39;&amp;&amp;&amp;&#39; operator", "body": "<p>The signature says, </p>\n\n<pre><code>(&amp;&amp;&amp;) :: Arrow a =&gt; a b c -&gt; a b c' -&gt; a b (c, c')\n</code></pre>\n\n<p>and <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Control.Arrow.html#line-139\"><code>(-&gt;)</code> is an instance of <code>Arrow</code> type class.</a> So, rewriting the signature specialized for <code>(-&gt;)</code> type:</p>\n\n<pre><code>(&amp;&amp;&amp;) :: ((-&gt;) b c) -&gt; ((-&gt;) b c') -&gt; ((-&gt;) b (c, c'))\n</code></pre>\n\n<p>in, infix form it will look like:</p>\n\n<pre><code>(b -&gt; c) -&gt; (b -&gt; c') -&gt; (b -&gt; (c, c'))\n</code></pre>\n\n<p>which simply means</p>\n\n<pre><code>(&amp;&amp;&amp;) :: (b -&gt; c)   -- given a function from type `b` to type `c`\n      -&gt; (b -&gt; c')  -- and another function from type `b` to type `c'`\n      -&gt; (b -&gt; (c, c')) -- returns a function which combines the result of\n                        -- first and second function into a tuple\n</code></pre>\n\n<p>a simple replication would be:</p>\n\n<pre><code>(&amp;:&amp;) :: ((-&gt;) b c) -&gt; ((-&gt;) b c') -&gt; ((-&gt;) b (c, c'))\nf &amp;:&amp; g = \\x -&gt; (f x, g x)\n</code></pre>\n\n<p>which would work the same way:</p>\n\n<pre><code>\\&gt; (negate &amp;:&amp; (+5)) &lt;$&gt; [1, 2, 3]\n[(-1,6),(-2,7),(-3,8)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1442152871, "creation_date": 1442152871, "answer_id": 32550432, "question_id": 32550132, "link": "https://stackoverflow.com/questions/32550132/how-to-make-sense-of-the-haskell-type-signature-for-control-arrows-operat/32550432#32550432", "title": "How to make sense of the Haskell type signature for Control.Arrow&#39;s &#39;&amp;&amp;&amp;&#39; operator", "body": "<p>It might be easier to skip some of the explanation of how arrows work and look at the type of <code>(negate &amp;&amp;&amp; (+5))</code>:</p>\n\n<pre><code>&gt; :t (negate &amp;&amp;&amp; (+5))\n(negate &amp;&amp;&amp; (+5)) :: Num a =&gt; a -&gt; (a, a)\n</code></pre>\n\n<p>With <code>negate :: a -&gt; a</code> and <code>(+5) :: a -&gt; a</code>, the function created by <code>&amp;&amp;&amp;</code> takes a value of type <code>a</code> and returns a pair of values, both of which have type <code>a</code> as well.</p>\n\n<p>When considering a function as an instance of <code>Arrow</code>, <code>b</code> and <code>c</code> are simply the names given to the argument and return types, respectively. That is, if <code>f :: b -&gt; c</code> and <code>g :: b -&gt; c'</code> are two functions that take arguments of the same type but return values of possibly different types, then <code>( f &amp;&amp;&amp; g ) :: b -&gt; (c, c')</code>, meaning the new function takes a single value of the common input type, then returns a pair consisting of the return values of each of the original functions, or <code>( f &amp;&amp;&amp; g ) x = (f x, g x)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442232126, "post_id": 32555637, "comment_id": 52983563, "body": "Another <i>great</i> answer. I&#39;m going to have a hard time choosing!"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442232248, "post_id": 32555637, "comment_id": 52983632, "body": "The thing I was missing completely was that <code>a</code> is matching <code>~&gt;</code> so that <code>a b c</code> matched, for example, <code>negate</code> \u2014 as <code>b ~&gt; c</code> \u2014 which, more familiarly is also <code>b -&gt; c</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442232349, "post_id": 32555637, "comment_id": 52983691, "body": "What, btw, other than a function could be an <code>Arrow</code> (in this context anyway: of being something that takes a <code>b</code> and produces a <code>c</code>)?"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442240547, "post_id": 32555637, "comment_id": 52989432, "body": "Every Applicative including every Monad is an arrow; see <a href=\"http://hackage.haskell.org/package/optparse-applicative-0.7.0.1/docs/src/Options-Applicative-Arrows.html#A\" rel=\"nofollow noreferrer\">this link</a>. Control.Arrow more specifically defines one for each Kleisli arrow <code>a -&gt; m b</code> of a monad <code>m</code> <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Control.Arrow.html#Kleisli\" rel=\"nofollow noreferrer\">here</a>. Arrows (and more confusingly, functions returning arrows) are seen a ton in the package HXT which parses XML, e.g. <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlArrow.html#t:ArrowXml\" rel=\"nofollow noreferrer\">the ArrowXML class</a>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442244910, "post_id": 32555637, "comment_id": 52992400, "body": "Are there <code>Arrow</code>s other than functions that can take a <code>b</code> as an argument and return a <code>c</code>?"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442250954, "post_id": 32555637, "comment_id": 52995802, "body": "@raxacoricofallapatorius I mean, at the very least you have <code>newtype C a b = C {runC :: forall z. (b -&gt; c -&gt; z) -&gt; z}</code> which is isomorphic to <code>(-&gt;)</code> but does not return a <code>c</code> directly. Also, the recipe for using an Applicative as an Arrow can be used with the <code>Applicative (Monoid m) =&gt; Const m</code> declaration, in which the <code>c</code> is a &quot;phantom type variable&quot; and the functions can never be coerced to return a <code>c</code> at all. I think the <code>a</code> must always appear as at least one argument in some function, though, and if it exists as an output this cannot affect the <code>(.)</code> function due to types."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 4, "last_activity_date": 1442188279, "creation_date": 1442188279, "answer_id": 32555637, "question_id": 32550132, "link": "https://stackoverflow.com/questions/32550132/how-to-make-sense-of-the-haskell-type-signature-for-control-arrows-operat/32555637#32555637", "title": "How to make sense of the Haskell type signature for Control.Arrow&#39;s &#39;&amp;&amp;&amp;&#39; operator", "body": "<p>You've got a bunch of great answers; I just wanted to add how to understand this thing <em>by only looking at the syntax</em>.</p>\n\n<p>The rules for Haskell's type language are the same as Haskell's normal language: <code>f a b = (f a) b</code> is some type-function <code>f</code> applied to some type-argument <code>a</code> to produce another type-function <code>f a</code> which is being applied to some type-argument <code>b</code>. Then there is one operator (and some compiler flags allow you to enable others) <code>-&gt;</code> which denotes the type of functions which expect the first type as input and return the second type as output.</p>\n\n<p>So the expression <code>(&amp;&amp;&amp;) :: (Arrow a) =&gt; a b c -&gt; a b c' -&gt; a b (c, c')</code> means \"The type of functions from <code>a b c</code> to functions from <code>a b c'</code> to <code>a b (c, c')</code> with the added constraint that <code>a</code> is a member of the Arrow typeclass.</p>\n\n<p>There are lots of different sorts of arrows; this says \"I take two arrows of the same sort, one from <code>b</code> to <code>c</code> and another from <code>b</code> to <code>c'</code>, and combine them together into an arrow of that same sort, from <code>b</code> to <code>(c, c')</code>.\"</p>\n\n<p>Intuitively, we'd say that it composes the two arrows \"in parallel\" so that they both act on the same input, produce their different outputs, and then we \"join\" those outputs with our inhomogeneous-pair data structure <code>(,)</code>.</p>\n\n<p>For the special case where the arrow is <code>(-&gt;)</code>, the function arrow, this is clearly <code>(f &amp;&amp;&amp; g) = \\b -&gt; (f b, g b)</code>. This operator <code>(&amp;&amp;&amp;)</code> is a part of the definition of the <code>Arrow</code> typeclass, so something can only be an <code>Arrow</code> from one type to another type if there is some way to perform an analogous \"parallel operation\" of the two arrows.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 2, "accepted_answer_id": 32550244, "answer_count": 4, "score": 11, "last_activity_date": 1442188279, "creation_date": 1442150840, "last_edit_date": 1442153478, "question_id": 32550132, "link": "https://stackoverflow.com/questions/32550132/how-to-make-sense-of-the-haskell-type-signature-for-control-arrows-operat", "title": "How to make sense of the Haskell type signature for Control.Arrow&#39;s &#39;&amp;&amp;&amp;&#39; operator", "body": "<p>I'm trying to wrap my head around how Haskell's <code>Control.Arrow</code>'s <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html#v:-38--38--38-\" rel=\"noreferrer\"><code>&amp;&amp;&amp;</code></a> works, but fear I'm on the verge of losing my way.</p>\n\n<p>Specifically, I'm confused (as a beginner) by how to makes sense of its behavior from the type signature</p>\n\n<pre><code>(&amp;&amp;&amp;) :: a b c -&gt; a b c' -&gt; a b (c, c')\n</code></pre>\n\n<p>in </p>\n\n<pre><code>import Control.Arrow\n(negate &amp;&amp;&amp; (+5)) &lt;$&gt; [1,2,3]\n</code></pre>\n\n<p>or even just</p>\n\n<pre><code>(negate &amp;&amp;&amp; (+5)) 5\n</code></pre>\n\n<p>for example, the first argument is \"missing\" <code>b</code> and <code>c</code>, while the second is missing just <code>c'</code>, and the result looks to me like <code>(c, c')</code>, not <code>a b (c, c')</code>.</p>\n\n<p>Can someone walk me through how <code>&amp;&amp;&amp;</code> works, in the context of its type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1442150581, "post_id": 32549948, "comment_id": 52956254, "body": "<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a> <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442186207, "post_id": 32550216, "comment_id": 52966880, "body": "I have added <code>default (Int, Float)</code> and still don&#39;t get the Int instance called, so the solution must be something else. I am using GHCi 7.8.3"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442186969, "post_id": 32550216, "comment_id": 52967016, "body": "Even if I disable the default rules for Num by doing <code>default ()</code> the Integer instance still gets called."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442190822, "post_id": 32550216, "comment_id": 52967761, "body": "I think what is happening is that GHCi doesn&#39;t take into account the default statement in your source file (the report states that the effect of the <code>default</code> statement is limited to the module). If I load a module with your source and type <code>5 .+. 9</code> I get an <code>Integer</code>. After that I type <code>default (Int, Float)</code> (in ghci) and then <code>5 .+. 9</code> again, then I get an <code>Int</code>. So it works for me."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442223770, "post_id": 32550216, "comment_id": 52978672, "body": "I tested and got the same behavior as you did. This is probably then a bug in GHCi ..."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442227738, "post_id": 32550216, "comment_id": 52980898, "body": "I don&#39;t think it&#39;s a bug, the behavior is as specified in the report."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442229295, "post_id": 32550216, "comment_id": 52981796, "body": "So I have to read the report to understand the different behaviors between compiled and interpreted modes of Haskell?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442229563, "post_id": 32550216, "comment_id": 52981961, "body": "The issue you encountered is not really a difference between the compiled and interpreted mode. The <code>default</code> statement is <i>local to the module in which it is defined</i> - when you load the module you are not in this local environment. It doesn&#39;t matter whether you load the module from ghci, or from inside another module. If you put your printing statement in a main function inside the source file the <code>default</code> setting will be taken into account (because then you are in the local environment)."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442229900, "post_id": 32550216, "comment_id": 52982166, "body": "OK, I understand now. But I don&#39;t think that was a good choice by Haskell&#39;s designers. It may cause confusion having different defaults in different modules."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 2, "creation_date": 1442232099, "post_id": 32550216, "comment_id": 52983550, "body": "@mljrg It would probably be <i>more</i> confusing if the default types suddenly changed just because you loaded some 3rd party module..."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442474268, "post_id": 32550216, "comment_id": 53099031, "body": "You said &quot;If you put your printing statement in a main function inside the source file the default setting ...&quot; will work. I have done it and got the above error when loading the file. I only tested what you suggested know, and it did not work. That&#39;s why I reopened the question. Can you please help?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442475649, "post_id": 32550216, "comment_id": 53099770, "body": "Right, I didn&#39;t see your edit. See my updated answer."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1442492159, "post_id": 32550216, "comment_id": 53109188, "body": "Aaarrgghhh! Different contexts, different default behaviors! This is a nightmare for those trying to enter Haskell. GHCi and GHC defaults or anything else should be consistent. I have lost hours chasing this ... Two questions: 1) How can I ask GHCi to print the defaults it is using? 2) How can I invoke GHCi (or GHC) so that all behaviors are the same at the prompt or when loading code from files?"}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "edited": false, "score": 0, "creation_date": 1442492606, "post_id": 32550216, "comment_id": 53109457, "body": "I don&#39;t know the answers to your questions and I can&#39;t find them either. Maybe you can open a separate question for this, I would also be interested in the answers."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 5, "last_activity_date": 1442478298, "last_edit_date": 1592644375, "creation_date": 1442151458, "answer_id": 32550216, "question_id": 32549948, "link": "https://stackoverflow.com/questions/32549948/haskell-rules-for-selecting-between-type-instances-for-int-double-and-integer/32550216#32550216", "title": "Haskell rules for selecting between type instances for Int, Double and Integer", "body": "<p>See <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">section 4.3.4 in the Haskell report</a>. When Haskell reads a literal that looks integral (no decimal component), the type is (unless more specifically inferred) <code>Num a =&gt; a</code>. The moment it <em>needs</em> to choose a type, it uses the defaulting rules, and normally the default is <code>Integer</code>. When a literal has a decimal component, it is <code>Fractional a =&gt; a</code>, which is normally defaulted to <code>Double</code>.</p>\n<p>By using a <code>default</code> top-level declaration, you can change these settings, e.g.:</p>\n<pre><code>default (Int, Float)\n</code></pre>\n<p>would default <code>Num</code> to <code>Int</code> and <code>Fractional</code> to <code>Float</code> (because <code>Int</code> is not <code>Fractional</code>). <em>Note that the effect of this statement is local to the module in which it is declared.</em></p>\n<p>The default statement has the following effect (quoting the report):</p>\n<blockquote>\n<p>Each defaultable variable is replaced by the first type in the default list that is an instance of all the ambiguous variable\u2019s classes. It is a static error if no such type is found.</p>\n</blockquote>\n<p>The -XExtendedDefaultRules GHC flag has additional effects, see <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow noreferrer\">here</a>.</p>\n<hr />\n<p><strong>Edit</strong></p>\n<p>As for your error, the source is the following statement, which is in the <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow noreferrer\">GHC user guide</a> and in different wording in section 4.3.4 of the report:</p>\n<blockquote>\n<p>However, it is tiresome for the user to have to specify the type, so GHCi extends Haskell's type-defaulting rules (Section 4.3.4 of the Haskell 2010 Report) as follows. The standard rules take each group of constraints (C1 a, C2 a, ..., Cn a) for each type variable a, and defaults the type variable if</p>\n<ol>\n<li><p>The type variable a appears in no other constraints</p>\n</li>\n<li><p><strong>All the classes Ci are standard.</strong></p>\n</li>\n<li><p>At least one of the classes Ci is numeric.</p>\n</li>\n</ol>\n</blockquote>\n<p>Where I intentionally put focus on the second bullet. Because you're using <code>.+.</code>, one of the classes of the numbers is <code>MyFuns</code> - which is not a class from the Prelude or the standard library, so it is not a &quot;standard&quot; class. Luckily, the text continues as follows:</p>\n<blockquote>\n<p>At the GHCi prompt, or with GHC if the -XExtendedDefaultRules flag is given, the following additional differences apply:</p>\n<ul>\n<li><p><strong>Rule 2 above is relaxed thus: All of the classes Ci are single-parameter type classes.</strong></p>\n</li>\n<li><p>Rule 3 above is relaxed this: At least one of the classes Ci is numeric, or is Show, Eq, or Ord.</p>\n</li>\n<li><p>The unit type () is added to the start of the standard list of types which are tried when doing type defaulting.</p>\n</li>\n</ul>\n</blockquote>\n<p>In conclusion, if you use the <code>ExtendedDefaultRules</code> flag (which as you can see is active in GHCi by default), your code will compile just fine also with your custom class:</p>\n<pre><code>{-# LANGUAGE ExtendedDefaultRules #-}\n\nimport Debug.Trace\n\ndefault (Int, Float, Double)\n\nclass MyFuns a where\n    (.+.) :: a -&gt; a -&gt; a\n\ninstance MyFuns Double where\n    x .+. y = trace &quot;Double &quot; $ x + y\n\ninstance MyFuns Integer where\n    x .+. y = trace &quot;Integer &quot; $ x + y\n\ninstance MyFuns Int where\n    x .+. y = trace &quot;Int &quot; $ x + y\n\nmain = do\n   print $ 1 .+. 2 -- Interpreted as Int\n</code></pre>\n<p>Note that in this example <code>1.0 .+. 2.0</code> is interpreted as double, while <code>1.0 + 2.0</code> is interpreted as float: this is because there is no <code>MyFuns</code> instance for Float, so its entry in the <code>default</code> list is skipped.</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 1, "accepted_answer_id": 32550216, "answer_count": 1, "score": 4, "last_activity_date": 1442478298, "creation_date": 1442149372, "last_edit_date": 1442448944, "question_id": 32549948, "link": "https://stackoverflow.com/questions/32549948/haskell-rules-for-selecting-between-type-instances-for-int-double-and-integer", "title": "Haskell rules for selecting between type instances for Int, Double and Integer", "body": "<p>I would like to know what are the rules used by Haskell to always decide for the Integer instance instead of the others when evaluating in GHCi the expression <code>1 .+. 2</code>:</p>\n\n<pre><code>import Debug.Trace\n\nclass MyFuns a where\n    (.+.) :: a \u2192  a \u2192  a\n\ninstance MyFuns Double where\n    x .+. y = trace \"Double \" $ x + y\n\ninstance MyFuns Integer where\n    x .+. y = trace \"Integer \" $ x + y\n\ninstance MyFuns Int where \n    x .+. y = trace \"Int \" $ x + y\n</code></pre>\n\n<p><strong>EDIT</strong>: if I add the following code at the end of the file</p>\n\n<pre><code>main = do\n   let x = 1 .+. 2\n   print x\n</code></pre>\n\n<p>why do I get this error?</p>\n\n<pre><code>No instance for (Num a0) arising from the literal \u20181\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include x :: a0 (bound at fun2.hs:19:7)\nNote: there are several potential instances:\n  instance Integral a =&gt; Num (GHC.Real.Ratio a)\n    -- Defined in \u2018GHC.Real\u2019\n  instance Num Integer -- Defined in \u2018GHC.Num\u2019\n  instance Num Double -- Defined in \u2018GHC.Float\u2019\n  ...plus three others\nIn the first argument of \u2018(.+.)\u2019, namely \u20181\u2019\nIn the expression: 1 .+. 2\nIn an equation for \u2018x\u2019: x = 1 .+. 2\n</code></pre>\n\n<p>Yet, if I load the file at GHCi prompt without the <code>main = ...</code>, and then type <code>1 .+. 2</code>, GHCi prints <code>3</code> as expected. Why this behavior?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 2, "creation_date": 1442151729, "post_id": 32547020, "comment_id": 52956541, "body": "When you define <code>data T = T { f :: Int -&gt; Int }</code> the compiler <i>defines</i> a function <code>f :: T -&gt; Int -&gt; Int; f (T x) = x</code> for you."}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442143843, "post_id": 32547049, "comment_id": 52954519, "body": "I am still confused. <code>runState :: s -&gt; (a,s)</code> is just type signature. Can you give an explicit definition of <code>runState</code> function for the code I have given above? I don&#39;t understand the <i>free</i> definition the compiler might be generating for me."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1442148487, "post_id": 32547049, "comment_id": 52955700, "body": "@mntk123 I added something like this - do you understand now?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 12, "last_activity_date": 1442151401, "last_edit_date": 1442151401, "creation_date": 1442126742, "answer_id": 32547049, "question_id": 32547020, "link": "https://stackoverflow.com/questions/32547020/haskell-help-to-understand-this-state-monad-code-where-is-runstate-defined/32547049#32547049", "title": "Haskell help to understand this State monad code: where is runState defined?", "body": "<p>Yes you are right it's defined here:</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a,s) }\n</code></pre>\n\n<p>basically from a definition like this you get two <em>functions</em> for free:</p>\n\n<ul>\n<li><code>State :: (s -&gt; (a,s)) -&gt; State s a</code> the constructor (named the same as the type) - here you can <em>wrap</em> in a function into the <code>newtype</code></li>\n<li>and <code>runState :: State s a -&gt; (s -&gt; (a,s))</code> (same as <code>State s a -&gt; s -&gt; (a,s)</code>) from inside the record-syntax - this will take the <em>wrapped</em> function out of the first argument and apply it to the second argument (or return the function back - currying enables us to work with both interpretations nicely)</li>\n</ul>\n\n<p>In a sense, <strong>you</strong> write its code when you create a new <code>State s a</code> value - it will take this value, get to the <em>content</em> and apply it.</p>\n\n<p>So, for example, if you do</p>\n\n<pre><code>runState get \"Hello\"\n{ def. get }\n= runState (State (\\s -&gt; (s,s))) \"Hello\"\n{ apply runState }\n= (\\s -&gt; (s,s)) \"Hello\"\n{ apply }\n= (\"Hello\", \"Hello\")\n</code></pre>\n\n<hr>\n\n<p>to your question - as far as I understand it - the record syntax is equal to this:</p>\n\n<pre><code>newtype State s a = State (s -&gt; (a,s))\n\nrunState :: State s a -&gt; s -&gt; (a,s)\nrunState (State f) s = f s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 10, "last_activity_date": 1442147853, "last_edit_date": 1442147853, "creation_date": 1442147234, "answer_id": 32549651, "question_id": 32547020, "link": "https://stackoverflow.com/questions/32547020/haskell-help-to-understand-this-state-monad-code-where-is-runstate-defined/32549651#32549651", "title": "Haskell help to understand this State monad code: where is runState defined?", "body": "<p>What you seem to be missing is the functionality provided by <em>record syntax</em>. In Haskell, there are multiple ways to define a data type. You are probably familiar with statements like the following:</p>\n\n<pre><code>data MyType = MyType String Int\n</code></pre>\n\n<p>where a type <code>MyType</code> is defined, which is a sum type (i.e. any value of this type has <em>both</em> the <code>String</code> and <code>Int</code> fields filled). If we want to work with this type, we might want to view the <code>String</code> and <code>Int</code> components separately, so we would define accessor functions for this:</p>\n\n<pre><code>getLabel :: MyType -&gt; String\ngetLabel (MyType s _) = s\n\ngetNum :: MyType -&gt; Int\ngetNum (MyType _ i) = i\n</code></pre>\n\n<p>For large data types (with many fields) this can get very tedious, and writing this kind of function is in general very common: often we have a simple type where a constructor wraps the content, and we want a convenient way to access this content in its \"own\" type (i.e. without the wrapper).</p>\n\n<p>Because this desire to access fields is so common, Haskell provides record syntax. When you use record syntax, you essentially name the fields inside a data type, and the functions to extract the values in these fields are generated automatically. So we could redefine our data type from earlier:</p>\n\n<pre><code>data MyType' = MyType' { myLabel :: String, myNum :: Int }\n</code></pre>\n\n<p>and Haskell would generate the accessor functions <code>myLabel :: MyType' -&gt; String</code> and <code>myNum :: MyType' -&gt; Int</code> automatically. These functions then have the same functionality as the <code>getLabel</code> and <code>getNum</code> functions we defined earlier.</p>\n\n<p>Taking the <code>State</code> type as an example, we could have defined it as follows:</p>\n\n<pre><code>newtype State' s a = State' (s -&gt; (a, s))\n</code></pre>\n\n<p>and written a function to access the contents:</p>\n\n<pre><code>getStateFun :: State' s a -&gt; (s -&gt; (a, s))\ngetStateFun (State' f) = f\n</code></pre>\n\n<p>which would allow us to remove the <code>State'</code> \"wrapping\" from around our value. But this is less convenient than using record syntax, which is used in your example: the value stored inside the <code>State</code> wrapper is given the fieldname <code>runState</code>, and Haskell generates the accessor function, which is why the code compiles and runs without problems. <code>runState</code> then basically does the same as <code>getStateFun</code>.</p>\n\n<p>This is also all quite clearly explained in the section \"Record syntax\" in <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"noreferrer\">this chapter from <em>Learn You A Haskell For Great Good</em></a>.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1769, "favorite_count": 3, "accepted_answer_id": 32549651, "answer_count": 2, "score": 11, "last_activity_date": 1442151401, "creation_date": 1442126433, "question_id": 32547020, "link": "https://stackoverflow.com/questions/32547020/haskell-help-to-understand-this-state-monad-code-where-is-runstate-defined", "title": "Haskell help to understand this State monad code: where is runState defined?", "body": "<p>I am new to Haskell and trying to understand monads. I am going thru <a href=\"https://github.com/sdiehl/wiwinwlh/blob/master/src/02-monads/state_impl.hs\">this code</a>\nPutting it here for quick reference </p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a,s) }\n\ninstance Monad (State s) where\n  return a = State $ \\s -&gt; (a, s)\n\n  State act &gt;&gt;= k = State $ \\s -&gt;\n    let (a, s') = act s\n    in runState (k a) s'\n\nget :: State s s\nget = State $ \\s -&gt; (s, s)\n\nput :: s -&gt; State s ()\nput s = State $ \\_ -&gt; ((), s)\n\nmodify :: (s -&gt; s) -&gt; State s ()\nmodify f = get &gt;&gt;= \\x -&gt; put (f x)\n\nevalState :: State s a -&gt; s -&gt; a\nevalState act = fst . runState act\n\nexecState :: State s a -&gt; s -&gt; s\nexecState act = snd . runState act\n</code></pre>\n\n<p>I didn't get where the function <code>runState</code> is defined. It seems its type is declared in <code>newtype State s a = State { runState :: s -&gt; (a,s) }</code>.\nThe most puzzling part is this code compiles without any error.</p>\n\n<p>Where is <code>runState</code> defined? where is its code?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 7, "last_activity_date": 1442109287, "last_edit_date": 1442109287, "creation_date": 1442108841, "answer_id": 32545537, "question_id": 32545459, "link": "https://stackoverflow.com/questions/32545459/what-is-the-operator-in-haskell/32545537#32545537", "title": "What is the :&lt; operator in Haskell?", "body": "<p>In the blog post it's defined by the data declaration for the <code>Cofree</code> type:</p>\n\n<pre><code>data Cofree f a = a :&lt; f (Cofree f a)\n</code></pre>\n\n<p>This makes <code>:&lt;</code> an infix <em>data constructor</em>, which you can use to construct or to pattern match <code>Cofree</code> values.</p>\n\n<p>That definition is also available in the <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Comonad-Cofree.html\"><code>Control.Comonad.Cofree</code></a> module of the <code>free</code> package on Hackage.</p>\n\n<p>There's <em>another</em> frequently used definition of <code>:&lt;</code> in the <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html#g:6\"><code>Data.Sequence</code></a> module of the <code>containers</code> package, as a constructor for the <code>ViewL</code> type used to pattern match the left end of a sequence.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 32545537, "answer_count": 1, "score": 1, "last_activity_date": 1442109287, "creation_date": 1442107868, "question_id": 32545459, "link": "https://stackoverflow.com/questions/32545459/what-is-the-operator-in-haskell", "title": "What is the :&lt; operator in Haskell?", "body": "<p><a href=\"http://dlaing.org/cofun/posts/free_and_cofree.html\" rel=\"nofollow\">This blog post</a> uses the <code>:&lt;</code> operator. What does it do?</p>\n"}, {"tags": ["sql", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "edited": false, "score": 0, "creation_date": 1442131950, "post_id": 32543563, "comment_id": 52951525, "body": "ah yes I missed that operator. Small correction: <code>selectList</code> instead of <code>selectWhere</code> and <code>IdList</code> lower-case since it&#39;s not a type in this case. thanks."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1442090924, "creation_date": 1442090924, "answer_id": 32543563, "question_id": 32543287, "link": "https://stackoverflow.com/questions/32543287/get-multiple-persistent-entries-by-keylist/32543563#32543563", "title": "Get multiple persistent entries by keylist", "body": "<p>I'm on a mobile right now and therefore may get the syntax wrong, but it's something like:</p>\n\n<pre><code>selectWhere [PostId &lt;-. IdList] []\n</code></pre>\n\n<p>That operator is the \"in\" operator, checking if a value is in a list.</p>\n\n<p>Note that this will not give any errors if some of the keys are not found, you'd need to check for that manually.</p>\n"}], "owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 32543563, "answer_count": 1, "score": 2, "last_activity_date": 1442090924, "creation_date": 1442088942, "question_id": 32543287, "link": "https://stackoverflow.com/questions/32543287/get-multiple-persistent-entries-by-keylist", "title": "Get multiple persistent entries by keylist", "body": "<p>I use SQLite with persistent in Haskell.</p>\n\n<p>I have a list of keys i.e. <code>[PostId]</code>.\nNow I want to get all entries<br>\n<code>[Desc PostCrtDate, OffsetBy from, LimitTo (to - from + 1)]</code>.   </p>\n\n<p>Is there an alternative to <code>selectList</code> but with a list of keys instead of or in addition to the \"normal\" conditions of a SQL query?</p>\n\n<p>It seems horribly inefficient to use <code>mapM get keyList</code> and then do sorting/offsetting/limiting, especially with a big database.</p>\n\n<p>I am open to using esqueleto if necessary but I would rather not introduce another dependency.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 3, "creation_date": 1442085852, "post_id": 32542695, "comment_id": 52942552, "body": "If <code>setList</code> is a function that takes 3 arguments, how can <code>setList [1,2] [3,4]</code> even return anything printable? How can it return <code>[(1,3) (2,4)]</code>? And how can you give it two lists, if the second argument should be an Integer?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442086043, "post_id": 32542695, "comment_id": 52942602, "body": "<code>setList</code> as defined definitely doesn&#39;t work, but we can provide a <code>setList</code> that behaves as expected. Well, assuming they still want tuples rather than lists. Making a best effort here."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442086189, "post_id": 32542695, "comment_id": 52942652, "body": "@ReinHenrichs - see the new edit. the op seams to want <code>pair (x:xs) (y:ys) = [x,y] : pair xs ys</code> but I think the type checker will not like it if x is a a and y is a b ..."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442086235, "post_id": 32542695, "comment_id": 52942666, "body": "@Michael The new edit still has <code>(x,y) :</code>, not <code>[x,y] :</code>  (unless we are seeing different edits)."}, {"owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "edited": false, "score": 0, "creation_date": 1442086285, "post_id": 32542695, "comment_id": 52942682, "body": "Yep, I copied the wrong answer in my file. I&#39;ve made the change now, kind of typed the result up thinking it was setList, My bad!"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1442086423, "post_id": 32542695, "comment_id": 52942722, "body": "still... what is <code>prod</code>? It&#39;s not a recursive call. Shouldn&#39;t it be <code>pair</code> instead?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442089796, "post_id": 32542695, "comment_id": 52943652, "body": "@user32132321 I noticed that you have recently posted a number of questions with negative feedback. Before asking a new question, please consider what you have learnt from the last, such as: using <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a>, so as to avoid bad questions."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1442086354, "post_id": 32542755, "comment_id": 52942704, "body": "How you got here from the original question is way beyond me. Well done on that."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442086407, "post_id": 32542755, "comment_id": 52942718, "body": "@DanielWagner I just looked at the expected result and made an educated guess. The rest of the question was confusing so I mostly ignored it... :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442099699, "post_id": 32542755, "comment_id": 52946261, "body": "Another somehow popular variant is <code>(,) &lt;$&gt; [1,2] &lt;*&gt; [2,4]</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1442103759, "post_id": 32542755, "comment_id": 52947035, "body": "@chi and if banana brackets were a thing then we might be able to use <code>(| ([1,2] , [3,4]) |)</code>! Pretty sure that isn&#39;t better either..."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 9, "last_activity_date": 1442086471, "last_edit_date": 1442086471, "creation_date": 1442085624, "answer_id": 32542755, "question_id": 32542695, "link": "https://stackoverflow.com/questions/32542695/haskell-how-can-i-make-this-lists-into-tuple-function-pair-with-all-elements/32542755#32542755", "title": "Haskell - How can I make this lists into tuple function pair with all elements?", "body": "<p>You can use the list applicative (or monad) instance:</p>\n\n<pre><code>\u03bb&gt; liftA2 (,) [1,2] [3,4]\n[(1,3),(1,4),(2,3),(2,4)]\n</code></pre>\n\n<p>Or, equivalently,</p>\n\n<pre><code>f = do\n   x &lt;- [1,2]\n   y &lt;- [3,4]\n   return (x,y)\n</code></pre>\n\n<p>You can also use a list comprehension:</p>\n\n<pre><code>[ (x,y) | x &lt;- [1,3], y &lt;- [2,4] ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442099458, "post_id": 32543103, "comment_id": 52946195, "body": "You can improve the explicit recursion by letting <code>pair&#39; _ [] = pair xs ys</code> so that the inefficient <code>++ pair xs ys</code> is no longer necessary. You can also remove the first argument from <code>pair&#39;</code>, since <code>x</code> is already in scope."}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1442088809, "last_edit_date": 1442088809, "creation_date": 1442087817, "answer_id": 32543103, "question_id": 32542695, "link": "https://stackoverflow.com/questions/32542695/haskell-how-can-i-make-this-lists-into-tuple-function-pair-with-all-elements/32543103#32543103", "title": "Haskell - How can I make this lists into tuple function pair with all elements?", "body": "<p>Although there is already a much more elegant answer, i think it is worthwhile to show how this would be achieved in a simple straightforward way. If you want to get all pairs, you obviously need to visit every element of one list for an element in the other.</p>\n\n<pre><code>pair :: [a] -&gt; [b] -&gt; [(a, b)]\npair [] _ = []\npair (x:xs) ys = pair' x ys ++ pair xs ys where\n    pair' :: a -&gt; [b] -&gt; [(a, b)]\n    pair' _ [] = []\n    pair' x (y:ys) = (x,y) : pair' x ys\n</code></pre>\n\n<p>But of course using the <code>pair = liftA2 (,)</code> or <code>[1,3] &gt;&gt;= \\x -&gt; [2,4] &gt;&gt;= \\y -&gt; (x,y)</code> in its <code>do</code> notation or list comprehension notation is much better. Also <code>++</code> isn't what you normally want to do. So maybe you can build the lists as <code>pair'</code> would do, keep them in a list and then <code>concat</code> them.</p>\n\n<pre><code>concat $ map (\\x -&gt; map (\\y -&gt; (x,y)) ys) xs\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 32542755, "answer_count": 2, "score": -4, "last_activity_date": 1442088809, "creation_date": 1442085149, "last_edit_date": 1442086374, "question_id": 32542695, "link": "https://stackoverflow.com/questions/32542695/haskell-how-can-i-make-this-lists-into-tuple-function-pair-with-all-elements", "title": "Haskell - How can I make this lists into tuple function pair with all elements?", "body": "<p>So i have </p>\n\n<pre><code>pair:: [a] -&gt; [b] -&gt; [(a,b)]\npair[] _ = []\npair(x:xs) (y:ys) = (x, y) : prod xs ys\n</code></pre>\n\n<p>But the result are only like the following:</p>\n\n<pre><code>&gt;&gt; pair [1,2] [3,4]\n&gt;&gt; [(1,3),(2,4)]\n</code></pre>\n\n<p>How can I make this so it pairs like:</p>\n\n<pre><code>[(1,3),(1,4),(2,3),(2,4)]\n</code></pre>\n"}, {"tags": ["haskell", "shuffle"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442084414, "post_id": 32542551, "comment_id": 52942108, "body": "What is <code>skyffla</code>; is it supposed to be <code>shuffle</code>? Can you give us an example of an input and the expected output?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1442084524, "post_id": 32542551, "comment_id": 52942150, "body": "If <code>skyffle</code> is <code>shuffle</code>, why are the odds shuffled again? What is your definition of an acceptable &quot;shuffle&quot; function?"}, {"owner": {"reputation": 1948, "user_id": 1548601, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/fabb1f3db767a21f84f19a077ef5d83d?s=128&d=identicon&r=PG", "display_name": "Entalpi", "link": "https://stackoverflow.com/users/1548601/entalpi"}, "edited": false, "score": 0, "creation_date": 1442088871, "post_id": 32542551, "comment_id": 52943401, "body": "Yeah, skyffla = shuffle. My bad, typo. I will add the definition of my shuffle algorithm."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442108275, "post_id": 32542551, "comment_id": 52947841, "body": "<code>length $ shuffle [1..2000]</code> already runs in a fraction of a second in ghci"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1442085079, "post_id": 32542661, "comment_id": 52942324, "body": "There are a bunch of related ways to partition a list into even and odd elements in the answers to <a href=\"http://stackoverflow.com/q/27307709/414413\">this question</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1442085231, "post_id": 32542661, "comment_id": 52942373, "body": "@Cirdec Sure, but this already shuffles 200,000 elements in less than 0.15 seconds in ghci, which is two orders of magnitude faster than requested."}, {"owner": {"reputation": 1948, "user_id": 1548601, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/fabb1f3db767a21f84f19a077ef5d83d?s=128&d=identicon&r=PG", "display_name": "Entalpi", "link": "https://stackoverflow.com/users/1548601/entalpi"}, "edited": false, "score": 0, "creation_date": 1442138640, "post_id": 32542661, "comment_id": 52953124, "body": "Yeah, sorry. I forgot to mention that I follow a specific algorithm. See my edited question for the algorithm."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 1948, "user_id": 1548601, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/fabb1f3db767a21f84f19a077ef5d83d?s=128&d=identicon&r=PG", "display_name": "Entalpi", "link": "https://stackoverflow.com/users/1548601/entalpi"}, "edited": false, "score": 0, "creation_date": 1442247226, "post_id": 32542661, "comment_id": 52993754, "body": "@Entalpi Yeah, that was rather important information to include in your question."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 2, "last_activity_date": 1442084860, "creation_date": 1442084860, "answer_id": 32542661, "question_id": 32542551, "link": "https://stackoverflow.com/questions/32542551/how-can-i-optimize-this-shuffle-function/32542661#32542661", "title": "How can I optimize this shuffle function?", "body": "<p>A perfect shuffle can be implemented as</p>\n\n<pre><code>perfectShuffle = concat . transpose . chunksOf 2\n</code></pre>\n\n<p>The speed improvements will come from:</p>\n\n<ol>\n<li>Not calculating the length of the list repeatedly.</li>\n<li>Not building up a chain of <code>(++)</code> inefficiently, which will require repeated traversals of the list and give an O(n<sup>2</sup>) runtime.</li>\n</ol>\n\n<p>Example output:</p>\n\n<pre><code>\u03bb&gt; perfectShuffle [1..10]\n[1,3,5,7,9,2,4,6,8,10]\n</code></pre>\n\n<p><code>chunksOf</code> is available in the <code>split</code> package. <code>transpose</code> is in <code>Data.List</code> in base.</p>\n"}, {"comments": [{"owner": {"reputation": 1948, "user_id": 1548601, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/fabb1f3db767a21f84f19a077ef5d83d?s=128&d=identicon&r=PG", "display_name": "Entalpi", "link": "https://stackoverflow.com/users/1548601/entalpi"}, "edited": false, "score": 0, "creation_date": 1442154213, "post_id": 32550303, "comment_id": 52957207, "body": "This did it. Thanks for the help!"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1442151984, "creation_date": 1442151984, "answer_id": 32550303, "question_id": 32542551, "link": "https://stackoverflow.com/questions/32542551/how-can-i-optimize-this-shuffle-function/32550303#32550303", "title": "How can I optimize this shuffle function?", "body": "<p>You should avoid indexing repeatedly into the same list with <code>!!</code> like you do in</p>\n\n<pre><code>evens l = [l !! i | i &lt;- [0,2..(length l) - 1]]    -- bad\n</code></pre>\n\n<p>This takes O(n^2) time where n is the length of <code>l</code>, since <code>l !! i</code> takes O(i) time.</p>\n\n<p>Instead just write something like this:</p>\n\n<pre><code>evens [] = []\nevens (x:xs) = x : odds xs\n\nodds xs = evens (drop 1 xs)\n</code></pre>\n\n<p>Your <code>shuffle</code> itself is fine.</p>\n"}], "owner": {"reputation": 1948, "user_id": 1548601, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/fabb1f3db767a21f84f19a077ef5d83d?s=128&d=identicon&r=PG", "display_name": "Entalpi", "link": "https://stackoverflow.com/users/1548601/entalpi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 32550303, "answer_count": 2, "score": -2, "last_activity_date": 1442151984, "creation_date": 1442084149, "last_edit_date": 1442089229, "question_id": 32542551, "link": "https://stackoverflow.com/questions/32542551/how-can-i-optimize-this-shuffle-function", "title": "How can I optimize this shuffle function?", "body": "<p>I am trying to create a generic (type-o-polymophism?) shuffle function with Haskell. I needs to sort a couple of thousand elements in a fraction of a second to be deemed \"good enough\". </p>\n\n<pre><code>evens :: [a] -&gt; [a]\nevens l = [l !! i | i &lt;- [0,2..(length l) - 1]]\n\nodds :: [a] -&gt; [a]\nodds  l = [l !! i | i &lt;- [1,3..(length l) - 1]]\n\nshuffle :: [a] -&gt; [a]\nshuffle s   | length s == 1 = s\n        | otherwise = l ++ shuffle r\n        where l = evens s\n              r = odds s\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/m7i8E.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/m7i8E.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1442083254, "post_id": 32542335, "comment_id": 52941765, "body": "That doesn&#39;t seem to be a case for the <code>(-&gt;) r</code> Monad instance. The <code>(-&gt;) r</code> Monad instance is for providing a &quot;supply of <code>r</code>&quot; to (multiple) functions. Instead, you have the same function and a bunch of different <code>r</code>&#39;s."}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 2, "creation_date": 1442085672, "post_id": 32542335, "comment_id": 52942507, "body": "If you really wanted to use <code>(-&gt;) r</code> you could write <code>myExample x y z = (func3 &lt;$&gt; ($ x) &lt;*&gt; ($ y) &lt;*&gt; ($ z)) func1</code>. But I have to agree it&#39;s not really a sensible use."}, {"owner": {"reputation": 335, "user_id": 3195266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11459be624d79fcf9665b0a46653b151?s=128&d=identicon&r=PG", "display_name": "Netsu", "link": "https://stackoverflow.com/users/3195266/netsu"}, "edited": false, "score": 0, "creation_date": 1442087957, "post_id": 32542335, "comment_id": 52943159, "body": "Is there any way to just DRY here?"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 3, "last_activity_date": 1442093643, "last_edit_date": 1442093643, "creation_date": 1442083714, "answer_id": 32542472, "question_id": 32542335, "link": "https://stackoverflow.com/questions/32542335/how-can-i-simplify-function-application-with-r-monad-or-which-other-r/32542472#32542472", "title": "How can I simplify function application with (-&gt;) r Monad or which other (-&gt;) r type class instance may be useful here?", "body": "<p>The <code>(-&gt;) r</code> instance of Monad can be thought of as providing a \"supply of <code>r</code>\" to (multiple) functions. An example of its use might be:</p>\n\n<pre><code>example f g h x = f (g x) (h x)\n</code></pre>\n\n<p>which would become</p>\n\n<pre><code>example' f g h = do\n  x1 &lt;- g\n  x2 &lt;- h\n  return (f x1 x2)\n</code></pre>\n\n<p>where the argument (originally <code>x</code>) is supplied to each function.</p>\n\n<p>Your example doesn't have a single supply of <code>r</code> for multiple functions, but rather multiple <code>r</code> values for a single function. This is not a use case for the <code>(-&gt;) r</code> instance of Monad.</p>\n"}, {"comments": [{"owner": {"reputation": 335, "user_id": 3195266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11459be624d79fcf9665b0a46653b151?s=128&d=identicon&r=PG", "display_name": "Netsu", "link": "https://stackoverflow.com/users/3195266/netsu"}, "edited": false, "score": 0, "creation_date": 1442093146, "post_id": 32543804, "comment_id": 52944604, "body": "So for this example I should use liftA3 or liftM3, right?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 335, "user_id": 3195266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11459be624d79fcf9665b0a46653b151?s=128&d=identicon&r=PG", "display_name": "Netsu", "link": "https://stackoverflow.com/users/3195266/netsu"}, "edited": false, "score": 0, "creation_date": 1442093432, "post_id": 32543804, "comment_id": 52944677, "body": "@Netsu: The thing with <code>func3 (func1 x) (func1 y) (func1 z)</code> is that <code>func1</code> is applied to three different values, <code>x</code>, <code>y</code> and <code>z</code>. The <code>(-&gt;) r</code> monad works in cases where all the functions are fed <i>the same</i> value."}, {"owner": {"reputation": 335, "user_id": 3195266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11459be624d79fcf9665b0a46653b151?s=128&d=identicon&r=PG", "display_name": "Netsu", "link": "https://stackoverflow.com/users/3195266/netsu"}, "edited": false, "score": 1, "creation_date": 1442097157, "post_id": 32543804, "comment_id": 52945680, "body": "There should be a general way, like Data.Function.on function for 2 arguments, but for 3 in this case."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 3, "last_activity_date": 1442094247, "last_edit_date": 1442094247, "creation_date": 1442092563, "answer_id": 32543804, "question_id": 32542335, "link": "https://stackoverflow.com/questions/32542335/how-can-i-simplify-function-application-with-r-monad-or-which-other-r/32543804#32543804", "title": "How can I simplify function application with (-&gt;) r Monad or which other (-&gt;) r type class instance may be useful here?", "body": "<p>The <code>(-&gt;) r</code> monad don't really \"simplify application.\"  The simplest way of applying a function is just to apply the function!</p>\n\n<p>I find the most intuitive way of getting a feel for <code>(-&gt;) r</code> is that it allows you to <strong>operate on the result types of functions that share the same argument type</strong>.  Say for example you have these functions:</p>\n\n<pre><code>f :: a -&gt; b -&gt; c\ng :: r -&gt; a\nh :: r -&gt; b\n</code></pre>\n\n<p>In this case, observe that:</p>\n\n<ol>\n<li><code>f</code> operates on the result types of <code>g</code> and <code>h</code>.</li>\n<li><code>g</code> and <code>h</code> share the same argument type.</li>\n</ol>\n\n<p>Now using the <code>Applicative</code> instance (superclass of <code>Monad</code>) for <code>(-&gt;) r</code>, you can write this:</p>\n\n<pre><code>import Control.Applicative (liftA2)\n\nexample :: r -&gt; c\nexample = liftA2 f g h\n</code></pre>\n\n<p>So if you have many functions that all take a shared \"context\" argument of type <code>r</code>, and your code is threading it around everywhere, you can sometimes simplify your code by using the <code>Reader r</code> monad (which is just a <code>newtype</code> around <code>(-&gt;) r</code>) to write code that \"pretends\" the context value has already been supplied.</p>\n\n<hr>\n\n<p>Expanding on my first comment to this answer, given what you've told us about your example so far I don't see a case for using any of this machinery.  In this definition:</p>\n\n<pre><code>myExample x y z = func3 (func1 x) (func1 y) (func1 z)\n</code></pre>\n\n<p>...<code>func1</code> is applied to three different values, so the following would not be equivalent:</p>\n\n<pre><code>notYourExample = liftA3 func3 func1 func1 func1\n</code></pre>\n\n<p>That would be equivalent to this instead:</p>\n\n<pre><code>notYourExample x = func3 (func1 x) (func1 x) (func1 x)\n</code></pre>\n\n<p>The thing that is repeated in your function is not the arguments to <code>func1</code>, but rather <code>func1</code> itself.  You could use the <code>(-&gt;) r</code> monad to eliminate that repetition by applying some code golf:</p>\n\n<pre><code>myExample x y z = liftA3 func3 ($x) ($y) ($z) func1\n</code></pre>\n\n<p>Do you find that hard to read than the original?  Well, that's the reason not to do it!  It's might also not be strictly equivalent to your example, depending on the precise type of <code>func1</code>.</p>\n"}], "owner": {"reputation": 335, "user_id": 3195266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11459be624d79fcf9665b0a46653b151?s=128&d=identicon&r=PG", "display_name": "Netsu", "link": "https://stackoverflow.com/users/3195266/netsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 32543804, "answer_count": 2, "score": 2, "last_activity_date": 1442160974, "creation_date": 1442082951, "last_edit_date": 1442088255, "question_id": 32542335, "link": "https://stackoverflow.com/questions/32542335/how-can-i-simplify-function-application-with-r-monad-or-which-other-r", "title": "How can I simplify function application with (-&gt;) r Monad or which other (-&gt;) r type class instance may be useful here?", "body": "<p>For example I have following code:</p>\n\n<pre><code>func1 :: a -&gt; b\nfunc3 :: b -&gt; b -&gt; b -&gt; c\n\nmyExample x y z = func3 (func1 x) (func1 y) (func1 z)\n</code></pre>\n\n<p>Any general suggestion for this case?</p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1442081435, "post_id": 32541929, "comment_id": 52941224, "body": "Wow! This edit <i>completely</i> changed the details of the question, making all the answers look a bit stupid. That&#39;s not really the recommended way; instead, if you find you are still confused after your first question, open a fresh one with details about your new question, how it differs from the previous one, and why you&#39;re still confused."}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442081675, "post_id": 32541929, "comment_id": 52941291, "body": "sorry,the previous one is in fact a simplified one...and after some experiments i find it best to post the original one ,sorry..thanks for the detailed typing ! would you like to update your answer?"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 1, "creation_date": 1442085634, "post_id": 32541929, "comment_id": 52942494, "body": "@doofin: no.. you should revert your edit and open a new question"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442080794, "post_id": 32541991, "comment_id": 52941021, "body": "I guess you meant  <code>data AB = A A | B B</code>. After all, it should be a sum type of A and B."}, {"owner": {"reputation": 1634, "user_id": 1779275, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/SgEYI.png?s=128&g=1", "display_name": "Evan Sebastian", "link": "https://stackoverflow.com/users/1779275/evan-sebastian"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442080881, "post_id": 32541991, "comment_id": 52941046, "body": "Ah, right, thanks for the correction, was meaning to write that"}], "tags": [], "owner": {"reputation": 1634, "user_id": 1779275, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/SgEYI.png?s=128&g=1", "display_name": "Evan Sebastian", "link": "https://stackoverflow.com/users/1779275/evan-sebastian"}, "is_accepted": false, "score": 1, "last_activity_date": 1442080811, "last_edit_date": 1442080811, "creation_date": 1442080710, "answer_id": 32541991, "question_id": 32541929, "link": "https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error/32541991#32541991", "title": "haskell sum type multiple declaration error", "body": "<p>Because the type of the value created using data constructor <code>A</code> or <code>B</code> will be ambiguous. When I have <code>a = B</code> for instance, what is the type of <code>a</code>? It is <code>A</code> or <code>AB</code>?</p>\n\n<p>You should consider using different data constructor as follows:</p>\n\n<pre><code>data A = MkA\ndata B = MkB\ndata AB = A A | B B\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 1, "last_activity_date": 1442080802, "creation_date": 1442080802, "answer_id": 32542010, "question_id": 32541929, "link": "https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error/32542010#32542010", "title": "haskell sum type multiple declaration error", "body": "<p>When you say <code>data AB = A | B</code>, you are not referring to the <em>types</em> <code>A</code> and <code>B</code>, but rather are defining <em>data constructors</em> <code>A</code> and <code>B</code>. These conflict with the constructors defined on the the previous lines.</p>\n\n<p>If you want to create a type <code>AB</code> that is the sum of <code>A</code> and <code>B</code>, you must provide data constructors that wrap the types <code>A</code> and <code>B</code>, e.g.:</p>\n\n<pre><code>data AB = ABA A | ABB B\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1442080904, "post_id": 32542015, "comment_id": 52941051, "body": "Given that neither <code>A</code> nor <code>B</code> carry additional information, one could probably throw them away entirely and use <code>data AB = A | B</code>, but that&#39;s hard to see without additional code."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1442081324, "post_id": 32542015, "comment_id": 52941192, "body": "@Zeta I&#39;m assuming that <code>data A=A</code> and <code>data B=B</code> were merely placeholders for more interesting data types."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1442080827, "creation_date": 1442080827, "answer_id": 32542015, "question_id": 32541929, "link": "https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error/32542015#32542015", "title": "haskell sum type multiple declaration error", "body": "<p>You're getting fooled. You think when you write <code>data A=Int|Bool</code> that you are saying that a value of type <code>A</code> can be a value of type <code>Int</code> or a value of type <code>Bool</code>; but what you are <em>actually</em> saying is that there are two new value-level constructors named <code>Int</code> and <code>Bool</code>, each containing no information at all, of type <code>A</code>. Similarly, you think that <code>data AB=A|B</code> says you can either be of type <code>A</code> or type <code>B</code>, but in fact you are saying you can either have <em>value</em> <code>A</code> or <em>value</em> <code>B</code>.</p>\n\n<p>The key thing to keep in mind is that there are two namespaces, type-level and term-level, and that they are distinct.</p>\n\n<p>Here is a simple example of how to do it right:</p>\n\n<pre><code>data A=A\ndata B=B\ndata AB=L A|R B\n</code></pre>\n\n<p>The last line declares two new term-level constructors, <code>L</code> and <code>R</code>. The <code>L</code> constructor carries a value of <em>type</em> <code>A</code>, while the <code>R</code> constructor carries a value of <em>type</em> <code>B</code>.</p>\n\n<p>You might also like the <code>Either</code> type, defined as follows:</p>\n\n<pre><code>data Either a b = Left a | Right b\n</code></pre>\n\n<p>You could use this to implement your <code>AB</code> if you wanted:</p>\n\n<pre><code>type AB = Either A B\n</code></pre>\n\n<p>Similarly, you could use <code>Either Int Bool</code> for your tagged union of <code>Int</code> and <code>Bool</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1442081065, "creation_date": 1442081065, "answer_id": 32542053, "question_id": 32541929, "link": "https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error/32542053#32542053", "title": "haskell sum type multiple declaration error", "body": "<p>Sum types have to be tagged. <code>a+a</code> has to have two <em>injections</em> from <code>a</code>.</p>\n\n<p>To understand how algebraic data types work, take a simple example:</p>\n\n<pre><code>data X = A | B C\n</code></pre>\n\n<p>This defines a new type constructor, <code>X</code>, along with data constructors <code>A</code> and <code>B</code>. The <code>B</code> constructor takes/holds an argument of type C.</p>\n\n<p>The primary canonical sum type in Haskell is <code>Either</code>:</p>\n\n<pre><code>data Either a b = Left a | Right b\n</code></pre>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 0, "accepted_answer_id": 32542015, "answer_count": 4, "score": 1, "last_activity_date": 1442160466, "creation_date": 1442080334, "last_edit_date": 1442160466, "question_id": 32541929, "link": "https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error", "title": "haskell sum type multiple declaration error", "body": "<pre><code>data A=A\ndata B=B\ndata AB=A|B\n</code></pre>\n\n<p>Which makes a sum type AB from A and B.</p>\n\n<p>but the last line induces a compile error \"multiple declarations of B\"</p>\n\n<p>I also tried sth like this:</p>\n\n<pre><code>data A=Int|Bool\n</code></pre>\n\n<p>It compiles. but why ghc disallows me from making sum types for user-defined types?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 5, "last_activity_date": 1442079291, "creation_date": 1442079291, "answer_id": 32541751, "question_id": 32541699, "link": "https://stackoverflow.com/questions/32541699/haskell-function-to-apply-operations-recursively-to-an-argument/32541751#32541751", "title": "Haskell function to apply operations recursively to an argument", "body": "<pre><code>\\&gt; foldr ($) 3 (reverse operationList)\n92.640625\n</code></pre>\n\n<p>or</p>\n\n<pre><code>\\&gt; foldl (flip ($)) 3 operationList\n92.640625\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442087836, "post_id": 32542129, "comment_id": 52943129, "body": "You should never have to reverse a list to fold over it. <code>foldr f n (reverse xs) = foldl (flip f) n xs</code> if I&#39;m not mistaken."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442088772, "post_id": 32542129, "comment_id": 52943372, "body": "And I believe <code>foldMap (Dual . Endo)</code> is the way to do it with <code>Foldable</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442088843, "post_id": 32542129, "comment_id": 52943393, "body": "@dfeuer Yes, but conceptually the <code>foldl</code> version is much more complicated. I wanted to get at the underlying concept rather than get stuck on administrivia. The <code>Dual</code> version is rather nice though. Also I suspected that OP would have control over the list order in a real application so a reverse wouldn&#39;t be necessary."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 7, "last_activity_date": 1442081595, "creation_date": 1442081595, "answer_id": 32542129, "question_id": 32541699, "link": "https://stackoverflow.com/questions/32541699/haskell-function-to-apply-operations-recursively-to-an-argument/32542129#32542129", "title": "Haskell function to apply operations recursively to an argument", "body": "<p>There are (at least) two ways to solve this problem. One is to apply each function to the result of applying the previous function. This gives you:</p>\n\n<pre><code>foldr ($) 3 (reverse operationList)\n</code></pre>\n\n<p>The other is to first compose all the functions together and then to apply the resulting function to the argument:</p>\n\n<pre><code>foldr (.) id (reverse operationList) 3\n</code></pre>\n\n<p>This behavior of functions under composition is also captured by the <code>Endo</code> monoid:</p>\n\n<pre><code>appEndo (foldMap Endo (reverse operationList)) 3\n</code></pre>\n\n<p>The list must be reversed because foldr folds from \"right to left\":</p>\n\n<pre><code>foldr ($) 3 [f,g,h]\n= { definition of foldr }\nf $ g $ h $ 3\n= { definition of ($) }\nf (g (h 3))\n\nfoldr (.) id [f,g,h] 3\n= { definition of foldr }\n(f . g . h . id) 3\n= { definition of (.), definition of id, eta reduction }\nf (g (h 3))\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "accepted_answer_id": 32542129, "answer_count": 2, "score": 4, "last_activity_date": 1442081595, "creation_date": 1442078942, "question_id": 32541699, "link": "https://stackoverflow.com/questions/32541699/haskell-function-to-apply-operations-recursively-to-an-argument", "title": "Haskell function to apply operations recursively to an argument", "body": "<p><strong>Is there a built-in function in Haskell to apply a list of operations recursively to an argument?</strong></p>\n\n<p>I have a list of operations to apply to a <code>Double</code> (multiplication, addition, ...) and I would like simply to get the result.\nFor example : </p>\n\n<pre><code>operationList = [\n                  (\\v -&gt; v/8+2)\n                , (\\v -&gt; v-12)\n                , (\\v -&gt; v*v)\n                ]\n\nfunc operationList 3\n</code></pre>\n\n<p><code>func</code> should return <code>92,640625</code>.</p>\n\n<p>I searched in hoogle the signature <code>[(a -&gt; a)] -&gt; a -&gt; a</code> but I didn't find anything.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1442071819, "post_id": 32540493, "comment_id": 52938181, "body": "A <code>let</code> requires an <code>in</code>, in this context: <code>let (xs,_:ys) = splitAt n l in xs ++ x : ys</code>."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "edited": false, "score": 0, "creation_date": 1442072233, "post_id": 32540582, "comment_id": 52938318, "body": "Is there anyway to make it work without making it Int and keep it Integer?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1442072944, "last_edit_date": 1442072944, "creation_date": 1442072085, "answer_id": 32540582, "question_id": 32540493, "link": "https://stackoverflow.com/questions/32540493/haskell-changing-an-element-at-n-position-compilation-error/32540582#32540582", "title": "Haskell - Changing an element at n position? Compilation error?", "body": "<p>yes your idea is right - there are just two problems:</p>\n\n<ul>\n<li>as Jubobs said you need a <code>in</code> if you use <code>let</code> outside a <code>do</code> block, as this is an expression <code>let ... in ...</code> (see below)</li>\n<li>you have a slight type problem: <code>splitAt</code> want's an <code>Int</code>:</li>\n</ul>\n\n<hr>\n\n<pre><code>listSet :: [a] -&gt; Int -&gt; a -&gt; [a]\nlistSet l n x = \n    let (xs,_:ys) = splitAt n l\n    in xs ++ x : ys\n</code></pre>\n\n<p>this should work</p>\n\n<p>of course there are a few problems with your solution:</p>\n\n<ul>\n<li>if <code>n</code> is greater than your list your function will fail (example <code>listSet [1..4] 5 99</code>)</li>\n<li>the <code>++</code> is not very performant for larger lists - and you can do without if you extent on <code>splitAt</code>s implementation (see below)</li>\n</ul>\n\n<hr>\n\n<p>as you asked: yes there is an easy way: you can for example just write it in the obvious recursive style - this will even remove the <code>++</code> and needed <code>splitAt</code>:</p>\n\n<pre><code>listSet :: [a] -&gt; Integer -&gt; a -&gt; [a]\nlistSet [] _ _ = []\nlistSet (_:xs) 0 y = y:xs\nlistSet (x:xs) n y = x:listSet xs (n-1) y\n</code></pre>\n\n<p>or you can use your version with the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:genericSplitAt\" rel=\"nofollow\"><code>genericSplitAt</code></a> - but please note the above problems </p>\n"}], "owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 32540582, "answer_count": 1, "score": -1, "last_activity_date": 1442072944, "creation_date": 1442071556, "last_edit_date": 1442072281, "question_id": 32540493, "link": "https://stackoverflow.com/questions/32540493/haskell-changing-an-element-at-n-position-compilation-error", "title": "Haskell - Changing an element at n position? Compilation error?", "body": "<p>So I have this function</p>\n\n<pre><code>listSet :: [a] -&gt; Integer -&gt; a -&gt; [a]\nlistSet l n x = \n    let (xs,_:ys) = splitAt n l\n    xs ++ x : ys\n</code></pre>\n\n<p>But I'm getting an error:</p>\n\n<p>:25:9: parse error in let binding: missing required 'in' </p>\n\n<p>What am I missing to resolve this?</p>\n\n<p>And is my logic correct to split at nth position and adding a element at the beginning of the list?</p>\n\n<p>Any help on the error or on the code would be appreciated!</p>\n\n<p>EDIT: Is there anyway to make this code work without changing Integer to Int?</p>\n"}, {"tags": ["haskell", "recursion", "types", "polymorphism", "composition"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442047250, "post_id": 32536837, "comment_id": 52931585, "body": "Which type do you want <code>createComposedMaps</code> to have?"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442047284, "post_id": 32536837, "comment_id": 52931591, "body": "I&#39;m not sure what the type is. It takes a list and gives back some type that can be inhabited by a composed map function."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442047464, "post_id": 32536837, "comment_id": 52931626, "body": "Okay. What should be the type of a composed map function? (I am not trying to annoy you, it&#39;s just that figuring out the types you want tends to clarify a lot problems of this kind.)"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442047615, "post_id": 32536837, "comment_id": 52931661, "body": "Well I don&#39;t know? Do you?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442047756, "post_id": 32536837, "comment_id": 52931694, "body": "Not yet, as there are a few things I&#39;m not sure of. What are you using <code>map</code> for? (I have a slight suspicion you don&#39;t actually need it.)"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442048044, "post_id": 32536837, "comment_id": 52931752, "body": "Look at the link here <a href=\"http://stackoverflow.com/questions/3911060/library-function-to-compose-a-function-with-itself-n-times\" title=\"library function to compose a function with itself n times\">stackoverflow.com/questions/3911060/&hellip;</a> The top answer appears to work for simple functions like <code>+1</code> but <code>map</code> doesn&#39;t work, it still results in an infinite type error. This function that I propose could be done in an untyped language with first class lambdas. I would like to know why it cannot be done in Haskell."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442048413, "post_id": 32536837, "comment_id": 52931829, "body": "AFAIK you are using polymorphic recursion there so you <b>must</b> provide an explicit type signature..."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1442048919, "post_id": 32536837, "comment_id": 52931940, "body": "@Bakuriu that lots relevant to this problem. But I don&#39;t know what the type signature for a recursive map would look like."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442049362, "post_id": 32536837, "comment_id": 52932040, "body": "@CMCDragonkai I see. The key issue is that in a chain of composed <code>map</code> the type of the result changes depending on how many <code>map</code> there are. That is why we are having trouble to give <code>createComposedMaps</code> a type. If you were dealing only with <code>a -&gt; a</code> functions you would be able to work with them as a monoid, as you suggest, and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow noreferrer\">there is even a standard type for that</a>. In your case, a workaround will be tricky, if it is even possible. Cf. <a href=\"http://okmij.org/ftp/Haskell/vararg-fn.lhs\" rel=\"nofollow noreferrer\">this polyvariadic function demo</a>."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442049964, "post_id": 32536837, "comment_id": 52932167, "body": "Perhaps something using return type polymorphism will be required, which means typeclasses..."}], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442056475, "post_id": 32538122, "comment_id": 52933891, "body": "Great answer! Lots to digest."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442056744, "post_id": 32538122, "comment_id": 52933949, "body": "Your second example seems the most effective for Haskell as I can custom create n-nested maps and map some function onto at n-dimensions into any tensor."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1442081752, "post_id": 32538122, "comment_id": 52941313, "body": "<code>IncoherentInstances</code> should only be available with the <code>IAmStupid</code> language extension, and <code>OverlappingInstances</code> feels like really weird macro programming."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1442098193, "post_id": 32538122, "comment_id": 52945911, "body": "<code>IterN</code> essentially represents a fixed depth free monad, so we can write <a href=\"https://github.com/effectfully/random-stuff/blob/master/HomoFree.hs\" rel=\"nofollow noreferrer\">something</a> a bit more general. But plain <code>IterN</code> is probably better, since it computes."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1442106457, "post_id": 32538122, "comment_id": 52947567, "body": "@user3237465 What do you mean your version doesn&#39;t compute?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442128308, "post_id": 32538122, "comment_id": 52950748, "body": "@CMCDragonkai, I added a version (<code>nmapFree</code>) that is more similar to <b>Andr&#225;s Kov&#225;cs</b>&#39; <code>mapN</code>. As you can see it&#39;s more complicated and clunky to use, because we now have two datatypes (<code>[]</code> and <code>HomoFree</code>) and need to coerce between them. That doesn&#39;t happen when we use <code>iterN</code>: there are only lists. If you only need to map elements, then the free monad is a good choice, but if you also sometimes need to map lists of elements, then <code>mapN</code> will save you from numerous and ineffecient coercions."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1442159936, "post_id": 32538122, "comment_id": 52959026, "body": "@user3237465 It looks fairly complicated. What&#39;s the advantage of so much abstraction?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442180648, "post_id": 32538122, "comment_id": 52965619, "body": "@CMCDragonkai, <code>HomoFree</code> is a version of <code>Free</code>, which is a well-understood concept, while <code>IterN</code> is a fancy type-level function in a language that has awful support for type-level functions. <code>mapFree</code> doesn&#39;t mention singletons, and you don&#39;t need to write things like <code>sing :: SLit 3</code>. A good rule of thumb is &quot;use data whenever you don&#39;t have strong reasons to use functions&quot;. It&#39;s easier to perform reasoning about data, rather than functions. But if you just want a generic mapping function, then <code>mapN</code> is what you want."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442488233, "post_id": 32538122, "comment_id": 53106962, "body": "With regards to <code>mapN</code> what changes are required to make it support any functor and not just <code>[]</code>?"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442489845, "post_id": 32538122, "comment_id": 53107832, "body": "After trying your haskell examples, I&#39;ve met a problem. The specification for how many nested composed maps is currently through type level integer (<code>sing :: SLit 3</code>), but I need to compose maps using a value level integer. I tried converting a value level integer into the <code>SZ | SS n</code>, but it didn&#39;t work. How do you use your <code>mapN</code> function with a value level integer?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442521521, "post_id": 32538122, "comment_id": 53127257, "body": "@CMCDragonkai: with arbitrary stacks of functors: <a href=\"http://lpaste.net/141200\" rel=\"nofollow noreferrer\">here&#39;s</a> one with classes, <a href=\"http://lpaste.net/141201\" rel=\"nofollow noreferrer\">here&#39;s</a> one with singletons. Also, you can convert a runtime <code>Integer</code> to a singleton <a href=\"http://lpaste.net/141203\" rel=\"nofollow noreferrer\">with this</a>. I should probably include it in the library too; there&#39;s already an analogous function in GHC.TypeLits (called <code>someNatVal</code>), that return GHC&#39;s builtin type level naturals (that type is less useful than the unary <code>Nat</code> though)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1442527129, "post_id": 32538122, "comment_id": 53129904, "body": "I used existentials for this kind of stuff too, but then I realized that CPS is nicer. @CMCDragonkai, <a href=\"http://stackoverflow.com/a/27070207/3237465\">this</a> answer might be helpful."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1442056714, "last_edit_date": 1442056714, "creation_date": 1442056247, "answer_id": 32538122, "question_id": 32536837, "link": "https://stackoverflow.com/questions/32536837/haskell-polymorphic-recursion-with-composed-maps-causes-infinite-type-error/32538122#32538122", "title": "Haskell Polymorphic Recursion with Composed Maps causes Infinite Type Error", "body": "<p>This is a classic job for dependent types, which means that we compute return types from the values of arguments. Here we'd like to express that the nesting of the resulting list depends on a numeric input (in your case, you used the length of a list parameter as the numeric input, but it's probably better to just use numbers where numbers are needed).</p>\n\n<p>Unfortunately Haskell doesn't yet have proper support for dependent typing, and existing workaround solutions involve some boilerplate and complications. <a href=\"http://www.idris-lang.org/\" rel=\"nofollow\">Idris</a> is a language with Haskell-like syntax and full dependent types, so I can illustrate the idea in Idris with greater clarity:</p>\n\n<pre><code>-- unary naturals from the Idris Prelude :\n-- data Nat = Z | S Nat\n\n-- compose a function n times (which can also be a type constructor!)\n-- for example, iterN 3 List Int = List (List (List Int))\niterN : Nat -&gt; (a -&gt; a) -&gt; a -&gt; a\niterN Z     f a = a\niterN (S k) f a = f (iterN k f a)\n\nmapN : (n : Nat) -&gt; (a -&gt; b) -&gt; iterN n List a -&gt; iterN n List b\nmapN Z     f as = f as\nmapN (S k) f as = map (mapN k f) as\n\n-- usage:\n&gt; mapN 3 (+10) [[[0]]]\n[[[10]]]\n&gt; mapN 0 id 10\n10\n</code></pre>\n\n<p>This is the complete Idris solution. In Haskell, we can't have values or functions in types, and the only way to make the above work is to create type-level versions of functions as type families and value-level versions of types as singletons, effectively writing twice as many definitions as would be ideal. The <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\"><code>singletons</code></a> library seeks to remove the bulk of the boilerplate through Template Haskell and clever machinery. Here's a singletons-based solution:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies #-}\n\nimport Data.Singletons -- package: singletons\nimport Data.Nat        -- package: singleton-nats (by me)\n\ntype family IterN n f a where\n  IterN Z     f a = a\n  IterN (S n) f a = f (IterN n f a)\n\nmapN :: Sing n -&gt; (a -&gt; b) -&gt; IterN n [] a -&gt; IterN n [] b  \nmapN SZ     f a  = f a\nmapN (SS n) f as = map (mapN n f) as\n\n-- usage:\n&gt; mapN (sing :: SLit 3) (+10) [[[0]]]\n[[[10]]]\n</code></pre>\n\n<p>The good news though is that there's ongoing research and development to add dependent types to GHC and we can expect improvements in the next few years. </p>\n\n<hr>\n\n<p>Alternatively, one might be tempted to use type classes to infer the amount of nestedness in the return type. This is fairly horrible, because we have to distinguish <code>[a]</code> and non-list types, which at the very least requires <code>OverlappingInstances</code>, but in practice it works acceptably with the even worse <code>IncoherentInstances</code>, because we'd also like to resolve polymorphic types depending on the local context. </p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, IncoherentInstances, MultiParamTypeClasses,\n  FlexibleInstances, TypeFamilies #-}\n\nclass MapN a b as bs where\n  mapN :: (a -&gt; b) -&gt; as -&gt; bs\n\ninstance (as ~ a, bs ~ b) =&gt; MapN a b as bs where\n  mapN = id\n\ninstance (MapN a b as bs, bs' ~ [bs]) =&gt; MapN a b [as] bs' where\n  mapN f as = map (mapN f) as\n\n-- usage:\n&gt; mapN (+1) 0\n1\n&gt; mapN (+10) [[[0]]]\n[[[10]]]\n\n-- note though that without enough context `mapN`'s type is nonsense:\n&gt; :t mapN (+0)\nmapN (+0) :: Num b =&gt; b -&gt; b\n</code></pre>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 4, "accepted_answer_id": 32538122, "answer_count": 1, "score": 3, "last_activity_date": 1442056714, "creation_date": 1442046917, "last_edit_date": 1495540312, "question_id": 32536837, "link": "https://stackoverflow.com/questions/32536837/haskell-polymorphic-recursion-with-composed-maps-causes-infinite-type-error", "title": "Haskell Polymorphic Recursion with Composed Maps causes Infinite Type Error", "body": "<p>What is the right way to create a function that can dynamically create composed map?</p>\n\n<p>This results in an error (also happens with fmap):</p>\n\n<pre><code>createComposedMaps list = accumulate list map\n    where \n        accumulate (x:xs) m = accumulate xs (m.map)\n        accumulate []     m = m\n</code></pre>\n\n<p>The <code>list</code> is irrelevant, it's just there to count the number of compositions.</p>\n\n<p>The error I get back is about \"cannot construct infinite type\":</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a2 ~ [a2]\nExpected type: (a2 -&gt; b1) -&gt; a2 -&gt; b1\n  Actual type: (a2 -&gt; b1) -&gt; [a2] -&gt; [b1]\nRelevant bindings include\n  m :: (a2 -&gt; b1) -&gt; c (bound at dimensional_filter.hs:166:27)\n  accumulate :: [t1] -&gt; ((a2 -&gt; b1) -&gt; c) -&gt; (a2 -&gt; b1) -&gt; c\n    (bound at dimensional_filter.hs:166:9)\nIn the second argument of \u2018(.)\u2019, namely \u2018map\u2019\nIn the second argument of \u2018accumulate\u2019, namely \u2018(m . map)\u2019\n\nOccurs check: cannot construct the infinite type: b1 ~ [b1]\nExpected type: (a2 -&gt; b1) -&gt; a2 -&gt; b1\n  Actual type: (a2 -&gt; b1) -&gt; [a2] -&gt; [b1]\nRelevant bindings include\n  m :: (a2 -&gt; b1) -&gt; c (bound at dimensional_filter.hs:166:27)\n  accumulate :: [t1] -&gt; ((a2 -&gt; b1) -&gt; c) -&gt; (a2 -&gt; b1) -&gt; c\n    (bound at dimensional_filter.hs:166:9)\nIn the second argument of \u2018(.)\u2019, namely \u2018map\u2019\nIn the second argument of \u2018accumulate\u2019, namely \u2018(m . map)\u2019\n</code></pre>\n\n<p>The goal is to create a dynamically composed mapping function that I can later use. While other semigroups can be appended together (lists, numbers...). Functions seems to be much harder.</p>\n\n<p>Would appreciate an example showing fmap and/or map.</p>\n\n<p>I found this <a href=\"https://stackoverflow.com/questions/3911060/library-function-to-compose-a-function-with-itself-n-times\">Library function to compose a function with itself n times</a></p>\n\n<p>But I need to use each intermediate composition, not just the final composition. And some examples still gives me infinite type error.</p>\n\n<p>Turns out the problem may involve polymorphic recursion. As each recursive application of the <code>accumulate</code> function changes the map type.</p>\n"}, {"tags": ["haskell", "parsec", "parser-combinators", "applicative", "polyvariadic"], "comments": [{"owner": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442031001, "post_id": 32534946, "comment_id": 52928018, "body": "<code>listUncurry</code> uses monadic <code>do</code> but has no reason to -- i want to fix both that and the polyvariadicity :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442031605, "post_id": 32534946, "comment_id": 52928122, "body": "So indeed I was missing something... Eliminating the <code>do</code> might be as simple as <code>fmap (\\[x1,x2,x3] -&gt; h x1 x2 x3) p</code>, as in David Young&#39;s answer."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442061607, "post_id": 32534946, "comment_id": 52935182, "body": "@duplode You should not have edited your questions after finding the answer. If there is an answer you like, you should accept it (click the tick beneath it) and leave it as such for future visitors to see."}, {"owner": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "edited": false, "score": 0, "creation_date": 1442075351, "post_id": 32534946, "comment_id": 52939298, "body": "the answer showed that i had focused on a trivial problem in the title, but you can see the edits only changed about 1% of the content -- none of the three specific questions at the bottom were addressed.  i upvoted him to thank him for helping me find and clarify the heart of the matter.  :)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1443269783, "post_id": 32534946, "comment_id": 53431872, "body": "Related: <a href=\"http://stackoverflow.com/questions/3775446/passing-list-elements-as-parameters-to-curried-function\" title=\"passing list elements as parameters to curried function\">stackoverflow.com/questions/3775446/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "edited": false, "score": 0, "creation_date": 1442031908, "post_id": 32535115, "comment_id": 52928172, "body": "heh ok that&#39;s fair, i guess what i really was interested in was how to use <code>(&lt;*&gt;)</code> to make it polyvariadic..."}, {"owner": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "edited": false, "score": 0, "creation_date": 1442032023, "post_id": 32535115, "comment_id": 52928190, "body": "i&#39;ll change the q to refocus on that, but let me know if you&#39;d rather i start a new question and give you credit for answering this one :)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "edited": false, "score": 0, "creation_date": 1443285869, "post_id": 32535115, "comment_id": 53436499, "body": "@user1441998 Usually the suggestion is to make a new question so that the existing answers aren&#39;t invalid. About the polyvariadic issue, unless you use some type class tricks which I would not really recommend for this, this is not possible (you cannot write the type of a polyvariadic <code>listUncurry</code> without the type class trick, let alone give an implementation). I added a possible way to use the type class trick to my answer though, to show how it could work and demonstrate the downsides of the approach."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "edited": false, "score": 0, "creation_date": 1443286966, "post_id": 32535115, "comment_id": 53436880, "body": "Thinking about it some more, the polyvariadic solution <i>could</i> work better than I thought originally, depending on the circumstances of the problem. It depends on what it means for an error to occur in <code>listUncurry</code> (I added a discussion about this issue to the answer)."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 7, "last_activity_date": 1443296805, "last_edit_date": 1443296805, "creation_date": 1442031542, "answer_id": 32535115, "question_id": 32534946, "link": "https://stackoverflow.com/questions/32534946/how-can-i-turn-this-parser-into-an-applicative-polyvariadic-one/32535115#32535115", "title": "How can I turn this parser into an applicative, polyvariadic one?", "body": "<p>Actually, you only need <code>Functor</code>:</p>\n\n<pre><code>listUncurry :: Functor f =&gt; (a -&gt; a -&gt; a -&gt; r) -&gt; f [a] -&gt; f r\nlistUncurry h p =\n  (\\[x, y, z] -&gt; h x y z) &lt;$&gt; p\n</code></pre>\n\n<p>To me, a hint that only <code>Functor</code> is necessary is when you have a code pattern like:</p>\n\n<pre><code>do x &lt;- m\n   return (f ...)\n</code></pre>\n\n<p>This is equivalent to</p>\n\n<pre><code>m &gt;&gt;= (\\x -&gt; return (f ...))\n</code></pre>\n\n<p>which is the same as</p>\n\n<pre><code>fmap (\\x -&gt; f ...) m\n</code></pre>\n\n<p>This is because the monad laws <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow\">imply this identity</a>:</p>\n\n<pre><code>fmap f xs  =  xs &gt;&gt;= return . f\n</code></pre>\n\n<h2>Polyvariadic <code>listUncurry</code></h2>\n\n<p>I don't really recommend this in most circumstances since it turns what would be compile time errors into runtime errors, but this is how you could implement a polyvariadic <code>listUncurry</code>:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances     #-}\n\nclass ListUncurry a x r where\n  listUncurry :: a -&gt; [x] -&gt; r\n\ninstance ListUncurry k a r =&gt; ListUncurry (a -&gt; k) a r where\n  listUncurry f (x:xs) = listUncurry (f x) xs\n  listUncurry _ _      = error \"listUncurry: Too few arguments given\"\n\ninstance ListUncurry r a r where\n  listUncurry r [] = r\n  listUncurry _ _  = error \"listUncurry: Too many arguments given\"\n</code></pre>\n\n<p>You will need a lot of explicit type annotations if you use it too. There is probably a way to use a type family or functional dependency to help with that, but I can't think of it off the top of my head at the moment. Since that is probably solvable (to an extent at least), in my mind the bigger problem is the type errors being changed from compile time errors to runtime errors.</p>\n\n<p>Sample usage:</p>\n\n<pre><code>ghci&gt; listUncurry ord ['a'] :: Int\n97\nghci&gt; listUncurry ((==) :: Int -&gt; Int -&gt; Bool) [1,5::Int] :: Bool\nFalse\nghci&gt; listUncurry ((==) :: Char -&gt; Char -&gt; Bool) ['a'] :: Bool\n*** Exception: listUncurry: Too few arguments given\nghci&gt; listUncurry ((==) :: Char -&gt; Char -&gt; Bool) ['a','b','c'] :: Bool\n*** Exception: listUncurry: Too many arguments given\n</code></pre>\n\n<h2>A safer <code>listUncurry</code></h2>\n\n<p>If you change the class to</p>\n\n<pre><code>class ListUncurry a x r where\n  listUncurry :: a -&gt; [x] -&gt; Maybe r\n</code></pre>\n\n<p>and change the error cases in the instances appropriately, you will at least get a better interface to handling the errors. You could also replace the <code>Maybe</code> with a type that differentiates between the \"too many\" and \"too few\" argument errors if you wanted to retain that information.</p>\n\n<p>I feel that this would be a bit better of an approach, although you will need to add a bit more error handling (<code>Maybe</code>'s <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> interfaces will make this fairly nice though).</p>\n\n<h2>Comparing the two approaches</h2>\n\n<p>It ultimately depends on what sort of error this would represent. If the program execution can no longer continue in <strong>any</strong> meaningful way if it runs into such an error, then the first approach (or something like it) might be more appropriate than the second. If there is <em>any</em> way to recover from the error, the second approach would be better than the first.</p>\n\n<p>Whether or not a polyvariadic technique should be used in the first place is a different question. It might be better to restructure the program to avoid the additional complexity of the polyvariadic stuff.</p>\n"}, {"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 2, "last_activity_date": 1442334692, "last_edit_date": 1442334692, "creation_date": 1442057125, "answer_id": 32538249, "question_id": 32534946, "link": "https://stackoverflow.com/questions/32534946/how-can-i-turn-this-parser-into-an-applicative-polyvariadic-one/32538249#32538249", "title": "How can I turn this parser into an applicative, polyvariadic one?", "body": "<blockquote>\n  <p>also i'm sure i shouldn't be <code>snoc</code>ing a list -- what's the right way to do this?</p>\n</blockquote>\n\n<p>The following implementation of <code>sepCount</code> is more efficient:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | @sepCount n sep p@ applies @n@ (&gt;=1) occurrences of @p@,\n-- separated by @sep@. Returns a list of the values returned by @p@. \nsepCount n sep p = p &lt;:&gt; count (n - 1) (sep *&gt; p)\n  where (&lt;:&gt;) = liftA2 (:)\n</code></pre>\n"}], "owner": {"reputation": 417, "user_id": 1441998, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8045191674f2225e0a218286aeae4ffd?s=128&d=identicon&r=PG", "display_name": "user1441998", "link": "https://stackoverflow.com/users/1441998/user1441998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1443296805, "creation_date": 1442029445, "last_edit_date": 1443270619, "question_id": 32534946, "link": "https://stackoverflow.com/questions/32534946/how-can-i-turn-this-parser-into-an-applicative-polyvariadic-one", "title": "How can I turn this parser into an applicative, polyvariadic one?", "body": "<p>I'm trying to parse dates such as <code>09/10/2015 17:20:52</code>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Text.Parsec\nimport Text.Parsec.String\nimport Text.Read\nimport Control.Applicative hiding (many, (&lt;|&gt;))\n\ndata Day = Day\n  { mo  :: Int\n  , dy  :: Int\n  , yr  :: Int\n  } deriving (Show)\n\ndata Time = Time\n  { hr  :: Int\n  , min :: Int\n  , sec :: Int\n  } deriving (Show)\n\nday  = listUncurry Day  &lt;$&gt; (sepCount 3 (char '/') $ read &lt;$&gt; many digit)\ntime = listUncurry Time &lt;$&gt; (sepCount 3 (char ':') $ dign 2             )\n\ndign :: (Stream s m Char, Read b) =&gt; Int -&gt; ParsecT s u m b\ndign = (read &lt;$&gt;) . flip count digit\n\n-- how generalize to n?\nlistUncurry h [x1,x2,x3] = h x1 x2 x3\n\nsepCount n sep p = (:) &lt;$&gt; p &lt;*&gt; (count (n-1) $ sep *&gt; p)\n</code></pre>\n\n<p>I have a hunch that some kind of <code>zipWithN</code> would generalize <code>listUncurry</code>.  Maybe some kind of <code>foldl ($)</code>?</p>\n\n<p>As a side question (out of curiosity), can <code>parsec</code> parsers be used generatively?</p>\n"}, {"tags": ["scala", "haskell", "function-composition"], "comments": [{"owner": {"reputation": 53042, "user_id": 2292812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ntpOX.jpg?s=128&g=1", "display_name": "Michael Zajac", "link": "https://stackoverflow.com/users/2292812/michael-zajac"}, "edited": false, "score": 0, "creation_date": 1442025686, "post_id": 32534611, "comment_id": 52927136, "body": "You mean like <code>iter(x =&gt; 2*x, 1) == Stream(1, 2, 4, 8, ?)</code> ?"}, {"owner": {"reputation": 9372, "user_id": 4585963, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Yzwc.jpg?s=128&g=1", "display_name": "hilberts_drinking_problem", "link": "https://stackoverflow.com/users/4585963/hilberts-drinking-problem"}, "reply_to_user": {"reputation": 53042, "user_id": 2292812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ntpOX.jpg?s=128&g=1", "display_name": "Michael Zajac", "link": "https://stackoverflow.com/users/2292812/michael-zajac"}, "edited": false, "score": 0, "creation_date": 1442026666, "post_id": 32534611, "comment_id": 52927297, "body": "Yes, exactly. I know I can do <code>val xs = 1 #:: xs.map(x =&gt; x * 2)</code> but this does not seem very elegant."}], "answers": [{"comments": [{"owner": {"reputation": 139391, "user_id": 135978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8931e023c82f232d4d02a115710fb8fc?s=128&d=identicon&r=PG", "display_name": "Sean Vieira", "link": "https://stackoverflow.com/users/135978/sean-vieira"}, "edited": false, "score": 0, "creation_date": 1442077014, "post_id": 32534744, "comment_id": 52939798, "body": "@downvoter - care to comment, so I can improve the answer? :-)"}], "tags": [], "owner": {"reputation": 139391, "user_id": 135978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8931e023c82f232d4d02a115710fb8fc?s=128&d=identicon&r=PG", "display_name": "Sean Vieira", "link": "https://stackoverflow.com/users/135978/sean-vieira"}, "is_accepted": false, "score": 5, "last_activity_date": 1442082167, "last_edit_date": 1495541888, "creation_date": 1442026923, "answer_id": 32534744, "question_id": 32534611, "link": "https://stackoverflow.com/questions/32534611/idiomatic-haskell-like-iterate-in-scala/32534744#32534744", "title": "Idiomatic Haskell-like iterate in Scala?", "body": "<p>There is <a href=\"http://www.scala-lang.org/api/current/index.html#scala.collection.Iterator$@iterate[T](start:T)(f:T=%3ET):Iterator[T]\" rel=\"nofollow noreferrer\"><code>Iterator.iterate</code></a> and <a href=\"http://www.scala-lang.org/api/2.11.7/index.html#scala.collection.immutable.Stream$@iterate[A](start:A)(f:A=%3EA):scala.collection.immutable.Stream[A]\" rel=\"nofollow noreferrer\"><code>Stream.iterate</code></a> (<a href=\"https://stackoverflow.com/a/32536689/135978\">via Paul's answer</a>):</p>\n\n<pre><code>Stream.iterate(1)(_ + 1)\n</code></pre>\n\n<p>Or you can write one yourself, using <code>Stream</code>:</p>\n\n<pre><code>def iter[A](f: A =&gt; A, x: A): Stream[A] = {\n  val result = f(x)\n  result #:: iter(f, result)\n}\n</code></pre>\n\n<p>(Note that holding onto the <code>Stream</code> will cause a memoization issue <a href=\"http://www.scala-lang.org/api/current/index.html#scala.collection.immutable.Stream\" rel=\"nofollow noreferrer\">warned about in the documentation</a>). Using it is as simple as:</p>\n\n<pre><code>scala&gt; iter[Int](_ + 1, 1).iterator.drop(100 * 100 * 100).take(10).toList\nres1: List[Int] = List(1000002, 1000003, 1000004, 1000005, 1000006, 1000007, 1000008, 1000009, 1000010, 1000011)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27952, "user_id": 86485, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/51b5c8968586c2fd45753f665a3fdf32?s=128&d=identicon&r=PG", "display_name": "Seth Tisue", "link": "https://stackoverflow.com/users/86485/seth-tisue"}, "edited": false, "score": 2, "creation_date": 1442073342, "post_id": 32536689, "comment_id": 52938682, "body": "<code>Stream.iterate</code>, too."}], "tags": [], "owner": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "is_accepted": true, "score": 11, "last_activity_date": 1442045700, "creation_date": 1442045700, "answer_id": 32536689, "question_id": 32534611, "link": "https://stackoverflow.com/questions/32534611/idiomatic-haskell-like-iterate-in-scala/32536689#32536689", "title": "Idiomatic Haskell-like iterate in Scala?", "body": "<p>Yes, it's in the library already: <a href=\"http://www.scala-lang.org/api/current/index.html#scala.collection.Iterator$@iterate[T](start:T)(f:T=%3ET):Iterator[T]\"><code>Iterator.iterate</code></a></p>\n\n<pre><code>Iterator.iterate(1)(_ + 1).drop(100 * 100 * 100).take(10).toList\n//&gt; List(1000001, 1000002, 1000003, 1000004, 1000005,\n         1000006, 1000007, 1000008, 1000009, 1000010)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17328, "user_id": 172677, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lgANn.jpg?s=128&g=1", "display_name": "Eastsun", "link": "https://stackoverflow.com/users/172677/eastsun"}, "is_accepted": false, "score": 0, "last_activity_date": 1442060535, "creation_date": 1442060535, "answer_id": 32538729, "question_id": 32534611, "link": "https://stackoverflow.com/questions/32534611/idiomatic-haskell-like-iterate-in-scala/32538729#32538729", "title": "Idiomatic Haskell-like iterate in Scala?", "body": "<p>Basically the same as @Sean Vieira's, with more Haskell-like syntax:</p>\n\n<pre><code>scala&gt; def iterate[A]: (A =&gt; A) =&gt; A =&gt; Stream[A] = {\n     |     f =&gt; x =&gt; x #:: iterate(f)(f(x))\n     | }\niterate: [A]=&gt; (A =&gt; A) =&gt; (A =&gt; Stream[A])\n\nscala&gt; iterate[Int](_+1)(1) take 10 toList\nres1: List[Int] = List(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\n</code></pre>\n\n<p>And swap the position of <code>f</code> and <code>x</code> can help the compiler:</p>\n\n<pre><code>scala&gt; def iterate[A]: A =&gt; (A =&gt; A) =&gt; Stream[A] = {\n     |     x =&gt; f =&gt; x #:: iterate(f(x))(f)\n     | }\niterate: [A]=&gt; A =&gt; ((A =&gt; A) =&gt; Stream[A])\n\nscala&gt; iterate(1)(2+) take 10 toList //Don't need to use iterate[Int] here\nres3: List[Int] = List(1, 3, 5, 7, 9, 11, 13, 15, 17, 19)\n</code></pre>\n"}], "owner": {"reputation": 9372, "user_id": 4585963, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Yzwc.jpg?s=128&g=1", "display_name": "hilberts_drinking_problem", "link": "https://stackoverflow.com/users/4585963/hilberts-drinking-problem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 32536689, "answer_count": 3, "score": 4, "last_activity_date": 1442082167, "creation_date": 1442025451, "question_id": 32534611, "link": "https://stackoverflow.com/questions/32534611/idiomatic-haskell-like-iterate-in-scala", "title": "Idiomatic Haskell-like iterate in Scala?", "body": "<p>In Haskell, I can get an infinite list of sequential function applications by calling:</p>\n\n<pre><code>iterate :: (A -&gt; A) -&gt; A -&gt; [A]\n</code></pre>\n\n<p>Suppose in scala I have <code>f(x: A): A</code>. Is there a function that will result in a stream of sequential function applications? Like <code>iter(f: A =&gt; A, x: A): Stream[A]</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1442017213, "post_id": 32533749, "comment_id": 52925782, "body": "You should consider searching in <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\"><b><code>Hoogle</code></b></a>"}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "edited": false, "score": 0, "creation_date": 1442018404, "post_id": 32533817, "comment_id": 52926016, "body": "Thank you, But you didn&#39;t have to provide the answer. I know the logic but haven&#39;t got a clue on how to implement the code! Helps a lot!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "edited": false, "score": 3, "creation_date": 1442032955, "post_id": 32533817, "comment_id": 52928331, "body": "@NeedHelp, note that if <code>xs</code> is a list, you really should never ask <code>length xs &gt; n</code>, because this has to walk the whole (possibly long) list just to see that it&#39;s not too short. The simplest way to check (for <code>n&gt;=1</code>) is probably <code>not . null . drop (n - 1) $ xs</code>. As amalloy points out, the check isn&#39;t even necessary in this partcular case."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442110095, "post_id": 32533817, "comment_id": 52948094, "body": "@dfeuer If you&#39;re feeling cheeky, <code>genericLength xs &gt;= (2 ::</code><a href=\"http://hackage.haskell.org/package/numbers-3000.2.0.1/docs/Data-Number-Natural.html\" rel=\"nofollow noreferrer\"><code>Natural</code></a><code>)</code> is as efficient as you could hope for, and very nearly as readable as the original <code>length xs &gt;= 2</code>."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": false, "score": 0, "last_activity_date": 1442016637, "creation_date": 1442016637, "answer_id": 32533817, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements/32533817#32533817", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<p><strong>Solution:</strong></p>\n\n<pre><code>conditionallyReverse :: [[a]] -&gt; [[a]]\nConditionallyReverse listOfLists= fmap f listOfLists\n  where \n    f list\n      | length list &gt;= 2 = reverse x\n      | otherwise        = x\n</code></pre>\n\n<p>We apply the function <code>f</code> to each element of the <code>listOfLists</code> by supplying <code>f</code> as the first argument to <code>fmap</code> and the <code>listOfLists</code> as the second argument. The function <code>f</code> transforms a <code>list</code> based on the condition <code>length list &gt;= 2</code>. If the condition holds, the list is reversed, <em>otherwise</em> the original list is returned.</p>\n"}, {"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1442017316, "post_id": 32533854, "comment_id": 52925810, "body": "@ReidBarton <code>fmap</code> is a generalization of <code>map</code>. <code>map</code> only works on lists, <code>fmap</code> works on every <code>Functor</code> including lists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 3, "creation_date": 1442028381, "post_id": 32533854, "comment_id": 52927570, "body": "@recursion.ninja FYI, Reid Barton is a major GHC compiler developer among other things. He&#39;s trying to make a point here, but I&#39;m not sure which one."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1442031008, "post_id": 32533854, "comment_id": 52928020, "body": "Perhaps my wording wasn&#39;t the most precise, but I usually do use <code>fmap</code>, even for lists. The only reason I&#39;ve ever heard used to justify the existence of a separate <code>map</code> function is &quot;it&#39;s easier for novices to understand&quot;."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1442086856, "post_id": 32533854, "comment_id": 52942843, "body": "@SilvioMayolo &quot;it&#39;s easier for novices to understand&quot;... and here we are on SO answering questions from novices. ;)"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 2, "last_activity_date": 1442016920, "creation_date": 1442016920, "answer_id": 32533854, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements/32533854#32533854", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<blockquote>\n  <p>how to traverse the lists.</p>\n</blockquote>\n\n<p>There are several sequence functions, from the more basic <code>fmap</code>, which maps a single function over a list, to <code>foldr</code>, which folds a list structure around a binary operation (for summing a list or similar operations) to the <code>sequence</code>/<code>traverse</code> operations, which carry monadic or applicative effects.</p>\n\n<blockquote>\n  <p>How would I find the length of the element. There is the length function I can use, but I haven't got an idea how to use it.</p>\n</blockquote>\n\n<p>There is a <code>length</code> function; you use it like any other function. <code>length xs</code>, where <code>xs</code> is a list. If you still aren't certain how to do that, I would suggest starting slower with a Haskell tutorial.</p>\n\n<blockquote>\n  <p>And I have this to reverse the list, But i think i have that now.</p>\n</blockquote>\n\n<p>There is a <code>reverse</code> function. If you don't want to use the built-in one (or if you want to do it yourself for educational purposes), you could build an efficient reverse function with an accumulator.</p>\n\n<pre><code>reverse' :: [a] -&gt; [a]\nreverse' xs = doReverse xs []\n    where doReverse [] ys = ys\n          doReverse (x:xs) ys = doReverse xs (x:ys)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 7, "last_activity_date": 1442017798, "creation_date": 1442017798, "answer_id": 32533947, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements/32533947#32533947", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<blockquote>\n  <p>I need to reverse all of the element lists x where <code>length x &gt;= 2</code></p>\n</blockquote>\n\n<p>You can totally ignore the <code>length x &gt;= 2</code> part, since if the length of a list is 0 or 1, reversing it has no effect: there's no way to tell whether you reversed it or not, so you might as well just reverse all lists, for uniformity.</p>\n\n<p>Given that, this is super simple: you just need to <code>map reverse</code> over the list of lists, reversing each one in turn:</p>\n\n<pre><code>reverseEach :: [[a]] -&gt; [[a]]\nreverseEach = map reverse\n\n&gt; reverseEach [[1,2,3],[4],[5,6,7,8]]\n[[3,2,1],[4],[8,7,6,5]]\n</code></pre>\n\n<p>And as other answers suggest, you can afford to generalize a little bit:</p>\n\n<pre><code>reverseEach :: Functor f =&gt; f [a] -&gt; f [a]\nreverseEach = fmap reverse\n\n&gt; reverseEach [[1,2,3],[4],[5,6,7,8]]\n[[3,2,1],[4],[8,7,6,5]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1442032528, "creation_date": 1442032528, "answer_id": 32535190, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements/32535190#32535190", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<p>Absurd over-generalization:</p>\n\n<p>Every <code>Traversable</code> instance supports a horrible hack implementing <code>reverse</code>. There may be a cleaner or more efficient way to do this; I'm not sure.</p>\n\n<pre><code>module Rev where\nimport Data.Traversable\nimport Data.Foldable\nimport Control.Monad.Trans.State.Strict\nimport Prelude hiding (foldl)\n\nfill :: Traversable t =&gt; t b -&gt; [a] -&gt; t a\nfill = evalState . traverse go\n  where\n    go _ = do\n      xs &lt;- get\n      put (drop 1 xs)\n      return (head xs)\n\nreverseT :: Traversable t =&gt; t a -&gt; t a\nreverseT xs = fill xs $ foldl (flip (:)) [] xs\n\nreverseAll :: (Functor f, Traversable t) =&gt; f (t a) -&gt; f (t a)\nreverseAll = fmap reverseT\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "is_accepted": false, "score": 0, "last_activity_date": 1517748203, "last_edit_date": 1517748203, "creation_date": 1487364751, "answer_id": 42307171, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements/42307171#42307171", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<p>In terms of folds:</p>\n\n<pre><code>reverse  =  foldl (\\ acc x -&gt; x : acc) []\nlength  =  foldl' (\\ n _ -&gt; n + 1) 0\nmap f  =  foldr (\\ x xs -&gt; f x : xs)\n</code></pre>\n\n<p>letting</p>\n\n<pre><code>mapReverse  =  map (\\ xs -&gt; if length xs &gt;= 2 then reverse xs else xs)\n</code></pre>\n\n<p>But <code>length</code> is a costly O(n), and <code>reverse [x]  =  [x]</code>. I would use</p>\n\n<pre><code>map reverse [[1,2,3],[4],[]]  ==  [[3,2,1],[4],[]]\n</code></pre>\n\n<p>where <code>(map reverse)  ::  [[a]] -&gt; [[a]]</code>. <code>map reverse</code> isn't basic enough to justify an own name binding.</p>\n"}], "owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 1, "accepted_answer_id": 32533854, "answer_count": 5, "score": -1, "last_activity_date": 1517748203, "creation_date": 1442016052, "last_edit_date": 1442017166, "question_id": 32533749, "link": "https://stackoverflow.com/questions/32533749/haskell-how-to-traverse-through-a-list-and-reverse-elements", "title": "Haskell - How to traverse through a list and reverse elements", "body": "<p>I am having trouble locating documentation on simple operations in Haskell.</p>\n\n<p>I have a list of lists (<code>:: [[a]]</code>) and I need to reverse all of the element lists <code>x</code> where <code>length x &gt;= 2</code>.</p>\n\n<p>So far I haven't found anything on:  </p>\n\n<ul>\n<li><p>How to traverse the lists</p></li>\n<li><p>How would I find the length of the element. There is the <code>length</code> function I can use, but I haven't got an idea how to use it.</p></li>\n</ul>\n\n<p>I did find the <code>reverse</code> function for lists, though I had trouble finding it.</p>\n\n<p>If any help on those individual implementation, it would be greatly appreciated. I can piece them together. </p>\n"}, {"tags": ["haskell", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 799, "user_id": 4080476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j8wTd.png?s=128&g=1", "display_name": "Brian Pendleton", "link": "https://stackoverflow.com/users/4080476/brian-pendleton"}, "edited": false, "score": 1, "creation_date": 1442008937, "post_id": 32532651, "comment_id": 52923666, "body": "What about when the list is empty.  You don&#39;t catch that case?"}, {"owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "reply_to_user": {"reputation": 799, "user_id": 4080476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j8wTd.png?s=128&g=1", "display_name": "Brian Pendleton", "link": "https://stackoverflow.com/users/4080476/brian-pendleton"}, "edited": false, "score": 0, "creation_date": 1442009176, "post_id": 32532651, "comment_id": 52923763, "body": "Dont need to account for that :)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442061451, "post_id": 32532651, "comment_id": 52935138, "body": "@NeedHelp Yes you do. <code>triplize [] = []</code>, by your definition. Incomplete functions are considered harmful."}], "answers": [{"comments": [{"owner": {"reputation": 1929, "user_id": 5181199, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204393995596520/picture?type=large", "display_name": "Oly", "link": "https://stackoverflow.com/users/5181199/oly"}, "edited": false, "score": 0, "creation_date": 1442010955, "post_id": 32532771, "comment_id": 52924333, "body": "A common idiom for naming parameters like that is to use <code>xs</code> or similar for list names. E.g. <code>triplize xs = concatMap (replicate 3) xs</code>"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 7, "last_activity_date": 1442009451, "last_edit_date": 1442009451, "creation_date": 1442008939, "answer_id": 32532771, "question_id": 32532651, "link": "https://stackoverflow.com/questions/32532651/why-doesnt-this-definition-cover-all-pattern-cases/32532771#32532771", "title": "Why doesn&#39;t this definition cover all pattern cases?", "body": "<p>When you write</p>\n\n<pre><code>triplize [x]\n</code></pre>\n\n<p>You are saying that the argument must match the pattern <code>[x]</code>.  This pattern represents a list with a single value, which will be assigned to the name <code>x</code>.  Note that the list will not be assigned to the name <code>x</code>, only the single value in that list.  If you tried calling your function with the list <code>[]</code> or <code>[1, 2]</code>, it would cause an error because you haven't told your function what to do with those inputs.</p>\n\n<p>What you probably want is</p>\n\n<pre><code>triplize x = concatMap (replicate 3) x\n</code></pre>\n\n<p>Here your pattern is just <code>x</code>, which matches any list, from the empty list to an infinite list.  Notice that the patterns in your function definition match the way you make the values themselves.  In Haskell you can pattern match on constructors, and lists can be constructed with square brackets and commas, or they can be constructed using the <code>:</code> operator, so <code>[1, 2, 3] == (1:2:3:[])</code>.  In fact, the <code>:</code> operator is how Haskell represents lists internally.</p>\n\n<p>An example that uses more pattern matches:</p>\n\n<pre><code>sumSuccessive :: [Int] -&gt; [Int]\nsumSuccessive [] = []      -- Empty list\nsumSuccessive [x] = [x]    -- Singleton list (only one value)\nsumSuccessive (x:y:rest) = x + y : sumSuccessive rest\n    -- Match a list with at least two elements `x` and `y`,\n    -- with the rest of the list assigned to the name `rest`\n</code></pre>\n\n<p>This example function would take the list <code>[1, 2, 3, 4]</code> and return the list <code>[3, 7]</code> (<code>[1 + 2, 3 + 4]</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 328, "user_id": 5325238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c140c79bfe5f68581c03c23be8faa0b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5325238/daniel"}, "is_accepted": false, "score": 3, "last_activity_date": 1442008962, "creation_date": 1442008962, "answer_id": 32532775, "question_id": 32532651, "link": "https://stackoverflow.com/questions/32532651/why-doesnt-this-definition-cover-all-pattern-cases/32532775#32532775", "title": "Why doesn&#39;t this definition cover all pattern cases?", "body": "<p>You can define <code>triplize</code> as:</p>\n\n<pre><code>triplize :: [a] -&gt; [a]\ntriplize x = concatMap (replicate 3) x\n</code></pre>\n\n<p>But there's even no need to write <code>x</code>:</p>\n\n<pre><code>triplize :: [a] -&gt; [a]\ntriplize = concatMap (replicate 3)\n</code></pre>\n\n<p>The original code will work only on lists with one element:</p>\n\n<pre><code>&gt; triplize [1]\n[1, 1, 1]\n&gt; triplize []\n*** Exception: Non-exhaustive patterns in function triplize\n&gt; triplize [0, 1]\n*** Exception: Non-exhaustive patterns in function triplize\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 1, "last_activity_date": 1442008996, "creation_date": 1442008996, "answer_id": 32532783, "question_id": 32532651, "link": "https://stackoverflow.com/questions/32532651/why-doesnt-this-definition-cover-all-pattern-cases/32532783#32532783", "title": "Why doesn&#39;t this definition cover all pattern cases?", "body": "<p><code>[x]</code> matches a list of exactly one element. If you want to match any list, just remove <code>[</code> and <code>]</code>:</p>\n\n<pre><code>triplize x = concatMap (replicate 3) x\n</code></pre>\n\n<p>This would turn <code>[\"a\", \"b\", \"c\"]</code> into <code>[\"a\", \"a\", \"a\", \"b\", \"b\", \"b\", \"c\", \"c\", \"c\"]</code>.</p>\n\n<p>On the other hand, if you want to take one element and return a list (containing 3 of that element), then your code should be </p>\n\n<pre><code>triplize :: a -&gt; [a]\ntriplize x = replicate 3 x\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 4709931, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aab8d600003209f08f5942e368e7d59b?s=128&d=identicon&r=PG&f=1", "display_name": "user32132321", "link": "https://stackoverflow.com/users/4709931/user32132321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 32532771, "answer_count": 3, "score": 5, "last_activity_date": 1442040348, "creation_date": 1442008323, "last_edit_date": 1442040348, "question_id": 32532651, "link": "https://stackoverflow.com/questions/32532651/why-doesnt-this-definition-cover-all-pattern-cases", "title": "Why doesn&#39;t this definition cover all pattern cases?", "body": "<p>So I'm trying to <code>triplize</code> an element, i.e. making 2 other copies of the element.</p>\n\n<p>So I've written this:</p>\n\n<pre><code>triplize :: [a] -&gt; [a]\ntriplize [x] = concatMap (replicate 3) [x]\n</code></pre>\n\n<p>But I've been getting this error:</p>\n\n<pre><code>Non-exhaustive patterns in function triplize\n</code></pre>\n\n<p>I'm new to Haskell, so any pointers are appreciated!</p>\n"}, {"tags": ["haskell", "printing", "pretty-print"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442011091, "post_id": 32533047, "comment_id": 52924377, "body": "There&#39;s no &quot;job&quot; to do here though other than to allow for common usage of something like <code>pprint</code> resulting in the pretty equivalent of <code>print</code> (due to type-defined implementations of <code>pshow</code>) in parallel with <code>print</code>/<code>show</code>. What&#39;s missing from accomplishing that? (I&#39;ve cut the bit that I think confused the issue). My point is: it seems like <i>a lot</i> of types that produce meaningful end-user display need to implant <code>pprint</code>, so why not abstract that simple fact."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442011243, "post_id": 32533047, "comment_id": 52924414, "body": "Note that I never said those libraries were elaborate but that <i>this</i> &quot;library&quot; was not intended to provide elaborate functionality. It&#39;s just glue."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442011447, "post_id": 32533047, "comment_id": 52924470, "body": "*&quot;implant&quot; = &quot;implement&quot; (that 5 min rule is silly)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442017390, "post_id": 32533047, "comment_id": 52925823, "body": "@raxacoricofallapatorius Many pretty-printing libraries <i>do</i> abstract that. <a href=\"http://hackage.haskell.org/package/pretty-1.1.3.2/docs/Text-PrettyPrint-HughesPJClass.html\" rel=\"nofollow noreferrer\">example</a>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442017744, "post_id": 32533047, "comment_id": 52925882, "body": "@DanielWagner: Yes, that&#39;s part of my point. If there are many different places that the same thing is happening, shouldn&#39;t there be one where its shared properties are defined (here, merely the existence of <code>pprint</code>, its signature and default behavior) so that all the others, or a user defined alternative, can instantiate?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442019664, "post_id": 32533047, "comment_id": 52926189, "body": "@raxacoricofallapatorius It&#39;s hard to imagine a more appropriate place for that than in the library that defines the pretty-printing combinators. Outside of that library you don&#39;t even have the <i>types</i> needed to specify the class."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442020221, "post_id": 32533047, "comment_id": 52926280, "body": "@DanielWagner: Only if there were just one such library and only if those types were in fact always needed to accomplish pretty printing. I think people are confusing rich, class specific presentation, with rich generic formatting functionality. The latter can be used to accomplish the former, but there are (demonstrably) many ways to do that; and the former can be (often simply) accomplished without the latter."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1442024919, "post_id": 32533047, "comment_id": 52927014, "body": "@raxacoricofallapatorius, may I suggest you write the library you want, since (you claim that) it&#39;s simple, demonstrate its utility with some realistic examples, and make it available on Hackage? This is, ultimately, how all libraries start out."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442026351, "post_id": 32533047, "comment_id": 52927246, "body": "@raxacoricofallapatorius A conjecture: when it comes to polished pretty printing for end-users, everyone will want to print things in different ways, due to aesthetic preferences and other arbitrary constraints, and so there is little incentive to generalise... unless the implementation is sophisticated and configurable enough to cater to the needs of most of its potential users. That might explain the lack of <i>simple</i> pretty printing libraries that you noticed."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442059761, "post_id": 32533047, "comment_id": 52934691, "body": "@duplode: That&#39;s exactly right. And I see now what has confused people (but not why, I think the question is clear enough): That&#39;s my point exactly. Everyone will want and need something very different so everyone will need to write (and do write) their own <code>someUserFriendlyStringOf</code> (and not necessarily or even commonly using any particular tools or libraries) \u2014 <i>but</i>, abstractly, those functions all do the same thing, they <code>pshow</code> (or &quot;render&quot; of whatever), so an abstraction that conveys that seems in order. And that <i>is</i> simple."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442059891, "post_id": 32533047, "comment_id": 52934719, "body": "@dfeuer: See previous comment. The code above <i>is</i> the library. All I was asking really is (sorry for the confusion) does it already exist?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442097450, "post_id": 32533047, "comment_id": 52945736, "body": "A corollary question (for me at least, since it is part of what motived this one) is whether just writing a bunch of functions <code>MyType -&gt; String</code> with names like <code>showMyTypeDetails</code> or <code>showEnlighteningViewOnMyType</code> is idiomatic Haskell practice. I think this question was misunderstood (I hope I&#39;ve cleared that up) but I may be trying to fit a square peg into a round hole."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442106223, "post_id": 32533047, "comment_id": 52947517, "body": "@raxacoricofallapatorius If your <code>PShow</code> abstracts this much, the only things in common between different <code>pshow</code> implementations will be the name and the type signature. At that point, having a general-purpose type class is not worth the trouble. In general, instances of a Haskell class are expected to be usable everywhere (<a href=\"http://stackoverflow.com/q/8728596\">this question</a>) discusses the issue in another context) and to have some properties in common that you can rely on (those properties are often expressed as the <i>laws</i> of a type class)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442107954, "post_id": 32533047, "comment_id": 52947795, "body": "@duplode: Yes, I think that&#39;s really the answer to the question I was asking (which, is in a sense the opposite of the question that was answered): given the idiosyncrasies and variety of demands that would be placed on PShow, that level of abstraction is taking things too far, almost to the point that it would be without meaning (in contrast to Show, which I naively thought of as a parallel), especially since it is (I gather) perfectly idiomatic Haskell to have a collection of <code>showAViewOfMyArg</code> functions, as needed."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442109099, "post_id": 32533047, "comment_id": 52947958, "body": "@raxacoricofallapatorius That&#39;s pretty much it. I will only emphasise a bit more the &quot;general-purpose&quot; qualification in my comment above. It is fine to have an internal <code>MyPShow</code> class, with instances tuned to the specific purposes of your application, but you wouldn&#39;t want to include it in a public API (unless you are writing something like a <a href=\"https://github.com/gibiansky/IHaskell/blob/master/src/IHaskell/Types.hs#L63\" rel=\"nofollow noreferrer\">Jupyter kernel</a>, in which being able to display things according to the arbitrary constraints of an external tool is part of the point)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442145734, "post_id": 32533047, "comment_id": 52955013, "body": "@duplode: Yes. I don&#39;t even think I&#39;d bother with <code>MyPShow</code>, just several <code>showPretty...</code> or <code>showInformative...</code> that were <code>OneOfMyTypes -&gt; String</code>. (In some cases in fact \u2014 perhaps many practical ones \u2014 what is most useful to show to users is not even a value of a Type, but, say, the progress of a computation, or several of them collected or sequenced. So I&#39;d need to define a type for that and have it instantiate <code>MyPShow</code> for the sole purpose of avoiding giving the function that displays it a different name than the one I use to display something else.)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1442010688, "creation_date": 1442010688, "answer_id": 32533047, "question_id": 32532617, "link": "https://stackoverflow.com/questions/32532617/is-there-a-pretty-printing-or-showing-abstraction-in-haskell/32533047#32533047", "title": "Is there a pretty printing (or showing) abstraction in Haskell?", "body": "<blockquote>\n  <p>Note that I'm not asking for something that provides elaborate pretty printing and formatting functionality (I see several packages that do that)</p>\n</blockquote>\n\n<p>There's a reason for that. The people who wrote those elaborate libraries did so because they couldn't get the job done with something simple. You've already hinted at some of the complexity by offering two different methods that may our may not do the same thing, with no guidance about which to use when.</p>\n\n<p>On the positive side, I wouldn't worry too much about <code>read</code>. Focus on <code>Show</code> instances that (possibly with GHC extensions) can give you code to cut and paste into your programs.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442090005, "post_id": 32543071, "comment_id": 52943719, "body": "Yes, that&#39;s one of the packages I&#39;m referring to. These al demonstrate my point: there are many approaches to the same thing. My emphasis was on <i>&quot;same thing&quot;</i>: that there is (as this demonstrates) an abstraction that sits above all these packages, as well as the many (I expect quite common) type-specific cases where <code>someUserFriendlyStringOf </code> needs to be written from scratch. My question was whether that abstraction was already part of the language, or had been implemented in a lightweight package."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442090030, "post_id": 32543071, "comment_id": 52943724, "body": "Put another way, all these packages contain a class (here <code>Pretty</code>) that is an instance of <code>Show</code>, and even taken together, these packages are probably mostly unsuited for custom rendering of arbitrary (rich, structured) values."}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": false, "score": 2, "last_activity_date": 1442087604, "creation_date": 1442087604, "answer_id": 32543071, "question_id": 32532617, "link": "https://stackoverflow.com/questions/32532617/is-there-a-pretty-printing-or-showing-abstraction-in-haskell/32543071#32543071", "title": "Is there a pretty printing (or showing) abstraction in Haskell?", "body": "<p>I just did a <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> search for <code>a -&gt; String</code> and found the <a href=\"http://hackage.haskell.org/package/haskell-src-1.0.2.0/docs/Language-Haskell-Pretty.html\" rel=\"nofollow\">Language.Haskell.Pretty</a> module.</p>\n\n<p>The module defines three simple functions:</p>\n\n<blockquote>\n  <p><strong>prettyPrintStyleMode</strong> :: Pretty a => Style -> PPHsMode -> a -> String<br>\n  pretty-print with a given style and mode.</p>\n  \n  <p><strong>prettyPrintWithMode</strong> :: Pretty a => PPHsMode -> a -> String<br>\n  pretty-print with the default style and a given mode.</p>\n  \n  <p><strong>prettyPrint</strong> :: Pretty a => a -> String<br>\n  pretty-print with the default style and defaultMode.</p>\n</blockquote>\n\n<p>The whole typeclass seems to be a bit more complex than what you have asked for, but maybe it helps</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1442087604, "creation_date": 1442008166, "last_edit_date": 1442010881, "question_id": 32532617, "link": "https://stackoverflow.com/questions/32532617/is-there-a-pretty-printing-or-showing-abstraction-in-haskell", "title": "Is there a pretty printing (or showing) abstraction in Haskell?", "body": "<p>Is there no standard way to print out values for end-user consumption? <code>Show</code> is clearly more of a debugging convenience than something that would work for this purpose, given the conventions around its use and the constraint that <code>read (show x) == x</code>.</p>\n\n<p>For example, isn't there at least a simple package like</p>\n\n<pre><code>class (Show a) =&gt; PShow a where \n    pshow :: a -&gt; String\n    pshow = show\n\npprint :: (PShow a) =&gt; a -&gt; IO () \npprint = putStrLn . pshow\n</code></pre>\n\n<p>where instances do something like</p>\n\n<pre><code>instance PShow MyType where\n    pshow a = someUserFriendlyStringOf a\n</code></pre>\n\n<p>Note that I'm not asking for something that provides elaborate pretty printing and formatting functionality (I see several packages that do that) just for a simple abstraction that's widely used that allows for pretty printing. Is there something like this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1442009053, "post_id": 32532550, "comment_id": 52923710, "body": "<code>pure () :: Maybe () == Just ()</code>?"}, {"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1442009576, "post_id": 32532550, "comment_id": 52923903, "body": "@Mephy  How does <code>Maybe () == Just ()</code> applied to <code>&gt;&gt;=</code>?"}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 1, "creation_date": 1442009806, "post_id": 32532550, "comment_id": 52923982, "body": "There is no application, <code>pure () :: Maybe ()</code> is defined as <code>Just ()</code>, in the line 634 of <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\">this source</a>."}], "answers": [{"comments": [{"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 0, "creation_date": 1442010748, "post_id": 32532875, "comment_id": 52924270, "body": "This solves my question, but I found a new question in the code, how does <code>(x,y,z) &lt;- attempt (i-6)</code> work? <code>(x,y,z)</code> is a tuple but <code>attempt x</code> is <code>Just a</code> or <code>Nothing</code>, it would be extremely appreciated if you could answer again."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 1, "creation_date": 1442011396, "post_id": 32532875, "comment_id": 52924454, "body": "@CYC That is how <code>do</code> blocks work. <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow noreferrer\">Here is an explanation of them</a>."}], "tags": [], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "is_accepted": false, "score": 3, "last_activity_date": 1442010022, "last_edit_date": 1442010022, "creation_date": 1442009614, "answer_id": 32532875, "question_id": 32532550, "link": "https://stackoverflow.com/questions/32532550/guard-and-pure-in-haskell/32532875#32532875", "title": "guard and pure in Haskell", "body": "<p>That's multiple questions in one, but let's see if I can make things a bit more clear.</p>\n\n<p>How does Haskell know what <code>f</code> is when interpreting <code>pure ()</code>?  <code>pure</code> is a typeclass method, so this simply comes from the instance declaration of the type we're in.  This changed recently, so you may have to follow a different path to reach the answer, but the result ends up the same: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-633\" rel=\"nofollow\"><code>pure</code> for <code>Maybe</code> is defined as <code>Just</code></a>.</p>\n\n<p>In the same way, <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-685\" rel=\"nofollow\"><code>empty</code> <em>is</em> in <code>Maybe</code>, and is defined as <code>Nothing</code></a>.</p>\n\n<p>You'll find out what typeclass provides those functions by typing <code>:i pure</code> or <code>:i empty</code> at a ghci prompt; then you can seek the instance declaration <code>Maybe</code> makes for them.</p>\n\n<p>It is unfortunate from an SO point of view that this changed recently so there's no clear permanent answer without knowing the specific versions you're using. Hopefully this will settle soon.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1442011120, "creation_date": 1442011120, "answer_id": 32533101, "question_id": 32532550, "link": "https://stackoverflow.com/questions/32532550/guard-and-pure-in-haskell/32533101#32533101", "title": "guard and pure in Haskell", "body": "<p>In the last expression of your manual evaluation of <code>attempt x</code> you are mixing up types and values. <code>pure :: a -&gt; f a</code> is not a definition; it is a type signature (note the <code>::</code>). To quote it fully, the <em>type</em> of <code>pure</code> is:</p>\n\n<pre><code>GHCi&gt; :t pure\npure :: Applicative f =&gt; a -&gt; f a\n</code></pre>\n\n<p>Here, the <code>f</code> stands for any instance of <code>Applicative</code>, and the <code>a</code> for any type. In your case, you are working with the <code>Maybe</code> monad/applicative functor, and so <code>f</code> is <code>Maybe</code>. The type of <code>pure ()</code> is <code>Maybe ()</code>. (<code>() :: ()</code> is a dummy value used when you are not interested in a result. The <code>()</code> in <code>pure ()</code> is a value, but the <code>()</code> in <code>Maybe ()</code> is a type -- the type of the <code>()</code> value).</p>\n\n<p>We will continue from the last correct step in your evaluation:</p>\n\n<pre><code>(pure ()) &gt;&gt;= \\_ -&gt; r!x\n</code></pre>\n\n<blockquote>\n  <p>how does Haskell know what [<code>pure ()</code>] is?</p>\n</blockquote>\n\n<p>In a sense, it doesn't need to. The function which makes use of <code>pure ()</code> here is <code>(&gt;&gt;=)</code>. It has the following type:</p>\n\n<pre><code>GHCi&gt; :t (&gt;&gt;=)\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Setting <code>m</code> to <code>Maybe</code>, as in your case,  we get:</p>\n\n<pre><code>Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b\n</code></pre>\n\n<p>The type of the first argument is <code>Maybe a</code>, and so <code>(&gt;&gt;=)</code> is able to handle any <code>Maybe a</code> value, including <code>pure ()</code>, regardless of whether it is a <code>Just</code>-something or <code>Nothing</code>. Naturally, it will handle <code>Just</code> and <code>Nothing</code> <em>differently</em>, as that is the whole point of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-642\" rel=\"nofollow\">the <code>Monad</code> instance</a>:</p>\n\n<pre><code>(Just x) &gt;&gt;= k      = k x\nNothing  &gt;&gt;= _      = Nothing\n</code></pre>\n\n<p>We still have to complete the evaluation. To do so, we need to know how <code>pure</code> is defined for <code>Maybe</code>. We can find the definition in <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#line-633\" rel=\"nofollow\">the <code>Applicative</code> instance of <code>Maybe</code></a>:</p>\n\n<pre><code>pure = Just\n</code></pre>\n\n<p>Now we can finally continue:</p>\n\n<pre><code>(pure ()) &gt;&gt;= \\_ -&gt; r!x\nJust () &gt;&gt;= \\_ -&gt; r!x\n(\\_ -&gt; r!x) () -- See the implementation of `(&gt;&gt;=)` above.\nr!x\n</code></pre>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 1, "accepted_answer_id": 32533101, "answer_count": 2, "score": 4, "last_activity_date": 1442011120, "creation_date": 1442007850, "last_edit_date": 1442008859, "question_id": 32532550, "link": "https://stackoverflow.com/questions/32532550/guard-and-pure-in-haskell", "title": "guard and pure in Haskell", "body": "<p>I was reading <a href=\"https://wiki.haskell.org/Dynamic_programming_example\" rel=\"nofollow\">Dynamic programming example</a>, there is a code like this:</p>\n\n<pre><code>buy n = r!n\n    where r = listArray (0,n) (Just (0,0,0) : map f [1..n])\n          f i = do (x,y,z) &lt;- attempt (i-6)\n                   return (x+1,y,z)\n                `mplus`\n                do (x,y,z) &lt;- attempt (i-9)\n                   return (x,y+1,z)\n                `mplus`\n                do (x,y,z) &lt;- attempt (i-20)\n                   return (x,y,z+1)\n          attempt x = guard (x&gt;=0) &gt;&gt; r!x\n</code></pre>\n\n<p>My question is how the <code>attempt x = guard (x&gt;=0) &gt;&gt; r!x</code> works? </p>\n\n<p>According to this <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Control.Monad.html#guard\" rel=\"nofollow\">Control.Monad</a> source code,</p>\n\n<pre><code>guard True      =  pure ()\nguard False     =  empty\n\npure :: a -&gt; f a\n\nm &gt;&gt; k = m &gt;&gt;= \\_ -&gt; k\n</code></pre>\n\n<p>so if x>0, then:</p>\n\n<pre><code>attempt x\n    = (guard True) &gt;&gt; (r!x) = (pure ()) &gt;&gt; (r!x)\n    = (pure ()) &gt;&gt;= \\_ -&gt; r!x = (f ()) &gt;&gt;= (\\_ -&gt; r!x)\n</code></pre>\n\n<p>hence <code>f ()</code> should be of type <code>m a</code> (<code>Maybe a</code> in this case), but how does Haskell know what <code>f</code> is? <code>f ()</code> may return <code>empty</code> since it has never been specified. (<code>f</code> means <code>f</code> in pure)</p>\n\n<p>And if x&lt;0, <code>empty</code> is not in <code>Maybe</code>, how can this still applied to <code>&gt;&gt;=</code>? </p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1442006271, "post_id": 32532120, "comment_id": 52922639, "body": "Specifically about <code>Data.Array.IO</code>, the answer is explicitly &quot;no&quot;. <a href=\"https://hackage.haskell.org/package/array-0.5.1.0\" rel=\"nofollow noreferrer\">The <i>array</i> docs</a> say that &quot;<i>In addition to</i> providing the Data.Array module as specified in the Haskell 2010 Language Report, this package <i>also</i> defines the classes IArray of immutable arrays and MArray of arrays mutable within appropriate monads, as well as some instances of these classes&quot; (emphasis mine); meanwhile, <a href=\"https://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array-IO.html\" rel=\"nofollow noreferrer\"><code>Data.Array.IO</code></a> is marked as &quot;non-portable (uses Data.Array.MArray)&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1442007522, "post_id": 32532120, "comment_id": 52923143, "body": "As far as I know, GHC is the only current general purpose Haskell implementation. That said, you might want to check what libraries are available with <code>GHCJS</code> and <code>Haste</code>, and perhaps to branch out a bit to Haskell relatives like Purescript and Frege."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 8, "creation_date": 1442013764, "post_id": 32532120, "comment_id": 52925048, "body": "Unfortunately the Haskell community doesn&#39;t have a real consensus about what&#39;s the &quot;standard&quot; library. The report libraries are too limited for many uses, the GHC libraries are mainly defined by what GHC itself <i>needs</i>, the Haskell Platform was an attempt to define one but many don&#39;t like to depend on it, and Stackage and especially Hackage are too huge."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1442203683, "post_id": 32532120, "comment_id": 52970293, "body": "@&#216;rjanJohansen Probably you should post your comment as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 12, "last_activity_date": 1442219453, "creation_date": 1442219453, "answer_id": 32560351, "question_id": 32532120, "link": "https://stackoverflow.com/questions/32532120/what-is-the-haskell-standard-library/32560351#32560351", "title": "What is the Haskell standard library?", "body": "<p>Unfortunately the Haskell community doesn't have a real consensus about what's the \"standard\" library.</p>\n\n<ul>\n<li>The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellpa2.html#x20-192000II\" rel=\"noreferrer\">report libraries</a> are too limited for many uses.</li>\n<li>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/index.html\" rel=\"noreferrer\">GHC libraries</a> are mainly defined by what GHC itself <em>needs</em>.</li>\n<li>The <a href=\"https://www.haskell.org/platform/\" rel=\"noreferrer\">Haskell Platform</a> was an attempt to define one but many don't like to depend on it.</li>\n<li><a href=\"https://www.stackage.org/\" rel=\"noreferrer\">Stackage</a> and especially <a href=\"https://hackage.haskell.org/\" rel=\"noreferrer\">Hackage</a> are too huge.</li>\n</ul>\n"}], "owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2645, "favorite_count": 1, "accepted_answer_id": 32560351, "answer_count": 1, "score": 20, "last_activity_date": 1519748659, "creation_date": 1442005594, "last_edit_date": 1519748659, "question_id": 32532120, "link": "https://stackoverflow.com/questions/32532120/what-is-the-haskell-standard-library", "title": "What is the Haskell standard library?", "body": "<p>Can the GHC-specific libraries be called the standard library? Or do only those in the Haskell 2010 report count?</p>\n\n<p>Many of the GHC libraries can be implemented by the functions in the Haskell report, possibly combined with C bindings. But the others are reliant on GHC-specific extensions, since the current Haskell language as defined in the language report doesn't support it.</p>\n\n<p>For example, can <code>Data.Array.IO</code> be implemented in pure standard Haskell?</p>\n\n<p>Is it really okay to think that GHC <em>is</em> Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442004692, "post_id": 32531508, "comment_id": 52921968, "body": "Why do you need <code>do</code> here? You&#39;re not sequencing or binding monadic actions."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1442006216, "post_id": 32531508, "comment_id": 52922625, "body": "Yes, I <i>did</i> read your question, and I <i>do</i> know what&#39;s wrong. However, there are some perfectly good answers below, so my adding more answers would be meaningless. I was adding a constructive comment that you would be able to find on many other questions. You seem to have taken it as an affront to yourself; as an insult. I can assure you that it is not. As for why it is a problem, it&#39;s simply unnecessary, and is generally viewed as bad Haskell. Furthermore, the fact that my comment was upvoted should suggest that I&#39;m saying something good."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1442263646, "post_id": 32531508, "comment_id": 53002376, "body": "This may help you: <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Indentation</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442317118, "post_id": 32584622, "comment_id": 53023723, "body": "What exactly does &#39;further indented (n &gt; m)&#39; mean? For example, in my second working example, <code>f&#39;</code> and <code>if</code> are indented identically; neither goes &#39;further&#39;."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442317311, "post_id": 32584622, "comment_id": 53023863, "body": "Hmm you&#39;re right I interpreted <i>n</i> and <i>m</i> as the numbers of characters but in that case it would seem like <i>n &gt;= m</i>."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442318714, "post_id": 32584622, "comment_id": 53024772, "body": "@xiver77: Strangely, it seems to be the <code>do</code> notation that makes the difference between <i>n &gt; m</i> and <i>n &gt;= m</i>. If I take your second example and take out the <code>do</code> (but leave the rest intact), suddenly there is an indentation error. Then, indenting by one more space fixes the error again. I wonder if this behavior is intentional."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442346683, "post_id": 32584622, "comment_id": 53042540, "body": "@xiver77: I have obtained some more information on the subject, see my additional edit. I think this clears things up."}, {"owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "edited": false, "score": 0, "creation_date": 1442354897, "post_id": 32584622, "comment_id": 53046303, "body": "Very nice answer! Thanks for clearing up confusion with the second example."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442586209, "post_id": 32584622, "comment_id": 53155271, "body": "@xiver77: Do you feel anything is still missing/unclear about the answer?"}, {"owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442601531, "post_id": 32584622, "comment_id": 53164111, "body": "Nope, I&#39;m just waiting for the bounty to end. You&#39;re answer is very clear and helpful."}, {"owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "reply_to_user": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 0, "creation_date": 1442913485, "post_id": 32584622, "comment_id": 53268452, "body": "@xiver77: Why are you waiting for the bounty to end? Accepting the answer leads to awarding the bounty. Waiting for it to end with no action will lead to only half the bounty being <a href=\"http://stackoverflow.com/help/bounty\">awarded</a>. Unless you have a reason to prefer that of course..?"}, {"owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "edited": false, "score": 1, "creation_date": 1442913823, "post_id": 32584622, "comment_id": 53268693, "body": "I didn&#39;t know about the half awarding part. Your answer is now accepted."}], "tags": [], "owner": {"reputation": 2271, "user_id": 4994500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233389523330bec1d6e95f4c480d5741?s=128&d=identicon&r=PG&f=1", "display_name": "Sam van Herwaarden", "link": "https://stackoverflow.com/users/4994500/sam-van-herwaarden"}, "is_accepted": true, "score": 6, "last_activity_date": 1442346634, "last_edit_date": 1442346634, "creation_date": 1442315712, "answer_id": 32584622, "question_id": 32531508, "link": "https://stackoverflow.com/questions/32531508/haskell-parse-error-from-incorrect-indent/32584622#32584622", "title": "Haskell parse error from incorrect indent", "body": "<p>The rule you violate is explained in Note 1 under <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3\">Section 10.3</a>. Let me quote:</p>\n\n<blockquote>\n  <p><strong>Note 1.</strong>\n  A nested context must be further indented than the enclosing context (<em>n > m</em>). If not, <em>L</em> fails, and the compiler should indicate a layout error. An example is: <strong>[example, see below]</strong>\n  Here, the definition of <code>p</code> is indented less than the indentation of the enclosing context, which is set in this case by the definition of <code>h</code>.</p>\n</blockquote>\n\n<p>Where the example is the following:</p>\n\n<pre><code>f x = let  \n         h y = let  \n  p z = z  \n               in p  \n      in h\n</code></pre>\n\n<p>In your case, the context of the <code>if</code>-statement, is the <code>f'</code> definition. (Just as in the example, the context of the definition of <code>p</code> is the definition of <code>h</code>.) Since the <code>if</code>-statement is a nested context, it needs to be indented further than the enclosing context (i.e. <code>if</code> needs to be indented further than <code>f'</code>). This is why you get an error in your first snippet.</p>\n\n<p>In your third example <code>p</code> is indented further than <code>f'</code>, this is in accordance with the rules.</p>\n\n<hr>\n\n<p><strong>Edit:</strong></p>\n\n<p>What's strange is that your second example does not give an error since <code>p</code> is not indented further than <code>f'</code>, but has the same indentation, and it almost seems like this is not intentional (i.e. a bug). I did some research, and found out that the <code>do</code> statement actually makes the difference. The following gives an error:</p>\n\n<pre><code>f =\n  f'\n  where f' = -- no do\n        if True then\n          return ()\n        else\n          return ()\n</code></pre>\n\n<p>The interaction between <code>where</code>/<code>let</code> and <code>do</code> seems to cause complications. Check these examples:</p>\n\n<p>1) This compiles without problems:</p>\n\n<pre><code>f = let y = do\n        Just 1\n    in y\n</code></pre>\n\n<p>2) This causes an error:</p>\n\n<pre><code>f = let y =\n        Just 1\n    in y\n</code></pre>\n\n<p>3) This compiles without problems:</p>\n\n<pre><code>f = do\n Just 1\n</code></pre>\n\n<p>4) This causes an error:</p>\n\n<pre><code>f = do\nJust 1\n</code></pre>\n\n<p>What's strange here is that the error in (4) is inconsistent with the successful parse of (1), and the successful parse of (1) seems inconsistent with the rule stated earlier (nested contexts need to be further indented).</p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>Alright, it seems I have gotten to the bottom of it! (I went ahead and filed a bug report, which was kindly marked invalid with an explanation by E.Z. Yang.)</p>\n\n<p>Here is the deal: in some situations it is desirable when using <code>do</code>-notation to not have to constantly increase the indentation. For this reason, the language extension <code>NondecreasingIndentation</code> was implemented, which is on by default. See <a href=\"https://ghc.haskell.org/trac/haskell-prime/wiki/NondecreasingIndentation\">here</a> for more information.</p>\n\n<p>This feature can be turned off, such that the following version of your code would not compile until you increase the indentation of the <code>if-then-else</code>-part:</p>\n\n<pre><code>{-# LANGUAGE NoNondecreasingIndentation #-}\n\nf =\n  f'\n  where f' = do\n        if True then\n          return ()\n        else\n          return ()\n</code></pre>\n\n<p>The <code>NondecreasingIndentation</code> feature is only active in contexts <em>which are already indented</em>. This is why my last example (4), even with the extension enabled, does not compile.</p>\n\n<p><strong>TL;DR</strong></p>\n\n<p>The <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\">golden rule of indentation</a> generally holds, with an exception. Indented <code>do</code>-blocks do not need to be further indented than their enclosing context. To stop GHC from treating <code>do</code>-blocks differently in this way, enable the language extensions <code>NoNondecreasingIndentation</code>.</p>\n"}], "owner": {"reputation": 6043, "user_id": 3998522, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/042b8c418b7f1129fa54862a935377b8?s=128&d=identicon&r=PG&f=1", "display_name": "xiver77", "link": "https://stackoverflow.com/users/3998522/xiver77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 32584622, "answer_count": 1, "score": 5, "last_activity_date": 1442351394, "creation_date": 1442002736, "last_edit_date": 1442262262, "question_id": 32531508, "link": "https://stackoverflow.com/questions/32531508/haskell-parse-error-from-incorrect-indent", "title": "Haskell parse error from incorrect indent", "body": "<p>Can anyone explain why this is a syntax error?</p>\n\n<pre><code>f =\n  f'\n  where f' = do\n    if True then\n      return ()\n    else\n      return ()\n\nmain = f\n</code></pre>\n\n<p>If I give more indentation to the <code>if</code> block, then it somehow compiles well.</p>\n\n<pre><code>f =\n  f'\n  where f' = do\n        if True then\n          return ()\n        else\n          return ()\n\nmain = f\n</code></pre>\n\n<p>Or I can just separate the <code>where</code>, which I'd normally do.</p>\n\n<pre><code>f =\n  f'\n  where\n    f' = do\n      if True then\n        return ()\n      else\n        return ()\n\nmain = f\n</code></pre>\n\n<p>I'm starting a bounty to get a good explanation for the two questions below. (Yes I read the Haskell report. Shame on me for not understanding <em>10.3 Layout</em>)</p>\n\n<ol>\n<li>Why is the first example an error?</li>\n<li>Why isn't the second example an error?</li>\n</ol>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442014597, "post_id": 32531368, "comment_id": 52925222, "body": "Is it important that <code>GenericUtilityFunctions</code> and <code>TestingUtilityFunctions</code> come from the library? I mean, one could imagine building your executable and test suite with their own internal copy of the library and <i>not</i> have an actual dependency on the library; this would increase the compile time significantly but would ease the need to expose internal stuff. I probably wouldn&#39;t squint too hard if this were needed for the test suite, though if even your executable needs access to internal stuff, that&#39;s probably a bad sign that your public API isn&#39;t exciting enough."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442014675, "post_id": 32531368, "comment_id": 52925239, "body": "(...and if that approach sounds appealing to you, I&#39;d be happy to write it up in enough detail to qualify as an answer.)"}, {"owner": {"reputation": 1431, "user_id": 1779853, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d77afdcecf4a659e43e0a725b120b7ca?s=128&d=identicon&r=PG", "display_name": "VF1", "link": "https://stackoverflow.com/users/1779853/vf1"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442023821, "post_id": 32531368, "comment_id": 52926843, "body": "@DanielWagner That answer looks like it takes care of everything I requested in the question, though unfortunately the compilation time is a pretty serious concern, mainly because of the testing dependencies, which take a while.  I think it&#39;s worth posting as an answer since it addresses what the question wants."}, {"owner": {"reputation": 1431, "user_id": 1779853, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d77afdcecf4a659e43e0a725b120b7ca?s=128&d=identicon&r=PG", "display_name": "VF1", "link": "https://stackoverflow.com/users/1779853/vf1"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442024015, "post_id": 32531368, "comment_id": 52926870, "body": "@DanielWagner It&#39;s actually a bit more complicated - I would agree that it&#39;s an API issue if the executable needs access to internals. What&#39;s really going on is the following:  The library provides generic functionality X. The executable provides an important instantiation of X, Y. Y contains some boring business logic that is not too complex but requires a decent amount of code - it is easily testable and has much to gain from being unit tested. If I want to test Y I need to include Y in the library so that it can be tested..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442079778, "post_id": 32531368, "comment_id": 52940771, "body": "It sounds like you just need a single module to be shared between the executable and test suite, and that module doesn&#39;t need access to library internals. That to me screams &quot;not part of the library&quot; -- just a file you write once and import in both the executable and test suite. That module will have to get compiled twice, but that probably isn&#39;t such a big hit -- certainly smaller than compiling the library three times."}], "answers": [{"comments": [{"owner": {"reputation": 1431, "user_id": 1779853, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d77afdcecf4a659e43e0a725b120b7ca?s=128&d=identicon&r=PG", "display_name": "VF1", "link": "https://stackoverflow.com/users/1779853/vf1"}, "edited": false, "score": 0, "creation_date": 1442013143, "post_id": 32531471, "comment_id": 52924905, "body": "Considering the scope of the project, it seems like using an internal module is probably the way to go, especially since I don&#39;t have another convincing reason to use CPP. Unfortunately this doesn&#39;t solve the over-inclusion of dependencies problem."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 11, "last_activity_date": 1442005294, "last_edit_date": 1442005294, "creation_date": 1442002571, "answer_id": 32531471, "question_id": 32531368, "link": "https://stackoverflow.com/questions/32531368/how-can-i-designate-internal-modules-in-my-cabal-package/32531471#32531471", "title": "How can I designate &quot;internal&quot; modules in my cabal package", "body": "<p>One approach, used in <code>containers</code>, is to use CPP to expose some bindings conditionally, depending on whether or not a test build is being run.</p>\n\n<p>The correct approach, in most cases, is to <em>expose</em> your internals module, with a name like <code>Blah.Blah.Internal</code>, which lets your users play games behind your back while solemnly (but implicitly) warning them that they'd better be careful and that they can't rely on anything in there staying the same from version to version.</p>\n"}], "owner": {"reputation": 1431, "user_id": 1779853, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d77afdcecf4a659e43e0a725b120b7ca?s=128&d=identicon&r=PG", "display_name": "VF1", "link": "https://stackoverflow.com/users/1779853/vf1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 3, "accepted_answer_id": 32531471, "answer_count": 1, "score": 10, "last_activity_date": 1442005294, "creation_date": 1442002079, "question_id": 32531368, "link": "https://stackoverflow.com/questions/32531368/how-can-i-designate-internal-modules-in-my-cabal-package", "title": "How can I designate &quot;internal&quot; modules in my cabal package", "body": "<p>I'm using cabal to help organize my dependencies, build process, and testing for a small Haskell project I'm working on. The current cabal file contains lines such as the following:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Project.Exposed1\n                       , Project.Exposed2\n                         -- pretty please don't use below modules\n                       , TestingUtilityFunctions\n                       , GenericUtilityFunctions\n\n  other-modules:       Convenient submodule for responsibility separation\n                       , Another one\n\nexecutable E1\n  -- relies on Project for both Project.Exposed1 AND GenericUtilityFunctions\n\ntestsuite T2\n  -- relies on Project for both Project.Exposed2 AND TestingUtilityFunctions\n</code></pre>\n\n<p>I need to keep <code>TestingUtilityFunctions</code> and <code>GenericUtilityFunctions</code> exposed because they appear in <code>E1</code> and <code>T2</code>. However, they shouldn't be present in the library since the library's functionality is not to provide generic utility functions (which I change as I see fit), but to provide the interface exposed by <code>Project.Exposed*</code> modules.</p>\n\n<p>Is there any way to make a \"private\" library (or several, to minimize dependency over-inclusion) which I can use inside my package but across executables and testsuites?</p>\n"}, {"tags": ["haskell", "monads", "either"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1442005214, "post_id": 32531008, "comment_id": 52922195, "body": "I was going to suggest Hoogle, but I found it surprisingly hard to get Hoogle to give me the right answer. I started with <code>(Char -&gt; Either String (a -&gt; a)) -&gt; (String -&gt; Either String [(a -&gt; a)])</code>, but that gave results; getting the right answer required both the insight that I could replace <code>a -&gt; a</code> with the more-polymorphic <code>a</code>, and that I could replace <code>Either String</code> with the more-polymorphic <code>f</code>. Only then did it suggest <code>mapM</code>. Oh well, at least I didn&#39;t have to have the insight that <code>Char</code> and <code>String</code> could be replaced with the more-polymorphic <code>b</code> and <code>[b]</code>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1442020575, "post_id": 32531008, "comment_id": 52926336, "body": "Isn&#39;t <code>id</code> the only valid functions of type <code>a -&gt; a</code>? (Ignoring errors, undefined, unsafe side effects, etc)"}], "answers": [{"comments": [{"owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 1, "creation_date": 1442001857, "post_id": 32531234, "comment_id": 52920716, "body": "Indeed, the parseAction is actually working on lawn mower :), but for the purpose of explanation, I didn&#39;t explain it."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 11, "last_activity_date": 1442002336, "last_edit_date": 1442002336, "creation_date": 1442001460, "answer_id": 32531234, "question_id": 32531008, "link": "https://stackoverflow.com/questions/32531008/how-to-map-either-string-a-b-to-either-string-a-b/32531234#32531234", "title": "How to map (Either String (a -&gt; b)) to (Either String [(a -&gt; b)])", "body": "<p>This looks like </p>\n\n<pre><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\n</code></pre>\n\n<p>where </p>\n\n<pre><code>a ~ Char\nb ~ (a -&gt; a)\nm ~ (Either String)\n</code></pre>\n\n<p>So an implementation is simply:</p>\n\n<pre><code>parseSequence :: String -&gt; Either String [a -&gt; a]\nparseSequence = mapM parseAction\n</code></pre>\n\n<p>As an aside, note that your <code>parseAction</code> doesn't really want to be using type <code>(a -&gt; a)</code>, which must work for <em>any</em> type <code>a</code>, chosen by the person calling the function. You instead want it to use type <code>(Location -&gt; Location)</code>, where Location is whatever type you're using to represent the location of the object you're moving.</p>\n\n<p>Equivalently to mapM, you can (as suggested by duplode) instead use traverse, which is slightly more general. In recent versions of GHC traverse is in Prelude; in older versions you may have to import it from Data.Traversable to use it.</p>\n"}, {"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1442001662, "post_id": 32531262, "comment_id": 52920644, "body": "But amalloy&#39;s solution is neater."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1442002215, "post_id": 32531262, "comment_id": 52920872, "body": "Hiding your &quot;impossible&quot; error behind <code>head</code> and <code>tail</code> is much worse."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1442001604, "creation_date": 1442001604, "answer_id": 32531262, "question_id": 32531008, "link": "https://stackoverflow.com/questions/32531008/how-to-map-either-string-a-b-to-either-string-a-b/32531262#32531262", "title": "How to map (Either String (a -&gt; b)) to (Either String [(a -&gt; b)])", "body": "<p>If you map parseAction over your source string you get part of the way. In GHCi:</p>\n\n<pre><code>&gt; :type map parseAction \"FFRRF\"\n[Either String (a-&gt;a)]\n</code></pre>\n\n<p>So now you can fold this into a single Either value</p>\n\n<pre><code>validActions = foldr f (Right [])\n   where\n      f (Left str) _ = Left str\n      f (Right x) (Right xs) = Right (x:xs)\n      f (Right x) (Left str) = error \"Can't happen\"\n</code></pre>\n\n<p>However this has an annoying \"error\" case. So to get rid of that:</p>\n\n<pre><code>import Data.Either\n\nvalidActions vs = if null ls then Right rs else Left $ head ls\n   where (ls, rs) = partitionEithers vs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 0, "creation_date": 1442002621, "post_id": 32531344, "comment_id": 52921043, "body": "So does mapM handle Left aswell ?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 1, "creation_date": 1442003524, "post_id": 32531344, "comment_id": 52921416, "body": "@MaximeB. Yes, it does. In practice, there is no difference between <code>mapM</code> and <code>traverse</code> other than the type signature. (It might be said that <code>mapM</code> only exists because, back when it was introduced, <code>Applicative</code> and <code>Traversable</code> didn&#39;t exist yet. It worked just the same because you can make every <code>Monad</code> an <code>Applicative</code>. Nowadays that is reflected in <code>Applicative</code> being a superclass of <code>Monad</code>.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 7, "last_activity_date": 1442002475, "last_edit_date": 1442002475, "creation_date": 1442001953, "answer_id": 32531344, "question_id": 32531008, "link": "https://stackoverflow.com/questions/32531008/how-to-map-either-string-a-b-to-either-string-a-b/32531344#32531344", "title": "How to map (Either String (a -&gt; b)) to (Either String [(a -&gt; b)])", "body": "<p><em>Note: For extra clarity, I am going to use <code>Thing -&gt; Thing</code> rather than <code>a -&gt; a</code>.</em></p>\n\n<p>You need <code>traverse</code>:</p>\n\n<pre><code>traverse parseAction\n  :: Traversable t =&gt; t Char -&gt; Either String (t (Thing -&gt; Thing))\n</code></pre>\n\n<p>In your case, <code>t</code> is <code>[]</code>, and so, <code>t Char</code> is <code>String</code>. <code>traverse parseAction</code> will walk across the <code>String</code>, generating one action for each <code>Char</code> and collecting the results. <code>traverse</code> uses the <code>Applicative</code> instance of <code>Either</code> to handle <code>Left</code>s and <code>Right</code>s, stopping at the first <code>Left</code>.</p>\n\n<p>P.S.: <code>mapM</code> in amalloy's answer is, in this case, equivalent to <code>traverse</code>. The only difference between them is that <code>traverse</code> is more general, as it only requires <code>Applicative</code> (rather than <code>Monad</code>) from the functor you use while traversing.</p>\n"}], "owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 32531234, "answer_count": 3, "score": 7, "last_activity_date": 1442002475, "creation_date": 1442000437, "last_edit_date": 1442000742, "question_id": 32531008, "link": "https://stackoverflow.com/questions/32531008/how-to-map-either-string-a-b-to-either-string-a-b", "title": "How to map (Either String (a -&gt; b)) to (Either String [(a -&gt; b)])", "body": "<p>I try to find a solution on an exercise of my own, with the following requirements :</p>\n\n<ul>\n<li>We need to move an object against a given sequence.</li>\n<li>A sequence is composed of actions.</li>\n</ul>\n\n<p>Here are the possible actions : F, L, R</p>\n\n<ul>\n<li>F : move Forward</li>\n<li>L : rotate 90\u00b0 to the left</li>\n<li>R : rotate 90\u00b0 to the right</li>\n</ul>\n\n<p>A sequence is then represented by a string, like this :</p>\n\n<p><code>\"FFLRLFF\"</code></p>\n\n<p>I want to parse the above sequence (and handle errors) and then bind each action to a function, like this :</p>\n\n<pre><code>parseAction :: Char -&gt; Either String (a -&gt; a)\nparseAction 'F' = Right moveForward\nparseAction 'L' = Right turnLeft\nparseAction 'R' = Right turnRight\nparseAction s   = Left (\"Unkown action : \" ++ [s])\n\n-- Implementation omitted\nmoveForward :: a -&gt; a\nturnLeft :: a -&gt; a\nturnRight :: a -&gt; a\n</code></pre>\n\n<p>Now what I want is something with the following signature :</p>\n\n<pre><code>parseSequence :: String -&gt; Either String [(a -&gt; a)]\n</code></pre>\n\n<p>I want to parse a full sequence by using many times <code>parseAction</code> function, and fails when that one returns Left. I'm stuck on how can I implement this function.</p>\n\n<p>Do you have any ideas ?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1441998134, "post_id": 32530240, "comment_id": 52918946, "body": "What is salsa? It would be helpful to provide a link."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442000178, "post_id": 32530770, "comment_id": 52919974, "body": "I did this:  <code>instance Monad Salsa where     return a = Salsa $ \\con -&gt; (a, con, [] :: Animation)</code>  but it says that  <code>Couldn&#39;t match expected type </code>Either                                     String (a, Context, Animation)&#39;                 with actual type <code>(a, Context, Animation)&#39;     Relevant bindings include       a :: a (bound at SalsaInterp.hs:33:12)       return :: a -&gt; Salsa a (bound at SalsaInterp.hs:33:5)     In the expression: (a, con, [] :: Animation)     In the second argument of </code>($)&#39;, namely       <code>\\ con -&gt; (a, con, [] :: Animation)&#39;     In the expression:.....</code>"}, {"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442000388, "post_id": 32530770, "comment_id": 52920057, "body": "How can I show what to do in <code>Left</code> case and what in <code>Right</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442000437, "post_id": 32530770, "comment_id": 52920079, "body": "@Ezis All that is missing (for <code>return</code>, at least) is wrapping the tuple in <code>Right</code>."}], "tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": false, "score": 6, "last_activity_date": 1442000452, "last_edit_date": 1442000452, "creation_date": 1441999429, "answer_id": 32530770, "question_id": 32530240, "link": "https://stackoverflow.com/questions/32530240/haskell-define-return-for-monad-with-function-and-either/32530770#32530770", "title": "Haskell define return for Monad with function and Either", "body": "<p>You need a function which takes a <code>Context</code> so use a lambda <code>\\con -&gt;</code>.</p>\n\n<p>You don't have anything that has failed so far so you can always succeed. <code>Right</code>.</p>\n\n<p><code>a</code> is provided by the call to <code>return</code>. <code>(a,</code>.</p>\n\n<p><code>Context</code> is provided by the call to the lambda. <code>con,</code>.</p>\n\n<p>Now you have to decide on the animations to include, I would guess none. <code>[])</code>. (Note I don't remember offhand the exact syntax there but I think this is right).</p>\n\n<p>Putting it all together you get:</p>\n\n<pre><code>return a = Salsa $ \\con -&gt; Right (a, con, [])\n</code></pre>\n\n<p>Now comes the complicated case where you have to handle bind (<code>&gt;&gt;=</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1442027264, "post_id": 32531975, "comment_id": 52927388, "body": "I don&#39;t think your implementation is ugly. At heart, this is State + Writer + Either, so it is not surprising that the plumbing gets a bit hairy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1442038570, "post_id": 32531975, "comment_id": 52929479, "body": "I believe when @Guvante wrote &quot;Now comes the complicated case&quot; for <code>&gt;&gt;=</code> they were omitting the <code>&gt;&gt;=</code> part on purpose, so not to hand out the full solution to the assignment and make the OP work on it on their own."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1442005193, "last_edit_date": 1442005193, "creation_date": 1442004848, "answer_id": 32531975, "question_id": 32530240, "link": "https://stackoverflow.com/questions/32530240/haskell-define-return-for-monad-with-function-and-either/32531975#32531975", "title": "Haskell define return for Monad with function and Either", "body": "<p>Well, I don't know anything about Salsa, but after reading Guvante's answer foreshadowing the difficulty of implementing <code>&gt;&gt;=</code>, I thought it would be an interesting exercise. And since I don't know what Salsa's Context or Animation types are, I decided to just parameterize over them, which I think worked out fairly well: the type of Context can be totally opaque to us as implementors of <code>&gt;&gt;=</code>, and we just need <code>Animation</code> to be a monoid:</p>\n\n<pre><code>newtype Salsa ctx error anim a = Salsa {\n    runSalsa :: ctx -&gt; Either error (a, ctx, anim)\n    }\n\ninstance Monoid anim =&gt; Monad (Salsa ctx error anim) where\n    return x = Salsa $ \\ctx -&gt; return (x, ctx, mempty)\n    (Salsa m) &gt;&gt;= f = Salsa m'\n      where m' ctx = m ctx &gt;&gt;= handle\n            handle (x, ctx, anims) = let (Salsa f') = f x\n                                         merge (a, b, c) = (a, b, mappend anims c)\n                                     in merge &lt;$&gt; f' ctx\n\n\ninstance Monoid anim =&gt; Functor (Salsa ctx error anim) where\n    fmap = liftM\ninstance Monoid anim =&gt; Applicative (Salsa ctx error anim) where\n    pure = return\n    (&lt;*&gt;) = ap\n</code></pre>\n\n<p>This as general as I could figure how to make it, and I'm still not totally happy with the implementation of <code>handle</code>: it seems like there must be a better way to get the animation results combined than letting a function and then fmapping it, but I couldn't find anything prettier.</p>\n\n<p>Incidentally I think it would be nicer to have a real data type for this <code>(a, Context, Animation)</code> group rather than just a tuple. Then you could, for example, give it a Functor instance and simplify the implementation of <code>handle</code>, removing the <code>merge</code> function and just writing </p>\n\n<pre><code>mappend anims &lt;$&gt; f' ctx\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442061164, "post_id": 32532149, "comment_id": 52935051, "body": "<code>instance Monad Salsa where     return a = Salsa $ \\con -&gt; Right (a, con, [] :: Animation)     (Salsa function) &gt;&gt;= f = Salsa $ \\con1 -&gt;          let result = function con1 in          case result of             Left errorMsg -&gt; Left errorMsg             Right (a, con2, anim) -&gt;                 let Salsa function2 = f a                     result2 = function2 con2                 in                  case result2 of                      Left errorMsg -&gt; Left errorMsg                     anim3 = anim ++ anim2                     Right (b, con3, anim2) -&gt; Right (b,con3, anim3)</code>"}, {"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442061222, "post_id": 32532149, "comment_id": 52935064, "body": "Could you elaborate on that? I think i am close"}, {"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442061647, "post_id": 32532149, "comment_id": 52935198, "body": "<code>instance Monad Salsa where     return a = Salsa $ \\con -&gt; Right (a, con, [] :: Animation)     (Salsa function) &gt;&gt;= f = Salsa $ \\con1 -&gt;          let result = function con1 in          case result of             Left errorMsg -&gt; Left errorMsg             Right (a, con2, anim) -&gt;                 let Salsa function2 = f a                     result2 = function2 con2                 in                  case result2 of                      Left errorMsg -&gt; Left errorMsg                     Right (b, con3, anim2) -&gt; Right (b,con3, mappend anim anim2)</code>"}, {"owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442061665, "post_id": 32532149, "comment_id": 52935202, "body": "That newest one compiles. How can i make sure that it is correct?"}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "reply_to_user": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "edited": false, "score": 0, "creation_date": 1442078302, "post_id": 32532149, "comment_id": 52940289, "body": "The magic of haskell is: when it compiles, it usually is right. From what I see your solution looks good."}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": true, "score": 3, "last_activity_date": 1442005747, "creation_date": 1442005747, "answer_id": 32532149, "question_id": 32530240, "link": "https://stackoverflow.com/questions/32530240/haskell-define-return-for-monad-with-function-and-either/32532149#32532149", "title": "Haskell define return for Monad with function and Either", "body": "<p>Help yourself with <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/typed-holes.html\" rel=\"nofollow\">typed holes</a>: Write an underscore where you are stuck:</p>\n\n<pre><code>instance Monad Salsa where\n    return a = Salsa $ _\n</code></pre>\n\n<p>and the compiler tells you it needs a function here</p>\n\n<pre><code>Found hole \u2018_\u2019\n  with type: Context -&gt; Either String (a, Context, Animation)\n</code></pre>\n\n<p>Now you can work your way with</p>\n\n<pre><code>instance Monad Salsa where\n    return a = Salsa $ \\x -&gt; _\n</code></pre>\n\n<hr>\n\n<p>For <code>&gt;&gt;=</code>, do almost the same:</p>\n\n<pre><code>(Salsa s) &gt;&gt;= f = Salsa $ \\x -&gt; _ \n</code></pre>\n\n<p>and the compiler outputs</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: Either String (b, Context, Animation)\nRelevant bindings include\n  con :: Context\n  f :: a -&gt; Salsa b\n  s :: Context -&gt; Either String (a, Context, Animation)\n</code></pre>\n\n<p>So, <code>s</code> is function that requires a <code>Context</code>, but our <code>con</code> supplies one, put it together:</p>\n\n<pre><code>(Salsa s) &gt;&gt;= f = Salsa $ \\con -&gt; let s' = s con in _\n...\n  s' :: Either String (a, Context, Animation)\n    (bound at Review.hs:12:43)\n  f :: a -&gt; Salsa b (bound at Review.hs:12:19)\n</code></pre>\n\n<p>So we need that <code>a</code> thing out of <code>s'</code> to supply it to <code>f</code>. Pattern match on <code>s'</code> (while renaming):</p>\n\n<pre><code>(Salsa salsaFunction1) &gt;&gt;= f = Salsa $ \\context1 -&gt; \n  let salsaResult1 = salsaFunction1 context1\n   in case salsaResult1 of\n        Left errorMsg                   -&gt; Left errorMsg\n        Right (a, context2, animation1) -&gt;\n           let Salsa salsaFunction2 = f a\n               salsaResult2         = salsaFunction2 context2\n            in _\n\n\n  salsaFunction2 :: Context -&gt; Either String (b, Context, Animation)\n  animation1 :: Animation\n  context2 :: Context\n  a :: a\n  salsaResult1 :: Either String (a, Context, Animation)\n  context1 :: Context\n  f :: a -&gt; Salsa b \n  salsaFunction1 :: Context -&gt; Either String (a, Context, Animation)\n</code></pre>\n\n<p>So, we have another <code>salsaFunction2</code>, and an unused <code>context2</code>. You already saw how to put this together: do another case analysis, in the <code>Right</code> case supply <code>context3</code>, the monadic result <code>b</code> and combine both animations to provide the final <code>Either String (b, Context, Animation)</code> that was seen again and again:</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: Either String (b, Context, Animation)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 4442032, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-fXnHbOHDqNY/AAAAAAAAAAI/AAAAAAAAABE/sgDlzFdQMkY/photo.jpg?sz=128", "display_name": "Ezis", "link": "https://stackoverflow.com/users/4442032/ezis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 32532149, "answer_count": 3, "score": 0, "last_activity_date": 1442005747, "creation_date": 1441997249, "last_edit_date": 1441998290, "question_id": 32530240, "link": "https://stackoverflow.com/questions/32530240/haskell-define-return-for-monad-with-function-and-either", "title": "Haskell define return for Monad with function and Either", "body": "<p>how do i define a monad for such a datatype in Haskell? It is basically a salsa interpreter. And I cant figure out what should the return look like. It is making me crazy...</p>\n\n<pre><code>newtype Salsa a = Salsa {\n    runSalsa :: Context -&gt; Either String (a, Context, Animation)}\n\ninstance Monad Salsa where\n    return a = Salsa $ ..........\n\ninstance Functor Salsa where\n    fmap = liftM\ninstance Applicative Salsa where\n    pure = return\n    (&lt;*&gt;) = ap\n</code></pre>\n\n<p><a href=\"http://ap-e2015.onlineta.org/assignments/assignment-1-salsa-interpreter.html\" rel=\"nofollow\">http://ap-e2015.onlineta.org/assignments/assignment-1-salsa-interpreter.html</a> </p>\n"}, {"tags": ["haskell", "primitive-types"], "answers": [{"comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1441999005, "post_id": 32530296, "comment_id": 52919413, "body": "yes, I only said <code>IO</code>-like, because the whole <code>IO</code>-monad is built around the concept of passing <code>State#</code> values around. If you look at the implementation of the <code>IO</code> monad in GHC, you will see that it is defined as <code>newtype IO a = IO (State# RealWorld -&gt; (# State# RealWorld, a #))</code> where the right-hand-side <code>State# RealWorld -&gt; (# State# RealWorld, a #)</code> looks really similar to <code>State# s -&gt; (# State# s, a #)</code>. So, the <code>readIntOffAddr#</code> function can easily be lifted to the <code>IO</code> monad."}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": true, "score": 8, "last_activity_date": 1542134006, "last_edit_date": 1542134006, "creation_date": 1441997480, "answer_id": 32530296, "question_id": 32529812, "link": "https://stackoverflow.com/questions/32529812/what-is-the-addr-type-and-how-can-i-use-it/32530296#32530296", "title": "What is the Addr# type, and how can I use it?", "body": "<p>The equivalent* C code would be:</p>\n\n<pre><code>long readIntOffAddr(long *ptr, long offset) {\n    return ptr[offset];\n}\n</code></pre>\n\n<p><code>Addr#</code> is just like <code>void *</code>. The function has an <code>IO</code>-like signature because it is not \"pure\". Multiple calls to the function may return different values (obviously).</p>\n\n<p><sub>* <strong>Update (2018):</strong> I just learned that equating C's <code>int</code> type with Haskells <code>Int#</code> type is wrong. So I changed <code>int</code> to <code>long</code> in the above code snippet. This is also (maybe) not 100% correct, but at least it is true for all GHC implementations that I have seen. In GHC versions 6-8 (haven't checked others), <code>Int#</code> is 32 bit wide on 32-bit platforms and 64 bit wide on 64-bit platforms. This matches the behaviour of GCC for <code>long</code> for all C/C++ implementations on 32-bit and 64-bit platforms that I am aware of, so I think equating <code>Int#</code> with <code>long</code> is a good first approximation. No one noticed this minor inaccuracy in the last 3 years (or cared enough to edit/comment), so please don't downvote me for that. I doubt that there is any Haskell/Platform/C combination where <code>HsInt</code> != <code>long</code> where the Haskell implementation has a <code>readIntOffAddr#</code> function.. please prove me wrong.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1441999945, "post_id": 32530874, "comment_id": 52919863, "body": "This clarified it for me. Thanks."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 9, "last_activity_date": 1441999849, "creation_date": 1441999849, "answer_id": 32530874, "question_id": 32529812, "link": "https://stackoverflow.com/questions/32529812/what-is-the-addr-type-and-how-can-i-use-it/32530874#32530874", "title": "What is the Addr# type, and how can I use it?", "body": "<p>As a complement to Michael's answer:</p>\n\n<p><code>Addr#</code> is the unboxed type underlying a <code>Ptr a</code> in the same way that <code>Int#</code> is the unboxed type underlying an <code>Int</code>. Its contents are presumably to be interpreted as a machine address, though as far as the compiler and GC are concerned it is just another integral type (of whatever size pointers are on the system in question). Since it is an arbitrary machine address and not a GC-managed pointer, it should presumably not point into the Haskell heap because the addresses of Haskell heap objects are not stable as viewed from the level of Haskell (a GC could occur at any point in your program, and then whatever object your <code>Addr#</code> pointed at now lives elsewhere, or nowhere at all).</p>\n\n<p>Normally a <code>Ptr a</code>/<code>Addr#</code> will contain a pointer returned from <code>malloc</code>/<code>mmap</code>/etc., or a pointer to a C global variable, or in general any sort of thing that a pointer might sensibly point to in a C program. You would normally use <code>readIntOffAddr#</code> when interfacing with a C function that returns or modifies the contents of a passed <code>HsInt *</code>. (Well, you wouldn't use it directly, you'd use <code>Int</code>'s <code>peekElemOff</code> <code>Storable</code> method which I presume is implemented in terms of <code>readIntOffAddr#</code>, or you would use an even higher-level function like <code>peekArray</code>).</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 859, "favorite_count": 0, "accepted_answer_id": 32530296, "answer_count": 2, "score": 4, "last_activity_date": 1542134006, "creation_date": 1441995605, "question_id": 32529812, "link": "https://stackoverflow.com/questions/32529812/what-is-the-addr-type-and-how-can-i-use-it", "title": "What is the Addr# type, and how can I use it?", "body": "<p>I've recently been looking around at various Haskell quirks, like unboxed types and whatnot, when I discovered the <code>Addr#</code> type.</p>\n\n<p>The <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/libraries/ghc-prim-0.2.0.0/GHC-Prim.html#g:10\" rel=\"nofollow\"><code>GHC.Prim</code></a> package describes it as so:</p>\n\n<blockquote>\n  <p>An arbitrary machine address assumed to point outside the garbage-collected heap.</p>\n</blockquote>\n\n<p>And that means not much to me.</p>\n\n<p>Furthermore, I keep finding functions like this that use the type:</p>\n\n<pre><code>readIntOffAddr# :: Addr# -&gt; Int# -&gt; State# s -&gt; (#State# s, Int##)\n</code></pre>\n\n<p>What is this type? What can I do with it? Why is it necessary?</p>\n"}, {"tags": ["python", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441996644, "post_id": 32529539, "comment_id": 52918206, "body": "<code>4</code> is not serializable as JSON because the top level construct has to be a list or an object.  You could have <code>{&quot;value&quot;: 4}</code> or <code>[4]</code>, but not <code>4</code>.  This is my guess anyway.  I&#39;m not familiar with <code>pyfi</code>, but you could try a simpler import than a <code>from ... import ... as ...</code> to see if you can at least get the function itself."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441997573, "post_id": 32529539, "comment_id": 52918659, "body": "Thanks ! I have a look !"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441997685, "post_id": 32529539, "comment_id": 52918719, "body": "Btw, <code>square</code> just works fine. What do you mean by function itself ? The function seems to be working, that is where the <code>4</code> is coming from."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1442146172, "post_id": 32529539, "comment_id": 52955121, "body": "<a href=\"http://meta.stackoverflow.com/questions/303812/discourage-screenshots-of-code-and-or-errors\" title=\"discourage screenshots of code and or errors\">meta.stackoverflow.com/questions/303812/&hellip;</a>"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442156030, "post_id": 32529539, "comment_id": 52957792, "body": "The arguments against screenshots are pretty poor. SOF should make screenshots searchable like Evernote does instead of limiting users."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1442169290, "post_id": 32529539, "comment_id": 52962067, "body": "That would solve both the screenreader and searchability problem..."}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 804, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1442039610, "creation_date": 1441994554, "last_edit_date": 1442039610, "question_id": 32529539, "link": "https://stackoverflow.com/questions/32529539/python-function-interface-for-haskell-module-not-found-decodeexception-pyfi", "title": "Python function interface for Haskell - Module not found/DecodeException - pyfi", "body": "<p>I have just tried <a href=\"https://github.com/Russell91/pyfi\" rel=\"nofollow noreferrer\">pyfi</a> and it gives me \"Module not found\" error. Any ideas what could be wrong ?</p>\n\n<p><a href=\"https://i.stack.imgur.com/vGjGs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vGjGs.png\" alt=\"enter image description here\"></a></p>\n\n<p>Also, related question, why does the example below from the github page not work ?</p>\n\n<p>Why is 4 not JSON serializable ? Is this a bug in pyfi ?</p>\n\n<p><a href=\"https://i.stack.imgur.com/FbCaR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FbCaR.png\" alt=\"enter image description here\"></a></p>\n\n<p>Update (trying to debug):</p>\n\n<p><a href=\"https://i.stack.imgur.com/t2PvU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/t2PvU.png\" alt=\"enter image description here\"></a></p>\n\n<p>After setting export PYTHONPATH=.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ThKJb.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ThKJb.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "printing", "io", "idioms"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441995538, "post_id": 32529524, "comment_id": 52917586, "body": "<code>pprint</code> is usually pretty understandable as an alternatively to <code>show</code> that does pretty output."}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 1, "creation_date": 1441995979, "post_id": 32529524, "comment_id": 52917820, "body": "My advice: do not use <code>read</code>: it fails with <code>error</code>. You can use things like <code>maybeRead</code> (or <code>reads</code> function), but I think that <code>attoparsec</code> library is better - it could produce cleaner messages. Not using <code>read</code> lifts the restriction."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441996331, "post_id": 32529524, "comment_id": 52918017, "body": "@bheklilr: Can you say a bit more about how to implement and use <code>pprint</code>. For my purposes, the best &quot;display&quot; is something very much different from the underlying representation of the value, and needs a good bit of formatting to get there. (Reading that representation, btw, would make almost no sense, since no user would enter it.)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441996483, "post_id": 32529524, "comment_id": 52918113, "body": "<code>pprint :: PPrintOptions -&gt; MyType -&gt; String</code> or just <code>pprint :: MyType -&gt; String</code>.  I can&#39;t really provide any more tips without knowing what the structure is and how you want to display it, which would be a different question anyway.  You can also optionally swap out <code>String</code> for <code>Text</code> or <code>ByteString</code> depending on your needs."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1441996932, "post_id": 32529524, "comment_id": 52918349, "body": "@bheklilr: What typeclass does <code>MyType</code> implement for <code>pprint</code>, and how is <code>pprint</code> invoked \u2014 <code>print</code> has the advantage of being &quot;automatic&quot;, in GHCi, Jupyter Notebooks, and through <code>print</code>? (Awkward naming too; <code>print</code> actually prints, bit <code>pprint</code> really does something more like <code>pshow</code>, right?)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1441997117, "post_id": 32529524, "comment_id": 52918441, "body": "@raxacoricofallapatorius There isn&#39;t any standard typeclass, if that&#39;s what you&#39;re asking.  I just came up with a function name and a type signature.  If you would prefer using <code>pshow</code> then that&#39;s fine by me, if you wanted a typeclass with it then <code>class PrettyShow a where pshow :: a -&gt; String</code> and then <code>pprint :: PrettyShow a =&gt; a -&gt; IO (); pprint = putStrLn . pshow</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 0, "creation_date": 1442004578, "post_id": 32529524, "comment_id": 52921908, "body": "@Heimdell Beyond <code>maybeRead</code> (from the <i>utility-ht</i> package) there is also <code>readMaybe</code> in <code>Text.Read</code> (which is in <i>base</i> and is therefore more accessible)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1442006973, "post_id": 32529524, "comment_id": 52922907, "body": "The entire <code>Read</code> mechanism is a bit of a throwback, based on an interesting idea about parsing that later developed in other directions. Aside from the fact that <code>Read</code> instances are relatively hard to write, there&#39;s the bigger problem that they&#39;re not usually terribly useful.  <code>Show</code> is primarily useful for debugging and interactive development in GHCi. I&#39;ve not yet seen a killer app for <code>Read</code>. It&#39;s typically much more useful to write, say, <code>attoparsec</code> and/or <code>parsec</code> parsers, instances of serialization classes, <code>FromJSON</code> instances, etc."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1442008182, "post_id": 32529524, "comment_id": 52923400, "body": "@dfeuer: That (from my beginner vantage) seems accurate. <code>Show</code> seems like a debugging tool and not much more. It&#39;s certainly not for end use. The  absence of a <code>PShow</code> typeclass <a href=\"http://stackoverflow.com/q/32532617/656912\">seems an omission</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442002336, "post_id": 32529884, "comment_id": 52920924, "body": "I think you should clarify a bit by saying something like <code>show (read &quot;Just (((6)))&quot;) = &quot;Just 6&quot;</code>, which is clearly not the identity, but nonetheless correct."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1442003733, "post_id": 32529884, "comment_id": 52921507, "body": "@AJFarmar I added a note, even if the OP asked about <code>read.show</code>, not <code>show.read</code>. Still, the latter can be interesting for comparison with the former."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1442003671, "last_edit_date": 1442003671, "creation_date": 1441995899, "answer_id": 32529884, "question_id": 32529524, "link": "https://stackoverflow.com/questions/32529524/what-is-the-correct-way-to-write-a-rich-haskell-show-function/32529884#32529884", "title": "What is the correct way to write a rich Haskell &quot;show&quot; function?", "body": "<p>First of all, <code>show</code> is expected to produce a string following the Haskell syntax -- ideally, one should be able to cut &amp; paste that into a Haskell file and have that work.</p>\n\n<p>That being said, <code>read . show</code> is expected to be the identity. However, sometimes it is relaxed a bit, only requiring that</p>\n\n<pre><code>read (show x) == x\n</code></pre>\n\n<p>where <code>(==)</code> is the <em>equivalence</em> defined by the related <code>Eq</code> instance.\nI believe the archetypal example for this is <code>Data.Set.Set</code>, which internally represents sets using balanced binary search trees (BST). Its <code>Show</code> instance produces strings of the form</p>\n\n<pre><code>fromList [1,2,3,4,6,7]\n</code></pre>\n\n<p><code>read</code>ing back such a string likely produces a different BST, but one which is still <code>==</code> to the old one. From the user's point of view, there's no (observable) difference.</p>\n\n<p>When printing a custom \"opaque\" type the same <code>fromSomeTransparentType value</code> string encoding can often be used.</p>\n\n<p>Finally, I guess these <code>Show</code>-related \"social contracts\" are much more respected in <em>libraries</em> than in <em>applications</em>. This is because in applications one sometimes can reasonably assume that no one else - but the application itself - will ever use these instances. E.g., I think this is okay-ish for an application:</p>\n\n<pre><code>data Exp = Add Exp Exp | ...\ninstance Show Exp where\n   show (Add e1 e2) = \"(\" ++ show e1 ++ \", \" ++ show e2 ++ \")\"\n</code></pre>\n\n<hr>\n\n<p>The \"other\" law <code>show . read == id</code> does not hold, in general. First, <code>read</code> is partial. Second, even disregarding partiality, the <code>read</code> method is allowed to be more lenient on its input, e.g. treating repeated whitespace as a single one, or neglecting redundant parentheses: (as AJFarmar suggests below)</p>\n\n<pre><code>show (read \"Just (((6)))\") = \"Just 6\"\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 0, "accepted_answer_id": 32529884, "answer_count": 1, "score": 4, "last_activity_date": 1442003671, "creation_date": 1441994494, "last_edit_date": 1495541680, "question_id": 32529524, "link": "https://stackoverflow.com/questions/32529524/what-is-the-correct-way-to-write-a-rich-haskell-show-function", "title": "What is the correct way to write a rich Haskell &quot;show&quot; function?", "body": "<p>My understanding of the <a href=\"https://stackoverflow.com/a/7852258/656912\">correct implementation</a> for Haskell's <code>Show</code> and <code>Read</code> is that <code>read.show</code> should be identity. If true, then either <code>read</code> needs to be able to do some pretty messy string parsing, or <code>show</code> has to provide fairly limited functionality (from a user experience point of view).</p>\n\n<p>Is it the case that <code>read.show == id</code>, and if so what is the accepted Haskell practice \u2014 for function naming and invocation \u2014 for richer (string) representations of values?</p>\n"}, {"tags": ["haskell", "coding-style", "associative-array", "idioms"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442065358, "post_id": 32530417, "comment_id": 52936198, "body": "Excellent! Can you say a bit more about your remark about the second import (<code>import Data.Map (Map)</code>). Also I think I need <code>M.fromList</code>. Is my lambda for generating <code>components</code> ok? I do indeed &quot;control&quot; that, so the duplication of &quot;name&quot; isn&#39;t such an issue (as you correctly point out). Is there a Haskell idiom for naming such &quot;private&quot; or &quot;internal&quot; values?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1442104129, "post_id": 32530417, "comment_id": 52947132, "body": "@raxacoricofallapatorius (1) The <code>import Data.Map (Map)</code> is just to make the type signatures a little less noisy. It is perfectly okay to leave it out; it only means you&#39;ll have to write <code>components :: M.Map Name Component</code>. (2) <code>M.fromList</code>, indeed. (3) The lambda is fine. There are point-free ways of writing that, such as <code>liftA2 (,) name id</code> (<code>liftA2</code> is in <code>Control.Applicative</code>) and <code>name &amp;&amp;&amp; id</code> (<code>(&amp;&amp;&amp;)</code> is in <code>Control.Arrow</code>), but in this case the choice is largely a matter of taste (some people will think the point-free versions are cleaner, while others will find them obfuscating)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1442104864, "post_id": 32530417, "comment_id": 52947283, "body": "@raxacoricofallapatorius (4) &quot;Is there a Haskell idiom for naming such &quot;private&quot; or &quot;internal&quot; values?&quot; -- Not really; just name them as you would name anything else. That also means having reasonably clear names even for internal values, to make it easier for people reading your implementation. Also, it is generally okay to have shorter and less descriptive names for things that have local scope (function parameters, <code>where</code> clause definitions, etc.), as in most cases it will be possible to spot all uses of local names in a quick glance."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1442150917, "post_id": 32530417, "comment_id": 52956346, "body": "Excellent! Thanks for the detailed responses. <code>&amp;&amp;&amp;</code> is great, and I can describe what it does in words, but I&#39;m <a href=\"http://stackoverflow.com/q/32550132/656912\">mystified by how its type signature matches that</a>!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1441998570, "last_edit_date": 1495542121, "creation_date": 1441998006, "answer_id": 32530417, "question_id": 32529297, "link": "https://stackoverflow.com/questions/32529297/haskell-idiom-for-setting-up-a-collection-of-indexed-structured-values/32530417#32530417", "title": "Haskell idiom for setting up a collection of indexed structured values", "body": "<p>Your <code>Map</code>-based solution looks fine to me. Two minor adjustments: firstly, you should do a qualified import of <code>Data.Map</code>, to avoid name clashes:</p>\n\n<pre><code>import qualified Data.Map as M\nimport Data.Map (Map)\n</code></pre>\n\n<p>The second <code>import</code> is there just for extra convenience. With it, you don't need to write <code>M.Map</code> in the type signatures.</p>\n\n<p>Secondly, <code>isNothing</code> and <code>isJust</code> are not very idiomatic. It is clearer to use <code>maybe</code>, <code>fromMaybe</code> or to simply pattern match on the <code>Maybe</code> value. As a bonus, if you do so you don't need to use <code>fromJust</code> (which is avoided whenever possible because it is partial).</p>\n\n<pre><code>component :: Name -&gt; Component\ncomponent n = fromMaybe\n    (Component n (someFunctionOf n) (someOtherFunctionOf n))\n    (M.lookup n components)\n</code></pre>\n\n<blockquote>\n  <p>but feels awkward, since it introduces an intermediate value (the <code>Map</code> <code>components</code>)</p>\n</blockquote>\n\n<p>I know <a href=\"https://stackoverflow.com/questions/32317206/exchanging-multiple-pairs-of-characters-in-a-haskell-string\">we couldn't persuade you last time around</a>, but there really is nothing wrong with introducing intermediate values. Doing so can make code easier to understand, by making it clearer what each of the parts are doing, and to reuse. If you won't need the <code>components</code> map anywhere else (as is likely the case) and don't want to make a top level definition for it, just put it in a <code>where</code> clause.</p>\n\n<blockquote>\n  <p>and duplicates the name there</p>\n</blockquote>\n\n<p>That is an annoyance, though a relatively small one. If the users of your code do not have access to the <code>components</code> dictionary, they cannot introduce mistakes by changing the name under which a component is stored; only you can do so. Still, if you want to minimise the number of places at which you can introduce mistakes (which is a legitimate goal in itself), you can change the type of <code>components</code> to...</p>\n\n<pre><code>components :: Map Name ComponentData\n</code></pre>\n\n<p>... in which <code>ComponentData</code> is your original, name-less, definition of <code>Component</code>. The <code>component</code> function, which is the one users will actually see, can retain its current type: just introduce something like...</p>\n\n<pre><code>giveNameToComponent :: Name -&gt; ComponentData -&gt; Component\n</code></pre>\n\n<p>... and change its definition to...</p>\n\n<pre><code>component :: Name -&gt; Component\ncomponent n = fromMaybe\n    (Component n (someFunctionOf n) (someOtherFunctionOf n))\n    (giveNameToComponent n &lt;$&gt; M.lookup n components)\n</code></pre>\n\n<p>... or, equivalently but using <code>maybe</code>:</p>\n\n<pre><code>component :: Name -&gt; Component\ncomponent n = maybe\n    (Component n (someFunctionOf n) (someOtherFunctionOf n))\n    (giveNameToComponent n)\n    (M.lookup n components)\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 32530417, "answer_count": 1, "score": 1, "last_activity_date": 1441998570, "creation_date": 1441993530, "question_id": 32529297, "link": "https://stackoverflow.com/questions/32529297/haskell-idiom-for-setting-up-a-collection-of-indexed-structured-values", "title": "Haskell idiom for setting up a collection of indexed structured values", "body": "<p>I have a collection of about a dozen structured things of a type I've defined (say <code>Component</code>), each of which can be identified by a \"name\", and am struggling to sort out an idiomatic Haskell way of instantiating and retrieving them. These things are used frequently in my application, so conceptually they are a set of global constants or a table of constants, that ideally would be initialized and saved for fast retrieval. </p>\n\n<p>My current approach, which I'm uncomfortable with, just uses a function to \"compute\" each <code>Component</code> from its name. </p>\n\n<pre><code>data Component = Component {\n                    someData :: !String,\n                    otherData :: ![Int] \n                } deriving Show\n\ncomponent :: Name -&gt; Component\ncomponent n = case n of\n    -- about a dozen in the application\n    \"1\"       -&gt; Component \"lasdkfj;alksdjfalkf\" [1]\n    \"Q\"       -&gt; Component \"nvjufhhqwe\" [5,10,11]\n    \"other\"   -&gt; Component \"ugugugu\" []\n    \"A\"       -&gt; Component \"alkkjsfkjaleifuhqiweufjc\" []\n    \"B\"       -&gt; Component \"randomletters\" []\n    \"C\"       -&gt; Component \"nothingimportant\" [9,10]\n    \"b\"       -&gt; Component \"uk\" []\n    \"c\"       -&gt; Component \"x\" [4,2,7,9,0]\n    \"\"        -&gt; Component \"ABC\" []\n    -- if not listed above, the Component is computed\n    otherwise -&gt; Component (someFunctionOf n) (someOtherFunctionOf n)\n</code></pre>\n\n<p>This doesn't feel right to me. For one thing, the <code>Component</code>'s name is really a part of the <code>Component</code>, but isn't included in the type. More importantly, even constant values get computed, when in fact they should just be initialized in some table.</p>\n\n<p>With this in mind I've also tried</p>\n\n<pre><code>type Name = String\n\nimport Data.Maybe\nimport Data.Map\n\ndata Component = Component {\n                    name :: Name,\n                    someDate :: String,\n                    otherData :: [Int] \n                } deriving Show\n\ncomponents = fromList $ (\\c -&gt; (name c, c)) &lt;$&gt; [\n    Component \"1\" \"lasdkfj;alksdjfalkf\" [1],\n    Component \"Q\" \"nvjufhhqwe\" [5,10,11],\n    Component \"other\" \"ugugugu\" [],\n    Component \"A\" \"alkkjsfkjaleifuhqiweufjc\" [],\n    Component \"B\" \"randomletters\" [],\n    Component \"C\" \"nothingimportant\" [9,10],\n    Component \"b\" \"uk\" [],\n    Component \"c\" \"x\" [4,2,7,9,0],\n    Component \"\" \"ABC\" []\n    ]\n\ncomponent :: Name -&gt; Component\ncomponent n | isNothing c = Component n (someFunctionOf n) (someOtherFunctionOf n) \n            | otherwise   = fromJust c  \n        where c = Data.Map.lookup n components\n</code></pre>\n\n<p>This has the advantage of clearly treating the \"constant\" values as constants, but feels awkward, since it introduces an intermediate value (the <code>Map</code> <code>components</code>) and duplicates the name there (in the <code>Component</code> and as the corresponding key).</p>\n\n<p>Anyway, I feel like I'm going about this all wrong, and that there must be a better way to set up an indexed set of structured values, that include a bunch of constants as well as computed ones.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1441987248, "post_id": 32527490, "comment_id": 52913177, "body": "What&#39;s the difference between your hypothetical 0-argument function and a value? How would calling that function be different from using a value?"}, {"owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1441987350, "post_id": 32527490, "comment_id": 52913235, "body": "@sepp2k The potentially expensive computation. I could make it lazy, e.g. delay it or omit it entirely if it is not needed."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 7, "creation_date": 1441987474, "post_id": 32527490, "comment_id": 52913294, "body": "Haskell is a lazy language. You don&#39;t need to make anything lazy. Everything&#39;s lazy by default unless you explicitly make it strict."}, {"owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1441987987, "post_id": 32527490, "comment_id": 52913624, "body": "I thought at least function application was eager!?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1441988315, "post_id": 32527490, "comment_id": 52913843, "body": "Nope, function application certainly is not eager. <code>const 5 undefined = 5</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1441990030, "post_id": 32527490, "comment_id": 52914793, "body": "Your <code>add2</code> is such a thunk: until you actually demand its value, <code>add2</code> will not be evaluated to <code>7</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1442184109, "post_id": 32527490, "comment_id": 52966463, "body": "Function application <b>is</b> the thing that the statement &quot;Haskell is a lazy language&quot; is talking about. What would be left to be lazy if function application were eager?"}, {"owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1442236858, "post_id": 32527490, "comment_id": 52986768, "body": "@Ben I thought it referred to evaluation of function arguments, meaning that the function code decides if and when an argument value is actually forced. But I thought the code would be run right away. (But maybe that wouldn&#39;t be &quot;lazy enough&quot; ..)"}], "answers": [{"comments": [{"owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "edited": false, "score": 0, "creation_date": 1441987862, "post_id": 32527646, "comment_id": 52913551, "body": "Ok, so GHCi betrayed me into believing that <code>add1 4</code> is immediatly evaluated to 7, and this would not be the case in a normal program run?!"}, {"owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "edited": false, "score": 0, "creation_date": 1441989190, "post_id": 32527646, "comment_id": 52914337, "body": "Ah, thanks, I suspected something like that after your initial answer, but wasn&#39;t sure. So I can assume that something like <code>add1 4</code> is carried around as an unevaluted expression (or so), until its value is actually required, right?!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "edited": false, "score": 2, "creation_date": 1441989420, "post_id": 32527646, "comment_id": 52914481, "body": "@ThomasH, yes. The thunk will only actually do anything interesting the first time it is forced; subsequent accesses will use the stored result."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "edited": false, "score": 0, "creation_date": 1442184477, "post_id": 32527646, "comment_id": 52966535, "body": "@ThomasH Showing things in ghci counts as requiring the value. Haskell promises to give you the same result regardless of when things actually end up being evaluated, so there&#39;s no way you can use normal Haskell code (even in ghci) to find out anything about when something is evaluated. That&#39;s why ghci supports non-Haskell commands like :print, so you can see what&#39;s going on under the hood."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 10, "last_activity_date": 1441989266, "last_edit_date": 1441989266, "creation_date": 1441987426, "answer_id": 32527646, "question_id": 32527490, "link": "https://stackoverflow.com/questions/32527490/is-there-a-fully-applied-curried-function-thunk-in-haskell/32527646#32527646", "title": "Is there a fully applied curried function thunk in Haskell?", "body": "<p>A function always takes an argument. That which does not take an argument is not a function. The only little trickery here is that some things <em>Haskell</em> considers values are, in System FC, functions. For instance <code>7</code> has type <code>Num a =&gt; a</code>, meaning that in Haskell it's a polymorphic number, but in System FC it's a function that takes a <code>Num a</code> dictionary and produces an <code>a</code>. So you kind of can have what you asked for.</p>\n\n<p>However, what you asked for does not seem to be what you want! The fact that a computation is expensive does not mean you should make it the result of a function</p>\n\n<pre><code>x = really expensive computation\n</code></pre>\n\n<p>doesn't actually calculate <code>x</code>. Only when you <em>inspect</em> the value of <code>x</code> (by pattern matching, or <code>seq</code>, or <code>evaluate</code>, etc.) does <code>x</code> get evaluated, and even then it is only evaluated as far as necessary.</p>\n\n<p>Comment:</p>\n\n<blockquote>\n  <p>Ok, so GHCi betrayed me into believing that add1 4 is immediatly evaluated to 7, and this would not be the case in a normal program run?!</p>\n</blockquote>\n\n<p>Nope! You typed <code>add1 4</code> at the GHCi prompt. GHCi therefore concluded that you wanted it to <code>print</code> that value. In order to <code>print</code> a number, all of the digits need to be calculated, and the number itself needs to be calculated first! If you want to peer under the hood, you can use GHCi's <code>:print</code> or <code>:sprint</code> commands, which let you inspect unevaluated or partially evaluated things.</p>\n\n<pre><code>Prelude&gt; let foo = (1+2, 3+4) :: (Int, Int)\nPrelude&gt; :print foo\nfoo = ((_t3::Int),(_t4::Int))\nPrelude&gt; fst foo\n3\nPrelude&gt; :print foo\nfoo = (3,(_t5::Int))\nPrelude&gt; snd foo\n7\nPrelude&gt; :print foo\nfoo = (3,7)\n</code></pre>\n\n<p>Note: delaying things lazily has potentially bad performance implications. GHC goes to great lengths in compiled code to figure out when it can make them strict instead without affecting the meaning of the program and without causing other performance problems. This compiler pass is called \"demand analysis\", and it's a particular form of \"strictness analysis\".</p>\n"}], "owner": {"reputation": 19080, "user_id": 127465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ca64f67167d37e7041e561104034bb2?s=128&d=identicon&r=PG", "display_name": "ThomasH", "link": "https://stackoverflow.com/users/127465/thomash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 32527646, "answer_count": 1, "score": 4, "last_activity_date": 1441989266, "creation_date": 1441986917, "question_id": 32527490, "link": "https://stackoverflow.com/questions/32527490/is-there-a-fully-applied-curried-function-thunk-in-haskell", "title": "Is there a fully applied curried function thunk in Haskell?", "body": "<p>Or put it another way:</p>\n\n<p>Can I apply all arguments to a curried function <strong>without evaluating it</strong>? So I would have a function value still, and not the result of the computation?</p>\n\n<p>Example:</p>\n\n<pre><code>add x y = x + y\nadd1 = add 3   {- add1 is a function -}\nadd2 = add1 4  {- add2 is 7, but I would like to have a function \n                  I can call with no arguments!? -}\n</code></pre>\n\n<p>The reason is to pass functions around that are fully bound and can be called in arbitrary situations and without the need to provide additional arguments.</p>\n\n<p>No tricks please (like providing a bogus last argument like 1 or True at the call site).</p>\n"}, {"tags": ["haskell", "memoization", "unsafe-perform-io"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1441983450, "post_id": 32525945, "comment_id": 52910761, "body": "Which memo library are you using? <a href=\"https://hackage.haskell.org/package/memoize\" rel=\"nofollow noreferrer\">memoize</a>?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1441983930, "post_id": 32525945, "comment_id": 52911114, "body": "Your data types are equivalent to <a href=\"https://hackage.haskell.org/package/transformers/docs/Control-Monad-Trans-Cont.html\" rel=\"nofollow noreferrer\"><code>Cont</code> and <code>ContT</code></a>. <code>type Cellular g a = Cont a g</code> and <code>type CellularT m g a = ContT a m g</code>"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1441987014, "post_id": 32527315, "comment_id": 52913041, "body": "<code>Cellular</code> and <code>CellularT</code> are a famous monad and monad transformer (<code>ContT</code>) if you flip the order of the <code>a</code> and <code>g</code> arguments. Just because something isn&#39;t a monad transformer doesn&#39;t mean it shouldn&#39;t be effectful; there are lots of things with <code>(* -&gt; *)</code> in their kind that might sit on top of a monad without themselves being monads."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1441986280, "last_edit_date": 1495539865, "creation_date": 1441986280, "answer_id": 32527315, "question_id": 32525945, "link": "https://stackoverflow.com/questions/32525945/memoizing-an-effectful-function/32527315#32527315", "title": "Memoizing an effectful function", "body": "<p>First, stop trying to use unsafePerformIO. Its got that name for a reason.</p>\n\n<p>What you are trying to do isn't memoisation, its actually controlling the calls to the inner monad. Part of the clue is that Cellular isn't a monad, so CellularT isn't a monad transformer.</p>\n\n<p>What I think you need to do is to have a pure function that computes the required effect per cell, and then iterate over the cells to sequence the effects. This separates your cellular autometon mechanics (which you already have, and which look good) from your effectful mechanics. At the moment you seem to be trying to execute the effects at the same time as you compute them, which is leading to your problems.</p>\n\n<p>It may be that your effects need to be split into an input phase and an output phase, or something like that. Or perhaps your effects are actually more like a state machine in which each iteration of each cell yields a result and expects a new input. In that case see <a href=\"https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell\">my question here</a> for some ideas about how to do this.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1441991751, "post_id": 32527436, "comment_id": 52915689, "body": "You might like <a href=\"http://hackage.haskell.org/package/universe-reverse-instances-1.0/docs/Data-Universe-Instances-Traversable.html#t:Traversable\" rel=\"nofollow noreferrer\"><code>sequenceA :: (Ord e, Finite e, Applicative f) =&gt; (e -&gt; f a) -&gt; f (e -&gt; a)</code></a>, though it doesn&#39;t populate its lookup table as &quot;lazily&quot; as yours does."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1442001365, "post_id": 32527436, "comment_id": 52920502, "body": "@DanielWagner Yep. The better answer, that I didn&#39;t have time to write this morning, is to add <code>Traversable</code> instances to <code>(:-&gt;:) a</code> for finite <code>a</code> in memo-trie."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1441988497, "last_edit_date": 1441988497, "creation_date": 1441986742, "answer_id": 32527436, "question_id": 32525945, "link": "https://stackoverflow.com/questions/32525945/memoizing-an-effectful-function/32527436#32527436", "title": "Memoizing an effectful function", "body": "<p>This can be achieved safely if you give yourself an opportunity to allocate the reference to hold the map.</p>\n\n<pre><code>import Control.Monad.IO.Class\n\nmemoM :: (Ord k, MonadIO m) =&gt; (k -&gt; m v) -&gt; m (k -&gt; m v)\n                 |                           |\n                 |        opportunity to allocate the map\n                 get to IO correctly\n</code></pre>\n\n<p>I'm going to use an <code>MVar</code> instead of an <code>IORef</code> to get most of concurrency correct. This is for correctness, In case it's used concurrently, not for performance. For performance we might be fancier than this and use double-check locks or a concurrent map with finer lock granularity.</p>\n\n<pre><code>import Control.Concurrent    \nimport Control.Monad.IO.Class    \nimport qualified Data.Map as Map\n\nmemoM :: (Ord k, Monad m, MonadIO m) =&gt; (k -&gt; m v) -&gt; m (k -&gt; m v)\nmemoM once = do \n    mapVar &lt;- liftIO $ newMVar Map.empty    \n    return (\\k -&gt; inMVar mapVar (lookupInsertM once k))\n\n-- like withMVar, but isn't exception safe   \ninMVar :: (MonadIO m) =&gt; MVar a -&gt; (a -&gt; m (a, b)) -&gt; m b\ninMVar mvar step = do\n    (a, b) &lt;- liftIO (takeMVar mvar) &gt;&gt;= step\n    liftIO $ putMVar mvar a\n    return b\n\nlookupInsertM :: (Ord k, Monad m) =&gt; (k -&gt; m v) -&gt; k -&gt; Map.Map k v -&gt; m (Map.Map k v, v)\nlookupInsertM once k map = \n    case Map.lookup k map of\n        Just v -&gt; return (map, v)\n        Nothing -&gt; do\n            v &lt;- once k\n            return (Map.insert k v map, v)\n</code></pre>\n\n<p>We aren't really using <code>IO</code>, we're just passing around state. Any monad should be able to do so with a transformer applied to it, so why are we mucking about in <code>IO</code>? It's because we want to be able to allocate those maps so that <code>memoM</code> can be used for more than one different function. If we only ever care about a single memoized effectful function, we can just use a state transformer instead.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Control.Applicative\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.State\n\nnewtype MemoT k v m a = MemoT {getMemoT :: StateT (k -&gt; m v, Map.Map k v) m a}\n    deriving (Functor, Applicative, Monad, MonadIO)\n\ninstance MonadTrans (MemoT k v) where\n    lift = MemoT . lift\n</code></pre>\n\n<p>This transformer adds the ability to lookup a value from the memoized effectful function</p>\n\n<pre><code>lookupMemoT :: (Ord k, Monad m) =&gt; k -&gt; MemoT k v m v\nlookupMemoT k = MemoT . StateT $ \\(once, map) -&gt; do\n                                                    (map', v) &lt;- lookupInsertM once k map\n                                                    return (v, (once, map'))\n</code></pre>\n\n<p>To run it and get at the underlying monad, we need to provide the effectful function we want to memoize.</p>\n\n<pre><code>runMemoT :: (Monad m) =&gt; MemoT k v m a -&gt; (k -&gt; m v) -&gt; m a\nrunMemoT memo once = evalStateT (getMemoT memo) (once, Map.empty)\n</code></pre>\n\n<p>Our <code>MemoT</code> uses a <code>Map</code> for every function. Some functions might be memoized some other way. The <a href=\"https://hackage.haskell.org/package/monad-memo\" rel=\"nofollow\">monad-memo</a> package has an <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow\">mtl</a>-style class for monads that provide memoization for a specific function, and a more elaborate mechanism for building them that doesn't necessarily use <code>Map</code>s.</p>\n"}], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1441988497, "creation_date": 1441982012, "question_id": 32525945, "link": "https://stackoverflow.com/questions/32525945/memoizing-an-effectful-function", "title": "Memoizing an effectful function", "body": "<p>I started working on a project defining a cellular automaton as a local transition function:</p>\n\n<pre><code>newtype Cellular g a = Cellular { delta :: (g -&gt; a) -&gt; a }\n</code></pre>\n\n<p>Whenever <code>g</code> is a <code>Monoid</code>, it is possible to define a global transition by shifting the focus before applying the local transition. This gives us the following <code>step</code> function:</p>\n\n<pre><code>step :: Monoid g =&gt; Cellular g a -&gt; (g -&gt; a) -&gt; (g -&gt; a)\nstep cell init g = delta cell $ init . (g &lt;&gt;)\n</code></pre>\n\n<p>Now, we can simply run the automaton by using <code>iterate</code>. And we can save a lot (and I do mean a lot: it literally saves hours) of re-computations by <code>memo</code>izing each one of the steps:</p>\n\n<pre><code>run :: (Monoid g, Memoizable g) =&gt; Cellular g a -&gt; (g -&gt; a) -&gt; [g -&gt; a]\nrun cell = iterate (memo . step cell)\n</code></pre>\n\n<p>My problem is that I generalised <code>Cellular</code> to <code>CelluarT</code> so that I would be able to use side effects in the local rules (e.g. copying a random neighbour):</p>\n\n<pre><code>newtype CellularT m g a = Cellular { delta :: (g -&gt; m a) -&gt; m a }\n</code></pre>\n\n<p>However, I only want the effects to be run <em>once</em> so that if you ask a cell multiple times what its value is, the answers are all consistent. <code>memo</code> fails us here because it saves <em>the effectful computation</em> rather than its result.</p>\n\n<p>I don't expect this to be achievable without using unsafe features. I've tried to have a go at it using <code>unsafePerformIO</code>, an <code>IORef</code> and a <code>Map g a</code> to store the values already computed:</p>\n\n<pre><code>memoM :: (Ord k, Monad m) =&gt; (k -&gt; m v) -&gt; (k -&gt; m v)\nmemoM =\n  let ref = unsafePerformIO (newIORef empty) in\n  ref `seq` loopM ref\n\nloopM :: (Monad m, Ord k) =&gt; IORef (Map k v) -&gt; (k -&gt; m v) -&gt; (k -&gt; m v)\nloopM ref f k =\n  let m = unsafePerformIO (readIORef ref) in\n  case Map.lookup k m of\n    Just v  -&gt; return v\n    Nothing -&gt; do\n      v &lt;- f k\n      let upd = unsafePerformIO (writeIORef ref $ insert k v m)\n      upd `seq` return v\n</code></pre>\n\n<p>But it behaves in unpredictable ways: <code>memoM putStrLn</code> is correctly memoized whilst <code>memoM (\\ str -&gt; getLine)</code> keeps fetching lines despite the same argument being passed to it.</p>\n"}]