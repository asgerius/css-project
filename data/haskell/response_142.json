[{"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1506555502, "post_id": 46458758, "comment_id": 79872911, "body": "<code>getLine &gt;&gt;= readFile</code>"}, {"owner": {"reputation": 49, "user_id": 5514480, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bVPT0WDjKas/AAAAAAAAAAI/AAAAAAAAAIg/Jf_7zhPxmnQ/photo.jpg?sz=128", "display_name": "Luqman Malik", "link": "https://stackoverflow.com/users/5514480/luqman-malik"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1506555817, "post_id": 46458758, "comment_id": 79872966, "body": "Perfect! Thanks @AlexisKing"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1506569362, "last_edit_date": 1506569362, "creation_date": 1506567797, "answer_id": 46460295, "question_id": 46458758, "link": "https://stackoverflow.com/questions/46458758/haskell-is-there-a-getline-analog-that-passes-the-contents-of-a-file-path-fro/46460295#46460295", "title": "Haskell: Is there a &#39;getLine&#39; analog that passes the contents of a file path from user input to a variable?", "body": "<p>As observed in the comments, <code>getLine &gt;&gt;= readFile</code> does this and has type <code>IO String</code>. Here is a sample shell interaction.</p>\n\n<pre><code>$ cat &gt; file.txt\nHello from a file!\n$ ghci\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nghci&gt; contentsFromName = getLine &gt;&gt;= readFile\ncontentsFromName :: IO String\nghci &gt; contentsFromName\nfile.txt\n\"Hello from a file!\\n\"\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 5514480, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bVPT0WDjKas/AAAAAAAAAAI/AAAAAAAAAIg/Jf_7zhPxmnQ/photo.jpg?sz=128", "display_name": "Luqman Malik", "link": "https://stackoverflow.com/users/5514480/luqman-malik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1506569362, "creation_date": 1506555375, "question_id": 46458758, "link": "https://stackoverflow.com/questions/46458758/haskell-is-there-a-getline-analog-that-passes-the-contents-of-a-file-path-fro", "title": "Haskell: Is there a &#39;getLine&#39; analog that passes the contents of a file path from user input to a variable?", "body": "<p>Something like</p>\n\n<pre><code>&gt;&gt; l1 &lt;- getContents_fu\n(this line is user input) dir/file.txt\n&gt;&gt; putStrLn l1\nThese are the contents of 'file.txt'.\n</code></pre>\n\n<p>I suppose the type signature can be <strong>String</strong> so long as the returned string is the contents of file.txt.</p>\n"}, {"tags": ["haskell", "tree", "binary-tree", "nodes"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506543857, "post_id": 46456470, "comment_id": 79868885, "body": "<code>Node _ t1 t2 -&gt; treeSize t1 + 1 + treeSize t2</code>. And you really only need <code>Num b</code>, not <code>Integral b</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1506552996, "post_id": 46456470, "comment_id": 79872303, "body": "<code>Num b</code> is the most general type, but I think <code>Integral b</code> is an equally useful type, and more informative about what result values are actually possible."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506565209, "post_id": 46456470, "comment_id": 79875075, "body": "@Alec please make your comment an answer so OP can accept as the right answer."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 1, "creation_date": 1506566280, "post_id": 46456470, "comment_id": 79875332, "body": "@PieOhPah I made a community wiki answer. Feel free to edit it if you want."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1506566153, "creation_date": 1506566153, "answer_id": 46460087, "question_id": 46456470, "link": "https://stackoverflow.com/questions/46456470/how-to-calculate-number-of-nodes-in-binary-trees-in-haskell/46460087#46460087", "title": "How to calculate number of nodes in binary trees in haskell", "body": "<p>The last case just needs to be <code>Node _ t1 t2 -&gt; 1 + treeSize t1 + treeSize t2</code>. Also, the <code>Integral b</code> constraint gives you more than you need - <code>Num b</code> is enough in this case.</p>\n\n<pre><code>treeSize :: Num b =&gt; BinaryTree a -&gt; b\ntreeSize Null = 0\ntreeSize (Node _ t1 t2) = 1 + treeSize t1 + treeSize t2\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8520204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebc078920e7e5c815a4f9bb42dabb41f?s=128&d=identicon&r=PG&f=1", "display_name": "James Raquel", "link": "https://stackoverflow.com/users/8520204/james-raquel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1518172821, "creation_date": 1506543250, "last_edit_date": 1518172821, "question_id": 46456470, "link": "https://stackoverflow.com/questions/46456470/how-to-calculate-number-of-nodes-in-binary-trees-in-haskell", "title": "How to calculate number of nodes in binary trees in haskell", "body": "<p>So I came up with this code, not sure how to continue.</p>\n\n<pre><code>treeSize :: (Integral b) =&gt; BinaryTree a -&gt; b\ntreeSize tree = case tree of\n    Null -&gt; 0\n    Node _ t1 t2 -&gt; \n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1506540593, "creation_date": 1506540593, "answer_id": 46455831, "question_id": 46455462, "link": "https://stackoverflow.com/questions/46455462/ghci-infinite-loop-in-binary-search-tree/46455831#46455831", "title": "GHCI infinite loop in Binary Search Tree", "body": "<p>All this stuff about your tree is quite unrelated to the root cause here, which is that haskell's <code>=</code> is not an assignment operator, but a definition. Importantly, it permits recursion, allowing a value to refer to itself, for example <code>xs = 1 : xs</code> producing an infinite list of 1s.</p>\n\n<p>So you are not incrementally building up one tree via three insertions, but rather defining three unrelated trees, each self-referential and therefore circular. You would have the same problem if you simply wrote <code>x = x</code>.</p>\n\n<p>If you want to name steps in a computation, you must give each a different name, because you cannot modify existing bindings.</p>\n"}], "owner": {"reputation": 192, "user_id": 6682967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1440645009284375/picture?type=large", "display_name": "David Maseda Neira", "link": "https://stackoverflow.com/users/6682967/david-maseda-neira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "closed_date": 1506543489, "accepted_answer_id": 46455831, "answer_count": 1, "score": 1, "last_activity_date": 1506540593, "creation_date": 1506539162, "last_edit_date": 1506539644, "question_id": 46455462, "link": "https://stackoverflow.com/questions/46455462/ghci-infinite-loop-in-binary-search-tree", "closed_reason": "Duplicate", "title": "GHCI infinite loop in Binary Search Tree", "body": "<p>I have this implementation of a Binary Search Tree in Haskell</p>\n\n<pre><code>data BST = Nil | Node (BST) Int (BST) deriving Show\n\nemptyTree :: BST\nemptyTree = Nil\n\nisEmptyTree :: BST -&gt; Bool\nisEmptyTree Nil = True\nisEmptyTree _ = False\n\nleftChild :: BST -&gt; BST\nleftChild Nil = Nil\nleftChild (Node l k r) = l\n\nrightChild :: BST -&gt; BST\nrightChild Nil = Nil\nrightChild (Node l k r) = r\n\nroot :: BST -&gt; Int\nroot Nil = error \"Empty Tree\"\nroot (Node l k r) = k\n\ninsert_r :: BST -&gt; Int -&gt; BST\ninsert_r Nil k = Node Nil k Nil\ninsert_r n@(Node l x r) k\n    | k &lt; x = Node (insert_r l k) x r\n    | k &gt; x = Node l x (insert_r r k)\n    | otherwise = n\n</code></pre>\n\n<p>I'm trying to test it inserting some values into the tree. This is a sample testing sequence:</p>\n\n<pre><code>t = Nil\nt = insert_r t 2\nt = insert_r t 3\nt = insert_r t 1\n</code></pre>\n\n<p>When i try to run this in GHCi, at the moment of checking \"t\" value, i get an infinite loop.\nHowever, if I assign the result of every insertion to a new variable, as this:</p>\n\n<pre><code>v = insert_r t 2\nu = insert_r v 1\n</code></pre>\n\n<p>Checking the value of \"u\" works perfectly. Does this have to do with Haskell's lazy evaluation, or am i coding something wrong in the BST implementation?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1506536933, "post_id": 46454714, "comment_id": 79865172, "body": "This has nothing to do with laziness."}], "answers": [{"comments": [{"owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "edited": false, "score": 0, "creation_date": 1506539124, "post_id": 46454901, "comment_id": 79866362, "body": "thanks, I guess <code>ReaderT _ IO</code> will end up doing what I want as it does use the underlying <code>&gt;&gt;</code> , which then will have IO actions composed."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1506537175, "creation_date": 1506537175, "answer_id": 46454901, "question_id": 46454714, "link": "https://stackoverflow.com/questions/46454714/unexpected-behavior-using-reader-r-inside-io/46454901#46454901", "title": "Unexpected behavior using Reader `(-&gt; r)` inside IO?", "body": "<p>Being strict on the LHS wouldn't matter at all: merely looking at an IO action does not perform it. It has to be combined with another IO action (via <code>&gt;&gt;</code> or the like) and eventually end up as part of <code>main</code> (or an action given to GHCI).</p>\n\n<p>That is, as you already seem to realize, in the first case you have two <code>(Int -&gt; IO ())</code> values, which you combine using <code>(&gt;&gt;)</code> from the Reader monad, which results in returning only the second IO action. In the second case you have two <code>IO ()</code> actions, which you combine using <code>(&gt;&gt;)</code> from the IO monad. Of course this combines the two into a single action.</p>\n\n<p>This is simply a consequence of how IO actions are combined, namely, that you must combine them explicitly: it is not enough to merely compute them and then throw them away. What you are asking for is similar to asking two numbers which you compute in the Reader monad to be implicitly added together:</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int\nf x = (* x)\n\nfoo :: Int -&gt; Int\nfoo = do\n  f 3\n  f 5\n\nbar :: Int\nbar = foo 4\n</code></pre>\n\n<p>First you compute 4*3, which is of course 12, and then you throw it away and compute 4*5, which is of course 20, and therefore the value bar is 20. The 12 is thrown away because you explicitly said not to do anything with it: it would be an error to add them together and let bar=32, or multiply them and let bar=240, or any such thing. Likewise, it would be incorrect for the <code>IO ()</code> values inside your reader computation to be implicitly combined.</p>\n"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 46454901, "answer_count": 1, "score": 1, "last_activity_date": 1506537175, "creation_date": 1506536447, "question_id": 46454714, "link": "https://stackoverflow.com/questions/46454714/unexpected-behavior-using-reader-r-inside-io", "title": "Unexpected behavior using Reader `(-&gt; r)` inside IO?", "body": "<p>I decide to cleanup some of my code by using <code>Reader</code> instance <code>(-&gt;) r</code> to avoid passing some values constantly.</p>\n\n<p>After playing around a bit, I found the following difference in behavior:</p>\n\n<pre><code>let p x y = print (x,y)\n    f = ($ (1 :: Int))\n\nf $ do\n    p &lt;$&gt; (+ 2) &lt;*&gt; (+ 5)\n    p &lt;$&gt; (* 6) &lt;*&gt; (* 2)\n-- prints (6,2) but not (3,6)\n\ndo\n  f $ p &lt;$&gt; (+ 2) &lt;*&gt; (+ 5)\n  f $ p &lt;$&gt; (* 6) &lt;*&gt; (* 2)\n-- prints both (6,2) and (3,6)\n</code></pre>\n\n<p>After manually desugaring this and putting some type annotations:</p>\n\n<pre><code>let p x y = print (x,y)\n    f = ($ (1 :: Int))\nf $ ((&gt;&gt;) :: forall m a. m ~ (Int -&gt; a) =&gt; m -&gt; m -&gt; m)\n    (p &lt;$&gt; (+ 2) &lt;*&gt; (+ 5) :: Int -&gt; IO ())\n    (p &lt;$&gt; (* 6) &lt;*&gt; (* 2))\n\n((&gt;&gt;) :: forall m. m ~ IO () =&gt; m -&gt; m -&gt; m)\n  (f (p &lt;$&gt; (+ 2) &lt;*&gt; (+ 5) :: Int -&gt; IO ()))\n  (f (p &lt;$&gt; (* 6) &lt;*&gt; (* 2)))\n</code></pre>\n\n<p>Now I suspect the problem is that while <code>&gt;&gt;</code> for IO instance does do what I want, <code>&gt;&gt;</code> for <code>(-&gt; r)</code> is too lazy to look into its left hand side.</p>\n\n<p>So my question is, is there a way (perhaps a variant of <code>&gt;&gt;</code> strict on LHS?), to do things like this without running in to this laziness problem?</p>\n\n<p>Not sure <code>ReaderT</code> would help in this case, but I think that might end up making the code more complicated so I haven't tried that.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 7, "creation_date": 1506531960, "post_id": 46453487, "comment_id": 79862635, "body": "Which blogs? It&#39;s not built in to the language but I&#39;ve mainly seen it used for natural transformations."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1506536839, "post_id": 46453487, "comment_id": 79865123, "body": "Your question is misleading. The Hayoo results show <code>:~&gt;</code> defined as a type, not a normal operator."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1506537369, "post_id": 46453487, "comment_id": 79865428, "body": "There is no &quot;canonical&quot; usage. It is a valid identifier for a type constructor that anyone can use, so it could be used for anything. The blog post should make it clear through context where the operator comes from and what it does."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1506544966, "creation_date": 1506544966, "answer_id": 46456902, "question_id": 46453487, "link": "https://stackoverflow.com/questions/46453487/is-the-identifier-in-haskell-proper/46456902#46456902", "title": "Is the `:~&gt;` Identifier in Haskell &quot;Proper&quot;?", "body": "<p>No, it is not part of the language core. If it exists at all, it is defined by user code, not the compiler or any of the libraries required by the standard. It is also not included in any of the libraries that ship with the major extant implementation, GHC.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 46456902, "answer_count": 1, "score": 0, "last_activity_date": 1506546547, "creation_date": 1506531816, "last_edit_date": 1506546547, "question_id": 46453487, "link": "https://stackoverflow.com/questions/46453487/is-the-identifier-in-haskell-proper", "title": "Is the `:~&gt;` Identifier in Haskell &quot;Proper&quot;?", "body": "<p>I've seen this operator used on Haskell blogs, but cannot find its source in Hoogle. Is the <code>:~&gt;</code> operator a part of the language core? If so, what does it denote?</p>\n\n<p><strong>EDIT:</strong> It does appear to show up in a <a href=\"https://hayoo.fh-wedel.de/?query=%3A~%3E\" rel=\"nofollow noreferrer\">Hayoo search</a>, but which one denotes the canonical usage?</p>\n"}, {"tags": ["haskell", "polymorphism", "type-kinds"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506532005, "post_id": 46453439, "comment_id": 79862660, "body": "Here is a contrived example: <code>data IntContainer f = IC (f Int)</code>. Then, I can have values like <code>IC [1,2,3]</code> or <code>IC (Data.Set.fromList [1,2,3])</code>. Note that <code>IntContainer :: (* -&gt; *) -&gt; *</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506532771, "post_id": 46453439, "comment_id": 79863051, "body": "That you pass it a higher-kinded type as first type parameter"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1506539077, "post_id": 46453439, "comment_id": 79866334, "body": "@WillemVanOnsem: <code>* -&gt; *</code> isn\u2019t a higher-kinded type. <code>(* -&gt; *) -&gt; *</code> is\u2014just as a higher-order function takes a function as a parameter, a higher-kinded type takes a type constructor as a parameter."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1506540786, "post_id": 46454244, "comment_id": 79867292, "body": "Higher kinded types that take type constructors as parameters. It is obvious to me now. In my defense I can only say that kind annotations such as <code>(* -&gt; *) -&gt; *</code> have a fairly high level of abstraction. Thank you!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1506534725, "creation_date": 1506534725, "answer_id": 46454244, "question_id": 46453439, "link": "https://stackoverflow.com/questions/46453439/what-do-parentheses-at-the-kind-level-mean/46454244#46454244", "title": "What do parentheses at the kind level mean?", "body": "<p><code>? :: (* -&gt; *) -&gt; *</code> means that if you give to <code>?</code> something of kind <code>* -&gt; *</code>, you'll get back a type (something of kind <code>*</code>). Let's take a concrete example:</p>\n\n<pre><code>newtype IntContainer f = IC { getContainer :: f Int }\n</code></pre>\n\n<p>This is meant to contain <code>Int</code>s. I can make <code>IntContainer</code>s with lists, or sets, or anything I want (of kind <code>* -&gt; *</code>) as the underlying data structure. The thing is that <code>f</code> isn't a type here - it needs to have another type applied to it before it is a type. So: <code>IntContainer</code> needs to have something applied to it, which in turn needs a type applied to it.</p>\n\n<pre><code>ghci&gt; :kind IntContainer\nIntContainer :: (* -&gt; *) -&gt; *\n</code></pre>\n\n<p>I can make concrete types by applying things of kind <code>* -&gt; *</code> to <code>IntContainer</code>:</p>\n\n<pre><code>ghci&gt; ic1 = IC [1,2,3]\nic1 :: IntContainer []                           -- [] :: * -&gt; *\nghci&gt; ic2 = IC (Data.Set.fromList [1,2,3])\nic2 :: IntContainer Set                          -- Set :: * -&gt; *\nghci&gt; ic3 = IC (Data.Sequence.fromList [1,2,3])\nic3 :: IntContainer Seq                          -- Seq :: * -&gt; *\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 46454244, "answer_count": 1, "score": 2, "last_activity_date": 1506534725, "creation_date": 1506531659, "question_id": 46453439, "link": "https://stackoverflow.com/questions/46453439/what-do-parentheses-at-the-kind-level-mean", "title": "What do parentheses at the kind level mean?", "body": "<p>I understand the following kinds:</p>\n\n<pre><code>String :: *\n[] :: * -&gt; *\n(-&gt;) :: * -&gt; * -&gt; *\n(,) :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>But what does this kind mean and what type might it represent?</p>\n\n<pre><code>? :: (* -&gt; *) -&gt; *\n</code></pre>\n"}, {"tags": ["haskell", "haddock"], "comments": [{"owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "edited": false, "score": 3, "creation_date": 1506541298, "post_id": 46452424, "comment_id": 79867564, "body": "<a href=\"http://trac.haskell.org/haddock/ticket/225\" rel=\"nofollow noreferrer\">trac.haskell.org/haddock/ticket/225</a>"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "edited": false, "score": 0, "creation_date": 1506590008, "post_id": 46452424, "comment_id": 79885528, "body": "I&#39;ll follow that ticket then. Thanks!"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "edited": false, "score": 1, "creation_date": 1506591451, "post_id": 46452424, "comment_id": 79886506, "body": "The bug above seems to be updated, a more recent version can be found here: <a href=\"https://github.com/haskell/haddock/issues/584\" rel=\"nofollow noreferrer\">github.com/haskell/haddock/issues/584</a>, and here <a href=\"https://github.com/haskell/haddock/issues/563\" rel=\"nofollow noreferrer\">github.com/haskell/haddock/issues/563</a>."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1506528164, "creation_date": 1506528164, "question_id": 46452424, "link": "https://stackoverflow.com/questions/46452424/haddock-generating-documentation-for-multiple-re-exported-modules-through-the-s", "title": "Haddock: generating documentation for multiple re-exported modules through the same identifier", "body": "<p>Is it possible to have haddock generating documentation for modules that are re-exported with an aliased identifier?</p>\n\n<p>I have the following two modules:</p>\n\n<p>Module <code>A</code>:</p>\n\n<pre><code>module A where\n\ndata A = A\n</code></pre>\n\n<p>Module <code>B</code>:</p>\n\n<pre><code>module B where\n\ndata B = B\n</code></pre>\n\n<p>Then if I re-export the <code>A</code> and <code>B</code> through a third module <code>Lib</code> as follows:</p>\n\n<pre><code>module Lib\n    ( someFunc\n    , module A\n    , module B\n    ) where\n\nimport           A\nimport           B\n</code></pre>\n\n<p>Haddock generates documentation for <code>A</code> and <code>B</code>. However, if I change the code of <code>Lib</code> to this:</p>\n\n<pre><code>module Lib\n    ( someFunc\n    , module X\n    ) where\n\nimport           A as X\nimport           B as X\n</code></pre>\n\n<p>While causes <code>Lib</code> to export the definitions of <code>A</code> and <code>B</code>, haddock will complain about it not being able to find the documentation for <code>X</code>:</p>\n\n<pre><code>Warning: Lib: Could not find documentation for exported module: X\n</code></pre>\n\n<p>Is there a way to generate documentation for <code>A</code> and <code>B</code> with an alias?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1506523281, "post_id": 46450569, "comment_id": 79857194, "body": "Can you show the C equivalent? Does it also allocate list elements one by one, or does it pre-allocate them all as an array?"}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1506524392, "post_id": 46450569, "comment_id": 79857978, "body": "Did you profile and determine that <code>Data.List.iterate</code> is slower than what you&#39;ve written here? I think the strictness of <code>pcg32_random_r</code> is enough to avoid accumulating thunks and the Prelude version of <code>iterate</code> uses foldr/build fusion which may be optimized better by GHC"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1506527203, "post_id": 46450569, "comment_id": 79859891, "body": "@cdk the problem with <code>iterate</code> is that the strictness of the function passed to it is irrelevant. It always builds up thunks if you discard elements of the result unevaluated.  That limits its suitability to cases where you evaluate most elements of the portion of its result that you consider."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1506528226, "post_id": 46450569, "comment_id": 79860559, "body": "@Carl user luqui once showed on SO how to overcome this by writing a map as a fold, using the seq to tie the mapping with the (:) node creation, so that access itself automatically forces the evaluation progressively. What&#39;s left is to write iterate as a map, <code>iter f x = ys where ys = {- x : map f ys = -} x : foldr ((:) . (f $!)) undefined ys</code>. Seem to work, when tested with <code>xs = iter (1:) [0 :: Int]</code> and then <code>head (xs !! 3)</code> and then <code>:sprint xs</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506546539, "post_id": 46450569, "comment_id": 79870130, "body": "@WillNess Sure, you can write a different function that is stricter than <code>iterate</code>. But there&#39;s nothing you can pass to <code>iterate</code> that prevents it from building up thunks if you discard some sequence values it produces."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1506550920, "post_id": 46450569, "comment_id": 79871736, "body": "@Carl I tested it, and with my <code>iter</code> function it was only 1.5x faster than with <code>iterate</code>, but when using OP&#39;s <code>iterate&#39;</code> it was 17 times faster!"}], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 3, "creation_date": 1506526892, "post_id": 46451655, "comment_id": 79859683, "body": "This compares favorably with a straightforward C solution (i.e., <code>state = state * ... + (i | 1)</code> in a loop, and compiled with <code>gcc -O2</code>) -- both run in about 120 milliseconds on my laptop -- so this is probably about the best achievable performance."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1506527643, "post_id": 46451655, "comment_id": 79860169, "body": "@K.A.Buhr: well of course it is possible to probably find a few additional optimizations, but I guess the most important bottleneck is probably fixed :)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1506528873, "post_id": 46451655, "comment_id": 79860979, "body": "a tentative  rule of thumb is <a href=\"https://www.youtube.com/watch?v=o3c_pJ_CLJQ\" rel=\"nofollow noreferrer\"><i>&quot;if you name it, it will stay&quot;</i></a> (in memory that is). So maybe something as simple as writing <code>pcg32_rng n = iterate&#39; (pcg32_random_r 1) 0 !! (n - 1)</code> (and of course <i>not</i> defining <code>pcg32_rng_s</code>) would have the same effect? Would it interest you to test this hypothesis?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506529311, "post_id": 46451655, "comment_id": 79861225, "body": "@WillNess: it is <code>0.54s</code>. This is logical: if you &quot;unfold&quot; this list construction function, you will keep constructing list nodes. Which is where the time overhead comes from. The memory burden will be less. But packing and unpacking in list nodes is probably the reason of the time overhead."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506531490, "post_id": 46451655, "comment_id": 79862381, "body": "so it didn&#39;t work. huh. the cons cells creation and destruction could conceivably be avoided altogether by the compiler, in such a clear case."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506550762, "post_id": 46451655, "comment_id": 79871681, "body": "interesting whether it&#39;ll be faster with <code>pcg32_rng :: Int -&gt; Word64</code> implemented directly as a recursive function, instead of using the general <code>perform_n</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1506529653, "last_edit_date": 1506529653, "creation_date": 1506525756, "answer_id": 46451655, "question_id": 46450569, "link": "https://stackoverflow.com/questions/46450569/ghc-turning-iterate-into-a-tight-loop/46451655#46451655", "title": "GHC - turning iterate into a tight loop", "body": "<p>It looks to me that the issue is more that you <strong>produce a list</strong>, and <strong>obtain the <em>i</em>-th element</strong> from that list. As a result you are going to unfold that list function, and each time you construct a new element if you need to move further in the list.</p>\n\n<p>Instead of constructing such list (which will construct new nodes, and perform memory allocations, and consume a lot of memory). You can construct a function that will perform a given function <code>n</code> times:</p>\n\n<pre><code>perform_n :: (a -&gt; a) -&gt; Int -&gt; a -&gt; a\nperform_n !f = step\n    where step !n !x | n &lt;= 0 = x\n                     | otherwise = step (n-1) (f x)\n</code></pre>\n\n<p>So now we can perform a function <code>f</code> <code>n</code> times. We can thus rewrite it like:</p>\n\n<pre><code>pcg32_rng n = perform_n (pcg32_random_r 1) (n-1) 0\n</code></pre>\n\n<p>If I compile this with <code>ghc -O2 file.hs</code> (GHC 8.0.2) run this file with <code>time</code>, I get:</p>\n\n<pre><code>$ time ./file\n2264354473547460187\n0.14user 0.00system 0:00.14elapsed 99%CPU (0avgtext+0avgdata 3408maxresident)k\n0inputs+0outputs (0major+161minor)pagefaults 0swaps\n</code></pre>\n\n<p>the original file produces the following benchmarks:</p>\n\n<pre><code>$ time ./file2\n2264354473547460187\n0.54user 0.00system 0:00.55elapsed 99%CPU (0avgtext+0avgdata 3912maxresident)k\n0inputs+0outputs (0major+287minor)pagefaults 0swaps\n</code></pre>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>As <a href=\"https://stackoverflow.com/questions/46450569/ghc-turning-iterate-into-a-tight-loop/46451655#comment79860979_46451655\">@WillNess</a> says, if you do not name the list, at runtime the list will be garbage collected: if you process through a list, and do not keep a reference to the head of the list, then that head can be removed once we step over it.</p>\n\n<p>If we however construct a file like:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nimport System.Environment (getArgs)\nimport Data.Bits\nimport Data.Word\n\niterate' f !x = x : iterate' f (f x)\n\nmain = print $ pcg32_rng 100000000\n\npcg32_random_r :: Word64 -&gt; Word64 -&gt; Word64\npcg32_random_r !i !state = state * (6364136223846793005 :: Word64) + (i .|. 1)\n{-# INLINE pcg32_random_r #-}\n\npcg32_rng n = iterate' (pcg32_random_r 1) 0 !! (n - 1)\n</code></pre>\n\n<p>we obtain:</p>\n\n<pre><code>$ time ./speedtest3\n2264354473547460187\n0.54user 0.01system 0:00.56elapsed 99%CPU (0avgtext+0avgdata 3908maxresident)k\n0inputs+0outputs (0major+291minor)pagefaults 0swaps\n</code></pre>\n\n<p>although the memory burden can be reduced, there is little impact on time. The reason is probably that working with list elements creates <em>cons</em> objects. So we do a lot of packing and unpacking into lists. This also results in constructing a lot of objects (and memory allocations) which still produces overhead.</p>\n"}], "owner": {"reputation": 63, "user_id": 4436708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9cd5a3d454f2b2f2416267749b1210f?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane Mutz", "link": "https://stackoverflow.com/users/4436708/st%c3%a9phane-mutz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 46451655, "answer_count": 1, "score": 4, "last_activity_date": 1506590443, "creation_date": 1506522737, "last_edit_date": 1506590443, "question_id": 46450569, "link": "https://stackoverflow.com/questions/46450569/ghc-turning-iterate-into-a-tight-loop", "title": "GHC - turning iterate into a tight loop", "body": "<p>I'm trying to learn/evaluate Haskell and I'm struggling with getting efficient executable for a simple case.\nThe test I'm using is a PRNG sequence (replicating PCG32 RNG). I've written it as an iteration of a basic state transition function (I'm looking only at the state for now).</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nimport System.Environment (getArgs)\nimport Data.Bits\nimport Data.Word\n\niterate' f !x = x : iterate' f (f x)\n\nmain = print $ pcg32_rng 100000000\n\npcg32_random_r :: Word64 -&gt; Word64 -&gt; Word64\npcg32_random_r !i !state = state * (6364136223846793005 :: Word64) + (i .|. 1)\n{-# INLINE pcg32_random_r #-}\n\npcg32_rng_s = iterate' (pcg32_random_r 1) 0\n\npcg32_rng n = pcg32_rng_s !! (n - 1)\n</code></pre>\n\n<p>I can get that code to compile and run. It still uses a lot more memory than it should and runs 10x slower than the C equivalent. The main issue seems to be that the iteration is not turned into a simple loop.</p>\n\n<p>What am I missing to get GHC to produce faster / more efficient code here?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>This is the C version I compare against which captures in essence what I'm trying to achieve. I try for a fair comparison but let me know if I missed something.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\nint main() {\n  uint64_t oldstate,state;\n  int i;\n\n  for(i=0;i&lt;100000000;i++) {\n    oldstate = state;\n    // Advance internal state\n    state = oldstate * 6364136223846793005ULL + (1|1);\n  }\n  printf(\"%ld\\n\",state);\n}\n</code></pre>\n\n<p>I tried initally with the Prelude <code>iterate</code> function but this result in lazy evaluation and a stack overflow. The \u00ecterate'`is aimed at fixing that issue.</p>\n\n<p>My next step was to try to get GHC to inline <code>pcg32_random_r</code>and that's where I added the strictness to it but that doesn't seem to be enough. When I look at the GHC core, it is not inlined.</p>\n\n<p>@WillemVanOnsem I confirm with <code>perform</code>the result is on par with C and actually the <code>pcg32_random_r</code>function was inlined. I'm reaching the limit of my grasp of Haskell and GHC at this stage. Can you elaborate on why <code>perform</code> performs better and how to decide when to use what?</p>\n\n<p>Would this transformation be feasible automatically by the compiler or is it something that requires a design decision?</p>\n\n<p>The reason to ask the last question is that I would like as much to separate functionality and implementation choice (speed / space tradeoffs, ...) to maximize reuse and I was hoping Haskell to help me there.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1506520143, "post_id": 46449364, "comment_id": 79854887, "body": "Because nothing is evaluated unless it absolutely has to in Haskell?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1506520243, "post_id": 46449364, "comment_id": 79854952, "body": "See <a href=\"https://stackoverflow.com/a/42602657/67579\">here</a>"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1506520714, "post_id": 46449364, "comment_id": 79855362, "body": "Why do you think it should get evaluated?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1506521132, "post_id": 46449364, "comment_id": 79855628, "body": "@augustss: I think the OP means that <code>x = 45</code> has not much to evaluate. But because <code>ghci</code> uses the <code>MonomorphismRestriction</code>, it does not pick a type for <code>x</code> (so no <code>Int</code>, <code>Integer</code>, etc.)"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506521663, "post_id": 46449364, "comment_id": 79856034, "body": "Let&#39;s consider the first example. When I write <code>*Main Lib&gt; myList ++ undefined</code> then it is an application and it gets evaluated. When I write <code>let myList&#39; = myList ++ undefined</code> is a lambda abstraction, that why it does not get evaluated, right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1506522390, "post_id": 46449364, "comment_id": 79856553, "body": "Because if you write <code>myList ++ undefined</code>, you have implicitly written <code>print (myList ++ undefined)</code>. So you force Haskell to generate textual output, and this requires some evaluation."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506523030, "post_id": 46449364, "comment_id": 79856998, "body": "and what about ` myList&#39;`?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1506523452, "post_id": 46449364, "comment_id": 79857313, "body": "a <code>let</code> statement is never evaluated eagerly. Only if it needs to be, like anything in Haskell."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506525692, "post_id": 46449364, "comment_id": 79858869, "body": "@WillemVanOnsem thanks for the link."}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1506525515, "answer_count": 0, "score": 0, "last_activity_date": 1506519446, "creation_date": 1506519446, "question_id": 46449364, "link": "https://stackoverflow.com/questions/46449364/why-does-not-get-evaluate", "closed_reason": "Duplicate", "title": "Why does not get evaluate?", "body": "<p>I have following code snippet:</p>\n\n<pre><code>*Main Lib&gt; let myList = [1, 2, id 1] :: [Integer]\n*Main Lib&gt; let myList' = myList ++ undefined\n*Main Lib&gt; :sprint myList'\nmyList' = _\n</code></pre>\n\n<p>Why does the <code>myList</code> does not get evaluated?</p>\n\n<p>And this too:</p>\n\n<pre><code>*Main Lib&gt; x = 45\n*Main Lib&gt; :sprint x\nx = _\n</code></pre>\n"}, {"tags": ["r", "haskell", "dll"], "answers": [{"comments": [{"owner": {"reputation": 51325, "user_id": 474349, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/ZMmIm.png?s=128&g=1", "display_name": "Hong Ooi", "link": "https://stackoverflow.com/users/474349/hong-ooi"}, "edited": false, "score": 0, "creation_date": 1506595743, "post_id": 46466455, "comment_id": 79889301, "body": "Not a Haskell user, but that seems like pretty crazy behaviour. This also looks related: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5987\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/5987</a>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 51325, "user_id": 474349, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/ZMmIm.png?s=128&g=1", "display_name": "Hong Ooi", "link": "https://stackoverflow.com/users/474349/hong-ooi"}, "edited": false, "score": 0, "creation_date": 1506596338, "post_id": 46466455, "comment_id": 79889698, "body": "Yes, that&#39;s strange. At the end, with <code>MyDef.def</code>, I have only two exported symbols and the DLL works. I&#39;m wondering why GHC exports &gt;65535 useless symbols."}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "edited": false, "score": 1, "creation_date": 1506846411, "post_id": 46466455, "comment_id": 79975168, "body": "It&#39;s not that strange if you think about it. The way function applications work in GHC means it requires an info table and a closure for each function it implements. which means, if you have a Haskell dll referencing another Haskell dll (such as when GHC and cabal use dynamic way) we need the info and closures to be available. Perhaps a flag to indicate that the dll won&#39;t be used as an import would be helpful, I&#39;ll add a note. What is a bug however is that we re-export functions imported from other packages. I&#39;ll look into fixing that for GHC 8.4."}], "tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1506594913, "last_edit_date": 1506594913, "creation_date": 1506593202, "answer_id": 46466455, "question_id": 46448892, "link": "https://stackoverflow.com/questions/46448892/cant-load-a-haskell-dll-on-windows/46466455#46466455", "title": "Can&#39;t load a Haskell dll on Windows", "body": "<p>I don't have a solution (<strong>edit: I have one, see below</strong>) but I can say this is due to the limit of number of exported symbols.</p>\n\n<p>When I compile the code </p>\n\n<pre><code>test :: IO (Maybe Worksheet)\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  let xlsx = toXlsx bs\n  let sheets = _xlSheets xlsx\n  let mapping = DM.fromList sheets\n  return $ DM.lookup \"List1\" mapping\n</code></pre>\n\n<p>and I inspect the DLL with <a href=\"http://dependencywalker.com/\" rel=\"nofollow noreferrer\">DependencyWalker</a>, I see there are 48318 exported symbols. That's acceptable.</p>\n\n<p>But for the other code:</p>\n\n<pre><code>test :: IO (Maybe Worksheet)\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  return $ toXlsx bs ^? ixSheet \"List1\" \n</code></pre>\n\n<p>the generated DLL reaches the maximal number of exported symbols: there are 65535=2^16-1 exported symbols. This DLL is \"truncated\".</p>\n\n<h1>Edit: A possible solution !</h1>\n\n<p>A possible solution consists in using a <code>def</code> file. In a file <code>MyDef.def</code>, list the functions you want to export, e.g. <code>funexport</code> and <code>HsStart</code>, like this:</p>\n\n<pre><code>EXPORTS\n funexport\n HsStart\n</code></pre>\n\n<p>and add <code>MyDef.def</code> at the end of the command line you use to compile:</p>\n\n<pre><code>ghc -shared foo.hs StartEnd.c -o foo.dll MyDef.def\n</code></pre>\n\n<p>I have just tested this solution and it works. However this is the first time I test it, so I would not guarantee yet. I'm also surprised that <code>ghc</code> does not automatically do that.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 46466455, "answer_count": 1, "score": 3, "last_activity_date": 1506594913, "creation_date": 1506518155, "last_edit_date": 1506520321, "question_id": 46448892, "link": "https://stackoverflow.com/questions/46448892/cant-load-a-haskell-dll-on-windows", "title": "Can&#39;t load a Haskell dll on Windows", "body": "<p>I often create some DLLs with Haskell that I load in R, and this works very well.</p>\n\n<p>But I have some code dealing with the <code>xlsx</code> library, I can compile it to a DLL without issue, but when I load the DLL in R, this totally crashes the R session. However this occurs on Windows only, there's no issue on Linux.</p>\n\n<p>I managed to find a minimal example and there's something weird. This is my minimal example:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule TestDLL where\nimport Codec.Xlsx\nimport Control.Lens\nimport qualified Data.ByteString.Lazy as L\nimport Foreign\nimport Foreign.C\nimport Foreign.C.String (peekCString, newCString)\n\ntest :: IO ()\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  let value = toXlsx bs ^? ixSheet \"List1\" .\n              ixCell (3,2) . cellValue . _Just\n  putStrLn $ \"Cell B3 contains \" ++ show value\n\n... some elementary functions here ...\n</code></pre>\n\n<p>If I compile this code to a DLL, loading this DLL in R crashes the R session on Windows. There's no such issue if I remove the <code>test</code> function. However the <code>test</code> function is not even exported (with <code>foreign export</code>) and it is not called by the other functions, isn't it weird ? If I don't export this function and if I don't use it, why the DLL deals with this function ?</p>\n\n<p>And more importantly, why the R session crashes when I load the DLL, and how to fix that ? </p>\n\n<h1>Edit</h1>\n\n<p>I have a more minimal example now. This works:</p>\n\n<pre><code>test :: IO Xlsx\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  return $ toXlsx bs \n</code></pre>\n\n<p>And this crashes:</p>\n\n<pre><code>test :: IO (Maybe Worksheet)\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  return $ toXlsx bs ^? ixSheet \"List1\"\n</code></pre>\n\n<p>It looks like Windows has a problem with <code>^?</code>.</p>\n\n<h1>Edit 2</h1>\n\n<p>No crash with this equivalent code:</p>\n\n<pre><code>test :: IO (Maybe Worksheet)\ntest = do\n  bs &lt;- L.readFile \"report.xlsx\"\n  let xlsx = toXlsx bs\n  let sheets = _xlSheets xlsx\n  let mapping = DM.fromList sheets\n  return $ DM.lookup \"List1\" mapping\n</code></pre>\n\n<p>Windows has a problem with <code>^? ixSheet</code>. Now let me try on my real example...</p>\n"}, {"tags": ["haskell", "compilation", "monads", "typechecking"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1506513149, "post_id": 46447006, "comment_id": 79849950, "body": "You need to collect all the error in a list, either by changing your Err type to store a list of strings, or by &quot;throwing&quot; a list or Err instead of just one."}, {"owner": {"reputation": 63, "user_id": 8682081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ulp9D.jpg?s=128&g=1", "display_name": "Goat16", "link": "https://stackoverflow.com/users/8682081/goat16"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1506514257, "post_id": 46447006, "comment_id": 79850685, "body": "I understand that but is not so simple. Using foldM the computation ends when it finds a Bad s and this doesn&#39;t change even if I use s as a list of strings. Maybe there&#39;s a way to store a error and then apply the function f defined in Bad s &gt;&gt;= f like in Ok a &gt;&gt;= f = f a?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1506516459, "post_id": 46447006, "comment_id": 79852106, "body": "your parser needs to not stop the computation but carry on an accumulate error. That&#39;s probably a bit tricky but doable."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1506536449, "post_id": 46447006, "comment_id": 79864918, "body": "You probably need something similar to a Writer Monad."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1506543381, "creation_date": 1506543381, "answer_id": 46456505, "question_id": 46447006, "link": "https://stackoverflow.com/questions/46447006/monadic-type-checker-in-haskell/46456505#46456505", "title": "Monadic type checker in Haskell", "body": "<p>As mostly covered in @mb14's comments, the usual method involves doing two things:</p>\n\n<ul>\n<li>First, instead of returning <em>either</em> a type-checked tree <em>or</em> an error, be prepared to <em>always</em> return a type-checked tree together with a log of zero or more errors.  This is easily accomplished with a <code>Writer</code> monad.</li>\n<li>Second, whenever an error is detected, log the error, try to recover by assuming <em>some</em> valid type for the node being type-checked, and continue the type check.</li>\n</ul>\n\n<p>In this simple scheme, the type checking always returns a typed tree.  If the log of error messages is empty, the type check has succeeded, and the typed tree is valid.  Otherwise, the type check has failed with the given set of errors, and the typed tree can be discarded.  In a more complex scheme, you could differentiate between warnings and errors in your log, and consider the type checking to have succeeded if it contains zero or more warnings, but no errors.</p>\n\n<p>I've included a complete example of the technique below for a very simplified grammar.  It only returns the top-level type instead of the typed tree, but this is just to keep the code simple -- returning a type-checked tree is not difficult.  The hard part in adapting it to your grammar will be determining how to forge ahead (i.e., what valid type to supply) when an error occurs, and it will be highly dependent on the details of your program.  Some general techniques are illustrated below:</p>\n\n<ul>\n<li>If a node always returns a particular type (e.g., <code>Len</code> below), always assume that type for the node, even if the node doesn't type-check.</li>\n<li>If a node combines compatible types to determine its result type (e.g, <code>Plus</code> below, or a BNF alternation), then when a type incompatibility is detected, take the type of the node to be determined by the type of its first argument.</li>\n</ul>\n\n<p>Anyway, here is the complete example:</p>\n\n<pre><code>import Control.Monad.Writer\n\n-- grammar annotated with node ids (\"line numbers\")\ntype ID = String\ndata Exp = Num  ID Double         -- numeric literal\n         | Str  ID String        -- string literal\n         | Len  ID Exp           -- length of a string expression\n         | Plus ID Exp Exp       -- sum of two numeric expressions\n                                 -- or concat of two strings\n-- expression types\ndata Type = NumT | StrT deriving (Show, Eq)\n\n-- Expressions:\n--    exp1 =    1 + len (\"abc\" + \"def\")\n--    exp2 =    \"abc\" + len (3 + \"def\")\n-- annotated with node ids\nexp1, exp2 :: Exp\nexp1 = Plus \"T1\" (Num \"T2\" 1)\n                 (Len \"T3\" (Plus \"T4\" (Str \"T5\" \"abc\")\n                                      (Str \"T6\" \"def\")))\nexp2 = Plus \"T1\" (Str \"T2\" \"abc\")\n                 (Len \"T3\" (Plus \"T4\" (Num \"T5\" 3)\n                                      (Str \"T6\" \"def\")))\n-- type check an expression\ndata Error = Error ID String deriving (Show)\ntype TC = Writer [Error]\n\ntypeCheck :: Exp -&gt; TC Type\ntypeCheck (Num _ _) = return NumT\ntypeCheck (Str _ _) = return StrT\ntypeCheck (Len i e) = do\n  t &lt;- typeCheck e\n  when (t /= StrT) $\n    tell [Error i (\"Len: applied to bad type \" ++ show t)]\n  return NumT  -- whether error or not, assume NumT\ntypeCheck (Plus i d e) = do\n  s &lt;- typeCheck d\n  t &lt;- typeCheck e\n  when (s /= t) $\n    tell [Error i (\"Plus: incompatible types \"\n                   ++ show s ++ \" and \" ++ show t\n                   ++ \", assuming \" ++ show s ++ \" result\")]\n  return s -- in case of error assume type of first arg\n\ncompile :: String -&gt; Exp -&gt; IO ()\ncompile progname e = do\n  putStrLn $ \"Running type check on \" ++ progname ++ \"...\"\n  let (t, errs) = runWriter (typeCheck e)\n  case errs of\n    [] -&gt; putStrLn (\"Success!  Program has type \" ++ show t)\n    _  -&gt; putStr (\"Errors:\\n\" ++ \n            unlines (map fmt errs) ++ \"Type check failed.\\n\")\n      where fmt (Error i s) = \"   in term \" ++ i ++ \", \" ++ s\n\nmain :: IO ()\nmain = do compile \"exp1\" exp1\n          compile \"exp2\" exp2\n</code></pre>\n\n<p>It generates the output:</p>\n\n<pre><code>Running type check on exp1...\nSuccess!  Program has type NumT\nRunning type check on exp2...\nErrors:\n   in term T4, Plus: incompatible types NumT and StrT, assuming NumT result\n   in term T3, Len: applied to bad type NumT\n   in term T1, Plus: incompatible types StrT and NumT, assuming StrT result\nType check failed.\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 8682081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ulp9D.jpg?s=128&g=1", "display_name": "Goat16", "link": "https://stackoverflow.com/users/8682081/goat16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 2, "accepted_answer_id": 46456505, "answer_count": 1, "score": 6, "last_activity_date": 1506543381, "creation_date": 1506512587, "last_edit_date": 1506519946, "question_id": 46447006, "link": "https://stackoverflow.com/questions/46447006/monadic-type-checker-in-haskell", "title": "Monadic type checker in Haskell", "body": "<p>I'm writing a parser and a type checker in Haskell starting from BNFC. The main function of the type checker is implemented as follows:</p>\n\n<pre><code>typecheck :: Program -&gt; Err ()\ntypecheck (PDefs ds) = do\n    env  &lt;- foldM (\\env  (DFun typ id args _ _) -&gt; \n               updateFun env id (argTypes args,typ) ) (emptyEnv) (ds)\n    mapM_ (checkDef env) ds \n    where argTypes = map (\\(ADecl _ typ _) -&gt; typ)\n</code></pre>\n\n<p>where <code>PDefs</code> ,<code>DFun</code>, and <code>ADecl</code> are constructrors of algebraic data types defined in the abstract syntax of the language and <code>checkDef</code> and <code>updateFun</code> are functions. <code>Program</code> is the \"starting point\" of the grammar. \nThe monad used  is the monad <code>Err</code>:</p>\n\n<pre><code>    data Err a = Ok a | Bad String\n       deriving (Read, Show, Eq, Ord)\n\n    instance Monad Err where\n       return      = Ok\n       fail        = Bad\n       Ok a  &gt;&gt;= f = f a\n       Bad s &gt;&gt;= f = Bad s \n</code></pre>\n\n<p>The <code>typechecker</code> function is called in the \"main\" module (where before the type check there are the lexical and the sintax analysis):</p>\n\n<pre><code>    check :: String -&gt; IO ()\n    check s = do\n               case pProgram (myLexer s) of\n                  Bad err -&gt; do\n                          putStrLn \"SYNTAX ERROR\"\n                          putStrLn err\n                          exitFailure\n                  Ok  tree -&gt; do \n                          case typecheck tree of\n                             Bad err -&gt; do\n                                 putStrLn \"TYPE ERROR\"\n                                 putStrLn err\n                                 exitFailure\n                             Ok _ -&gt; do\n                                 putStrLn \"\\nParsing e checking ok!\"\n                                 showTree tree\n</code></pre>\n\n<p>(<code>tree</code> is the abstract syntax tree build by the parser)</p>\n\n<p>If there's a type error in the program passed as input the type checker returns an error saying what is wrong and it doesn't continue. Is there a way to allow the type checker to list all the errors in the input in a single execution? </p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1508515569, "post_id": 46445237, "comment_id": 80653487, "body": "I now think that adding <code>takeWhile (not.null)</code> <i>is</i> the right and easiest solution here, and it <i>is</i> a perfectly sensible thing to wish for that the <code>concat . iterate (const [])</code> should in fact terminate (and be equivalent to <code>id</code> for lists)."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506516101, "post_id": 46445897, "comment_id": 79851845, "body": "here we know, because it is <i>we</i> that compute. on each step we consume what <i>we</i> have produced on the previous step. when the last expansion step added nothing, we stop. I&#39;ve added an answer with the working code."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506526097, "post_id": 46445897, "comment_id": 79859129, "body": "and yes the OP diagnosis was correct. have you missed the <code>if x&lt;1 then []</code> part? these are not integers, because <code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code>, thus <code>2**8 :: Floating a =&gt; a</code>, and so <code>2**8 &#47;5 &#47;5 &#47;5 &#47;5 = 0.4096</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506526297, "post_id": 46445897, "comment_id": 79859279, "body": "@WillNess Yes, I totally missed that. I don&#39;t know how I managed to do that, because I wasn&#39;t even in a particular hurry; I really have no excuse."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506526416, "post_id": 46445897, "comment_id": 79859362, "body": "I blame the (lack of) whitespace in <code>x&lt;1</code>. I once too wrote dense code, like OP. I now even add extraneous spaces often."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506526475, "post_id": 46445897, "comment_id": 79859385, "body": "@WillNess Thank you for keeping me honest. I considered deleting the answer, but then I thought that maybe the part about the Halting problem is marginally useful, so I ended up striking most of the other content."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1506526400, "last_edit_date": 1506526400, "creation_date": 1506509148, "answer_id": 46445897, "question_id": 46445237, "link": "https://stackoverflow.com/questions/46445237/haskell-self-referential-list-termination/46445897#46445897", "title": "Haskell self-referential List termination", "body": "<p><strike><code>bfsList</code> is defined recursively, which is not in itself a problem in Haskell. It does, however, produce an infinite list, which, again, isn't in itself a problem, because Haskell is lazily evaluated.</p>\n\n<p>As long as <code>find</code> eventually finds what it's looking for, it's not an issue that there's still an infinity of elements, because at that point evaluation stops (or, rather, moves on to do other things).</p>\n\n<p>AFAICT, the problem in the second case is that the predicate is never matched, so <code>bfsList</code> just keeps producing new elements, and <code>find</code> keeps on looking.</p>\n\n<blockquote>\n  <p>After all the terms have been expanded to [] concatMap will never return another item</p>\n</blockquote>\n\n<p>Are you sure that's the correct diagnosis? As far as I can tell, with the lambda expressions supplied above, each input element always expand to two new elements - never to <code>[]</code>. The list is, however, infinite, so if the predicate goes unmatched, the function will evaluate forever.</strike></p>\n\n<blockquote>\n  <p>Could Haskell be made smart enough to realize the list generation is blocked reading the self-reference and terminate the list?</p>\n</blockquote>\n\n<p>It'd be nice if there was a general-purpose algorithm to determine whether or not a computation would eventually complete. Alas, as both Turing and Church (independently of each other) proved in 1936, such an algorithm can't exist. This is also known as the Halting problem. I'm not a mathematician, though, so I may be wrong, but <em>I think</em> it applies here as well...</p>\n\n<p><strike></p>\n\n<blockquote>\n  <p>The best replacement I've been able to come up with isn't quite as elegant</p>\n</blockquote>\n\n<p>Not sure about that one... If I try to use it instead of the other definition of <code>bfsList</code>, it doesn't compile... Still, I don't think the problem is the empty list.</strike></p>\n"}, {"comments": [{"owner": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "edited": false, "score": 0, "creation_date": 1506622347, "post_id": 46447519, "comment_id": 79906538, "body": "Couldn&#39;t the language be made to do the &quot;counter increment&quot; steps for us in some cases? At the very least, GHC should be able to tell if a re-entrant read beyond the current end of the list will block forever, and throw an error. I edited my question to a much simpler example to illustrate the class of blocking list generators I am referring to and would be very interested in your thoughts."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "edited": false, "score": 0, "creation_date": 1506631247, "post_id": 46447519, "comment_id": 79911032, "body": "Hopefully when you post the new question it will attract some experts&#39; attention. :) I think GHCi sometimes <i>is</i> able to detect these kinds of situations, but I&#39;m not sure about the particulars."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1508514251, "last_edit_date": 1508514251, "creation_date": 1506514127, "answer_id": 46447519, "question_id": 46445237, "link": "https://stackoverflow.com/questions/46445237/haskell-self-referential-list-termination/46447519#46447519", "title": "Haskell self-referential List termination", "body": "<p>We produce the results list (queue) in steps. On each step we consume what we have produced on the previous step. When the last expansion step added nothing, we stop:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>bfs :: (a -&gt; Bool) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; Maybe a\nbfs predf expandf xs = find predf queue\n    where \n    queue = xs ++ gen (length xs) queue                 -- start the queue with `xs`, and\n    gen 0 _ = []                                        -- when nothing in queue, stop;\n    gen n q = let next = concatMap expandf (take n q)   -- take n elemts from queue,\n              in  next ++                               -- process, enqueue the results,\n                         gen (length next) (drop n q)   -- advance by `n` and continue\n</code></pre>\n\n<p>Thus we get</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>~&gt; bfs (==3) (\\x -&gt; if x&lt;1 then [] else [x/2, x/5]) [5, 3*2**8]\nJust 3.0\n\n~&gt; bfs (==3) (\\x -&gt; if x&lt;1 then [] else [x/2, x/5]) [5, 2**8]\nNothing\n</code></pre>\n\n<p>One potentially serious flow in this solution is that if any <code>expandf</code> step produces an infinite list of results, it will get stuck calculating its <code>length</code>, totally needlessly so.</p>\n\n<hr>\n\n<p>In general, just introduce a counter and increment it by the length of solutions produced at each expansion  step (<code>length . concatMap expandf</code> or something), decrementing by the amount that was consumed. When it reaches <code>0</code>, do not attempt to consume anything anymore because there's nothing to consume at that point, and you should instead terminate. </p>\n\n<p>This counter serves in effect as a pointer back into the queue being constructed. A value of <em><code>n</code></em> indicates that the place where the next result will be placed is <em><code>n</code></em> notches ahead of the place in the list from which the input is taken. <code>1</code> thus means that the next result is placed directly after the input value. </p>\n\n<p>The following code can be found in <a href=\"https://en.wikipedia.org/wiki/Corecursion#Discussion\" rel=\"nofollow noreferrer\">Wikipedia's article</a> about corecursion (search for \"corecursive queue\"):</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a b = Leaf a  |  Branch b (Tree a b) (Tree a b)\n\nbftrav :: Tree a b -&gt; [Tree a b]\nbftrav tree = queue\n  where\n    queue = tree : gen 1 queue                -- have one value in queue from the start\n\n    gen  0   _                 =         []           \n    gen len (Leaf   _     : s) =         gen (len-1) s   -- consumed one, produced none\n    gen len (Branch _ l r : s) = l : r : gen (len+1) s   -- consumed one, produced two\n</code></pre>\n\n<p>This technique is natural in Prolog with top-down list instantiation and logical variables which can be explicitly in a <em>not-yet-set</em> state. See also <a href=\"/questions/tagged/tailrecursion-modulo-cons\" class=\"post-tag\" title=\"show questions tagged &#39;tailrecursion-modulo-cons&#39;\" rel=\"tag\">tailrecursion-modulo-cons</a>.</p>\n\n<hr>\n\n<p><code>gen</code> in <code>bfs</code> can be re-written to be more incremental, which is usually a good thing to have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>    gen 0  _     = []\n    gen n (y:ys) = let next = expandf y\n                   in  next ++ gen (n - 1 + length next) ys\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "edited": false, "score": 0, "creation_date": 1506621993, "post_id": 46457910, "comment_id": 79906359, "body": "Thank you for your insights. I am intrigued by your alternatives, but have not quite reached far enough in my Haskell to grasp them, will have to revisit later. I would be very interested in what you think of my edited question, perhaps explaining why <code>list = 1 : tail list</code> needs to block forever would illuminate some aspect of Haskell I do not yet understand."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506631517, "post_id": 46457910, "comment_id": 79911157, "body": "<code>bfsList = concatMap (\\x -&gt; []) bfsList</code> is actually an excellent example for this, because with a <i>little</i> bit of human reasoning we can see that <code>concatMap (\\x -&gt; []) bfsList</code> will produce an empty list no matter what, and so <code>bfsList</code> <i>must</i> be <code>[]</code>. Of course this is not how <i>Haskell</i> works though."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "edited": false, "score": 0, "creation_date": 1506631821, "post_id": 46457910, "comment_id": 79911298, "body": "@Erik what you want is full equational reasoning <i>all the way down</i>. But that&#39;s not Haskell, unfortunately (or not, YMMV)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506632459, "post_id": 46457910, "comment_id": 79911631, "body": "I think <code>foo = case foo of [] -&gt; []</code> is not the same, because it is non-exhaustive. <code>foo = case foo of [] -&gt; []; (_:_) -&gt; []</code> would be the same."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506669461, "post_id": 46457910, "comment_id": 79921644, "body": "You miss one <code>xs</code> on the last line. Great use of <code>find p (a++b) = find p a &lt;|&gt; find p b</code> BTW, obviating the <code>++</code> and the <code>length</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1506691496, "post_id": 46457910, "comment_id": 79934029, "body": "Thanks, the missing <code>xs</code> is fixed."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "edited": false, "score": 0, "creation_date": 1508545166, "post_id": 46457910, "comment_id": 80665408, "body": "@Erik note that <code>foo = 1 : undefined</code> is just a valid solution to the equation <code>foo = 1 : tail foo</code> as <code>[1,1..]</code> or <code>[]</code>: <code>1 : undefined = 1 : tail (1 : undefined)</code>. Haskell chooses the former, because it&#39;s the <i>least defined</i> (as it contains <code>undefined</code>) (why we say &quot;<i>least</i> fixed point&quot;). If you use the time-travel metaphor, trying to force something in its own definition creates a paradox, punching a <code>_|_</code> shaped hole in your universe. For your function, it&#39;s equationally valid to have <code>undefined</code> sitting as the tail of your list, and it&#39;s chosen because it is less defined than <code>[]</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1506691479, "last_edit_date": 1506691479, "creation_date": 1506549771, "answer_id": 46457910, "question_id": 46445237, "link": "https://stackoverflow.com/questions/46445237/haskell-self-referential-list-termination/46457910#46457910", "title": "Haskell self-referential List termination", "body": "<p><em>Edited</em> to add a note to explain my <code>bfs'</code> solution below.</p>\n\n<p>The way your question is phrased (\"could Haskell be made smart enough\"), it sounds like you think the correct value for a computation like:</p>\n\n<pre><code>bfs (\\x -&gt; False) (\\x -&gt; []) []\n</code></pre>\n\n<p>given your original definition of <code>bfs</code> should be <code>Nothing</code>, and Haskell is just failing to find the correct answer.</p>\n\n<p>However, the <em>correct</em> value for the above computation is bottom.  Substituting the definition of <code>bfs</code> (and simplifying the <code>[] ++</code> expression), the above computation is equal to:</p>\n\n<pre><code>find (\\x -&gt; False) bfsList\n   where bfsList = concatMap (\\x -&gt; []) bfsList\n</code></pre>\n\n<p>Evaluating <code>find</code> requires determining if <code>bfsList</code> is empty or not, so it must be forced to weak head normal form.  This forcing requires evaluating the <code>concatMap</code> expression, which <em>also</em> must determine if <code>bfsList</code> is empty or not, forcing it to WHNF.  This forcing loop implies <code>bfsList</code> is bottom, and therefore so is <code>find</code>.</p>\n\n<p>Haskell <em>could</em> be smarter in detecting the loop and giving an error, but it would be incorrect to return <code>[]</code>.</p>\n\n<p>Ultimately, this is the same thing that happens with:</p>\n\n<pre><code>foo = case foo of [] -&gt; []\n</code></pre>\n\n<p>which also loops infinitely.  Haskell's semantics imply that this <code>case</code> construct must force <code>foo</code>, and forcing <code>foo</code> requires forcing <code>foo</code>, so the result is bottom.  It's true that if we considered this definition an equation, then substituting <code>foo = []</code> would \"satisfy\" it, but that's not how Haskell semantics work, for the same reason that:</p>\n\n<pre><code>bar = bar\n</code></pre>\n\n<p>does not have value <code>1</code> or <code>\"awesome\"</code>, even though these values satisfy it as an \"equation\".</p>\n\n<p>So, the answer to your question is, no, this behavior couldn't be changed so as to return an empty list without fundamentally changing Haskell semantics.</p>\n\n<p>Also, as an alternative that looks pretty slick -- even with its explicit termination condition -- maybe consider:</p>\n\n<pre><code>bfs' :: (a -&gt; Bool) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; Maybe a\nbfs' predf expandf = look\n  where look [] = Nothing\n        look xs = find predf xs &lt;|&gt; look (concatMap expandf xs)\n</code></pre>\n\n<p>This uses the <code>Alternative</code> instance for <code>Maybe</code>, which is really very straightforward:</p>\n\n<pre><code>Just x  &lt;|&gt; ...     -- yields `Just x`\nNothing &lt;|&gt; Just y  -- yields `Just y`\nNothing &lt;|&gt; Nothing -- yields `Nothing` (doesn't happen above)\n</code></pre>\n\n<p>so <code>look</code> checks the current set of values <code>xs</code> with <code>find</code>, and if it fails and returns <code>Nothing</code>, it recursively looks in their expansions.</p>\n\n<p>As a silly example that makes the termination condition look less explicit, here's its double-monad (Maybe in implicit Reader) version using <code>listToMaybe</code> as the terminator!  (Not recommended in real code.)</p>\n\n<pre><code>bfs'' :: (a -&gt; Bool) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; Maybe a\nbfs'' predf expandf = look\n  where look = listToMaybe *&gt;* find predf *|* (look . concatMap expandf)\n\n        (*&gt;*) = liftM2 (&gt;&gt;)\n        (*|*) = liftM2 (&lt;|&gt;)\n        infixl 1 *&gt;*\n        infixl 3 *|*\n</code></pre>\n\n<p>How does this work?  Well, it's a joke.  As a hint, the definition of <code>look</code> is the same as:</p>\n\n<pre><code>  where look xs = listToMaybe xs &gt;&gt; \n                  (find predf xs &lt;|&gt; look (concatMap expandf xs))\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 8682061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebba5ec82c3ed1cc88da2de62fbcf53f?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/8682061/erik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1508514251, "creation_date": 1506507223, "last_edit_date": 1506631936, "question_id": 46445237, "link": "https://stackoverflow.com/questions/46445237/haskell-self-referential-list-termination", "title": "Haskell self-referential List termination", "body": "<p><strong><em>EDIT:</strong> see <strong><a href=\"https://stackoverflow.com/questions/46478088/haskell-handling-deadlocked-self-referential-lists\">this followup question</a></strong> that simplifies the problem I am trying to identify here, and asks for input on a GHC modification proposal.</em></p>\n\n<p>So I was trying to write a generic breadth-first search function and came up with the following:</p>\n\n<pre><code>bfs :: (a -&gt; Bool) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; Maybe a\nbfs predf expandf xs = find predf bfsList\n    where bfsList = xs ++ concatMap expandf bfsList\n</code></pre>\n\n<p>which I thought was pretty elegant, however in the does-not-exist case it blocks forever. </p>\n\n<p>After all the terms have been expanded to <code>[]</code>, <code>concatMap</code> will never return another item, so <code>concatMap</code> is blocking waiting for another item from itself? Could Haskell be made smart enough to realize the list generation is blocked reading the self-reference and terminate the list?</p>\n\n<p>The best replacement I've been able to come up with isn't quite as elegant, since I have to handle the termination case myself:</p>\n\n<pre><code>    where bfsList = concat.takeWhile (not.null) $ iterate (concatMap expandf) xs\n</code></pre>\n\n<p>For concrete examples, the first search terminates with success, and the second one blocks:</p>\n\n<pre><code>bfs (==3) (\\x -&gt; if x&lt;1 then [] else [x/2, x/5]) [5, 3*2**8]\nbfs (==3) (\\x -&gt; if x&lt;1 then [] else [x/2, x/5]) [5, 2**8]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506506724, "post_id": 46445031, "comment_id": 79845782, "body": "What if the string has one character?"}, {"owner": {"reputation": 13, "user_id": 8681850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62260e8617d223fbedb8d5496fb1e82b?s=128&d=identicon&r=PG&f=1", "display_name": "batlord", "link": "https://stackoverflow.com/users/8681850/batlord"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506507676, "post_id": 46445031, "comment_id": 79846410, "body": "Thank you! You&#39;re right. I was thinking isAlpha b == False covered that one."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1506507819, "last_edit_date": 1506507819, "creation_date": 1506507508, "answer_id": 46445341, "question_id": 46445031, "link": "https://stackoverflow.com/questions/46445031/haskell-error-non-exhaustive-patterns/46445341#46445341", "title": "Haskell error: non-exhaustive patterns", "body": "<p>The problem is that you define two clauses:</p>\n\n<ul>\n<li><p>one with the empty list</p>\n\n<pre><code>cwords \"\" = 0\n</code></pre></li>\n<li><p>and one where the list contains <em>at least</em> two elements:</p>\n\n<pre><code>cwords (a:b:c) = ...\n</code></pre></li>\n</ul>\n\n<p>So the Haskell says that it does not know what to do in case the string contains exactly one character, since there is no clause that specifies what to do in that case.</p>\n\n<p>Since you count words, in case we obtain the last character, we should count this as a word (given it is an alpha-character). So the code should read:</p>\n\n<pre><code>cwords :: String -&gt; Int\ncwords \"\" = 0\ncwords (a:b:c)\n    |isAlpha a &amp;&amp; (isAlpha b == False) = 1 + cwords (b:c) \n    |otherwise = cwords (b:c)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>cwords :: String -&gt; Int\ncwords \"\" = 0\ncwords [_] | isAlpha a = 1\ncwords (a:b:c)\n    |isAlpha a &amp;&amp; (isAlpha b == False) = 1 + cwords (b:c)\n    | otherwise = cwords (b:c)\n</code></pre>\n\n<p>That being said, we can still improve the code:</p>\n\n<ul>\n<li>we can use <code>not (isAlpha b)</code> instead of <code>isAlpha b == False</code>;</li>\n<li>if we know <code>b</code> is not <code>isAlpha</code>, then we do not have to perform recursion on <code>(b:c)</code> here, but can directly perform recursion on <code>c</code>; and</li>\n<li>we can rewrite the <code>otherwise</code> case as a clause that handles lists with at least one element.</li>\n</ul>\n\n<p>Resulting into:</p>\n\n<pre><code>cwords :: String -&gt; Int\ncwords \"\" = 0\ncwords [a] | isAlpha a = 1\ncwords (a:b:c) |isAlpha a &amp;&amp; not (isAlpha b) = 1 + cwords c\ncwords (_:b) = cwords b\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8681850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62260e8617d223fbedb8d5496fb1e82b?s=128&d=identicon&r=PG&f=1", "display_name": "batlord", "link": "https://stackoverflow.com/users/8681850/batlord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 46445341, "answer_count": 1, "score": 1, "last_activity_date": 1506507819, "creation_date": 1506506659, "question_id": 46445031, "link": "https://stackoverflow.com/questions/46445031/haskell-error-non-exhaustive-patterns", "title": "Haskell error: non-exhaustive patterns", "body": "<p>I'm trying to write a function that will count the words in a sentence. </p>\n\n<pre><code>cwords :: String -&gt; Int\ncwords \"\" = 0\ncwords (a:b:c)\n    |isAlpha a &amp;&amp; (isAlpha b == False) = 1 + cwords (b:c) \n    |otherwise = cwords (b:c)\n</code></pre>\n\n<p>I keep getting an error saying \"non-exhaustive patterns in function cwords\" whenever I enter a sentence. An empty string works fine. (I'm very new to Haskell)</p>\n"}, {"tags": ["haskell", "protocol-buffers", "protobuf-3"], "answers": [{"tags": [], "owner": {"reputation": 1340, "user_id": 8372228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea211204c4d8ee5167b4e34ccb2328f3?s=128&d=identicon&r=PG", "display_name": "v1bri", "link": "https://stackoverflow.com/users/8372228/v1bri"}, "is_accepted": true, "score": 1, "last_activity_date": 1507215944, "creation_date": 1507215944, "answer_id": 46588963, "question_id": 46443201, "link": "https://stackoverflow.com/questions/46443201/using-protbuf3-how-can-i-express-the-type-map-string-maybe-customtype/46588963#46588963", "title": "Using protbuf3, how can I express the type &#39;Map string (Maybe CustomType)&#39;?", "body": "<p>Your language tag mentions haskell but I'm not sure which library implementation you're using to provide proto3 support, so I'll try to provide a generic answer.</p>\n\n<h2>Overview</h2>\n\n<p>The thread you pointed to suggests using <code>oneof</code> with a single field since it's possible to represent a <code>null</code> (really the absence of the field). Fortunately you don't need to create a <code>None</code> type for this purpose since it is built into the language-specific generated source files. Take a look at the <a href=\"https://developers.google.com/protocol-buffers/docs/proto#oneof\" rel=\"nofollow noreferrer\">Language Guide for oneof</a>...</p>\n\n<blockquote>\n  <p>You can check which value in a oneof is set (if any) using a special case() or WhichOneof() method, depending on your chosen language.</p>\n</blockquote>\n\n<p>The \"if any\" part is the magic you're looking for. The <a href=\"https://developers.google.com/protocol-buffers/docs/reference/cpp-generated#oneof\" rel=\"nofollow noreferrer\">generated C++ code</a> for a oneof definition will provide a special <code>oneof_name_case()</code> method that will tell you if one of the fields have been set...</p>\n\n<blockquote>\n  <p>OneofNameCase oneof_name_case() const: Returns the enum indicating which field is set. Returns ONEOF_NAME_NOT_SET if none of them is set.</p>\n</blockquote>\n\n<p>A similar method is <a href=\"https://developers.google.com/protocol-buffers/docs/reference/java-generated#oneof\" rel=\"nofollow noreferrer\">generated for Java code</a>: <code>getOneofNameCase()</code> returns <code>ONEOFNAME_NOT_SET</code> if none of the oneof fields are set.</p>\n\n<h2>Example</h2>\n\n<p>Starting from a test message...</p>\n\n<pre><code>message Test1 {\n    oneof single_field_oneof {\n        int32 some_int = 1;\n    }\n}\n</code></pre>\n\n<p>If you were using C++ you could use code similar to the following to handle the oneof field...</p>\n\n<pre><code>int main(int argc, char* argv[]) {\n    Test1 test;\n\n    // &lt;Populate message somehow&gt;\n\n    if (test.single_field_case() == Test1::kSomeInt) {\n        std::cout &lt;&lt; \"Field is set, value is \" &lt;&lt; test.some_int() &lt;&lt; std::endl;\n    } else {\n        assert(test.single_field_case() == Test1::SINGLE_FIELD_NOT_SET);\n        std::cout &lt;&lt; \"Field is not set\" &lt;&lt; std::endl;\n    }\n}\n</code></pre>\n\n<p>Anyway, as I mentioned I'm not familiar with the specific proto3 language bindings for Haskell, but the <code>oneof</code> feature should have similar functionality in the library that you're using.</p>\n"}], "owner": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 46588963, "answer_count": 1, "score": 4, "last_activity_date": 1507215944, "creation_date": 1506501588, "last_edit_date": 1506669741, "question_id": 46443201, "link": "https://stackoverflow.com/questions/46443201/using-protbuf3-how-can-i-express-the-type-map-string-maybe-customtype", "title": "Using protbuf3, how can I express the type &#39;Map string (Maybe CustomType)&#39;?", "body": "<p>I am trying to share a large dictionary/map between a client and a service. I need to be able to bidirectionally set values, and delete values from the dictionary/map without passing the entire map back and forth each time.</p>\n\n<p>I know I can create a map using:</p>\n\n<pre><code>map&lt;string, CustomType&gt; cells = 3;\n</code></pre>\n\n<p>(<a href=\"https://developers.google.com/protocol-buffers/docs/proto3#maps\" rel=\"nofollow noreferrer\">Docs for protobuf3 maps</a>)</p>\n\n<p>I see a sugestion to use <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#oneof\" rel=\"nofollow noreferrer\">oneof</a> here: \n<a href=\"https://github.com/google/protobuf/issues/1606\" rel=\"nofollow noreferrer\">https://github.com/google/protobuf/issues/1606</a></p>\n\n<p>However, the syntax suggested in that bug report doesn't make sense to me:</p>\n\n<pre><code>message Test1 {\n oneof a_oneof {\n  int32 a = 1;\n }\n}\n</code></pre>\n\n<p>How would I test for that? How would I store None?</p>\n\n<p>I would try to create something like:</p>\n\n<pre><code>message None{}\nmessage MaybeCustomType{\n oneof maybe{\n   CustomType just = 1;\n   None       none = 2;\n }\n}\n</code></pre>\n\n<p>But I'm not at all convinced that this is the elegant and correct solution.</p>\n\n<p>I also considered changing my schema entirely and doing.</p>\n\n<pre><code>map&lt;string, CustomType&gt; cells = 1;\nrepeated string deleted_cells = 2;\n</code></pre>\n\n<p>However I don't like that solution because it creates an undefined case. What happens if a cell named \"foo\" appears in both the \"cells\" map and the \"deleted_cells\" map? Furthermore, it abstracts the data away from the computation. I'd like to be able to pass a cell to a function which modifies and potentially decides to delete the cell, and so it seems natural to me that information about cell deletion be stored near the cell itself.</p>\n"}, {"tags": ["haskell", "methods"], "answers": [{"tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": false, "score": 2, "last_activity_date": 1506501138, "creation_date": 1506501138, "answer_id": 46443051, "question_id": 46442988, "link": "https://stackoverflow.com/questions/46442988/passing-data-in-haskell/46443051#46443051", "title": "Passing data in haskell", "body": "<p>Unlike in other languages, you do not call a Haskell function with a parameter list in parentheses.</p>\n\n<p>It should be just <code>c1 x y</code> -- or <code>(c1 x y)</code> if you need to embed it in a bigger expression.</p>\n\n<p><code>c1 (x y)</code> would have called <code>c1</code> on the result of <code>x</code> (a function itself!) being called with parameter <code>y</code>.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8681590"}, "edited": false, "score": 0, "creation_date": 1506502793, "post_id": 46443448, "comment_id": 79843066, "body": "That makes more sense now. Thank you :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1506502293, "creation_date": 1506502293, "answer_id": 46443448, "question_id": 46442988, "link": "https://stackoverflow.com/questions/46442988/passing-data-in-haskell/46443448#46443448", "title": "Passing data in haskell", "body": "<p>To elaborate on Thilo's answer: in Haskell, <code>f x y</code> is <em>not</em> parsed as something like <code>f (x y)</code>, instead it's actually parsed as <code>(f x) y</code>. That seems at first sight to make little sense, but actually it's perfectly reasonable \u2013 the technique is called <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">Currying</a>. Its advantage will become obvious when you're dealing with <em>higher-order functions</em>.</p>\n\n<p>Normally, you don't need to worry about this \u2013 just <em>never put parenthesis around function-argument listings</em>. Only put parentheses around <em>single</em> arguments, when they're expressions that need to be encapsulated.</p>\n\n<ul>\n<li><p>Don't:</p>\n\n<pre><code>sin (x)\n</code></pre>\n\n<p>(Though that's in principle perfectly legal.) Do:</p>\n\n<pre><code>sin x\n</code></pre></li>\n<li><p>Don't:</p>\n\n<pre><code>max (7 5)\n</code></pre>\n\n<p>which would be parsed as application of the function <code>7</code> to the argument <code>5</code>... clearly nonsense. Do:</p>\n\n<pre><code>max 7 5\n</code></pre></li>\n<li><p>Don't:</p>\n\n<pre><code>sin pi*x\n</code></pre>\n\n<p>which would be parsed as <code>(sin pi) * x</code>, aka <code>0</code>. Do:</p>\n\n<pre><code>sin (pi*x)\n</code></pre>\n\n<p>or, preferrably unless it requires putting extra parens around the entire thing,</p>\n\n<pre><code>sin $ pi*x\n</code></pre></li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8681590"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 46443448, "answer_count": 2, "score": -2, "last_activity_date": 1506502293, "creation_date": 1506500937, "last_edit_date": 1506501031, "question_id": 46442988, "link": "https://stackoverflow.com/questions/46442988/passing-data-in-haskell", "title": "Passing data in haskell", "body": "<p>My question is about passing data in Haskell. This is my code:</p>\n\n<pre><code>c1 x y = x^y\nc3 x y = let\n    z1 = c1(x y)\n    in (z1)\n</code></pre>\n\n<p>Does anyone know why this doesn't work?</p>\n\n<p>How would I pass data from one method to another?</p>\n"}, {"tags": ["haskell", "symbols"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 3, "creation_date": 1506500432, "post_id": 46442479, "comment_id": 79841636, "body": "If you got any typecheck errors, please include them. Understanding how to read those is very important in Haskell (and helps tracking down errors immensely)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1506501183, "post_id": 46442479, "comment_id": 79842056, "body": "Indeed. Also, it&#39;s an extremely good idea to add type signatures to all functions, that makes it easier to understand what you&#39;re doing and also usually causes type errors to come out way less cryptic."}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1506501031, "post_id": 46442645, "comment_id": 79841972, "body": "Yes you&#39;re right. I thought the <code>$</code> stopped at the <code>:</code>. I forget that it takes everything after it. This will be a good lesson for me."}], "tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": true, "score": 7, "last_activity_date": 1506500629, "last_edit_date": 1506500629, "creation_date": 1506499828, "answer_id": 46442645, "question_id": 46442479, "link": "https://stackoverflow.com/questions/46442479/haskell-the-use-of-symbol/46442645#46442645", "title": "Haskell :: The use of symbol $", "body": "<p>It is a question of operator precendence:</p>\n\n<ul>\n<li><p><code>cak' (x - 2) : cak' (xs)</code> is the same as <code>(cak' (x - 2)) : (cak' (xs))</code></p></li>\n<li><p><code>cak' $ (x - 2) : cak' (xs)</code> is the same as <code>cak' ( (x - 2) : cak' (xs) )</code></p></li>\n</ul>\n\n<p>You can read the <code>$</code> as \"use everything after the <code>$</code> as a <em>single</em> argument for the function before the <code>$</code>\". It kind of works like a set of parentheses that you don't have to close.</p>\n"}, {"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 1, "creation_date": 1506500823, "post_id": 46442747, "comment_id": 79841852, "body": "Now I get it. Before this I look at <code>cak&#39; $ x - 2 : cak&#39; xs</code> as the <code>$</code> stop before the <code>:</code>. However, it takes all the rest. My bad forgetting the concept."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1506500176, "creation_date": 1506500176, "answer_id": 46442747, "question_id": 46442479, "link": "https://stackoverflow.com/questions/46442479/haskell-the-use-of-symbol/46442747#46442747", "title": "Haskell :: The use of symbol $", "body": "<p>Function application (like <code>f x</code>, please don't write this as <code>f (x)</code> BTW) always binds more tightly than any infix operator (such as <code>:</code> and especially <code>$</code>). So <code>cak' (x - 2) : cak' xs</code> is in fact parsed as <code>(cak' (x - 2)) : cak' xs</code>, which doesn't typecheck (because <code>x - 2</code> is not a list).</p>\n\n<p>The <code>$</code> on the other hand binds <em>weaker</em> than all other standard infix operators, because</p>\n\n<pre><code>Prelude&gt; :i $\n($) :: (a -&gt; b) -&gt; a -&gt; b   -- Defined in \u2018GHC.Base\u2019\ninfixr 0 $\nPrelude&gt; :i :\n...\ninfixr 5 :\n</code></pre>\n\n<p>...i.e. <code>:</code> has fixity 5 but <code>$</code> only fixity 0. Therefore, <code>cak' $ (x - 2) : cak' xs</code> is parsed as the (presumably) right thing, namely <code>cak' ((x - 2) : cak' xs)</code>.</p>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 46442645, "answer_count": 2, "score": 1, "last_activity_date": 1506500629, "creation_date": 1506499263, "question_id": 46442479, "link": "https://stackoverflow.com/questions/46442479/haskell-the-use-of-symbol", "title": "Haskell :: The use of symbol $", "body": "<p>Here is my code:</p>\n\n<pre><code>    data = [1,2,3,4,5,6,7,8,9,10]\n    cak' [] = []\n    cak' (x:xs) =\n        if x &gt;= 2 then\n            cak' (x - 2) : cak' (xs)\n        else\n            x : cak' (xs)\n    run = cak' data\n</code></pre>\n\n<p>It will not work till I change the <code>cak' (x - 2) : cak' (xs)</code> to <code>cak' $ x - 2 : cak' (xs)</code>. Why it gives such an impact?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1506505112, "post_id": 46442336, "comment_id": 79844654, "body": "<code>k</code> can be an arbitrary kind, it is not limited to the valid Haskell type <code>*</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1506506654, "post_id": 46442336, "comment_id": 79845723, "body": "@ThreeFx  can I open a chat with you, because I am living in Z&#252;rich too."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1506506725, "post_id": 46442336, "comment_id": 79845784, "body": "Sure, do so, best include the link in the comments for further reference."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1506506901, "post_id": 46442336, "comment_id": 79845899, "body": "Can you please do it, I do not know how to."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506526823, "post_id": 46442336, "comment_id": 79859642, "body": "It means that we can have nonsense like <code>ReaderT () Any Monad :: *</code>.  When <code>PolyKinds</code> came out, I imagine people attempted to generalize signatures that could. This is one of those. There are probably some contrived use cases. <a href=\"https://hub.darcs.net/ross/transformers/issue/5\" rel=\"nofollow noreferrer\">Here</a> is the relevant issue."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1508082039, "creation_date": 1508082039, "answer_id": 46756839, "question_id": 46442336, "link": "https://stackoverflow.com/questions/46442336/what-does-k-mean/46756839#46756839", "title": "What does k -&gt; * mean?", "body": "<p>The fragment <code>(m :: k -&gt; *)</code> indicates that <code>m</code> is a type variable of <em>kind</em> <code>k -&gt; *</code>.  This, in turn, means that <code>m</code> is a higher-kinded type that takes a type (of <strong>unspecified</strong> kind <code>k</code>) and produces a concrete type (i.e., a type of kind <code>*</code>).</p>\n\n<p>All you're seeing here is GHC's attempt to infer the most general possible kind for a type (the same way it infers the most general possible type for a function).</p>\n\n<p>Here's the reason this kind is inferred:  The actual <em>definition</em> of <code>ReaderT</code> given in module <code>Control.Monad.Trans.Reader</code> in the <code>transformers</code> package is:</p>\n\n<pre><code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a }\n</code></pre>\n\n<p>The right-hand side implies that <code>r</code> and <code>m a</code> must both be concrete types (of kind <code>*</code>).  From this, it's possible to infer that <code>r</code> is of kind <code>*</code> and that <code>m</code> takes a single argument and produces a concrete type (so <code>m</code> is of kind <code>something -&gt; *</code>).  Since there is no constraint placed on the kind of <code>a</code> by this definition, GHC decides that it can have arbitrary kind <code>k</code>, implying that the kind of <code>m</code> is <code>k -&gt; *</code> for an arbitrary <code>k</code>.</p>\n\n<p>This explains both:</p>\n\n<pre><code>&gt; :i ReaderT\n...\nnewtype ReaderT r (m :: k -&gt; *) (a :: k)\n  = ReaderT {runReaderT :: r -&gt; m a}\n...\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>&gt; :k ReaderT\nReaderT ::    * -&gt; (k -&gt; *) -&gt; k -&gt; *\n-- kinds of:  r        m       a    `-- (ReaderT r m a)\n</code></pre>\n\n<p>Now, just because GHC infers such a general kind doesn't indicate that it has any use or purpose.  Since all monads are of kind <code>* -&gt; *</code>, the only way to create a <code>ReaderT</code> that didn't use an <code>a</code> of kind <code>*</code> would be to use it to \"transform\" an <code>m</code> that wasn't actually a monad, and then you wouldn't be able to use any of the functions in <code>Control.Monad.Reader</code> that use a <code>Monad m</code> constraint (which is almost all of them).  So, in this case, the generalization is useless.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1508082039, "creation_date": 1506498779, "last_edit_date": 1506499339, "question_id": 46442336, "link": "https://stackoverflow.com/questions/46442336/what-does-k-mean", "title": "What does k -&gt; * mean?", "body": "<p>In the prelude, the type information about <code>ReaderT</code> says:</p>\n\n<pre><code>newtype ReaderT r (m :: k -&gt; *) (a :: k)\n  = ReaderT {runReaderT :: r -&gt; m a}\n</code></pre>\n\n<p>What does <code>(m :: k -&gt; *)</code> it mean? <code>m</code> takes an argument of type <code>k</code>, but <code>m</code> is a higher kinded type.   </p>\n\n<p>Information about higher kinded looks also wired:  </p>\n\n<pre><code>Prelude&gt; :k ReaderT\nReaderT :: * -&gt; (k -&gt; *) -&gt; k -&gt; * \n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506449521, "post_id": 46433134, "comment_id": 79823679, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4629883/rigid-type-variable-error\">rigid type variable error</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1506457570, "post_id": 46433134, "comment_id": 79827645, "body": "Although the errors match, I hesitate to mark this as a duplicate; the explanation of the problem in the proposed dupe is just too different from the explanation of the problem here."}, {"owner": {"reputation": 37, "user_id": 8678276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7749277831353da6c548be887745c0d6?s=128&d=identicon&r=PG&f=1", "display_name": "jek339", "link": "https://stackoverflow.com/users/8678276/jek339"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506542975, "post_id": 46433134, "comment_id": 79868425, "body": "@DanielWagner yeah, I don\u2019t believe this is a duplicate as my question was about creating an adhoc polymorphic function. I provided the error to explain that I knew my code as written didn\u2019t work."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506484065, "post_id": 46433536, "comment_id": 79834726, "body": "Well, there are two ways, but I doubt either is appropriate here."}, {"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1506487547, "post_id": 46433536, "comment_id": 79835575, "body": "Note that the <code>showField</code> signature is different from the default one. It looks unfortunate that you need to explicitly instantiate <code>ShowField&#39;</code> for each type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1506492821, "post_id": 46433536, "comment_id": 79837437, "body": "@StefanHanke, well, you <i>could</i> use overlapping instances, or you <i>could</i> use a hand-cranked &quot;instance chain&quot; constructed using a closed type family. But I don&#39;t think these would likely be appropriate."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1506500428, "post_id": 46433536, "comment_id": 79841632, "body": "BTW the <code>where</code> on an empty instance declaration is optional"}, {"owner": {"reputation": 37, "user_id": 8678276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7749277831353da6c548be887745c0d6?s=128&d=identicon&r=PG&f=1", "display_name": "jek339", "link": "https://stackoverflow.com/users/8678276/jek339"}, "reply_to_user": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1506542849, "post_id": 46433536, "comment_id": 79868361, "body": "@StefanHanke this is what I ended up doing."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 11, "last_activity_date": 1506450946, "creation_date": 1506450946, "answer_id": 46433536, "question_id": 46433134, "link": "https://stackoverflow.com/questions/46433134/ad-hoc-polymorphic-functions/46433536#46433536", "title": "Ad hoc polymorphic functions", "body": "<p>It looks like you're trying to construct an adhoc polymorphic function - a function whose definition varies according to its type.</p>\n\n<p>A parametric polymorphic function does the same thing to all data types:</p>\n\n<pre><code>both :: a -&gt; (a,a)\nboth a = (a,a)\n</code></pre>\n\n<p>In Haskell, adhoc polymorphism is implemented using type classes:</p>\n\n<pre><code>class ShowField a where\n  showField :: a -&gt; Text\n\ninstance Show a =&gt; ShowField (Maybe a) where\n  showField Nothing = \"None\"\n  showField (Just a) = Text.pack $ show a\n</code></pre>\n\n<p>However there's no way to define an instance for \"all other types other than Maybe a\" with type classes, so you just have to define instances for the types you actually care about:</p>\n\n<pre><code>class ShowField Int where\n  showField = Text.pack . show\nclass ShowField Float where\n  showField = Text.pack . show\n</code></pre>\n\n<p>You can cut down on boilerplate by using <code>-XDefaultSignatures</code>:</p>\n\n<pre><code>class ShowField' a where\n  showField :: a -&gt; Text\n  default showField :: Show a =&gt; a -&gt; Text\n  showField = Text.pack . show\n\ninstance ShowField' Int where\ninstance ShowField' Float where\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1232, "user_id": 428877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/647e57e253aadeb22847cf6f1065dfd1?s=128&d=identicon&r=PG", "display_name": "Thedward", "link": "https://stackoverflow.com/users/428877/thedward"}, "is_accepted": false, "score": 1, "last_activity_date": 1506452374, "creation_date": 1506452374, "answer_id": 46433933, "question_id": 46433134, "link": "https://stackoverflow.com/questions/46433134/ad-hoc-polymorphic-functions/46433933#46433933", "title": "Ad hoc polymorphic functions", "body": "<p>The error tells us:</p>\n\n<pre><code>\u2018a\u2019 is a rigid type variable bound by\n  the type signature for:\n    showField :: forall a. Show a =&gt; a -&gt; Text\n</code></pre>\n\n<p>Basically, this tells us that according to the type signature you provided, the type of the first parameter is <code>forall a. Show a</code> (the '<code>forall a.</code>' bit is implied by the signature), which means that the first parameter can be any type that is an instance of <code>Show</code>. It is a <em>rigid</em> type variable because it is defined by an explicit type signature. </p>\n\n<p>It also tells us:</p>\n\n<pre><code>Couldn't match expected type \u2018Maybe a0\u2019 with actual type \u2018a\u2019\n</code></pre>\n\n<p>By  applying the functions <code>isJust</code> and <code>isNothing</code> \u2014 both of type <code>Maybe a -&gt; Bool</code> \u2014 to the first parameter you are also claiming the type of the first parameter is <code>Maybe a</code> which is obviously not the same type as <code>forall a. Show a =&gt; a -&gt; Text</code>.</p>\n\n<p>You can turn this into a correct program simply by removing the type signature for <code>showField</code>, but that won't have the behavior you desire \u2014 the inferred type signature will be <code>(Show a) =&gt; Maybe a -&gt; Text</code> which obviously only accepts values of <code>Maybe a</code> (where <code>a</code> is also an instance of <code>Show</code>).</p>\n\n<p>In Haskell, you can't have a function that accepts values of both <code>a</code> and <code>Maybe a</code>\u00b9. Without more context, it's unclear what your actual goal is, but there is almost certainly a more idiomatic way to achieve it.</p>\n\n<p>\u00b9 Unless you have a type class that has instances for both <code>a</code> and <code>Maybe a</code>.</p>\n"}], "owner": {"reputation": 37, "user_id": 8678276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7749277831353da6c548be887745c0d6?s=128&d=identicon&r=PG&f=1", "display_name": "jek339", "link": "https://stackoverflow.com/users/8678276/jek339"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 46433536, "answer_count": 2, "score": 2, "last_activity_date": 1506543031, "creation_date": 1506449380, "last_edit_date": 1506543031, "question_id": 46433134, "link": "https://stackoverflow.com/questions/46433134/ad-hoc-polymorphic-functions", "title": "Ad hoc polymorphic functions", "body": "<p>I have some data that I'd like to print (some is Maybe and some is not), and I'm trying to create a generic showField function as follows:</p>\n\n<pre><code>showField :: (Show a) =&gt; a -&gt; Text\nshowField x\n  | isJust x = Text.pack $ show $ fromJust x\n  | isNothing x = \"None\"\n  | otherwise = Text.pack $ show x\n</code></pre>\n\n<p>This is throwing a rigid type error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Maybe a0\u2019 with actual type \u2018a\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      showField :: forall a. Show a =&gt; a -&gt; Text\n    at /data/users/jkozyra/fbsource/fbcode/experimental/jkozyra/hs/holdout_cleanup/HoldoutReaper.hs:244:18\n\u2022 In the first argument of \u2018isNothing\u2019, namely \u2018x\u2019\n  In the expression: isNothing x\n  In a stmt of a pattern guard for\n                 an equation for \u2018showField\u2019:\n    isNothing x\n</code></pre>\n\n<p>I generally understand this error, but I don't understand if there's a way to achieve what I'd like to. I've also tried pattern matching rather than guards, but can't quite work that out either. Is there something that I could construct in this format that would work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1506452589, "post_id": 46432983, "comment_id": 79825205, "body": "You should change a lot more than only the undefined..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1506455227, "post_id": 46432983, "comment_id": 79826564, "body": "I don&#39;t think you are on the right track. I&#39;d try to start by writing a function that, given a row, computes the list of all possible variant rows."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1506456502, "post_id": 46432983, "comment_id": 79827145, "body": "Hi, @BaasBartMans.  Welcome to Stack Overflow.  I think this is a neat question, but it was in danger of being closed.  I tried to rewrite it to make it clearer.  Feel free to edit it further (or change things back) if you think I misunderstood what you were asking."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1506456741, "post_id": 46432983, "comment_id": 79827245, "body": "Also, can you explain what your function should do it you give it a <code>Mappy</code> like <code>[[&#39;o&#39;,&#39;x&#39;],[&#39;o&#39;,&#39;o&#39;]]</code>.  Should it generate a list of four variants, with <code>&#39;i&#39;</code> replacing each of the four elements, or should it only generate the three variants where <code>&#39;o&#39;</code> is replaced with <code>&#39;i&#39;</code>, so the <code>&#39;x&#39;</code> is never changed?"}, {"owner": {"reputation": 51, "user_id": 8168200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-QsHbz8YjcMY/AAAAAAAAAAI/AAAAAAAAACw/jqGmmP79ahk/photo.jpg?sz=128", "display_name": "BaasBartMans", "link": "https://stackoverflow.com/users/8168200/baasbartmans"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1506512408, "post_id": 46432983, "comment_id": 79849515, "body": "@K.A.Buhr only the o should be replaced indeed, so i need to do some checking indeed."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8168200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-QsHbz8YjcMY/AAAAAAAAAAI/AAAAAAAAACw/jqGmmP79ahk/photo.jpg?sz=128", "display_name": "BaasBartMans", "link": "https://stackoverflow.com/users/8168200/baasbartmans"}, "edited": false, "score": 0, "creation_date": 1506599664, "post_id": 46435284, "comment_id": 79891754, "body": "A zipper seemed to do the job indeed, thanks"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1506457812, "creation_date": 1506457812, "answer_id": 46435284, "question_id": 46432983, "link": "https://stackoverflow.com/questions/46432983/taking-a-list-of-lists-and-generating-all-variants-with-one-element-replaced/46435284#46435284", "title": "Taking a list of lists and generating all variants with one element replaced", "body": "<p>What you want, young BaasBartMans, is a Zipper.</p>\n\n<pre><code>data Zipper a = Zipper [a] a [a]\n\nofList :: [a] -&gt; Maybe (Zipper a)\nofList [] = Nothing\nofList (a:as) = Just (Zipper [] a as)\n</code></pre>\n\n<p>A zipper gives you the context for a position in a list, so you\ncan easily modify them one at a time, step forward and backward and such.</p>\n\n<p>We can recover a list from a zipper:</p>\n\n<pre><code>instance Foldable Zipper where\n  foldr f c (Zipper ls a rs) = foldl' (flip f) (f a (foldr f c rs)) ls\n</code></pre>\n\n<p>We can modify every position in a Zipper simultaneously:</p>\n\n<pre><code>instance Functor Zipper where\n  fmap f (Zipper ls a rs) = Zipper (fmap f ls) (f a) (fmap f rs)\n</code></pre>\n\n<p>Or just the focused element:</p>\n\n<pre><code>here :: Functor f =&gt; (a -&gt; f a) -&gt; Zipper a -&gt; f (Zipper a)\nhere f (Zipper ls a rs) = fmap (\\a' -&gt; Zipper ls a' rs) (f a)\n</code></pre>\n\n<p>And as a <code>Zipper</code> is a <code>Comonad</code>, we can modify each element in context:</p>\n\n<pre><code>instance Comonad Zipper where\n  extract (Zipper _ a _) = a\n  extend f z@(Zipper ls a rs) = Zipper ls' a' rs' where\n    a' = f z\n    ls' = unfoldr (fmap (\\z' -&gt; (f z', z')) . goLeft) z\n    rs' = unfoldr (fmap (\\z' -&gt; (f z', z')) . goRight) z\n</code></pre>\n\n<p>Using that, we can build a function that modifies each element of a list in context:</p>\n\n<pre><code>everywhere :: Alternative f =&gt; (a -&gt; f a) -&gt; [a] -&gt; f [a]\neverywhere f as = case ofList as of\n  Nothing -&gt; pure []\n  Just z  -&gt; asum $ extend (fmap toList . here f) z\n</code></pre>\n\n<p>Which works for simple lists:</p>\n\n<pre><code>\u03bb everywhere (\\a -&gt; [a+1]) [10,20,30]\n[[11,20,30]\n,[10,21,30]\n,[10,20,31]]\n</code></pre>\n\n<p>And nested lists:</p>\n\n<pre><code>\u03bb everywhere (everywhere (\\a -&gt; [a+1])) [[10], [20,20], [30,30,30]]\n[[[11],[20,20],[30,30,30]]\n,[[10],[21,20],[30,30,30]]\n,[[10],[20,21],[30,30,30]]\n,[[10],[20,20],[31,30,30]]\n,[[10],[20,20],[30,31,30]]\n,[[10],[20,20],[30,30,31]]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1506473143, "post_id": 46436409, "comment_id": 79832359, "body": "This is a much better answer for someone new to haskell"}, {"owner": {"reputation": 51, "user_id": 8168200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-QsHbz8YjcMY/AAAAAAAAAAI/AAAAAAAAACw/jqGmmP79ahk/photo.jpg?sz=128", "display_name": "BaasBartMans", "link": "https://stackoverflow.com/users/8168200/baasbartmans"}, "edited": false, "score": 0, "creation_date": 1506599635, "post_id": 46436409, "comment_id": 79891736, "body": "Yess thanks, this is just what i needed :)"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1506463240, "last_edit_date": 1506463240, "creation_date": 1506462768, "answer_id": 46436409, "question_id": 46432983, "link": "https://stackoverflow.com/questions/46432983/taking-a-list-of-lists-and-generating-all-variants-with-one-element-replaced/46436409#46436409", "title": "Taking a list of lists and generating all variants with one element replaced", "body": "<p>Zippers are great, and there's an interesting blog post about\nimplementing <a href=\"https://samtay.github.io/posts/comonadic-game-of-life.html\" rel=\"nofollow noreferrer\">Conway's Game of Life using zippers and comonads in Haskell</a>.  On the other\nhand, if this is still your first week learning Haskell, you might\nwant to save Comonads for Thursday, right?</p>\n\n<p>Here's another approach that uses simple recursion and list\ncomprehensions and no complex Haskell features.</p>\n\n<p>First, imagine we have an awesome function:</p>\n\n<pre><code>varyOne :: (a -&gt; [a]) -&gt; [a] -&gt; [[a]]\nvaryOne = undefined\n</code></pre>\n\n<p>that works as follows.  Given a function <code>f</code> that produces zero or\nmore variants of an element <code>a</code>, the function call <code>varyOne f xs</code>\ngenerates all variants of the list <code>xs</code> that result from taking\nexactly one element of <code>xs</code>, say <code>x</code> in the middle of the list, and replacing it with all the\nvariants given by <code>f x</code>.</p>\n\n<p>This function is surprisingly flexible.  It can generate the list of all variants resulting from forcibly replacing an element by a constant:</p>\n\n<pre><code>&gt; varyOne (\\x -&gt; [3]) [1,2,3,4]\n[[3,2,3,4],[1,3,3,4],[1,2,3,4],[1,2,3,3]]\n</code></pre>\n\n<p>By returning a singleton variant for a specific value and an empty list of variants for other values, it can generate all variants that replace an <code>'o'</code> with an <code>'i'</code> while suppressing the \"variants\" where no replacement is possible:</p>\n\n<pre><code>&gt; let varyRow = varyOne (\\c -&gt; if c == 'o' then ['i'] else [])\n&gt; varyRow \"ooxo\"\n[\"ioxo\",\"oixo\",\"ooxi\"]\n</code></pre>\n\n<p>and, because <code>varyRow</code> itself generates variants of a row, it can be used with <code>varyOne</code> to generate variants of tables where a particular <em>row</em> has been replaced by its possible variants:</p>\n\n<pre><code>&gt; varyOne varyRow [\"ooo\",\"oox\",\"ooo\"]\n[[\"ioo\",\"oox\",\"ooo\"],[\"oio\",\"oox\",\"ooo\"],[\"ooi\",\"oox\",\"ooo\"],\n [\"ooo\",\"iox\",\"ooo\"],[\"ooo\",\"oix\",\"ooo\"],\n [\"ooo\",\"oox\",\"ioo\"],[\"ooo\",\"oox\",\"oio\"],[\"ooo\",\"oox\",\"ooi\"]]\n</code></pre>\n\n<p>It turns out that this awesome function is surprisingly easy to write:</p>\n\n<pre><code>varyOne :: (a -&gt; [a]) -&gt; [a] -&gt; [[a]]\nvaryOne f (x:xs)\n    = [y:xs | y &lt;- f x] ++ [x:ys | ys &lt;- varyOne f xs]\nvaryOne _ []     = []\n</code></pre>\n\n<p>The first list comprehension generates all the variants for the current element.  The second list comprehension generates variants that involve changes to the right of the current element using a recursive <code>varyOne</code> call.</p>\n\n<p>Given <code>varyOne</code>, we can define:</p>\n\n<pre><code>replaceOne :: Char -&gt; Char -&gt; Mappy -&gt; [Mappy]\nreplaceOne old new = varyOne (varyOne rep1)\n  where rep1 x = if x == old then [new] else []\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>&gt; replaceOne 'o' 'i' [\"ooo\",\"oox\",\"ooo\"]\n[[\"ioo\",\"oox\",\"ooo\"],[\"oio\",\"oox\",\"ooo\"],[\"ooi\",\"oox\",\"ooo\"]\n,[\"ooo\",\"iox\",\"ooo\"],[\"ooo\",\"oix\",\"ooo\"]\n,[\"ooo\",\"oox\",\"ioo\"],[\"ooo\",\"oox\",\"oio\"],[\"ooo\",\"oox\",\"ooi\"]]\n</code></pre>\n\n<p>is probably the function you're looking for.</p>\n\n<p>If you prefer to unconditionally replace a single element with <code>i</code>, no matter what the old element was, then this will work:</p>\n\n<pre><code>&gt; varyOne (varyOne (const ['i'])) [\"ooo\",\"oox\",\"ooo\"]\n[[\"ioo\",\"oox\",\"ooo\"],[\"oio\",\"oox\",\"ooo\"],[\"ooi\",\"oox\",\"ooo\"]\n,[\"ooo\",\"iox\",\"ooo\"],[\"ooo\",\"oix\",\"ooo\"],[\"ooo\",\"ooi\",\"ooo\"]\n,[\"ooo\",\"oox\",\"ioo\"],[\"ooo\",\"oox\",\"oio\"],[\"ooo\",\"oox\",\"ooi\"]]\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8168200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-QsHbz8YjcMY/AAAAAAAAAAI/AAAAAAAAACw/jqGmmP79ahk/photo.jpg?sz=128", "display_name": "BaasBartMans", "link": "https://stackoverflow.com/users/8168200/baasbartmans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "closed_date": 1506465469, "accepted_answer_id": 46436409, "answer_count": 2, "score": 2, "last_activity_date": 1506463240, "creation_date": 1506448652, "last_edit_date": 1506456352, "question_id": 46432983, "link": "https://stackoverflow.com/questions/46432983/taking-a-list-of-lists-and-generating-all-variants-with-one-element-replaced", "closed_reason": "Needs more focus", "title": "Taking a list of lists and generating all variants with one element replaced", "body": "<p>I have types for a two-dimensional map of characters:</p>\n\n<pre><code>type Row = [Char]\ntype Mappy = [Row]\n</code></pre>\n\n<p>I'd like to write a function that takes a <code>Mappy</code> like:</p>\n\n<pre><code>[['o','o'],['o','o']]\n</code></pre>\n\n<p>and generates a list of all <code>Mappy</code>s with a single 'o' element replaced with 'i':</p>\n\n<pre><code>[ [['i','o'],['o','o']]\n, [['o','i'],['o','o']]\n, [['o','o'],['i','o']]\n, [['o','o'],['o','i']]\n]\n</code></pre>\n\n<p>Here's what I've tried:  I think I need to use the map function, because I need to go over each element, but I don't know how, because a map function doesn't keep track of the position it is working on. </p>\n\n<pre><code>type Row = [Char]\ntype Mappy = [Row]\n\nfunc :: Mappy -&gt; [Mappy]\nfunc a = map (map someFunc a) a\n\nsomeFunc :: Mappy -&gt; Char -&gt; Mappy\nsomeFunc a b = if b == \"o\"\n               then undefined\n               else a\n</code></pre>\n\n<p>Obviously, I should change the <code>undefined</code>, but i have no idea how. Thanks in advance.</p>\n"}, {"tags": ["list", "haskell", "encoding"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506445661, "post_id": 46432171, "comment_id": 79821614, "body": "How would you take the first character of every list?"}, {"owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506445771, "post_id": 46432171, "comment_id": 79821667, "body": "When I use (x:xs), isn&#39;t x the first character of the list?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506445801, "post_id": 46432171, "comment_id": 79821681, "body": "yes, but now you want to do this for every sublist."}, {"owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506445903, "post_id": 46432171, "comment_id": 79821734, "body": "So, do I need to create sublists based on how many factors there are?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506446540, "post_id": 46432171, "comment_id": 79822063, "body": "well this problem has two subproblems: padding the input with <code>X</code>s, and transposing the list. The comment was more to help you constructing the transpose function."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1506447000, "post_id": 46432171, "comment_id": 79822310, "body": "It&#39;s a good use case for <code>Data.Matrix</code> once you get <code>[3,7]</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1506449982, "post_id": 46432171, "comment_id": 79823912, "body": "Padding is done with <code>xs ++ replicate n &#39;X&#39;</code>. Package <code>split</code> has a function <a href=\"http://hoogle.haskell.org/?hoogle=Int%20-%3E%20%5Ba%5D%20-%3E%20%5B%5Ba%5D%5D\" rel=\"nofollow noreferrer\"><code>chunksOf :: Int -&gt; [a] -&gt; [[a]]</code></a> in module <code>Data.List.Split</code> to turn <code>&quot;i am struggling hereX&quot;</code> into <code>[&quot;i am st&quot;, &quot;rugglin&quot;, &quot;g hereX&quot;]</code>.    Then there&#39;s  <a href=\"http://hoogle.haskell.org/?hoogle=%5B%5Ba%5D%5D-%3E%20%5B%5Ba%5D%5D\" rel=\"nofollow noreferrer\"><code>transpose :: [[a]] -&gt; [[a]]</code></a> to turn it into <code>[&quot;irg&quot;, &quot; u &quot;, &quot;agh&quot;, &quot;mge&quot;, &quot; lr&quot;, &quot;sie&quot;, &quot;tnX&quot;]</code> and <a href=\"http://hoogle.haskell.org/?hoogle=concat\" rel=\"nofollow noreferrer\"><code>concat :: [[a]] -&gt; [a]</code></a> to glue the pieces back together."}], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 1, "last_activity_date": 1506483204, "last_edit_date": 1506483204, "creation_date": 1506459828, "answer_id": 46435803, "question_id": 46432171, "link": "https://stackoverflow.com/questions/46432171/encoding-and-decoding-by-rearranging-a-list-in-haskell/46435803#46435803", "title": "Encoding and decoding by rearranging a list in Haskell", "body": "<p>Let's break this down into steps.</p>\n\n<ol>\n<li>Identify the smallest 2-composite number that is <code>&gt;=</code> the length of the input string.</li>\n<li>Pad the ending of the string with <code>'X'</code> characters so that the length is 2-composite.</li>\n<li>Split the padded string into a list of chunks where each chunk is the same length.</li>\n<li>Transpose the chunks.</li>\n<li>Concatenate the chunks back together.</li>\n</ol>\n\n<p>We can start by using <code>length</code> to get the length of the input string. Next, we can use the <a href=\"https://hackage.haskell.org/package/primes-0.2.1.0/docs/Data-Numbers-Primes.html#v:primeFactors\" rel=\"nofollow noreferrer\"><code>primeFactors</code></a> function from the <code>primes</code> package to find a number with only 2 prime factors.</p>\n\n<p>The 2nd step can be accomplished using <code>++</code> and <code>replicate n 'X'</code> to append <code>n</code> characters to the end of the string.</p>\n\n<p>The 3rd step can be accomplished using the <a href=\"https://hackage.haskell.org/package/split-0.2.3.2/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\"><code>chunksOf</code></a> function from the <code>split</code> package, using 1 of the factors from step 1 in order to split the string into chunks.</p>\n\n<p>The last 2 steps are very easy, because that's the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>transpose</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:concat\" rel=\"nofollow noreferrer\"><code>concat</code></a> functions.</p>\n\n\n\n<pre><code>import Data.List.Split (chunksOf)\nimport Data.Numbers.Primes (primeFactors)\nimport Data.List (transpose)\n\nanagramEncode :: String -&gt; String\nanagramEncode str = concat (transpose (chunksOf factor paddedString))\n  where\n    unpaddedLength = length str\n    (paddedLength, factor) =\n        head [(n, facHi) | n &lt;- [unpaddedLength ..]\n                         , [facLo, facHi] &lt;- [primeFactors n] ]\n    paddedString = str ++ replicate (paddedLength - unpaddedLength) 'X'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1506483581, "post_id": 46436891, "comment_id": 79834626, "body": "<code>(&gt; n)</code> could probably be <code>(&gt;= n)</code>. That way your second test case doesn&#39;t need to expand from 21 chars to 22 chars (since 21 is already 2-composite)."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1506503009, "last_edit_date": 1506503009, "creation_date": 1506465969, "answer_id": 46436891, "question_id": 46432171, "link": "https://stackoverflow.com/questions/46432171/encoding-and-decoding-by-rearranging-a-list-in-haskell/46436891#46436891", "title": "Encoding and decoding by rearranging a list in Haskell", "body": "<p>Well here is my solution. As mentioned in my comment the <code>Data.Matrix</code> package seems ideal for this job due to it's data structure and built in transposing (rows &lt;-> columns) ability.</p>\n\n<p>So this is the code;</p>\n\n<pre><code>import Data.Bool (bool)\nimport Data.Matrix\n\nfactors :: Int -&gt; [(Int,Int)]\nfactors n = [(x, n `div` x) | x &lt;- [2..limit], n `mod` x == 0]\n            where limit = truncate . sqrt . realToFrac $ n\n\ntwoComposites :: [(Int,Int)] -- infinite list of composites only with 2 composers\ntwoComposites = foldr (\\n rs -&gt; let ts  = factors n  -- tuples of composers\n                                in bool rs (ts ++ rs) (length ts == 1)) [] [2..]      \n\ngetComposites :: Int -&gt; (Int,Int)\ngetComposites n = head . filter ((&gt;= n) . uncurry (*)) $ twoComposites\n\ncomposeMtx :: String -&gt; Matrix Char\ncomposeMtx s = uncurry fromList ts swx\n               where len = length s\n                     ts  = getComposites len\n                     lwx = uncurry (*) $ ts               -- length with X\n                     swx = s ++ replicate (lwx - len) 'X' -- string with X\n\nencode :: String -&gt; String\nencode = toList . transpose . composeMtx\n</code></pre>\n\n<p>Note: It's already 2AM here and I am out of beer and cigars... So all detailed explanation will follow tomorrow. Yet.. lets put this under some test... (also thanks for @4castle for pointing out my overlook)</p>\n\n<pre><code>*Main&gt; encode \"i am struggling here\"   -- 20 chrs adds one X fills up to (3,7)\n\"irg u aghmge lrsietn \"\n(0.01 secs, 155,240 bytes)\n\n\n*Main&gt; encode \"i am struggling here \"  -- 21 chrs adds no Xs already (3,7)\n\"il ianmg  shterrueg gX\"\n(0.01 secs, 159,160 bytes)\n\n*Main&gt; encode \"i am struggling here  \" -- 22 chrs adds no Xs already (2,11)\n\"il ianmg  shterrueg g \"\n(0.01 secs, 158,984 bytes)\n\n*Main&gt; encode \"i am struggling here   \" -- 23 chrs adds 2 Xs fills up to (5,5)\n\"isg   tlh arie munrX ggeX\"\n(0.01 secs, 159,448 bytes)\n</code></pre>\n\n<p>Explanation:</p>\n\n<ul>\n<li><code>factors</code> is an efficient function to calculate composing numbers. i.e. to check 100 it only counts up from 2 to 10 (sqrt 100). 2 yields (2,50), 4 yields (4,25), 5 yields (5,20), ... 10 yields (10,10). I allow (10,10) although 10 is duplicated, since this algorithm needs composer pairs to be used for Matrix dimensions.</li>\n<li><code>twoComposites</code> gives us an infinite list of composite numbers which only have 2 composers. The <code>bool</code> function (<code>a -&gt; a -&gt; Bool -&gt; a</code>) is a ternary test just like JavaScript's <code>? :</code> and takes 3 parameters like <code>bool negativeResponse positiveResponce condition</code> In Haskell left side is almost always negative.. so keep in mind that's different in JS.</li>\n<li><code>getComposites</code> is a function when fed with an integer returns a tuple with two composers which yield either same or the closest bigger composite number which has only two composers. The <code>uncurry</code> (<code>(a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c</code>) function takes an operator which accepts 2 parameters and applies it to the elements of a tuple with two elements. So <code>uncurry (*) (3,7)</code> will result 21.</li>\n<li><code>composeMtx</code> when fed with a string pads it with necessary number of 'x's and places it row by row in a matrix.</li>\n</ul>\n\n<p>So this is what it produces;</p>\n\n<pre><code>*Main&gt; composeMtx \"Once i had a black and white cat called Jessuro. He used to run on the roof all day long\"\n\n( 'O' 'n' 'c' 'e' ' ' 'i' ' ' 'h' 'a' 'd' ' ' 'a' ' ' )\n( 'b' 'l' 'a' 'c' 'k' ' ' 'a' 'n' 'd' ' ' 'w' 'h' 'i' )\n( 't' 'e' ' ' 'c' 'a' 't' ' ' 'c' 'a' 'l' 'l' 'e' 'd' )\n( ' ' 'J' 'e' 's' 's' 'u' 'r' 'o' '.' ' ' 'H' 'e' ' ' )\n( 'u' 's' 'e' 'd' ' ' 't' 'o' ' ' 'r' 'u' 'n' ' ' 'o' )\n( 'n' ' ' 't' 'h' 'e' ' ' 'r' 'o' 'o' 'f' ' ' 'a' 'l' )\n( 'l' ' ' 'd' 'a' 'y' ' ' 'l' 'o' 'n' 'g' 'X' 'X' 'X' )\n</code></pre>\n\n<ul>\n<li>encode function is pretty straightforward... You may need to check <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html#v:transpose\" rel=\"nofollow noreferrer\"><code>Data.Matrix.transpose</code></a></li>\n</ul>\n\n<p>So;</p>\n\n<pre><code>*Main&gt; encode \"Once i had a black and white cat called Jessuro. He used to run on the roof all day long\"\n\"Obt unlnleJs  ca eetdeccsdha kas eyi tut   a rorlhnco ooada.rond l ufg wlHn Xahee aX id olX\"\n(0.01 secs, 485,112 bytes)\n</code></pre>\n"}], "owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1506503009, "creation_date": 1506445604, "last_edit_date": 1506445628, "question_id": 46432171, "link": "https://stackoverflow.com/questions/46432171/encoding-and-decoding-by-rearranging-a-list-in-haskell", "title": "Encoding and decoding by rearranging a list in Haskell", "body": "<p>I am trying to write two separate programs that could be used to encode and then decode a word or phrase.  Encoding requires checking that the length of the message (including spaces) is a 2-composite number.  That is, it has exactly two factors excluding 1 and itself.  If it is not 2-composite, 'X' must be added until it is 2-composite.  Then the actual encoding is done by arranging the message in a grid with the dimensions of its factors and reading down instead of across.  So the phrase \"i am struggling here\", has 20 characters and needs to become \"i am struggling hereX\" in order to be encoded, because 20 has too many factors. Then think of the message as</p>\n\n<pre><code>i am st\nrugglin\ng hereX\n</code></pre>\n\n<p>After being encoded, it reads, \"irg u aghmge lrsietnX\".  </p>\n\n<p>I understand how to make the list the right length by adding 'X', but I can't understand how to take every 7th character from the list to create a new list. This is what I have:</p>\n\n<pre><code>factors :: Int -&gt; [Int]\nfactors n = [x | x &lt;- [1..n], n `mod` x == 0]\n\nanagramEncode :: [Char] -&gt; [Char]\nanagramEncode (x:xs) = if (length (factors (length xs))) == 4 then [k | k &lt;- \n???]\nelse anagramEncode (xs ++ ['X'])\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1506497578, "post_id": 46430773, "comment_id": 79839966, "body": "maybe splitting your test suite as desired and running <code>stack clean; stack build; stack path --local-hpc-root PATH-FOR-projA; stack test projA --coverage</code> and so on. An other solution is described in the <a href=\"https://docs.haskellstack.org/en/latest/coverage/#stack-hpc-report-command\" rel=\"nofollow noreferrer\">stack docs</a>"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1506516583, "post_id": 46430773, "comment_id": 79852194, "body": "We have about 50 tests (and counting) so it is not a solution to split each individual test into its own package. There is something I don&#39;t quite understand here: where does coverage information for functions that are <i>not</i> run as part of the single test I am running come from?"}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1506517742, "post_id": 46430773, "comment_id": 79853076, "body": "Unfortunately I haven&#39;t answer to your question. Maybe posting it at <a href=\"https://github.com/commercialhaskell/stack/issues\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues</a> will help"}], "answers": [{"tags": [], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "is_accepted": true, "score": 0, "last_activity_date": 1515764363, "creation_date": 1515764363, "answer_id": 48227441, "question_id": 46430773, "link": "https://stackoverflow.com/questions/46430773/how-can-i-generate-coverage-info-per-test-using-stack-hpc/48227441#48227441", "title": "How can I generate coverage info per test using stack hpc?", "body": "<p>It happens this issue was caused by some test code being executed as part of test tree creation and not test tree execution, so even when filtering all tests but one, we would accrue coverage for this code without any report.</p>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 48227441, "answer_count": 1, "score": 2, "last_activity_date": 1515764363, "creation_date": 1506440693, "question_id": 46430773, "link": "https://stackoverflow.com/questions/46430773/how-can-i-generate-coverage-info-per-test-using-stack-hpc", "title": "How can I generate coverage info per test using stack hpc?", "body": "<p>I would like to generate one coverage report <em>per test</em> run, instead of for a whole test suite. What I do is that I extract all individual tests then run <code>TASTY_PATTERN=testname stack test proj --coverage</code> for each test, archiving the generated HTML report file between each test. This works but the generated reports are <em>always</em> reporting values as if all tests had been run, with coverage information in files that could not possibly have been touch by a test.</p>\n\n<p>What do I need to do to properly cleanup the data and generate this information? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1506464832, "last_edit_date": 1506464832, "creation_date": 1506432162, "answer_id": 46427771, "question_id": 46427455, "link": "https://stackoverflow.com/questions/46427455/how-to-use-monadtrans/46427771#46427771", "title": "How to use monadtrans?", "body": "<blockquote>\n  <p>Which type the statement <code>return (a, s)</code> is going to return? A tuple or the tuple wrapped in a monad?</p>\n</blockquote>\n\n<p>A tuple wrapped in a monad. <code>return (a, s) :: m (a, s)</code> which is good since <code>runStateT' :: s -&gt; m (a, s)</code></p>\n\n<blockquote>\n  <p>How to use the lift function and force to have to <code>StateT'</code> type?</p>\n</blockquote>\n\n<p>You probably don't need this. If you use <code>lift</code> where there's a type signature it should just work.</p>\n\n<p>You can make a version of lift with a type signature that introduces the fact that you're lifting into <code>StateT' s</code>, but it won't help much since type inference will still need to infer <code>s</code>.</p>\n\n<pre><code>liftStateT' :: Monad m =&gt; m a -&gt; StateT' s m a\nliftStateT' = lift\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 46427771, "answer_count": 1, "score": 2, "last_activity_date": 1506464832, "creation_date": 1506431314, "question_id": 46427455, "link": "https://stackoverflow.com/questions/46427455/how-to-use-monadtrans", "title": "How to use monadtrans?", "body": "<p>I have following type:</p>\n\n<pre><code>newtype StateT' s m a =\n  StateT' { runStateT' :: s -&gt; m (a,s) }\n</code></pre>\n\n<p>and I implement the MonadTrans instance:</p>\n\n<pre><code>instance MonadTrans (StateT' s) where\n  lift ma = StateT' $ \\s -&gt; do\n    a &lt;- ma\n    return (a, s) \n</code></pre>\n\n<p>My questions are:</p>\n\n<ul>\n<li><p>Which type the statement <code>return (a, s)</code> is going to return? A tuple\nor the tuple wrapped in a monad?  </p></li>\n<li><p>How to use the <code>lift</code> function and force to have to <code>StateT'</code> type?</p></li>\n</ul>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 3, "creation_date": 1506429963, "post_id": 46426414, "comment_id": 79810900, "body": "<a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#what-makes-stack-special\" rel=\"nofollow noreferrer\">stack.yaml contains a reference, called a resolver, to the snapshot which your package will be built against</a>"}], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1506436599, "post_id": 46428660, "comment_id": 79815777, "body": "&quot;but your project is very likely not to build correctly (either now or at some time in the future) if you leave out version bounds&quot; Why would that be the case? The stack.yaml is fully specifying the versions of all packages being used."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1506442141, "post_id": 46428660, "comment_id": 79819688, "body": "@MichaelSnoyman Assuming it gets built with stack, having a <code>stack.yaml</code> with a fixed stackage reference does imply that you have included version bounds, just not in the <code>.cabal</code> file. But I wanted to address the question asked (&quot;Is it not necessary to specify each library&#39;s version?&quot;) head-on, addressing the problems that happen if you don&#39;t include a version constraint anywhere. I will add a bit of verbiage to be more clear about what I meant here."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1506442587, "last_edit_date": 1506442587, "creation_date": 1506434783, "answer_id": 46428660, "question_id": 46426414, "link": "https://stackoverflow.com/questions/46426414/understanding-versioning-in-cabal-and-stack-yaml-files/46428660#46428660", "title": "Understanding Versioning in .cabal and stack.yaml Files", "body": "<p>Correct, it is not necessary to specify the version of a library (in the sense that the parser for <code>.cabal</code> files doesn't require it).</p>\n\n<p>Correct, <code>stack.yaml</code>'s <code>lts-9.5</code> resolver specifies fixed versions of a large swath of Hackage, probably including everything listed in that cabal file. You can see the exact list of package/version pairs implied by <code>lts-9.5</code> <a href=\"https://www.stackage.org/lts-9.5\" rel=\"nofollow noreferrer\">on the Stackage website</a>.</p>\n\n<p>The community is somewhat divided on which mechanism (version constraints in the <code>.cabal</code> file or version constraints by specifying a fixed package/version pair list in <code>stack.yaml</code>) is best suited for specifying version bounds, but I think we can unite in agreement that you should use at least one of these two mechanisms. So, while it is technically not necessary to specify version bounds in <em>any</em> way, I encourage you to do so in some way despite that. Your project is very likely not to build correctly (either now or at some time in the future) if you leave out version bounds.</p>\n\n<p>Personally, I also consider it best practice to include version bounds <em>in the <code>.cabal</code> file itself</em>, even if this is just to fix the bounds to exactly what the stackage resolver would choose, so that people who prefer to use cabal for one reason or another will have less trouble with your package.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506442587, "creation_date": 1506428431, "question_id": 46426414, "link": "https://stackoverflow.com/questions/46426414/understanding-versioning-in-cabal-and-stack-yaml-files", "title": "Understanding Versioning in .cabal and stack.yaml Files", "body": "<p>Looking at my stack project's <code>project.cabal</code>:</p>\n\n<pre><code>name:                project\nversion:             0.1.0.0\n-- synopsis:\n-- description:\nhomepage:            https://github.com/githubuser/project#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2017 Author name here\ncategory:            Web\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nexecutable project-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , project\n                     , servant-server\n                     , base-compat\n                     , wai\n                     , aeson\n                     , blaze-markup\n                     , blaze-html\n                     , directory\n                     , warp\n                     , http-media\n                     , lucid\n                     , time\n                     , bytestring\n                     , attoparsec\n                     , string-conversions\n                     , mtl\n                     , servant-lucid\n  default-language:    Haskell2010\n  ghc-options:\n    -fwarn-unused-imports\n</code></pre>\n\n<p>Is it not necessary to specify each library's version? In other words, it seems that I'm only specifying the library, not the version, e.g. <code>servant-server</code>.</p>\n\n<p>Looking at my <code>stack.yaml</code>, I see:</p>\n\n<p><code>resolver: lts-9.5</code></p>\n\n<p>Perhaps that version, i.e. <code>lts-9.5</code>, specifies the version of each dependency? </p>\n\n<p>In short, I'm asking about versioning in a <code>stack</code> project.</p>\n"}, {"tags": ["haskell", "npm-install", "cabal", "haskell-stack", "yarnpkg"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1506434392, "post_id": 46426228, "comment_id": 79814174, "body": "<code>stack solver</code>: Add missing extra-deps to stack project config"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 1711338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p4fl2.png?s=128&g=1", "display_name": "Thunderkrown", "link": "https://stackoverflow.com/users/1711338/thunderkrown"}, "edited": false, "score": 0, "creation_date": 1506435603, "post_id": 46427294, "comment_id": 79815087, "body": "Ah, thanks. I couldn&#39;t find such an issue in the tracker, must have been blind."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1506430810, "creation_date": 1506430810, "answer_id": 46427294, "question_id": 46426228, "link": "https://stackoverflow.com/questions/46426228/automatic-dependency-management-with-stack-such-as-stack-add-module/46427294#46427294", "title": "Automatic Dependency Management with stack such as `stack add &lt;module&gt;`", "body": "<p>No, there's no such command in <code>stack</code>. But there's an open issue for that:</p>\n\n<p><a href=\"https://github.com/commercialhaskell/stack/issues/1933\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/1933</a></p>\n"}], "owner": {"reputation": 21, "user_id": 1711338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p4fl2.png?s=128&g=1", "display_name": "Thunderkrown", "link": "https://stackoverflow.com/users/1711338/thunderkrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506455479, "creation_date": 1506427969, "last_edit_date": 1506455479, "question_id": 46426228, "link": "https://stackoverflow.com/questions/46426228/automatic-dependency-management-with-stack-such-as-stack-add-module", "title": "Automatic Dependency Management with stack such as `stack add &lt;module&gt;`", "body": "<p>it there a command to tell <code>stack</code> to add a dependency in the cabal file? I think of a convenient way like with <code>npm</code> or <code>yarn</code> (<code>npm install &lt;module&gt; --save</code>, <code>yarn add &lt;module&gt;</code>). I think it is a bit tedious to manually add a new module in die cabal file. Maybe this functionality could automatically include version information as well.</p>\n\n<p>I know that a cabal file has different targets, so it is not as easy as with <code>npm</code> or <code>yarn</code>. But I think it would be useful.</p>\n\n<p>Thanks :)</p>\n"}, {"tags": ["haskell", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1506428086, "creation_date": 1506428086, "answer_id": 46426270, "question_id": 46425706, "link": "https://stackoverflow.com/questions/46425706/variadic-function-in-a-monad/46426270#46426270", "title": "Variadic function in a monad", "body": "<p>Continuation passing style gives direct access to the result of a computation.</p>\n\n<p>Another way would be to build a type class to iterate composition, but it's cumbersome.</p>\n\n<pre><code> {-# LANGUAGE FlexibleInstances #-}\n\nclass Foo t where\n  foo_ :: (IO () -&gt; IO ()) -&gt; t\n\ninstance (Show a, Foo t) =&gt; Foo (a -&gt; t) where\n  foo_ k a = foo_ (\\continue -&gt; k (print a &gt;&gt; continue))\n\ninstance Foo (IO ()) where\n  foo_ k = k (return ())\n\nfoo :: Foo t =&gt; t\nfoo = foo_ id\n\nmain :: IO ()\nmain = foo () (Just \"bar\") [()]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1507222286, "creation_date": 1507222286, "answer_id": 46590980, "question_id": 46425706, "link": "https://stackoverflow.com/questions/46425706/variadic-function-in-a-monad/46590980#46590980", "title": "Variadic function in a monad", "body": "<p>I found a way to write function <code>IO () -&gt; (ts ~~&gt; IO ()) -&gt; ts ~~&gt; IO ()</code></p>\n\n<pre><code>-- | Perform first action `m a` then pass its result to a function `(a -&gt; ts ~~&gt; mb)`\n--   which returns variadic function and return that function.\nclass BindV (m :: Type -&gt; Type) a b (ts :: [Type]) where\n    bindV :: m a -&gt; (a -&gt; ts ~~&gt; m b) -&gt; ts ~~&gt; m b\n\ninstance (Monad m) =&gt; BindV m a b '[] where\n    bindV ma f = ma &gt;&gt;= f\n\ninstance (BindV m a b ts) =&gt; BindV m a b (t ': ts) where\n    bindV ma f x = bindV @m @a @b @ts ma ((flip f) x)\n\n-- | Monadic composition that discards result of the first action.\nthenV :: forall (m :: Type -&gt; Type) a b (ts :: [Type]).\n    (BindV m a b ts) =&gt; \n    m a -&gt; (ts ~~&gt; m b) -&gt; ts ~~&gt; m b\nthenV ma f = bindV @m @a @b @ts ma (\\_ -&gt; f)\n</code></pre>\n\n<p>Thus instance in question become:</p>\n\n<pre><code>instance (Show t, Foo ts, BindV IO () () ts) =&gt; Foo (t ': ts) where\n    foo t = thenV @IO @() @() @ts (print t) (foo @ts)\n</code></pre>\n\n<p>I wish I could write <code>thenV</code> and <code>bindV</code> as an operator but <code>TypeApplications</code> doesn't work with operators.</p>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 46426270, "answer_count": 2, "score": 2, "last_activity_date": 1507222286, "creation_date": 1506426495, "question_id": 46425706, "link": "https://stackoverflow.com/questions/46425706/variadic-function-in-a-monad", "title": "Variadic function in a monad", "body": "<p>I have a type family of variadic functions:</p>\n\n<pre><code>type family (~~&gt;) (argTypes :: [Type]) (result :: Type) :: Type where\n'[]       ~~&gt; r = r\n(t ': ts) ~~&gt; r = t -&gt; (ts ~~&gt; r)\n\ninfixr 0 ~~&gt;\n</code></pre>\n\n<p>I want a variadic function which applies some monadic action (say print) to all its arguments:</p>\n\n<pre><code>class Foo (ts :: [Type]) where\nfoo :: ts ~~&gt; IO ()\n\ninstance Foo '[] where\n    foo = pure ()\n\ninstance (Show t, Foo ts) =&gt; Foo (t ': ts) where\n    foo t = print t &gt;&gt; foo @ts\n</code></pre>\n\n<p>Usual monadic composition doesn't work here.\n<code>(&gt;&gt;)</code> has type <code>IO () -&gt; IO () -&gt; IO ()</code>. I need to use something of type <code>IO () -&gt; (ts ~~&gt; IO ()) -&gt; ts ~~&gt; IO ()</code> to compose <code>print t</code> and <code>foo @ts</code> there.</p>\n\n<p>Is it possible to write such function at all?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses", "newtype"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506596725, "post_id": 46428431, "comment_id": 79889933, "body": "Thanks for the great answer. It is still unclear how and why the solution works, but I hope that understanding will come after I dive deeper into lenses. In the meantime <a href=\"https://github.com/capitanbatata/sandbox/blob/master/pw-lenses/src/Coercions.lhs\" rel=\"nofollow noreferrer\">here</a> is some working code."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1506434105, "creation_date": 1506434105, "answer_id": 46428431, "question_id": 46425567, "link": "https://stackoverflow.com/questions/46425567/how-to-eliminate-the-boilerplate-of-wrapping-and-unwrapping-using-lenses/46428431#46428431", "title": "How to eliminate the boilerplate of wrapping and unwrapping using lenses", "body": "<p>The \"problem\" is that you're using <code>Wrapped</code>, which is really meant to be a convenience pattern synonym and not a wrapping \"constructor\".  Because it's designed to support polymorphic wrapping, you need to assert that your type can be rewrapped:</p>\n\n<pre><code>fromListW :: (Rewrapped a a, Ord a) =&gt; [Unwrapped a] -&gt; FreeMonoid a\nfromListW = fromList . (Wrapped &lt;$&gt;)\n</code></pre>\n\n<p>This then works as expected:</p>\n\n<pre><code>&gt; let x = [1,2,3]\n&gt; fromListW x :: FreeMonoid (Sum Int)\nFreeMonoid {asMap = fromList [(Sum {getSum = 1},...\n&gt; fromListW x :: FreeMonoid (Product Int)\nFreeMonoid {asMap = fromList [(Product {getProduct = 1},...\n&gt;\n</code></pre>\n\n<p>I think a more idiomatic lens implementation would be:</p>\n\n<pre><code>fromListW :: (Rewrapped a a, Ord a) =&gt; [Unwrapped a] -&gt; FreeMonoid a\nfromListW = fromList . view (mapping _Unwrapped)\n</code></pre>\n\n<p>This still requires the <code>Rewrapped a a</code> constraint, but you can use the non-polymorphic <code>_Unwrapped'</code> instead:</p>\n\n<pre><code>fromListW :: (Wrapped a, Ord a) =&gt; [Unwrapped a] -&gt; FreeMonoid a\nfromListW = fromList . view (mapping _Unwrapped')\n</code></pre>\n\n<p>which looks a little more natural.</p>\n\n<p>The <code>toListW</code> implementation would have similar structure:</p>\n\n<pre><code>toListW :: (Wrapped a, Ord a) =&gt; FreeMonoid a -&gt; [Unwrapped a]\ntoListW = view (mapping _Wrapped') . toList\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 46428431, "answer_count": 1, "score": 0, "last_activity_date": 1506434105, "creation_date": 1506426070, "question_id": 46425567, "link": "https://stackoverflow.com/questions/46425567/how-to-eliminate-the-boilerplate-of-wrapping-and-unwrapping-using-lenses", "title": "How to eliminate the boilerplate of wrapping and unwrapping using lenses", "body": "<p><strong>tl;dr</strong>: is it possible to use any of the <code>lens</code> family of abstractions to wrap/unwrap any arbitrary <code>newtype</code> (that provides an instance for such abstractions)?</p>\n\n<p>I'll motivate my question by a simple example, based on a true story. Suppose I define the following <code>newtype</code>:</p>\n\n<pre><code>newtype FreeMonoid a = FreeMonoid { asMap :: Map a Int }\n</code></pre>\n\n<p>which is used to represent terms of the form:</p>\n\n<pre><code>a0 &lt;&gt; a1 &lt;&gt; ... &lt;&gt; an-1\n</code></pre>\n\n<p>We can represent free-monoids as lists:</p>\n\n<pre><code>instance Ord a =&gt; IsList (FreeMonoid a) where\n    type Item (FreeMonoid a) = a\n    fromList xs = FreeMonoid $ Map.fromListWith (+) $ zip xs (repeat 1)\n    toList (FreeMonoid p) = do\n        (x, n) &lt;- Map.toList p\n        genericReplicate n x\n</code></pre>\n\n<p>Two examples of free-monoids are sequences of sum and sequences of products:</p>\n\n<pre><code>type FreeSum a = FreeMonoid (Sum a)\ntype FreeProduct a = FreeMonoid (Product a)\n</code></pre>\n\n<p>Where <code>Sum</code> and <code>Product</code> are defined in <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\"><code>Data.Monoid</code></a>. Now we could define <code>fromList</code> and <code>toList</code> operations for <code>FreeSum</code> and\n<code>FreeProduct</code> as follows:</p>\n\n<pre><code>fromListSum :: Ord a =&gt; [a] -&gt; FreeSum a\nfromListSum = fromList . (Sum &lt;$&gt;)\n\nfromListProduct :: Ord a =&gt; [a] -&gt; FreeProduct a\nfromListProduct = fromList . (Product &lt;$&gt;)  \n</code></pre>\n\n<p>But this has quite a lot of boilerplate. It'd be nicer if we could simply say:</p>\n\n<pre><code>fromListW :: (Ord a, Wrapper f) =&gt; [a] -&gt; FreeMonoid (f a)\nfromListW = fromList . (wrap &lt;$&gt;)\n</code></pre>\n\n<p>where <code>wrap</code> is some operation of the (hypotetical) <code>Wrapper</code> class were:</p>\n\n<pre><code>wrap :: a -&gt; f a\nunwrap :: f a -&gt; a\n</code></pre>\n\n<p>Similarly, I'd like to be able to write a function:</p>\n\n<pre><code>toListW :: (Ord a, Wrapper f) =&gt; FreeMonoid (f a) -&gt; [a]\ntoListW = (unwrap &lt;$&gt;) . toList\n</code></pre>\n\n<p>Lenses seem to provide such an abstraction in <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Wrapped.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Wrapped</code></a> (for which <code>Sum</code> and <code>Product</code> in this example are instances of the typeclasses there!). However my attempts to understand and use the abstractions in this module have failed. For instance:</p>\n\n<pre><code>fromListW :: (Ord a, Wrapped (f a))  =&gt; [a] -&gt; FreeMonoid (f a)\nfromListW = fromList . (Wrapped &lt;$&gt;)\n</code></pre>\n\n<p>won't work since the argument is not a list of <code>Unwrapped (f a)</code>.</p>\n\n<p>So my question is:</p>\n\n<ul>\n<li>Do lenses provide an abstraction similar to this <code>Wrapper</code> class?</li>\n<li>If not, can this \"scrap-your-boilerplate\" problem be solved by using lenses?</li>\n</ul>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 30, "last_activity_date": 1506429543, "creation_date": 1506429543, "answer_id": 46426831, "question_id": 46425062, "link": "https://stackoverflow.com/questions/46425062/should-i-prefer-monadunliftio-or-monadmask-for-bracketting-like-functions/46426831#46426831", "title": "Should I prefer MonadUnliftIO or MonadMask for bracketting like functions?", "body": "<p>Let's lay out the options first (repeating some of your question in the process):</p>\n\n<ul>\n<li><code>MonadMask</code> from the <code>exceptions</code> library. This can work on a wide range of monads and transformers, and does not require that the base monad be <code>IO</code>.</li>\n<li><code>MonadUnliftIO</code> from the <code>unliftio-core</code> (or <code>unliftio</code>) library. This library only works for monads with <code>IO</code> at their base, and which is somehow isomorphic to <code>ReaderT env IO</code>.</li>\n<li><code>MonadBaseControl</code> from the <code>monad-control</code> library. This library will require <code>IO</code> at the base, but will allow non-ReaderT.</li>\n</ul>\n\n<p>Now the tradeoffs. <code>MonadUnliftIO</code> is the newest addition to the fray, and has the least developed library support. This means that, in addition to the limitations of what monads can be instances, many good instances just haven't been written yet.</p>\n\n<p>The important question is: why does <code>MonadUnliftIO</code> make this seemingly arbitrary requirement around <code>ReaderT</code>-like things? This is to prevent issues with lost monadic state. For example, the semantics of <code>bracket_ (put 1) (put 2) (put 3)</code> are not really clear, and therefore <code>MonadUnliftIO</code> disallows a <code>StateT</code> instance.</p>\n\n<p><code>MonadBaseControl</code> relaxes the <code>ReaderT</code> restriction and has wider library support. It's also considered more complicated internally than the other two, but for your usages that shouldn't really matter. And it allows you to make mistakes with the monadic state as mentioned above. If you're careful in your usage, this won't matter.</p>\n\n<p><code>MonadMask</code> allows totally pure transformer stacks. I think there's a good argument to be had around the usefulness of modeling asynchronous exceptions in a pure stack, but I understand this kind of approach is something people want to do sometimes. In exchange for getting more instances, you still have the limitations around monadic state, plus the inability to lift some <code>IO</code> control actions, like <code>timeout</code> or <code>forkIO</code>.</p>\n\n<p>My recommendation:</p>\n\n<ul>\n<li>If you want to match the way most people are doing things today, it's probably best to choose <code>MonadMask</code>, it's the most well adopted solution.</li>\n<li>If you want that goal, <em>but</em> you also need to do a <code>timeout</code> or <code>withMVar</code> or something, use <code>MonadBaseControl</code>.</li>\n<li>And if you know there's a specific set of monads you need compatibility with, and want compile time guarantees about the correctness of your code vis-a-vis monadic state, use <code>MonadUnliftIO</code>.</li>\n</ul>\n"}], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1033, "favorite_count": 5, "accepted_answer_id": 46426831, "answer_count": 1, "score": 16, "last_activity_date": 1506429543, "creation_date": 1506424800, "question_id": 46425062, "link": "https://stackoverflow.com/questions/46425062/should-i-prefer-monadunliftio-or-monadmask-for-bracketting-like-functions", "title": "Should I prefer MonadUnliftIO or MonadMask for bracketting like functions?", "body": "<p>I'm currently building a new API, and one of the functions it currently provides is:</p>\n\n<pre><code>inSpan :: Tracer -&gt; Text -&gt; IO a -&gt; IO a\n</code></pre>\n\n<p>I'm looking to move that <code>Tracer</code> into a monad, giving me a signature more like</p>\n\n<pre><code>inSpan :: MonadTracer m =&gt; Text -&gt; m a -&gt; m a \n</code></pre>\n\n<p>The implementation of <code>inSpan</code> uses <code>bracket</code>, which means I have two main options:</p>\n\n<pre><code>class MonadUnliftIO m =&gt; MonadTracer m\n</code></pre>\n\n<p>or</p>\n\n<pre><code>class MonadMask m =&gt; MonadTracer m\n</code></pre>\n\n<p>But which should I prefer? Note that I'm in control of all the types I've mentioned, which makes me slightly lean towards <code>MonadMask</code> as it doesn't enforce <code>IO</code> at the bottom (that is, we could perhaps have a pure <code>MonadTracer</code> instance).</p>\n\n<p>Is there anything else I should consider?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1506421844, "post_id": 46423041, "comment_id": 79805187, "body": "<code>(r -&gt; m a) ~ b</code> and <code>ReaderT r m a ~ c</code> in <code>(.)</code> type when applied to <code>ReaderT</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506422875, "post_id": 46423041, "comment_id": 79805816, "body": "Why is <code>(r -&gt; m a)</code> ~ b and where is the type variable <code>a</code> of <code>const</code> function?"}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506425756, "post_id": 46424773, "comment_id": 79807770, "body": "What is going to happen with <code>a</code> in <code>(a -&gt; r -&gt; m a1)</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1506425873, "post_id": 46424773, "comment_id": 79807848, "body": "Because <code>const :: a -&gt; b -&gt; a</code> and we passing it in place of <code>(a -&gt; r -&gt; m a1)</code>, the type system infers the fact that <code>a ~ m a1</code> in the latter signature."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506426249, "post_id": 46424773, "comment_id": 79808112, "body": "Can I say <code>m a1 -&gt; r -&gt; m a1</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1506426465, "post_id": 46424773, "comment_id": 79808258, "body": "Yes, you can say that."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 3, "last_activity_date": 1506423959, "creation_date": 1506423959, "answer_id": 46424773, "question_id": 46423041, "link": "https://stackoverflow.com/questions/46423041/substitute-type-of-readert-and-const-through-function-compostion/46424773#46424773", "title": "Substitute type of ReaderT and const through function compostion", "body": "<p><code>ReaderT</code> is an unary function: it takes <code>(r -&gt; m a)</code> as its argument and returns <code>ReaderT r m a</code> as result.</p>\n\n<p>The first argument of <code>(.)</code> is also an unary function <code>b -&gt; c</code>. Passing <code>ReaderT</code> as its first argument naturally gives <code>(r -&gt; m a) ~ b</code> and <code>ReaderT r m a ~ c</code>:</p>\n\n<pre><code>(r -&gt; m a) -&gt; ReaderT r m a\n    b      -&gt;        c\n</code></pre>\n\n<p>So, substituting it into <code>(.)</code> type we get</p>\n\n<pre><code>&gt; :t (.) ReaderT\n(.) ReaderT :: (a -&gt; r -&gt; m a1) -&gt; a -&gt; ReaderT r m a1\n</code></pre>\n\n<p>The <code>(.)</code> got passed first argument of two, so now it is an unary function (rougly speaking, the <code>(a -&gt; b) -&gt; a -&gt; c</code> part of <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>), where <code>b</code> and <code>c</code> are fixed to what we wrote above.</p>\n\n<p>Now, <code>const :: a -&gt; b -&gt; a</code>, a binary function and exactly what <code>(.) ReaderT</code> expects next:</p>\n\n<pre><code>(a -&gt; r -&gt; m a1)\n a -&gt; b -&gt; a\n</code></pre>\n\n<p>This means that <code>a ~ m a1</code> and due to this <code>a</code> in <code>(.)</code> type gets turned into <code>m a</code>.</p>\n\n<p>So, we passed both arguments to <code>(.)</code> and it gives us <code>a -&gt; c</code> where <code>a ~ m a</code> (note that these a's are different!) and <code>c ~ ReaderT b m a</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 46424773, "answer_count": 1, "score": 2, "last_activity_date": 1506424206, "creation_date": 1506419157, "last_edit_date": 1506424206, "question_id": 46423041, "link": "https://stackoverflow.com/questions/46423041/substitute-type-of-readert-and-const-through-function-compostion", "title": "Substitute type of ReaderT and const through function compostion", "body": "<p>I am trying to find it out, what is the type of the function composition of <code>ReaderT</code> and <code>const</code> and want to figure it out by myself.</p>\n\n<pre><code>(.) ReaderT const :: ???  \n</code></pre>\n\n<p>First, look at the type signature of <code>ReaderT</code> and <code>(.)</code>:</p>\n\n<pre><code>ReaderT :: (r -&gt; m a) -&gt; ReaderT r m a\n(.)     :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>then I did following substitution:</p>\n\n<pre><code>(.) ReaderT\n</code></pre>\n\n<p>step by step:</p>\n\n<pre><code>((r -&gt; m a) -&gt; ReaderT r m a) -&gt; (a1 -&gt; (r -&gt; m a)) -&gt; a1 -&gt; ReaderT r m a\n</code></pre>\n\n<p>it becomes to:</p>\n\n<pre><code>(a1 -&gt; r -&gt; m a) -&gt; a1 -&gt; ReaderT r m a\n</code></pre>\n\n<p>next substitute with <code>const</code>:</p>\n\n<pre><code>const :: (a  -&gt; ( b -&gt; a  ))\n         (a1 -&gt; ( r -&gt; m a)) -&gt; a1 -&gt; ReaderT r m a\n</code></pre>\n\n<p>My brain stop at this point. How to continue the type substitution?</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1506405684, "post_id": 46418784, "comment_id": 79795027, "body": "Looks like you switched x and n around. You need <code>(length (factors x)) == n-2</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1506406152, "post_id": 46418784, "comment_id": 79795255, "body": "Also n+2 of course, not n-2."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 5, "last_activity_date": 1506406474, "creation_date": 1506406474, "answer_id": 46419054, "question_id": 46418784, "link": "https://stackoverflow.com/questions/46418784/create-infinite-list-in-haskell-of-k-composite-numbers/46419054#46419054", "title": "Create infinite list in Haskell of k-composite numbers", "body": "<blockquote>\n  <p>A k-composite number is a composite number with k factors excluding 1 and itself</p>\n</blockquote>\n\n<p>Since your <code>factors</code> function returns all factors of a number (including <code>1</code> and itself), this number will be greater than the provided <code>k</code>. That's why you need to compare with <code>k + 2</code> instead of <code>k - 2</code></p>\n\n<p>Also, when <code>k</code> is less than <code>0</code> you'll still get the program never stop running, that's why you might want to process this edge case.</p>\n\n<pre><code>factors :: Int -&gt; [Int]\nfactors n = [x | x &lt;- [1..n], n `mod` x == 0]\n\nkcomposite ::  Int -&gt; [Int]\nkcomposite k\n  | k &lt; 0 = []\n  | otherwise = [x | x &lt;- [1..], length (factors x) == (k + 2)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506518780, "post_id": 46430504, "comment_id": 79853819, "body": "... and why 5? because 7 is prime, and so can only be got at through the n^6 numbers, i.e. those with just <i>one</i> prime factor."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506536439, "post_id": 46430504, "comment_id": 79864907, "body": "@Will Ness Sorry... I am unsure what you mean... These 5 factors that we are after are not prime but largest ones.Numbers with 7 factors are plenty while finding a number with 9 factors seems to be even harder than finding one with 5. As a side note..  for a number to have odd numbers of factors it has to have a perfect integer square root."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506540373, "post_id": 46430504, "comment_id": 79867074, "body": "if a number has <i>prime</i> factorization <code>p^a*q^b*r^c*...</code>, its total number of divisors is <code>product [a+1,b+1,c+1,...]</code>, including 1 and itself. So if it has 5 = 7-2 divisors excluding 1 and itself, it must be that <code>product [a+1,b+1,c+1,...] = 7</code>, but 7 is prime, so there can be only one entry in that list, <code>product [a+1] = (a+1) = 7</code> thus <code>a=6</code> and the prime factorization is <code>p^6</code> for some prime <code>p</code>. // for 7 factors, excluding, it is <code>product [a+1,b+1,c+1,...] = 9</code> for example <code>3*3 = 9</code> for a factorization of <code>p^2*q^2</code>, or also <code>p^8</code>. // 9 = 11-2, 11 is prime, factorization is <code>p^10</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506540522, "post_id": 46430504, "comment_id": 79867149, "body": "and naturally 10th powers are much more sparse than 6th powers."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1506689773, "post_id": 46430504, "comment_id": 79933003, "body": "@Will Ness Thank you for explanation. I&#39;ve just got time to work out what exactly you mean. So finding numbers with <code>11, 15, 17, 21...  (p - 2)</code>  factors by this algorithm would be hard and wasteful.. Instead we better simply switch the logic to <code>take 5 . map (^(k+1)) $ primes</code> for such number of factors are required. Cool..!"}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1506450850, "last_edit_date": 1506450850, "creation_date": 1506439842, "answer_id": 46430504, "question_id": 46418784, "link": "https://stackoverflow.com/questions/46418784/create-infinite-list-in-haskell-of-k-composite-numbers/46430504#46430504", "title": "Create infinite list in Haskell of k-composite numbers", "body": "<p>Here is my slightly different approach for this task which is much more efficient.</p>\n\n<p>The boosting key is to <strong>not</strong> check all the way to the end but only up to its <strong>square root</strong>. I mean if we want to find composites of 100 we don't need to control all 100 numbers. We only need to control up to <code>sqrt 100</code> (like <code>[2..10]</code>) to see <code>(mod 100 x) == 0</code>. We start from 2 since you don't want 1 and the number itself. Once we have the satisfying numbers <code>100 div x</code> should give us the other one. So if 2 is a composite then <code>100 div 2</code> (50) is another one like 4 yields 25 and 5 yields 20. Of course when we come to 10 it will give us another 10 and we will only evaluate one of them. Cool..!</p>\n\n<p>So this is the code</p>\n\n<pre><code>kcomposites :: Int -&gt; [Int]\nkcomposites k = \n  let factors n = concat [bool [x, n `div` x] [x] (x^2 == n) \n                          | x &lt;- [2..limit], n `mod` x == 0]\n          where limit = truncate . sqrt . realToFrac $ n\n  in foldr (\\n rs -&gt; bool rs (n:rs) (k == (length . factors $ n))) [] [2..]\n</code></pre>\n\n<p>Here is this code's performance for k = 19 for first 5 elements;</p>\n\n<pre><code>*Main&gt; take 5 . kcomposites $ 19\n[576,1600,2916,3136,7744]\n(0.43 secs, 174,826,272 bytes)\n</code></pre>\n\n<p>and here is your code's performance for k = 19 for first 5 elements;</p>\n\n<pre><code>*Main&gt; take 5 . kcomposite $ 19\n[576,1600,2916,3136,7744]\n(17.61 secs, 6,246,022,504 bytes)\n</code></pre>\n\n<p>Note: I wouldn't advice checking for k = 5 for 5 elements. Even this code took like 15 minutes to come up with <code>[64,729,15625,117649,1771561]</code> the above code will probably take a crazy amount of time (like a day or more perhaps).</p>\n\n<p>Lets compare them with <code>take 3</code>.</p>\n\n<pre><code>*Main&gt; take 3 . kcomposites $ 5\n[64,729,15625]\n(1.14 secs, 472,228,880 bytes)\n\n*Main&gt; take 3 . kcomposite $ 5\n[64,729,15625]\n(69.84 secs, 25,409,801,688 bytes)\n</code></pre>\n"}], "owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "accepted_answer_id": 46419054, "answer_count": 2, "score": 3, "last_activity_date": 1506450850, "creation_date": 1506405333, "question_id": 46418784, "link": "https://stackoverflow.com/questions/46418784/create-infinite-list-in-haskell-of-k-composite-numbers", "title": "Create infinite list in Haskell of k-composite numbers", "body": "<p>A k-composite number is a composite number with k factors excluding 1 and itself.  I'm trying to write code that will take in an integer k and return an infinite list of all k-composites. So using take 5 $ kcomposite 2 will return [6,8,10,14,15].  I wrote two functions to accomplish this:</p>\n\n<pre><code>factors :: Int -&gt; [Int]\nfactors n = [x | x &lt;- [1..n], n `mod` x == 0]\n\nkcomposite ::  Int -&gt; [Int]\nkcomposite n = [x | x &lt;- [1..], (length (factors n)) == (x-2)]\n</code></pre>\n\n<p>I have no trouble compiling, but when I try to run them, the ghci never stops running. This makes sense because of the infinite list, but this happens even when I only try to get the first few elements in the list, like in the above example.  I can't understand what I'm doing wrong.</p>\n"}, {"tags": ["haskell", "types", "monads"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 6, "creation_date": 1506368365, "post_id": 46412916, "comment_id": 79783663, "body": "No. <code>putStrLn</code> has type <code>String -&gt; IO ()</code>, so your assumption is incorrect."}, {"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 2, "creation_date": 1506368648, "post_id": 46412916, "comment_id": 79783819, "body": "putStrln has the following Type: <code>putStrLn :: String -&gt; IO ()</code>. This is also intuitively correct, since we dont expect a String back, we simply want the IO effect of printing to console."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1506376738, "post_id": 46413256, "comment_id": 79787501, "body": "And three, it wouldn&#39;t compile if <code>main :: IO ()</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1506378024, "post_id": 46413256, "comment_id": 79787937, "body": "@ThomasM.DuBuisson Ah, good point! One could imagine the compiler adding <code>&gt;&gt; return ()</code> but only when <code>main :: IO ()</code>, and your proposed test is a good way to rule that out."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1506369614, "creation_date": 1506369614, "answer_id": 46413256, "question_id": 46412916, "link": "https://stackoverflow.com/questions/46412916/is-there-a-hidden-return-at-the-end-of-every-main-in-haskell/46413256#46413256", "title": "Is there a hidden &quot;&gt;&gt; return ()&quot; at the end of every main in Haskell?", "body": "<p>Actually, <code>putStrLn :: String -&gt; IO ()</code>. So there's nothing magical happening at all.</p>\n\n<p>You can also verify this by writing</p>\n\n<pre><code>main :: IO String\nmain = getLine\n</code></pre>\n\n<p>and observing that this both (1) does compile and (2) couldn't possibly compile if there were an implicit <code>&gt;&gt; return ()</code> inserted into <code>main</code>.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 46413256, "answer_count": 1, "score": -4, "last_activity_date": 1506369614, "creation_date": 1506368245, "question_id": 46412916, "link": "https://stackoverflow.com/questions/46412916/is-there-a-hidden-return-at-the-end-of-every-main-in-haskell", "title": "Is there a hidden &quot;&gt;&gt; return ()&quot; at the end of every main in Haskell?", "body": "<p>How come I can write something like this:</p>\n\n<pre><code>main :: IO ()\nmain = getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>Since <code>getLine :: IO String</code> and <code>putStrLn :: String -&gt; IO String</code> it would seem that the overall type of this action should be <code>IO String</code>. Why does this compile instead of giving a type error? The only reason I can come up with is that at compile time <code>&gt;&gt; return ()</code> is added to the end of the value of <code>main</code>. So what's going on here?</p>\n"}, {"tags": ["haskell", "compiler-errors", "tuples", "size", "compiler-specific"], "comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1506369820, "post_id": 46412823, "comment_id": 79784408, "body": "Tuples of higher-cardinality are not very often used in Haskell, since we prefer to work with structurally (co-)recursive data types. I can&#39;t think of a time when I&#39;ve used anything larger than a 3-tuple; to do so would be a code smell IMHO. GHC&#39;s suggestion is also valid, if you <i>really</i> need a product type with more than 62 fields, it&#39;s going to be worth defining a <code>data</code> record yourself."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1506370012, "post_id": 46412823, "comment_id": 79784493, "body": "Why is there a size limit and why is it 62? Because <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.1.0/docs/src/GHC.Tuple.html#%28%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%29\" rel=\"nofollow noreferrer\">Manuel Chakravarty says</a> that larger tuples cause segmentation faults. Way back in GHC 6, this limit was not present. It would be fun to figure out what has happened since..."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506370189, "post_id": 46412823, "comment_id": 79784586, "body": "@Alec Indeed, I&#39;m aware that this 62-field limit is from GHC 6.12.2 onwards. I may add this to the question. Edit: added"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1506370532, "post_id": 46412823, "comment_id": 79784754, "body": "@AJFarmar I think Alec&#39;s comment contains strictly more content than &quot;this limit is from GHC 6.12.2 onwards&quot; -- it is also a direct answer to the questions you posed. &quot;Why is there a tuple size limit at all?&quot; To avoid segfaults. &quot;Why is the limit specifically at 62?&quot; Because that&#39;s where the segfaults start. (In fact I think he should have posted this as an answer rather than as a comment!)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506370614, "post_id": 46412823, "comment_id": 79784803, "body": "@DanielWagner That&#39;s what I&#39;m asking: why do these faults occur at all? What changed in GHC 6.12.2?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1506371290, "post_id": 46412823, "comment_id": 79785173, "body": "I suspect what changed in ghc 6.12.2 is that someone noticed that if you had a triple of more than 62 things you got a segfault. So the limit was added to prevent this. If we postulate 4 bytes per element in a tuple (ie a 32-bit machine) and a 8 byte header then we could fit the total size of a tuple into one byte (ie up to 256 bytes) perhaps that is the reason for this limit. I don\u2019t know about the internal representation in memory of Haskell types so this is all guesswork. However it would explain segfaults: if a tuple were bigger the header would be corrupted or the gc would get lost."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506371624, "post_id": 46412823, "comment_id": 79785332, "body": "What I find interesting here is that records can easily have more than 62 type variables / fields. So that means that there is some core way in which tuples actually <i>aren&#39;t</i> the record types we are always told they are. That makes me wonder (1) why and (2) how can I take advantage of the difference?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1506375358, "post_id": 46412823, "comment_id": 79787000, "body": "Whatever the reason is i think <b>Workaround: use nested tuples or define a data type</b> is a beautiful tip."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 2, "creation_date": 1506396993, "post_id": 46412823, "comment_id": 79792418, "body": "A post-facto justification:  there are quite a few boilerplate instances of code that creates class instances for all tuple sizes (like <a href=\"https://hackage.haskell.org/package/binary-0.9.0.0/docs/src/Data-Binary-Class.html#line-512\" rel=\"nofollow noreferrer\">Data.Binary</a>) that result in $O(n^2)$ code size where $n$ is the maximum tuple size."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1506387715, "post_id": 46416136, "comment_id": 79790382, "body": "Interesting. Lifting the limit on tuple size sounds like something that shouldn&#39;t be <i>too</i> difficult to do. I might try doing this, just as a way of playing around with GHC internals."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 1, "creation_date": 1507346054, "post_id": 46416136, "comment_id": 80184361, "body": "Bravo. I hope your work gets included in a book on the history of GHC someday. :D"}, {"owner": {"reputation": 5267, "user_id": 1102851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0e1866c32c13460429d2f9ba066949bc?s=128&d=identicon&r=PG", "display_name": "bgamari", "link": "https://stackoverflow.com/users/1102851/bgamari"}, "edited": false, "score": 2, "creation_date": 1507419829, "post_id": 46416136, "comment_id": 80202871, "body": "I&#39;m not sure this is quite so simple. The problem is that you need <i>one</i> place to declare the necessary info tables. If you regenerate them in every module you need them all sorts of things will break (e.g. profiling). I suppose you might be able to lean on the linker to eliminate the duplicate tables but this isn&#39;t currently something that we do."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 35, "last_activity_date": 1506387755, "last_edit_date": 1506387755, "creation_date": 1506386368, "answer_id": 46416136, "question_id": 46412823, "link": "https://stackoverflow.com/questions/46412823/why-are-ghc-tuples-limited-to-size-62/46416136#46416136", "title": "Why are GHC tuples limited to size 62?", "body": "<p>I think the speculation re: the timing of this change in the comments is wrong.  First, as far as I can tell, the limit has existed since <strong>LONG</strong> before 6.12.1.  As can be seen in <a href=\"https://ghc.haskell.org/trac/ghc/ticket/98\" rel=\"noreferrer\">Trac #98 from November 2002</a>, in version 5.02.2, the limit was 37 (instead of 62), and trying to use a larger tuple generated a mysterious message:</p>\n\n<pre><code>Switches_tupel.lhs:1:\nFailed to find interface decl for\n`PrelTup.(,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,)'\n    from module `PrelTup'\n</code></pre>\n\n<p>Simon Peyton-Jones fixed the bug by having the compiler check the size earlier in the compilation pipeline and generate a nicer error message (visible in Git commit <a href=\"https://github.com/ghc/ghc/commit/b44c6881743abf8f4c3c0612c482ede8b835ac37\" rel=\"noreferrer\">b44c6881</a>).  By the time this commit was made, the limit had already been increased from 37 to 62 (Git commit 9af77fa4, which integrated Template Haskell work into the HEAD), so GHC 5.04 was released with a 62-tuple limit and a better error message.</p>\n\n<p>I believe the original Trac #98 bug points to the reason for a limit.  In <code>ghc/compiler/prelude/TysWiredIn.hs</code>, a set of tuple type and data constructors is preallocated:</p>\n\n<pre><code>boxedTupleArr, unboxedTupleArr :: Array Int (TyCon,DataCon)\nboxedTupleArr   = listArray (0,mAX_TUPLE_SIZE) [mk_tuple Boxed   i \n                    | i &lt;- [0..mAX_TUPLE_SIZE]]\nunboxedTupleArr = listArray (0,mAX_TUPLE_SIZE) [mk_tuple Unboxed i \n                    | i &lt;- [0..mAX_TUPLE_SIZE]]\n</code></pre>\n\n<p>where <code>mAX_TUPLE_SIZE</code> is the 62-tuple limit in question.  However, the functions that actually <em>use</em> these preallocated arrays are happy to generate bigger constructors on demand (\"Build one specially\"):</p>\n\n<pre><code>tupleTyCon :: Boxity -&gt; Arity -&gt; TyCon\ntupleTyCon sort i | i &gt; mAX_TUPLE_SIZE \n                = fst (mk_tuple sort i)  -- Build one specially\ntupleTyCon Boxed   i = fst (boxedTupleArr   ! i)\ntupleTyCon Unboxed i = fst (unboxedTupleArr ! i)\n</code></pre>\n\n<p>and this is what the compiler used to do before Simon added the error message for 5.04 -- it built one specially.</p>\n\n<p>Unfortunately, this caused an error (not a segfault, just an error) later in the compilation process when the compiler couldn't find an interface definition for the too-large tuple in the list given in <code>ghc/libraries/ghc-prim/GHC/Tuple.hs</code>.  As per the (slightly outdated) comments in <code>TysWiredIn.hs</code> under the heading <code>The tuple types</code>, the declarations in <code>Tuple.hs</code> are used to construct the info tables and entry code for tuple constructors, even though these could theoretically be programmatically generated on the fly for arbitrarily large tuples.</p>\n\n<p>So, what does this mean for modern-day GHC?  Well, for the same technical reasons described above, even though the compiler is prepared to generate arbitrarily large tuples, there's a limit imposed by the fact that they require matching declarations in <code>.../GHC/Tuple.hs</code>.</p>\n\n<p>I ran a few experiments, compiling GHC from source with the tuple length check disabled.  The resulting compiler successfully compiled and ran the following program with a 100-tuple:</p>\n\n<pre><code>a = (False,...,False)  -- imagine 100 Falses\nmain = let (x,_,...,_) = a\n       in print x\n</code></pre>\n\n<p>and it printed \"False\".  It worked fine when I modified it to grab the last element of the same tuple:</p>\n\n<pre><code>a = (False,...,False)  -- imagine 100 Falses\nmain = let (_,...,_,x) = a\n       in print x\n</code></pre>\n\n<p>However, the program:</p>\n\n<pre><code>a = (False,...,False)  -- imagine 100 Falses\nmain = let (x,_,...,_,y) = a\n       in print (x,y)\n</code></pre>\n\n<p>failed with a linkage error:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( Tuple.hs, Tuple.o )\nLinking Tuple ...\nTuple.o(.data+0x0): error: undefined reference to 'ghczmprim_GHCziTuple_Z100T_con_info'\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>I suspect that for the first two programs, the compiler optimized away the reference to the missing constructor, but the final program needed it.  After I added a declaration for a 100-tuple in <code>Tuple.hs</code> and rebuilt the compiler, all three programs compiled and ran fine.</p>\n\n<p>In short, compiling the manually constructed list of tuples in <code>Tuple.hs</code> generates required data structures to support tuples up to size 62, and no one has been sufficiently motivated to re-implement this data structure generation to be independent of the <code>Tuple.hs</code> crutch.  If they did, GHC would probably support tuples of arbitrary size.</p>\n\n<p>As an aside, the note in <code>Tuple.hs</code> about Manuel's segfault (referenced in one of the comments to this question) dates from July 2001, when it was checked into <code>libraries/base/Data/Tuple.hs</code>, so whatever it was about, it had nothing to do with GHC 6.12.1.  This issue is probably the reason the max was set to 62 by Simon, but the limit no longer seems to apply with modern GHC.</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2018, "favorite_count": 4, "accepted_answer_id": 46416136, "answer_count": 1, "score": 21, "last_activity_date": 1506387755, "creation_date": 1506367884, "last_edit_date": 1506370643, "question_id": 46412823, "link": "https://stackoverflow.com/questions/46412823/why-are-ghc-tuples-limited-to-size-62", "title": "Why are GHC tuples limited to size 62?", "body": "<p>From the the <a href=\"https://www.haskell.org/onlinereport/basic.html\" rel=\"noreferrer\">Haskell 98 report</a>:</p>\n\n<blockquote>\n  <p><strong>There is no upper bound on the size of a tuple, but some Haskell implementations may restrict the size of tuples,</strong> and limit the instances associated with larger tuples. However, every Haskell implementation must support tuples up to size 15, together with the instances for Eq, Ord, Bounded, Read, and Show. (...)</p>\n</blockquote>\n\n<p>However, it's well known that GHC does not support tuples of size greater than 62. Here's what happens when I try to create a tuple of size 63 in GHCi:</p>\n\n<pre><code>&lt;interactive&gt;:1:1: error:\n    A 63-tuple is too large for GHC\n      (max size is 62)\n      Workaround: use nested tuples or define a data type\n</code></pre>\n\n<p>I recognise that this is in accordance with the Haskell 98 specification, and also that a tuple of size greater than 62 is likely to be highly unnecessary, but I don't understand why exactly this is as it is in GHC.</p>\n\n<hr>\n\n<p>To summarise:</p>\n\n<ul>\n<li>Why is there a tuple size limit at all?</li>\n<li>Why is the size limit specifically at 62?</li>\n</ul>\n\n<p>In addition:</p>\n\n<ul>\n<li>Why is this the case only from GHC 6.12.2 and onwards?</li>\n<li>Do other prominent Haskell implementations do this? What are their reasons?</li>\n</ul>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1506366048, "post_id": 46412242, "comment_id": 79782416, "body": "This is not doing exactly what you think it is. How about <code>[ replicate n &#39;a&#39; ++ replicate n &#39;b&#39; | n &lt;- [1..] ]</code>? That seems like the most faithful translation..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1506366221, "post_id": 46412242, "comment_id": 79782521, "body": "&quot;a&quot; is not part of that language."}, {"owner": {"reputation": 31843, "user_id": 1337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72de240484e389dbedb6a3e428b9f0c1?s=128&d=identicon&r=PG", "display_name": "Brad Gilbert", "link": "https://stackoverflow.com/users/1337/brad-gilbert"}, "edited": false, "score": 0, "creation_date": 1521521981, "post_id": 46412242, "comment_id": 85754069, "body": "The direct translation to Perl 6 <code>&#39;ab&#39;,-&gt; \\S { &quot;a{S}b&quot; } \u2026\u00a0*</code>, but what you are trying is more similar to <code>[Z~]\u00a0(&#39;a&#39;\u00a0Xx\u00a01..*),\u00a0(&#39;b&#39;\u00a0Xx\u00a01..*)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 637, "user_id": 6189164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/948078e4d38d4a25a930c9f8ad559cd9?s=128&d=identicon&r=PG&f=1", "display_name": "user6189164", "link": "https://stackoverflow.com/users/6189164/user6189164"}, "edited": false, "score": 0, "creation_date": 1506366547, "post_id": 46412421, "comment_id": 79782710, "body": "Quick followup, I noticed that when I wrote <code>s = [&quot;ab&quot;] ++ [ &quot;a&quot; ++ x ++ &quot;b&quot; | x &lt;- s ]</code> in the ghci, it throws an error, but if I put it in test.hs and then :l test, it works! Do you know what the difference is?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 637, "user_id": 6189164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/948078e4d38d4a25a930c9f8ad559cd9?s=128&d=identicon&r=PG&f=1", "display_name": "user6189164", "link": "https://stackoverflow.com/users/6189164/user6189164"}, "edited": false, "score": 0, "creation_date": 1506366986, "post_id": 46412421, "comment_id": 79782937, "body": "what was the error? did you try using <code>let</code>, like <code>let s = ...</code> (you have to, in the case you have an older version installed)."}, {"owner": {"reputation": 637, "user_id": 6189164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/948078e4d38d4a25a930c9f8ad559cd9?s=128&d=identicon&r=PG&f=1", "display_name": "user6189164", "link": "https://stackoverflow.com/users/6189164/user6189164"}, "edited": false, "score": 0, "creation_date": 1506367679, "post_id": 46412421, "comment_id": 79783309, "body": "ah, it said <code>&lt;interactive&gt;:2:3: parse error on input \u2018=\u2019</code>; but, if you&#39;re right, if I use let it works!"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1506375524, "post_id": 46412421, "comment_id": 79787064, "body": "<code>[&quot;ab&quot;] ++</code> could be written as <code>&quot;ab&quot; :</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1506413858, "post_id": 46412421, "comment_id": 79799532, "body": "@4castle yes, but, it&#39;s one less thing to be dealing with, without the <code>:</code>. another take on it could be, &quot;lists&quot; are <code>[...]</code> and <code>++</code>, on a higher level (i.e. viewed as a monoid); <code>:</code> is an implementational detail (cf. Clojure&#39;s &quot;lists&quot; impl&#39;d as shallow trees). third is, <code>++</code> is what corresponds to <code>|</code> in production rules (not <code>:</code>)."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 8, "last_activity_date": 1506367662, "last_edit_date": 1506367662, "creation_date": 1506366114, "answer_id": 46412421, "question_id": 46412242, "link": "https://stackoverflow.com/questions/46412242/balanced-language-2-non-terminal-symbols-list-comprehension/46412421#46412421", "title": "Balanced Language, 2 Non-Terminal Symbols, List Comprehension", "body": "<p>Working from the production rule,</p>\n\n<pre><code>S -&gt; ab | aSb\n</code></pre>\n\n<p>we could write</p>\n\n<pre><code>s = [\"ab\"] ++ [ \"a\" ++ x ++ \"b\" | x &lt;- s ]\n</code></pre>\n\n<p>so that</p>\n\n<pre><code>~&gt; take 5 s\n[\"ab\",\"aabb\",\"aaabbb\",\"aaaabbbb\",\"aaaaabbbbb\"]\nit :: [[Char]]\n</code></pre>\n\n<p>Your attempt could work with a small edit, </p>\n\n<pre><code>[ x ++ y | x &lt;- [\"a\",\"aa\",..] | y &lt;- [\"b\",\"bb\",..]]\n</code></pre>\n\n<p>so that it uses <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?#parallel-list-comprehensions\" rel=\"nofollow noreferrer\">Parallel List Comprehensions</a> extension (<code>:set -XParallelListComp</code> in GHCi), except for the enumerations. But this is simple to fix,</p>\n\n<pre><code>[ x ++ y | x &lt;- [replicate n 'a' | n &lt;- [1..]] \n         | y &lt;- [replicate n 'b' | n &lt;- [1..]]]\n</code></pre>\n"}], "owner": {"reputation": 637, "user_id": 6189164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/948078e4d38d4a25a930c9f8ad559cd9?s=128&d=identicon&r=PG&f=1", "display_name": "user6189164", "link": "https://stackoverflow.com/users/6189164/user6189164"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 46412421, "answer_count": 1, "score": 5, "last_activity_date": 1506367662, "creation_date": 1506365483, "last_edit_date": 1506365918, "question_id": 46412242, "link": "https://stackoverflow.com/questions/46412242/balanced-language-2-non-terminal-symbols-list-comprehension", "title": "Balanced Language, 2 Non-Terminal Symbols, List Comprehension", "body": "<p>So, I was reading a book, \"An Introduction to Formal Language Theory\" and it describes a language <code>L(G) = {a^n ++ b^n | n &gt; 0}</code>.</p>\n\n<p>It has the following productions:</p>\n\n<pre><code>S -&gt; ab | aSb\n</code></pre>\n\n<p>And so would produce the following language:</p>\n\n<pre><code>a, ab, aabb, aaabbb, ...\n</code></pre>\n\n<p>I was wondering how I could use Haskell's list comprehension to create this language. I know I can do list comprehension with strings, but I'm pretty much of a beginner and wasn't sure how I could get an infinite list like I would like of these strings.</p>\n\n<p>I'm imagining something like:</p>\n\n<pre><code>[ x ++ y | x &lt;- [\"a\",\"aa\",..] y &lt;- [\"b\",\"bb\",..]] \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506349420, "post_id": 46407358, "comment_id": 79772686, "body": "The <i>kinds</i> of type variables in Haskell classes are inferred from how those variables are used in the class declaration. Here, <code>t :: (* -&gt; *) -&gt; * -&gt; *</code> since it needs some <code>m</code> and <code>a</code> applied to it for it to be a type (and <code>m :: * -&gt; *</code> since it needs <code>a</code> applied to it for it to be a type)."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 4, "last_activity_date": 1506350171, "last_edit_date": 1506350171, "creation_date": 1506349470, "answer_id": 46407609, "question_id": 46407358, "link": "https://stackoverflow.com/questions/46407358/why-do-not-monadtrans-the-whole-type/46407609#46407609", "title": "Why do not MonadTrans the whole type?", "body": "<p>First thing to mention is that <code>lift</code> definition uses \"point-free\" style. It is equivalent to</p>\n\n<pre><code>instance MonadTrans (ExceptT e) where\n  lift x = ExceptT (liftM Right x)\n</code></pre>\n\n<p>Now to the question. The expression under <code>instance MonadTrans</code> is <code>(ExceptT e)</code>. This is what substitues <code>t</code> in class declaration. Lets substitute it in <code>lift</code>s signature:</p>\n\n<pre><code>instance MonadTrans (ExceptT e) where\n  --                          (this was t)\n  --                               ||\n  --                               \\/\n  lift :: (Monad m) =&gt; m a -&gt;  ExceptT e   m a\n  lift = ExceptT (liftM Right x)\n</code></pre>\n\n<p>In this expression <code>liftM Right x :: m (Either a b)</code>, which is exactly what <code>ExceptT</code> takes.</p>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 2, "last_activity_date": 1506349998, "last_edit_date": 1506349998, "creation_date": 1506349603, "answer_id": 46407645, "question_id": 46407358, "link": "https://stackoverflow.com/questions/46407358/why-do-not-monadtrans-the-whole-type/46407645#46407645", "title": "Why do not MonadTrans the whole type?", "body": "<p>Because when you fully apply you are left with an expression that stands for a type, but you want to state things about the type function, in this case of kind <code>(* -&gt; *) -&gt; (* -&gt; *)</code>, that is something that takes a monad (<code>* -&gt; *</code> + laws) and produces a monad. Any instance of the class is such a <em>transformer</em> <code>t</code> that given a monad <code>m</code> allows you to <em>lift</em> values <code>m a</code> into values <code>(t m) a</code>. How many arguments you fix determines whether you talk about <em>transformer</em> (no argument supplied), the <em>transformed monad</em> (one argument supplied - the monad you wish the transformer to act on), or a monadic value (both arguments supplied).</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 46407609, "answer_count": 2, "score": 0, "last_activity_date": 1506380332, "creation_date": 1506348858, "last_edit_date": 1506352744, "question_id": 46407358, "link": "https://stackoverflow.com/questions/46407358/why-do-not-monadtrans-the-whole-type", "title": "Why do not MonadTrans the whole type?", "body": "<p>The MonadTrans type is defined as follow:</p>\n\n<pre><code>class MonadTrans t where\n  -- | Lift a computation from the argument monad\n  -- to the constructed monad.\n  lift :: (Monad m) =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>and looking at the implementation of:</p>\n\n<pre><code>instance MonadTrans (ExceptT e) where\n  lift = ExceptT . liftM Right\n</code></pre>\n\n<p>The type constructor of <code>ExceptT</code> has three type variables:</p>\n\n<pre><code>newtype ExceptT e m a =\n  ExceptT { runExceptT :: m (Either e a)) }\n</code></pre>\n\n<p>So the type constructor <code>ExceptT</code> does not get fully applied with types.<br>\nWhy it is possible, not to mention all type variables in the instance implementation of <code>MonadTrans</code> for <code>ExceptT e</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506344764, "post_id": 46405813, "comment_id": 79769345, "body": "I didn&#39;t quite get what&#39;s missing. The <code>a</code> is <code>Int</code> in your case."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506344810, "post_id": 46405813, "comment_id": 79769380, "body": "The <code>MaybeT</code> obtains a type of kind <code>* -&gt; *</code>, and an <code>a</code>, <code>Int</code> and applies <code>a</code> to <code>* -&gt; *</code>."}], "answers": [{"tags": [], "owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "is_accepted": false, "score": 0, "last_activity_date": 1506344899, "creation_date": 1506344899, "answer_id": 46406069, "question_id": 46405813, "link": "https://stackoverflow.com/questions/46405813/type-does-not-get-fully-applied/46406069#46406069", "title": "Type does not get fully applied", "body": "<p>Disclaimer: I am not with my Haskell environment, so this might be utter nonsense.</p>\n\n<p>Put in an explicit type variable for the missing spot on <code>ExceptT</code>:</p>\n\n<pre><code>embedded' :: MaybeT (ExceptT String (ReaderT () IO) a) Int\nembedded' = MaybeT (ExceptT (ReaderT (const (return (Right (Just 1))))))\n</code></pre>\n\n<p>Hopefully the compiler can figure out what <code>a</code> should be!</p>\n\n<p>What you're running into, which shows more obviously in your <code>fullType</code> example, is that it's not possible to give something a type of kind <code>* -&gt; *</code>. Functions, values and so forth all need to have types of kind <code>*</code>.</p>\n\n<p>Currying a type constructor gives you a <code>* -&gt; *</code>, so you have to provide <em>something</em> for all the parameters.</p>\n\n<p>Putting a type parameter in the signature for <code>embedded'</code> makes it kind <code>*</code>, but polymorphic over <code>a</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 3, "last_activity_date": 1506345022, "creation_date": 1506345022, "answer_id": 46406103, "question_id": 46405813, "link": "https://stackoverflow.com/questions/46405813/type-does-not-get-fully-applied/46406103#46406103", "title": "Type does not get fully applied", "body": "<p>You probably got confused by outmost <code>MaybeT</code>. This type is parametrised by 2 arguments of kinds <code>m :: * -&gt; *</code> and <code>a :: *</code>, respectively. So, that <code>ExceptT String (ReaderT () IO)</code> is indeed missing an <code>a</code> because it is an <code>MaybeT</code> first argument and should be of kind <code>* -&gt; *</code>. Had we apply <code>Int</code> to <code>ExceptT</code>, it would turn into <code>*</code> and then it can't be passed to <code>MaybeT</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 46406103, "answer_count": 2, "score": 0, "last_activity_date": 1506345022, "creation_date": 1506344144, "question_id": 46405813, "link": "https://stackoverflow.com/questions/46405813/type-does-not-get-fully-applied", "title": "Type does not get fully applied", "body": "<p>I have following code snippet from haskell book: </p>\n\n<pre><code>embedded' :: MaybeT (ExceptT String (ReaderT () IO)) Int\nembedded' = MaybeT (ExceptT (ReaderT (const (return (Right (Just 1))))))\n</code></pre>\n\n<p>The type signature of <code>ExceptT</code> is as follow: </p>\n\n<pre><code>newtype ExceptT e m a =\n  ExceptT { runExceptT :: m (Either e a)) }\n</code></pre>\n\n<p>Compare the type signature of the <code>embedded'</code> function with <code>ExceptT</code> type constructor:</p>\n\n<pre><code>        ExceptT   e             m                 a\n                  |             |                 |\nMaybeT (ExceptT String   (ReaderT () IO) (**missing here**)  ) Int\n</code></pre>\n\n<p>How can I just leave <code>ExceptT</code> as higher kinded?          </p>\n\n<p>I tried also:</p>\n\n<pre><code>fullType :: ExceptT String []\nfullType = undefined\n</code></pre>\n\n<p>the compiler complains:</p>\n\n<pre><code>* Expecting one more argument to `ExceptT String []'\n  Expected a type, but `ExceptT String []' has kind `* -&gt; *'\n* In the type signature:\n    fullType :: ExceptT String []\n</code></pre>\n\n<p>Failed, modules loaded: none.</p>\n"}, {"tags": ["haskell", "latex", "haskell-diagrams"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506343392, "post_id": 46405488, "comment_id": 79768394, "body": "You can try suspending the process with <code>Ctrl+Z</code>. This may help you to view the temporary file."}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "edited": false, "score": 0, "creation_date": 1506359477, "post_id": 46405488, "comment_id": 79778825, "body": "I tried your <code>test.tex</code> but cannot reproduce the error.  Can you paste the contents of <code>test-diagrams-latex-fig1.hs</code>?"}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "edited": false, "score": 1, "creation_date": 1506359549, "post_id": 46405488, "comment_id": 79778865, "body": "Incidentally, you probably don&#39;t want to use the <code>input</code> flag with the <code>ps</code> or <code>cairo</code> backends (it will cause the contents of the <code>.eps</code> file to be included directly into the LaTeX source which does not make sense).  It is intended for use with the <code>pgf</code> backend.  But in any case that is not what is causing your problem."}, {"owner": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "reply_to_user": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "edited": false, "score": 0, "creation_date": 1506361173, "post_id": 46405488, "comment_id": 79779717, "body": "@brent-yorgey I&#39;ve updated the original post accordingly. Perhaps there&#39;s a problem with my installation. I was having a lot of trouble installing it yesterday and ended up completely removing Haskell from my system and then redownloading the Haskell Platform core and installing with cabal."}], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "edited": false, "score": 0, "creation_date": 1506499635, "post_id": 46437194, "comment_id": 79841169, "body": "Thanks for your help! Indeed, downgrading to GHC 8.0 has fixed the issue, although this certainly isn&#39;t an ideal solution."}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "reply_to_user": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "edited": false, "score": 0, "creation_date": 1506511796, "post_id": 46437194, "comment_id": 79849145, "body": "Sure!  I will add a comment here if we figure out a good way to get it working again on GHC 8.2."}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "reply_to_user": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "edited": false, "score": 1, "creation_date": 1516575029, "post_id": 46437194, "comment_id": 83732065, "body": "This is now fixed in diagrams-builder HEAD: <a href=\"https://github.com/diagrams/diagrams-builder/commit/b44c754c15ab71d3350a6212ff73b3721b3b0e80\" rel=\"nofollow noreferrer\">github.com/diagrams/diagrams-builder/commit/&hellip;</a> .  I will try to put out a new release with this bugfix soon."}], "tags": [], "owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "is_accepted": true, "score": 1, "last_activity_date": 1506476905, "last_edit_date": 1506476905, "creation_date": 1506468135, "answer_id": 46437194, "question_id": 46405488, "link": "https://stackoverflow.com/questions/46405488/parse-error-with-haskell-diagrams-builder/46437194#46437194", "title": "Parse error with Haskell diagrams-builder", "body": "<p>Oh, I think I just figured out what must be wrong, although I'm not sure of the best way to fix it.  The key is this line:</p>\n\n<p><code>/var/folders/2g/_6mplpfn4fl338wr3cj949440000gn/T/Diagram58289-0.hs:3:20: error:</code></p>\n\n<p>Notice that the name of the temporary file is <code>Diagram58289-0.hs</code>.  <code>diagrams-builder</code> calls <code>openTempFile</code> (<a href=\"https://github.com/diagrams/diagrams-builder/blob/master/src/Diagrams/Builder.hs#L210\" rel=\"nofollow noreferrer\">see here</a>) and then uses the base name of the resulting file as the name of the module.  So the contents of <code>Diagram58289-0.hs</code> must look something like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nmodule Diagram58289-0 where\n\ndia = circle 1\n</code></pre>\n\n<p>The problem is that a hyphen is not valid in a module name, hence the parse error (sure enough, it is in column 20 on line 3).</p>\n\n<p>Although the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/System-IO.html#v:openTempFile\" rel=\"nofollow noreferrer\">documentation for <code>openTempFile</code></a> says the created file will have a name of the form \"<code>fooXXX.ext</code> where XXX is some random number\", obviously that is not what is happening here.  And indeed, it looks like the <a href=\"https://github.com/ghc/ghc/commit/ad617a3edf832b5368146e0bbf0cf2780d9355e1\" rel=\"nofollow noreferrer\">behavior of <code>openTempFile</code> changed recently</a>; now it will always include a hyphen.  I'm guessing this behavior changed in <code>base-4.10</code>, so it will show up for anyone using GHC 8.2.</p>\n\n<p>I have <a href=\"https://github.com/diagrams/diagrams-builder/issues/32\" rel=\"nofollow noreferrer\">created an issue on the <code>diagrams-builder</code> issue tracker</a> to keep track of this problem.  For now, one solution would be to downgrade to GHC 8.0, but that may not be a very attractive option.</p>\n"}], "owner": {"reputation": 293, "user_id": 3926155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bae4f76436f8feaa99fe75612fcf97?s=128&d=identicon&r=PG", "display_name": "Noah Halford", "link": "https://stackoverflow.com/users/3926155/noah-halford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 46437194, "answer_count": 1, "score": 1, "last_activity_date": 1506476905, "creation_date": 1506343134, "last_edit_date": 1506361006, "question_id": 46405488, "link": "https://stackoverflow.com/questions/46405488/parse-error-with-haskell-diagrams-builder", "title": "Parse error with Haskell diagrams-builder", "body": "<p>I'm trying to use the diagrams-builder package with LaTeX in order to generate diagrams in line. Following the tutorial <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/doc/latex.html#running\" rel=\"nofollow noreferrer\">here</a>, I have a file called <code>test.tex</code> with the following contents:</p>\n\n<pre><code>\\documentclass[10pt]{article}\n\n\\usepackage[backend=ps, extension=eps, outputdir=diagrams]{diagrams-latex}\n\\usepackage{graphicx}\n\n\\begin{document}\n\\begin{diagram}[width=300,height=200]\n{-# LANGUAGE FlexibleContexts #-}\ndia = circle 1 \n\\end{diagram}\n\n\\end{document}\n</code></pre>\n\n<p>I created an empty directory called <code>diagrams</code> and tried to compile, only to be told that there is a parse error in what looks to be a file automatically generated by <code>diagrams-builder-ps</code>.</p>\n\n<pre><code>$ pdflatex --enable-write18 --shell-escape test.tex\nThis is pdfTeX, Version 3.14159265-2.6-1.40.17 (TeX Live 2016) (preloaded format=pdflatex)\n \\write18 enabled.\nentering extended mode\n(./test.tex\nLaTeX2e &lt;2016/03/31&gt;\nBabel &lt;3.9r&gt; and hyphenation patterns for 83 language(s) loaded.\n(/usr/local/texlive/2016/texmf-dist/tex/latex/base/article.cls\nDocument Class: article 2014/09/29 v1.4h Standard LaTeX document class\n(/usr/local/texlive/2016/texmf-dist/tex/latex/base/size10.clo))\n(/Users/nhalford/Library/texmf/tex/diagrams-latex.sty\n(/usr/local/texlive/2016/texmf-dist/tex/latex/moreverb/moreverb.sty\n(/usr/local/texlive/2016/texmf-dist/tex/latex/tools/verbatim.sty))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/xkeyval/xkeyval.sty\n(/usr/local/texlive/2016/texmf-dist/tex/generic/xkeyval/xkeyval.tex\n(/usr/local/texlive/2016/texmf-dist/tex/generic/xkeyval/xkvutils.tex\n(/usr/local/texlive/2016/texmf-dist/tex/generic/xkeyval/keyval.tex))))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/base/ifthen.sty))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/graphics/graphicx.sty\n(/usr/local/texlive/2016/texmf-dist/tex/latex/graphics/graphics.sty\n(/usr/local/texlive/2016/texmf-dist/tex/latex/graphics/trig.sty)\n(/usr/local/texlive/2016/texmf-dist/tex/latex/graphics-cfg/graphics.cfg)\n(/usr/local/texlive/2016/texmf-dist/tex/latex/pdftex-def/pdftex.def\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/infwarerr.sty)\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/ltxcmds.sty))))\nNo file test.aux.\n(/usr/local/texlive/2016/texmf-dist/tex/context/base/mkii/supp-pdf.mkii\n[Loading MPS to PDF converter (version 2006.09.02).]\n) (/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/pdftexcmds.sty\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/ifluatex.sty)\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/ifpdf.sty))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/epstopdf-base.sty\n(/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/grfext.sty\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/kvdefinekeys.sty))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/kvoptions.sty\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/kvsetkeys.sty\n(/usr/local/texlive/2016/texmf-dist/tex/generic/oberdiek/etexcmds.sty)))\n(/usr/local/texlive/2016/texmf-dist/tex/latex/latexconfig/epstopdf-sys.cfg))\nOpening diagrams-latex stream diagrams/test-diagrams-latex-fig1.hs Error while compiling diagrams/test-diagrams-latex-fig1.hs\n/var/folders/2g/_6mplpfn4fl338wr3cj949440000gn/T/Diagram58258-0.hs:3:20: error:\n    parse error on input \u2018-\u2019\n\n\n\nPackage diagrams-latex Warning: Conversion of diagrams/test-diagrams-latex-fig1\n.hs failed.\n\n\nPackage diagrams-latex Warning: Please convert diagrams/test-diagrams-latex-fig\n1.hs manually.\n\n(./test.aux) )\nNo pages of output.\nTranscript written on test.log.\n</code></pre>\n\n<p>I also get this error when attempting to run <code>diagrams-builder-ps</code> or <code>diagrams-builder-cairo</code> on the <code>.hs</code> file directly:</p>\n\n<pre><code>$ cd diagrams\n$ ls\ntest-diagrams-latex-fig1.hs\n$ diagrams-builder-ps -w 300 -h 200 test-diagrams-latex-fig1.hs\nError while compiling test-diagrams-latex-fig1.hs\n/var/folders/2g/_6mplpfn4fl338wr3cj949440000gn/T/Diagram58289-0.hs:3:20: error:\n    parse error on input \u2018-\u2019\n\n$ diagrams-builder-cairo -w 300 -h 200 test-diagrams-latex-fig1.hs\nError while compiling test-diagrams-latex-fig1.hs\n/var/folders/2g/_6mplpfn4fl338wr3cj949440000gn/T/Diagram58294-0.hs:3:20: error:\n    parse error on input \u2018-\u2019\n\n$ cat test-diagrams-latex-fig1.hs\n{-# LANGUAGE FlexibleContexts #-}\ndia = circle 1\n$\n</code></pre>\n\n<p>Unfortunately the system deletes the temporary <code>.hs</code> file with the parse error immediately, so I'm unable to examine that file to see what exactly is causing this problem.</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "edited": false, "score": 0, "creation_date": 1506338042, "post_id": 46403798, "comment_id": 79764807, "body": "Right, I can not add a list of type [a] to another of type [[a]], but I can add together two lists of type [[a]]. Thank you!"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "edited": false, "score": 0, "creation_date": 1506338114, "post_id": 46403798, "comment_id": 79764862, "body": "@Salviati, consider accepting the answer if it was helpful. You are welcome"}, {"owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "edited": false, "score": 0, "creation_date": 1506338196, "post_id": 46403798, "comment_id": 79764911, "body": "Absolutely. But there is a wait period of about 7 minutes. Hold on tight."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 5, "last_activity_date": 1506337843, "creation_date": 1506337843, "answer_id": 46403798, "question_id": 46403730, "link": "https://stackoverflow.com/questions/46403730/add-a-list-into-the-front-and-back-of-a-list-of-list/46403798#46403798", "title": "Add a list into the front and back of a list of list", "body": "<p>Using <code>types</code> always makes everything clearer:</p>\n\n<pre><code>funk :: [[Int]] -&gt; [[Int]]\nfunk listOfList = [[1,2,3]] ++ listOfList ++ [[1,2,3]]\n</code></pre>\n\n<p>If you use <code>(++)</code> for <code>[Int]</code> the result will be an <code>[Int]</code> too, so you actually want to use <code>(++)</code> for <code>[[Int]]</code> hence you need to use it with <code>[[1,2,3]]</code></p>\n"}], "owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 46403798, "answer_count": 1, "score": 1, "last_activity_date": 1506338208, "creation_date": 1506337613, "question_id": 46403730, "link": "https://stackoverflow.com/questions/46403730/add-a-list-into-the-front-and-back-of-a-list-of-list", "title": "Add a list into the front and back of a list of list", "body": "<p>Example. I have a list, say [1,2,3], and I want to append it to a list of list so it looks like this.</p>\n\n<pre><code>[[5,5,5],[6,6,6]] -&gt; [[1,2,3],[5,5,5],[6,6,6],[1,2,3]]\n</code></pre>\n\n<p>How do I accomplish this? I can not do something like this</p>\n\n<pre><code>funk listOfList = [1,2,3] ++ listOfList ++ [1,2,3]\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>funk [listOfList] = [[1,2,3], listOfList, [1,2,3]]\n</code></pre>\n\n<p>To be honest, I have no idea.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "edited": false, "score": 0, "creation_date": 1506335106, "post_id": 46402850, "comment_id": 79763036, "body": "Higher order functions take functions as function parameters"}, {"owner": {"reputation": 3892, "user_id": 1236045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cdfcff173a4487d2a73a29e177930ec?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Politowski", "link": "https://stackoverflow.com/users/1236045/micha%c5%82-politowski"}, "edited": false, "score": 2, "creation_date": 1506336220, "post_id": 46402850, "comment_id": 79763691, "body": "Could you better define what&#39;s confusing you? You can pass eg. <code>(bar 7 + 3)</code> as an argument to an apropriately typed function <code>foo</code>. <i>Why</i> couldn&#39;t you pass <code>(x &gt;&gt;= baz z)</code> as the argument to another appropriately typed function?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506336726, "post_id": 46402850, "comment_id": 79764006, "body": "<code>do</code> is not syntactical sugar for <code>&gt;&gt;=</code> itself."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506336738, "post_id": 46402850, "comment_id": 79764015, "body": "I do not understand the code, that I post it above."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506336899, "post_id": 46402850, "comment_id": 79764118, "body": "The type signature of <code>get</code> is <code>RoutePattern -&gt; ActionM () -&gt; ScottyM ()</code>, why can I pass a <code>do</code> block instead of  <code>ActionM ()</code> type?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1506337087, "post_id": 46402850, "comment_id": 79764241, "body": "@zero_coding It&#39;s not instead of. The <code>do</code> block has the type <code>ActionM ()</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506339152, "post_id": 46402850, "comment_id": 79765494, "body": "Could someone give me a simple example?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1506364771, "post_id": 46402850, "comment_id": 79781738, "body": "You say you understand it, but you clearly do not. You only understand that <code>do</code> syntax is syntactic sugar for <i>something</i>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1506339694, "creation_date": 1506339694, "answer_id": 46404375, "question_id": 46402850, "link": "https://stackoverflow.com/questions/46402850/understand-do-statement-as-parameter/46404375#46404375", "title": "Understand do statement as parameter", "body": "<p>Let's define</p>\n\n<pre><code>twice :: IO () -&gt; IO ()\ntwice a = do\n   a\n   a\n</code></pre>\n\n<p>...or in short <code>twice a = a&gt;&gt;a</code>.</p>\n\n<p>You can certainly use this like</p>\n\n<pre><code>Prelude&gt; twice (putStrLn \"hello\")\nhello\nhello\n</code></pre>\n\n<p>...but Haskellers prefer to save parens and write <code>twice $ putStrLn \"hello\"</code>.</p>\n\n<p>You can also use it like</p>\n\n<pre><code>Prelude&gt; twice $ putStrLn \"hello\" &gt;&gt; putStrLn \"world\"\nhello\nworld\nhello\nworld\n</code></pre>\n\n<p>Now, that monadic sequence can be converted to a do block:</p>\n\n<pre><code>Prelude&gt; twice $ do{putStrLn \"hello\"; putStrLn \"world\"}\n</code></pre>\n\n<p>and with layout instead of braces&amp;semicolons, this looks thus:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| twice $ do\nPrelude|    putStrLn \"hello\"\nPrelude|    putStrLn \"world\"\nPrelude| :}\nhello\nworld\nhello\nworld\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1506365222, "creation_date": 1506365222, "answer_id": 46412173, "question_id": 46402850, "link": "https://stackoverflow.com/questions/46402850/understand-do-statement-as-parameter/46412173#46412173", "title": "Understand do statement as parameter", "body": "<p><a href=\"http://www.haskellforall.com/2014/10/how-to-desugar-haskell-code.html\" rel=\"nofollow noreferrer\">http://www.haskellforall.com/2014/10/how-to-desugar-haskell-code.html</a> provides several examples to show how various <code>do</code> expressions are desugared. </p>\n\n<p>The single expression</p>\n\n<pre><code>do\n  beam &lt;- param \"word\"\n  putStrLn \"hello\"\n  html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]\n</code></pre>\n\n<p>is first recursively desugared into multiple nested expressions:</p>\n\n<pre><code>do\n  beam &lt;- param \"word\"\n  do putStrLn \"hello\"\n     html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]  \n</code></pre>\n\n<p>The inner one desugars using the <code>&gt;&gt;</code> operator:</p>\n\n<pre><code>do\n  beam &lt;- param \"word\"\n  (putStrLn \"hello\" &gt;&gt; html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"])\n</code></pre>\n\n<p>The resulting expression desugars using <code>&gt;&gt;=</code>:</p>\n\n<pre><code>param \"word\" &gt;&gt;= (\\beam -&gt; (putStrLn \"hello\" &gt;&gt; html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"])\n</code></pre>\n\n<p><em>This</em> expression is what is seen as the argument to <code>get \"/:word\"</code>:</p>\n\n<pre><code>main = scotty 3000 $ do\n  get \"/:word\" $ param \"word\" &gt;&gt;= (\\beam -&gt; (putStrLn \"hello\" &gt;&gt; html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"])\n</code></pre>\n\n<p>The last remaining <code>do</code> expression trivially desugars to</p>\n\n<pre><code>main = scotty 3000 $ get \"/:word\" $ param \"word\" &gt;&gt;= (\\beam -&gt; (putStrLn \"hello\" &gt;&gt; html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"])\n</code></pre>\n\n<p>as a single line <code>do</code> expression is just the wrapped expression itself (<code>do x = x</code>).</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 46404375, "answer_count": 2, "score": 0, "last_activity_date": 1506365222, "creation_date": 1506334775, "question_id": 46402850, "link": "https://stackoverflow.com/questions/46402850/understand-do-statement-as-parameter", "title": "Understand do statement as parameter", "body": "<p>I have following code snippet: </p>\n\n<pre><code>  main = scotty 3000 $ do\n    get \"/:word\" $ do\n      beam &lt;- param \"word\"\n      putStrLn \"hello\"\n      html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]  \n</code></pre>\n\n<p>I do understand, how <code>do</code> statement works, it is just a syntax sugar for <code>&gt;&gt;=</code>, but the example above, how can it be, that I can pass <code>do</code> block as function parameter?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506329829, "post_id": 46401076, "comment_id": 79759541, "body": "You forget the <code>return</code>. <code>return</code> is <i>not</i> a keyword: it is a function: <code>return :: Monad m =&gt; a -&gt; m a</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1506329902, "post_id": 46401076, "comment_id": 79759584, "body": "You are right. The compiler will not infer <i>this</i> type signature. It will infer a much more general one. <i>You</i> supply a less general signature to tell the compiler &quot;hey, I know what I&#39;m doing, I want this&quot;."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506330541, "post_id": 46401076, "comment_id": 79760027, "body": "But how to imaging, how does it works?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1506330702, "post_id": 46401076, "comment_id": 79760156, "body": "How does <i>what</i> work?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1506331757, "post_id": 46401076, "comment_id": 79760922, "body": "There is not much that works. <code>MaybeT (ExceptT String (ReaderT () IO))</code> is a monad. SO <code>MaybeT (ExceptT String (ReaderT () IO)) Int</code> is a <code>Monad m =&gt; m Int</code>. So since the function has a <code>return 1</code>, it calls the <code>return</code> associated with <code>MaybeT (ExceptT String (ReaderT () IO))</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1506338031, "post_id": 46401076, "comment_id": 79764802, "body": "There is no type inference here. You&#39;ve told the compiler what type <code>embedded</code> has; <code>return</code> will simply produce a value of that type, based on the definition of <code>return</code> <i>for</i> that type."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 10, "last_activity_date": 1506339836, "creation_date": 1506339836, "answer_id": 46404434, "question_id": 46401076, "link": "https://stackoverflow.com/questions/46401076/type-inference-seems-like-a-magic/46404434#46404434", "title": "Type inference seems like a magic", "body": "<p>The choice of wording is a bit unfortunate. It's not the case that the expression <code>return 1</code> <em>gives back</em> the type signature <code>MaybeT (ExceptT String (ReaderT () IO)) Int</code>.</p>\n\n<p>As <em>n.m.</em> writes in the comments, if you don't supply a type, the expression is much more general:</p>\n\n<pre><code>Prelude&gt; embedded = return 1\nPrelude&gt; :type embedded\nembedded :: (Num a, Monad m) =&gt; m a\n</code></pre>\n\n<p>By annotating with a type, you explicitly state that you want something less general than that.</p>\n\n<p>Specifically, you state that you want the type <code>MaybeT (ExceptT String (ReaderT () IO)) Int</code>.</p>\n\n<p>How does <code>return</code> work? <code>MaybeT m a</code> is a <code>Monad</code> when <code>m</code> is a <code>Monad</code>, and <code>return</code> is defined like this:</p>\n\n<pre><code>return = lift . return\n</code></pre>\n\n<p>The right-hand <code>return</code> is the <code>return</code> function that belongs to the 'inner' <code>Monad</code>, whereas <code>lift</code> is defined by <code>MonadTrans</code> and lifts the underlying monadic value up to <code>MaybeT</code>.</p>\n\n<p>That explains how a <code>MaybeT</code> value is created, but isn't the whole story.</p>\n\n<p>In this case, the 'inner' <code>Monad</code> is <code>ExceptT String (ReaderT () IO)</code>, which is another <code>Monad</code> (in fact, another <code>MonadTrans</code>). <code>return</code> is defined like this:</p>\n\n<pre><code>return a = ExceptT $ return (Right a)\n</code></pre>\n\n<p>Notice that this is another nested <code>return</code>, where the right-hand <code>return</code> belongs to yet another nested <code>Monad</code>.</p>\n\n<p>In this case, the nested <code>Monad</code> is <code>ReaderT () IO</code> - another <code>MonadTrans</code>. It defines <code>return</code> like this:</p>\n\n<pre><code>return   = lift . return\n</code></pre>\n\n<p>Yet another nested <code>return</code>, where the right-hand <code>return</code> is the <code>return</code> defined for <code>IO</code> (in this particular case).</p>\n\n<p>All of this is parametrised with <code>a</code>, which in this case you've constrained to <code>Int</code>.</p>\n\n<p>So <code>return 1</code> first takes the pure value <code>1</code> and packages it in <code>IO Int</code>. This then gets lifted to <code>ReaderT () IO Int</code>, which again gets packaged into an <code>ExceptT String (ReaderT () IO) Int</code>. Finally, this values gets lifted to <code>MaybeT</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 46404434, "answer_count": 1, "score": 3, "last_activity_date": 1506339836, "creation_date": 1506329233, "question_id": 46401076, "link": "https://stackoverflow.com/questions/46401076/type-inference-seems-like-a-magic", "title": "Type inference seems like a magic", "body": "<p>I have following code snippet and could not configure it out, how it works:</p>\n\n<pre><code>embedded :: MaybeT (ExceptT String (ReaderT () IO)) Int\nembedded = return 1\n</code></pre>\n\n<p>How it is possible to give only a number and get such as type signature back? How does the compiler do that? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1506335242, "creation_date": 1506335242, "answer_id": 46402988, "question_id": 46400679, "link": "https://stackoverflow.com/questions/46400679/how-to-wrap-it-up/46402988#46402988", "title": "How to wrap it up?", "body": "<p>You have defined a <code>MaybeT (ExceptT String (Reader ())) Int</code>. You've missed the innermost layer, <code>IO</code>. Unlike the others, <code>IO</code> doesn't have a concrete representation, but you can of course inject pure values into it with <code>return</code> or <code>pure</code> (duh).</p>\n\n<pre><code>embedded' = MaybeT . ExceptT . ReaderT\n           $ (pure .) . const . Right $ Just 1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1506342257, "post_id": 46403024, "comment_id": 79767579, "body": "What does it mean <code>GHC typed holes extension to the rescue</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1506342302, "post_id": 46403024, "comment_id": 79767611, "body": "Uhm. Well, like Chip &amp; Dale. Comes to help you."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1506382815, "post_id": 46403024, "comment_id": 79789140, "body": "Place an _ anywhere in an expression. It is an invalid identifier according to the spec, so it would be an error anyway. GHC takes the liberty of inferring a type for it and prints that type before causing that error. You build up an expression and put _ wherever you\u2019re unsure, and then you sort of plumb down and let the types write the code, in a vague sense."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 5, "last_activity_date": 1506335411, "creation_date": 1506335411, "answer_id": 46403024, "question_id": 46400679, "link": "https://stackoverflow.com/questions/46400679/how-to-wrap-it-up/46403024#46403024", "title": "How to wrap it up?", "body": "<p>GHC typed holes extension to the rescue! It lets you plumb a <code>_</code> somewhere in your expression and make GHC tell you needed type. So, let's start with</p>\n\n<pre><code>:t MaybeT (ExceptT (ReaderT (const _)))\n\n&lt;interactive&gt;:1:33: error:\n    * Found hole: _ :: m (Either e (Maybe a))\n</code></pre>\n\n<p>Now we need a value of <code>ReaderT () (Either e (Maybe a))</code>. Plumbing <code>_</code> over and over we finally arrive at value</p>\n\n<pre><code>embedded = MaybeT (ExceptT (ReaderT (const (return (Right (Just 1))))))\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 46403024, "answer_count": 2, "score": 1, "last_activity_date": 1506335411, "creation_date": 1506328017, "question_id": 46400679, "link": "https://stackoverflow.com/questions/46400679/how-to-wrap-it-up", "title": "How to wrap it up?", "body": "<p>I have following code snippet from the haskellbook that shows step by step, how monad transformer is going to unwrap:  </p>\n\n<pre><code>module OuterInner where\n\n  import Control.Monad.Trans.Except\n  import Control.Monad.Trans.Maybe\n  import Control.Monad.Trans.Reader\n\n  -- We only need to use return once\n  -- because it's one big Monad\n  embedded :: MaybeT (ExceptT String (ReaderT () IO)) Int\n  embedded = return 1\n\n  maybeUnwrap :: ExceptT String (ReaderT () IO) (Maybe Int)\n  maybeUnwrap = runMaybeT embedded\n\n  -- Next\n  eitherUnwrap :: ReaderT () IO (Either String (Maybe Int))\n  eitherUnwrap = runExceptT maybeUnwrap\n\n  -- Lastly\n  readerUnwrap :: () -&gt; IO (Either String (Maybe Int))\n  readerUnwrap = runReaderT eitherUnwrap\n</code></pre>\n\n<p>There is an exercise, that I have to wrap everything again: </p>\n\n<pre><code>embedded :: MaybeT (ExceptT String (ReaderT () IO)) Int\nembedded = ??? (const (Right (Just 1))) \n</code></pre>\n\n<p>I tried as follows: </p>\n\n<pre><code>embedded' :: MaybeT (ExceptT String (ReaderT () IO)) Int\nembedded' = MaybeT (ExceptT (ReaderT (const (Right (Just 1)))))\n</code></pre>\n\n<p>but the compiler complains:</p>\n\n<pre><code>D:\\haskell\\chapter26\\src\\OuterInner.hs:24:15: error:\n    * Couldn't match type `Either a0' with `IO'\n      Expected type: MaybeT (ExceptT String (ReaderT () IO)) Int\n        Actual type: MaybeT (ExceptT String (ReaderT () (Either a0))) Int\n    * In the expression:\n        MaybeT (ExceptT (ReaderT (const (Right (Just 1)))))\n      In an equation for embedded':\n          embedded' = MaybeT (ExceptT (ReaderT (const (Right (Just 1)))))\n\nD:\\haskell\\chapter26\\src\\OuterInner.hs:24:32: error:\n    * Couldn't match type `Maybe Integer'\n                     with `Either String (Maybe Int)'\n      Expected type: ReaderT () (Either a0) (Either String (Maybe Int))\n        Actual type: ReaderT () (Either a0) (Maybe Integer)\n    * In the first argument of `ExceptT', namely\n        `(ReaderT (const (Right (Just 1))))'\n      In the first argument of `MaybeT', namely\n        `(ExceptT (ReaderT (const (Right (Just 1)))))'\n      In the expression:\n        MaybeT (ExceptT (ReaderT (const (Right (Just 1)))))\nFailed, modules loaded: none.\n</code></pre>\n\n<p>How to solve the exercise?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1506323801, "creation_date": 1506323801, "answer_id": 46399538, "question_id": 46397802, "link": "https://stackoverflow.com/questions/46397802/how-to-prevent-stack-from-creating-dump-hi-files/46399538#46399538", "title": "How to prevent Stack from creating .dump-hi files?", "body": "<p>The <code>.dump-hi</code> files are in fact needed for Stack to perform correctly. Those files provide information on Template Haskell file dependencies, which are used for dirtiness checking in deciding whether to rebuild.</p>\n\n<p>There is currently no way to disable generating these files, at least as far as I know.</p>\n"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 46399538, "answer_count": 1, "score": 1, "last_activity_date": 1506323801, "creation_date": 1506315004, "question_id": 46397802, "link": "https://stackoverflow.com/questions/46397802/how-to-prevent-stack-from-creating-dump-hi-files", "title": "How to prevent Stack from creating .dump-hi files?", "body": "<p>By default, <code>stack build</code> creates a a directory of .dump-hi files in <code>.stack-work</code>.</p>\n\n<p>In my program, the largest of these files takes 1.9 GB. (Its corresponding .hi files takes only 24 MB.) As far as I understand, these files are totally unnecessary, and this hasn't been helping my build performance.</p>\n\n<p>So, how can I stop <code>stack build</code> from producing them?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 1, "creation_date": 1506313522, "post_id": 46397583, "comment_id": 79752158, "body": "Do you want to pattern-match the result of <code>getVal</code>? Something like <code>case getVal x of { Cokd str ch -&gt; ... }</code>?"}, {"owner": {"reputation": 21, "user_id": 8667632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63d610a7e05546053f9d1e2ddcfe781d?s=128&d=identicon&r=PG&f=1", "display_name": "Hok", "link": "https://stackoverflow.com/users/8667632/hok"}, "reply_to_user": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1506313868, "post_id": 46397583, "comment_id": 79752239, "body": "can i do like in edit post above @ZhekaKozlov"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8667632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63d610a7e05546053f9d1e2ddcfe781d?s=128&d=identicon&r=PG&f=1", "display_name": "Hok", "link": "https://stackoverflow.com/users/8667632/hok"}, "edited": false, "score": 0, "creation_date": 1506313989, "post_id": 46397661, "comment_id": 79752270, "body": "the way i show in the original post seems to compile, will it work? @igor-"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 21, "user_id": 8667632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63d610a7e05546053f9d1e2ddcfe781d?s=128&d=identicon&r=PG&f=1", "display_name": "Hok", "link": "https://stackoverflow.com/users/8667632/hok"}, "edited": false, "score": 0, "creation_date": 1506318781, "post_id": 46397661, "comment_id": 79753784, "body": "it will work as long as you provide <code>1</code>&#39;s to <code>hello</code>. other values will fail. (updated my answer)"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 5, "last_activity_date": 1506318723, "last_edit_date": 1506318723, "creation_date": 1506313934, "answer_id": 46397661, "question_id": 46397583, "link": "https://stackoverflow.com/questions/46397583/haskell-pattern-matching-on-a-function-result/46397661#46397661", "title": "Haskell pattern matching on a function result", "body": "<p>You can use <code>case</code> to pattern-match the result of <code>getVal</code>:</p>\n\n<pre><code>data Toll = Vok Int Bool | Bok Int | Cokd String Char\n\ngetVal :: Int -&gt; Toll\ngetVal 1 = Cokd \"hello\" 'c'\ngetVal _ = Bok 12\n\nhello :: Int -&gt; Bool\nhello x =\n  case getVal x of\n    Cokd st ch -&gt;\n      st == \"hell\"\n    _ -&gt; False\n</code></pre>\n\n<p>Or create a separate function and pattern match the argument:</p>\n\n<pre><code>hello :: Int -&gt; Bool\nhello =\n  helloToll . getVal\n  where\n    helloToll (Cokd st ch) = st == \"hell\"\n    helloToll _ = False\n</code></pre>\n\n<hr>\n\n<p>The example, that you've provided in the question compiles (with few modifications), but it will throw a runtime exception when you try to call <code>hello</code> with <code>2</code> (or any other value different from <code>1</code>, in which case <code>getValue</code> returns <code>Bok 12</code>, thus <code>(Cokd st ch) = getVal x</code> fails to pattern-match).</p>\n"}, {"tags": [], "owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "is_accepted": false, "score": 3, "last_activity_date": 1506314566, "last_edit_date": 1506314566, "creation_date": 1506314220, "answer_id": 46397695, "question_id": 46397583, "link": "https://stackoverflow.com/questions/46397583/haskell-pattern-matching-on-a-function-result/46397695#46397695", "title": "Haskell pattern matching on a function result", "body": "<p>Your code seems totally fine, just one correction: the pattern <code>if &lt;expr&gt; then True else False</code> can be replaced with <code>&lt;expr&gt;</code>.</p>\n\n<pre><code>hello :: Int -&gt; Bool\nhello x = st == \"hell\" where (Cokd st ch) = getVal x\n</code></pre>\n\n<p>However, this code will fail for values other than <code>1</code> due to non-exhaustive pattern matching. You need to cover all cases:</p>\n\n<pre><code>hello :: Int -&gt; Bool\nhello x = case getVal x of\n    Cokd st ch -&gt; st == \"hell\"\n    _ -&gt; False\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8667632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63d610a7e05546053f9d1e2ddcfe781d?s=128&d=identicon&r=PG&f=1", "display_name": "Hok", "link": "https://stackoverflow.com/users/8667632/hok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 983, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1520404397, "creation_date": 1506313294, "last_edit_date": 1520404397, "question_id": 46397583, "link": "https://stackoverflow.com/questions/46397583/haskell-pattern-matching-on-a-function-result", "title": "Haskell pattern matching on a function result", "body": "<p>I have an algebraic data type like:</p>\n\n<pre><code>data Toll = Vok Int Bool | Bok Int | Cokd String Char\n</code></pre>\n\n<p>and another function</p>\n\n<pre><code>getVal :: Int -&gt; Toll\ngetVal 1 = Cokd \"hello\" 'c'\ngetVal _ = Bok 12\n</code></pre>\n\n<p>I want to call <code>getVal</code> in some function and extract the arguments of <code>Cokd</code> (if the answer was of type <code>Cokd</code>) (maybe using pattern matching).</p>\n\n<p>can I do like:</p>\n\n<pre><code>hello :: Int -&gt; Bool\nhello x = if st == \"hell\" then True else False\nwhere (Cokd st ch) = getVal x\n</code></pre>\n\n<p>I cannot use monads.</p>\n\n<p>How to do that?</p>\n"}, {"tags": ["macos", "haskell", "llvm", "macos-sierra"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 8667335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90cb4625d157e091a9c1d59c78c716d6?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Rafay", "link": "https://stackoverflow.com/users/8667335/muhammad-rafay"}, "is_accepted": false, "score": 1, "last_activity_date": 1506308615, "creation_date": 1506308615, "answer_id": 46397035, "question_id": 46396919, "link": "https://stackoverflow.com/questions/46396919/converting-hs-to-llvm-ir-ll-error-ghc-could-not-execute-opt-on/46397035#46397035", "title": "Converting *.hs to llvm ir (*.ll) ---- Error: ghc: could not execute: opt --- on macOS Sierra", "body": "<p>Need to set PATH, CPLUS_INCLUDE_PATH and LD_LIBRARY_PATH</p>\n\n<pre><code># export PATH=/usr/local/opt/llvm/bin:$PATH\n# export CPLUS_INCLUDE_PATH=$(llvm-config --includedir):$CPLUS_INCLUDE_PATH\n# export LD_LIBRARY_PATH=$(llvm-config --libdir):$LD_LIBRARY_PATH \n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8667335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90cb4625d157e091a9c1d59c78c716d6?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Rafay", "link": "https://stackoverflow.com/users/8667335/muhammad-rafay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506308615, "creation_date": 1506307583, "question_id": 46396919, "link": "https://stackoverflow.com/questions/46396919/converting-hs-to-llvm-ir-ll-error-ghc-could-not-execute-opt-on", "title": "Converting *.hs to llvm ir (*.ll) ---- Error: ghc: could not execute: opt --- on macOS Sierra", "body": "<p>ghc -fllvm -keep-llvm-files -fforce-recomp hello.hs</p>\n\n<p>[1 of 1] Compiling Main             ( hello.hs, hello.o )</p>\n\n<p>:\n    Warning: Couldn't figure out LLVM version!\n             Make sure you have installed LLVM\nghc: could not execute: opt</p>\n\n<p>Although the .ll file is generated in the current directory but I still don't get the error.</p>\n"}, {"tags": ["haskell", "types", "io", "file-handling"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506308654, "post_id": 46396821, "comment_id": 79751126, "body": "How about <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hPutStrLn\" rel=\"nofollow noreferrer\"><code>hPutStrLn</code></a>? Then you have <code>mapM_ (hPutStrLn outh) (sort (words string_one))</code>"}, {"owner": {"reputation": 49, "user_id": 5514480, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bVPT0WDjKas/AAAAAAAAAAI/AAAAAAAAAIg/Jf_7zhPxmnQ/photo.jpg?sz=128", "display_name": "Luqman Malik", "link": "https://stackoverflow.com/users/5514480/luqman-malik"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506309655, "post_id": 46396821, "comment_id": 79751371, "body": "That worked perfectly. Thanks! If you don&#39;t mind, can you explain (briefly) why this works?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506322716, "post_id": 46396821, "comment_id": 79755566, "body": "Remember that functions in Haskell are curried, so <code>hPutStrLn outh :: String -&gt; IO ()</code>. Does that help?"}, {"owner": {"reputation": 49, "user_id": 5514480, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bVPT0WDjKas/AAAAAAAAAAI/AAAAAAAAAIg/Jf_7zhPxmnQ/photo.jpg?sz=128", "display_name": "Luqman Malik", "link": "https://stackoverflow.com/users/5514480/luqman-malik"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506357446, "post_id": 46396821, "comment_id": 79777821, "body": "It does. I was (more so) unsure about the effect moving <code>mapM_</code> to the head-position would have on the output. Seeing its type declaration now, I&#39;m beginning to have a better understanding. Thanks, Alec!"}], "owner": {"reputation": 49, "user_id": 5514480, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bVPT0WDjKas/AAAAAAAAAAI/AAAAAAAAAIg/Jf_7zhPxmnQ/photo.jpg?sz=128", "display_name": "Luqman Malik", "link": "https://stackoverflow.com/users/5514480/luqman-malik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1506364979, "creation_date": 1506306841, "last_edit_date": 1506364979, "question_id": 46396821, "link": "https://stackoverflow.com/questions/46396821/how-do-i-write-a-handle-analog-for-mapm-putstrln-as-in-hputstrln-analog-puts", "title": "How do I write a handle-analog for mapM_ putStrLn (as in hPutStrLn -analog- putStrLn)?", "body": "<p>If we let <code>string_one = \"Apple computer Bitcoin\"</code> then the function chain <code>mapM_ putStrLn (sort (words string_one))</code> will output the following column to the screen:</p>\n\n<pre><code>Apple\nBitcoin\ncomputer\n</code></pre>\n\n<p>I need a function that will output in the same manner to an output handle, i.e., each word to its own line in an output.txt file. To the best of my ability am I managing the pure/action nuances, but haven't solved this yet...</p>\n\n<p>The type declaration for <code>mapM_ putStrLn :: [String] -&gt; IO ()</code> so I assume something like <code>hMapm_putStrLn :: Handle -&gt; [String] -&gt; IO ()</code> is reasonable for this purpose, but am not sure how to write the function definition. The final expression that I would like to be able to use should look something like:</p>\n\n<pre><code>hMapm_putStrLn outh (sort (words string_one))\n</code></pre>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1506312570, "post_id": 46396772, "comment_id": 79751946, "body": "An <code>Array</code> is a pure value. You can&#39;t change it. There are operations for creating new arrays representing modifications of old ones, but those are too slow for any non-small arrays. If your arrays really have just ten or so elements, then that&#39;s likely fine, but otherwise you might want to use mutable arrays or pure sequences."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1506309530, "post_id": 46396897, "comment_id": 79751346, "body": "how can i say get the size of bsd? and how can i assign to say index 2 ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1506335910, "post_id": 46396897, "comment_id": 79763501, "body": "@Jhoy <code>bsd &#47;&#47; [(2,False)]</code> to assign at index 2 ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1506336014, "post_id": 46396897, "comment_id": 79763556, "body": "For the size you could do <code>indices bsd</code> which returns the list of indices and then take the length of this list (maybe there&#39;s a better way, I don&#39;t know)."}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1506365973, "post_id": 46396897, "comment_id": 79782368, "body": "<code>bounds bsd</code> gives you min+max index, so you can get length from that. Also <code>MArray</code> or <code>Data.Array.ST</code> are better for scenarios involving lots of mutation."}], "tags": [], "owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "is_accepted": true, "score": 2, "last_activity_date": 1506307431, "creation_date": 1506307431, "answer_id": 46396897, "question_id": 46396772, "link": "https://stackoverflow.com/questions/46396772/cannot-understand-haskell-arrays/46396897#46396897", "title": "Cannot understand haskell arrays", "body": "<p>Using <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-IArray.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-IArray.html</a></p>\n\n<p>This constructs an array of bools from a list. There are tons of other options and functions to use as well</p>\n\n<pre><code>import Data.Array.IArray\nlet bsd = listArray (0, 3) [False, True, True, False] :: Array Int Bool\nelems bsd -- [False,True,True,False]\nbsd -- array (0,3) [(0,False),(1,True),(2,True),(3,False)]\nbsd ! 0 -- Get element at index 0, which is False\n-- Create new array with element 0 changed to True.\nlet bsd2 = bsd // [(0, True)]\nbsd2 -- array (0,3) [(0,True),(1,True),(2,True),(3,False)]\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 46396897, "answer_count": 1, "score": 1, "last_activity_date": 1506307431, "creation_date": 1506306383, "question_id": 46396772, "link": "https://stackoverflow.com/questions/46396772/cannot-understand-haskell-arrays", "title": "Cannot understand haskell arrays", "body": "<p>I cannot understand haskell arrays.</p>\n\n<p>For example I want to create and store an array in variable <code>bsd</code> but what goes in <code>....</code> if I want an array of size eg 10 and of type Bool.</p>\n\n<pre><code>bsd :: Array Int Bool --is this correct?\nbsd = .... --what comes here?\n</code></pre>\n\n<p>Please help me understand...</p>\n\n<p>and what if I want to change a value in <code>bsd</code> at e.g. index 5 what is the syntax</p>\n\n<p>and how can i access a index in <code>bsd</code> ??</p>\n\n<p>please help</p>\n"}, {"tags": ["haskell", "singleton", "dependent-type", "singleton-type"], "comments": [{"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1506412900, "post_id": 46395806, "comment_id": 79798968, "body": "<a href=\"https://blog.jle.im/entry/fixed-length-vector-types-in-haskell.html\" rel=\"nofollow noreferrer\">blog.jle.im/entry/fixed-length-vector-types-in-haskell.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506353390, "post_id": 46396155, "comment_id": 79775421, "body": "<i>size hint has to be something type-level</i> ; That&#39;s what <code>singletons</code> helps with though, right? Perhaps this would be possible with a type family <code>Length</code>, but the root of my question is I&#39;m still a bit uncertain how to move things between type levels, and... Am I mistaken? That&#39;s what <code>singletons</code> does, no?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506356462, "post_id": 46396155, "comment_id": 79777329, "body": "@Josh.F Not quite. <code>singletons</code> uses TH to promote term-level computations into type-level ones, and then machinery to go back down to the corresponding term-level (that&#39;s where the <code>SingI</code> stuff comes in). What it cannot do (since Haskell is not dependently typed) is let you go the other way. Here is a <code>Vec</code>-free formulation of the same problem: try implementing <code>int2Nat :: Int -&gt; SNat n</code>."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506359979, "post_id": 46396155, "comment_id": 79779072, "body": "My intent is to take the <a href=\"https://www.reddit.com/r/haskell/comments/6w79vy/type_tac_toe_advanced_type_safety/\" rel=\"nofollow noreferrer\">TypeTacToe example</a> and make it playable at runtime, which people seemed to indicate was <a href=\"https://www.reddit.com/r/haskell/comments/6w79vy/type_tac_toe_advanced_type_safety/dm82cfl/\" rel=\"nofollow noreferrer\">possible</a>. The key thing to make it work is to get a singleton from runtime data, which this question was meant to be a representative example of. I seem to recall Eisenberg saying that singletons make most dep. types work in haskell, where can I go to learn more about the limitations/usage of singletons?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506360451, "post_id": 46396155, "comment_id": 79779326, "body": "@Josh.F The key insight with the comment you linked is that the input arguments have type <code>Sing a</code>. So this is &quot;runnable&quot;, if you fix at compile time all of the <code>a</code>s! <a href=\"http://cs.brynmawr.edu/~rae/papers/2016/thesis/eisenberg-thesis.pdf\" rel=\"nofollow noreferrer\">Richard Eisenberg&#39;s thesis</a> is a great place to see what can be done today in Haskell (including with singletons) and what could be done in Haskell with his dependent type proposal."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506364011, "post_id": 46396155, "comment_id": 79781319, "body": "Thanks, I&#39;ll plan on reading through that behemoth. Re: <code>Sing</code>, are you saying that it <i>is</i> possible to write <code>fromList :: (?) =&gt; [a] -&gt; Vec a (Sing n)</code>. I&#39;m getting close, but just can&#39;t use this, and don&#39;t quite know what to do about <code>SingI</code>: <code>fromList (SS n) (x:xs) = (Cons x) $ fromList n xs</code> and <code>fromList&#39; = fromList sing</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1506364651, "post_id": 46396155, "comment_id": 79781669, "body": "@Josh.F There simply is no way to lift the term-level length of the input list into a type-level <code>n :: Nat</code>. <code>Sing</code> only lets you go the other direction. What that lets you do (for example), is get the length of a <code>Vec a n</code> without explicitly traversing the <code>Vec</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1506303022, "last_edit_date": 1506303022, "creation_date": 1506299895, "answer_id": 46396155, "question_id": 46395806, "link": "https://stackoverflow.com/questions/46395806/using-haskells-singletons-how-can-i-write-fromlist-a-vec-a-n/46396155#46396155", "title": "Using haskell&#39;s singletons, how can I write `fromList :: [a] -&gt; Vec a n`?", "body": "<p>This is <em>not</em> possible using Haskell because Haskell does not yet have full dependent types (although GHC <a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell\" rel=\"noreferrer\">might in the future</a>). Notice that</p>\n\n<pre><code>fromList :: [a] -&gt; Vec a n\n</code></pre>\n\n<p>Has both <code>a</code> and <code>n</code> quantified universally, which means that the user should be able to pick their <code>n</code> and get back a <code>Vec</code> of the right size. That makes no sense! The trick is that <code>n</code> is not really for the user to choose - it has to be the length of the input list. (For the same reason, <code>fromList :: Integer -&gt; [a] -&gt; Vec a n</code> would not be any more useful - the size hint has to be something type-level.)</p>\n\n<p>Looking to a dependently typed language like Idris, you <em>can</em> define</p>\n\n<pre><code>fromList : (l : List elem) -&gt; Vec (length l) elem\n</code></pre>\n\n<p>And in fact they <a href=\"https://github.com/idris-lang/Idris-dev/blob/master/libs/base/Data/Vect.idr#L178-L181\" rel=\"noreferrer\">define this in the standard library</a>.</p>\n\n<p>So, what <em>can</em> you do? Short of saying that <code>Vec</code> has the length equal to the size of the input list (which requires lifting \"length of the input list\" to the type level), you can say it has <em>some</em> length.</p>\n\n<pre><code>data SomeVec a where { SomeVec :: Vec a n -&gt; SomeVec a }\n\nlist2SomeVec :: [a] -&gt; SomeVec a\nlist2SomeVec [] = SomeVec Nil\nlist2SomeVec (x:xs) = case list2SomeVec xs of\n                        SomeVec ys -&gt; SomeVec (x `Cons` ys)\n</code></pre>\n\n<p>That isn't spectacularly useful, but it is better than nothing.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506394261, "post_id": 46412677, "comment_id": 79791805, "body": "Worth mentioning that these two approaches are completely equivalent and can be defined in terms of each other. <code>list2SomeVec xs = fromList xs SomeVec</code> and <code>fromList xs f = case list2SomeVec xs of { SomeVec v -&gt; f v }</code>."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1506689260, "post_id": 46412677, "comment_id": 79932688, "body": "Is this called skolemization? (or related to it?)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1506694886, "post_id": 46412677, "comment_id": 79936116, "body": "@Josh.F: They\u2019re related. As I understand it, skolemisation gives you a way to eliminate existentials in <i>argument</i> position, converting a rank-n existential to a rank-(n \u2212 1) universal, while CPS conversion lets you eliminate them in <i>return</i> position, converting a rank-n existential to a rank-(n + 1) universal. \u201cSkolemisation\u201d in a typechecker also refers to replacing the quantified variables in a type with fresh type constants, for example when typechecking existentials, or more commonly when checking an inferred type against a declared type signature."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 2, "last_activity_date": 1506382169, "last_edit_date": 1506382169, "creation_date": 1506367266, "answer_id": 46412677, "question_id": 46395806, "link": "https://stackoverflow.com/questions/46395806/using-haskells-singletons-how-can-i-write-fromlist-a-vec-a-n/46412677#46412677", "title": "Using haskell&#39;s singletons, how can I write `fromList :: [a] -&gt; Vec a n`?", "body": "<p>You can do this with an existentially quantified type variable, as in @Alec\u2019s answer, or equivalently by rewriting in continuation-passing style. The trick is to give <code>fromList</code> a <em>continuation</em> (function) that\u2019s polymorphic in the size of the <code>Vec</code>; then, within the continuation, you have access to a type variable representing the size:</p>\n\n<pre><code>data Vec n a where\n  Nil :: Vec Z a\n  Cons :: a -&gt; Vec n a -&gt; Vec (S n) a\n\nderiving instance (Show a) =&gt; Show (Vec n a)\n\nfromList :: [a] -&gt; (forall n. Vec n a -&gt; r) -&gt; r\nfromList [] k = k Nil\nfromList (x : xs) k = fromList xs $ \\ xs' -&gt; k (Cons x xs')\n\n-- fromList [1, 2, 3] show == \"Cons 1 (Cons 2 (Cons 3 Nil))\"\n</code></pre>\n\n<p>You can\u2019t know the actual <em>value</em> of <code>n</code>, because it\u2019s not available at compile time.</p>\n\n<p>If you replace your <code>Nat</code> with the one from <code>GHC.TypeLits</code>, I think you can get a <code>KnownNat</code> constraint for <code>n</code> by creating a <code>SomeNat</code> from the runtime length using <code>fromJust (someNatVal (fromIntegral (length xs)))</code>, then get back the actual length value at runtime with <code>natVal</code>. I\u2019m not really familiar with how to do it, and it might require the <a href=\"https://hackage.haskell.org/package/ghc-typelits-natnormalise\" rel=\"nofollow noreferrer\"><code>ghc-typelits-natnormalise</code></a> plugin, but it might be a starting point.</p>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 1, "accepted_answer_id": 46396155, "answer_count": 2, "score": 4, "last_activity_date": 1506382169, "creation_date": 1506295811, "last_edit_date": 1506355471, "question_id": 46395806, "link": "https://stackoverflow.com/questions/46395806/using-haskells-singletons-how-can-i-write-fromlist-a-vec-a-n", "title": "Using haskell&#39;s singletons, how can I write `fromList :: [a] -&gt; Vec a n`?", "body": "<p>As part of my journey in understanding <code>singletons</code> I have tried to bridge the gap between compile time safety, and lifting runtime values into that dependent type safety.</p>\n\n<p>I think though that a minimal example of \"runtime\" values is a function that takes an unbounded list, and converts it to a size-indexed vector. The following skeleton provides length-indexed vectors, but I can't quite determine how to write <code>fromList</code>.</p>\n\n<p>I have considered making the function take a size parameter, but I suspect it's possible to keep that implicit.</p>\n\n<pre><code>{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE ScopedTypeVariables  #-}\n{-# LANGUAGE TemplateHaskell      #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE TypeInType           #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport           Data.Singletons\nimport           Data.Singletons.TH\n\n$(singletons\n  [d|\n    data Nat = Z | S Nat deriving (Show)\n  |])\n\ndata Vec a n where\n  Nil :: Vec a Z\n  Cons :: a -&gt; Vec a n -&gt; Vec a (S n)\n\ninstance Show a =&gt; Show (Vec a n) where\n  show Nil = \"Nil\"\n  show (Cons x xs) = show x ++ \" :&lt; \" ++ show xs\n\nfromListExplicit :: forall (n :: Nat) a. SNat n -&gt; [a] -&gt; Vec a n\nfromListExplicit SZ _ = Nil\nfromListExplicit (SS n) (x : xs) = Cons x (fromListExplicit n xs)\n\nex1 = fromListExplicit (SS (SS (SS SZ))) [1..99]\n-- 1 :&lt; 2 :&lt; 3 :&lt; Nil\n\nfromListImplicit :: (?????) =&gt; [a] -&gt; Vec a n\nfromListImplicit = ?????\n\nmain :: IO ()\nmain = do\n  xs &lt;- readLn :: IO [Int]\n  print $ fromListImplicit xs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1506292615, "post_id": 46395396, "comment_id": 79748245, "body": "The code is wrong in a few places, and the type inference consequently is trying to assign the wrong types. Try to add a type annotation for <i>all</i> your functions, and the type errors will become clearer. Right now, <code>numerator</code> must be a function taking a list-of-lists, which is wrong, for instance."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506365080, "post_id": 46395396, "comment_id": 79781891, "body": "How is <code>listSum</code> defined?"}], "answers": [{"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1506374318, "creation_date": 1506374318, "answer_id": 46414344, "question_id": 46395396, "link": "https://stackoverflow.com/questions/46395396/calculating-standard-deviation-in-haskell/46414344#46414344", "title": "Calculating standard deviation in Haskell", "body": "<p>I guess you may calculate the standard deviation as follows;</p>\n\n<pre><code>stdev :: [Float] -&gt; Float\nstdev xs = sqrt . average . map ((^2) . (-) axs) $ xs\n           where average = (/) &lt;$&gt; sum &lt;*&gt; realToFrac . length\n                 axs     = average xs\n</code></pre>\n\n<p>It's best to define our list as a <code>Float</code> type. This saves us from some conversions.</p>\n\n<p>The <code>average</code> function; <code>(/) &lt;$&gt; sum &lt;*&gt; realToFrac . length</code> is in fact an <code>Applicative</code> approach in which we feed the <code>(/)</code> function's two parameters with the results of <code>sum</code> and <code>realToFrac . length</code> from a common parameter; a list. So it will be like;</p>\n\n<p><code>sum ([1,2,3] :: [Float]) / (realToFrac . length $ [1,2,3])</code></p>\n\n<p>and <code>map</code>s first parameter <code>((^2) . (-) axs)</code> is a function which will take each element one by one, find it's difference with the list's average and square it. Well... then we calculate the average of them and take square root of it. Accordingly;</p>\n\n<pre><code>*Main&gt; stdev [600, 470, 170, 430, 300]\n147.32277\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1329, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506374318, "creation_date": 1506291428, "last_edit_date": 1506318532, "question_id": 46395396, "link": "https://stackoverflow.com/questions/46395396/calculating-standard-deviation-in-haskell", "title": "Calculating standard deviation in Haskell", "body": "<p>I'm trying to write an equation to find the standard deviation of a list of integers in Haskell and after wracking my brain for an hour, I think I've figured out how to write the equation. It's giving me errors though and I'm not sure what I'm doing wrong.</p>\n\n<pre><code>listLength :: (Num a) =&gt; [a] -&gt; a\nlistLength [] = 0\nlistLength (x:xs) = 1 + listLength xs\n\nlistMeanInt x = listSum x `div` listLength x\n\nlistStdDev x = sqrt(numerator x `div` denominator x)\ndenominator x = (listLength x) - 1\nnumerator (x:xs) = if (x /= []) then ((x - listMeanInt x)^2) + (numerator xs) else 0\n</code></pre>\n\n<p>The functions listLength and listMeanInt are used in other parts of my program so I'm confident they are not the problem. When I try to load the module, I get errors for listStdDev and numerator. </p>\n\n<p>For the former, I'm given the error</p>\n\n<pre><code>Non type-variable argument in the constraint: Integral [a]\nWhen checking the inferred type\n    listStdDev :: forall a. (Integral [a], Floating [a]) =&gt; [[a]] -&gt; [a].\n</code></pre>\n\n<p>I'm not sure what that's saying? Maybe that the denominator is expected to be a float even though I'm using div? I'm confused by this and would like some clarification before I set something on fire. </p>\n\n<p>As for the latter, I get told</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a ~ [a]\nIn the second argument of \u2018(-)\u2019, namely \u2018listMeanInt x\u2019,\nIn the first argument of \u2018(^)\u2019, namely \u2018(x - listMeanInt x)\u2019,\nIn the first argument of \u2018(+)\u2019, namely \u2018((x - listMeanInt x) ^ 2)\u2019.\nRelevant bindings include xs :: [[a]], x :: [a], numerator :: [[a]] -&gt; [a].\n</code></pre>\n\n<p>I am completely lost for words as to how to interpret this; I'm very new to Haskell. Could I please have some help understanding what I'm doing wrong?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "edited": false, "score": 0, "creation_date": 1506287244, "post_id": 46394601, "comment_id": 79746985, "body": "You type signature is incorrect <code>randomizeList :: Eq a =&gt; a -&gt; [a]</code> takes in a single element and returns a list, you probably wanted <code>[a] -&gt; [a]</code>.  I also don&#39;t see why <code>Eq</code> is needed"}], "answers": [{"tags": [], "owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "is_accepted": false, "score": 3, "last_activity_date": 1506286820, "creation_date": 1506286820, "answer_id": 46394812, "question_id": 46394601, "link": "https://stackoverflow.com/questions/46394601/randomize-a-list-in-haskell/46394812#46394812", "title": "Randomize a List in Haskell", "body": "<p>A quick and easy way to randomize a list would be:</p>\n\n<pre><code>module Main where                                                                                                                                                      \n\nimport Control.Monad (replicateM)                                                                                             \nimport Data.Function (on)\nimport Data.List     (sortBy)\nimport System.Random (randomRIO)                                                                                                                                                     \n\nmain :: IO ()\nmain = do                                                                                                                                                              \n  putStrLn \"not randomized\"                                                                                                                                            \n  let nums = [1..10]                                                                                                                                                   \n  print nums                                                                                                                                                           \n  putStrLn \"randomized\"                                                                                                                                                \n  print =&lt;&lt; randomize nums                                                                                                                                             \n\nrandomize :: [a] -&gt; IO [a]                                                                                                                                             \nrandomize xs = do                                                                                                                                                      \n  ys &lt;- replicateM (length xs) $ randomRIO (1 :: Int, 100000)                                                                                                          \n  pure $ map fst $ sortBy (compare `on` snd) (zip xs ys)\n</code></pre>\n\n<p>This code generates a random list of numbers, zips them with the original list, and then sorts these pairs by the random number generated. We then strip off the random number (<code>map fst</code>) and are left with the original list of elements, but randomized.</p>\n\n<p>In general, using <code>unsafePerformIO</code> is not recommended.</p>\n"}, {"tags": [], "owner": {"reputation": 11377, "user_id": 553279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de617e09030cad8f06663113eeea27cc?s=128&d=identicon&r=PG", "display_name": "fdreger", "link": "https://stackoverflow.com/users/553279/fdreger"}, "is_accepted": true, "score": 2, "last_activity_date": 1506288945, "creation_date": 1506288945, "answer_id": 46395109, "question_id": 46394601, "link": "https://stackoverflow.com/questions/46394601/randomize-a-list-in-haskell/46395109#46395109", "title": "Randomize a List in Haskell", "body": "<p>Couple of problems with your code, mostly trivial mistakes:</p>\n\n<ol>\n<li>Wrong signature, should be <code>randomizeList :: Eq a =&gt; [a] -&gt; [a]\n</code> (it's from list to list, not from element to list)</li>\n<li>spurious <code>do</code> on the beginning of the block (just remove)</li>\n<li>list are concatenated with <code>++</code>, not with <code>:</code> (the latter adds an element to a list)</li>\n<li>in the last <code>else</code> you need to return <code>list</code> instead of <code>[list]</code> (the latter is a list of lists)</li>\n</ol>\n\n<p>The following should work:</p>\n\n<pre><code>randomizeList :: Eq a =&gt; [a] -&gt; [a]\nrandomizeList list =\n  let lists = (divideList list) in\n    if (length list) &gt; 1\n    then if (randomInt &gt; 5)\n    then (randomizeList (fst lists) ++ randomizeList (snd lists))\n    else (randomizeList (snd lists) ++ randomizeList (fst lists))\n    else list\n</code></pre>\n"}], "owner": {"reputation": 539, "user_id": 4889611, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh3.googleusercontent.com/-9fVTIC4mtOE/AAAAAAAAAAI/AAAAAAAABrw/BZzSKj4M7vs/photo.jpg?sz=128", "display_name": "Tomas Piaggio", "link": "https://stackoverflow.com/users/4889611/tomas-piaggio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 1, "accepted_answer_id": 46395109, "answer_count": 2, "score": 1, "last_activity_date": 1506288945, "creation_date": 1506285322, "question_id": 46394601, "link": "https://stackoverflow.com/questions/46394601/randomize-a-list-in-haskell", "title": "Randomize a List in Haskell", "body": "<p>I'm trying to, given a list, create a random arrangement of that elements in Haskell. I already tried the algorithm in Javascript and it worked. I'm pretty new to Haskell so I might be not seeing something. I'm pretty sure that I'm receiving single elements instead of lists with just one element in it, which makes my program crash. I've encountered this problem in previous exercises but still do not know how to solve it.</p>\n\n<p>The algorithm divides the list until it gets one element. Then there is a 50% chance of if merging the list as it was and another 50% to merge it the other way around.</p>\n\n<p>This is the code:</p>\n\n<pre><code>-- A randomly chosen, program-scoped constant from the range [1 .. 10]\nrandomInt :: Int\nrandomInt = unsafePerformIO (getStdRandom (randomR (1, 10)))\n\n-- Divides the list in half\ndivideList :: [a] -&gt; ([a], [a])\ndivideList list = splitAt ((length list) `div` 2) list\n\n-- Given a list, it creates a new one with the elements of said list\nrandomizeList :: Eq a =&gt; a -&gt; [a]\nrandomizeList list = do\n    let lists = (divideList list) in\n        if (length list) &gt; 1\n        then if (randomInt &gt; 5)\n        then (randomizeList (fst lists) : randomizeList (snd lists))\n        else (randomizeList (snd lists) : randomizeList (fst lists))\n        else [list]\n</code></pre>\n\n<p>Here is the Javascript code in case it helps:</p>\n\n<pre><code>function divideList(list){\n    const length = list.length / 2;\n    return {fst: list.splice(0, length), snd: list};\n}\nfunction randomizeList(list) {\n    if(list.length == 1) return list;\n    const lists = divideList(list);\n    if(Math.random() &gt; 0.5) return randomizeList(lists.fst).concat(randomizeList(lists.snd));\n    else return randomizeList(lists.snd).concat(randomizeList(lists.fst));\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "lambda", "monads"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1506291524, "post_id": 46393211, "comment_id": 79748006, "body": "<code>compute_v1 = liftA2 replicate length head . (++ &quot;abcd&quot;)</code>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1506332286, "post_id": 46393211, "comment_id": 79761283, "body": "<code>compute_v1 = (replicate &lt;$&gt; length &lt;*&gt; head) . (++ &quot;abcd&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506278291, "post_id": 46393514, "comment_id": 79744167, "body": "I&#39;d not use <code>fmap</code> when it is <code>(.)</code> in disguise. I&#39;d use <code>flip (.) (++&quot;abcd&quot;)</code> or <code>(. (++&quot;abcd&quot;))</code>. (Well, to be honest, I would never write this in monadic style, but the OP seems to want to experiment with that)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506278385, "post_id": 46393514, "comment_id": 79744204, "body": "@chi That&#39;s a good point, but I wanted to highlight the thought process a bit that led me to it (which was: since we are using its monadic properties, try looking at what the <code>Functor</code> instance does)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506278464, "post_id": 46393514, "comment_id": 79744224, "body": "I understand. Yes, I&#39;d agree with that process."}, {"owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "edited": false, "score": 0, "creation_date": 1506427726, "post_id": 46393514, "comment_id": 79809155, "body": "It completely slipped my mind that all I had to do was to actually compose the function. However, judging from all those predefined helper flip definitions, that inversion is quite common? eg: <code>(++ &quot;abcd&quot;) {do block}</code> instead of <code>{do block} (++ &quot;abcd&quot;)</code>"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 5, "last_activity_date": 1506278665, "last_edit_date": 1506278665, "creation_date": 1506278077, "answer_id": 46393514, "question_id": 46393211, "link": "https://stackoverflow.com/questions/46393211/executing-a-transformation-to-the-input-before-applying-the-function-monad/46393514#46393514", "title": "Executing a transformation to the input before applying the function monad", "body": "<p>Since all <code>Monad</code> instances also have <code>Functor</code> instances and the function instance of <code>Functor</code> has <code>fmap = (.)</code>, you can have</p>\n\n<pre><code>compute :: String -&gt; String \ncompute = flip fmap (++ \"abcd\") $ do\n    x   &lt;- length\n    top &lt;- head\n    return $ replicate x top\n</code></pre>\n\n<p>Some packages (like <code>microlens</code> and <code>lens</code>) define <code>(&lt;&amp;&gt;) = flip fmap</code>, allowing you to write</p>\n\n<pre><code>compute :: String -&gt; String \ncompute = (++ \"abcd\") &lt;&amp;&gt; do\n    x   &lt;- length\n    top &lt;- head\n    return $ replicate x top\n</code></pre>\n\n<p>There is also a <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Category.html\" rel=\"nofollow noreferrer\"><code>Category</code></a> instance for <code>(-&gt;)</code>, which gives us <code>(&gt;&gt;&gt;) = flip (.)</code>. That might be slightly clearer, visually:</p>\n\n<pre><code>compute :: String -&gt; String \ncompute = (++ \"abcd\") &gt;&gt;&gt; do\n    x   &lt;- length\n    top &lt;- head\n    return $ replicate x top\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1506278680, "post_id": 46393537, "comment_id": 79744284, "body": "@chi No parse error with the code in a module loaded in GHCi. I haven&#39;t tried to &#39;really&#39; compile it..."}, {"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1506282342, "post_id": 46393537, "comment_id": 79745455, "body": "I like these &quot;simple&quot; Haskell questions and answers, they always make my head spin in no time. My current understanding of this: <code>&lt;$&gt;</code> is the infix operator of <code>fmap</code> (looked up <a href=\"https://stackoverflow.com/questions/37286376/what-does-mean-in-haskell\">here</a>). Anything on the left of it would be a function <code>a-&gt;b</code>, the right the <code>f a</code>. So this is a function seen as a functor? For the <code>do</code> block itself, this is the <code>List</code> monad because strings are lists of chars?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1506286879, "post_id": 46393537, "comment_id": 79746879, "body": "@StefanHanke No, it&#39;s the function monad (and function functor) all the way. The type of the expressions to the right of the <code>&lt;-</code>s are function types, which is one way you can tell that it is the function monad instance being used. The parsing is a bit weird here (in my opinion), but it seems to parse as <code>compute_vs = (do { ... do block code here ...}) &lt;$&gt; (++ &quot;abcd&quot;)</code>. I would personally put the parens in explicitly, if I had something like that."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1506287203, "post_id": 46393537, "comment_id": 79746976, "body": "You could also write it as <code>compute_vs = doBody &lt;$&gt; (++ &quot;abcd&quot;)  where doBody = do { ... do code here ... }</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1506278181, "creation_date": 1506278181, "answer_id": 46393537, "question_id": 46393211, "link": "https://stackoverflow.com/questions/46393211/executing-a-transformation-to-the-input-before-applying-the-function-monad/46393537#46393537", "title": "Executing a transformation to the input before applying the function monad", "body": "<p>You could do something like this:</p>\n\n<pre><code>compute_v2 :: String -&gt; String\ncompute_v2 = do\n    x &lt;- length\n    top &lt;- head\n    return $ replicate x top\n    &lt;$&gt; (++ \"abcd\")\n</code></pre>\n\n<p>AFAIK, the monad in question is called the <em>Reader monad</em>, and it's also a <code>Functor</code>.</p>\n\n<pre><code>*Q46393211&gt; compute_v2 \"1234\"\n\"11111111\"\n*Q46393211&gt; compute_v2 \"71\"\n\"777777\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1506327875, "last_edit_date": 1506327875, "creation_date": 1506322831, "answer_id": 46399310, "question_id": 46393211, "link": "https://stackoverflow.com/questions/46393211/executing-a-transformation-to-the-input-before-applying-the-function-monad/46399310#46399310", "title": "Executing a transformation to the input before applying the function monad", "body": "<p><a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html\" rel=\"nofollow noreferrer\"><code>MonadReader</code> class</a> has the method <code>local</code> for this, and <code>(-&gt;) r</code> is an instance, so</p>\n\n<pre><code>import Control.Monad.Reader (local)\n\ncompute_v3 ::String -&gt; String\ncompute_v3 = local (++ \"abcd\") $ do \n    x &lt;- length \n    top &lt;- head\n    return (replicate x top)\n</code></pre>\n\n<p>should work (can't test at the moment).</p>\n"}], "owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 46393514, "answer_count": 3, "score": 2, "last_activity_date": 1506327875, "creation_date": 1506276189, "question_id": 46393211, "link": "https://stackoverflow.com/questions/46393211/executing-a-transformation-to-the-input-before-applying-the-function-monad", "title": "Executing a transformation to the input before applying the function monad", "body": "<p>I am aware that I can use the function monad to achieve a construct like the one below (where I reuse the argument in multiple calls without explicitly referencing it):</p>\n\n<pre><code>compute_v0 :: String -&gt; String\ncompute_v0 = do \n    x &lt;- length -- (using the argument implicitly here)\n    top &lt;- head -- (and here)\n    return (replicate x top)\n</code></pre>\n\n<p>The result of the above function for: <code>compute \"1234\"</code> would be <code>\"1111\"</code></p>\n\n<p>My question is: How would I apply a transformation to the 'hidden' argument before executing the do block (imagine I would like to append \"abcd\" to the list).</p>\n\n<p>My first solution:</p>\n\n<pre><code>compute_v1 :: String -&gt; String\ncompute_v1 = compute_v1' . (++ \"abcd\")\n\ncompute_v1' ::String -&gt; String\ncompute_v1' = do \n    x &lt;- length \n    top &lt;- head\n    return (replicate x top)\n</code></pre>\n\n<p>The result for <code>compute \"1234\"</code> would now be <code>\"11111111\"</code>. This actually gets the job done, but I would rather try to keep it defined all in one concise block of code.</p>\n\n<p>The closest I could get to actually include the transformation while still keeping the style from code (v0) was this one:</p>\n\n<pre><code>compute_v2 :: String -&gt; String \ncompute_v2 = (++ \"abcd\") &gt;&gt;= \\r -&gt; do\n    let x = length r\n    let top = head r\n    return $ replicate x top\n</code></pre>\n\n<p>But I still had to include a lambda, use a lot of let bindings and explicitly reference the lambda argument. Are there better ways to achieve such a construct?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "reply_to_user": {"reputation": 120590, "user_id": 3788176, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/9c18d321d8948803c05643d87b003dc2?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Turner", "link": "https://stackoverflow.com/users/3788176/andy-turner"}, "edited": false, "score": 0, "creation_date": 1506272547, "post_id": 46392519, "comment_id": 79742299, "body": "You mean removing fractional? I did that and it gave me an error saying &quot;Expected a type, but \u2018a\u2019 has kind \u2018Constraint\u2019&quot;"}, {"owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "reply_to_user": {"reputation": 120590, "user_id": 3788176, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/9c18d321d8948803c05643d87b003dc2?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Turner", "link": "https://stackoverflow.com/users/3788176/andy-turner"}, "edited": false, "score": 0, "creation_date": 1506272673, "post_id": 46392519, "comment_id": 79742330, "body": "That gives me the error &quot;No instance for (Fractional Int) arising from a use of \u2018listMean\u2019&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "edited": false, "score": 0, "creation_date": 1506273364, "post_id": 46392697, "comment_id": 79742549, "body": "I had not thought to test this with a float before and I see it works with float values now. Thanks for the advice (although hilariously now I&#39;m having trouble getting the interpreter to convert an int to a float)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1506273042, "creation_date": 1506273042, "answer_id": 46392697, "question_id": 46392519, "link": "https://stackoverflow.com/questions/46392519/division-of-two-functions-in-haskell/46392697#46392697", "title": "Division of two functions in Haskell", "body": "<p>At a guess: you are testing this in ghci with <code>listMean randInts</code>. This is a problem, because <code>Int</code> doesn't support division via <code>(/)</code> but rather supports integer division via <code>div</code> (to avoid a certain class of bugs that crops up in languages that conflate the two).</p>\n\n<p>You have a two obvious choices, namely, convert your <code>Int</code>s to something that does support division (e.g. <code>Double</code>) or generate random <code>Double</code>s in the first place.</p>\n\n<pre><code>listMean (map fromIntegral is) :: Double\nlistMean . take 5 . randoms $ mkStdGen 11 :: Double\n</code></pre>\n\n<p>By the way, if my guess is correct: in the future, you should really include <em>all</em> the details of the things you did, in so much detail that we playing along at home could follow them and see the exact same error; <em>and</em> you should include the entire content of the error, especially since in this case it mentions the code snippet that caused it and would have made diagnosis instantaneous.</p>\n"}, {"tags": [], "owner": {"reputation": 13477, "user_id": 401539, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a5b4abd71ac6fc7faa1107d51ea4f720?s=128&d=identicon&r=PG", "display_name": "tungd", "link": "https://stackoverflow.com/users/401539/tungd"}, "is_accepted": false, "score": 1, "last_activity_date": 1506274380, "last_edit_date": 1506274380, "creation_date": 1506273899, "answer_id": 46392846, "question_id": 46392519, "link": "https://stackoverflow.com/questions/46392519/division-of-two-functions-in-haskell/46392846#46392846", "title": "Division of two functions in Haskell", "body": "<p>The problem is that:</p>\n\n<pre><code>(Num a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>Applied with <code>[Int]</code>, both <code>listSum</code> and <code>listLength</code> returns <code>Int</code>, which does not support <code>/</code>. You need to convert the return values before division:</p>\n\n<pre><code>listMean :: (Num a, Integral a) =&gt; [a] -&gt; Double\nlistMean [] = 0\nlistMean x = (fromIntegral $ listSum x) / (fromIntegral $ listLength x)\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 5338731, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ds9sU.jpg?s=128&g=1", "display_name": "remington howell", "link": "https://stackoverflow.com/users/5338731/remington-howell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 46392697, "answer_count": 2, "score": 0, "last_activity_date": 1506274380, "creation_date": 1506272078, "question_id": 46392519, "link": "https://stackoverflow.com/questions/46392519/division-of-two-functions-in-haskell", "title": "Division of two functions in Haskell", "body": "<p>I'm very new to Haskell and I'm trying to make a basic function which finds the mean of a list. I've almost got it solved, except for the last bit of division I have to do.</p>\n\n<pre><code>randInts = take 5 $ randoms (mkStdGen 11) :: [Int]\n\nlistSum :: (Num a) =&gt; [a] -&gt; a\nlistSum [] = 0\nlistSum (x:xs) = x + listSum xs\n\nlistLength :: (Num a) =&gt; [a] -&gt; a\nlistLength [] = 0\nlistLength (x:xs) = 1 + listLength xs\n\nlistMean :: (Num a) =&gt; [a] -&gt; a\nlistMean [] = 0\nlistMean x = (listSum x) / (listLength x)\n</code></pre>\n\n<p>This is what I started with, where listSum and listLength basically have the same functionality as the sum and length operators on lists respectively and listMean takes those two and divides them. When I run this, however, I get an error saying <em>\"Could not deduce (Fractional a) arising from a use of \u2018/\u2019 from the context: Num a\"</em> </p>\n\n<p>At first, I just thought I had used the wrong type and switched listMean to start with listMean :: (Fractional a) => [a] -> a. This allowed me to compile, but when I attempted to run it by giving it randInts, but instead I got the error message \"No instance for (Fractional Int) arising from a use of \u2018listMean\u2019.\"</p>\n\n<p>I am not sure what I am missing here. Could I have some advice please?</p>\n"}, {"tags": ["haskell", "haskell-stack", "reflex"], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 2431984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29e6ef2db775edf8f056584c8c59eee4?s=128&d=identicon&r=PG", "display_name": "Micha\u0142 Adamczyk", "link": "https://stackoverflow.com/users/2431984/micha%c5%82-adamczyk"}, "edited": false, "score": 0, "creation_date": 1506550176, "post_id": 46397103, "comment_id": 79871484, "body": "I thought I had tried that, but apparently I must have done something a bit different, for example apart from specifying reflex in packages I also put it in extra-deps.. lol Anyways.. it worked! Thank you :)"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 4, "last_activity_date": 1506309266, "creation_date": 1506309266, "answer_id": 46397103, "question_id": 46391975, "link": "https://stackoverflow.com/questions/46391975/how-do-i-build-stack-configuration-that-allows-me-to-build-project-with-reflex-f/46397103#46397103", "title": "How do I build stack configuration that allows me to build project with reflex-frp as dependency?", "body": "<p>Looks like no published version of <code>reflex</code> supports ghc 8.0.2.  There are a lot of changes on the <code>develop</code> branch since the 0.4 release: <a href=\"https://github.com/reflex-frp/reflex/compare/cc62c11a6cde31412582758c236919d4bb766ada...develop\" rel=\"nofollow noreferrer\">https://github.com/reflex-frp/reflex/compare/cc62c11a6cde31412582758c236919d4bb766ada...develop</a></p>\n\n<p>So first I tried this:</p>\n\n<pre><code>resolver: lts-9.5\n\npackages:\n- .\n- location:\n    git: https://github.com/reflex-frp/reflex\n    commit: 916c876\n  extra-dep: true\n</code></pre>\n\n<p>But that led to:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\n   In the dependencies for reflex-0.5.0:\n       prim-uniq must match &gt;=0.1.0.1 &amp;&amp; &lt;0.2, but the stack configuration has no specified version\n                 (latest applicable is 0.1.0.1)\n       ref-tf must match ==0.4.*, but the stack configuration has no specified version (latest applicable is 0.4.0.1)\n   needed due to hmm-0.1.0.0 -&gt; reflex-0.5.0\n\n   Recommended action: try adding the following to your extra-deps in /home/mgsloan/fpco/test-stack/stackoverflow46391975/hmm/stack.yaml:\n   - prim-uniq-0.1.0.1\n   - ref-tf-0.4.0.1\n</code></pre>\n\n<p>Following the recommended action yields a configuration that works:</p>\n\n<pre><code>resolver: lts-9.5\n\npackages:\n- .\n- location:\n    git: https://github.com/reflex-frp/reflex\n    commit: 916c876\n  extra-dep: true\n\nextra-deps:\n- prim-uniq-0.1.0.1\n- ref-tf-0.4.0.1\n</code></pre>\n"}], "owner": {"reputation": 293, "user_id": 2431984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29e6ef2db775edf8f056584c8c59eee4?s=128&d=identicon&r=PG", "display_name": "Micha\u0142 Adamczyk", "link": "https://stackoverflow.com/users/2431984/micha%c5%82-adamczyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 46397103, "answer_count": 1, "score": 1, "last_activity_date": 1506309266, "creation_date": 1506268543, "question_id": 46391975, "link": "https://stackoverflow.com/questions/46391975/how-do-i-build-stack-configuration-that-allows-me-to-build-project-with-reflex-f", "title": "How do I build stack configuration that allows me to build project with reflex-frp as dependency?", "body": "<p>As in question. I can't get working stack configuration. I want to build project that uses reflex with ghc, preferably 8.0.2 or higher.\nHow do I do it, cause specifying it as an extra deps doesn't seem to work either..</p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 4, "last_activity_date": 1506263577, "creation_date": 1506263577, "answer_id": 46391148, "question_id": 46390448, "link": "https://stackoverflow.com/questions/46390448/deriving-tohtml-for-newtype/46391148#46391148", "title": "Deriving `ToHtml` for Newtype?", "body": "<p><code>Foo</code> need to derive <code>ToHtml</code> class to be the instance of that class.\nSince <code>Foo</code> is a <code>newtype</code> of <code>String</code> it can be done using:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n</code></pre>\n\n<p>I guess, this code demonstrates, what you're looking for:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Lucid.Base\n\nnewtype Foo = Foo String deriving ToHtml\n\nmain = print $ toHtml (Foo \"foo\")\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 46391148, "answer_count": 1, "score": 1, "last_activity_date": 1506263577, "creation_date": 1506259038, "question_id": 46390448, "link": "https://stackoverflow.com/questions/46390448/deriving-tohtml-for-newtype", "title": "Deriving `ToHtml` for Newtype?", "body": "<p>Given:</p>\n\n<pre><code>\u03bb: &gt;import Servant.HTML.Lucid\n</code></pre>\n\n<p>I created a <code>newtype</code>:</p>\n\n<pre><code>\u03bb: &gt;newtype Foo = Foo String\n</code></pre>\n\n<p>However, it doesn't appear that there's an <code>ToHtml Foo</code> typeclass in scope:</p>\n\n<pre><code>\u03bb: &gt;instance ToHtml Foo\n\n&lt;interactive&gt;:3:10: warning: [-Wmissing-methods]\n    \u2022 No explicit implementation for\n        \u2018toHtml\u2019 and \u2018toHtmlRaw\u2019\n    \u2022 In the instance declaration for \u2018ToHtml Foo\u2019\n</code></pre>\n\n<p>Yet one exists for <code>String</code>:</p>\n\n<pre><code>\u03bb: &gt;:t toHtml\ntoHtml :: (Monad m, ToHtml a) =&gt; a -&gt; HtmlT m ()\n\u03bb: &gt;toHtml \"foo\"\nfoo\n</code></pre>\n\n<p>How can I get a <code>ToHtml Foo</code> without an explicit instance definition?</p>\n"}, {"tags": ["list", "haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1506262019, "post_id": 46390099, "comment_id": 79739021, "body": "@chepner very close but not exactly. As you can see, I&#39;m using lists, so efficiency is not top priority for me. Though I think my solution is already efficient enough and probably even uses only one traversal of list. I want shorter form (w/o big loss of efficiency). And I&#39;m interested in solution which uses lenses (because w/o lenses I can do it myself). The difference is that in your form <code>myUpdate</code> should check whether to modify element while in my form <code>map myUpdate</code> will change every element of the list. But your idea is very close to what I want."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1506262100, "post_id": 46390099, "comment_id": 79739037, "body": "Oh, sorry. I figured out what you really wanted, then forgot to delete my comment."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1506272028, "last_edit_date": 1506272028, "creation_date": 1506269206, "answer_id": 46392074, "question_id": 46390099, "link": "https://stackoverflow.com/questions/46390099/how-to-add-element-to-list-if-its-not-there-with-lens/46392074#46392074", "title": "How to add element to list if it&#39;s not there with &#39;lens&#39;?", "body": "<p>You should be able to use <code>has</code> to shorten it a little:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>functionIWantToWrite :: [A] -&gt; [A]\nfunctionIWantToWrite = modifyItem . addEmptyItem\n  where\n    _items = filtered myPredicate\n    addEmptyItem list | has _items list = list\n                      | otherwise       = item : list \n    modifyItem = each . _items %~ myUpdate\n</code></pre>\n\n<p>If you really wanted to shorten it, you might be able to just get it as a single traversal using the <code>Monoid m =&gt; Applicative (m,)</code> instance or so, something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>accAny :: (x -&gt; Bool) -&gt; (x -&gt; x) -&gt; x -&gt; (Any, x)\naccAny pred fn x = (Any b, if b then fn x else x)\n  where b = pred x\n\nfunctionIWantToWrite list = handle . traverse . accAny myPredicate myUpdate $ list\n  where handle (Any True, list) = list\n        handle (_, list) = item : list\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 593, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1506272028, "creation_date": 1506256499, "question_id": 46390099, "link": "https://stackoverflow.com/questions/46390099/how-to-add-element-to-list-if-its-not-there-with-lens", "title": "How to add element to list if it&#39;s not there with &#39;lens&#39;?", "body": "<p>Let's say I have a list <code>[A]</code>. I want to update specific element of list if it satisfies some predicate. But if there's no such element I want to add element to list first. My current solution is to write manually function for inserting element into list if it's not there and then use <code>filtered</code> Traversal to update my element. Like this:</p>\n\n<pre><code>-- inserts element to list if there's no a single element \n-- which satisfies given predicate \ninsertIfNot :: (a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]\ninsertIfNot _ e []       = [e]\ninsertIfNot p e l@(x:xs) = if p x then l else x : insertIfNot p e xs\n\nfunctionIWantToWrite :: [A] -&gt; [A]\nfunctionIWantToWrite = modifyItem . addEmptyItem\n  where\n    addEmptyItem = insertIfNot myPredicate item\n    modifyItem   = each.filtered myPredicate %~ myUpdate\n</code></pre>\n\n<p>I wonder if there's better (shorter, more idiomatic) solution? If possible I would appreciate solution which uses only <a href=\"http://hackage.haskell.org/package/microlens\" rel=\"nofollow noreferrer\"><code>microlens</code></a> family of packages.</p>\n"}, {"tags": ["haskell", "random", "time"], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1506248521, "post_id": 46388596, "comment_id": 79735402, "body": "<code>Integer -&gt; NominalDiffTime</code> is only one part of the problem. I have a <code>NominalDiffTime</code> but I want to <code>randomR (0, max)</code> where <code>max</code> is a <code>NominalDiffTime</code>, <i>or</i>, e.g. an <code>Integer</code>. So how do I <code>NominalDiffTime -&gt; Integer</code>? (Hoogle isn&#39;t much help here)"}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1506245443, "creation_date": 1506245443, "answer_id": 46388596, "question_id": 46388359, "link": "https://stackoverflow.com/questions/46388359/random-time-between-two-localtime-or-utctime-in-haskell/46388596#46388596", "title": "Random time between two `LocalTime` (or `UTCTime`) in Haskell", "body": "<p>As far as I understand the documentation there in an <code>Num</code> implementation for <code>NominalDiffTime</code> which offers the function <code>fromInteger :: Integer -&gt; NominalDiffTime</code>.</p>\n\n<p>Therefore: generate a <code>Integer</code> of the appropriate range, convert it to <code>NominalDiffTime</code> and add it to your time value.</p>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506280127, "post_id": 46389038, "comment_id": 79744731, "body": "<code>truncate</code> would be a safer choice; <code>floor</code> can give you an out of range value if <code>max</code> is a negative duration."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506284294, "post_id": 46389038, "comment_id": 79746134, "body": "@jberryman, good point on out of range. Despite that negative <code>max</code> would be a bug in this program (you just don&#39;t start in the future and end in the past :) ), and I would take a different action on such an input, I&#39;ll update the answer."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1506284334, "last_edit_date": 1506284334, "creation_date": 1506248814, "answer_id": 46389038, "question_id": 46388359, "link": "https://stackoverflow.com/questions/46388359/random-time-between-two-localtime-or-utctime-in-haskell/46389038#46389038", "title": "Random time between two `LocalTime` (or `UTCTime`) in Haskell", "body": "<p>You were on the right track. For <code>randomSeconds</code> to work all you need to do is convert <code>NominalDiffTime</code> to seconds as an <code>Int</code> and since <code>NominalDiffTime</code> is an instance of <code>RealFrac</code> you can use <code>round</code>, <code>floor</code> etc. to do so. Also you don't want to discard your generator in helper functions, since you might need it later.</p>\n\n<pre><code>import           Data.Bifunctor (first)\nimport           Data.Time\nimport           System.Random\n\nrandomSeconds :: RandomGen g =&gt; g -&gt; NominalDiffTime -&gt; (NominalDiffTime, g)\nrandomSeconds rg max = first realToFrac $ randomR (0, truncate max :: Int) rg\n\ndiff :: TimeZone -&gt; LocalTime -&gt; LocalTime -&gt; NominalDiffTime\ndiff tz st en = diffUTCTime (localTimeToUTC tz st) (localTimeToUTC tz en)\n\nrandomTimeBetween :: RandomGen g =&gt;\n  TimeZone -&gt; LocalTime -&gt; LocalTime -&gt; g -&gt; (LocalTime, g)\nrandomTimeBetween tz s e rg =\n  first\n    (utcToLocalTime tz . (`addUTCTime` (localTimeToUTC tz s)))\n    (randomSeconds rg (diff tz s e))\n\nmain :: IO ()\nmain = do\n  gen &lt;- getStdGen\n  tz &lt;- getCurrentTimeZone\n  nowUTC &lt;- getCurrentTime\n  let yesterday = utcToLocalTime tz $ addUTCTime (-1 * 3600 * 24) nowUTC\n      between =\n        fst $ randomTimeBetween tz yesterday (utcToLocalTime tz nowUTC) gen\n  putStrLn $ \"Yesterday: \" ++ show yesterday\n  putStrLn $ \"In between: \" ++ show between\n  putStrLn $ \"Now: \" ++ show (utcToLocalTime tz nowUTC)\n</code></pre>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 46389038, "answer_count": 2, "score": 2, "last_activity_date": 1506284334, "creation_date": 1506243477, "last_edit_date": 1506248559, "question_id": 46388359, "link": "https://stackoverflow.com/questions/46388359/random-time-between-two-localtime-or-utctime-in-haskell", "title": "Random time between two `LocalTime` (or `UTCTime`) in Haskell", "body": "<p>I need to generate a random time between two given <code>LocalTime</code> values (but this can be <code>UTCTime</code> if necessary, as I can convert).</p>\n\n<p>I achieve the generation of a number in the range <code>(0, n)</code> like this:</p>\n\n<pre><code>randomSeconds :: RandomGen g =&gt; g -&gt; NominalDiffTime -&gt; NominalDiffTime\nrandomSeconds rg max = realToFrac $ fst (randomR (0, max) rg)\n</code></pre>\n\n<p>and this is used like so:</p>\n\n<pre><code>randomTimeBetween :: RandomGen g =&gt; TimeZone -&gt; LocalTime -&gt; LocalTime -&gt; g -&gt; UTCTime\nrandomTimeBetween tz s e rg = addUTCTime (randomSeconds rg (diff tz s e)) (localTimeToUTC tz s)\n</code></pre>\n\n<p>where <code>diff</code> is </p>\n\n<pre><code>diff :: TimeZone -&gt; LocalTime -&gt; LocalTime -&gt; NominalDiffTime\ndiff tz st en = diffUTCTime (localTimeToUTC tz st) (localTimeToUTC tz en)\n</code></pre>\n\n<p>However I'm in the endless cycle of compilation errors where it could not deduce <code>Random NominalDiffTime</code> or can't convert from <code>NominalDiffTime</code> because there's no instance for <code>(Fractional Int)</code> etc </p>\n\n<p>What's the most appropriate/simplest/whatever way of me generating a random <code>NominalDiffTime</code> so I can then add that amount using <code>addUTCTime x utc</code>? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1506205798, "post_id": 46384713, "comment_id": 79727828, "body": "You may check with a function like <code>Data.Bool.bool No Yes . (Yes ==)</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1506206155, "post_id": 46384713, "comment_id": 79727897, "body": "The data type is <code>YesOrNo</code>, as reported by ghci. You want to know which constructor was used, which you can do by pattern matching."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1506207707, "post_id": 46384713, "comment_id": 79728179, "body": "<code>Yes</code> and <code>No</code> are not types, but values. Use <code>case yOrN of Yes -&gt; ... ; No -&gt; ....</code> to check the value, or other forms of pattern matching."}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1506221605, "answer_count": 0, "score": 0, "last_activity_date": 1506204668, "creation_date": 1506204668, "question_id": 46384713, "link": "https://stackoverflow.com/questions/46384713/how-to-know-the-data-type-of-a-value-of-a-sum-type", "closed_reason": "Duplicate", "title": "How to know the data type of a value of a sum type", "body": "<p>Say I have such sum type</p>\n\n<pre><code>data YesOrNo = Yes | No\n</code></pre>\n\n<p>If somehow I have a value of this type in GHCI</p>\n\n<pre><code>&gt;:t yOrN\nyOrN :: YesOrNo\n</code></pre>\n\n<p>Is it possible to get the data type of this value so that I know if it's a Yes or a No? </p>\n\n<p>Context: </p>\n\n<p>I'm using a library that returns a sum type of 10+ types\n<a href=\"https://hackage.haskell.org/package/bson-0.3.2.3/docs/Data-Bson.html#t:Value\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/bson-0.3.2.3/docs/Data-Bson.html#t:Value</a></p>\n\n<p>Now I have a value of this type, I would like to know which data type exactly is that value.</p>\n"}, {"tags": ["scala", "haskell", "f#", "functional-programming", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 12, "last_activity_date": 1506295373, "last_edit_date": 1506295373, "creation_date": 1506201786, "answer_id": 46384406, "question_id": 46384203, "link": "https://stackoverflow.com/questions/46384203/why-doesnt-a-prism-set-function-return-an-option-maybe/46384406#46384406", "title": "Why doesn&#39;t a prism set function return an Option/Maybe", "body": "<p>I doubt there's one definitive answer, so I'll give you two here.</p>\n\n<h3>Origin</h3>\n\n<p>I believe prisms were first imagined (by Dan Doel, if my vague recollection is correct) as \"co-lenses\". Whereas a lens from <code>s</code> to <code>a</code> offers</p>\n\n<pre><code>get :: s -&gt; a\nset :: (s, a) -&gt; s\n</code></pre>\n\n<p>a prism from <code>s</code> to <code>a</code> offers</p>\n\n<pre><code>coget :: a -&gt; s\ncoset :: s -&gt; Either s a\n</code></pre>\n\n<p>All the arrows are reversed, and the product, <code>(,)</code>, is replaced by a coproduct, <code>Either</code>. So a prism in the category of types and functions is a lens in the dual category.</p>\n\n<p>For simple prisms, that <code>s -&gt; Either s a</code> seems a bit weird. Why would you want the original value back? But the <code>lens</code> package also offers <em>type-changing</em> optics. So we end up with</p>\n\n<pre><code>get :: s -&gt; a\nset :: (s, b) -&gt; t\n\ncoget :: a -&gt; s\ncoset :: t -&gt; Either s b\n</code></pre>\n\n<p>Suddenly what we're getting back in the non-matching case may actually be a bit different! What's that about? Here's an example:</p>\n\n<pre><code>cogetLeft :: a -&gt; Either a x\ncogetLeft = Left\n\ncosetLeft :: Either b x -&gt; Either (Either a x) b\ncosetLeft (Left b) = Right b\ncosetLeft (Right x) = Left (Right x)\n</code></pre>\n\n<p>In the second (non-matching) case, the <em>value</em> we get back is the same, but its <em>type</em> has been changed.</p>\n\n<h3>Nice hierarchy</h3>\n\n<p>For both Van Laarhoven (as in <code>lens</code>) and profunctor style frameworks, both lenses and prisms can also stand in for traversals. To do that, they need to have similar forms, and this design accomplishes that. leftaroundabout's answer gives more detail on this aspect.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1506233364, "post_id": 46384712, "comment_id": 79731977, "body": "Is that <code>Just</code> actually a <code>Right</code>?"}, {"owner": {"reputation": 579, "user_id": 8426314, "user_type": "registered", "profile_image": "https://graph.facebook.com/10101771879690894/picture?type=large", "display_name": "Nathan Wilson", "link": "https://stackoverflow.com/users/8426314/nathan-wilson"}, "edited": false, "score": 0, "creation_date": 1506352985, "post_id": 46384712, "comment_id": 79775168, "body": "Thank you, I believe I understand now. Perhaps I will write my own version of a set operation.  F# (which lacks higher kinded types - for now), wouldn&#39;t allow me to express the general form of a traversal, so the fact that a prism is a special case of a traversal is really of no particular benefit that I&#39;m aware of."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 579, "user_id": 8426314, "user_type": "registered", "profile_image": "https://graph.facebook.com/10101771879690894/picture?type=large", "display_name": "Nathan Wilson", "link": "https://stackoverflow.com/users/8426314/nathan-wilson"}, "edited": false, "score": 0, "creation_date": 1506364264, "post_id": 46384712, "comment_id": 79781482, "body": "@NathanWilson, I suspect type-changing prisms may still be useful even in that restricted context, and those really need the extra flexibility of <code>Either</code>."}, {"owner": {"reputation": 579, "user_id": 8426314, "user_type": "registered", "profile_image": "https://graph.facebook.com/10101771879690894/picture?type=large", "display_name": "Nathan Wilson", "link": "https://stackoverflow.com/users/8426314/nathan-wilson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506370537, "post_id": 46384712, "comment_id": 79784759, "body": "@dfeuer, I had honestly never heard of type-changing prisms until reading your answer.  Certainly something I will have to do some research on - thanks for pointing that out to me."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 579, "user_id": 8426314, "user_type": "registered", "profile_image": "https://graph.facebook.com/10101771879690894/picture?type=large", "display_name": "Nathan Wilson", "link": "https://stackoverflow.com/users/8426314/nathan-wilson"}, "edited": false, "score": 1, "creation_date": 1506371547, "post_id": 46384712, "comment_id": 79785302, "body": "@NathanWilson, the basic idea is that if the value is found <i>not</i> to be built from the specified constructor, then any parameters mentioned <i>only</i> under the specified constructor are irrelevant and can be changed to anything whatsoever. <code>[] :: forall a. [a]</code>, <code>Nothing :: forall a. Maybe a</code>, <code>Left (x :: a) :: forall b. Either a b</code>, <code>Right (x :: b) :: forall a. Either a b</code>, etc."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1506247411, "last_edit_date": 1506247411, "creation_date": 1506204659, "answer_id": 46384712, "question_id": 46384203, "link": "https://stackoverflow.com/questions/46384203/why-doesnt-a-prism-set-function-return-an-option-maybe/46384712#46384712", "title": "Why doesn&#39;t a prism set function return an Option/Maybe", "body": "<p>To answer the \u201cwhy\u201d \u2013 lenses etc. are pretty rigidly derived from category theory, so this is actually quite clear-cut \u2013 the behaviour you describe just drops out of the maths, it's not something anybody defined for any purpose but follows from far more general ideas.</p>\n\n<p>Ok, that's not really satisfying.</p>\n\n<p>Not sure if other languages' type systems are powerful enough to express this, but in principle and in Haskell, a prism is a special case of a <em>traversal</em>. \nA traversal is a way to \u201cvisit\u201d all occurences of \u201celements\u201d within some \u201ccontainer\u201d. The classical example is</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\n</code></pre>\n\n<p>This is typically used like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; mapM print [1..4]\n1\n2\n3\n4\n[(),(),(),()]\n</code></pre>\n\n<p>The focus here is on: sequencing the actions/side-effects, and gathering back the result in a container with the same structure as the one we started with.</p>\n\n<p>What's special about a prism is simply that the containers are restricted to contain either one or zero elements<sup>\u2020</sup> (whereas a general traversal can go over any number of elements). But the <code>set</code> operator doesn't know about that because it's strictly more general. The nice thing is that you can therefore use this on a lens, or a prism, or on <code>mapM</code>, and always get a sensible behaviour. But it's <em>not</em> the behaviour of \u201cinsert exactly once into the structure or else tell me if it failed\u201d.</p>\n\n<p>Not that this isn't a sensible operation, just it's not what lens libraries call \u201csetting\u201d. You can do it by explicitly matching and re-building:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>set\u2081 :: Prism s a -&gt; a -&gt; s -&gt; Maybe s\nset\u2081 p x = case matching p x of\n    Left _ -&gt; Nothing\n    Right a -&gt; Just $ a ^. re p\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>More precisely: a prism seperates the cases: a container may either contain one element, and nothing else apart from that, or it may have no element but possibly something unrelated.</sub></p>\n"}], "owner": {"reputation": 579, "user_id": 8426314, "user_type": "registered", "profile_image": "https://graph.facebook.com/10101771879690894/picture?type=large", "display_name": "Nathan Wilson", "link": "https://stackoverflow.com/users/8426314/nathan-wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 46384712, "answer_count": 2, "score": 8, "last_activity_date": 1506295373, "creation_date": 1506199905, "question_id": 46384203, "link": "https://stackoverflow.com/questions/46384203/why-doesnt-a-prism-set-function-return-an-option-maybe", "title": "Why doesn&#39;t a prism set function return an Option/Maybe", "body": "<p>In functional optics, a well-behaved prism (called a partial lens in scala, I believe) is supposed to have a <em>set</em> function of type <code>'subpart -&gt; 'parent -&gt; 'parent</code>, where if the prism \"succeeds\" and is structurally compatible with the <code>'parent</code> argument given, then it returns the <code>'parent</code> given with the appropriate subpart modified to have the <code>'subpart</code> value given.  If the prism \"fails\" and is structurally incompatible with the <code>'parent</code> argument, then it returns the <code>'parent</code> given unmodified.<br>\nI'm wondering why the prism doesn't return a <code>'parent option</code> (<code>Maybe</code> for Haskellers) to represent the pass/fail nature of the set function?  Shouldn't the programmer be able to tell from the return type whether the set was \"successful\" or not?  </p>\n\n<p>I know there's been a lot of research and thought put into the realm of functional optics, so I'm sure there must be a definitive answer that I just can't seem to find.  </p>\n\n<p>(I'm from an F# background, so I apologize if the syntax I've used is a bit opaque for Haskell or Scala programmers).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8661022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d9f90ba853a444f86f3fa7a7665102?s=128&d=identicon&r=PG&f=1", "display_name": "Barbrousse", "link": "https://stackoverflow.com/users/8661022/barbrousse"}, "edited": false, "score": 1, "creation_date": 1506186878, "post_id": 46382068, "comment_id": 79722620, "body": "Thanks for your response, it&#39;s working with the workaround. I will contact the maintainer as suggested."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23, "user_id": 8661022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d9f90ba853a444f86f3fa7a7665102?s=128&d=identicon&r=PG&f=1", "display_name": "Barbrousse", "link": "https://stackoverflow.com/users/8661022/barbrousse"}, "edited": false, "score": 0, "creation_date": 1506188378, "post_id": 46382068, "comment_id": 79723167, "body": "@Barbrousse, I&#39;m not sure an <code>NFData</code> instance will really get you what you want in this case. From the documentation: &quot;The primary motivation for VRefs is to support memory-cached values, i.e. very large data structures that should not be stored in all at once in RAM.&quot; I don&#39;t think it&#39;s very likely that you&#39;ll be able to get a really meaningful sense of the performance of an operation by performing a <code>deepseq</code> on the result. That said, the package should probably offer an <code>NFData</code> instance anyway."}, {"owner": {"reputation": 23, "user_id": 8661022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d9f90ba853a444f86f3fa7a7665102?s=128&d=identicon&r=PG&f=1", "display_name": "Barbrousse", "link": "https://stackoverflow.com/users/8661022/barbrousse"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506208730, "post_id": 46382068, "comment_id": 79728342, "body": "@dfeuer Thanks for your response, do you have any idea of a more accurate test that could be created for this case ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 23, "user_id": 8661022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d9f90ba853a444f86f3fa7a7665102?s=128&d=identicon&r=PG&f=1", "display_name": "Barbrousse", "link": "https://stackoverflow.com/users/8661022/barbrousse"}, "edited": false, "score": 1, "creation_date": 1506217230, "post_id": 46382068, "comment_id": 79729537, "body": "@Barbrousse Presumably the most accurate thing is to test not just the creation of the trie, but also whatever code you think is most representative of the way you will be consuming that same trie. Then you won&#39;t need an <code>NFData</code> instance for the trie, either."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1506185751, "creation_date": 1506185751, "answer_id": 46382068, "question_id": 46381502, "link": "https://stackoverflow.com/questions/46381502/create-a-nfdata-instance-for-trie/46382068#46382068", "title": "Create a NFData instance for Trie", "body": "<p>Ideally, you should contact the maintainer of <code>vcache-trie</code> with a feature request or patch to add the instance, since you would need access to the internal representation of <code>Trie</code> in order to write it.</p>\n\n<p>As a workaround, you can make a locally modified version of the package (e.g., adding a local checkout to <code>extra-deps</code> in Stack) and either add an <code>NFData</code> instance yourself, or add <code>deriving (Generic)</code> to <code>Trie</code> and use <code>deepseq-generics</code> to implement <code>NFData</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1506187440, "creation_date": 1506187440, "answer_id": 46382327, "question_id": 46381502, "link": "https://stackoverflow.com/questions/46381502/create-a-nfdata-instance-for-trie/46382327#46382327", "title": "Create a NFData instance for Trie", "body": "<p>The following should do the trick, but may be slightly less efficient than writing an <code>NFData</code> with access to the internal representation (as suggested by @JonPurdy):</p>\n\n<pre><code>instance NFData a =&gt; NFData (Trie a) where rnf = rnf . toList\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8661022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d9f90ba853a444f86f3fa7a7665102?s=128&d=identicon&r=PG&f=1", "display_name": "Barbrousse", "link": "https://stackoverflow.com/users/8661022/barbrousse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 46382327, "answer_count": 2, "score": 2, "last_activity_date": 1506187440, "creation_date": 1506182282, "question_id": 46381502, "link": "https://stackoverflow.com/questions/46381502/create-a-nfdata-instance-for-trie", "title": "Create a NFData instance for Trie", "body": "<p>I'm currently working on a project using the <a href=\"https://hackage.haskell.org/package/vcache-trie-0.2.4\" rel=\"nofollow noreferrer\">vcache-trie</a> module. I'm looking to test the execution speed of a research inside the trie with the <code>lookupPrefix</code> function. </p>\n\n<p>This is a benchmark created with Criterion for this purpose :</p>\n\n<pre><code>bench \"trieSearch\"  $ nf (lookupPrefix (pack \"ab\")) trie\n</code></pre>\n\n<p>where trie is created in an environment for criterion. The type of this trie is <code>Trie Int</code>. </p>\n\n<p>As the environment is evaluated to normal form I need to create an instance of <a href=\"https://hackage.haskell.org/package/deepseq-1.4.3.0/docs/Control-DeepSeq.html#t:NFData\" rel=\"nofollow noreferrer\">NFData</a> for this specific type. </p>\n\n<p>The content of the trie for this specific case is [(ByteString, Int)], I assume the instance of NFData should evaluate each tuple but I'm not sure how to proceed.</p>\n\n<p>Any help would be greatly appreciate, thanks for taking the time to read my issue. </p>\n"}, {"tags": ["haskell", "websocket"], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1506183124, "post_id": 46381419, "comment_id": 79721438, "body": "Maybe I&#39;m using the word &quot;thing&quot; too much."}, {"owner": {"reputation": 4631, "user_id": 4037, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/OoCae.png?s=128&g=1", "display_name": "Daisuke Shimamoto", "link": "https://stackoverflow.com/users/4037/daisuke-shimamoto"}, "edited": false, "score": 0, "creation_date": 1506183356, "post_id": 46381419, "comment_id": 79721511, "body": "Ah, that makes sense. Some old sample code on the Internet was using this function to merely fork off workers and return (causing the socket to close for newer Wuss versions). I guess the sample was using this function in the wrong way to start with."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 4631, "user_id": 4037, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/OoCae.png?s=128&g=1", "display_name": "Daisuke Shimamoto", "link": "https://stackoverflow.com/users/4037/daisuke-shimamoto"}, "edited": false, "score": 1, "creation_date": 1506184119, "post_id": 46381419, "comment_id": 79721775, "body": "@DaisukeShimamoto, yes I think so. It should be &quot;fork $ runSecureClientWithConfig ...&quot; rather than &quot;runSecureClientWithConfig ... $ fork ...&quot;"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 4, "last_activity_date": 1506181833, "creation_date": 1506181833, "answer_id": 46381419, "question_id": 46381193, "link": "https://stackoverflow.com/questions/46381193/should-websockets-be-closed/46381419#46381419", "title": "Should WebSockets be closed?", "body": "<p>The idea of this function is that it runs <code>app</code>, and once <code>app</code> terminates the resources it used are recovered.</p>\n\n<p>Typically <code>app</code> will be a long-running thing which listens at the port for connections and does the appropriate thing when one arrives. So closing the port and recovering the resources is the Right Thing. The <a href=\"https://github.com/tfausak/wuss/commit/408d551debf74bf99e4df257522cf25ef82fd6d8\" rel=\"nofollow noreferrer\">previous version</a> didn't do this, leading to a resource leak.</p>\n"}], "owner": {"reputation": 4631, "user_id": 4037, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/OoCae.png?s=128&g=1", "display_name": "Daisuke Shimamoto", "link": "https://stackoverflow.com/users/4037/daisuke-shimamoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 46381419, "answer_count": 1, "score": 1, "last_activity_date": 1506181833, "creation_date": 1506180406, "last_edit_date": 1506181684, "question_id": 46381193, "link": "https://stackoverflow.com/questions/46381193/should-websockets-be-closed", "title": "Should WebSockets be closed?", "body": "<p>I was looking at some WebSocket library for Haskell, namely <a href=\"https://github.com/tfausak/wuss\" rel=\"nofollow noreferrer\">Wuss</a> and found something that might render it unusable.</p>\n\n<p>The latest commit (<a href=\"https://github.com/tfausak/wuss/tree/04ab5d3f725d61fa15d8ecccfeaa6518713aa3aa\" rel=\"nofollow noreferrer\">04ab5d3f72</a>), uses <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception.html#v:bracket\" rel=\"nofollow noreferrer\"><code>Control.Exception.Bracket</code></a> and <strong>always closes</strong> the connection.</p>\n\n<p><a href=\"https://github.com/tfausak/wuss/blob/04ab5d3f725d61fa15d8ecccfeaa6518713aa3aa/Wuss.hs#L163\" rel=\"nofollow noreferrer\">Wuss.hs#L163</a></p>\n\n<pre><code>runSecureClientWithConfig host port path config options headers app = do\n    context &lt;- Connection.initConnectionContext\n    Exception.bracket\n        (Connection.connectTo context (connectionParams host port))\n        Connection.connectionClose     -- &lt;-- This line closes the connection\n        (\\connection -&gt; do\n            stream &lt;-\n                Stream.makeStream (reader config connection) (writer connection)\nWebSockets.runClientWithStream stream host path options headers app)\n</code></pre>\n\n<p>If I'm not mistaking, shouldn't this function keep the connection open as it's a WebSocket (or close it only if something errored)?</p>\n\n<p>I would be surpirsed for a library with recent commits (2017) to have such a bug and I'm no expert in Haskell nor in WebSockets so I might just be missing something...</p>\n"}, {"tags": ["regex", "haskell", "unicode"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1506183650, "post_id": 46381142, "comment_id": 79721606, "body": "Looks like it works great ! Thanks a lot, it&#39;s actually a lot simpler than I expected. A simple &gt;= &lt;= .."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506186952, "post_id": 46381142, "comment_id": 79722644, "body": "No need to <code>fromEnum</code>, just <code>isEmoji c = c &gt;= &#39;\\x1f600&#39; &amp;&amp; c &lt;= &#39;\\x1f64f&#39;</code>."}, {"owner": {"reputation": 1679, "user_id": 5171110, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dcb5e1caccc071299f63c26271f1d244?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/5171110/artem"}, "edited": false, "score": 0, "creation_date": 1506285588, "post_id": 46381142, "comment_id": 79746534, "body": "The range is 0x1f000..0x1f9ff: <a href=\"http://unicode.org/emoji/charts/full-emoji-list.html\" rel=\"nofollow noreferrer\">unicode.org/emoji/charts/full-emoji-list.html</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1506190314, "last_edit_date": 1506190314, "creation_date": 1506180117, "answer_id": 46381142, "question_id": 46380952, "link": "https://stackoverflow.com/questions/46380952/remove-all-emojis-from-a-string-in-haskell/46381142#46381142", "title": "Remove all emojis from a string in Haskell", "body": "<p>Not a emoji or unicode expert, but this seems to work:</p>\n\n<pre><code>isEmoji :: Char -&gt; Bool\nisEmoji c = let uc = fromEnum c\n            in uc &gt;= 0x1F600 &amp;&amp; uc &lt;= 0x1F64F\n\nstr = \"\ud83d\ude01wew\ud83d\ude01\"\n</code></pre>\n\n<p>As Daniel Wagner points out, this can be made even better:</p>\n\n<pre><code>isEmoji :: Char -&gt; Bool\nisEmoji c = c &gt;= '\\x1F600' &amp;&amp; c &lt;= '\\x1F64F'\n</code></pre>\n\n<p>Demo in ghci:</p>\n\n<pre><code>\u03bb&gt; str\n\"\\128513wew\\128513\"\n\u03bb&gt; filter isEmoji str\n\"\\128513\\128513\"\n\u03bb&gt; filter (not . isEmoji) str\n\"wew\"\n</code></pre>\n\n<p>Explanation: <code>fromEnum</code> function converts the character to the corresponding <code>Int</code> value defined by the Unicode. I just check for the unicode range of emoji in the function to determine if it's actually an emoji.</p>\n"}, {"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1506183702, "post_id": 46381211, "comment_id": 79721627, "body": "Thanks, that does work ! I went with the other answer &#39;cause it&#39;s lighter I think, but both achieve what I was looking for"}], "tags": [], "owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "is_accepted": false, "score": 3, "last_activity_date": 1506180519, "creation_date": 1506180519, "answer_id": 46381211, "question_id": 46380952, "link": "https://stackoverflow.com/questions/46380952/remove-all-emojis-from-a-string-in-haskell/46381211#46381211", "title": "Remove all emojis from a string in Haskell", "body": "<p>Unicode characters are represented by a single backslash, followed by an optional <code>x</code> for hexadecimal, <code>o</code> for octal and none for decimal number representing the character [0]:</p>\n\n<pre><code>putStrLn \"\\x1f600\" -- \ud83d\ude00\n</code></pre>\n\n<p>Here, <code>\\x</code> is a prefix for the hexadecimal representation of the first emoji character in Unicode.</p>\n\n<p>You can now remove the emojis using RegExp or you could simply do:</p>\n\n<pre><code>emojis = concat [['\\x1f600'..'\\x1F64F'],\n                 ['\\x1f300'..'\\x1f5ff'],\n                 ['\\x1f680'..'\\x1f6ff'],\n                 ['\\x1f1e0'..'\\x1f1ff']]\nsomeString = \"hello \ud83d\ude4b\"\nremoveEmojis = filter (`notElem` emojis)\n\nputStrLn . removeEmojis $ someString -- \"hello \"\n</code></pre>\n\n<p>[0] <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#dx7-20001\" rel=\"nofollow noreferrer\">Haskell Language 2010: Lexical Structure#Character and String Literals</a></p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 46381142, "answer_count": 2, "score": 2, "last_activity_date": 1506190314, "creation_date": 1506178887, "question_id": 46380952, "link": "https://stackoverflow.com/questions/46380952/remove-all-emojis-from-a-string-in-haskell", "title": "Remove all emojis from a string in Haskell", "body": "<p>I made a Mastodon / Twitter &lt;--> IRC bot a while back. It's been working great, but someone complained that when people use emojis on mastodon (which seems to happen a lot in some usernames ..) it breaks his terminal.</p>\n\n<p>I was wondering if there is a way to remove those from the ByteStrings before sending them to IRC (or at least provide an option to do so), googling a bit I found this : <a href=\"https://stackoverflow.com/questions/33404752/removing-emojis-from-a-string-in-python\">removing emojis from a string in Python</a></p>\n\n<p>Looks like \\U0001F600-\\U0001F64F should be the emoji range if I understand it correctly, but I've never been big with regex. Any easy-ish way to translate that to Haskell ? I've tried reading up a bit on regex but I only get \"lexical error in string/character literal at character 'U'\" when I try, I assume that syntax must be a python thing.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1506177017, "post_id": 46380633, "comment_id": 79719640, "body": "Uh. Give them the same number of arguments?"}], "answers": [{"comments": [{"owner": {"reputation": 491, "user_id": 5137138, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e37c34a79c1a83fe429961233358ef39?s=128&d=identicon&r=PG&f=1", "display_name": "Leomar de Souza", "link": "https://stackoverflow.com/users/5137138/leomar-de-souza"}, "edited": false, "score": 0, "creation_date": 1506177528, "post_id": 46380672, "comment_id": 79719773, "body": "I&#39;m amazed how I forgot that little detail. A very stupid mistake. Excuse me."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 1, "last_activity_date": 1506177077, "creation_date": 1506177077, "answer_id": 46380672, "question_id": 46380633, "link": "https://stackoverflow.com/questions/46380633/error-equations-for-testlisttuple-have-different-numbers-of-arguments/46380672#46380672", "title": "Error: equations for \u2018testListTuple\u2019 have different numbers of arguments", "body": "<p>The problem is in exactly what compiler says. Equations for <code>testListTuple</code> have different numbers of arguments.</p>\n\n<p>The first equation has two : <code>testListTuple (exp) ((a,b):xs) = ...</code>.</p>\n\n<p>The second one has one: <code>testListTuple _ = []</code></p>\n\n<p>The correct definition is:</p>\n\n<pre><code>testListTuple :: Expression -&gt; [(Symbol,Symbol)] -&gt; [Symbol]\ntestListTuple exp ((a,b):xs) = functionTest exp a b : testListTuple exp xs\ntestListTuple _ _ = []\n</code></pre>\n"}], "owner": {"reputation": 491, "user_id": 5137138, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e37c34a79c1a83fe429961233358ef39?s=128&d=identicon&r=PG&f=1", "display_name": "Leomar de Souza", "link": "https://stackoverflow.com/users/5137138/leomar-de-souza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 46380672, "answer_count": 1, "score": -2, "last_activity_date": 1506177139, "creation_date": 1506176861, "last_edit_date": 1506177139, "question_id": 46380633, "link": "https://stackoverflow.com/questions/46380633/error-equations-for-testlisttuple-have-different-numbers-of-arguments", "title": "Error: equations for \u2018testListTuple\u2019 have different numbers of arguments", "body": "<p>I'm trying to do a function that gets an <code>Expression</code> and a <code>list of tuples (a pair of strings)</code>, according to the following code:</p>\n\n<pre><code>module Test where\n\nimport Data.List\n\ntype Symbol = String\n\ndata Expression = Var Symbol    -- variable\n    | Lambda Symbol Expression  -- abstraction\n    | App Expression Expression -- application\n    deriving (Eq, Read)\n\nexpTest = Lambda \"x\" $ Lambda \"y\" $ (Var \"x\" `App` Var \"y\")\n\ntestListTuple :: Expression -&gt; [(Symbol,Symbol)] -&gt; [Symbol]\ntestListTuple (exp) ((a,b):xs) = functionTest (exp) (a) (b) : testListTuple (exp) (xs)\ntestListTuple _          = []\n\n\nfunctionTest :: Expression -&gt; Symbol -&gt; Symbol -&gt; Symbol\nfunctionTest _ a b = a ++ b\n\nrunTest = testListTuple expTest [(\"a\", \"b\"), (\"c\", \"d\")]\n</code></pre>\n\n<p>However, the following error is displayed:</p>\n\n<p><a href=\"https://i.stack.imgur.com/m6EYB.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/m6EYB.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>After resolving this error, I will still finish implementing the <code>functionTest</code>.</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1506176160, "creation_date": 1506176160, "answer_id": 46380522, "question_id": 46380501, "link": "https://stackoverflow.com/questions/46380501/haskell-understanding-where-and-pattern-matching/46380522#46380522", "title": "Haskell - Understanding where and pattern matching", "body": "<pre><code>sm :: [Integer] -&gt; Integer\n   -- ^^^^^^^^^ one argument\nsm lst [] = ...\n-- ^^^ ^^ two arguments\nsm lst [x:xs]= ...\n-- ^^^ ^^^^^^ two arguments\n</code></pre>\n\n<p>You need to remove <code>lst</code>, and only pattern match on the other argument.</p>\n\n<p>Further, <code>(x:xs)</code> does not use square brackets. The pattern <code>[x:xs]</code> matches a single-element list, where the element is a non empty list <code>x:xs</code> -- you don't want to match a list-of-lists.</p>\n\n<p>A possible fix is therefore:</p>\n\n<pre><code>mysum :: [Integer] -&gt; Integer\nmysum lst = sm lst\n  where \n  sm :: [Integer] -&gt; Integer\n  sm [] = 0\n  sm (x : xs) = x + sm xs\n</code></pre>\n\n<p>There is a redundancy above: <code>mysum</code> and <code>sm</code> do the same thing! So, we can remove the auxiliary definition.</p>\n\n<pre><code>mysum :: [Integer] -&gt; Integer\nmysum []       = 0\nmusum (x : xs) = x + mysum xs\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 7419652, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e1fa1bb27a5e810acb7030d2888711d?s=128&d=identicon&r=PG&f=1", "display_name": "Mikkel bruun", "link": "https://stackoverflow.com/users/7419652/mikkel-bruun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 46380522, "answer_count": 1, "score": 0, "last_activity_date": 1506176160, "creation_date": 1506176013, "question_id": 46380501, "link": "https://stackoverflow.com/questions/46380501/haskell-understanding-where-and-pattern-matching", "title": "Haskell - Understanding where and pattern matching", "body": "<p>Im trying to create a sum function in haskell. I'm doing this to get more familiar with the language. I've defined it as so:</p>\n\n<pre><code>mysum :: [Integer] -&gt; Integer\nmysum lst = sm lst\n  where \n    sm :: [Integer] -&gt; Integer\n    sm lst [] = 0\n    sm lst [x:xs]=\n      x + sm xs\n</code></pre>\n\n<p>The idea was to return the value of the head of the list, + the tail fed back into the function. I recall doing something similar in F#, but i simply cant get it to work in haskell.</p>\n\n<pre><code>The error im getting is:\nsum.hs:5:5: error:\n    \u2022 Couldn't match expected type \u2018Integer\u2019\n                  with actual type \u2018[[Integer]] -&gt; Integer\u2019\n    \u2022 The equation(s) for \u2018sm\u2019 have two arguments,\n      but its type \u2018[Integer] -&gt; Integer\u2019 has only one\n      In an equation for \u2018mysum\u2019:\n          mysum lst\n            = sm lst\n            where\n                sm :: [Integer] -&gt; Integer\n                sm lst [] = 0\n                sm lst [x : xs] = x + sm xs\n  |\n5 |     sm lst [] = 0\n  |     ^^^^^^^^^^^^^...\n</code></pre>\n"}, {"tags": ["haskell", "testing"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1506151223, "post_id": 46376965, "comment_id": 79712892, "body": "Hi thanks. I like the code block with <code>tc1 = catch (print $ test 1) (\\err -&gt; print (err :: SomeException))</code> <code>...</code>"}, {"owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1506151276, "post_id": 46376965, "comment_id": 79712901, "body": "I have a question, if I have a list ie <code>allTests = [tc1,tc2,tc3,tc4]</code> can i use something similar on this list in order to reduce the duplicate code ??"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "edited": false, "score": 0, "creation_date": 1506151418, "post_id": 46376965, "comment_id": 79712926, "body": "@Jhoy First, understand that that <code>catch</code> code is not elegant, or even appropriate, Haskell code. That said, you can use <code>map</code> (or <code>fmap</code>) on <code>[a]</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 4, "last_activity_date": 1506151028, "last_edit_date": 1506151028, "creation_date": 1506150062, "answer_id": 46376965, "question_id": 46376632, "link": "https://stackoverflow.com/questions/46376632/testing-haskell-functions-that-return-errors/46376965#46376965", "title": "Testing haskell functions that return errors", "body": "<p>You could try to use <code>catch</code> from <code>Control.Exception</code>, but that's still an awkward way to achieve the goal.</p>\n\n<p>It'd be better to use a pure data type to capture errors, as they're easier to compose and collect. Normally, you'd use <code>Either</code> for that, but in this particular case, the success case would carry no information, so the type would be <code>Either String ()</code>, which is isomorphic to <code>Maybe String</code>. Rewriting <code>test</code> to return <code>Maybe String</code> is trivial:</p>\n\n<pre><code>test :: Int -&gt; Maybe String\ntest 1  = Just \"shouldnt have been 1\"\ntest 2  = Just \"shouldnt have been 2\"\ntest 11 = Just \"shouldnt have been 11\"\ntest 77 = Just \"shouldnt have been 77\"\ntest _  = Nothing\n\ntc1 = test 1\ntc2 = test 2\ntc3 = test 11\ntc4 = test 77\ntc5 = test 5\n</code></pre>\n\n<p>I added a <code>tc5</code> value in order to demonstrate what happens when a test succeeds.</p>\n\n<p>You can evaluate all of those test cases, but if you want only the failure cases, you can use <code>catMaybes</code> from <code>Data.Maybe</code>:</p>\n\n<pre><code>allTests = catMaybes [tc1, tc2, tc3, tc4, tc5]\n</code></pre>\n\n<p>Here's the result of running <code>allTests</code>:</p>\n\n<pre><code>*Q46376632&gt; allTests\n[\"shouldnt have been 1\",\n \"shouldnt have been 2\",\n \"shouldnt have been 11\",\n \"shouldnt have been 77\"]\n</code></pre>\n\n<hr>\n\n<p>If you can't change the function you're testing, you can try something like the following, but it's hardly elegant:</p>\n\n<pre><code>tc1 = catch (print $ test 1) (\\err -&gt; print (err :: SomeException))\ntc2 = catch (print $ test 2) (\\err -&gt; print (err :: SomeException))\ntc3 = catch (print $ test 11) (\\err -&gt; print (err :: SomeException))\ntc4 = catch (print $ test 77) (\\err -&gt; print (err :: SomeException))\ntc5 = catch (print $ test 5) (\\err -&gt; print (err :: SomeException))\n\nallTests = sequence_ [tc1, tc2, tc3, tc4, tc5]\n</code></pre>\n\n<p>When running it, you get output like this:</p>\n\n<pre><code>*Q46376632&gt; allTests\nshouldnt have been 1\nCallStack (from HasCallStack):\n  error, called at 46376632.hs:14:10 in main:Q46376632\nshouldnt have been 2\nCallStack (from HasCallStack):\n  error, called at 46376632.hs:15:10 in main:Q46376632\nshouldnt have been 11\nCallStack (from HasCallStack):\n  error, called at 46376632.hs:16:11 in main:Q46376632\nshouldnt have been 77\nCallStack (from HasCallStack):\n  error, called at 46376632.hs:17:11 in main:Q46376632\nTrue\n</code></pre>\n\n<p>At this point, you'd probably be better of using a proper testing framework.</p>\n"}], "owner": {"reputation": 107, "user_id": 8470375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1511c9b38f531312f5d399019de5582?s=128&d=identicon&r=PG&f=1", "display_name": "Jhoy", "link": "https://stackoverflow.com/users/8470375/jhoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 46376965, "answer_count": 1, "score": 1, "last_activity_date": 1506162140, "creation_date": 1506146969, "last_edit_date": 1506162140, "question_id": 46376632, "link": "https://stackoverflow.com/questions/46376632/testing-haskell-functions-that-return-errors", "title": "Testing haskell functions that return errors", "body": "<p>Hi I have a similar to the following haskell function</p>\n\n<pre><code>test :: Int -&gt; Bool\ntest 1  = error \"shouldnt have been 1\"\ntest 2  = error \"shouldnt have been 2\"\ntest 11 = error \"shouldnt have been 11\"\ntest 77 = error \"shouldnt have been 77\"\ntest _  = True\n</code></pre>\n\n<p>I have a testing scheme to test bad inputs to make sure they return the correct error</p>\n\n<pre><code>tc1 = test 1\ntc2 = test 2\ntc3 = test 11\ntc4 = test 77\n\nallTests = [tc1, tc2, tc3, tc4]\n</code></pre>\n\n<p>But the problem is that when I run <code>allTests</code> in ghci, I only get the first error. I would like to have a list of all the errors</p>\n\n<p>How can this be done or some way I can catch the errors?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1506151209, "post_id": 46376603, "comment_id": 79712889, "body": "What would the type of <code>[(2, 10), 1]</code> be?"}, {"owner": {"reputation": 589, "user_id": 1494159, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2af3dee10db5e7d656a93ee582c4c66b?s=128&d=identicon&r=PG", "display_name": "Ajit", "link": "https://stackoverflow.com/users/1494159/ajit"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506151844, "post_id": 46376603, "comment_id": 79713025, "body": "I see your point, think it should also be another user defined type"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506152033, "post_id": 46376603, "comment_id": 79713059, "body": "If you just want it to display nicely, you could map both to <code>String</code>, so that it&#39;d become <code>[&quot;(2, 10)&quot;, &quot;1&quot;]</code>. You can&#39;t use the default instances of <code>show</code> for that, though, because (IIRC) it&#39;d render <code>Tuple (2, 10)</code> as <code>&quot;Tuple (2, 10)&quot;</code>."}, {"owner": {"reputation": 589, "user_id": 1494159, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2af3dee10db5e7d656a93ee582c4c66b?s=128&d=identicon&r=PG", "display_name": "Ajit", "link": "https://stackoverflow.com/users/1494159/ajit"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506152562, "post_id": 46376603, "comment_id": 79713179, "body": "@MarkSeemann What I mean is, can I really store different data types in an array somehow. Something like you mentioned, defining an array type that stores tuples and elements. Instead of assigning elements of the array to a datatype"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1506153131, "post_id": 46376603, "comment_id": 79713330, "body": "These 99 problems are nothing but trouble. They&#39;re really not written for Haskell. You&#39;ve solved the problem; move on!"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1506154033, "post_id": 46376603, "comment_id": 79713552, "body": "As @dfeuer writes, you&#39;ve solved the problem. That&#39;s how it&#39;s done in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1506154049, "creation_date": 1506154049, "answer_id": 46377467, "question_id": 46376603, "link": "https://stackoverflow.com/questions/46376603/haskell-heterogeneous-arrays/46377467#46377467", "title": "Haskell - heterogeneous arrays?", "body": "<p>No, there is no way to do that. What you've done already is the best and most idiomatic solution.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1506159286, "creation_date": 1506159286, "answer_id": 46378131, "question_id": 46376603, "link": "https://stackoverflow.com/questions/46376603/haskell-heterogeneous-arrays/46378131#46378131", "title": "Haskell - heterogeneous arrays?", "body": "<p>As already said, explicitly tagging which type each element has is the correct thing to do. This pays off when you actually want to <em>use</em> that list, because you can simply pattern match on the elements and then know in each clause for sure which types you have!</p>\n\n<p>However, that doesn't mean such a list must always be <em>written out</em> with those verbose constructor names. You can save a lot of boilerplate by choosing different constructor names, in particular <em>infix constructors</em>:</p>\n\n<pre><code>data Hetero a = Int :* a | Elem a\n</code></pre>\n\n<p>Then your list looks like</p>\n\n<pre><code>[2 :* 10, Elem 1]\n</code></pre>\n\n<p>You could even allow defining those values by single numbers literals, by way of the instance</p>\n\n<pre><code>instance (Num a) =&gt; Num (Hetero a) where\n  fromIntegral = Elem . fromIntegral\n</code></pre>\n\n<p>...which then allows writing</p>\n\n<pre><code>[2:*10, 1]\n</code></pre>\n\n<p>However this is probably not a good idea, because a <code>Num</code> type is also supposed to support addition, multiplication etc., which I'm not sure can be defined sensibly for the tuple case. If you go that route, you should make sure the arithmetic operations actually behave sanely.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1506163681, "post_id": 46378737, "comment_id": 79716008, "body": "This is possible, but I wouldn&#39;t recommend it. The output of <code>show</code> is supposed to be valid Haskell code, but <code>[(2,10), 1]</code> is only valid if the elements really are plain tuples rather than <code>Hetero</code> values <i>and</i> if you give these plain tuples a <code>Num</code> instance, which would pretty clearly be a bad idea."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1506163411, "creation_date": 1506163411, "answer_id": 46378737, "question_id": 46376603, "link": "https://stackoverflow.com/questions/46376603/haskell-heterogeneous-arrays/46378737#46378737", "title": "Haskell - heterogeneous arrays?", "body": "<blockquote>\n  <p>But then my result <em>looks</em> something like this:</p>\n</blockquote>\n\n<p>(my emphasis)</p>\n\n<p>You can address that issue by changing the definition of <code>Hetero</code>:</p>\n\n<pre><code>data Hetero a = Tuple (Int, a) | Elem a deriving (Ord, Eq)\n\ninstance Show a =&gt; Show (Hetero a) where\n  show (Tuple (i, x)) = \"(\" ++ show i ++ \", \" ++ show x ++ \")\"\n  show (Elem x) = show x\n</code></pre>\n\n<p>Now a list of <code>Hetero</code> elements will look as you'd like it to look:</p>\n\n<pre><code>*Q46376603&gt; [Tuple (2, 10), Elem 1]\n[(2, 10),1]\n</code></pre>\n"}], "owner": {"reputation": 589, "user_id": 1494159, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2af3dee10db5e7d656a93ee582c4c66b?s=128&d=identicon&r=PG", "display_name": "Ajit", "link": "https://stackoverflow.com/users/1494159/ajit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 46377467, "answer_count": 3, "score": 2, "last_activity_date": 1506163411, "creation_date": 1506146758, "last_edit_date": 1506150904, "question_id": 46376603, "link": "https://stackoverflow.com/questions/46376603/haskell-heterogeneous-arrays", "title": "Haskell - heterogeneous arrays?", "body": "<p>I am trying to learn haskell with 99 Haskell problems : </p>\n\n<p><a href=\"https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems</a>.\nFor one of the problems I have to return a heterogeneous array of <code>Element</code> and tuples of the form <code>(Int, Element)</code>. Since haskell doesn't allow storing heterogeneous data in array, the best I could come up with was </p>\n\n<pre><code>data Hetero a = Tuple (Int, a) | Elem a deriving (Show, Ord, Eq)\n</code></pre>\n\n<p>then write my function like: </p>\n\n<pre><code>myFunk [a] -&gt; [Hetero a] \n\n-- Rest of the function\n</code></pre>\n\n<p>But then my result looks something like this: </p>\n\n<pre><code>[Tuple (2, 10), Elem 1]\n</code></pre>\n\n<p>Is there a way I could modify my data type or function to return something like</p>\n\n<pre><code>[(2, 10), 1] \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1506142061, "post_id": 46376111, "comment_id": 79711256, "body": "A spectacularly inefficient solution would be: <code>fibSum = map fib . enumFromTo 0</code>."}], "answers": [{"tags": [], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "is_accepted": true, "score": 2, "last_activity_date": 1506168154, "last_edit_date": 1506168154, "creation_date": 1506145865, "answer_id": 46376505, "question_id": 46376111, "link": "https://stackoverflow.com/questions/46376111/created-a-function-that-calculates-fib-of-some-number-and-now-i-want-to-add-all/46376505#46376505", "title": "Created a function that calculates fib of some number and now I want to add all them to a list", "body": "<p>Here is a good solution</p>\n\n<pre><code>fibs :: [Integer]\nfibs = 0:1:zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>but if we improve on your solution we get:</p>\n\n<pre><code>fib :: Integer -&gt; Integer\nfib 0 = 0\nfib 1 = 1\nfib n = fib(n-1) + fib (n-2)\n\nfibs :: [Integer]\nfibs = fmap fib [0..]\n</code></pre>\n\n<p>which is way less efficient than the first solution.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1506186017, "creation_date": 1506186017, "answer_id": 46382100, "question_id": 46376111, "link": "https://stackoverflow.com/questions/46376111/created-a-function-that-calculates-fib-of-some-number-and-now-i-want-to-add-all/46382100#46382100", "title": "Created a function that calculates fib of some number and now I want to add all them to a list", "body": "<p>The <code>fibs</code> version in @milad zahedi's answer is a classic Haskell method for generating the infinite sequence, though it's probably too clever by half for someone just learning Haskell.  Here's another method of coming up with a decent answer.</p>\n\n<p>A very standard way of generating a list recursively in Haskell is to write something like this:</p>\n\n<pre><code>countDownFrom 0 = []\ncountDownFrom n = n : countDownFrom (n-1)\n</code></pre>\n\n<p>Here, the second line generates a list by producing the next element <code>n</code> and attaching it at the head of the \"rest of the list\", generated by a recursive call to <code>countDownFrom (n-1)</code>.  The first line provides the base case when we reach zero, so we don't keep counting forever (assuming we started with a non-negative integer -- otherwise, yikes!).</p>\n\n<p>Counting <strong>up</strong> needs to be handled a little differently, since:</p>\n\n<pre><code>countUpFrom n = n : countUpFrom (n+1)\n</code></pre>\n\n<p>doesn't have a common base case -- it depends how high we want to count.  There are lots of ways of handling this in Haskell, but a pretty common pattern is to generate an infinite list and take a finite number of elements from the beginning:</p>\n\n<pre><code>countUpLen n = take n (countUpFrom 1)\n   where countUpFrom n = n : countUpFrom (n+1)\n</code></pre>\n\n<p>where <code>countUpLen 5</code> generates <code>[1,2,3,4,5]</code>.</p>\n\n<p>With all that said, we can use a similar pattern for your Fibonacci sequence.  However, if we try to write:</p>\n\n<pre><code>fibs n = take n (allFibs 0)\n\nallFibs x = x : allFibs ???\n</code></pre>\n\n<p>we run into a bit of a problem.  For example, if <code>allFibs 1</code> is supposed to generate the sequence starting with 1, it's not clear if it should generate <code>[1,1,2,3,...]</code> or <code>[1,2,3,5,...]</code> -- in other words, which 1 are we starting with?</p>\n\n<p>Fixing this requires a bit of trick, though once you've seen it, it's obvious.  Let's say we need to generate the part of the Fibonacci sequence that starts <code>[2,3,5,...]</code>.  If we kept track of the next <strong>two</strong> numbers (2 and 3), it would be easy -- we'd spit out 2 and attach it at the head of the rest of the sequence, which would be generated by the <strong>two</strong> numbers 3 and 5 (calculated from 2+3).  In other words, for this specific case, we'd have:</p>\n\n<pre><code>allFibs 2 3 = 2 : allFibs 3 (2+3)\n</code></pre>\n\n<p>and more generally, we could write:</p>\n\n<pre><code>allFibs a b = a : allFibs b (a+b)\n</code></pre>\n\n<p>The interpretation is that <code>allFibs a b</code> generates \"the rest of the Fibonacci sequence starting with <code>a</code> and <code>b</code>\".</p>\n\n<p>Then, we can write the final solution:</p>\n\n<pre><code>fibs :: Int -&gt; [Int]\nfibs n = take n (allFibs 0 1)\n    where allFibs a b = a : allFibs b (a+b)\n</code></pre>\n\n<p>which works like so:</p>\n\n<pre><code>&gt; fibs 10\n[0,1,1,2,3,5,8,13,21,34]\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 46376505, "answer_count": 2, "score": 0, "last_activity_date": 1506186017, "creation_date": 1506141655, "question_id": 46376111, "link": "https://stackoverflow.com/questions/46376111/created-a-function-that-calculates-fib-of-some-number-and-now-i-want-to-add-all", "title": "Created a function that calculates fib of some number and now I want to add all them to a list", "body": "<p>So I created this function to calculate the fib of some number, pretty standard:</p>\n\n<pre><code>fib 0 = 0\nfib 1 = 1\nfib x = fib(x-1) + fib(x-2)\n</code></pre>\n\n<p>But now I want to be able to calculate the fib up to some number and add each of those answers to a list. For example, if I were to calculate the fib up 6 then I should get a list of [0, 1, 1, 2, 3, 5, 8]</p>\n"}, {"tags": ["haskell", "if-statement"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506141876, "post_id": 46376106, "comment_id": 79711227, "body": "Looks like your are missing an <code>=</code>. Replace the line <code>trueChar char</code> with <code>trueChar char =</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506159822, "post_id": 46376106, "comment_id": 79714895, "body": "Note that <code>char</code> in <code>char == &quot;..&quot;</code> is not actually a char, but a string. It&#39;s a misleading choice of a name."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1506153872, "post_id": 46376522, "comment_id": 79713512, "body": "...but don&#39;t write <code>if foo then True else False</code>. Just write <code>foo</code> instead."}], "tags": [], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "is_accepted": true, "score": 0, "last_activity_date": 1506145973, "creation_date": 1506145973, "answer_id": 46376522, "question_id": 46376106, "link": "https://stackoverflow.com/questions/46376106/if-then-else-statment-returns-parse-error-on-input-if-in-haskell/46376522#46376522", "title": "if then else statment returns &quot;parse error on input `if&#39;&quot; in haskell", "body": "<p>you are missing an equal sign, this is correct:</p>\n\n<pre><code>trueChar char =\n    if char == \"True\"\n        then True \n        else False\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 4724765, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-ZxRSYYYw3Ok/AAAAAAAAAAI/AAAAAAAAAA8/XcIZ_iULnXU/photo.jpg?sz=128", "display_name": "Charles Zhang", "link": "https://stackoverflow.com/users/4724765/charles-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "accepted_answer_id": 46376522, "answer_count": 1, "score": 0, "last_activity_date": 1506145973, "creation_date": 1506141627, "question_id": 46376106, "link": "https://stackoverflow.com/questions/46376106/if-then-else-statment-returns-parse-error-on-input-if-in-haskell", "title": "if then else statment returns &quot;parse error on input `if&#39;&quot; in haskell", "body": "<p>I just can't get this to work. Keeps giving me the error \"parse error on input `if'\" in sublime.</p>\n\n<pre><code>trueChar char \n    if char == \"True\"\n        then True \n        else False\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1506134022, "post_id": 46375448, "comment_id": 79710141, "body": "Whoops, missed the typo.  Good catch."}], "tags": [], "owner": {"reputation": 231, "user_id": 5824635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c43dd400f3c9c2cbaeb8986532cd359b?s=128&d=identicon&r=PG&f=1", "display_name": "homura", "link": "https://stackoverflow.com/users/5824635/homura"}, "is_accepted": true, "score": 2, "last_activity_date": 1506133794, "creation_date": 1506133794, "answer_id": 46375448, "question_id": 46375377, "link": "https://stackoverflow.com/questions/46375377/create-a-function-that-takes-a-list-of-pairs-learnyouahaskell/46375448#46375448", "title": "Create a function that takes a list of pairs -- learnyouahaskell", "body": "<p>Your second element is \"2.4\" instead of \"(2,4)\". Running \"calcBmis [(1,2),(2,4)]\" should work.</p>\n"}], "owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 46375448, "answer_count": 1, "score": -2, "last_activity_date": 1506135085, "creation_date": 1506132869, "last_edit_date": 1506135085, "question_id": 46375377, "link": "https://stackoverflow.com/questions/46375377/create-a-function-that-takes-a-list-of-pairs-learnyouahaskell", "title": "Create a function that takes a list of pairs -- learnyouahaskell", "body": "<p>so I'm trying to understand this function in the tutorial learnyouahaskell and it doesn't seem to be working correctly. As I understand, it should take in a list of pairs and return a list of BMI's from those pairs.</p>\n\n<pre><code>calcBmis :: (RealFloat a) =&gt; [(a, a)] -&gt; [a]  \ncalcBmis xs = [bmi w h | (w, h) &lt;- xs]  \n    where bmi weight height = weight / height ^ 2\n</code></pre>\n\n<p>Every time I try and run the function with this input, <code>calcBmis [(1,2),(2.4)]</code>, I get this error:</p>\n\n<pre><code>&lt;interactive&gt;:77:1: error:\n    \u2022 Non type-variable argument in the constraint: Fractional (a, a)\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall a. (Fractional (a, a), RealFloat a) =&gt; [a]\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1506140648, "last_edit_date": 1506140648, "creation_date": 1506139477, "answer_id": 46375919, "question_id": 46375356, "link": "https://stackoverflow.com/questions/46375356/ghci-sourcing-bash-files/46375919#46375919", "title": "GHCi Sourcing Bash Files?", "body": "<p>You can't keep the state around, but you can do this:</p>\n\n<pre><code>:!source /path/to/script.sh &amp;&amp; bash_function\n</code></pre>\n\n<p>If there's a particular script you use a lot, you could add a command to your <code>~/.ghci</code> to make this more convenient; for example</p>\n\n<pre><code>:def fun Prelude.return Prelude.. (\":!source /path/to/script.sh &amp;&amp; \"Prelude.++)\n</code></pre>\n\n<p>would enable you to use this in ghci instead:</p>\n\n<pre><code>:fun bash_function\n</code></pre>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506140648, "creation_date": 1506132774, "question_id": 46375356, "link": "https://stackoverflow.com/questions/46375356/ghci-sourcing-bash-files", "title": "GHCi Sourcing Bash Files?", "body": "<p>Suppose you have <code>bash_function</code> defined in <code>/path/to/script.sh</code>, and you'd like to use this GHCi quickly. The following doesn't work:</p>\n\n<pre><code>Prelude&gt; :!source /path/to/script.sh\nPrelude&gt; :!bash_function\n</code></pre>\n\n<p>Is there a way to load a GHCi's bash state so that you can execute non-stock shell functions?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506131305, "post_id": 46374840, "comment_id": 79709747, "body": "Let me know (@) if the linked question doesn&#39;t satisfy you."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506134322, "post_id": 46374840, "comment_id": 79710191, "body": "@dfeuer Could a <code>Traversal</code> be used for this? It seems they just want to use <code>over</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1506134532, "post_id": 46374840, "comment_id": 79710220, "body": "@4castle, well, they could write a <code>Traversal</code>, sure, but they can&#39;t combine two lenses in an entirel generic way to get a valid <code>Traversal</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506178489, "post_id": 46374840, "comment_id": 79720030, "body": "The trouble will be the composition law, which generally objects to visiting the same element twice."}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1506131255, "answer_count": 0, "score": 0, "last_activity_date": 1506126426, "creation_date": 1506126426, "question_id": 46374840, "link": "https://stackoverflow.com/questions/46374840/haskell-setter-over-with-multiple-targets", "closed_reason": "Duplicate", "title": "Haskell Setter/over with multiple targets?", "body": "<p>Is there a way to combine lenses, such that I can apply a function over a and b in the below structure, but not c?</p>\n\n<pre><code>import Control.Lens hiding (element)\n\ndata SomeInts = SomeInts {_a :: Int , _b :: Int, _c :: Int  } deriving (Show)\nmakeLenses ''SomeInts\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 0, "creation_date": 1506114150, "post_id": 46373083, "comment_id": 79705952, "body": "So I figured part of it out.      <code>addList :: (Integral b) =&gt; [b] -&gt; [b]</code>     <code>addList (x:xs) = x + 1 : addList xs</code>  But now I get an exhaustive pattern error. How do I fix that?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1506114244, "post_id": 46373083, "comment_id": 79705984, "body": "Tell it what to do with an empty list."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506114247, "post_id": 46373083, "comment_id": 79705987, "body": "You want to increment <i>all</i> elements with one?"}, {"owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 0, "creation_date": 1506114293, "post_id": 46373083, "comment_id": 79706003, "body": "Yep! <code>addList [] = []</code> Thanks!"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1506114445, "post_id": 46373083, "comment_id": 79706043, "body": "<code>addList = map (+1)</code>"}, {"owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 0, "creation_date": 1506114597, "post_id": 46373083, "comment_id": 79706093, "body": "Haven&#39;t learn about mapping yet, but it&#39;s coming up. Thanks!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1506114768, "post_id": 46373083, "comment_id": 79706156, "body": "<code>map</code> is basically &quot;apply this operation to all elements of the list&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 0, "creation_date": 1506114808, "post_id": 46373143, "comment_id": 79706167, "body": "So I wrote it two different ways and was wondering which would be considered better:  <code>addList xs = [x + 1 | x &lt;- xs]</code> non-recursive   or  <code>addList [] = [] addList (x:xs) = x + 1 : addList xs</code>  The first one doesn&#39;t require that guard."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 1, "creation_date": 1506115026, "post_id": 46373143, "comment_id": 79706240, "body": "@humbleCoder Given a choice between those, I would prefer the first (list comprehension) version, because it abstracts some details away: You can immediately see that it iterates over the input list and you don&#39;t have to figure out what exactly the recursion does. But in practice I&#39;d write it as <code>addList xs = map (+ 1) xs</code>, because it&#39;s even more direct: We want to apply the same operation (<code>+ 1</code>) to each element of the list and return a list of results."}, {"owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "edited": false, "score": 0, "creation_date": 1506120160, "post_id": 46373143, "comment_id": 79707687, "body": "Understood. I&#39;m assuming the xs at the end of the function is the return statement essentially? Also, I don&#39;t understand why this post was down voted and now it&#39;s at -1."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1506114116, "creation_date": 1506114116, "answer_id": 46373143, "question_id": 46373083, "link": "https://stackoverflow.com/questions/46373083/how-to-create-a-function-that-expects-a-integral-list/46373143#46373143", "title": "How to create a function that expects a Integral List", "body": "<pre><code>addList :: (Integral b) =&gt; [b] -&gt; [b]\n</code></pre>\n\n<p>Here we're saying that the <code>b</code> type must be an instance of <code>Integral</code>, and that <code>addList</code> takes and returns a list of <code>b</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1506114213, "creation_date": 1506114213, "answer_id": 46373169, "question_id": 46373083, "link": "https://stackoverflow.com/questions/46373083/how-to-create-a-function-that-expects-a-integral-list/46373169#46373169", "title": "How to create a function that expects a Integral List", "body": "<p><code>Integral a</code>, means that <code>a</code> is an integral, and that you can perform functions on <code>a</code>s, like <code>div :: Integral a =&gt; a -&gt; a -&gt; a</code>.</p>\n\n<p>So if you want a list <code>[a]</code> of <code>Integral</code>s, that means that <code>a</code> should be <code>Integral</code>. So you should write:</p>\n\n<pre><code>addList :: <b>Integral b</b> =&gt; [b] -> b</code></pre>\n\n<p>Furthermore note that the output type is probably a <code>b</code>, since you \"fold the list together to one such number.</p>\n\n<p>In case you want to increment for instance all number (or perform another operation on the numbers), the type is:</p>\n\n<pre><code>addList :: Integral b =&gt; [b] -> <b>[b]</b></code></pre>\n\n<p>since now we specify that the output is a list of <code>b</code>s.</p>\n"}], "owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 46373143, "answer_count": 2, "score": -2, "last_activity_date": 1506114213, "creation_date": 1506113835, "question_id": 46373083, "link": "https://stackoverflow.com/questions/46373083/how-to-create-a-function-that-expects-a-integral-list", "title": "How to create a function that expects a Integral List", "body": "<p>So I'm learning Haskell for school and was learning about functions, syntax and typeclasses over at learnyouahaskell and was wondering I would create a function that takes in an Integral list as a parameter?</p>\n\n<p>If I'm understanding this correctly:</p>\n\n<pre><code>addVectors :: (Num a) =&gt; (a,a) -&gt; (a,a) -&gt; (a,a)\naddVectors (x1,y1) (x2,y2) = (x1 + x2, y1 + y2)\n</code></pre>\n\n<p>addVectors takes in two sets that basically all parameters have to be of the Number class? But what about if I want it to take in a list of Numbers or Integrals?</p>\n\n<pre><code>addList :: (Integral [b]) =&gt; [b] -&gt; [b]\n</code></pre>\n\n<p>But this clearly didn't work. </p>\n"}, {"tags": ["haskell", "transactions", "hspec", "postgresql-simple"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1506120326, "post_id": 46373033, "comment_id": 79707738, "body": "That&#39;s not how transactions work. Either a transaction takes place or it doesn&#39;t. If you don&#39;t commit a transaction from the DBs point of view, nothing ever happened. You never inserted a line into the DB. All you did was inform that you might want it inserted in the future, if nothing else goes wrong."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1506120462, "post_id": 46373033, "comment_id": 79707773, "body": "@Cubic does that mean there is no way to test-call a database while using transaction rollback to prevent alteration?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1506120560, "post_id": 46373033, "comment_id": 79707801, "body": "Well, you can use rollback to prevent changes. But if you prevent a change, then of course no change takes place. In any case, this makes it sound like you&#39;re trying to run your tests against production. Don&#39;t. Run against a dedicated testdb and just nuke that once the test run completed."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1506120865, "post_id": 46373033, "comment_id": 79707876, "body": "@Cubic I will definitely take that advice and use a test db. While running there, is there a way to use rollback instead of nuking/truncating the db after each test? Maybe it&#39;s not, but I was under the impression that using rollback would be a more elegant solution."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1506121243, "post_id": 46373033, "comment_id": 79707967, "body": "Like I said. Rollback isn&#39;t &quot;undo&quot;. It&#39;s &quot;never do in the first place&quot;. The entire point of transactions is grouping a bunch of individual actions into one atomic action. Setting up your test database should be automated anyway, so it shouldn&#39;t really cost you anything. For integration tests you might reasonably reuse the same database for multiple runs, and you don&#39;t need to rebuild the db if you never change it, but things may break during tests, so you need to set up your system to account for that anyway."}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1506113557, "creation_date": 1506113557, "question_id": 46373033, "link": "https://stackoverflow.com/questions/46373033/how-to-begin-and-rollback-a-transaction-with-hspec", "title": "How to begin and rollback a transaction with hspec?", "body": "<p>I am trying to write a test using <a href=\"https://hspec.github.io/writing-specs.html#using-pending-and-pendingwith\" rel=\"nofollow noreferrer\"><code>hspec</code></a> involving postgres transaction rollback as with <a href=\"https://hspec.github.io/writing-specs.html#using-pending-and-pendingwith\" rel=\"nofollow noreferrer\"><code>postgresql-simple</code></a>'s <code>begin</code> and <code>rollback</code> commands.</p>\n\n<p>However, applying <code>postgresql-simple</code>'s <code>begin</code> and <code>rollback</code> commands appears to cause my 'insert' command not to run and not affect my database at all.</p>\n\n<p>Here is the relevant code.</p>\n\n<pre><code>import qualified Database.PostgreSQL.Simple as PGS\nimport Test.Hspec (describe, it, SpecWith, hspec, before, after)\n\ntestConnInfo :: PGS.ConnectInfo\ntestConnInfo = PGS.ConnectInfo\n  { PGS.connectHost = \"localhost\"\n  , PGS.connectPort = 5432\n  , PGS.connectUser = \"user\"\n  , PGS.connectPassword = \"\"\n  , PGS.connectDatabase = \"database\"\n  }\n\ntestConnection :: IO PGS.Connection\ntestConnection = do\n  PGS.connect testConnInfo\n\nrunSpec :: IO ()\nrunSpec = do\n  conn &lt;- testConnection\n  hspec $ test_addTask conn\n\ntest_addTask :: PGS.Connection -&gt; SpecWith ()\ntest_addTask conn = describe \"test_addTask\" $ do\n  it \"adding_task_succeeds\" $ do\n    PGS.begin conn\n    addTask conn \"taskName\"\n    print \"set breakpoint here\"\n    PGS.rollback conn\n    return ()\n</code></pre>\n\n<p>I run this in <code>ghci</code>, setting a breakpoint at the \"set breakpoint here\" line; after the entry should be inserted and before the rollback. While paused at this breakpoint I query the database to see whether the entry has been inserted, and see that <em>no entry appears to be inserted into the database by this code</em>.</p>\n\n<p>When I remove the <code>PGS.begin conn</code> and <code>PGS.rollback conn</code> lines, however, the code <em>does</em> insert the entry into the database.</p>\n\n<p><strong>Why does this code not insert an entry into the database with the 'begin' and 'rollback' lines in place?</strong></p>\n\n<p>How can I write hspec tests which begin and rollback so that my tests do not influence values in the database, and that actually run the commands?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506093486, "post_id": 46366850, "comment_id": 79695622, "body": "Please include the exact command you ran, any relevant source files, and the <i>exact</i> error you got. It was good to include the output of ghc-pkg check. You can safely ignore the warnings about haddock; I didn&#39;t see any other lines when I scrolled through quickly, but could you use grep or similar to verify that all of ghc-pkg check&#39;s output is about missing haddocks? Also, site rules say you should include all information relevant to the question here on StackOverflow itself (rather than using pastebins)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1506093567, "post_id": 46366850, "comment_id": 79695660, "body": "That said, given the current information, I assign high probability to the simplest solution being &quot;reinstall GHC&quot;."}, {"owner": {"reputation": 391, "user_id": 7637341, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9cbda903cee9e038d3f46be09863f4ec?s=128&d=identicon&r=PG&f=1", "display_name": "user7637341", "link": "https://stackoverflow.com/users/7637341/user7637341"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506093891, "post_id": 46366850, "comment_id": 79695893, "body": "@DanielWagner Tried reinstalling GHC, didn&#39;t fix. I get this error for any module used. Sorry for using pastebin, i thought it would be easier for formatting than pasting it all in here because its quite big."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1506097278, "post_id": 46366850, "comment_id": 79697826, "body": "What system you are using, which ghc version, do you use stack  or cabal?"}, {"owner": {"reputation": 391, "user_id": 7637341, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9cbda903cee9e038d3f46be09863f4ec?s=128&d=identicon&r=PG&f=1", "display_name": "user7637341", "link": "https://stackoverflow.com/users/7637341/user7637341"}, "edited": false, "score": 2, "creation_date": 1506255403, "post_id": 46366850, "comment_id": 79737140, "body": "Arch Linux - ghc version 8.2.1, dont use stack or cabal."}, {"owner": {"reputation": 2309, "user_id": 569825, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/703c791d3eaf7b4f107e847c5ee08b70?s=128&d=identicon&r=PG", "display_name": "user569825", "link": "https://stackoverflow.com/users/569825/user569825"}, "edited": false, "score": 2, "creation_date": 1506432223, "post_id": 46366850, "comment_id": 79812494, "body": "Exact same issue here - also on Arch with 8.2.1"}], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 5092038, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2GrKkHuXTkQ/AAAAAAAAAAI/AAAAAAAAAHo/JSQ4pwnqyfM/photo.jpg?sz=128", "display_name": "meyer1994", "link": "https://stackoverflow.com/users/5092038/meyer1994"}, "edited": false, "score": 1, "creation_date": 1510612700, "post_id": 46508604, "comment_id": 81500752, "body": "But 1Gb installed pkg to fix this --&#39;"}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "reply_to_user": {"reputation": 365, "user_id": 5092038, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2GrKkHuXTkQ/AAAAAAAAAAI/AAAAAAAAAHo/JSQ4pwnqyfM/photo.jpg?sz=128", "display_name": "meyer1994", "link": "https://stackoverflow.com/users/5092038/meyer1994"}, "edited": false, "score": 0, "creation_date": 1510614939, "post_id": 46508604, "comment_id": 81501475, "body": "@meyer1994 Yeah, Haskell seems to be pretty bad about that. Related: <a href=\"https://stackoverflow.com/questions/4858585/why-is-ghc-so-large-big\" title=\"why is ghc so large big\">stackoverflow.com/questions/4858585/why-is-ghc-so-large-big</a>"}], "tags": [], "owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "is_accepted": false, "score": 9, "last_activity_date": 1506823590, "creation_date": 1506823590, "answer_id": 46508604, "question_id": 46366850, "link": "https://stackoverflow.com/questions/46366850/haskell-missing-files-in-base-package/46508604#46508604", "title": "Haskell missing files in base package", "body": "<p>I had the exact same issue. Installing <code>ghc-static</code> fixed it.</p>\n"}, {"comments": [{"owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "reply_to_user": {"reputation": 365, "user_id": 5092038, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2GrKkHuXTkQ/AAAAAAAAAAI/AAAAAAAAAHo/JSQ4pwnqyfM/photo.jpg?sz=128", "display_name": "meyer1994", "link": "https://stackoverflow.com/users/5092038/meyer1994"}, "edited": false, "score": 2, "creation_date": 1510639218, "post_id": 46898938, "comment_id": 81507953, "body": "@meyer1994 If you&#39;re on Arch, you can do <code>pacman -Ql ghc</code> and you&#39;ll see that all of the compiled files are .dyn_hi as opposed to .hi, which are loaded via -dynamic"}, {"owner": {"reputation": 365, "user_id": 5092038, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2GrKkHuXTkQ/AAAAAAAAAAI/AAAAAAAAAHo/JSQ4pwnqyfM/photo.jpg?sz=128", "display_name": "meyer1994", "link": "https://stackoverflow.com/users/5092038/meyer1994"}, "edited": false, "score": 0, "creation_date": 1510698602, "post_id": 46898938, "comment_id": 81543942, "body": "Is there a particular reason for Arch to save them all as .dyn_hi? Why not just save as .hi? I imagine it is memory related(?)."}, {"owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "reply_to_user": {"reputation": 365, "user_id": 5092038, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2GrKkHuXTkQ/AAAAAAAAAAI/AAAAAAAAAHo/JSQ4pwnqyfM/photo.jpg?sz=128", "display_name": "meyer1994", "link": "https://stackoverflow.com/users/5092038/meyer1994"}, "edited": false, "score": 0, "creation_date": 1510723067, "post_id": 46898938, "comment_id": 81550858, "body": "I&#39;m nit entirely sure, but here&#39;s a somewhat related discussion on the topic - <a href=\"https://github.com/commercialhaskell/stack/issues/3409\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/3409</a>"}], "tags": [], "owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "is_accepted": false, "score": 9, "last_activity_date": 1616849216, "last_edit_date": 1616849216, "creation_date": 1508794695, "answer_id": 46898938, "question_id": 46366850, "link": "https://stackoverflow.com/questions/46366850/haskell-missing-files-in-base-package/46898938#46898938", "title": "Haskell missing files in base package", "body": "<p>You probably need to tell <code>ghc</code> to use shared libraries via the <code>-dynamic</code> flag, e.g.</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ ghc --make -dynamic path/to/file.hs\n</code></pre>\n<p>Doing this means you do not need to install the <code>ghc-static</code> package.</p>\n"}, {"comments": [{"owner": {"reputation": 16690, "user_id": 234248, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2e3e7f03ab2e85c1be14975ebc9945bf?s=128&d=identicon&r=PG", "display_name": "mykhal", "link": "https://stackoverflow.com/users/234248/mykhal"}, "edited": false, "score": 0, "creation_date": 1618220759, "post_id": 49988083, "comment_id": 118527384, "body": "fails, saying <code>cabal: Invalid package ID: .</code>"}], "tags": [], "owner": {"reputation": 677, "user_id": 3536806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5321e2babfa1c70186599163a3c188?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik Schrempf", "link": "https://stackoverflow.com/users/3536806/dominik-schrempf"}, "is_accepted": false, "score": 4, "last_activity_date": 1524509727, "creation_date": 1524509727, "answer_id": 49988083, "question_id": 46366850, "link": "https://stackoverflow.com/questions/46366850/haskell-missing-files-in-base-package/49988083#49988083", "title": "Haskell missing files in base package", "body": "<p>Try to tell <code>ghc</code> to build dynamically linked object files and executables, e.g., by</p>\n\n<pre><code>cabal install --dependencies-only --ghc-option=-dynamic\n</code></pre>\n"}], "owner": {"reputation": 391, "user_id": 7637341, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9cbda903cee9e038d3f46be09863f4ec?s=128&d=identicon&r=PG&f=1", "display_name": "user7637341", "link": "https://stackoverflow.com/users/7637341/user7637341"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3950, "favorite_count": 6, "answer_count": 3, "score": 13, "last_activity_date": 1616849216, "creation_date": 1506089655, "question_id": 46366850, "link": "https://stackoverflow.com/questions/46366850/haskell-missing-files-in-base-package", "title": "Haskell missing files in base package", "body": "<p>I have never had this before but today I tried to use ghc and get: </p>\n\n<pre><code>could not find module\nthere are files missing in the base-4.10.0.0 package\n</code></pre>\n\n<p>ghc-pkg check returns:</p>\n\n<p><a href=\"https://pastebin.com/aCmr9igi\" rel=\"noreferrer\">https://pastebin.com/aCmr9igi</a></p>\n"}, {"tags": ["string", "list", "haskell", "indexing", "int"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1506088808, "post_id": 46366563, "comment_id": 79692652, "body": "Please show your own attempt. Explain what does not work, etc."}, {"owner": {"reputation": 71, "user_id": 8622570, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/582f23659e7dcea18acadd21019d271a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Maassen", "link": "https://stackoverflow.com/users/8622570/jeroen-maassen"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506090946, "post_id": 46366563, "comment_id": 79694065, "body": "I have added it"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1506091059, "creation_date": 1506091059, "answer_id": 46367296, "question_id": 46366563, "link": "https://stackoverflow.com/questions/46366563/indexing-with-int-and-string-haskell/46367296#46367296", "title": "Indexing with [Int] and [[String]] Haskell", "body": "<p>Perhaps you are looking for something like this:</p>\n\n<pre><code>foo :: [Int] -&gt; [[String]] -&gt; [[String]]\nfoo indices strings = map (strings !!) indices\n</code></pre>\n\n<p>The type can also be generalized to</p>\n\n<pre><code>foo :: [Int] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>since we don't need a list-of-lists.</p>\n\n<p>This is not terribly efficient. It can be greatly improved if we can assume that the indices are increasing, for instance.</p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1506093040, "post_id": 46367558, "comment_id": 79695345, "body": "I&#39;d argue against using list comprehensions - it is not very idiomatic Haskell since it is not compositional. Use <code>map, filter, fold, &gt;&gt;=</code> combinators instead."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1506094952, "post_id": 46367558, "comment_id": 79696527, "body": "@Centril I&#39;d argue it&#39;s not always prudent to maximise compositionality. List comprehensions tend to be very intuitive to understand. Sometimes Python&#39;s ideals are better than Haskell&#39;s, even when writing Haskell..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1506095276, "post_id": 46367558, "comment_id": 79696682, "body": "In particular, I don&#39;t find that monadic solution at all sensible here \u2013 it&#39;s longer, more convoluted, and not really more compositional at all. A better way of writing this without list comprehensions would be <code>getStrings is = map snd . filter ((`elem`is).fst) . zip [0..]</code>."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1506111698, "last_edit_date": 1506111698, "creation_date": 1506091824, "answer_id": 46367558, "question_id": 46366563, "link": "https://stackoverflow.com/questions/46366563/indexing-with-int-and-string-haskell/46367558#46367558", "title": "Indexing with [Int] and [[String]] Haskell", "body": "<p>I guess using list comprehensions is an expressive way for this job.</p>\n\n<pre><code>getStrings :: [Int] -&gt; [[String]] -&gt;  [[String]]\ngetStrings is css = [cs | (ix,cs) &lt;- zip [0..] css, ix `elem` is]\n\n*Main&gt; gs [0,1,4] [[\"a\",\"a\",\"a\"],[\"b\",\"b\",\"b\"],[\"c\",\"c\",\"c\"],[\"d\",\"d\",\"d\"],[\"e\",\"e\",\"e\"],[\"f\",\"f\",\"f\"]]\n[[\"a\",\"a\",\"a\"],[\"b\",\"b\",\"b\"],[\"e\",\"e\",\"e\"]]\n</code></pre>\n\n<p>So as per @Centril's comment, that i have to agree here is a monadic version of the same thing;</p>\n\n<pre><code>gs :: [Int] -&gt; [[String]] -&gt;  [[String]]\ngs is css = zip [0..] css &gt;&gt;= \\(ix,cs) -&gt; guard (ix `elem` is) &gt;&gt; return cs\n\n*Main&gt; gs [0,1,4] [[\"a\",\"a\",\"a\"],[\"b\",\"b\",\"b\"],[\"c\",\"c\",\"c\"],[\"d\",\"d\",\"d\"],[\"e\",\"e\",\"e\"],[\"f\",\"f\",\"f\"]]\n[[\"a\",\"a\",\"a\"],[\"b\",\"b\",\"b\"],[\"e\",\"e\",\"e\"]]\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 8622570, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/582f23659e7dcea18acadd21019d271a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Maassen", "link": "https://stackoverflow.com/users/8622570/jeroen-maassen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1506111698, "creation_date": 1506088748, "last_edit_date": 1506090935, "question_id": 46366563, "link": "https://stackoverflow.com/questions/46366563/indexing-with-int-and-string-haskell", "title": "Indexing with [Int] and [[String]] Haskell", "body": "<p>I have in index <code>[Int]</code> and <code>[[String]]</code>, now I only want to keep the <code>[String]</code> which correspond to the index:</p>\n\n<p><code>[0,1,4]</code> and <code>[[a,a,a],[b,b,b],[c,c,c],[d,d,d],[e,e,e],[f,f,f]]</code></p>\n\n<p>would give <code>[[a,a,a],[b,b,b],[e,e,e]]</code></p>\n\n<p>So <code>[Int] -&gt; [[String]] -&gt; [[String]]</code></p>\n\n<p>How could I do this?</p>\n\n<p>I have tried <code>map (!!) (x y)</code></p>\n\n<p>where x is the [[String]] and y is the [Int]</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 4, "creation_date": 1506086636, "post_id": 46365871, "comment_id": 79691186, "body": "Can you show the solution you\u2019ve come up with, please? It might be easiest to describe how to modify parts of it."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1506086857, "post_id": 46365871, "comment_id": 79691332, "body": "Please provide your curent attempt."}, {"owner": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "edited": false, "score": 0, "creation_date": 1506086965, "post_id": 46365871, "comment_id": 79691398, "body": "Basically i used the isNumber function, importing it from Data.Char and writing it as list comprehention, something like this:  f xs = [if isNumber x then 1 else 2| x &lt;- xs ]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506087020, "post_id": 46365871, "comment_id": 79691445, "body": "Shouldn&#39;t you <code>sum</code> up that list?"}, {"owner": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "edited": false, "score": 0, "creation_date": 1506087286, "post_id": 46365871, "comment_id": 79691599, "body": "Ups, yeah, here is the full function  f xs = sum([if isNumber x then 1 else 2| x &lt;- xs ])  , but i have to be able to do it without list comprehensions, thats why i asked, if anyone has a possible solution."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "edited": false, "score": 0, "creation_date": 1506088303, "post_id": 46366312, "comment_id": 79692315, "body": "Thank you for the fast response! One last question - what is the dot used for?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "edited": false, "score": 0, "creation_date": 1506088395, "post_id": 46366312, "comment_id": 79692374, "body": "@zauahiri it&#39;s function composition: <code>f . g</code> is a function that, applied to <code>x</code>, gives <code>f (g x)</code>. I.e. in this case, the string is first pulled through the <code>map</code>ping, the result of which is then <code>sum</code>med."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "edited": false, "score": 0, "creation_date": 1506088462, "post_id": 46366312, "comment_id": 79692427, "body": "@zauahiri <code>(.)</code> is the composition operator with type signature <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> which means it takes two function like <code>f</code> and <code>g</code> and <code>f . g</code> works like <code>f (g (x))</code>."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 6, "last_activity_date": 1506087902, "creation_date": 1506087902, "answer_id": 46366312, "question_id": 46365871, "link": "https://stackoverflow.com/questions/46365871/haskell-manipulating-elements-of-a-list/46366312#46366312", "title": "Haskell manipulating elements of a list", "body": "<p>You may do as follows;</p>\n\n<pre><code>import Data.Char (isDigit)\nimport Data.Bool (bool)\n\ngetsum :: String -&gt; Int\ngetsum = sum . map (bool 2 1 . isDigit)\n\n*Main&gt; getsum \"1234abc\"\n10\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 8649342, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/89ea1baa908d2afd4a59302fdd89f325?s=128&d=identicon&r=PG&f=1", "display_name": "zauahiri", "link": "https://stackoverflow.com/users/8649342/zauahiri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506087902, "creation_date": 1506086591, "last_edit_date": 1506086638, "question_id": 46365871, "link": "https://stackoverflow.com/questions/46365871/haskell-manipulating-elements-of-a-list", "title": "Haskell manipulating elements of a list", "body": "<p>So lets say i have a certain string and i want to check the elements of the string, whether they are numbers or characters. Each number has to be replaced with the number 1 and each character with the number 2 and at the end it has to be shown the final result when you sum all numbers.\nExample: function \"123abc\" has to give a result 9</p>\n\n<p>I've already come up with a solution using lists comprehensions and pattern matching, but i need to be able to give a solution without using them, meaning only elem,head,tail,reverse,map,sum etc. All has to be 1 function, now a few combined as one.</p>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506084101, "post_id": 46364784, "comment_id": 79689512, "body": "This approach is much more complex than needed, and the syntax is quite wrong. Start by coding a <code>isVowel :: Char -&gt; Bool</code> function. Forget about the <code>n</code> index and <code>!!</code>: they lead to bad code. Instead, proceed by structural recursion on the string, exploiting pattern matching on <code>[]</code> and <code>(x:xs)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1506085208, "post_id": 46364784, "comment_id": 79690299, "body": "One-line solution: <code>vowel = any (`elem` &quot;aeiouy&quot;)</code>. (Yes, that&#39;s all!)"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 13, "last_activity_date": 1506084618, "last_edit_date": 1506084618, "creation_date": 1506084054, "answer_id": 46365069, "question_id": 46364784, "link": "https://stackoverflow.com/questions/46364784/haskell-checking-the-vowels-in-a-string/46365069#46365069", "title": "Haskell: checking the vowels in a String", "body": "<h1>Problems with the current approach</h1>\n\n<p>This piece of code has a lot of problems:</p>\n\n<ul>\n<li>you define a constant <code>n = 0</code>, and somehow expect this to be a default value in <code>check</code>; that is not the case;</li>\n<li>you first write <code>check n = a !! n</code>, and then use <code>check == ...</code>, a variable has only one type;</li>\n<li>In Haskell <code>=</code> is <em>not</em> an <em>assignment</em>, it is a <em>declaration</em>. Once declared you can not change the value anymore;</li>\n<li>You write <code>check == 'a' || 'e' || 'i' || 'o' || 'u' || 'y'</code>, but <code>||</code> binds less thight than <code>==</code>, so you wrote <code>(check == 'a') || 'e' || 'i' || 'o' || 'u' || 'y'</code>, since a character <code>'e'</code> is not a boolean (and in Haskell there is no <em>truthiness</em>), you can not use <code>'e'</code> as an operand of <code>||</code>;</li>\n<li>there is no index checking so even if the above problems would be resolved; <code>n</code> would eventually grow that large, that you will get an <em>index out of range</em> exception;</li>\n<li>you use <code>!!</code> which is not per se wrong, but it is considered inefficient (<em>O(n)</em>) and it is not a total function so <em>unsafe</em>.</li>\n</ul>\n\n<h1>Using <code>any</code></h1>\n\n<p>Let us construct a function that satisfies the needs. If I understand the requirements correctly, you need to check if there is at least one element a vowel.</p>\n\n<p>A character <code>c</code> is a vowel if it is <code>'a'</code>, <code>'e'</code>, <code>'i'</code>, <code>'o'</code>, <code>'u'</code>, or <code>'y'</code>. So we can write a check:</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel c = c == 'a' || c == 'e' || c == 'i' || c == 'o' || c == 'u' || c == 'y'\n</code></pre>\n\n<p>But this is rather inelegant. Since a <code>String</code> is however a list of <code>Char</code>s, we can use the <code>elem :: Eq a =&gt; a -&gt; [a]</code> function, so we can write:</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel c = elem c \"aeiouy\"\n</code></pre>\n\n<p>Now we only have to check if there is any character <code>c</code> of the string <code>s</code> that is a vowel, so we can write:</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel s = any (\\c -&gt; isVowel c) s\n</code></pre>\n\n<p>We can further improve the question. It is useless to write a lambda expression of the form <code>\\x -&gt; f x</code>. Instead we can simply write <code>f</code>. So we can write:</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel s = any isVowel s\n</code></pre>\n\n<p>we can apply the same trick on <code>s</code>: we can remove it both in the head and the body of the <code>vowel</code> function:</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel = any isVowel\n</code></pre>\n\n<p>finally we can make the <code>isVowel</code> function pointfree, by using <code>flip</code>:</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel = flip elem \"aeiouy\"\n</code></pre>\n\n<p>this results into:</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel = flip elem \"aeiouy\"\n\nvowel :: String -&gt; Bool\nvowel = any isVowel\n</code></pre>\n\n<p>We can then test it. For instance:</p>\n\n<pre><code>Prelude&gt; vowel \"foobar\"\nTrue\nPrelude&gt; vowel \"qx\"\nFalse\nPrelude&gt; vowel \"bl\"\nFalse\nPrelude&gt; vowel \"bla\"\nTrue\n</code></pre>\n\n<h1>Using recursion</h1>\n\n<p>The <code>any :: (a -&gt; Bool) -&gt; [a] -&gt; Bool</code> function is a higher order function: it takes a function as input which can make it hard to understand. We can write our own specialed <code>any</code> function for the <code>vowel</code> function. We are here working with a list, and usually when doing list processing there are at least two patterns we have to consider: the empty list <code>[]</code> and the non-empty list <code>(x:xs)</code>. Since <code>any</code> is rather simple this will be sufficient.</p>\n\n<p>If we process the empty list, we know that there is no vowel in the string, so we can write:</p>\n\n<pre><code>vowel [] = False\n</code></pre>\n\n<p>in case the list is non-empty <code>(x:xs)</code>, it has a <em>head</em> (first element) <code>x</code> and a <em>tail</em> (remaining elements) <code>xs</code>. A string contains a vowel if either the first element is a vowel, or any of the remaining elements is a vowel. So we can write:</p>\n\n<pre><code>vowel (x:xs) = isVowel x || vowel xs\n</code></pre>\n\n<p>if we put these together (together with the <code>isVowel</code> function), we obtain:</p>\n\n<pre><code>isVowel :: Char -&gt; Bool\nisVowel c = elem c \"aeiouy\"\n\nvowel [] = False\nvowel (x:xs) = isVowel x || vowel xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23517, "user_id": 287976, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8cf3090cda1c829f3f8df0a3796fc60c?s=128&d=identicon&r=PG", "display_name": "brandizzi", "link": "https://stackoverflow.com/users/287976/brandizzi"}, "is_accepted": false, "score": 4, "last_activity_date": 1506084849, "last_edit_date": 1506084849, "creation_date": 1506084187, "answer_id": 46365110, "question_id": 46364784, "link": "https://stackoverflow.com/questions/46364784/haskell-checking-the-vowels-in-a-string/46365110#46365110", "title": "Haskell: checking the vowels in a String", "body": "<p>Your code will need a bit more of attention. Yet, this specific error is quite straightforward. The operator <code>||</code>  expects two <code>Bool</code> values. Values such as <code>'a'</code>, <code>'b'</code> etc. are of type <code>Char</code>, however, so you cannot use <code>||</code> here. </p>\n\n<p>What you need is a series of booleans to use <code>||</code>. The first value, <code>check == 'a'</code>, is a <code>Bool</code> in theory, because the operator <code>==</code> can take two values (of some types, including <code>Char</code>) and return <code>Bool</code>. What you want, then, is to create a series of comparisons to get many booleans. So, you have to use the <code>==</code> operator to compare <code>check</code> to each vowel:</p>\n\n<pre><code>| check == 'a' || check ==  'e' || check ==  'i' || check ==  'o' || check ==  'u' || check ==  'y'   = True\n</code></pre>\n\n<p>This is a common misconception when starting to code. In English, one can say</p>\n\n<blockquote>\n  <p>if <code>check</code> is equal to <code>'a'</code>, or <code>'e'</code>, or <code>'i'</code> ...</p>\n</blockquote>\n\n<p>and we try to translate it directly into code. In Haskell, however, the \"or\" operator (<code>||</code>) cannot figure out what what this would mean. You have make every condition explicit:</p>\n\n<blockquote>\n  <p>if <code>check</code> is equal to <code>'a'</code>, or <code>check</code> is equal to <code>'e'</code>, or <code>check</code> is equal to <code>'i'</code> ...</p>\n</blockquote>\n\n<p>Will your code work once you solve this problem? No. There are other problems. For example, <code>check</code> is not defined anywhere. Nonetheless, solve one problem per time and move to the next, eventually you'll get what you look for :)</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1506086124, "last_edit_date": 1506086124, "creation_date": 1506085043, "answer_id": 46365395, "question_id": 46364784, "link": "https://stackoverflow.com/questions/46364784/haskell-checking-the-vowels-in-a-string/46365395#46365395", "title": "Haskell: checking the vowels in a String", "body": "<h3>Problem 0</h3>\n\n<p>You've defined <code>n = 0</code>. I suspect you meant to use that as a kind of running variable that's increased in every recursion step. That's not possible in Haskell \u2013 if you define <code>n = 0</code> at the top-level, then <code>n</code> will <em>always</em> be <code>0</code>.</p>\n\n<p>To have such a \u201crunning variable\u201d, you need to make it the argument of a recursive-loop function. You seem to have attempted something like that with <code>check</code> and its <code>n</code> argument (this is then a completely different variable, which <em>shadows</em> the global <code>n</code> \u2013 shadowing can easily lead to confusion, avoid it). The standard name for such a local function is <code>go</code>, and it would be used like</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel a = go 0\n where go n = case a !! n of\n          ...  -&gt;  False\n          ...  -&gt;  True\n          ...  -&gt; ... go (n+1) ...\n</code></pre>\n\n<h3>Problem 1</h3>\n\n<p>You use list-indexing to loop over all the elements of a list. That's clumsy and unsafe (giving an obscure error when you index outside the list)<sup>\u2020</sup>; the preferred way to do something like this is either to use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\">the standard folding operations</a> (see below), or to write your recursion <em>on the list directly</em> via pattern-matching, rather than an integer indexing variable. So we can trash that <code>n</code> argument again and recurse on the list instead:</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel a = go a\n where go (x:xs) = case x of\n          ...  -&gt;  False\n          ...  -&gt;  True\n          ...  -&gt; ... go xs ...\n</code></pre>\n\n<p>Note that this will automatically fail at the end of the list, because then the pattern <code>x:xs</code> can't be matched anymore. Easy and clear, just add a special clause:</p>\n\n<pre><code> where go (x:xs) = case x of\n          ...  -&gt;  False\n          ...  -&gt;  True\n          ...  -&gt; ... go xs ...\n       go [] = ...\n</code></pre>\n\n<p><em>Actually</em>, at this point, <code>go</code> is just a local pre-definition of <code>vocal</code>, so you might as well pull the recursion to the top-level:</p>\n\n<pre><code>vowel :: String -&gt; Bool\nvowel [] = ...\nvowel (x:xs) = ... vowel xs ...\n</code></pre>\n\n<h3>Problem 2</h3>\n\n<p>You've tried to declare <code>check</code> in a guard-list. That's not supported \u2013 see above, <code>where</code> should be used for local definitions, alternatively <code>let</code><sup>\u2021</sup>.</p>\n\n<h3>Problem 3</h3>\n\n<p>You've tried to write multiple equality-options in a single chain of <code>||</code>. This isn't possible because each comparison takes a (in this case) number and gives a <code>Bool</code> result, so you can't just chain them. What you can do is write out <code>x == 'a' || x == 'e' || ...</code>, but that's obviously awkward. A much neater option, as <a href=\"https://stackoverflow.com/a/46365069/745903\">suggested by Willem</a>, is to write <code>x `elem` \"aeiouy\"</code> instead: that will just the right thing.</p>\n\n<p>If you haven't come across those backticks <code>``</code> yet: they take a two-argument function like <code>elem</code> and put it into <em>infix mode</em>. This is similar to the infix <code>+</code> in <code>n + 1</code>.</p>\n\n<p>The nice thing about infixes is that you can make a <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">section</a> of them: to define the function that takes a character and compares it with every vowel, you could write</p>\n\n<pre><code>isVowel c = elem c \"aeiouy\"\n</code></pre>\n\n<p>but you could also just write</p>\n\n<pre><code>isVowel = (`elem` \"aeiouy\")\n</code></pre>\n\n<p>Note that I've completely eliminated the variable, through <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#.CE.B7-conversion\" rel=\"nofollow noreferrer\">eta reduction</a>. This is called <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">point-free style</a>.</p>\n\n<p>Where this comes in handy: it's not really necessary to define <code>isVowel</code> as a named function for your application \u2013 you only use it for one purpose anyway, namely compare against all chars in the string. The most common way to apply an operation to all elements of a container and combine the results<sup>\u00b6</sup> is <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr</code></a>. You can use it like</p>\n\n<pre><code>vowel = foldr ((||) . (`elem` \"aeiouy\")) False\n</code></pre>\n\n<p>That's a bit cryptic; fortunately this combination of logical-or and fold has a standard name: <code>any</code>. With it, you can everything as concise as</p>\n\n<pre><code>vowel = any (`elem` \"aeiouy\")\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Indexing into a list is also very inefficient: <code>!!</code> needs to traverse all the elements up to the requested one. This gives your attempt a complexity of <em>O</em> (<em>n</em><sup>2</sup>), when <em>O</em> (<em>n</em>) would be completely sufficient.</sub></p>\n\n<p><sup>\u2021</sup><sub>Incidentally, it <em>is</em> possible to define something in a single guard, but only by abusing the <a href=\"https://wiki.haskell.org/Pattern_guard\" rel=\"nofollow noreferrer\">pattern guard feature</a>.</sub></p>\n\n<p><sup>\u00b6</sup><sub>To just gather the results again in a container, you can use the simpler <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor.html#v:fmap\" rel=\"nofollow noreferrer\"><code>fmap</code></a> instead.</sub></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1506134595, "creation_date": 1506134595, "answer_id": 46375507, "question_id": 46364784, "link": "https://stackoverflow.com/questions/46364784/haskell-checking-the-vowels-in-a-string/46375507#46375507", "title": "Haskell: checking the vowels in a String", "body": "<p>A simple solution using higher-order functions, for intermediate Haskellers who might find this question:</p>\n\n<pre><code>checkVowels :: String -&gt; String\ncheckVowels = any (`elem` \"aeiouyw\")\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5545878, "user_type": "registered", "profile_image": "https://graph.facebook.com/902874469767587/picture?type=large", "display_name": "Karolina ", "link": "https://stackoverflow.com/users/5545878/karolina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2662, "favorite_count": 1, "accepted_answer_id": 46365069, "answer_count": 4, "score": 3, "last_activity_date": 1506134595, "creation_date": 1506083108, "last_edit_date": 1506083204, "question_id": 46364784, "link": "https://stackoverflow.com/questions/46364784/haskell-checking-the-vowels-in-a-string", "title": "Haskell: checking the vowels in a String", "body": "<p>I'm new to Haskell. I wanted to write a code, which checks if there is any vowel in a String.\nI came up with this solution:</p>\n\n<pre><code>n :: Int\nn = 0\n\nvowel :: String -&gt; Bool\nvowel a\n    | check n = a !! n   \n    | check == 'a' || 'e' || 'i' || 'o' || 'u' || 'y'   = True  \n    | check /= 'a' || 'e' || 'i' || 'o' || 'u' || 'y'   = check(n+1) \n    | otherwise = False \n</code></pre>\n\n<p>So basically, I want to use recursion to check letter by letter if there is any vowel. \nI just got the error messages like:</p>\n\n<pre><code> Couldn't match expected type `Bool' with actual type `Char'\n    * In the second argument of `(||)', namely 'y'\n      In the second argument of `(||)', namely 'u' || 'y'\n      In the second argument of `(||)', namely 'o' || 'u' || 'y'\n   |\n14 |                 | check /= 'a' || 'e' || 'i' || 'o' || 'u' || 'y'   = check(n+1)\n   |\n</code></pre>\n\n<p>Where is the problem?</p>\n"}, {"tags": ["haskell", "int", "type-conversion", "maybe"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1506079999, "post_id": 46363709, "comment_id": 79686618, "body": "Depends on how you would like to represent <code>Nothing</code> value in <code>Integer</code> type. This seems to be an index operation so you may try like <code>Nothing -&gt; -1</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1506081971, "post_id": 46363709, "comment_id": 79687965, "body": "This strictly depends on what you actually are trying to achieve. What do you need to happen when the column is not present in the header? If that should never happen, you can raise a runtime error using <code>... Nothing -&gt; error &quot;column not found!?&quot;</code>. If I had to guess, I&#39;d say that there is a problem above the <code>where</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1506080716, "post_id": 46363792, "comment_id": 79687097, "body": "Yes, but I suspect a better solution would be to not compute any <code>n</code> at all in the <code>Nothing</code> case \u2013 this should probably be handled with an entirely different clause in the enclosing function."}], "tags": [], "owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "is_accepted": false, "score": 1, "last_activity_date": 1506079987, "creation_date": 1506079987, "answer_id": 46363792, "question_id": 46363709, "link": "https://stackoverflow.com/questions/46363709/haskell-maybe-int-to-int/46363792#46363792", "title": "Haskell Maybe Int to Int", "body": "<p>This can't work: On the right side of the <code>-&gt;</code> you have one time a <code>Nothing</code> and the next time an <code>Int</code>. For this to work, you need to provide a default value in case of <code>Nothing</code> (e.g. -1)</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 6, "last_activity_date": 1506081628, "creation_date": 1506081628, "answer_id": 46364308, "question_id": 46363709, "link": "https://stackoverflow.com/questions/46363709/haskell-maybe-int-to-int/46364308#46364308", "title": "Haskell Maybe Int to Int", "body": "<p>You can use <code>fromMaybe</code> from <code>Data.Maybe</code>, but you have to supply a default value that will be used in case the value is <code>Nothing</code>:</p>\n\n<pre><code>*Q46363709&gt; :m +Data.Maybe\n*Q46363709 Data.Maybe&gt; fromMaybe 0 (Just 42)\n42\n*Q46363709 Data.Maybe&gt; fromMaybe 0 Nothing\n0\n</code></pre>\n\n<p>The <code>Maybe</code> type, however, is a <code>Functor</code>, so often, instead of always supplying default values, you can <code>fmap</code> the result of calling your function. Assuming that your function <code>foo</code> has the type <code>Int -&gt; String</code>, you can do this:</p>\n\n<pre><code>*Q46363709&gt; fmap foo $ Just 42\nJust \"42\"\n</code></pre>\n\n<p>Often, while you may not have a good default value for the input (i.e. no good default <code>Int</code>), you may have a suitable default value for the output. In this case, assuming that <code>\"\"</code> (the empty <code>String</code>) is a good default output value, you could use <code>fromMaybe</code> on the output instead of the input:</p>\n\n<pre><code>*Q46363709 Data.Maybe&gt; fromMaybe \"\" $ fmap foo $ Just 42\n\"42\"\n*Q46363709 Data.Maybe&gt; fromMaybe \"\" $ fmap foo $ Nothing\n\"\"\n</code></pre>\n\n<p>As you can see, when the input is <code>Just 42</code>, the output is <code>\"42\"</code>, but when the input is <code>Nothing</code>, then the output is <code>\"\"</code>.</p>\n\n<p>(BTW, I used <code>show</code> for <code>foo</code>, as you can tell...)</p>\n"}], "owner": {"reputation": 71, "user_id": 8622570, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/582f23659e7dcea18acadd21019d271a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Maassen", "link": "https://stackoverflow.com/users/8622570/jeroen-maassen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6705, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1507897992, "creation_date": 1506079707, "last_edit_date": 1507897992, "question_id": 46363709, "link": "https://stackoverflow.com/questions/46363709/haskell-maybe-int-to-int", "title": "Haskell Maybe Int to Int", "body": "<p>I have a function where <code>n</code> needs to be an <code>Int</code> but is a <code>Maybe Int</code>; how could I convert this? I'm aware that this has been asked before, but I don't understand the answer.</p>\n\n<pre><code>where n = case elemIndex column header of\n        Nothing -&gt; Nothing\n        Just n  -&gt; n\n</code></pre>\n"}, {"tags": ["haskell", "hackage", "haddock"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1506073343, "post_id": 46357747, "comment_id": 79682773, "body": "It seems very likely that this is <code>DuplicateRecordFields</code>&#39; fault. Basically, that extension removes all record labels and replaces them with class methods and Haddock has seemingly no way to reverse this process. I was never a fan of that extension; are you sure you need to go that way? Using <code>lens</code>&#39; <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-TH.html#v:makeFields\" rel=\"nofollow noreferrer\"><code>makeFields</code></a> on records with unambiguous field names seems so much more versatile to me."}, {"owner": {"reputation": 166, "user_id": 3413039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33307c80f028ab6739893d8bcf73e9d4?s=128&d=identicon&r=PG&f=1", "display_name": "aviaviavi", "link": "https://stackoverflow.com/users/3413039/aviaviavi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1506100174, "post_id": 46357747, "comment_id": 79699252, "body": "@leftaroundabout: I&#39;m writing a wrapper for a 3rd party JSON API, and many of the requests and responses have field names that are shared across different endpoints. I suppose I could go the route of making field names unique, it just seems like such an otherwise unnecessary workaround. If I go the route of disambiguating, what&#39;s the benefit of using lens? I&#39;m not currently using any lens functionality"}, {"owner": {"reputation": 166, "user_id": 3413039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33307c80f028ab6739893d8bcf73e9d4?s=128&d=identicon&r=PG&f=1", "display_name": "aviaviavi", "link": "https://stackoverflow.com/users/3413039/aviaviavi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1506135947, "post_id": 46357747, "comment_id": 79710418, "body": "Thanks for the help @leftaroundabout! You were correct!"}], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 3413039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33307c80f028ab6739893d8bcf73e9d4?s=128&d=identicon&r=PG&f=1", "display_name": "aviaviavi", "link": "https://stackoverflow.com/users/3413039/aviaviavi"}, "is_accepted": true, "score": 0, "last_activity_date": 1506135878, "creation_date": 1506135878, "answer_id": 46375607, "question_id": 46357747, "link": "https://stackoverflow.com/questions/46357747/haddock-data-record-fields-names-not-being-generated/46375607#46375607", "title": "Haddock - Data record fields names not being generated", "body": "<p>The problem was indeed <code>DuplicateRecordFields</code>. The fields generated just fine when I disambiguated and removed the extension.</p>\n"}], "owner": {"reputation": 166, "user_id": 3413039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33307c80f028ab6739893d8bcf73e9d4?s=128&d=identicon&r=PG&f=1", "display_name": "aviaviavi", "link": "https://stackoverflow.com/users/3413039/aviaviavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 46375607, "answer_count": 1, "score": 2, "last_activity_date": 1506135878, "creation_date": 1506059789, "last_edit_date": 1506060142, "question_id": 46357747, "link": "https://stackoverflow.com/questions/46357747/haddock-data-record-fields-names-not-being-generated", "title": "Haddock - Data record fields names not being generated", "body": "<p>I'm having trouble getting haddock to display the field names of my data records. Some of my data types have many different numeric values, so documenting the names is key.</p>\n\n<p>An example data record:</p>\n\n<pre><code>-- | API response container for daily price history\ndata PriceHistoryResponse = PriceHistoryResponse {\n  responseData :: [PriceHistoryResponseData], -- ^ the actual response, list of price entries\n  timeTo       :: Maybe Integer, -- ^ latest price returned\n  timeFrom     :: Maybe Integer -- ^ earliest price returned\n} deriving (Show, Generic)\n</code></pre>\n\n<p>The data types in question are being exported like so:</p>\n\n<pre><code>  -- more module exports above ..\n  , PriceHistoryResponse(..)\n  , PriceHistoryResponseData(..)\n  -- more below ...\n</code></pre>\n\n<p>For this definition (and all others like it), the only documentation being generated is the constructor's type signature. No explanations of values involved are generated, however.</p>\n\n<p>A possibly relevant detail is that I have <code>DuplicateRecordFields</code> enabled in this file. </p>\n\n<pre><code>$ stack exec -- haddock --version                                           \nHaddock version 2.17.3\n</code></pre>\n\n<p>Am I making an obvious error, or just missing something? Happy to provide any other information that would be useful.</p>\n"}, {"tags": ["string", "haskell", "int"], "comments": [{"owner": {"reputation": 110733, "user_id": 1009479, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wlrC5.jpg?s=128&g=1", "display_name": "Yu Hao", "link": "https://stackoverflow.com/users/1009479/yu-hao"}, "edited": false, "score": 0, "creation_date": 1506059710, "post_id": 46357690, "comment_id": 79675164, "body": "Specify what&#39;s wrong with your current code. Provide an example of input and expected output."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506062092, "post_id": 46357690, "comment_id": 79676207, "body": "In your <code>otherwise</code> case, return <code>Nothing</code>. That will, however, require you to change the return type of the <code>isDigit</code> case, and the <code>[]</code> case, to <code>Maybe [Int]</code> as well. You can do that by using <code>Just</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1506065507, "post_id": 46357690, "comment_id": 79678020, "body": "You can not merge a <code>Nothing</code> with a list..."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 5, "last_activity_date": 1506070713, "last_edit_date": 1506070713, "creation_date": 1506063465, "answer_id": 46358614, "question_id": 46357690, "link": "https://stackoverflow.com/questions/46357690/string-to-list-of-int/46358614#46358614", "title": "String to List of Int", "body": "<p>What is wrong with the code, that you've specified for <code>text2digits :: String -&gt; Maybe [Int]</code>?</p>\n\n<p>The problem is in this line:</p>\n\n<pre><code>digitToInt x :text2digits (filter (/= ' ') xs)\n</code></pre>\n\n<p><code>text2digits</code> returns value of <code>Maybe [Int]</code> type, but <code>(:)</code> expects it to be <code>[Int]</code>.</p>\n\n<p>In order to fix it, you can use <code>fmap</code> or <code>&lt;$&gt;</code> to apply a function to a structure inside the functor <code>Maybe</code>:</p>\n\n<pre><code>import Data.Char\n\ntext2digits :: String -&gt; Maybe [Int]\ntext2digits s = case s of\n    [] -&gt; Just []\n    x:xs\n      |isDigit x      -&gt; ((digitToInt x) :) &lt;$&gt; text2digits (filter (/= ' ') xs)\n      |otherwise      -&gt; Nothing\n\nmain = print $ text2digits \"1233 5687\"\n</code></pre>\n\n<p>Or probably you can use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Traversable.html#v:traverse\" rel=\"nofollow noreferrer\">traverse</a> to refactor the function a bit:</p>\n\n<pre><code>import Data.Char\n\ntext2digits :: String -&gt; Maybe [Int]\ntext2digits s =\n  traverse digitToMaybeInt $ filter (/= ' ') s\n  where\n    digitToMaybeInt x\n      | isDigit x = Just $ digitToInt x\n      | otherwise = Nothing\n\nmain = print $ text2digits \"89\"\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8577937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31f038e506fcaac969874e726807e176?s=128&d=identicon&r=PG&f=1", "display_name": "adsbb12345", "link": "https://stackoverflow.com/users/8577937/adsbb12345"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1506070713, "creation_date": 1506059474, "last_edit_date": 1506062673, "question_id": 46357690, "link": "https://stackoverflow.com/questions/46357690/string-to-list-of-int", "title": "String to List of Int", "body": "<p>I would like to incorporate Maybe [int] into this.</p>\n\n<p>The code should take a string and filter out spaces turning it into a list of integers and if their are letters return Nothing.</p>\n\n<pre><code>text2digits :: String -&gt; [Int]\ntext2digits s = case s of\n    []          -&gt; []\n    x:xs        \n        |isDigit x      -&gt; digitToInt x :text2digits (filter (/= ' ') xs)\n        |otherwise      -&gt; undefined\n\ninput \"1233 5687\"  output: [1,2,3,3,5,6,8,7]\ninput \"a89\"       required output : Nothing \n                  current output: undefined\n</code></pre>\n\n<p>I have tried this but it shows up a list of errors</p>\n\n<pre><code>text2digits :: String -&gt; Maybe [Int]\ntext2digits s = case s of\n    []          -&gt; Just []\n        x:xs        \n        |isDigit x      -&gt; Just digitToInt x :text2digits (filter (/= ' ') xs)\n        |otherwise      -&gt; Nothing\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1506063355, "post_id": 46357238, "comment_id": 79676814, "body": "You can&#39;t define functions which take an arbitrary number in arguments in Haskell without using typeclass tricks. You&#39;re trying to make a function that takes a variable number of arguments, and GHC can&#39;t infer a proper type"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1506063547, "post_id": 46357238, "comment_id": 79676902, "body": "Have you tried writing down the type you think <code>cn</code> should have?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1506082590, "post_id": 46357238, "comment_id": 79688403, "body": "Note that &quot;a function g that takes multiple arguments&quot; is actually, for Haskell, a function which takes exactly one argument (and returns another function). There is no way to distinguish between a function with two arguments, and a function with one argument which returns a function. For this reason it&#39;s hard to define a general composition function as you are trying to do."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1506063940, "creation_date": 1506063940, "answer_id": 46358755, "question_id": 46357238, "link": "https://stackoverflow.com/questions/46357238/yet-another-infinite-type-error/46358755#46358755", "title": "Yet another infinite type error", "body": "<p>You cannot make polyvariadic functions in Haskell without typeclasses.</p>\n\n<p>When you try to make a function that takes either one or two arguments, you try to make a function of type <code>a -&gt; b</code> and <code>a -&gt; p -&gt; b</code>. Hence, the compiler must infer that the type <code>b</code> is equivalent to <code>p -&gt; b</code>, so the type of the function becomes <code>a -&gt; p -&gt; p -&gt; p -&gt; ...</code>. In other words, an infinite type.</p>\n\n<p>A similar problem occurs when you try to make this function. The first line is fine:</p>\n\n<pre><code>cn 1 = c\n</code></pre>\n\n<p>This would imply something like <code>cn :: Int -&gt; (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. However, we now have a problem in the second line:</p>\n\n<pre><code>cn k = lift (cn (k-1))\n</code></pre>\n\n<p>Since we know that <code>cn :: Int -&gt; (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>, we must infer that <code>cn (k-1) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. However, since <code>lift :: (x -&gt; y -&gt; z) -&gt; x -&gt; (w -&gt; y) -&gt; w -&gt; z</code>, we see that the return value must be of type <code>(b -&gt; c) -&gt; (w -&gt; a -&gt; b) -&gt; w -&gt; c</code>, which clashes with the original type declaration.</p>\n\n<p>TL;DR: you can't change the type of a Haskell function/value via values. This means you can't write polyvariadic functions without certain tricks.</p>\n"}], "owner": {"reputation": 1, "user_id": 8653283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78abf46cefc9ffad10f616ce638483f1?s=128&d=identicon&r=PG&f=1", "display_name": "llama", "link": "https://stackoverflow.com/users/8653283/llama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506063940, "creation_date": 1506056996, "last_edit_date": 1506063294, "question_id": 46357238, "link": "https://stackoverflow.com/questions/46357238/yet-another-infinite-type-error", "title": "Yet another infinite type error", "body": "<p>I'm trying to create a function that composes a function f with a function g that takes multiple arguments.</p>\n\n<pre><code>c :: (a -&gt; b) -&gt; (c -&gt; a) -&gt; c -&gt; b\nc x y z = x(y(z))\nlift = c c\n</code></pre>\n\n<p><code>(lift $ lift $ lift ... c)</code> creates the desired function:</p>\n\n<pre><code>*Main&gt; (lift $ lift $ lift $ lift $ lift $ c) (\\x -&gt; x+2) (\\x y z a b c -&gt; x*y*z-(a*b*c)) 1 2 3 4 5 6\n-112\n</code></pre>\n\n<p>However, when I attempt to define a function to produce a function that takes f, g, then n arguments (to save typing), the following error occurs:</p>\n\n<pre><code>cn 1 = c\ncn k = lift (cn(k-1))\n&lt;interactive&gt;:9:1: error:\n    * Occurs check: cannot construct the infinite type: a ~ c0 -&gt; a\n      Expected type: t -&gt; (a -&gt; b) -&gt; a -&gt; b\n        Actual type: t -&gt; (a -&gt; b) -&gt; (c0 -&gt; a) -&gt; c0 -&gt; b\n    * Relevant bindings include\n        cn :: t -&gt; (a -&gt; b) -&gt; a -&gt; b (bound at &lt;interactive&gt;:9:1)\n</code></pre>\n\n<p>Why does this error occur, and how might I resolve it?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1506082734, "post_id": 46357137, "comment_id": 79688515, "body": "No, it&#39;s not bad -- actually, that&#39;s a very good idea! Just use pattern matching: e.g. <code>case</code> instead of <code>if</code>, or as Daniel Wagner shows below."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1506106622, "post_id": 46357137, "comment_id": 79702506, "body": "Even if it were less efficient, you should profile before making an optimization like that. I&#39;d be pretty surprised if it were a bottleneck (if it were an issue)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "edited": false, "score": 0, "creation_date": 1506134805, "post_id": 46357137, "comment_id": 79710257, "body": "GHC does in fact optimize representations of ADTs. I&#39;m not even sure how it wouldn&#39;t?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1506056516, "creation_date": 1506056516, "answer_id": 46357167, "question_id": 46357137, "link": "https://stackoverflow.com/questions/46357137/is-it-a-bad-idea-to-use-custom-binary-data-types-in-haskell/46357167#46357167", "title": "Is it a bad idea to use custom binary data types in Haskell?", "body": "<p>No, don't replace this with <code>Bool</code>; instead replace your equality check with pattern matching.</p>\n\n<pre><code>myFunc Constructor1 = -- do something\nmyFunc Constructor2 = -- do something else\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1506083122, "creation_date": 1506083122, "answer_id": 46364791, "question_id": 46357137, "link": "https://stackoverflow.com/questions/46357137/is-it-a-bad-idea-to-use-custom-binary-data-types-in-haskell/46364791#46364791", "title": "Is it a bad idea to use custom binary data types in Haskell?", "body": "<p>A few alternatives to Daniel's approach (which is the best one, anyway).</p>\n\n<ul>\n<li><p>Use <code>case .. of</code></p>\n\n<pre><code>myFunc input = case input of\n   Constructor1 -&gt; ...\n   Constructor2 -&gt; ...\n</code></pre></li>\n<li><p>Roll your custom <code>if</code> (Haskell excels at this!)</p>\n\n<pre><code>-- define this helper once\nmyIf :: MyType -&gt; a -&gt; a -&gt; a\nmyIf Constructor1 x1 _  = x1\nmyIf Constructor2 _  x2 = x2\n\n-- use it as many times as needed\nmyFunc input = myIf input\n   (...) -- \"then\"/Constructor1 branch\n   (...) -- \"else\"/Constructor2 branch\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 46357167, "answer_count": 2, "score": 2, "last_activity_date": 1506083122, "creation_date": 1506056294, "question_id": 46357137, "link": "https://stackoverflow.com/questions/46357137/is-it-a-bad-idea-to-use-custom-binary-data-types-in-haskell", "title": "Is it a bad idea to use custom binary data types in Haskell?", "body": "<p>Recently I made a program where I used a data type of the following form:</p>\n\n<pre><code>data MyType = Constructor1 | Constructor2 deriving Eq\n</code></pre>\n\n<p>Yes, this type is practically the same as <code>Bool</code> I just named it something different to make my code more readable. Later in the program I have function(s) of the form </p>\n\n<pre><code>myFunc input = if input == Constructor1 then --do something\n    else --do something else\n</code></pre>\n\n<p>The reason I think that this could be a bad idea is that if it were interpreted just the way that it is, every time the program came across this branch it would have to run through the <code>==</code> function that it set up for <code>MyType</code> to get a <code>Bool</code> to pass to the <code>if_then_else_</code> function, whereas if I had just used <code>Bool</code> the necessity of the <code>==</code> function is eliminated which would speed up the process. </p>\n\n<p>Should I replace all instances of <code>MyType</code> with instances of <code>Bool</code> or does ghc optimize the use of data types like these somehow?</p>\n"}, {"tags": ["haskell", "static-site", "hakyll"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1506084097, "post_id": 46356263, "comment_id": 79689509, "body": "It depends on the way your server is configured. Typically <code>www.example.com&#47;index.html</code> will be the landing page when someone tries to visit <code>www.example.com</code>. See for instance <a href=\"https://github.com/gallais/gallais.github.io/blob/source/src/site.hs#L68\" rel=\"nofollow noreferrer\">this line</a>."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506093457, "post_id": 46356263, "comment_id": 79695597, "body": "Have you tried <code>fromFilePath &quot;.&#47;&quot;</code>?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1506142693, "post_id": 46356263, "comment_id": 79711356, "body": "@gallais, as far as I can tell, using index.html produces a default file server that does not seem to respect any of the templates or content I provided."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506142798, "post_id": 46356263, "comment_id": 79711369, "body": "@arrowd,     \u2022 Couldn&#39;t match expected type \u2018Rules () -&gt; Rules a0\u2019                   with actual type \u2018Rules ()\u2019"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1506148335, "post_id": 46356263, "comment_id": 79712291, "body": "Check parentheses: <code>create (fromFilePath &quot;.&#47;&quot;) $ do</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1506179587, "post_id": 46356263, "comment_id": 79720346, "body": "\u2022 Couldn&#39;t match expected type \u2018[Identifier]\u2019                   with actual type \u2018Identifier\u2019     \u2022 In the first argument of \u2018create\u2019, namely \u2018(fromFilePath &quot;./&quot;)\u2019       In the expression: create (fromFilePath &quot;./&quot;)  Replacing with      create [(fromFilePath &quot;./&quot;)] $ do  No error, but can&#39;t rebuild:   [ERROR] Hakyll.Core.Compiler.cached: You are trying to (perhaps indirectly) use <code>cached</code> on a non-existing resource: there is no file backing ."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1506192342, "post_id": 46356263, "comment_id": 79724364, "body": "It kind of blows my mind this doesn&#39;t have a trivial answer that works with minimal configuration. This is &quot;hello world&quot; for Hakyll."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1507004157, "post_id": 46519924, "comment_id": 80028658, "body": "I have similar, trying to use markdown: ``    create [&quot;index.md&quot;] $ do       route (setExtension &quot;html&quot;)       compile $ pandocCompiler         &gt;&gt;= loadAndApplyTemplate &quot;templates/default.html&quot; defaultContext         &gt;&gt;= relativizeUrls `` I get this error when I  <code>stack build</code> ```   [ERROR] Hakyll.Core.Compiler.Require.load: templates/default.html (snapshot _final) was not found in the cache, the cache might be corrupted or the item you are referring to might not exist ```"}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1506921955, "creation_date": 1506921955, "answer_id": 46519924, "question_id": 46356263, "link": "https://stackoverflow.com/questions/46356263/whats-the-root-of-a-hakyll-site/46519924#46519924", "title": "What&#39;s the root of a Hakyll site?", "body": "<p>The <code>create</code> function requires a list of <code>Identifiers</code>.  For the case of a single element, just surround it with brackets (<code>[]</code>). And <code>Identifier</code> is a member of the <code>IsString</code> class so assuming you have enabled <code>-XOverloadedStrings</code> you can build one with just a regular quoted string literal (<code>\"index.html\"</code>).</p>\n\n<p>So to create a file that is served at the root you would write:</p>\n\n<pre><code>create [\"index.html\"] $ do\nroute   idRoute\ncompile $ pandocCompiler\n    &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n    &gt;&gt;= relativizeUrls\n</code></pre>\n\n<hr>\n\n<p>Reminder when a path is requested without an explicit file name (e.g. <code>http://www.example.com/</code>) the contents of the file <code>index.html</code> are returned (Unless the server is configured in some other way, but this is the standard.)</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1506921955, "creation_date": 1506050043, "question_id": 46356263, "link": "https://stackoverflow.com/questions/46356263/whats-the-root-of-a-hakyll-site", "title": "What&#39;s the root of a Hakyll site?", "body": "<p>I see the create function takes a list of Identifiers.</p>\n\n<pre><code>ghci    \u03bb&gt; :t create\ncreate :: [Identifier] -&gt; Rules () -&gt; Rules ()\n</code></pre>\n\n<p>What list of identifier should I use to match the root of the site?  Eg, I just want to make a single html page that appears on \"www.example.com\" without \"/posts\" or \"/archives\" or any other domain parts.</p>\n\n<p>I've tried a few:</p>\n\n<pre><code>create \"/\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create \"/*\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create \".\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create \"./\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create \"/.\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create \"\" $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create Nothing $ do\n    route   idRoute\n    compile $ pandocCompiler\n        &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n        &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>I get errors like:</p>\n\n<pre><code>site.hs:24:12: error:\n    \u2022 Couldn't match type \u2018Identifier\u2019 with \u2018Char\u2019\n        arising from the literal \u2018\"\"\u2019\n    \u2022 In the first argument of \u2018create\u2019, namely \u2018\"\"\u2019\n      In the expression: create \"\"\n      In a stmt of a 'do' block:\n        create \"\"\n        $ do { route idRoute;\n               compile\n               $ pandocCompiler\n                 &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n                 &gt;&gt;= relativizeUrls }\nFailed, modules loaded: none.\nLoaded GHCi configuration from /tmp/ghci29841/ghci-script\n</code></pre>\n\n<p>I can't say <code>:i Identifier</code> or <a href=\"https://jaspervdj.be/hakyll/reference/Hakyll-Core-Identifier.html#t:Identifier\" rel=\"noreferrer\">reading documentation</a> or <a href=\"https://github.com/jaspervdj/hakyll/blob/67ecff7ad383640bc73d64edc2506c7cc648a134/lib/Hakyll/Core/Identifier.hs\" rel=\"noreferrer\">reading the source code</a> makes this any clearer for me:</p>\n\n<pre><code>ghci    \u03bb&gt; :i Identifier\ndata Identifier\n  = Hakyll.Core.Identifier.Identifier {identifierVersion :: Maybe\n                                                              String,\n                                       Hakyll.Core.Identifier.identifierPath :: String}\n    -- Defined in \u2018Hakyll.Core.Identifier\u2019\ninstance Eq Identifier -- Defined in \u2018Hakyll.Core.Identifier\u2019\ninstance Ord Identifier -- Defined in \u2018Hakyll.Core.Identifier\u2019\ninstance Show Identifier -- Defined in \u2018Hakyll.Core.Identifier\u2019\n</code></pre>\n\n<p>What magic incantation should I use to create html that will appear \"/\", and how should I have investigated this better to make it less mysterious?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1506045022, "post_id": 46355636, "comment_id": 79671144, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38839348/stack-yaml-file-cabal-file-differences\">stack.yaml file &amp; .cabal file differences?</a>"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1506045145, "post_id": 46355636, "comment_id": 79671172, "body": "Actually, no, that\u2019s probably not a duplicate, reading your question more closely. It sounds like you are using <a href=\"https://github.com/sol/hpack\" rel=\"nofollow noreferrer\">hpack</a>, which generates the <code>.cabal</code> file for you. Add the dependency in the <code>package.yaml</code> file, instead."}, {"owner": {"reputation": 1, "user_id": 8652548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86dcecf33a9ad0d7f8cbcad738b3eced?s=128&d=identicon&r=PG&f=1", "display_name": "wvansteen", "link": "https://stackoverflow.com/users/8652548/wvansteen"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1506048459, "post_id": 46355636, "comment_id": 79671983, "body": "packages.yaml was exactly the place.  Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1574118965, "creation_date": 1574118965, "answer_id": 58924331, "question_id": 46355636, "link": "https://stackoverflow.com/questions/46355636/stack-wont-resolve-a-hidden-dependency/58924331#58924331", "title": "Stack won&#39;t resolve a &#39;hidden&#39; dependency", "body": "<p>In <code>stack.yaml</code> you declare the Stackage LTS version, a curated list of hackage dependencies that you want to depend on. You can also depend on local packages and packages in git that are not in Hackage. You may also change the versions of the packages in LTS as long as they respect the constraints of the other dependencies.</p>\n\n<p><code>package.yaml</code> is the build file. Any packages you want to import directly in your Haskell code must be declared in here as dependencies, even if they are explicitly declared in the <code>stack.yaml</code>.</p>\n\n<p>Finally, when you see <code>It is a member of the hidden package</code>, that means that one of your dependencies is using that package, but it is not declared as a dependency in your build file.</p>\n"}], "owner": {"reputation": 1, "user_id": 8652548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86dcecf33a9ad0d7f8cbcad738b3eced?s=128&d=identicon&r=PG&f=1", "display_name": "wvansteen", "link": "https://stackoverflow.com/users/8652548/wvansteen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574118965, "creation_date": 1506044790, "last_edit_date": 1506045293, "question_id": 46355636, "link": "https://stackoverflow.com/questions/46355636/stack-wont-resolve-a-hidden-dependency", "title": "Stack won&#39;t resolve a &#39;hidden&#39; dependency", "body": "<p>I am working on my first major Haskell application, and want to add mockery to create disposable test WAI threads.  Importing mockery and running <code>stack test</code> resulted in the compiler error: </p>\n\n<pre><code>Failed to load interface for \u2018Test.Mockery.Directory\u2019\nIt is a member of the hidden package \u2018mockery-0.3.5\u2019.\nPerhaps you need to add \u2018mockery\u2019 to the build-depends in your .cabal file.\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p>So, I added mockery to my cabal file under test dependencies.  However, when I run <code>stack build</code> or <code>stack test</code> mockery is automatically removed from the cabal file.</p>\n\n<p>I have also tried listing <code>mockery-0.3.5</code> under <code>extra-deps</code> in the <code>stack.yaml</code> file.  This unsurprisingly didn't work, since mockery is part of my lts, and extra deps is for packages outside of lts.</p>\n\n<p>How can I get stack to recognize that mockery should be included as a dependency to to project?</p>\n\n<p>Here is my stack.yaml: </p>\n\n<pre><code>flags: {}\nghc-options:\n  ! '*': -Wall\npackages:\n- .\nextra-deps: [\n]\n\nresolver: lts-9.5\n</code></pre>\n\n<p>I'm using stack version 1.5.1</p>\n\n<p>I imagine this is a stupid build issue and look forward to confronting my obvious oversight.</p>\n"}, {"tags": ["haskell", "pattern-matching", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 3, "last_activity_date": 1506039390, "creation_date": 1506039390, "answer_id": 46355031, "question_id": 46354999, "link": "https://stackoverflow.com/questions/46354999/non-exhaustive-pattern-matches-only-because-i-left-off-otherwise/46355031#46355031", "title": "Non-exhaustive pattern matches only because I left off `otherwise =`?", "body": "<p>The compiler does only a static semantic analysis. This is unable to see that the three cases cover all possible inputs because the meaning of the operators are determined at run-time.</p>\n\n<p>Your code is provably correct. If you want to avoid the warning from GHC, you can change the final condition to <code>otherwise</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1506064627, "post_id": 46355037, "comment_id": 79677528, "body": "I&#39;d add that there <i>are</i> <code>Ord</code> instances which are commonly used and for which this assumption doesn&#39;t hold: <code>Float</code> and <code>Double</code> (because of <code>NaN</code>)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1506039420, "creation_date": 1506039420, "answer_id": 46355037, "question_id": 46354999, "link": "https://stackoverflow.com/questions/46354999/non-exhaustive-pattern-matches-only-because-i-left-off-otherwise/46355037#46355037", "title": "Non-exhaustive pattern matches only because I left off `otherwise =`?", "body": "<p>GHC simply doesn't know that one of <code>a &gt; b</code>, <code>a &lt; b</code>, or <code>a == b</code> must evaluate to <code>True</code>. (Indeed, it is possible to write an <code>Ord</code> instance that violates this assumption -- though most programmers would not consider doing so, and certainly the one for <code>Int</code> will behave nicely in this regard.)</p>\n\n<p>You can make it patently obvious to GHC that you've covered all the cases by using a complete pattern match instead, e.g.</p>\n\n<pre><code>respond correct guess = case compare guess correct of\n    GT -&gt; ...\n    LT -&gt; ...\n    EQ -&gt; ...\n</code></pre>\n\n<p>GHC also has a special case in its exhaustiveness checker for the guards <code>otherwise</code> and <code>True</code>, so you may add (or replace) one of the guards with this as an alternative solution.</p>\n\n<pre><code>respond correct guess\n    | guess &gt; correct = ...\n    | guess &lt; correct = ...\n    | otherwise = ...\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "closed_date": 1506039712, "accepted_answer_id": 46355037, "answer_count": 2, "score": 3, "last_activity_date": 1506039420, "creation_date": 1506039175, "question_id": 46354999, "link": "https://stackoverflow.com/questions/46354999/non-exhaustive-pattern-matches-only-because-i-left-off-otherwise", "closed_reason": "Duplicate", "title": "Non-exhaustive pattern matches only because I left off `otherwise =`?", "body": "<p>I wrote a simple program in Haskell that plays <a href=\"https://doc.rust-lang.org/book/second-edition/ch02-00-guessing-game-tutorial.html\" rel=\"nofollow noreferrer\">the guessing game described in The Rust Programming Language book</a>:</p>\n\n<blockquote>\n  <p>Here\u2019s how it works: the program will generate a random integer between 1 and 100. It will then prompt the player to enter a guess. After entering a guess, it will indicate whether the guess is too low or too high. If the guess is correct, the game will print congratulations and exit.</p>\n</blockquote>\n\n<p>Here is what I wrote:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad (when)\nimport System.Random (randomRIO)\n\n-- | Check if the guess is correct, otherwise provide a hint\nrespond :: Int -&gt; Int -&gt; String\nrespond correct guess\n  | guess &gt; correct = \"Smaller than \" ++ show guess\n  | guess &lt; correct = \"Larger than \" ++ show guess\n  | guess == correct = \"Correct! \" ++ show correct\n\n-- | Main game loop; prompt for input and repeat until guessed correctly\nplay :: Int -&gt; IO ()\nplay x = do\n  putStr \"Guess: \"\n  guess &lt;- read &lt;$&gt; getLine\n  putStrLn $ respond x guess\n  when (guess /= x) $ play x\n\n-- | Start the game with a random number between 1 and 100\nmain :: IO ()\nmain = play =&lt;&lt; randomRIO (1, 100)\n</code></pre>\n\n<p>The code works, but GHC gives me a warning that <code>\"Pattern match(es) are non exhaustive. In an equation for 'respond': Patterns not matched:  _ _\"</code></p>\n\n<p>I take those two underscores to represent the two <code>Ints</code> I have as arguments to the <code>respond</code> function. What I don't understand is which case I haven't covered. Those aren't <code>Maybe Int</code>s or anything special \u2014\u00a0the function <em>requires</em> two valid <code>Ints</code>, so I only need to deal with integers \u2014 and I don't think there is any number that cannot be deemed greater than, less than, or equal to another?</p>\n\n<p>Is this just GHC assuming I have not covered all cases because I didn't add a final <code>otherwise =</code> guard? Even though it logically covers all cases.</p>\n\n<hr>\n\n<p>Also, if you have any tips on how to write more idiomatic Haskell, I'd appreciate them. I'm still learning the basics.</p>\n"}, {"tags": ["performance", "haskell", "build", "ghc"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506038553, "post_id": 46354561, "comment_id": 79669678, "body": "If you&#39;re running out of memory then you are hitting some bad asymptotics in GHC and (2) would probably help, especially if you can look at your modules as a dependency tree. (1) also sounds like what I would do TBH. If you can identify any of the slowness or get test cases you should definitely report them to GHC trac."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506042093, "post_id": 46354561, "comment_id": 79670511, "body": "4 years ago, in a predecessor to this project, I did identify one source of slowness, related to typeclass resolution involving Generic. It had already been reported in trac. To my knowledge, that performance issue has still not been fixed.  I wound up deleting that part of the code. 4 years later, my code is still missing NFData instances."}, {"owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1506042132, "post_id": 46354561, "comment_id": 79670519, "body": "How would I view the dependency tree of my modules, and how would that help compared to suggestion (2) without dependency info?"}], "answers": [{"tags": [], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "is_accepted": true, "score": 0, "last_activity_date": 1506191028, "creation_date": 1506191028, "answer_id": 46382922, "question_id": 46354561, "link": "https://stackoverflow.com/questions/46354561/benchmarking-ghc-compilation-times/46382922#46382922", "title": "Benchmarking GHC compilation times", "body": "<p>Better and easier than watching text output, I realized I could simply look at the timestamps on files in the build folder.</p>\n\n<p>This command gives me a nice list of build files sorted by timestamp, so I can roughly tell how long it spent on each:</p>\n\n<pre><code>ls -l -c -T -R .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/&lt;source folder&gt; | grep \"rw\" | grep \"\\.\" | awk '{print $8,$10}' | sort\n</code></pre>\n"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 46382922, "answer_count": 1, "score": 1, "last_activity_date": 1506191028, "creation_date": 1506035753, "question_id": 46354561, "link": "https://stackoverflow.com/questions/46354561/benchmarking-ghc-compilation-times", "title": "Benchmarking GHC compilation times", "body": "<p>My Haskell program takes too long to compile.</p>\n\n<p>By that, I mean: It's been over a year since I've been able to compile with -O1. Last time I tried, I set up a 64gb server just to compile my program, and let it run overnight. It ran out of memory.</p>\n\n<p>I'm about to embark on some big re-engineering changes which I hope will speed up compilation times, but first I need to know what's taking so long, and get some good measurements so I can track progress.</p>\n\n<p>I currently have two ideas for how to do this:</p>\n\n<ol>\n<li>Cover my program in flags so I can try compiling different pieces and timing\nthem.</li>\n<li>Writing a wrapper program for <code>stack build</code> that looks for lines like \"[75 of 83] Compiling ,\" and times how long between them.</li>\n</ol>\n\n<p>(1) sounds really ugly, and I don't expect (2) to give good numbers because of imprecision and because of cross-module compilation. Anyone have better ideas?</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1506034555, "post_id": 46354206, "comment_id": 79668634, "body": "For the special case of newtypes, you should just use <code>Data.Coerce</code>, which gives you <code>coerce :: (a -&gt; a) -&gt; A a -&gt; A a</code> and <code>coerce :: (A a -&gt; A a) -&gt; B a -&gt; B a</code> and <code>coerce (a -&gt; a) -&gt; B a -&gt; B a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1506034689, "post_id": 46354206, "comment_id": 79668669, "body": "I think <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\">safe coercions</a> are the way to go for autowrapping/unwrapping."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1506039230, "post_id": 46354206, "comment_id": 79669839, "body": "@user2407038, indeed, but that doesn&#39;t necessarily have to be at the use site. For a newtype, <code>instance Functor N where fmap = coerce</code> is pretty reasonable."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506056679, "post_id": 46354206, "comment_id": 79674077, "body": "I don&#39;t see how your proposed typeclass would even help. The type <code>B a -&gt; B a</code> doesn&#39;t unify with <code>h (k a) -&gt; h (k b)</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1506061992, "post_id": 46354206, "comment_id": 79676163, "body": "<code>&lt;$$&gt;</code> is reminiscent of <code>over</code> from the newtype / newtype-generics package. But <code>over</code> requires the external newtype constructor as an additional parameter. <a href=\"http://hackage.haskell.org/package/newtype-generics-0.5.1/docs/Control-Newtype.html#v:over\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/newtype-generics-0.5.1/docs/&hellip;</a>"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506117323, "post_id": 46354206, "comment_id": 79706988, "body": "You&#39;re right Daniel. Such typeclass won&#39;t help indeed."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506153825, "post_id": 46361824, "comment_id": 79713498, "body": "This won&#39;t work in my case since <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code>. The function I want to reuse has type <code>A a -&gt; A b</code>, hence I need something like <code>??? :: (A a -&gt; A b) -&gt; B a -&gt; B a</code>. Note that I&#39;m not operating on elements of type <code>a</code> (in your example), but on elements on type <code>Team a</code>. For the problem I&#39;m dealing with <code>A a = Map a Integer</code> so this example won&#39;t work. Function <code>over</code> in the other answer seems to fit the bill."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506159682, "post_id": 46361824, "comment_id": 79714860, "body": "@Damian Nadales <code>A a -&gt; A b</code> is in fact partial application of <code>fmap g </code> on <code>A</code> type where <code>g</code> is type <code>(a -&gt; b)</code> so <code>:t fmap g</code> would give you <code>(f a -&gt; f b)</code> where <code>f</code> represents Functor <code>A</code>. Then all you need is to apply another <code>fmap</code> but this time on type <code>B</code> like <code>fmap (fmap g)</code> or ` fmap . fmap $ g` which is in practice what happens in the Functor instance of the <code>League</code> type in above code. If you prefer Functor instance of League (your B type) to operate directly on <code>(A a -&gt; A b)</code> instead of <code>(a -&gt; b)</code> then make the Functor instance of League like <code>fmap f (League x) = League (f x)</code>."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1506073966, "creation_date": 1506073966, "answer_id": 46361824, "question_id": 46354206, "link": "https://stackoverflow.com/questions/46354206/mapping-the-value-inside-a-newtype/46361824#46361824", "title": "Mapping the value inside a newtype", "body": "<p>Actually one of the main reasons to use <code>newtype</code> is to derive new Type Class instances for a new type which is wrapped over an existing one.</p>\n\n<p>So its quite simple. You are just expected to write an instance for Functor class and that's it.</p>\n\n<pre><code>newtype Team a = Team a deriving (Show , Eq)\n\ninstance Functor Team where\n  fmap f (Team x) = Team (f x)\n\nnewtype League a = League (Team a) deriving (Show , Eq)\n\ninstance Functor League where\n  fmap f (League x) = League (fmap f x)\n\n\nupgradeTeam :: (Int -&gt; Int) -&gt; Team [Int] -&gt; Team [Int]\nupgradeTeam f = fmap (map f)\n\nupgradeLeague :: (Int -&gt; Int) -&gt; League [Int] -&gt; League [Int]\nupgradeLeague f = fmap (map f) \n\nprependToLeague :: League [Int] -&gt; Int -&gt; League [Int]\nprependToLeague x n = fmap (n:) x\n\n*Main&gt; upgradeTeam (+1) (Team [0,1,2,3])\nTeam [1,2,3,4]\n\n*Main&gt; upgradeLeague (*2) (League (Team [1,2,3,4]))\nLeague (Team [2,4,6,8])\n\n*Main&gt; prependToLeague (League (Team [2,4,6,8])) 42\nLeague (Team [42,2,4,6,8])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1506130648, "post_id": 46373254, "comment_id": 79709643, "body": "I&#39;d be more likely to reach for <code>Control.Lens.Iso.coerced</code> along with <code>Control.Lens.Setter.over</code>. They don&#39;t require <code>Newtype</code> or <code>Generic</code> instances."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506134209, "post_id": 46373254, "comment_id": 79710172, "body": "Actually, you can do it even more simply. See the answer I&#39;m about to write."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1506114942, "last_edit_date": 1506114942, "creation_date": 1506114636, "answer_id": 46373254, "question_id": 46354206, "link": "https://stackoverflow.com/questions/46354206/mapping-the-value-inside-a-newtype/46373254#46373254", "title": "Mapping the value inside a newtype", "body": "<p>One solution is to use the <a href=\"http://hackage.haskell.org/package/newtype-generics-0.5.1/docs/Control-Newtype.html\" rel=\"nofollow noreferrer\">newtype-generics</a> package, in particular the <a href=\"http://hackage.haskell.org/package/newtype-generics-0.5.1/docs/Control-Newtype.html#v:over\" rel=\"nofollow noreferrer\"><code>over</code></a> function:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport Control.Newtype (Newtype, over)\nimport GHC.Generics\n\nnewtype A a = A a\n\nnewtype B a = B (A a) deriving (Generic)\n\ninstance Newtype (B a)\n\nf :: A a -&gt; A a\nf = undefined\n\nfb :: B a -&gt; B a\nfb = over B f\n</code></pre>\n\n<p>Notice that <code>over</code> requires the outer <code>B</code> constructor as a parameter, not only the function <code>f</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506154598, "post_id": 46375501, "comment_id": 79713663, "body": "Nice. Where are <code>_pack</code> defined? Also I would expect <code>mover</code> to be defined in some library already ..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1506154688, "post_id": 46375501, "comment_id": 79713676, "body": "Those are just wildcards. You could write <code>mover _ _ = coerce</code>."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1506134463, "creation_date": 1506134463, "answer_id": 46375501, "question_id": 46354206, "link": "https://stackoverflow.com/questions/46354206/mapping-the-value-inside-a-newtype/46375501#46375501", "title": "Mapping the value inside a newtype", "body": "<p>If you like danidiaz's answer, you may like this somewhat more \"modern\" version of <code>over</code>:</p>\n\n<pre><code>mover :: (Coercible o n, Coercible o' n')\n      =&gt; (o -&gt; n)\n      -&gt; (o' -&gt; n')\n      -&gt; (o -&gt; o') -&gt; n -&gt; n'\nmover _pack _pack' = coerce\n</code></pre>\n\n<p>This skips all the instances in favor of a bit more explicit passing.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 2, "accepted_answer_id": 46373254, "answer_count": 3, "score": 3, "last_activity_date": 1506134463, "creation_date": 1506033609, "question_id": 46354206, "link": "https://stackoverflow.com/questions/46354206/mapping-the-value-inside-a-newtype", "title": "Mapping the value inside a newtype", "body": "<p>Assume the following <code>newtype</code> is defined:</p>\n\n<pre><code>newtype A a = A a\n</code></pre>\n\n<p>And there is a function:</p>\n\n<pre><code>f :: A a -&gt; A a\n</code></pre>\n\n<p>Now suppose I define another <code>newtype</code>, which contains <code>A a</code>:</p>\n\n<pre><code>newtype B a = B (A a)\n</code></pre>\n\n<p>And then I'd like to define a function <code>fb</code> which operates on <code>B a</code> but just uses <code>f</code>:</p>\n\n<pre><code>fb :: B a -&gt; B a\nfb (B x) = B (f x)\n</code></pre>\n\n<p>Now this is quite inconvenient since I have to unwrap and wrap the value inside an element of type <code>B a</code>. This won't be that bad if I only had to define one such a <code>fb</code> but if there are a lot of them this becomes quite tedious.</p>\n\n<p>I'd be nice if there would be a type-class with a function:</p>\n\n<pre><code>(&lt;$$&gt;) :: k a -&gt; k b -&gt; h (k a) -&gt; h (k b)\n</code></pre>\n\n<p>So that <code>fb</code> can be rewritten as:</p>\n\n<pre><code>fb = (f &lt;$$&gt;)\n</code></pre>\n\n<p>Maybe such an abstraction already exists, but I cannot find it.</p>\n"}, {"tags": ["haskell", "postgresql-9.1", "yesod", "yesod-forms"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506034779, "post_id": 46353611, "comment_id": 79668698, "body": "What exactly is <code>MyHandler</code> ?"}, {"owner": {"reputation": 489, "user_id": 4208588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f5fca93c18a3ae7c3a701a29507ef0?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Romero", "link": "https://stackoverflow.com/users/4208588/jose-romero"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506044081, "post_id": 46353611, "comment_id": 79670932, "body": "It&#39;s defined like: type MyHandler = HandlerT PersonalPage IO, PersonalPage is my Foundation type."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506046440, "post_id": 46353611, "comment_id": 79671503, "body": "Does the error remain the same if you change the type signature to <code>Handler Html</code> ?"}, {"owner": {"reputation": 489, "user_id": 4208588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f5fca93c18a3ae7c3a701a29507ef0?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Romero", "link": "https://stackoverflow.com/users/4208588/jose-romero"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506048320, "post_id": 46353611, "comment_id": 79671944, "body": "Yes, it doesn&#39;t change."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506048387, "post_id": 46353611, "comment_id": 79671963, "body": "Are you using the yesod scaffolding template ?"}, {"owner": {"reputation": 489, "user_id": 4208588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f5fca93c18a3ae7c3a701a29507ef0?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Romero", "link": "https://stackoverflow.com/users/4208588/jose-romero"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506048514, "post_id": 46353611, "comment_id": 79672003, "body": "No, I&#39;m doing it from scratch. Everything is working except for that runDB. This is the complete code: <a href=\"https://github.com/jmromeroes/personal-webpage/blob/master/app/main.hs\" rel=\"nofollow noreferrer\">github.com/jmromeroes/personal-webpage/blob/master/app/main.&zwnj;&#8203;hs</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1506048779, "post_id": 46353611, "comment_id": 79672062, "body": "You are missing <code>YesodPersist</code> instances."}, {"owner": {"reputation": 489, "user_id": 4208588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f5fca93c18a3ae7c3a701a29507ef0?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Romero", "link": "https://stackoverflow.com/users/4208588/jose-romero"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1506049337, "post_id": 46353611, "comment_id": 79672200, "body": "That was it! Thank you so much. I don&#39;t know how I skiped that from the documentation."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1506147388, "creation_date": 1506147388, "answer_id": 46376668, "question_id": 46353611, "link": "https://stackoverflow.com/questions/46353611/couldnt-match-type-basebackendyesodpersistbackend-personalpage-with-sqlbac/46376668#46376668", "title": "Couldn&#39;t match type `BaseBackend(YesodPersistBackend PersonalPage)&#39; with `SqlBackend&#39;", "body": "<p>You are missing the relevant <code>YesodPerist</code> instance. It will be something like this:</p>\n\n<pre><code>instance YesodPersist App where\n  type YesodPersistBackend App = SqlBackend\n  runDB action = do\n    master &lt;- getYesod\n    runSqlPool action $ appConnPool master\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 4208588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f5fca93c18a3ae7c3a701a29507ef0?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Romero", "link": "https://stackoverflow.com/users/4208588/jose-romero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 46376668, "answer_count": 1, "score": 0, "last_activity_date": 1506147388, "creation_date": 1506030261, "last_edit_date": 1506037086, "question_id": 46353611, "link": "https://stackoverflow.com/questions/46353611/couldnt-match-type-basebackendyesodpersistbackend-personalpage-with-sqlbac", "title": "Couldn&#39;t match type `BaseBackend(YesodPersistBackend PersonalPage)&#39; with `SqlBackend&#39;", "body": "<p>I have a problem using persistent and Yesod with postgresql. This is the function that brings problems:</p>\n\n<pre><code>postBlogR :: MyHandler Html\npostBlogR = do\n    ((res, widgetForm), enctype) &lt;- runFormPost blogForm\n    case res of\n        FormSuccess blog -&gt; do\n            blogId &lt;- runDB $ insert blog\n            redirect $ HomeR\n    _ -&gt; adminLayout [whamlet|&lt;h1&gt;Post Created!|]\n</code></pre>\n\n<p>The trace is:</p>\n\n<pre><code>* Couldn't match type `BaseBackend(YesodPersistBackend PersonalPage)'\n                 with `SqlBackend'\n    arising from a use of `insert'\n* In the second argument of `($)', namely `insert blog'\n  In a stmt of a 'do' block: blogId &lt;- runDB $ insert blog\n  In the expression:\n    do { blogId &lt;- runDB $ insert blog;\n         redirect $ HomeR }\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "closed_date": 1506027409, "answer_count": 0, "score": 5, "last_activity_date": 1506027262, "creation_date": 1506025556, "question_id": 46352629, "link": "https://stackoverflow.com/questions/46352629/what-does-instance-safe-mean-in-ghci-info-output", "closed_reason": "Duplicate", "title": "What does &quot;instance [safe]&quot; mean in ghci &quot;:info&quot; output?", "body": "<p>In <code>ghci</code>, I declare a data type as follows.</p>\n\n<pre><code>data Example = MakeExample deriving Show\n</code></pre>\n\n<p>Then, when I call <code>:info Example</code> to see that the derived <code>Show</code> instance is recognized, I get the following output.</p>\n\n<pre><code>&gt; :i Example\ndata Example = MakeExample      -- Defined at &lt;interactive&gt;:17:1\ninstance [safe] Show Example -- Defined at &lt;interactive&gt;:17:37\n</code></pre>\n\n<p>The <code>Show</code> instance is recognized as expected. However, I do not understand why that <code>[safe]</code> is there.</p>\n\n<p>By contrast, <code>[safe]</code> does not appear when I call <code>:info</code> on <code>Bool</code>.</p>\n\n<pre><code>&gt; :i Bool\ndata Bool = False | True        -- Defined in \u2018GHC.Types\u2019\ninstance Bounded Bool -- Defined in \u2018GHC.Enum\u2019\ninstance Enum Bool -- Defined in \u2018GHC.Enum\u2019\ninstance Eq Bool -- Defined in \u2018GHC.Classes\u2019\ninstance Ord Bool -- Defined in \u2018GHC.Classes\u2019\ninstance Read Bool -- Defined in \u2018GHC.Read\u2019\ninstance Show Bool -- Defined in \u2018GHC.Show\u2019\n</code></pre>\n\n<p><strong>What does <code>instance [safe]</code> mean in <code>ghci</code>'s <code>:info</code> output?</strong></p>\n"}, {"tags": ["haskell", "compiler-errors", "typeclass", "phantom-types"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1506023180, "post_id": 46350839, "comment_id": 79664320, "body": "I&#39;ve opened a GHC issue: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14266\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/14266</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1506019225, "last_edit_date": 1506019225, "creation_date": 1506018828, "answer_id": 46350965, "question_id": 46350839, "link": "https://stackoverflow.com/questions/46350839/compilation-error-with-a-class-constraint-on-a-phantom-type-in-a-default-method/46350965#46350965", "title": "Compilation error with a class constraint on a phantom type in a default method", "body": "<p>GHC is basically converting your code to this:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE ExplicitForAll #-}\n\nmodule Foo where\n\ndefaultF :: forall t x m. (A t, Monoid x) =&gt; t m -&gt; m\ndefaultF = undefined\n\nclass A t where\n  f :: forall x m. Monoid x =&gt; t m -&gt; m\n  f = defaultF @t @x @m\n\ninstance A [] where\n  f = defaultF @[]\n</code></pre>\n\n<p>Now, in the last line the type variable <code>x</code> is not in scope since we do not have an explicit <code>forall x</code>. Even if it were, it is not passed to <code>defaultF</code> as an explicit type argument. So, the last <code>defaultF</code> call could be made on any monoid at all, possibly another one!</p>\n\n<p>For that call, the inference engine generates a fresh <code>x0</code> type variable, hence the type error message :-(</p>\n\n<p>Maybe GHC's instance deriving mechanism should be updated, now that ambiguous types are allowed (which is a good thing, IMO).</p>\n\n<p>For a simpler case, consider</p>\n\n<pre><code>a :: forall x. Monoid x =&gt; Int\na = undefined\n\nb :: forall x. Monoid x =&gt; Int\nb = a\n</code></pre>\n\n<p>The last call <em>needs</em> a disambiguating explicit type argument, in Haskell. It would work fine in dependently typed languages like Agda/Idris/Coq/... since these (by default, at least) pass their type arguments explicitly.</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506019225, "creation_date": 1506018313, "question_id": 46350839, "link": "https://stackoverflow.com/questions/46350839/compilation-error-with-a-class-constraint-on-a-phantom-type-in-a-default-method", "title": "Compilation error with a class constraint on a phantom type in a default method", "body": "<p>This (somewhat nonsensical) module compiles:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE ExplicitForAll #-}\n\nmodule Foo where\n\nclass A t where\n  f :: forall x m. Monoid x =&gt; t m -&gt; m\n  f = undefined\n\ninstance A [] where\n  f = undefined\n</code></pre>\n\n<p>If I remove the instance's definition of <code>f</code>, I would expect it to inherit the method default and amount to the same thing.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE ExplicitForAll #-}\n\nmodule Foo where\n\nclass A t where\n  f :: forall x m. Monoid x =&gt; t m -&gt; m\n  f = undefined\n\ninstance A [] where\n</code></pre>\n\n<p>This does not work, however. GHC 8.0.2 gives this error:</p>\n\n<pre><code>\u2022 Could not deduce (Monoid x0)\n    arising from a use of \u2018Foo.$dmf\u2019\n  from the context: Monoid x\n    bound by the type signature for:\n               f :: Monoid x =&gt; [m] -&gt; m\n    at src/Foo.hs:10:10-13\n  The type variable \u2018x0\u2019 is ambiguous\n  These potential instances exist:\n    instance Monoid a =&gt; Monoid (IO a) -- Defined in \u2018GHC.Base\u2019\n    instance Monoid Ordering -- Defined in \u2018GHC.Base\u2019\n    instance Monoid a =&gt; Monoid (Maybe a) -- Defined in \u2018GHC.Base\u2019\n    ...plus 7 others\n    (use -fprint-potential-instances to see them all)\n\u2022 In the expression: Foo.$dmf @[]\n  In an equation for \u2018f\u2019: f = Foo.$dmf @[]\n  In the instance declaration for \u2018A []\u2019\n</code></pre>\n\n<p>I'm not sure how to read this error, because I don't know where the imaginary <code>x0</code> is being inserted. Why doesn't the second example compile?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506011970, "post_id": 46348867, "comment_id": 79658441, "body": "I don&#39;t think a function <code>f</code> is useful, but maybe you are just looking for an equality constraint: <code>a ~ (b,c) =&gt; ... Proxy a ...</code>? More information on your use case would definitely help!"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506012241, "post_id": 46348867, "comment_id": 79658587, "body": "Hmmm I didn&#39;t think about a constraint like that, it might work with what I&#39;m trying, I&#39;ll give it a shot. I&#39;m happy to give more information, I have a recursive function that is piecing together functions based on proxy types, and need to handle the case where an input type is a tuple. I can identify that case, but since everything is polymorphic, I can&#39;t just cast things to a specific type to then pull out the <code>(b,c)</code>. I can&#39;t go into too much detail, but let me know if that&#39;s not clear."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506012450, "post_id": 46348867, "comment_id": 79658695, "body": "If you aren&#39;t certain at compile time that you&#39;ll have a tuple, you&#39;ll probably want overlapping classes instead. Otherwise, the equality constraint should do it."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506013539, "post_id": 46348867, "comment_id": 79659308, "body": "Everything happens inside of <code>MonadPlus</code> to allow for backtracking if you don&#39;t get a tuple, I have other cases to handle the other portions. Inside of the tuple portion, I&#39;m certain it&#39;s a tuple, but I&#39;m having trouble convincing the compiler to allow me to break <code>Proxy a</code> into <code>Proxy (b,c)</code> since <code>b</code> and <code>c</code> are unknown types. The equality constraints works on it&#39;s own, but it won&#39;t compile at a call site. Is there a way for me to use that kind of constraint to do something like <code>a ~ (b,c) =&gt; a -&gt; Maybe (b,c)</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1506013618, "post_id": 46348867, "comment_id": 79659348, "body": "How does the tuple portion detect that it&#39;s a tuple? That seems to be the key."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506013838, "post_id": 46348867, "comment_id": 79659471, "body": "Extremely hacky typeRep comparisons. I don&#39;t like how it happens right now, but it works for the detection. We can do <code>Proxy a -&gt; TypeRep</code> and do comparisons at the <code>TypeRep</code> level. But we can&#39;t get back from <code>TypeRep -&gt; Proxy a</code>. I started to look at the <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow noreferrer\">reflection</a> library, but that doesn&#39;t seem to do what I need."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1506014055, "post_id": 46348867, "comment_id": 79659602, "body": "Now I&#39;m getting really curious. Do you have any of this on Github by any chance? You could be looking for <a href=\"https://downloads.haskell.org/~ghc/master/libraries/html/base/Type-Reflection.html#v:withTypeable\" rel=\"nofollow noreferrer\"><code>withTypeable :: forall a r. TypeRep a -&gt; (Typeable a =&gt; r) -&gt; r</code></a> in the new <code>Type.Reflection</code> module."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506014314, "post_id": 46348867, "comment_id": 79659743, "body": "None of this code unfortunately, it&#39;s all proprietary right now. My coworker gave a talk about this idea at lambdaconf this last year, but the video&#39;s aren&#39;t online yet either. That function might be what I need, I hadn&#39;t run across that module yet."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1506028316, "post_id": 46348867, "comment_id": 79666582, "body": "Seconding @Alec: you want the new <code>Typeable</code> stuff that gives you type-level witnesses of the term-level information in the <code>TypeRep</code>. Or, if you absolutely can&#39;t use a new GHC, emulate it yourself with a hand implementation of (a clone of) the <code>Typeable</code> class."}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1506022058, "post_id": 46351643, "comment_id": 79663761, "body": "Correct me if I&#39;m wrong, but the problem with this is you have to provide the <code>(b,c)</code> that you want to extract don&#39;t you?"}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1506023084, "post_id": 46351643, "comment_id": 79664280, "body": "I&#39;m not sure I entirely understand what you&#39;re asking, but this function doesn&#39;t depend on any specific <code>b</code>, <code>c</code>. Given you can provide a <code>Refl :: a :~: (b, c)</code> value, and you use the values <code>x :: b</code> and <code>y :: c</code> in a non-ambiguous context (say as non-parametric arguments to a function) then I believe GHC should be able to infer the types. Again, difficult to answer without more context or a code example."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1506023459, "post_id": 46351643, "comment_id": 79664466, "body": "I won&#39;t have values for <code>x</code> or <code>y</code>, just proxies, and I don&#39;t know what they will be (so a partially ambiguous context). I need to take my <code>Proxy a</code>, and, knowing <code>a</code> is really a tuple of <code>(b,c)</code>, split it into two proxies <code>Proxy b</code> and <code>Proxy c</code>."}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1506027482, "post_id": 46351643, "comment_id": 79666220, "body": "Ahh, I see. I think my answer has missed the point of your question then. I&#39;m not sure how you can know that <code>a ~ (b, c)</code> without knowing what <code>b</code>, <code>c</code> are. Or furthermore, what good is a <code>Proxy b</code> without knowing, or being able to infer, a concrete type for <code>b</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1506027644, "post_id": 46351643, "comment_id": 79666291, "body": "Maybe a little bit, I&#39;ll look more into <code>Data.Type.Equality</code> and see if it contains any answers to help me out further. If you have suggestions on how to improve the clarity of my question, I&#39;m happy to apply or accept edits! I can know that <code>a ~ (b,c)</code> by casting the proxies to typereps and comparing the type constructors. Once I get there though, I can&#39;t get back to generate new proxies. <code>Proxy b</code> is useful in my situation since I can use it as a selector for other recursive function calls moving on in my application. It doesn&#39;t have to be a rigid type for me to know how to use it."}], "tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 0, "last_activity_date": 1506021513, "creation_date": 1506021513, "answer_id": 46351643, "question_id": 46348867, "link": "https://stackoverflow.com/questions/46348867/how-can-you-extract-type-information-from-a-proxy/46351643#46351643", "title": "How can you extract type information from a Proxy?", "body": "<p>This seems easy enough to write, given the limited context available from your question. As long as you can provide a concrete proof of your claim that <code>a ~ (b, c)</code>, you just need a bit of <code>Data.Type.Equality</code> machinery to convince GHC.</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeOperators #-}\n\nimport Data.Proxy\nimport Data.Type.Equality\n\nsplitProxyTuple :: a :~: (b, c) -&gt; Proxy a -&gt; Proxy (b, c)\nsplitProxyTuple Refl = castWith Refl\n</code></pre>\n\n<p>and using it in a GHCI session</p>\n\n<pre><code>&gt; type T = (Int, Char)\n&gt; type F = (Int, Bool)\n&gt; let prf = Refl :: (T :~: (Int, Char))\n&gt; let prx = Proxy :: Proxy T\n\n&gt; :t splitProxyTuple prf prx\nsplitProxyTuple prf prx :: Proxy (Int, Char)\n=&gt; Proxy\n\n&gt; :t splitProxyTuple prf (Proxy :: Proxy F)\n  \u2022 Couldn't match type \u2018Bool\u2019 with \u2018Char\u2019\n    Expected type: Proxy T\n      Actual type: Proxy F\n  \u2022 In the second argument of \u2018splitProxyTuple\u2019, namely\n      \u2018(Proxy :: Proxy F)\u2019\n    In the expression: splitProxyTuple prf (Proxy :: Proxy F)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1515773509, "post_id": 48197663, "comment_id": 83442125, "body": "So I&#39;ve been trying to use your example, but I&#39;m running into issues actually using the underlying typereps. In your <code>tupleLength</code>, you just return an int and ignore the types <code>a</code> and <code>b</code>. Overall, I&#39;m trying to create a function that can take the arbitrary <code>TypeRep</code> (I wrote this question before knowing about Type.Reflection in GHC 8.2, that&#39;s why it asks with <code>Proxy</code>) and return the underlying typereps. I.e. <code>TypeRep a -&gt; Maybe (TypeRep b, TypeRep c)</code>. I can get things to work with specific, concrete types like <code>@(Int,Char)</code> but not polymorphic types. Any thoughts?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1515779270, "post_id": 48197663, "comment_id": 83445233, "body": "The fact that I return an <code>Int</code> eventually is essential.  It is required to eliminate the existential type variables somehow.  We don&#39;t have to <i>ignore</i> them altogether like <code>tupleLength</code> does, but they can&#39;t be part of the return type, because that would make it impossible to give <code>example</code> a type that Haskell supports (since it does not support first-class existentials). At best, we can wrap them up in another existential data type (like <code>ProxyTupleEx</code>)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1515779396, "post_id": 48197663, "comment_id": 83445309, "body": "FWIW the signature <code>TypeRep a -&gt; Maybe (TypeRep b, TypeRep c)</code> is not correct for what you are looking for.  This signature says that the <i>caller</i> chooses <code>b</code> and <code>c</code>, but you want the them rather to be chosen by the <i>callee</i>.  That&#39;s why all this existential stuff is coming up."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1515781696, "post_id": 48197663, "comment_id": 83446422, "body": "I think the caller/callee distinction is really what&#39;s giving me trouble. In my program, I need to split a given typerep into its components, and then pass those components as arguments to other functions. I still feel like it&#39;s possible, but getting all of the types to line up is tricky."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1515699338, "last_edit_date": 1515699338, "creation_date": 1515626376, "answer_id": 48197663, "question_id": 46348867, "link": "https://stackoverflow.com/questions/46348867/how-can-you-extract-type-information-from-a-proxy/48197663#48197663", "title": "How can you extract type information from a Proxy?", "body": "<p>I've been trying to see what you're after and can't quite, it would be helpful if you could produce a more complete example that represents your problem.</p>\n\n<p>Until then, I seem to have an answer for this part of your question</p>\n\n<blockquote>\n  <p>The main thing stopping me is that I don't know what the types <code>b</code> or <code>c</code> are going to be...</p>\n</blockquote>\n\n<p>From that sentence it sounds like you need an existential:</p>\n\n<pre><code>proxyTuple :: Proxy a -&gt; exists b c. Proxy (b,c)\n</code></pre>\n\n<p>which is not valid Haskell, but we can encode it easily:</p>\n\n<pre><code>data ProxyTupleEx where\n    ProxyTupleEx :: Proxy (b,c) -&gt; ProxyTupleEx\n</code></pre>\n\n<p>It's not quite enough though, because we could easily implement this function in a trivial way.</p>\n\n<pre><code>proxyTuple :: Proxy a -&gt; ProxyTupleEx\nproxyTuple _ = ProxyTupleEx (Proxy :: Proxy ((), ()))\n</code></pre>\n\n<p>We need to also specify the connection with the incoming <code>a</code>.  This we can do:</p>\n\n<pre><code>data ProxyTupleEx a where\n    ProxyTupleEx :: (a ~ (b,c)) =&gt; Proxy (b,c) -&gt; ProxyTupleEx a\n</code></pre>\n\n<p>We won't be able to implement <code>proxyTuple</code> now, because it has no implementation when <code>a</code> is not a tuple.  We need</p>\n\n<pre><code>proxyTuple :: Proxy a -&gt; Maybe (ProxyTupleEx a)\n</code></pre>\n\n<p>giving it the opportunity to fail.</p>\n\n<p>Now we get to your <a href=\"https://stackoverflow.com/questions/48158787/how-can-you-decompose-compose-types-using-the-type-reflection-library\">other question about reflection</a>.  We need to add a <code>Typeable</code> constraint so that we can reflect about the type, but then it is fairly straightforward once you are used to the cadence of the library:</p>\n\n<pre><code>proxyTuple :: Typeable a =&gt; Proxy a -&gt; Maybe (ProxyTupleEx a)\nproxyTuple p\n    | App _proxy (App (App tuple a) b) &lt;- typeOf p\n    , Just HRefl &lt;- eqTypeRep tuple (typeRep :: TypeRep (,))\n    = Just (ProxyTupleEx p)\n    | otherwise\n    = Nothing\n</code></pre>\n\n<p>Now if you pattern match on a <code>ProxyTupleEx a</code>, the compiler will know that <code>a</code> is actually a tuple.</p>\n\n<pre><code>tupleLength :: (a,b) -&gt; Int\ntupleLength _ = 2\n\nexample :: Typeable a =&gt; Proxy a -&gt; a -&gt; Int\nexample proxy x\n    | Just (ProxyTupleEx _) &lt;- proxyTuple proxy = tupleLength x\n                                                  -- x is now known to be a tuple\n                                                  -- so this typechecks\n    | otherwise = 0\n</code></pre>\n\n<p>Like magic, this typechecks, and works:</p>\n\n<pre><code>ghci&gt; example Proxy (1,2)\n2\nghci&gt; example Proxy 0\n0\n</code></pre>\n\n<p>(Also the <code>Proxy</code> here is unnecessary since we already have the type of <code>a</code>, but I included it for consistency with the query.)</p>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 48197663, "answer_count": 2, "score": 2, "last_activity_date": 1515699338, "creation_date": 1506011173, "question_id": 46348867, "link": "https://stackoverflow.com/questions/46348867/how-can-you-extract-type-information-from-a-proxy", "title": "How can you extract type information from a Proxy?", "body": "<p>Let's say I have a standard <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Proxy.html\" rel=\"nofollow noreferrer\">proxy</a> with some type <code>a</code> hidden inside:</p>\n\n<pre><code>pxyA = Proxy :: Proxy a\n</code></pre>\n\n<p>Because of other parts of my program, I know for a fact that <code>a</code> is actually a tuple of two other types, say <code>(b,c)</code>. Is there any way for me to extract that information from my original proxy with a function like: </p>\n\n<pre><code>f :: Proxy a -&gt; (Proxy b, Proxy c)\n</code></pre>\n\n<p>or  </p>\n\n<pre><code>f :: Proxy a -&gt; Proxy (b,c)\n</code></pre>\n\n<p>The main thing stopping me is that I don't know what the types <code>b</code> or <code>c</code> are going to be, just that I need to pass them to other parts of my program. </p>\n\n<p>I've already written a trivial function with a similar form: </p>\n\n<pre><code>splitPxyTup :: forall a b . Proxy (a,b) -&gt; (Proxy a, Proxy b)\nsplitPxyTup _ = (Proxy :: Proxy a, Proxy :: Proxy b)\n</code></pre>\n\n<p>but keep getting lost on how to convince the type system that my original proxy actually is a tuple type. </p>\n\n<p>I also thought about using a <code>cast</code>, but since I don't know what the output types are, I won't be able to get anything meaningful from it.</p>\n"}, {"tags": ["haskell", "types", "typeclass", "newtype"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 5, "creation_date": 1506009914, "post_id": 46348426, "comment_id": 79657301, "body": "Could you provide an example of how you intend to use this? And/or maybe provide a second instance to make the redundancy clear? More descriptive names could be helpful as well. Could <code>Foo</code> be a <code>Functor</code>/<code>Applicative</code> to use something like <code>f &lt;$&gt; B a &lt;*&gt; B b</code>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1506011285, "post_id": 46348426, "comment_id": 79658071, "body": "That <code>Bar</code> typeclass looks like a <code>Semigroup</code>. If the binary operation also has identity, it could be a <code>Monoid</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1506040287, "post_id": 46348426, "comment_id": 79670133, "body": "Can you skip the newtype and typeclass entirely and just pass around <code>(+)</code> (or whatever other functions you want)?"}, {"owner": {"reputation": 269, "user_id": 2292384, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/11df8ed336e14bc9a6e7cc9eb67d3afe?s=128&d=identicon&r=PG", "display_name": "plan", "link": "https://stackoverflow.com/users/2292384/plan"}, "edited": false, "score": 0, "creation_date": 1506085872, "post_id": 46348426, "comment_id": 79690720, "body": "I provided an example of how I intend to use it! I am short of time at the moment and will try to clarify more later, in the meantime thanks for all the replies! I will need some time to answer in a meaningful way if I could skip the typeclass, monoid properties etc."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1506013666, "last_edit_date": 1506013666, "creation_date": 1506012910, "answer_id": 46349326, "question_id": 46348426, "link": "https://stackoverflow.com/questions/46348426/creating-many-similar-newtypes-typeclass-instances-in-haskell/46349326#46349326", "title": "Creating many similar newtypes/typeclass instances in Haskell", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/reflection-2.1.2/docs/Data-Reflection.html\" rel=\"nofollow noreferrer\">reflection</a>.  This is a fairly advanced technique, and there may be better ways to solve your problem, but the way you have stated it it seems like this is what you're looking for.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, RankNTypes, ScopedTypeVariables, UndecidableInstances #-}\n\nimport Data.Reflection\nimport Data.Proxy\n\nclass Bar k where\n    baz :: k -&gt; k -&gt; k\n\nnewtype Foo f i = B i       -- f is a type level representation of your function\n   deriving (Eq, Ord, Show)\n\ninstance (Num k, Reifies f (k -&gt; k -&gt; k)) =&gt; Bar (Foo f k) where\n    baz (B a) (B b) = B (reflect (Proxy :: Proxy f) a b)\n\nmkFoo :: forall i r. (i -&gt; i -&gt; i) -&gt; i\n      -&gt; (forall f. Reifies f (i -&gt; i -&gt; i) =&gt; Foo f i -&gt; r) -&gt; r\nmkFoo f x c = reify f (\\(p :: Proxy f) -&gt; c (B x :: Foo f i))\n\nmain = do\n    mkFoo (+) 5 $ \\foo1 -&gt; do\n    print $ foo1 `baz` B 5  -- 10\n\n    mkFoo (*) 5 $ \\foo2 -&gt; do\n    print $ foo2 `baz` B 5  -- 25\n\n    print $ foo1 `baz` foo2 -- type error\n</code></pre>\n\n<p>There is a lot going on here, so a few notes.  </p>\n\n<pre><code>Reifies f (k -&gt; k -&gt; k)\n</code></pre>\n\n<p>is a constraint that means that <code>f</code> is a type-level representation of a function of type <code>k -&gt; k -&gt; k</code>.  When we <code>reflect (Proxy :: Proxy f)</code> (a fancy way of passing the type <code>f</code> to <code>reflect</code> since explicit type application was not until recently allowed), we get the function itself back out.</p>\n\n<p>Now to the nasty signature of <code>mkFoo</code></p>\n\n<pre><code>mkFoo :: forall i r. (i -&gt; i -&gt; i) -&gt; i\n      -&gt; (forall f. Reifies f (i -&gt; i -&gt; i) =&gt; Foo f i -&gt; r) -&gt; r\n</code></pre>\n\n<p>The first <code>forall</code> is there for <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\"><code>ScopedTypeVariables</code></a>, so we can refer to the type variables within the body of the function.  The second one is a genuine <a href=\"https://wiki.haskell.org/Rank-N_types\" rel=\"nofollow noreferrer\">rank-2 type</a>, </p>\n\n<pre><code>(forall f. Reifies f (i -&gt; i -&gt; i) =&gt; Foo f i -&gt; r) -&gt; r\n</code></pre>\n\n<p>and it is a common encoding of an existential type, since Haskell doesn't have first class existentials.  You can read this type as</p>\n\n<pre><code>exists f. ( Reifies f (i -&gt; i -&gt; i) , Foo f i )\n</code></pre>\n\n<p>or some such&mdash;it <em>returns a type</em> <code>f</code> together with evidence that <code>f</code> is a type-level representation of a function <code>i -&gt; i -&gt; i</code>, and a <code>Foo f i</code>.  Observe in <code>main</code> that to use this \"existential\", we call the function with continuation passing style, that is</p>\n\n<pre><code>mkFoo (+) 5 $ \\foo -&gt; -- what to do with foo\n</code></pre>\n\n<p>Within the function, <code>foo</code> behaves like it has type <code>Foo f0 Integer</code> where <code>f0</code> is a brand new type made just for this function.</p>\n\n<p>It's quite nice that it won't let us <code>baz</code> together <code>Foo</code>s from different <code>f</code>s, but unfortunately it's not smart enough to allow us to <code>baz</code> together <code>Foo</code>s made with the same function using different calls to <code>mkFoo</code>, so:</p>\n\n<pre><code>mkFoo (+) 5 $ \\foo1 -&gt; mkFoo (+) 5 $ \\foo2 -&gt; foo1 `baz` foo2  -- type error\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 1, "last_activity_date": 1506071714, "last_edit_date": 1506071714, "creation_date": 1506013880, "answer_id": 46349599, "question_id": 46348426, "link": "https://stackoverflow.com/questions/46348426/creating-many-similar-newtypes-typeclass-instances-in-haskell/46349599#46349599", "title": "Creating many similar newtypes/typeclass instances in Haskell", "body": "<p>This is actually not that different to the answer by luqui, but instead of defining the mapping from an phantom type <code>f</code> to a concrete function at runtime using <code>reify</code> we do this at compile time. This makes the code a bit simpler and easier to use.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nclass Bar k where\n  baz :: k -&gt; k -&gt; k\n\n-- Foo has now another phantom type variable, that we use to pick the \n-- desired f.\nnewtype Foo f k = B k\n\n-- | GetF is used to retrieve a function for a given type label.\nclass GetF f k where\n  appF :: Foo f k -&gt; Foo f k -&gt; Foo f k\n\n-- Now we can make an instance for Bar if we have an instance for GetF\ninstance GetF f k =&gt; Bar (Foo f k) where\n  baz x y = appF x y\n\n\n-- = Usage example\n\n-- | Add is just a label. We never use it at value level.\ndata Add\n\ninstance Num k =&gt; GetF Add k where\n  appF (B x) (B y) = B (x + y)\n\nexample :: Foo Add Int\nexample = B 1 `baz` B 2 -- = B 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1506024541, "last_edit_date": 1506024541, "creation_date": 1506014754, "answer_id": 46349847, "question_id": 46348426, "link": "https://stackoverflow.com/questions/46348426/creating-many-similar-newtypes-typeclass-instances-in-haskell/46349847#46349847", "title": "Creating many similar newtypes/typeclass instances in Haskell", "body": "<p>This is a supplement to my other answer, the solution I would actually suggest if your intention is to solve the practical problem rather than explore what is possible. It just converts the typeclass to \"dictionary passing style\", and doesn't use any fancy extensions or anything.</p>\n\n<pre><code>data Bar k = Bar { baz :: k -&gt; k -&gt; k }\n\nnewtype Foo i = B i\n\nfooBar :: (i -&gt; i -&gt; i) -&gt; Bar (Foo i)\nfooBar f = Bar { baz = \\(B x) (B y) -&gt; B (f x y) }\n</code></pre>\n\n<p>Then when you have a function that uses this, pass it a <code>Bar</code> dictionary:</p>\n\n<pre><code>doThingsWithFoos :: Bar (Foo Int) -&gt; Foo Int -&gt; Foo Int -&gt; Foo Int\ndoThingsWithFoos bar a b = baz bar a (baz bar a b)\n</code></pre>\n\n<p>It's a bit more verbose to use, but this kind of solution is remarkably flexible.  Dictionaries are completely first-class, so, for example, you can start doing higher level manipulations on the dictionaries themselves:</p>\n\n<pre><code>transportBar :: (a -&gt; b) -&gt; (b -&gt; a) -&gt; Bar a -&gt; Bar b\ntransportBar f finv bar = Bar { baz = \\x y -&gt; f (baz bar (finv x) (finv y)) }\n\nsumBar :: (Num a) =&gt; Bar a -&gt; Bar a -&gt; Bar a\nsumBar bar1 bar2 = Bar { baz = \\x y -&gt; baz bar1 x y + baz bar2 x y }\n</code></pre>\n\n<p>Both of these transformations would be a major pain using typeclasses.</p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1506085638, "creation_date": 1506085638, "answer_id": 46365582, "question_id": 46348426, "link": "https://stackoverflow.com/questions/46348426/creating-many-similar-newtypes-typeclass-instances-in-haskell/46365582#46365582", "title": "Creating many similar newtypes/typeclass instances in Haskell", "body": "<p>Given that <code>f</code> only depends on <code>k</code>, you could define another class which would pack such a function like so:</p>\n\n<pre><code>newtype Foo i = B i deriving (Eq, Ord, Show)\n\nclass PreBar k where\n  preBar :: k -&gt; k -&gt; k\n\nclass Bar k where\n  baz :: k -&gt; k -&gt; k\n\ninstance (Num k, PreBar k) =&gt; Bar (Foo k) where\n    baz (B a) (B b) = B (preBar a b)\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 2292384, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/11df8ed336e14bc9a6e7cc9eb67d3afe?s=128&d=identicon&r=PG", "display_name": "plan", "link": "https://stackoverflow.com/users/2292384/plan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 1, "answer_count": 4, "score": 3, "last_activity_date": 1506085776, "creation_date": 1506009539, "last_edit_date": 1506085776, "question_id": 46348426, "link": "https://stackoverflow.com/questions/46348426/creating-many-similar-newtypes-typeclass-instances-in-haskell", "title": "Creating many similar newtypes/typeclass instances in Haskell", "body": "<p>I am a beginner in Haskell and trying to learn about typeclasses and types. I have the following example (which represents a real problem in algebra that I am working on), in which I define a type which just wraps Num instances, and a typeclass which defines a binary operation <code>baz</code>. </p>\n\n<pre><code>newtype Foo i = B i deriving (Eq, Ord, Show)\n\nclass Bar k where\n    baz :: k -&gt; k -&gt; k\n\ninstance Num k =&gt; Bar (Foo k) where\n    baz (B a) (B b) = B (f a b)\n\nf :: Num a =&gt; a -&gt; a -&gt; a\nf a b = a + b\n</code></pre>\n\n<p>When defining <code>Bar</code> to be an instance of this, I realize that I want to be able to \"vary\" the function <code>f</code> with the type. To be clear: I want to supply a function <code>f :: Num a =&gt; a -&gt; a -&gt; a</code> and get back a new type <code>Foo</code> which is an instance of <code>Bar</code>. Say that I want to do this 5, 10 times with the only difference being different functions <code>f</code>. I can of course copy and paste the code above, but I wonder if there is another way?</p>\n\n<p>It seems to me that I'm confusing things. What is the best way of doing something like this in Haskell? Is this a good choice of design, what am I thinking right/wrong and why?</p>\n\n<p>EDIT: I realize that a concrete example might help to make the question clearer (beware that it may seem complicated, I was not able to simplify the code more than this. The question above contains the same information I think): the typeclass I am interested in is <code>Algebra k v</code> from the library <a href=\"https://hackage.haskell.org/package/HaskellForMaths\" rel=\"nofollow noreferrer\">HaskellForMaths</a>:</p>\n\n<pre><code>class Algebra k b where\n    unit :: k -&gt; Vect k b\n    mult :: Vect k (Tensor b b) -&gt; Vect k b\n</code></pre>\n\n<p>Here <code>k</code> is a field (a mathematical structure such as the real or complex numbers), while <code>v</code> is a choice of basis in a vector space. I would want to use it something like this</p>\n\n<pre><code>newtype Basis i = T i deriving (Eq, Ord, Show)\n\ntype Expression k = Vect k (Basis Int)\n\ninstance Algebra k Basis where\n    unit x = x *&gt; return I\n    mult = linear mult'\n           where mult' (T x ,T y) = comm x y\n           where comm a b = sum $ map (\\c -&gt; structure a b c *&gt; t c) [0..n]\n\nt :: Int -&gt; Expression k\nt a = return (T a)\n</code></pre>\n\n<p>and then vary the map <code>structure</code> as I please. Here the type <code>T</code> is just a convenient way of writing abstract basis elements <code>T 1, T 2, ...</code>. The reason I want to do it is the standard mathematical definition of an algebra in terms of its <em>structure constants</em> (here: <code>structure</code>). To summarize: I want to be able to vary the function <code>f</code> (preferably not at compile time?) and get back an algebra. This may be a bad design decision: if so, why?</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1506001572, "post_id": 46345002, "comment_id": 79651389, "body": "By the way the source can be found in base. <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Text-ParserCombinators-ReadP.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1506002099, "post_id": 46345002, "comment_id": 79651789, "body": "I can&#39;t reproduce the non-termination. <code>readP_to_S (fmap Just (munch1 (== &#39;c&#39;)) +++ return Nothing) &quot;c&quot;</code> produces <code>[(Nothing,&quot;c&quot;),(Just &quot;c&quot;,&quot;&quot;)]</code>."}, {"owner": {"reputation": 829, "user_id": 6717054, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/72a7bcb06a087a25530bcbab56c2024f?s=128&d=identicon&r=PG", "display_name": "ritchie46", "link": "https://stackoverflow.com/users/6717054/ritchie46"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1506002446, "post_id": 46345002, "comment_id": 79652046, "body": "Hmm.. I see in your small example that it doesnt choose but just returns both results. In the large file I&#39;m parsing however nothing happens."}], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 5, "last_activity_date": 1506002446, "creation_date": 1506002446, "answer_id": 46346000, "question_id": 46345002, "link": "https://stackoverflow.com/questions/46345002/what-does-the-operator-do-in-text-parsercombinators-readp-haskell/46346000#46346000", "title": "What does the (+++) operator do in Text.ParserCombinators.ReadP (Haskell)", "body": "<p>The <code>+++</code> operator can backtrack to give you both results when either\npossibility can work.  Here's a simple example:</p>\n\n<pre><code>&gt; readP_to_S (many (string \"aa\" +++ string \"a\") &lt;* eof) \"aaa\"\n[([\"aa\",\"a\"],\"\"),([\"a\",\"aa\"],\"\"),([\"a\",\"a\",\"a\"],\"\")]\n</code></pre>\n\n<p>If you used <code>&lt;++</code> here you would only get the first result.</p>\n\n<p>Your example could also work fine in some circumstances, allowing two\npossibilities (with different amounts of input left over):</p>\n\n<pre><code>&gt; readP_to_S (fmap Just (munch1 (=='a')) +++ return Nothing) \"aaa\"\n[(Nothing,\"aaa\"),(Just \"aaa\",\"\")]\n</code></pre>\n\n<p>My guess is that you are using it in some context where it's possible\nfor it to keep choosing <code>return Nothing</code> repeatedly, like inside a\n<code>many</code> or a recursion.  Since this doesn't consume any characters it\nmight be trying to produce a parse which involves choosing \"return\nNothing\" repeatedly forever and never getting any further through the\ninput.</p>\n\n<p>Alternatively it could be producing an infinite number of parses, for\nexample one where it uses <code>return Nothing</code> once, another where it uses\nit twice, and so on.  Although in this case it would usually be happy\nto start printing the infinite list of parses, so you'd probably know\nabout it.</p>\n"}], "owner": {"reputation": 829, "user_id": 6717054, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/72a7bcb06a087a25530bcbab56c2024f?s=128&d=identicon&r=PG", "display_name": "ritchie46", "link": "https://stackoverflow.com/users/6717054/ritchie46"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1024, "favorite_count": 0, "accepted_answer_id": 46346000, "answer_count": 1, "score": 0, "last_activity_date": 1506002446, "creation_date": 1505999860, "question_id": 46345002, "link": "https://stackoverflow.com/questions/46345002/what-does-the-operator-do-in-text-parsercombinators-readp-haskell", "title": "What does the (+++) operator do in Text.ParserCombinators.ReadP (Haskell)", "body": "<p>I am having trouble with the symmetric choice (+++) operator in the ReadP package.</p>\n\n<p><a href=\"https://www.haskell.org/cabal/release/cabal-1.22.8.0/doc/API/Cabal/Distribution-Compat-ReadP.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/cabal/release/cabal-1.22.8.0/doc/API/Cabal/Distribution-Compat-ReadP.html</a></p>\n\n<p>As I cannot find many examples of the ReadP lib on the internet I've just been trying some things.</p>\n\n<p>I noticed that the biased choice works as expected. Favoring parsing the left and if it fails choose the right parser.</p>\n\n<p><code>fmap Just (munch1 dianaFloat) &lt;++ return Nothing</code> </p>\n\n<p>If I insert the symmetric choice operator. The algorithm doesn't finish.</p>\n\n<p><code>fmap Just (munch1 dianaFloat) +++ return Nothing</code> </p>\n\n<p>If I let the lefthand fail they both yield the same result:</p>\n\n<p><code>fpail) &lt;++ return Nothing</code> </p>\n\n<p>==</p>\n\n<p><code>fpail) +++ return Nothing</code></p>\n\n<p>So my question is, what use is the (+++) operator, as it doesn't seem to finish when both succeed in parsing.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1506004432, "post_id": 46344980, "comment_id": 79653587, "body": "<code>unordered-containers</code> can&#39;t define such a synonym either!"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1506001380, "creation_date": 1506001380, "answer_id": 46345582, "question_id": 46344980, "link": "https://stackoverflow.com/questions/46344980/map-over-patternsynonyms-args-before-matching-w-viewpatterns/46345582#46345582", "title": "Map over PatternSynonyms args before matching w/ ViewPatterns?", "body": "<p>Does <code>Tags</code> really need to be a pattern? What's wrong with simply providing a function:</p>\n\n<pre><code>toLabel :: [Tags] -&gt; Label\n</code></pre>\n\n<p>and have users use guards:</p>\n\n<pre><code>someFunction lab | lab == toLabel [TagFoo, TagBar \"bar\"] = ...\n</code></pre>\n"}], "owner": {"reputation": 20695, "user_id": 434799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/I8S9d.jpg?s=128&g=1", "display_name": "Xion", "link": "https://stackoverflow.com/users/434799/xion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506001380, "creation_date": 1505999797, "question_id": 46344980, "link": "https://stackoverflow.com/questions/46344980/map-over-patternsynonyms-args-before-matching-w-viewpatterns", "title": "Map over PatternSynonyms args before matching w/ ViewPatterns?", "body": "<p>I was recently trying to refactor an ADT -- where the number of constructors has grown combinatorically -- into a backwards-compatible set representation:</p>\n\n<pre><code>data Tag = TagFoo | TagBar !Text | TagBaz !Int ... -- many more\n           deriving (Eq, Generic, Ord, Show)\n\nnewtype Label = Label (HashSet Tag)\n                deriving (Eq, Generic, Show)\n</code></pre>\n\n<p>To this end, I defined several pattern synonyms to the effect of:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE PatternSynonyms #-}\n{-# LANGUAGE ViewPatterns #-}\n\npattern Foo :: Label\npattern Foo &lt;- Tags [TagFoo] where\n  Foo = Label $ HashSet.singleton TagFoo\n\n-- (let's say a lone TagBar is invalid)\n\npattern FooWithBar :: Text -&gt; Label\npattern FooWithBar b &lt;- Tags [TagFoo, TagBar b] where\n   FooWithBar b = Label $ HashSet.fromList [TagFoo, TagBar b]\n</code></pre>\n\n<p>with <code>Tags</code> pattern defined as:</p>\n\n<pre><code> pattern Tags :: [Tag] -&gt; Label\n pattern Tags ts &lt;- ((\\(Label ts') -&gt; sort $ HashSet.toList ts') -&gt; ts)\n</code></pre>\n\n<p>Unfortunately, this form is error prone, as it requires users to provide the <code>[Tag]</code> list in the correct <code>Ord</code>er. Otherwise, a pattern like <code>Tags [TagBar \"x\", TagFoo]</code> won't match <code>Label $ HashSet.fromList [TagBar \"x\", TagFoo]</code>. (Not doing the <code>sort</code> is even worse, though, as then the order of tags would be arbitrary).</p>\n\n<p>Ideally, Haskell (or unordered-containers?) would provide a way to pattern-match elements of a <code>HashSet</code>s. But another way could be to map the <code>ts</code> argument of <code>Tags ts</code> pattern through <code>HashSet.fromList</code> and then compare the resulting sets:</p>\n\n<pre><code>pattern Tags ts &lt;- ((\\(Label ts') -&gt; ts' == HashSet.fromList ts) -&gt; True)\n</code></pre>\n\n<p>This is impossible, however, because arguments of a pattern synonym cannot be used by a view pattern function. But trying to do the transformation outside of the view function:</p>\n\n<pre><code>pattern Tags ts &lt;- ((\\(Label ts') -&gt; ts') -&gt; HashSet.fromList ts == ts')\n</code></pre>\n\n<p>is also impossible, since the part after <code>-&gt;</code> is a pattern and doesn't permit function application.</p>\n\n<p>Is there some other way of defining the pattern synonym that would allow this kind of matching?</p>\n"}, {"tags": ["haskell", "symbolic-math", "algebra"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505992121, "post_id": 46342046, "comment_id": 79644486, "body": "You don&#39;t really need the instance to know anything about commutativity, do you? Sounds like a law-thing that would normally just be expressed in documentation. (I know, this isn&#39;t elegant, but...) What you do need is the much uglier <code>Ord</code> constraint in oder to use <code>Map</code>."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505992244, "post_id": 46342046, "comment_id": 79644566, "body": "By representing a sum like <code>2 + 6 + 2</code> as a map I&#39;m loosing information about the order of the terms, so I do need the commutativity constraint I think. Maybe not in the <code>Semigroup</code> instance, but somewhere I would think..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1505992565, "post_id": 46342046, "comment_id": 79644801, "body": "Well, you basically just act <i>as if</i> it&#39;s commutative. Whether the key type really <i>is</i> commutative is another question. I agree that in principle this <i>should</i> be expressed by a dedicated class (basically an empty subclass of <code>Semigroup</code> that doesn&#39;t add any methods, only a law), but I&#39;m not sure if that&#39;s practical."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1506115887, "creation_date": 1506115887, "answer_id": 46373487, "question_id": 46342046, "link": "https://stackoverflow.com/questions/46342046/representing-commutative-semigroups-polynomials-in-haskell/46373487#46373487", "title": "Representing commutative semigroups polynomials in Haskell", "body": "<p>As @leftroundabout has commented, you don't <em>need</em> a constraint here.  Don't be fooled by the word \"constraint\".  In Haskell, the primary purpose of constraints isn't to constrain the behavior of a particular type or operation in some manner.  Rather, it's to constrain the set of types that a function will accept to those types that support a set of operations.</p>\n\n<p>When I write:</p>\n\n<pre><code>fmapTwice :: (Functor f) =&gt; (a -&gt; a) -&gt; f a -&gt; f a\nfmapTwice f = fmap (f . f)\n</code></pre>\n\n<p>I'm not really constraining the type <code>f</code> to act like a functor and obey the rules required of functors.  Rather, I'm constraining the <code>fmapTwice</code> function to only apply to types <code>f</code> that support the <code>fmap</code> operation.</p>\n\n<p>Nothing stops some jerk from writing:</p>\n\n<pre><code>data Foo a = Foo a | NoFoo deriving (Show)\ninstance Functor Foo where\n    fmap _ _ = NoFoo   -- invalid functor violates:  fmap id = id\n</code></pre>\n\n<p>and applying my function to this invalid functor:</p>\n\n<pre><code>&gt; fmapTwice (*2) (Foo 10)\nNoFoo\n&gt;\n</code></pre>\n\n<p>Haskell relies on programmer discipline to ensure that something declared as having a <code>Functor</code> instance is a well behaved functor.</p>\n\n<p>In your example, the instance:</p>\n\n<pre><code>import Data.Semigroup\nimport qualified Data.Map as Map\nimport Data.Map.Strict (Map)\n\ndata SemigroupPolynomial a = SP (Map a Integer) deriving (Show)\ninstance (Ord a) =&gt; Semigroup (SemigroupPolynomial a) where\n    (SP p0) &lt;&gt; (SP p1) = \n        SP $ Map.filter (0/=) $ Map.unionWith (+) p0 p1\n</code></pre>\n\n<p>doesn't require any constraints other than <code>Ord a</code>, to ensure that <code>a</code> can be used as a <code>Map</code> key.</p>\n\n<p>Now, it's up to you to make sure you only use your <code>SemigroupPolynomial</code> to represent commutative operations:</p>\n\n<pre><code>foldSP :: (a -&gt; a -&gt; a) -&gt; SemigroupPolynomial a -&gt; a\nfoldSP f (SP m) = foldr1 f $ concatMap (\\(a, n) -&gt; replicate (fromIntegral n) a)\n                                       (Map.assocs m)\n\nmain = do let sp = singleton 3 &lt;&gt; singleton 3 &lt;&gt; singleton 6\n          print sp\n          print $ foldSP (*) sp\n          print $ foldSP (+) sp\n          print $ foldSP (-) sp   -- wrong, but it's your own damn fault\n</code></pre>\n\n<p>If you want to somehow introduce a requirement of commutativity into your data type, one way of doing it (that doesn't involve Haskell \"constraints\" at all) is to write something like:</p>\n\n<pre><code>data CommutativeOp a = CO (a -&gt; a -&gt; a)\nfoldSP :: CommutativeOp a -&gt; SemigroupPolynomial a -&gt; a\nfoldSP (CO f) (SP m) = &lt;same as above&gt;\n</code></pre>\n\n<p>Now, as long as you realize that when you write:</p>\n\n<pre><code>plusOp = CO (+)\ntimesOp = CO (*)\n</code></pre>\n\n<p>you are making a declaration that <code>(+)</code> and <code>(*)</code> are commutative operations, this will ensure that <code>foldSP</code> is only applied to such operations:</p>\n\n<pre><code>main = do let sp = singleton 3 &lt;&gt; singleton 3 &lt;&gt; singleton 6\n          print $ foldSP plusOp sp\n          print $ foldSP timesOp sp\n</code></pre>\n\n<p>If you want to somehow introduce a commutativity constraint on the type <code>a</code> to ensure that <code>SemigroupPolynomial a</code> is a valid representation, then you can't do this for <code>a</code> equal to <code>Int</code>, obviously, since it depends on which binary operation <code>Int -&gt; Int -&gt; Int</code> is used for the fold.</p>\n\n<p>Instead, you need to embed the operation into the type, perhaps using <code>newtype</code>s that represent the operation, like <code>Sum</code> or <code>Product</code> in <code>Data.Semigroup</code>.  Then, you can introduce a type class (with no operations) to represent the commutativity constraint:</p>\n\n<pre><code>class Commutative a\ninstance Commutative (Sum a)\ninstance Commutative (Product a)\ninstance (Ord a, Commutative b) =&gt; SemigroupPolynomial b where\n    ...definition on (&lt;&gt;) as above...\n</code></pre>\n\n<p>and now the fold operation would use the operation implicit in the newtype (here, just using the monoid instance):</p>\n\n<pre><code>foldSP' :: (Monoid a) =&gt; SemigroupPolynomial a -&gt; a\nfoldSP' (SP m) = mconcat $ concatMap (\\(a, n) -&gt; replicate (fromIntegral n) a)\n                                     (Map.assocs m)\n</code></pre>\n\n<p>Maybe this is what you wanted.  If so, the full example looks like this:</p>\n\n<pre><code>import Data.Semigroup\nimport qualified Data.Map as Map\nimport Data.Map.Strict (Map)\n\nnewtype SemigroupPolynomial a = SP (Map a Integer) deriving (Show)\n\nclass Commutative a\ninstance Commutative (Sum a)\ninstance Commutative (Product a)\ninstance (Ord a, Commutative a) =&gt; Semigroup (SemigroupPolynomial a) where\n    (SP p0) &lt;&gt; (SP p1) = \n        SP $ Map.filter (0/=) $ Map.unionWith (+) p0 p1\n\nsingleton :: a -&gt; SemigroupPolynomial a\nsingleton x = SP $ Map.singleton x 1\n\nfoldSP' :: (Monoid a) =&gt; SemigroupPolynomial a -&gt; a\nfoldSP' (SP m) = mconcat $ concatMap (\\(a, n) -&gt; replicate (fromIntegral n) a)\n                                     (Map.assocs m)\n\nmain = do let sp1 = singleton (Sum 3) &lt;&gt; singleton (Sum 3) &lt;&gt; singleton (Sum 6)\n          print sp1\n          print (foldSP' sp1)\n          let sp2 = singleton (Product 3) &lt;&gt; singleton (Product 3) \n                          &lt;&gt; singleton (Product 6)\n          print sp2\n          print (foldSP' sp2)\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1506135502, "last_edit_date": 1592644375, "creation_date": 1506135502, "answer_id": 46375585, "question_id": 46342046, "link": "https://stackoverflow.com/questions/46342046/representing-commutative-semigroups-polynomials-in-haskell/46375585#46375585", "title": "Representing commutative semigroups polynomials in Haskell", "body": "<p>What you've constructed there is a free monoid, which is in turn just a list. You could probably use <code>[(a, Integer)]</code> rather than a map and it would be fine for some use cases. Since Haskell doesn't have dependent types, I doubt there will be anything nicer in terms of types.</p>\n<blockquote>\n<p>No the question is which constraints do I have to put in ??? so that:</p>\n<p>The &lt;&gt; operation is commutative and associative.</p>\n<p>It can be used to represent sums and products, as exemplified above.</p>\n</blockquote>\n<p>You should probably create a <code>Ring</code> typeclass, or use that of <a href=\"https://hackage.haskell.org/package/numeric-prelude-0.4.2/docs/Algebra-Ring.html\" rel=\"nofollow noreferrer\">numeric-prelude</a>. That will let users know your data type is associative, and has addition and multiplication. There's not any great type-level way to indicate these to my knowledge. You could use a property test to make sure that everything worked via <a href=\"https://hspec.github.io\" rel=\"nofollow noreferrer\">hspec</a> or a similar library.</p>\n<blockquote>\n<p>However it seems that the constraint (Abelian m, Monoidal m) might be too strong (I don't require a zero element), and it will prevent me to use this to represent products.</p>\n</blockquote>\n<p>There's no algebraic structure associated with polynomials &quot;over&quot; a semigroup, so you may have to implement that yourself. Since you say that <code>&lt;&gt;</code> is commutative, your elements <em>will</em> satisfy <code>Abelian m</code>. It's just a question of adding a unit.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 46373487, "answer_count": 2, "score": 0, "last_activity_date": 1506135502, "creation_date": 1505991111, "question_id": 46342046, "link": "https://stackoverflow.com/questions/46342046/representing-commutative-semigroups-polynomials-in-haskell", "title": "Representing commutative semigroups polynomials in Haskell", "body": "<p>I'm trying to represent terms like the following:</p>\n\n<pre><code>a0 &lt;&gt; a1 &lt;&gt; ... &lt;&gt; an-1\n</code></pre>\n\n<p>Where <code>ai</code> must be element of a commutative Semigroup. For this one can choose a data representation like the following:</p>\n\n<pre><code>newtype SemigroupPolynomial a = SP Map a Integer\n</code></pre>\n\n<p>where the map contains the different terms of the polynomial and its count.</p>\n\n<p>In this way, we can represent the sum</p>\n\n<pre><code>3 + 3 + 6\n</code></pre>\n\n<p>as (assuming <code>OverloadedLists</code>):</p>\n\n<pre><code>SP [(3, 2), (6, 1)]\n</code></pre>\n\n<p>But also we can represent terms like:</p>\n\n<pre><code>3 * 3 * 6\n</code></pre>\n\n<p>The <code>SemigroupPolynomial</code> could be an instance of <code>Semigroup</code>:</p>\n\n<pre><code>instance ??? a =&gt; Semigroup (SemigroupPolynomial a) where\n    (MP p0) &lt;&gt; (MP p1) = \n        MP $ Map.filter (0/=) $ Map.unionWith (+) p0 p1\n</code></pre>\n\n<p>No the question is which constraints do I have to put in <code>???</code> so that:</p>\n\n<ol>\n<li>The <code>&lt;&gt;</code> operation is commutative and associative.</li>\n<li>It can be used to represent sums and products, as exemplified above. </li>\n</ol>\n\n<p>A similar question on how to represent commutative Monoids <a href=\"https://stackoverflow.com/questions/12289746/commutative-monoid-from-algebra-package-on-hackage\">was already asked here</a>. However it seems that the constraint <code>(Abelian m, Monoidal m)</code> might be too strong (I don't require a zero element), and it will prevent me to use this to represent products.</p>\n"}, {"tags": ["haskell", "haskell-chart"], "comments": [{"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1505979740, "post_id": 46337988, "comment_id": 79635977, "body": "Could you provide your code so we can tinker with it?"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1505980446, "post_id": 46337988, "comment_id": 79636423, "body": "I added what I can, but it&#39;s missing the datas. You can probably use something like [[(some LocalTime, &quot;2000000000&quot;), (some LocalTime + 10s, &quot;2000005000&quot;)]] or something and get a similar result."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505982556, "post_id": 46337988, "comment_id": 79637838, "body": "I&#39;m sure this is possible to do. But \u2013 without disrecommending it \u2013 I&#39;ve always found <code>chart</code> to be a bit clumsly in regard to <i>simply plotting some stuff without issues like those badly-formatted numbers</i>. I&#39;d like to advertise <a href=\"http://hackage.haskell.org/package/dynamic-plot-0.2.2.0/docs/Graphics-Dynamic-Plot-R2.html\" rel=\"nofollow noreferrer\">dynamic-plot</a>, which does this kind of thing automatically. (But is nowhere near as feature-rich in terms of labels etc..)"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1505983105, "post_id": 46337988, "comment_id": 79638168, "body": "I didn&#39;t know it existed, but as far as I understand it that&#39;s a graphical window type thing, right ? The goal for me there is to make an API with snap to graph datas from a database on the fly, I loved the toFile function of charts because it makes that very easy to accomplish, if I could just figure out how to adjust the graph. But I&#39;ll read up on dynamic, the screenshots do look pretty good"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505984414, "post_id": 46337988, "comment_id": 79638970, "body": "Well, since <code>dynamic-plot</code> actually renders everything through <code>diagrams</code>, it would in principle be easy to output to a file instead of GTK window. In fact I&#39;ve meant to implement this for a long time, but always postponed it... should definitely put it in the next release."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1505984631, "post_id": 46337988, "comment_id": 79639104, "body": "Well to a file, a string or something, but yeah an option to skip the GTK dependecy would be great, to run that on headless servers."}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1505990783, "post_id": 46339903, "comment_id": 79643508, "body": "That&#39;s pretty good, thanks ! I went with that for func : (\\y -&gt; TL.unpack $ FO.format (FO.prec 3 FO.% &quot; GB&quot;) $ (fromIntegral y) / 1073741824.0). It gives some pretty good result, I might have to fiddle with the precision depending on the results but that&#39;s allright"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 5, "last_activity_date": 1506045078, "last_edit_date": 1506045078, "creation_date": 1505985156, "answer_id": 46339903, "question_id": 46337988, "link": "https://stackoverflow.com/questions/46337988/human-readable-numbers-with-haskell-charts/46339903#46339903", "title": "Human readable numbers with Haskell Charts", "body": "<p>Digging into the <a href=\"https://github.com/timbod7/haskell-chart/blob/CHART_1_8_2/chart/Graphics/Rendering/Chart/Axis/Int.hs#L20-L35\" rel=\"nofollow noreferrer\">source of the Chart</a>, maybe I found the solution.</p>\n\n<p>Here's working code. you can change <code>func</code> to anything you like</p>\n\n<p>This will show label of y-axis <code>10,20,30,40</code>, when actual data is <code>100,200,300,400</code></p>\n\n<pre><code>import Graphics.Rendering.Chart.Easy\nimport Graphics.Rendering.Chart.Backend.Diagrams\n\nfunc :: Int -&gt; String\nfunc x = show $ x `quot` 10\n\nvals :: [(Int,Int)]\nvals = [(1,100),(2,200),(3,300),(4,400)]\nmain = do\n  toFile def \"test.svg\" $ do\n    layout_title .= \"test\"\n    layout_y_axis . laxis_generate .= autoScaledIntAxis(LinearAxisParams{\n        _la_labelf = map func,\n        _la_nLabels = 5,\n        _la_nTicks = 10\n        })\n    plot $ points \"Score\" vals\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 46339903, "answer_count": 1, "score": 3, "last_activity_date": 1546172607, "creation_date": 1505979157, "last_edit_date": 1546172607, "question_id": 46337988, "link": "https://stackoverflow.com/questions/46337988/human-readable-numbers-with-haskell-charts", "title": "Human readable numbers with Haskell Charts", "body": "<p>I'm trying to use Haskell-Charts (<a href=\"http://hackage.haskell.org/package/Chart\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/Chart</a>) to generate some graphs. It works fine and I get a nice graph <a href=\"https://i.stack.imgur.com/vNdJJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vNdJJ.png\" alt=\"enter image description here\"></a></p>\n\n<p>My only \"problem\" are the numbers on the left, that's a bit hard to read. Is there a way to maybe provide a function that would convert those numbers before displaying them ?\nI could convert the numbers before plotting, but I would lose precision. I've been looking at the doc but I don't see it, if it exists.</p>\n\n<p>Thanks</p>\n\n<p>EDIT : Here is the code.</p>\n\n<pre><code>import Graphics.Rendering.Chart.Easy\nimport Graphics.Rendering.Chart.Axis.LocalTime\nimport Graphics.Rendering.Chart.Backend.Diagrams\nimport Data.Time.LocalTime\n\nmain = do\n  -- Get datas\n  toFile def \"test.svg\" $ do\n    layout_title .= \"Active mem\"\n    plot (line \"Active\" $ [L.map (\\v -&gt; ((utcToLocalTime utc $ time v) :: LocalTime, (fromIntegral $ value v) :: Int)) $ V.toList q])\n</code></pre>\n\n<p>Unfortunately I get the data from a database, and I can't give public access to it. But a list of [(LocalTime, Int)] with big numbers should give you something similar. I'm using the Diagrams backend btw</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1505978742, "post_id": 46336993, "comment_id": 79635380, "body": "Cannot reproduce as given. Please provide a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1505978969, "post_id": 46336993, "comment_id": 79635512, "body": "What if the portfolio is <code>(...,[])</code>? Why are you matching on <code>s</code> twice, in the function definition and case? I&#39;d turn on the warnings with <code>-Wall</code>: GHC will spot these mistakes and report them."}], "owner": {"reputation": 1, "user_id": 8646480, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99010e62ebfcf28abd20f10b73c4cb95?s=128&d=identicon&r=PG&f=1", "display_name": "\u9ec4\u4e25\u6a11", "link": "https://stackoverflow.com/users/8646480/%e9%bb%84%e4%b8%a5%e6%a8%91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517122477, "creation_date": 1505975666, "last_edit_date": 1517122477, "question_id": 46336993, "link": "https://stackoverflow.com/questions/46336993/non-exhaustive-patterns-when-i-am-trying-to-use-2-inputs-of-list-in-haskell", "title": "Non-exhaustive patterns when I am trying to use 2 inputs of list in haskell", "body": "<pre><code>numOfSell :: Portfolio -&gt; [StockHistory] -&gt; Integer\nnumOfSell (_, h@((s, q) : _)) history = case history of\n  [] -&gt; 0\n  (s, p) : _\n    |(head p &gt; last p) &amp;&amp; (head p &gt; mean (take 15 p)) -&gt; floor ((integerToFloat q) / 2)\n    |(head p &gt; last p) &amp;&amp; (head p &gt; 2 * mean (take 20 p)) -&gt; q\n    |(head p &lt; 1.5 * mean (take 20 p)) &amp;&amp; (head p &gt; 0.8 * (last p)) -&gt; floor ((integerToFloat q) / 2)\n    |otherwise           -&gt; 0\n</code></pre>\n\n<p>When I wanted to use two lists which are h and history, it said there is non-exhaustive part in my function. I have no idea why that happened and how to solve it.</p>\n"}, {"tags": ["haskell", "sqrt", "floor"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1505993378, "post_id": 46335513, "comment_id": 79645329, "body": "Then you get rid of the boilerplate by using the composition operator: <code>roundSqrt = floor . sqrt . fromIntegral</code>."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1505968208, "creation_date": 1505968208, "answer_id": 46335513, "question_id": 46335406, "link": "https://stackoverflow.com/questions/46335406/joint-use-of-floor-and-sqrt-in-haskell/46335513#46335513", "title": "Joint use of floor and sqrt in Haskell", "body": "<p>The type of sqrt is:</p>\n\n<pre><code>\u03bb&gt; :t sqrt\nsqrt :: Floating a =&gt; a -&gt; a\n</code></pre>\n\n<p>The type of floor is:</p>\n\n<pre><code>\u03bb&gt; ::t floor\nfloor :: (RealFrac a, Integral b) =&gt; a -&gt; b\n</code></pre>\n\n<p>So, <code>sqrt</code> needs a type which has a <code>Floating</code> constraint. You can use the <code>fromIntegral</code> function to achieve that:</p>\n\n<pre><code>roundSqrt :: Int -&gt; Int\nroundSqrt x = floor (sqrt (fromIntegral x))  \n</code></pre>\n"}], "owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 0, "accepted_answer_id": 46335513, "answer_count": 1, "score": 3, "last_activity_date": 1505968208, "creation_date": 1505967497, "question_id": 46335406, "link": "https://stackoverflow.com/questions/46335406/joint-use-of-floor-and-sqrt-in-haskell", "title": "Joint use of floor and sqrt in Haskell", "body": "<p>I want my function to read in an integer and return the square root rounded down to the nearest integer. This is what I've tried:</p>\n\n<pre><code>roundSqrt :: Int -&gt; Int\nroundSqrt x = floor (sqrt x)  \n</code></pre>\n\n<p>The error I get is, \"Could not deduce (Floating a) arising from a use of -sqrt'\", but I don't understand what this means.</p>\n"}, {"tags": ["haskell", "static-site", "hakyll"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1505978923, "post_id": 46335025, "comment_id": 79635485, "body": "Hum, where did you get that <code>&quot;index&quot; + setExtension &quot;.html&quot;</code> syntax? I have <code>route   $ setExtension &quot;html&quot;</code>"}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1505979209, "post_id": 46335025, "comment_id": 79635641, "body": "Indeed, that should not even compile <code>(+)</code> is defined on <code>Num</code> typeclass, which <code>Routes</code> produced by <code>setExtension</code> come nowhere near."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1505979743, "post_id": 46335025, "comment_id": 79635979, "body": "Did you call <code>stack build</code> or <code>cabal build</code> after editing the source code?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1506043002, "post_id": 46335025, "comment_id": 79670697, "body": "Was trying to concatenate.  Changed to &#39;++.&#39;"}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1506075842, "post_id": 46335025, "comment_id": 79684286, "body": "@Mittenchops That will not work either. <code>setExtension</code> does not return <code>String</code>, it just sets the extension (think imperatively)."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1506142909, "post_id": 46335025, "comment_id": 79711388, "body": "@JanTojnar, now that I stopped the watch process, when I try to rebuild or clean, I get:  ```  [ERROR] Hakyll.Core.Compiler.Require.load: templates/default.html (snapshot _final) was not found in the cache, the cache might be corrupted or the item you are referring to might not exist``` The templates/default.html definitely does exist."}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1505964614, "creation_date": 1505964614, "question_id": 46335025, "link": "https://stackoverflow.com/questions/46335025/minimal-hakyll-site", "title": "Minimal Hakyll site", "body": "<p>I understand there's an example site given by</p>\n\n<pre><code>hakyll-init app\n</code></pre>\n\n<p>But I'm looking to reduce even more to the skeleton, and just have 1 markdown page that renders in the root, \"<code>localhost:8000/</code>\", and an alias \"<code>localhost:8000/index.html</code>.\"</p>\n\n<p>From the instructions, I have created this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 app.cabal\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 _cache\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 d5c19886a1234f571c624d44ba520d2b\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 default.css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 images\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.markdown\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 _site\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 default.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 images\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 site.hs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 stack.yaml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 default.html\n</code></pre>\n\n<p>And I have the following in:</p>\n\n<h1>site.hs</h1>\n\n<pre><code>--------------------------------------------------------------------------------\n{-# LANGUAGE OverloadedStrings #-}\nimport           Data.Monoid (mappend)\nimport           Hakyll\n\n\n--------------------------------------------------------------------------------\nmain :: IO ()\nmain = hakyll $ do\n    match \"images/*\" $ do\n        route   idRoute\n        compile copyFileCompiler\n\n    match \"css/*\" $ do\n        route   idRoute\n        compile compressCssCompiler\n\n    match \"index.markdown\" $ do\n        route   $ \"index\" + setExtension \"html\"\n        compile $ pandocCompiler\n            &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n            &gt;&gt;= relativizeUrls\n\n    create \"/\" $ do\n        route   $ \"index\" + setExtension \"html\"\n        compile $ pandocCompiler\n            &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n            &gt;&gt;= relativizeUrls\n\n--------------------------------------------------------------------------------\npostCtx :: Context String\npostCtx =\n    dateField \"date\" \"%B %e, %Y\" `mappend`\n    defaultContext\n</code></pre>\n\n<p>This seems to compile:</p>\n\n<pre><code>app $ stack exec site watch\nListening on http://127.0.0.1:8000\nInitialising...\n  Creating store...\n  Creating provider...\n  Running rules...\nChecking for out-of-date items\nCompiling\nSuccess\n</code></pre>\n\n<p>But when I load <code>http://127.0.0.1:8000</code>, or <code>http://localhost:8000/index.html</code>, I don't see my template, I see:</p>\n\n<pre><code>File not found\n</code></pre>\n\n<p>How can I fix <code>site.hs</code> for a minimal Hakyll (only an <code>index.html</code> created from a markdown stub), and how can I understand the debugging better?  Eg, here I would have liked to see some kind of \"stuff won't be found\" at compile time.  Where would I look for that?</p>\n"}, {"tags": ["function", "haskell", "recursion", "size"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1505957298, "post_id": 46333934, "comment_id": 79628647, "body": "There&#39;s a little bit of context missing from your question, namely the definition of <code>Set</code>. If it&#39;s declared as <code>type Set = []</code> then your code is <i>almost</i> correct. You just need to adjust the base case - an empty set should have a size of 0. (A couple of suggestions of things to think about as an exercise: How would you make this function tail recursive? Would that be a good idea for performance? Can this function be expressed using a fold?)"}, {"owner": {"reputation": 7, "user_id": 5380463, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2dcc0bc819fbaf1e59dac91c98f932d6?s=128&d=identicon&r=PG&f=1", "display_name": "carl123", "link": "https://stackoverflow.com/users/5380463/carl123"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1505958213, "post_id": 46333934, "comment_id": 79628812, "body": "Thank you for your reply. Yes, <code>size</code> is declared as you mentioned <code>type Set a = [a]</code>. I&#39;ll look into your suggestions."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 0, "last_activity_date": 1506013479, "creation_date": 1506013479, "answer_id": 46349491, "question_id": 46333934, "link": "https://stackoverflow.com/questions/46333934/haskell-recursive-function-size-that-returns-the-number-of-elements-in-a-set/46349491#46349491", "title": "Haskell recursive function size that returns the number of elements in a set", "body": "<p>I think you forgot one important part: the fact that the empty list <code>[]</code> has size <code>0</code>, so:</p>\n\n<pre><code>size ::  Set a -&gt; Int\nsize [] = <b>0</b>                 -- zero\nsize (_:xs) = 1  + size xs</code></pre>\n\n<p>Besides code however it is important to be able to explain your code. The first clause can be explained like:</p>\n\n<blockquote>\n  <p>\"The size of an empty list is zero (0)\".</p>\n</blockquote>\n\n<p>The recursive clause on the other hand can be explained as:</p>\n\n<blockquote>\n  <p>The size of the non-empty list is the same as one plus the size of a set minus one element (the head).</p>\n</blockquote>\n\n<p>Note that here, we make the assumption that the type <code>Set a</code> is the same as <code>[a]</code>. This however means that we can have sets with duplicate entries. In case we do not want that, we should use a uniqueness filter. We can use <code>nub :: Eq a =&gt; [a] -&gt; [a]</code> for that, or we can implement it in our <code>size</code> function:</p>\n\n<pre><code>size :: Set a -&gt; Int\nsize = size' []\n    where size' _ [] = 0\n          size' l (x:xs) | elem x l = size' l xs\n                         | otherwise = 1 + size' (x:l) xs\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1506135938, "creation_date": 1506135938, "answer_id": 46375610, "question_id": 46333934, "link": "https://stackoverflow.com/questions/46333934/haskell-recursive-function-size-that-returns-the-number-of-elements-in-a-set/46375610#46375610", "title": "Haskell recursive function size that returns the number of elements in a set", "body": "<p>One possible solution using higher-order functions:</p>\n\n<pre><code>size :: Set a -&gt; Int\nsize = sum . fmap (const 1)\n</code></pre>\n\n<p>This works because <code>Set</code> is an instance of <code>Foldable</code> and can be made an instance of <code>Functor</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 5380463, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2dcc0bc819fbaf1e59dac91c98f932d6?s=128&d=identicon&r=PG&f=1", "display_name": "carl123", "link": "https://stackoverflow.com/users/5380463/carl123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1339, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1506135938, "creation_date": 1505956811, "question_id": 46333934, "link": "https://stackoverflow.com/questions/46333934/haskell-recursive-function-size-that-returns-the-number-of-elements-in-a-set", "title": "Haskell recursive function size that returns the number of elements in a set", "body": "<p>Write a recursive function size in haskell that returns the number of elements in a set. Do not use the library function <strong>length.</strong></p>\n\n<pre><code>size ::  Set a -&gt; Int\n</code></pre>\n\n<p>This is what i did so far. Does it look right or am i misunderstanding what the question is asking? Thanks</p>\n\n<pre><code>  size ::  Set a -&gt; Int\n  size [] = 1\n  size (_:xs) = 1  + size xs\n</code></pre>\n"}]