[{"tags": ["haskell", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1537426737, "post_id": 52413656, "comment_id": 91781783, "body": "So it doesn&#39;t matter in this case that there&#39;s only one instance defined (and accessible) in that module?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1537431559, "post_id": 52413656, "comment_id": 91784275, "body": "@DamianNadales, we have an open world assumption for classes."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1537433379, "post_id": 52413656, "comment_id": 91785257, "body": "Oh, I didn&#39;t know about it. Makes sense."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": false, "score": 4, "last_activity_date": 1537388416, "creation_date": 1537388416, "answer_id": 52413656, "question_id": 52413429, "link": "https://stackoverflow.com/questions/52413429/can-i-select-an-instance-without-resorting-to-typeapplications/52413656#52413656", "title": "Can I select an instance without resorting to TypeApplications?", "body": "<p>No. Imagine, if we had in another module</p>\n\n<pre><code>instance Interpretation Y where\n  type Context Y = Identity\n\ninstance Interpret Y Int where\n  type Interpreted Y Int = Bool\n\n  int :: Int -&gt; Identity Bool\n  int x = pure (x /= 0)\n</code></pre>\n\n<p>And define <code>f</code> as you have done - what should the behaviour be?</p>\n\n<p>I assume you also don't want to use something like <code>Proxy</code>, which would allow you to pass in a type variable without needing to use <code>TypeApplications</code>, but would still require specifying the instance you'd want to use.</p>\n"}, {"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1537428322, "post_id": 52413690, "comment_id": 91782606, "body": "I didn&#39;t know about these alternatives (and the injectivity problem). Thanks.  Regarding the use <code>TypeFamiliesDependencies</code> does the constraint <code>r -&gt; i</code> means that one couldn&#39;t define a second instance like the one shown in <a href=\"https://stackoverflow.com/a/52413656/2289983\">Isaac</a>&#39;s answer?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1537433804, "post_id": 52413690, "comment_id": 91785494, "body": "Yes, the injectivity annotation basically prevents you from writing two instances that both have <code>type Context _ = Identity</code>, and therefore avoids the ambiguity between two such instances."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1537389420, "last_edit_date": 1537389420, "creation_date": 1537388625, "answer_id": 52413690, "question_id": 52413429, "link": "https://stackoverflow.com/questions/52413429/can-i-select-an-instance-without-resorting-to-typeapplications/52413690#52413690", "title": "Can I select an instance without resorting to TypeApplications?", "body": "<p>As it stands, <code>int</code> has an ambiguous type. That's because <code>i</code> only appears in the signature within <code>Context i</code> and <code>Interpreted i a</code>, which are type families and as such not (necessarily) injective, as witnessed by <a href=\"https://stackoverflow.com/a/52413656/745903\">Isaac van Bakel's answer</a>. Ambiguous types can only be resolved with type applications (and IMO this is a perfectly good approach).</p>\n\n<p>You can however prevent the ambiguity. The traditional way is to use associated <em>data</em> families instead of type families; these have the type information baked in and are therefore always injective:</p>\n\n<pre><code>class Interpretation i where\n  data Context i a\n\nclass Interpretation i =&gt; Interpret i a where\n  type Interpreted i a :: *\n  int :: a -&gt; Context i (Interpreted i a)\n\ninstance Interpretation X where\n  newtype Context X a = XContext (Identity a)\n\ninstance Interpret X Int where\n  type Interpreted X Int = Bool\n  int :: Int -&gt; Context X Bool\n  int x = XContext $ pure (x == 0)\n\nf :: Int -&gt; Bool\nf n = case int n of\n  XContext a -&gt; runIdentity a\n</code></pre>\n\n<p>An alternative is the more recent <a href=\"https://downloads.haskell.org/~ghc/master/users-guide/glasgow_exts.html?highlight=typefamilydependencies#injective-type-families\" rel=\"nofollow noreferrer\">injective type families extension</a>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilyDependencies #-}\n\nclass Interpretation i where\n  type Context i = (r :: * -&gt; *) | r -&gt; i\n\nclass Interpretation i =&gt; Interpret i a where\n  type Interpreted i a :: *\n  int :: a -&gt; Context i (Interpreted i a)\n\ninstance Interpretation X where\n  type Context X = Identity\n\ninstance Interpret X Int where\n  type Interpreted X Int = Bool\n  int :: Int -&gt; Identity Bool\n  int x = pure (x == 0)\n\nf :: Int -&gt; Bool\nf = runIdentity . int\n</code></pre>\n\n<p>Note that in this case, you won't be able to use <code>Identity</code> for another <code>Interpretation</code> instance.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 52413690, "answer_count": 2, "score": 3, "last_activity_date": 1537389420, "creation_date": 1537387409, "question_id": 52413429, "link": "https://stackoverflow.com/questions/52413429/can-i-select-an-instance-without-resorting-to-typeapplications", "title": "Can I select an instance without resorting to TypeApplications?", "body": "<p>I have the following type classes:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes    #-}\n{-# LANGUAGE InstanceSigs           #-}\n{-# LANGUAGE TypeFamilies           #-}\n{-# LANGUAGE MultiParamTypeClasses  #-}\n\nclass Interpretation i where\n  type Context i :: * -&gt; *\n\nclass Interpretation i =&gt; Interpret i a where\n  type Interpreted i a :: *\n\n  int :: a -&gt; Context i (Interpreted i a)\n</code></pre>\n\n<p>Which basically encode interpretation functions from <code>a</code> to <code>Interpreted i a</code> wrapped in some context. </p>\n\n<p>I've written these instances:</p>\n\n<pre><code>data X = X\n\ninstance Interpretation X where\n  type Context X = Identity\n\ninstance Interpret X Int where\n  type Interpreted X Int = Bool\n\n  int :: Int -&gt; Identity Bool\n  int x = pure (x == 0)\n</code></pre>\n\n<p>Now suppose that I need to use <code>int</code> above to interpret an <code>Int</code> into a <code>Bool</code>, for instance in the following function:</p>\n\n<pre><code>f :: Int -&gt; Bool\nf = -- use int somehow\n</code></pre>\n\n<p>If I define <code>f</code> as follows:</p>\n\n<pre><code>f x = int x\n</code></pre>\n\n<p>The compiler will complain:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Interpreted i0 Int\u2019 with \u2018Bool\u2019\n  Expected type: Int -&gt; Identity Bool\n    Actual type: Int -&gt; Context i0 (Interpreted i0 Int)\n  The type variable \u2018i0\u2019 is ambiguous\n\u2022 In the second argument of \u2018(.)\u2019, namely \u2018int\u2019\n  In the expression: runIdentity . int\n  In an equation for \u2018f\u2019: f = runIdentity . int\n</code></pre>\n\n<p>By using <code>TypeApplications</code> I can select the right (and only available) instance:</p>\n\n<pre><code>{-# LANGUAGE TypeApplications       #-}\n\n-- ...\n\nf :: Int -&gt; Bool\nf = runIdentity . int @X\n</code></pre>\n\n<p>But I was wondering whether such instance could be selected without resorting to <code>TypeApplications</code>.</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1537381683, "post_id": 52412094, "comment_id": 91767951, "body": "Hint: A common mistake is that people assume that <code>[x]</code> means that this is <i>any</i> list (of any length), but the <code>[x]</code> pattern, matches a <i>singleton</i> list, with as element <code>x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1537382241, "last_edit_date": 1537382241, "creation_date": 1537382000, "answer_id": 52412210, "question_id": 52412094, "link": "https://stackoverflow.com/questions/52412094/a-function-of-tuple-of-lists/52412210#52412210", "title": "A function of tuple of lists", "body": "<p>A common mistake that beginner Haskell programmers make is that they think that <code>[x]</code> is a pattern that matches a list of <em>any</em> length. But <code>[x]</code> is in fact a pattern that matches a <em>singleton</em> list (a list with exactly <em>one</em> element, and that element is \"linked\" to <code>x</code>).</p>\n\n<p>If we want to be able to process empty lists (<code>[]</code>) or non-empty lists (with a length larger than zero), we can just write as pattern <code>x</code>, <code>x</code> will than get \"linked\" to that list itself. Note that we can use any identifier we want. Pattern matching for lists is of course useful: for example to handle the case of an empty list, a cons, a list containing exactly one, two, three, five, etc. elements. But here we will only restrict ourselves, and make things more complicated.</p>\n\n<p>In order to calculate the maximum of the second item of the tuples, we can process it by first making a <code>map</code>ping that generates a list of elements, each the second item of the corresponding tuple, and then we can calculate the <code>maximum</code> of that list, like:</p>\n\n<pre><code>maxSecond :: Ord a =&gt; [(a, a)] -&gt; a\nmaxSecond xs = maximum (map snd xs)\n</code></pre>\n\n<p>We here thus make use of the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:map\" rel=\"noreferrer\"><strong><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code></strong></a> function to apply a function to all elements in the list <code>xs</code>, that function is <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:snd\" rel=\"noreferrer\"><strong><code>snd :: (c, d) -&gt; d</code></strong></a> that thus takes the second element of a 2-tuple, and then we calculate the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:maximum\" rel=\"noreferrer\"><strong><code>maximum :: Ord e =&gt; [e] -&gt; e</code></strong></a> to obtain the maximum of that list.</p>\n\n<p>We can also use the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-46-\" rel=\"noreferrer\"><strong><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></strong></a> operator, and write it like:</p>\n\n<pre><code>maxSecond :: Ord a =&gt; [(a, a)] -&gt; a\nmaxSecond = maximum . map snd\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 10387316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa7e403eeb47469098855d34fc854dca?s=128&d=identicon&r=PG&f=1", "display_name": "Jameson Braga", "link": "https://stackoverflow.com/users/10387316/jameson-braga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1537382251, "creation_date": 1537381535, "last_edit_date": 1537382251, "question_id": 52412094, "link": "https://stackoverflow.com/questions/52412094/a-function-of-tuple-of-lists", "title": "A function of tuple of lists", "body": "<p>I am sorry if this question is very trivial, but I have struggled to find an answer to it for quite a time, that is why I decided to post it here. </p>\n\n<p>I want to build a function which takes a list of binary tuples: [(Integer, Integer)] and outputs the maximum Integer from all the second Integers from all tuples. I wrote the following code:</p>\n\n<pre><code>maxSecond:: [(Integer,Integer)] -&gt; Integer\nmaxSecond [(ks, as)] = aux (unzip [(ks, as)])\n  where aux ([ks],[as]) = maximum ([as])\n</code></pre>\n\n<p>But it only works if I input a list of only 1 tuple and outputs \"Non-exhaustive patterns in function\" error for a list of more than 2 tuples. My question is not as much how to actually solve the original problem, as why such an approach doesn't work in Haskell?</p>\n\n<p>I have also wrote the following function:</p>\n\n<pre><code>aaa:: ([Integer], [Integer]) -&gt; Integer\naaa ([as],[ms]) = 10\n</code></pre>\n\n<p>And apparently it is impossible to input a tuple of lists in Haskell (unless the lists are not made of 1 element). Is there any explanation to this?</p>\n\n<p>Thank you!!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537381318, "post_id": 52411928, "comment_id": 91767766, "body": "How did you get an infinite list for  <code>fullDeck</code> when the current definition isn&#39;t syntactically correct? Syntax error aside, that will result in a 52-card deck."}, {"owner": {"reputation": 101, "user_id": 10338282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8045145181da08fe82ae57c4dade02a?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bernhardt", "link": "https://stackoverflow.com/users/10338282/tobias-bernhardt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537381430, "post_id": 52411928, "comment_id": 91767829, "body": "Not sure, I just assumed :D Mostly because I can&#39;t interpret why there would only be 52 cards, so I assumed I didn&#39;t  define an total sum for the deck :/"}, {"owner": {"reputation": 101, "user_id": 10338282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8045145181da08fe82ae57c4dade02a?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bernhardt", "link": "https://stackoverflow.com/users/10338282/tobias-bernhardt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537381468, "post_id": 52411928, "comment_id": 91767844, "body": "Nvm, now I understand... Because there&#39;s only 52 possibilities. God im dumb"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537435167, "post_id": 52411928, "comment_id": 91786298, "body": "&quot;A section must be enclosed in parentheses thus: (Two.. Ace)&quot; <i>means</i>, <code>Two..</code> was interpreted as the operator <code>(.)</code> from a module <code>Two</code>; then we&#39;re left with <code>.Ace</code> which is interpreted by the compiler to be the partial application <code>flip (.) Ace</code> in the <i>operator section</i> syntax thus it offers us to enclose it in parentheses, <code>( . Ace )</code>, or with full module import syntax <code>( Two.. Ace )</code>. A common Haskell gotcha."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1537386554, "post_id": 52412001, "comment_id": 91770205, "body": "Incidentally, why is there not some polymorphic &quot;all the things&quot; defined as <code>[minBound..] :: (Enum a, Bounded a) =&gt; [a]</code>? This seems like a frequently useful idea, and here if it existed we could just write <code>fullDeck :: Deck; fullDeck = (,) &lt;$&gt; allTheThings &lt;*&gt; allTheThings</code> (after deriving Bounded for Suit and Value)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1537387059, "last_edit_date": 1537387059, "creation_date": 1537381190, "answer_id": 52412001, "question_id": 52411928, "link": "https://stackoverflow.com/questions/52411928/full-deck-in-haskell-using-list-comprehension/52412001#52412001", "title": "Full deck in Haskell using list comprehension", "body": "<p>You forgot to use <em>spaces</em> between the data constructors (like <code>Club</code> and <code>Spade</code>) and the <code>..</code> operator. By failing to do so, Haskell sees this as dots that are used for for example <em>qualified</em> imports.</p>\n\n<p>The following works:</p>\n\n<pre><code>[(suit, value) | suit &lt;- [Club .. Spade], value &lt;- [Two .. Ace]]\n--                            ^  ^                     ^  ^\n</code></pre>\n\n<p>This generates the expected:</p>\n\n<pre><code>Prelude&gt; [(suit, value) | suit &lt;- [Club .. Spade], value &lt;- [Two .. Ace]]\n[(Club,Two),(Club,Three),(Club,Four),(Club,Five),(Club,Six),(Club,Seven),(Club,Eight),(Club,Nine),(Club,Ten),(Club,Jack),(Club,Queen),(Club,King),(Club,Ace),(Diamond,Two),(Diamond,Three),(Diamond,Four),(Diamond,Five),(Diamond,Six),(Diamond,Seven),(Diamond,Eight),(Diamond,Nine),(Diamond,Ten),(Diamond,Jack),(Diamond,Queen),(Diamond,King),(Diamond,Ace),(Heart,Two),(Heart,Three),(Heart,Four),(Heart,Five),(Heart,Six),(Heart,Seven),(Heart,Eight),(Heart,Nine),(Heart,Ten),(Heart,Jack),(Heart,Queen),(Heart,King),(Heart,Ace),(Spade,Two),(Spade,Three),(Spade,Four),(Spade,Five),(Spade,Six),(Spade,Seven),(Spade,Eight),(Spade,Nine),(Spade,Ten),(Spade,Jack),(Spade,Queen),(Spade,King),(Spade,Ace)]\n</code></pre>\n\n<p>We can also - like @Amalloy says - make the types <code>Bounded</code>, and then write it like:</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade  deriving (Show, Enum, Bounded)\n\ndata Value = Two | Three | Four | Five | Six | Seven\n          | Eight | Nine | Ten | Jack | Queen\n          | King | Ace  deriving (Show, Enum, Bounded)\n\nfullDeck :: Deck    -- My function is supposed to consist of a deck\nfullDeck = [(suit, value) | suit &lt;- [minBound ..], value &lt;- [minBound ..]]\n</code></pre>\n\n<p>or we could define a helper value:</p>\n\n<pre><code>boundedAll :: (Bounded a, Ord a) =&gt; [a]\nboundedAll = [minBound ..]\n</code></pre>\n\n<p>and then write it like:</p>\n\n<pre><code>fullDeck :: Deck\nfullDeck = (,) &lt;$&gt; boundedAll &lt;*&gt; boundedAll\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 10338282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8045145181da08fe82ae57c4dade02a?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bernhardt", "link": "https://stackoverflow.com/users/10338282/tobias-bernhardt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "closed_date": 1537385174, "accepted_answer_id": 52412001, "answer_count": 1, "score": 1, "last_activity_date": 1537387059, "creation_date": 1537380858, "question_id": 52411928, "link": "https://stackoverflow.com/questions/52411928/full-deck-in-haskell-using-list-comprehension", "closed_reason": "Duplicate", "title": "Full deck in Haskell using list comprehension", "body": "<p>I'm quite new to Haskell (and programming).\nMy assignment is to define a function that returns a full deck of card (aka 52 cards). Trying to include my thought process in the notes next to  the code. </p>\n\n<p>-- The values I've defined</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade  deriving (Show, Enum)\n\ndata Value = Two | Three | Four | Five | Six | Seven\n          | Eight | Nine | Ten | Jack | Queen\n          | King | Ace  deriving (Show, Enum) \n\ntype Card = (Suit, Value)  -- A card must have a suit and a value\ntype Deck = [Card]        -- A deck consists of a list of cards\n\nfullDeck :: Deck    -- My function is supposed to consist of a deck\nfullDeck = [(suit, value) | suit &lt;- [Club..Spade], value &lt;- [Two..Ace]]  -- Tried my luck using ''list comprehensions''. Is it necessary to type [Club..Spade] or does it work for just [Club..] as well? \n</code></pre>\n\n<p>My code won't load. The error I'm getting: </p>\n\n<pre><code>beginner.hs:11:62: error:\n    A section must be enclosed in parentheses thus: (Two.. Ace)\n   |\n11 | fullDeck = [(suit, value) | suit &lt;- [Club..Spade], value &lt;- [Two..Ace]]\n</code></pre>\n\n<p>No matter how I try to solve it, some new error shows up, so I'm obviously doing some major fail(s) that I can't locate. </p>\n\n<p>Also I'm curious on how to make sure that there will only be 52 cards in my deck, because at the moment my list consists of an infinite amount?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1537358876, "last_edit_date": 1537358876, "creation_date": 1537358429, "answer_id": 52405400, "question_id": 52405328, "link": "https://stackoverflow.com/questions/52405328/tuples-inside-tuples-type-different-or-similar/52405400#52405400", "title": "Tuples inside Tuples type different or similar?", "body": "<p><strong>No</strong>. We can query the type in GHCi, and obtain:</p>\n\n<pre><code>Prelude&gt; :t [([(True, False),(True, False)])]\n[([(True, False),(True, False)])] :: [[(Bool, Bool)]]\nPrelude&gt; :t [((True, False),(True, False))]\n[((True, False),(True, False))] :: [((Bool, Bool), (Bool, Bool))]\n</code></pre>\n\n<p>So the first expression is a list of lists of 2-tuples of <code>Bool</code>s; the latter is a list of 2-tuples of 2-tuples of <code>Bool</code>s.</p>\n\n<p>A list is <em>not</em> a tuple. In Haskell in a list <em>all</em> elements have the <em>same</em> type, furthermore the <em>length</em> of the list is not fixed at <em>compile</em> time.</p>\n\n<p>A tuple on the other hand has a <em>fixed</em> arity (number of elements), and the type of the elements can vary.</p>\n\n<p>We can also see that in the syntax: <code>(True, False)</code> is a 2-tuple with two booleans, but in the first variant, we put this expression twice between <em>square</em> brackets (hence a list), whereas in the latter, it is between <em>round</em> brackets (hence a tuple, or brackets to \"group\" an expression).</p>\n"}], "owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 52405400, "answer_count": 1, "score": 0, "last_activity_date": 1537358876, "creation_date": 1537358165, "question_id": 52405328, "link": "https://stackoverflow.com/questions/52405328/tuples-inside-tuples-type-different-or-similar", "title": "Tuples inside Tuples type different or similar?", "body": "<p>Is <code>[([(True, False),(True, False)])]</code> equivalent to <code>[((True, False),(True, False))]</code> in terms of typing? </p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 713, "user_id": 9074767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/649ec7f04002c8479617a6ca73da77b7?s=128&d=identicon&r=PG&f=1", "display_name": "MarcelB", "link": "https://stackoverflow.com/users/9074767/marcelb"}, "edited": false, "score": 3, "creation_date": 1537346343, "post_id": 52401396, "comment_id": 91747055, "body": "I&#39;ve seen this before but couldn&#39;t really figure out the logic behind it. Thank you a lot, I will tinker a little with this!!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1537346396, "last_edit_date": 1537346396, "creation_date": 1537345548, "answer_id": 52401396, "question_id": 52401378, "link": "https://stackoverflow.com/questions/52401378/turn-a-list-of-tuples-into-a-list-of-its-elements-with-list-comprehension/52401396#52401396", "title": "Turn a list of tuples into a list of its elements with list comprehension", "body": "<p>You can use an <em>extra</em> iteration in the right part of the list comprehension, like:</p>\n\n<pre><code>func :: [(a, a)] -&gt; [a]\nfunc xs = [ xi | (x1, x2) &lt;- xs, <b>xi &lt;- [x1, x2]</b> ]</code></pre>\n\n<p>So we write list comprehension like people would write a <em>nested</em> loop in an imperative programming language.</p>\n"}], "owner": {"reputation": 713, "user_id": 9074767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/649ec7f04002c8479617a6ca73da77b7?s=128&d=identicon&r=PG&f=1", "display_name": "MarcelB", "link": "https://stackoverflow.com/users/9074767/marcelb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 52401396, "answer_count": 1, "score": 3, "last_activity_date": 1537346396, "creation_date": 1537345482, "last_edit_date": 1537345662, "question_id": 52401378, "link": "https://stackoverflow.com/questions/52401378/turn-a-list-of-tuples-into-a-list-of-its-elements-with-list-comprehension", "title": "Turn a list of tuples into a list of its elements with list comprehension", "body": "<p>I'm currently studying for my exam in October and am confronting a problem I can't seem to figure out a good solution.</p>\n\n<p>I want to read in a list of tuples of integers like this:\n[(1,2),(3,4),(5,6),..] and want the list comprehension to return [1,2,3,4,5,6,..]</p>\n\n<p>The following works just fine but I want it to be in one list comprehension.</p>\n\n<pre><code>func :: [(Integer, Integer)] -&gt; [Integer]\nfunc xs = concat [ [x,y] | (x,y) &lt;- xs ]\n</code></pre>\n\n<p>How can I make this work?</p>\n"}, {"tags": ["haskell", "types", "ghc", "idris", "dependent-type"], "answers": [{"comments": [{"owner": {"reputation": 4138, "user_id": 30160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9cc7a433f140236fb55c21d3266cced8?s=128&d=identicon&r=PG", "display_name": "Derrick Turk", "link": "https://stackoverflow.com/users/30160/derrick-turk"}, "edited": false, "score": 0, "creation_date": 1537368974, "post_id": 52407136, "comment_id": 91761159, "body": "Thanks, Isaac! That was simultaneously a formalization of my intuition for why this was unnecessary, a concise solution, and a compelling reminder that sometimes I just need to go to bed and look at my code again in the morning."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 8, "last_activity_date": 1537364010, "creation_date": 1537364010, "answer_id": 52407136, "question_id": 52399035, "link": "https://stackoverflow.com/questions/52399035/singletons-of-singletons-emulating-complex-pi-types-in-haskell/52407136#52407136", "title": "Singletons of singletons (emulating complex pi types in Haskell)", "body": "<p><em>Yes.</em></p>\n\n<p>Consider that, by the definition of a singleton type, you have as much type information in a singleton as the <em>singleton of that singleton</em>, because they both have a unique instance.</p>\n\n<h3>In your code</h3>\n\n<p>With the above in mind, we can remove the <code>SSNat</code> and <code>SSEconPhase</code> declarations from your code. Then, in the <code>SProd</code> constructor</p>\n\n<pre><code>SProd :: SSEconPhase p - &gt; SKeyword ('Prod p)\n</code></pre>\n\n<p>We know that <code>SEconPhase</code> would be sufficient to decide <code>p</code>, so we can rewrite it as </p>\n\n<pre><code>SProd :: SEconPhase p - &gt; SKeyword ('Prod p)\n</code></pre>\n\n<p>Which produces a kind error - what we need is a type transformation like</p>\n\n<pre><code>SomeType :: (p :: EconPhase) -&gt; SEconPhase p\n</code></pre>\n\n<p>Which you already have defined in your code as <code>SingEconPhase</code>. The result is </p>\n\n<pre><code>SProd :: SEconPhase p - &gt; SKeyword ('Prod (SingEconPhase p))\n</code></pre>\n\n<h3>In general</h3>\n\n<p>You should never have to write a singleton of a singleton - if you need to \"lift\" a type parameter to the singleton type, then the correct choice is to write a type family as you have done.</p>\n"}], "owner": {"reputation": 4138, "user_id": 30160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9cc7a433f140236fb55c21d3266cced8?s=128&d=identicon&r=PG", "display_name": "Derrick Turk", "link": "https://stackoverflow.com/users/30160/derrick-turk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 2, "accepted_answer_id": 52407136, "answer_count": 1, "score": 8, "last_activity_date": 1537364010, "creation_date": 1537336519, "question_id": 52399035, "link": "https://stackoverflow.com/questions/52399035/singletons-of-singletons-emulating-complex-pi-types-in-haskell", "title": "Singletons of singletons (emulating complex pi types in Haskell)", "body": "<p>I've got a simple proof of concept in Idris which uses dependent types to enforce some not-too-complex business logic. A few names have been changed to protect the not-so-innocent, but the idea is that we want to collect \"lines\" in a sequence. Each line pertains to a specific section, but only one (<code>EconProduction</code>) has anything we care about yet. In general, lines have a section-specific keyword and an expression whose form/type may depend upon the keyword used.</p>\n\n<p>For this particular section, each line either describes some numbers for a \"phase\" (<code>Prod</code>), or continues the last named \"phase\" (<code>Continue</code>).</p>\n\n<p>In Idris, we can do this like so:</p>\n\n<pre><code>data EconSection\n  = EconGeneral\n  | EconProduction\n\ndata EconPhase\n  = Oil\n  | Water\n  | NumPhase Nat\n\ndata ContState\n  = ContNone\n  | ContProd EconPhase\n\ndata Keyword : EconSection -&gt; ContState -&gt; ContState -&gt; Type where\n  Prod : (p : EconPhase) -&gt; Keyword EconProduction c (ContProd p)\n  Continue : Keyword s c c\n\ndata Expression : (s : EconSection) -&gt;\n                  (d : ContState) -&gt;\n                  Keyword s c d -&gt;\n                  Type where\n  ExProc : Double -&gt; Double -&gt; Expression EconProduction (ContProd p) k\n\ndata Line : EconSection -&gt; ContState -&gt; ContState -&gt; Type where\n  L : (k : Keyword s c d) -&gt; Expression s d k -&gt; Line s c d\n\ndata Lines : EconSection -&gt; ContState -&gt; Type where\n  First : Line s ContNone d -&gt; Lines s d\n  Then : Lines s c -&gt; Line s c d -&gt; Lines s d\n\ninfixl 0 `Then`\n\ngood : Lines EconProduction (ContProd (NumPhase 1))\ngood = First (L (Prod Oil) (ExProc 23.2 70.1))\n      `Then` (L (Continue) (ExProc 27.9 1.2))\n      `Then` (L (Prod (NumPhase 1)) (ExProc 91.2 7014.1))\n      `Then` (L (Continue) (ExProc 91.2 7014.1))\n</code></pre>\n\n<p>So far so good! The usual dependent typestate business. For eminently practical business reasons, we wish to actually implement this logic in GHC Haskell. I've built it with singletons (rolled my own as-needed rather than use the <code>singletons</code> package, just for a short proof of concept):</p>\n\n<pre><code>{-# LANGUAGE GADTs, KindSignatures, DataKinds #-}\n{-# LANGUAGE RankNTypes, TypeInType, TypeOperators #-}\n{-# LANGUAGE TypeFamilies, TypeFamilyDependencies, MultiParamTypeClasses #-}\n\nimport Data.Kind (Type)\n\ndata Nat\n  = Z\n  | S Nat\n\ndata SNat :: Nat -&gt; Type where\n  SZ :: SNat 'Z\n  SS :: SNat n -&gt; SNat ('S n)\n\ndata SSNat :: forall (n :: Nat) . SNat n -&gt; Type where\n  SSZ :: SSNat 'SZ\n  SSS :: SSNat n -&gt; SSNat ('SS n)\n\ntype family SingNat (n :: Nat) :: SNat n where\n  SingNat 'Z = 'SZ\n  SingNat ('S n) = 'SS (SingNat n)\n\ndata EconSection\n  = EconGeneral\n  | EconProduction\n\ndata SEconSection :: EconSection -&gt; Type where\n  SEconGeneral :: SEconSection 'EconGeneral\n  SEconProduction :: SEconSection 'EconProduction\n\ntype family SingSection (s :: EconSection) :: SEconSection s where\n  SingSection 'EconGeneral = 'SEconGeneral\n  SingSection 'EconProduction = 'SEconProduction \n\ndata EconPhase\n  = Oil\n  | Water\n  | NumPhase Nat\n\ndata SEconPhase :: EconPhase -&gt; Type where\n  SOil :: SEconPhase 'Oil\n  SWater :: SEconPhase 'Water\n  SNumPhase :: SNat n -&gt; SEconPhase ('NumPhase n)\n\ndata SSEconPhase :: forall (p :: EconPhase) . SEconPhase p -&gt; Type where\n  SSOil :: SSEconPhase 'SOil\n  SSWater :: SSEconPhase 'SWater\n  SSNumPhase :: SSNat n -&gt; SSEconPhase ('SNumPhase n)\n\ntype family SingEconPhase (p :: EconPhase) :: SEconPhase p where\n  SingEconPhase 'Oil = 'SOil\n  SingEconPhase 'Water = 'SWater\n  SingEconPhase ('NumPhase n) = 'SNumPhase (SingNat n)\n\ndata ContState\n  = ContNone\n  | ContProd EconPhase\n\ndata SContState :: ContState -&gt; Type where\n  SContNone :: SContState 'ContNone\n  SContProd :: SEconPhase p -&gt; SContState ('ContProd p)\n\ntype family SingContState (c :: ContState) :: SContState c where\n  SingContState 'ContNone = 'SContNone\n  SingContState (ContProd p) = 'SContProd (SingEconPhase p)\n\ndata Keyword :: EconSection -&gt; ContState -&gt; ContState -&gt; Type where\n  Prod :: SEconPhase p -&gt; Keyword 'EconProduction c ('ContProd p)\n  Continue :: Keyword s c c\n\ndata SKeyword :: forall (s :: EconSection) (c :: ContState) (d :: ContState) .\n                 Keyword s c d -&gt; Type where\n  SProd :: SSEconPhase p -&gt; SKeyword ('Prod p)\n  SContinue :: SKeyword 'Continue\n\ndata Expression :: forall (s :: EconSection) (c :: ContState) (d :: ContState) .\n                   SEconSection s -&gt; SContState d -&gt; Keyword s c d -&gt; Type where\n  ExProc :: Double -&gt; Double -&gt; Expression SEconProduction (SContProd p) k\n\ntype family KWSection k where\n  KWSection (Keyword s _ _) = s\n\ntype family KWFrom k where\n  KWFrom (Keyword _ c _) = c\n\ntype family KWTo k where\n  KWTo (Keyword _ _ d) = d\n\ndata Line :: EconSection -&gt; ContState -&gt; ContState -&gt; Type where\n  L :: SKeyword (k :: Keyword s c d)\n    -&gt; Expression (SingSection s) (SingContState d) k\n    -&gt; Line s c d\n\ndata Lines :: EconSection -&gt; ContState -&gt; Type where\n  First :: Line s 'ContNone d -&gt; Lines s d\n  Then :: Lines s c -&gt; Line s c d -&gt; Lines s d\n\ninfixl 0 `Then`\n\ngood :: Lines 'EconProduction ('ContProd ('NumPhase ('S 'Z)))\ngood = First (L (SProd SSOil) (ExProc 23.2 70.1))\n      `Then` (L (SContinue) (ExProc 27.9 1.2))\n      `Then` (L (SProd (SSNumPhase (SSS SSZ))) (ExProc 91.2 7014.1))\n      `Then` (L (SContinue) (ExProc 91.2 7014.1))\n</code></pre>\n\n<p>Here's my question. Is there any way to avoid the \"singletons of singletons\"? I don't like the look of things like <code>SSNat</code> and so on at all, but this is where I get by translating every pi type to an extra layer of singleton-ing. I haven't been able to make any simpler approach work, and I've not seen any clever ideas in the <code>singletons</code> package to make this easier, though I might have easily missed something beneath all the Template Haskell.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1537321348, "post_id": 52396713, "comment_id": 91738261, "body": "This can also be written more succinctly with the <code>either</code> combinator, e.g.: <code>pro &lt;- either fail pure pr</code>"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1537362392, "post_id": 52396713, "comment_id": 91756888, "body": "@JonPurdy Or <code>pro &lt;- either fail return pr</code>. Beginners may not know that <code>pure == return</code>."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1537423517, "post_id": 52396713, "comment_id": 91780255, "body": "@PaulJohnson: Oops, yeah, force of habit there. I always use <code>pure</code> nowadays because it\u2019s slightly more general (<code>Applicative</code> instead of <code>Monad</code>) and I just like the name better\u2014<code>pure x</code> converts a pure value <code>x</code> into an action (which for most monads does just \u201creturn\u201d <code>x</code>), whereas <code>return x</code> is a <i>faux ami</i> of the <code>return</code> keyword for exiting (early) from a procedure in an imperative language."}], "tags": [], "owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "is_accepted": false, "score": 1, "last_activity_date": 1537721026, "last_edit_date": 1537721026, "creation_date": 1537320446, "answer_id": 52396713, "question_id": 52396645, "link": "https://stackoverflow.com/questions/52396645/returning-defined-type-from-either/52396713#52396713", "title": "Returning defined type from Either", "body": "<p>Your <code>case</code> expression has branches with different types.\n<code>fail</code> has the type <code>Monad m =&gt; String -&gt; m a</code> (so <code>fail err</code> has type <code>Monad m =&gt; m a</code>) and <code>pr</code> is a <code>Property</code>.</p>\n\n<p>That's how it gets <code>m a</code> not matching <code>Property</code>.</p>\n\n<p>If you want them to match you need to turn the <code>Property</code> into <code>m Property</code> with <code>return</code>.</p>\n\n<p>Like so:</p>\n\n<pre><code>pr &lt;- liftIO $ parseProps t\npro &lt;- case pr of\n    Left err -&gt; fail err\n    Right pr -&gt; return pr\n...\n</code></pre>\n\n<p>And do the stuff with <code>pro</code></p>\n\n<p>Also, as Jon Purdy, and Paul Johnson pointed out in the comments, there is a combinator for this operation called <code>either</code>. So this is a cleaner way to write that:</p>\n\n<pre><code>pr &lt;- liftIO $ parseProps t\npro &lt;- either fail return pr\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537721026, "creation_date": 1537319932, "question_id": 52396645, "link": "https://stackoverflow.com/questions/52396645/returning-defined-type-from-either", "title": "Returning defined type from Either", "body": "<p>I have the following type declared:</p>\n\n<pre><code>data Property = Property {mapProperty :: !Object\n                      } deriving (Show, Generic)\n</code></pre>\n\n<p>I am returning that type from the following function:</p>\n\n<pre><code>parseProps :: String -&gt; IO (Either String Property)\nparseProps m = fmap property &lt;$&gt; (eitherDecode &lt;$&gt; getMap m)\n</code></pre>\n\n<p>In the calling function, I have the following:</p>\n\n<pre><code>pr &lt;- liftIO $ parseProps t\nlet pro = case pr of\n        Left err -&gt; fail err\n        Right pr -&gt; pr\n</code></pre>\n\n<p>I get the following error from the line above (Right pr -> pr):</p>\n\n<p>Couldn't match expected type \u2018m a\u2019 with actual type \u2018Property\u2019\n\u2022 In the expression: pr\n  In a case alternative: Right pr -> pr\n  In the expression:</p>\n\n<pre><code>    case pr of {\n      Left err -&gt; fail err\n      Right pr -&gt; pr }\n</code></pre>\n\n<p>\u2022 Relevant bindings include\n    pro :: m a (bound at src/Actor/Master.hs:42:7)</p>\n\n<p>I appreciate any assistance.</p>\n"}, {"tags": ["haskell", "haskell-stack", "hoogle"], "comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1537317683, "post_id": 52396097, "comment_id": 91737536, "body": "bhoogle is a front-end to an existing hoogle database.  What do you have in your &quot;~/.hoogle&quot; directory?  You should have two files, default-haskell-5.0.17.hoo and default-haskell-5.0.17.warn,  do you?    Additionally, your hoogle version and your bhoogle version need to match, at this point, it&#39;s 5.0.17."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1537317916, "post_id": 52396097, "comment_id": 91737578, "body": "I do not have a ~/.hoogle directory.  The <code>stack install hoogle</code> appears to have only made a bhoogle binary, but made no .hoogle.  Isn&#39;t ~/.hoogle created by the generate call?"}, {"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1537318022, "post_id": 52396097, "comment_id": 91737602, "body": "When you run &quot;hoogle generate&quot; the database will be created, did it succeed?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537354991, "post_id": 52396097, "comment_id": 91752442, "body": "Sounds like you&#39;re just confused about the difference between bhoogle and hoogle. You must install both for bhoogle to work."}], "answers": [{"comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 1, "creation_date": 1537318364, "post_id": 52396429, "comment_id": 91737664, "body": "&quot;stack install hoogle&quot; will not install bhoogle.  I suspect you made a typo, check your terminal history."}], "tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": true, "score": -2, "last_activity_date": 1537318073, "creation_date": 1537318073, "answer_id": 52396429, "question_id": 52396097, "link": "https://stackoverflow.com/questions/52396097/installing-bhoogle-through-stack/52396429#52396429", "title": "Installing bhoogle through stack", "body": "<p>The answer was running:</p>\n\n<pre><code>stack install hoogle\n</code></pre>\n\n<p>twice.  </p>\n\n<p>The first time it installed many packages and said:</p>\n\n<pre><code>$ stack install hoogle\nCopied executables to /home/username/.local/bin:\n- bhoogle\n</code></pre>\n\n<p>The second time it installed no packages and said:</p>\n\n<pre><code>$ stack install hoogle\nCopying from /home/username/.stack/snapshots/x86_64-linux/lts-12.6/8.4.3/bin/hoogle to /home/username/.local/bin/hoogle\n\nCopied executables to /home/username/.local/bin:\n- hoogle\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 52396429, "answer_count": 1, "score": -1, "last_activity_date": 1537318073, "creation_date": 1537315050, "question_id": 52396097, "link": "https://stackoverflow.com/questions/52396097/installing-bhoogle-through-stack", "title": "Installing bhoogle through stack", "body": "<p>I'm <a href=\"http://hackage.haskell.org/package/hoogle\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>And see:</p>\n\n<pre><code>Command Line UI\n\nThere is a terminal/curses based UI available through cabal install bhoogle.\n</code></pre>\n\n<p>I'd like to install with stack rather than cabal.  I run</p>\n\n<pre><code>$ stack install hoogle\nCopied executables to /home/username/.local/bin:\n- bhoogle\n</code></pre>\n\n<p>This is on my path, great.  Let's run it:</p>\n\n<pre><code>$ bhoogle\n\nbhoogle error:     default hoogle database not found\n     at /home/username/.hoogle/default-haskell-5.0.17.hoo    You can create the database by installing hoogle and running\n     hoogle generate\n</code></pre>\n\n<p>Great, let's do that:</p>\n\n<pre><code>$ hoogle generate\n\nCommand 'hoogle' not found, but can be installed with:\n\nsudo apt install hoogle\n</code></pre>\n\n<p>How about calling it bhoogle instead?</p>\n\n<pre><code>$ bhoogle generate\n\nbhoogle error: \n   default hoogle database not found\n     at /home/username/.hoogle/default-haskell-5.0.17.hoo\n   You can create the database by installing hoogle and running\n     hoogle generate\n</code></pre>\n\n<p>Is it not finding the executable?  Let's use the full path:</p>\n\n<pre><code>$ /home/username/.local/bin/bhoogle generate\n\nbhoogle error: \n   default hoogle database not found\n     at /home/username/.hoogle/default-haskell-5.0.17.hoo\n   You can create the database by installing hoogle and running\n     hoogle generate\n</code></pre>\n\n<p>How can I initialize hoogle?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": -1, "last_activity_date": 1537811710, "creation_date": 1537811710, "answer_id": 52484857, "question_id": 52394677, "link": "https://stackoverflow.com/questions/52394677/how-to-install-quickcheck-on-windows/52484857#52484857", "title": "How to install QuickCheck on Windows?", "body": "<p>There probably isn't enough information in here on how you set up your sandbox or started GHCi for people to provide you with an answer. I can give you an approach to this that will work with Stack, however:</p>\n\n<pre><code>$ stack ghci --package QuickCheck\n&gt; import Test.QuickCheck\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1377, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537811710, "creation_date": 1537305239, "last_edit_date": 1537384599, "question_id": 52394677, "link": "https://stackoverflow.com/questions/52394677/how-to-install-quickcheck-on-windows", "title": "How to install QuickCheck on Windows?", "body": "<p>I use cabal to install QuickCheck in a sandbox environment and it looks good</p>\n\n<pre><code>C:\\Users\\yashi&gt;cabal install QuickCheck\nResolving dependencies...\nNotice: installing into a sandbox located at C:\\Users\\yashi\\.cabal-sandbox\nDownloading erf-2.0.0.0...\nDownloading primitive-0.6.4.0...\nDownloading random-1.1...\n...\nInstalled QuickCheck-2.12.4\n</code></pre>\n\n<p>But when I open a file, it shows </p>\n\n<pre><code>C:\\\\Users\\yashi\\OneDrive\\Desktop\\Ex1.hs:24:1: error:\n    Could not find module \u2018Test.QuickCheck\u2019\n    Use -v to see a list of the files searched for.\n   |\n24 | import Test.QuickCheck (Property, quickCheck, (==&gt;))\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\nPrelude&gt; import Test.QuickCheck\n</code></pre>\n\n<p>How can I fix it?</p>\n"}, {"tags": ["haskell", "fixpoint-combinators"], "answers": [{"comments": [{"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1537292064, "post_id": 52391271, "comment_id": 91728767, "body": "Beautifully explained. Thanks. So <code>more</code> here is a dumy variable right? Only used anytime people wants loops? Can there be a counter of loop with this use case?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1537294034, "post_id": 52391271, "comment_id": 91729673, "body": "@osager Sure, counters are possible."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1537289372, "creation_date": 1537289372, "answer_id": 52391271, "question_id": 52391224, "link": "https://stackoverflow.com/questions/52391224/how-to-understand-use-haskell-fix-function/52391271#52391271", "title": "How to understand/use Haskell fix function", "body": "<p><code>fix</code> is the fundamental tool used for implementing recursion. It can always be replaced by a recursive <code>let</code> -- and vice versa, a recursive <code>let</code> can be turned into a call to <code>fix</code>. In this example,</p>\n\n<pre><code>fix $ \\more -&gt; do\n    x &lt;- getAnyProcessStatus False False\n    when (isJust x) more\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>let more = do\n        x &lt;- getAnyProcessStatus False False\n        when (isJust x) more\nin more\n</code></pre>\n\n<p>and is essentially implementing a loop that calls <code>getAnyProcessStatus False False</code> until it returns <code>Nothing</code>.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "closed_date": 1537290417, "accepted_answer_id": 52391271, "answer_count": 1, "score": 2, "last_activity_date": 1563168144, "creation_date": 1537289191, "last_edit_date": 1563168144, "question_id": 52391224, "link": "https://stackoverflow.com/questions/52391224/how-to-understand-use-haskell-fix-function", "closed_reason": "Duplicate", "title": "How to understand/use Haskell fix function", "body": "<p>I see the following code in <code>xmonad</code> package:</p>\n\n<pre><code>-- | Ignore SIGPIPE to avoid termination when a pipe is full, and SIGCHLD to\n-- avoid zombie processes, and clean up any extant zombie processes.\ninstallSignalHandlers :: MonadIO m =&gt; m ()\ninstallSignalHandlers = io $ do\n    installHandler openEndedPipe Ignore Nothing\n    installHandler sigCHLD Ignore Nothing\n    (try :: IO a -&gt; IO (Either SomeException a))\n      $ fix $ \\more -&gt; do\n        x &lt;- getAnyProcessStatus False False\n        when (isJust x) more\n    return ()\n</code></pre>\n\n<p>It seems that this <code>fix</code> functions comes from <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Function.html\" rel=\"nofollow noreferrer\">Data.Function</a></p>\n\n<p>But I can't understand how it's used here and when would someone use this fix function?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537279981, "post_id": 52388283, "comment_id": 91721822, "body": "And an aside: the proof that <code>from (to act) = act</code> is easy. The proof that <code>to (from act)</code> is quite a bit trickier, and involves using parametricity to essentially observe that all fully-defined values of type <code>forall m. MonadIO m =&gt; Bool -&gt; m Bool</code> are equal to <code>liftIO . foo</code> for some <code>foo</code>. (Yes, even <code>liftIO bar &gt;&gt; liftIO baz</code>, which is equal to <code>liftIO (bar &gt;&gt; baz)</code> by the <code>MonadIO</code> laws.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1537279398, "last_edit_date": 1537279398, "creation_date": 1537279067, "answer_id": 52388283, "question_id": 52387403, "link": "https://stackoverflow.com/questions/52387403/haskell-monadio-vs-io/52388283#52388283", "title": "Haskell MonadIO vs IO", "body": "<p>The types <code>forall m. MonadIO m =&gt; Bool -&gt; m Bool</code> and <code>Bool -&gt; IO Bool</code> are isomorphic:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Control.Monad.IO.Class\n\nfrom :: (forall m. MonadIO m =&gt; Bool -&gt; m Bool) -&gt; (Bool -&gt; IO Bool)\nfrom act = act\n\nto :: (Bool -&gt; IO Bool) -&gt; (forall m. MonadIO m =&gt; Bool -&gt; m Bool)\nto act = liftIO . act\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/q/9243215/791604\">Not all types involving <code>IO</code> are isomorphic to a version that replaces <code>IO</code> with a constrained <code>m</code>, though.</a></p>\n\n<p>Generally, one uses <code>MonadIO m</code> instead of <code>m ~ IO</code> when they feel like scattering <code>liftIO</code> through calling code will be annoying or when there are other <code>mtl</code>-style constraints needed on <code>m</code>; and uses <code>m ~ IO</code> instead of <code>MonadIO m</code> when going for simplicity of API (where <code>MonadIO m</code> contributes to complexity and therefore is not desirable) or when dealing with forking or exception handling (where <code>MonadIO m</code> is not possible for the reasons discussed in the linked question).</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1232, "favorite_count": 2, "accepted_answer_id": 52388283, "answer_count": 1, "score": 5, "last_activity_date": 1537279398, "creation_date": 1537276287, "last_edit_date": 1537278499, "question_id": 52387403, "link": "https://stackoverflow.com/questions/52387403/haskell-monadio-vs-io", "title": "Haskell MonadIO vs IO", "body": "<p>What is the difference between the two:</p>\n\n<pre><code>recompile :: MonadIO m =&gt; Bool -&gt; m Bool\nrecompile :: Bool -&gt; IO Bool\n</code></pre>\n"}, {"tags": ["haskell", "haskell-diagrams"], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": true, "score": 3, "last_activity_date": 1537351525, "last_edit_date": 1537351525, "creation_date": 1537349830, "answer_id": 52402746, "question_id": 52385447, "link": "https://stackoverflow.com/questions/52385447/fix-arrowshaft-diagrams-library/52402746#52402746", "title": "Fix arrowShaft (Diagrams Library)", "body": "<p>I got it. After I scaled down the symbol It becomes easier to adjust the connection. </p>\n\n<p><a href=\"https://i.stack.imgur.com/sXZwg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sXZwg.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here's the changes.</p>\n\n<pre><code>...\n[input, bandpass,ssa, td, focuss, spt, outputBPM, (prior # scale 0.7)]\n...\n# connectPerim'   arrowStyleU \"prior\" \"ssa\" (0 @@ deg)  (205 @@ deg)\n...\n</code></pre>\n\n<p><strong>NOTE:</strong> \n- Adding <code>arrowTail .~ lineTail</code> <em>is critical.</em></p>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 52402746, "answer_count": 1, "score": 7, "last_activity_date": 1563043571, "creation_date": 1537269633, "last_edit_date": 1563043571, "question_id": 52385447, "link": "https://stackoverflow.com/questions/52385447/fix-arrowshaft-diagrams-library", "title": "Fix arrowShaft (Diagrams Library)", "body": "<p>I've made a <strong>data storage</strong> symbol using <code>B.difference</code> and <code>B.union</code>. The one with the red dot in the middle.</p>\n\n<pre><code>dataStorage :: Diagram B\ndataStorage =  (strokePath $ B.difference Winding  combined  block1) # translateX (-0.3)\n  where block1 = (circle 0.5)  # scaleX 0.5 # translateX (-1)\n        block2 = rect 2 1\n        block3 = (circle 0.5)  # translateX (1)\n        combined = B.union Winding $ block2 &lt;&gt; block3\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/jm5bx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jm5bx.png\" alt=\"enter image description here\"></a></p>\n\n<p>I've been trying for hours now but can't make an arrow straight between <code>Previous Estimate</code> written inside that symbol and  <code>Signal Decomposition (SSA)</code>. The goal is to draw the arrow starting at the center right outside of the symbol. Any help is welcome. Thank you very much.</p>\n\n<p>EDIT 1: Added wanted result.</p>\n\n<p><a href=\"https://i.stack.imgur.com/xfPFM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xfPFM.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here's the complete code.</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE FlexibleContexts          #-}\n{-# LANGUAGE TypeFamilies              #-}\n\nmodule FlowChartTR where\n\nimport System.Process\n--import Graphics.SVGFonts\nimport Diagrams.Backend.SVG.CmdLine\nimport Diagrams.Prelude\nimport Diagrams.TwoD.Arrow\nimport qualified Diagrams.TwoD.Path.Boolean as B\n\noneLineText txt = text txt\ntwoLineText txt1 txt2 = center $ (text txt1) === strutY 0.2 === (text txt2)\nthreeLineText txt1 txt2 txt3 = center $\n  (text txt1) === strutY 0.2 === (text txt2) === strutY 0.2 === (text txt3)\n\nterminal writeText w h r = (writeText &lt;&gt; roundedRect w h r) # lwL 0.02 # fontSize (local 0.2)\n--terminalInput = (text \"Input Data\" &lt;&gt; roundedRect 1 0.3 0.3) # lwL 0.02 # fontSize (local 0.2)\n\n\n--process txt w h = (text txt &lt;&gt; rect w h) # lwL 0.02 # fontSize (local 0.2)\nprocess  writeText w h = (writeText &lt;&gt; rect w h) # lwL 0.02 # fontSize (local 0.2)\n\ndataStorage :: Diagram B\ndataStorage =  (strokePath $ B.difference Winding  combined  block1) # translateX (-0.3)\n  where block1 = (circle 0.5)  # scaleX 0.5 # translateX (-1)\n        block2 = rect 2 1\n        block3 = (circle 0.5)  # translateX (1)\n        combined = B.union Winding $ block2 &lt;&gt; block3\n\n--decision :: Diagram B\n--decision = (text \"BPM\" &lt;&gt; rect  0.4 0.3) # lwL 0.02 # fontSize (local 0.2)\n\ninput = (terminal (oneLineText \"Input Data\") 1.2 0.3 0.3) # named \"terminalInput\"\nbandpass = (process (twoLineText \"Bandpass\" \"Filtering\") 1.5 0.5) # named \"bandpass\"\nssa = (process (threeLineText \"Signal\" \"Decomposition\" \"(SSA)\") 1.5 1) # translateY (-0.3) # named \"ssa\" # showOrigin\ntd = (process (twoLineText \"Temporal\" \"Difference\") 1 0.5) # named \"td\"\nfocuss = (process (threeLineText \"Sparse Signal\" \"Reconstruction\" \"(FOCUSS)\") 1.5 0.8) # named \"focuss\"\noutputBPM = (terminal (oneLineText \"Output BPM\") 1.2 0.3 0.3) # named \"terminalOutput\"\nspt = (process (threeLineText \"Spectral Peak\" \"Tracking\" \"Select &amp; Verif\") 1.5 0.8) # named \"spt\"\nprior = (oneLineText \"Previous Estimate\" &lt;&gt; dataStorage) # fontSize (local 0.2) # named \"prior\" #showOrigin # translateY 1\n\narrowStyle = (with &amp; arrowHead .~ dart &amp; headLength .~ large &amp; tailLength .~ veryLarge)\nushaft = trailFromVertices (map p2 [(0, 0), (0.5, 0), (0.5, 1), (1, 1)])\narrowStyleU = (with &amp; arrowHead .~ dart &amp; headLength .~ large &amp; tailLength .~ veryLarge &amp; arrowShaft .~ ushaft)\n\n\ndecision :: Diagram B\ndecision = square 5 # rotate (45 @@ deg) # scaleY 0.5\n\nplaceBlocks :: Diagram B\nplaceBlocks = atPoints [ P (V2 0 0),    -- input\n                         P (V2 4 0),    -- bandpass\n                         P (V2 8 0),    -- ssa\n                         P (V2 8 (-2)), -- td\n                         P (V2 8 (-4)), -- focuss\n                         P (V2 4 (-4)), -- spt\n                         P (V2 0 (-4)), -- outputBPM\n                         P (V2 4 (-2))  -- prior\n                       ] [input, bandpass,ssa, td, focuss, spt, outputBPM, prior]\n\nflowChart :: Diagram B\nflowChart = placeBlocks # connectOutside' arrowStyle \"terminalInput\" \"bandpass\"\n                        # connectOutside' arrowStyle \"bandpass\" \"ssa\"\n                        # connectOutside' arrowStyle \"ssa\" \"td\"\n                        # connectOutside' arrowStyle \"td\" \"focuss\"\n                        # connectOutside' arrowStyle \"focuss\" \"spt\"\n                        # connectOutside' arrowStyle \"spt\" \"terminalOutput\"\n                        # connectOutside' arrowStyle \"prior\" \"spt\"\n                        # connectOutside' arrowStyleU \"prior\" \"ssa\"\n                        # pad 1.1\n\nflowChartTR :: IO ()\nflowChartTR = mainWith flowChart\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1537258801, "post_id": 52381200, "comment_id": 91708362, "body": "Looks like the monomorphism restriction, which is enabled in GHC but disabled in GHCi for extra convenience. <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\" title=\"what is the monomorphism restriction\">stackoverflow.com/questions/32496864/&hellip;</a>"}, {"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537259361, "post_id": 52381200, "comment_id": 91708658, "body": "<code>NoMonomorphismRestriction</code> fixes that. Thanks!"}, {"owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537259559, "post_id": 52381200, "comment_id": 91708775, "body": "It would be helpful if the ghc suggested to enable this extension, but it doesn&#39;t in that case."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1537259727, "post_id": 52381200, "comment_id": 91708884, "body": "@xafizoff It would be good if you could write up what you have learned as an answer for the benefit of others. Thanks."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1537263206, "post_id": 52381200, "comment_id": 91710935, "body": "@xafizoff There are some downsides of turning it off, evaluating performance becomes more tricky, since some constants now are disguised functions and get recomputed every time. Usually one keeps MR on, and adds type signatures to <code>bar</code> like <code>bar :: (Show a) =&gt; a -&gt; IO ()</code>. Or, less commonly, writes <code>bar x = foo x</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1537265933, "post_id": 52381200, "comment_id": 91712603, "body": "@xafizoff For the most part, what you wanna do is to give explicit type signatures in your source files - that&#39;s good for documentation purposes anyway (you&#39;d be surprised how little you remember about what your own code does within a week or two)"}], "owner": {"reputation": 249, "user_id": 1722399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e98942645afd09fdd8e00853bff4f2?s=128&d=identicon&r=PG", "display_name": "xafizoff", "link": "https://stackoverflow.com/users/1722399/xafizoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1537273368, "answer_count": 0, "score": 1, "last_activity_date": 1537255921, "creation_date": 1537255921, "question_id": 52381200, "link": "https://stackoverflow.com/questions/52381200/ambiguous-type-variable-with-function-aliases", "closed_reason": "Duplicate", "title": "Ambiguous type variable with &#39;function aliases&#39;", "body": "<p>Why this code does not compile with an <code>Ambiguous type variable</code> error</p>\n\n<pre><code>foo :: (Show a) =&gt; a -&gt; IO ()\nfoo = putStrLn . show\nbar = foo\n</code></pre>\n\n<p>whereas in the GHCI the following commands work fine?</p>\n\n<pre><code>&gt; let foo :: (Show a) =&gt; a -&gt; IO (); foo = putStrLn . show\n&gt; bar = foo\n&gt; bar 1\n</code></pre>\n\n<p>Why do we need an explicit type annotation for the <code>bar</code> function?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537250432, "post_id": 52379685, "comment_id": 91703886, "body": "Your <code>return</code> is incorrect too as <code>a</code> is not defined. Perhaps fixing it would provide a hint re. <code>bind</code>."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537250627, "post_id": 52379685, "comment_id": 91703975, "body": "thanks, that was a typo. Corrected it."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537250737, "post_id": 52379685, "comment_id": 91704021, "body": "It would be helpful if you elaborate the hint in an answer"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1537251018, "post_id": 52379685, "comment_id": 91704149, "body": "Calling your type <code>ST</code> is <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad-ST.html\" rel=\"nofollow noreferrer\">slightly confusing</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1537251055, "post_id": 52379685, "comment_id": 91704162, "body": "There is only one sensible way to define <code>bind</code>. Follow the types. You have two functions (one is wrapped in State but that&#39;s not essential). You need to return a function (again wrapped, but it doesn&#39;t matter). So you start to write that function. <code>\\s -&gt; ...</code> Ok now you have an <code>s</code>, what can you do with it <i>and</i> the two functions you already have? Follow the types!"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537251543, "post_id": 52379685, "comment_id": 91704347, "body": "@n.m. is my approach of partial type (State s) right? That was the only thing I could think of. Not sure if it is right though."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537251888, "post_id": 52379685, "comment_id": 91704497, "body": "Looks ok to me but you want to define bind to be sure. If you can, then it&#39;s correct."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1537252005, "post_id": 52379685, "comment_id": 91704553, "body": "It is sort of partial type, because the type State needs two &#39;s&#39; and &#39;a&#39;, but I have kind of defined a partial type (State s). I dont know enough about this"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1537275782, "post_id": 52379685, "comment_id": 91718899, "body": "@n.m. There&#39;s <a href=\"https://lukepalmer.wordpress.com/2008/08/10/mindfuck-the-reverse-state-monad/\" rel=\"nofollow noreferrer\">more than one sensible way to define <code>bind</code></a>; and following the types is not enough to prevent bugs: even in the standard implementation of <code>bind</code> there are multiple values of type <code>s</code> floating around at the point where you have to return a <code>(b,s)</code>, so it is easy to put the wrong one and have a buggy but type-correct implementation."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537280166, "post_id": 52379685, "comment_id": 91721937, "body": "@DanielWagner Indeed there are two things of type <code>s</code>, one that you&#39;ve got as an input and one you compute with the left operand of <code>bind</code>. Yes you need to be equipped with some common sense to return the correct one. Or enable warnings and get a message about an unused local bind."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1537253604, "last_edit_date": 1537253604, "creation_date": 1537253104, "answer_id": 52380434, "question_id": 52379685, "link": "https://stackoverflow.com/questions/52379685/how-to-derive-a-state-monad-from-first-principles/52380434#52380434", "title": "How to derive a state monad from first principles?", "body": "<p>Your composed function <code>fex3</code> has the wrong type:</p>\n\n<pre><code>fex3 :: Int -&gt; (Int, Int)\n</code></pre>\n\n<p>Unlike with your <code>sqrtInvLog'</code> example for <code>Maybe</code>', <code>State</code> does not appear in the type of <code>fex3</code>.</p>\n\n<p>We could define it as</p>\n\n<pre><code>fex3 :: Int -&gt; State Int Int\nfex3 x = State { runState = \\s -&gt;\n    let (y, st) = runState (fex1 x) s in\n        runState (fex2 y) st }\n</code></pre>\n\n<p>The main difference to your definition is that instead of hardcoding <code>0</code> as the initial state, we pass on our own state <code>s</code>.</p>\n\n<p>What if (like in your <code>Maybe</code> example) we wanted to compose three functions? Here I'll just reuse <code>fex2</code> instead of introducing another intermediate function:</p>\n\n<pre><code>fex4 :: Int -&gt; State Int Int\nfex4 x = State { runState = \\s -&gt;\n        let (y, st) = runState (fex1 x) s in\n            let (z, st') = runState (fex2 y) st in\n                runState (fex2 z) st' }\n</code></pre>\n\n<hr>\n\n<p><strong><em>SPOILERS:</em></strong></p>\n\n<p>The generalized version <code>bindState</code> can be extracted as follows:</p>\n\n<pre><code>bindState m f = State { runState = \\s -&gt;\n    let (x, st) = runState m s in\n    runState (f x) st }\n\nfex3' x = fex1 x `bindState` fex2\nfex4' x = fex1 x `bindState` fex2 `bindState` fex2\n</code></pre>\n\n<hr>\n\n<p>We can also start with <code>Monad'</code> and types.</p>\n\n<p>The <code>m</code> in the definition of <code>Monad'</code> is applied to one type argument (<code>m a</code>, <code>m b</code>). We can't set <code>m = State</code> because <code>State</code> requires two arguments. On the other hand, partial application is perfectly valid for types: <code>State s a</code> really means <code>(State s) a</code>, so we can set <code>m = State s</code>:</p>\n\n<pre><code>instance Monad' (State s) where\n   -- return' :: a -&gt; m a (where m = State s)\n   -- return' :: a -&gt; State s a\n   return' x = State { runState = \\s -&gt; (x,s) }\n\n   -- bind' :: m a -&gt; (a -&gt; m b) -&gt; m b (where m = State s)\n   -- bind' :: State s a -&gt; (a -&gt; State s b) -&gt; State s b\n   bind' st f =\n   -- Good so far: we have two arguments\n   --   st :: State s a\n   --   f :: a -&gt; State s b\n   -- We also need a result\n   --   ... :: State s b\n   -- It must be a State, so we can start with:\n       State { runState = \\s -&gt;\n   -- Now we also have\n   --   s :: s\n   -- That means we can run st:\n           let (x, s') = runState st s in\n   --   runState :: State s a -&gt; s -&gt; (a, s)\n   --   st :: State s a\n   --   s :: s\n   --   x :: a\n   --   s' :: s\n   -- Now we have a value of type 'a' that we can pass to f:\n   --   f x :: State s b\n   -- We are already in a State { ... } context, so we need\n   -- to return a (value, state) tuple. We can get that from\n   -- 'State s b' by using runState again:\n           runState (f x) s'\n       }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "is_accepted": false, "score": 1, "last_activity_date": 1537371041, "last_edit_date": 1537371041, "creation_date": 1537367804, "answer_id": 52408388, "question_id": 52379685, "link": "https://stackoverflow.com/questions/52379685/how-to-derive-a-state-monad-from-first-principles/52408388#52408388", "title": "How to derive a state monad from first principles?", "body": "<p>Have a look to <a href=\"https://www.quora.com/What-is-a-state-monad\" rel=\"nofollow noreferrer\">this</a>. Summing and extending a bit.</p>\n\n<p>If you have a function</p>\n\n<pre><code>ta -&gt; tb\n</code></pre>\n\n<p>and want to add \"state\" to it, then you should pass that state along, and have</p>\n\n<pre><code>(ta, ts) -&gt; (tb, ts)\n</code></pre>\n\n<p>You can transform this by currying it:</p>\n\n<pre><code>ta -&gt; ts -&gt; (tb, ts)\n</code></pre>\n\n<p>If you compare this with the original <code>ta -&gt; tb</code>, we obtain (adding parentheses)</p>\n\n<pre><code>ta -&gt; (ts -&gt; (tb, ts))\n</code></pre>\n\n<p><strong>Summing up, if a function returns <code>tb</code> from <code>ta</code> (i.e. <code>ta -&gt; tb</code>), a \"stateful\"\nversion of it will return (<code>ts -&gt; (tb, ts)</code>) from <code>ta</code> (i.e. <code>ta -&gt; (ts -&gt; (tb, ts))</code>)</strong></p>\n\n<p><strong>Therefore, a \"stateful computation\" (just one function, or either a chain of functions dealing with state) must return/produce this:</strong></p>\n\n<pre><code>(ts -&gt; (tb, ts))\n</code></pre>\n\n<p>This is the typical case of a stack of ints.\n<code>[Int]</code> is the State</p>\n\n<pre><code>pop :: [Int] -&gt; (Int, [Int]) -- remove top\npop (v:s) -&gt; (v, s)\n\npush :: Int -&gt; [Int] -&gt; (int, [Int]) -- add to the top\npush v s -&gt; (v, v:s)\n</code></pre>\n\n<p>For <code>push</code>, the type of <code>push 5</code> is the same than type of <code>pop :: [Int] -&gt; (Int, [Int])</code>.\nSo we would like to combine/join this basic operations to get things as</p>\n\n<pre><code>duplicateTop =\n   v &lt;- pop\n   push v\n   push v\n</code></pre>\n\n<p>Note that, as desired, <code>duplicateTop :: [Int] -&gt; (Int, [Int])</code></p>\n\n<p><strong>Now: how to combine two stateful computations to get a new one?</strong>\nLet's do it (Caution: this definition is not the same that the\nused for the <code>bind</code> of monad (<code>&gt;&gt;=</code>) but it is equivalent).</p>\n\n<p>Combine:</p>\n\n<pre><code>f :: ta -&gt; (ts -&gt; (tb, ts))\n</code></pre>\n\n<p>with</p>\n\n<pre><code>g :: tb -&gt; (ts -&gt; (tc, ts))\n</code></pre>\n\n<p>to get</p>\n\n<pre><code>h :: ta -&gt; (ts -&gt; (tc, ts))\n</code></pre>\n\n<p>This is the construction of h (in pseudo-haskell)</p>\n\n<pre><code>h = \\a -&gt; ( \\s -&gt; (c, s') )\n</code></pre>\n\n<p>where we have to calculate <code>(c, s')</code> (the rest in the expressions are just parameters <code>a</code> and <code>s</code>). Here it is how:</p>\n\n<pre><code>                   -- 1. run f using a and s\n  l1 = f a         -- use the parameter a to get the function (ts -&gt; (tb, ts)) returned by f \n  (b, s1) = l1 s   -- use the parameter s to get the pair that l1 returns ( :: (tb, ts) )\n                   -- 2. run g using f output, b and s1\n  l2  = g b        -- use b to get the function (ts -&gt; (tb, ts)) returned by g\n  (c, s') = l2 s1  -- use s1 to get the pair that l2 returns ( :: (tc, ts) ) \n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 52380434, "answer_count": 2, "score": 2, "last_activity_date": 1537371041, "creation_date": 1537249614, "last_edit_date": 1537287986, "question_id": 52379685, "link": "https://stackoverflow.com/questions/52379685/how-to-derive-a-state-monad-from-first-principles", "title": "How to derive a state monad from first principles?", "body": "<p>I am trying to come up with an implementation of State Monad derived from examples of function composition. Here I what I came up with:</p>\n\n<p>First deriving the concept of Monad:</p>\n\n<pre><code>data Maybe' a = Nothing' | Just' a deriving Show\n\nsqrt' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\nsqrt' x = if x &lt; 0 then Nothing' else Just' (sqrt x)\n\ninv' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\ninv' x = if x == 0 then Nothing' else Just' (1/x)\n\nlog' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\nlog' x = if x == 0 then Nothing' else Just' (log x)\n</code></pre>\n\n<p>We can have function that composes these functions as follows:</p>\n\n<pre><code>sqrtInvLog' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\nsqrtInvLog' x = case (sqrt' x) of\n                  Nothing' -&gt; Nothing'\n                  (Just' y) -&gt; case (inv' y) of\n                                Nothing' -&gt; Nothing'\n                                (Just' z) -&gt; log' z\n</code></pre>\n\n<p>This could be simplified by factoring out the case statement and function application:</p>\n\n<pre><code>fMaybe' :: (Maybe' a) -&gt; (a -&gt; Maybe' b) -&gt; Maybe' b\nfMaybe' Nothing' _ = Nothing'\nfMaybe' (Just' x) f = f x\n\n-- Applying fMaybe' =&gt;\nsqrtInvLog'' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\nsqrtInvLog'' x = (sqrt' x) `fMaybe'` (inv') `fMaybe'` (log')`\n</code></pre>\n\n<p>Now we can generalize the concept to any type, instead of just Maybe' by defining a Monad =></p>\n\n<pre><code>class Monad' m where\n  bind' :: m a -&gt; (a -&gt; m b) -&gt; m b\n  return' :: a -&gt; m a\n\ninstance Monad' Maybe' where\n  bind' Nothing' _ = Nothing'\n  bind' (Just' x) f = f x\n  return' x = Just' x\n</code></pre>\n\n<p>Using Monad' implementation, sqrtInvLog'' can be written as:</p>\n\n<pre><code>sqrtInvLog''' :: (Floating a, Ord a) =&gt; a -&gt; Maybe' a\nsqrtInvLog''' x = (sqrt' x) \\bind'` (inv') `bind'` (log')`\n</code></pre>\n\n<p>Trying to apply the concept to maintain state, I defined something as shown below:</p>\n\n<pre><code>data St a s = St (a,s) deriving Show\n\nsqrtLogInvSt' :: (Floating a, Ord a) =&gt; St a a -&gt; St (Maybe' a) a\nsqrtLogInvSt' (St (x,s)) = case (sqrt' x) of\n                             Nothing' -&gt; St (Nothing', s)\n                             (Just' y) -&gt; case (log' y) of\n                                            Nothing' -&gt; St (Nothing', s+y)\n                                            (Just' z) -&gt; St (inv' z, s+y+z)\n</code></pre>\n\n<p>It is not possible to define a monad using the above definition as bind needs to be defined as taking in a single type \"m a\".</p>\n\n<p>Second attempt based on Haskell's definition of State Monad:</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a, s) }\n</code></pre>\n\n<p>First attempt to define function that is built using composed functions and maintains state:</p>\n\n<pre><code>fex1 :: Int-&gt;State Int Int\nfex1 x = State { runState = \\s-&gt;(r,(s+r)) } where r = x `mod` 2`\n\nfex2 :: Int-&gt;State Int Int\nfex2 x = State { runState = \\s-&gt; (r,s+r)} where r = x * 5\n</code></pre>\n\n<p>A composed function:</p>\n\n<pre><code>fex3 x = (runState (fex2 y)) st where (st, y) = (runState (fex1 x)) 0\n</code></pre>\n\n<p>But the definition <code>newtype State s a = State { runState :: s -&gt; (a, s) }</code> does not fit the pattern of <code>m a -&gt; (a -&gt; m b) -&gt; m b</code> of bind</p>\n\n<p>An attempt could be made as follows:</p>\n\n<pre><code>instance Monad' (State s) where\n   bind' st f = undefined\n   return' x = State { runState = \\s -&gt; (x,s) }\n</code></pre>\n\n<p>bind' is undefined above becuase I did not know how I would implement it.</p>\n\n<p>I could derive why monads are useful and apply it the first example (Maybe') but cannot seem to apply it to State. It will be useful to understand how I could derive the State Moand using concepts defined above.</p>\n\n<p>Note that I have asked a similar question earlier: <a href=\"https://stackoverflow.com/questions/52205421/haskell-unable-to-define-a-state-monad-like-function-using-a-monad-like-defini\">Haskell - Unable to define a State monad like function using a Monad like definition</a> but I have expanded here and added more details.</p>\n"}, {"tags": ["haskell", "types", "compiler-errors", "parametric-polymorphism", "monomorphism-restriction"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537191926, "post_id": 52369203, "comment_id": 91682747, "body": "I can not reproduce this. Did you added a signature, or a made a call with this <code>lengthList</code>?"}, {"owner": {"reputation": 103, "user_id": 9306372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23d2a902513dac1fd4cd8e9acc9c706?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Nikitin", "link": "https://stackoverflow.com/users/9306372/alexey-nikitin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537192161, "post_id": 52369203, "comment_id": 91682913, "body": "I just load one-line module with GHCi 8.4.3    ~\\Desktop\\hskl&gt; ghci .\\lenListFoldr.hs GHCi, version 8.4.3: <a href=\"http://www.haskell.org/ghc/\" rel=\"nofollow noreferrer\">haskell.org/ghc</a>  :? for help [1 of 1] Compiling Main             ( lenListFoldr.hs, interpreted )  lenListFoldr.hs:1:14: error:     * Ambiguous type variable <code>t0&#39; arising from a use of </code>foldr&#39;     ...."}, {"owner": {"reputation": 451, "user_id": 6503034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d905b86d8e26779f9f0feda1510c6b0?s=128&d=identicon&r=PG&f=1", "display_name": "Jordi Jordi", "link": "https://stackoverflow.com/users/6503034/jordi-jordi"}, "edited": false, "score": 0, "creation_date": 1537192776, "post_id": 52369203, "comment_id": 91683376, "body": "length:: (Foldable f, Num a) =&gt; f a -&gt; a    you need to explicit is Foldable"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1537193104, "post_id": 52369203, "comment_id": 91683594, "body": "@WillemVanOnsem It works straight away in GHCi due to the monomorphism restriction being disabled."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1537193238, "post_id": 52369203, "comment_id": 91683691, "body": "@duplode: aarrghh... yes :s."}], "answers": [{"tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": true, "score": 3, "last_activity_date": 1537244026, "last_edit_date": 1537244026, "creation_date": 1537192464, "answer_id": 52369427, "question_id": 52369203, "link": "https://stackoverflow.com/questions/52369203/haskell-count-length-using-foldr-throw-type-error/52369427#52369427", "title": "Haskell count length using foldr throw type error", "body": "<p>Add type signature:</p>\n\n<pre><code>lengthList :: [a] -&gt; Int\n</code></pre>\n\n<p>Or something similar. The error states: \"Probable fix: use a type annotation to specify what `t0' should be.\" In other words, the compiler could not infer the type. Or, as a comment states: use the function in a context, then the compiler will use the context to infer correct type for <code>lengthList</code>. I believe the function <code>foldr</code> uses a class constraint <code>Foldable t</code>; in your case, the compiler doesn't know what <code>lengthList</code> is folding. By giving the signature above, you bound <code>t0</code> to be a list. Take a look at the output GHCi gives for</p>\n\n<pre><code>:t foldr\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>In short, GHC can figure out that <code>a</code> is unused and <code>b</code> is a <code>Num</code>, but it does not know <code>t</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1537192770, "post_id": 52369488, "comment_id": 91683369, "body": "&quot;It strange, but if just paste function to interpreter, it will be works fine without type definition&quot; -- That is because GHCi by default disables <a href=\"https://stackoverflow.com/q/32496864/2751851\">the monomorphism restriction</a>."}], "tags": [], "owner": {"reputation": 103, "user_id": 9306372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23d2a902513dac1fd4cd8e9acc9c706?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Nikitin", "link": "https://stackoverflow.com/users/9306372/alexey-nikitin"}, "is_accepted": false, "score": 3, "last_activity_date": 1537192656, "creation_date": 1537192656, "answer_id": 52369488, "question_id": 52369203, "link": "https://stackoverflow.com/questions/52369203/haskell-count-length-using-foldr-throw-type-error/52369488#52369488", "title": "Haskell count length using foldr throw type error", "body": "<p>It can be solved by type definition:</p>\n\n<pre><code>lengthList :: (Foldable t, Num a1) =&gt; t a2 -&gt; a1\n</code></pre>\n\n<p>It strange, but if just paste function to interpreter, it will be works fine without type definition</p>\n"}], "owner": {"reputation": 103, "user_id": 9306372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23d2a902513dac1fd4cd8e9acc9c706?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Nikitin", "link": "https://stackoverflow.com/users/9306372/alexey-nikitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 52369427, "answer_count": 2, "score": 3, "last_activity_date": 1537244026, "creation_date": 1537191831, "last_edit_date": 1537204625, "question_id": 52369203, "link": "https://stackoverflow.com/questions/52369203/haskell-count-length-using-foldr-throw-type-error", "title": "Haskell count length using foldr throw type error", "body": "<p>Trying to implement list counting through foldr function</p>\n\n<pre><code>lengthList = foldr (\\x s -&gt; s + 1) 0 \n</code></pre>\n\n<p>gives following error</p>\n\n<pre><code>   * Ambiguous type variable `t0' arising from a use of `foldr'\n  prevents the constraint `(Foldable t0)' from being solved.\n  Relevant bindings include\n    lengthList :: t0 a -&gt; Integer (bound at lenListFoldr.hs:2:1)\n  Probable fix: use a type annotation to specify what `t0' should be.\n  These potential instances exist:\n    instance Foldable (Either a) -- Defined in `Data.Foldable'\n    instance Foldable Maybe -- Defined in `Data.Foldable'\n    instance Foldable ((,) a) -- Defined in `Data.Foldable'\n    ...plus one other\n    ...plus 23 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the expression: foldr (\\ x s -&gt; s + 1) 0\n  In an equation for `lengthList':\n      lengthList = foldr (\\ x s -&gt; s + 1) 0\n</code></pre>\n\n<p>How can I fix that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537189210, "post_id": 52367808, "comment_id": 91680885, "body": "<a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Real.html#line-489\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 2, "creation_date": 1537189336, "post_id": 52367808, "comment_id": 91680975, "body": "<code>if k even</code> and likewise <code>if k odd</code> does not make sense and will not compile, i think you wanted <code>where even = ...</code>. Also GHCi will let you interactively work through errors while giving feedback. Use it to test your comments."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537212576, "post_id": 52367808, "comment_id": 91693798, "body": "These days, we have a better type than <code>Integer</code> for the exponent. Import <code>Numeric. Natural</code> and use <code>power2 :: Integer -&gt; Natural -&gt; Integer</code>. Then you don&#39;t have to worry about the exponent being negative, because it <i>can&#39;t</i> be."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1537216732, "post_id": 52367808, "comment_id": 91695521, "body": "<code>Numeric.Natural</code> just hides the runtime error; <code>power2 3 (-5)</code> would still typecheck."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1537212424, "post_id": 52368682, "comment_id": 91693735, "body": "Using <code>| ... = True | otherwise = False</code> is generally considered poor style. You have the truth value already: just use it! Similarly, you should flip them with <code>not</code> rather than guards. I&#39;ve edited your answer to follow convention."}, {"owner": {"reputation": 2148, "user_id": 2123044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09b60fbac0a47f3a243ac1e5b86eef60?s=128&d=identicon&r=PG", "display_name": "st4hoo", "link": "https://stackoverflow.com/users/2123044/st4hoo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537252460, "post_id": 52368682, "comment_id": 91704779, "body": "@dfeuer: I was trying to make the example more readable and understandable for newcomer. In real world scenario there would not be a need to substitute standard <code>even</code> and <code>odd</code> functions. Thanks for your opinion anyway."}], "tags": [], "owner": {"reputation": 2148, "user_id": 2123044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09b60fbac0a47f3a243ac1e5b86eef60?s=128&d=identicon&r=PG", "display_name": "st4hoo", "link": "https://stackoverflow.com/users/2123044/st4hoo"}, "is_accepted": true, "score": 5, "last_activity_date": 1537212315, "last_edit_date": 1537212315, "creation_date": 1537190151, "answer_id": 52368682, "question_id": 52367808, "link": "https://stackoverflow.com/questions/52367808/different-formula-depending-on-if-its-odd-or-even/52368682#52368682", "title": "Different formula depending on if it&#39;s odd or even", "body": "<p><code>even</code> and <code>odd</code> are functions in Haskell and you may use them directly inside guards conditions to test if a number is even/odd. </p>\n\n<p>Below is one option:</p>\n\n<pre><code>power2 :: Integer -&gt; Integer -&gt; Integer \npower2 n 0 = 1\npower2 n k\n   | k &lt; 0  = error \"negative argument\"\n   | even k = power2 (n * n) (div k 2)\n   | odd  k = n * ( power2 n (k-1) )\n</code></pre>\n\n<p><a href=\"http://zvon.org/other/haskell/Outputprelude/odd_f.html\" rel=\"nofollow noreferrer\">http://zvon.org/other/haskell/Outputprelude/odd_f.html</a>\n<a href=\"http://zvon.org/other/haskell/Outputprelude/even_f.html\" rel=\"nofollow noreferrer\">http://zvon.org/other/haskell/Outputprelude/even_f.html</a></p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Of course you may write your own version of even/odd functions and use them as an alternative. </p>\n\n<p>Example:</p>\n\n<pre><code>myEven :: Integer -&gt; Bool\nmyEven n = n `mod` 2 == 0\n\nmyOdd :: Integer -&gt; Bool\nmyOdd n = n `mod` 2 == 1\n\npower2 :: Integer -&gt; Integer -&gt; Integer \npower2 n 0 = 1\npower2 n k\n   | k &lt; 0  = error \"negative argument\"\n   | myEven k = power2 (n * n) (div k 2)\n   | myOdd  k = n * ( power2 n (k-1) )\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 10338282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8045145181da08fe82ae57c4dade02a?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bernhardt", "link": "https://stackoverflow.com/users/10338282/tobias-bernhardt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 52368682, "answer_count": 1, "score": 1, "last_activity_date": 1537212315, "creation_date": 1537187429, "last_edit_date": 1537188020, "question_id": 52367808, "link": "https://stackoverflow.com/questions/52367808/different-formula-depending-on-if-its-odd-or-even", "title": "Different formula depending on if it&#39;s odd or even", "body": "<p>I'm trying to create a code in Haskell that does n^k\u2004=\u2004(n\u2005*\u2005n)^(k/2) when k is even, and n^k\u2004=\u2004n\u2005*\u2005(n^(k\u22121)) if k is odd. \nI'm doing something wrong, but I can't figure out how to solve it.</p>\n\n<pre><code>power2 :: Integer -&gt; Integer -&gt; Integer \npower2 n 0 = 1\npower2 n k\n   | k &lt; 0 = error \"negative argument\"\n   | k `mod` 2 == 0 = even            -- Am I supposed to write  = even here?\n   | otherwise = odd\nif k even = (n 2) ( div k 2)       -- (n^2)^(k/2)  ???\nif k odd = n * (n) (k-1))          -- Is this n^(k-1) ???\n</code></pre>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1537201014, "post_id": 52367608, "comment_id": 91688493, "body": "A <code>data family</code> is not much more than a way to group together several newtype/data declarations. In fact, you can almost think of a data family as an injective open type family (where each <code>data instance</code> corresponds to a data decl and a <code>type instance</code> to that decl). That analogy breaks down in two places (that I can think of): data family type constructors can be partially applied and data family type constructors have stronger typing rules (<code>MyDataFamily a ~ g b</code> implies <code>MyDataFamily ~ g</code> and <code>a ~ b</code>, while <code>MyInjectiveTyFam a ~ MyInjectiveTyFam b</code> implies <code>a ~ b</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537426299, "post_id": 52370623, "comment_id": 91781522, "body": "&quot;you can largely emulate DFs just using GADTs&quot; is I think misleading, because you could have a DF instance that&#39;s a newtype <a href=\"https://stackoverflow.com/questions/52417415/data-family-instances-newtype-data\" title=\"data family instances newtype data\">stackoverflow.com/questions/52417415/&hellip;</a>; emulating that as a GADT would block it from being a newtype. I&#39;d rather say that a top-level GADT is like a DF with only one instance, in which the instance head is <code>DF a</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 6, "last_activity_date": 1537202174, "last_edit_date": 1537202174, "creation_date": 1537196435, "answer_id": 52370623, "question_id": 52367608, "link": "https://stackoverflow.com/questions/52367608/differences-gadt-data-family-data-family-that-is-a-gadt/52370623#52370623", "title": "differences: GADT, data family, data family that is a GADT", "body": "<p>As a start, you should think of a data family as a collection of independent ADTs that happen to be indexed by a type, while a GADT is a single data type with an inferrable type parameter where constraints on that parameter (typically, equality constraints like <code>a ~ Int</code>) can be brought into scope by pattern matching.</p>\n\n<p>This means that the biggest difference is that, contrary to what I think you're claiming in part of your question, for a plain data family, matching on a constructor does <strong>not</strong> perform any inference on the type parameter.  In particular, this typechecks:</p>\n\n<pre><code>inferGADT :: GADT a -&gt; a\ninferGADT (MkGADT n) = n\n</code></pre>\n\n<p>but this does <em>not</em>:</p>\n\n<pre><code>inferDF :: DF a -&gt; a\ninferDF (MkDF n) = n\n</code></pre>\n\n<p>and without type signatures, the first would fail to type check (with a mysterious \"untouchable\" message) while the second would be inferred as <code>DF Int -&gt; Int</code>.</p>\n\n<p>The situation becomes quite a bit more confusing for something like your <code>FGADT</code> type that combines data families with GADTs, and I confess I haven't really thought about how this works in detail.  But, as an interesting example, consider:</p>\n\n<pre><code>data family Foo a b\ndata instance Foo Int a where\n  Bar :: Double -&gt; Foo Int Double\n  Baz :: String -&gt; Foo Int String\ndata instance Foo Char Double where\n  Quux :: Double -&gt; Foo Char Double\ndata instance Foo Char String where\n  Zlorf :: String -&gt; Foo Char String\n</code></pre>\n\n<p>In this case, <code>Foo Int a</code> is a GADT with an inferrable <code>a</code> parameter:</p>\n\n<pre><code>fooint :: Foo Int a -&gt; a\nfooint (Bar x) = x + 1.0\nfooint (Baz x) = x ++ \"ish\"\n</code></pre>\n\n<p>but <code>Foo Char a</code> is just a collection of separate ADTs, so this won't typecheck:</p>\n\n<pre><code>foodouble :: Foo Char a -&gt; a\nfoodouble (Quux x) = x\n</code></pre>\n\n<p>for the same reason <code>inferDF</code> won't typecheck above.</p>\n\n<p>Now, getting back to your plain <code>DF</code> and <code>GADT</code> types, you can largely emulate <code>DFs</code> just using <code>GADTs</code>.  For example, if you have a DF:</p>\n\n<pre><code>data family MyDF a\ndata instance MyDF Int where\n  IntLit :: Int -&gt; MyDF Int\n  IntAdd :: MyDF Int -&gt; MyDF Int -&gt; MyDF Int\ndata instance MyDF Bool where\n  Positive :: MyDF Int -&gt; MyDF Bool\n</code></pre>\n\n<p>you can write it as a GADT just by writing separate blocks of constructors:</p>\n\n<pre><code>data MyGADT a where\n  -- MyGADT Int\n  IntLit' :: Int -&gt; MyGADT Int\n  IntAdd' :: MyGADT Int -&gt; MyGADT Int -&gt; MyGADT Int\n  -- MyGADT Bool\n  Positive' :: MyGADT Int -&gt; MyGADT Bool\n</code></pre>\n\n<p>So, in some ways, GADTs are generalizations of data families.  However, a major use case for data families is defining associated data types for classes:</p>\n\n<pre><code>class MyClass a where\n  data family MyRep a\ninstance MyClass Int where\n  data instance MyRep Int = ...\ninstance MyClass String where\n  data instance MyRep String = ...\n</code></pre>\n\n<p>where the \"open\" nature of data families is needed (and where the pattern-based inference methods of GADTs aren't helpful).</p>\n"}, {"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1537207643, "post_id": 52372731, "comment_id": 91691624, "body": "This is very helpful!  I hope you don&#39;t mind, but I added a note about the <code>forall a. forall s. Num s=&gt; ...</code> syntax corresponding to <code>() =&gt; Num s =&gt; ...</code>, as I&#39;d never previously realized this and assume that I&#39;m not the only one."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537209473, "post_id": 52372731, "comment_id": 91692498, "body": "Why do you say lies?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1537209979, "post_id": 52372731, "comment_id": 91692707, "body": "Perhaps not outright falsehoods, but definitely lying by omission. GADT definition constructor types are only accurate when used as functions. If you don&#39;t consider the pattern types, <code>data D a where D :: Int -&gt; D Int</code> and <code>data family D a; data instance D Int = D Int</code> seem like they should bahave similarly: <code>D :: Int -&gt; D Int</code>. But this is misleading; the truth is <code>pattern D :: forall a. () =&gt; (a ~ Int) =&gt; Int -&gt; D a</code> and <code>pattern D :: Int -&gt; D Int</code> and those are not the same."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537223126, "post_id": 52372731, "comment_id": 91697614, "body": "Downvoted: explaining 2 tricky concepts in terms of 2 more (pattern signatures and existential quant), and then another (singletons) is the opposite of helpful. I wish I&#39;d not read your answer. I&#39;m now more confused."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1537229239, "post_id": 52372731, "comment_id": 91698956, "body": "@AntC is this better?"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1537269184, "post_id": 52372731, "comment_id": 91714580, "body": "Thank you for trying. I feel you&#39;re giving me a brain dump of everything you know about data decls. That&#39;s a Good Thing if others are getting insights: on SO there&#39;s not much on the topic; GHC&#39;s docos notoriously describe each extension separately, and are poor at explaining how they interact or interfere. For me, you seem to have answered a lot of questions I didn&#39;t ask and am not ready for. It would be a shame for this info to get buried/be difficult to search; I suggest you break it down into separate answers, and post on SO each question you think you&#39;re addressing and your answer."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 4, "last_activity_date": 1537229226, "last_edit_date": 1537229226, "creation_date": 1537204371, "answer_id": 52372731, "question_id": 52367608, "link": "https://stackoverflow.com/questions/52367608/differences-gadt-data-family-data-family-that-is-a-gadt/52372731#52372731", "title": "differences: GADT, data family, data family that is a GADT", "body": "<p>I think the difference becomes clear if we use <code>PatternSynonyms</code>-style type signatures for data constructors. Lets start with Haskell 98</p>\n\n<pre><code>data D a = D a a\n</code></pre>\n\n<p>You get a pattern type:</p>\n\n<pre><code>pattern D :: forall a. a -&gt; a -&gt; D a\n</code></pre>\n\n<p>it can be read in two directions. <code>D</code>, in \"forward\" or expression contexts, says, \"<code>forall a</code>, you can give me 2 <code>a</code>s and I'll give you a <code>D a</code>\". \"Backwards\", as a pattern, it says, \"<code>forall a</code>, you can give me a <code>D a</code> and I'll give you 2 <code>a</code>s\".</p>\n\n<p>Now, the things you write in a GADT definition are not pattern types. What are they? Lies. Lies lies lies. Give them attention only insofar as the alternative is writing them out manually with <code>ExistentialQuantification</code>. Let's use this one</p>\n\n<pre><code>data GD a where\n  GD :: Int -&gt; GD Int\n</code></pre>\n\n<p>You get</p>\n\n<pre><code>--                      vv ignore\npattern GD :: forall a. () =&gt; (a ~ Int) =&gt; Int -&gt; GD a\n</code></pre>\n\n<p>This says: <code>forall a</code>, you can give me a <code>GD a</code>, and I can give you a proof that <code>a ~ Int</code>, plus an <code>Int</code>.</p>\n\n<p>Important observation: The return/match type of a GADT constructor is <em>always</em> the \"data type head\". I defined <code>data GD a where ...</code>; I got <code>GD :: forall a. ... GD a</code>. This is also true for Haskell 98 constructors, and also <code>data family</code> constructors, though it's a bit more subtle.</p>\n\n<p>If I have a <code>GD a</code>, and I don't know what <code>a</code> is, I can pass into <code>GD</code> anyway, even though I wrote <code>GD :: Int -&gt; GD Int</code>, which seems to say I can only match it with <code>GD Int</code>s. This is why I say GADT constructors lie. The pattern type never lies. It clearly states that, <code>forall a</code>, I can match a <code>GD a</code> with the <code>GD</code> constructor and get evidence for <code>a ~ Int</code> and a value of <code>Int</code>.</p>\n\n<p>Ok, <code>data family</code>s. Lets not mix them with GADTs yet.</p>\n\n<pre><code>data Nat = Z | S Nat\ndata Vect (n :: Nat) (a :: Type) :: Type where\n  VNil :: Vect Z a\n  VCons :: a -&gt; Vect n a -&gt; Vect (S n) a -- try finding the pattern types for these btw\n\ndata family Rect (ns :: [Nat]) (a :: Type) :: Type\nnewtype instance Rect '[] a = RectNil a\nnewtype instance Rect (n : ns) a = RectCons (Vect n (Rect ns a))\n</code></pre>\n\n<p>There are actually <em>two</em> data type heads now. As @K.A.Buhr says, the different <code>data instance</code>s act like different data types that just <em>happen</em> to share a name. The pattern types are</p>\n\n<pre><code>pattern RectNil :: forall a. a -&gt; Rect '[] a\npattern RectCons :: forall n ns a. Vect n (Rect ns a) -&gt; Rect (n : ns) a\n</code></pre>\n\n<p>If I have a <code>Rect ns a</code>, and I don't know what <code>ns</code> is, <em>I cannot match on it</em>. <code>RectNil</code> only takes <code>Rect '[] a</code>s, <code>RectCons</code> only takes <code>Rect (n : ns) a</code>s. You might ask: \"why would I want a reduction in power?\" @KABuhr has given one: GADTs are closed (and for good reason; stay tuned), families are open. This doesn't hold in <code>Rect</code>'s case, as these instances already fill up the entire <code>[Nat] * Type</code> space. The reason is actually <code>newtype</code>.</p>\n\n<p>Here's a GADT <code>RectG</code>:</p>\n\n<pre><code>data RectG :: [Nat] -&gt; Type -&gt; Type where\n  RectGN :: a -&gt; RectG '[] a\n  RectGC :: Vect n (RectG ns a) -&gt; RectG (n : ns) a\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>-- it's fine if you don't get these\npattern RectGN :: forall ns a. () =&gt; (ns ~ '[]) =&gt; a -&gt; RectG ns a\npattern RectGC :: forall ns' a. forall n ns. (ns' ~ (n : ns)) =&gt;\n                  Vect n (RectG ns a) -&gt; RectG ns' a\n-- just note that they both have the same matched type\n-- which means there needs to be a runtime distinguishment \n</code></pre>\n\n<p>If I have a <code>RectG ns a</code> and don't know what <code>ns</code> is, I can still match on it just fine. The compiler has to preserve this information with a data constructor. So, if I had a <code>RectG [1000, 1000] Int</code>, I would incur an overhead of one million <code>RectGN</code> constructors that all \"preserve\" the same \"information\". <code>Rect [1000, 1000] Int</code> is fine, though, as I do not have the ability to match and tell whether a <code>Rect</code> is <code>RectNil</code> or <code>RectCons</code>. This allows the constructor to be <code>newtype</code>, as it holds no information. I would instead use a different GADT, somewhat like</p>\n\n<pre><code>data SingListNat :: [Nat] -&gt; Type where\n  SLNN :: SingListNat '[]\n  SLNCZ :: SingListNat ns -&gt; SingListNat (Z : ns)\n  SLNCS :: SingListNat (n : ns) -&gt; SingListNat (S n : ns)\n</code></pre>\n\n<p>that stores the dimensions of a <code>Rect</code> in <code>O(sum ns)</code> space instead of <code>O(product ns)</code> space (I think those are right). This is also why <code>GADT</code>s are closed and families are open. A GADT is just like a normal <code>data</code> type except it has equality evidence and existentials. It doesn't make sense to add constructors to a GADT any more than it makes sense to add constructors to a Haskell 98 type, because any code that doesn't know about one of the constructors is in for a <em>very</em> bad time. It's fine for families though, because, as you noticed, once you define a branch of a family, you cannot add more constructors in that branch. Once you know what branch you're in, you know the constructors, and no one can break that. You're not allowed to use any constructors if you don't know which branch to use.</p>\n\n<p>Your examples don't really mix GADTs and data families. Pattern types are nifty in that they normalize away superficial differences in <code>data</code> definitions, so let's take a look.</p>\n\n<pre><code>data family FGADT a\ndata instance FGADT a where\n  MkFGADT :: Int -&gt; FGADT Int\n</code></pre>\n\n<p>Gives you</p>\n\n<pre><code>pattern MkFGADT :: forall a. () =&gt; (a ~ Int) =&gt; Int -&gt; FGADT a\n-- no different from a GADT; data family does nothing\n</code></pre>\n\n<p>But</p>\n\n<pre><code>data family DF a\ndata instance DF Int where\n  MkDF :: Int -&gt; DF Int\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>pattern MkDF :: Int -&gt; DF Int\n-- GADT syntax did nothing\n</code></pre>\n\n<p>Here's a proper mixing</p>\n\n<pre><code>data family Map k :: Type -&gt; Type\ndata instance Map Word8 :: Type -&gt; Type where\n  MW8BitSet :: BitSet8 -&gt; Map Word8 Bool\n  MW8General :: GeneralMap Word8 a -&gt; Map Word8 a\n</code></pre>\n\n<p>Which gives patterns</p>\n\n<pre><code>pattern MW8BitSet :: forall a. () =&gt; (a ~ Bool) =&gt; BitSet8 -&gt; Map Word8 a\npattern MW8General :: forall a. GeneralMap Word8 a -&gt; Map Word8 a\n</code></pre>\n\n<p>If I have a <code>Map k v</code> and I don't know what <code>k</code> is, I can't match it against <code>MW8General</code> or <code>MW8BitSet</code>, because those only want <code>Map Word8</code>s. This is the <code>data family</code>'s influence. If I have a <code>Map Word8 v</code> and I don't know what <code>v</code> is, matching on the constructors <em>can</em> reveal to me whether it's known to be <code>Bool</code> or is something else.</p>\n"}], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 3, "answer_count": 2, "score": 8, "last_activity_date": 1537238966, "creation_date": 1537186747, "last_edit_date": 1537238966, "question_id": 52367608, "link": "https://stackoverflow.com/questions/52367608/differences-gadt-data-family-data-family-that-is-a-gadt", "title": "differences: GADT, data family, data family that is a GADT", "body": "<p>What/why are the differences between those three? Is a GADT (and regular data types) just a shorthand for a data family? Specifically what's the difference between:</p>\n\n<pre><code>data GADT a  where\n  MkGADT :: Int -&gt; GADT Int\n\ndata family FGADT a\ndata instance FGADT a  where             -- note not FGADT Int\n  MkFGADT :: Int -&gt; FGADT Int\n\ndata family DF a\ndata instance DF Int  where              -- using GADT syntax, but not a GADT\n  MkDF :: Int -&gt; DF Int\n</code></pre>\n\n<p>(Are those examples over-simplified, so I'm not seeing the subtleties of the differences?)</p>\n\n<p>Data families are extensible, but GADTs are not. OTOH data family instances must not overlap. So I couldn't declare another instance/any other constructors for <code>FGADT</code>; just like I can't declare any other constructors for <code>GADT</code>. I can declare other instances for <code>DF</code>.</p>\n\n<p>With pattern matching on those constructors, the rhs of the equation does 'know' that the payload is <code>Int</code>.</p>\n\n<p>For class instances (I was surprised to find) I can write overlapping instances to consume GADTs:</p>\n\n<pre><code>instance C (GADT a) ...\ninstance {-# OVERLAPPING #-} C (GADT Int) ...\n</code></pre>\n\n<p>and similarly for <code>(FGADT a), (FGADT Int)</code>. But not for <code>(DF a)</code>: it must be for <code>(DF Int)</code> -- that makes sense; there's no <code>data instance DF a</code>, and if there were it would overlap.</p>\n\n<p><strong>ADDIT:</strong> to clarify @kabuhr's answer (thank you)</p>\n\n<blockquote>\n  <p>contrary to what I think you're claiming in part of your question, for a plain data family, matching on a constructor does not perform any inference </p>\n</blockquote>\n\n<p>These types are tricky, so I expect I'd need explicit signatures to work with them. In that case the plain data family is easiest</p>\n\n<pre><code>inferDF (MkDF x) = x                 -- works without a signature\n</code></pre>\n\n<p>The inferred type <code>inferDF :: DF Int -&gt; Int</code> makes sense. Giving it a signature <code>inferDF :: DF a -&gt; a</code> doesn't make sense: there is no declaration for a <code>data instance DF a ...</code>. Similarly with <code>foodouble :: Foo Char a -&gt; a</code> there is no <code>data instance Foo Char a ...</code>.</p>\n\n<p>GADTs are awkward, I already know. So neither of these work without an explicit signature</p>\n\n<pre><code>inferGADT (MkGADT x) = x\ninferFGADT (MkFGADT x) = x\n</code></pre>\n\n<p>Mysterious \"untouchable\" message, as you say. What I meant in my \"matching on those constructors\" comment was: the compiler 'knows' on rhs of an equation that the payload is <code>Int</code> (for all three constructors), so you'd better get any signatures consistent with that.</p>\n\n<p>Then I'm thinking <code>data GADT a where ...</code> is as if <code>data instance GADT a where ...</code>. I can give a signature <code>inferGADT :: GADT a -&gt; a</code> or <code>inferGADT :: GADT Int -&gt; Int</code> (likewise for <code>inferFGADT</code>). That makes sense: there is a <code>data instance GADT a ...</code> or I can give a signature at a more specific type.</p>\n\n<p>So in some ways data families are generalisations of GADTs. I also see as you say</p>\n\n<blockquote>\n  <p>So, in some ways, GADTs are generalizations of data families.</p>\n</blockquote>\n\n<p>Hmm. (The reason behind the question is that GHC Haskell has got to the stage of feature bloat: there's too many similar-but-different extensions. I was trying to prune it down to a smaller number of underlying abstractions. Then @HTNW's approach of explaining in terms of yet further extensions is opposite to what would help a learner. IMO existentials in data types should be chucked out: use GADTs instead. PatternSynonyms should be explained in terms of data types and mapping functions between them, not the other way round. Oh, and there's some DataKinds stuff, which I skipped over on first reading.)</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1537212887, "post_id": 52366172, "comment_id": 91693937, "body": "<code>Last</code> is right-biased, but it&#39;s a special-purpose Monoid. There are also right-biased monads, but most of them are a bit weird and not strictly lawful (lazy state, lazy <code>ST</code>, etc.). The only simple, lawful, and somewhat important example that comes to mind is <code>Reader</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 9, "last_activity_date": 1537181810, "creation_date": 1537181810, "answer_id": 52366172, "question_id": 52365360, "link": "https://stackoverflow.com/questions/52365360/should-my-monoid-be-left-or-right-biased/52366172#52366172", "title": "Should my monoid be left- or right-biased?", "body": "<p>(This is a bit opinion based, but I will answer anyway)</p>\n\n<p>Other things being equal, I would make it left-biased.</p>\n\n<p>I'm suggesting that only because there already are left-biased monoids (<code>[a]</code>), and I can't think of any existing right-biased ones. (Well, snoc-lists, but these are far less common.) </p>\n\n<p>Further, left-to-right is a common order for \"effects\" like non-termination, or applicatives/monads. I would argue that most programmers are already used to such order of effect-sequencing.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1537191043, "post_id": 52366669, "comment_id": 91682158, "body": "&quot;that&#39;s the way <code>&lt;&gt;</code> associates&quot; is a bit misleading since <code>&lt;&gt;</code> is <i>right</i> associative. Still, that&#39;s precisely what we need to play along left-biased monoids. (+1)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1537183598, "creation_date": 1537183598, "answer_id": 52366669, "question_id": 52365360, "link": "https://stackoverflow.com/questions/52365360/should-my-monoid-be-left-or-right-biased/52366669#52366669", "title": "Should my monoid be left- or right-biased?", "body": "<p>Left-biased makes sense because that's the way the <code>&lt;&gt;</code> operator associates naturally, without parentheses:</p>\n\n<pre><code>good = pure () &lt;&gt; pure () &lt;&gt; pure () &lt;&gt; ...\nbad = ((... &lt;&gt; pure ()) &lt;&gt; pure()) &lt;&gt; pure ()\n</code></pre>\n\n<p>This is a bit of a chicken &amp; egg of course, because this associativity was chosen so lists would perform properly. But there we are.</p>\n"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1537183598, "creation_date": 1537179055, "question_id": 52365360, "link": "https://stackoverflow.com/questions/52365360/should-my-monoid-be-left-or-right-biased", "title": "Should my monoid be left- or right-biased?", "body": "<p>The monoid instance for <code>[a]</code> is left-biased.  One way to\ndemonstrate what I'm aiming at is with the following two\ndefinitions:</p>\n\n<pre><code>good \u2237 Applicative f \u21d2 Semigroup (f ()) \u21d2 f ()\ngood = pure () &lt;&gt; good\n\nbad \u2237 Applicative f \u21d2 Semigroup (f ()) \u21d2 f ()\nbad = bad &lt;&gt; pure ()\n</code></pre>\n\n<p>Here we can see that <code>good @[]</code> is productive whereas <code>bad @[]</code>\ndiverges.  The same issue can have similar consequences for\nperformance (runtime and memory usage).  So my question is, is\nthere a general guideline for whether I should design my\nsemigroup to be left- or right biased?  I'd argue that similar\nthings should be taken into consideration when writing/using\n<code>Foldable</code>s.  Perhaps this is the reason that both <code>foldl</code> and\n<code>foldr</code> are instance methods?</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson", "lenses"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537175012, "post_id": 52361860, "comment_id": 91672475, "body": "What solution involving <code>members</code> do you find lacking?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537175155, "post_id": 52361860, "comment_id": 91672550, "body": "It&#39;s giving me a <code>[(Text, Value)]</code> and I have to process it further to get <code>[Text]</code>. It <i>seems</i> like there should be a more straightforward way of doing this."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537175365, "post_id": 52361860, "comment_id": 91672675, "body": "<code>v ^@.. members</code> does not wrap the list in <code>Maybe</code>. Is it fine to drop the <code>Maybe</code>?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1537176107, "post_id": 52361860, "comment_id": 91673069, "body": "What&#39;s the maybe supposed to be for? A value <i>always</i> has keys, even if it has no keys."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537176944, "post_id": 52361860, "comment_id": 91673613, "body": "The value may not be an object. Perhaps he wants to tell between an empty object and a string."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1537186119, "post_id": 52361860, "comment_id": 91678964, "body": "the result is a <code>Maybe [Text]</code> because the input to the function is a <code>Value</code>. If the input to the function is an <code>Object</code> then the result can be a <code>[Text]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1581504675, "post_id": 52364312, "comment_id": 106454207, "body": "How does one actually use this? eg <code>x ^? _Right . (ix 0) . &lt;??&gt;</code> -- what do I put in place of <code>&lt;??&gt;</code> to get all keys of the object?"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1581508823, "post_id": 52364312, "comment_id": 106456376, "body": "Assuming that <code>x ^? _Right . ix 0</code> would have type <code>Maybe Value</code>: <code>x ^.. _Right . ix 0 . members . asIndex</code>. My answer was wrong, edited!"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1581508821, "last_edit_date": 1581508821, "creation_date": 1537175535, "answer_id": 52364312, "question_id": 52361860, "link": "https://stackoverflow.com/questions/52361860/which-lens-to-use-to-get-all-keys-in-an-aeson-object/52364312#52364312", "title": "Which lens to use to get all keys in an Aeson.Object?", "body": "<pre><code>toKeysList :: Value -&gt; [Text]\ntoKeysList = toListOf $ members . asIndex\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 0, "last_activity_date": 1537368642, "creation_date": 1537368642, "answer_id": 52408662, "question_id": 52361860, "link": "https://stackoverflow.com/questions/52361860/which-lens-to-use-to-get-all-keys-in-an-aeson-object/52408662#52408662", "title": "Which lens to use to get all keys in an Aeson.Object?", "body": "<p>I'd probably use what @Gurkenglas suggested, or</p>\n\n<pre><code>view (_Object . to HM.keys)\n    :: (AsValue s, MonadReader s m)\n    =&gt; m [Text]\n</code></pre>\n\n<p>I find it's important to note that <code>lens</code> doesn't really shine there; for a reason.\nThe keys of an object are part of its \"shape\". <code>lens</code> works nicely when you don't need to change shape. So you can <em>get</em> the keys, but you cannot do much else, i.e. you cannot <em>set</em> or <em>modify</em> them.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1581508821, "creation_date": 1537165527, "question_id": 52361860, "link": "https://stackoverflow.com/questions/52361860/which-lens-to-use-to-get-all-keys-in-an-aeson-object", "title": "Which lens to use to get all keys in an Aeson.Object?", "body": "<p>I'm looking at <a href=\"https://www.stackage.org/haddock/lts-12.1/lens-aeson-1.0.2/Data-Aeson-Lens.html\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-12.1/lens-aeson-1.0.2/Data-Aeson-Lens.html</a> and trying to find out a lens which can give me all they keys from an <code>Object</code>. Conceptually, I'm looking for the following:</p>\n\n<pre><code>allKeys :: Value -&gt; Maybe [Text]\nallKeys v = v ^? _Object . keys -- `keys` is not an actual lens!\n</code></pre>\n\n<p>The closest that I can <em>possibly</em> get to, is by using <a href=\"https://www.stackage.org/haddock/lts-12.1/lens-aeson-1.0.2/Data-Aeson-Lens.html#v:members\" rel=\"nofollow noreferrer\"><code>members</code></a>, but it doesn't seem the easiest/fastest/shorted way to achieve this.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537132328, "post_id": 52358403, "comment_id": 91661276, "body": "<code>g (x y)</code> means that <code>x</code> is a function, that you first perform function application with <code>x</code> the function and <code>y</code> the parameter, and then pass that result to <code>g</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1537132847, "post_id": 52358403, "comment_id": 91661386, "body": "Hi, you appear to be a Haskell beginner. I&#39;d strongly reccommend reading <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a> to completion for beginner programmers before diving into questions. This question is answered in LYAH."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1537136753, "post_id": 52358403, "comment_id": 91662178, "body": "also be sure to check out <code>let  j g (x, y) = (g x y)</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1537147762, "post_id": 52358403, "comment_id": 91663903, "body": "@AJFarmar seconded, except for &quot;to completion .. before&quot;.  Asking questions is an important part of learning, even when using a &quot;textbook&quot;.  But I agree that Lama might benefit from reading a few chapters."}], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 4189983, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000634755722/picture?type=large", "display_name": "Lama Madan", "link": "https://stackoverflow.com/users/4189983/lama-madan"}, "edited": false, "score": 0, "creation_date": 1537142526, "post_id": 52358452, "comment_id": 91663160, "body": "Can you please explain the type of this function *Main&gt; let  j g (x, y) = g(x y) *Main&gt; :t j j :: (t1 -&gt; t2) -&gt; (t3 -&gt; t1, t3) -&gt; t2"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1537152880, "post_id": 52358452, "comment_id": 91664760, "body": "Same as ML, Idris, Agda, etc. Maybe unusual in the grand scheme of things, but far from unique!"}, {"owner": {"reputation": 387, "user_id": 4189983, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000634755722/picture?type=large", "display_name": "Lama Madan", "link": "https://stackoverflow.com/users/4189983/lama-madan"}, "edited": false, "score": 0, "creation_date": 1537187452, "post_id": 52358452, "comment_id": 91679761, "body": "Clear in such type of expression. Could you please describe type signature of : h f = foldr ((:) . f) [ ]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 387, "user_id": 4189983, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000634755722/picture?type=large", "display_name": "Lama Madan", "link": "https://stackoverflow.com/users/4189983/lama-madan"}, "edited": false, "score": 0, "creation_date": 1537188221, "post_id": 52358452, "comment_id": 91680246, "body": "@LamaMadan: I suggests you ask a new questions, since, well, this is a new question :)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1537189153, "last_edit_date": 1537189153, "creation_date": 1537132650, "answer_id": 52358452, "question_id": 52358403, "link": "https://stackoverflow.com/questions/52358403/why-does-using-a-comma-in-haskell-function-application-cause-different-types/52358452#52358452", "title": "Why does using a comma in Haskell function application cause different types?", "body": "<blockquote>\n  <p>What is the difference between <code>g(x,y)</code> and <code>g(x y)</code> and how the yield that output.</p>\n</blockquote>\n\n<p>Well Haskell has - compared to the gross of programming languages - an \"unusual\" syntax (compared to very common languages like C, Java, etc.) how to describe function applications.</p>\n\n<p><code>f x</code> is a function application with <code>f</code> the function, and <code>x</code> the parameter. The parentheses are not necessary (in contrast to for example programming languages like C, Java, C#, etc.), however they may be included. Therefore <code>f(x)</code> is interpreted as <code>f (x)</code> and since <code>(x)</code> is simply <code>x</code>, the two are equivalent.</p>\n\n<p>With that in mind if we look at <code>g (x y)</code> we see <em>two</em> function applications: <code>x y</code>, and <code>g (x y)</code>. In a programming language like Java, this would look like <code>g(x(y))</code>. <code>g</code>, and <code>x</code> are thus both functions (where the \"output type\" of <code>x</code> should be the same as the \"input type\" of <code>g</code>). We perform function application with <code>x</code> the function and <code>y</code> the parameter, and the result is a parameter in a function application with <code>g</code> the function.</p>\n\n<p>Haskell also has <em>tuples</em>. For example <code>(4, 2)</code> a 2-tuple. <code>(x, y)</code> is a 2-tuple as well: <code>x</code> is the first element, and <code>y</code> the second. If we thus write <code>g (x, y)</code>, then we perform a function application with <code>g</code> the function, and <code>(x, y)</code> (a 2-tuple) the parameter. So that means that <code>x</code> has type <code>a</code>, and <code>y</code> has type <code>b</code>, then <code>g</code> has type <code>(a, b) -&gt; c</code>.</p>\n\n<p>With that in mind, we can derive the signature of functions, for example:</p>\n\n<pre><code>j g (x, y) = g (x,y)\n</code></pre>\n\n<p>We see here that <code>j</code> has \"two\" parameters (in Haskell all functions have <em>one</em> parameter, the result of that function takes then another parameter), so we start by describing the signature of the function as:</p>\n\n<pre><code>j :: a -&gt; b -&gt; c\ng :: a\n(x, y) :: b\ng (x, y) :: c\n</code></pre>\n\n<p>Since <code>(x, y)</code> is a tuple, we specialize the type of <code>(x, y)</code> as <code>(d, e)</code>, so that means that the signature changes to:</p>\n\n<pre><code>j :: a -&gt; (d, e) -&gt; c\ng :: a\n(x, y) :: b ~ (d, e)\ng (x, y) :: c\nx :: d\ny :: e\n</code></pre>\n\n<p>(the tilde <code>~</code> stands for the fact that the two types are the same)</p>\n\n<p>Since we call <code>g</code> with <code>(x, y)</code> as parameter, we know that <code>g</code> is a function. The input type is the type of the parameter <code>(x, y)</code>, so <code>(d, e)</code>, whereas its result type is here the type of the result of <code>j g (x, y)</code>, hence <code>c</code>, so we derive that <code>g</code> has type <code>(d, e) -&gt; c</code>, so that means that:</p>\n\n<pre><code>j :: ((d, e) -&gt; c) -&gt; (d, e) -&gt; c\ng :: a ~ ((d, e) -&gt; c)\n(x, y) :: b ~ (d, e)\ng (x, y) :: c\nx :: d\ny :: e\n</code></pre>\n\n<p>Then all constraints are satisfied, hence the type of <code>j</code> is:</p>\n\n<pre><code>j :: ((d, e) -&gt; c) -&gt; (d, e) -&gt; c\n</code></pre>\n\n<p>I leave deriving the type of <code>j g (x, y) = g(x y)</code> as an exercise.</p>\n"}, {"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": false, "score": 4, "last_activity_date": 1537200093, "last_edit_date": 1537200093, "creation_date": 1537152855, "answer_id": 52360203, "question_id": 52358403, "link": "https://stackoverflow.com/questions/52358403/why-does-using-a-comma-in-haskell-function-application-cause-different-types/52360203#52360203", "title": "Why does using a comma in Haskell function application cause different types?", "body": "<p>In Haskell (unlike in C-derived languages), function calls are not indicated by parentheses after the function.  Instead, Haskell treats any two consecutive expressions as function application, so that <code>(x y)</code> reads as \"the function <code>x</code> applied to argument <code>y</code>\".</p>\n\n<p>Also unlike C-derived languages, Haskell has native support for tuples:  <code>(x,y)</code> reads \"the tuple of <code>x</code> followed by <code>y</code>\".</p>\n\n<p>Combining these together, Haskell will treat <code>g(x,y)</code> as \"the function <code>g</code> applied to the tuple <code>(x,y)</code>, which is similar to how it reads in C-like languages.  However, this similarity is misleading:  C-like function calls require the parentheses to indicate the function call, while in Haskell they only delimit the tuple.</p>\n\n<p>From your other example, <code>g(x y)</code> reads \"the function <code>g</code> applied to the result of (function <code>x</code> applied to argument <code>y</code>)\".  In a C-like language, <code>x y</code> would be a syntax error, but Haskell recognizes it as a function application.</p>\n"}], "owner": {"reputation": 387, "user_id": 4189983, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000634755722/picture?type=large", "display_name": "Lama Madan", "link": "https://stackoverflow.com/users/4189983/lama-madan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 982, "favorite_count": 1, "accepted_answer_id": 52358452, "answer_count": 2, "score": 2, "last_activity_date": 1537200093, "creation_date": 1537132219, "last_edit_date": 1537133117, "question_id": 52358403, "link": "https://stackoverflow.com/questions/52358403/why-does-using-a-comma-in-haskell-function-application-cause-different-types", "title": "Why does using a comma in Haskell function application cause different types?", "body": "<p>I have run these haskell function in ghci then got those output, but i dont know how to explain it. What is the difference between g(x,y) and g(x y) and how the yield that output.</p>\n\n<pre><code>*Main&gt; let  j g (x, y) = g(x,y)\n*Main&gt; :t j\nj :: ((a, b) -&gt; t) -&gt; (a, b) -&gt; t\n\n*Main&gt; let  j g (x, y) = g(x y)\n*Main&gt; :t j\nj :: (t1 -&gt; t2) -&gt; (t3 -&gt; t1, t3) -&gt; t2\n</code></pre>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537131932, "post_id": 52358348, "comment_id": 91661205, "body": "You use two <code>f</code>s in the head, (same with <code>x</code>) so you probably want to writhe <code>Twice f g &lt;*&gt; Twice x y = Twice (f x) (g y)</code>. The brackets were also written in a wrong way (here you have made a function call with <code>(f x)</code> the function, and <code>(f x)</code> the argument."}, {"owner": {"reputation": 33, "user_id": 10371415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hyCc4.jpg?s=128&g=1", "display_name": "PanicCoder", "link": "https://stackoverflow.com/users/10371415/paniccoder"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537140833, "post_id": 52358348, "comment_id": 91662868, "body": "Wow, thank you so much all of you!"}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1537132460, "post_id": 52358379, "comment_id": 91661305, "body": "Brackets around the arguments of <code>(&lt;*&gt;)</code> are not necessary."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1537142921, "post_id": 52358379, "comment_id": 91663228, "body": "It\u2019s an interesting inconsistency of the language that neither <code>f a a = a + 6</code> nor <code>f = \\ a a -&gt; a + 6</code> is allowed, so the compiler can produce a more helpful diagnostic, even though they both ostensibly ought to desugar to the same thing, <code>f = \\ a -&gt; \\ a -&gt; a + 6</code>\u2014where the latter <code>a</code> shadows the former, which is ignored."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1537191376, "post_id": 52358379, "comment_id": 91682385, "body": "@JonPurdy I think that&#39;s a feature; when I was first learning Haskell, my first thought was something like <code>f a a = ...</code> would match the case where <code>f</code> was called with the same argument twice. The shadowing behavior is more obvious if you know what it desugars to, but it&#39;s surprising if you don&#39;t. Disallowing the same variable makes sense if you want to maintain the illusion of multiple parameters."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1537132672, "last_edit_date": 1537132672, "creation_date": 1537132049, "answer_id": 52358379, "question_id": 52358348, "link": "https://stackoverflow.com/questions/52358348/implementing-applicative-functor-for-custom-data-type-with-two-identical-type-cl/52358379#52358379", "title": "Implementing applicative functor for custom data type with two identical type classes", "body": "<p>Here are the problems and their corrections:</p>\n\n<pre><code>instance Functor Twice where\n    -- fmap f (Twice a a) = Twice (f a) (f a)\n    --               ^^^ you define `a` twice here. Replace this with:\n    fmap f (Twice a b) = Twice (f a) (f b)\n\ninstance Applicative Twice where\n    pure x = Twice x x -- You don't need brackets here so I removed them.\n    -- Twice f f &lt;*&gt; Twice x x = Twice ((f x) (f x))\n    -- ^^^^^^^^^     ^^^^^^^^^         ^^^^^^^^^^^^^\n    -- You define f and x twice.\n    -- You are also misusing brackets - this is not how to apply functions.\n    -- A corrected version:\n    Twice f1 f2 &lt;*&gt; Twice x1 x2 = Twice (f1 x1) (f2 x2)\n</code></pre>\n\n<p>Firstly, if you don't give seperate arguments seperate names, this <em>will</em> cause an error. Imagine me writing <code>f a a = a + 6</code>, and then asking you to evaluate <code>f 1 2</code>.</p>\n\n<p>Secondly, you misunderstand how Haskell functions are applied. Let me make this clear: in most languages you write <code>f(a,b,c)</code>, but in Haskell, you write <code>f a b c</code>. If you write <code>f (a b c)</code>, this is read as <code>f(a(b,c))</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1537132753, "last_edit_date": 1537132753, "creation_date": 1537132111, "answer_id": 52358387, "question_id": 52358348, "link": "https://stackoverflow.com/questions/52358348/implementing-applicative-functor-for-custom-data-type-with-two-identical-type-cl/52358387#52358387", "title": "Implementing applicative functor for custom data type with two identical type classes", "body": "<p>The errors are more syntactical than semantical I guess. In your definition:</p>\n\n<pre><code>Twice <b>f</b> <b>f</b> &lt;*&gt; Twice <b>x</b> <b>x</b> = Twice ((f x) (f x))</code></pre>\n\n<p>the same in the <code>Functor</code> defintion:</p>\n\n<pre><code>fmap f (Twice <b>a</b> <b>a</b>) = Twice (f a) (f a)</code></pre>\n\n<p>You write two <code>f</code>s and two <code>x</code>'s in the head. Haskell does not allows that (Prolog does, but even then it is probably not what you mean).</p>\n\n<p>Furthermore in the body you write:</p>\n\n<pre><code>((f x) (f x))</code></pre>\n\n<p>This means that you would make a function call with <code>f x</code> the function, and <code>f x</code> the argument, which is again probably not what you intended.</p>\n\n<p>We can fix it syntactically to:</p>\n\n<pre><code>instance Functor Twice where\n    fmap f (Twice a <b>b</b>) = Twice (f a) (f <b>b</b>)\n\ninstance Applicative Twice where\n    pure x = Twice x x\n    Twice <b>f</b> <b>g</b> &lt;*&gt; Twice <b>x</b> <b>y</b> = Twice <b>(f x) (g y)</b></code></pre>\n\n<p>Note that you still need to prove that this is a valid <code>Functor</code> and <code>Applicative</code> instance by taking the constraints documented for these typeclasses into account.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1537455886, "last_edit_date": 1537455886, "creation_date": 1537133861, "answer_id": 52358602, "question_id": 52358348, "link": "https://stackoverflow.com/questions/52358348/implementing-applicative-functor-for-custom-data-type-with-two-identical-type-cl/52358602#52358602", "title": "Implementing applicative functor for custom data type with two identical type classes", "body": "<p>The confusion stems from using the same name for data and type; a common and accepted, even recommended practice for all but the very novice Haskellers. </p>\n\n<p>For now, you can use different names, to reduce the cognitive load while learning and getting accustomed to Haskell's data type declarations:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Twice a = MkTwice a a deriving (Show)         -- 'Mk' is for \"make\"\n\n-- Twice a                         -- a type\n-- MkTwice :: a -&gt; a -&gt; Twice a    -- data constructor\n\ninstance Functor Twice where\n    -- fmap (f :: a -&gt; b) :: Twice a -&gt; Twice b\n    fmap f (MkTwice x y) = MkTwice (f x) (f y)     -- transform both fields\n\ninstance Applicative Twice where\n    pure x = MkTwice x x                 -- create two fields from one value\n    MkTwice f g &lt;*&gt; MkTwice x y = MkTwice (f x) (g y)  -- combine both fields\n</code></pre>\n\n<p><code>Twice a</code> is a type, with <code>a</code> a type variable.</p>\n\n<p><code>MkTwice</code> is the data constructor for this type. It makes values of type <code>Twice a</code>, from two values of type <code>a</code> (say, <code>x :: a</code> and <code>y :: a</code>). Values appear to the right of <code>=</code> in Haskell definitions (roughly).</p>\n\n<p>It is also used in patterns for values of the type <code>Twice a</code>. Patterns appear to the left of <code>=</code> in Haskell definitions. There can be <em>no</em> duplicate pattern variables in Haskell's patterns. Each pattern variable stands for some value. </p>\n\n<p>Each type variable stands for a type.</p>\n\n<p>I bet you wouldn't make those mistakes if you were using the different names for the type and data constructor.</p>\n"}], "owner": {"reputation": 33, "user_id": 10371415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hyCc4.jpg?s=128&g=1", "display_name": "PanicCoder", "link": "https://stackoverflow.com/users/10371415/paniccoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 52358387, "answer_count": 3, "score": 3, "last_activity_date": 1537455886, "creation_date": 1537131754, "question_id": 52358348, "link": "https://stackoverflow.com/questions/52358348/implementing-applicative-functor-for-custom-data-type-with-two-identical-type-cl", "title": "Implementing applicative functor for custom data type with two identical type classes", "body": "<p>I'm trying to make Twice a member of applicative, but I am getting \"Conflicting definitions for `a'\" in the functor implementation: Also I'm not sure how to implement the &lt;*> correctly :/</p>\n\n<pre><code>data Twice a = Twice a a deriving (Show)\n\ninstance Functor Twice where\n    fmap f (Twice a a) = Twice (f a) (f a)\n\ninstance Applicative Twice where\n    pure x = (Twice x) x\n    Twice f f &lt;*&gt; Twice x x = Twice ((f x) (f x))\n</code></pre>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1537116135, "post_id": 52355940, "comment_id": 91657046, "body": "You should avoid <code>setStdGen</code> and <code>getStdRandom</code>.  You should just pass a <code>StdGen</code> value around, instead of  manipulating a global in IO. It makes it easier to compose values together.  And since the problem is likely the order of interleaved IO, avoiding it entirely should make everything easier to understand."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10371359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e673ad8a7eb5a40577a4498227af5140?s=128&d=identicon&r=PG&f=1", "display_name": "rpns", "link": "https://stackoverflow.com/users/10371359/rpns"}, "edited": false, "score": 0, "creation_date": 1537139815, "post_id": 52356605, "comment_id": 91662693, "body": "Thank you, @Daniel! I still don&#39;t understand what&#39;s wrong with an <i>infinite</i> list of randoms instead of <code>replicateM 10 mphi</code>. My naive code: <code>setStdGen (mkStdGen 20180916) &gt;&gt; (sequence . take 10 $ (scanl (\\b -&gt; \\a -&gt; (+) &lt;$&gt; b &lt;*&gt; a) (return 0) $ repeat mphi))</code> produces exactly the same incorrect result as <code>l2</code>does via <code>iterate</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13, "user_id": 10371359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e673ad8a7eb5a40577a4498227af5140?s=128&d=identicon&r=PG&f=1", "display_name": "rpns", "link": "https://stackoverflow.com/users/10371359/rpns"}, "edited": false, "score": 0, "creation_date": 1537143664, "post_id": 52356605, "comment_id": 91663339, "body": "@rpns If you can explain which part of the first few paragraphs is not clear, I can try to refine it some. As it stands, the explanation for why the naive code you posted in your comment doesn&#39;t work is essentially the same as why your original <code>l1</code> and <code>l2</code> don&#39;t behave correctly."}, {"owner": {"reputation": 13, "user_id": 10371359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e673ad8a7eb5a40577a4498227af5140?s=128&d=identicon&r=PG&f=1", "display_name": "rpns", "link": "https://stackoverflow.com/users/10371359/rpns"}, "edited": false, "score": 0, "creation_date": 1537145892, "post_id": 52356605, "comment_id": 91663632, "body": "If so, is there any simple way to generate an <b>infinite</b> list of partial sums of randoms like <code>scanl (+) 0 [1..]</code> for a pure series? Thank you!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13, "user_id": 10371359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e673ad8a7eb5a40577a4498227af5140?s=128&d=identicon&r=PG&f=1", "display_name": "rpns", "link": "https://stackoverflow.com/users/10371359/rpns"}, "edited": false, "score": 0, "creation_date": 1537147622, "post_id": 52356605, "comment_id": 91663879, "body": "@rpns You can look at <code>randomRs</code>. But it is much harder to use correctly than you might first guess: you must not reuse the seed you pass to it, and you don&#39;t get an updated seed back from it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1537118428, "creation_date": 1537118428, "answer_id": 52356605, "question_id": 52355940, "link": "https://stackoverflow.com/questions/52355940/iterate-and-getstdrandom/52356605#52356605", "title": "Iterate and getStdRandom", "body": "<p>Here are the first few elements of <code>iterate (\\s -&gt; (\\a b -&gt; b) &lt;$&gt; s &lt;*&gt; mphi) (return 0)</code>:</p>\n\n<pre><code>return 0\n(\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi\n(\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi) &lt;*&gt; mphi\n(\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi) &lt;*&gt; mphi) &lt;*&gt; mphi\n</code></pre>\n\n<p>When you sequence these, here's what you get:</p>\n\n<pre><code>do\n    v0 &lt;- return 0\n    v1 &lt;- (\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi\n    v2 &lt;- (\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi) &lt;*&gt; mphi\n    v3 &lt;- (\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; ((\\a b -&gt; b) &lt;$&gt; return 0 &lt;*&gt; mphi) &lt;*&gt; mphi) &lt;*&gt; mphi\n    return [v0, v1, v2, v3]\n</code></pre>\n\n<p>Notice in particular that the random seed is not reset between these lines, and the things being thrown away by <code>\\a b -&gt; b</code> are <em>result values</em>, not <em><code>IO</code> actions</em>. This means that we are getting the constant <code>0</code> in <code>v0</code>; the first element of the random sequence in <code>v1</code> (not <code>v0</code>!); the third element of the random sequence (completely skipping the second element) in <code>v2</code> (this one is probably what you wanted, but just by accident...); the sixth element of the random sequence in <code>v3</code> (not <code>v5</code>! and skipping the fourth and fifth elements of the sequence entirely); and so on up the triangle numbers, throwing away <em>most</em> of the random numbers we generate.</p>\n\n<p>What you almost certainly wanted instead was</p>\n\n<pre><code>do\n    v0 &lt;- mphi\n    v1 &lt;- mphi\n    v2 &lt;- mphi\n    v3 &lt;- mphi\n    return [v0, v1, v2, v3]\n</code></pre>\n\n<p>which can be achieved by using <code>repeat mphi</code> instead of <code>iterate (\\s -&gt; ...) (return 0)</code>. This lands us at:</p>\n\n<pre><code>sequence . take 10 $ repeat mphi\n</code></pre>\n\n<p>Idiomatically, one would then change <code>take 10 (repeat mphi)</code> to <code>replicate 10 mphi</code>, then change <code>sequence (replicate 10 mphi)</code> to <code>replicateM 10 mphi</code>.</p>\n\n<p>Similar comments apply to your summing version: element <code>n</code> of the resulting list has generated <code>n</code> random numbers (distinct from any of the previously used ones for sums earlier in the result list) and summed them. Maybe this is what you want, but I suspect what you really wanted was just:</p>\n\n<pre><code>scanl (+) 0 &lt;$&gt; replicateM 10 mphi\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10371359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e673ad8a7eb5a40577a4498227af5140?s=128&d=identicon&r=PG&f=1", "display_name": "rpns", "link": "https://stackoverflow.com/users/10371359/rpns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 52356605, "answer_count": 1, "score": 1, "last_activity_date": 1537118428, "creation_date": 1537113889, "question_id": 52355940, "link": "https://stackoverflow.com/questions/52355940/iterate-and-getstdrandom", "title": "Iterate and getStdRandom", "body": "<p>I have the following code (trying to simulate a Gaussian random walk):</p>\n\n<pre><code>import System.Random\nimport Control.Applicative\n\ngetStdNormal :: StdGen -&gt; (Float,StdGen)\ngetStdNormal g = let l = drop 1 . take 49 $ iterate (\\(_,g') -&gt; random g') (0,g) in\n                ((/ 2) . (+ (-24)) . sum . map fst $ l, snd . last $ l)\n\nmphi = getStdRandom getStdNormal\n\nl1 = setStdGen (mkStdGen 20180916) &gt;&gt; (sequence . take 10 $\n                iterate (\\s -&gt; (\\a -&gt; \\b -&gt;  b) &lt;$&gt; s &lt;*&gt; mphi) (return 0))\n\nl2 = setStdGen (mkStdGen 20180916) &gt;&gt; (sequence . take 10 $\n                iterate (\\s -&gt; (\\a -&gt; \\b -&gt; a + b) &lt;$&gt; s &lt;*&gt; mphi) (return 0))\n</code></pre>\n\n<p><code>l1</code> is evaluated to the list of (apparently normal) random values, just as I can expect:</p>\n\n<pre><code>[0.0,1.1155739,-0.24667645,0.7793722,-0.18391132,0.23517609,-0.80208874,-1.5305595,-0.28670216,0.53894806]\n</code></pre>\n\n<p>However, <code>l2</code> behaves far from my expectations. The list obviously is not the series of <code>l1</code> partial sums, and is very unlikely to have standard normal differences:</p>\n\n<pre><code>[0.0,1.1155739,0.55951977,0.22015285,-2.0858078,0.6170025,-5.20298,0.3877325,1.410594,0.8647003]\n</code></pre>\n\n<p>(Yet note that the first two members are correct.) In fact, I can't explain where do the numbers in <code>l2</code> come from, although I tend to blame laziness in <code>mphi</code>.</p>\n\n<p>Why doesn't the code work as intended? Many thanks!</p>\n"}, {"tags": ["haskell", "serialization", "bytestring"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1537193730, "post_id": 52355279, "comment_id": 91683994, "body": "Wrt your edit, it would work with that second type if you add eight bytes at the beginning of the file indicating the number of chunks (i.e. increment this at every append)."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "edited": false, "score": 0, "creation_date": 1537116692, "post_id": 52355774, "comment_id": 91657198, "body": "First of all thank you, i didnt know that directly appending encoded data wouldnt work.  I also realized that i was missing the List on the Tuple so that the type of <code>S.runGet getMultiChunks bstr :: Either String ([Float],[Float])</code> should be  <code>:: Either String [([Float],[Float])]</code> . Meaning what i wanted to achieve was to add whole Tuples to the file like this <code>[([1.1,2.2],[3.3,4.4]),([9.9,3.2,4.2],[1.1,3.5])]</code> so i thought that appending it like that would be possible but from what i can see with <code>getMultiChunks</code>  what i have to do is something like <code>getMultiChunks ::Get [([Float],[Float])]</code>"}, {"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "edited": false, "score": 0, "creation_date": 1537116941, "post_id": 52355774, "comment_id": 91657270, "body": "and also to avoid the inefficient appending it could also be added at the beginning of  the List with <code>:</code> . The workaround what recently came to my mind was to read the File, decode whats inside, add the tuple, encode and write to file again. But that would cost much if the file was big"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1537113971, "last_edit_date": 1537113971, "creation_date": 1537112714, "answer_id": 52355774, "question_id": 52355279, "link": "https://stackoverflow.com/questions/52355279/how-to-save-append-and-read-a-list-of-tuple-including-lists-into-a-file-using-d/52355774#52355774", "title": "How to save, append and read a List of tuple including Lists into a File using Data.Serialize and ByteString", "body": "<p><strong>The Problem In Brief</strong> The default format used by serialize (or binary) encoding isn't trivially append-able.</p>\n\n<p><strong>The Problem (Longer)</strong></p>\n\n<p>You say you appended:</p>\n\n<pre><code>S.encode (a,b)\n</code></pre>\n\n<p>to the same file \"multiple times\". So the format of the file is now:</p>\n\n<pre><code>[ 64 bit length field  | # floats encoded | 64 length field | # floats encoded ]\n</code></pre>\n\n<p>Repeated however many times you appended to the file.  That is, each append will add new length fields and list of floats while leaving the old values in place.</p>\n\n<p>After that you returned to read the file and decode some floats using, morally, <code>S.decode &lt;$&gt; BS.readFile path</code>.  This will decode the first two lists of floats by first reading the length field (of the first time you wrote to the file) then the following floats and the second length field followed by its related floats.  After reading the stated length worth of floats the decoder will stop.</p>\n\n<p>It should now be clear that just because you appended more data does not make your encoding or decoding script look for any additional data.  The default format used by serialize (or binary) encoding isn't trivially append-able.</p>\n\n<p><strong>Solutions</strong></p>\n\n<p>You mentioned switching to Aeson, but using JSON to encode instead of binary won't help you.  Decoding two appended JSON strings like <code>{ \"first\": [1], \"second\": [2]}{ \"first\": [3], \"second\": [4]}</code> is logically the same as your current problem.  You have some unknown number of interleaved chunks of lists - just write a decoder to keep trying:</p>\n\n<pre><code>import Data.Serialize as S\nimport Data.Serialize.Get as S\nimport Data.ByteString as BS\n\nfromFile path = do \n    bstr &lt;- BS.readFile path\n    let d = S.runGet getMultiChunks bstr :: Either String ([Float],[Float])\n    return (Right d)\n\ngetMultiChunks :: Get ([Float],[Float])\ngetMultiChunks = go ([], [])\n   where\n  go (l,r) = do\n     b &lt;- isEmpty\n     if b then pure ([],[])\n          else do (lNext, rNext) &lt;- S.get\n                  go (l ++ lNext, r ++ rNext) -- inefficient\n</code></pre>\n\n<p>So we've written our own getter (untested) that will look to see if byte remain and if so decode another pair of lists of floats.  Each time it decodes a new chunk it prepends the old chunk (which is inefficient, use something like a dlist if you want it to be respectable).</p>\n"}], "owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537118161, "creation_date": 1537109397, "last_edit_date": 1537118161, "question_id": 52355279, "link": "https://stackoverflow.com/questions/52355279/how-to-save-append-and-read-a-list-of-tuple-including-lists-into-a-file-using-d", "title": "How to save, append and read a List of tuple including Lists into a File using Data.Serialize and ByteString", "body": "<p>Hello i am having problems reading after saving and appending a List of Tuple Lists inside a File.</p>\n\n<p>Saving something into a File works without problems.</p>\n\n<p>I am saving into a file with </p>\n\n<pre><code>import qualified Data.ByteString            as BS\nimport qualified Data.Serialize             as S (decode, encode)\nimport Data.Either \n\ntoFile path = do\n   let a = take 1000 [100..] :: [Float]\n   let b = take 100 [1..] :: [Float]\n   BS.appendFile path $ S.encode (a,b)\n</code></pre>\n\n<p>and reading with</p>\n\n<pre><code>fromFile path = do \n    bstr&lt;-BS.readFile path\n    let d = S.decode bstr :: Either String ([Float],[Float])\n    return (Right d)\n</code></pre>\n\n<p>but reading from that file with <code>fromFile</code>only gives me 1 Element of it although i append to that file multiple times.</p>\n\n<p>Since im appending to the file it should have multiple Elements inside it so im missing something like map on my <code>fromFile</code> function but i couldnt work out how.</p>\n\n<p>I appreciate any help or any other solutions so using  Data.Serialize and ByteString is not a must. Other possibilities i thought of are json files with Data.Aeson if i cant get it to work with Serialize</p>\n\n<p>Edit :</p>\n\n<p>I realized that i made a mistake on the decoding type in <code>fromFile</code></p>\n\n<pre><code>let d = S.decode bstr :: Either String ([Float],[Float])\n</code></pre>\n\n<p>it should be like this</p>\n\n<pre><code>let d = S.decode bstr :: Either String [([Float],[Float])]\n</code></pre>\n"}, {"tags": ["haskell", "types", "polymorphism", "alias"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1537108663, "post_id": 52355019, "comment_id": 91654909, "body": "N.b. <code>applyMaybe f a b = f &lt;$&gt; a &lt;*&gt; b</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1537108861, "post_id": 52355019, "comment_id": 91654974, "body": "In your first codefragment you write <code>data HanoiDisk = ...</code>, in the latter it is <code>type HanoiDisk = ...</code>, what did you use?"}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 5, "creation_date": 1537112322, "post_id": 52355019, "comment_id": 91655985, "body": "What&#39;s the question?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1537116752, "post_id": 52355019, "comment_id": 91657219, "body": "If your function <code>&gt;&gt;&gt;=</code> was applicable to <code>HanoiDisk</code>, what would you expect the type of <code>((&gt;) &gt;&gt;&gt;= a) b</code> to be?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537120306, "post_id": 52355019, "comment_id": 91658222, "body": "<code>hanoiDisk</code> was supposed to call <code>hanoiDisk&#39;</code>, implementing the actual algorithm. otherwise, this isn&#39;t doing anything."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1537125416, "post_id": 52355019, "comment_id": 91659663, "body": "Do you want a data type for positive integers?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1537153054, "post_id": 52355019, "comment_id": 91664799, "body": "@AJFarmar: even more directly, <code>applyMaybe = liftA2</code>. The latter is now actually a method of <code>Applicative</code>."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10354068, "user_type": "registered", "profile_image": "https://graph.facebook.com/507184540/picture?type=large", "display_name": "Brad Phillips", "link": "https://stackoverflow.com/users/10354068/brad-phillips"}, "edited": false, "score": 0, "creation_date": 1537141380, "post_id": 52357315, "comment_id": 91662987, "body": "Thanks for the awesome reply! :) Yeah I&#39;m over cooking the problem, I guess I&#39;m trying to explore the language find the right pattern to solve common problems. I can picture using smart constructors a lot, but wanting to use those with generic functions."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1537125475, "last_edit_date": 1537125475, "creation_date": 1537123344, "answer_id": 52357315, "question_id": 52355019, "link": "https://stackoverflow.com/questions/52355019/haskell-higher-order-function-that-takes-a-pattern/52357315#52357315", "title": "haskell higher order function that takes a &#39;pattern&#39;", "body": "<p>As you have correctly determined, the reason for the original error message is that:</p>\n\n<pre><code>data HanoiDisk = HanoiDisk (Maybe Integer)\n</code></pre>\n\n<p>introduces an \"algebraic data type\" and not a \"type alias\", so the values of <code>a</code> and <code>b</code> are of type <code>HanoiDisk</code> not <code>Maybe Integer</code>  The type error then results because the type <code>HanoiDisk</code> is not of the form <code>Maybe a</code> and/or <code>Maybe b</code> required by <code>applyMaybe</code>.</p>\n\n<p>One way of accomplishing what you want -- having a general <code>applyMaybe</code> operate on types that aren't <code>Maybe a</code> but somehow \"look\" like the pattern <code>Maybe a</code> -- is to introduce a typeclass, but to paraphrase an old joke about regular expressions:  \"A new Haskell programmer has a problem and decides to use a type class.  Now the programmer has two problems.\"  Ha ha!</p>\n\n<h3>Just convert it</h3>\n\n<p>I've included a type class solution below, but the more straightforward and idiomatic way of treating <code>HanoiDisk</code> like a <code>Maybe Integer</code> is to provide a conversion function, either explicitly or by introducing a named field in the data type, as below.  This approach is used throughout the standard library, and in real world Haskell code.</p>\n\n<pre><code>module HanoiDiskConvert where\n\ndata HanoiDisk = HanoiDisk { getHanoiDisk :: Maybe Integer }\n  deriving (Show)\nhanoiDisk :: Integer -&gt; HanoiDisk\nhanoiDisk n\n  | n &gt; 0 = HanoiDisk (Just n)\n  | otherwise = HanoiDisk Nothing\n\napplyMaybe :: (a -&gt; b -&gt; c) -&gt; Maybe a -&gt; Maybe b -&gt; Maybe c\napplyMaybe f (Just a) (Just b) = Just (f a b)\napplyMaybe _ _ _ = Nothing\n-- or as noted below, just: applyMaybe = liftA2\n\nmain = do\n  let a = hanoiDisk 5\n      b = hanoiDisk 7\n  print $ applyMaybe (&gt;) (getHanoiDisk a) (getHanoiDisk b)\n</code></pre>\n\n<p>You should think of <code>getHanoiDisk</code> as being the moral equivalent of having to use <code>fromIntegral</code> when you write <code>mean xs = sum xs / fromIntegral (length xs)</code>.  It's just satisfying Haskell's requirement that even \"obvious\" type conversions should be explicit.</p>\n\n<p>A further advantage of this approach is that -- as referenced in a comment -- <code>Maybe</code> already has an <code>Applicative</code> instance that you can be using here.  Your <code>applyMaybe</code> is just a specialization of <code>liftA2</code> from <code>Control.Applicative</code>:</p>\n\n<pre><code>import Control.Applicative\napplyMaybe :: (a -&gt; b -&gt; c) -&gt; Maybe a -&gt; Maybe b -&gt; Maybe c\napplyMaybe = liftA2\n</code></pre>\n\n<p>and there's a bunch of other useful stuff in that module that you can use.  For example, the following are equivalent, and the applicative operator syntax becomes easy to read and write as you gain experience using it:</p>\n\n<pre><code>applyMaybe (&gt;) (getHanoiDisk a) (getHanoiDisk b)\n(&gt;) &lt;$&gt; getHanoiDisk a &lt;*&gt; getHanoiDisk b      -- using applicative operators\n</code></pre>\n\n<h3>An ill-advised typeclass solution</h3>\n\n<p>Anyway, if you <em>really</em> wanted to do this using a type class, it would look something like this.  You'd define a class that allows conversion of a \"maybe-like\" type to and from an actual maybe value:</p>\n\n<pre><code>class MaybeLike m a | m -&gt; a where\n  toMaybe :: m -&gt; Maybe a\n  fromMaybe :: Maybe a -&gt; m\n</code></pre>\n\n<p>You'd also want to define an instance to allow plain <code>Maybe</code> values themselves to be treated as maybe-like!</p>\n\n<pre><code>instance MaybeLike (Maybe a) a where\n  toMaybe = id\n  fromMaybe = id\n</code></pre>\n\n<p>Then, you could define an instance for your <code>HanoiDisk</code> type:</p>\n\n<pre><code>data HanoiDisk = HanoiDisk (Maybe Integer) deriving (Show)\ninstance MaybeLike HanoiDisk Integer where\n  toMaybe (HanoiDisk x) = x\n  fromMaybe x = HanoiDisk x\n</code></pre>\n\n<p>Finally, you can define a general <code>applyMaybe</code> that can work with any <code>MaybeLike</code> types, by converting to and from <code>Maybe</code>:</p>\n\n<pre><code>applyMaybe :: (MaybeLike m a, MaybeLike n b, MaybeLike k c)\n           =&gt; (a -&gt; b -&gt; c) -&gt; m -&gt; n -&gt; k\napplyMaybe f m n = fromMaybe $ f &lt;$&gt; toMaybe m &lt;*&gt; toMaybe n\n</code></pre>\n\n<p>Finally, then, this would allow you to write the full program:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nmodule HanoiClass where\n\nclass MaybeLike m a | m -&gt; a where\n  toMaybe :: m -&gt; Maybe a\n  fromMaybe :: Maybe a -&gt; m\n\ninstance MaybeLike (Maybe a) a where\n  toMaybe = id\n  fromMaybe = id\n\ndata HanoiDisk = HanoiDisk (Maybe Integer) deriving (Show)\ninstance MaybeLike HanoiDisk Integer where\n  toMaybe (HanoiDisk x) = x\n  fromMaybe x = HanoiDisk x\n\napplyMaybe :: (MaybeLike m a, MaybeLike n b, MaybeLike k c)\n           =&gt; (a -&gt; b -&gt; c) -&gt; m -&gt; n -&gt; k\napplyMaybe f m n = fromMaybe $ f &lt;$&gt; toMaybe m &lt;*&gt; toMaybe n\n\nhanoiDisk :: Integer -&gt; HanoiDisk\nhanoiDisk n\n  | n &gt; 0 = HanoiDisk (Just n)\n  | otherwise = HanoiDisk Nothing\n\nmain = do\n  let a = hanoiDisk 5\n      b = hanoiDisk 7\n      res = applyMaybe (&gt;) a b :: Maybe Bool\n  print res\n</code></pre>\n\n<h3>But you shouldn't be doing this...</h3>\n\n<p>Work through and play with the above code if you like, but realize that it's a terrible idea for an actual design.  One reason is that I can see right now that your choice of representation for <code>HanoiDisk</code> isn't a good one.  This may start to become obvious to you when you switch from writing generic functions and type classes and try to solve your actual programming problem.  For example, you might write:</p>\n\n<pre><code>data HanoiTower = HanoiTower [HanoiDisk]\n</code></pre>\n\n<p>and start asking yourself what this value represents:</p>\n\n<pre><code>HanoiTower [HanoiDisk (Just 3), HanoiDisk Nothing]\n</code></pre>\n\n<p>and why you're writing code to handle it.  Then, you'll start to wonder, why were you ever trying to compare a <code>HanoiDisk (Just 3)</code> with a <code>HanoiDisk Nothing</code>?  When would this ever be useful?</p>\n\n<p>Finally, you'll realize that you really want to check for and act on valid disk sizes at the <em>start</em> of your program but work internally with a representation of valid disks only:</p>\n\n<pre><code>newtype HanoiDisk' = HanoiDisk' Integer\n</code></pre>\n\n<p>that have either been created by an alternate smart constructor:</p>\n\n<pre><code>hanoiDisk' :: Integer -&gt; Maybe HanoiDisk'\nhanoiDisk' n | n &gt; 0 = Just (HanoiDisk' n)\n             | otherwise = Nothing\n</code></pre>\n\n<p>or by other code that \"obviously\" creates valid disks.</p>\n\n<p>At this point you'll also realize that all the time you spent writing type classes, instances, and generic <code>applyMaybe</code> functions was wasted.</p>\n\n<p>If you'd stuck with a more agile design with a couple of <code>getHanoiDisk</code> calls sprinkled around, you'd have a lot less useless code to abandon.</p>\n\n<p>If you're coming from a Java background or something, you're probably used to the idea of developing elaborate boilerplate, object hierarchies, and best-practice design patterns on the front end before you write your first line of useful code.  This can be an effective approach in the Java universe, but it's less effective in programming Haskell, especially when you're just starting out.</p>\n\n<p>Though it will be difficult, try making a conscious effort to write the most straightforward code you can, and don't look so hard for artificial opportunities to catch non-positive numbers at compile time, write generic higher-order functions, and introduce type classes to solve every problem.  These opportunities will evolve naturally in a way they seldom do when writing in other programming languages.  This is advice I wish someone had hammered into my head five years ago.</p>\n"}], "owner": {"reputation": 33, "user_id": 10354068, "user_type": "registered", "profile_image": "https://graph.facebook.com/507184540/picture?type=large", "display_name": "Brad Phillips", "link": "https://stackoverflow.com/users/10354068/brad-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 52357315, "answer_count": 1, "score": 0, "last_activity_date": 1537125475, "creation_date": 1537107586, "question_id": 52355019, "link": "https://stackoverflow.com/questions/52355019/haskell-higher-order-function-that-takes-a-pattern", "title": "haskell higher order function that takes a &#39;pattern&#39;", "body": "<p>This leads on from <a href=\"https://stackoverflow.com/questions/52298627/haskell-compile-time-checking-of-smart-constructors\">my last question</a></p>\n\n<p>So I have</p>\n\n<pre><code>&gt; module HanoiDisk(HanoiDisk, hanoiDisk) where\n&gt; data HanoiDisk = HanoiDisk (Maybe Integer) deriving (Show)\n&gt; hanoiDisk :: Integer -&gt; HanoiDisk\n&gt; hanoiDisk n \n&gt;   | n &gt; 0 = HanoiDisk (Just n)\n&gt;   | otherwise = HanoiDisk Nothing\n</code></pre>\n\n<p>I wrote applyMaybe and an infix operator for working with this type:</p>\n\n<pre><code>&gt; applyMaybe :: (a -&gt; b -&gt; c) -&gt; Maybe a -&gt; Maybe b -&gt; Maybe c\n&gt; applyMaybe f (Just a) (Just b) = Just (f a b)\n&gt; applyMaybe _ _ _ = Nothing\n&gt;\n&gt; infix 5 &gt;&gt;&gt;=\n&gt; (&gt;&gt;&gt;=) = applyMaybe\n</code></pre>\n\n<p>I wanted to keep applyMaybe and (and the infix) general since this is pretty handy on its own.</p>\n\n<p>But when I try and use applyMaybe with HanoiDisks I get:</p>\n\n<pre><code>&gt; a = hanoiDisk 5\n&gt; b = hanoiDisk 7\n&gt; applyMaybe (&gt;) a b\n\n* Couldn't match expected type `Maybe ()'\n              with actual type `HanoiDisk'\n* In the third argument of `applyMaybe', namely `b'\n  In the expression: applyMaybe (&gt;) a b\n  In an equation for `it': it = applyMaybe (&gt;) a b\n</code></pre>\n\n<p>but HanoiDisk is just an alias of Maybe Integer, so this should work?!</p>\n\n<hr>\n\n<p>I realized at the end that 'alias' was the key word, so... instead of using data I used type, I thought I'd be able to answer my own question..</p>\n\n<p>so my module becomes </p>\n\n<pre><code>&gt; module HanoiDisk(HanoiDisk, hanoiDisk) where\n&gt; type HanoiDisk = Maybe Integer\n&gt; hanoiDisk :: Integer -&gt; HanoiDisk\n&gt; hanoiDisk n \n&gt;   | n &gt; 0 = (Just n)\n&gt;   | otherwise = Nothing\n</code></pre>\n\n<p>Then I can use the general form of my applyMaybe function:</p>\n\n<pre><code>&gt; let a = hanoiDisk 4\n&gt; let b = hanoiDisk 5\n&gt; ((&gt;) &gt;&gt;&gt;= a) b \nJust False\n</code></pre>\n\n<p>I don't like this since you could have </p>\n\n<pre><code>&gt; let t = Just (-4)\n&gt; expectsGreaterThanZero :: HanoiDisk -&gt; Bool\n</code></pre>\n\n<p>Suggestions? I'm guessing I might have to look at type classes?</p>\n"}, {"tags": ["haskell", "repa", "accelerate-haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537108495, "post_id": 52354005, "comment_id": 91654870, "body": "I didn&#39;t read through your question, sorry, but just looking at your image the arrays are perfectly rectangular, you just have a bit special neighbors relationship. looking at your image <a href=\"https://imgur.com/a/Vcq8dG1\" rel=\"nofollow noreferrer\">skewed 30 degrees to the right</a> it is easier to see how that relationship could be defined following the 6 line segments around the chosen center tile. Apologies if you already knew all this and wrote about it in the question (that I skipped over)."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537112117, "post_id": 52354005, "comment_id": 91655917, "body": "@WillNess The question is not to store the grid as an array, but for each cell, a &#39;list&#39; of its neighbors. That won&#39;t be rectangular because the cells have a different amount of neighbors."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537116603, "post_id": 52354005, "comment_id": 91657177, "body": "why not have the grid in an array and just access the neighbors through the specialized indexing scheme? it&#39;ll still be O(1) per element. is the grid huge and you only need few of such neighborhoods, is that it? otherwise, why not?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1537125164, "post_id": 52354005, "comment_id": 91659589, "body": "I&#39;m almost certain that using an array of neighbor indices will be <i>slower</i> than calculating them on the fly, unless the grid is small. CPU cache is a tightly limited and extremely valuable resource; using some of it to hold values that can be computed in a couple cheap instructions doesn&#39;t sound good."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537129002, "post_id": 52354005, "comment_id": 91660563, "body": "@willness Developing the index scheme is a lot of work for the particular coordinate system (axial) which allows for storing the grid in an array without wasting space (the latter property is important to me for unrelated reasons)"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1537129009, "post_id": 52354005, "comment_id": 91660566, "body": "@dfeuer Using the code in the post, generating the neighbors for a cell is O(n) but it is possible to do in constant time thus your solution is probably best. Writing the code to do it in O(n) is far less work than doing it in O(1) because the neighbor offsets differ between odd and even columns.That said I still would like a solution to the actual question in this post; emulating jagged arrays (and the creation of them) is a common problem in software development."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537129425, "post_id": 52354005, "comment_id": 91660665, "body": "@willness (and even ignoring that, I would curious to know how to carry on the solution to the problem as stated)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1537130238, "post_id": 52354005, "comment_id": 91660846, "body": "I&#39;d recommend you consider alternatives to the monolithic-array-with-some-dummy-entries approach. That&#39;s a very Matlab thing to do. I&#39;d consider just lining up all the neighbours of all cells in one 1D unboxed vector, and then for each cell storing just an offset into that vector and the number of neighbours. This is much nicer to construct in a pure-functional manner, and it would also need less total memory, if the number of neighbours varies considerably."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1537130355, "post_id": 52354005, "comment_id": 91660866, "body": "@leftaroundabout I agree that&#39;s a much better solution."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537130840, "post_id": 52354005, "comment_id": 91660983, "body": "the indexing is very simple. you can derive it just by looking at the skewed image. then certainly generating the neighbors will take O(1) time per neighbor. you haven&#39;t answered about the comparative sizes of all cells vs the number of neighborhoods."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537130969, "post_id": 52354005, "comment_id": 91661012, "body": "@willness The size of the grid in the picture is the one that I will actually be using, 7x7, and all cells are equally interesting."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537131079, "post_id": 52354005, "comment_id": 91661041, "body": "so there&#39;s no problem with using what I proposed. you have simple regular 2D array. each time you need to find neighbors for a cell, generate their indices according to the six green segments in the second picture, skip the invalid indices, access the array in O(1) time per neighbor."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537131305, "post_id": 52354005, "comment_id": 91661088, "body": "@willness No there is not. I&#39;m not aware of any formula/equation for the set of n-distance neighbors for arbitrary <code>n</code>. Coding the offsets by hand is a lot of work since you must do it for every distance <code>n</code> that you need, twice, since the offsets differ for odd and even columns."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537134395, "post_id": 52354005, "comment_id": 91661688, "body": "@willness Could you make an answer post. I don&#39;t know which second picture you&#39;re referring to (there&#39;s only 1 in the post) nor do I grok your code. By <code>filterIsvalid</code> I assume you mean filtering by grid bounds. I don&#39;t get the directions you&#39;re referring to; how  n-distance neighbors are traversed for a given cell and arbitrary n."}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 0, "creation_date": 1537191597, "post_id": 52354005, "comment_id": 91682528, "body": "Looks like a bunch of cubes to me, is it easier to approach the problem in a 3D coordinate system?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 1, "creation_date": 1537196204, "post_id": 52354005, "comment_id": 91685617, "body": "@davidcox That leads to wasted space when storing the grid in a rectangular array. See <a href=\"https://www.redblobgames.com/grids/hexagons/\" rel=\"nofollow noreferrer\">redblobgames.com/grids/hexagons</a> for an excellent resource on hexagonal grids."}], "answers": [{"tags": [], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "is_accepted": false, "score": 0, "last_activity_date": 1537130826, "creation_date": 1537130826, "answer_id": 52358246, "question_id": 52354005, "link": "https://stackoverflow.com/questions/52354005/emulating-non-rectangular-arrays/52358246#52358246", "title": "Emulating non-rectangular arrays", "body": "<p>This can be by using the <a href=\"https://hackage.haskell.org/package/accelerate-1.2.0.0/docs/Data-Array-Accelerate.html#v:permute\" rel=\"nofollow noreferrer\">permute</a> function to fill the neighbors for 1 cell at a time.</p>\n\n<pre><code>import Data.Bits (shift)\nimport Data.Array.Accelerate as A\nimport qualified Prelude as P\nimport Prelude hiding ((++), (==))\n\nrows = 7\ncols = 7\nchannels = 70\n\ntype Cell = (Int, Int)\n\n(neighs, nNeighs) = fillNeighs\n\ngetNeighs :: Cell -&gt; Acc (Array DIM1 Cell)\ngetNeighs (r, c) = A.take (nNeighs ! sh1) $ slice neighs sh2\n  where\n    sh1 = constant (Z :. r :. c)\n    sh2 = constant (Z :. r :. c :. All)\n\nfillNeighs :: (Acc (Array DIM3 Cell), Acc (Array DIM2 Int))\nfillNeighs = (neighs2, nNeighs2)\n  where\n    sh = constant (Z :. rows :. cols :. 18) :: Exp DIM3\n    neighZeros = fill sh (lift (0 :: Int, 0 :: Int)) :: Acc (Array DIM3 Cell)\n    -- nNeighZeros = fill (constant (Z :. rows :. cols)) 0 :: Acc (Array DIM2 Int)\n    (neighs2, nNeighs2li) = foldr inner (neighZeros, []) indices\n    nNeighs2 = use $ fromList (Z :. rows :. cols) nNeighs2li\n    -- Generate indices by varying column fastest. This assures that fromList, which fills\n    -- the array in row-major order, gets nNeighs in the correct order.\n    indices = foldr (\\r acc -&gt; foldr (\\c acc2 -&gt; (r, c):acc2 ) acc [0..cols-1]) [] [0..rows-1]\n    inner :: Cell\n      -&gt; (Acc (Array DIM3 Cell), [Int])\n      -&gt; (Acc (Array DIM3 Cell), [Int])\n    inner cell (neighs, nNeighs) = (newNeighs, n : nNeighs)\n      where\n        (newNeighs, n) = fillCell cell neighs\n\n\n-- Given an cell and a 3D array to contain cell neighbors,\n-- fill in the neighbors for the given cell\n-- and return the number of neighbors filled in\nfillCell :: Cell -&gt; Acc (Array DIM3 Cell) -&gt; (Acc (Array DIM3 Cell), Int)\nfillCell (r, c) arr = (permute const arr indcomb neighs2arr, nNeighs)\n  where\n    (ra, ca) = (lift r, lift c) :: (Exp Int, Exp Int)\n    neighs2li = generateNeighs 2 (r, c)\n    nNeighs = P.length neighs2li\n    neighs2arr = use $ fromList (Z :. nNeighs) neighs2li\n    -- Traverse the 3rd dimension of the given cell\n    indcomb :: Exp DIM1 -&gt; Exp DIM3\n    indcomb nsh = index3 ra ca (unindex1 nsh)\n\n\ngenerateNeighs :: Int -&gt; Cell -&gt; [Cell]\ngenerateNeighs d cell1 = [ (row2, col2)\n                            | row2 &lt;- [0..rows]\n                            , col2 &lt;- [0..cols]\n                            , hexDistance cell1 (row2, col2) P.== d]\n\n\n-- Manhattan distance between two cells in an hexagonal grid with an axial coordinate system\nhexDistance :: Cell -&gt; Cell -&gt; Int\nhexDistance (r1, c1) (r2, c2) = shift (abs rd + abs (rd + cd) + abs cd) (-1)\n  where\n    rd = r1 - r2\n    cd = c1 - c2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1537136087, "last_edit_date": 1537136087, "creation_date": 1537135222, "answer_id": 52358761, "question_id": 52354005, "link": "https://stackoverflow.com/questions/52354005/emulating-non-rectangular-arrays/52358761#52358761", "title": "Emulating non-rectangular arrays", "body": "<p>Here's you picture skewed 30 degrees to the right:</p>\n\n<p><a href=\"https://i.stack.imgur.com/YbM3e.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YbM3e.png\" alt=\"enter image description here\"></a></p>\n\n<p>As you can see your array is actually perfectly rectangular.</p>\n\n<p>The indices of a neighborhood's periphery are easily found as six straight pieces around the chosen center cell, e.g. (imagine <code>n == 2</code>  is the distance of the periphery from the center <code>(i,j) == (3,3)</code> in the picture):</p>\n\n<pre><code>periphery n (i,j) = \n   --     2 (3,3)\n  let \n    ((i1,j1):ps1) = reverse . take (n+1) . iterate (\\(i,j)-&gt;(i,j+1)) $ (i-n,j) \n    --                                                                 ( 1, 3)\n    ((i2,j2):ps2) = reverse . take (n+1) . iterate (\\(i,j)-&gt;(i+1,j)) $ (i1,j1) \n    --                                                                 ( 1, 5)\n    .....\n    ps6           = .......                                          $ (i5,j5)\n  in filter isValid (ps6 ++ ... ++ ps2 ++ ps1)\n</code></pre>\n\n<p>The whole neighborhood is simply</p>\n\n<pre><code>neighborhood n (i,j) = (i,j) : concat [ periphery k (i,j) | k &lt;- [1..n] ]\n</code></pre>\n\n<p>For each cell/distance combination, simply generate the neighborhood indices on the fly and access your array in <em>O(1)</em> time for each index pair.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537203806, "post_id": 52370985, "comment_id": 91689773, "body": "BTW the reason I used <code>reverse</code> was that I didn&#39;t want to call <code>last</code> to find the next starting point which is the next vertex of the fence polygon. But if we calculate each of the six vertices of the polygon explicitly (which isn&#39;t hard; I was just being lazy with that), we don&#39;t need all that, and can eliminate the reverses, and also convert the <code>take...iterate</code> to simple enumerations in the style of <code>zip [i,i+1..i+d-1] (repeat j)</code>. :) Also seems the d==1 case should be special cased as well (there&#39;s no enumerations, just the vertices)."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537270977, "post_id": 52370985, "comment_id": 91715722, "body": "@WillNess I incorporated your first suggestion in the post. I also benchmarked that code (with suggestion #1) versus also using <code>zip</code>s and <code>repeat</code>s. It turns out the latter approach is about 50 % slower according to Criterion (testing code: <a href=\"https://github.com/tsoernes/haskelldca/blob/master/test/TestGridneighs.hs\" rel=\"nofollow noreferrer\">github.com/tsoernes/haskelldca/blob/master/test/&hellip;</a>)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537279162, "post_id": 52370985, "comment_id": 91721267, "body": "you&#39;re right, I later thought about this too (that there&#39;s no real need to special case d==1) but wasn&#39;t on-line to comment. so <code>iterate</code> compiles into a faster code than enumerations, interesting. Ah, indeed, <code>zip</code> is not a &quot;good producer&quot; (i.e. it doesn&#39;t fuse) but <code>iterate</code> is; so this makes sense. Did you make sure to compile with the -O2 switch BTW?"}], "tags": [], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "is_accepted": false, "score": 2, "last_activity_date": 1537267555, "last_edit_date": 1537267555, "creation_date": 1537197533, "answer_id": 52370985, "question_id": 52354005, "link": "https://stackoverflow.com/questions/52354005/emulating-non-rectangular-arrays/52370985#52370985", "title": "Emulating non-rectangular arrays", "body": "<p>Writing out the answer from @WillNess in full, and incorporating the proposal from @leftroundabout to store indecies in a 1D vector instead, and we get this:</p>\n\n<pre><code>import qualified Data.Array.Accelerate as A\nimport Data.Array.Accelerate (Acc, Array, DIM1, DIM2, DIM3, Z(..), (:.)(..), (!), fromList, use)\n\nrows = 7\ncols = 7\n\ntype Cell = (Int, Int)\n\n(neighs, nNeighs) = generateNeighs\n\n-- Return a vector of indices of cells at distance 'd' or less from the given cell\ngetNeighs :: Int -&gt; Cell -&gt; Acc (Array DIM1 Cell)\ngetNeighs d (r,c) = A.take n $ A.drop start neighs\n  where\n    start = nNeighs ! A.constant (Z :. r :. c :. 0)\n    n = nNeighs ! A.constant (Z :. r :. c :. d)\n\ngenerateNeighs :: (Acc (Array DIM1 Cell), Acc (Array DIM3 Int))\ngenerateNeighs = (neighsArr, nNeighsArr)\n  where\n    idxs = concat [[(r, c) | c &lt;- [0..cols-1]] | r &lt;- [0..rows-1]]\n    (neighsLi, nNeighsLi, n) = foldl inner ([], [], 0) idxs\n    neighsArr = use $ fromList (Z :. n) neighsLi\n    nNeighsArr = use $ fromList (Z :. rows :. cols :. 5) nNeighsLi\n    inner (neighs', nNeighs', n') idx = (neighs' ++ cellNeighs, nNeighs'', n'')\n      where\n        (cellNeighs, cellNNeighs) = neighborhood idx\n        n'' = n' + length cellNeighs\n        nNeighs'' = nNeighs' ++ n' : cellNNeighs\n\nneighborhood :: Cell -&gt; ([Cell], [Int])\nneighborhood (r,c) = (neighs, nNeighs)\n  where\n    neighsO = [ periphery d (r,c) | d &lt;- [1..4] ]\n    neighs = (r,c) : concat neighsO\n    nNeighs = tail $ scanl (+) 1 $ map length neighsO\n\nperiphery d (r,c) =\n  -- The set of d-distance neighbors form a hexagon shape. Traverse each of\n  -- the sides of this hexagon and gather up the cell indices.\n  let \n    ps1 = take d . iterate (\\(r,c)-&gt;(r,c+1))   $ (r-d,c)\n    ps2 = take d . iterate (\\(r,c)-&gt;(r+1,c))   $ (r-d,c+d)\n    ps3 = take d . iterate (\\(r,c)-&gt;(r+1,c-1)) $ (r,c+d)\n    ps4 = take d . iterate (\\(r,c)-&gt;(r,c-1))   $ (r+d,c)\n    ps5 = take d . iterate (\\(r,c)-&gt;(r-1,c))   $ (r+d,c-d)\n    ps6 = take d . iterate (\\(r,c)-&gt;(r-1,c+1)) $ (r,c-d)\n  in filter isValid (ps6 ++ ps5 ++ ps4 ++ ps3 ++ ps2 ++ ps1)\n\n\nisValid :: Cell -&gt; Bool\nisValid (r, c)\n  | r &lt; 0 || r &gt;= rows = False\n  | c &lt; 0 || c &gt;= cols = False\n  | otherwise = True\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 52358761, "answer_count": 3, "score": 3, "last_activity_date": 1537267555, "creation_date": 1537100018, "last_edit_date": 1537130166, "question_id": 52354005, "link": "https://stackoverflow.com/questions/52354005/emulating-non-rectangular-arrays", "title": "Emulating non-rectangular arrays", "body": "<p>Often times you want the performance of arrays over linked lists while having not conforming to the requirement of having rectangular arrays.</p>\n\n<p>As an example consider an hexagonal grid, here shown with the 1-distance neighbors of cell (3, 3) in medium gray and the 2-distance neighbors in light gray.\n<a href=\"https://i.stack.imgur.com/5zFBv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5zFBv.png\" alt=\"enter image description here\"></a>\nSay we want an array that contains, for each cell, the indices of every 1- and 2-distance neighbor for that cell. One slight issue is that cells have a different amount of X-distance neighbors -- cells on the grid border will have fewer neighbors than cells closer to the grid center.</p>\n\n<p>(We want an array of neighbor indices --- instead of a function from cell coordinates to neighbor indices --- for performance reasons.) </p>\n\n<p>We can work around this problem by keeping track of how many neighbors each cell has. Say you have an array \n<code>neighbors2</code> of size <code>R x C x N x 2</code>, where <code>R</code> is the number of grid rows, <code>C</code> for columns, and <code>N</code> is the maximum number of 2-distance neighbors for any cell in the grid.\nThen, by keeping an additional array <code>n_neighbors2</code> of size <code>R x C</code>, we can keep track of which indices in <code>neighbors2</code> are populated and which are just zero padding. For example, to retrieve the the 2-distance neighbors of cell (2, 5), we simply index into the array as such: </p>\n\n<p><code>someNeigh = neighbors2[2, 5, 0..n_neighbors2[2, 5], ..]</code></p>\n\n<p><code>someNeigh</code> will be a <code>n_neighbors2[2, 5] x 2</code> array (or view) of indicies, where <code>someNeigh[0, 0]</code> yields the row of the first neighbor, and <code>someNeigh[0, 1]</code> yields the column of the first neighbor and so forth.\nNote that the elements at the positions </p>\n\n<p><code>neighbors2[2, 5, n_neighbors2[2, 5]+1.., ..]</code></p>\n\n<p>are irrelevant; this space is just padding to keep the matrix rectangular.</p>\n\n<p>Provided we have a function for finding the d-distance neighbors for any cell:</p>\n\n<pre><code>import           Data.Bits (shift)\nrows, cols = (7, 7)\ntype Cell = (Int, Int)\n\ngenerateNeighs :: Int -&gt; Cell -&gt; [Cell]\ngenerateNeighs d cell1 = [ (row2, col2)\n                            | row2 &lt;- [0..rows-1]\n                            , col2 &lt;- [0..cols-1]\n                            , hexDistance cell1 (row2, col2) == d]\n\nhexDistance :: Cell -&gt; Cell -&gt; Int\nhexDistance (r1, c1) (r2, c2) = shift (abs rd + abs (rd + cd) + abs cd) (-1)\n  where\n    rd = r1 - r2\n    cd = c1 - c2\n</code></pre>\n\n<p>How can we create the aforementioned arrays <code>neighbors2</code> and <code>n_neighbors2</code>? Assume we know the maximum amount of 2-distance neighbors  <code>N</code> beforehand. Then it is possible to modify <code>generateNeighs</code> to always return lists of the same size, as we can fill up remaining entries with (0, 0). That leaves, as I see it, two problems:</p>\n\n<ul>\n<li>We need a function to populate <code>neighbors2</code> which operates not every individual index but on a slice, in our case it should fill one cell at a time.</li>\n<li><code>n_neighbors2</code> should be populated simultaneously as <code>neighbors2</code></li>\n</ul>\n\n<p>A solution is welcome with either <code>repa</code> or <code>accelerate</code> arrays.</p>\n"}, {"tags": ["haskell", "haste"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1537083090, "creation_date": 1537083090, "answer_id": 52351953, "question_id": 52351256, "link": "https://stackoverflow.com/questions/52351256/how-to-get-a-random-number-with-haste/52351953#52351953", "title": "how to get a random number with Haste", "body": "<p><code>randomRIO (1,100) :: IO Int</code> would generate such a random number.</p>\n\n<p>Note that since this is not a pure value, it can only be used inside the IO monad.</p>\n\n<p>See the <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow noreferrer\"><code>System.Random</code></a> documentation for more information.</p>\n"}], "owner": {"reputation": 1226, "user_id": 983447, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/e677e1bb118c65183742b414d8574f9a?s=128&d=identicon&r=PG", "display_name": "user983447", "link": "https://stackoverflow.com/users/983447/user983447"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1537083090, "creation_date": 1537076151, "question_id": 52351256, "link": "https://stackoverflow.com/questions/52351256/how-to-get-a-random-number-with-haste", "title": "how to get a random number with Haste", "body": "<p>I write a simple Haskell program using Haste ( <a href=\"https://www.haste-lang.org/\" rel=\"nofollow noreferrer\">https://www.haste-lang.org/</a> ). I need to get a random number from range 1-100. How can I do this?</p>\n"}, {"tags": ["scala", "haskell", "clojure"], "comments": [{"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 2, "creation_date": 1537099054, "post_id": 52350969, "comment_id": 91652452, "body": "I see only: 1) Overly broad introduction paragraph about &quot;some interop&quot;. 2) List of three sentences which I don&#39;t understand (apples do not &quot;generalize&quot; oranges, oranges do not &quot;generalize&quot; apples, scala <code>Functions</code> aren&#39;t tied to <code>scala.collection.Traversable</code> in any significant way). 3) &quot;Would monads be useful&quot; - for <i>what case</i>? You haven&#39;t asked anything yet. 4) &quot;Would a <code>map</code> operation be implemented [...]&quot; - it&#39;s already implemented on every thinkable and unthinkable collection, and also on everything that vaguely resembles a functor. Unclear what you&#39;re asking."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1537100531, "post_id": 52350969, "comment_id": 91652762, "body": "And also: the last code snippet is not a <code>map</code>. It seems like it&#39;s taking <code>(scala-fn +)</code> which reduces lists of integers to integers (ie. <code>List[Int] =&gt; Int</code>), and something that looks roughly like <code>List[Seq[Int]]</code>, and produces a <code>Seq[Int]</code>. That corresponds to <a href=\"https://github.com/scalaz/scalaz/blob/scalaz-seven/core/src/main/scala/scalaz/Traverse.scala#L100\" rel=\"nofollow noreferrer\"><code>sequence</code></a> operation on <a href=\"https://github.com/scalaz/scalaz/blob/scalaz-seven/core/src/main/scala/scalaz/Traverse.scala\" rel=\"nofollow noreferrer\"><code>Traverse</code></a>, followed by an ordinary <code>map</code>. Maybe take a look at <code>Traverse</code> to reformulate the question more clearly."}, {"owner": {"reputation": 13052, "user_id": 1291986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/745681266d2eb7cfa30c941aa5a77c7c?s=128&d=identicon&r=PG&f=1", "display_name": "zcaudate", "link": "https://stackoverflow.com/users/1291986/zcaudate"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1537149345, "post_id": 52350969, "comment_id": 91664165, "body": "@AndreyTyukin, see additional explaination."}, {"owner": {"reputation": 403, "user_id": 3554119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79421d48f8e4e753ab9ec19b3a964b7?s=128&d=identicon&r=PG&f=1", "display_name": "dirkt", "link": "https://stackoverflow.com/users/3554119/dirkt"}, "edited": false, "score": 0, "creation_date": 1537253655, "post_id": 52350969, "comment_id": 91705387, "body": "A <code>map</code> operation can be generalized over all container types (and more). In Haskell, this is called a <code>Functor</code>, and the generalized function is called <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Functor.html\" rel=\"nofollow noreferrer\">fmap</a>. However, it&#39;s impossible to derive this automatically for all interesting cases (though it could be done for some), so it has to be provided for each container. Monads are not really useful for that; but one of the requirements for Monads is that the underlying Monad type is a functor. So for every Monad, such a generalized map must exist."}, {"owner": {"reputation": 403, "user_id": 3554119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79421d48f8e4e753ab9ec19b3a964b7?s=128&d=identicon&r=PG&f=1", "display_name": "dirkt", "link": "https://stackoverflow.com/users/3554119/dirkt"}, "edited": false, "score": 0, "creation_date": 1537253666, "post_id": 52350969, "comment_id": 91705395, "body": "You can define <a href=\"https://stackoverflow.com/questions/8460594/scala-functor-and-monad-differences\">functors in scala</a>"}, {"owner": {"reputation": 403, "user_id": 3554119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79421d48f8e4e753ab9ec19b3a964b7?s=128&d=identicon&r=PG&f=1", "display_name": "dirkt", "link": "https://stackoverflow.com/users/3554119/dirkt"}, "edited": false, "score": 0, "creation_date": 1537266308, "post_id": 52350969, "comment_id": 91712818, "body": "What kind of context are you talking about? Something that works both in Clojure and Scala, so context = programming language?"}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 2, "creation_date": 1537272790, "post_id": 52350969, "comment_id": 91716930, "body": "<i>&quot;all the literature I&#39;ve read on monads seem to presume that any function f:X-&gt;Y is universal&quot;</i>... Now I see <a href=\"https://en.wikipedia.org/wiki/Universal_property#Formal_definition\" rel=\"nofollow noreferrer\">more technical terms</a> used seemingly out of context, but I don&#39;t see how it&#39;s supposed to make the question clearer. What I don&#39;t see is any attempt to connect the actual problem with monads - what do monads have to do with anything of it? Is it used just as a placeholder for &quot;some abstraction&quot;?"}, {"owner": {"reputation": 12330, "user_id": 1374461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541fe7eb28782e457c7cd83db9a5694f?s=128&d=identicon&r=PG", "display_name": "Jasper-M", "link": "https://stackoverflow.com/users/1374461/jasper-m"}, "edited": false, "score": 0, "creation_date": 1537274138, "post_id": 52350969, "comment_id": 91717803, "body": "They are not just &quot;libraries&quot;. First and foremost they are compilers that translate text into JVM bytecode (or Javascript, or native code...). And by the way, recent versions of Scala can compile lambdas to Java functional interfaces (Single Abstract Method types). And the Scala function types themselves are also SAM-types, so in Java you can pass a lambda where a Scala function is expected."}, {"owner": {"reputation": 13052, "user_id": 1291986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/745681266d2eb7cfa30c941aa5a77c7c?s=128&d=identicon&r=PG&f=1", "display_name": "zcaudate", "link": "https://stackoverflow.com/users/1291986/zcaudate"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1537284167, "post_id": 52350969, "comment_id": 91724696, "body": "@AndreyTyukin, I find monads very confusing, yet I persist."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1537809994, "post_id": 52350969, "comment_id": 91910428, "body": "@AndreyTyukin It&#39;s just that <code>map</code> in Clojure also covers what Scala and Haskell call <code>zipWith</code>/<code>zipWith3</code>/etc."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1537810322, "post_id": 52350969, "comment_id": 91910562, "body": "@AlexeyRomanov Yeah, might well be... As I&#39;ve <a href=\"https://stackoverflow.com/questions/52106357/what-is-the-difference-between-clojure-clojure-core-reducers-fold-and-scala-fold/52106945#52106945\">already noticed myself</a>, <code>&quot;reduce&quot;</code> and <code>&quot;fold&quot;</code> are also named weirdly and confusingly..."}], "answers": [{"tags": [], "owner": {"reputation": 725, "user_id": 1117884, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/uoBrU.png?s=128&g=1", "display_name": "yokto", "link": "https://stackoverflow.com/users/1117884/yokto"}, "is_accepted": true, "score": 1, "last_activity_date": 1537806819, "last_edit_date": 1537806819, "creation_date": 1537805619, "answer_id": 52483402, "question_id": 52350969, "link": "https://stackoverflow.com/questions/52350969/how-would-monadic-rules-apply-if-the-function-could-be-of-a-different-type/52483402#52483402", "title": "how would monadic rules apply if the function could be of a different type", "body": "<p>I can only give you the Haskell answer, since I don't speak any of those other languages. However to me it seems like you're mostly looking for a way to automatically convert the input to a function. It doesn't appear to have anything to do with monads.</p>\n\n<pre><code>(concat (scala-list 1 2) [3 4]) =&gt; (scala-list 1 2 3 4)\n</code></pre>\n\n<p>If I translate this to Haskell I would give it a type like this</p>\n\n<pre><code>concat :: (IsList l1, IsList l2) =&gt; l1 elem -&gt; l2 elem -&gt; [elem]\n</code></pre>\n\n<p>where ToList is a typeclass which will just convert this container to a list</p>\n\n<pre><code>class IsListOf a where\n    toList :: a elem -&gt; [elem]\n</code></pre>\n\n<p>It is not clear from your example how you would decide on an output type, so I can't help with that.</p>\n\n<pre><code>(map + [1 2] (scala-list 3 4)) =&gt; [4 6]\n</code></pre>\n\n<p>In Haskell this function is not called map but zipWith. If you want to automcatically convert the input you can do it like this.</p>\n\n<pre><code>zipWith :: (IsList l1, IsList l2) =&gt; (a -&gt; b -&gt; c) -&gt; l1 a -&gt; l2 b -&gt; [c]\n</code></pre>\n\n<p>If you want to automatically convert the function you can do it just as well.</p>\n\n<pre><code>zipWith :: (IsList l1, IsList l2, Is2Function f) =&gt; f a b c -&gt; l1 a -&gt; l2 b -&gt; [c]\n</code></pre>\n\n<p>Is2Function would again be a typeclass that just converts to a 2-ary function</p>\n\n<pre><code>class Is2Function f where\n    toFunction :: f a b c -&gt; a -&gt; b -&gt; c\n</code></pre>\n\n<p>There is also something to keep in mind concerning generalizations. I said in the previous that I didn't know how you would decide on the output. This is a problem the compiler also has from time to time (at least in haskell) when you do to many generalizations. Generalizations seem nice on the surface but they don't always make things more clear and can lead to ambiguity.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 3, "last_activity_date": 1537813060, "last_edit_date": 1592644375, "creation_date": 1537813060, "answer_id": 52485169, "question_id": 52350969, "link": "https://stackoverflow.com/questions/52350969/how-would-monadic-rules-apply-if-the-function-could-be-of-a-different-type/52485169#52485169", "title": "how would monadic rules apply if the function could be of a different type", "body": "<blockquote>\n<p>scala functions extend scala.Function and generalises collection operations on scala.collection.Traversable</p>\n<p>java lambdas extend java.util.function.Function and generalises collection operations on java.util.stream.Stream</p>\n</blockquote>\n<p>First, the good news: this isn't correct, Java and Scala lambdas can implement any SAM (single abstract method) interface. This allows using Java lambdas with APIs expecting <code>scala.FunctionN</code> and Scala lambdas with APIs expecting <code>java.util.function.*</code> (including Java streams). This interoperability should be complete in Scala 2.12 and later (so far as I know).</p>\n<p>The bad news (you knew this was coming): when talking about Scala collection API specifically, it also very much relies on implicit parameters, and those aren't really usable from Java or Clojure. Similarly, Clojure collection API relies on dynamic typing, and <code>IFn</code> isn't a SAM type (because it covers functions with different numbers of arguments). And of course, for use from Clojure, interoperation between Java and Scala lambdas doesn't help.</p>\n<p>More generally speaking, the 3 collection APIs (4 if you count the redesing coming in Scala 2.13) are probably too different to be unified like that.</p>\n<p>I don't see any way in which monads per se would be useful here. If I was trying to do something usable from Clojure, I'd go with &quot;checking the collection and function types and doing some coercing before function application&quot; as the solution. <a href=\"https://clojure.org/reference/protocols\" rel=\"nofollow noreferrer\">Protocols</a> could simplify it, but with some performance cost.</p>\n"}], "owner": {"reputation": 13052, "user_id": 1291986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/745681266d2eb7cfa30c941aa5a77c7c?s=128&d=identicon&r=PG&f=1", "display_name": "zcaudate", "link": "https://stackoverflow.com/users/1291986/zcaudate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 52483402, "answer_count": 2, "score": 7, "last_activity_date": 1537813060, "creation_date": 1537072319, "last_edit_date": 1537194392, "question_id": 52350969, "link": "https://stackoverflow.com/questions/52350969/how-would-monadic-rules-apply-if-the-function-could-be-of-a-different-type", "title": "how would monadic rules apply if the function could be of a different type", "body": "<p>I'm looking at doing some interop between clojure and scala. As java itself now has lambdas, I was thinking of a generalisation between data and how to apply a function to a collection</p>\n\n<ul>\n<li>clojure functions extend <code>clojure.lang.IFn</code> and generalises collection operations on <code>clojure.lang.ISeq</code></li>\n<li>scala functions extend <code>scala.Function</code> and generalises collection operations on <code>scala.collection.Traversable</code></li>\n<li>java lambdas extend <code>java.util.function.Function</code> and generalises collection operations on <code>java.util.stream.Stream</code></li>\n</ul>\n\n<p>Questions:</p>\n\n<ul>\n<li>Would monads be useful in this case?</li>\n<li>If so, would a <code>map</code> operation be implemented across all collection types and how might this be generalisable?</li>\n</ul>\n\n<p>Example:</p>\n\n<pre><code>  (map (scala-fn +) \n       [1 2 3]\n       (scala-seq [1 2 3]) \n       (.stream [1 2 3]))\n  =&gt; (scala-seq [3 6 9])\n</code></pre>\n\n<hr>\n\n<p><strong>Continued</strong> (added haskell as a tag just in case the hardcore type people might know)</p>\n\n<p>There are operations in both Clojure, Scala and Java that take a collection, applies a function to that collection and returns a new collection. </p>\n\n<ul>\n<li>All of these languages run on the JVM. </li>\n<li>However, each language defines it's own class to represent a function.</li>\n</ul>\n\n<p>I'm more familiar with clojure, so there are operations like:</p>\n\n<pre><code> (into {} [[:a 1] [:b 2]]) =&gt; {:a 1 :b 2}\n</code></pre>\n\n<p>Which converts a clojure vector into a clojure map. Because the <code>into</code> operation generalises on <code>java.util.List</code> any datastructure that inherits <code>java.util.List</code> can be used.</p>\n\n<p>I wish to work with some scala libraries in clojure and face certain obstacles:</p>\n\n<ul>\n<li>Scala, like clojure also has immutable data structures, but they are defined very differently from clojure data structures</li>\n<li>Scala functions inherit from <code>scala.Function</code> and so need to be wrapped to <code>clojure.lang.IFn</code></li>\n<li><p>Scala datastructures do not inherit from <code>java.util.List</code> which means that:</p>\n\n<p><code>(into {} (scala-list [:a 1] [:b 2]))</code>  will not work.</p></li>\n<li><p>I'm looking to reimplement some basic clojure functions that also incorporate scala datastructures. (map, reduce, mapcat, etc...)</p></li>\n</ul>\n\n<p>The functionality would look something like:</p>\n\n<pre><code> (into {} (scala-list [:a 1] [:b 2])) =&gt; {:a 1 :b 2}\n\n (into (scala-map) [[:a 1] [:b 2]]) =&gt; (scala-map :a 1 :b 2)\n\n (concat (scala-list 1 2) [3 4]) =&gt; (scala-list 1 2 3 4)\n\n (concat [1 2] (scala-list 3 4)) =&gt; (1 2 3 4) ;lazy seq\n\n (map + [1 2] (scala-list 3 4)) =&gt; [4 6]\n\n (map (scala-fn +) [1 2] (scala-list 3 4)) =&gt; [4 6]\n</code></pre>\n\n<ul>\n<li>What I'm looking for is the ability to use both clojure and scala functions in collection operations.</li>\n<li>I can do this without using monads (by checking the collection and function types and doing some coercing before function application)</li>\n<li>What I'm asking here serves as a bit of a curiosity for me, as all the literature I've read on monads seem to presume that any function <code>f:X-&gt;Y</code> is universal.</li>\n<li>However, in the case of clojure/scala/lambda interop, a clojure function, a scala function and a java lambda are not universal. I'm curious about how category theory might be used to solve this problem.</li>\n</ul>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1537067312, "post_id": 52350577, "comment_id": 91646499, "body": "Which operating system/distro are you using ?"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "edited": false, "score": 0, "creation_date": 1537131375, "post_id": 52357337, "comment_id": 91661105, "body": "This doesn&#39;t seem to change anything. It does install a new GHC, but the same error happens."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "edited": false, "score": 0, "creation_date": 1537134648, "post_id": 52357337, "comment_id": 91661741, "body": "What&#39;s the state of <code>libtinfo.*</code> and <code>libncursesw.*</code> in your <code>&#47;usr&#47;lib</code>? I can&#39;t think exactly why <code>-lncursesw</code> would try to load <code>libtinfo.so</code> unless <code>libncursesw</code> was symlinked to it - and why your system GHC wouldn&#39;t have the same issue, unless it was loading <code>libtinfo.so.6</code> directly, and that links somewhere else, like <code>libncursesw.so.6</code>, as it does on my system (God knows why)."}, {"owner": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "edited": false, "score": 0, "creation_date": 1537135302, "post_id": 52357337, "comment_id": 91661888, "body": "I have various libtinfo.so.* that link to corresponding libncurses.so.*. Nothing links to libncursesw.so.* as far as I can tell. <code>stack ghc</code> doesn&#39;t have this issue either, for some reason, but <code>stack ghci</code> does."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "edited": false, "score": 0, "creation_date": 1537135759, "post_id": 52357337, "comment_id": 91661977, "body": "Looks like this is an issue with <code>ghc</code> that depends on how the distro handles going from <code>libncurses.so</code> to <code>libncursesw.so</code> : <a href=\"https://github.com/commercialhaskell/stack/issues/440\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/440</a> . There&#39;s a workaround specified in that issue - does it work for you?"}, {"owner": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "edited": false, "score": 1, "creation_date": 1537136211, "post_id": 52357337, "comment_id": 91662057, "body": "Yes, making libncurses.so a symlink to libncursesw.so fixed the issue. Thanks!"}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 1, "last_activity_date": 1537136454, "last_edit_date": 1537136454, "creation_date": 1537123481, "answer_id": 52357337, "question_id": 52350577, "link": "https://stackoverflow.com/questions/52350577/stack-cant-find-lncursesw/52357337#52357337", "title": "Stack can&#39;t find -lncursesw", "body": "<p>This looks like an issue with the <code>bindist</code> Stack has chosen for Void Linux - it normally guesses right, but it can cause issues on some distros. The <code>tinfo6</code> variant tries to load <code>libtinfo.so</code>, since some distributions provide <code>ncurses6</code> through that shared object file. You can try <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#ghc-build\" rel=\"nofollow noreferrer\">configuring the variant manually</a> - you'll probably want <code>standard</code>. Stack will install a new GHC version if you do that, but it will change what shared object it tries to load for <code>ncurses</code>.</p>\n\n<h3>EDIT:</h3>\n\n<p>This was actually caused by <a href=\"https://github.com/commercialhaskell/stack/issues/440\" rel=\"nofollow noreferrer\">an issue with GHC</a> - if the distro links between the various <code>ncurses</code> files with a linker <em>file</em>, instead of an actual link, GHC won't follow it properly and instead complain that the file doesn't exist. The solution is to replace the linker file with a link to the target.</p>\n"}], "owner": {"reputation": 47, "user_id": 5016175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vslmo.png?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/5016175/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 52357337, "answer_count": 1, "score": 2, "last_activity_date": 1537136454, "creation_date": 1537066577, "last_edit_date": 1537109159, "question_id": 52350577, "link": "https://stackoverflow.com/questions/52350577/stack-cant-find-lncursesw", "title": "Stack can&#39;t find -lncursesw", "body": "<p>When I try compiling my Haskell program with Stack, I get the following error:</p>\n\n<pre><code>Building executable 'fractal' for fractal-0.1.0.0..\n[1 of 2] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.2.0.1/build/fractal/fractal-tmp/Main.o )\n &lt;command line&gt;: can't load .so/.DLL for: /usr/lib/gcc/x86_64-unknown-linux-gnu/8.2.0/../../../../lib/libtinfo.so (-lncursesw: cannot open shared object file: No such file or directory)\n\n --  While building custom Setup.hs for package fractal-0.1.0.0 using:\n  /home/lorxu/.stack/setup-exe-cache/x86_64-linux-tinfo6/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3 --builddir=.stack-work/dist/x86_64-linux-tinfo6/Cabal-2.2.0.1 build lib:fractal exe:fractal --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n</code></pre>\n\n<p>When I compile with GHC directly, it works fine, and libncursesw.so is present in /usr/lib. I'm on Void Linux. Any ideas where Stack is looking?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537063079, "post_id": 52350227, "comment_id": 91645962, "body": "Do you understand what the error message is telling you?"}, {"owner": {"reputation": 57, "user_id": 10369431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c6e8eb37be31b6c6b3443e3bfb4e8fb?s=128&d=identicon&r=PG&f=1", "display_name": "Cody G.", "link": "https://stackoverflow.com/users/10369431/cody-g"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1537063804, "post_id": 52350227, "comment_id": 91646091, "body": "From my understanding it means I&#39;m missing a case. Possibly if [y] == []? @MarkSeemann"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1537064582, "post_id": 52350227, "comment_id": 91646192, "body": "Note that, if we are not writing a type signature, <code>[y]</code> doesn&#39;t mean &quot;a list called <code>y</code>&quot;, but rather &quot;a list with a single element, <code>y</code>&quot;. You might want to have a look at <a href=\"https://stackoverflow.com/q/48884276/2751851\">this question</a>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1537066726, "post_id": 52350227, "comment_id": 91646428, "body": "@CodyG. Yes, that&#39;s one missing case. It&#39;s not the only one, though."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1537068106, "post_id": 52350227, "comment_id": 91646628, "body": "(By the way, the &quot;if we are not writing a type signature&quot; in my previous comment might give the wrong impression, as <code>[y]</code> on a type signature means something entirely different -- the type of lists with elements of some type <code>y</code>.)"}, {"owner": {"reputation": 57, "user_id": 10369431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c6e8eb37be31b6c6b3443e3bfb4e8fb?s=128&d=identicon&r=PG&f=1", "display_name": "Cody G.", "link": "https://stackoverflow.com/users/10369431/cody-g"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1537068932, "post_id": 52350227, "comment_id": 91646724, "body": "@duplode thanks for the hhelp but I&#39;m just really confused. I looked over your link and it makes sense that I can&#39;t use [y] however, I&#39;m unsure of where to go after because I run in to a whole host of other errors such as couldn&#39;t match type [Int] with expected type Int."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1537072402, "post_id": 52350227, "comment_id": 91647138, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/23178455/non-exhaustive-pattern-in-function-nothirds\">Non exhaustive pattern in function noThirds</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537082489, "post_id": 52350227, "comment_id": 91648750, "body": "Your question is too broad (and I voted to close it as such). Start by making your function be able to also handle empty lists. then add ability to handle lists of two elements. if you have problems there, ask new specific questions please. see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. -- also see if <a href=\"https://web.archive.org/web/20160728022441/http://stackoverflow.com:80/documentation/haskell/2281/lists\" rel=\"nofollow noreferrer\">this</a> helps."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537083314, "post_id": 52350227, "comment_id": 91648959, "body": "(change that last link to <a href=\"https://web.archive.org/web/20170803134836/https://stackoverflow.com/documentation/haskell/2281/lists\" rel=\"nofollow noreferrer\">this</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1537082055, "creation_date": 1537082055, "answer_id": 52351845, "question_id": 52350227, "link": "https://stackoverflow.com/questions/52350227/non-exhaustive-pattern/52351845#52351845", "title": "Non exhaustive pattern", "body": "<p>A list value can be of any one of the following forms</p>\n\n<ul>\n<li><code>[]</code></li>\n<li><code>[y1]</code>, i.e. <code>y1:[]</code></li>\n<li><code>[y1,y2]</code>, i.e. <code>y1:y2:[]</code></li>\n<li><code>[y1,y2,y3]</code>, i.e. <code>y1:y2:y3:[]</code></li>\n<li>...</li>\n<li>infinite lists <code>y1:y2:y3:...</code></li>\n</ul>\n\n<p>(pedantically, we also have lists ending with a bottom, but I'll neglect those)</p>\n\n<p>A defining equation like</p>\n\n<pre><code>f [y] = ...\n</code></pre>\n\n<p>only considers the lists of the form <code>[y1]</code>, having a single element (<code>y</code>). All the other cases are not matched by the equation.</p>\n\n<p>If <code>y</code> is meant to be a generic list argument, and not the single element, we instead must use</p>\n\n<pre><code>f y = ...\n</code></pre>\n\n<p>As we see, list arguments do not require special syntax.</p>\n\n<p>To detect non-exhaustiveness errors, it is strongly recommended to turn on warnings during compilation. If we do so, GHC would report that we missed the cases <code>[]</code> and <code>_:_:_</code>, the latter being a list with at least two elements.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1537137169, "post_id": 52352153, "comment_id": 91662243, "body": "and what should <code>inc 1 []</code> return? also, <code>[]</code> is a list, not an array."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1537172454, "post_id": 52352153, "comment_id": 91671109, "body": "Your <code>inc x [y]</code> definition is redundant."}], "tags": [], "owner": {"reputation": 7256, "user_id": 9187350, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/PNJAq.png?s=128&g=1", "display_name": "Renato Damas", "link": "https://stackoverflow.com/users/9187350/renato-damas"}, "is_accepted": false, "score": 0, "last_activity_date": 1537172513, "last_edit_date": 1537172513, "creation_date": 1537084869, "answer_id": 52352153, "question_id": 52350227, "link": "https://stackoverflow.com/questions/52350227/non-exhaustive-pattern/52352153#52352153", "title": "Non exhaustive pattern", "body": "<p>Your implementation is incomplete, it says you are only supporting lists of single elements. You need to extend your implementation in order to cover all the possibilities. Use recursion to iterate through all the elements. A possible implementation could be:</p>\n\n<pre><code>inc :: Int-&gt;[Int]-&gt;[Int]\ninc _ [] = []\ninc x (y:ys) = if x == y then x:inc x ys else inc x ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 0, "last_activity_date": 1537172800, "creation_date": 1537172800, "answer_id": 52363601, "question_id": 52350227, "link": "https://stackoverflow.com/questions/52350227/non-exhaustive-pattern/52363601#52363601", "title": "Non exhaustive pattern", "body": "<p>When you want to inspect values of some type, you need to know what the possible \"shapes\" (i.e. data constructors) of that type are.</p>\n\n<p>In the case of lists, values have one of two forms:</p>\n\n<ul>\n<li>empty: <code>[]</code></li>\n<li>non-empty: <code>h : t</code> (where <code>h</code> is the head (first element) of the list and <code>t</code> is the tail (another list))</li>\n</ul>\n\n<p>When you write something like <code>[1, 2, 3]</code>, it really means <code>1 : (2 : (3 : []))</code> (a list whose head is <code>1</code> and whose tail is another list whose head is <code>2</code> and whose tail is another list whose head is <code>3</code> and whose tail is <code>[]</code>).</p>\n\n<p>For functions consuming lists, that usually means you need to provide two equations:</p>\n\n<pre><code>inc x [] = ...\n</code></pre>\n\n<p>to handle empty lists and</p>\n\n<pre><code>inc x (y : ys) = ...\n</code></pre>\n\n<p>to handle non-empty lists (<code>y</code> will be the first element of the list and <code>ys</code> the remaining values).</p>\n"}, {"tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": false, "score": 0, "last_activity_date": 1537190790, "creation_date": 1537190790, "answer_id": 52368857, "question_id": 52350227, "link": "https://stackoverflow.com/questions/52350227/non-exhaustive-pattern/52368857#52368857", "title": "Non exhaustive pattern", "body": "<p>In Haskell, when possible its best to avoid explicit recursion and do away with some of the exhaustive pattern matching by using functions. Specifically for this case, you could use <code>filter</code>. Read up on its documentation <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch20.html#x28-24100020.6\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Using this function your program could be written as:</p>\n\n<pre><code>inc :: Int-&gt; [Int] -&gt; [Int]\ninc x ys = filter (==x) ys\n</code></pre>\n\n<p>Or point free style:</p>\n\n<pre><code>inc x = filter (==x)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 10369431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c6e8eb37be31b6c6b3443e3bfb4e8fb?s=128&d=identicon&r=PG&f=1", "display_name": "Cody G.", "link": "https://stackoverflow.com/users/10369431/cody-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1537190790, "creation_date": 1537061477, "last_edit_date": 1537172529, "question_id": 52350227, "link": "https://stackoverflow.com/questions/52350227/non-exhaustive-pattern", "title": "Non exhaustive pattern", "body": "<p>I am very new to Haskell and I have a problem. I have a module defined as: </p>\n\n<pre><code>inc :: Int-&gt;[Int]-&gt;[Int]\n</code></pre>\n\n<p>What it is supposed to do is to return all occurrences of the first argument in its second argument. So output of <code>1 [1,1,3]</code> would return <code>[1,1]</code>.</p>\n\n<p>This is what I have:</p>\n\n<pre><code> inc :: Int-&gt;[Int]-&gt;[Int]\n inc x [y] = if [x] == [y] then [x] else []\n</code></pre>\n\n<p>Since I was struggling I just wanted to see if it would work for one number and it does. For instance: <code>1 [1]</code> returns <code>[1]</code>. However, when I attempt you use multiple values such as <code>1 [1,1]</code> I receive the error:</p>\n\n<blockquote>\n  <p>Non exhaustive patterns in the function inc</p>\n</blockquote>\n\n<p>How could I adapt my program, so it is able to handle multiple values instead of just one value?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 5, "creation_date": 1537055857, "post_id": 52349820, "comment_id": 91644840, "body": "Do you mean you want it to <i>ignore</i> both parameters?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1537056280, "post_id": 52349820, "comment_id": 91644903, "body": "Well that&#39;s a constant, so <code>e6 = 2 + 3</code>, with signature <code>Int</code>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10326304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b02a693a91f76f88a8d710b7aa421004?s=128&d=identicon&r=PG&f=1", "display_name": "H. Dong", "link": "https://stackoverflow.com/users/10326304/h-dong"}, "edited": false, "score": 0, "creation_date": 1537065819, "post_id": 52349882, "comment_id": 91646321, "body": "Great explanation! Thanks a lot!"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1537057010, "last_edit_date": 1537057010, "creation_date": 1537056650, "answer_id": 52349882, "question_id": 52349820, "link": "https://stackoverflow.com/questions/52349820/how-to-write-haskell-function-with-no-parameter/52349882#52349882", "title": "How to write Haskell function with no parameter?", "body": "<p>Are you asking about how to write a function in <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">point-free style</a>?</p>\n\n<p>If so, you can write the addition function as:</p>\n\n<pre><code>e6 = (+)\n</code></pre>\n\n<p>In this simple example, <code>e6</code> simply becomes an alias for the <code>+</code> operator. In Haskell, operators are just functions with special names, and when you want to use them as functions instead of operators, you surround them with brackets, as above. The <code>(+)</code> function (i.e. <code>+</code> operator) is already a function that takes two arguments, and returns a value.</p>\n\n<p>Here's a bit of GHCi interaction with it:</p>\n\n<pre><code>Prelude&gt; :t e6\ne6 :: Num a =&gt; a -&gt; a -&gt; a\nPrelude&gt; e6 1 3\n4\nPrelude&gt; e6 42 1337\n1379\n</code></pre>\n\n<p>The inferred type is <code>Num a =&gt; a -&gt; a -&gt; a</code>, but this is also compatible with <code>Int -&gt; Int -&gt; Int</code>, so if you wish to constrain the type to that, you can declare the function with this more restricted type. There's no particular reason to do that, though, since the generic version works fine with <code>Int</code> as well, as the GHCi session demonstrates.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 10326304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b02a693a91f76f88a8d710b7aa421004?s=128&d=identicon&r=PG&f=1", "display_name": "H. Dong", "link": "https://stackoverflow.com/users/10326304/h-dong"}, "edited": false, "score": 0, "creation_date": 1537065530, "post_id": 52349907, "comment_id": 91646281, "body": "Sorry about my description. That helps a lot. Thank you so much."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1537071967, "post_id": 52349907, "comment_id": 91647081, "body": "I think it&#39;s worth pointing out that Haskell is lazily evaluated, so in some sense, a variable like <code>e = 2 + 3</code> <i>does</i> behave like a function taking zero arguments which computes <code>2 + 3</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1537081227, "post_id": 52349907, "comment_id": 91648480, "body": "Is <code>(+)</code> really called section syntax? I thought sections are only <code>(+ exp)</code> and <code>(exp +)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537102614, "post_id": 52349907, "comment_id": 91653304, "body": "@chi You might be right about that. To avoid fibbing, I&#39;ve just dropped that aside for now -- what it&#39;s called isn&#39;t really important for the purposes of this answer anyway."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1537102584, "last_edit_date": 1537102584, "creation_date": 1537057063, "answer_id": 52349907, "question_id": 52349820, "link": "https://stackoverflow.com/questions/52349820/how-to-write-haskell-function-with-no-parameter/52349907#52349907", "title": "How to write Haskell function with no parameter?", "body": "<p>It's not super clear what the right fix is, because it's not super clear to me exactly what you want. Here are some possible interpretations of what you want.</p>\n\n<ul>\n<li><p>You want <code>e6</code> to be equivalent to the constant <code>5</code>, computed by evaluating <code>2+3</code>. Since this is not a function, you should not use a function type in its signature.</p>\n\n<pre><code>e6 :: Int\ne6 = 2 + 3\n</code></pre></li>\n<li><p>You want <code>e6</code> to be a function just like <code>add</code> is, but to always return <code>2+3</code> instead of <code>a+b</code> -- that is, to ignore its arguments, even though it still has them. Then the type signature is okay, but you need to explicitly ignore the arguments.</p>\n\n<pre><code>e6 :: Int -&gt; Int -&gt; Int\ne6 _ _ = 2 + 3\n-- OR\ne6 a b = 2 + 3\n</code></pre></li>\n<li><p>You want <code>e6</code> to be just like <code>add</code> in every way, but you don't want to explicitly name its arguments when defining <code>e6</code>. Then, if you're not giving the arguments to <code>e6</code>, you also can't give the arguments to <code>+</code>. So:</p>\n\n<pre><code> e6 :: Int -&gt; Int -&gt; Int\n e6 = (+)\n</code></pre>\n\n<p><code>(+)</code> is special syntax for turning an infix operator into a prefix function; roughly, <code>\\a b -&gt; (+) a b</code> and <code>\\a b -&gt; a + b</code> behave the same way.</p></li>\n</ul>\n"}], "owner": {"reputation": 23, "user_id": 10326304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b02a693a91f76f88a8d710b7aa421004?s=128&d=identicon&r=PG&f=1", "display_name": "H. Dong", "link": "https://stackoverflow.com/users/10326304/h-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 52349907, "answer_count": 2, "score": 2, "last_activity_date": 1537102584, "creation_date": 1537055761, "last_edit_date": 1537056729, "question_id": 52349820, "link": "https://stackoverflow.com/questions/52349820/how-to-write-haskell-function-with-no-parameter", "title": "How to write Haskell function with no parameter?", "body": "<p>I have a function declaration called <code>e6</code>. I need to replace <code>undefined</code> by some code and make it work. </p>\n\n<pre><code>e6 :: Int -&gt; Int -&gt; Int\ne6 = undefined\n</code></pre>\n\n<p>I know for example </p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd a b = a + b\n</code></pre>\n\n<p>It takes parameters a and b then return a + b. But how can I write a function with no argument. I tried</p>\n\n<pre><code>e6 :: Int -&gt; Int -&gt; Int\ne6 = 2 + 3\n</code></pre>\n\n<p>And it said:</p>\n\n<blockquote>\n  <p>No instance for (Num (Int -> Int -> Int)) arising from a use of '+' </p>\n</blockquote>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1537082706, "post_id": 52349199, "comment_id": 91648799, "body": "The default value in mreq is not the default value of the OptionPair  but the default  use to fill countryR (or countryV , which ever contains the value). In your case , it is probably either a Text or a CountryKey."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 1, "creation_date": 1537091979, "post_id": 52349199, "comment_id": 91650841, "body": "The types are a little confusing here - do you think you could annotate <code>defaultCountry</code> and <code>countries</code>? Otherwise, I can&#39;t see why you wouldn&#39;t do <code>(name, key) &lt;- defaultCountry; (countryR, countryV) &lt;- mreq (selectField countries) &quot;&quot; (Just key)</code>."}, {"owner": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 1, "creation_date": 1537103150, "post_id": 52349199, "comment_id": 91653449, "body": "Thanks guys, I updated my question with the GHC errors. They include the expected and provided types. I tried to follow them but I get lost because two of them seems to be in conflict."}], "answers": [{"comments": [{"owner": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 0, "creation_date": 1537231498, "post_id": 52368268, "comment_id": 91699423, "body": "I&#39;m still seeing several errors, but new ones! If I apply only the changes to the <code>defaultCountry</code> function I get <code>Couldn&#39;t match type \u2018record\u2019 with \u2018Country\u2019 \u2018record\u2019 is a rigid type variable bound by the type signature for: defaultCountry :: forall site record. HandlerFor site (Text, Key record) at app&#47;Main.hs:54:1-52 Expected type: HandlerFor site (Text, Key record) Actual type: HandlerFor site (Text, Key Country)</code>"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 0, "creation_date": 1537265959, "post_id": 52368268, "comment_id": 91712616, "body": "Then just replace <code>record</code> in the type declarations with <code>Country</code>."}, {"owner": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 0, "creation_date": 1537279726, "post_id": 52368268, "comment_id": 91721642, "body": "Oh, right \ud83d\ude05 but now the error is even weirder <code>Couldn&#39;t match type \u2018BaseBackend (YesodPersistBackend site)\u2019 with \u2018SqlBackend\u2019 arising from a use of \u2018getBy\u2019</code>. I stripped down my attempt to this <a href=\"https://gist.github.com/tssm/3a503fb60cde023d05a33cf2248e7d40\" rel=\"nofollow noreferrer\">gist.github.com/tssm/3a503fb60cde023d05a33cf2248e7d40</a> (I had several other form fields and it worked until I tried to preselect an option)"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 0, "creation_date": 1537300826, "post_id": 52368268, "comment_id": 91732738, "body": "From the code you&#39;ve shared, it looks like you should then put <code>App</code> instead of <code>site</code> in the type signatures."}, {"owner": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "edited": false, "score": 1, "creation_date": 1537303247, "post_id": 52368268, "comment_id": 91733730, "body": "That reduced the errors enough for me to figure it out the next steps: 1. to get the default country from the database I should use just <code>UniqueCountryName</code> not <code>UniqueCountryName $ countryName)</code> and 2. <code>defaultContry</code> must be lifted when in <code>SurveyForm</code> to being able to get <code>defaultKey</code>. Thank you very much for all your patience!"}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 1, "last_activity_date": 1537188867, "creation_date": 1537188867, "answer_id": 52368268, "question_id": 52349199, "link": "https://stackoverflow.com/questions/52349199/how-to-build-a-pre-selected-option-for-a-selectfield-in-yesod/52368268#52368268", "title": "How to build a pre-selected option for a selectField in Yesod?", "body": "<p>Alright, this looks like a few type errors. The first</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018(,) Text\u2019 with \u2018HandlerFor site\u2019 Expected type: HandlerFor site (Key record) Actual type: (Text, Key record)</p>\n</blockquote>\n\n<p>comes from not using <code>return</code> in your <code>do</code> notation to lift the value to the monad:</p>\n\n<pre><code>defaultCountry :: HandlerFor site (Text, Key record)\ndefaultCountry = do\n  row &lt;- runDB $ getBy $ UniqueCountryName $ countryName \"United States\"\n  return (countryName $ entityVal row, entityKey row)\n</code></pre>\n\n<p>The error on <code>row</code> </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018Entity Country\u2019 with actual type \u2018Maybe (Entity Country)\u2019</p>\n</blockquote>\n\n<p>is because it's a <code>Maybe</code>, so let's correct that</p>\n\n<pre><code>defaultCountry :: HandlerFor site (Text, Key record)\ndefaultCountry = do\n  Just row &lt;- runDB $ getBy $ UniqueCountryName $ countryName \"United States\"\n  return (countryName $ entityVal row, entityKey row)\n</code></pre>\n\n<p>Now that <code>defaultCountry</code> is a good monad, you should be able to use it in your other code. But be careful of that third error </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018Maybe (Key Country)\u2019 with actual type \u2018HandlerFor site0 (Key record0)\u2019</p>\n</blockquote>\n\n<p>You need to unwrap the value from the <code>HandlerFor</code> monad, and rewrap it in a <code>Maybe</code></p>\n\n<pre><code>surveyForm :: Html -&gt; MForm Handler (FormResult SurveyAnswerSet, Widget)\nsurveyForm extra = do\n  (defaultName, defaultKey) &lt;- defaultCountry -- (defaultName, defaultKey) :: (Text, Key record)\n  (countryR, countryV) &lt;- mreq (selectField countries) \"\" (Just defaultKey)\n</code></pre>\n"}], "owner": {"reputation": 1601, "user_id": 259517, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/GtRrC.jpg?s=128&g=1", "display_name": "Tae", "link": "https://stackoverflow.com/users/259517/tae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 52368268, "answer_count": 1, "score": 0, "last_activity_date": 1537188867, "creation_date": 1537048392, "last_edit_date": 1537103038, "question_id": 52349199, "link": "https://stackoverflow.com/questions/52349199/how-to-build-a-pre-selected-option-for-a-selectfield-in-yesod", "title": "How to build a pre-selected option for a selectField in Yesod?", "body": "<p>(<a href=\"https://stackoverflow.com/questions/20588667/multiselectfield-with-pre-selected-options-in-yesod\">This was asked before but it has no answers</a>).</p>\n\n<p>I have a list of countries in a database:</p>\n\n<pre><code>share [mkPersist sqlSettings] [persistLowerCase|\nCountry\n  name Text\n  UniqueCountryName name\n  deriving Show\n|]\n</code></pre>\n\n<p>And I can show a form to select one of them:</p>\n\n<pre><code>countries = do\n  rows &lt;- runDB $ selectList [] [Asc CountryName]\n  optionsPairs $ map (\\ r -&gt; (countryName $ entityVal r, entityKey r)) rows\n\nsurveyForm :: Html -&gt; MForm Handler (FormResult SurveyAnswerSet, Widget)\nsurveyForm extra = do\n  (countryR, countryV) &lt;- mreq (selectField countries) \"\" Nothing\n</code></pre>\n\n<p>I know that I should replace the <code>Nothing</code> in the last line with the desired default value but I still don't get how to do it. Looking at the <a href=\"https://hackage.haskell.org/package/yesod-form-1.4.7.1/docs/Yesod-Form-Functions.html#g:3\" rel=\"nofollow noreferrer\"><code>mreq</code></a> and the <a href=\"https://hackage.haskell.org/package/yesod-form-1.4.9/docs/Yesod-Form-Fields.html#v:optionsPairs\" rel=\"nofollow noreferrer\"><code>optionsPairs</code></a> signatures my thought was that in this case I should provide a <code>Maybe Option</code> with the default country but my attempts have raised so many type errors that probably I am quite far from the right answer.</p>\n\n<p>The Yesod book has an example using seems more simple than what I tried to achieve so I am not sure how to extrapolate it.</p>\n\n<p>By the way I am getting the default country from the database so I don't need to hardcode its internal id:</p>\n\n<pre><code>defaultCountry = do\n  row &lt;- runDB $ getBy $ UniqueCountryName $ countryName \"United States\"\n  (countryName $ entityVal row, entityKey row)\n</code></pre>\n\n<p>When I pass it as an argument to <code>mreq</code> I get the following errors:</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018(,) Text\u2019 with \u2018HandlerFor site\u2019\n  Expected type: HandlerFor site (Key record)\n    Actual type: (Text, Key record)</p>\n</blockquote>\n\n<p>That's on the last line of the of the <code>defaultContry</code> function (<code>(countryName $ entityVal row, entityKey row)</code>). I understand that I should take the <code>Key record</code> from the pair and return it in a <code>HandlerFor site</code> but at the same time I also get:</p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018Maybe (Key Country)\u2019\n              with actual type \u2018HandlerFor site0 (Key record0)\u2019</p>\n</blockquote>\n\n<p>In the <code>(countryR, countryV) &lt;- mreq (selectField countries) \"\" defaultCountry</code> line. I interprete this as \"you are passing me a <code>HandlerFor site0 (Key record0)</code> but I only accept <code>Maybe (Key Country)</code> which seems in conflict with the first error...</p>\n\n<p>In the <code>(countryName $ entityVal row, entityKey row)</code> line I also see:</p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018Entity Country\u2019\n              with actual type \u2018Maybe (Entity Country)\u2019</p>\n</blockquote>\n\n<p>in the <code>row</code> argument. I understand that I should extract the <code>Entity Country</code> from the <code>Maybe</code> but if I pattern match and pass just the <code>Entity Country</code> (i. e.: <code>Just (Entity countryId country) -&gt; (countryName $ entityVal (Entity countryId country), entityKey (Entity countryId country)</code>) I still get the first error.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 9078, "user_id": 1366455, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fa38c3a267295fb2978ded32786073d2?s=128&d=identicon&r=PG", "display_name": "tolgap", "link": "https://stackoverflow.com/users/1366455/tolgap"}, "edited": false, "score": 0, "creation_date": 1537056780, "post_id": 52348059, "comment_id": 91644988, "body": "I can&#39;t believe it was &quot;this simple&quot; :D Thanks, that instantly fixed my issues."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1537039136, "creation_date": 1537039136, "answer_id": 52348059, "question_id": 52347107, "link": "https://stackoverflow.com/questions/52347107/decode-record-while-mapping-a-specific-field/52348059#52348059", "title": "Decode record while mapping a specific field", "body": "<p>The issue is that the key type for the <code>HashMap</code> is ambiguous.  Even though you don't use the keys, Haskell still needs to know the type so it can figure out what parser to instantiate for the <code>Aeson.parseField v \"_embedded\"</code> call.  You can help Haskell out by specializing a type signature for <code>elems</code>:</p>\n\n<pre><code>instance Aeson.FromJSON a =&gt; Aeson.FromJSON (List a) where\n    parseJSON (Aeson.Object v) = List\n        &lt;$&gt; Aeson.parseField v \"count\"\n        &lt;*&gt; fmap elems (Aeson.parseField v \"_embedded\")\n      where elems :: HashMap.HashMap Text.Text a -&gt; [a]\n            elems = HashMap.elems\n    parseJSON invalid = Aeson.typeMismatch \"Not a correct embed for a list\" invalid\n</code></pre>\n\n<p>After this, I can do:</p>\n\n<pre><code>&gt; Aeson.decode \"{\\\"count\\\": 5, \\\"_embedded\\\": {\\\"payments\\\": [1,2,3,4]}}\" \n          :: Maybe (List [Double])\nJust (List {list_count = 5, list__embedded = [[1.0,2.0,3.0,4.0]]})\n</code></pre>\n\n<p>I'm not sure if you intended the payments list to be an <em>element</em> of <code>list__embedded</code> or not, but that should get you on the right track.</p>\n"}], "owner": {"reputation": 9078, "user_id": 1366455, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fa38c3a267295fb2978ded32786073d2?s=128&d=identicon&r=PG", "display_name": "tolgap", "link": "https://stackoverflow.com/users/1366455/tolgap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 52348059, "answer_count": 1, "score": 1, "last_activity_date": 1537039136, "creation_date": 1537032065, "question_id": 52347107, "link": "https://stackoverflow.com/questions/52347107/decode-record-while-mapping-a-specific-field", "title": "Decode record while mapping a specific field", "body": "<p>I have a record that looks like this:</p>\n\n<pre><code>data List a = List\n    { list_count     :: Int\n    , list__embedded :: [a]\n    -- ^The actual data you\u2019re looking for.\n    }\n    deriving (Show)\n</code></pre>\n\n<p>The <code>list__embedded</code> field is from an external API, where the embeds are actually an object:</p>\n\n<pre><code>{\n  \"count\": 5,\n  \"_embedded\": {\n    \"payments\": [\n        // payment records that derive FromJSON\n    ]\n  }\n}\n</code></pre>\n\n<p>As you can see, the <code>_embedded</code> field is actually an object, but I'm only interested in the value of it.</p>\n\n<p>I tried to solve it by writing the <code>FromJSON</code> implementation as following:</p>\n\n<pre><code>instance Aeson.FromJSON a =&gt; Aeson.FromJSON (List a) where\n    parseJSON (Aeson.Object v) = List\n        &lt;$&gt; Aeson.parseField v \"count\"\n        &lt;*&gt; fmap HashMap.elems (Aeson.parseField v \"_embedded\")\n    parseJSON invalid = Aeson.typeMismatch \"Not a correct embed for a list\" invalid\n</code></pre>\n\n<p>But I keep running into a type mismatch:</p>\n\n<pre><code>\u2022 Could not deduce (Aeson.FromJSONKey k0)\n    arising from a use of \u2018Aeson.parseField\u2019\n  from the context: Aeson.FromJSON a\n    bound by the instance declaration\n    at src/Mollie/API/Types.hs:366:10-52\n  The type variable \u2018k0\u2019 is ambiguous\n  These potential instances exist:\n    instance Aeson.FromJSONKey Integer\n      -- Defined in \u2018aeson-1.2.4.0:Data.Aeson.Types.FromJSON\u2019\n    instance Aeson.FromJSONKey Text.Text\n      -- Defined in \u2018aeson-1.2.4.0:Data.Aeson.Types.FromJSON\u2019\n    instance Aeson.FromJSONKey Time.Day\n      -- Defined in \u2018aeson-1.2.4.0:Data.Aeson.Types.FromJSON\u2019\n    ...plus 14 others\n    ...plus 14 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the second argument of \u2018fmap\u2019, namely\n    \u2018(Aeson.parseField v \"_embedded\")\u2019\n  In the second argument of \u2018(&lt;*&gt;)\u2019, namely\n    \u2018fmap HashMap.elems (Aeson.parseField v \"_embedded\")\u2019\n  In the first argument of \u2018(&lt;*&gt;)\u2019, namely\n    \u2018List &lt;$&gt; Aeson.parseField v \"count\"\n       &lt;*&gt; fmap HashMap.elems (Aeson.parseField v \"_embedded\")\u2019\n    |\n369 |         &lt;*&gt; fmap HashMap.elems (Aeson.parseField v \"_embedded\")\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I not quite sure how to make this work.</p>\n"}, {"tags": ["haskell", "semantics", "strictness"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1537015685, "post_id": 52344772, "comment_id": 91635510, "body": "I don&#39;t know for certain but I&#39;m pretty sure it does not try to do that. Irrefutable patterns exist for a reason. that reason being the intended difference in semantics between the two definitions you showed, just as you&#39;ve described them. AFAIK strictness analysis seeks to <i>reduce</i> laziness and perform the unavoidable computations earlier, if it can be proved it won&#39;t change the semantics. But these are just hunches and impressions that I have. Perhaps a close reading of <a href=\"https://www.haskell.org/onlinereport/haskell2010/\" rel=\"nofollow noreferrer\">the Report</a> will provide more definitive answers."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1537034318, "post_id": 52344772, "comment_id": 91640230, "body": "If we bring this reasoning to its extreme, we should also &quot;optimize&quot; <code>seq x y</code> to <code>y</code>, which would defeat the purpose of <code>seq</code>. A strict pattern, in principle, could be used as a special case of <code>seq</code>."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1537058296, "post_id": 52344772, "comment_id": 91645206, "body": "The ~ changes the semantics of the function, so ghc doesn\u2019t do that."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1537021506, "post_id": 52345126, "comment_id": 91636971, "body": "It&#39;s worth noting that the suggested change in the original question <i>does</i> change semantics wrt laziness - it removes some possible bottoms. Sometimes you want very precise control over what bottoms can result from code, and the compiler switching that up on you is awkward."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1537018358, "last_edit_date": 1537018358, "creation_date": 1537018039, "answer_id": 52345126, "question_id": 52344772, "link": "https://stackoverflow.com/questions/52344772/automatically-inserting-laziness-in-haskell/52345126#52345126", "title": "Automatically inserting laziness in Haskell", "body": "<p>As far as I know, GHC will never make something <em>more lazy</em> than specified by the programmer, even if it can prove that doesn't change the semantics of the term. I don't think there is any fundamental reason to avoid changing the laziness of a term when we can prove the semantics don't change; I suspect it's more of an empirical observation that we don't know of any situations where that would be a really great idea. (And if a transformation <em>would</em> change the semantics, I would consider it a bug for GHC to make that change.)</p>\n\n<p>There is only one possible exception that comes to mind, the so-called \"full laziness\" transformation, described well <a href=\"https://wiki.haskell.org/GHC/FAQ#When_can_I_rely_on_full_laziness.3F\" rel=\"nofollow noreferrer\">on the wiki</a>. In short, GHC will translate</p>\n\n<pre><code>\\a b -&gt; let c = {- something that doesn't mention b -} in d\n</code></pre>\n\n<p>to</p>\n\n<pre><code>\\a -&gt; let c = {- same thing as before -} in \\b -&gt; d\n</code></pre>\n\n<p>to avoid recomputing <code>c</code> each time the argument is applied to a new <code>b</code>. But it seems to me that this transformation is more about memoization than about laziness: the two terms above appear to me to have the same (denotational) semantics wrt laziness/strictness, and are only operationally different.</p>\n"}], "owner": {"reputation": 69, "user_id": 10356681, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TzEOGltC0GM/AAAAAAAAAAI/AAAAAAAAAEw/dRYmOMhphAc/photo.jpg?sz=128", "display_name": "Jun Xu", "link": "https://stackoverflow.com/users/10356681/jun-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1537018358, "creation_date": 1537015241, "question_id": 52344772, "link": "https://stackoverflow.com/questions/52344772/automatically-inserting-laziness-in-haskell", "title": "Automatically inserting laziness in Haskell", "body": "<p>Haskell pattern matching is often head strict, for example,<code>f (x:xs) = ...</code>\nrequires input list to be evaluated to (<em>thunk</em> : <em>thunk</em>). But sometimes such evaluation is not needed and function can afford to be non-strict on some arguments, for example <code>f (x:xs) = 3</code>.</p>\n\n<p>Ideally, in such situations we could avoid evaluating arguments to get the behaviour of <code>const 3</code>, which could be done with irrefutable pattern: <code>f ~(x:xs) = 3</code>. This gives us performance benefits and greater error tolerance.</p>\n\n<p>My question is: Does GHC already implement such transformations via some kind of strictness analysis? Appreciate it if you could also point me to some readings on it.</p>\n"}, {"tags": ["list", "function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1537012804, "post_id": 52344388, "comment_id": 91634882, "body": "SO isn&#39;t a code-writing service. You try first, and show us your attempt and explain why you believe you can&#39;t make progress. We&#39;ll help you take whatever the single next step is, then you drive progress again."}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 1, "creation_date": 1537021619, "post_id": 52344388, "comment_id": 91636999, "body": "The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch20.html#x28-23300020.4\" rel=\"nofollow noreferrer\">Haskell report</a> section on building lists might help further your research."}, {"owner": {"reputation": 25, "user_id": 3637052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1831323890/picture?type=large", "display_name": "user3637052", "link": "https://stackoverflow.com/users/3637052/user3637052"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537031547, "post_id": 52344388, "comment_id": 91639521, "body": "@DanielWagner I have modified my code and tried... Could you please check it now? Thank you!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1537033433, "post_id": 52344388, "comment_id": 91639988, "body": "@user3637052 Given that this question has had multiple close votes, it would have been better to ask this improved version as a new question. It&#39;s a much better question now, but keep this in mind, please."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1537042265, "post_id": 52344388, "comment_id": 91642330, "body": "@AJFarmar I disagree. Close votes are supposed to encourage edits, and it does nobody any good to have a bad, closed question lying around instead of improving it. Even if it were actually closed, that&#39;s what reopening is for."}], "answers": [{"tags": [], "owner": {"reputation": 11377, "user_id": 553279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de617e09030cad8f06663113eeea27cc?s=128&d=identicon&r=PG", "display_name": "fdreger", "link": "https://stackoverflow.com/users/553279/fdreger"}, "is_accepted": true, "score": 2, "last_activity_date": 1537032083, "creation_date": 1537032083, "answer_id": 52347109, "question_id": 52344388, "link": "https://stackoverflow.com/questions/52344388/how-to-generate-a-list-with-own-data-type-in-haskell/52347109#52347109", "title": "How to generate a list with own data type in haskell", "body": "<p>You get this error because <code>Cell</code> is - indeed - not a value constructor. Just use plain <code>Empty</code> instead (note that you don't write <code>Bool True</code> or <code>Bool False</code> - you just write <code>True</code> or <code>False</code>).</p>\n"}], "owner": {"reputation": 25, "user_id": 3637052, "user_type": "registered", "profile_image": "https://graph.facebook.com/1831323890/picture?type=large", "display_name": "user3637052", "link": "https://stackoverflow.com/users/3637052/user3637052"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 52347109, "answer_count": 1, "score": 1, "last_activity_date": 1537070297, "creation_date": 1537011874, "last_edit_date": 1537070297, "question_id": 52344388, "link": "https://stackoverflow.com/questions/52344388/how-to-generate-a-list-with-own-data-type-in-haskell", "title": "How to generate a list with own data type in haskell", "body": "<p>I am trying to create an infinite list with my own data type in haskell</p>\n\n<pre><code>data Color = Black | White       deriving (Show, Eq)\ndata Cell  = Empty | Stone Color deriving (Show, Eq)\n\nmakeRow :: Int -&gt; Row\nmakeRow 0 = []\nmakeRow n = take n (repeat Cell Empty)\n</code></pre>\n\n<p>And it gives me the error : </p>\n\n<pre><code>Data constructor not in scope: Cell\n</code></pre>\n"}, {"tags": ["haskell", "random"], "answers": [{"comments": [{"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 0, "creation_date": 1537020718, "post_id": 52344676, "comment_id": 91636771, "body": "So if I understand it correctly, <code>randomIvalInteger</code> deems the range of a <code>Word32</code> smaller than a <code>Word32</code>, and therefore skips every second value of my generator? :&#39;(."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 2, "creation_date": 1537021245, "post_id": 52344676, "comment_id": 91636905, "body": "That&#39;s not the reason for skipping. <code>randomIvalInteger</code> has a helper function which skips values based on a <code>mag</code> (magnitude) argument. The argument starts at <code>1</code>, is multiplied by <code>(highest enum value) - (lowest enum value) + 1</code> every iteration, and values are skipped until it&#39;s bigger than <code>((highest range value) - (lowest range value) + 1) * 1000</code>. In your case, the range is equal to the whole of <code>Word32</code>, so that target is exceeded every other iteration (since <code>(size of Word32)^2 &gt; (size of Word32) * 1000</code>. There&#39;s no way to have a generator which doesn&#39;t skip using <code>randomIvalInteger</code>."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 5, "last_activity_date": 1537014419, "creation_date": 1537014419, "answer_id": 52344676, "question_id": 52343524, "link": "https://stackoverflow.com/questions/52343524/haskell-randomgen-drops-half-of-values/52344676#52344676", "title": "Haskell: RandomGen drops half of values", "body": "<p>This is to do with the behaviour of <a href=\"https://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#randoms\" rel=\"noreferrer\">System.Random.randoms</a>, which repeatedly applies <code>random</code> to a <code>RandomGen</code>, not <code>next</code>.</p>\n\n<pre><code>class Random a where\n    ...\n    random :: (RandomGen g) =&gt; g -&gt; (a, g)\n</code></pre>\n\n<p>The <code>Random</code> class is what allows you to reuse <code>RandomGen</code> instances across different enums, and the instance for <code>Word32</code> (as well as nearly all other types) is defined as </p>\n\n<pre><code>instance Random Word32     where randomR = randomIvalIntegral; random = randomBounded\n</code></pre>\n\n<p><code>randomBounded</code> just calls <code>randomR</code>, so the behaviour of <code>random</code> is decided by `</p>\n\n<pre><code> randomIvalIntegral (l,h) = randomIvalInteger (toInteger l, toInteger h)\n</code></pre>\n\n<p><code>randomIvalInteger</code> is an interesting function, you can read the source <a href=\"https://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#randomIvalInteger\" rel=\"noreferrer\">here</a>. It's actually causing your problem because the function will discard a certain number of intermediate values based on the range of the generator and the range being generated over.</p>\n\n<p>To get the values you want, you just need to use <code>next</code> instead - the easiest way would just be to define</p>\n\n<pre><code>randoms' g = x : (randoms' g') where (x, g') = next g\n</code></pre>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 2, "accepted_answer_id": 52344676, "answer_count": 1, "score": 2, "last_activity_date": 1537014419, "creation_date": 1537004503, "last_edit_date": 1537005329, "question_id": 52343524, "link": "https://stackoverflow.com/questions/52343524/haskell-randomgen-drops-half-of-values", "title": "Haskell: RandomGen drops half of values", "body": "<p>I am writing a simple deterministic Random Number generator, based on the <a href=\"https://en.wikipedia.org/wiki/Xorshift\" rel=\"nofollow noreferrer\">xorshift</a>. The goal here is not to get a cryptographically secure or statistically perfect (pseudo-)random number generator, but to be able to archieve the same deterministic sequence of semi-random numbers across programming languages.</p>\n\n<p>My Haskell program looks like follows:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nmodule SimpleRNG where\n\nimport Data.Word (Word32)\nimport Data.Bits (xor, shift)\nimport System.Random (RandomGen(..))\nimport Control.Arrow\n\n(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\n(|&gt;) x f = f x\ninfixl 0 |&gt;\n\nnewtype SeedState = SeedState Word32\n  deriving (Eq, Show, Enum, Bounded)\n\nseed :: Integral a =&gt; a -&gt; SeedState\nseed = SeedState . fromIntegral\n\nrand_r :: SeedState -&gt; (Word32, SeedState)\nrand_r (SeedState num) = (res, SeedState res)\n  where\n    res = num\n      |&gt; xorshift 13\n      |&gt; xorshift (-17)\n      |&gt; xorshift 5\n    xorshift :: Int -&gt; Word32 -&gt; Word32\n    xorshift amount x = x `xor` (shift x amount)\n\ninstance RandomGen SeedState where\n  next seed_state = (first fromIntegral) $ rand_r seed_state\n    where\n  genRange seed_state = (fromEnum (minBound `asTypeOf` seed_state),\n                fromEnum (maxBound `asTypeOf` seed_state))\n\n  split seed_state@(SeedState num) =  (seed_state', inverted_seed_state')\n    where\n      (_, seed_state') = next seed_state\n      (_, inverted_seed_state') = next inverted_seed_state\n      inverted_seed_state = SeedState (maxBound - num)\n</code></pre>\n\n<p>Now, for some reason, when running</p>\n\n<pre><code>take 10 $ System.Random.randoms (seed 42) :: [Word32]\n</code></pre>\n\n<p>it returns only the 'odd' results, compared to the output of the following Python program:</p>\n\n<pre><code>class SeedState(object):\n    def __init__(self, seed = 42):\n        self.data = seed\n\ndef rand_r(rng_state):\n    num = rng_state.data\n    num ^= (num &lt;&lt; 13) % (2 ** 32)\n    num ^= (num &gt;&gt; 17) % (2 ** 32)\n    num ^= (num &lt;&lt; 5) % (2 ** 32)\n    rng_state.data = num\n    return num\n\n\n__global_rng_state = SeedState(42)\n\ndef rand():\n    global __global_rng_state\n    return rand_r(__global_rng_state)\n\ndef seed(seed):\n    global __global_rng_state\n    __global_rng_state = SeedState(seed)\n\nif __name__ == '__main__':\n    for x in range(0, 10):\n        print(rand())\n</code></pre>\n\n<p>It seems like the internals of the System.Random module do some weird trickery with the return result of the generator \n(calling </p>\n\n<pre><code>map fst $ take 10 $ iterate (\\(_, rng) -&gt; rand_r rng) (rand_r $ seed 42)\n</code></pre>\n\n<p>gives the result I'd expect).</p>\n\n<p>This is odd, since the type returned by the generator is already a <code>Word32</code>, so it could/should just be passed on unaltered without any remapping happening.</p>\n\n<p>What is going on here, and is there a way to plug this xorshift-generator into  System.Random in a way that returns the same results?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537002175, "post_id": 52342776, "comment_id": 91632584, "body": "What&#39;s the full compiler error?"}, {"owner": {"reputation": 778, "user_id": 3574103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0024768df17069f67a5f88b10cc866d7?s=128&d=identicon&r=PG&f=1", "display_name": "PawelN", "link": "https://stackoverflow.com/users/3574103/paweln"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1537008671, "post_id": 52342776, "comment_id": 91633864, "body": "I forgot to add compilation error. I updated my question."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1537012031, "post_id": 52342776, "comment_id": 91634688, "body": "Wouldn&#39;t it be enough to just fix your choice of <code>m</code> in <code>mainServer</code>&#39;s definition; for example, to <code>ReaderT R IO</code> (with some suitable <code>R</code>)?"}], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1537040852, "post_id": 52348036, "comment_id": 91641966, "body": "Indeed. I strongly recommend that you read <a href=\"https://haskell-servant.readthedocs.io/\" rel=\"nofollow noreferrer\">the tutorial</a> to not get stuck on those basics and fully focus on what you want to do. It mentions hoistServer and covers various other things you&#39;ll likely be using in the future."}], "tags": [], "owner": {"reputation": 778, "user_id": 3574103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0024768df17069f67a5f88b10cc866d7?s=128&d=identicon&r=PG&f=1", "display_name": "PawelN", "link": "https://stackoverflow.com/users/3574103/paweln"}, "is_accepted": true, "score": 4, "last_activity_date": 1537038862, "creation_date": 1537038862, "answer_id": 52348036, "question_id": 52342776, "link": "https://stackoverflow.com/questions/52342776/haskell-servant-and-mtl-application-style/52348036#52348036", "title": "Haskell Servant and MTL application style", "body": "<p>Finally I managed to solve my problem.  </p>\n\n<pre><code>run :: (MonadIO m, MonadReader r m, HasNetworkConfig r) =&gt; AppConfig -&gt; m ()\nrun config = do\n  serverPort &lt;- view (networkConfig . port)\n  let settings =\n        setPort serverPort $\n        setBeforeMainLoop (liftIO $ hPutStrLn stderr (\"listening on port \" ++ show serverPort)) defaultSettings\n  liftIO $ runSettings settings (mainServer config)\n\nprintM :: (MonadIO m, Show a) =&gt; a -&gt; m ()\nprintM a = liftIO $ print a\n\ntype ReaderAPI = \"ep1\" :&gt; Get '[ JSON] String :&lt;|&gt; \"ep2\" :&gt; Get '[ JSON] String :&lt;|&gt; Raw :&lt;|&gt; EmptyAPI\n\nreaderApi :: Proxy ReaderAPI\nreaderApi = Proxy :: Proxy ReaderAPI\n\nfromConfig :: (Functor m, MonadReader r m, HasNetworkConfig r) =&gt; m String\nfromConfig = view (networkConfig . host)\n\nrawValue :: (Applicative m) =&gt; m String\nrawValue = pure \"1797\"\n\nreaderServer :: (Monad m) =&gt; ServerT ReaderAPI (AppT m)\nreaderServer = rawValue :&lt;|&gt; fromConfig :&lt;|&gt; Tagged (error \"raw server\") :&lt;|&gt; emptyServer\n\nnt :: AppConfig -&gt; AppT IO x -&gt; Handler x\nnt config x = do\n  res &lt;- liftIO $ runExceptT $ runReaderT (runApp x) config\n  case res of\n    Left e       -&gt; throwError e\n    Right result -&gt; return result\n\nmainServer :: AppConfig -&gt; Application\nmainServer config = serve readerApi api\n  where\n    api = hoistServer readerApi (nt config) readerServer\n</code></pre>\n\n<p>One thing I missed was correct use of hoistServer. After I created correct natural transformation from my monad (AppT) to Handler, everything compiled and work as expected. </p>\n"}], "owner": {"reputation": 778, "user_id": 3574103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0024768df17069f67a5f88b10cc866d7?s=128&d=identicon&r=PG&f=1", "display_name": "PawelN", "link": "https://stackoverflow.com/users/3574103/paweln"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 52348036, "answer_count": 1, "score": 1, "last_activity_date": 1537038862, "creation_date": 1536997897, "last_edit_date": 1537011248, "question_id": 52342776, "link": "https://stackoverflow.com/questions/52342776/haskell-servant-and-mtl-application-style", "title": "Haskell Servant and MTL application style", "body": "<p>After I watched good talk of George Wilson (<strong>Next Level MTL</strong> <a href=\"https://github.com/gwils/next-level-mtl-with-classy-optics/blob/master/Slides.pdf\" rel=\"nofollow noreferrer\">https://github.com/gwils/next-level-mtl-with-classy-optics/blob/master/Slides.pdf</a>) I try to create application which uses MTL style design and decided to use servant, it looks like this library doesn't fit well to such design.<br>\nBelow code doesn't compile because I am not able to transform <strong>m</strong> into Handler.</p>\n\n<pre><code>getItems :: (MonadIO m, MonadReader r m, HasNetworkConfig r) =&gt; m [Item]\ngetItems =\n   return [Item \"foo\" \"bar\"]\n\nmkApp :: Application\nmkApp = serve itemApi getItems\n</code></pre>\n\n<p>You can find complete example here: <a href=\"https://github.com/paweln1986/ServantMTLStackOverflowExample\" rel=\"nofollow noreferrer\">https://github.com/paweln1986/ServantMTLStackOverflowExample</a></p>\n\n<p>Is it possible to use any monad with servant? How to achieve this? I tried to use hoistServer without success. Do you have any idea what I miss here?</p>\n\n<p>Compilation error:</p>\n\n<pre><code>   \u2022 No instance for (MonadReader r0 Handler)\n    arising from a use of \u2018getItems\u2019\n   \u2022 In the second argument of \u2018serve\u2019, namely \u2018getItems\u2019\n     In the expression: serve itemApi getItems\n     In an equation for \u2018mkApp\u2019: mkApp = serve itemApi getItems\n   |\n40 | mkApp = serve itemApi getItems\n   |                       ^^^^^^^^\n</code></pre>\n\n<p>Shorter example:</p>\n\n<pre><code>type ReaderAPI = \"ep1\" :&gt; Get '[JSON] Int :&lt;|&gt; \"ep2\" :&gt; Get '[JSON] String    :&lt;|&gt; Raw :&lt;|&gt; EmptyAPI\n\nreaderApi = Proxy :: Proxy ReaderAPI\n\nreaderServer :: (MonadIO m, HasNetworkConfig r, MonadReader r m) =&gt; ServerT ReaderAPI (AppT m)\nreaderServer = return 1797 :&lt;|&gt; view (networkConfig . host) :&lt;|&gt; Tagged (error \"raw server\") :&lt;|&gt; emptyServer\n\nnt x = return undefined\n\nmainServer = hoistServer readerApi nt readerServer :: Server ReaderAPI\n</code></pre>\n\n<p>This gives me below compilation error</p>\n\n<pre><code>    \u2022 Ambiguous type variable \u2018m0\u2019 arising from a use of \u2018readerServer\u2019\n  prevents the constraint \u2018(MonadIO m0)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018m0\u2019 should be.\n  These potential instances exist:\n    instance [safe] MonadIO IO -- Defined in \u2018Control.Monad.IO.Class\u2019\n    instance MonadIO m =&gt; MonadIO (AppT m) -- Defined in \u2018Types\u2019\n    instance MonadIO Handler\n      -- Defined in \u2018Servant.Server.Internal.Handler\u2019\n    ...plus 18 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the third argument of \u2018hoistServer\u2019, namely \u2018readerServer\u2019\n  In the expression:\n      hoistServer readerApi nt readerServer :: Server ReaderAPI\n  In an equation for \u2018mainServer\u2019:\n      mainServer\n        = hoistServer readerApi nt readerServer :: Server ReaderAPI\n   |\n64 | mainServer = hoistServer readerApi nt readerServer :: Server ReaderAPI\n   |                                       ^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1536973707, "post_id": 52340328, "comment_id": 91628528, "body": "If you run <code>which stack</code> and <code>stack --version</code>, what does it show?  A potential issue is that <code>stack upgrade</code> normally installs the new version in <code>~&#47;.local&#47;bin&#47;stack</code>, but you may be using an old version in <code>&#47;usr&#47;local&#47;bin&#47;stack</code> or someplace similar."}, {"owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1536974319, "post_id": 52340328, "comment_id": 91628625, "body": "@K.A.Buhr version is <code>1.5.1 x86_64</code> and the folder is <code>usr&#47;bin&#47;stack</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1536978649, "post_id": 52340328, "comment_id": 91629090, "body": "You need a more recent version of Stack (1.6.1 or above). Cf. <a href=\"https://stackoverflow.com/q/47962377/2751851\"><i>Cannot build a hello world program with Stack because of flag bytestring--lt-0_10_4</i></a>"}, {"owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1536978736, "post_id": 52340328, "comment_id": 91629101, "body": "@duplode thanks, how do I get the new version if not by <code>stack upgrade</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1536978959, "post_id": 52340328, "comment_id": 91629135, "body": "<code>stack upgrade</code> installs Stack in <code>~&#47;.local&#47;bin</code>. It seems the globally installed version is being picked ahead of the local one, so you&#39;ll likely want to have a look at your PATH."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1537037353, "creation_date": 1537037353, "answer_id": 52347838, "question_id": 52340328, "link": "https://stackoverflow.com/questions/52340328/stack-throwing-errors-whenever-i-try-to-install-something/52347838#52347838", "title": "Stack throwing errors whenever I try to install something", "body": "<p>I think this is a common problem, but it's a little tough to find a StackOverflow answer that addresses it directly, so here's a shot at it.</p>\n\n<p>On Linux, there are two main ways to initially install Stack:</p>\n\n<ol>\n<li><p>If your distribution has a \"stack\" package, you might install that.  This will usually put the <code>stack</code> binary in <code>/usr/bin/stack</code>.</p></li>\n<li><p>If you follow the instructions on <code>haskellstack.org</code>, it'll tell you to retrieve an installation script via <code>curl</code> and pipe it through a shell:  <code>curl -sSL https://get.haskellstack.org/ | sh</code>.  By default, this puts <code>stack</code> in <code>/usr/local/bin/stack</code>.</p></li>\n</ol>\n\n<p>Most people already have these directories in their paths, so they don't have any problem running <code>stack</code> after installation, in either case.</p>\n\n<p><strong>HOWEVER</strong>, if you later follow the instructions for upgrading Stack using the <code>stack upgrade</code> command, this will install the upgraded binary in your home directory under <code>~/.local/bin/stack</code>.   The old version in <code>/usr/bin/stack</code> or <code>/usr/local/bin/stack</code> will be left untouched.</p>\n\n<p>Since many people do <em>not</em> have <code>~/.local/bin/</code> in their path, they may find that attempts to run Stack after supposedly upgrading it will still run the old version.  If you run:</p>\n\n<pre><code>$ which stack\n/usr/local/bin/stack\n</code></pre>\n\n<p>and see that the path is the globally installed version instead of something under your home directory, like <code>/home/xxx/.local/bin/stack</code>, then you're probably still running the old version.</p>\n\n<p>If you try running:</p>\n\n<pre><code>$ ~/.local/bin/stack install hip\n</code></pre>\n\n<p>and that works, then that will confirm that this is your problem.  You'll have to add <code>$HOME/.local/bin</code> to your path <em>before</em> the global paths to select the correct version of <code>stack</code>.  (If you haven't done this sort of thing before, search for \"adding directory path\" and your Linux distribution.  For example, here are some <a href=\"https://askubuntu.com/questions/60218/how-to-add-a-directory-to-the-path\">instructions for Ubuntu</a> on the Ask Ubuntu StackExchange site.)</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 52347838, "answer_count": 1, "score": 0, "last_activity_date": 1537037353, "creation_date": 1536967827, "last_edit_date": 1536978806, "question_id": 52340328, "link": "https://stackoverflow.com/questions/52340328/stack-throwing-errors-whenever-i-try-to-install-something", "title": "Stack throwing errors whenever I try to install something", "body": "<p>Whenever I try to install something with <code>stack</code>, for example <code>$ stack install hip</code>, <code>$ stack install Gifcurry</code>, and several other packages, they all throw the same error:</p>\n\n<pre><code>Downloaded lts-12.9 build plan.\nAesonException \"Error in $.packages.cassava.constraints.flags['bytestring--lt-0_10_4']: Invalid flag name: \\\"bytestring--lt-0_10_4\\\"\"\n</code></pre>\n\n<p>This is the first time I've tried using <code>stack</code> to install anything, so I'm not sure what to do. I did run <code>$ stack upgrade</code> before doing this.</p>\n\n<p>The Stack version is <code>1.5.1 x86_64</code> and it is in the directory <code>usr/bin/stack</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1536967406, "post_id": 52340277, "comment_id": 91627647, "body": "<code>x</code> only has one argument, <code>y</code>. Why are you trying to call it with two arguments?"}, {"owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536967694, "post_id": 52340277, "comment_id": 91627687, "body": "@melpomene I tried calling it with one argument as well. It didn&#39;t work out.. I tried <code>x 2</code> and <code>x [2]</code> and so on ..."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1536967733, "post_id": 52340277, "comment_id": 91627694, "body": "<code>(a -&gt; [a] -&gt; [a])</code> is the type of a function. None of <code>2</code> or <code>[2]</code> are functions."}, {"owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536967934, "post_id": 52340277, "comment_id": 91627725, "body": "@melpomene I also tried a function like (:) which takes an element of type <code>a</code> and prepends it to the following list <code>[]</code> like this:  <code>x (2:[1,2])</code> or <code>x (2:[])</code> but neither worked"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536967976, "post_id": 52340277, "comment_id": 91627729, "body": "<code>(2:[1,2])</code> is not a function but a list (same as <code>[2,1,2]</code>). <code>(2:[])</code> is not a function but a list (same as <code>[2]</code>)."}, {"owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536968393, "post_id": 52340277, "comment_id": 91627774, "body": "@melpomene I am out of luck here, do you suggest any function which could work in this case?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1536968787, "post_id": 52340277, "comment_id": 91627833, "body": "<code>x</code> places its argument in a list together with <code>(:)</code>. All elements of a list must have the same type. Therefore the argument must have the same type as <code>(:)</code>. The easiest way to do that is to use <code>(:)</code> again: <code>x (:)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536975690, "post_id": 52340918, "comment_id": 91628781, "body": "How about <code>x take</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536976064, "post_id": 52340918, "comment_id": 91628812, "body": "there&#39;s also <code>intersperse</code>... (Hoogle says). I guess this means <code>(:)</code> is treated as fully polymorphic, huh. so we can&#39;t think about it as &quot;one thing&quot; but rather as &quot;one definition&quot;. I always trip on this one."}, {"owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536998176, "post_id": 52340918, "comment_id": 91631821, "body": "Thanks a bunch @WillNess and @melpomene, I get the concept but even now when I make a query like <code>x (twice 2 [2])</code> it gives me an error: <code>&lt;interactive&gt;:10:4: error:     \u2022 Couldn&#39;t match expected type \u2018a -&gt; [a] -&gt; [a]\u2019                   with actual type \u2018[Integer]\u2019     \u2022 Possible cause: \u2018twice\u2019 is applied to too many arguments       In the first argument of \u2018x\u2019, namely \u2018(twice 2 [2])\u2019       In the expression: x (twice 2 [2])       In an equation for \u2018it\u2019: it = x (twice 2 [2])     \u2022 Relevant bindings include         it :: [a -&gt; [a] -&gt; [a]] (bound at &lt;interactive&gt;:10:1)</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "edited": false, "score": 0, "creation_date": 1537002974, "post_id": 52340918, "comment_id": 91632777, "body": "@Moorani Because yet again you&#39;re trying to pass a list to <code>x</code>. <code>x</code> does not take a list (<code>actual type \u2018[Integer]\u2019</code>), it takes a function (<code>expected type \u2018a -&gt; [a] -&gt; [a]\u2019</code>)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "edited": false, "score": 1, "creation_date": 1537013794, "post_id": 52340918, "comment_id": 91635086, "body": "@Moorani as we saw in the answer, <code>x twice == [(:), twice] :: [a -&gt; [a] -&gt; [a]]</code> (read <code>::</code> as &quot;has the type&quot;). this means that <code>((x twice) !! 0) == (:) :: a -&gt; [a] -&gt; [a]</code> and <code>((x twice) !! 1) == twice :: a -&gt; [a] -&gt; [a]</code>. this means we can call <code>map (\\f -&gt; f 2 [3]) (x twice)</code>. Try it. What&#39;s the result? What&#39;s its type? Also, try <code>map (\\f -&gt; f 2 [1..3]) (x take)</code>. Is the result&#39;s type the same, or different?"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1536977209, "last_edit_date": 1536977209, "creation_date": 1536975570, "answer_id": 52340918, "question_id": 52340277, "link": "https://stackoverflow.com/questions/52340277/guess-the-input-of-a-function/52340918#52340918", "title": "Guess the input of a function?", "body": "<p>As was said <a href=\"https://stackoverflow.com/questions/52340277/guess-the-input-of-a-function#comment91627833_52340277\">in the comments</a> by <a href=\"https://stackoverflow.com/users/1848654/melpomene\">melpomene</a>, the easiest way to have something of the same type as <code>(:)</code> is to use <code>(:)</code> itself:</p>\n\n<pre><code>&gt; :t x (:)\nx (:) :: [a -&gt; [a] -&gt; [a]]\n</code></pre>\n\n<p>What else could we use? Let's write out <code>(:)</code> in full:</p>\n\n<pre><code>f x xs = (:) x xs = x : xs\n</code></pre>\n\n<p>This suggest some other possibilities:</p>\n\n<pre><code>twice x xs = x : x : xs\n\nntimes n x xs | n &lt;= 0 = xs\n              | otherwise = x : ntimes (n-1) x xs\n\nmapping f x xs = f x : xs\n\nfiltering p x xs | p x = x : xs\n                 | otherwise = xs\n</code></pre>\n\n<p>etc.:</p>\n\n<pre><code>&gt; :t x twice\nx twice :: [a -&gt; [a] -&gt; [a]]\n\n&gt; :t x (ntimes 33)\nx (ntimes 33) :: [a -&gt; [a] -&gt; [a]]\n\n&gt; :t x (mapping sqrt)\nx (mapping sqrt) :: Floating a =&gt; [a -&gt; [a] -&gt; [a]]\n\n&gt; :t x (filtering even)\nx (filtering even) :: Integral a =&gt; [a -&gt; [a] -&gt; [a]]\n</code></pre>\n\n<p>The last two are interesting. Though their types are \"narrower\" in a sense than an unconstrained <code>(:)</code>, they are nevertheless allowed to unify with it:</p>\n\n<pre><code>&gt; :t [(:), mapping sqrt]\n[(:), mapping sqrt] :: Floating a =&gt; [a -&gt; [a] -&gt; [a]]\n\n&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<hr>\n\n<p><em>(edit:)</em> As pointed out in the comments by melpomene, there's even <code>take</code> that can be used there as well:</p>\n\n<pre><code>&gt; :t x take\nx take :: [Int -&gt; [Int] -&gt; [Int]]\n</code></pre>\n\n<p>so the type of <code>(:)</code> is allowed to get even more specialized with this one.</p>\n\n<p>This tells us that <code>(:) :: a -&gt; [a] -&gt; [a]</code> is a fully polymorphic type, so we shouldn't be thinking about <code>(:)</code> as one \"thing\", but rather as one \"definition\", capable of adjusting and fitting in in multiple situations, or uses. Indeed <code>(:) (5 :: Int)</code> has the more specialized type</p>\n\n<pre><code>&gt; :t (:) (5 :: Int)\n(:) (5 :: Int) :: [Int] -&gt; [Int]\n</code></pre>\n\n<p>just as it ought to have. Here the type of <code>(:)</code> was specialized by an argument it is applied to. In <code>x</code>, this is done by putting <code>(:)</code> into the same list with some other function.</p>\n"}], "owner": {"reputation": 117, "user_id": 2080986, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6fa2b13793834c2a094a802bb0973201?s=128&d=identicon&r=PG", "display_name": "Moorani", "link": "https://stackoverflow.com/users/2080986/moorani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 52340918, "answer_count": 1, "score": 0, "last_activity_date": 1536977209, "creation_date": 1536967238, "question_id": 52340277, "link": "https://stackoverflow.com/questions/52340277/guess-the-input-of-a-function", "title": "Guess the input of a function?", "body": "<p>I have this body of a function which is </p>\n\n<pre><code>x = \\y -&gt; [(:), y]\n</code></pre>\n\n<p>I guessed that the type would be </p>\n\n<pre><code>x :: (a -&gt; [a] -&gt; [a]) -&gt; [a -&gt; [a] -&gt; [a]]\n</code></pre>\n\n<p>because the function takes an input <code>y</code> and produces a <code>[(:), y]</code> where <code>y</code> equals <code>y</code> and then we have function <code>(:)</code> again which expects an element of type <code>a</code> and a list <code>[]</code> to do the prepend. </p>\n\n<p>But I am unable to guess what input should be given to make it work? </p>\n\n<p>I tried <code>x 2 [3]</code>\nor <code>x 2 []</code>\nor <code>x 2 [[3]]</code></p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "travis-ci", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1537037434, "post_id": 52347610, "comment_id": 91641052, "body": "Yes, that&#39;s apparent from the error messages I get, which specify the build sought (as the value of XX.XX.XX). The question is about how do I match that Cabal spec with each resolver in my Travis CI builds."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1537066645, "post_id": 52347610, "comment_id": 91646417, "body": "If you&#39;re asking &quot;how do I get older GHCs to support newer versions of the cabal spec,&quot; this is nontrivial, as it requires using a newer version of the Cabal library. I&#39;ve never tried this, but in theory adding the desired <code>Cabal</code> to your <code>extra-deps</code> and switching to <code>build-type: Custom</code> should do the trick. If you need support for older GHCs, however, I&#39;d strongly recommend not using the latest Cabal spec features."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": -1, "last_activity_date": 1537035687, "creation_date": 1537035687, "answer_id": 52347610, "question_id": 52338228, "link": "https://stackoverflow.com/questions/52338228/how-do-i-match-the-right-cabal-spec-with-each-resolver-in-my-travis-ci-builds/52347610#52347610", "title": "How do I match the right Cabal spec with each resolver in my Travis CI builds?", "body": "<p>To my knowledge, the Cabal spec version and Cabal library version always correspond, meaning that Cabal library version 2.0.C.D will support Cabal spec version 2.0 and earlier. You just need to check which version of the Cabal library ships with each LTS version, which depends on the GHC version. Some links that will help:</p>\n\n<ul>\n<li>I put together a page correlating GHC, base, and Cabal versions: <a href=\"https://www.snoyman.com/base\" rel=\"nofollow noreferrer\">https://www.snoyman.com/base</a></li>\n<li>The Stackage homepage lists the latest LTS for each GHC version in the bottom left column: <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">https://www.stackage.org/</a></li>\n<li>You can check the Cabal library version for a specific LTS by following a link like <a href=\"https://www.stackage.org/lts-9/package/Cabal\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-9/package/Cabal</a>, which in this case auto-redirects to <a href=\"https://www.stackage.org/lts-9.21/package/Cabal-1.24.2.0\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-9.21/package/Cabal-1.24.2.0</a>.</li>\n</ul>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1537035687, "creation_date": 1536953538, "question_id": 52338228, "link": "https://stackoverflow.com/questions/52338228/how-do-i-match-the-right-cabal-spec-with-each-resolver-in-my-travis-ci-builds", "title": "How do I match the right Cabal spec with each resolver in my Travis CI builds?", "body": "<p>After updating my <a href=\"https://hackage.haskell.org/package/crypto-enigma\" rel=\"nofollow noreferrer\">Haskell package's</a> <code>.cabal</code> file <a href=\"https://github.com/orome/crypto-enigma-hs/commit/08d88e2e365c62f80c1f58f31ff14219201c6705#diff-e9b7813096c0993c4abc4d021b0176d9\" rel=\"nofollow noreferrer\">to Cabal 2.2</a>, most of my <a href=\"https://travis-ci.org/orome/crypto-enigma-hs/builds/428756527\" rel=\"nofollow noreferrer\">Travis CI builds</a> with resolvers older than LTS 12.9 fail with:</p>\n\n<blockquote>\n  <p>This package description follows\n  version 2.2 of the Cabal specification. This tool only supports up to version XX.XX.XX.</p>\n</blockquote>\n\n<p>where the version varies depending on the resolver specified in my <a href=\"https://github.com/orome/crypto-enigma-hs/blob/develop/.travis.yml\" rel=\"nofollow noreferrer\"><code>.travis.yaml</code></a>.</p>\n\n<p>It seems that for each resolver I need to specify a different Cabal version In fact, because of Cabal spec changes, I appear to need a different <code>.cabal</code> file for each resolver. Is this the case? Is there a better way? How do I match the right Cabal spec with each resolver in my Travis CI builds?</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "typeclass", "semigroup"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536932992, "post_id": 52333274, "comment_id": 91613665, "body": "In Haskell <code>Combine (f &lt;&gt; g)</code> is equivalent to the pointful <code>Combine (\\x -&gt; f x &lt;&gt; g x)</code>. Perhaps you can use that in Scala?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1536934141, "post_id": 52333274, "comment_id": 91614356, "body": "Forgive me; I know very little about Scala. But it looks to me like you&#39;ve lost the <code>Semigroup b =&gt;</code> part of the Haskell <code>instance</code> declaration in your translation. Specifically your <code>implicit val mySemigroup</code> doesn&#39;t take any arguments, which seems suspicious on its face; it needs to know that the codomain of the functions stored in the <code>Combine</code> value is a <code>Semigroup</code> somehow. Perhaps that is part of what&#39;s giving you trouble?"}, {"owner": {"reputation": 836, "user_id": 4066802, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GiiSS_sDEPE/AAAAAAAAAAI/AAAAAAAAAJQ/myPMLHIRehQ/photo.jpg?sz=128", "display_name": "lprakashv", "link": "https://stackoverflow.com/users/4066802/lprakashv"}, "edited": false, "score": 1, "creation_date": 1536935876, "post_id": 52333274, "comment_id": 91615419, "body": "Forgive me I do not know Haskell, can you please explain what the Haskell code is doing?"}, {"owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "edited": false, "score": 0, "creation_date": 1536939084, "post_id": 52333274, "comment_id": 91617253, "body": "The Haskell code first defines a datatype called <code>Combine a b</code>. Any value of type <code>Combine a b</code> is a wrapper around a function of type <code>a -&gt; b</code>. The &quot;getter method&quot; for the wrapped function is <code>unCombine</code>. The code then makes the type <code>Combine a b</code> an instance of the typeclass <code>Semigroup</code>. Just like in algebraic groups, this involves defining an associative operator <code>(&lt;&gt;)</code> on values of that type. Here, <code>Combine f &lt;&gt; Combine g = Combine (f &lt;&gt; g)</code> which requires <code>f</code> and <code>g</code> to have the type <code>a -&gt; b</code> where <code>b</code> implements <code>Semigroup</code> as well. <code>f &lt;&gt; g</code> is like <code>\\n -&gt; (f n) &lt;&gt; (g n)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 836, "user_id": 4066802, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GiiSS_sDEPE/AAAAAAAAAAI/AAAAAAAAAJQ/myPMLHIRehQ/photo.jpg?sz=128", "display_name": "lprakashv", "link": "https://stackoverflow.com/users/4066802/lprakashv"}, "edited": false, "score": 0, "creation_date": 1536939124, "post_id": 52333274, "comment_id": 91617276, "body": "@LalitPrakash If the set T is a semigroup with operation op, then for any other set S, the set of functions S -&gt; T can be made a semigroup by applying op pointwise, that is, with operation opFun(f,g)(s) = op(f(s),g(s)). The Haskell code implements this construction (and then throws a <code>newtype</code> wrapper on top of it for no apparent reason)."}, {"owner": {"reputation": 32442, "user_id": 4254517, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a949771fd949b5e2b10afbdb490de38?s=128&d=identicon&r=PG&f=1", "display_name": "Dima", "link": "https://stackoverflow.com/users/4254517/dima"}, "edited": false, "score": 1, "creation_date": 1536941285, "post_id": 52333274, "comment_id": 91618313, "body": "I think, you would have a <i>much</i> better chance to get a good answer sooner, if you explained what you are trying to do in English. By using haskell to describe it, you exclude a large part of the audience - namely, people who speak both English and scala, but not Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 2, "last_activity_date": 1536945427, "creation_date": 1536945427, "answer_id": 52336600, "question_id": 52333274, "link": "https://stackoverflow.com/questions/52333274/semigroup-with-function-in-scala/52336600#52336600", "title": "Semigroup with function in Scala", "body": "<p>Here's code that answers your specific question.</p>\n\n<pre><code>import cats.Semigroup\nimport cats.instances.all._\n\nobject Main extends App {\n\n  trait Combine[A, B] {\n    def unCombine(a: A): B\n  }\n\n  override def main(args: Array[String]): Unit = {\n    implicit val mySemigroup: Semigroup[Combine[Int, Int]] =\n      new Semigroup[Combine[Int, Int]] {\n        def combine(x: Combine[Int, Int], y: Combine[Int, Int]): Combine[Int, Int] =\n          new Combine[Int, Int] {\n            override def unCombine(n: Int): Int =\n              Semigroup[Int].combine(x.unCombine(n), y.unCombine(n))\n          }\n        }\n\n    val f = new Combine[Int, Int] {\n      override def unCombine(n: Int): Int = n + 1\n    }\n\n    val g = new Combine[Int, Int] {\n      override def unCombine(n: Int): Int = n - 1\n    }\n\n    val example = Semigroup[Combine[Int, Int]].combine(f, g).unCombine(10)\n\n    printf(\"%d\\n\", example)\n  }\n}\n</code></pre>\n\n<p><em>Ideally</em> I'd like to duplicate the Haskell code in spirit and implement something of the form</p>\n\n<pre><code>// 'a' can be any type\n// Semigroup[b] must exist\nimplicit val mySemigroup: Semigroup[Combine[a, b]] =\n  def combine(x: Combine[a, b], y: Combine[a, b]): Combine[a, b] =\n    new Combine[a, b] {\n      override def unCombine(n: a): b =\n        Semigroup[b].combine(x.unCombine(n), y.unCombine(n))\n    }\n</code></pre>\n\n<p>But I don't know enough Scala to accomplish it. I'll update the answer when I figure it out or someone else can come along and edit this answer/post a better one.</p>\n"}, {"tags": [], "owner": {"reputation": 13201, "user_id": 1098230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8776a6aefb37bf25d866707973593e?s=128&d=identicon&r=PG", "display_name": "Kolmar", "link": "https://stackoverflow.com/users/1098230/kolmar"}, "is_accepted": false, "score": 3, "last_activity_date": 1536947165, "creation_date": 1536947165, "answer_id": 52336945, "question_id": 52333274, "link": "https://stackoverflow.com/questions/52333274/semigroup-with-function-in-scala/52336945#52336945", "title": "Semigroup with function in Scala", "body": "<p>In addition to the answer by @KartikSabharwal, because both <code>Semigroup</code> and <code>Combine</code> are functional interfaces, since Scala 2.12 you can define the specific case like this:</p>\n\n<pre><code>implicit val mySemigroup: Semigroup[Combine[Int, Int]] =\n  (x, y) =&gt; a =&gt; x.unCombine(a) + y.unCombine(a)\n</code></pre>\n\n<p>And the generic case, which @KartikSabharwal has mentioned would look like this in Scala 2.12:</p>\n\n<pre><code>// Don't forget to NOT import `cats.instances.all._` together with this import\nimport cats.implicits._ \n\nimplicit def combineSemigroup[A, B](\n  implicit ev: Semigroup[B]\n): Semigroup[Combine[A, B]] =\n  (x, y) =&gt; a =&gt; x.unCombine(a) combine y.unCombine(a)\n</code></pre>\n\n<p>And like this in Scala 2.11:</p>\n\n<pre><code>import cats.implicits._ \n\nimplicit def combineSemigroup[A, B](\n  implicit ev: Semigroup[B]\n): Semigroup[Combine[A, B]] =\n  new Semigroup[Combine[A, B]] {\n    override def combine(x: Combine[A, B], y: Combine[A, B]): Combine[A, B] =\n      new Combine[A, B] {\n        override def unCombine(a: A): B = x.unCombine(a) combine y.unCombine(a)\n      }\n  }\n</code></pre>\n"}], "owner": {"reputation": 395, "user_id": 4264914, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/uMKfB.png?s=128&g=1", "display_name": "gekomad", "link": "https://stackoverflow.com/users/4264914/gekomad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1536947165, "creation_date": 1536932572, "last_edit_date": 1536935349, "question_id": 52333274, "link": "https://stackoverflow.com/questions/52333274/semigroup-with-function-in-scala", "title": "Semigroup with function in Scala", "body": "<p>I'm trying to convert an Haskell <code>Semigroup</code> to Scala. The Haskell code works fine but I can't write it in Scala</p>\n\n<p><strong>Haskell:</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Semigroup\n\nnewtype Combine a b = Combine { unCombine :: (a -&gt; b) }\n\ninstance Semigroup b =&gt; Semigroup (Combine a b) where  \n    Combine f &lt;&gt; Combine g = Combine (f &lt;&gt; g)\n\nf = Combine $ \\n -&gt; Sum (n + 1)\ng = Combine $ \\n -&gt; Sum (n - 1)\n\nprint (unCombine (f &lt;&gt; g) $ 0)   -- Sum 0\nprint (unCombine (f &lt;&gt; g) $ 10)  -- Sum 20\n</code></pre>\n\n<p><strong>Scala code</strong></p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>import cats.Semigroup\nimport cats.instances.all._\n\ntrait Combine[A, B] {\n    def unCombine(a: A): B\n}\n\nval f = new Combine[Int, Int] {\n  override def unCombine(n: Int): Int = n + 1\n}\n\nval g = new Combine[Int, Int] {\n  override def unCombine(n: Int): Int = n - 1\n}\n\n\nimplicit val mySemigroup: Semigroup[Combine[Int, Int]] = new Semigroup[Combine[Int, Int]] {\n  def combine(x: Combine[Int, Int], y: Combine[Int, Int]): Combine[Int, Int] = (x,y) match {\n    // ???\n  }\n}\n</code></pre>\n"}, {"tags": ["haskell", "threepenny-gui"], "answers": [{"tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": false, "score": 1, "last_activity_date": 1538815086, "creation_date": 1538815086, "answer_id": 52677224, "question_id": 52323232, "link": "https://stackoverflow.com/questions/52323232/drawing-an-image-onto-a-threepenny-gui-canvas/52677224#52677224", "title": "Drawing an image onto a threepenny-gui Canvas", "body": "<p>Is the <code>canvas</code> part of the DOM? Don't forget to add it to the document body with via <code>getBody #+ [...]</code> or thelike.</p>\n\n<p>There may be another problem, though: Browsers usually load image URLs asynchronously. In fact, I'm not sure if they load image URLs at all if the image is not part of the DOM, as in your example. In both scenarios, if you try to draw an image to a canvas before its URL has been loaded, nothing will be drawn. (The easiest way to check whether this problem is the relevant one in your code is to draw polygons instead of an image.)</p>\n"}], "owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1538815086, "creation_date": 1536882980, "last_edit_date": 1536938511, "question_id": 52323232, "link": "https://stackoverflow.com/questions/52323232/drawing-an-image-onto-a-threepenny-gui-canvas", "title": "Drawing an image onto a threepenny-gui Canvas", "body": "<p>I'm having an issue with canvases. I have modified the Canvas.hs example program to draw an image onto the canvas with</p>\n\n<pre><code>canvas # drawImg\n</code></pre>\n\n<p>right after the canvas setup code; here it is for reference:</p>\n\n<pre><code>canvas &lt;- UI.canvas\n      # set UI.height canvasSize\n      # set UI.width  canvasSize\n      # set style [(\"border\", \"solid black 1px\"), (\"background\", \"#eee\")]\n</code></pre>\n\n<p>where drawImg is</p>\n\n<pre><code>drawImg :: UI.Canvas -&gt; UI ()\ndrawImg canvas = do\n  url &lt;- UI.loadFile \"image/png\" \"resources/img.png\"\n  img &lt;- UI.img # set UI.src url\n  UI.drawImage img (0,0) canvas\n</code></pre>\n\n<p>which should be the same behavior as the on click function for drawing an image in the original version of the code.</p>\n\n<p>The actual behavior of this code is a blank canvas, just as in the original example  before clicking on the draw image button. I would think that it should draw the image on loading. Why is this? Should I instead add this call to the line that sets up the canvas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1536874077, "post_id": 52321977, "comment_id": 91591670, "body": "I think you dropped the <code>(f (g x)) : ...</code> towards the end"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1536874469, "post_id": 52321977, "comment_id": 91591813, "body": "You have this <code>(f(g x)) : ((map f) . (map g)) xs = map f (map g (xs))</code>, but then you don&#39;t have the <code>(f (g x))</code> element anywhere in the list on the right, so that equality doesn&#39;t hold."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1536875582, "post_id": 52321977, "comment_id": 91592135, "body": "I think your main hypothesis should be <code>f(g x) = g(f x)</code> for all <code>x</code>s -- if so, please edit your question adding the missing <code>f</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536877733, "post_id": 52321977, "comment_id": 91592693, "body": "Your statement is false. Let <code>g = show . length</code> and <code>f = reverse</code>. Then <code>g x = g (f x)</code> for all lists <code>x</code>. Let <code>l = [[0 .. 9]]</code>. Now <code>map f (map g l) = map f [&quot;10&quot;] = [&quot;01&quot;]</code>, but <code>map g (map f l) = map g [[9, 8 .. 0]] = [&quot;10&quot;]</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1536893260, "post_id": 52321977, "comment_id": 91595670, "body": "@Hani : melpomene has disproved your statement by providing a counter-example. As chi notes, it seems likely there is a typo in your hypothesis. If we have <code>f . g = g . f</code>, then <code>map (f . g) = map (g . f)</code>, and then, by the functor laws, <code>map f .  map g = map g . map f</code> (and you would be able to reach the same conclusion through induction on the list shape)."}, {"owner": {"reputation": 45, "user_id": 5336301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e9b5f973d59aa420948ebc0c3d9bfc?s=128&d=identicon&r=PG&f=1", "display_name": "Hani", "link": "https://stackoverflow.com/users/5336301/hani"}, "edited": false, "score": 0, "creation_date": 1536908513, "post_id": 52321977, "comment_id": 91599994, "body": "map f (map g l) = map g (map f l) such that f (g x) = g (f x"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1536908701, "post_id": 52321977, "comment_id": 91600079, "body": "It&#39;s a basic property of map: <code>map p . map q = map (p . q)</code>."}, {"owner": {"reputation": 45, "user_id": 5336301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e9b5f973d59aa420948ebc0c3d9bfc?s=128&d=identicon&r=PG&f=1", "display_name": "Hani", "link": "https://stackoverflow.com/users/5336301/hani"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1536909561, "post_id": 52321977, "comment_id": 91600513, "body": "@n.m. all these lines not enough? also it&#39;s not assignments !"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 11, "last_activity_date": 1536931667, "last_edit_date": 1536931667, "creation_date": 1536916685, "answer_id": 52328760, "question_id": 52321977, "link": "https://stackoverflow.com/questions/52321977/prove-by-inductive-hypothesis-haskell/52328760#52328760", "title": "Prove by inductive hypothesis (Haskell)", "body": "<p>The OP has indicated this is <a href=\"https://stackoverflow.com/questions/52321977/prove-by-inductive-hypothesis-haskell#comment91600513_52321977\">not</a> an assignment.</p>\n\n<p>Prove <code>map f . map g == map g . map f</code> provided <code>f . g == g . f</code>, where <code>(f . g) x = f (g x)</code> by definition.</p>\n\n<p>The inductive data type definition:</p>\n\n<pre><code>data [a] = []                 -- [] is of type [a]\n         | (:) a [a]          -- if x is of type a, and xs is of type [a],\n                              --    then (x:xs) is of type [a]\n</code></pre>\n\n<p>Base case:</p>\n\n<pre><code>(map f . map g) [] = map f (map g [])    -- by definition of `.`\n                   = map f []            -- by definition of map\n                   = []                  -- by definition of map\n                   = map g []            -- by definition of map\n                   = map g (map f [])    -- by definition of map\n</code></pre>\n\n<p><em>whatever</em> the <code>f</code> and <code>g</code> are. Base case is proven.</p>\n\n<p>The Inductive case: under the Induction Hypothesis that it is true for a list <code>xs</code> of some length, prove it is true for a list <code>(x:xs)</code> with one more element in front of it:</p>\n\n<pre><code>(map f . map g) (x:xs) \n             = map f ( map g (x:xs) )          -- by definition of `.`\n             = map f ( g x : map g xs )        -- by definition of map\n             = f ( g x ) : map f ( map g xs )  -- by definition of map\n             = g ( f x ) : map f ( map g xs )  -- by the condition on f,g\n             = g ( f x ) : map g ( map f xs )  -- by the Induction Hypothesis\n             = map g ( f x : map f xs )        -- by definition of map\n             = map g ( map f (x:xs) )          -- by definition of map\n</code></pre>\n\n<p>Inductive case is proven.</p>\n"}], "owner": {"reputation": 45, "user_id": 5336301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e9b5f973d59aa420948ebc0c3d9bfc?s=128&d=identicon&r=PG&f=1", "display_name": "Hani", "link": "https://stackoverflow.com/users/5336301/hani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 52328760, "answer_count": 1, "score": 0, "last_activity_date": 1536931667, "creation_date": 1536873746, "last_edit_date": 1536910128, "question_id": 52321977, "link": "https://stackoverflow.com/questions/52321977/prove-by-inductive-hypothesis-haskell", "title": "Prove by inductive hypothesis (Haskell)", "body": "<p>I want to be able to prove this statement  map f (map g l) = map g (map f l) \nsuch that f (g x) = g (f x) </p>\n\n<p>I need to proof this by base case and induction case. It is possible to do a proof by base case and induction case like the following:</p>\n\n<pre><code>     map f (map g l) = map g (map f l)\n\nmap f (map g l) = map g (map f l)   \n   Base Case:    \n L.H.S   map f.(map g []) [ ]=            \n          R.H.S  map g (map f []=[]           \n        map f ( map g [ ])=                    \n         map g [ ] = []                  \n map f [ ] = [ ]    \n   Inductive Case:     L=(x:xs)  \n   Inductive Hypotheses: \u2200 (f.g)\n  map f (map g (xs)) =\n map g (map f (xs)))   \n   L.H.S   map f (map g (x:xs))=\n              map f (g (x): map g (xs))= \n(f(g (x)): map f (map g (xs))\n (f(g x)) : ((map f) . (map g)) xs=        \n        map f (map g (xs)) (using the Inductive Hypotheses)              \n      map g (map f (xs)))                      R.H.S\n</code></pre>\n\n<p>But I think my prove is going wrong . Any suggestions ?</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536863693, "post_id": 52319817, "comment_id": 91587013, "body": "<code>&gt;&gt;= return .</code> can be replaced by <code>&lt;$&gt;</code>: <code>identP = pack &lt;$&gt; identPQuoted</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536863820, "post_id": 52319817, "comment_id": 91587083, "body": "The <code>do</code> block in <code>identPQuoted</code> can be written as <code>char &#39;&quot;&#39; *&gt; (concat &lt;$&gt; many inner) &lt;* char &#39;&quot;&#39;</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536863878, "post_id": 52319817, "comment_id": 91587108, "body": "Can you post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? I&#39;d like to try this myself."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1536864527, "post_id": 52319817, "comment_id": 91587420, "body": "The requirement is rather poorly worded. Can you show a real grammar of your input language? Also, try <code>reads</code>."}, {"owner": {"reputation": 315, "user_id": 1382357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3N1Oz.jpg?s=128&g=1", "display_name": "Vey", "link": "https://stackoverflow.com/users/1382357/vey"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1536866785, "post_id": 52319817, "comment_id": 91588446, "body": "I added an example @melpomene and updated the requirements"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1536891041, "post_id": 52319817, "comment_id": 91595269, "body": "A list of characters like <code>[&#39;\\\\&#39;, &#39;\\&quot;&#39;, &#39;0&#39;, &#39;n&#39;, &#39;r&#39;, &#39;v&#39;, &#39;t&#39;, &#39;b&#39;, &#39;f&#39;]</code> can be written more conveniently and compactly as a <code>String</code> literal like <code>&quot;\\\\\\&quot;0nrvtbf&quot;</code>, since <code>type String = [Char]</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536911349, "post_id": 52319817, "comment_id": 91601437, "body": "Warning: the list of characters in <code>nonEscape</code> is a list of <i>single characters</i>, i.e. <code>\\n</code> is a literal newline character, <code>\\0</code> is the null character (which you would never see in a plain text file).  Probably not what you meant."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536928515, "post_id": 52319817, "comment_id": 91610909, "body": "@luqui That part looks fine to me. It says double-quoted strings cannot contain literal control characters (such as NUL, newline, etc)."}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 1382357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3N1Oz.jpg?s=128&g=1", "display_name": "Vey", "link": "https://stackoverflow.com/users/1382357/vey"}, "edited": false, "score": 0, "creation_date": 1536867447, "post_id": 52320635, "comment_id": 91588753, "body": "Thanks! Kind of embarrassing in hindsight."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1536867471, "last_edit_date": 1536867471, "creation_date": 1536867317, "answer_id": 52320635, "question_id": 52319817, "link": "https://stackoverflow.com/questions/52319817/parse-between-quotes-with-haskell/52320635#52320635", "title": "Parse between quotes with Haskell", "body": "<p>Your input text is <code>\"foo \"bar\"</code>, which does not contain any escaped quotes. It is parsed as a complete ID of <code>\"foo \"</code> (followed by <code>bar\"</code>, which is ignored).</p>\n\n<p>If you want to make sure that your parser consumes all of the available input, you can use</p>\n\n<pre><code>parseTest (identP &lt;* eof) \"...\"\n</code></pre>\n\n<p>If you want to provide an ID with an escaped quote to the parser, like this ...</p>\n\n<pre><code>\"foo \\\"bar\"\n</code></pre>\n\n<p>... then you need to escape all of the special characters to embed them in Haskell source code:</p>\n\n<pre><code>main = parseTest identP \"\\\"foo \\\\\\\"bar\\\"\"\n</code></pre>\n\n<p><code>\\\"</code> represents a literal <code>\"</code> and <code>\\\\</code> represents a literal <code>\\</code>.</p>\n"}], "owner": {"reputation": 315, "user_id": 1382357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3N1Oz.jpg?s=128&g=1", "display_name": "Vey", "link": "https://stackoverflow.com/users/1382357/vey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 1, "accepted_answer_id": 52320635, "answer_count": 1, "score": 4, "last_activity_date": 1536867471, "creation_date": 1536863490, "last_edit_date": 1536866740, "question_id": 52319817, "link": "https://stackoverflow.com/questions/52319817/parse-between-quotes-with-haskell", "title": "Parse between quotes with Haskell", "body": "<p>The requirements are taken from the <a href=\"https://graphviz.gitlab.io/_pages/doc/info/lang.html\" rel=\"nofollow noreferrer\">DOT language specification</a>, more precisely I'm trying to parse the <code>[ID]</code> attribute, which can be e.g., </p>\n\n<blockquote>\n  <p>any double-quoted string (\"...\") possibly containing escaped quotes (\\\")1;</p>\n</blockquote>\n\n<p>The following should be a minimal example.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport           Text.Megaparsec\nimport           Text.Megaparsec.Char\nimport           Data.Void\nimport           Data.Char\nimport           Data.Text               hiding ( map\n                                        , all\n                                        , concat\n                                        )\n\ntype Parser = Parsec Void Text\n\nescape :: Parser String\nescape = do\n    d &lt;- char '\\\\'\n    c &lt;- oneOf ['\\\\', '\\\"', '0', 'n', 'r', 'v', 't', 'b', 'f']\n    return [d, c]\n\nnonEscape :: Parser Char\nnonEscape = noneOf ['\\\\', '\\\"', '\\0', '\\n', '\\r', '\\v', '\\t', '\\b', '\\f']\n\nidentPQuoted :: Parser String\nidentPQuoted =\n    let inner = fmap return (try nonEscape) &lt;|&gt; escape\n    in  do\n      char '\"'\n      strings &lt;- many inner\n      char '\"'\n      return $ concat strings\n\nidentP :: Parser Text\nidentP = identPQuoted &gt;&gt;= return . pack\n\nmain = parseTest identP \"\\\"foo \\\"bar\\\"\"\n</code></pre>\n\n<p>The above code fails on the second with returns <code>\"foo \"</code> even though I want <code>foo \"bar</code></p>\n\n<p>I don't understand why. I thought that <code>megaparsec</code> would repeatedly apply <code>inner</code> until it parses the final <code>\"</code>. But it only repeatedly applies the <code>nonEscape</code> parser and the first time that fails, and it uses <code>escape</code>, it then appears to skip the rest of the inner string and just move on to the final quotes.</p>\n"}, {"tags": ["haskell", "pattern-matching", "filtering", "maybe"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1536918849, "post_id": 52315431, "comment_id": 91605619, "body": "you could use <code>filter (\\x -&gt; case x of (Just _) -&gt; True ; _ -&gt; False) a </code> or even <code>filter (\\case (Just _) -&gt; True ; _ -&gt; False)</code> (the latter with the LambdaCase extention)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1536847732, "post_id": 52315450, "comment_id": 91578328, "body": "This answers the letter of the question, but I bet <code>[e | T (Just e) &lt;- a]</code> answers the spirit of the question better."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1536848050, "post_id": 52315450, "comment_id": 91578571, "body": "Yes that is precisely what i wanted to later on be able to unpack the inner value and use it accordingly."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1536848068, "post_id": 52315450, "comment_id": 91578580, "body": "@BercoviciAdrian: see update."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1536850143, "post_id": 52315450, "comment_id": 91579982, "body": "Could you please tell me why do i get <code>Pattern bindings not allowed in instance declaration</code> for  <code>instance Show File where ; (Dfile ls)=Data.List.intercalate &#39;,&#39; [show e|T (Just e) &lt;- ls]</code>.Might deserve a separate question but i am not sure. though."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1536854502, "post_id": 52315450, "comment_id": 91582496, "body": "@BercoviciAdrian You probably mean <code>... where show (Dfile ls)= ...</code>"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1536854554, "post_id": 52315450, "comment_id": 91582521, "body": "Yes i am sorry i forgot to add that."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1536848124, "last_edit_date": 1536848124, "creation_date": 1536847367, "answer_id": 52315450, "question_id": 52315431, "link": "https://stackoverflow.com/questions/52315431/how-to-filter-based-on-monadic-pattern-match/52315450#52315450", "title": "How to filter based on monadic pattern match?", "body": "<p>I think here we can better use the pattern-matching semantics of list comprehension:</p>\n\n<pre><code>result = [ e | e@(T (Just _)) &lt;- a]\n</code></pre>\n\n<p>Here we thus enumerate over the elements <code>e</code> in <code>a</code>, and if the pattern matching with <code>T (Just _)</code> succeeds, we yield it in the result list.</p>\n\n<p>If you however wish to <em>unpack</em> the values encapsulated in the <code>T (Just x)</code>, we thus can perform pattern matching, and yield the wrapped element:</p>\n\n<pre><code>result = [ e | T (Just <b>e</b>) &lt;- a]</code></pre>\n\n<p>This will thus not only \"filter\" the values, but unpack concurrently. So the <code>T Nothing</code>s are ignored, and only the wrapped <code>T (Just e)</code>s are retained and the corresponding <code>e</code>s end up in the list.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1536854615, "creation_date": 1536854615, "answer_id": 52317630, "question_id": 52315431, "link": "https://stackoverflow.com/questions/52315431/how-to-filter-based-on-monadic-pattern-match/52317630#52317630", "title": "How to filter based on monadic pattern match?", "body": "<p>Pattern matching only works in the <em>argument</em> to the function, not the body. The pattern you need to match on is <code>T</code>, with a catamorphism like <code>maybe</code> to convert the wrapped value to a boolean.</p>\n\n<pre><code>Prelude&gt; a = [T (Just 3), T Nothing, T (Just 4)]\nPrelude&gt; filter (\\(T x) -&gt; maybe False (const True) x) a\n[T (Just 3),T (Just 4)]\n</code></pre>\n\n<p>Note, however, that <code>maybe False (const True)</code> is already defined as <code>Data.Maybe.isJust</code>.</p>\n\n<pre><code>Prelude&gt; import Data.Maybe\nPrelude&gt; filter (\\(T x) -&gt; isJust x) a\n[T (Just 3),T (Just 4)]\n</code></pre>\n\n<p>You can simplify the predicate if you have some function of type <code>T -&gt; Maybe Int</code> to compose with <code>isJust</code>. For instance:</p>\n\n<pre><code>Prelude&gt; data T = T { getT :: Maybe Int } deriving Show\nPrelude&gt; a = [T (Just 3), T Nothing, T (Just 4)]\nPrelude&gt; filter (isJust . getT) a\n[T {getT = Just 3},T {getT = Just 4}]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1536903156, "post_id": 52323769, "comment_id": 91597865, "body": "Thank you for your observations, they are very valuable for me as a beginner.I wanted to know as a rules of thumb, whenever i have nested <code>maybe</code>-s in my types like in the example oyu provided with <code>T</code> i should make methods that pattern-match and get the field value ? (in your example <code>unT</code>)?"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1536888060, "creation_date": 1536888060, "answer_id": 52323769, "question_id": 52315431, "link": "https://stackoverflow.com/questions/52315431/how-to-filter-based-on-monadic-pattern-match/52323769#52323769", "title": "How to filter based on monadic pattern match?", "body": "<p>If you want to get a list of the <code>Int</code> values in your list of <code>T</code>s (so typed <code>[T] -&gt; [Int]</code>), then <a href=\"https://hackage.haskell.org/package/base/docs/Data-Maybe.html#v:mapMaybe\" rel=\"nofollow noreferrer\"><code>mapMaybe</code></a> from <code>Data.Maybe</code> already does almost exactly what you want. All you need on top of that is a unwrapping function of type <code>T -&gt; Maybe Int</code></p>\n\n<pre><code>import Data.Maybe ( mapMaybe )\n\ndata T = T (Maybe Int)\n  deriving (Eq, Show)\n\nunT :: T -&gt; Maybe Int\nunT (T x) = x\n\nfilterTs = mapMaybe unT\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>\u03bb a = [T (Just 3), T Nothing, T (Just 4)]\na :: [T]\n\n\u03bb filterTs a\n[3,4]\nit :: [Int]\n</code></pre>\n\n<p>In my opinion having this filter operation be of type <code>[T] -&gt; [Int]</code> is more useful than having it return the <code>T</code> values containing non-<code>Nothing</code> values; the reason is that even if you filter <code>a</code> down to <code>[T (Just 3), T (Just 4)]</code>, then the code that deals with that later <em>still</em> has to pattern match on the <code>Just</code> to get at the <code>Int</code> values, even though you know there'll never be a <code>Nothing</code><sup>1</sup>, because <code>T</code> is still hardcoded to contain <code>Nothing</code>.</p>\n\n<p>As a general rule, if you're filtering (or defaulting, or etc) to guarantee the absence of a case, you should consider transforming to a type that doesn't have the case anymore. It usually makes the resulting data easier to deal with (no need for pattern matches or <code>fmap</code>s to get inside the redundant layers, for example), as well as helping avoid bugs.</p>\n\n<p>There's also <code>catMaybes :: [Maybe a] -&gt; [a]</code>, that does this \"filtering out <code>Nothing</code>s without mapping\", but since you're mapping to unwrapp the <code>T</code> constructor <code>mapMaybe</code> is a closer fit.</p>\n\n<hr>\n\n<p><sup>1</sup> And this \"I know there'll never be <code>Nothing</code> here, so I don't have to handle it\" situation is a very rich source of bugs, liable to break when something changes that hidden invariant in future. So it's not even a great idea to actually write code that takes advantage of that knowledge that <code>Nothing</code> \"cannot\" be there; you should <em>still</em> handle both cases!</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "closed_date": 1536918709, "accepted_answer_id": 52315450, "answer_count": 3, "score": 1, "last_activity_date": 1536918649, "creation_date": 1536847277, "last_edit_date": 1536918649, "question_id": 52315431, "link": "https://stackoverflow.com/questions/52315431/how-to-filter-based-on-monadic-pattern-match", "closed_reason": "Duplicate", "title": "How to filter based on monadic pattern match?", "body": "<p>I have the following problem:</p>\n\n<p>Given a type <code>data T = T (Maybe Int)</code>, how can I filter  a list getting the non-<code>Nothing</code> values?</p>\n\n<p><strong>Input</strong></p>\n\n<pre><code>a = [T (Just 3), T Nothing, T (Just 4)]\n</code></pre>\n\n<p><strong>Desired Output</strong></p>\n\n<pre><code>b = [T (Just 3), T (Just 4)]\n</code></pre>\n\n<p>I have tried something like :</p>\n\n<pre><code>b = filter (\\x-&gt; x@(Just t)) a \n</code></pre>\n\n<p>...thinking that I can filter based on a pattern match but i get the error:</p>\n\n<pre><code>Pattern syntax in expression context: x@(Just t)\n    Did you mean to enable TypeApplications?\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/52315431/how-to-filter-based-on-monadic-pattern-match#comment91578571_52315450\">I want to</a> later on be able to unpack the inner value (under <code>Just</code>) and use it accordingly. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1536845853, "post_id": 52314908, "comment_id": 91577052, "body": "Do you know lists are implemented in Haskell?  How else could <code>(++)</code> work?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536845901, "post_id": 52314908, "comment_id": 91577091, "body": "How would you construct a list otherwise?"}, {"owner": {"reputation": 57, "user_id": 7823831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GTkfY.jpg?s=128&g=1", "display_name": "rostej", "link": "https://stackoverflow.com/users/7823831/rostej"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1536846121, "post_id": 52314908, "comment_id": 91577242, "body": "@Carl I know [1,2,3] is actually just syntactic sugar for 1:2:3:[]"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 2, "creation_date": 1536847019, "post_id": 52314908, "comment_id": 91577852, "body": "@GovindParmar This question is explicitly about performance (while the other one isn&#39;t), and the answers here address reflect that by addressing that aspect in a more effective manner. I would leave it open, unless there was a better match with great answers lying around."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 4, "last_activity_date": 1536851861, "last_edit_date": 1536851861, "creation_date": 1536846084, "answer_id": 52315038, "question_id": 52314908, "link": "https://stackoverflow.com/questions/52314908/why-the-function-is-much-more-expensive-than/52315038#52315038", "title": "Why the &quot;++&quot; function is much more expensive than &quot;:&quot;?", "body": "<p>The list on the rhs (right-hand side) must come <em>after</em> the last element on the lhs. Since haskell lists are implemented in terms of sucessors, you need to \"reach\" the last element to append anything to it, i.e. make the list you're appending <em>its</em> successor.</p>\n\n<p>This is analogous to concatenating singly-linked lists in an imperative language, if you only store a reference to the first element. You can only append to the last one, but to find it, you need to walk all the links.</p>\n\n<p>If you implement your own list, this becomes even more obvious because of the syntax change:</p>\n\n<pre><code>data List a = Empty | Cons a (List a)\n\nCons 1 (Cons 2 (Cons 3 Empty)))\n</code></pre>\n\n<p>To append to such a list, you need to change<sup>*</sup> the middle <code>Empty</code>. But looking at the value \"from the outside\" (e.g. by pattern matching), you only see the <code>Cons 1 &lt;tail&gt;</code>. The <code>tail</code> part is some cloudy thing until you evaluate it and see <code>Cons 2 &lt;tail&gt;</code> and so on, which is what you've tried to avoid. </p>\n\n<p>Converserly, prepending would simply be <code>Cons 0 &lt;the list above&gt;</code>, wrapping the entire list without even looking at it. This is why you can write things like <code>0 : [1..]</code>, but can't write things like <code>[1..] ++ [42]</code>.</p>\n\n<hr>\n\n<p><sup>*</sup> Create a new list which differs in that specific point. Haskell lists (values in general) are obviously immutable.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1536847214, "post_id": 52315142, "comment_id": 91577973, "body": "<code>:</code> is closer to a list literal than a function that returns a list. Whereas the return value of <code>++</code> leaves no trace of what its original arguments were, the value <i>created</i> by <code>:</code> stores its arguments. <code>1 : ()</code> <i>is</i> the list, rather than an expression that evaluates to a list."}, {"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1536847533, "post_id": 52315142, "comment_id": 91578199, "body": "Yes, that is my understanding as well, why do you feel the need to comment this? Or are you expanding on what I said? I cannot find something in my answer that contradicts this. <code>:</code> is a constructor of <code>List</code>, which makes it a function."}], "tags": [], "owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "is_accepted": false, "score": 1, "last_activity_date": 1536855963, "last_edit_date": 1536855963, "creation_date": 1536846391, "answer_id": 52315142, "question_id": 52314908, "link": "https://stackoverflow.com/questions/52314908/why-the-function-is-much-more-expensive-than/52315142#52315142", "title": "Why the &quot;++&quot; function is much more expensive than &quot;:&quot;?", "body": "<p>A list like <code>[3,1,5,6]</code> in Haskell looks like this:</p>\n\n<p><code>3 : (1 : (5 : [6]))</code>, where <code>:</code> is the cons function. Clearly you can still write lists like <code>[3,1,5,6]</code> in Haskell, but that is just fancy syntax.</p>\n\n<p>Adding an element after the 6 is difficult as you can see: the 6 is nested all the way down the list. In order to add the item, Haskell needs to deconstruct the list entirely before it can add the item like so:</p>\n\n<pre><code>(++) (x : xs) otherList = x : (xs ++ otherList)\n(++) [x] otherList = x : otherList\n</code></pre>\n\n<p>This is very likely not the actual definition of <code>(++)</code>, but it shows the problem. The <code>(++)</code> operator has to traverse through the entire leftmost list in order to cons the last item in the list to the new list, after which recursively all other items are again concatenated.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1536846955, "creation_date": 1536846955, "answer_id": 52315330, "question_id": 52314908, "link": "https://stackoverflow.com/questions/52314908/why-the-function-is-much-more-expensive-than/52315330#52315330", "title": "Why the &quot;++&quot; function is much more expensive than &quot;:&quot;?", "body": "<p>I think maybe a manual unrolling would be a helpful tool in addition to the other answers.  A list <code>[1,2,3]</code> is represented as a right-nested expression of \"conses\" (<code>:</code>) like this</p>\n\n<pre><code>1 : (2 : (3 : []))\n</code></pre>\n\n<p>We understand that the <code>:</code> operator associates to the right so this is just written</p>\n\n<pre><code>1:2:3:[]\n</code></pre>\n\n<p>Append is defined by these two patterns:</p>\n\n<pre><code>[]     ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys)\n</code></pre>\n\n<p>So now let's just look at how <code>[1,2,3] ++ [4,5]</code> is unfolded.  Starting by rewriting into conses:</p>\n\n<pre><code>(1:2:3:[]) ++ (4:5:[])\n--                    (second pattern, x = 1, xs = 2:3:[], ys = 4:5:[])\n1 : ((2:3:[]) ++ (4:5:[]))\n--                    (second pattern, x = 2, xs = 3:[], ys = 4:5:[])\n1 : 2 : ((3:[]) ++ (4:5:[]))\n--                    (second pattern, x = 3, xs = [], ys = 4:5:[])\n1 : 2 : 3 : ([] ++ (4:5:[]))\n--                    (first pattern, ys = 4:5:[])\n1 : 2 : 3 : 4 : 5 : []\n</code></pre>\n\n<p>So that's how it works.  See how we traversed the left list, but we didn't need to traverse the right one?  In some sense, we traverse the left list in order to find the <code>[]</code> at the end of it, and then replace the <code>[]</code> at the end with a reference to the whole right list.</p>\n"}], "owner": {"reputation": 57, "user_id": 7823831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GTkfY.jpg?s=128&g=1", "display_name": "rostej", "link": "https://stackoverflow.com/users/7823831/rostej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "closed_date": 1536853958, "answer_count": 3, "score": 1, "last_activity_date": 1536855963, "creation_date": 1536845721, "last_edit_date": 1536845905, "question_id": 52314908, "link": "https://stackoverflow.com/questions/52314908/why-the-function-is-much-more-expensive-than", "closed_reason": "Duplicate", "title": "Why the &quot;++&quot; function is much more expensive than &quot;:&quot;?", "body": "<p>The following paragraph comes from <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">Learn You a Haskell for Great Good!</a> </p>\n\n<blockquote>\n  <p>\"Watch out when repeatedly using the ++ operator on long strings. When you put together two lists (even if you append a singleton list to a list, for instance: [1,2,3] ++ [4]), internally, Haskell has to walk through the whole list on the left side of ++. That's not a problem when dealing with lists that aren't too big. But putting something at the end of a list that's fifty million entries long is going to take a while. However, putting something at the beginning of a list using the : operator (also called the cons operator) is instantaneous.\"</p>\n</blockquote>\n\n<p>I don't know why Haskell has to walk through the whole list on the left side of ++.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536843964, "post_id": 52314364, "comment_id": 91575906, "body": "Well <code>k</code> is <i>not</i> the last item, but the <i>remaining items</i>."}, {"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1536844358, "post_id": 52314364, "comment_id": 91576134, "body": "Now i see my mistake, i have to add [] so that it would be <code>code (g:h:j:k:[]) </code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1536851765, "post_id": 52314364, "comment_id": 91580996, "body": "This doesn&#39;t answer your question, but I think you&#39;re doing it wrong. I&#39;d almost certainly write <code>getColorData color colors = map (color `isInfixOf`) colors</code>. Easy to read and idiomatic, and uses a more sensible type than <code>Int</code>. You might also be interested in <a href=\"https://hackage.haskell.org/package/base/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> or <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:findIndices\" rel=\"nofollow noreferrer\"><code>findIndices</code></a>, depending on exactly what you&#39;re doing."}, {"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1536943857, "post_id": 52314364, "comment_id": 91619504, "body": "@Daniel Wagner  The problem with that function is that u are mapping the color String with isInfixOf to the List but i want to use isInfixOf on every element of the list with color String. It should be possible to use ur function with recursion maybe  Still thank you for your answer.  Something like this but the function is still missing something :  <code>getColorData (x:xs) color = map (x &#39;isInfixOf&#39; ) color</code> and somewhere to use this part  <code>getColorData xs</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1536946711, "post_id": 52314364, "comment_id": 91620860, "body": "@Ninexreaker Have you tried running my proposed function? I think you&#39;ll be pleasantly surprised. It already does &quot;use <code>isInfixOf</code> on every element of the list&quot; -- that is what <code>map</code> does. e.g. <code>getColorData &quot;red&quot; [&quot;fred&quot;, &quot;green&quot;, &quot;bluered&quot;, &quot;blue&quot;]</code> returns <code>[True, False, True, False]</code>, and <code>getColorData &quot;red&quot; [&quot;red&quot;,&quot;blue&quot;,&quot;yellow&quot;,&quot;green&quot;]</code> returns <code>[True,False,False,False]</code> just as required by your example input/output pair."}, {"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "edited": false, "score": 0, "creation_date": 1536953942, "post_id": 52314364, "comment_id": 91623800, "body": "Yes you are right. It was my mistake using a bad example on my original post. I should have used something like &quot;redxy&quot; as the String to compare on because then it doesnt work anymore. But thank you anyways, its always good to get more opinions!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1537110955, "post_id": 52314364, "comment_id": 91655620, "body": "@Ninexreaker Still not really a problem, just swap the order of arguments to <code>isInfixOf</code>, as in <code>getColorData color colors = map (`isInfixOf` color) colors</code>."}, {"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1537118706, "post_id": 52314364, "comment_id": 91657766, "body": "@Daniel Wagner Yes i tried your new function with following example: <code>getColorData &quot;redxyz&quot; [&quot;red&quot; , &quot;blue&quot; ,&quot;yellow&quot; , &quot;green&quot; ]</code> and now it works. Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "edited": false, "score": 1, "creation_date": 1536844658, "post_id": 52314478, "comment_id": 91576316, "body": "I forgot that using () would result the remaining of list on the last element. Now i can see why it did not work. Thank you for that!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1536844454, "last_edit_date": 1536844454, "creation_date": 1536844153, "answer_id": 52314478, "question_id": 52314364, "link": "https://stackoverflow.com/questions/52314364/pattern-matching-a-list-of-strings-with-a-string-using-isinfixof/52314478#52314478", "title": "Pattern matching a List of Strings with a String using isInfixOf", "body": "<p>The problem is here that you pattern match with:</p>\n\n<pre><code>getColorData <b>(g:h:j:k)</b> str</code></pre>\n\n<p>Here <code>g</code>, <code>h</code>, and <code>j</code> are the <em>heads</em> (first elements) of the list, but <code>k</code> is the <em>tail</em> of the list (the remaining items). So <code>k</code> has as type <code>[String]</code>, <em>not</em> <code>String</code>.</p>\n\n<p>We can fix it by using <code>[g,h,j,k]</code> which is a list of four elements:</p>\n\n<pre><code>getColorData  :: [String] -&gt; String -&gt; [Int]\ngetColorData <b>[g,h,j,k]</b> str \n    | isInfixOf g str = [1, 0, 0, 0]\n    | isInfixOf h str = [0, 1, 0, 0]\n    | isInfixOf j str = [0, 0, 1, 0]\n    | isInfixOf k str = [0, 0, 0, 1]\n    | otherwise = []</code></pre>\n\n<p>But still it is not really good design. Since for lists with less, or more than four elements, this function will error. I'm also not sure whether using an <code>isInfixOf</code> condition is a good idea at all: it means that the order of the list can sometimes determine what the result will be: a list where two elements are swapped might result in a different. Finally the code is very repetitive (not following the <strong>D</strong>on't <strong>R</strong>epeat <strong>Y</strong>ourself principle).</p>\n\n<p>A more elegant version could be:</p>\n\n<pre><code>getColorData :: Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [Int]\ngetColorData [] _ = Nothing\ngetColorData (x:xs) s | isInfixOf x s = Just (1: map (const 0) xs)\n                      | otherwise = fmap (0:) (getColorData xs s)\n</code></pre>\n\n<p>Here we let it work for any type <code>a</code> where two <code>a</code>s have an equality relation. Furthermore it works with lists of all lengths. It returns <code>Nothing</code> if the elements can not be found, and <code>Just e</code> with <code>e</code> an entity vector with the length of the list as the number of dimensions.</p>\n"}], "owner": {"reputation": 43, "user_id": 5910479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1e6fa64d404f7ae0b99821bcdb4b7e?s=128&d=identicon&r=PG&f=1", "display_name": "Ninexreaker", "link": "https://stackoverflow.com/users/5910479/ninexreaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 52314478, "answer_count": 1, "score": 1, "last_activity_date": 1536844454, "creation_date": 1536843836, "question_id": 52314364, "link": "https://stackoverflow.com/questions/52314364/pattern-matching-a-list-of-strings-with-a-string-using-isinfixof", "title": "Pattern matching a List of Strings with a String using isInfixOf", "body": "<p>Hello i am a beginner in haskell and i have a problem with comparing/matching Strings from a set List with a given String as Parameter. </p>\n\n<p>What i want to achieve is:</p>\n\n<p>I have a set List </p>\n\n<pre><code>colorTypes = [\"red\" , \"blue\" ,\"yellow\" , \"green\" ]\n</code></pre>\n\n<p>what i want to do is make a Function to compare each element of the List with a given String using the isInfixOf Function from Data.List and depending on the outcome from isInfixOf return a Pattern</p>\n\n<p>Example if i use the function:</p>\n\n<pre><code>getColorData colorTypes \"red\" \n</code></pre>\n\n<p>it should return</p>\n\n<pre><code>[1, 0, 0, 0]\n</code></pre>\n\n<p>What i have tried is:</p>\n\n<pre><code>import Data.List \n\ngetColorData  :: [String] -&gt; String -&gt; [Int]\ngetColorData (g:h:j:k) str \n    | isInfixOf g str = [1, 0, 0, 0]\n    | isInfixOf h str = [0, 1, 0, 0]\n    | isInfixOf j str = [0, 0, 1, 0]\n    | isInfixOf k str = [0, 0, 0, 1]\n    | otherwise = []\n</code></pre>\n\n<p>i get the error : Parse error in pattern: isInfixOf with this function</p>\n\n<p>i also tried this with case </p>\n\n<pre><code> getColorData  :: [String] -&gt; String -&gt; [Int]\n getColorData (g:h:j:k) str = case (g:h:j:k) of\n                         isInfixOf g str -&gt; [1, 0, 0, 0]\n                         isInfixOf h str -&gt; [0, 1, 0, 0]\n                         isInfixOf j str -&gt; [0, 0, 1, 0]\n                         isInfixOf k str -&gt; [0, 0, 0, 1]\n</code></pre>\n\n<p>this also doesnt work and i get the Couldn't match type error.</p>\n\n<p>I don't know if my approach is wrong or if there are any other ways to get what i want but i appreciate any help</p>\n"}, {"tags": ["parsing", "haskell", "maybe"], "answers": [{"tags": [], "owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "is_accepted": false, "score": 1, "last_activity_date": 1536846752, "creation_date": 1536846752, "answer_id": 52315262, "question_id": 52313436, "link": "https://stackoverflow.com/questions/52313436/dealing-with-read-no-parse-error-for-lists/52315262#52315262", "title": "Dealing with read no parse error for lists", "body": "<p>The <code>Text.Read</code> library also has a function called <code>readMaybe</code> that returns a <code>Maybe a</code> instead of just an <code>a</code> like <code>read</code> does.</p>\n\n<p>In the case that you're not sure whether or not a string can be parsed, you clearly want a <code>Maybe a</code>. Now you need to deal with the <code>Maybe</code> though, however the <code>Maybe</code> monad has tons of functions that do exactly what you need.</p>\n\n<p>For more complicated parsing you could look into the Haskell ParseLib which is really good. However it might be a little overkill if you're not trying to parse more than your example.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536846752, "creation_date": 1536840496, "question_id": 52313436, "link": "https://stackoverflow.com/questions/52313436/dealing-with-read-no-parse-error-for-lists", "title": "Dealing with read no parse error for lists", "body": "<p>Hello can someone please explain me how can you deal with failed computations (in our case parsings) in Haskell when performed in a list,retrieving the successful elements? </p>\n\n<p>The error i get is <br>\n<code>main: Prelude.read: no parse</code> and that stops all the list from being processed</p>\n\n<p>I am using a  <code>forM</code> over a collection of <code>Text</code> , and for each element i am using a<br> <code>read::String-&gt;Double</code> for the result value.<Br>\n<br>Currently the parsing fails at the first element and i can not parse the remaining elements.How can i make single elements \"fail-able\" but still get partial results ( for the elements of the list that could be parsed) ?</p>\n\n<p><strong>Example</strong> :<br><strong>Input</strong>:   <code>[\"asta\",\"1.23\",\"2.44\"]</code><br>\n  <strong>Desired Output</strong>:<code>[1.23,2.44]</code></p>\n\n<pre><code>import qualified Data.Text as T\n\nparseDfile::[T.Text]-&gt;IO [Maybe Double]\n    parseDfile []=do\n        return  [Nothing]\n    parseDfile lines = forM lines $ \\line -&gt;\n                          do   \n                          Prelude.putStrLn (\"line value:\"++(T.unpack line))\n                          let value = (read::String-&gt;Double) . T.unpack $ //fails here  for first element \n                          print .show $ value\n                          return (Just value)\n</code></pre>\n\n<p><strong>P.S</strong><BR>Do i have to define a method using the <code>Maybe</code> monad separately only for that one line of code ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7613, "user_id": 1364007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d106de3dec9586b56ed7f110497689e?s=128&d=identicon&r=PG", "display_name": "Wai Ha Lee", "link": "https://stackoverflow.com/users/1364007/wai-ha-lee"}, "edited": false, "score": 1, "creation_date": 1536842313, "post_id": 52313405, "comment_id": 91574930, "body": "Is this the same thing as <a href=\"https://stackoverflow.com/q/44865000/1364007\">this</a>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 7613, "user_id": 1364007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d106de3dec9586b56ed7f110497689e?s=128&d=identicon&r=PG", "display_name": "Wai Ha Lee", "link": "https://stackoverflow.com/users/1364007/wai-ha-lee"}, "edited": false, "score": 0, "creation_date": 1536844370, "post_id": 52313405, "comment_id": 91576143, "body": "@WaiHaLee Yes, it&#39;s the same mechanism. To the OP: if you feel that the linked question does not answer fully, we can reopen the question."}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1536844259, "answer_count": 0, "score": 1, "last_activity_date": 1536840595, "creation_date": 1536840371, "last_edit_date": 1536840595, "question_id": 52313405, "link": "https://stackoverflow.com/questions/52313405/explanation-of-the-following-syntax-atype", "closed_reason": "Duplicate", "title": "explanation of the following syntax : &#39;ATYPE", "body": "<p>I've seen this syntax <code>ReadResult 'RegularStream StreamSlice</code>, could you explain what does the <code>'</code> mean before a data type ?</p>\n"}, {"tags": ["haskell", "yesod", "conduit"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1536853363, "post_id": 52312631, "comment_id": 91581872, "body": "Maybe this can be of any help? <a href=\"https://www.yesodweb.com/blog/2013/03/simpler-streaming-responses\" rel=\"nofollow noreferrer\">yesodweb.com/blog/2013/03/simpler-streaming-responses</a>"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1536854937, "post_id": 52312631, "comment_id": 91582741, "body": "Nope, as it doesn&#39;t use <code>defaultLayout</code> in the streamed response. However, this page <a href=\"https://www.yesodweb.com/book/sql-joins\" rel=\"nofollow noreferrer\">yesodweb.com/book/sql-joins</a> explicitly says that &quot; We also lose the ability to use defaultLayout&quot;. :-("}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536837839, "creation_date": 1536837604, "last_edit_date": 1536837839, "question_id": 52312631, "link": "https://stackoverflow.com/questions/52312631/is-there-a-way-to-use-defaultlayout-and-a-source-conduit-in-yesod", "title": "Is there a way to use defaultLayout and a source (conduit) in Yesod", "body": "<p>I'm trying to optimise an Yesod application so that it runs in constant space.\nFor example, I'm reading a DB table and display it as an HTML table. I should be able to start sending the first row before having finished processing the full table. I understand I can do that using <code>selectSource</code>(to read the DB) and <code>responseSource</code> or <code>responseSourceDB</code> but I how can wrap it in the default layout using <code>defaultLayout</code> ?</p>\n\n<p>At the moment I have to consume the full source to generate a list and the Html in one go. For example let say I have (might not compiles)</p>\n\n<pre><code>   data User = {name :: Text, email :: Text } deriving ...\n\n   userSource = selectSource [] [Asc UserName]\n   userToTR user = [whamlet|\n             &lt;tr&gt;\n                  &lt;td&gt;#{user name}\n                  &lt;td&gt;#{user email}\n\n\n   getUsers :: Handler Html\n   getUsers = do\n      rows &lt;- runConduit $ userSource =$= mapC userToTR =$= sinkList\n      table = [whamlet|\n         &lt;table&gt;\n           &lt;tr&gt;\n             &lt;th&gt;Name\n             &lt;th&gt;Email\n           ^{mconcat rows}\n\n       defaultLayout table\n</code></pre>\n\n<p>How I can transform this to stream the rows nicely ?\n(This is only a made up example to explain the problem, the real problem is much more complicated).</p>\n"}, {"tags": ["haskell", "casting", "io"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1536830077, "post_id": 52309869, "comment_id": 91567810, "body": "The idea is that one does <i>not</i> unwrap the values of an <code>IO</code>. There are some <code>unsafePerformIO</code> and friends functions, but this can result in severe problems. One writes pure functions, and you can for example then bind two functions together with for example <code>probs x &gt;&gt;= \\y -&gt; return (calcQuartile y [0, 0.25..1])</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1536831416, "post_id": 52309869, "comment_id": 91568632, "body": "In practice, you would just write <code>(`calcQuartile`[0, 1&#47;4 .. 1]) &lt;$&gt; probs x</code>. (The purpose of the backticks is to partially apply to the right argument. It would be easier if you had defined <code>calcQuartile</code> with flipped arguments in the first place, that would simplify the application to <code>calcQuartile [0, 1&#47;4 .. 1] &lt;$&gt; probs x</code>.) Alternatively: <code>calcQuartile &lt;$&gt; probs x &lt;*&gt; pure [0, 1&#47;4 .. 1]</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536831863, "post_id": 52309869, "comment_id": 91568910, "body": "Incidentally, for more involved stuff with random numbers there are dedicated monads, so you can avoid doing everything in <code>IO</code> in the first place. <a href=\"http://hackage.haskell.org/package/random-fu-0.2.7.0/docs/Data-Random.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/random-fu-0.2.7.0/docs/&hellip;</a>"}, {"owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536865447, "post_id": 52309869, "comment_id": 91587846, "body": "@leftaroundabout I must say I don&#39;t find my question a duplicate from the linked questions as my question explicitly states that it is about an IO <b>list</b> and that it deals with <b>random</b> values. I had hoped for some solution that deals with monad lists in specific (ways to <code>fold</code> over a monadic list (<code>foldM</code> perhaps?) or <code>map</code> or <code>filter</code> or whatever). That the answer to this question is now similar to the answers of the other question, doesn&#39;t mean that I expected to find similar answers."}], "answers": [{"comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 2, "creation_date": 1536829841, "post_id": 52310082, "comment_id": 91567643, "body": "Yes, it works, but how does it work? Can you predict and explanation result: <code>let {a = calcQuartile (unsafePerformIO(probs x)) [0,0.25..1]; b = calcQuartile (unsafePerformIO(probs x)) [0,0.25..1]} in a == b</code>"}, {"owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1536830198, "post_id": 52310082, "comment_id": 91567887, "body": "@freestyle But isn&#39;t that the whole thing when working with random numbers? Random results are not entirely predictable by nature. How would you suggest this usecase could be solved in a more &quot;clean&quot; manner?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1536830431, "post_id": 52310082, "comment_id": 91568034, "body": "@SimonBaars If you enable optimizations, freestyle&#39;s code will suddenly return <code>True</code>, not <code>False</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1536830981, "post_id": 52310082, "comment_id": 91568363, "body": "This is emphatically <b>not</b> a safe use of <code>unsafePerformIO</code>. As freestyle says, it breaks referential transparency: if you want to check multiple different samples from the same distribution, you&#39;d expect to get always slightly different results, but <code>unsafePerformIO (probs x)</code> is semantically just a constant. As a rule of thumb, never use <code>unsafePerformIO</code>, ever. (The few cases where it is actually appropriate, you must be 100% sure and wouldn&#39;t have to ask a question about it.) <i>Definitely</i> don&#39;t use it if you&#39;re not really firm with monads yet."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1536838090, "post_id": 52310082, "comment_id": 91572404, "body": "To everybody: though I downvoted this answer myself, there&#39;s no need to overdo it. This is a perfectly well-intended post, no need to punish anything. It just happens to contain a solution that should be avoided."}, {"owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536842294, "post_id": 52310082, "comment_id": 91574912, "body": "@leftaroundabout Sorry... I did not know about the unpredictible results. I edited my answer so people who discover this question will not be lead towards bad practise solutions."}, {"owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536865589, "post_id": 52310082, "comment_id": 91587912, "body": "@leftaroundabout Thanks a lot for elaborating upon my answer :-)."}], "tags": [], "owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "is_accepted": true, "score": -1, "last_activity_date": 1536842750, "last_edit_date": 1536842750, "creation_date": 1536828926, "answer_id": 52310082, "question_id": 52309869, "link": "https://stackoverflow.com/questions/52309869/convert-io-float-to-float-in-haskell/52310082#52310082", "title": "Convert IO [Float] to [Float] in Haskell", "body": "<p>Edit: As @freestyle style noted, this solution works but can lead to unpredicible results:</p>\n\n<blockquote>\n  <p>I imported the module <code>System.IO.Unsafe</code>:</p>\n\n<pre><code>import System.IO.Unsafe\n</code></pre>\n  \n  <p>Next, I can replace my code by the following:</p>\n\n<pre><code>calcQuartile (unsafePerformIO(probs x)) [0,0.25..1]\n</code></pre>\n</blockquote>\n\n<p>The better solution, as noted by @Willem Van Onsem is the following:</p>\n\n<pre><code>probs x &gt;&gt;= \\y -&gt; return (calcQuartile y [0, 0.25..1])\n</code></pre>\n\n<p>It is noteable though that this returns a <code>IO [Int]</code> instead of a <code>[Int]</code>. The <em>monadic bind</em> <code>&gt;&gt;=</code> links two impure actions together (i.e. in this case IO actions) and makes a single <code>IO</code> action out of them. The same thing can also be written with <code>do</code> notation:</p>\n\n<pre><code>do\n  y &lt;- probs x\n  return $ calcQuartile y [0, 0.25 .. 1]\n</code></pre>\n\n<p>In this particular case, the second action (the <code>calcQuartile</code>) is actually <em>pure</em> (thus the <code>return</code>, which wraps a pure value as a side-effect-free IO action), so you don't really need the monad instance at all and can instead just use <code>IO</code> as a functor:</p>\n\n<pre><code>fmap (\\y -&gt; calcQuartile y [0, 0.25..1]) $ probs x\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(`calcQuartile`[0, 0.25..1]) &lt;$&gt; probs x\n</code></pre>\n"}], "owner": {"reputation": 1466, "user_id": 5320300, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ktwDF.jpg?s=128&g=1", "display_name": "Simon Baars", "link": "https://stackoverflow.com/users/5320300/simon-baars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 0, "closed_date": 1536830631, "accepted_answer_id": 52310082, "answer_count": 1, "score": -1, "last_activity_date": 1536842750, "creation_date": 1536828206, "question_id": 52309869, "link": "https://stackoverflow.com/questions/52309869/convert-io-float-to-float-in-haskell", "closed_reason": "Duplicate", "title": "Convert IO [Float] to [Float] in Haskell", "body": "<p>I need to convert a list of <code>IO [Float]</code> to <code>[Float]</code>. I get a <code>IO [Float]</code> object from the following function:</p>\n\n<pre><code>probs :: Int -&gt; IO [Float]\nprobs 0 = return []\nprobs n = do\n             p &lt;- getStdRandom random\n             ps &lt;- probs (n-1) \n             return (p:ps)\n</code></pre>\n\n<p>I understand that the result of this function is a list with type [IO Float] and not a list of numbers. It is a list of I/O actions that generate numbers. The I/O wasn't executed yet, so in my case the random number generator hasn't actually generated the numbers. What I want to do is generate each random number of the contents of this list, so I can get a <code>[Float]</code> list.</p>\n\n<p>I need this to calculate the amount of numbers in every quartile of the result (to check the distribution among random numbers):</p>\n\n<pre><code>calcQuartile :: [Float] -&gt; [Float] -&gt; [Int]\ncalcQuartile randomList (x1:x2:rest) = length(filter (\\x -&gt; x&gt;=x1 &amp;&amp; x&lt;x2) randomList):calcQuartile randomList (x2:rest)\ncalcQuartile x y = []\n</code></pre>\n\n<p>I use the following code to run this function, which is not working:</p>\n\n<pre><code>calcQuartile (probs x) [0,0.25..1]\n</code></pre>\n\n<p>The error which I get is:</p>\n\n<pre><code> \u2022 Couldn't match expected type \u2018[Float]\u2019\n               with actual type \u2018IO [Float]\u2019\n \u2022 In the first argument of \u2018calcQuartile\u2019, namely \u2018(probs x)\u2019\n   In the expression: calcQuartile (probs x) [0, 0.25 .. 1]\n   In an equation for \u2018getAmountInQuartile\u2019:\n       getAmountInQuartile x = calcQuartile (probs x) [0, 0.25 .. 1]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1536815048, "post_id": 52306902, "comment_id": 91561026, "body": "I&#39;m not even sure where to begin answering this. This is a type synonym - there is no definition. Are you confusing this with a function signature perhaps?"}], "answers": [{"comments": [{"owner": {"reputation": 1195, "user_id": 2814202, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8e45b7eb53a10285dbc4195f61e9d83?s=128&d=identicon&r=PG&f=1", "display_name": "himekami", "link": "https://stackoverflow.com/users/2814202/himekami"}, "edited": false, "score": 1, "creation_date": 1536815481, "post_id": 52306947, "comment_id": 91561154, "body": "IC.. it kinda works like find-and-replace or preprocessor thing"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1195, "user_id": 2814202, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8e45b7eb53a10285dbc4195f61e9d83?s=128&d=identicon&r=PG&f=1", "display_name": "himekami", "link": "https://stackoverflow.com/users/2814202/himekami"}, "edited": false, "score": 0, "creation_date": 1536815599, "post_id": 52306947, "comment_id": 91561183, "body": "@himekami if that&#39;s how you want to think of it. It&#39;s helpful in a broader sense to name things reasonably. <code>data Card = Card Rank Suit; type Hand = [Card]; type Deck = [Card]; shuffle :: RandomGen s =&gt; s -&gt; Deck -&gt; Deck</code> etc..."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 5, "last_activity_date": 1536815045, "creation_date": 1536815045, "answer_id": 52306947, "question_id": 52306902, "link": "https://stackoverflow.com/questions/52306902/haskell-type-declaration-using-arrow-operator/52306947#52306947", "title": "Haskell type declaration using arrow operator", "body": "<p>That's a type synonym. It's expressing that an <code>Acceleration</code> is a function that goes from <code>State</code> to <code>Vec</code>.</p>\n\n<p>Simplify a bit and imagine the set of functions that go from <code>Int</code> to <code>String</code>. Let's call them <code>Frobnicators</code>.</p>\n\n<pre><code>type Frobnicator = Int -&gt; String\n</code></pre>\n\n<p>We can define such a function which we could then say has a type of <code>Frobnicator</code>.</p>\n\n<pre><code>foo :: Frobnicator\nfoo = show . (+3)\n</code></pre>\n"}], "owner": {"reputation": 1195, "user_id": 2814202, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8e45b7eb53a10285dbc4195f61e9d83?s=128&d=identicon&r=PG&f=1", "display_name": "himekami", "link": "https://stackoverflow.com/users/2814202/himekami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 52306947, "answer_count": 1, "score": 2, "last_activity_date": 1536815045, "creation_date": 1536814761, "question_id": 52306902, "link": "https://stackoverflow.com/questions/52306902/haskell-type-declaration-using-arrow-operator", "title": "Haskell type declaration using arrow operator", "body": "<p>I encountered a Haskell type declaration using arrow operator like the following :</p>\n\n<pre><code>type Acceleration = State -&gt; Vec\n</code></pre>\n\n<p>But how can that be ? coz I've never encountered such use before (in learning Haskell tutorials).</p>\n\n<p>if the declaration is a-OK then what its definition should look like ? \nHow do I even use such a type ?</p>\n"}, {"tags": ["haskell", "haskell-stack", "haddock"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1536809743, "post_id": 52306161, "comment_id": 91559790, "body": "Looks like Haddock is segfaulting. There&#39;s a couple of bugs in the last version of Haddock that might cause this. Is <code>webservice</code> a package that is published so I can replicate?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1536818876, "post_id": 52306161, "comment_id": 91562275, "body": "@Alec thank you for offering to help. Unfortunately, <code>webservice</code> is private/proprietary code and I won&#39;t be able to share publicly. Any other debugging information that I can share?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1536819703, "post_id": 52306161, "comment_id": 91562584, "body": "I&#39;m not too familiar with <code>stack</code>, but there should be some way to tell it to pass <code>-v3</code> to the underlying call to Cabal. You&#39;ll probably get more output there (so it&#39;ll be easier to tell approx when the segfault happened). Also, just a wild guess at the bug you may be hitting: try passing <code>--no-haddock-hyperlink-source</code> and see if things succeed..."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1536822886, "post_id": 52306161, "comment_id": 91563943, "body": "@Alec I&#39;ve added some debugging output to the question. Does this help in any way? Btw, has the bug (that you&#39;re suspecting) been fixed? How do I upgrade haddock?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1536824063, "post_id": 52306161, "comment_id": 91564513, "body": "Not quite, I was thinking of <code>--cabal-verbose</code> (I do wish stack advertised that option a bit more). The bug I&#39;m thinking of has been fixed. Upgrading your Haddock version isn&#39;t quite as easy as it sounds. If you really want to, the simplest way about this is probably to build/install Haddock from source. You&#39;ll need to checkout the branch corresponding to the GHC version you are using. Even after that, I&#39;m not sure how to instruct stack to use that <code>haddock</code> binary (with <code>cabal</code>, you&#39;d use <code>--with-haddock</code>)..."}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536822801, "creation_date": 1536808696, "last_edit_date": 1536822801, "question_id": 52306161, "link": "https://stackoverflow.com/questions/52306161/haddock-generating-docs-but-returning-exit-code-1", "title": "haddock generating docs, but returning exit code 1", "body": "<p>I've tried invoking <code>haddock</code> via stack using the following commands:</p>\n\n<pre><code>stack haddock --no-haddock-deps --haddock-internal webservice:lib\n\nstack haddock --haddock-arguments \"--odir=/tmp/haddock\" --no-haddock-deps --haddock-internal webservice:lib\n\nstack haddock --haddock-arguments \"--odir=/tmp/haddock --no-warnings\" --no-haddock-deps --haddock-internal webservice:lib\n\nstack haddock --haddock-arguments \"--odir=/tmp/haddock --no-warnings --no-print-missing-docs\" --no-haddock-deps --haddock-internal webservice:lib\n</code></pre>\n\n<p>And each time, towards the end of haddock's output I notice the following:</p>\n\n<pre><code>Documentation created:\n.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/doc/html/webservice/index.html,\nCabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3: can't find source for QCTest in\n.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/doc/html/webservice/webservice.txt\n.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/webservice-test/webservice-test-tmp,\nPreprocessing test suite 'webservice-test' for webservice-0.1.0.0..\ntest, src\n\n\n--  While building custom Setup.hs for package webservice-0.1.0.0 using:\n      /home/vl/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.2.0.1 haddock --html --hoogle --html-location=../$pkg-$version/ --haddock-option=--hyperlinked-source --internal --haddock-option=--odir=/tmp/haddock --haddock-option=--no-warnings --haddock-option=--no-print-missing-docs --haddock-option=--hoogle --haddock-option=--quickjump\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>The documentation of <code>webservice:lib</code> seems to be have been generated, but still <code>haddock</code> exits with <code>1</code>, thus completely breaking my CI scripts.</p>\n\n<p><strong>Edit - debugging output:</strong></p>\n\n<p>Command:</p>\n\n<pre><code>stack haddock --haddock-arguments \"--odir=/tmp/haddock -v3 --no-haddock-hyperlink-source\" --no-haddock-deps --haddock-internal webservice:lib\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Warning: Unable to find a known\n         candidate for the Cabal entry\n         Keys, but did find: \n         * Keys.hs.sample If you are\n         using a custom preprocessor for\n         this module with its own file\n         extension, consider adding the\n         file(s) to your .cabal under\n         extra-source-files.\nwebservice-0.1.0.0: build (lib)\nPreprocessing library for webservice-0.1.0.0..\nBuilding library for webservice-0.1.0.0..\nignoring (possibly broken) abi-depends field for packages\nwebservice-0.1.0.0: haddock\nCabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3:\n'/home/vl/.stack/programs/x86_64-linux/ghc-8.4.3/bin/haddock' exited with an\nerror:\n\n\n--  While building custom Setup.hs for package webservice-0.1.0.0 using:\n      /home/vl/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.2.0.1 haddock --html --hoogle --html-location=../$pkg-$version/ --haddock-option=--hyperlinked-source --internal --haddock-option=--odir=/tmp/haddock --haddock-option=-v3 --haddock-option=--no-haddock-hyperlink-source\n    Process exited with code: ExitFailure 1\n</code></pre>\n"}]