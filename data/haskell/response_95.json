[{"tags": ["haskell", "monads", "composition", "st-monad"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1478225633, "creation_date": 1478225633, "answer_id": 40414285, "question_id": 40391476, "link": "https://stackoverflow.com/questions/40391476/recursive-function-that-returns-multable-array-and-a-list/40414285#40414285", "title": "Recursive function that returns multable array and a list", "body": "<p>You should use the <code>Monad</code> instance of <code>ST s</code> to implement the recursive calls to <code>f</code> (and the composition of their results): change <code>f</code>'s type to</p>\n\n<pre><code>f :: [a] -&gt; ([a], STArray s Int a) -&gt; ST s ([a], STArray s Int a)\n</code></pre>\n\n<p>which means the recursive calls in <code>f</code> will look something like</p>\n\n<pre><code>f xs curr = do\n    xs' &lt;- ...\n    curr' &lt;- ...\n    next &lt;- f xs' curr'\n    combine curr next\n</code></pre>\n\n<p>and then <code>runST</code> it to completion in <code>h</code> (<code>runSTArray</code> doesn't work directly here, because you also have your <code>[a]</code> on the side):</p>\n\n<pre><code>h lo hi x0 xs = runST $ do\n    curr &lt;- newArray lo hi x0\n    (ys, mArr) &lt;- f xs (xs, curr)\n    arr &lt;- freeze mArr\n    return (ys, arr)\n</code></pre>\n\n<p>This works because in that last expression, <code>ys :: [a]</code> and <code>arr :: Array Int a</code>, so neither depends on the choice of <code>s</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478226013, "creation_date": 1478129244, "last_edit_date": 1478226013, "question_id": 40391476, "link": "https://stackoverflow.com/questions/40391476/recursive-function-that-returns-multable-array-and-a-list", "title": "Recursive function that returns multable array and a list", "body": "<p>I'm trying to build a recursive function, which for simplicity's sake, lets say it takes an list and builds an array and a list. Because I need to both read and write the array as it's being built, I'm using a mutable array so I can do constant time reads and writes. So the signature and function looks something like as follows:</p>\n\n<pre><code>f :: [a] -&gt; ST s ([a], STArray s Int a) -&gt; ST s ([a], STArray s Int a)\nf (x:xs) curr_arr = \n  case blah of\n    ... -&gt; f xs new_arr\nf [] curr_arr = curr_arr\n</code></pre>\n\n<p>I want a function <code>h</code> with the following signature:</p>\n\n<pre><code>h :: Int -&gt; Int -&gt; a -&gt; [a] -&gt; (Array Int a, [a])\n</code></pre>\n\n<p>And I want it to have the roughly following implementation:</p>\n\n<pre><code>h lbound ubound default_a xs = g (f xs (newArray lbound ubound default_a))\n</code></pre>\n\n<p>Problem is, I need a function <code>g</code> with this signature:</p>\n\n<pre><code>ST s ([a], STArray s Int a) -&gt; (Array Int a, [a])\n</code></pre>\n\n<p>but I can't seem to hack together <code>runST</code> and <code>runSTArray</code> to achieve this. </p>\n\n<p>Is there anyway to implement <code>g</code>, or should I make the signature of <code>f</code> completely different in the first place?</p>\n"}, {"tags": ["performance", "sorting", "haskell", "functional-programming", "list-comprehension"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1478128569, "post_id": 40390867, "comment_id": 68034420, "body": "What version of GHC is this? How are you measuring speed, and on what inputs? I&#39;m pretty surprised, because <code>filter</code> is implemented using a <code>build&#47;foldr</code> form that should fuse similarly to the list comprehension. If you&#39;re trying things in GHCi, they&#39;re not optimized. Note also that there is no <code>-O3</code>; just <code>-O2</code>. That could change eventually, but it&#39;s been that way since the beginning."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1478129152, "post_id": 40390867, "comment_id": 68034591, "body": "There&#39;s no way <code>minisort</code> (<a href=\"https://en.wikipedia.org/wiki/Selection_sort\" rel=\"nofollow noreferrer\">selection sort</a>) would be faster on any non-tiny list, as it&#39;s <i>O</i> (<i>n</i> &#178;) best-case, whereas any decent sort algorithm has <i>O</i> (<i>n</i> &#183; log <i>n</i>) average-case complexity. <i>How</i> did you measure this? In particular, what did you do to make sure the results are actually evaluated? I suspect you only WHNF the sorted lists \u2013 that&#39;s not sufficient."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478129396, "post_id": 40390867, "comment_id": 68034652, "body": "Not really relevant to the question, but <code>minisort</code> is not a correct implementation. Try <code>minisort [3,5,6,5,2]</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1478130879, "post_id": 40390867, "comment_id": 68035017, "body": "I&#39;ve let them sort standard-type <code>Int</code> lists of 5000 to 10000 elements. I got the factors using both GHC 7.8.0 and GHC 8.0.1, multiple measurement methods and separate programs for each implementation. I&#39;m not an expert though. THX duplode, fixed the bug."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1478131553, "post_id": 40390867, "comment_id": 68035194, "body": "<code>print</code>, no WHNF."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1478133567, "post_id": 40390867, "comment_id": 68035613, "body": "Please post your benchmark code and the procedure you used to run it. Note also that your &quot;quicksort&quot; is not randomized, so it&#39;s susceptible to pathological cases, and that it performs two passes over each list (although the latter may not be terrible here)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1478140545, "post_id": 40390867, "comment_id": 68037242, "body": "I used the classic famous Haskell &#39;quicksort&#39; two-liner. As said, wasn&#39;t trying to rival <code>sort</code>. Updated question description with criterion benchmark."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 9, "creation_date": 1478140572, "post_id": 40390867, "comment_id": 68037254, "body": "The descending list you&#39;re testing on is just the sort of pathological input dfeuer is referring to. Can you see why? So you&#39;re comparing several quadratic time algorithms. The answer as to why some are slower or faster than others here is not going to be particularly interesting"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1478141670, "post_id": 40390867, "comment_id": 68037505, "body": "I read this a bit wrong. There is no potential for list fusion here. If the difference between <code>quicksort</code> and <code>quicksort2</code> is real (it&#39;s barely statistically significant, and I wouldn&#39;t be surprised if there were some silly dependence on which benchmark is run first or whatever) then it&#39;s probably something fragile in optimization. Selection sort is simpler than quicksort, so I&#39;m not surprised it&#39;s faster when quicksort hits its worst case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1478141791, "post_id": 40390867, "comment_id": 68037545, "body": "If you want to have fun playing with sorting in Haskell, I suggest you try writing some merge sorts, heap sorts, and genuine randomized quicksorts."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1478142340, "post_id": 40390867, "comment_id": 68037660, "body": "The <code>quicksort</code>-<code>quicksort2</code> difference still irks me though. It&#39;s consistent changing order, list size and orderedness."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1478188125, "post_id": 40390867, "comment_id": 68061877, "body": "Well, that is actually a bit strange. <i>Why is <code>filter</code> slower than a list comprehension here</i>? Perhaps you should have left <code>minisort</code> out of this question..."}], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 705, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1503410938, "creation_date": 1478125622, "last_edit_date": 1503410938, "question_id": 40390867, "link": "https://stackoverflow.com/questions/40390867/haskell-ghc-performance-of-naive-sorts-using-filter-list-comprehension", "title": "Haskell/GHC performance of naive sorts using `filter` / list comprehension", "body": "<p>Compiling with <code>-O3</code>, a program using</p>\n\n<pre><code>quicksort []       = []\nquicksort (x : xs) = quicksort (filter (&lt; x) xs)\n                     ++ [x] ++\n                     quicksort (filter (&gt;= x) xs)\n</code></pre>\n\n<p>is 1.1x slower than a program using</p>\n\n<pre><code>quicksort2 []       = []\nquicksort2 (x : xs) = quicksort2 [y |\u00a0y &lt;- xs, y &lt; x]\n                      ++ [x] ++\n                      quicksort2 [y | y &lt;- xs, y &gt;= x]\n</code></pre>\n\n<p>is 6x slower than a program using</p>\n\n<pre><code>minisort [] = []\nminisort xs = let x = minimum xs\n              in  x : minisort (delete x xs)\n</code></pre>\n\n<p>These are not the Haskell-native merge<code>sort</code>, and not meant to be.</p>\n\n<p>I noticed <code>minisort</code> consistently run much faster than both of the <code>quicksort</code>s, which seemed understandable, considering complexities of involved operations. What I don't understand is a consistent slight edge <code>quicksort2</code> has over <code>quicksort</code>. Are list comprehensions generally more efficient than <code>filter</code> expressions?</p>\n\n<hr>\n\n<p>Used by me, so far, were <a href=\"http://rextester.com/l/haskell_online_compiler\" rel=\"nofollow noreferrer\">criterion</a>, with <code>nf</code>, <code>ghci</code>'s <code>:set +s</code>, and 2 remote performance-displayant online compilers (<a href=\"http://ideone.com\" rel=\"nofollow noreferrer\">ideone</a>, <a href=\"http://rextester.com/l/haskell_online_compiler\" rel=\"nofollow noreferrer\">rextester</a>).</p>\n\n<p>criterion benchmark sorting worst-case <code>[5000, 4999 .. 1] :: [Int]</code>:</p>\n\n<pre><code>benchmarking quicksort\ntime                 2.283 s     (2.191 s .. 2.450 s)\n                     0.999 R\u00b2    (0.998 R\u00b2 .. 1.000 R\u00b2)\nmean                 2.434 s     (2.368 s .. 2.485 s)\nstd dev              79.23 ms    (0.0 s .. 88.75 ms)\nvariance introduced by outliers: 19% (moderately inflated)\n\nbenchmarking quicksort2\ntime                 2.203 s     (1.982 s .. 2.455 s)\n                     0.998 R\u00b2    (0.994 R\u00b2 .. 1.000 R\u00b2)\nmean                 2.327 s     (2.275 s .. 2.359 s)\nstd dev              49.11 ms    (0.0 s .. 56.47 ms)\nvariance introduced by outliers: 19% (moderately inflated)\n\nbenchmarking minisort\ntime                 257.2 ms    (229.7 ms .. 276.4 ms)\n                     0.997 R\u00b2    (NaN R\u00b2 .. 1.000 R\u00b2)\nmean                 274.4 ms    (264.3 ms .. 280.9 ms)\nstd dev              9.714 ms    (2.538 ms .. 12.94 ms)\nvariance introduced by outliers: 16% (moderately inflated)\n</code></pre>\n\n<p><code>quicksort2</code> always (varying test cases, orders, and contexts) performs a bit better than <code>quicksort</code>. <code>minisort</code>, by far, performs better than both of them.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1478123257, "post_id": 40390309, "comment_id": 68032458, "body": "This is a deprecated feature of Haskell. To turn it back on, you can always type <code>:set -XNPlusKPatterns</code> in GHCi or add <code>{-# LANGUAGE NPlusKPatterns #-}</code> to the top of your file."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1478127067, "last_edit_date": 1478127067, "creation_date": 1478125911, "answer_id": 40390933, "question_id": 40390309, "link": "https://stackoverflow.com/questions/40390309/parse-error-in-pattern-for-recursive-mathematical-operators/40390933#40390933", "title": "Parse Error In Pattern for Recursive Mathematical Operators", "body": "<p>You just replace <code>n</code> with <code>n-1</code> on both sides of the equation:</p>\n\n<pre><code>(*) :: Int -&gt; Int -&gt; Int\nm * 0 = 0\nm * ((n-1) + 1) = m + (m * (n-1))\n</code></pre>\n\n<p>which is not valid syntax, but of course \"simplifies\" to the correct version</p>\n\n<pre><code>(*) :: Int -&gt; Int -&gt; Int\nm * 0 = 0\nm * n = m + (m * (n-1))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 5537785, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qk26D.png?s=128&g=1", "display_name": "lamg", "link": "https://stackoverflow.com/users/5537785/lamg"}, "is_accepted": false, "score": 3, "last_activity_date": 1478140466, "last_edit_date": 1478140466, "creation_date": 1478126116, "answer_id": 40390964, "question_id": 40390309, "link": "https://stackoverflow.com/questions/40390309/parse-error-in-pattern-for-recursive-mathematical-operators/40390964#40390964", "title": "Parse Error In Pattern for Recursive Mathematical Operators", "body": "<p>If you prefer not using the NPlusKPatterns extension then you can write:</p>\n\n<pre><code>import Prelude hiding ((^))\n\n(^) :: Int -&gt; Int -&gt; Int\nm ^ 0 = 1\nm ^ n = m * (m ^ (n - 1))\n</code></pre>\n\n<p>The line <code>import Prelude hiding ((^))</code> avoids the duplicate definition of (^), since it is already defined in Prelude.</p>\n"}], "owner": {"reputation": 308, "user_id": 5004298, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/MgM2A.png?s=128&g=1", "display_name": "Michael Brandon Morris", "link": "https://stackoverflow.com/users/5004298/michael-brandon-morris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "closed_date": 1478158494, "accepted_answer_id": 40390933, "answer_count": 2, "score": 0, "last_activity_date": 1504684285, "creation_date": 1478122952, "last_edit_date": 1504684285, "question_id": 40390309, "link": "https://stackoverflow.com/questions/40390309/parse-error-in-pattern-for-recursive-mathematical-operators", "closed_reason": "Duplicate", "title": "Parse Error In Pattern for Recursive Mathematical Operators", "body": "<p>I am a student learning Haskell. My textbook gives the following as an example:</p>\n\n<pre><code>(*) :: Int -&gt; Int -&gt; Int\nm * 0 = 0\nm * (n + 1) = m + (m * n)\n</code></pre>\n\n<p>It then asks us to redefine the ^ (positive integral exponentiation) operator in the same manner for an exercise. I assumed the following would work:</p>\n\n<pre><code>(^) :: Int -&gt; Int -&gt; Int\nm ^ 0 = 1\nm ^ (n + 1) = m * (m ^ n)\n</code></pre>\n\n<p>However, it fails to compile, giving a 'parse error in pattern' on the <code>(n + 1)</code> bit. Out of curiosity, I tried the multiplication operator as defined in the book's example, and it gave the same error.</p>\n\n<p>Where/how is the textbook wrong, and how do I correct it?</p>\n\n<h3>Edit</h3>\n\n<p>Thank you to those who pointed out that this issue was addressed some years ago. Since the \"feature\" of n+k pattern matching was removed, how would I modify the textbook example to follow modern good practice?</p>\n\n<p>In short, I now know why the original does not work, but how could it be changed to work?</p>\n"}, {"tags": ["haskell", "interface", "abstract"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 3, "creation_date": 1478113142, "post_id": 40387586, "comment_id": 68027155, "body": "The last method is inherently bad because too many fields always imply an inconsistent state."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1478113212, "post_id": 40387586, "comment_id": 68027196, "body": "Aside: there is nothing wrong with using Haskell to write games :)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1478118260, "post_id": 40387860, "comment_id": 68029909, "body": "If there are different player types (e.g., for different variations of the game, or possibly even for PCs vs. NPCs), then a class for them could make sense."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 2, "last_activity_date": 1478114474, "last_edit_date": 1478114474, "creation_date": 1478113552, "answer_id": 40387860, "question_id": 40387586, "link": "https://stackoverflow.com/questions/40387586/abstract-records-or-record-interfaces/40387860#40387860", "title": "Abstract records or record interfaces?", "body": "<p>I would go with your first attempt, for a very simple reason:</p>\n\n<p>It accurately captures the intention of a <code>Player</code> - it's an <code>Entity</code> with additional information.</p>\n\n<pre><code>data Player = Player {\n    e      :: Entity\n    health :: Int\n}\n</code></pre>\n\n<p>While all functions dealing with may be cumbersome to write at first, you will probably never have to see them again, meaning you provided an abstract enough interface in your code not to access the state of a <code>Player</code> directly.</p>\n\n<pre><code>movePlayer :: Player -&gt; Player\nmovePlayer p@(e) = p {e = move e}\n</code></pre>\n\n<p>This function is written once and then ideally you never have to deal with internals again.</p>\n\n<p>Additionally, now you can use type classes as they are intended: you can abstract <code>movePlayer</code> in a separate type class such as <code>Movable</code>:</p>\n\n<pre><code>class Movable m where\n    move :: m -&gt; m\n\n-- Obviously, you can move entities\ninstance Movable Entity where\n    move e = -- stuff\n</code></pre>\n\n<p>But now it's really easy to move <code>Players</code> too:</p>\n\n<pre><code>instance Movable Player where\n    move (Player entity health) = Player (move entity) health\n    -- works, since `Entity` is movable\n</code></pre>\n\n<hr>\n\n<p>This aside, your type class approach has a major flaw: What about functions a <code>Player</code> has but an <code>Entity</code> doesn't? In this case you would have <code>Player</code> inherit <code>Entity</code>, like this:</p>\n\n<pre><code>class Entity e =&gt; Player e where\n   -- stuff ...\n</code></pre>\n\n<p>But since Haskell's type classes are open, anything can become a <code>Player</code>, which is not how it's supposed to work (unless, of course, that is your intention).</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1478114316, "post_id": 40387974, "comment_id": 68027744, "body": "A sum type is a nice solution, but implemented in this way it has the disadvantage of making things like <code>health</code> and <code>pickupType</code> partial. Factoring it differently with an additional layer of constructors would be a little more cumbersome, but safer."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1478114408, "post_id": 40387974, "comment_id": 68027791, "body": "Also, factoring out the <code>Entity</code>-specific fields has the additional bonus of way less code duplication when adding an additional <code>Entity</code> type."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1478114041, "creation_date": 1478114041, "answer_id": 40387974, "question_id": 40387586, "link": "https://stackoverflow.com/questions/40387586/abstract-records-or-record-interfaces/40387974#40387974", "title": "Abstract records or record interfaces?", "body": "<p>You could just use a sum (aka \"union\") type.</p>\n\n<pre><code>data Entity =\n   Player {\n      location :: Vector,\n      -- etc.\n      health :: Int }\n   | Pickup {\n      location :: Vector,\n      -- etc.\n      pickupType :: PickupType}\n</code></pre>\n\n<p>You can factor this out by just having the sum type hold the data that varies.</p>\n\n<p>This has the advantage that you can have a [Entity], which is something you can't do when all the different variations of Entity are different types (unlike OO languages).</p>\n\n<p>Depending on your game model you might also want to separate the location and velocity data from the rest of the player information. Could that data be better held in some kind of spatial data structure like a quadtree? That way you can keep the constant data separate from the stuff that changes with every frame.</p>\n\n<p>One thing you ought to look at are <a href=\"https://hackage.haskell.org/package/lens-tutorial-1.0.1/docs/Control-Lens-Tutorial.html\" rel=\"nofollow noreferrer\">lenses</a>, which exist to solve the problem you describe with lots of getters and setters.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 0, "last_activity_date": 1494699224, "last_edit_date": 1495540964, "creation_date": 1478115476, "answer_id": 40388357, "question_id": 40387586, "link": "https://stackoverflow.com/questions/40387586/abstract-records-or-record-interfaces/40388357#40388357", "title": "Abstract records or record interfaces?", "body": "<p>This is more of a long comment than an answer, as the core of what I was going to write is covered well enough by <a href=\"https://stackoverflow.com/a/40387860/2751851\">ThreeFx's answer</a>.</p>\n\n<p>Firstly, avoid using OOP jargon, as it will lead to confusion. In your attempt #1, <code>Entity</code> is a data type, not a class, and it is not abstract either. The relationship between <code>Player</code> and <code>Entity</code> in attempt #1 is merely one of composition: a <code>Player</code> has an <code>Entity</code>, and it is not in any way an instance of <code>Entity</code>.</p>\n\n<p>Secondly, record update syntax <em>is</em> quite ugly in Haskell. That doesn't make it complicated, just a little cumbersome. So when you say e.g. \"Hard to get or set Entity-implemented fields of an instance\", it is not actually hard, just not too pretty. That is not a serious enough concern to determine the design of your data types.</p>\n\n<p>Thirdly, lenses are a way of (among many other things) avoiding the ugliness of the record update syntax. You probably won't want to dive into that right now (wait at least until you have finished your assignment), but I can't resist leaving a link to a highly relevant tutorial for you to read at some point in the future: <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow noreferrer\"><em>Program imperatively using Haskell lenses</em></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 2, "last_activity_date": 1478144430, "last_edit_date": 1478144430, "creation_date": 1478144084, "answer_id": 40393433, "question_id": 40387586, "link": "https://stackoverflow.com/questions/40387586/abstract-records-or-record-interfaces/40393433#40393433", "title": "Abstract records or record interfaces?", "body": "<p>I would say that your first attempt is the way to go, for the same reasons as given in @ThreeFx's answer. I'm going to suggest a slightly different alternative though.</p>\n\n<p>Given these types:</p>\n\n<pre><code>data Player = Player {\n    playerEntity :: Entity,\n    health       :: Int\n}\n\ndata Pickup = Pickup {\n    pickupEntity :: Entity,\n    pickupType   :: PickupType\n}\n</code></pre>\n\n<p>Instead of having a separate type class for each action that can be done on an <code>Entity</code>, we can provide generic higher-order functions to make it easier to perform <code>Entity</code> actions on <code>Player</code>s and <code>Pickup</code>s:</p>\n\n<pre><code>overPlayerEntity :: (Entity -&gt; Entity) -&gt; Player -&gt; Player\noverPlayerEntity fn (Player pe h) = Player (fn pe) h\n\noverPickupEntity :: (Entity -&gt; Entity) -&gt; Pickup -&gt; Pickup\noverPickupEntity fn (Pickup pe t) = Pickup (fn pe) t\n</code></pre>\n\n<p>Now, we can have</p>\n\n<pre><code>movePlayer = overPlayerEntity move\nmovePickup = overPickupEntity move\n</code></pre>\n\n<p>We can also wrap this up into a type class to make it easier to write generic code as well:</p>\n\n<pre><code>class HasEntity a where\n  overEntity :: (Entity -&gt; Entity) -&gt; a -&gt; a\n\ninstance HasEntity Player where overEntity = overPlayerEntity\ninstance HasEntity Pickup where overEntity = overPickupEntity\n</code></pre>\n\n<p>This allows things like:</p>\n\n<pre><code>move' :: HasEntity a =&gt; a -&gt; a\nmove' = overEntity move\n</code></pre>\n\n<p>which works with both <code>Player</code>s and <code>Pickup</code>s. This eliminates the need for a specialized version of functions like <code>move</code> and at the same time we only need to write the <code>Entity</code> access boilerplate once.</p>\n\n<p>Incidentally, this <code>over...Entity</code> way of doing things is approaching the \"lens\" technique mentioned at the end of @duplode's and @Paul Johnson's answers. These are essentially two (very) specialized lenses. If we add in the <code>HasEntity</code> type class it gives us what might be called a \"classy lens\" (this is sort of the terminology used in the <code>lens</code> library). You don't really need to worry about what the general lens concept means or entails, but this could give you an entry point to learn about lenses in the future.</p>\n"}], "owner": {"reputation": 237, "user_id": 6901555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f21f290d1767035d21e77b74b09c52?s=128&d=identicon&r=PG&f=1", "display_name": "SmileyCraft", "link": "https://stackoverflow.com/users/6901555/smileycraft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 40387860, "answer_count": 4, "score": 2, "last_activity_date": 1494699224, "creation_date": 1478112551, "last_edit_date": 1481027854, "question_id": 40387586, "link": "https://stackoverflow.com/questions/40387586/abstract-records-or-record-interfaces", "title": "Abstract records or record interfaces?", "body": "<p>I'm using Haskell to make a game, (this is an assignment, so don't judge me) but I'm facing a problem regarding data types.</p>\n\n<p>So what I want is a data type Entity which has a location, velocity, angle and a rotation speed. A record works very well for this idea:</p>\n\n<pre><code>data Entity = Entity {\n    location :: Vector,\n    velocity :: Vector,\n    angle    :: Float,\n    rotation :: Float\n}\n</code></pre>\n\n<p>Now I want instances of Entity, namely Player Rock Pickup and Bullet. But Players Rocks and Bullets must have an extra field, namely health :: Int, and Pickup must have another extra field, namely pickupType :: PickupType.</p>\n\n<p>But I have certain methods which I want to work on any Entity type. For example:</p>\n\n<pre><code>move :: Entity -&gt; Entity\nmove e@(Entity {location, velocity, angle, rotation}) = e {location = location + velocity, angle = angle + rotation}\n</code></pre>\n\n<p>I have no idea how to do this or if this is even possible. I wouldn't understand why if it isn't possible, since this is definitely possible in other languages.</p>\n\n<p>Some attempts and why they aren't quite what I desire:</p>\n\n<p>Attempt 1:</p>\n\n<pre><code>type Player = Player {\n    e      :: Entity,\n    health :: Int\n}\n</code></pre>\n\n<p>This works, but it is really ugly. This, for example, is how you would move a Player:</p>\n\n<pre><code>movePlayer :: Player -&gt; Player\nmovePlayer p@(e) = p {e = move e}\n</code></pre>\n\n<p>Which is just really ugly.</p>\n\n<p>Positives:\nEasy to create the abstract class. \nEasy to create instances. \nEasy abstract methods. </p>\n\n<p>Negatives:\nHard to get or set Entity-implemented fields of an instance. </p>\n\n<p>Attempt 2:</p>\n\n<pre><code>class Entity e where\n    getLocation :: e -&gt; Vector\n    getVelocity :: e -&gt; Vector\n    ...\n    setLocation :: Vector -&gt; e -&gt; e\n    setVelocity :: Vector -&gt; e -&gt; e\n    ...\n\ndata Player = Player {\n    playerLocation :: Vector,\n    playerVelocity :: Vector,\n    ...\n    playerHealth   :: Int\n}\n\ninstance Entity Player where\n    getLocation = location\n    getVelocity = velocity\n    ...\n    setLocation l e = e {location = l}\n    setVelocity v e = e {playerVelocity = v}\n    ...\n\nmove :: (Entity e) =&gt; e -&gt; e\nmove e = (setLocation (getLocation e + getVelocity e) . setAngle (getAngle e + getRotation e)) e\n</code></pre>\n\n<p>Well it works, but I hope we can all agree that their definitions are now really ugly. The abstract methods which work on any Entity also becomes way ugly. The only good thing is that methods like movePlayer become really easy.</p>\n\n<pre><code>movePlayer :: Player -&gt; Player\nmovePlayer = move\n</code></pre>\n\n<p>I don't even need to define movePlayer anymore, since I can just use move.</p>\n\n<p>Positives:\nEasy to get or set Entity-implemented fields of an instance. </p>\n\n<p>Negatives:\nHard to create the abstract class. \nEven harder to create instances. \nHard abstract methods. </p>\n\n<p>Attempt 3:</p>\n\n<p>Give Entity all fields that any instance needs.</p>\n\n<pre><code>data Entity = Entity {\n    location   :: Vector,\n    velocity   :: Vector,\n    angle      :: Float,\n    rotation   :: Float,\n    health     :: Int,\n    pickupType :: PickupType\n}\n</code></pre>\n\n<p>This way I don't even need to define instances and I can just use Entity. The only problem is that you have a lot of excess data. This is currently what I use and IMO the best solution for my problem, but I still don't like it.</p>\n\n<p>Positives:\nEasy to create the abstract class, even though it isn't really abstract anymore. \nNo need to define instances. \nEasy abstract methods. \nEasy to get or set Entity-implemented fields of an instance. </p>\n\n<p>Negatives:\nA lot of unused data. \nYou have to define a lot of nonsense fields every time you create an Entity. </p>\n\n<p>So please help me, I can't find any better methods than these three :(</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1478106748, "post_id": 40385728, "comment_id": 68023467, "body": "try setting things up in a cabal sandbox instead, this lets you have different versions of libraries installed on a per-project basis, saving you from the horrors of cabal hell, as it&#39;s affectionately known (FYI: this shows up in pretty much every language, it&#39;s not just a haskell problem)"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1478107171, "post_id": 40385728, "comment_id": 68023742, "body": "I will research into cabal sand box. so this is pretty normal for cabal ?"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1478107380, "post_id": 40385728, "comment_id": 68023855, "body": "@bheklilr the only package that I can import is the base package. I thought may be this can help you help me !"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1478107384, "post_id": 40385728, "comment_id": 68023857, "body": "yeah, basically what&#39;s happened is you&#39;ve gotten yourself into a place where the libraries you have installed have conflicting dependencies. Since there are conflicts, things break. These days everyone uses either cabal sandboxes or stack to mitigate this problem. Again, every language from python to C# to Haskell has this problem at some point, and all have introduced a similar solution of sandboxing, virtual environments, or whatever."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1478107444, "post_id": 40385728, "comment_id": 68023894, "body": "after you initialize a sandbox you need to install packages into it. By default it comes with only the standard library called base. Just cabal install mtl"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1478107514, "post_id": 40385728, "comment_id": 68023920, "body": "and what is this error ? &quot;Failed to load interface for \u2018Control.Monad.State\u2019&quot;"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1478108127, "post_id": 40385728, "comment_id": 68024267, "body": "@bheklilr and 2 more questions. shouldn&#39;t running ghc-pkg check show if there is problem? out of curosity how can I make sure that cabal is not working as it should. and second which one is better cabal-sandboxing or stack?"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 264, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1478224974, "creation_date": 1478106387, "last_edit_date": 1478224974, "question_id": 40385728, "link": "https://stackoverflow.com/questions/40385728/ghc-package-cannot-be-found", "title": "GHC package cannot be found", "body": "<p>I have a <code>.hs</code> file which imports the following module</p>\n\n<pre><code>import Control.Monad.State\n</code></pre>\n\n<p>this module is located in <code>mtl</code> package.</p>\n\n<p>but the compiler cannot find this module or any other modules in the <code>mtl</code> package. I did check available packages using <code>ghc-pkg list</code> and I see it is already installed and exposed. it is shown in the following database:</p>\n\n<pre><code>/Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/lib/ghc-8.0.1/package.conf.d\n</code></pre>\n\n<p>I did try reinstalling but it warns that other packages will be broken.</p>\n\n<p>I also tried <code>ghc-pkg recache</code> but it didn't help.</p>\n\n<p>It seems that I cannot import any modules from any packages from <code>ghci</code>. I am running OS X El Capitan. </p>\n"}, {"tags": ["multithreading", "haskell", "parallel-processing", "garbage-collection"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1478111248, "post_id": 40384843, "comment_id": 68026151, "body": "Can you post some code that exhibits the issue? I&#39;m having trouble even understanding what you mean in the first paragraph re. &quot;compute timing information&quot;"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1478116181, "post_id": 40384843, "comment_id": 68028802, "body": "And you compiled with <code>-threaded</code> and are running with <code>-N</code>? An actual executable program that exhibits the issue is what I was hoping for"}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1478117307, "post_id": 40384843, "comment_id": 68029406, "body": "Yes. In fact, the <code>-N</code> parameter is the only thing I&#39;m changing. I can&#39;t provide the actual code. I&#39;ll see if I can get build an MWE, but I&#39;m not hopeful."}], "answers": [{"tags": [], "owner": {"reputation": 448, "user_id": 4416280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c4e7c5ba681838526fb520fc8f36dec?s=128&d=identicon&r=PG&f=1", "display_name": "Zemyla", "link": "https://stackoverflow.com/users/4416280/zemyla"}, "is_accepted": false, "score": 3, "last_activity_date": 1488684531, "creation_date": 1488684531, "answer_id": 42604183, "question_id": 40384843, "link": "https://stackoverflow.com/questions/40384843/how-to-avoid-performance-degradation-in-long-running-parallel-and-concurrent-has/42604183#42604183", "title": "How to avoid performance degradation in long running parallel and concurrent Haskell computations", "body": "<p>Since the tasks are all independent, and you're on an AWS instance (which is probably Linux), you'll probably have better results using <a href=\"http://hackage.haskell.org/package/unix-2.4.2.0/docs/System-Posix-Process.html\" rel=\"nofollow noreferrer\"><code>forkProcess</code></a>. This way, each process will have its own GC pool, which will get freed up when the process exits, and the parent doesn't have to worry about holding more than the process IDs for the children and waiting for them to die.</p>\n"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1488684531, "creation_date": 1478103645, "last_edit_date": 1478111877, "question_id": 40384843, "link": "https://stackoverflow.com/questions/40384843/how-to-avoid-performance-degradation-in-long-running-parallel-and-concurrent-has", "title": "How to avoid performance degradation in long running parallel and concurrent Haskell computations", "body": "<p>I have an AWS instance. I would like to run a bunch of tasks, some memory and cpu intensive. Ideally, I would like to compute timing information on each task. If I run them in serial, it computes accurate timing information, but it's slow. If I run them in parallel, the whole thing is faster, but individual tasks are slower, as reported by both wall time and thread CPU time.</p>\n\n<p>This slowdown increases as the number of threads increases up to the number of CPUs</p>\n\n<p>Cursory examination with <code>ghc-events-analyze</code> and <code>+RTS -s</code> suggests that the source of the slowdown is (unsurprisingly) GC pauses. Playing with RTS options reveals that <code>+RTS -qg -qb -qa -A256m</code> (disabling parallel GC, disabling load balancing GC, disabling thread migration, and increasing the GC allocation area) improves this, but does not completely eliminate it.</p>\n\n<p>I am running threads using <code>forkIO</code>, but the threads are independent and pure apart from printing progress information. I'm using <a href=\"https://hackage.haskell.org/package/parallel-io\" rel=\"nofollow noreferrer\">parallel-io</a> to manage the number of running threads, but when I briefly tried a more conventional approach of having a fixed pool of threads and a task queue, I still had this problem.</p>\n\n<p>Any suggestions for how to debug?</p>\n\n<p>EDIT:</p>\n\n<p>@jberryman asked for an example. Each of the tasks looks like the below code</p>\n\n<pre><code>computation params = do\n  !x &lt;- force params\n  print $ \"Starting computation on \" ++ show params\n  t1 &lt;- getCPUTime\n  !y &lt;- fmap force $ do $\n    ...some work with x ...\n  t2 &lt;- getCPUTime\n  print $ \"Finished computation on \" ++ show params\n  return (t2 - t1, y)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1478101981, "post_id": 40384257, "comment_id": 68020476, "body": "Great thanks. I did not know about such syntax"}], "tags": [], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "is_accepted": true, "score": 4, "last_activity_date": 1478101926, "creation_date": 1478101926, "answer_id": 40384257, "question_id": 40384173, "link": "https://stackoverflow.com/questions/40384173/usage-of-weird-symbol-in-haskell-code/40384257#40384257", "title": "Usage of weird symbol in haskell code", "body": "<p><code>:&lt;:</code> is a data constructor, like <code>Just</code>. The only difference is that it is infix because it is symbolic. Infix data constructors must start with a <code>:</code>.</p>\n\n<p>You could rewrite the above as:</p>\n\n<pre><code>data Nested a = Nest a (Nested [a]) | Epsilon\n\nmylength Epsilon    = 0\nmylength (Nest _ xs) = 1 + mylength xs\n</code></pre>\n"}], "owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "closed_date": 1478102030, "accepted_answer_id": 40384257, "answer_count": 1, "score": 0, "last_activity_date": 1478101926, "creation_date": 1478101720, "question_id": 40384173, "link": "https://stackoverflow.com/questions/40384173/usage-of-weird-symbol-in-haskell-code", "closed_reason": "Duplicate", "title": "Usage of weird symbol in haskell code", "body": "<p>I came across on following code:</p>\n\n<pre><code>data Nested a = a :&lt;: (Nested [a]) | Epsilon\n\nmylength Epsilon    = 0\nmylength (_ :&lt;: xs) = 1 + mylength xs\n</code></pre>\n\n<p>What does <code>a :&lt;: (Nested [a])</code> mean? I don't understand such code (especially <code>:&lt;:</code>)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1478082592, "post_id": 40377585, "comment_id": 68007338, "body": "Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) <b>must include</b> the desired behavior, a specific problem or error <b>and the shortest code necessary to reproduce it in the question itself.</b> Questions without a clear problem statement are not useful to other readers. See: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1478087392, "post_id": 40377585, "comment_id": 68010305, "body": "You <i>should</i> be getting a &quot;Not in scope&quot; error for the undefined type <code>TTT</code>."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1478087340, "post_id": 40379002, "comment_id": 68010279, "body": "<code>f</code> is just <code>fmap</code>, so you may as well define a <code>Functor</code> instance for <code>Tree</code>."}, {"owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1478087697, "post_id": 40379002, "comment_id": 68010495, "body": "Yes, but that was not the purpose of the question. I put this example because it matches with the signature given by @RobertK."}], "tags": [], "owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "is_accepted": true, "score": 1, "last_activity_date": 1478086650, "creation_date": 1478086650, "answer_id": 40379002, "question_id": 40377585, "link": "https://stackoverflow.com/questions/40377585/how-to-declare-function-for-data-type-that-can-hold-single-or-list-values/40379002#40379002", "title": "How to declare function for data type that can hold single or list values?", "body": "<p>Data type should be:</p>\n\n<pre><code>data Test aa = Leaf [aa] | Treenode (Test aa) (Test aa) | Empty deriving Show\n</code></pre>\n\n<p>Then, for example, you could create a <code>map</code> function with your trees:</p>\n\n<pre><code>f :: (aa -&gt; aa) -&gt; Test aa -&gt; Test aa\nf _ Empty = Empty\nf g (Leaf xs) = Leaf $ map g xs\nf g (Treenode x y) = Treenode (f g x) (f g y)\n\nPrelude&gt; f (1+) (Treenode (Leaf [1,2]) (Leaf [3,4]))\nTreenode (Leaf [2,3]) (Leaf [4,5])\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 4801003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbbf20562e0820554a9229388784541d?s=128&d=identicon&r=PG&f=1", "display_name": "RobertK", "link": "https://stackoverflow.com/users/4801003/robertk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "closed_date": 1479202285, "accepted_answer_id": 40379002, "answer_count": 1, "score": -1, "last_activity_date": 1478086650, "creation_date": 1478082358, "question_id": 40377585, "link": "https://stackoverflow.com/questions/40377585/how-to-declare-function-for-data-type-that-can-hold-single-or-list-values", "closed_reason": "Not suitable for this site", "title": "How to declare function for data type that can hold single or list values?", "body": "<p>I am trying to make a tree where each node can have 0 - 2 children and leaves contain lists:<br>\n<code>data Test aa = Leaf [aa] | Treenode (TTT aa) (TTT aa) | Empty deriving Show</code><br>\nFor example if <code>aa</code> would be <code>Int</code> then leaves would hold <code>[Int]</code>.</p>\n\n<p>How do I write a function definition that accepts this type of data? I tried:<br>\n<code>f :: (aa -&gt; aa) -&gt; Test aa -&gt; Test aa</code><br>\nThis gives error: <code>Couldn't match expected type 'aa' with actual type '[aa]'</code> because <code>Leaf [aa]</code> is a list not a single value.   </p>\n\n<p>I thought it would't be a problem because function receives argument of type <code>Test</code> and the list <code>[aa]</code> is the content of the argument <code>Test</code> and not the argument itself, if that makes sense.</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 10, "creation_date": 1478082013, "post_id": 40376996, "comment_id": 68006987, "body": "The notation <code>Num -&gt; Integral -&gt; Num</code> is source of great confusion for newcomers who do not yet understand typeclasses. I&#39;d avoid it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1478109313, "post_id": 40376996, "comment_id": 68024944, "body": "GHC defaults to <code>Integer</code> for unspecified <code>Num</code> types that are not constrained to be <code>Fractional</code>. That seems to be an important part of the answer."}], "tags": [], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "is_accepted": true, "score": 13, "last_activity_date": 1478084735, "last_edit_date": 1478084735, "creation_date": 1478080646, "answer_id": 40376996, "question_id": 40376924, "link": "https://stackoverflow.com/questions/40376924/weird-behavior-of/40376996#40376996", "title": "Weird behavior of (^)", "body": "<blockquote>\n  <p>I couldn't find any difference</p>\n</blockquote>\n\n<p>Yes, there are some differences.</p>\n\n<pre><code>:t exp'\nexp' :: Int -&gt; Int -&gt; Int\n\n:t (^)\n(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>namely</p>\n\n<pre><code>:t (^)\n--                           Num    Integral    Num\n(^) :: (Num a, Integral b) =&gt; a  -&gt;     b    -&gt;  a\n</code></pre>\n\n<p>See? It's about the <em>type</em>.</p>\n\n<p>Simply put, <code>Int</code> is bounded so it can overflow to negative when exceeding allowed range:</p>\n\n<pre><code>&gt; (6::Int) ^ (25::Int)\n</code></pre>\n\n<blockquote>\n  <p>-8463200117489401856</p>\n</blockquote>\n\n<p>while <code>Integer</code> is unbounded, so does not overflow:</p>\n\n<pre><code>&gt; (6::Integer) ^ (25::Integer)\n</code></pre>\n\n<blockquote>\n  <p>28430288029929701376</p>\n</blockquote>\n\n<p>So, to fix it you just change <code>Int</code> to <code>Integer</code>:</p>\n\n<pre><code>exp' :: Integer -&gt; Integer -&gt; Integer\nexp' = (^)\n</code></pre>\n\n<p>You may want to visit <a href=\"https://www.haskell.org/tutorial/numbers.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/tutorial/numbers.html</a> for more details about types and Numbers.</p>\n"}], "owner": {"reputation": 33, "user_id": 7103359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9234f73060809dc0002e91e056764d0b?s=128&d=identicon&r=PG&f=1", "display_name": "nontando", "link": "https://stackoverflow.com/users/7103359/nontando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 40376996, "answer_count": 1, "score": 3, "last_activity_date": 1478084735, "creation_date": 1478080412, "last_edit_date": 1478082487, "question_id": 40376924, "link": "https://stackoverflow.com/questions/40376924/weird-behavior-of", "title": "Weird behavior of (^)", "body": "<p>I'm working on a puzzle solving game in which an exponent function is required, so I define</p>\n\n<pre><code>exp' :: Int -&gt; Int -&gt; Int\nexp' = (^)\n</code></pre>\n\n<p>Here happens the weird:</p>\n\n<pre><code>*Main&gt; exp' 6 25\n</code></pre>\n\n<blockquote>\n  <p>-8463200117489401856</p>\n</blockquote>\n\n<p>But</p>\n\n<pre><code>*Main&gt; 6^25\n</code></pre>\n\n<blockquote>\n  <p>28430288029929701376</p>\n</blockquote>\n\n<p>I couldn't find any difference between my <code>exp'</code> and <code>(^)</code> from <code>ghci</code>.</p>\n\n<p>Is is a <code>ghc</code> bug?</p>\n\n<blockquote>\n  <p>The Glorious Glasgow Haskell Compilation System, version 8.0.1</p>\n</blockquote>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 2, "creation_date": 1478109426, "post_id": 40376039, "comment_id": 68025039, "body": "Might also be useful for someone: <code>stack dot --external</code>. Thanks <a href=\"https://twitter.com/snoyberg/status/793870778672541696\" rel=\"nofollow noreferrer\">twitter.com/snoyberg/status/793870778672541696</a>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1506060835, "post_id": 40376039, "comment_id": 79675607, "body": "Useful answer (upvoted), but by default it only lists the dependencies of the &#39;production&#39; code. If you wish to see dependencies of your test code, you can use <code>stack list-dependencies --test</code>."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "edited": false, "score": 2, "creation_date": 1535592364, "post_id": 40376039, "comment_id": 91126327, "body": "For future visitors, <code>stack list-dependencies</code> is being deprecated in favour of <code>stack ls dependencies</code>."}], "tags": [], "owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "is_accepted": true, "score": 31, "last_activity_date": 1573928510, "last_edit_date": 1573928510, "creation_date": 1478077632, "answer_id": 40376039, "question_id": 40375428, "link": "https://stackoverflow.com/questions/40375428/how-do-i-check-what-version-of-a-package-is-installed-with-stack/40376039#40376039", "title": "How do I check what version of a package is installed with stack?", "body": "<p>The command</p>\n\n<pre><code>stack ls dependencies\n</code></pre>\n\n<p>or for older version of stack:</p>\n\n<pre><code>stack list-dependencies\n</code></pre>\n\n<p>will list every dependency installed for the current project, along with its version.</p>\n"}, {"tags": [], "owner": {"reputation": 4762, "user_id": 4881398, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mcves.png?s=128&g=1", "display_name": "argo", "link": "https://stackoverflow.com/users/4881398/argo"}, "is_accepted": false, "score": 11, "last_activity_date": 1537514664, "creation_date": 1537514664, "answer_id": 52438637, "question_id": 40375428, "link": "https://stackoverflow.com/questions/40375428/how-do-i-check-what-version-of-a-package-is-installed-with-stack/52438637#52438637", "title": "How do I check what version of a package is installed with stack?", "body": "<p>The  new  command  is going to be </p>\n\n<pre><code>stack ls dependencies\n</code></pre>\n\n<p>which is replacement of <code>stack list-dependencies</code></p>\n\n<p>You can read more about it <a href=\"https://github.com/seek-oss/serverless-haskell/issues/38\" rel=\"noreferrer\">here</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5663, "favorite_count": 4, "accepted_answer_id": 40376039, "answer_count": 2, "score": 27, "last_activity_date": 1573928510, "creation_date": 1478075570, "last_edit_date": 1478075870, "question_id": 40375428, "link": "https://stackoverflow.com/questions/40375428/how-do-i-check-what-version-of-a-package-is-installed-with-stack", "title": "How do I check what version of a package is installed with stack?", "body": "<p>Within my project's .cabal file I've got the following under the <code>executable</code> section:</p>\n\n<pre><code>executable ArchPkgstatsScraper\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                       , ArchPkgStatsScraper\n                       , text\n                       , conduit\n                       , html-conduit\n                       , http-conduit\n                       , xml-conduit\n                       , resourcet\n                       , transformers\n</code></pre>\n\n<p>After I've successfully installed / built the above with stack, how could I check which version of xml-conduit is installed? </p>\n"}, {"tags": ["haskell", "types", "syntax", "arguments", "type-signature"], "answers": [{"tags": [], "owner": {"reputation": 538, "user_id": 4348568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/205118bc91e0ad54a10b05d0188ce2cb?s=128&d=identicon&r=PG&f=1", "display_name": "user31708", "link": "https://stackoverflow.com/users/4348568/user31708"}, "is_accepted": true, "score": 5, "last_activity_date": 1478087325, "last_edit_date": 1478087325, "creation_date": 1478071362, "answer_id": 40374406, "question_id": 40373808, "link": "https://stackoverflow.com/questions/40373808/number-of-arguments-in-haskell-code-and-type-is-different-why/40374406#40374406", "title": "Number of arguments in Haskell code and type is different, why?", "body": "<p><code>+</code> is the addition operator.  Putting an operator in parentheses, like <code>(+)</code>, refers to the addition function itself, as opposed to using <code>+</code> to add two numbers right on the spot.  Basically, this:</p>\n\n<pre><code>plus = (+)\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>plus a b = a + b\n</code></pre>\n\n<p>Either way, it is defining <code>plus</code> to be a synonym for <code>+</code>.</p>\n\n<p>In Haskell, <code>-&gt;</code> is used to separate the types of the arguments, <em>as well as the return value</em>.  So,</p>\n\n<pre><code>plus :: Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>is a function which takes two <code>Int</code>s and returns an <code>Int</code>.</p>\n\n<pre><code>plusPlus :: Int -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>is a function which takes three <code>Int</code>s and returns an <code>Int</code>.</p>\n\n<p>The reason why the syntax is the same for the arguments and the return value is due to <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">currying</a>.</p>\n\n<p>To be really pedantic,</p>\n\n<pre><code>plus :: Int -&gt; Int -&gt; Int                -- ~  Int -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>is a function which takes an <code>Int</code>, and returns a function which takes an <code>Int</code> and returns an <code>Int</code>.</p>\n\n<pre><code>plusPlus :: Int -&gt; Int -&gt; Int -&gt; Int     -- ~  Int -&gt; (Int -&gt; (Int -&gt; Int))\n</code></pre>\n\n<p>is a function which takes an <code>Int</code>, and returns a function which takes an <code>Int</code>, and returns a function which takes an <code>Int</code> and returns an <code>Int</code>.</p>\n\n<p>In practice, it's convenient to speak of Haskell functions as taking multiple arguments.  But technically, Haskell functions always take one argument.  The argument type is on the left side of <code>-&gt;</code>, and the return type is on the right side of <code>-&gt;</code>, but the return type might itself be another function.</p>\n"}], "owner": {"reputation": 3063, "user_id": 3040893, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/JaV1X.jpg?s=128&g=1", "display_name": "smoothumut", "link": "https://stackoverflow.com/users/3040893/smoothumut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 40374406, "answer_count": 1, "score": 0, "last_activity_date": 1478087325, "creation_date": 1478068657, "last_edit_date": 1478087086, "question_id": 40373808, "link": "https://stackoverflow.com/questions/40373808/number-of-arguments-in-haskell-code-and-type-is-different-why", "title": "Number of arguments in Haskell code and type is different, why?", "body": "<p>Can anybody explain the code below, what it does step by step, please. I know it is defining a function and its inputs, but what does <code>(+)</code> do, and why are there three <code>Int</code>s in <code>plus</code> and <em>four</em> <code>Int</code>s in <code>plusplus</code>'s type, while it seems like there are <em>only 3 arguments</em> in <code>plusplus</code>'s code?</p>\n\n<pre><code> plus :: Int -&gt; Int -&gt; Int \n plus = (+)\n\n plusPlus :: Int -&gt; Int -&gt; Int -&gt; Int\n plusPlus a b c = a + b + c\n</code></pre>\n"}, {"tags": ["haskell", "exception-handling", "resources", "monad-transformers", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1478145588, "post_id": 40374512, "comment_id": 68038429, "body": "Excellent response! So it seems there isn&#39;t really a &quot;standard&quot; way to solve this problem? It makes sense that monad-control has edge cases in this situation since, according to Kmett, it probably can&#39;t have a sound implementation for these stacks anyway."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1484820848, "post_id": 40374512, "comment_id": 70671283, "body": "Is there difference between <code>ExceptT err (ResourceT IO) r</code> and <code>ResourceT (ExceptT err IO) r</code>. AFAICS the <code>ResourceT</code> is simply a reader, so it should commute; but are there some other implications?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1484856425, "post_id": 40374512, "comment_id": 70693906, "body": "@phadej I believe both orders would work, but I feel that <code>ExceptT err (ResourceT IO) r</code> is more natural."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 7, "last_activity_date": 1478123691, "last_edit_date": 1478123691, "creation_date": 1478071819, "answer_id": 40374512, "question_id": 40372087, "link": "https://stackoverflow.com/questions/40372087/what-is-the-best-way-to-manage-resources-in-a-monad-stack-like-exceptt-a-io/40374512#40374512", "title": "What is the best way to manage resources in a monad stack like ExceptT a IO?", "body": "<p>You could work in <code>IO</code>, return a value of type <code>IO (Either ServantErr r)</code> at the end and wrap it in <code>ExceptT</code> to make it fit the handler type. This would let you use <code>bracket</code> normally in <code>IO</code>. One problem with this approach is that you lose the \"automatic error management\" that <code>ExceptT</code> provides. That is, if you fail in the middle of the handler you'll have to perform an explicit pattern match on the <code>Either</code> and things like that.</p>\n\n<hr>\n\n<p>The above is basically reimplementing the <code>MonadTransControl</code> instance for <code>ExceptT</code>, which is</p>\n\n<pre><code>instance MonadTransControl (ExceptT e) where\n    type StT (ExceptT e) a = Either e a\n    liftWith f = ExceptT $ liftM return $ f $ runExceptT\n    restoreT = ExceptT\n</code></pre>\n\n<p><em>monad-control</em> works fine when lifting functions like <code>bracket</code>, but it has odd corner cases with functions like the following (taken from <a href=\"http://blog.ezyang.com/2012/01/monadbasecontrol-is-unsound/\" rel=\"nofollow noreferrer\">this blog post</a>):</p>\n\n<pre><code>import Control.Monad.Trans.Control\n\ncallTwice :: IO a -&gt; IO a\ncallTwice action = action &gt;&gt; action\n\ncallTwice' :: ExceptT () IO () -&gt; ExceptT () IO ()\ncallTwice' = liftBaseOp_ callTwice\n</code></pre>\n\n<p>If we pass to <code>callTwice'</code> an action that prints something and fails immediately after</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let printAndFail = lift (putStrLn \"foo\") &gt;&gt; throwE ()\n    runExceptT (callTwice' printAndFail) &gt;&gt;= print  \n</code></pre>\n\n<p>It prints \"foo\" two times anyway, even if our intuition says that it should stop after the first execution of the action fails.</p>\n\n<hr>\n\n<p>An alternative approach is to use the <a href=\"https://hackage.haskell.org/package/resourcet\" rel=\"nofollow noreferrer\"><code>resourcet</code></a> library and work in a  <code>ExceptT ServantErr (ResourceT IO) r</code> monad. You would need to use <code>resourcet</code> functions like <a href=\"https://hackage.haskell.org/package/resourcet-1.1.8/docs/Control-Monad-Trans-Resource.html#v:allocate\" rel=\"nofollow noreferrer\"><code>allocate</code></a> instead of <code>bracket</code>, and adapt the monad at the end like:</p>\n\n<pre><code>import Control.Monad.Trans.Resource\nimport Control.Monad.Trans.Except\n\nadapt :: ExceptT ServantErr (ResourceT IO) r -&gt; ExceptT err IO r \nadapt = ExceptT . runResourceT . runExceptT\n</code></pre>\n\n<p>or like:</p>\n\n<pre><code>import Control.Monad.Morph\n\nadapt' :: ExceptT err (ResourceT IO) r -&gt; ExceptT err IO r \nadapt' = hoist runResourceT\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1478790096, "post_id": 40519550, "comment_id": 68301282, "body": "After much pondering and research I must confess I&#39;m coming to this conclusion, which seems like a cop-out in some ways, but the most clear-cut and pain-free solution."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 2, "creation_date": 1478790401, "post_id": 40519550, "comment_id": 68301526, "body": "Just because it&#39;s easier doesn&#39;t mean it&#39;s wrong. I really think people are making this whole problem more complicated than it needs to be, for nebulous benefits."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 3, "last_activity_date": 1478748764, "creation_date": 1478748764, "answer_id": 40519550, "question_id": 40372087, "link": "https://stackoverflow.com/questions/40372087/what-is-the-best-way-to-manage-resources-in-a-monad-stack-like-exceptt-a-io/40519550#40519550", "title": "What is the best way to manage resources in a monad stack like ExceptT a IO?", "body": "<p>My recommendation: have your code live in IO instead of ExceptT, and wrap each handler function in a <code>ExceptT . try</code>.</p>\n"}], "owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 6, "accepted_answer_id": 40374512, "answer_count": 2, "score": 15, "last_activity_date": 1479915265, "creation_date": 1478057745, "last_edit_date": 1479915265, "question_id": 40372087, "link": "https://stackoverflow.com/questions/40372087/what-is-the-best-way-to-manage-resources-in-a-monad-stack-like-exceptt-a-io", "title": "What is the best way to manage resources in a monad stack like ExceptT a IO?", "body": "<p>For better or for worse, Haskell's popular <a href=\"http://haskell-servant.readthedocs.io/\" rel=\"nofollow noreferrer\">Servant</a> library has made it common-place to run code in a monad transformer stack involving <code>ExceptT err IO</code>. Servant's own handler monad is <code>ExceptT ServantErr IO</code>. As many argue, this is a somewhat <a href=\"https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell\" rel=\"nofollow noreferrer\">troublesome monad</a> to work in since there are <em>multiple ways for failure to unroll</em>: 1) via normal exceptions from <code>IO</code> at the base, or 2) by returning <code>Left</code>.</p>\n\n<p>As Ed Kmett's <a href=\"https://hackage.haskell.org/package/exceptions\" rel=\"nofollow noreferrer\"><code>exceptions</code></a> library <a href=\"https://hackage.haskell.org/package/exceptions-0.8.3/docs/Control-Monad-Catch.html#t:MonadMask\" rel=\"nofollow noreferrer\">helpfully clarifies</a>:</p>\n\n<blockquote>\n  <p>Continuation-based monads, and stacks such as <code>ErrorT e IO</code> which provide for multiple failure modes, are invalid instances of this [<code>MonadMask</code>] class.</p>\n</blockquote>\n\n<p>This is very inconvenient since <code>MonadMask</code> gives us access the helpful [polymorphic version of] <code>bracket</code> function for doing resource management (not leaking resources due to an exception, etc.). But in Servant's <code>Handler</code> monad we can't use it.</p>\n\n<p>I'm not very familiar with it, but some people say that the solution is to use <code>monad-control</code> and it's many partner libraries like <code>lifted-base</code> and <code>lifted-async</code> to give your monad access to resource management tools like <code>bracket</code> (presumably this works for <code>ExceptT err IO</code> and friends as well?).</p>\n\n<p>However, it seems that <code>monad-control</code> is <a href=\"http://www.yesodweb.com/blog/2014/06/exceptions-transformers\" rel=\"nofollow noreferrer\">losing favor in the community</a>, yet I can't tell what the alternative would be. Even Snoyman's recent <code>safe-exceptions</code> library uses Kmett's <code>exceptions</code> library and avoids <code>monad-control</code>.</p>\n\n<p>Can someone clarify the current story for people like me who are trying to plow our way into serious Haskell usage?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40865, "user_id": 10431, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/22aac6106c44ae4078bd4c0a564714e0?s=128&d=identicon&r=PG", "display_name": "Keith Nicholas", "link": "https://stackoverflow.com/users/10431/keith-nicholas"}, "edited": false, "score": 0, "creation_date": 1478054031, "post_id": 40371572, "comment_id": 67996571, "body": "you need to work out what doubleme really is,  you&#39;ve used the word variable....  why?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1478054113, "post_id": 40371572, "comment_id": 67996582, "body": "Are you writing a Haskell program (.hs file) or using ghci? In ghci you need let, in a normal source file you don&#39;t."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1478054248, "post_id": 40371572, "comment_id": 67996607, "body": "Also I can&#39;t tell whether you&#39;re asking &quot;what&#39;s the difference between a variable and a function?&quot; or whether you&#39;re asking &quot;what&#39;s the difference between using &#39;let&#39; and not using &#39;let&#39;?&quot;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478054326, "post_id": 40371572, "comment_id": 67996622, "body": "<code>doubleMe</code> is not a function, as a function must have arguments. See also: <a href=\"http://conal.net/blog/posts/everything-is-a-function-in-haskell\" rel=\"nofollow noreferrer\">conal.net/blog/posts/everything-is-a-function-in-haskell</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1478072039, "post_id": 40371572, "comment_id": 68001847, "body": "@immibis GHC 8 made <code>let</code> optional in GHCi at the top level."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1478086920, "post_id": 40371624, "comment_id": 68009985, "body": "Note the <code>let</code> in a <code>do</code> block is just syntactic sugar for a nested <code>do</code> block: <code>do let foo = ...; ...</code> is the same as <code>do let foo = ... in do ...</code>."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 7, "last_activity_date": 1616871300, "last_edit_date": 1616871300, "creation_date": 1478054312, "answer_id": 40371624, "question_id": 40371572, "link": "https://stackoverflow.com/questions/40371572/let-and-variables-in-haskell/40371624#40371624", "title": "&#39;let&#39; and variables in Haskell", "body": "<p>At the top level of a program, <code>name = expression</code> is a <em>definition</em>. It creates a variable, in the sense of a mathematical variable\u2014just a name for some expression. It can be a definition of a value:</p>\n<pre><code>two :: Int\ntwo = 2\n</code></pre>\n<p>Or a definition of a function:</p>\n<pre><code>twice :: Int -&gt; Int\ntwice x = x * two\n</code></pre>\n<p>A definition refers to a function if its type has a function arrow <code>-&gt;</code>.</p>\n<p>In a <code>do</code> block or GHCi, <code>let name = expression</code> is a <em>local definition</em>.</p>\n<pre><code>main :: IO ()\nmain = do\n  let greet name = &quot;Hello, &quot; ++ name ++ &quot;!&quot;\n  putStrLn (greet &quot;world&quot;)\n</code></pre>\n<p>Finally, there is another use of the <code>let</code> keyword: <code>let name = expression1 in expression2</code>. This creates a variable local to a single expression:</p>\n<pre><code>length (let x = &quot;hello&quot; in x ++ x)  ==  10\n</code></pre>\n<p>Be aware that <code>let</code> takes a <em>block</em> of bindings, so it\u2019s subject to the layout rules like other layout keywords, such as <code>do</code>, <code>where</code>, <code>of</code> as in <code>case</code>\u2026<code>of</code>, and so on:</p>\n<pre><code>main :: IO ()\nmain = do\n\n  -- Bindings must be aligned past the start column.\n  --  \u2193\n  let greeting name = &quot;Hello, &quot; ++ name ++ &quot;!&quot;\n      parting name = &quot;Goodbye, &quot; ++ name ++ &quot;!&quot;\n\n  putStrLn (greeting &quot;world&quot;)\n  putStrLn (parting &quot;world&quot;)\n</code></pre>\n<p>\u00a0</p>\n<pre><code>length $ let x = &quot;hello&quot;\n             y = &quot;goodbye&quot;\n  in x ++ y\n</code></pre>\n<p>As with other layout keywords, can instead put a newline and a fixed amount of indentation after <code>let</code>, and then not worry about alignment:</p>\n<pre><code>main = do              -- \u2190 newline+indent\n  let                  -- \u2190 newline+indent\n    greeting name = \u2026\n    parting name = \u2026\n  \u2026\n</code></pre>\n<p>\u00a0</p>\n<pre><code>length $ let\n  x = &quot;hello&quot;\n  y = &quot;goodbye&quot;\n  in x ++ y\n</code></pre>\n<p>Or you can always include explicit curly braces and semicolons:</p>\n<pre><code>main :: IO ()<strong>;</strong>\nmain = do <strong>{</strong>\n  let <strong>{</strong>\n    greeting name = \"Hello, \" ++ name ++ \"!\"<strong>;</strong>\n    parting name = \"Goodbye, \" ++ name ++ \"!\"<strong>;</strong>\n  <strong>};</strong>\n  putStrLn (greeting \"world\")<strong>;</strong>\n  putStrLn (parting \"world\")<strong>;</strong>\n<strong>};</strong></code></pre>\n<pre><code>length $ let <strong>{</strong>\n    x = \"hello\"<strong>;</strong>\n    y = \"goodbye\"<strong>;</strong>\n  <strong>}</strong> in x ++ y</code></pre>\n"}], "owner": {"reputation": 541, "user_id": 5482796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/002d614b28c51914148c9efa5826cf96?s=128&d=identicon&r=PG&f=1", "display_name": "yomin", "link": "https://stackoverflow.com/users/5482796/yomin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2643, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1616871300, "creation_date": 1478053824, "last_edit_date": 1478065782, "question_id": 40371572, "link": "https://stackoverflow.com/questions/40371572/let-and-variables-in-haskell", "title": "&#39;let&#39; and variables in Haskell", "body": "<p>I'm a newbie in Haskell and I'm reading \"Learn You a Haskell for Great Good!\".</p>\n\n<p>An expression that defines with a \"name\" and a \"space\", followed by \"parameters\" could be used as functions.\nConsider the following code:</p>\n\n<pre><code>doubleMe = 2\n</code></pre>\n\n<p>this code actually follows the rule above, so we could see it as a <strong>function</strong>. but it really seems like an <strong>assign</strong> operations in java or c++.</p>\n\n<p>So, How to understand the variable in Haskell?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478062582, "post_id": 40371427, "comment_id": 67998495, "body": "I changed the title into something that reflects the topic a little more clearly, but I am not really satisfied with my suggestion. If anyone has better ideas, please do edit it."}], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1478438984, "post_id": 40372670, "comment_id": 68145081, "body": "Very nice, thank you. I do wonder why one needs to make the existential quantification (forall) explicit in the syntax for this and require a pragma. Why not just the same syntax as used for typeclasses, which was my original attempt?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1478483278, "post_id": 40372670, "comment_id": 68158987, "body": "@guthrie Good question. I believe that feature is off by default merely because of simplicity, and also to shield beginners from strange collateral effects in case of typos (e.g. <code>data Foo = Bar | Baz a</code> when <code>Foo</code> was supposed to be a normal, non-existential parametric type). Cf. <a href=\"https://prime.haskell.org/wiki/ExistentialQuantification\" rel=\"nofollow noreferrer\">the remarks in this Haskell Prime page</a>. By the way, <code>RankNTypes</code> (which adds uses of <code>forall</code> other than existential types) is also off by default mostly to keep things simple -- it introduces situations in which types can&#39;t be inferred without signatures."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1478062905, "last_edit_date": 1495540123, "creation_date": 1478062119, "answer_id": 40372670, "question_id": 40371427, "link": "https://stackoverflow.com/questions/40371427/how-to-specify-a-type-with-constraints/40372670#40372670", "title": "How to specify a type with constraints?", "body": "<p>Let's begin with your comment about the inferred types for <code>test</code> and <code>tests</code>:</p>\n\n<blockquote>\n<pre><code>test :: Show a =&gt; ([Char], a) -&gt; IO ()\ntests :: (Traversable t, Show a) =&gt; t ([Char], a) -&gt; IO (t ())\n</code></pre>\n  \n  <p>Which works only as long as all tests have the same type for the\n  second argument. I assume that it is somehow specializing the type to\n  the actual encountered type of the arguments, even though they are all\n  show'able.</p>\n</blockquote>\n\n<p>That is expected. All elements of a list (or any other traversable) must have the same type. It is not even quite a matter of \"specializing\": once type checker catches you trying to e.g. assemble a list out of an <code>Int</code> and a <code>String</code>, it immediately throws up its hands:</p>\n\n<pre><code>GHCi&gt; [3 :: Int, \"foo\"]\n\n&lt;interactive&gt;:125:12: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the expression: \"foo\"\n      In the expression: [3 :: Int, \"foo\"]\n      In an equation for \u2018it\u2019: it = [3 :: Int, \"foo\"]\n</code></pre>\n\n<p>A direct way of circumventing that is assigning the elements a type which ignores the irrelevant differences between the values. That is precisely what you were trying to do by bringing <code>forall</code> into play -- in your case, you were trying to state that the only thing that matters about the second element of your pairs is that there is a <code>Show</code> instance for them:  </p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\ntype ATest = forall a. (Show a) =&gt; (String, a)\n</code></pre>\n\n<p>You mention that this approach \"still fails on any variation in the value argument\". I couldn't reproduce this specific mode of failure: in fact, I couldn't even state the type of a list of <code>ATest</code>: </p>\n\n<pre><code>GHCi&gt; :set -XRankNTypes\nGHCi&gt; type ATest = forall a. (Show a) =&gt; (String, a)\nGHCi&gt; -- There is no special meaning to :{ and :}\nGHCi&gt; -- They are merely a GHCi trick for multi-line input.\nGHCi&gt; :{\nGHCi| glub :: [ATest]\nGHCi| glub = [(\"Sqrt(4)\", sqrt(4.0)),(\"sumList:\", sum [1,2,3,4])]\nGHCi| :}\n\n&lt;interactive&gt;:145:9: error:\n    \u2022 Illegal polymorphic type: ATest\n      GHC doesn't yet support impredicative polymorphism\n    \u2022 In the type signature:\n        glub :: [ATest]\n</code></pre>\n\n<p>GHC is forthcoming about its refusal: since <code>ATest</code> is just a type synonym, <code>[ATest]</code> expands to <code>[forall a. (Show a) =&gt; (String, a)]</code>. The <code>forall</code> within the argument to the list type constructor requires a feature called impredicative polymorphism, which <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\" rel=\"nofollow noreferrer\">is not supported by GHC</a>. To avoid running into that, we need to define a proper datatype, and not just a synonym, which is what you tried to do in the final attempt -- except that you still need the <code>forall</code> just like before:</p>\n\n<pre><code>GHCi&gt; -- We need a different extension in this case.\nGHCi&gt; :set -XExistentialQuantification \nGHCi&gt; data ATest = forall a. Show a =&gt; ATest (String, a)\nGHCi&gt; :{\nGHCi| glub :: [ATest]\nGHCi| glub = [ATest (\"Sqrt(4)\", sqrt(4.0)),ATest (\"sumList:\", sum [1,2,3,4])]\nGHCi| :}\nGHCi&gt; \n</code></pre>\n\n<p>This, at last, works as intended:</p>\n\n<pre><code>GHCi&gt; :{\nGHCi| -- I took the liberty of doing a few stylistic changes.\nGHCi| test :: ATest -&gt; IO ()\nGHCi| test (ATest (msg, val)) = print $ msg ++ \" :: \" ++ show val\nGHCi| \nGHCi| tests :: Foldable t =&gt; t ATest -&gt; IO ()\nGHCi| tests = mapM_ test\nGHCi| :}\nGHCi&gt; tests glub\n\"Sqrt(4) :: 2.0\"\n\"sumList: :: 10\"\n</code></pre>\n\n<p>On a general note, it is advisable to look for alternatives before committing yourself to use existential quantification in this manner, as it can often be more trouble than it is worth (for a primer on this discussion, see e.g. the question and all of the answers in <a href=\"https://stackoverflow.com/q/25030233/2751851\"><em>How to convert my thoughts in OOP to Haskell?</em></a>). In this case, however, in which all you want to do is to conveniently specify a list of tests to be ran, it seems sensible to use this strategy. In <a href=\"https://stackoverflow.com/q/1449156/2751851\"><em>Testing QuickCheck properties against multiple types?</em></a>, you can see an example of something very similar to what we have done here using QuickCheck, a full-blown testing library for Haskell.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478090520, "post_id": 40373513, "comment_id": 68012192, "body": "In general, this is good advice. I didn&#39;t follow this approach my answer (save for the allusions in the final paragraph) because I assumed the ultimate goal of the OP was writing <code>tests</code>, which is not an unreasonable thing to want to do in this specific context."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478090956, "post_id": 40373513, "comment_id": 68012465, "body": "@duplode but he can write <code>tests</code> because <code>t1</code>, <code>t2</code> and <code>t3</code> are now all of the same type.That&#39;s kinda the point."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478093125, "post_id": 40373513, "comment_id": 68013980, "body": "I see your point, and the difference of emphasis in your answer makes it a nice counterpoint to mine. If all the OP wants to do is to specify an <i>ad hoc</i> list of tests to be ran, though, there is a slight loss of convenience in having to define <code>t1</code>, <code>t2</code>, <code>t3</code>, etc. separately. While this sort of thing is almost always not enough to justify reaching for existential types, in the OP&#39;s specific use case the cost is small enough that it might make sense."}, {"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1478438794, "post_id": 40373513, "comment_id": 68145029, "body": "duplode: yes, that was my intent, and also to better understand how to do it this way."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1478067152, "creation_date": 1478067152, "answer_id": 40373513, "question_id": 40371427, "link": "https://stackoverflow.com/questions/40371427/how-to-specify-a-type-with-constraints/40373513#40373513", "title": "How to specify a type with constraints?", "body": "<p>There's no need to bend the type system in this case. You only need</p>\n\n<pre><code>t1 = (\"Sqrt(4)\", show $ sqrt(4.0))\n...\nt2 = (\"sumList:\", show $ sum [1,2,3,4])\n...\nt3 = (\"Description\", show $ value)\n...\n</code></pre>\n\n<p>Since the only thing you can do with a result of a test is show it, you might as well do that right away. Thanks to laziness, no actual call to show is made until the result is needed.</p>\n\n<p>Should you have a type class with many methods, an existential type might give you some marginal advantage.</p>\n"}], "owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 40372670, "answer_count": 2, "score": 3, "last_activity_date": 1478067152, "creation_date": 1478052556, "last_edit_date": 1478062430, "question_id": 40371427, "link": "https://stackoverflow.com/questions/40371427/how-to-specify-a-type-with-constraints", "title": "How to specify a type with constraints?", "body": "<p>I want to define a bunch of tests in a simple demo program, where each test is locally defined, but all can be printed in one standard place.</p>\n\n<p>For example;</p>\n\n<pre><code>t1 = (\"Sqrt(4)\", sqrt(4.0))\n...\nt2 = (\"sumList:\", sum [1,2,3,4])\n...\nt3 = (\"Description\", value)\n...\n</code></pre>\n\n<p>So each test is of type: (String, value), for various value types all of which (only) have to be members of the <em>Show</em> class.</p>\n\n<p>Then for the summary of the tests, a loop:</p>\n\n<pre><code>test (msg, val) = do print $ msg ++ \" :: \" ++ show val\ntests ts        = mapM test ts\n</code></pre>\n\n<p>This compiles, and assigns these types:</p>\n\n<pre><code>test :: Show a =&gt; ([Char], a) -&gt; IO ()\ntests :: (Traversable t, Show a) =&gt; t ([Char], a) -&gt; IO (t ())\n</code></pre>\n\n<p>Which works only as long as all tests have the same type for the second argument. I assume that it is somehow specializing the type to the actual encountered type of the arguments, even though they are all show'able.</p>\n\n<p>So that they can vary on the actual types of the second argument, I tried something like this (pseudo code):</p>\n\n<pre><code>type ATest = (Show a) =&gt; (String, a)\n</code></pre>\n\n<p>since that wouldn't work, I tried:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\ntype ATest = forall a. (Show a) =&gt; (String, a)\n</code></pre>\n\n<p>Which compiles, but still fails on any variation in the value argument. </p>\n\n<p>Further, I want to abstract the type of tests from the loop which prints them, but I cannot then use it to convert from:</p>\n\n<pre><code>   test :: Show a =&gt; ([Char], a) -&gt; IO ()\nto\n   test :: ATest -&gt; IO ()\n</code></pre>\n\n<p>The basic idea was to define and use a polymorphic type for the tests in the definition of the testing loop. So perhaps a Data structure instead;</p>\n\n<pre><code>data (Show a) =&gt; ATest =  Test (String,a)\n</code></pre>\n\n<p>but that also fails, although it does give the right idea; all tests have a common structure, with a second value in the Show typeclass.</p>\n\n<p>What is the right approach for this?</p>\n"}, {"tags": ["haskell", "emacs", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1478024717, "post_id": 40366079, "comment_id": 67985831, "body": "That&#39;s odd, I can&#39;t reproduce that behavior. The first entry gives me an ambiguity error (are you sure you typed <code>climbS 3</code> and not <code>:t climbS 3</code>?), and the second entry gives me a scoping error (are you sure you typed <code>sum [n | n &lt;- [1..(div nn 2)]]</code> and not <code>sum [n | n &lt;- [1..(div 5 2)]</code> or similar?). Do you have anything fun in a <code>.ghci</code> file? What version of GHC do you have?"}, {"owner": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478025373, "post_id": 40366079, "comment_id": 67986174, "body": "I am sure that I type <code>climbS 3</code> but <code>:t climbS 3</code>. I use ghci drectly in shell instead of in emacs <code>haskell-mode</code>, and everything is fine now. I think it is <code>haskell-mode</code> issues but not ghci&#39;s. Thank you"}, {"owner": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1478025843, "post_id": 40366079, "comment_id": 67986424, "body": "Submit this problem to <code>haskell-mode</code> on github. <a href=\"https://github.com/haskell/haskell-mode/issues/1446\" rel=\"nofollow noreferrer\">link</a>"}], "owner": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1478025401, "creation_date": 1478024025, "last_edit_date": 1478025401, "question_id": 40366079, "link": "https://stackoverflow.com/questions/40366079/haskell-ghci-do-not-print-value", "title": "Haskell ghci do not print value", "body": "<p>I just learn haskell recently. </p>\n\n<p>I write this code in *.hs file, and run ghci in emacs. </p>\n\n<pre><code>climbS :: (Fractional a, Enum a, Num a, Integral a) =&gt; a -&gt; a\nclimbS nn = sum [n | n &lt;- [1..(div nn 2)]]\n</code></pre>\n\n<p>I put code below in ghci, and get the type of <code>climbS</code></p>\n\n<pre><code>\u03bb&gt; climbS 3\nclimbS 3 :: (Integral a, Fractional a) =&gt; a\n</code></pre>\n\n<p>but if I put expression directly, I get the return that I purposed get </p>\n\n<pre><code>\u03bb&gt; let nn = 4 in sum [n | n &lt;- [1..(div nn 2)]]\n3\n</code></pre>\n\n<p>How does it happen and how can I fix it?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1478019938, "post_id": 40364846, "comment_id": 67983039, "body": "Try: <code>total 10 :: Double</code>"}, {"owner": {"reputation": 11, "user_id": 4414253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4fd4233342e1b392d0fcf0d58eb4c1a?s=128&d=identicon&r=PG&f=1", "display_name": "Cogs", "link": "https://stackoverflow.com/users/4414253/cogs"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1478020444, "post_id": 40364846, "comment_id": 67983328, "body": "I already tried this ofc --&gt;      \u2022 No instance for (Integral Double) arising from a use of \u2018total\u2019     \u2022 In the expression: total 10 :: Double       In an equation for \u2018it\u2019: it = total 10 :: Double"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1478020635, "post_id": 40364846, "comment_id": 67983445, "body": "Yes, the problem is that Haskell does not have any type that is both <code>Integral</code> and <code>Fractional</code> at the same time, but your <code>total</code> functions needs such a type!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1478047710, "post_id": 40364846, "comment_id": 67995111, "body": "fwiw, you can rewrite <code>leftHalf</code> as <code>leftHalf x = takeLessEqual x $ map (\\x -&gt; (x * x + x + 1) [1..]</code> and it&#39;ll work for all numeric types, not just <code>Integral</code> or <code>Fractional</code> types."}], "answers": [{"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 6, "last_activity_date": 1478021464, "last_edit_date": 1478021464, "creation_date": 1478020596, "answer_id": 40365166, "question_id": 40364846, "link": "https://stackoverflow.com/questions/40364846/adding-different-number-types-in-haskell/40365166#40365166", "title": "Adding different number types in Haskell", "body": "<p>Firstly, I would like to recommend that you definitely follow GHC's suggestion of adding type signatures. I recommend always giving type signatures to top-level definitions. This will make the error messages <em>significantly</em> more clear.</p>\n\n<p>If we go ahead and do that, assuming that the <code>Fractional</code> type you want is <code>Double</code> and the <code>Integral</code> type is <code>Int</code>, we have</p>\n\n<pre><code>takeLessEqual :: Ord a =&gt; a -&gt; [a] -&gt; [a]\ntakeLessEqual x = takeWhile (&lt;=x)\n\nleftHalf :: Double -&gt; [Double] -- This must be some `Fractional` type since we are doing things like adding by 0.5\nleftHalf x = takeLessEqual x $ (map (\\x -&gt; ((x+0.5)*(x+0.5) + 0.75))) [1..]\n\nrightHalf :: Int -&gt; [Int]      -- This must be some `Integral` type since we are using `even`\nrightHalf x = takeLessEqual x $ (map (\\x -&gt; if even x then x*x + 1 else x*x)) [1..]\n\n-- total :: ?\ntotal x = (sum $ rightHalf x) + (sum $ leftHalf x)\n</code></pre>\n\n<p>Note that there is no type that is both <code>Integral</code> and <code>Fractional</code>, so we cannot use the same number type everywhere here.</p>\n\n<p>The problem now is that the two sides of <code>+</code> in <code>total</code> are not the same type, even though they must be (<code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code>).</p>\n\n<p>Now, you need to decide if you want to end up using <code>Double</code>s or <code>Int</code>s (or a combination. I will assume you want <code>Double</code> for both the input and the output):</p>\n\n<pre><code>total :: Double -&gt; Double\n</code></pre>\n\n<p>Now, we see that <code>rightHalf</code> needs an <code>Int</code>, so we must use either <code>ceiling</code>, <code>floor</code> or <code>round</code> to convert the argument from a <code>Double</code>. The result we get back is a <code>[Int]</code> fed into <code>sum</code>, which gives us an <code>Int</code> (since <code>sum :: Num a =&gt; [a] -&gt; a</code>).</p>\n\n<p>Assuming <code>ceiling</code> gives the rounding we want, we end up with:</p>\n\n<pre><code>total x = (fromIntegral . sum . rightHalf $ ceiling x) + (sum $ leftHalf x)\n</code></pre>\n\n<p>On a stylistic note, I would also suggest writing <code>... + sum (leftHalf x)</code> instead of <code>... + (sum $ leftHalf x)</code>.</p>\n\n<p>In general, if you want to go from a fractional type to an integral type, you will want to use <code>floor</code>, <code>ceiling</code> or <code>round</code>. If you want to go from an integral type to anything else (usually a fractional type, but possible some different integral type), you will want <code>fromIntegral</code>.</p>\n\n<p>You could do the conversions in a different spot (in <code>leftHalf</code> and/or <code>rightHalf</code>). It seems like those two functions should stay floating and integral respectively though, since you would have to choose a rounding method (when the function that calls those two should probably be able to decide on a rounding method).</p>\n"}], "owner": {"reputation": 11, "user_id": 4414253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4fd4233342e1b392d0fcf0d58eb4c1a?s=128&d=identicon&r=PG&f=1", "display_name": "Cogs", "link": "https://stackoverflow.com/users/4414253/cogs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1478021464, "creation_date": 1478019535, "question_id": 40364846, "link": "https://stackoverflow.com/questions/40364846/adding-different-number-types-in-haskell", "title": "Adding different number types in Haskell", "body": "<p>I'm have been using Haskell for a while and I'm having some trouble with Numeric Types. Most of the time I can solve the after trying around a bit but this time i have been stumped for over two hours by this trivial piece of code.</p>\n\n<p>I have these Functions:</p>\n\n<pre><code>takeLessEqual x = takeWhile (&lt;=x)\n\nleftHalf x = takeLessEqual x $ (map (\\x -&gt; ((x+0.5)*(x+0.5) + 0.75))) [1..]\n-- Produces the list [3.0,7.0,13.0,21.0,31.0,43.0 ... (some number &lt; x)]\n\nrightHalf x = takeLessEqual x $ (map (\\x -&gt; if even x then x*x + 1 else x*x)) [1..]\n-- Produces the list [1,5,9,17,25,37,49 ... (some number &lt; x)]   \n\ntotal x = (sum $ rightHalf x) + (sum $ leftHalf x)\n-- total 10 Should produce some number 25 or 25.0\n</code></pre>\n\n<p>It loads without error in to ghci, but when i try to evaluate:</p>\n\n<pre><code>*&gt; leftHalf 10 \n[3.0,7.0]\nit :: (Ord a, Fractional a, Enum a) =&gt; [a]\n\n*&gt; rightHalf 10\n[1,5,9]\nit :: Integral a =&gt; [a]\n\n*&gt; total 10\n\n&lt;interactive&gt;:150:1: error:\n\u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018it\u2019\n  prevents the constraint \u2018(Fractional a0)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n  These potential instances exist:\n    instance Fractional Double -- Defined in \u2018GHC.Float\u2019\n    instance Fractional Float -- Defined in \u2018GHC.Float\u2019\n    ...plus one instance involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the first argument of \u2018print\u2019, namely \u2018it\u2019\n  In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>And I have tried adding type annotations at various points and converting types with toInteger and fromIntegral with no success.</p>\n\n<p>What am I doing wrong and how do I fix it?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1478019553, "creation_date": 1478019553, "answer_id": 40364850, "question_id": 40364831, "link": "https://stackoverflow.com/questions/40364831/list-of-brackets-haskell/40364850#40364850", "title": "list of brackets, Haskell", "body": "<p><code>(+)</code> is an operator for adding together numbers, not concatenating lists/strings. Try <code>(++)</code> for that.</p>\n"}], "owner": {"reputation": 7, "user_id": 6268300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/029832e1414d47e5446ae37161809797?s=128&d=identicon&r=PG&f=1", "display_name": "falazure", "link": "https://stackoverflow.com/users/6268300/falazure"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478023640, "creation_date": 1478019459, "last_edit_date": 1478023640, "question_id": 40364831, "link": "https://stackoverflow.com/questions/40364831/list-of-brackets-haskell", "title": "list of brackets, Haskell", "body": "<p>The task is describe infinite list (called brackets) of strings\nExample of such list: <code>[\"[]\", \"[[]]\", \"[[[]]]\", \"[[[[]]]]\"...]</code></p>\n\n<p>If I'll write <code>take 4 brackets</code> the result should be\n<code>[\"[]\",\"[[]]\",\"[[[]]]\",\"[[[[]]]]\"]</code>.</p>\n\n<p>In this task I should use a trick called \"tying the knot\".\nIt is something like that:</p>\n\n<pre><code>geom= 1 : map (/2) geom\n</code></pre>\n\n<hr>\n\n<p>My solution is </p>\n\n<pre><code>brackets = \"[]\": map (\\xs -&gt; \"[\" + xs + \"]\" ) brackets\n</code></pre>\n\n<p>but I got error:</p>\n\n<pre><code>Unresolved top-level overloading\n*** Binding             : brackets\n*** Outstanding context : Num [Char]\n</code></pre>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478018918, "post_id": 40363949, "comment_id": 67982418, "body": "If the ratio between lengths of the list arguments is not correct given <code>n</code>, what should happen? (ex. <code>dropandreplace [dropandreplace [1,0,3,0,5,0,7,0] 2 [2,4,6]</code>)"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1478018944, "post_id": 40363949, "comment_id": 67982438, "body": "What have you tried for the actual question? What isn&#39;t working? These are necessary parts for a <a href=\"http://stackoverflow.com/help/how-to-ask\">good question</a>."}, {"owner": {"reputation": 159, "user_id": 6394340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-hgeCHgTo5ok/AAAAAAAAAAI/AAAAAAAAAC8/9AAWXNM7WiE/photo.jpg?sz=128", "display_name": "Can &#199;al\u0131\u015fkan", "link": "https://stackoverflow.com/users/6394340/can-%c3%87al%c4%b1%c5%9fkan"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478019589, "post_id": 40363949, "comment_id": 67982843, "body": "give error message like &quot;Second list hasn&#39;t got enough length&quot; @mnoronha"}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 6394340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-hgeCHgTo5ok/AAAAAAAAAAI/AAAAAAAAAC8/9AAWXNM7WiE/photo.jpg?sz=128", "display_name": "Can &#199;al\u0131\u015fkan", "link": "https://stackoverflow.com/users/6394340/can-%c3%87al%c4%b1%c5%9fkan"}, "edited": false, "score": 0, "creation_date": 1478020116, "post_id": 40364883, "comment_id": 67983145, "body": "it works but if second list hasn&#39;t got enough length return missing list like;  dropandreplace [1,0,3,0,5,0,7,0] 2 [2,4,6]  output; [1,2,3,4,5,6]"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478020131, "post_id": 40364883, "comment_id": 67983153, "body": "To address the uneven length direction (from comment above), we should add an error case for an empty second list: <code>dropandreplace _ _ [] = error &quot;Replacement list has insufficient size&quot;</code> before our base case."}, {"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "reply_to_user": {"reputation": 159, "user_id": 6394340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-hgeCHgTo5ok/AAAAAAAAAAI/AAAAAAAAAC8/9AAWXNM7WiE/photo.jpg?sz=128", "display_name": "Can &#199;al\u0131\u015fkan", "link": "https://stackoverflow.com/users/6394340/can-%c3%87al%c4%b1%c5%9fkan"}, "edited": false, "score": 0, "creation_date": 1478023331, "post_id": 40364883, "comment_id": 67985065, "body": "@Can&#199;al\u0131\u015fkan , I added two comments; if you want to preserve longer list use them."}], "tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": true, "score": 0, "last_activity_date": 1478023283, "last_edit_date": 1478023283, "creation_date": 1478019673, "answer_id": 40364883, "question_id": 40363949, "link": "https://stackoverflow.com/questions/40363949/haskell-drop-nth-element-in-list-and-replace-other-list-with-that-index/40364883#40364883", "title": "haskell drop N&#39;th element in list and replace other list with that index", "body": "<p>Here is a simple solution using recursion and <code>splitAt</code>.</p>\n\n<pre><code>dropandreplace :: [a] -&gt; Int -&gt; [a] -&gt; [a]\ndropandreplace xs num (r:rs)\n  = case splitAt (num-1) xs of\n      (f, _:l) -&gt; f ++ r : dropandreplace l num rs\n      (f, _)   -&gt; f -- `xs` if you want to preserve longer list\ndropandreplace _ _ _ = []\n</code></pre>\n\n<p>Which is basically, </p>\n\n<blockquote>\n  <p>take the first nth character, replace with target, and recurse.</p>\n</blockquote>\n\n<hr>\n\n<p>Or another solution:</p>\n\n<pre><code>dropandreplace :: [a] -&gt; Int -&gt; [a] -&gt; [a]\ndropandreplace ss num rs = zipWith fromMaybe ss (expand rs)\n  where\n    expand [] = [] -- `repeat Nothing` if you want to preserve longer list\n    expand (x:xs) = replicate (num-1) Nothing ++ Just x : expand xs\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 6394340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-hgeCHgTo5ok/AAAAAAAAAAI/AAAAAAAAAC8/9AAWXNM7WiE/photo.jpg?sz=128", "display_name": "Can &#199;al\u0131\u015fkan", "link": "https://stackoverflow.com/users/6394340/can-%c3%87al%c4%b1%c5%9fkan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 40364883, "answer_count": 1, "score": -1, "last_activity_date": 1478023283, "creation_date": 1478016440, "last_edit_date": 1478020518, "question_id": 40363949, "link": "https://stackoverflow.com/questions/40363949/haskell-drop-nth-element-in-list-and-replace-other-list-with-that-index", "title": "haskell drop N&#39;th element in list and replace other list with that index", "body": "<p>I have a problem, the question is;</p>\n\n<p>Drop every N'th element from a list and replaces it with the elements in the list given in the second parameter.</p>\n\n<p>Example;</p>\n\n<p>dropandreplace \u201cabcdefgh\u201d 3 \u201chgfedcba\u201d</p>\n\n<p>output: \u201cabhdeggh\u201d</p>\n\n<p>dropandreplace [1,0,3,0,5,0,7,0] 2 [2,4,6,8]</p>\n\n<p>output: [1,2,3,4,5,6,7,8]</p>\n\n<p>I did implement that code;</p>\n\n<pre><code>dropn :: [Char] -&gt; Int -&gt; [Char]\ndropn list n = [ i | (i,c) &lt;- ( zip list [1,2..]), (mod c n) /= 0 ]\n</code></pre>\n\n<p>But this code is drop N'th element from list.. How can i replace element of other list??</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1478011449, "post_id": 40362182, "comment_id": 67977784, "body": "<code>guard $ month &gt;= 0 &amp;&amp; month &lt;= 12</code> ?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1478014159, "post_id": 40362182, "comment_id": 67979485, "body": "<code>&gt;=1</code> maybe? :D"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1478014646, "post_id": 40362182, "comment_id": 67979790, "body": "Side note 20160229 is valid while 20000229 is not, don&#39;t foget to check that too"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1478016074, "post_id": 40362182, "comment_id": 67980681, "body": "another side note why is date a <code>Parser (String, String, String)</code> and not <code>String (Integer, Int, Int)</code> ?? (then @ThomasM.DuBuisson s advice wont work - because you can&#39;t compare <code>String</code> with <code>Int</code> (roughly speaking))"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1478016076, "post_id": 40362182, "comment_id": 67980684, "body": "There is a difference between determining if a string matches a date <i>format</i> and determining if a string represents a valid date. A parser should only be responsible for the former."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1478016205, "post_id": 40362182, "comment_id": 67980751, "body": "@chepner good point - never thought of it that way, but I agree - <code>parseDate</code> &amp; <code>validateDate</code> should be two separate things"}, {"owner": {"reputation": 2862, "user_id": 2613769, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/200dde59bd0be1e302c0d89ed34f5081?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2613769/ben"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1478042247, "post_id": 40362182, "comment_id": 67993760, "body": "@epsilonhalbe Int is better.  I chose String just because it&#39;s simpler."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1478031086, "post_id": 40364961, "comment_id": 67989047, "body": "And of course, in real code (as distinct from pedagogical code like displayed here) you should use <a href=\"http://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Calendar.html#v:fromGregorianValid\" rel=\"nofollow noreferrer\"><code>fromGregorianValid</code></a> from the venerable <code>time</code> package rather than coding up a simple-but-wrong validator yourself."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478031760, "post_id": 40364961, "comment_id": 67989394, "body": "@DanielWagner: Yes, although you might also want to do a bit of your own sanity checks to have more detailed error messages."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 4, "last_activity_date": 1478020424, "last_edit_date": 1478020424, "creation_date": 1478019931, "answer_id": 40364961, "question_id": 40362182, "link": "https://stackoverflow.com/questions/40362182/how-to-parse-a-string-of-integers-only-in-some-range-with-parsec/40364961#40364961", "title": "How to parse a string of integers only in some range with Parsec?", "body": "<p>You could add a <code>guard</code> as suggested by Thomas M. DuBuisson:</p>\n\n<pre><code>date :: Parser (String, String, String)\ndate = do\n  year &lt;- replicateM 4 digit\n  month &lt;- replicateM 2 digit\n  day &lt;- replicateM 2 digit\n  guard $ read month &gt; 0 &amp;&amp; read month &lt;= 12 &amp;&amp; read day &gt; 0 &amp;&amp; read day &lt;= 31\n  return (year, month, day)\n</code></pre>\n\n<p>However, this results in a bad error message:</p>\n\n<pre><code>\u03bb&gt; parse date \"\" \"20161356\"\nLeft (line 1, column 9):unknown parse error\n</code></pre>\n\n<p>We can fix this by combining <code>guard</code> with <code>&lt;?&gt;</code> to provide a better error message:</p>\n\n<pre><code>date :: Parser (String, String, String)\ndate = do\n  year &lt;- replicateM 4 digit\n  month &lt;- replicateM 2 digit\n  guard (read month &gt; 0 &amp;&amp; read month &lt;= 12) &lt;?&gt; \"valid month (1\u201312)\"\n  day &lt;- replicateM 2 digit\n  guard (read day &gt; 0 &amp;&amp; read day &lt;= 31) &lt;?&gt; \"valid day (1\u201331)\"\n  return (year, month, day)\n</code></pre>\n\n<p>With this approach, you get a more useful error message:</p>\n\n<pre><code>\u03bb&gt; parse date \"\" \"20161356\"\nLeft (line 1, column 7):\nexpecting valid month (1\u201312)\n</code></pre>\n\n<p>As a side note, I think it <em>is</em> valuable to validate (or at least sanity check) the date in a parser\u2014it ensures that the date validation composes with the rest of your parser and error-handling code. You can't forget to check the date later in your code and the error is localized correctly, which is very useful if you're parsing documents with lots of dates.</p>\n"}], "owner": {"reputation": 2862, "user_id": 2613769, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/200dde59bd0be1e302c0d89ed34f5081?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2613769/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 40364961, "answer_count": 1, "score": 3, "last_activity_date": 1478020424, "creation_date": 1478010684, "question_id": 40362182, "link": "https://stackoverflow.com/questions/40362182/how-to-parse-a-string-of-integers-only-in-some-range-with-parsec", "title": "How to parse a string of integers only in some range with Parsec?", "body": "<p>I'm trying to learn Parsec by parsing a date string of format \"YYYYMMDD\", for example \"20161030\".  And my solution is:</p>\n\n<pre><code>date :: Parser (String, String, String)\ndate = do\n  year &lt;- replicateM 4 digit\n  month &lt;- replicateM 2 digit\n  day &lt;- replicateM 2 digit\n  return (year, month, day)\n</code></pre>\n\n<p>But the problem is that \"20161356\" is also a valid date for my code.</p>\n\n<p>How can I validate the \"MM\" is between 1 and 12; and \"DD\" is between 1 and 31?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1478003639, "post_id": 40359978, "comment_id": 67973447, "body": "You are looking for type families. Cf. <a href=\"http://stackoverflow.com/q/34482540/2751851\"><i>Type families for dummies</i></a>."}, {"owner": {"reputation": 8790, "user_id": 1261432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3cd64a8b152ef096abdd8d03925bf34?s=128&d=identicon&r=PG&f=1", "display_name": "Synxis", "link": "https://stackoverflow.com/users/1261432/synxis"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478004870, "post_id": 40359978, "comment_id": 67974071, "body": "I need an extension for this ? Will it work if I try a compiler different than GHC ?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1478005675, "post_id": 40359978, "comment_id": 67974502, "body": "@Synxis Type families are pretty standard, as are a lot of extensions.  GHC is pretty much the only compiler out there for Haskell if you&#39;re targeting native (there is GHCJS for targeting the browser, and a handful of others).  You even hit it right on the nose when you said that you want to make an association between types, that&#39;s exactly what type families do."}, {"owner": {"reputation": 8790, "user_id": 1261432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3cd64a8b152ef096abdd8d03925bf34?s=128&d=identicon&r=PG&f=1", "display_name": "Synxis", "link": "https://stackoverflow.com/users/1261432/synxis"}, "edited": false, "score": 0, "creation_date": 1478005873, "post_id": 40359978, "comment_id": 67974610, "body": "Thank you then. If you make an answer I can accept it"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1478006134, "post_id": 40359978, "comment_id": 67974758, "body": "@Synxis As a footnote to bheklilr&#39;s comment, GHCJS supports <a href=\"https://github.com/ghcjs/ghcjs\" rel=\"nofollow noreferrer\">&quot;All type system extensions supported by GHC&quot;</a>."}], "owner": {"reputation": 8790, "user_id": 1261432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3cd64a8b152ef096abdd8d03925bf34?s=128&d=identicon&r=PG&f=1", "display_name": "Synxis", "link": "https://stackoverflow.com/users/1261432/synxis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1478003147, "creation_date": 1478002905, "last_edit_date": 1478003147, "question_id": 40359978, "link": "https://stackoverflow.com/questions/40359978/function-working-on-types-instead-of-values", "title": "Function working on types instead of values", "body": "<p>In Haskell, I want to make an association like:</p>\n\n<pre><code>-- Given types A, B, C, and X, Y, Z,\n-- make some sort of manual association :\nf A = X\nf B = Y\nf C = Z\n\n-- Intended use (for example)\ng :: a -&gt; ... -&gt; f a\n</code></pre>\n\n<p>I think its kind should be <code>* -&gt; *</code>, which can be the kind of some constructors, but I don't know how to manually make associations...</p>\n\n<p><strong>So, how do you create a function of types, ie a function which you give a type and the result is another type ?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477990111, "post_id": 40356620, "comment_id": 67966670, "body": "Any chance you have the full code somewhere online? Optimally, you would want to look at the core output to see what is happening, but that&#39;s only possible for something that compiles. Also, what flags are you using when you compile?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1477990831, "post_id": 40356620, "comment_id": 67966987, "body": "Floyd-Warshall is classical dynamic programming algorithm. You can find better approach to solve such problems using <i>Haskell</i> in this post: <a href=\"http://jelv.is/blog/Lazy-Dynamic-Programming/\" rel=\"nofollow noreferrer\">jelv.is/blog/Lazy-Dynamic-Programming</a>"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1477992286, "post_id": 40356620, "comment_id": 67967723, "body": "i&#39;ve uploaded full code and sample input: <a href=\"https://gist.github.com/cwyang/27ab81bee731e6d01bb3a7483fdb748e\" rel=\"nofollow noreferrer\">gist.github.com/cwyang/27ab81bee731e6d01bb3a7483fdb748e</a>"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1477992295, "post_id": 40356620, "comment_id": 67967727, "body": "compiled with: stack ghc -- -O2  graph.hs"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1477992857, "post_id": 40356620, "comment_id": 67967998, "body": "@Shersh I&#39;ve read the article. Since flyod-warshall repeatedly modifies its own elements, I could not find way to code in lazy DP sytle, <i>sigh</i>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477993849, "post_id": 40356620, "comment_id": 67968524, "body": "@cwyang We&#39;re missing something here. I&#39;m on GHC 8.0 and your test file linked results in only one <code>&quot;doing&quot;</code>, not three, when I run it with the same options (actually, the same result comes from <code>-O0</code>, <code>-O1</code>, and <code>-O2</code>). What version of GHC are you on?"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1477994042, "post_id": 40356620, "comment_id": 67968627, "body": "Oh, I ran on ghc version 7.10.3. I don&#39;t want to believe it&#39;s version issue though... (same result on -O0,1,2 -- &quot;doing&quot; thrice)"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477998549, "post_id": 40356620, "comment_id": 67970942, "body": "@alec I tested on ghc 8.0 (base library 4.9.0) and that was fine. When I change <code>replicateM_</code> to <code>forM_</code>, it runs well on ghc 7.10.x. it might be bug of <code>replicateM_</code> in ghc 7.10.x (base library 4.8.2)"}], "answers": [{"comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1477999906, "post_id": 40359058, "comment_id": 67971588, "body": "@Shersh&#39;s comment above seems quite good: &quot; You can find better approach to solve such problems using Haskell in this post: jelv.is/blog/Lazy-Dynamic-Programming&quot; Generally, you should do as little as possible while in the IO monad... you&#39;ll need to change your thinking a bit when programming Haskell, but with time you&#39;ll enjoy it more and more :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478018418, "post_id": 40359058, "comment_id": 67982086, "body": "Oh, wow, that is a nasty gotcha. It&#39;s one that I, at least, didn&#39;t know about, and I&#39;ve been using Haskell as my go-to language for new projects for almost a decade now, including several years hacking Haskell projects professionally. Perhaps that is some small evidence that this problem doesn&#39;t bite very often."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1478030377, "post_id": 40359058, "comment_id": 67988673, "body": "@mb21 While I agree with the spirit of your comment, the OP is <i>not</i> doing his work inside the <code>IO</code> monad, but inside the <code>ST</code> monad (the bug is actually not even in the algorithm but in the code that calls it). Also, as this particular algorithm requires a lot of updates <code>ST</code> seems like a pretty good choice."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478078900, "post_id": 40359058, "comment_id": 68005086, "body": "@Daniel Wagner, <a href=\"https://ghc.haskell.org/trac/ghc/ticket/1168\" rel=\"nofollow noreferrer\">here</a> are more examples."}], "tags": [], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "is_accepted": false, "score": 4, "last_activity_date": 1478055770, "last_edit_date": 1478055770, "creation_date": 1477999357, "answer_id": 40359058, "question_id": 40356620, "link": "https://stackoverflow.com/questions/40356620/why-is-the-result-of-the-function-not-reused/40359058#40359058", "title": "Why is the result of the function not reused?", "body": "<p>Frustratingly, this seems to be caused by the GHC issue <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11271\" rel=\"nofollow noreferrer\">\"Costly let binding gets duplicated in IO action value\"</a>.</p>\n\n<p>Using <code>forM_</code> rather than <code>replicateM_</code> or using <code>BangPatterns</code> solves this issue.</p>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1480426266, "creation_date": 1477989805, "last_edit_date": 1480426266, "question_id": 40356620, "link": "https://stackoverflow.com/questions/40356620/why-is-the-result-of-the-function-not-reused", "title": "Why is the result of the function not reused?", "body": "<p>When I try to code a shortest path algorithm, I run across a strange thing. After <code>floydWarshall</code> function generates adjecency matrix in array form, <code>main</code> function tries to query the array multiple times (in <code>replicateM_</code> loop). </p>\n\n<p>What I found is that my code is terribly slow. So I put <code>traceShow \"doing\"</code> at the top of <code>floydWarshall</code> and re-run to find that each <code>res ! (start,end)</code> calls <code>floydWarshall</code> repeatedly. </p>\n\n<p>Why does the array re-generates each time?</p>\n\n<p>Full source with sample input:  <a href=\"https://gist.github.com/cwyang/27ab81bee731e6d01bb3a7483fdb748e\" rel=\"nofollow noreferrer\">https://gist.github.com/cwyang/27ab81bee731e6d01bb3a7483fdb748e</a></p>\n\n<pre><code>floydWarshall :: AdjMatrix (Maybe Int) -&gt; AdjMatrix (Maybe Int)\nfloydWarshall am = traceShow \"doing\" $ runST $ do\n  arr &lt;- thaw am :: ST s (STArray s (Vertex,Vertex) (Maybe Int))\n  sequence_ [ go arr k i j | k &lt;- r, i &lt;- r, j &lt;- r]\n  freeze arr\n  where ((minb,_), (maxb,_)) = bounds am\n        r = [minb..maxb]\n        go :: STArray s (Vertex,Vertex) (Maybe Int)\n           -&gt; Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()\n        go arr k i j = do\n          ij &lt;- readArray arr (i,j)\n          ik &lt;- readArray arr (i,k)\n          kj &lt;- readArray arr (k,j)\n          case (ik, kj) of\n            (Nothing, _) -&gt; return ()\n            (_, Nothing) -&gt; return ()\n            (Just a, Just b) -&gt; case ij of\n              Nothing  -&gt; do\n                writeArray arr (i,j) $ Just (a+b)\n              (Just c) -&gt; when (c &gt; a+b) $ do\n                writeArray arr (i,j) $ Just (a+b)\nreadInt :: B.ByteString -&gt; Int\nreadInt = fst . fromJust . B.readInt\n\nmain :: IO ()\nmain = do\n  [n,m] &lt;- rl\n  edges &lt;- replicateM m $ do\n    [from,to,weight] &lt;- rl\n    return (from,to,weight)\n  [q] &lt;- rl\n  let am = buildAdjMatrix (1,n) edges\n      res= floydWarshall am\n  replicateM_ q $ do\n    [start,end] &lt;- rl\n    putStrLn . show $ maybe (-1) id (res ! (start,end))\n  where rl = map readInt . B.words &lt;$&gt; B.getLine\n</code></pre>\n\n<p>Sample run:</p>\n\n<pre><code>$ graph &lt; floyd3.txt hs\n\"doing\"     &lt;-- floydWarshall keeps calling\n1395\n\"doing\"\n975\n\"doing\"\n1593\n\"doing\"\n1023\n\"doing\"\n1521\n...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1477972019, "post_id": 40353804, "comment_id": 67961748, "body": "I was with you until you said \u201cSo now I need to make <code>Layer</code> abstraction\u201d. Why do you need to do that? What are you gaining over the higher-order function? What problem are you trying to solve by going down that path?"}, {"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1477973098, "post_id": 40353804, "comment_id": 67961984, "body": "DRY concept. To unify the code, that is strongly repeatable. Create <code>Layer</code> is not a solution. But I didn&#39;t find any other path. It is my second day in Haskell. Maybe I just missed the obvious solution."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1477974650, "post_id": 40353804, "comment_id": 67962299, "body": "@AlexisKing or anyone else feel free to correct me if this is wrong... it seems to me like you jump to creating the <code>Layer</code> abstraction because of the different types of element lists. But if we wrote a <code>universalTransform</code> of type <code>(MyData -&gt; [a]) -&gt; MyData -&gt; [Int]</code>, wouldn&#39;t we circumvent this?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 1, "creation_date": 1477974753, "post_id": 40353804, "comment_id": 67962319, "body": "@mnoronha Yup. My answer, posted simultaneously with your comment, is basically that :)"}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 1, "creation_date": 1478043318, "post_id": 40354151, "comment_id": 67994050, "body": "Yes, thank you so much! I am unstuck. That took me some time to understand, what \u201cFunctional\u201d actually means in definition of Haskell. I am having my fun occasionally with lambdas in ruby/rails, but it is just a bit. Here in Haskell functions are all around. They are being passed as arguments to other functions. That&#39;s mind changing. It is like to stop seeing things in the first place, and start seeing processes. In OOP/ruby I had a thing and was thinking, what it can do. In Haskell I have a function and think, to what to apply it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 0, "creation_date": 1478046495, "post_id": 40354151, "comment_id": 67994835, "body": "@AlexeySkoblikov &quot;It is like to stop seeing things in the first place, and start seeing processes.&quot; -- That&#39;s the spirit. In the context of your comment, it is worth emphasising that if you define, for instance, <code>g</code> and <code>layer79</code> with the appropriate types, then <code>transform g layer79</code> is an entirely normal <code>MyData -&gt; [Int]</code> function that you can use anywhere, including as an argument for other functions that accept <code>MyData -&gt; [Int]</code> arguments."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1477974566, "creation_date": 1477974566, "answer_id": 40354151, "question_id": 40353804, "link": "https://stackoverflow.com/questions/40353804/pull-out-data-from-inside-a-constructor/40354151#40354151", "title": "Pull out data from inside a constructor", "body": "<p>As Alexis King points out, you don't need the <code>Layer</code> type to abstract over the transformations. Just have your function take <code>f</code> and the layer function as arguments. That way, you go from...</p>\n\n<pre><code>transform1 :: MyData -&gt; [Int]\ntransform1 mydata = zipWith f (layer1 mydata) constList\n</code></pre>\n\n<p>... to (let's say the type of <code>constList</code> is <code>[Foo]</code>):</p>\n\n<pre><code>transform :: (a -&gt; Foo -&gt; Int) -&gt; (MyData -&gt; [a]) -&gt; MyData -&gt; [Int]\ntransform f layer mydata = zipWith f (layer mydata) constList\n</code></pre>\n\n<p>This <code>transform</code> becomes easier on the eyes if you flip the order of the arguments of <code>f</code>:</p>\n\n<pre><code>transform :: (Foo -&gt; a -&gt; Int) -&gt; (MyData -&gt; [a]) -&gt; MyData -&gt; [Int]\ntransform f layer mydata = zipWith f constList (layer mydata)\n</code></pre>\n\n<p>Now it becomes easy to not mention <code>mydata</code> explicitly (this final step is perhaps a matter of taste, but I like it best this way):</p>\n\n<pre><code>transform :: (Foo -&gt; a -&gt; Int) -&gt; (MyData -&gt; [a]) -&gt; MyData -&gt; [Int]\ntransform f layer = zipWith f constList . layer\n</code></pre>\n\n<p>The main substantial difference between <code>transform</code> and what you were speculating about doing with <code>Layer</code> is that with this solution you are not constrained to just three ways of creating the layers, as specified by <code>LayerName</code>. Given how you stated your problem, however, I guess you didn't really want such a restriction in the first place.</p>\n\n<hr>\n\n<p>P.S.: If you actually wanted something similar to your <code>Layer</code> proposal (which, again, is something I strongly suspect you don't actually need), you would probably have better luck with something like...</p>\n\n<pre><code>data Element = Elem1 Element1 | Elem2 Element2 | Elem3 Element3\n</code></pre>\n\n<p>... plus a layer-producing function (that actually produces a list!):</p>\n\n<pre><code>toLayer :: LayerName -&gt; MyData -&gt; [Element]\n</code></pre>\n\n<p>The function you give <code>zipWith</code> would then be responsible for doing case analysis on <code>Element</code>:</p>\n\n<pre><code>f :: Foo -&gt; Element -&gt; Int\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477974566, "creation_date": 1477971416, "last_edit_date": 1477972463, "question_id": 40353804, "link": "https://stackoverflow.com/questions/40353804/pull-out-data-from-inside-a-constructor", "title": "Pull out data from inside a constructor", "body": "<p>I am completely new to Haskell.</p>\n\n<p>I have several layers of information. Each layer is calculated in a unique way, but on the output I have just lists of typed elements.</p>\n\n<pre><code>layer1 :: MyData -&gt; [Element1]\nlayer1 mydata = unique calculations\n\nlayer2 :: MyData -&gt; [Element2]\nlayer2 mydata = even more unique calculations, using layer1\n\nlayer3 :: MyData -&gt; [Element3]\nlayer3 mydata = completely genious layer of profound information\n.....\n</code></pre>\n\n<p>So here my N functions cannot be parametrized and should remain detached.</p>\n\n<p>Then I want to run a bunch of similar functions on these layers.</p>\n\n<p>I mights do it in a straightforward way</p>\n\n<pre><code>transform1 :: MyData -&gt; [Int]\ntransform1 mydata = zipWith f (layer1 mydata) constList\ntransform2 :: MyData -&gt; [Int]\ntransform2 mydata = zipWith f (layer2 mydata) constList\ntransform3 :: MyData -&gt; [Int]\ntransform3 mydata = zipWith f (layer3 mydata) constList\n......\n</code></pre>\n\n<p>But here clearly it is inviting to make <strong>some kind of unification.</strong> Like</p>\n\n<pre><code>universalTransform :: Layer -&gt; [Int]\nuniversalTransform layer = zipWith f layer constList\n</code></pre>\n\n<p>Ok. So now I need to make <code>Layer</code> abstraction</p>\n\n<pre><code>data Layer = Lay1 [Element1] | Lay2 [Element2] | Lay3 [Element3]\ndata LayerName = Lay1Name | Lay2Name | Lay3Name\n</code></pre>\n\n<p>Then I need to make a dispatching collector</p>\n\n<pre><code>take :: LayerName -&gt; MyData -&gt; Layer\ntake lname mydata = case lname of\n  Lay1Name -&gt; Lay1 (layer1 mydata)\n  Lay2Name -&gt; Lay2 (layer2 mydata)\n  Lay3Name -&gt; Lay3 (layer3 mydata)\n</code></pre>\n\n<p>And somehow it becomes huger and huger and the worst problem is that my <code>zipWith f</code> wants a list. And in <code>universalTransform</code> <code>layer</code> is <em>not</em> a list. It is a <code>Layer</code> abstraction. I was trying to befree <code>[ElementsX]</code> from inside of <code>Layer</code> but didn't succeed.</p>\n\n<p>I know I am looking in a wrong direction.</p>\n\n<p>So: how can I do that <strong>unification</strong>, but in a proper way, and not like ...ehmmm... me myself.</p>\n"}, {"tags": ["haskell", "types", "type-inference", "typeclass"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1477954862, "post_id": 40351748, "comment_id": 67958105, "body": "This is described in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1360006.4.1\" rel=\"nofollow noreferrer\">haskell report</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1477959805, "post_id": 40351748, "comment_id": 67959332, "body": "Suppose I gave <code>4</code> the type <code>Ord t =&gt; t</code>. Now I note that <code>Bool</code> is an instance of <code>Ord</code>. Therefore <code>4 :: Bool</code>. Should <code>4 :: Bool</code> be <code>True</code> or <code>False</code>, and why?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1477999344, "post_id": 40351748, "comment_id": 67971309, "body": "@Lee Btw, there is similar question regarding type defaulting rules: <a href=\"https://stackoverflow.com/questions/39251728/ghci-randomio-type-inference\" title=\"ghci randomio type inference\">stackoverflow.com/questions/39251728/&hellip;</a>  I tried to answer it and understand report but still has no clear view. Maybe more experienced <i>Haskell</i> users can help :)"}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1477957361, "post_id": 40351924, "comment_id": 67958773, "body": "Note that you explained why the type isn&#39;t <code>(Ord t, Num t) =&gt; t</code>, not why it isn&#39;t <code>(Ord t || Num t) =&gt; t</code> (which isn&#39;t valid syntax, but, I assume, is meant to say &quot;t might be an <code>Ord</code> <i>or</i> a <code>Num</code>)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1477957795, "post_id": 40351924, "comment_id": 67958877, "body": "@sepp2k That is true - I hadn&#39;t interpreted the <code>||</code> that way. That said, I think I indirectly answer this..."}, {"owner": {"reputation": 1185, "user_id": 1393971, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/2gqNV.jpg?s=128&g=1", "display_name": "Databyte", "link": "https://stackoverflow.com/users/1393971/databyte"}, "edited": false, "score": 0, "creation_date": 1477958601, "post_id": 40351924, "comment_id": 67959076, "body": "Ok thx. The thing with the` fromIntegral` in the Link provided by @Lee was very helpful. Even more helpful was the link to Section <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">3.4.3</a>. So when I write <code>(3&lt;4)</code>: to infer the actual type of <code>4</code> the compiler has to find a Type that satisfies <code>(Num t, Ord t) =&gt; t</code>, which could be one of <code>Int</code>, <code>Integer</code>, <code>Float</code>, <code>Double</code> (or even more with external Modules). That&#39;s ambiguous and would produce an Error. But for Num these ambiguities are resolved by defaulting to (in this case) Integer."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1477955550, "creation_date": 1477955550, "answer_id": 40351924, "question_id": 40351748, "link": "https://stackoverflow.com/questions/40351748/why-does-ghci-outputs-num-a-a-for-t-4-and-not-ord-a-a/40351924#40351924", "title": "Why does ghci outputs (Num a) =&gt; a for :t 4 and not (Ord a) =&gt; a?", "body": "<p>Not all types with instances for <code>Num</code> also have instances for <code>Ord</code>, and you only need the <code>fromInteger</code> part of <code>Num</code> to have the overloaded numeric literals Haskell has. For example, <code>Complex</code> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Complex.html\"><code>Data.Complex</code></a> has a <code>Num</code> instance but no <code>Ord</code>. In this case, <code>4</code> is <em>not</em> an <code>Ord</code>.</p>\n\n<pre><code>ghci&gt; import Data.Complex\nghci&gt; let x = 1 :: Complex Double\nghci&gt; let y = 2 :: Complex Double\nghci&gt; x &lt; y\n&lt;interactive&gt;\n    * No instance for (Ord (complex Double)) arising from use of `&lt;'\n    * In the expression: x &lt; y\n      In the equation for `it': it = x &lt; y\nghci&gt;\n</code></pre>\n\n<p>As @Lee commented, this is the behavior outlined in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1360006.4.1\">report</a>.</p>\n"}], "owner": {"reputation": 1185, "user_id": 1393971, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/2gqNV.jpg?s=128&g=1", "display_name": "Databyte", "link": "https://stackoverflow.com/users/1393971/databyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 40351924, "answer_count": 1, "score": 4, "last_activity_date": 1477955603, "creation_date": 1477954451, "question_id": 40351748, "link": "https://stackoverflow.com/questions/40351748/why-does-ghci-outputs-num-a-a-for-t-4-and-not-ord-a-a", "title": "Why does ghci outputs (Num a) =&gt; a for :t 4 and not (Ord a) =&gt; a?", "body": "<p>When I enter <code>:t 4</code> in ghci I get</p>\n\n<pre><code>Prelude&gt; :t 4\n4 :: Num t =&gt; t\n</code></pre>\n\n<p>I understand why <code>4</code> is not only an Int or an Integer and that it is infered bottom up but I do not understand why <code>4</code> is not shown as an <code>Ord t =&gt; t</code> or even more correct something like this:</p>\n\n<pre><code>4 :: (Ord t || Num t) =&gt; t\n</code></pre>\n\n<p>Because <code>4</code> is both an <code>Ord</code> and a <code>Num</code> but <code>Ord</code> and <code>Num</code> have no connection...</p>\n\n<p>So why does <code>:t 4</code> output only <code>Num</code>?</p>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1477944899, "post_id": 40349637, "comment_id": 67954232, "body": "That would require dependent types (found e.g. in Agda but not present in Haskell) or some Hasochistic type-level hackery. Both would not be terribly convenient, since they would force <i>you</i> to provide a proof of the &quot;groupiness&quot; of each instance you define. The compiler would not fill the proof obligation for you (albeit in the finite cases some Template Haskell might produce such a proof for you)."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1477945513, "post_id": 40349637, "comment_id": 67954548, "body": "You can&#39;t.  Sorry."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1478034061, "post_id": 40349637, "comment_id": 67990562, "body": "You might want to look into Coq for this. It is a dependently typed programming language that is also designed to assert and prove theorems about programs. It&#39;s overall design is somewhat similar to an &quot;extended&quot; Haskell with a bit different syntax. Here is how I might start in Coq (I have also proven here that your counterexample is indeed not a group): <a href=\"https://gist.github.com/roboguy13/8f52a2cdbac3f37ed31fe9662cf088e1\" rel=\"nofollow noreferrer\">gist.github.com/roboguy13/8f52a2cdbac3f37ed31fe9662cf088e1</a> . Coq also comes with a tool that extracts Haskell code from verified Coq code (so you can verify it in Coq then generate the Haskell version of the correct code)."}], "answers": [{"tags": [], "owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "is_accepted": false, "score": 6, "last_activity_date": 1477944861, "creation_date": 1477944861, "answer_id": 40349891, "question_id": 40349637, "link": "https://stackoverflow.com/questions/40349637/constraints-on-a-haskell-typeclass-for-the-definition-of-a-group/40349891#40349891", "title": "Constraints on a Haskell typeclass for the definition of a group", "body": "<p>You are right that it is possible to write instances of the <code>Group</code> typeclass which violates the group laws, because in fact there's nothing in the code actually stating them. </p>\n\n<p>This happens the same way for instance for the <code>Monad</code> class, where the monadic laws are not written nor enforced in any way. You can write an unlawful <code>Monad</code> instance, as you can write an unlawful <code>Group</code> instance. </p>\n\n<p>This is actually the best you can get in Haskell, at least without increasing the complexity of the type signature too much. In fact, to express the group laws in the type you will probably need a fully dependently typed language, which Haskell is not. </p>\n\n<p>In cases like this, laws are usually written in comments, maybe stated as rewrite rules, and programmers are usually disciplinate enough to respect them. </p>\n"}, {"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1477953019, "post_id": 40350188, "comment_id": 67957560, "body": "Whats the harm in moving <code>gappend</code> outside of the typeclass by using the <code>Group g</code> constraint and setting <code>gappend = mappend</code>? That way it&#39;s not overridable but behaves like <code>mappend</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1477962252, "post_id": 40350188, "comment_id": 67959866, "body": "None that I can see :)"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1477963466, "last_edit_date": 1477963466, "creation_date": 1477946137, "answer_id": 40350188, "question_id": 40349637, "link": "https://stackoverflow.com/questions/40349637/constraints-on-a-haskell-typeclass-for-the-definition-of-a-group/40350188#40350188", "title": "Constraints on a Haskell typeclass for the definition of a group", "body": "<p>You cannot enforce such laws, but you can document them. The <code>Monoid</code> class, for example, documents four laws that any instance of <code>Monoid</code> is expected to adhere to:</p>\n\n<pre><code>-- | The class of monoids (types with an associative binary operation that\n-- has an identity).  Instances should satisfy the following laws:\n--\n--  * @mappend mempty x = x@\n--\n--  * @mappend x mempty = x@\n--\n--  * @mappend x (mappend y z) = mappend (mappend x y) z@\n--\n--  * @mconcat = 'foldr' mappend mempty@\n</code></pre>\n\n<p>A group is just a monoid with an additional inverse operation. Make your <code>Group</code> class a subclass of <code>Monoid</code>; then you only need to document the additional law that your inverse operation must obey.</p>\n\n<pre><code>class Monoid g =&gt; Group g where\n  ginverse :: g -&gt; g\n  -- ginv must obey the following laws\n  -- x `gappend` (ginverse x) == gempty\n  -- (ginverse x) `gappend` x == gempty\n\n-- g-prefixed synonym for mappend\ngappend :: Group g =&gt; g -&gt; g -&gt; g\ngappend = mappend\n\n-- g-prefixed synonym for mempty\ngempty :: Group g =&gt; g\ngempty = mempty\n</code></pre>\n"}], "owner": {"reputation": 4800, "user_id": 46871, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/H7vPm.jpg?s=128&g=1", "display_name": "tlehman", "link": "https://stackoverflow.com/users/46871/tlehman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "accepted_answer_id": 40350188, "answer_count": 2, "score": 4, "last_activity_date": 1477963466, "creation_date": 1477943875, "question_id": 40349637, "link": "https://stackoverflow.com/questions/40349637/constraints-on-a-haskell-typeclass-for-the-definition-of-a-group", "title": "Constraints on a Haskell typeclass for the definition of a group", "body": "<p>I came up with this typeclass definition for a <a href=\"https://en.wikipedia.org/wiki/Group_(mathematics)#Definition\" rel=\"nofollow\">Group</a>, but I found a counterexample type that is not actually a group.</p>\n\n<p>Here is the class definition and an instance that is the group \u2124\u2082:</p>\n\n<pre><code>class Group g where\n  iden :: g\n  op :: g -&gt; g -&gt; g\n  inv :: g -&gt; g\n\ndata Z2T = Z0 | Z1\n\ninstance Group Z2T where\n  iden = Z0\n  Z0 `op` Z0 = Z0\n  Z0 `op` Z1 = Z1\n  Z1 `op` Z0 = Z1\n  Z1 `op` Z1 = Z0\n  inv Z0 = Z1\n  inv Z1 = Z0\n</code></pre>\n\n<p>However, those type signatures for <code>Group</code> are necessary, but not sufficient for a type to really be a group, here's my counterexample that compiles:</p>\n\n<pre><code>data NotAGroup = N0 | N1\n\ninstance Group NotAGroup where\n  iden = N0\n  N0 `op` N0 = N0\n  N1 `op` N0 = N0\n  N0 `op` N1 = N0\n  N1 `op` N1 = N0\n  inv N0 = N0\n  inv N1 = N0\n</code></pre>\n\n<p>How can I encode the sufficient rules for a type to be a group in the <code>Group</code> typeclass in Haskell?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "edited": false, "score": 0, "creation_date": 1477949106, "post_id": 40348521, "comment_id": 67956159, "body": "Thanks for the clarification and suggestion. However, my DirectedEdgeSet is more than just a type and also has methods. I didn&#39;t include it in the original post since I didn&#39;t know it mattered. Would you suggest another solution to my problem that is more haskell like perhaps? Or are there any other work-arounds?"}, {"owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "edited": false, "score": 0, "creation_date": 1477950584, "post_id": 40348521, "comment_id": 67956771, "body": "Oh yes, and it&#39;s actually written in the error message that it&#39;s universally quantified <code>edges :: forall c. EdgeSet c =&gt; Tree -&gt; c</code>. Yet difficult to catch for a beginners eye"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 5, "last_activity_date": 1477939423, "creation_date": 1477939423, "answer_id": 40348521, "question_id": 40348242, "link": "https://stackoverflow.com/questions/40348242/cant-match-class-type-with-specific-type-in-haskell/40348521#40348521", "title": "Can&#39;t match class type with specific type in haskell", "body": "<p>In <code>edges</code>, the type variable <code>c</code> is <em>universally quantified</em>. That means that <code>edges</code> must work for <em>all</em> types which are instances of <code>EdgeSet</code>. Your implementation fixes a concrete type and thus does not work for <em>all</em> <code>EdgeSet</code> instances.</p>\n\n<p>To fix this, you can specify the concrete type of edge set that the instance uses via type families:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata Tree = Tree\ndata DirectedEdgeSet = DirectedEdgeSet\n\nclass Graph a where\n  type GraphEdgeSet a :: *\n  edges :: a -&gt; GraphEdgeSet a\n\ninstance Graph Tree where\n  type GraphEdgeSet Tree = DirectedEdgeSet\n  edges tree = DirectedEdgeSet\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477944125, "post_id": 40348526, "comment_id": 67953827, "body": "Nice approach. I note that the type families solution is not perfectly adherent to the OP question, since the OP typeclass <code>EdgeSet</code> may have methods, which instead might be unavailable on the type family. I&#39;d be tempted to use <code>class (EdgeSet (ES a)) =&gt; Graph a where type ES a ; edges :: a -&gt; ES a</code> and turn on undecidable instances. Or, alternatively <code>class Graph a where ... ; getDict :: Dict (EdgeSet (ES a))</code> possibly with a nice <code>default</code> implementation so that instances will not have to state <code>getDict = Dict</code> every time."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477945361, "post_id": 40348526, "comment_id": 67954470, "body": "@chi I initially had the undecideable instances version typed up, but I thought I&#39;d wait and see if OP really had methods in <code>EdgeSet</code>."}, {"owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477948737, "post_id": 40348526, "comment_id": 67955971, "body": "Thank you for the clarifacation and solution suggestions. As @chi guessed, I actually have methods of the EdgeSet type. I edited to illustrate. Can you edit your answer?"}, {"owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "edited": false, "score": 0, "creation_date": 1477948896, "post_id": 40348526, "comment_id": 67956046, "body": "By the way, I never had to dive into Haskell extensions. I don&#39;t want to do anything that isn&#39;t haskell-ideomatic! Perhaps my OO-mindset is misleading me. I would be open to redesigning my solution in a more functional style and would be happy for any tips and pointers"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477950076, "post_id": 40348526, "comment_id": 67956578, "body": "@Isund Many Haskell extensions are very idiomatic nowadays. While Haskell98 and 2010 are nice basic languages, many haskellers nowadays make use of many GHC extensions in everyday code. There are some extensions which are regarded as &quot;bad(-dish)&quot;, though. <code>UndecidableInstances</code> is still OK-ish: the worst it can do, when misused, is to make the compiler loop forever. But, if the compiler terminates, the resulting program does not break any nice property of Haskell. (Unlike e.g. overlapping/incoherent instances which are evil, and make the code fragile.)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477952695, "post_id": 40348526, "comment_id": 67957469, "body": "@Isund Updated!"}, {"owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "edited": false, "score": 0, "creation_date": 1478011150, "post_id": 40348526, "comment_id": 67977609, "body": "Thank you. This is what I was looking for"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1477952683, "last_edit_date": 1477952683, "creation_date": 1477939435, "answer_id": 40348526, "question_id": 40348242, "link": "https://stackoverflow.com/questions/40348242/cant-match-class-type-with-specific-type-in-haskell/40348526#40348526", "title": "Can&#39;t match class type with specific type in haskell", "body": "<p>You are misunderstanding the type of the class method; <code>edges :: EdgeSet c =&gt; a -&gt; c</code> is a function which takes <em>any</em> <code>a</code> (constrained with <code>a</code> being an instance of <code>Graph</code>) and returns <em>any</em> <code>c</code> (constrained with <code>c</code> being an instance of <code>EdgeSet c</code>). You probably instead want to say it returns <em>some</em> <code>c</code> obeying the aforementioned constraint.</p>\n\n<h3>Haskell 98 solution</h3>\n\n<p>You could just require that edges return an actual <code>Set</code> (like the one from <code>Data.Set</code>) for all graphs:</p>\n\n<pre><code>class Graph a where\n  edges :: a -&gt; Data.Set Edge\n</code></pre>\n\n<h3><code>ExistentialQuantification</code> solution</h3>\n\n<p>Otherwise, you can use the <code>ExistentialQuantification</code> extension and modify the class method:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata SomeEdgeSet = forall c. EdgeSet c =&gt; SomeEdgeSet c\n\nclass Graph a where\n  edges :: a -&gt; SomeEdgeSet \n\ninstance Graph Tree where\n  edges tree = SomeEdgeSet DirectedEdgeSet\n</code></pre>\n\n<p>As you can tell, each one of your instances of <code>Graph</code> all return <code>SomeEdgeSet</code> when <code>edges</code> is used, but that <code>SomeEdgeSet</code> contains anything, as long as that thing is an instance of <code>EdgeSet</code>.</p>\n\n<h3><code>TypeFamilies</code> solution</h3>\n\n<p>This is the solution I recommend. In general, for any <code>Graph</code>, you will only ever have <em>one</em> type of <code>Edges</code> it returns. Then, there is this cool feature with <code>TypeFamilies</code> where you can declare a type inside a class:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, UndecideableInstances #-}\n\nclass (EdgeSet (Edges a)) =&gt; Graph a where\n  type Edges a\n  edges :: a -&gt; Edges a\n</code></pre>\n\n<p>Then, suppose that your representation of edges for <code>Graph Tree</code> is <code>DirectedEdgeSet</code>, your instance will look like:</p>\n\n<pre><code>class Graph Tree where\n  type Edges Tree = DirectedEdgeSet -- `DirectedEdgeSet` is the type here\n  edges tree = DirectedEdgeSet      -- `DirectedEdgeSet` is the constructor here\n</code></pre>\n"}], "owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 40348526, "answer_count": 2, "score": 3, "last_activity_date": 1477952683, "creation_date": 1477938336, "last_edit_date": 1477948798, "question_id": 40348242, "link": "https://stackoverflow.com/questions/40348242/cant-match-class-type-with-specific-type-in-haskell", "title": "Can&#39;t match class type with specific type in haskell", "body": "<p>I have the following situation in my code (simplified but semantically identical)</p>\n\n<pre><code>class Graph a where\n    edges :: EdgeSet c =&gt; a -&gt; c\n</code></pre>\n\n<p>I have many subtypes that fulfill the graph interface. One of them is a tree</p>\n\n<pre><code>data Tree = Tree\n\ninstance Graph Tree where\n    edges tree = DirectedEdgeSet\n</code></pre>\n\n<p>A call on the edges method should return a <code>DirectedEdgeSet</code>. This should be OK since <code>DirectedEdgeSet</code> implements the <code>EdgeSet</code> class:</p>\n\n<pre><code>type Edge = (Int, Int)\ndata DirectedEdgeSet = DirectedEdgeSet (Set Edge) Int\n\nclass EdgeSet c where\n    content :: c -&gt; Set Edge\n    size :: c -&gt; Int\n\ninstance EdgeSet DirectedEdgeSet where\n    content (DirectedEdgeSet es _) = es\n    size (DirectedEdgeSet _ x) = x \n</code></pre>\n\n<p>This example does not compile:</p>\n\n<pre><code>   \u2022 Couldn't match expected type \u2018c\u2019\n                  with actual type \u2018DirectedEdgeSet\u2019\n      \u2018c\u2019 is a rigid type variable bound by\n        the type signature for:\n          edges :: forall c. EdgeSet c =&gt; Tree -&gt; c\n        at Tree.hs:10:5\n    \u2022 In the expression: DirectedEdgeSet\n      In an equation for \u2018edges\u2019: edges tree = DirectedEdgeSet\n      In the instance declaration for \u2018Graph Tree\u2019\n    \u2022 Relevant bindings include\n        edges :: Tree -&gt; c (bound at Tree.hs:10:5)\n</code></pre>\n\n<p>Can someone tell me what I am doing wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1477937337, "post_id": 40347816, "comment_id": 67950385, "body": "By defining the automatically defined <code>Show</code> and <code>Read</code> instances, you technically break the abstraction completely - this is what you are observing. If you expose a <code>Show</code> instance, it should be e.g. <code>show (AccountId x) = show x</code>. Note that <code>Eq</code> and <code>Ord</code> don&#39;t really have such problems."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1477937624, "post_id": 40347816, "comment_id": 67950547, "body": "It is better not to rely on <code>show</code> to provide on its own the string representation specified by your requirements. Define a special-purpose <code>AccountId -&gt; Text</code> function instead. See also: <a href=\"http://stackoverflow.com/q/8217511/2751851\"><i>Haskell: show and pretty-print instance</i></a>."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 4, "creation_date": 1477938420, "post_id": 40347816, "comment_id": 67950977, "body": "The type system <i>did</i> prevent this mistake until you circumvented it by converting your value into a string."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1477940079, "post_id": 40347816, "comment_id": 67951903, "body": "Or until you instanciated Show."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477940638, "post_id": 40347816, "comment_id": 67952181, "body": "If the third-party library relies on the supplied text to contain bare numbers, then its interface is wrong \u2013 why doesn&#39;t it accept numbers directly?"}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1477941340, "post_id": 40347816, "comment_id": 67952501, "body": "@user2297560 Could you clarify how this was prevented by the type system and how did I circumvent it? I may be misunderstanding what you are saying but in this instance I have little choice in interacting with a third-party API which expects string inputs."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477941915, "post_id": 40347816, "comment_id": 67952777, "body": "@leftaroundabout third-party library talks to a third-party API that can filter on user-defined tags which don&#39;t have any types associated with them :-(  A tag called <code>accountId</code> can be added but no type can be specified, hence the strings.. Not a fault of the library."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477942949, "post_id": 40347816, "comment_id": 67953254, "body": "Then why is there a problem? If the library only <i>filters</i> on those tags then again it shouldn&#39;t matter whether you have the text <code>&quot;AccountId 123&quot;</code> or only <code>&quot;123&quot;</code>, as long as it&#39;s consistent (like the <code>Show</code> instance is)."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477943737, "post_id": 40347816, "comment_id": 67953635, "body": "@leftaroundabout I&#39;m sorry but I&#39;m not sure I follow - how could filtering by different values yield the same results? What am I missing?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477944759, "post_id": 40347816, "comment_id": 67954162, "body": "You don&#39;t filter by different values. You either filter only values starting with <code>&quot;AccountId&quot;</code>, or only values containing just a number. If the library doesn&#39;t care what those strings contain, this shouldn&#39;t matter, it just needs to be done consistently throughout the application."}], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1477944997, "post_id": 40348758, "comment_id": 67954283, "body": "Thank you. Wouldn&#39;t adding a typeclass like <code>Display</code> open up the same way for making errors as <code>Show</code> by possibly bringing a different instance in scope? And wouldn&#39;t be this tight coupling beneficial if I want to talk specifically about accounts and their id&#39;s? In any case thank you for the answer and your help :)."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1477945082, "post_id": 40348758, "comment_id": 67954329, "body": "Yes, but it is your typeclass and you are in control of the instances. I mentioned the tight coupling to an implementation because your original concern was being able to change your implementation. If you want tight coupling, you can have it."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1477952200, "post_id": 40348758, "comment_id": 67957296, "body": "Thanks again, Rein. I&#39;m not quite sure how I could re-use this typeclass - even being in control I could only introduce the instances you listed, otherwise I would risk mixing in a different type that can be converted to <code>Text</code>, so it wouldn&#39;t be much different from the monomorphic functions?"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 4, "last_activity_date": 1477940259, "creation_date": 1477940259, "answer_id": 40348758, "question_id": 40347816, "link": "https://stackoverflow.com/questions/40347816/is-it-possible-to-catch-this-mistake-using-the-type-system-or-a-different-desig/40348758#40348758", "title": "Is it possible to catch this mistake using the type system, or a different design?", "body": "<p>Show is a general purpose debugging tool and is not intended for display purposes. (Its intended use case is specifically to produce a <em>readable</em> (as in <code>read</code> and <code>Read</code>) string version of your data.) Because it is general purpose, <code>show</code> does not sufficiently restrict the types on which it operates to be safe for <em>your</em> use case. You can, instead, write display functions that are specific to the types you want to display:</p>\n\n<pre><code>displayInt :: Int -&gt; Text\ndisplayInt = T.pack . show\n\ndisplayAccountId :: AccountId -&gt; Text\ndisplayAccountId (AccountId x) = displayInt x\n\ndisplayAccount :: Account -&gt; Text\ndisplayAccount = displayAccountId . accountId\n</code></pre>\n\n<p>This guarantees that an account can only be displayed as the int representation of its id. Of course, this implementation is highly coupled to the implementation of <code>Account</code> and <code>AccountId</code>. To reduce this coupling, a typeclass can be added:</p>\n\n<pre><code>class Display a where\n    display :: a -&gt; Text\n\ninstance Display Int where\n    display = T.pack . show\n\ninstance Display AccountId where\n    display (AccountId x) = display x\n\ninstance Display Account where\n    display = display . accountId\n</code></pre>\n\n<p>This maintains the type safety (you can't accidentally <code>show</code> the wrong thing any more) while solving\u2014to some extent\u2014this particular instance of the expression problem.</p>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 40348758, "answer_count": 1, "score": 2, "last_activity_date": 1477940259, "creation_date": 1477936729, "question_id": 40347816, "link": "https://stackoverflow.com/questions/40347816/is-it-possible-to-catch-this-mistake-using-the-type-system-or-a-different-desig", "title": "Is it possible to catch this mistake using the type system, or a different design?", "body": "<p>I was working on a small refactoring which involved converting a part of a data type from an <code>Int</code> type into a newtype wrapper. Before:</p>\n\n<p></p>\n\n<pre><code>data Account = Account {\n  accountId :: Int\n} deriving (Eq, Show)\n</code></pre>\n\n<p>After:</p>\n\n<p></p>\n\n<pre><code>newtype AccountId = AccountId Int deriving (Eq, Ord, Read, Show)\n\ndata Account = Account {\n  accountId :: AccountId\n} deriving (Eq, Show)\n</code></pre>\n\n<p>In another part of the program I'm passing <code>accountId</code> into a function from a third-party library for the purpose of filtering the results it returns. However the filters expect <code>Text</code> input, and to convert <code>accountId</code> into that I used the following:</p>\n\n\n\n<pre><code>Text.pack $ show $ accountId someAccount\n</code></pre>\n\n<p>This resulted in wrong results being returned at runtime after the refactoring due to difference in <code>Show</code> instances (<code>\"123\"</code> vs <code>\"AccountId 123\"</code>). </p>\n\n<p>Is there a way, either utilising the type system or a different way to convert into <code>Text</code>, that would catch this at compile time? One solution that comes to mind would be defining a helper function that takes the result of <code>accountId someAccount</code> and converts that into <code>Text</code> but perhaps there is a different/better option/pattern I'm not aware of.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1477930240, "post_id": 40345838, "comment_id": 67946534, "body": "If you are <i>conceptually thinking of strings</i>, then why do you need the type-level distinction? The point of a different type is that you think about something conceptually different, even if the actual implementation is a string."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1477948353, "post_id": 40345838, "comment_id": 67955787, "body": "I think <code>GeneralizedNewtypeDeriving</code> is often a better answer than using something like <code>coerce</code> (which the answers here seem to focus on), but it depends on the situation."}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1477930220, "post_id": 40346082, "comment_id": 67946525, "body": "This is elegant; however, you&#39;ll still be having to create these wrapper functions for each function type.  And what if <code>StringWrapper1</code> is embedded into a record data structure? There still seems to be a lot of duplication."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1477930242, "post_id": 40346082, "comment_id": 67946538, "body": "But at the end of the day: is the solution in your post the idiomatic  Haskell approach?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1477930793, "post_id": 40346082, "comment_id": 67946879, "body": "@George Note however that &quot;to create these wrapper functions&quot; amounts to using <code>wrap f</code> where I would have used <code>f</code>. There is no need to provide a definition for all such functions with its own identifier. I&#39;d just define the plain <code>f</code> and make the caller use <code>wrap f</code> whenever needed. No duplication."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 2, "last_activity_date": 1477930087, "creation_date": 1477930087, "answer_id": 40346082, "question_id": 40345838, "link": "https://stackoverflow.com/questions/40345838/what-is-the-idiomatic-way-to-build-functions-over-newtypes-wrapped-types-in/40346082#40346082", "title": "What is the idiomatic way to build functions over newtypes (&quot;wrapped types&quot;) in Haskell?", "body": "<p>Why not just write a function that will wrap any other function?</p>\n\n<pre><code>wrap :: (String -&gt; String) -&gt; StringWrapper1 -&gt; StringWrapper2\nwrap f (StringWrapper1 str) = StringWrapper2 (f str)\n</code></pre>\n\n<p>This will lift any <code>String -&gt; String</code> into a <code>StringWrapper1 -&gt; StringWrapper2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1477932288, "last_edit_date": 1495541795, "creation_date": 1477930638, "answer_id": 40346223, "question_id": 40345838, "link": "https://stackoverflow.com/questions/40345838/what-is-the-idiomatic-way-to-build-functions-over-newtypes-wrapped-types-in/40346223#40346223", "title": "What is the idiomatic way to build functions over newtypes (&quot;wrapped types&quot;) in Haskell?", "body": "<p>First of all, you should take into account leftaroundabout's comment and make sure the newytpes are actually meaningful. That said, this sort of wrapping and unwrapping is everyday stuff indeed, but you can make it more convenient. One way is taking advantage of how your string wrappers are monomorphic functors (as opposed to <code>Functor</code>s, which are polymorphic), and so you can write mapping functions such as:</p>\n\n<pre><code>mapWrapper1 :: (String -&gt; String) -&gt; StringWrapper1 -&gt; StringWrapper1\nmapWrapper1 f (StringWrapper1 str) = StringWrapper1 (f str)\n\nmapWrapper2 :: (String -&gt; String) -&gt; StringWrapper2 -&gt; StringWrapper2\nmapWrapper2 f (StringWrapper2 str) = StringWrapper2 (f str)\n</code></pre>\n\n<p>A well-known generalisation of this pattern is the <a href=\"https://www.stackage.org/haddock/lts-7.6/mono-traversable-1.0.1/Data-MonoTraversable.html#t:MonoFunctor\" rel=\"nofollow noreferrer\"><code>MonoFunctor</code></a> class from the <em>mono-traversable</em> package.</p>\n\n<p>It is also easy to define a conversion function between the two wrappers (in fancy jargon, we would say it is a natural transformation between the two functors):</p>\n\n<pre><code>rewrap1as2 :: StringWrapper1 -&gt; StringWrapper2\nrewrap1as2 (StringWrapper1 str) = StringWrapper2 str\n</code></pre>\n\n<p>(<code>rewrap1as2</code> can be implemented simply as <code>coerce</code> from <code>Data.Coerce</code>. See <a href=\"https://stackoverflow.com/a/40346504/2751851\">David Young's answer</a> for details.)</p>\n\n<p>The <code>wrap</code> from <a href=\"https://stackoverflow.com/a/40346082/2751851\">user2297560's answer</a> can then be defined in terms of these more elementary functions:</p>\n\n<pre><code>mapAndRewrap1as2 :: (String -&gt; String) -&gt; StringWrapper1 -&gt; StringWrapper2\nmapAndRewrap1as2 f = rewrap1as2 . mapWrapper1 f\n</code></pre>\n\n<p>If you want something even less verbose, you might appreciate the <a href=\"https://hackage.haskell.org/package/newtype-0.2\" rel=\"nofollow noreferrer\"><em>newtype</em></a> package, or the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Wrapped.html\" rel=\"nofollow noreferrer\">equivalent <code>Iso</code>s provided by <em>lens</em></a>. That, however, is probably worth a separate answer.</p>\n"}, {"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1477931724, "post_id": 40346504, "comment_id": 67947463, "body": "This seems to be the most elegant. Is its use frowned upon?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1477931823, "post_id": 40346504, "comment_id": 67947525, "body": "@George No, I have never seen it frowned upon if this is actually what you want to do (usually you want a newtype to be &quot;opaque&quot; outside at some point though. Usually outside of the module its defined in). <code>coerce</code> also has zero overhead (which is not the case for the wrapping/unwrapping solution) because it is eliminated during compilation. Note that <code>coerce</code> is very different from <code>unsafeCoerce</code>. <code>coerce</code> is always safe."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1477935195, "post_id": 40346504, "comment_id": 67949314, "body": "The wrapping and unwrapping solution also has zero overhead."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1477935388, "post_id": 40346504, "comment_id": 67949410, "body": "@BenjaminHodgson Ahh, that&#39;s right. The overhead difference would come into play if you had something like <code>map (\\(StringWrapper1 str) -&gt; str) wrappers</code> vs <code>coerce wrappers :: [String]</code>."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 5, "last_activity_date": 1477941349, "last_edit_date": 1477941349, "creation_date": 1477931654, "answer_id": 40346504, "question_id": 40345838, "link": "https://stackoverflow.com/questions/40345838/what-is-the-idiomatic-way-to-build-functions-over-newtypes-wrapped-types-in/40346504#40346504", "title": "What is the idiomatic way to build functions over newtypes (&quot;wrapped types&quot;) in Haskell?", "body": "<p>As others have said, you should make sure this is really what you want to do (see leftaroundabout's comment). If it is, you can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow\"><code>coerce</code> from the standard library</a> to convert between types that have the same runtime representation:</p>\n\n<pre><code>func :: String -&gt; String\nfunc = ...\n\n...\n\nfuncWrapper :: StringWrapper1 -&gt; StringWrapper2\nfuncWrapper = coerce func\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1478003134, "creation_date": 1478003134, "answer_id": 40360037, "question_id": 40345838, "link": "https://stackoverflow.com/questions/40345838/what-is-the-idiomatic-way-to-build-functions-over-newtypes-wrapped-types-in/40360037#40360037", "title": "What is the idiomatic way to build functions over newtypes (&quot;wrapped types&quot;) in Haskell?", "body": "<p>Using the <a href=\"http://hackage.haskell.org/package/newtype-generics-0.5\" rel=\"nofollow noreferrer\"><em>newtype-generics</em></a> package, one can write something like</p>\n\n<pre><code>{-# language DeriveGeneric #-}\nmodule Main where\n\nimport GHC.Generics\nimport Control.Newtype (Newtype,over)\n\nnewtype StringWrapper1 = StringWrapper1 String deriving Generic\n\ninstance Newtype StringWrapper1\n\nnewtype StringWrapper2 = StringWrapper2 String deriving Generic\n\ninstance Newtype StringWrapper2\n\nfunc :: String -&gt; String\nfunc = undefined\n\nfuncWrapper :: StringWrapper1 -&gt; StringWrapper2\nfuncWrapper = over StringWrapper1 func\n</code></pre>\n\n<p>I would not define the wrapper function and instead use <a href=\"http://hackage.haskell.org/package/newtype-generics-0.5/docs/Control-Newtype.html#v:over\" rel=\"nofollow noreferrer\"><code>over</code></a> at each site.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1478003134, "creation_date": 1477929250, "question_id": 40345838, "link": "https://stackoverflow.com/questions/40345838/what-is-the-idiomatic-way-to-build-functions-over-newtypes-wrapped-types-in", "title": "What is the idiomatic way to build functions over newtypes (&quot;wrapped types&quot;) in Haskell?", "body": "<p>Let <code>StringWrapper1</code> and <code>StringWrapper2</code> be two types that wrap over a string (i.e. <code>newtype StringWrapper1 = StringWrapper1 String</code> and <code>newtype StringWrapper2 = StringWrapper2</code>).</p>\n\n<p>Now suppose we're trying to craft a function from <code>StringWrapper1</code> to <code>StringWrapper2</code>. </p>\n\n<pre><code>funcWrapper :: StringWrapper1 -&gt; StringWrapper2\n</code></pre>\n\n<p>On the one hand, we want to be explicit that what we're passing into this function is a <code>StringWrapper1</code>, so we don't want merely treat <code>StringWrapper1</code> as a type synonym for <code>String</code> (that leads to bugs, as my own experience can attest). On the other hand, when conceptually building the function, we are still somehow thinking in terms of <code>String</code>s. What we want to do then is to first build <code>func</code> which doesn't us to constantly wrap and unwrap types:</p>\n\n<pre><code>func :: String -&gt; String\n</code></pre>\n\n<p>Then, we use <code>func</code> to build <code>funcWrapper</code>:</p>\n\n<pre><code>funcWrapper :: StringWrapper1 -&gt; StringWrapper2\nfuncWrapper (StringWrapper1 str) = StringWrapper2 (func str)\n</code></pre>\n\n<p><strong>Problem/Question:</strong> Is this idiomatic? It seems awkward to constantly be duplicating every function with a <code>func</code> and a <code>funcWrapper</code>. Does Haskell provide some other way of doing this that I'm missing? Or should I just use type synonyms?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477929011, "post_id": 40345495, "comment_id": 67945717, "body": "That code causes a different error from the one you&#39;re quoting. Please edit your question to include the full and exact error message."}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1477929492, "post_id": 40345495, "comment_id": 67946047, "body": "sidenote : you can make <code>werpDobbelstenen</code> tail recursive :)"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1477929638, "post_id": 40345495, "comment_id": 67946134, "body": "by the way, how does <code>worp</code> compile ? <code>[werpDobbelstenen (8-length d),d]</code> is not a homogeneous list !!"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477930062, "post_id": 40345972, "comment_id": 67946424, "body": "I don&#39;t think I&#39;ve answered  your actual question; my definition of <code>worp&#39;</code> doesn&#39;t really correspond to the pair of lists you want. However, I do stand by my suggested definition of <code>werpDobbelstenen</code>, if that helped you solve your own problem."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1477931226, "post_id": 40345972, "comment_id": 67947143, "body": "I like the comment in <code>import Control.Monad  -- replicateM</code>, but a qualified <code>import Control.Monad (replicateM)</code> is even better."}, {"owner": {"reputation": 17, "user_id": 6032856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SWffB.jpg?s=128&g=1", "display_name": "ergoforce", "link": "https://stackoverflow.com/users/6032856/ergoforce"}, "edited": false, "score": 0, "creation_date": 1477931970, "post_id": 40345972, "comment_id": 67947626, "body": "Yes, thank you! :) This is exactly what i wanted, but you made a typo at line 7, &quot; worp &quot; should be &quot; worp&#39; &quot;"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1477933040, "last_edit_date": 1477933040, "creation_date": 1477929707, "answer_id": 40345972, "question_id": 40345495, "link": "https://stackoverflow.com/questions/40345495/how-can-i-get-8-x-random-values-in-haskell/40345972#40345972", "title": "How can I get 8-x random values in Haskell?", "body": "<p>First, I would return an <code>IO [Int]</code> value for simplicity:</p>\n\n<pre><code>import Control.Monad  -- replicateM\nimport System.Random  -- randomRIO\n\nwerpDobbelstenen :: Int -&gt; IO [Int]\nwerpDobbelstenen n = replicateM n (randomRIO (1,6))\n</code></pre>\n\n<p>Now, define your <code>worp</code> more simply, as one that simply takes a list of <code>Int</code> and returns the desired pair of lists.</p>\n\n<pre><code>worp' :: [Int] -&gt; ([Int], [Int])\nworp' d = (d, map (\\x -&gt; x - length d) d)\n</code></pre>\n\n<p>And finally, you can simply map <code>worp</code> over the result of <code>werpDobbelstenen</code> to get an <code>IO ([Int], [Int])</code> value.</p>\n\n<pre><code>worp :: Int -&gt; IO ([Int], [Int])\nworp n = fmap worp' (werpDobbelstenen n)\n</code></pre>\n\n<hr>\n\n<p>After a little more thinking, I think this is what you want:</p>\n\n<pre><code>import Control.Monad  -- replicateM\nimport System.Random  -- randomRIO\n\nwerpDobbelstenen :: Int -&gt; IO [Int]\nwerpDobbelstenen n = replicateM n (randomRIO (1,6))\n\nworp' :: [Int] -&gt; IO ([Int],  [Int])\nworp' d = let n = 8 - length d\n          in do d' &lt;- werpDobbelstenen n\n                return (d, d')\n\nworp :: Int -&gt; IO ([Int], [Int])\nworp n = werpDobbelstenen n &gt;&gt;= worp'\n\n&gt;&gt;&gt; worp 6\n([4,1,2,5,6,4],[1,2])\n</code></pre>\n\n<p>In this case, the second value of the tuple is always an empty list for <code>n &gt;= 8</code>. You may want to do something different for values larger than 8.</p>\n"}], "owner": {"reputation": 17, "user_id": 6032856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SWffB.jpg?s=128&g=1", "display_name": "ergoforce", "link": "https://stackoverflow.com/users/6032856/ergoforce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 40345972, "answer_count": 1, "score": 0, "last_activity_date": 1477933040, "creation_date": 1477928211, "last_edit_date": 1477929549, "question_id": 40345495, "link": "https://stackoverflow.com/questions/40345495/how-can-i-get-8-x-random-values-in-haskell", "title": "How can I get 8-x random values in Haskell?", "body": "<p>I'm trying to make a function worp that returns 2 lists of integers.</p>\n\n<p>Where the first list of integers is the result of 8 minus the length of the input list, dice throws.</p>\n\n<p>And the second list is the input list.</p>\n\n<p>This is my code:</p>\n\n<pre><code>import System.Random\n\nworp :: [Int] -&gt; [[IO Int]]\nworp d = [werpDobbelstenen (8-length d),d]\n\nwerpDobbelstenen :: Int -&gt; [IO Int]\nwerpDobbelstenen 0 = []\nwerpDobbelstenen x = randomRIO (1,6):werpDobbelstenen x-1\n</code></pre>\n\n<p>Im getting this error:</p>\n\n<pre><code>System.IO&gt; :load \"X:\\\\haskell\\\\dobbel.hs\"\nERROR file:.\\dobbel.hs:17 - Instance of Num [IO Int] required for definitio of werpDobbelstenen\n</code></pre>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 11591, "user_id": 1097347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/efffb39e9e98d002a5b9afe2fde7e50d?s=128&d=identicon&r=PG", "display_name": "Uri Goren", "link": "https://stackoverflow.com/users/1097347/uri-goren"}, "edited": false, "score": 0, "creation_date": 1477916835, "post_id": 40342060, "comment_id": 67938309, "body": "The tuple size defines its type, why not use list instead ?"}, {"owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "reply_to_user": {"reputation": 11591, "user_id": 1097347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/efffb39e9e98d002a5b9afe2fde7e50d?s=128&d=identicon&r=PG", "display_name": "Uri Goren", "link": "https://stackoverflow.com/users/1097347/uri-goren"}, "edited": false, "score": 0, "creation_date": 1477916971, "post_id": 40342060, "comment_id": 67938381, "body": "i want to extend this function for use beyond its current use, currently it is acting on a specific tuple of known size, i now have a completely different problem, and i dont want to rewrite the function"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1477919293, "post_id": 40342060, "comment_id": 67939691, "body": "You will have to rewrite the function anyway, and you should use lists instead of tuples. See also <a href=\"http://stackoverflow.com/q/31497468/2751851\"><i>Why do we use tuples, if we can use a two dimensional list?</i></a>, of which your question is a mirror image."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1477919407, "post_id": 40342060, "comment_id": 67939775, "body": "what would the type of such a function be?"}, {"owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "edited": false, "score": 0, "creation_date": 1477920547, "post_id": 40342060, "comment_id": 67940430, "body": "the type would be ([a]) -&gt; [(a)], but i really have no idea, i dont know very much about haskell yet. i know the benifits of lists over tuples, but i need a tuple so i can pass a function with only two parameters to a foldl that happens later."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1477921429, "post_id": 40342060, "comment_id": 67940938, "body": "It is not a question of benefits; they are simply meant for different situations. If you have a variable number of things with the same type, you want a list. If you have a fixed number of things with different types, you want a tuple. As for the fold you mention, it is almost certain that there is a way of writing it that doesn&#39;t require building tuples of arbitrary size. You should edit the question to tell us more about that fold, as it will make your difficulty easier to grasp."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1477924652, "post_id": 40342060, "comment_id": 67942886, "body": "So you want <code>unzip</code>?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1477933149, "post_id": 40342060, "comment_id": 67948240, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/2468226/how-to-zip-multiple-lists-in-haskell\">How to zip multiple lists in Haskell?</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477989518, "post_id": 40342060, "comment_id": 67966411, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell\">How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1506553487, "last_edit_date": 1506553487, "creation_date": 1478052632, "answer_id": 40371438, "question_id": 40342060, "link": "https://stackoverflow.com/questions/40342060/convert-a-tuple-of-lists-of-the-same-length-to-a-list-of-tuples-for-arbitrary/40371438#40371438", "title": "Convert a tuple of lists of the same length to a list of tuples for arbitrary -- Haskell", "body": "<p>As is usual with this kind of questions, the answer to 'should you' and 'can you' are different. Here, I will answer strictly the second.</p>\n\n<p>The first part of solving this is a representation of n-ary tuples, or (to sound extra fancy) products. Let's do that (without using any imports so that the whole thing remains self-contained, and also because on the machine I'm currently on, Stack is misbehaving):</p>\n\n<pre><code>{-# language DataKinds, KindSignatures, TypeOperators, GADTs #-}\n{-# language FlexibleInstances, FlexibleContexts #-}\n{-# language TypeFamilies #-} -- This will be needed later\n\ndata Product (ts :: [*]) where\n    Nil :: Product '[]\n    Cons :: t -&gt; Product ts -&gt; Product (t ': ts)\n\ninstance Show (Product '[]) where\n    show Nil = \"()\"\n\ninstance (Show t, Show (Product ts)) =&gt; Show (Product (t ': ts)) where\n    show (Cons x xs) = let '(':s = show xs\n                       in concat [\"(\", show x, \",\", s]\n</code></pre>\n\n<p>So this gives us a way to write something like</p>\n\n<pre><code>*Main&gt; myPair = Cons 1 $ Cons \"Foo\" $ Cons True Nil \n*Main&gt; :t myPair\nmyPair :: Num t =&gt; Product '[t, [Char], Bool]\n*Main&gt; myLists = Cons [1, 2] $ Cons [\"Foo\", \"Bar\", \"Baz\"] Nil\n*Main&gt; :t myLists\nmyLists :: Num t =&gt; Product '[[t], [[Char]]]\n</code></pre>\n\n<p>Using this type, at least we can start thinking about what the type of our n-ary zipping function <code>zipN</code> should be:</p>\n\n<pre><code>zipN :: Product '[[a], [b], ...] -&gt; [Product '[a, b, ...]]\n</code></pre>\n\n<p>however, we still need a way to somehow convert that tuple-of-lists <code>Product '[[a], [b], ...]</code> into a tuple-of-elements <code>Product '[a, b, ...]</code>. What I've found easiest is using an associated type family to do the conversion and the actual zipping in lockstep:</p>\n\n<pre><code>class IsLists (ts :: [*]) where\n    type Unlists ts :: [*]\n    zipN :: Product ts -&gt; [Product (Unlists ts)]\n\ninstance IsLists '[] where\n    type Unlists '[] = '[]\n    zipN Nil = []\n\ninstance (IsLists ts) =&gt; IsLists ([t] ': ts) where\n    type Unlists ([t] ': ts) = t ': Unlists ts\n\n    -- Handling the tail is special to ensure we don't end up zipping everything\n    -- with the empty list coming from zipN []\n    zipN (Cons xs yss) = case yss of\n        Nil -&gt; map (`Cons` Nil) xs\n        _ -&gt; zipWith Cons xs (zipN yss)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>*Main&gt; zipN myLists\n[(1,\"Foo\",),(2,\"Bar\",)]\n*Main&gt; :t it\nit :: Num t =&gt; [Product '[t, [Char]]]\n</code></pre>\n\n<p>Note that this behaves like regular <code>zip</code> in that the result list's length is specified by the shortest list in the tuple. </p>\n"}], "owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 40371438, "answer_count": 1, "score": 1, "last_activity_date": 1506553487, "creation_date": 1477916359, "last_edit_date": 1478054164, "question_id": 40342060, "link": "https://stackoverflow.com/questions/40342060/convert-a-tuple-of-lists-of-the-same-length-to-a-list-of-tuples-for-arbitrary", "title": "Convert a tuple of lists of the same length to a list of tuples for arbitrary -- Haskell", "body": "<p>I'm trying to convert a tuple of lists of the same length:\n<code>([Int], [Int], ..)</code> to  a list of tuples <code>[(Int, Int, ...)]</code>. This can be accomplished for predetermined sizes with the following code:</p>\n\n<pre><code>buildList :: ([a], [a], [a], [a], [a], [a], [a], [a]) -&gt; [(a, a, a, a, a, a, a, a)]           \nbuildList ([], [], [], [], [], [], [], []) = []                                               \nbuildList (a:as, b:bs, c:cs, d:ds, e:es, f:fs, g:gs, h:hs) = (a, b, c, d, e, f, g, h) : buildList (as, bs, cs, ds, es, fs, gs, hs)\n</code></pre>\n\n<p>As you can probably see, this isn't going to be pretty when I need a lot of items in the list, and it would be much cleaner if it worked for any arbitrary value.  </p>\n\n<p>So my questions is, do you have a function that preforms this operation for tuples of arbitrary length?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1477914399, "creation_date": 1477914399, "answer_id": 40341552, "question_id": 40341479, "link": "https://stackoverflow.com/questions/40341479/foldl-expression-not-compiling-due-to-use-of-literal/40341552#40341552", "title": "foldl expression not compiling due to use of literal", "body": "<p>When you don't find the element, the result of your function is <code>0</code>. That only makes sense if you're working with a list of numbers. If you pass in a list of strings and then return either a string from the list or the number <code>0</code>, that'd be a clear type error.</p>\n\n<p>So your function only works with lists of numbers and your type signature must reflect that by adding a <code>Num a</code> constraint.</p>\n\n<p>However a better solution would be to not use <code>0</code> as the default value and use a <code>Maybe</code> instead. That way you don't have to restrict yourself to lists of numbers.</p>\n"}], "owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 40341552, "answer_count": 1, "score": 0, "last_activity_date": 1477914399, "creation_date": 1477914111, "question_id": 40341479, "link": "https://stackoverflow.com/questions/40341479/foldl-expression-not-compiling-due-to-use-of-literal", "title": "foldl expression not compiling due to use of literal", "body": "<p>I have the following use of foldl which is erroring:</p>\n\n<pre><code>elementAt :: [a] -&gt; Int -&gt; a\nelementAt [] x = error \"No empty lists for element-at\"\nelementAt xs x = foldl(\\acc (a, b) -&gt; if(b == x) then a else acc) 0 $ zip xs [0..]\n</code></pre>\n\n<p>When I try and compile I get this error:</p>\n\n<blockquote>\n  <p>exercises.hs:8:67: error:\n      * No instance for (Num a) arising from the literal <code>0'\n        Possible fix:\n          add (Num a) to the context of\n            the type signature for:\n              elementAt :: [a] -&gt; Int -&gt; a\n      * In the second argument of</code>foldl', namely `0'\n        In the expression:\n          foldl (\\ acc (a, b) -> if (b == x) then a else acc) 0\n        In the expression:\n          foldl (\\ acc (a, b) -> if (b == x) then a else acc) 0\n          $ zip xs [0 .. ] Failed, modules loaded: none.</p>\n</blockquote>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1477923215, "post_id": 40341242, "comment_id": 67941970, "body": "Your approach looks fine, though I haven&#39;t tested it. You may also want to check out <code>ZipConduit</code> to see if it does what you&#39;re looking for."}], "answers": [{"tags": [], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "is_accepted": true, "score": 0, "last_activity_date": 1478240287, "creation_date": 1478240287, "answer_id": 40416454, "question_id": 40341242, "link": "https://stackoverflow.com/questions/40341242/conduit-join-two-sources-into-one/40416454#40416454", "title": "Conduit: Join two sources into one", "body": "<p>I ended up doing this way:</p>\n\n<pre><code>data MergedValue a v b = BackL a v | MergedValue v | BackR v b\ndata JoinResult a v b = LeftoverL a | JoinValue v | LeftoverR b\n\njoinSources :: Monad m\n            =&gt; (a -&gt; b -&gt; MergedValue a v b)\n            -&gt; Source m a\n            -&gt; Source m b\n            -&gt; Source m (JoinResult a v b)\njoinSources f as bs =\n  go (newResumableSource as) (newResumableSource bs)\n  where\n    go ras rbs = do\n      (ras', ma) &lt;- lift $ ras $$++ await\n      (rbs', mb) &lt;- lift $ rbs $$++ await\n      case (ma, mb) of\n        (Nothing, Nothing) -&gt; pure ()\n        (Nothing, Just b)  -&gt; yield (LeftoverR b) &gt;&gt; go ras' rbs'\n        (Just a,  Nothing) -&gt; yield (LeftoverL a) &gt;&gt; go ras' rbs'\n        (Just a,  Just b)  -&gt; case f a b of\n          BackL x v -&gt; do\n            yield (JoinValue v)\n            (nxt, _) &lt;- lift $ ras' $$++ leftover x\n            go nxt rbs'\n          BackR v x -&gt; do\n            yield (JoinValue v)\n            (nxt, _) &lt;- lift $ rbs' $$++ leftover x\n            go ras' nxt\n          MergedValue v -&gt; yield (JoinValue v) &gt;&gt; go ras' rbs'\n</code></pre>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 40416454, "answer_count": 1, "score": 3, "last_activity_date": 1478240287, "creation_date": 1477913173, "last_edit_date": 1477919853, "question_id": 40341242, "link": "https://stackoverflow.com/questions/40341242/conduit-join-two-sources-into-one", "title": "Conduit: Join two sources into one", "body": "<p>I have two conduit sources A and B which I want to merge them into one yielding:</p>\n\n<pre><code>data Result = Left Int | Value Int | Right Int\n\nmerge :: Monad m =&gt; Source m Int -&gt; Source m Int -&gt; Source Result\nmerge a b = undefined\n</code></pre>\n\n<p>such as it:</p>\n\n<ul>\n<li>Consumes values from both <code>a</code> and <code>b</code></li>\n<li>Performs some computation to produce <code>Value Int</code></li>\n<li>As a result of computation either <code>a</code> or <code>b</code> could have a <code>leftover</code></li>\n<li>When one of the sequences is exhausted the result source should keep producing either <code>Left</code> or <code>Right</code> values, (depending on which original source still has values) until both sources are exhausted</li>\n</ul>\n\n<p>I tried implementing it with <code>ZipSource</code> such as:</p>\n\n<pre><code>getZipSource (ZipSource (a =$= CL.map Left) &lt;* ZipSource (b =$= CL.map Right))\n</code></pre>\n\n<p>but I couldn't figure out how to make it alternate between sources (when I do two <code>await</code>s) and how to deal with leftovers in a way that I described above.</p>\n\n<p>I also looked at <code>sequenceSources</code> but it doesn't seem to help either.</p>\n\n<p>Can something like that be built with Conduit?</p>\n\n<p>A concrete example would be:</p>\n\n<ul>\n<li>Have two (assumed sorted) <code>Int</code> sources</li>\n<li>Get values from both and compare</li>\n<li>Yield the <code>min</code> value, subtract it from the biggest and put the remaining back to its stream</li>\n<li>Repeat.</li>\n</ul>\n\n<p>The expected output would be:</p>\n\n<pre><code>runConduit $ merge (CL.sourceList [10, 20, 30]) (CL.sourceList [6, 4, 20]) $$ CL.take 10\n\nValue 6    -- 10-6  = 4,  6 yielded, 4 goes back to \"a\"\nValue 4    -- 4-4   = 0,  both values are fully consumed\nValue 20   -- 20-20 = 0,  both values are fully consumed\nLeft 30    -- \"b\" has no values, but \"a\" still yielding\n</code></pre>\n\n<hr>\n\n<p><strong>[UPDATE]</strong>\nThe best way I found so far is to write something similar to <code>zipSources</code> tweaking its internals as:</p>\n\n<pre><code>go (Done ()) (HaveOutput src close y) = HaveOutput (go (Done ()) src) close (Nothing, Just y)\ngo (HaveOutput src close x) (Done ()) = HaveOutput (go src (Done ())) close (Just x, Nothing)\n</code></pre>\n\n<p>Would it be the right way to go?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 3, "last_activity_date": 1477902637, "last_edit_date": 1477902637, "creation_date": 1477902192, "answer_id": 40338644, "question_id": 40338523, "link": "https://stackoverflow.com/questions/40338523/implementation-of-for-reader/40338644#40338644", "title": "implementation of &lt;*&gt; for Reader", "body": "<p>Use <code>runReader</code>, for instance:</p>\n\n<pre><code>runReader getDogR1 pers\n</code></pre>\n\n<p><code>Reader</code> is simply a newtype around functions of type <code>r -&gt; a</code> and <code>runReader</code> is the name of its (only) field which automatically generates an accessor function for the field with the same name. Using it on a value of type <code>Reader</code> extracts the underlying function and then you can proceed as in the <code>getDogR</code> case.</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1477907601, "creation_date": 1477901493, "last_edit_date": 1477907601, "question_id": 40338523, "link": "https://stackoverflow.com/questions/40338523/implementation-of-for-reader", "title": "implementation of &lt;*&gt; for Reader", "body": "<p>Can somebody please explain how to run <code>getDogR1</code>. Both <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> expect a parameter. However the <code>Reader</code> type is not a function and has no parameters. So how do we pass a <code>Person</code> data type? For example, it is not possible to run <code>getDogR1</code> using <code>getDogR1 pers</code> which is how <code>getDogR</code> would be run: <code>getDogR pers</code>.</p>\n\n<pre><code>newtype Reader r a = Reader {runReader :: r -&gt; a}\n\ninstance Functor (Reader r) where\n  fmap f (Reader f1) = Reader $ f . f1\n\ninstance Applicative (Reader r) where\n  pure :: a -&gt; Reader r a\n  pure a = Reader $ const a\n  (&lt;*&gt;) :: Reader r (a -&gt; b) -&gt; Reader r a -&gt; Reader r b\n  Reader rab &lt;*&gt; Reader ra = Reader $ \\r -&gt; rab r (ra r)\n-----------------------------------------------------------------\nnewtype HumanName = HumanName String deriving (Eq, Show)\nnewtype DogName = DogName String deriving (Eq, Show)\nnewtype Address = Address String deriving (Eq, Show)\n\ndata Person = Person {\n                humanName :: HumanName\n              , dogName :: DogName\n              , address :: Address\n              } deriving (Eq, Show)\n\ndata Dog = Dog {\n            dogsName :: DogName\n          , dogsAddress :: Address\n          } deriving (Eq, Show)\n\npers :: Person\npers = Person (HumanName \"Big Bird\")\n              (DogName \"Barkley\")\n              (Address \"Sesame Street\")\n\ndDuck :: Person\ndDuck = Person (HumanName \"Jeff\")\n               (DogName \"Mutley\")\n               (Address \"Some Street\")\n\ngetDog :: Person -&gt; Dog\ngetDog p = Dog (dogName p) (address p)\n\ngetDogR :: Person -&gt; Dog\ngetDogR = Dog &lt;$&gt; dogName &lt;*&gt; address\n\ngetDogR' :: Person -&gt; Dog\ngetDogR' = liftA2 Dog dogName address\n\ngetDogR1 :: Reader Person Dog\ngetDogR1 = Dog &lt;$&gt; Reader dogName &lt;*&gt; Reader address\n</code></pre>\n"}, {"tags": ["haskell", "optparse"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477883275, "post_id": 40335927, "comment_id": 67927290, "body": "A note on terminology: the second argument of <code>(&lt;$&gt;)</code> is not &quot;a functor&quot;. <code>Parser</code> is the functor involved here, as opposed to any particular <code>Parser</code>-values you might make use of. I usually call such values &quot;functorial values&quot;, even though that is somewhat unwieldy jargon. (Sorry for the rather annoying nitpicking. It is just that it is worth pointing out this particular mix-up because it can lead to further confusion down the road.)"}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1477882441, "post_id": 40335965, "comment_id": 67927153, "body": "So the data constructor <code>Sample</code>, as the first argument of <code>(&lt;$&gt;)</code>, is being treated as a normal function?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 3, "creation_date": 1477882587, "post_id": 40335965, "comment_id": 67927176, "body": "@George Yes; you can see with <code>:t Sample</code> that it is effectively a function with type <code>String -&gt; Bool -&gt; Sample</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1477882715, "post_id": 40335965, "comment_id": 67927199, "body": "@George Yup, as chepner says a constructor is just a normal function (that it can also be used for pattern matching doesn&#39;t affect that)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 9, "last_activity_date": 1477882203, "creation_date": 1477882203, "answer_id": 40335965, "question_id": 40335927, "link": "https://stackoverflow.com/questions/40335927/understanding-the-introductory-code-snippet-for-haskells-popular-optparse-appli/40335965#40335965", "title": "Understanding the introductory code snippet for Haskell&#39;s popular optparse-applicative library", "body": "<blockquote>\n  <p>Q1: How is it that <code>&lt;$&gt;</code> can be used as the first argument of the type constructor Sample? I thought this operation had to be used between a function and a functor.</p>\n</blockquote>\n\n<p>It is the other way around: <code>Sample</code> is the first argument of <code>(&lt;$&gt;)</code>, and it is being mapped over the <code>Parser String</code> produced by <code>strOption</code>.</p>\n\n<blockquote>\n  <p>Q2: What is the operation <code>&lt;&gt;</code> used throughout this code snippet?</p>\n</blockquote>\n\n<p><code>(&lt;&gt;)</code> is a synonym for <code>mappend</code>, from the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\"><code>Monoid</code></a> class. In this case, it is being used to combine individual settings into the set of settings to be used for each of the command-line options that you are defining.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1477992702, "creation_date": 1477992702, "answer_id": 40357309, "question_id": 40335927, "link": "https://stackoverflow.com/questions/40335927/understanding-the-introductory-code-snippet-for-haskells-popular-optparse-appli/40357309#40357309", "title": "Understanding the introductory code snippet for Haskell&#39;s popular optparse-applicative library", "body": "<p>Using the <code>ApplicativeDo</code> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-puns\" rel=\"nofollow\"><code>NamedFieldPuns</code></a> extensions, one could also write it like this:</p>\n\n<pre><code>{-# language ApplicativeDo #-}\n{-# language NamedFieldPuns #-}\nimport Options.Applicative\nimport Data.Monoid\n\ndata Sample = Sample\n  { hello :: String\n  , quiet :: Bool }\n\nsample :: Parser Sample\nsample = do\n    hello &lt;- strOption ( long \"hello\"\n                      &lt;&gt; metavar \"TARGET\"\n                      &lt;&gt; help \"Target for the greeting\" )\n    quiet &lt;- switch ( long \"quiet\"\n                   &lt;&gt; help \"Whether to be quiet\" )\n    pure (Sample {hello,quiet})\n</code></pre>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 40335965, "answer_count": 2, "score": 1, "last_activity_date": 1477992702, "creation_date": 1477881804, "question_id": 40335927, "link": "https://stackoverflow.com/questions/40335927/understanding-the-introductory-code-snippet-for-haskells-popular-optparse-appli", "title": "Understanding the introductory code snippet for Haskell&#39;s popular optparse-applicative library", "body": "<p>From an introductory code snippet from the popular <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow\">optparse</a> library: </p>\n\n<pre><code>data Sample = Sample\n  { hello :: String\n  , quiet :: Bool }\n\nsample :: Parser Sample\nsample = Sample\n  &lt;$&gt; strOption -- Q1\n      ( long \"hello\"\n     &lt;&gt; metavar \"TARGET\" -- Q2\n     &lt;&gt; help \"Target for the greeting\" )\n  &lt;*&gt; switch\n      ( long \"quiet\"\n     &lt;&gt; help \"Whether to be quiet\" )\n</code></pre>\n\n<p>See the comments in the code snippet for my questions/confusion.</p>\n\n<p>Q1: How is it that <code>&lt;$&gt;</code> can be used as the first argument of the type constructor <code>Sample</code>? I thought this operation had to be used between a function and a functor.</p>\n\n<p>Q2: What is the operation <code>&lt;&gt;</code> used throughout this code snippet?</p>\n"}, {"tags": ["haskell", "monads", "record", "clash"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1506553527, "last_edit_date": 1506553527, "creation_date": 1477881761, "answer_id": 40335921, "question_id": 40335878, "link": "https://stackoverflow.com/questions/40335878/how-to-refactor-code-using-the-state-monad-in-order-to-increase-modularity-by-ad/40335921#40335921", "title": "How to refactor code using the State monad in order to increase modularity by adding more functions?", "body": "<p>In your definition of <code>newFun</code></p>\n\n<pre><code>newFun = when (not _rx_busy &amp;&amp; _rx_d2 == 0) $ do\n         rx_busy       .= True\n         rx_sample_cnt .= 1\n         rx_cnt        .= 0\n</code></pre>\n\n<p>you are trying to refer to <code>_rx_busy</code> and <code>_rx_d2</code>, which are record fields of the type <code>RxReg</code>. In <code>uartRX</code>, the first argument is an <code>RxReg</code>, and the RecordWildCards language extension is used to bind all the field names by matching the argument with the pattern <code>RxReg{..}</code>. So you will either need to pass <code>r</code> itself, or at least <code>_rx_busy</code> and <code>_rx_d2</code>, from <code>uartRX</code> to <code>newFun</code>; i.e. either have</p>\n\n<pre><code>newFun busy d2 = when (not busy &amp;&amp; d2 == 0) $ do\n    ...\n</code></pre>\n\n<p>or</p>\n\n<pre><code>newFun RxReg{..} = when (not _rx_busy &amp;&amp; _rx_d2 == 0) $ do\n    ...\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 40335921, "answer_count": 1, "score": 0, "last_activity_date": 1562828855, "creation_date": 1477881377, "last_edit_date": 1562828855, "question_id": 40335878, "link": "https://stackoverflow.com/questions/40335878/how-to-refactor-code-using-the-state-monad-in-order-to-increase-modularity-by-ad", "title": "How to refactor code using the State monad in order to increase modularity by adding more functions?", "body": "<p>I am trying to get the hang of monads. I figured it would be good practice to play with the state monad. </p>\n\n<p>Using the UART Rx from <a href=\"https://hackage.haskell.org/package/clash-prelude-0.10.14/docs/CLaSH-Examples.html\" rel=\"nofollow\">CLaSH</a>:</p>\n\n<pre><code>-- UART RX Logic\ndata RxReg\n  = RxReg\n  { _rx_reg        :: BitVector 8\n  , _rx_data       :: BitVector 8\n  , _rx_sample_cnt :: Unsigned 4\n  , _rx_cnt        :: Unsigned 4\n  , _rx_frame_err  :: Bool\n  , _rx_over_run   :: Bool\n  , _rx_empty      :: Bool\n  , _rx_d1         :: Bit\n  , _rx_d2         :: Bit\n  , _rx_busy       :: Bool\n  }\n\nmakeLenses ''RxReg\n\nuartRX r@(RxReg {..}) rx_in uld_rx_data rx_enable = flip execState r $ do\n  -- Synchronise the async signal\n  rx_d1 .= rx_in\n  rx_d2 .= _rx_d1\n  -- Uload the rx data\n  when uld_rx_data $ do\n    rx_data  .= _rx_reg\n    rx_empty .= True\n  -- Receive data only when rx is enabled\n  if rx_enable then do\n    -- Check if just received start of frame\n    when (not _rx_busy &amp;&amp; _rx_d2 == 0) $ do\n      rx_busy       .= True\n      rx_sample_cnt .= 1\n      rx_cnt        .= 0\n    -- Star of frame detected, Proceed with rest of data\n    when _rx_busy $ do\n      rx_sample_cnt += 1\n      -- Logic to sample at middle of data\n      when (_rx_sample_cnt == 7) $ do\n        if _rx_d1 == 1 &amp;&amp; _rx_cnt == 0 then\n          rx_busy .= False\n        else do\n          rx_cnt += 1\n          -- start storing the rx data\n          when (_rx_cnt &gt; 0 &amp;&amp; _rx_cnt &lt; 9) $ do\n            rx_reg %= replaceBit (_rx_cnt - 1) _rx_d2\n          when (_rx_cnt == 9) $ do\n            rx_busy .= False\n            -- Check if End of frame received correctly\n            if _rx_d2 == 0 then\n              rx_frame_err .= True\n            else do\n              rx_empty     .= False\n              rx_frame_err .= False\n              -- Check if last rx data was not unloaded\n              rx_over_run  .= not _rx_empty\n  else do\n    rx_busy .= False\n</code></pre>\n\n<p>How would I go about moving the <code>when</code> logic to their own functions? I have been playing with this for a little bit, but the lenses seem to be causing issues. </p>\n\n<pre><code>Could not deduce Control.Monad.State.Class.MonadState from .=\n</code></pre>\n\n<p>I am think there is a function <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html\" rel=\"nofollow\">here</a> </p>\n\n<p>That I am missing. </p>\n\n<p>I would want to do something like </p>\n\n<pre><code>newFun = when (not _rx_busy &amp;&amp; _rx_d2 == 0) $ do\n         rx_busy       .= True\n         rx_sample_cnt .= 1\n         rx_cnt        .= 0\n</code></pre>\n\n<p>I would think there would be a function like <code>execState</code> that I need. </p>\n\n<p>So my questions are, </p>\n\n<ul>\n<li>What should I be using? </li>\n<li>What does that function do that allows it to compose with other functions?</li>\n<li>If monads are just composing why cant I have the <code>when</code> in a function without an execState type function?</li>\n<li>What other ways could I increase the modularity of this code? </li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1477872407, "post_id": 40334968, "comment_id": 67925221, "body": "I wanted this for forever. I was really disappointed to learn it wasn&#39;t possible."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1477872586, "post_id": 40334968, "comment_id": 67925264, "body": "Guards do not participate in layout, so your suggested syntax would be highly ambiguous."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477873315, "post_id": 40334968, "comment_id": 67925408, "body": "What Reid Barton suggests is, I guess, the most likely reason why no one bothered yet. In general, I don&#39;t think concerns such as &quot;resonate too much with imperative programming&quot; hold much water -- after all, we have <code>if</code>, <code>case</code> and <code>do</code> already. On the other hand, I believe this sort of nesting remove most of the clarity adding by the guards syntax, so we might as well just use nested <code>if</code>."}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "closed_date": 1477875851, "answer_count": 0, "score": 0, "last_activity_date": 1477872134, "creation_date": 1477872134, "last_edit_date": 1495540097, "question_id": 40334968, "link": "https://stackoverflow.com/questions/40334968/nested-guards-on-haskell", "closed_reason": "Duplicate", "title": "Nested guards on Haskell", "body": "<p>Haskell disallows the following style of nested guards although they look aesthetically natural and concise:</p>\n\n<pre><code>x | condition_1\n    | condition_1_1\n      | condition_1_1_1 = expression_1_1_1\n      | ...\n    | ...\n  | ...\n</code></pre>\n\n<p>I got a few pointers e.g. <a href=\"https://mail.haskell.org/pipermail/haskell/2007-December/020019.html\" rel=\"nofollow noreferrer\">1</a> and <a href=\"https://stackoverflow.com/questions/34124558/is-it-possible-to-nest-guards-in-haskell\">2</a>, but still can't help ask:</p>\n\n<p>Needn't we bother such negligible syntactical sugar?</p>\n\n<p>Would the implementation introduce prohibitive incompatibility?</p>\n\n<p>Do deep nested guards resonate too much with imperative programming to easily promote them? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 3, "creation_date": 1477862149, "post_id": 40333647, "comment_id": 67922438, "body": "One option is to export the constructor only from a separate module with <code>Unsafe</code> in its name. This way, it&#39;s easy for users to do the right thing, but if required, the constructor is still accessible."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1477879368, "post_id": 40333647, "comment_id": 67926558, "body": "It seems that you want to allow pattern matching on <code>Zq</code> but not construction. With <code>PatternSynonyms</code> this is easy: <code>pattern View_Zq a &lt;- Zq a</code>. You can even go further with GHC &gt;= 7.10 and write an explicit bidirectional pattern synonym, which in an expression context would <i>check</i> if the <code>Int</code> is the correct size and throw an error otherwise (or just apply <code>mod q</code> to the integer if that suits you). In older version you can accomplish the same with a <i>view</i> type which is identical to the original, but one cannot convert the view type to the original, and a e.g. <code>view :: Zq q -&gt; View_Zq q</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1477879512, "post_id": 40333647, "comment_id": 67926587, "body": ".. But it seems you have this idea already (3rd paragraph) - why is this no better than exporting the data constructor? You can implement all of the classes you mentioned with the non-abstraction breaking functions <code>Zq q -&gt; Int</code> and <code>IsNat q =&gt; Int -&gt; Maybe (Z q)</code>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1477880026, "post_id": 40333647, "comment_id": 67926689, "body": "@user2407038 Two points: first, the destructor is rather meaningless because the <code>Int</code> doesn&#39;t mean anything outside of its context. I&#39;m also concerned about efficiency with that approach: it would be bad if low-level instances (like <code>Unbox</code> and <code>Storable</code>) were less efficient than strictly required due to using a destructor rather than matching on the type constructor."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1477863436, "last_edit_date": 1477863436, "creation_date": 1477863069, "answer_id": 40333832, "question_id": 40333647, "link": "https://stackoverflow.com/questions/40333647/getting-safety-and-extensibility/40333832#40333832", "title": "Getting safety and extensibility", "body": "<p>Most well-formed instances shouldn't require the unsafe raw constructors. <code>Unbox</code> etc. are a bit unusually low-level, but other instances should generally be definable in terms of much the same high-level API you'd also use for end applications.</p>\n\n<p>So, I don't really see your concern of <em>don't know instances \u21d2 can't hide constructors</em>. If you just define the critical close-to-the-metal instances yourself you should be fine.</p>\n\n<p>That said, I often find it rather annoying if a library doesn't export the constructors at all. Even if every instance and everything else <em>can</em> be defined only using the high-level API, it <em>can</em> make sense to grant unsafe low-level access for a lot of reasons that can't really be forseen. Debugging, special optimisations, simply seeing <em>what's going on</em>...<br>Hence, in a similar vein to Python's <a href=\"https://mail.python.org/pipermail/tutor/2003-October/025932.html\" rel=\"nofollow\">\u201cwe're all consenting adults here\u201d</a> philosophy, I'd support kosmikus' suggestion: export the constructors of all important types, but do it in a way that makes it clear that using these directly is unsafe. An extra <code>Unsafe</code> module is a good way to achieve this. Simply giving the constructor a technical-sounding name may also be sufficient. And of course document what precisely is unsafe about these exports.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 40333832, "answer_count": 1, "score": 2, "last_activity_date": 1477863436, "creation_date": 1477861774, "question_id": 40333647, "link": "https://stackoverflow.com/questions/40333647/getting-safety-and-extensibility", "title": "Getting safety and extensibility", "body": "<p>I have a library that includes a type <code>data Zq q = Zq Int</code> representing the integers <code>mod q</code>. For safety, I'd like to expose some operations on this type (<code>(+)</code>, <code>(*)</code>, etc), but <em>not</em> export the constructor to avoid people circumventing the safety gotten by declaring such a type in the first place. </p>\n\n<p>However, users of the library may reasonably need to declare instances for this type that I as the library author can't predict. To name just a few possible instances: <code>DeepSeq</code>, <code>Storable</code>, <code>Unbox</code>, ...</p>\n\n<p>The only way I know of that allows third parties to make such instances is to export the constructor. (Alternatively, I could define and export a smart constructor and destructor, but this seems to be no better than just exporting the data constructor.)</p>\n\n<p>Is there a way to ensure safety while also allowing third parties to extend the type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1477857168, "post_id": 40332869, "comment_id": 67920801, "body": "leftaroundabout&#39;s answer in all likelihood will solve your problem, but note that the code you posted doesn&#39;t actually match the error you describe. In future questions, please paste your code exactly as it is."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1477856833, "creation_date": 1477856833, "answer_id": 40332912, "question_id": 40332869, "link": "https://stackoverflow.com/questions/40332869/how-to-get-a-function-in-haskell-to-return-more-than-one-type-using-a-data-type/40332912#40332912", "title": "how to get a function in Haskell to return more than one type using a data type?", "body": "<p>In a variant type, you always need to be explicit about which of the options you take. I.e. you need to \u201clabel\u201d the two branches unambiguously, with <em>constructors</em>. Like,</p>\n\n<pre><code>data Token = CharToken Char | IntToken Int\n</code></pre>\n\n<p>When actually building a token from either a char or int, you thereto wrap it in the suitable constructor:</p>\n\n<pre><code>readIfNumber a \n | isDigit a = IntToken $ digitToInt a\n | otherwise = CharToken a\n</code></pre>\n\n<p>The reason this is required? Well, Haskell has full <a href=\"https://en.wikipedia.org/wiki/Type_erasure\">type erasure</a>, i.e. types are completely traced, decided and optimised at compile time. At runtime, you wouldn't know whether the contained type was a char or int. Sometimes that's ok, namely when you have <em>polymorphic actions</em>. For example, <code>length</code> really doesn't care what the type of the <em>elements</em> contained in a list is, as it only deals with the <em>structure</em> of the list.</p>\n\n<p>In this case however, somebody who receives a <code>Token</code> <em>will</em> need to know whether it's a char or int, to properly process it further. Hence the need to tag which type is contained.</p>\n"}], "owner": {"reputation": 115, "user_id": 5559919, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/451e8782c71cf5804989bb2ad548984c?s=128&d=identicon&r=PG&f=1", "display_name": "jazaniac", "link": "https://stackoverflow.com/users/5559919/jazaniac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 40332912, "answer_count": 1, "score": 2, "last_activity_date": 1477856833, "creation_date": 1477856502, "question_id": 40332869, "link": "https://stackoverflow.com/questions/40332869/how-to-get-a-function-in-haskell-to-return-more-than-one-type-using-a-data-type", "title": "how to get a function in Haskell to return more than one type using a data type?", "body": "<p>So in my code I have the data type Token declared as:</p>\n\n<pre><code>data Token = Char | Int\nderiving (Show,Eq,Ord)\n</code></pre>\n\n<p>and a function readIfNumber declared as </p>\n\n<pre><code>readIfNumber :: Char -&gt; Token \nreadIfNumber a \n    | isDigit a = Token (digitToInt a)\n    | otherwise = Token a\n</code></pre>\n\n<p>but when I try to compile, the console returns an error of \"expecting type Token, but got Char\" or \"expecting Token, but got Int\" when an Int should be viewed as a Token, according to my declaration of Token. What am I doing wrong here? </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 3, "creation_date": 1477852063, "post_id": 40332069, "comment_id": 67919322, "body": "Thanks. I submitted an <a href=\"https://github.com/commercialhaskell/stack/issues/2750\" rel=\"nofollow noreferrer\">issue</a> to Stack to mention this in the docs."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 22, "last_activity_date": 1477851123, "creation_date": 1477851123, "answer_id": 40332069, "question_id": 40332040, "link": "https://stackoverflow.com/questions/40332040/what-goes-in-a-stack-package-yaml-file/40332069#40332069", "title": "What goes in a Stack package.yaml file?", "body": "<p>This is hpack, available here: <a href=\"https://github.com/sol/hpack\">https://github.com/sol/hpack</a></p>\n\n<p>It's a slightly different package format, and, as you say, can be used to generate cabal files. It isn't directly tied to stack.</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7118, "favorite_count": 1, "accepted_answer_id": 40332069, "answer_count": 1, "score": 24, "last_activity_date": 1477851123, "creation_date": 1477850930, "question_id": 40332040, "link": "https://stackoverflow.com/questions/40332040/what-goes-in-a-stack-package-yaml-file", "title": "What goes in a Stack package.yaml file?", "body": "<p>I notice that Stack supports using a <code>package.yaml</code> file that it will use to generate a <code>.cabal</code> file. For example, <a href=\"https://github.com/yi-editor/yi/blob/2f0c7b738b3a1f79ff149034db2c4392273ee26f/yi-core/package.yaml\">yi-core/package.yaml</a>. Its structure seems very similar to a Cabal file, but not quite the same. Some of the keys have been renamed (for example, Stack uses <code>source-dirs</code> instead of <code>hs-source-dirs</code>).</p>\n\n<p>I haven't found any documentation on this feature. <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\">The Stack docs</a> don't seem to mention <code>package.yaml</code> at all. Does a specification exist?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1477869062, "creation_date": 1477869062, "answer_id": 40334657, "question_id": 40331977, "link": "https://stackoverflow.com/questions/40331977/if-a-list-element-matches-1st-tuple-element-replace-it-with-2nd-tuple-element/40334657#40334657", "title": "If a list element matches 1st tuple element replace it with 2nd tuple element", "body": "<p>No need to reinvent the wheel.</p>\n\n<pre><code>import qualified Data.Map as M\n\nlist1 = [(\"aaa\", \"bb\"), (\"d\", \"efg\"), (\"if found this\", \"replace with this\")]\nlist2 = [\"aaa\", \"efg\", \"zzz\"]\n\nreplace d = map (\\k -&gt; M.findWithDefault k k d)\n\nmain = print $ replace (M.fromList list1) list2\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 3702977, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002117498810/picture?type=large", "display_name": "Robert_H", "link": "https://stackoverflow.com/users/3702977/robert-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477869062, "creation_date": 1477850509, "question_id": 40331977, "link": "https://stackoverflow.com/questions/40331977/if-a-list-element-matches-1st-tuple-element-replace-it-with-2nd-tuple-element", "title": "If a list element matches 1st tuple element replace it with 2nd tuple element", "body": "<p>I am given 2 lists:<br>\n- <code>list1</code> as a dictionary in a form of tuples:<br>\n<code>[(\"aaa\", \"bb\"), (\"d\", \"efg\"), (\"if found this\", \"replace with this\")]</code><br>\n- <code>list2</code> as a list of elements to translate: <code>[\"aaa\", \"efg\", \"zzz\"]</code></p>\n\n<p>I need to return a list where elements from <code>list2</code> are replaces with tuples 2nd element from <code>list1</code> elements if <code>list2</code> element matches <code>list1</code> tuples 2nd element. In this example result list would look like this <code>[\"bb\", \"efg\", \"zzz\"]</code>  </p>\n\n<p>How to do this?\nI only started to learn Haskell only recently so syntax is my main problem. I think the function definition should look like this<br>\n<code>replace ::  Eq a =&gt; [(a,a)] -&gt; [a] -&gt; [a]</code><br>\nand the function should do something like try ti find <code>list2</code> value in tuples if found keep value from tuple and recursively call function <code>replace</code>, if value is not found keep value from <code>list2</code> and recursively call function <code>replace</code>.</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1477850573, "post_id": 40331851, "comment_id": 67918863, "body": "You might wrap <code>Decimal</code> in a <code>newtype</code> (to avoid writing an orphan instance) and then follow the <a href=\"https://hackage.haskell.org/package/aeson-1.0.2.1/docs/Data-Aeson.html#g:2\" rel=\"nofollow noreferrer\">Writing instances by hand</a> section of the <i>aeson</i> documentation. In all likelihood, however, the sensible thing to do is switching from <code>Data.Decimal</code> to <code>Data.Scientific</code> (from the <a href=\"https://hackage.haskell.org/package/scientific-0.3.4.9\" rel=\"nofollow noreferrer\"><i>scientific</i></a> package), which does have instances provided by <i>aeson</i>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497512052, "post_id": 40331851, "comment_id": 76111766, "body": "Did you find an answer to this?"}, {"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "edited": false, "score": 1, "creation_date": 1497532679, "post_id": 40331851, "comment_id": 76125735, "body": "I switched to Data.Scientific"}], "answers": [{"comments": [{"owner": {"reputation": 638, "user_id": 1107446, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ngJVZ.jpg?s=128&g=1", "display_name": "Denis Krivitski", "link": "https://stackoverflow.com/users/1107446/denis-krivitski"}, "edited": false, "score": 0, "creation_date": 1535640247, "post_id": 50419308, "comment_id": 91150221, "body": "This code is incorrect. First you should use reads function instead of read, second the case go (_ : xs) should also result in a failure, not a recursive call."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "reply_to_user": {"reputation": 638, "user_id": 1107446, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ngJVZ.jpg?s=128&g=1", "display_name": "Denis Krivitski", "link": "https://stackoverflow.com/users/1107446/denis-krivitski"}, "edited": false, "score": 0, "creation_date": 1535736063, "post_id": 50419308, "comment_id": 91191382, "body": "Thanks, I ended up using parseJSON = A.withScientific &quot;Decimal&quot; (return . right . eitherFromRational . toRational) and it works fine"}], "tags": [], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "is_accepted": false, "score": 0, "last_activity_date": 1526677770, "creation_date": 1526677770, "answer_id": 50419308, "question_id": 40331851, "link": "https://stackoverflow.com/questions/40331851/haskell-data-decimal-as-aeson-type/50419308#50419308", "title": "Haskell Data.Decimal as Aeson type", "body": "<p>I know this is an old thread, but might help someone. Here is how I am converting Decimal to/from json (I assembled this code from a bunch of other code which I don't have the source for now):</p>\n\n<pre><code>instance A.ToJSON (DecimalRaw Integer) where\n  -- maybe this is not the best, but it works\n  toJSON d = A.toJSON $ show d\n\ninstance A.FromJSON (DecimalRaw Integer) where\n  parseJSON = A.withText \"Decimal\" (go . (read :: String -&gt; [(DecimalRaw Integer, String)]) . T.unpack)\n    where\n      go [(v, [])] = return v\n      go (_ : xs) = go xs\n      go _ = fail \"Could not parse number\"\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1526677770, "creation_date": 1477849688, "last_edit_date": 1477849810, "question_id": 40331851, "link": "https://stackoverflow.com/questions/40331851/haskell-data-decimal-as-aeson-type", "title": "Haskell Data.Decimal as Aeson type", "body": "<p>Is it possible to parse a <a href=\"https://hackage.haskell.org/package/Decimal-0.4.2/docs/Data-Decimal.html\" rel=\"nofollow\">Data.Decimal</a> from JSON using the Aeson package?</p>\n\n<p>Suppose I have the following JSON:</p>\n\n<pre><code>{\n    \"foo\": 5.231,\n    \"bar\": \"smth\"\n}\n</code></pre>\n\n<p>And the following record type:</p>\n\n<pre><code>data test { foo :: Data.Decimal\n          , bar :: String } deriving Generic\n</code></pre>\n\n<p>with</p>\n\n<pre><code>instance FromJSON test\ninstance ToJSON test\n</code></pre>\n\n<p>This would work, if it weren't for the <code>Data.Decimal</code> value \"foo\".</p>\n\n<p>From what I understand I would need to manually create a <code>FromJSON</code> and <code>ToJSON</code> (for converting back to JSON) instance of Data.Decimal, since it doesn't derive from Generic. How can I do that?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1477853894, "last_edit_date": 1477853894, "creation_date": 1477851211, "answer_id": 40332083, "question_id": 40331438, "link": "https://stackoverflow.com/questions/40331438/how-do-i-modify-the-body-and-fields-of-a-page/40332083#40332083", "title": "How do I modify the body and fields of a page?", "body": "<p>To modify the page body, use <a href=\"https://hackage.haskell.org/package/hakyll-4.9.0.0/docs/Hakyll-Core-Item.html#v:withItemBody\" rel=\"nofollow\"><code>withItemBody</code></a> while compiling the page. You can use it, for instance, with <a href=\"https://hackage.haskell.org/package/hakyll-4.9.0.0/docs/Hakyll-Web-Html.html#v:withTags\" rel=\"nofollow\"><code>withTags</code></a> and the tools provided by the <a href=\"https://hackage.haskell.org/package/tagsoup-0.14\" rel=\"nofollow\"><em>tagsoup</em></a> package for modifying the DOM tree of an HTML page however you want.</p>\n\n<p>As for metadata, as far as I am aware of, it is read-only. What you can do instead is using <a href=\"https://hackage.haskell.org/package/hakyll-4.9.0.0/docs/Hakyll-Web-Template-Context.html\" rel=\"nofollow\"><code>Hakyll.Web.Template.Context</code></a> to define your own custom contexts for filling in template fields, possibly using metadata fields to do so. The implementation of contexts such as <a href=\"https://hackage.haskell.org/package/hakyll-4.9.0.0/docs/src/Hakyll-Web-Template-Context.html#dateField\" rel=\"nofollow\"><code>dateField</code></a> illustrates how that might be done.</p>\n"}], "owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 40332083, "answer_count": 1, "score": 1, "last_activity_date": 1496559810, "creation_date": 1477846753, "last_edit_date": 1496559810, "question_id": 40331438, "link": "https://stackoverflow.com/questions/40331438/how-do-i-modify-the-body-and-fields-of-a-page", "title": "How do I modify the body and fields of a page?", "body": "<p>Is it possible with Hakyll to modify a field such as \"date\", \"author\" and more specifically the body of a page. For example, I wish to modify or delete some part of page.</p>\n\n<p>I looked at the Hakyll documentation on Hackage. There was a function called <a href=\"https://hackage.haskell.org/package/hakyll-3.3.0.0/docs/Hakyll-Web-Page-Metadata.html#v:changeField\" rel=\"nofollow\"><code>changeField</code></a> which seam to make what I want. But this function is from version 3 of Hakyll, and it doesn't exist in Hakyll 4.5.0, which I am using now.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477847097, "post_id": 40331179, "comment_id": 67917788, "body": "I can`t think of anything on your <i>phone</i>, but there are some pretty straightforward things you can do in GHCi"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1477847125, "post_id": 40331179, "comment_id": 67917794, "body": "Well, <a href=\"http://hackage.haskell.org/package/haskell-src-exts-1.18.2/docs/Language-Haskell-Exts.html\" rel=\"nofollow noreferrer\">haskell-src-exts</a> makes it easy to get a completely unambiguous parse tree and print it out. But it ain&#39;t really readable. Try <code>(fmap . fmap . fmap) (const ()) (parseFile &quot;foo.hs&quot;)</code> from ghci once you&#39;ve installed it."}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477852828, "post_id": 40331179, "comment_id": 67919561, "body": "@Alec: what exactly can I do in ghci?  (about the phone: that was just a preference, and a mild one at that, in case there was a choice in the matter; if there isn&#39;t, i&#39;ll gladly settle for ghci.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1489877540, "post_id": 40331179, "comment_id": 72865080, "body": "<a href=\"https://github.com/commercialhaskell/describe#describe\" rel=\"nofollow noreferrer\">This brand new tool</a> seems to do exactly what you describe in the term level."}, {"owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "edited": false, "score": 0, "creation_date": 1489947953, "post_id": 40331179, "comment_id": 72882320, "body": "Thank you for the heads-up!  It looks like a godsend for the haskell noob (like me)."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 10, "last_activity_date": 1482794912, "last_edit_date": 1482794912, "creation_date": 1477860382, "answer_id": 40333460, "question_id": 40331179, "link": "https://stackoverflow.com/questions/40331179/how-to-automatically-parenthesize-arbitrary-haskell-expressions/40333460#40333460", "title": "How to automatically parenthesize arbitrary haskell expressions?", "body": "<p>If you really want to go to the work of it, you could write a <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH.html\" rel=\"nofollow noreferrer\"><code>TemplateHaskell</code></a> function to do this for you - you essentially just walk the AST and add parens at will. I started doing that, but realized it will get pretty long and tedious pretty fast. I think it may be more convenient for the moment for you to only think about currying when it actually comes into play (with functions that are not fully applied).</p>\n\n<hr>\n\n<p>However, there is a trick you can use for a subcase of your problem: <em>parens around operators whose fixity and associativity you aren't familiar with</em>. In GHCi, after booting up with the right flags, just wrap the expression you are interested in inspecting in <code>$([| &lt;expression&gt; |])</code>. Then, you get to see a parenthesized version of your expression before the result of evaluating it.</p>\n\n<pre><code>$ ghci -ddump-splices -XTemplateHaskell\nPrelude&gt; $([| 1 + 2 ^ 3 * 4 |])\n&lt;interactive&gt;:1:3-21: Splicing expression\n    [| 1 + 2 ^ 3 * 4 |] ======&gt; (1 + ((2 ^ 3) * 4))\n33\nPrelude&gt; $([| 1 &lt;$ pure 4 &gt;&gt;= \\x -&gt; const mempty =&lt;&lt; [(+),(*)] &lt;*&gt; [1,2] &lt;* [False] |])\n&lt;interactive&gt;:2:3-77: Splicing expression\n    [| 1 &lt;$ pure 4\n       &gt;&gt;=\n         (\\ x_a6PT -&gt; const mempty =&lt;&lt; [(+), (*)] &lt;*&gt; [1, 2] &lt;* [False] |]\n  ======&gt;\n    ((1 &lt;$ (pure 4))\n     &gt;&gt;=\n       (\\ x_a6PT\n          -&gt; ((const mempty) =&lt;&lt; (([(+),(*)] &lt;*&gt; [1,2]) &lt;* [False]))))\n[]\nPrelude&gt;\n</code></pre>\n\n<p>However, this definitely won't fix the type signatures or function applications the way you want.</p>\n"}, {"tags": [], "owner": {"reputation": 4431, "user_id": 23106, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BYY6E.png?s=128&g=1", "display_name": "Colin Barrett", "link": "https://stackoverflow.com/users/23106/colin-barrett"}, "is_accepted": false, "score": 4, "last_activity_date": 1477862465, "creation_date": 1477862465, "answer_id": 40333747, "question_id": 40331179, "link": "https://stackoverflow.com/questions/40331179/how-to-automatically-parenthesize-arbitrary-haskell-expressions/40333747#40333747", "title": "How to automatically parenthesize arbitrary haskell expressions?", "body": "<p>It's not exactly what you're asking for, but I've found using <a href=\"https://hackage.haskell.org/package/hlint\" rel=\"nofollow\">HLint</a> to warn me about unnecessary parens when I'm <em>writing</em> Haskell to be a big help when I'm <em>reading</em>.</p>\n\n<p>You may also find the chart on page 23 of <a href=\"http://www.cse.chalmers.se/edu/year/2015/course/TDA452/Haskell-Prelude-Tour-A4.pdf\" rel=\"nofollow\">Bernie Pope's \"A tour of the Haskell Prelude\"</a> helpful. I've included a copy below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/k9i59.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/k9i59.png\" alt=\"page 23 of Bernie Pope&#39;s &quot;A tour of the Haskell Prelude&quot;\"></a></p>\n"}], "owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "accepted_answer_id": 40333460, "answer_count": 2, "score": 7, "last_activity_date": 1482794912, "creation_date": 1477845080, "question_id": 40331179, "link": "https://stackoverflow.com/questions/40331179/how-to-automatically-parenthesize-arbitrary-haskell-expressions", "title": "How to automatically parenthesize arbitrary haskell expressions?", "body": "<p>I'm learning haskell, and I have a lot of difficulty with mentally parsing many haskell expressions I come across.</p>\n\n<p>Of course, I expect that, with enough practice, mentally parsing haskell will become second-nature, but in the meantime, in order to make sense of what I come across, I'd like to find some automatic way to translate an arbitrary \"standard haskell\"<sup>1</sup> expression into one in which all \"ambiguous\"<sup>2</sup> sub-expressions have been eliminated by introducing the necessary parentheses.</p>\n\n<p>For example, it would translate the expression</p>\n\n<pre><code>f g h i\n</code></pre>\n\n<p>...into</p>\n\n<pre><code>((f g) h) i\n</code></pre>\n\n<p>..., or</p>\n\n<pre><code>a -&gt; b -&gt; c -&gt; d\n</code></pre>\n\n<p>...into</p>\n\n<pre><code>a -&gt; (b -&gt; (c -&gt; d))\n</code></pre>\n\n<p>..., etc.</p>\n\n<p>Preferably, this would be a tool I can access with my phone, since I do much of my reading on haskell away from a proper computer.</p>\n\n<hr>\n\n<p><sup><sup>1</sup>Of course, no such tool could possibly work with custom operators of unknown fixity and associativity.  By \"standard haskell\" I mean the stuff defined in the prelude and in the standard haskell library.</sup></p>\n\n<p><sup><sup>2</sup>I'm using \"ambiguous\" here as shorthand for \"ambiguous in the absence of precedence rules\".  E.g. <code>2 + 3 * 5</code> is ambiguous <em>unless</em> there's some precedence rule that settles the question of which of the two operations will be performed first.</sup></p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "lazy-evaluation", "tying-the-knot"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1477841464, "post_id": 40330562, "comment_id": 67916234, "body": "You can&#39;t really do that, but maybe you can fake it with proxy objects."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 5, "last_activity_date": 1477843682, "creation_date": 1477843682, "answer_id": 40330970, "question_id": 40330562, "link": "https://stackoverflow.com/questions/40330562/functional-pearl-implementing-trace-in-javascript/40330970#40330970", "title": "Functional Pearl: Implementing trace in JavaScript", "body": "<p>Actually, you only need lazy evaluation because assignments in JavaScript are like <code>letrec</code>. Lazy evaluation is generally implemented using <a href=\"https://en.wikipedia.org/wiki/Thunk\" rel=\"noreferrer\">thunks</a>. Hence, you can implement <code>trace</code> as follows:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function trace(f) {\n    return function (a) {\n        var [b, c] = f(a, () =&gt; c);\n        return b;\n    };\n}\n</code></pre>\n\n<p>Using this definition of <code>trace</code>, the <code>repmin</code> function can remain the same:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var repmin = trace(function repmin(tree, min) {\n    switch (tree.constructor) {\n    case Leaf:\n        return [new Leaf(min), tree.value];\n    case Node:\n        var [left,  lmin] = repmin(tree.left,  min);\n        var [right, rmin] = repmin(tree.right, min);\n        return [new Node(left, right), Math.min(lmin, rmin)];\n    }\n});\n</code></pre>\n\n<p>However, you'd want to make your data constructors possibly lazy using getters:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function Leaf(value) {\n    Object.defineProperty(this, \"value\", descOf(value));\n}\n\nfunction Node(left, right) {\n    Object.defineProperty(this, \"left\",  descOf(left));\n    Object.defineProperty(this, \"right\", descOf(right));\n}\n\nfunction descOf(value) {\n    var desc = { enumerable: true };\n    var prop = typeof value === \"function\" &amp;&amp;\n        value.length === 0 ? \"get\" : \"value\";\n    desc[prop] = value;\n    return desc;\n}\n</code></pre>\n\n<p>Putting it all together:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var tree = new Node(new Node(new Leaf(1), new Leaf(2)),\r\n                    new Node(new Leaf(3), new Leaf(4)));\r\n\r\nconsole.log(\"Input: \", show(tree));\r\n\r\nconsole.log(\"Output:\", show(repmin(tree)));\r\n\r\nfunction show(tree) {\r\n    switch (tree.constructor) {\r\n    case Leaf: return \"Leaf(\" + tree.value + \")\";\r\n    case Node: return \"Node(\" + show(tree.left) + \", \" + show(tree.right) + \")\";\r\n    }\r\n}</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script&gt;\r\nfunction trace(f) {\r\n    return function (a) {\r\n        var [b, c] = f(a, () =&gt; c);\r\n        return b;\r\n    };\r\n}\r\n\r\nvar repmin = trace(function repmin(tree, min) {\r\n    switch (tree.constructor) {\r\n    case Leaf:\r\n        return [new Leaf(min), tree.value];\r\n    case Node:\r\n        var [left,  lmin] = repmin(tree.left,  min);\r\n        var [right, rmin] = repmin(tree.right, min);\r\n        return [new Node(left, right), Math.min(lmin, rmin)];\r\n    }\r\n});\r\n\r\nfunction Leaf(value) {\r\n    Object.defineProperty(this, \"value\", descOf(value));\r\n}\r\n\r\nfunction Node(left, right) {\r\n    Object.defineProperty(this, \"left\",  descOf(left));\r\n    Object.defineProperty(this, \"right\", descOf(right));\r\n}\r\n\r\nfunction descOf(value) {\r\n    var desc = { enumerable: true };\r\n    var prop = typeof value === \"function\" &amp;&amp;\r\n        value.length === 0 ? \"get\" : \"value\";\r\n    desc[prop] = value;\r\n    return desc;\r\n}\r\n&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>The only problem is that you won't be able to write functions like:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var sqr = trace((x, y) =&gt; [y * y, x]);\n</code></pre>\n\n<p>This is because the <code>*</code> operator is not lazy. Hence, you would have to define a lazy <code>mul</code> function:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var sqr = trace((x, y) =&gt; [mul(y, y), x]);\r\n\r\nconsole.log(evaluate(sqr(10)));\r\n\r\nfunction mul(a, b) {\r\n    return function () {\r\n        return evaluate(a) * evaluate(b);\r\n    };\r\n}\r\n\r\nfunction evaluate(value) {\r\n    return typeof value === \"function\" &amp;&amp;\r\n        value.length === 0 ? value() : value;\r\n}\r\n\r\nfunction trace(f) {\r\n    return function (a) {\r\n        var [b, c] = f(a, () =&gt; c);\r\n        return b;\r\n    };\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "accepted_answer_id": 40330970, "answer_count": 1, "score": 4, "last_activity_date": 1477843682, "creation_date": 1477840829, "question_id": 40330562, "link": "https://stackoverflow.com/questions/40330562/functional-pearl-implementing-trace-in-javascript", "title": "Functional Pearl: Implementing trace in JavaScript", "body": "<p>Ross Paterson: <a href=\"http://www.staff.city.ac.uk/~ross/papers/fop.html\" rel=\"nofollow\">Arrows and Computation</a> introduces the <a href=\"https://en.wikipedia.org/wiki/Traced_monoidal_category\" rel=\"nofollow\"><code>trace</code></a> function (on page 11):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>trace :: ((a, c) -&gt; (b, c)) -&gt; a -&gt; b\ntrace f a = let (b, c) = f (a, c) in b\n</code></pre>\n\n<p>The <code>trace</code> function is useful for modularizing the magic feedback step in <a href=\"https://wiki.haskell.org/Circular_programming\" rel=\"nofollow\">circular programs</a>. For example, consider Richard Bird's famous <a href=\"http://dl.acm.org/citation.cfm?id=2697826\" rel=\"nofollow\"><code>repmin</code></a> function which finds the minimum leaf value of a tree <strong>and</strong> creates an identical tree with every leaf value replaced by the minimum leaf value, both in a single pass by making clever use of lazy evaluation and local recursion (as provided by <code>letrec</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree = Leaf Int | Node Tree Tree deriving Show\n\nrepmin :: Tree -&gt; Tree\nrepmin = trace repmin'\n\nrepmin' :: (Tree, Int) -&gt; (Tree, Int)\n-- put the minimum value m into the leaf and return the old value n as the minimum\nrepmin' (Leaf n, m) = (Leaf m, n)\n-- copy the minimum value m into both the left and right subtrees and\n-- set the minimum value m to the minimum of both the left and right subtrees\nrepmin' (Node l r, m) = let (l', lmin) = repmin' l m in\n                        let (r', rmin) = repmin' r m in\n                        (Node l' r', lmin `min` rmin)\n</code></pre>\n\n<p>Anyway, I was wondering how to implement the <code>trace</code> function in JavaScript such that we can implement <code>repmin</code> as follows:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function Leaf(value) {\n    this.value = value;\n}\n\nfunction Node(left, right) {\n    this.left  = left;\n    this.right = right;\n}\n\nvar repmin = trace(function repmin(tree, min) {\n    switch (tree.constructor) {\n    case Leaf:\n        return [new Leaf(min), tree.value];\n    case Node:\n        var [left,  lmin] = repmin(tree.left,  min);\n        var [right, rmin] = repmin(tree.right, min);\n        return [new Node(left, right), Math.min(lmin, rmin)];\n    }\n});\n</code></pre>\n\n<p>In order to implement <code>trace</code> we need local recursion as provided by <code>letrec</code> so that we can write something like:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function trace(f) {\n    return function (a) {\n        var [b, c] = f(a, c);\n        return b;\n    };\n}\n</code></pre>\n\n<p>I originally thought of making <code>c</code> a promise. However, that changes the semantics of <code>trace</code>. So, can you think of a way to implement <code>trace</code> in JavaScript without changing its semantics?</p>\n"}, {"tags": ["haskell", "smalltalk", "object-oriented-analysis"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 3, "creation_date": 1477840507, "post_id": 40330481, "comment_id": 67915963, "body": "In Objective C, you need very little imagination to see message passing, because that&#39;s what it&#39;s called. In C++, you need a bit more to understand method calls as messages. In C, you need quite a lot of imagination to see any sort of message passing. Whether you&#39;re using &quot;message passing&quot; depends on what names the language uses for its concepts and how strong your imagination is."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477841293, "post_id": 40330481, "comment_id": 67916186, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/4113138/object-oriented-programming-in-a-purely-functional-programming-context\">Object-oriented programming in a purely functional programming context?</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477841377, "post_id": 40330481, "comment_id": 67916213, "body": "(Perhaps not an exact duplicate, but it should bring you closer to an answer of some sort.)"}, {"owner": {"reputation": 12054, "user_id": 982238, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7540d351654e7a702370dcd2da7b7a43?s=128&d=identicon&r=PG", "display_name": "Uko", "link": "https://stackoverflow.com/users/982238/uko"}, "edited": false, "score": 0, "creation_date": 1477841472, "post_id": 40330481, "comment_id": 67916238, "body": "I thinks it makes more sense to put the question on <a href=\"http://softwareengineering.stackexchange.com\">softwareengineering.stackexchange.com</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477843549, "post_id": 40330481, "comment_id": 67916797, "body": "I guess it should be possible to do that in Haskell, but it would be quite unidiomatic. A program in that style doing task X would likely ignore all the convenient solutions to achieve X in Haskell and choose a weird, verbose, inconvenient way to solve X. This is not specific to Haskell. For instance, I would never use a <code>State</code> monad built on closures in Java to express mutability -- that would be silly, when mutable objects are the predominant idiom. Doing OOP in Haskell is, IMO, similarly pointless."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1477845286, "post_id": 40330481, "comment_id": 67917282, "body": "Sure, why not: <code>type Message a = a; type Messaging a r = Message a -&gt; r; sendMessage :: Message a -&gt; Messaging a r -&gt; r; sendMessage m k = k m</code>. Without specifying in more detail what you mean by &#39;structure a Haskell program&#39; this completely trivial model fits your requirements quite fine. Modelling OOP in a functional language can be simple or absurdly complicated depending on precisely the domain you want to model."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1477845853, "post_id": 40330481, "comment_id": 67917424, "body": "Who knows what OOP is supposed to be, but it seems to me OOP is about scoping mutable state. &quot;Messaging&quot; too is not an apt word unless you&#39;re dealing with mutability and side-effects (consider a &quot;pure&quot; actor: <code>newtype Actor msg = Actor (msg -&gt; MonadForSendingMessages (Actor msg))</code>; such an &quot;object&quot; is pure and can be stateful, changing its behavior for the next message based on the current one,  but this would be rather useless without <code>MonadForSendingMessages</code>). So to answer your question you should explore how state flows and is encapsulated in a pure program"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1477848658, "last_edit_date": 1477848658, "creation_date": 1477848190, "answer_id": 40331637, "question_id": 40330481, "link": "https://stackoverflow.com/questions/40330481/can-a-haskell-program-resemble-objects-passing-messages-to-each-other/40331637#40331637", "title": "Can a Haskell program resemble objects passing messages to each other?", "body": "<blockquote>\n  <p>only messaging, local retention and protection and hiding of\n  state-process</p>\n  \n  <p>like biological cells and/or individual computers on a network, only\n  able to communicate with messages</p>\n</blockquote>\n\n<p>I believe certain Haskell programming patterns do resemble Kay's description, to a degree.</p>\n\n<p>In streaming libraries like <a href=\"https://hackage.haskell.org/package/conduit\" rel=\"nofollow\"><em>conduit</em></a>, <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\"><em>pipes</em></a> or <a href=\"https://hackage.haskell.org/package/streaming\" rel=\"nofollow\"><em>streaming</em></a>, it is common to build a computation as a pipeline composed of different stages. Each part of the pipeline is quite independent of the others and can maintain its own private state (you can have \"shared\" state in the pipeline as well).</p>\n\n<p>The topologies tend to be linear and unidirectional. That said, abstractions like <em>conduit</em>'s <a href=\"http://hackage.haskell.org/package/conduit-1.2.8/docs/Data-Conduit.html#t:ZipSink\" rel=\"nofollow\"><code>ZipSink</code></a>\u2014and the <code>Applicative</code> instance for <code>Fold</code>s in the <a href=\"https://hackage.haskell.org/package/foldl\" rel=\"nofollow\"><em>foldl</em></a> package\u2014let you build \"tree-like\" topologies that branch out. And <em>pipes</em> can be <a href=\"http://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes-Core.html\" rel=\"nofollow\">bidirectional</a>, although I haven't seen many examples that make use of it.</p>\n\n<p>Then there's <a href=\"https://wiki.haskell.org/Yampa\" rel=\"nofollow\">arrowized functional reactive programming</a>. It lets you build \"circuits\" of automaton arrows that <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#t:ArrowLoop\" rel=\"nofollow\">can even include loops</a>. Each part of the circuit can maintain its own state. As the description of the <a href=\"https://hackage.haskell.org/package/netwire\" rel=\"nofollow\"><em>netwire</em></a> FRP library states:</p>\n\n<blockquote>\n  <p>This library provides interfaces for and implements wire arrows useful\n  both for functional reactive programming (FRP) and <strong>locally stateful</strong>\n  programming (LSP).</p>\n</blockquote>\n\n<p>And from the docs of the <a href=\"https://hackage.haskell.org/package/auto\" rel=\"nofollow\"><em>auto</em></a> library:</p>\n\n<blockquote>\n  <p>auto works by providing a type that encapsulates value stream\n  transformers, or locally stateful functions; by specifying your\n  program as a (potentially cyclic) graph of relationships between value\n  streams, you create a way of declaring a system based simply on static\n  relationships between quantities.</p>\n  \n  <p>Instead of a state monad type solution, where all functions have\n  access to a rigid global state, auto works by specifying relationships\n  which each exist independently and on their own, without any global\n  state.</p>\n</blockquote>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 2, "closed_date": 1477858328, "answer_count": 1, "score": 5, "last_activity_date": 1477848658, "creation_date": 1477840269, "last_edit_date": 1477841536, "question_id": 40330481, "link": "https://stackoverflow.com/questions/40330481/can-a-haskell-program-resemble-objects-passing-messages-to-each-other", "closed_reason": "Needs more focus", "title": "Can a Haskell program resemble objects passing messages to each other?", "body": "<p>Haskell is a purely functional language, breaking from traditional object-oriented languages. However, consider the following quote from Alan Kay on the \"true\" meaning of OOP:</p>\n\n<blockquote>\n  <p>OOP to me means only messaging, local retention and protection and hiding of state-process, and extreme late-binding of all things. It can be done in Smalltalk and in LISP. There are possibly other systems in which this is possible, but I\u2019m not aware of them. -- Alan Kay</p>\n</blockquote>\n\n<p>and later on:</p>\n\n<blockquote>\n  <p>I thought of objects being like biological cells and/or individual computers on a network, only able to communicate with messages (so messaging came at the very beginning -- it took a while to see how to do messaging in a programming language efficiently enough to be useful).</p>\n</blockquote>\n\n<p>I'm curious to what extent this style of programming can be achieved in Haskell. In particular, is it possible to structure a Haskell program as a sequence of (something resembling) encapsulated objects <strong>passing messages back and forth to each other</strong>?</p>\n\n<p>NOTE: I'm looking for examples specific to Haskell, not functional languages at large (when in conflict).</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1477840017, "post_id": 40330388, "comment_id": 67915829, "body": "Check out <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\"><code>Data.List</code></a>. You&#39;re looking for <code>groupBy</code> and <code>minimumBy</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1477841902, "post_id": 40330516, "comment_id": 67916340, "body": "Rebuilding a list with <code>foldl</code> by appending single elements with <code>(++)</code> is not a good idea -- use <code>foldr</code> and <code>(:)</code> instead. Furthermore, there is no need to reimplement the whole thing. You can reuse <code>filter</code> just fine, with something like <code>filter&#39; p q = filter (uncurry (&amp;&amp;) . bimap p q)</code>."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477842130, "post_id": 40330516, "comment_id": 67916395, "body": "Good point. Changed my implementation to use <code>foldr</code>, though what you&#39;ve included is better/more concise."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477842297, "post_id": 40330516, "comment_id": 67916445, "body": "What is the <code>bimap</code> function you are using?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477842596, "post_id": 40330516, "comment_id": 67916546, "body": "It is in <code>Data.Bifunctor</code>, and can be used to map two different functions to e.g. each component of an <code>(a, b)</code> pair or each case of <code>Either a b</code>."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 1, "last_activity_date": 1477842070, "last_edit_date": 1477842070, "creation_date": 1477840461, "answer_id": 40330516, "question_id": 40330388, "link": "https://stackoverflow.com/questions/40330388/how-can-i-compare-elements-of-two-lists-according-to-one-predicate-and-select-ac/40330516#40330516", "title": "How can I compare elements of two lists according to one predicate and select according to another?", "body": "<p>To solve a general case, you can define modified version of filter that pattern-matches a tuple containing two predicates and checks if both are satisfied.</p>\n\n<pre><code>filter' :: ((a-&gt;Bool),(a-&gt;Bool)) -&gt; [(a,a)] -&gt; [(a,a)]\nfilter' (pred1,pred2) = foldr f []\n where f = (\\x acc -&gt; if pred1 $ fst x then\n                                        if pred2 $ snd x then x : acc\n                                        else acc\n                      else acc\n           )\n</code></pre>\n\n<p>Which would evaluate a list <code>[(1,2),(2,2),(3,3),(3,4)]</code> with the first predicate <code>odd</code> and the second predicate <code>even</code> as:</p>\n\n<pre><code>&gt;&gt; filter' (odd,even) [(1,2),(2,2),(3,3),(3,4)]\n[(1,2),(3,4)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1477844141, "last_edit_date": 1495542803, "creation_date": 1477844141, "answer_id": 40331043, "question_id": 40330388, "link": "https://stackoverflow.com/questions/40330388/how-can-i-compare-elements-of-two-lists-according-to-one-predicate-and-select-ac/40331043#40331043", "title": "How can I compare elements of two lists according to one predicate and select according to another?", "body": "<p>I will assume that...</p>\n\n<blockquote>\n  <p>What I am trying to achieve is to compare two lists of tuples with <code>((==) `on` fst)</code> </p>\n</blockquote>\n\n<p>... means comparing each pair in one list with the corresponding pair in the other list, as in the usual <code>(==)</code> for lists.</p>\n\n<p>Here is a mostly pointfree (and perhaps slightly cranky) solution that stays close to your original suggestions:</p>\n\n<pre><code>-- Suggestions of sensible names for this are welcome.\nyourSelector :: (Eq a, Ord b) =&gt; [(a, b)] -&gt; [(a, b)] -&gt; [(a, b)]\nyourSelector ps = fmap (minBy' snd)\n    . filter (uncurry ((==) `on` fst)) . zip ps\n    where\n    minBy' f (x, y) = case (compare `on` f) x y of\n        LT -&gt; x\n        _ -&gt; y\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; yourSelector [(1,2),(3,5),(4,7)] [(1,3),(2,2),(4,9)]\n[(1,2),(4,7)]\n</code></pre>\n\n<p>For alternative ways of writing <code>minBy'</code>, cf. <a href=\"https://stackoverflow.com/q/40209169/2751851\"><em>Maximizing according to a function</em></a>.</p>\n"}], "owner": {"reputation": 348, "user_id": 310378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/36752538526b328cb5c451a19a257b0d?s=128&d=identicon&r=PG", "display_name": "kureta", "link": "https://stackoverflow.com/users/310378/kureta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 40330516, "answer_count": 2, "score": 0, "last_activity_date": 1477844141, "creation_date": 1477839573, "last_edit_date": 1477839909, "question_id": 40330388, "link": "https://stackoverflow.com/questions/40330388/how-can-i-compare-elements-of-two-lists-according-to-one-predicate-and-select-ac", "title": "How can I compare elements of two lists according to one predicate and select according to another?", "body": "<p>What I am trying to achieve is to compare two lists of tuples with <code>((==) `on` fst)</code> and out of the pairs that satisfy this predicate, select the ones that satisfy <code>(min `on` snd)</code></p>\n"}, {"tags": ["haskell", "pattern-matching", "strictness"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": true, "score": 15, "last_activity_date": 1477834189, "last_edit_date": 1477834189, "creation_date": 1477830548, "answer_id": 40329068, "question_id": 40328862, "link": "https://stackoverflow.com/questions/40328862/is-there-any-guarantee-about-the-evaluation-order-within-a-pattern-match/40329068#40329068", "title": "Is there any guarantee about the evaluation order within a pattern match?", "body": "<p>Yes, it is guaranteed that evaluating the expression <code>both (False, undefined)</code> will not diverge since matching on data constructors is guaranteed to match left-to-right against the components of the constructor and the pattern fails as soon as some sub-pattern fails. Since the first element of the tuple is <code>False</code>, the pattern will fail for both <code>(True, ...)</code> branches as soon as the first element fails to match. </p>\n\n<p>Per the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-600003.17.2\" rel=\"noreferrer\">Haskell 2010 Report, section 3.17.2</a>, which gives an informal semantics of pattern matching:</p>\n\n<blockquote>\n  <ol start=\"5\">\n  <li>Matching the pattern <em>con pat1 \u2026 patn</em> against a value, where <em>con</em> is a constructor defined by data, depends on the value:\n  \n  <ul>\n  <li>If the value is of the form <em>con v1 \u2026 vn</em>, sub-patterns are matched left-to-right against the components of the data value; if all matches succeed, the overall match succeeds; the first to fail or diverge causes the overall match to fail or diverge, respectively.</li>\n  <li>If the value is of the form <em>con\u2032 v1 \u2026 vm</em>, where con is a different constructor to <em>con\u2032</em>, the match fails.</li>\n  <li>If the value is \u22a5, the match diverges.</li>\n  </ul></li>\n  </ol>\n</blockquote>\n\n<p>Since the tuple syntax is just a special-case syntactic sugar for a data constructor, the above applies.</p>\n\n<p>For a fuller treatment of pattern matching, see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-610003.17.3\" rel=\"noreferrer\">section 3.17.3 of the Haskell 2010 Report</a>, which gives a formal semantics of pattern matching (specifically, figure 3.2 pertains to this question).</p>\n\n<p>Another resource of interest is the paper <a href=\"http://programatica.cs.pdx.edu/P/journal-wrs2002.pdf\" rel=\"noreferrer\">Pattern-driven Reduction in Haskell</a> which specifies the semantics as an interpreter (written in Haskell) of an abstract syntax representation of Haskell's concrete syntax (the function <code>mP</code> in figure 3, page 7 is relevant to the question).</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 2, "accepted_answer_id": 40329068, "answer_count": 1, "score": 13, "last_activity_date": 1477834189, "creation_date": 1477829205, "question_id": 40328862, "link": "https://stackoverflow.com/questions/40328862/is-there-any-guarantee-about-the-evaluation-order-within-a-pattern-match", "title": "Is there any guarantee about the evaluation order within a pattern match?", "body": "<p>The following</p>\n\n<pre><code>(&amp;&amp;) :: Bool -&gt; Bool -&gt; Bool\nFalse &amp;&amp; _ = False\nTrue &amp;&amp; False = False\nTrue &amp;&amp; True = True\n</code></pre>\n\n<p>has the desired short-circuit property <code>False &amp;&amp; undefined \u2261 False</code>. The first clause, which is non-strict in the right argument, is guaranteed to be checked before anything else is tried.</p>\n\n<p>Apparently, it still works if I change the order and even uncurry the function</p>\n\n<pre><code>both :: (Bool,Bool) -&gt; Bool\nboth (True,False) = False\nboth (True, True) = True\nboth (False, _) = False\n\nPrelude&gt; both (False, undefined)\nFalse\n</code></pre>\n\n<p>but is this actually guaranteed by the standard? Unlike with the order of clauses, the order of evaluation of the patterns is not so clear here. Can I actually be sure that matching <code>(True,False)</code> will be aborted as soon as <code>(False,_)</code> is determined, before the snd element is evaluated at all?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477826275, "post_id": 40328222, "comment_id": 67912025, "body": "Note that making the arguments <code>Int</code> but the results <code>Float</code> gives you a problem that&#39;s unrelated to the current error: the numeric types need to be converted; Haskell always requires this to be made explicit. Use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral</code></a> for this."}, {"owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477829602, "post_id": 40328222, "comment_id": 67912844, "body": "Can you please show me how exactly that is done? do I need to change the signature? I simply added fromIntegral like for example: ((w - (fromIntegral r/255))/w, but that didn&#39;t seem to make it work."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477829847, "post_id": 40328222, "comment_id": 67912920, "body": "You need to do the conversion before all divisions. I would just first convert all the rgb channels before doing any computations; one way to do that is to match \u201cpre-arguments\u201d <code>rgb2cmyk r&#39; g&#39; b&#39; = ...</code> and use <code>where [r,g,b] = [fromIntegral c&#47;255 | c&lt;-[r&#39;,g&#39;,b&#39;]]</code> to get <code>r</code>, <code>g</code> and <code>b</code> in floating-point and range-normalise form."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477836008, "post_id": 40328365, "comment_id": 67914734, "body": "I forgot (or, more likely, never realized) you could specify multiple fields with a common type like this."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1477845371, "post_id": 40328365, "comment_id": 67917304, "body": "Unboxing strict fields is an optimization flag, not a language extension, and it&#39;s on by default (if optimizations are enabled) for fields that use only a single word when unboxed."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1477826308, "last_edit_date": 1477826308, "creation_date": 1477825169, "answer_id": 40328365, "question_id": 40328222, "link": "https://stackoverflow.com/questions/40328222/rgb-to-cmyk-haskell/40328365#40328365", "title": "RGB to CMYK, Haskell", "body": "<p>Haskell functions with multiple arguments work in a somewhat strange (but, after you've gotten used to it, extremely useful) way. <code>rgb2cmyk r g b = ...</code> is actually just a short way of writing the <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus\" rel=\"nofollow\">lambda expression</a> <code>rgb2cmyk = \\r -&gt; \\g -&gt; \\b -&gt; ...</code>, i.e. this is actually a <em>nesting</em> of three functions, each of which takes only a single argument. Hence the type of this function is really</p>\n\n<pre><code>rgb2cmyk :: Int -&gt; (Int -&gt; (Int -&gt; ...))\n</code></pre>\n\n<p>Because this pattern is so common in Haskell, the parsing rules are defined so you can omit those parentheses. The signature you're trying to define is thus actually</p>\n\n<pre><code>rgb2cmyk :: Int -&gt; Int -&gt; Int -&gt; (Float,Float,Float,Float)\n</code></pre>\n\n<p>Alternatively, you could also make it</p>\n\n<pre><code>rgb2cmyk :: (Int,Int,Int) -&gt; (Float,Float,Float,Float)\nrgb2cmyk (r,g,b) = ...\n</code></pre>\n\n<p>In this case, <code>rgb2cmyk</code> has only a <em>single</em> argument, but that has a compound type. I'd argue that this is actually more sensible for this particular function than three separate arguments for each colour<sup>\u2020</sup>.</p>\n\n<p>But <code>Int Int Int</code> is not a compound type of three integers, it means something very different: it interprets the first <code>Int</code> as a <em>type-level function</em> which is applied to two other <code>Int</code>s. That doesn't make sense, <code>Int</code> is not a type-level function. This is what that compiler error is telling you.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>In fact, you should probably not use tuples but suitably named record types:</sub></p>\n\n<pre><code>data RGB = RGB {_RChannel, _GChannel, _BChannel :: !Int}\ndata CMYK = CMYK {_CChannel, _MChannel, _YChannel, _KChannel :: !Float}\n</code></pre>\n\n<p><sub>Here, the <code>!</code> makes the individual channels <em>strict</em>: it doesn't really make a lot of sense to evaluate all colour channels individually and is more efficient to do them in one go. If you turn on the <code>-XUnboxStrictFields</code> extension, GHC will also compile strict records to a much more memory-efficient structure.\n</sub></p>\n"}], "owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 40328365, "answer_count": 1, "score": 3, "last_activity_date": 1477826308, "creation_date": 1477824132, "question_id": 40328222, "link": "https://stackoverflow.com/questions/40328222/rgb-to-cmyk-haskell", "title": "RGB to CMYK, Haskell", "body": "<p>Haskell beginner (and new to programming in general), I am trying to write a code that converts RGB color values to CMYK. I have searched around here for reference, and after that I managed to write this:</p>\n\n<pre><code>rgb2cmyk :: Int Int Int -&gt; (Float,Float,Float,Float)\nrgb2cmyk r g b = ((w - (r/255))/w, (w - (g/255))/w, (w -(b/255))/w, 1 - w)\n             where  w = max (r/255, g/255, b/255)\n</code></pre>\n\n<p>When trying to load the module in GHCi I get the following:</p>\n\n<pre><code>\u2018Int\u2019 is applied to too many type arguments\nIn the type signature for \u2018rgb2cmyk\u2019:\n  rgb2cmyk :: Int Int Int -&gt; (Float, Float, Float, Float)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I don't really understand what I did wrong, can anyone provide any guidance? Thanks.</p>\n"}, {"tags": ["haskell", "ghc", "proof"], "answers": [{"comments": [{"owner": {"reputation": 299, "user_id": 1324454, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e86c4b41d6688faabbe2eeecbe8b5d8f?s=128&d=identicon&r=PG", "display_name": "Mads Buch", "link": "https://stackoverflow.com/users/1324454/mads-buch"}, "edited": false, "score": 0, "creation_date": 1477837801, "post_id": 40328581, "comment_id": 67915247, "body": "I tried that, but then following also compiles: <code>zeroNeqOne :: Z == Z -&gt; a</code>, which it shouldn&#39;t (compiling like <code>ghci ZeroNeqOne.hs -XDataKinds -fwarn-incomplete-patterns -Werror</code>)."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 299, "user_id": 1324454, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e86c4b41d6688faabbe2eeecbe8b5d8f?s=128&d=identicon&r=PG", "display_name": "Mads Buch", "link": "https://stackoverflow.com/users/1324454/mads-buch"}, "edited": false, "score": 0, "creation_date": 1477839966, "post_id": 40328581, "comment_id": 67915808, "body": "It seems to be <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10746\" rel=\"nofollow noreferrer\">a bug in the coverage checker</a>. So for now you&#39;ll need to be careful when using empty-case. That being said, it&#39;s not more dangerous than having type signatures with no accompanying definition like you requested."}, {"owner": {"reputation": 299, "user_id": 1324454, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e86c4b41d6688faabbe2eeecbe8b5d8f?s=128&d=identicon&r=PG", "display_name": "Mads Buch", "link": "https://stackoverflow.com/users/1324454/mads-buch"}, "edited": false, "score": 1, "creation_date": 1477840270, "post_id": 40328581, "comment_id": 67915896, "body": "The hope was that I could achieve this using no accompanying binding, also with a compile time error when there is a pattern. I guess realt theorem provers a preferred when doing serious stuff anyways. But thanks!"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 299, "user_id": 1324454, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e86c4b41d6688faabbe2eeecbe8b5d8f?s=128&d=identicon&r=PG", "display_name": "Mads Buch", "link": "https://stackoverflow.com/users/1324454/mads-buch"}, "edited": false, "score": 1, "creation_date": 1477841191, "post_id": 40328581, "comment_id": 67916157, "body": "You talking about theorem proving got me thinking and it turns out that we can use <code>TypeFamilies</code> to write a nice solution! See my edit."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 3, "last_activity_date": 1477841144, "last_edit_date": 1477841144, "creation_date": 1477827026, "answer_id": 40328581, "question_id": 40328044, "link": "https://stackoverflow.com/questions/40328044/haskell-disable-accompanying-binding-check-haskell/40328581#40328581", "title": "Haskell - disable accompanying binding check haskell", "body": "<p>You don't need to: using the <code>EmptyCase</code> language extension, this statement is actually provable. Here is a self-contained file demonstrating it:</p>\n\n<pre><code>{-# LANGUAGE GADTs         #-}\n{-# LANGUAGE PolyKinds     #-}\n{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE EmptyCase     #-}\n\nmodule ZeroNeqOne where\n\ndata (==) a b where\n  Refl :: a == a\n\ndata Nat where\n  Z :: Nat\n  S :: Nat -&gt; Nat\n\nzeroNeqOne :: Z == S Z -&gt; a\nzeroNeqOne p = case p of {}\n</code></pre>\n\n<p>Given that you were talking about theorem proving in the comments it got me thinking and it turns out we can play a little game Coq users like quite a bit: using a diagonal function at the type level. Cf. JF Monin's <a href=\"http://www-verimag.imag.fr/~monin/Publis/Docs/coq2.pdf\" rel=\"nofollow\">Proof Trick: Small inversions</a>. This time we'll use the <code>TypeFamilies</code> extension. The idea to discard a contradictory <code>a == b</code> is to use a type-level function that will ask us to prove a trivial goal when presented with <code>a</code> and an impossible one when presented with <code>b</code>. And then use the proof of equality to transport the trivial result to the impossible one:</p>\n\n<pre><code>{-# LANGUAGE GADTs         #-}\n{-# LANGUAGE PolyKinds     #-}\n{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeFamilies  #-}\n\nmodule ZeroNeqOneDiag where\n\nimport Data.Void\n\ndata (==) a b where\n  Refl :: a == a\n\nsubst :: a == b -&gt; p a -&gt; p b\nsubst Refl pa = pa\n\ndata Nat where\n  Z :: Nat\n  S :: Nat -&gt; Nat\n\ntype family Diag (n :: Nat) :: * where\n  Diag 'Z     = ()\n  Diag ('S n) = Void\n\nnewtype Diagonal n = Diagonal { runDiagonal :: Diag n }\n\nzeroNeqOneDiag :: 'Z == 'S 'Z -&gt; Void\nzeroNeqOneDiag p = runDiagonal $ subst p (Diagonal ())\n</code></pre>\n"}], "owner": {"reputation": 299, "user_id": 1324454, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e86c4b41d6688faabbe2eeecbe8b5d8f?s=128&d=identicon&r=PG", "display_name": "Mads Buch", "link": "https://stackoverflow.com/users/1324454/mads-buch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 40328581, "answer_count": 1, "score": 1, "last_activity_date": 1477841144, "creation_date": 1477822868, "question_id": 40328044, "link": "https://stackoverflow.com/questions/40328044/haskell-disable-accompanying-binding-check-haskell", "title": "Haskell - disable accompanying binding check haskell", "body": "<p>I wan't to disable the function that checks for accompanying binding in Haskell.</p>\n\n<p>The reason I want to do this is to be able to able to implement proof by contradiction. Following type signature does not have any binding, and should not have so.</p>\n\n<pre><code>zeroDoesNotEqualOne :: Refl Z (S Z) -&gt; Bottom\n</code></pre>\n\n<p>There are no inhabitant to the type <code>Refl Z (S Z)</code>, and therefore there should be no binding.</p>\n\n<p>In the above snippet the types mean what you would expect such that <code>S Z</code> is the Peano natural for 1 and <code>Refl</code> only has a single inhabitant of type <code>Refl a a</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 3, "creation_date": 1477820500, "post_id": 40327699, "comment_id": 67910550, "body": "<code>fromJust</code> and <code>inJust</code> are not in the Prelude, but live in Data.Maybe. You need to start your module with a line like <code>import Data.Maybe (fromJust, isJust)</code> (which imports <code>fromJust</code> and <code>inJust</code> into global scope) or <code>import Data.Maybe</code> (which imports everything from <code>Data.Maybe</code> into global scope). Also, please just copy the text of the errors of one compilation round to the question, rather than taking a screenshot of six compilation rounds with the same errors."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1477820654, "post_id": 40327699, "comment_id": 67910579, "body": "Why do you need <code>filterJust [] = []</code>?"}, {"owner": {"reputation": 173, "user_id": 6900669, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ac12dce0c1fe17b172f3859ee0d3d8c0?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Bujdo\u0161", "link": "https://stackoverflow.com/users/6900669/tibor-bujdo%c5%a1"}, "edited": false, "score": 0, "creation_date": 1477820996, "post_id": 40327699, "comment_id": 67910664, "body": "thanks a lot Rhymoid. Im stupid and tought it actually is in Prelude"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1477821504, "post_id": 40327699, "comment_id": 67910788, "body": "The Prelude is quite messy, so it&#39;s not dumb to think <code>fromJust</code> and <code>isJust</code> are part of it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 12, "creation_date": 1477822196, "post_id": 40327699, "comment_id": 67910948, "body": "please cut-and-paste your error messages as text, not pictures."}], "answers": [{"comments": [{"owner": {"reputation": 3685, "user_id": 5812238, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b99072b57c3ba6f1c4049e21767571cb?s=128&d=identicon&r=PG&f=1", "display_name": "diralik", "link": "https://stackoverflow.com/users/5812238/diralik"}, "edited": false, "score": 5, "creation_date": 1583272777, "post_id": 40327860, "comment_id": 107058908, "body": "Also <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html#v:mapMaybe\" rel=\"nofollow noreferrer\"><code>mapMaybe</code></a> can be useful"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 25, "last_activity_date": 1603392992, "last_edit_date": 1603392992, "creation_date": 1477821411, "answer_id": 40327860, "question_id": 40327699, "link": "https://stackoverflow.com/questions/40327699/filtering-nothing-and-unpack-just/40327860#40327860", "title": "Filtering Nothing and unpack Just", "body": "<p>You don't need to write <code>filterJust</code> function. It is already in <code>base</code> and it is called <code>catMaybes</code>: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html#v:catMaybes\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html#v:catMaybes</a></p>\n<p>Also, you can see better way to define this function:</p>\n<pre><code>catMaybes :: [Maybe a] -&gt; [a]\ncatMaybes ls = [x | Just x &lt;- ls]\n</code></pre>\n<p>So all you need to do is just add <code>import Data.Maybe (catMaybes)</code> into your module.</p>\n<p>Here this function is using the &quot;MonadFail sugar&quot; design pattern for lists. You can read more about it and other patterns in the following blog post:</p>\n<ul>\n<li><a href=\"https://kowainik.github.io/posts/haskell-mini-patterns#monadfail-sugar\" rel=\"nofollow noreferrer\">https://kowainik.github.io/posts/haskell-mini-patterns#monadfail-sugar</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1477826769, "creation_date": 1477826769, "answer_id": 40328548, "question_id": 40327699, "link": "https://stackoverflow.com/questions/40327699/filtering-nothing-and-unpack-just/40328548#40328548", "title": "Filtering Nothing and unpack Just", "body": "<ul>\n<li><code>/=</code> can only be used on values of a type that implements <code>Eq</code> (<code>(/=) :: (Eq a) -&gt; a -&gt; a -&gt; Bool</code>).</li>\n<li><code>Maybe a</code> supports <code>Eq</code> only if <code>a</code> does (there's an <code>instance (Eq a) =&gt; Eq (Maybe a)</code>).</li>\n<li>Your type signature says that <code>filterJust</code> works for all types <code>a</code>, even those that don't implement <code>Eq</code>: <code>[Maybe a] -&gt; [a]</code></li>\n</ul>\n\n<p>Therefore <code>filterJust</code> can't use <code>/=</code>.</p>\n"}], "owner": {"reputation": 173, "user_id": 6900669, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ac12dce0c1fe17b172f3859ee0d3d8c0?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Bujdo\u0161", "link": "https://stackoverflow.com/users/6900669/tibor-bujdo%c5%a1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5785, "favorite_count": 0, "answer_count": 2, "score": 11, "last_activity_date": 1603392992, "creation_date": 1477820095, "last_edit_date": 1477896808, "question_id": 40327699, "link": "https://stackoverflow.com/questions/40327699/filtering-nothing-and-unpack-just", "title": "Filtering Nothing and unpack Just", "body": "<p>I'm having trouble with this program.</p>\n\n<pre><code>filterJust :: [Maybe a] -&gt; [a]\n\nfilterJust [] = []\nfilterJust x = map fromJust (filter (isJust) x)\n</code></pre>\n\n<p>but ghci keeps reporting this</p>\n\n<p><a href=\"https://i.stack.imgur.com/scXox.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/scXox.png\" alt=\"but ghci keeps reporting this\"></a></p>\n\n<p>EDIT:</p>\n\n<p>I don't want to use any additional module so i made this:</p>\n\n<pre><code>filterJust :: [Maybe a] -&gt; [a]\n\nfilterJust x = map unpack (filter (Nothing /=) x)\n\nunpack (Just a) = a\n</code></pre>\n\n<p>and i get this message</p>\n\n<p><a href=\"https://i.stack.imgur.com/ssOtg.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/ssOtg.png\" alt=\"and i get this message\"></a></p>\n\n<p>and i dont understand why. I should be able to use Eq functions without importing anthing right?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477783153, "post_id": 40324583, "comment_id": 67904686, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/6258609/haskell-what-makes-main-unique\">Haskell - What makes &#39;main&#39; unique?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477854869, "post_id": 40324614, "comment_id": 67920176, "body": "&quot;You can fix this by using the functions provided with StateT and ErrorT for converting them to actions of the underlying monad.&quot;. What do you mean?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477857043, "post_id": 40324614, "comment_id": 67920773, "body": "@Gilgamesz E.g., <code>runStateT</code> and <code>runErrorT</code>."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 5, "last_activity_date": 1477814850, "last_edit_date": 1477814850, "creation_date": 1477783128, "answer_id": 40324614, "question_id": 40324583, "link": "https://stackoverflow.com/questions/40324583/matching-types-and-monads-error/40324614#40324614", "title": "Matching types and monads. Error", "body": "<p><code>main</code> must be of type <code>IO a</code> for some <code>a</code> (usually, but not necessarily, <code>()</code>). It can't be of type <code>StateT Int (ErrorT String IO)</code>. You can fix this by using the functions provided with <code>StateT</code> and <code>ErrorT</code> for converting them to actions of the underlying monad.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 40324614, "answer_count": 1, "score": 2, "last_activity_date": 1477814850, "creation_date": 1477782823, "last_edit_date": 1477788860, "question_id": 40324583, "link": "https://stackoverflow.com/questions/40324583/matching-types-and-monads-error", "title": "Matching types and monads. Error", "body": "<pre><code>type C = StateT Int (ErrorT String IO)\n\n\nmain :: C ()\nmain = do\n  args &lt;- liftIO $ getArgs\n  case args of\n    [] -&gt; liftIO $ putStrLn \"E\"\n    (p:ps) -&gt; s \"d\"\n\ns :: String -&gt; C ()\n</code></pre>\n\n<p>I've got the error:</p>\n\n<pre><code>     Couldn't match type \u2018Control.Monad.Trans.State.Lazy.StateT\n                           Int\n                           (Control.Monad.Trans.Error.ErrorT String IO)\n                           ()\u2019\n                   with \u2018IO t0\u2019\n    Expected type: IO t0\n      Actual type: C ()\n    In the expression: main\n    When checking the type of the IO action \u2018main\u2019\n</code></pre>\n\n<p>I cannot understand why there is an error and how to repair it. Please help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1477782435, "post_id": 40324482, "comment_id": 67904554, "body": "Can you explain a bit more why you think there&#39;d be a problem?  Why would <code>arg</code>&#39;s type matter? Do you think <code>args</code> is the return value of <code>main</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1477782487, "post_id": 40324482, "comment_id": 67904564, "body": "Why do you think it should raise an error? If the type of  <code>getArgs</code> is <code>IO [String]</code>, then the type of <code>args</code> in <code>do { args &lt;- getArgs; ... }</code> is <code>[String]</code>. Then <code>case args of { .. }</code> must have type <code>IO ()</code> because it is the final statement in the do block, which has type <code>IO ()</code> (due to the annotation). Then each pattern in the case must bind something of type <code>[String]</code> and produce an <code>IO ()</code>. Clearly <code>[]</code> is a pattern of type <code>[String]</code> and <code>putStrLn .. :: IO ()</code>. This is exactly what the typechecker does."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477812669, "post_id": 40324482, "comment_id": 67908934, "body": "The type of a <code>do</code> block is the type of the <i>last</i> statement -- in this case, of <code>case ...</code> which has the same type of <code>putStrLn &quot;..&quot;</code> which is <code>IO ()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477826075, "post_id": 40324531, "comment_id": 67911968, "body": "@Gilgamesz I&#39;m sorry I can&#39;t see what you edited in your post :/"}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477826275, "post_id": 40324531, "comment_id": 67912026, "body": "I missed to click: EDIT ;)."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477854669, "post_id": 40324531, "comment_id": 67920121, "body": "Ok, I found the problem in my reasoning: &quot;<code>getArgs</code> is expected to have type <code>C [String]</code>, but it has type <code>IO [String]</code>&quot;. Why expected type is <code>C [String]</code>? After all, The type of a do block is the type of the last statement, so it should be ok."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477949994, "post_id": 40324531, "comment_id": 67956539, "body": "@Gilgamesz if you are in the context of a monad, you can only run monadic action wrapped in that monad. Here, if your function has type <code>C ()</code>, you can only write things such as <code>x &lt;- action</code> if <code>action</code> has type <code>C something</code>, so because <code>getArgs</code> has type <code>IO [String]</code>, you can&#39;t directly call it from <code>main</code>, you first have to wrap the <code>IO</code> action into your <code>C</code> monad, here, with <code>lift</code> or <code>liftIO</code>"}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 6, "last_activity_date": 1495476706, "last_edit_date": 1495540968, "creation_date": 1477782389, "answer_id": 40324531, "question_id": 40324482, "link": "https://stackoverflow.com/questions/40324482/different-type-of-function-and-in-do-statement/40324531#40324531", "title": "Different type of function and `in do statement`", "body": "<p>To figure out what is going on, you can try de-sugaring you function:</p>\n\n<pre><code>main :: IO ()\nmain = getArgs &gt;&gt;= \\ args -&gt;\n    case args of\n        [] -&gt; putStrLn \"Give an argument!\"\n</code></pre>\n\n<p>Here, <code>getArgs</code> has type <code>IO [String]</code> and the function (let's call it <code>f</code>) has type <code>[String] -&gt; IO ()</code>. Now lets see what's going on with <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n\n-- a unifies with [String] and m with IO\n(getArgs &gt;&gt;=) :: ([String] -&gt; IO b) -&gt; IO b\n(&gt;&gt;=) :: IO [String] -&gt; ([String] -&gt; IO b) -&gt; IO b\n\n-- b unifies with ()\ngetArgs &gt;&gt;= f :: IO ()\n(&gt;&gt;=) :: IO [String] -&gt; ([String] -&gt; IO ()) -&gt; IO ()\n</code></pre>\n\n<p>For your example with <code>C</code>, there are three things wrong:</p>\n\n<ul>\n<li>GHC expects <code>main</code> to have type <code>IO ()</code>, but it has type <code>C ()</code> in your snippet</li>\n<li><code>getArgs</code> is expected to have type <code>C [String]</code>, but it has type <code>IO [String]</code></li>\n<li>same for <code>putStrLn</code>, which must have type <code>C ()</code></li>\n</ul>\n\n<p>To fix this, since <code>ErrorT</code> is a monad transformer, you can <code>lift</code> a monadic action to the level of the transformer with <code>lift</code>.</p>\n\n<p><code>liftIO</code> is a <code>lift</code> operation that can be applied only with monad transforming <code>IO</code>. The interesting thing is that it can work with any monad transformer (with as much monad transformer depth as you want): With <code>liftIO</code>, you can work with <code>T1 (T2 (... (Tn IO)...)) a</code> for any <code>n</code> where <code>Tn</code> are monad transformers.</p>\n\n<p>You can notice their kind of similar signatures:</p>\n\n<pre><code>lift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t m a\nliftIO :: MonadIO m =&gt; IO a -&gt; m a\n</code></pre>\n\n<p>You don't need to specify IO for m, in the signature of <code>liftIO</code>, because it's instance of MonadIO already tells us that it can perform only IO actions.</p>\n\n<p>To conclude, this is how you would use <code>liftIO</code> in your program:</p>\n\n<pre><code>type C = ErrorT String IO\nmain :: IO ()\nmain = runErrorT go &gt;&gt;= print  -- print the result of type `Either String ()`\n    where go :: C ()\n          go = do\n              args &lt;- liftIO getArgs\n              case args of\n                [] -&gt; liftIO $ putStrLn \"Give an argument!\"\n</code></pre>\n\n<p>But, here, since you don't use any features of the <code>ErrorT</code> monad, the code is not really a good example.</p>\n\n<p>Also, note that if you are talking about <code>ErrorT</code> in the <code>mtl</code> package, it is deprecated, consider using <code>ExceptT</code>.</p>\n\n<p>Check out <a href=\"https://stackoverflow.com/questions/3921237/haskell-lift-vs-liftio#3921280\">this post</a> for more information about <code>lift</code> vs <code>liftIO</code></p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1477782522, "creation_date": 1477782522, "answer_id": 40324544, "question_id": 40324482, "link": "https://stackoverflow.com/questions/40324482/different-type-of-function-and-in-do-statement/40324544#40324544", "title": "Different type of function and `in do statement`", "body": "<p>If you desugar the <code>do</code> notation:</p>\n\n<pre><code>main = getArgs &gt;&gt;= (\\ args -&gt; case args of [] -&gt; putStrLn \"Argh!\")\n</code></pre>\n\n<p><code>getArgs</code> has type <code>IO [String]</code>. <code>&gt;&gt;=</code> pipes the resulting <code>[String]</code> into the lambda, which returns <code>IO ()</code>, the result of <code>putStrLn \"...\"</code>. Here, <code>&gt;&gt;=</code> has the inferred type:</p>\n\n<pre><code>(&gt;&gt;=) :: IO [String] -&gt; ([String] -&gt; IO ()) -&gt; IO ()\n</code></pre>\n\n<p>So the type of the whole expression is <code>IO ()</code>, matching the signature of <code>main</code>.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 40324531, "answer_count": 2, "score": 0, "last_activity_date": 1495476706, "creation_date": 1477781885, "last_edit_date": 1477826251, "question_id": 40324482, "link": "https://stackoverflow.com/questions/40324482/different-type-of-function-and-in-do-statement", "title": "Different type of function and `in do statement`", "body": "<pre><code>main :: IO ()\nmain = do\n  args &lt;- getArgs\n  case args of\n    [] -&gt; putStrLn \"Give an argument!\"\n</code></pre>\n\n<p>It works, but why? Returned type is <code>IO ()</code>. <code>getArgs</code> returned <code>IO [String]</code> ( not <code>IO ()</code>). So it should raise an error. </p>\n\n<hr>\n\n<pre><code>type C = ErrorT String IO\nmain :: C ()\nmain = do\n    args &lt;- getArgs\n    case args of\n      [] -&gt; putStrLn \"Give an argument!\"\n</code></pre>\n\n<p><code>putStrLn</code> tries to return <code>IO ()</code>. But it isn't compatible with <code>C</code>. So, should I <code>liftIO</code>? I see that I should. Could you show me how does <code>liftIO</code> works here? Why I have to use <code>liftIO</code> with <code>getArgs</code>? </p>\n"}, {"tags": ["haskell", "clojure", "jvm", "ffi"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1477769833, "post_id": 40322749, "comment_id": 67901489, "body": "Google &quot;haskell inline-java&quot;. it&#39;s very recent work I don&#39;t know anything about"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1477771140, "post_id": 40322749, "comment_id": 67901846, "body": "Potential close voters: if this deserves closure for being a recommendation question, then we might as well close every single non-conceptual question in Stack Overflow, on the grounds that all of them ask us to recommend ways of doing things."}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 3, "creation_date": 1477778829, "post_id": 40322749, "comment_id": 67903784, "body": "I agree this is a very worthwhile question and shouldn&#39;t be closed."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1478508974, "post_id": 40322749, "comment_id": 68167208, "body": "Your best bet is to follow the path Haskell -&gt; C (jni) -&gt; Java -&gt; Clojure -&gt; Java -&gt; C -&gt; Haskell. Is your clojure code compiled (into <code>.class</code> files)?"}, {"owner": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478596636, "post_id": 40322749, "comment_id": 68209945, "body": "@Alec I thought about the same workflow, but I can&#39;t see any C(JNI) code in the Haskell package <a href=\"https://github.com/tweag/inline-java\" rel=\"nofollow noreferrer\">inline-java</a>. I don&#39;t know Haskell, so I was wondering why."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "edited": false, "score": 2, "creation_date": 1478599068, "post_id": 40322749, "comment_id": 68211493, "body": "@Marcs I&#39;ve been playing around with this and I now have a C interface for some of Clojure. I&#39;m hoping to get it interfacing with Haskell next... maybe tomorrow."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "edited": false, "score": 1, "creation_date": 1478721530, "post_id": 40322749, "comment_id": 68271642, "body": "@Marcs slightly misleadingly, there <i>is no C code in <code>inline-java</code></i>. The JNI interop happens in the <a href=\"https://github.com/tweag/inline-java/tree/master/jni\" rel=\"nofollow noreferrer\"><code>jni</code></a> package, and even there it happens in the Haskell source code via the <a href=\"https://hackage.haskell.org/package/inline-c\" rel=\"nofollow noreferrer\"><code>inline-c</code></a> package."}, {"owner": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478722305, "post_id": 40322749, "comment_id": 68272025, "body": "@Alec, Thanks for the clarification. So <code>inline-c</code> is the last <i>bridge</i> between Haskell and JNI. I&#39;m starting to understand now <a href=\"http://book.realworldhaskell.org/read/interfacing-with-c-the-ffi.html\" rel=\"nofollow noreferrer\">what FFI is</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "edited": false, "score": 0, "creation_date": 1478722901, "post_id": 40322749, "comment_id": 68272299, "body": "@Marcs Yep you got it. Also, just a word of warning - I&#39;m not sure how up to date Real World Haskell is with FFI. For example, they tell you to have <code>#include</code> pragmas, which are deprecated for a while and don&#39;t even have an effect anymore. We could do with some good updated FFI documentation..."}], "answers": [{"tags": [], "owner": {"reputation": 1202, "user_id": 1244676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f28485dbe44f7f91a73cf9ee0499d3f4?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisBlom", "link": "https://stackoverflow.com/users/1244676/chrisblom"}, "is_accepted": false, "score": 2, "last_activity_date": 1478287792, "creation_date": 1478287792, "answer_id": 40430458, "question_id": 40322749, "link": "https://stackoverflow.com/questions/40322749/calling-a-clojure-function-from-haskell/40430458#40430458", "title": "Calling a Clojure Function from Haskell", "body": "<p>An easy way would be to launch your Clojure process with a <a href=\"http://clojure.org/reference/repl_and_main#_launching_a_socket_server\" rel=\"nofollow noreferrer\">socket REPL</a> or <a href=\"https://github.com/clojure/tools.nrepl\" rel=\"nofollow noreferrer\">NRepl server</a>.\nThis enables a socket based REPL, so you could then use sockets to call your Clojure function.</p>\n"}, {"comments": [{"owner": {"reputation": 3363, "user_id": 2555321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/071cc8bdde247f6fc8798768afbf5c76?s=128&d=identicon&r=PG", "display_name": "Marcs", "link": "https://stackoverflow.com/users/2555321/marcs"}, "edited": false, "score": 0, "creation_date": 1478641035, "post_id": 40496123, "comment_id": 68237805, "body": "Nice. I think would be good to have this as an example in the Haskell docs."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1478718212, "post_id": 40496123, "comment_id": 68270047, "body": "Excellent answer. And it shows just how cumbersome calling clojure from Haskell can be."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1478718224, "post_id": 40496123, "comment_id": 68270056, "body": "I&#39;ll throw in another +50 bounty if you demonstrate how to use the inline-java method."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1478718680, "post_id": 40496123, "comment_id": 68270277, "body": "@George Sure, but I am going to wait until the official release of GHC 8.0.2 (which is already overdue) since the Hackage page of <code>inline-java</code> says I need at least that. :)"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1482462007, "post_id": 40496123, "comment_id": 69791885, "body": "@Alec: It looks like GHC 8.0.2 was released today. Just letting you know that this offer still stands :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1482551917, "post_id": 40496123, "comment_id": 69823671, "body": "@George Haha, I&#39;ll probably only get around to doing this in early January - I&#39;m currently out of country and with barely functional wifi."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1478658505, "last_edit_date": 1478658505, "creation_date": 1478638074, "answer_id": 40496123, "question_id": 40322749, "link": "https://stackoverflow.com/questions/40322749/calling-a-clojure-function-from-haskell/40496123#40496123", "title": "Calling a Clojure Function from Haskell", "body": "<p>Let me start by advertising <a href=\"https://hackage.haskell.org/package/inline-java\" rel=\"nofollow noreferrer\"><code>inline-java</code></a> which should make it pretty easy to call Clojure by just writing the Java code that calls the <a href=\"http://clojure.github.io/clojure/javadoc/\" rel=\"nofollow noreferrer\">Clojure API</a>. That said, as I am not running the bleeding edge GHC 8.0.2 (and had a variety of other install issues) I haven't been able to use this. When (if) I get <code>inline-java</code> running, I'll update this solution.</p>\n\n<p>My solution below starts by creating a C interface to the Java methods in the Clojure API for Java via the JNI. Then, it calls that C interface using Haskell FFI support. You may need to adjust the library and include file paths depending on where your JDK and JRE are installed. If everything works right, you should see <code>7</code> printed to stdout. This is <code>3</code> plus <code>4</code> calculated by Clojure.</p>\n\n<h3>Setup</h3>\n\n<p>Download the <a href=\"http://repo1.maven.org/maven2/org/clojure/clojure/1.8.0/clojure-1.8.0.zip\" rel=\"nofollow noreferrer\">Clojure 1.8.0</a> jar if you don't already have it. We'll be using the <a href=\"http://clojure.github.io/clojure/javadoc/\" rel=\"nofollow noreferrer\">Java Clojure API</a>. Make sure you've defined <code>LD_LIBRARY_PATH</code>. On the machine I used, that means exporting</p>\n\n<pre><code>export LD_LIBRARY_PATH=\"/usr/lib64/jvm/java/jre/lib/amd64/server/\"\n</code></pre>\n\n<p>Finally, here is a makefile to make compiling a bit easier. You may need to adjust some library and include paths.</p>\n\n<pre><code># makefile\nall:\n    gcc -O -c \\\n        -I /usr/lib64/jvm/java/include/ \\\n        -I /usr/lib64/jvm/java/include/linux/ \\\n        java.c\n    ghc -O2 -Wall \\\n        -L/usr/lib64/jvm/java/jre/lib/amd64/server/ \\\n        -ljvm \\\n        clojure.hs \\\n        java.o\n\nrun:\n    ./clojure\n\nclean:\n    rm -f java.o \n    rm -f clojure clojure.o clojure.hi\n</code></pre>\n\n<h3>C Interface to Clojure functions</h3>\n\n<p>Now, we will make a C interface for the JVM and Clojure functionality we need. For this, we will be using the <a href=\"http://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html\" rel=\"nofollow noreferrer\">JNI</a>. I choose to expose a pretty limited interface:</p>\n\n<ul>\n<li><code>create_vm</code> initializes a new JVM with the Clojure jar on the classpath (make sure you adjust this if you put your Clojure jar somewhere other than in the same folder)</li>\n<li><code>load_methods</code> looks up the Clojure methods we will need. Thankfully the <a href=\"http://clojure.github.io/clojure/javadoc/\" rel=\"nofollow noreferrer\">Java Clojure API</a> is pretty small, so we can wrap almost all of the functions there without to much difficulty. We also need to have functions that convert things like numbers or strings to and from their corresponding Clojure representation. I've only done this for <code>java.lang.Long</code> (which is Clojure's default integral number type).\n\n<ul>\n<li><code>readObj</code> wraps <code>clojure.java.api.Clojure.read</code> (with C strings)</li>\n<li><code>varObj</code> wraps the one arg version of <code>clojure.java.api.Clojure.var</code> (with C strings)</li>\n<li><code>varObjQualified</code> wraps the two arg version of <code>clojure.java.api.Clojure.read</code> (with C strings)</li>\n<li><code>longValue</code> converts a Clojure long to a C long</li>\n<li><code>newLong</code> converts a C long to a Clojure long</li>\n<li><code>invokeFn</code> dispatches to the <code>clojure.lang.IFn.invoke</code> of the right arity. Here, I only bother to expose this up to arity 2, but nothing is stopping you from going further.</li>\n</ul></li>\n</ul>\n\n<p>Here is the code:</p>\n\n<pre><code>// java.c\n#include &lt;stdio.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;jni.h&gt;\n\n// Uninitialized Java natural interface\nJNIEnv *env;\nJavaVM *jvm;\n\n// JClass for Clojure\njclass clojure, ifn, longClass;\njmethodID readM, varM, varQualM, // defined on 'clojure.java.api.Clojure'\n          invoke[2],             // defined on 'closure.lang.IFn'\n          longValueM, longC;     // defined on 'java.lang.Long'\n\n// Initialize the JVM with the Clojure JAR on classpath. \nbool create_vm() {\n  // Configuration options for the JVM\n  JavaVMOption opts = {\n    .optionString =  \"-Djava.class.path=./clojure-1.8.0.jar\",\n  };\n  JavaVMInitArgs args = {\n    .version = JNI_VERSION_1_6,\n    .nOptions = 1,\n    .options = &amp;opts,\n    .ignoreUnrecognized = false,\n  };\n\n  // Make the VM\n  int rv = JNI_CreateJavaVM(&amp;jvm, (void**)&amp;env, &amp;args);\n  if (rv &lt; 0 || !env) {\n    printf(\"Unable to Launch JVM %d\\n\",rv);\n    return false;\n  }\n  return true;\n}\n\n// Lookup the classes and objects we need to interact with Clojure.\nvoid load_methods() {\n\n  clojure    = (*env)-&gt;FindClass(env, \"clojure/java/api/Clojure\");\n  readM      = (*env)-&gt;GetStaticMethodID(env, clojure, \"read\", \"(Ljava/lang/String;)Ljava/lang/Object;\");\n  varM       = (*env)-&gt;GetStaticMethodID(env, clojure, \"var\",  \"(Ljava/lang/Object;)Lclojure/lang/IFn;\");\n  varQualM   = (*env)-&gt;GetStaticMethodID(env, clojure, \"var\",  \"(Ljava/lang/Object;Ljava/lang/Object;)Lclojure/lang/IFn;\");\n\n  ifn        = (*env)-&gt;FindClass(env, \"clojure/lang/IFn\");\n  invoke[0]  = (*env)-&gt;GetMethodID(env, ifn, \"invoke\", \"()Ljava/lang/Object;\");\n  invoke[1]  = (*env)-&gt;GetMethodID(env, ifn, \"invoke\", \"(Ljava/lang/Object;)Ljava/lang/Object;\");\n  invoke[2]  = (*env)-&gt;GetMethodID(env, ifn, \"invoke\", \"(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;\");\n  // Obviously we could keep going here. The Clojure API has 'invoke' for up to 20 arguments...\n\n  longClass  = (*env)-&gt;FindClass(env, \"java/lang/Long\");\n  longValueM = (*env)-&gt;GetMethodID(env, longClass, \"longValue\", \"()J\");\n  longC      = (*env)-&gt;GetMethodID(env, longClass, \"&lt;init&gt;\",    \"(J)V\");\n}\n\n// call the 'invoke' function of the right arity on 'IFn'.\njobject invokeFn(jobject obj, unsigned n, jobject *args) {\n  return (*env)-&gt;CallObjectMethodA(env, obj, invoke[n], (jvalue*)args);\n}\n\n// 'read' static method from 'Clojure' object.\njobject readObj(const char *cStr) {\n  jstring str = (*env)-&gt;NewStringUTF(env, cStr);\n  return (*env)-&gt;CallStaticObjectMethod(env, clojure, readM, str);\n}\n\n// 'var' static method from 'Clojure' object.\njobject varObj(const char* fnCStr) {\n  jstring fn = (*env)-&gt;NewStringUTF(env, fnCStr);\n  return (*env)-&gt;CallStaticObjectMethod(env, clojure, varM, fn);\n}\n// qualified 'var' static method from 'Clojure' object.\njobject varObjQualified(const char* nsCStr, const char* fnCStr) {\n  jstring ns = (*env)-&gt;NewStringUTF(env, nsCStr);\n  jstring fn = (*env)-&gt;NewStringUTF(env, fnCStr);\n  return (*env)-&gt;CallStaticObjectMethod(env, clojure, varQualM, ns, fn);\n}\n</code></pre>\n\n<h3>Haskell Interface to C functions</h3>\n\n<p>Finally, we use Haskell's FFI to plug into the C functions we just made. This compiles to an executable which adds <code>3</code> and <code>4</code> using Clojure's add function. Here, I lost the motivation to make functions for <code>readObj</code> and <code>varObj</code> (mostly because I don't happen to need them for my example).</p>\n\n<pre><code>-- clojure.hs\n{-# LANGUAGE GeneralizedNewtypeDeriving, ForeignFunctionInterface #-}\n\nimport Foreign\nimport Foreign.C.Types\nimport Foreign.C.String\n\n-- Clojure objects are just Java objects, and jsvalue is a union with size 64\n-- bits. Since we are cutting corners, we might as well just derive 'Storable'\n-- from something else that has the same size - 'CLong'.\nnewtype ClojureObject = ClojureObject CLong deriving (Storable)\n\nforeign import ccall \"load_methods\" load_methods :: IO ()\nforeign import ccall \"create_vm\" create_vm :: IO ()\nforeign import ccall \"invokeFn\" invokeFn :: ClojureObject -&gt; CUInt -&gt; Ptr ClojureObject -&gt; IO ClojureObject\n-- foreign import ccall \"readObj\" readObj :: CString -&gt; IO ClojureObject\n-- foreign import ccall \"varObj\" varObj :: CString -&gt; IO ClojureObject\nforeign import ccall \"varObjQualified\" varObjQualified :: CString -&gt; CString -&gt; IO ClojureObject\nforeign import ccall \"newLong\" newLong :: CLong -&gt; ClojureObject\nforeign import ccall \"longValue\" longValue :: ClojureObject -&gt; CLong\n\n-- | In order for anything to work, this needs to be called first.\nloadClojure :: IO ()\nloadClojure = create_vm *&gt; load_methods\n\n-- | Make a Clojure function call\ninvoke :: ClojureObject -&gt; [ClojureObject] -&gt; IO ClojureObject\ninvoke fn args = do\n  args' &lt;- newArray args\n  let n = fromIntegral (length args)\n  invokeFn fn n args'\n\n-- | Make a Clojure number from a Haskell one\nlong :: Int64 -&gt; ClojureObject\nlong l = newLong (CLong l)\n\n-- | Make a Haskell number from a Clojure one\nunLong :: ClojureObject -&gt; Int64\nunLong cl = let CLong l = longValue cl in l\n\n-- | Look up a var in Clojure based on the namespace and name\nvarQual :: String -&gt; String -&gt; IO ClojureObject\nvarQual ns fn = withCString ns (\\nsCStr -&gt;\n                withCString fn (\\fnCStr -&gt; varObjQualified nsCStr fnCStr))\n\nmain :: IO ()\nmain = do\n  loadClojure\n  putStrLn \"Clojure loaded\"\n\n  plus &lt;- varQual \"clojure.core\" \"+\"\n  out &lt;- invoke plus [long 3, long 4]\n  print $ unLong out -- prints \"7\" on my tests\n</code></pre>\n\n<h3>Try it!</h3>\n\n<p>Compiling should be just <code>make all</code> and running <code>make run</code>.</p>\n\n<h3>Limitations</h3>\n\n<p>Since this is only a proof of concept, there are a bunch of things that should be fixed:</p>\n\n<ul>\n<li>proper conversion for all of Clojure's primitive types</li>\n<li>tear down the JVM after you are done!</li>\n<li>make sure we aren't introducing memory leaks anywhere (which we might be doing with <code>newArray</code>)</li>\n<li>represent Clojure objects properly in Haskell</li>\n<li>many more!</li>\n</ul>\n\n<p>That said, it works! </p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 5, "accepted_answer_id": 40496123, "answer_count": 2, "score": 15, "last_activity_date": 1478658505, "creation_date": 1477768708, "last_edit_date": 1478649609, "question_id": 40322749, "link": "https://stackoverflow.com/questions/40322749/calling-a-clojure-function-from-haskell", "title": "Calling a Clojure Function from Haskell", "body": "<p>Is it possible to call a Clojure function from Haskell (on the GHC), using the FFI or some other trick? Here I'm interested in staying within the bounds of GHC (i.e., not using Frege). I'm also interested in keeping the central program in Haskell (meaning that the Clojure function should be called from Haskell, and not vice versa).</p>\n\n<p>How to do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477767616, "post_id": 40322492, "comment_id": 67900851, "body": "You probably should rewrite the title into something that reflects the question better. (For instance, you are not actually defining any higher order function here.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1477767748, "post_id": 40322492, "comment_id": 67900890, "body": "You can do this with a one-line list comprehension: <code>[(fst x, snd y) | x &lt;- a, y &lt;- b, snd x == fst y]</code>, with <code>let a = [(&quot;a&quot;, &quot;b&quot;), (&quot;e&quot;, &quot;b&quot;)]</code> and <code>let b = [(&quot;b&quot;, &quot;c&quot;), (&quot;b&quot;, &quot;d&quot;)]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1477770102, "creation_date": 1477770102, "answer_id": 40322979, "question_id": 40322492, "link": "https://stackoverflow.com/questions/40322492/haskell-functions-response-list-more-values-than-input-parameter-list-size/40322979#40322979", "title": "Haskell functions response list more values than input parameter list size", "body": "<p>Your code looks unnecessarily complicated. Can't you just do this?</p>\n\n<pre><code>cc :: [(String,String)] -&gt; [(String,String)] -&gt; [(String,String)]\ncc as bs = [(x, z) | (x, y1) &lt;- as, (y2, z) &lt;- bs, y1 == y2]\n</code></pre>\n\n<p>As for the type error in <code>(getValue (x1,y1) ys) : cc xs ysa</code>, that could be fixed by using <code>++</code> (concatenate lists) instead of <code>:</code>.</p>\n"}], "owner": {"reputation": 354, "user_id": 3961243, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f7c5aad34d8d18af032b3de9b0d9b314?s=128&d=identicon&r=PG&f=1", "display_name": "arvist", "link": "https://stackoverflow.com/users/3961243/arvist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 40322979, "answer_count": 1, "score": 0, "last_activity_date": 1477770102, "creation_date": 1477766992, "last_edit_date": 1477767853, "question_id": 40322492, "link": "https://stackoverflow.com/questions/40322492/haskell-functions-response-list-more-values-than-input-parameter-list-size", "title": "Haskell functions response list more values than input parameter list size", "body": "<p>The main idea is that I've two input lists that consists of tuples, list A(x,y) and list B(y,z) in output I need to compile list C that consists of elements (x,z) if y from A == y from B</p>\n\n<p>In function cc there is recursive loop through all input tuples in list. Function getValue finds all tuples that correspond to (x,y) from A. The problem is that in getValue there's possibility to find more than one tuple. The question is how to add all those tuples from getValue to cc result list. Currently I have an error </p>\n\n<pre><code>Couldn't match type \u2018(String, String)\u2019 with \u2018[(String, String)]\u2019\n</code></pre>\n\n<p>For example for [(a, b), (e, b)] [(b,c), (b,d)] should give result [(a,c), (a,d), (e, c), (e,d)] </p>\n\n<pre><code>isInDictionary :: String -&gt; [(String,String)] -&gt; Bool\nisInDictionary x [] = False\nisInDictionary x((x1,y1):ys) = any (==x) (map fst ys) ||  x == x1\n\ngetValue :: (String,String) -&gt; [(String,String)] -&gt; [(String,String)]\ngetValue  (x,y)[] = []\ngetValue (x,y)((x1,y1):ys) = \n    if (y == x1) \n    then (x,y1) : getValue (x,y) ys\n    else getValue (x,y) ys\n\n\ncc :: [(String,String)] -&gt; [(String,String)] -&gt; [(String,String)]\n\ncc [] ((x2,y2):ys) = []\ncc ((x1,y1):xs) [] = []\ncc [] [] = []\ncc ((x1,y1):xs)((x2,y2):ys) = \n    if( isInDictionary y1 ys ) \n        then (getValue (x1,y1) ys) : cc xs ysa --fix head\n    else if (y1 == x2)\n        then ( (x1,y2) : cc xs ysa)\n    else (cc xs ysa)\n    where ysa = (ys ++ [(x2,y2)])\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": true, "score": 7, "last_activity_date": 1477767945, "last_edit_date": 1477767945, "creation_date": 1477760591, "answer_id": 40321495, "question_id": 40321358, "link": "https://stackoverflow.com/questions/40321358/haskell-code-zipwith-using-maybe/40321495#40321495", "title": "Haskell code zipWith using Maybe", "body": "<p>You are specifying an <code>Integral</code> constraint on your function, but using <code>(/)</code> inside the function which signifies fractional division.</p>\n\n<p>You probably want to use <code>div</code>, which is integral division, e.g. <code>3 `div` 2 == 1</code>. Otherwise, change the constraint from <code>Integral</code> to <code>Fractional</code> (which is what the error message is telling you to do).</p>\n"}], "owner": {"reputation": 173, "user_id": 6900669, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ac12dce0c1fe17b172f3859ee0d3d8c0?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Bujdo\u0161", "link": "https://stackoverflow.com/users/6900669/tibor-bujdo%c5%a1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 40321495, "answer_count": 1, "score": 3, "last_activity_date": 1477767945, "creation_date": 1477759580, "last_edit_date": 1477765200, "question_id": 40321358, "link": "https://stackoverflow.com/questions/40321358/haskell-code-zipwith-using-maybe", "title": "Haskell code zipWith using Maybe", "body": "<p>I'm having trouble with this code. I'm trying to write a simple function that takes two lists and tries to divide each element of list A by the corresponding element of list B. If the element in list B is 0, it should return <code>Nothing</code>, otherwise it should return <code>Just (a / b)</code>.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>divlist :: Integral a =&gt; [a] -&gt; [a] -&gt; [Maybe a]\ndivlist = zipWith (\\x y -&gt; if (y /= 0) then Just (x / y) else Nothing) \n</code></pre>\n\n<p>It's probably something stupid, but I simply can't find it.</p>\n\n<p>EDIT: This is what ghci is reporting:</p>\n\n<pre><code>C:\\Users\\spravce\\Desktop\\Haskell\\6.hs:16:51: error:\n    \u2022 Could not deduce (Fractional a) arising from a use of \u2018/\u2019\n    from the context: Integral a\n        bound by the type signature for:\n                divlist :: Integral a =&gt; [a] -&gt; [a] -&gt; [Maybe a]\n        at C:\\Users\\spravce\\Desktop\\Haskell\\6.hs:14:1-48\n    Possible fix:\n        add (Fractional a) to the context of\n        the type signature for:\n            divlist :: Integral a =&gt; [a] -&gt; [a] -&gt; [Maybe a]\n    \u2022 In the first argument of \u2018Just\u2019, namely \u2018(x / y)\u2019\n    In the expression: Just (x / y)\n    In the expression: if (y /= 0) then Just (x / y) else Nothing\nFailed, modules loaded: none.\n</code></pre>\n\n<p>EDIT 2:\nUsing <code>div x y</code> instead of <code>x / y</code> just did it. :) Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 0, "creation_date": 1477759789, "post_id": 40321309, "comment_id": 67898421, "body": "What is the ordering that you would like on the elements?"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 0, "creation_date": 1477759861, "post_id": 40321309, "comment_id": 67898442, "body": "Oh sorry, I&#39;ve updated the question with the sorting requirement."}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 1, "creation_date": 1477760398, "post_id": 40321444, "comment_id": 67898607, "body": "dkasak your great answers and explanation are very appreciated. Thank you for making Haskell more approachable!"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": true, "score": 2, "last_activity_date": 1477760261, "creation_date": 1477760261, "answer_id": 40321444, "question_id": 40321309, "link": "https://stackoverflow.com/questions/40321309/sort-list-of-different-types/40321444#40321444", "title": "Sort list of different types", "body": "<p>A wrapper type is definitely a good way to do this. Since you simply want to sort your wrapped values based on a constituent <code>Int</code> value, you can use <code>Data.List.sortOn</code>.</p>\n\n<p>Define a function which extracts the delta value:</p>\n\n<pre><code>delta :: Wrapper -&gt; Int\ndelta (WFoo f) = fooDelta f\ndelta (WBar b) = barDelta b\n</code></pre>\n\n<p>Then use <code>sortOn</code> like this:</p>\n\n<pre><code>main :: IO ()\nmain = print $ sortOn delta sortTest\n</code></pre>\n\n<p>This gives the following output for your example:</p>\n\n<pre><code>[WFoo (Foo {fooLabel = \"label1\", fooDelta = 0}),WBar (Bar {barLabel = \"label1\", barDelta = 1, barAnother = \"another1\"}),WFoo (Foo {fooLabel = \"label2\", fooDelta = 2})]\n</code></pre>\n\n<p>Another way to do this is to define an <code>Ord</code> instance for your wrapper type. Then you can simply use <code>sort</code> on your <code>[Wrapper]</code> list.</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 40321444, "answer_count": 1, "score": 1, "last_activity_date": 1477760261, "creation_date": 1477759244, "last_edit_date": 1477759839, "question_id": 40321309, "link": "https://stackoverflow.com/questions/40321309/sort-list-of-different-types", "title": "Sort list of different types", "body": "<p>I'd like to sort a list of two different types. To do so I first create a <code>Wrapper</code>type, so I can <code>mappend</code> both types.</p>\n\n<ol>\n<li>Is having a <code>Wrapper</code> type the right way here?</li>\n<li>I'm not clear on how do I do the actual sorting if I'd like to sort by the delta key (i.e. <code>fooDelta</code> and <code>barDelta</code>)</li>\n</ol>\n\n<p>The code:</p>\n\n<pre><code>import           Data.List   (sortBy)\nimport           Data.Monoid\nimport           Data.Ord    (comparing)\n\ndata Foo = Foo\n    { fooLabel :: String\n    , fooDelta :: Int\n    } deriving (Show, Eq)\n\ndata Bar = Bar\n    { barLabel   :: String\n    , barDelta   :: Int\n    , barAnother :: String\n    } deriving (Show, Eq)\n\ndata Wrapper = WFoo Foo | WBar Bar\n    deriving (Show, Eq)\n\nsortTest :: [Wrapper]\nsortTest =\n    listFoo &lt;&gt; listBar\n    where\n        listFoo = [WFoo $ Foo \"label1\" 0, WFoo $ Foo \"label2\" 2]\n        listBar = [WBar $ Bar \"label1\" 1 \"another1\"]\n</code></pre>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 0, "creation_date": 1477759886, "post_id": 40321170, "comment_id": 67898450, "body": "You have a typo in your code. The <code>=</code> in <code>rand 0 100 = 50</code> should be <code>==</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1477765072, "post_id": 40321170, "comment_id": 67900046, "body": "Are you ever stepping the rng?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1477772378, "post_id": 40321170, "comment_id": 67902167, "body": "A random Float between 0 and 100 will almost never be exactly 50. If you want (say) a 1% chance, you might check for <code>r &lt;= 1</code> instead. Also, you throw away the new generator so your rand function will always return the same value."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1477772941, "post_id": 40321170, "comment_id": 67902326, "body": "To give you some idea, your enemies currently have about a one in a billion chance of spawning."}], "answers": [{"tags": [], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "is_accepted": true, "score": 0, "last_activity_date": 1477762757, "creation_date": 1477762757, "answer_id": 40321824, "question_id": 40321170, "link": "https://stackoverflow.com/questions/40321170/haskell-random-number-generator/40321824#40321824", "title": "Haskell Random Number Generator", "body": "<p>The chance of getting a random Float to equal 50 is pretty low because Floats are not necessarily whole numbers. Try converting your random number to an Integral first using <code>floor</code>.</p>\n"}], "owner": {"reputation": 5, "user_id": 6566522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86dbd76fab0a89044d73c2dc2e0cd9e4?s=128&d=identicon&r=PG&f=1", "display_name": "DirkKirk", "link": "https://stackoverflow.com/users/6566522/dirkkirk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 40321824, "answer_count": 1, "score": 0, "last_activity_date": 1477762757, "creation_date": 1477758344, "last_edit_date": 1477762299, "question_id": 40321170, "link": "https://stackoverflow.com/questions/40321170/haskell-random-number-generator", "title": "Haskell Random Number Generator", "body": "<p>I want to spawn an enemy at a random time in my game.\nTo do this I wanted to check each frame if a random value [0..100] == 50</p>\n\n<pre><code>spawnEnemy :: World -&gt; World\nspawnEnemy (world@World { rndGen = r, enemies = e }) = world { enemies = if rand 0 100 == 50 then Enemy (rand (-200) 200, rand (-200) 200) 0 0 : e else e }\n    where\n        rand :: Float -&gt; Float -&gt; Float\n        rand l h = fst $ randomR (l, h) r\n</code></pre>\n\n<p>(here rndGen :: stdGen and enemies :: [Enemy])</p>\n\n<p>But rand never seems to return 50.\nWhat am I doing wrong here?</p>\n"}, {"tags": ["haskell", "functional-programming", "parse-error"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1477774838, "post_id": 40320416, "comment_id": 67902811, "body": "Once you fix your error with <code>myFunction</code>, you will run into an error in <code>interactWith</code> because you can&#39;t end a do block with a bind. I&#39;d suggest trying to compile your code more frequently."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1477774930, "post_id": 40320416, "comment_id": 67902838, "body": "@ReinHenrichs I just noticed that as well and included the presumed fix in my answer."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7053036, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/db2fcf4f318f925e784fbf8e2fdafae5?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Toto", "link": "https://stackoverflow.com/users/7053036/ali-toto"}, "edited": false, "score": 0, "creation_date": 1477753790, "post_id": 40320433, "comment_id": 67896712, "body": "Check my updated code, did what you said, still getting parse error."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 63, "user_id": 7053036, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/db2fcf4f318f925e784fbf8e2fdafae5?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Toto", "link": "https://stackoverflow.com/users/7053036/ali-toto"}, "edited": false, "score": 1, "creation_date": 1477763869, "post_id": 40320433, "comment_id": 67899680, "body": "@AliToto Now it&#39;s aligned with <code>args</code> instead. You may want to use more than one space for indentation."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477764961, "post_id": 40320433, "comment_id": 67900012, "body": "<code>myFunction</code> is not part of the <code>do</code> block, which is what you are saying by lining it up with <code>args</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1477774894, "last_edit_date": 1477774894, "creation_date": 1477753469, "answer_id": 40320433, "question_id": 40320416, "link": "https://stackoverflow.com/questions/40320416/why-am-i-getting-parse-error-on-myfunction/40320433#40320433", "title": "Why am I getting parse error on myFunction", "body": "<p><code>myFunction = id</code> needs to line up with the other thing defined in the <code>where</code> clause.</p>\n\n<pre><code>main = mainWith myFunction  \n where mainWith function = do         \n     ^  args &lt;- getArgs          \n     |  case args of            \n     |      [input,output] -&gt; interactWith function input output         \n     |      _ -&gt; putStrLn \"error: exactly two arguments needed\"\n     | -- replace \"id\" with the name of our function below       \n     | myFunction = id \n     | ^\n     | |\n     | here\n     |\n     not here\n</code></pre>\n\n<p>The same code with more indentation to make it clear:</p>\n\n<pre><code>import System.Environment (getArgs)\ninteractWith function inputFile outputFile = do  \n    input &lt;- readFile inputFile \n    -- I assume a line break belongs here \n    writeFile outputFile (function input)\nmain = mainWith myFunction  \n    where mainWith function = do         \n              args &lt;- getArgs          \n              case args of            \n                  [input,output] -&gt; interactWith function input output         \n                  _ -&gt; putStrLn \"error: exactly two arguments needed\"\n          -- replace \"id\" with the name of our function below       \n          myFunction = id \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "is_accepted": false, "score": 0, "last_activity_date": 1477755430, "creation_date": 1477755430, "answer_id": 40320749, "question_id": 40320416, "link": "https://stackoverflow.com/questions/40320416/why-am-i-getting-parse-error-on-myfunction/40320749#40320749", "title": "Why am I getting parse error on myFunction", "body": "<p>In haskell it is bad practice to do this:</p>\n\n<pre><code>where a = x\n  b = y\n</code></pre>\n\n<p>This can lead to errors because it isn't lined up the same, so please make a CRNL after the where:</p>\n\n<pre><code>where\n  a = x\n  b = y\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7053036, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/db2fcf4f318f925e784fbf8e2fdafae5?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Toto", "link": "https://stackoverflow.com/users/7053036/ali-toto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 40320433, "answer_count": 2, "score": -3, "last_activity_date": 1477774894, "creation_date": 1477753357, "last_edit_date": 1477753766, "question_id": 40320416, "link": "https://stackoverflow.com/questions/40320416/why-am-i-getting-parse-error-on-myfunction", "title": "Why am I getting parse error on myFunction", "body": "<p>In the following code, I'm getting parse error on input `myFunction':</p>\n\n<pre><code>import System.Environment (getArgs)\ninteractWith function inputFile outputFile = do  \n    input &lt;- readFile inputFile writeFile outputFile (function input)\nmain = mainWith myFunction  \n where mainWith function = do         \n        args &lt;- getArgs          \n        case args of            \n            [input,output] -&gt; interactWith function input output         \n            _ -&gt; putStrLn \"error: exactly two arguments needed\"\n        -- replace \"id\" with the name of our function below       \n        myFunction = id \n</code></pre>\n"}, {"tags": ["haskell", "io", "conduit"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477753087, "post_id": 40319710, "comment_id": 67896487, "body": "What&#39;s the purpose of <code>mapC (`snoc` 10)</code>?"}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477755811, "post_id": 40319710, "comment_id": 67897302, "body": "@chepner 10 is Word8 value for <code>&#39;\\n&#39;</code>, so it appends newline character back to each line."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1477761443, "post_id": 40319710, "comment_id": 67898920, "body": "This has a bug, for starters. Suppose I break the source up into one-byte bytestrings <code>stdinC&#39; = (stdinC :: Source (ResourceT IO) B.ByteString)  .| concatC .| mapC B.singleton</code>  This doesn&#39;t affect the semantics of <code>stdinC</code> but it breaks this function, but not the conduit lines function."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477761553, "post_id": 40319710, "comment_id": 67898958, "body": "When it is corrected, it will emerge that in gluing the one-byte bytestrings together into lines, your <code>chunks</code> function allocates as many intermediate bytestrings as there are bytes in the line. It is rational where you expect one or two chunks per line. This is fairly typical of course."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477762185, "post_id": 40319710, "comment_id": 67899155, "body": "It occurs to me the old conduit <code>lines</code> had this property; see this patch <a href=\"https://github.com/snoyberg/conduit/pull/209\" rel=\"nofollow noreferrer\">github.com/snoyberg/conduit/pull/209</a> It might be that the old version was faster for inputs like yours, where we have a ton of one-chunk short lines."}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477767354, "post_id": 40319710, "comment_id": 67900759, "body": "@Michael it seems like the old <code>CB.lines</code> performs better for me (speeds the run by ~5%), but most of time is spent in conduit pipeline anyway (fuse, <code>&gt;&gt;=</code>)."}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477767549, "post_id": 40319710, "comment_id": 67900825, "body": "@Michael I guess you mean the bug is in my <code>lineChunksC</code>? It&#39;s quite likely, I just wrote for the <code>chunks</code> solution and never tested on anything else."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477767597, "post_id": 40319710, "comment_id": 67900843, "body": "Yes, if it is given the bytes in tiny chunks it exits after two lines."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477767695, "post_id": 40319710, "comment_id": 67900880, "body": "The regular conduit function speeds up if you assimilate the maps writing  <code>mapC ((&quot;000&quot; ++). (`snoc` 10))</code>  instead of  <code>mapC (&quot;000&quot; ++) .| mapC (`snoc` 10)</code>. This is done implicitly by the other."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477767822, "post_id": 40319710, "comment_id": 67900909, "body": "There is a crude rule of course that more uses of  <code>.|</code> makes for a more complex program - unless they fuse away. Your <code>chunks</code> uses three, but your <code>lines</code> uses four. This has nothing to do with the lines function."}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477832567, "post_id": 40319710, "comment_id": 67913684, "body": "@Michael see my edit. Joining two <code>mapC</code> improves performance, but not drastically, so there is still serious performance loss with per-line conduit processing."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477896865, "post_id": 40319710, "comment_id": 67930055, "body": "Until you correct the implementation of <code>lineChunksC</code> it will be impossible to bench this. Try it with, e.g. <code>yield (&quot;\\nr\\n\\n&quot;::B.ByteString) =$= concatC =$= mapC B.singleton</code> instead of <code>stdinC</code>. This is essential to benchmarking."}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477911178, "post_id": 40319710, "comment_id": 67935633, "body": "@Michael I updated the answer with fixed version. It didn&#39;t change the timing at all (no surprise, as with normal stdin it&#39;s called only once every N kilobytes)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1477932501, "post_id": 40319710, "comment_id": 67947921, "body": "Right,  it is fast for some nice cases, since it uses <code>ByteString.lines</code> where possible - but as expected, if I feed it a file that is 10 million &#39;t&#39;s with no linebreaks, it is much slower <a href=\"http://sprunge.us/APeK\" rel=\"nofollow noreferrer\">sprunge.us/APeK</a> If I give the file in single byte chunks char by char, it doesn&#39;t complete after 5 minutes, since it is allocating 10M separate bytestrings, while the other is done in 5 sec. It is I think quadratic in the number of chunks per line. Here&#39;s my source <a href=\"http://sprunge.us/gVQG\" rel=\"nofollow noreferrer\">sprunge.us/gVQG</a>"}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1477941237, "post_id": 40319710, "comment_id": 67952455, "body": "@Michael thanks, it&#39;s a good example. Building strict bytestring from many pieces is gonna be slow."}], "answers": [{"comments": [{"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "edited": false, "score": 0, "creation_date": 1477765896, "post_id": 40320988, "comment_id": 67900296, "body": "Thanks for the answer, I should defnitely check <code>streaming</code>. But after adding your code into benchmark, results are on par with my &quot;lines&quot; solution (+/- 5%), so no immediate improvements in my case."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1477762769, "last_edit_date": 1477762769, "creation_date": 1477757125, "answer_id": 40320988, "question_id": 40319710, "link": "https://stackoverflow.com/questions/40319710/ways-to-improve-performance-for-line-based-conduits/40320988#40320988", "title": "Ways to improve performance for line-based conduits", "body": "<p>My guess is that, for \"lines\", the <code>mapC (\"000\" ++) .| mapC (`snoc` 10)</code> part is doing a lot of work.</p>\n\n<p>Concatenating several strict <code>ByteStrings</code> into another strict <code>ByteString</code> is expensive. Concatenating them into a lazy <code>ByteString</code> tends to be more efficient.</p>\n\n<p>To avoid this cost, you can yield each part individually downstream as a strict <code>ByteString</code> (but be aware that then we aren't talking about \"lines\" anymore). </p>\n\n<p>Alternatively, yield each transformed line as a lazy <code>ByteString</code> downstream.</p>\n\n<hr>\n\n<blockquote>\n  <p>The question is, did I miss a simple and elegant solution which would\n  allow me to write efficient code in same fashion as with lines\n  approach?</p>\n</blockquote>\n\n<p>Some streaming libraries have an interesting feature: you can delimit lines in the stream, and manipulate them, without the need to materialize entire lines in memory at any point.</p>\n\n<p>Here I'm using the <a href=\"http://hackage.haskell.org/package/streaming\" rel=\"nofollow\"><em>streaming</em></a> and <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.4.4\" rel=\"nofollow\"><em>streaming-bytestring</em></a> packages, because I'm more familiar with them.</p>\n\n<p>In module <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.4.4/docs/Data-ByteString-Streaming-Char8.html\" rel=\"nofollow\"><code>Data.ByteString.Streaming.Char8</code></a> of <em>streaming-bytestring</em>, we have the <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.4.4/docs/Data-ByteString-Streaming-Char8.html#v:lines\" rel=\"nofollow\"><code>lines</code></a> function:</p>\n\n<pre><code>lines :: Monad m =&gt; ByteString m r -&gt; Stream (ByteString m) m r\n</code></pre>\n\n<blockquote>\n  <p>lines turns a ByteString into a connected stream of ByteStrings at\n  divide at newline characters. The resulting strings do not contain\n  newlines. This is the genuinely streaming lines which only breaks\n  chunks, and thus never increases the use of memory.</p>\n</blockquote>\n\n<p>The gist of it is that <code>ByteString m r</code> is <em>already</em> a streaming type! So this version of <code>lines</code> transforms a stream into a \"stream of streams\". And we can only reach the \"next stream\" (next line) by exhausting the \"current stream\" (current line).</p>\n\n<p>Your \"lines\" example could be written as:</p>\n\n<pre><code>{-# language OverloadedStrings #-}\nmodule Main where\n\nimport Control.Applicative ((*&gt;))\nimport Streaming\nimport qualified Streaming.Prelude as S\nimport qualified Data.ByteString.Streaming.Char8 as Q\n\nmain :: IO ()\nmain = Q.stdout\n     . Q.unlines\n     . S.maps (\\line -&gt; \"000\" *&gt; line)\n     . Q.lines\n     $ Q.stdin\n</code></pre>\n"}], "owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1477910996, "creation_date": 1477748787, "last_edit_date": 1477910996, "question_id": 40319710, "link": "https://stackoverflow.com/questions/40319710/ways-to-improve-performance-for-line-based-conduits", "title": "Ways to improve performance for line-based conduits", "body": "<p>I use haskell for line-based data processing, i.e. tasks where you can apply <code>sed</code>, <code>awk</code> and similar tools. As a trivial example, let's prepend <code>000</code> to every line from standard input.</p>\n\n<p>I have three alternative ways to do the task:</p>\n\n<ol>\n<li>Lazy IO with lazy <code>ByteString</code>s</li>\n<li>Line-based conduit.</li>\n<li>Chunk-based conduit with pure strict <code>ByteString</code> processing inside.</li>\n</ol>\n\n<p><code>example.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport ClassyPrelude.Conduit\nimport qualified Data.ByteString.Char8 as B8\nimport qualified Data.ByteString.Lazy.Char8 as BL8\nimport qualified Data.Conduit.Binary as CB\n\nmain = do\n  [arg] &lt;- getArgs\n  case arg of\n\n    \"lazy\" -&gt; BL8.getContents &gt;&gt;= BL8.putStr . BL8.unlines . map (\"000\" ++) . BL8.lines\n\n    \"lines\" -&gt; runConduitRes $ stdinC .| CB.lines .|\n      mapC (\"000\" ++) .| mapC (`snoc` 10) .| stdoutC\n\n    \"chunks\" -&gt; runConduitRes $ stdinC .| lineChunksC .|\n      mapC (B8.unlines . (map (\"000\" ++)) . B8.lines) .| stdoutC\n\n\nlineChunksC :: Monad m =&gt; Conduit ByteString m ByteString\nlineChunksC = await &gt;&gt;= maybe (return ()) go\n  where\n  go acc = if\n    | Just (_, 10) &lt;- unsnoc acc -&gt; yield acc &gt;&gt; lineChunksC\n    | otherwise -&gt; await &gt;&gt;= maybe (yield acc) (go' . breakAfterEOL)\n    where\n    go' (this, next) = let acc' = acc ++ this in if null next then go acc' else yield acc' &gt;&gt; go next\n\nbreakAfterEOL :: ByteString -&gt; (ByteString, ByteString)\nbreakAfterEOL = uncurry (\\x -&gt; maybe (x, \"\") (first (snoc x)) . uncons) . break (== 10)\n</code></pre>\n\n<pre>\n$ stack ghc --package={classy-prelude-conduit,conduit-extra} -- -O2 example.hs -o example\n$ for cmd in lazy lines chunks; do echo $cmd; time -p seq 10000000 | ./example $cmd > /dev/null; echo; done\nlazy\nreal 2.99\nuser 3.06\nsys 0.07\n\nlines\nreal 3.30\nuser 3.36\nsys 0.06\n\nchunks\nreal 1.83\nuser 1.95\nsys 0.06\n</pre>\n\n<p>(The results are consistent across multiple runs, and also hold for lines with several numbers).</p>\n\n<p>So <code>chunks</code> is 1.6x faster than <code>lines</code> which is a bit faster than <code>lazy</code>. This means that conduits can be faster than plain bytestrings, but the overhead of conduit pipes is too heavy when you split chunks into short lines.</p>\n\n<p>What I don't like about <code>chunks</code> approach is that it mixes both conduit and pure worlds, and it makes it harder to use it for more complex tasks.</p>\n\n<p>The question is, did I miss a simple and elegant solution which would allow me to write efficient code in same fashion as with <code>lines</code> approach?</p>\n\n<p>EDIT1: Per @Michael's suggestion I joined two <code>mapC</code> into one <code>mapC ((\"000\" ++). (</code>snoc<code>10))</code> in <code>lines</code> solution, to make number of pipes (<code>.|</code>) same between <code>lines</code> and <code>chunks</code>. This made it perform a bit better (down from 3.3s to 2.8s), but still significantly slower than <code>chunks</code>.</p>\n\n<p>Also I tried older <code>Conduit.Binary.lines</code> which Michael suggested in comments, and it also improves performance a bit, by ~0.1s.</p>\n\n<p>EDIT2: Fixed <code>lineChunksC</code> so it works with very small chunks, e.g.</p>\n\n<pre><code>&gt; runConduitPure $ yield (\"\\nr\\n\\n\"::ByteString) .| concatC .| mapC singleton .| lineChunksC .| sinkList \n[\"\\n\",\"r\\n\",\"\\n\"]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1477739307, "post_id": 40318414, "comment_id": 67893084, "body": "You seem to have a pretty good lay of the land in your listed options.  The only thing that comes to mind is <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow noreferrer\"><code>reflection</code></a> which you may be able to get to work for you with some cleverness."}, {"owner": {"reputation": 133, "user_id": 7088594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8329b56ae0b5b32de35ba11cfad5a275?s=128&d=identicon&r=PG&f=1", "display_name": "T. Hunter", "link": "https://stackoverflow.com/users/7088594/t-hunter"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1477740571, "post_id": 40318414, "comment_id": 67893381, "body": "Yes, I was looking at the <code>reflection</code> package. My issue is that the signature of <code>reify</code> is essentially closed over the type being created, i.e. it does not escape. I am not familiar enough with the Haskell type system to understand if you can create a type out of a value (which sounds like a heresy in Haskell, and only allowed through a special compiler construct in Scala)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1477741028, "post_id": 40318414, "comment_id": 67893483, "body": "Nothing like Scala&#39;s path-dependent types are available in Haskell.  The &quot;non-<code>fast</code>&quot; reflection variant contains a mechanism by which you can a type representation of a value, but it&#39;s messy and your error messages would be horrid.  The only way to create a type with &quot;intensional identity&quot; (i.e. not equal to any other type) is through a scoped quantifier like <code>reify</code> or <code>runST</code>.  I would begin looking for mixed approaches, e.g. go with your option #2 but create a simplified phantom type that does not capture everything, combined with selective manual labeling or something."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1477741950, "post_id": 40318414, "comment_id": 67893686, "body": "Of course if you use template haskell your options widen.  E.g. you could generate a fresh top-level type for each table declaration and then use that to tag the columns.  I think you could get a minimal approximation of path-dependent types that way, actually."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1477813374, "post_id": 40318414, "comment_id": 67909049, "body": "<code>add a phantom type on the Table type itself, and pass this extra type to the columns</code> Why do the tables need to have a phantom type? Perhaps it would be enough if the columns where tagged with the phantom type of its origin table."}, {"owner": {"reputation": 133, "user_id": 7088594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8329b56ae0b5b32de35ba11cfad5a275?s=128&d=identicon&r=PG&f=1", "display_name": "T. Hunter", "link": "https://stackoverflow.com/users/7088594/t-hunter"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1478251519, "post_id": 40318414, "comment_id": 68087013, "body": "@danidiaz yes this is what I ended up doing, although it requires the introduction of a separate type. You can see what I eventually came up with in the edited answer."}, {"owner": {"reputation": 133, "user_id": 7088594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8329b56ae0b5b32de35ba11cfad5a275?s=128&d=identicon&r=PG&f=1", "display_name": "T. Hunter", "link": "https://stackoverflow.com/users/7088594/t-hunter"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1478251612, "post_id": 40318414, "comment_id": 68087071, "body": "@luqui thanks for your comments, I ended doing something as you suggested. I agree that template haskell would be nice, but it seems to have to many other downsides (compilation times, weird corner cases, lack of understandability) in this case."}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 1, "last_activity_date": 1477743767, "creation_date": 1477743767, "answer_id": 40319050, "question_id": 40318414, "link": "https://stackoverflow.com/questions/40318414/path-dependent-types-in-haskell/40319050#40319050", "title": "Path dependent types in Haskell", "body": "<p>Haskell does not (as far as I know) have path dependent types, but you can get some of the way by using rank 2 types. For instance the ST monad has a dummy type parameter <code>s</code> that is used to prevent leakage between invocations of runST:</p>\n\n<pre><code>runST :: (forall s . ST s a) -&gt; a\n</code></pre>\n\n<p>Within an ST action you can have an STRef:</p>\n\n<pre><code>newSTRef :: a -&gt; ST s (STRef s a) \n</code></pre>\n\n<p>But the STRef you get carries the <code>s</code> type parameter, so it isn't allowed to escape from the <code>runST</code>.</p>\n"}], "owner": {"reputation": 133, "user_id": 7088594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8329b56ae0b5b32de35ba11cfad5a275?s=128&d=identicon&r=PG&f=1", "display_name": "T. Hunter", "link": "https://stackoverflow.com/users/7088594/t-hunter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 2, "accepted_answer_id": 40319050, "answer_count": 1, "score": 13, "last_activity_date": 1478251315, "creation_date": 1477738877, "last_edit_date": 1495542283, "question_id": 40318414, "link": "https://stackoverflow.com/questions/40318414/path-dependent-types-in-haskell", "title": "Path dependent types in Haskell", "body": "<p>I am trying to design an API for some database system in Haskell, and I would like to model the columns of this database in a way such that interactions between columns of different tables cannot get mixed up.</p>\n\n<p>More precisely, imagine that you have a type to represent a table in a database, associated to some type:</p>\n\n<pre><code>type Table a = ...\n</code></pre>\n\n<p>and that you can extract the columns of the table, along with the type of the column:</p>\n\n<pre><code>type Column col = ...\n</code></pre>\n\n<p>Finally, there are various extractors. For example, if your table contains descriptions of frogs, a function would let you extract the column containing the weight of the frog:</p>\n\n<pre><code>extractCol :: Table Frog -&gt; Column Weight\n</code></pre>\n\n<p>Here is the question: I would like to distinguish the origin of the columns so that users cannot do operations between tables. For example:</p>\n\n<pre><code>bullfrogTable = undefined :: Table Frog\ntoadTable = undefined :: Table Frog\nbullfrogWeights = extractCol bullfrogTable\ntoadWeights = extractCol toadTable\n-- Or some other columns from the toad table\ntoadWeights' = extractCol toadTable\n-- This should compile\naddWeights toadWeights' toadWeights\n-- This should trigger a type error\naddWeights bullfrogWeights toadWeights\n</code></pre>\n\n<p>I know how to achieve this in Scala (using path-dependent types, see [1]), and I have been thinking of 3 options in Haskell:</p>\n\n<ul>\n<li><p>not using types, and just doing a check at runtime (the current solution)</p></li>\n<li><p>the TypeInType extension to add a phantom type on the Table type itself, and pass this extra type to the columns. I am not keen on it, because the construction of such a type would be very complicated (tables are generated through complex DAG operations) and probably slow to compile in this context.</p></li>\n<li><p>wrapping the operations using a <code>forall</code> construct similar to the ST monad, but in my case, I would like the extra tagging type to actually escape the construction.</p></li>\n</ul>\n\n<p>I am happy to have a very limited valid scoping for the construction of the same columns (i.e. columns from <code>table</code> and <code>(id table)</code> not being mixable), and I mostly care about the DSL feel of the API rather than the safety.</p>\n\n<p>[1] <a href=\"https://stackoverflow.com/questions/2693067/what-is-meant-by-scalas-path-dependent-types\">What is meant by Scala&#39;s path-dependent types?</a></p>\n\n<p><strong>My current solution</strong></p>\n\n<p>Here is what I ended up doing, using RankNTypes.</p>\n\n<p>I still want to give users the ability to use columns how they see fit without having some strong type checks, and opt in if they want some stronger type guarantees: this is a DSL for data scientist who will not know the power of the Haskell side</p>\n\n<p>Tables are still tagged by their content:</p>\n\n<pre><code>type Table a = ...\n</code></pre>\n\n<p>and columns are now tagged with some extra reference types, on top of the type of the data they contain:</p>\n\n<pre><code>type Column ref col = ...\n</code></pre>\n\n<p>Projections from tables to columns are either tagged or untagged. In practice, this is hidden behind a lens-like DSL.</p>\n\n<pre><code>extractCol :: Table Frog -&gt; Column Frog Weight\n\ndata TaggedTable ref a = TaggedTable { _ttTable :: Table a }\n\nextractColTagged :: Table ref Frog -&gt; Column ref Weight\n\nwithTag :: Table a -&gt; (forall ref. TaggedTable ref a -&gt; b) -&gt; b\nwithTag tb f = f (TaggedTable tb)\n</code></pre>\n\n<p>Now I can write some code as following:</p>\n\n<pre><code>let doubleToadWeights = withTag toadTable $ \\ttoadTable -&gt;\n  let toadWeights = extractColTagged ttoadTable in\n    addWeights toadWeights toadWeights\n</code></pre>\n\n<p>and this will not compile, as desired:</p>\n\n<pre><code>let doubleToadWeights =\n  toadTable `withTag` \\ttoads -&gt;\n     bullfrogTable `withTag` \\tbullfrogs -&gt;\n       let toadWeights = extractColTagged ttoads\n           bullfrogWeights = extractColTagged tbullfrogs\n       in addWeights toadWeights bullfrogWeights -- Type error\n</code></pre>\n\n<p>From a DSL perspective, I believe it is not as straightforward as what one could achieve with Scala, but the type error message is understandable, which is paramount for me.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1477897475, "post_id": 40318102, "comment_id": 67930203, "body": "could you paste the output?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1478241964, "post_id": 40318102, "comment_id": 68082806, "body": "Have you tried using the <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.0.1/Outputable.html#t:Outputable\" rel=\"nofollow noreferrer\"><code>Outputable</code></a> instance of <code>Type</code>, or is that the one that is giving you the output you&#39;re not satisfied with?"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1477736340, "creation_date": 1477736340, "question_id": 40318102, "link": "https://stackoverflow.com/questions/40318102/understand-type-representation-in-ghc-for-type-checker-plugin", "title": "Understand type representation in GHC for type checker plugin", "body": "<p>I'm trying to make a typechecker plugin, and I've got a \"null\" plugin working (i.e. one that does nothing), but the solver takes three arguments of type <code>[Ct]</code>. That's described <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.0.1/TcRnTypes.html#t:Ct\" rel=\"nofollow\">here</a> but what's actually more complex is the subtype <code>TcType</code>, which is a type synonym of the type <code>Type</code>. The <code>Type</code> type is in this module <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/libraries/ghc/Type.html\" rel=\"nofollow\">here</a>, but it's complex, so I was hoping I could work it out by printing out the representation of certain types I create. </p>\n\n<p>I've wrapped my solver in <code>tracePlugin</code> from <a href=\"https://hackage.haskell.org/package/ghc-tcplugins-extra-0.2/docs/GHC-TcPluginM-Extra.html\" rel=\"nofollow\">GHC.TcPluginM.Extra</a> in attempt to see what's going on, but the output is ugly, and doesn't seem to use the variable names in my program but scrabbled ones.</p>\n\n<p>Any help that will help me understand what's going on will be appreciated.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1477744320, "post_id": 40318071, "comment_id": 67894214, "body": "You could possibly try to install it with stack instead of cabal."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1477786821, "post_id": 40318071, "comment_id": 67905339, "body": "@Chris That wouldn&#39;t help at all, as <a href=\"https://www.stackage.org/package/haskore\" rel=\"nofollow noreferrer\">Haskore is not in any Stackage snapshot</a>. Stack can be useful in many situations, but it is no silver bullet."}], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 2, "last_activity_date": 1477832732, "creation_date": 1477832732, "answer_id": 40329441, "question_id": 40318071, "link": "https://stackoverflow.com/questions/40318071/haskore-installation-with-cabal/40329441#40329441", "title": "Haskore installation with cabal", "body": "<p>The problem seems to be that <code>haskore</code> depends on a version of <code>process</code> that is not compatible with GHC 8.</p>\n\n<p>Try</p>\n\n<pre><code>cabal install haskore --allow-newer=process\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 2882634, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jbZId.jpg?s=128&g=1", "display_name": "RandomStudent", "link": "https://stackoverflow.com/users/2882634/randomstudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 40329441, "answer_count": 1, "score": 2, "last_activity_date": 1477832732, "creation_date": 1477736132, "question_id": 40318071, "link": "https://stackoverflow.com/questions/40318071/haskore-installation-with-cabal", "title": "Haskore installation with cabal", "body": "<p>When trying to install <a href=\"https://wiki.haskell.org/Haskore\" rel=\"nofollow\">Haskore</a>, with <code>cabal</code> I get the following dependency conflict. (I have GHC 8.0.1)</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: base-4.9.0.0/installed-4.9... (dependency of haskore-0.2.0.8)\nnext goal: process (dependency of haskore-0.2.0.8:+splitbase)\nrejecting: process-1.4.2.0/installed-1.4..., process-1.4.2.0, process-1.4.1.0,\nprocess-1.4.0.0, process-1.3.0.0 (conflict: haskore-0.2.0.8:splitbase =&gt;\nprocess&gt;=1.0 &amp;&amp; &lt;1.3)\nrejecting: process-1.2.3.0, process-1.2.2.0, process-1.2.1.0 (conflict:\nbase==4.9.0.0/installed-4.9..., process =&gt; base&gt;=4.4 &amp;&amp; &lt;4.9)\nrejecting: process-1.2.0.0 (conflict: base==4.9.0.0/installed-4.9..., process\n=&gt; base&gt;=4.4 &amp;&amp; &lt;4.8)\nrejecting: process-1.1.0.2 (conflict: text =&gt;\ndeepseq==1.4.2.0/installed-1.4..., process =&gt; deepseq&gt;=1.1 &amp;&amp; &lt;1.4)\ntrying: process-1.1.0.1\nnext goal: directory (dependency of process-1.1.0.1)\nrejecting: directory-1.2.6.2/installed-1.2..., directory-1.2.7.0,\ndirectory-1.2.6.3, directory-1.2.6.2, directory-1.2.5.1, directory-1.2.5.0,\ndirectory-1.2.4.0, directory-1.2.3.1, directory-1.2.3.0, directory-1.2.2.1,\ndirectory-1.2.2.0, directory-1.2.1.0, directory-1.2.0.1, directory-1.2.0.0\n(conflict: process =&gt; directory&gt;=1.0 &amp;&amp; &lt;1.2)\nrejecting: directory-1.1.0.2 (conflict: base==4.9.0.0/installed-4.9...,\ndirectory =&gt; base&gt;=4.4 &amp;&amp; &lt;4.6)\nrejecting: directory-1.1.0.1 (conflict: base==4.9.0.0/installed-4.9...,\ndirectory =&gt; base&gt;=4.2 &amp;&amp; &lt;4.5)\nrejecting: directory-1.1.0.0, directory-1.0.1.2 (conflict:\nbase==4.9.0.0/installed-4.9..., directory =&gt; base&gt;=4.2 &amp;&amp; &lt;4.4)\nrejecting: directory-1.0.1.1, directory-1.0.1.0 (conflict:\nbase==4.9.0.0/installed-4.9..., directory =&gt; base&gt;=4.1 &amp;&amp; &lt;4.3)\nrejecting: directory-1.0.0.3, directory-1.0.0.0 (conflict:\nbase==4.9.0.0/installed-4.9..., directory =&gt; base&lt;4.3)\nrejecting: directory-1.2.6.1 (conflict: process =&gt; directory&gt;=1.0 &amp;&amp; &lt;1.2)\nBackjump limit reached (currently 2000, change with --max-backjumps or try to\nrun with --reorder-goals).\n</code></pre>\n\n<p>How do I resolve this?</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation", "monad-transformers"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1477733444, "post_id": 40317431, "comment_id": 67891751, "body": "Besides the answer I gave, what happens if you use plain regular <code>foldM</code> from <code>Control.Monad</code>? It seems you could avoid materializing the list that way as well."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1477735902, "post_id": 40317431, "comment_id": 67892219, "body": "I just tried this here: <code>foldM (\\a i-&gt; do {b&lt;-check&#39; i; return $ a &amp;&amp; b}) True [1..n]</code> and it does not remove the space leak. <code>foldM</code>=<code>foldlM</code> is also just a sequence of <code>&gt;&gt;=</code>, it seems."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1477738382, "post_id": 40317431, "comment_id": 67892864, "body": "@mcmayer, try <code>return $! a &amp;&amp; b</code> instead (currently <code>foldM</code> is returning a thunk like <code>((... &amp;&amp; True) &amp;&amp; True) &amp;&amp; True</code> before evaluating it) .  If that doesn&#39;t fix it, I think you are probably misdiagnosing the leak."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1477899449, "post_id": 40317431, "comment_id": 67930728, "body": "@luqui Yes, <code>return $! a &amp;&amp; b</code> works indeed! No space leaks."}], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1477736603, "post_id": 40317623, "comment_id": 67892405, "body": "Yes, that does the job!"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1477733040, "last_edit_date": 1477733040, "creation_date": 1477732361, "answer_id": 40317623, "question_id": 40317431, "link": "https://stackoverflow.com/questions/40317431/haskell-replace-mapm-in-a-monad-transformer-stack-to-achieve-lazy-evaluation-n/40317623#40317623", "title": "Haskell: Replace mapM in a monad transformer stack to achieve lazy evaluation (no space leaks)", "body": "<p>I know you mention you don't want to use streaming libraries, but your problem seems pretty easy to solve with <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.3\"><em>streaming</em></a> without changing the code too much.</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\n</code></pre>\n\n<p>We use <code>each [1..n]</code> instead of <code>[1..n]</code> to get a stream of elements:</p>\n\n<pre><code>each :: (Monad m, Foldable f) =&gt; f a -&gt; Stream (Of a) m ()\n</code></pre>\n\n<blockquote>\n  <p>Stream the elements of a pure, foldable container.</p>\n</blockquote>\n\n<p>(We could also write something like <code>S.take n $ S.enumFrom 1</code>).</p>\n\n<p>We use <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.3/docs/Streaming-Prelude.html#v:mapM\"><code>S.mapM check'</code></a> instead of <code>mapM check'</code>:</p>\n\n<pre><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r\n</code></pre>\n\n<blockquote>\n  <p>Replace each element of a stream with the result of a monadic action</p>\n</blockquote>\n\n<p>And then we fold the stream of booleans with <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.3/docs/Streaming-Prelude.html#v:all\"><code>S.all_ id</code></a>:</p>\n\n<pre><code>all_ :: Monad m =&gt; (a -&gt; Bool) -&gt; Stream (Of a) m r -&gt; m Bool\n</code></pre>\n\n<p>Putting it all together:</p>\n\n<pre><code>S.all_ id (S.mapM check' (S.each [1..n]))\n</code></pre>\n\n<p>Not too different from the code you started with, and without the need for any new operator.</p>\n"}, {"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1477899599, "post_id": 40318307, "comment_id": 67930776, "body": "This is the simplest solution so far!"}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 3, "last_activity_date": 1477737976, "creation_date": 1477737976, "answer_id": 40318307, "question_id": 40317431, "link": "https://stackoverflow.com/questions/40317431/haskell-replace-mapm-in-a-monad-transformer-stack-to-achieve-lazy-evaluation-n/40318307#40318307", "title": "Haskell: Replace mapM in a monad transformer stack to achieve lazy evaluation (no space leaks)", "body": "<p>I think what you need is <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html#v:allM\" rel=\"nofollow\"><code>allM</code></a> from the monad-loops package.</p>\n\n<p>Then it would be just <code>allM check' [1..n]</code></p>\n\n<p>(Or if you don't want the import it's a pretty small function to copy.)</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1477900049, "creation_date": 1477730508, "last_edit_date": 1495541208, "question_id": 40317431, "link": "https://stackoverflow.com/questions/40317431/haskell-replace-mapm-in-a-monad-transformer-stack-to-achieve-lazy-evaluation-n", "title": "Haskell: Replace mapM in a monad transformer stack to achieve lazy evaluation (no space leaks)", "body": "<p>It has already been discussed that <code>mapM</code> is inherently not lazy, e.g. <a href=\"https://stackoverflow.com/questions/3270255/is-haskells-mapm-not-lazy\">here</a> and <a href=\"https://stackoverflow.com/questions/3358913/is-mapm-in-haskell-strict-why-does-this-program-get-a-stack-overflow\">here</a>. Now I'm struggling with a variation of this problem where the <code>mapM</code> in question is deep inside a monad transformer stack.</p>\n\n<p>Here's a function taken from a concrete, working (but space-leaking) example using LevelDB that I put on <a href=\"https://gist.github.com/mcmayer/57884805528632736d4e3bbc9a74b0af\" rel=\"nofollow noreferrer\">gist.github.com</a>:</p>\n\n<pre><code>-- read keys [1..n] from db at DirName and check that the values are correct\ndoRead :: FilePath -&gt; Int -&gt; IO ()\ndoRead dirName n = do\n    success &lt;- runResourceT $ do\n        db &lt;- open dirName defaultOptions{ cacheSize= 2048 }\n        let check' = check db def in        -- is an Int -&gt; ResourceT IO Bool\n            and &lt;$&gt; mapM check' [1..n]      -- space leak !!!\n    putStrLn $ if success then \"OK\" else \"Fail\"\n</code></pre>\n\n<p>This function reads the values corresponding to keys <code>[1..n]</code> and checks that they are all correct. The troublesome line inside the <code>ResourceT IO a</code> monad  is</p>\n\n<pre><code>and &lt;$&gt; mapM check' [1..n]\n</code></pre>\n\n<p>One solution would be to use streaming libraries such as <code>pipes</code>, <code>conduit</code>, etc. But these seem rather heavy and I'm not at all sure how to use them in this situation.</p>\n\n<p>Another path I looked into is <code>ListT</code> as suggested <a href=\"https://stackoverflow.com/questions/34950142/is-there-a-lazy-mapm\">here</a>. But the type signatures of <code>ListT.fromFoldable :: [Bool]-&gt;ListT Bool</code> and <code>ListT.fold :: (r -&gt; a -&gt; m r) -&gt; r -&gt; t m a -&gt; mr</code> (where <code>m</code>=<code>IO</code> and <code>a</code>,<code>r</code>=<code>Bool</code>) do not match the problem at hand.</p>\n\n<p>What is a 'nice' way to get rid of the space leak?</p>\n\n<p><strong>Update:</strong> Note that this problem has nothing to do with monad transformer stacks! Here's a summary of the proposed solutions:</p>\n\n<p>1) Using <code>Streaming</code>:</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\nS.all_ id (S.mapM check' (S.each [1..n]))\n</code></pre>\n\n<p>2) Using <code>Control.Monad.foldM</code>:</p>\n\n<pre><code>foldM (\\a i-&gt; do {b&lt;-check' i; return $! a &amp;&amp; b}) True [1..n]\n</code></pre>\n\n<p>3) Using <code>Control.Monad.Loops.allM</code></p>\n\n<pre><code>allM check' [1..n]\n</code></pre>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 40613, "user_id": 4099593, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zweIW.png?s=128&g=1", "display_name": "Bhargav Rao", "link": "https://stackoverflow.com/users/4099593/bhargav-rao"}, "edited": false, "score": 0, "creation_date": 1477740601, "post_id": 40316605, "comment_id": 67893392, "body": "Please don&#39;t delete and run away once you have received your answer"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1477748940, "post_id": 40316605, "comment_id": 67895348, "body": "See <a href=\"https://www.schoolofhaskell.com/user/edwardk/bound\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/edwardk/bound</a> for an explanation of techniques to allow you <i>not</i> to have to do alpha-equivalence"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 1, "creation_date": 1477897633, "post_id": 40316605, "comment_id": 67930251, "body": "fyi you don&#39;t need to do alpha conversions to implement a lambda calculus evaluator"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 3, "last_activity_date": 1477723857, "last_edit_date": 1477723857, "creation_date": 1477723461, "answer_id": 40316752, "question_id": 40316605, "link": "https://stackoverflow.com/questions/40316605/implementing-alpha-equivalence-in-haskell/40316752#40316752", "title": "Implementing Alpha-Equivalence in haskell", "body": "<p>One way is to convert names to De Bruijn indices, where e.g. <code>0</code> refers to the variable bound by the innermost enclosing lambda, <code>1</code> the next enclosing lambda, and so on. So instead of <em>absolute</em> names, you use <em>relative</em> indices, giving you alpha-equivalence and capture-avoiding substitution for free:</p>\n\n<pre><code>type Sym = Char\ndata Exp = Var Sym | App Exp Exp | Lam Sym Exp\n  deriving (Eq, Read, Show)\n\ntype Ind = Int\ndata Exp' = Var' Ind | App' Exp' Exp' | Lam' Exp'\n  deriving (Eq, Read, Show)\n</code></pre>\n\n<p>To do the conversion, you just keep an <em>environment</em> of the names in scope:</p>\n\n<pre><code>db :: Exp -&gt; Exp'\ndb = go []\n  where\n\n    -- If we see a variable, we look up its index in the environment.\n    go env (Var sym) = case findIndex (== sym) env of\n      Just ind -&gt; Var' ind\n      Nothing -&gt; error \"unbound variable\"\n\n    -- If we see a lambda, we add its variable to the environment.\n    go env (Lam sym exp) = Lam' (go (sym : env) exp)\n\n    -- The other cases are straightforward.\n    go env (App e1 e2) = App' (go env e1) (go env e2)\n</code></pre>\n\n<p>Now, alpha equivalence is simple:</p>\n\n<pre><code>alphaEq x y = db x == db y\n-- or:\nalphaEq = (==) `on` db\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>-- \u03bbx.x ~ \u03bby.y\nLam 'x' (Var 'x') `alphaEq` Lam 'y' (Var 'y')  ==  True\n\n-- \u03bbx.\u03bby.\u03bbz.xz(yz)\ns1 = Lam 'x' $ Lam 'y' $ Lam 'z'\n  $ Var 'x' `App` Var 'z' `App` (Var 'y' `App` Var 'z')\n\n-- \u03bba.\u03bbb.\u03bbc.ac(bc)\ns2 = Lam 'a' $ Lam 'b' $ Lam 'c'\n  $ Var 'a' `App` Var 'c' `App` (Var 'b' `App` Var 'c')\n\n-- \u03bba.\u03bbb.\u03bbc.ab(ac)\ns3 = Lam 'a' $ Lam 'b' $ Lam 'c'\n  $ Var 'a' `App` Var 'b' `App` (Var 'a' `App` Var 'c')\n\ns1 `alphaEq` s2  ==  True\ns1 `alphaEq` s3  ==  False\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5395043"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 956, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477723857, "creation_date": 1477721778, "question_id": 40316605, "link": "https://stackoverflow.com/questions/40316605/implementing-alpha-equivalence-in-haskell", "title": "Implementing Alpha-Equivalence in haskell", "body": "<p>I want to define Alpha-Equivalence using this data definition</p>\n\n<pre><code>type Sym = Char\ndata Exp = Var Sym | App Term Exp | Lam Sym Exp \nderiving (Eq, Read, Show)\n</code></pre>\n\n<p>What is the best way to do this?</p>\n"}, {"tags": ["haskell", "type-conversion", "type-families"], "comments": [{"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1478013314, "post_id": 40316051, "comment_id": 67978956, "body": "There&#39;s the <a href=\"https://hackage.haskell.org/package/Boolean\" rel=\"nofollow noreferrer\">Boolean</a> package."}], "answers": [{"comments": [{"owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "edited": false, "score": 0, "creation_date": 1477738016, "post_id": 40317758, "comment_id": 67892763, "body": "I define <code>&amp;&amp;</code> as <code>(toBool -&gt; BoolLike f) &amp;&amp; (toBool -&gt; BoolLike g) = BoolLike $ \\k -&gt; f k P.&amp;&amp; g k</code>, and <code>||</code> similar.  It looks good, until <code>let relation = 1 &amp;&amp; 2 || 3</code>, ghci cannot deduce (BoolItem a10 ~ BoolLike a3).  The full source code is <a href=\"https://github.com/qzchenwl/BoolLike/blob/master/src/BoolLike.hs\" rel=\"nofollow noreferrer\">github.com/qzchenwl/BoolLike/blob/master/src/BoolLike.hs</a>"}, {"owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "edited": false, "score": 0, "creation_date": 1477739480, "post_id": 40317758, "comment_id": 67893123, "body": "It&#39;s OK for <code>Char</code>. I&#39;ve updated the <a href=\"https://github.com/qzchenwl/BoolLike/blob/master/src/Main.hs\" rel=\"nofollow noreferrer\"><code>Main.hs</code></a>"}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "reply_to_user": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "edited": false, "score": 1, "creation_date": 1477740836, "post_id": 40317758, "comment_id": 67893443, "body": "@wenlong, this is because <code>1</code>, <code>2</code>, etc. have a non-monomorphic type, i.e. <code>Num a =&gt; a</code>. If the type is unambiguous, like <code>(1 :: Int) &amp;&amp; (2 :: Int) || (3 :: Int)</code>, it works."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 1, "creation_date": 1477741030, "post_id": 40317758, "comment_id": 67893484, "body": "To expand a bit, there could potentially be a <code>Num</code> instance for <code>BoolLike</code> and then the other instance would match. There are ways around this that sometimes work and I&#39;m currently seeing if I can find one, but annotating things is probably the cleanest option."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "edited": false, "score": 2, "creation_date": 1477742116, "post_id": 40317758, "comment_id": 67893722, "body": "@wenlong I&#39;ve made it work for your examples <a href=\"https://gist.github.com/LukaHorvat/039da8546d7f831a7f7e6348da03d089\" rel=\"nofollow noreferrer\">gist.github.com/LukaHorvat/039da8546d7f831a7f7e6348da03d089</a> (don&#39;t tell anyone you&#39;re using <code>INCOHERENT</code> instances)"}], "tags": [], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "is_accepted": true, "score": 3, "last_activity_date": 1477733619, "creation_date": 1477733619, "answer_id": 40317758, "question_id": 40316051, "link": "https://stackoverflow.com/questions/40316051/auto-convert-type-in-haskell/40317758#40317758", "title": "Auto convert type in haskell", "body": "<p>You could try this</p>\n\n<pre><code>type family BoolItem a where\n    BoolItem (BoolLike a) = BoolLike a\n    BoolItem a = BoolLike a\n\nclass IsBool a where\n  toBool :: a -&gt; BoolItem a\n\ninstance IsBool (BoolLike a) where\n  toBool = id\n\ninstance (BoolItem a ~ BoolLike a) =&gt; IsBool a where\n  toBool = toBoolLike\n</code></pre>\n\n<p>By moving the type family out of the class you can define it for all types. Then all that remains is restricting one of the instances. Don't forget you'll also need to make that one <code>OVERLAPPABLE</code></p>\n"}, {"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 1, "creation_date": 1477771769, "post_id": 40320309, "comment_id": 67902022, "body": "Also worth noting that if you tag your &quot;bottom values&quot; as you do here with <code>$</code> it also makes the OP&#39;s problem go away since then the operators can be implemented only for <code>BoolLike</code>s and they don&#39;t have to be polymorphic."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1477761505, "last_edit_date": 1477761505, "creation_date": 1477752705, "answer_id": 40320309, "question_id": 40316051, "link": "https://stackoverflow.com/questions/40316051/auto-convert-type-in-haskell/40320309#40320309", "title": "Auto convert type in haskell", "body": "<p>This answer probably won't be useful to you, as in all likelihood you have already considered the alternative I am going to suggest and deemed it not enough for your devilish purposes. Still, readers who stumble upon this question might find it useful to know how to achieve something similar to what you were looking for, if not quite as nifty, without type class trickery.</p>\n\n<p>In your plans, a <code>BoolLike a</code> ...</p>\n\n<pre><code>newtype BoolLike a = BoolLike ((a -&gt; Bool) -&gt; Bool)\n</code></pre>\n\n<p>... consists of a function which produces a <code>Bool</code> result when given an <code>a -&gt; Bool</code> continuation. Your usage examples all boil down to combining the <code>Bool</code> results with <code>(&amp;&amp;)</code> and <code>(||)</code> before supplying the continuation. That can be achieved using the <code>Applicative</code> instance for functions (in this case, <code>(-&gt;) (a -&gt; Bool)</code>) and using <code>(&amp;)</code>/<code>flip ($)</code> to promote plain values into <code>(a -&gt; Bool) -&gt; Bool</code> \"suspended computations\":</p>\n\n<pre><code>GHCi&gt; ((||) &lt;$&gt; ((&amp;&amp;) &lt;$&gt; ($ 1) &lt;*&gt; ($ 2)) &lt;*&gt; ($ 3)) (`elem` [2])\nFalse\n</code></pre>\n\n<p>That, of course, is not at all tidy to write. However, we can improve things quite a lot by defining:</p>\n\n<pre><code>(&lt;&amp;&amp;&gt;) :: Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool\nx &lt;&amp;&amp;&gt; y = (&amp;&amp;) &lt;$&gt; x &lt;*&gt; y\n\n(&lt;||&gt;) :: Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool\nx &lt;||&gt; y = (||) &lt;$&gt; x &lt;*&gt; y\n</code></pre>\n\n<p>(For a little library defining them, have a look at <a href=\"http://hackage.haskell.org/package/control-bool-0.2.1\" rel=\"nofollow\"><em>control-bool</em></a>.)</p>\n\n<p>Armed with these, the extra line noise becomes quite lightweight:</p>\n\n<pre><code>GHCi&gt; (($ 1) &lt;&amp;&amp;&gt; ($ 2) &lt;||&gt; ($ 3)) (`elem` [2])\nFalse\n</code></pre>\n\n<p>This works out of the box for the <code>contains</code> case as well \u2014 all that it takes is changing the supplied continuation:</p>\n\n<pre><code>GHCi&gt; (($ [1, 2]) &lt;&amp;&amp;&gt; ($ [2, 3]) &lt;||&gt; ($ [3, 4])) (elem 1)\nFalse\n</code></pre>\n\n<p>As a final note, it is worth pointing out the <code>contains</code> case can be straightforwardly expressed in terms of <code>intersect</code> and <code>union</code> from <code>Data.List</code>:</p>\n\n<pre><code>GHCi&gt; [1, 2] `intersect` [2, 3] `union` [3, 4] &amp; elem 1\nFalse\n</code></pre>\n"}], "owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 1, "accepted_answer_id": 40317758, "answer_count": 2, "score": 4, "last_activity_date": 1477761505, "creation_date": 1477715731, "question_id": 40316051, "link": "https://stackoverflow.com/questions/40316051/auto-convert-type-in-haskell", "title": "Auto convert type in haskell", "body": "<p>I've written some helpful functions to do logical operation. It looks like <code>(a and b or c) `belongs` x</code>.</p>\n\n<p>Thanks to <code>Num</code>, <code>IsList</code> and <code>OverloadedLists</code>, I can have it for integers and lists.</p>\n\n<pre><code>\u03bb&gt; (1 &amp;&amp; 2 || 3) `belongs` [2]\nFalse\n\u03bb&gt; (1 &amp;&amp; 2 || 3) `belongs` [1, 2]\nTrue\n\u03bb&gt; (1 &amp;&amp; 2 || 3) `belongs` [3]\nTrue\n\n\u03bb&gt; :set -XOverloadedLists\n\u03bb&gt; ([1, 2] &amp;&amp; [2, 3] || [3, 4]) `contains` 1\nFalse\n\u03bb&gt; ([1, 2] &amp;&amp; [2, 3] || [3, 4]) `contains` 2\nTrue\n</code></pre>\n\n<p>I do it this way:</p>\n\n<pre><code>newtype BoolLike a = BoolLike ((a -&gt; Bool) -&gt; Bool)\n\n(&amp;&amp;) :: BoolLike a -&gt; BoolLike a -&gt; BoolLike a\nBoolLike f &amp;&amp; BoolLike g = BoolLike $ \\k -&gt; f k P.&amp;&amp; g k\ninfixr 3 &amp;&amp;\n\ntoBoolLike :: a -&gt; BoolLike a\ntoBoolLike x = BoolLike $ \\k -&gt; k x\n\nbelongs :: Eq a =&gt; BoolLike a -&gt; [a] -&gt; Bool\nbelongs (BoolLike f) xs = f (\\x -&gt; x `elem` xs)\n\ncontains :: Eq a =&gt; BoolLike [a] -&gt; a -&gt; Bool\ncontains (BoolLike f) x = f (\\xs -&gt; x `elem` xs)\n\ninstance Num a =&gt; Num (BoolLike a) where\n  fromInteger = toBoolLike . fromInteger\n</code></pre>\n\n<p>What I am going to do is make it suit for any types, without manually convert <code>a</code> to <code>BoolLike a</code>.</p>\n\n<p>How can I achieve it?</p>\n\n<p>First try:</p>\n\n<pre><code>class IsBool a where\n  type BoolItem a\n  toBool :: a -&gt; BoolItem a\n\ninstance IsBool (BoolLike a) where\n  type BoolItem (BoolLike a) = BoolLike a\n  toBool = id\n\ninstance IsBool a where\n  type BoolItem a = BoolLike a\n  toBool = toBoolLike\n</code></pre>\n\n<p>Failed:</p>\n\n<pre><code>Conflicting family instance declarations:\n  BoolItem (BoolLike a) -- Defined at BoolLike.hs:54:8\n  BoolItem a -- Defined at BoolLike.hs:58:8\n</code></pre>\n"}, {"tags": ["haskell", "haskell-prelude"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1477723772, "post_id": 40316021, "comment_id": 67890191, "body": "Consider <code>Tree String</code>. Let all strings in the tree have a common prefix of length N. Now count individual character comparisons in both cases."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477745496, "post_id": 40316947, "comment_id": 67894500, "body": "Consider what happens, though, if type <code>a</code> implements <code>compare x y</code> as <code>if x == y then EQ else if x &lt; y then LT else GT</code>, though."}, {"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477792885, "post_id": 40316947, "comment_id": 67906255, "body": "@chepner I don&#39;t really get your point. Could you explain more?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477793354, "post_id": 40316947, "comment_id": 67906361, "body": "You need to know how <code>compare</code> is actually implemented before you can claim it is more efficient than computing <code>x == y</code> and <code>x &lt; y</code> explicitly."}, {"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477793854, "post_id": 40316947, "comment_id": 67906451, "body": "@chepner I guess I catch up a little bit. Could you add another answer?"}], "tags": [], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "is_accepted": true, "score": 1, "last_activity_date": 1477725869, "last_edit_date": 1495542798, "creation_date": 1477725550, "answer_id": 40316947, "question_id": 40316021, "link": "https://stackoverflow.com/questions/40316021/operator-comparison-and-prelude-compare/40316947#40316947", "title": "operator comparison and Prelude.compare", "body": "<p>It turns out to be simple:</p>\n\n<pre><code>occurs x (Node l y r) | x == y    = True\n                      | x &lt; y     = occurs x l\n                      | otherwise = occurs x r\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>occurs x (Node l y r) = if x == y\n                            then True\n                            else if x &lt; y\n                                then occurs x l\n                                else occurs x r\n</code></pre>\n\n<p>Comparison (Operator <code>==</code> and <code>&lt;</code>) would be applied to <code>x</code>, <code>y</code> (<code>Tree-Node</code>) at most twice.</p>\n\n<p>As for</p>\n\n<pre><code>occurs x (Node l y r) = case compare x y of EQ -&gt; True\n                                            LT -&gt; occurs x l\n                                            GT -&gt; occurs x r\n</code></pre>\n\n<p>Comparison of <code>x</code>, <code>y</code> (<code>Tree-Node</code>) would be done for once and the result is saved to compare with <code>EQ</code>, <code>LT</code> and <code>GT</code> (<code>Ordering</code>).</p>\n\n<p>Consider cost of worse case:</p>\n\n<pre><code>operator-comparison = cost(compare(Tree-node)) * 2\n</code></pre>\n\n<p>while</p>\n\n<pre><code>Prelude.compare = cost(compare(Tree-node)) + cost(compare(Ordering))*2\n</code></pre>\n\n<p>Boost would be notable as <code>Tree-node</code> become more complicated than <code>Ordering</code>.</p>\n\n<p>Thanks <a href=\"https://stackoverflow.com/users/775806/n-m\">n.m.</a>.</p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 40316947, "answer_count": 1, "score": 2, "last_activity_date": 1512974029, "creation_date": 1477715231, "last_edit_date": 1512974029, "question_id": 40316021, "link": "https://stackoverflow.com/questions/40316021/operator-comparison-and-prelude-compare", "title": "operator comparison and Prelude.compare", "body": "<p>Chapter 8 of <a href=\"http://www.cs.nott.ac.uk/~pszgmh/pih.html\" rel=\"nofollow\">Programming in Haskell (2e)</a> defines a data <code>Tree</code> and a binary search function <code>occurs</code>:</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) a (Tree a)\n\noccurs :: Ord a =&gt; a -&gt; Tree a -&gt; Bool\noccurs x (Leaf y)                 = x == y\noccurs x (Node l y r) | x == y    = True\n                      | x &lt; y     = occurs x l\n                      | otherwise = occurs x r\n</code></pre>\n\n<p>Exercise 3 (of chap 8) asks to redefine <code>occurs</code> with <code>Prelude.compare</code> and question:</p>\n\n<blockquote>\n  <p>Why is this new definition more efficient than the original version?</p>\n</blockquote>\n\n<p>Here I give my definition:</p>\n\n<pre><code>occurs :: Ord a =&gt; a -&gt; Tree a -&gt; Bool\noccurs x (Leaf y)     = x == y\noccurs x (Node l y r) = case compare x y of EQ -&gt; True\n                                            LT -&gt; occurs x l\n                                            GT -&gt; occurs x r\n</code></pre>\n\n<p>But I don't see boost on efficiency. Is there any?</p>\n\n<p>Do I learn it the wrong way?</p>\n"}, {"tags": ["haskell", "types", "type-theory", "higher-rank-types"], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 7, "last_activity_date": 1477718588, "last_edit_date": 1477718588, "creation_date": 1477718058, "answer_id": 40316260, "question_id": 40315597, "link": "https://stackoverflow.com/questions/40315597/rankntypes-and-church-numerals/40316260#40316260", "title": "RankNTypes and Church numerals", "body": "<p>The reason that it doesn't work is it involves several impredicative instantiations, which isn't even normally allowed in Haskell. If you turn on <code>-XImpredicativeTypes</code>, you can get it to compile: </p>\n\n<pre><code>{-# LANGUAGE ImpredicativeTypes #-} \n\n...\n\nexp' :: Nat -&gt; Nat -&gt; Nat\nexp' m n = n (mult m) (succ zero) \n</code></pre>\n\n<p>The second version typechecks because <code>mult'</code> has a higher rank type, even though it is definitionally equal to <code>(.)</code>, so typechecking proceeds differently. Since the type of <code>(.)</code> is simpler (rank 1) typechecking will succeed more often.</p>\n\n<p>The GHC docs warn <code>ImpredicativeTypes</code> does not work so I would caution against using it. The typical way to get around this it to simple use a <code>newtype</code>:</p>\n\n<pre><code>newtype Nat' = N { instN :: Nat } \n\nexp'' :: Nat -&gt; Nat -&gt; Nat\nexp'' m n = instN $ n (\\(N q) -&gt; N $ mult m q) (N $ succC zero) \n</code></pre>\n\n<hr>\n\n<p>To see the impredicative instantiation in action, you can use typed holes: </p>\n\n<pre><code>exp' :: Nat -&gt; Nat -&gt; Nat\nexp' m n = _ (mult m) (succC zero) \n</code></pre>\n\n<p>This will report the type <code>forall a . (Nat -&gt; Nat) -&gt; Nat -&gt; (a -&gt; a) -&gt; a -&gt; a</code>, which is the same as <code>(Nat -&gt; Nat) -&gt; Nat -&gt; Nat</code>. Since you place <code>n</code> there, you have to unify this type with <code>forall a . (a -&gt; a) -&gt; a -&gt; a</code>, which involves instantiating the type variable <code>a</code> with the polytype <code>Nat</code>. </p>\n"}], "owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 40316260, "answer_count": 1, "score": 5, "last_activity_date": 1477757200, "creation_date": 1477709635, "last_edit_date": 1477757200, "question_id": 40315597, "link": "https://stackoverflow.com/questions/40315597/rankntypes-and-church-numerals", "title": "RankNTypes and Church numerals", "body": "<p>I'm trying to study church numerals in Haskell by giving the numbers a type like this, with the idea that a natural number <code>n</code> is basically the expression that applies the function in the following type to the value of type <code>t</code> for <code>n</code> times.</p>\n\n<pre><code>type Nat = forall t. (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>With that idea, I can define <code>zero</code>, <code>successor</code>, <code>plus</code>, <code>mult</code> in the following ways:</p>\n\n<pre><code>zero :: Nat\nzero = \\f t -&gt; t\n\nsucc :: Nat -&gt; Nat\nsucc n = \\f -&gt; f . (n f)\n\nplus :: Nat -&gt; Nat -&gt; Nat\nplus m n = \\f -&gt; (m f) . (n f)\n\nmult :: Nat -&gt; Nat -&gt; Nat\nmult m n = \\f -&gt; m (n f) -- Equal to \\f -&gt; (m . n) f\n\n-- Pointfree version\nmult' :: Nat -&gt; Nat -&gt; Nat\nmult' = (.)\n</code></pre>\n\n<p>When I try to define exponentiation, I'd like to try applying the same reasoning that allowed me to define multiplication, namely <strong>applying <code>mult m</code> <code>n</code> times to <code>1</code></strong>.</p>\n\n<p>This leads to the following code</p>\n\n<pre><code>exp' :: Nat -&gt; Nat -&gt; Nat\nexp' m n = n (mult m) (succ zero)\n</code></pre>\n\n<p>But this does type check with the following error from GHC:</p>\n\n<pre><code>  Couldn't match type \u2018t\u2019 with \u2018t1\u2019\n  \u2018t\u2019 is a rigid type variable bound by\n    the type signature for:\n      exp' :: forall t. Nat -&gt; Nat -&gt; (t -&gt; t) -&gt; t -&gt; t\n    at church.lhs:44:3\n  \u2018t1\u2019 is a rigid type variable bound by\n    a type expected by the context:\n      forall t1. (t1 -&gt; t1) -&gt; t1 -&gt; t1\n    at church.lhs:44:17\n  Expected type: ((t -&gt; t) -&gt; t -&gt; t) -&gt; (t -&gt; t) -&gt; t -&gt; t\n    Actual type: Nat -&gt; Nat\n</code></pre>\n\n<p>The error seems to say that the typechecker is not instantiating the type for <code>n</code> properly, ideally type <code>t</code> should be instantiated with another (<code>t -&gt; t</code>) for the expression to go through.</p>\n\n<p>What's also confusing me is that the following code typechecks:</p>\n\n<pre><code>exp :: Nat -&gt; Nat -&gt; Nat\nexp m n = n ((.) m) (succ zero) -- replace mult by (.)\n</code></pre>\n\n<p>Would someone mind explaining what's the problem here? Why does the first definition of <code>exp'</code> not typecheck but the second <code>exp</code> typecheks?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ambiguous"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1477695160, "post_id": 40314142, "comment_id": 67885706, "body": "Look at the line number - the error is in your exports list. You export <code>empty</code> but there are two such names in scope. You probably want <code>import qualified DataStructures.Stack...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1477709066, "creation_date": 1477709066, "answer_id": 40315556, "question_id": 40314142, "link": "https://stackoverflow.com/questions/40314142/ambiguous-occurrence-empty-even-with-a-as-prefix/40315556#40315556", "title": "Ambiguous occurrence \u2018empty\u2019 even with a &quot; as Prefix &quot;", "body": "<p>Suppose you have a module <code>A</code>:</p>\n\n<pre><code>module A (Foo, Bar) where\ndata Foo = \u2026\ndata Bar = \u2026\n</code></pre>\n\n<p>When you write:</p>\n\n<pre><code>import A as B\n</code></pre>\n\n<p>That brings <code>B.Foo</code>, and <code>B.Bar</code> into scope, but it <em>also</em> brings in the unqualified <code>Foo</code> and <code>Bar</code>. When you use a <code>qualified</code> import, <em>only</em> the qualified names (<code>B.Foo</code>, <code>B.Bar</code>) are imported. For example:</p>\n\n<pre><code>import qualified DataStructures.Stack.LinearStack as LS\n       ---------\n</code></pre>\n\n<p>With this, <code>empty</code> in your export list will refer unambiguously to <code>DataStructures.Queue.TwoStacksQueue.empty</code>, but you have to qualify all functions from <code>DataStructures.Stack.LinearStack</code> with the <code>LS.</code> prefix, unless you import them explicitly:</p>\n\n<pre><code>import DataStructures.Stack.LinearStack (foo, bar)\n</code></pre>\n\n<p>Alternatively, in the export list, you can fully qualify the name of the function in the current module:</p>\n\n<pre><code>module DataStructures.Queue.TwoStacksQueue\n  ( DataStructures.Queue.TwoStacksQueue.empty\n  , \u2026\n  ) where\n</code></pre>\n\n<p>Generally speaking, <code>import qualified \u2026 as \u2026</code> is a sane default. It generates some prefix clutter in the code, but it prevents name collisions like this. It\u2019s also more future-proof: using <em>unqualified</em> imports, if <code>DataStructures.Stack.LinearStack</code> exports a new function, then you may have to change any module that imports it, if there is a name collision.</p>\n"}], "owner": {"reputation": 21, "user_id": 7087441, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-M4clmhOpJSM/AAAAAAAAAAI/AAAAAAAAAcA/WHO2Qt0robE/photo.jpg?sz=128", "display_name": "Pedro Avila", "link": "https://stackoverflow.com/users/7087441/pedro-avila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477709066, "creation_date": 1477694421, "question_id": 40314142, "link": "https://stackoverflow.com/questions/40314142/ambiguous-occurrence-empty-even-with-a-as-prefix", "title": "Ambiguous occurrence \u2018empty\u2019 even with a &quot; as Prefix &quot;", "body": "<p>I was trying to implement a two stacks queue in Haskell but at the very first of my code I get this error.</p>\n\n<pre><code>TwoStacksQueue.hs:3:5:\n    Ambiguous occurrence \u2018empty\u2019\n    It could refer to either \u2018DataStructures.Queue.TwoStacksQueue.empty\u2019,\n                      defined at TwoStacksQueue.hs:15:1\n                      or \u2018LS.empty\u2019,\n                      imported from \u2018DataStructures.Stack.LinearStack\u2019 \n</code></pre>\n\n<p>This is the code (I cant even start with isEmpty):</p>\n\n<pre><code>module DataStructures.Queue.TwoStacksQueue\n( Queue\n, empty\n, isEmpty\n, enqueue\n, dequeue\n, first\n) where\n\nimport DataStructures.Stack.LinearStack as LS\n\ndata Queue a = Empty | Node a (Stack a) (Stack a)\n\nempty :: Queue a\nempty = Empty\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1477693445, "post_id": 40313918, "comment_id": 67885158, "body": "I don&#39;t know if this exists or not. To implement it myself, I&#39;d start with a simpler function. Something like <code>find :: String -&gt; String -&gt; Int</code> which returns the index of the first string within the second string. You can return a -1 to indicate not found, or return <code>Maybe Int</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477693866, "post_id": 40314007, "comment_id": 67885287, "body": "<a href=\"https://hayoo.fh-wedel.de/?query=Eq+a+%3D%3E+%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D+\" rel=\"nofollow noreferrer\">Hayoo gives a handful of other relevant functions</a> (mainly the <i>utility-ht</i> and <i>extra</i> ones) if you search for the more general signature <code>Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]</code>."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477694214, "post_id": 40314007, "comment_id": 67885404, "body": "That&#39;s a good idea, but considering OP is dealing with strings, I&#39;d be inclined to <i>also</i> typeclass-constrain <code>a</code> to <code>Show a</code>, which <a href=\"https://www.haskell.org/hoogle/?hoogle=%28Show+a%2C+Eq+a%29+%3D%3E+%5Ba%5D-%3E%5Ba%5D-%3E%5Ba%5D-%3E%5Ba%5D\" rel=\"nofollow noreferrer\">shows up on Hoogle</a>. <code>Data.Text</code>&#39;s <code>replace</code> shows up on the first page there."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477694490, "post_id": 40314007, "comment_id": 67885498, "body": "I&#39;m not sure I follow. The extra <code>Show a</code> does not change the results on Hoogle, and a <code>Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]</code> works just fine with the subset of element types that have both <code>Eq</code> and <code>Show</code>  constraints."}], "tags": [], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "is_accepted": false, "score": 3, "last_activity_date": 1477694396, "last_edit_date": 1477694396, "creation_date": 1477693476, "answer_id": 40314007, "question_id": 40313918, "link": "https://stackoverflow.com/questions/40313918/in-string-replacement-function-in-haskel/40314007#40314007", "title": "In string replacement function in Haskel", "body": "<p>This can be easily done using the <a href=\"https://hackage.haskell.org/package/MissingH-1.4.0.1/docs/Data-String-Utils.html#v:replace\" rel=\"nofollow\"><code>replace</code></a> function provided by <code>Data.String.Utils</code>.</p>\n\n<p>Example usage is very similar to your code snippet:</p>\n\n<pre><code>ghci&gt; replace \"Hello\" \"Goodbye\" \"Hello world\"\n\"Goodbye world\"\n</code></pre>\n\n<p>Note that this function is provided as part of the <a href=\"https://hackage.haskell.org/package/MissingH-1.4.0.1\" rel=\"nofollow\"><code>MissingH</code></a> package.</p>\n\n<p>Finally, while this is the first result that comes up on an internet search engine, <a href=\"https://www.haskell.org/hoogle/?hoogle=replace\" rel=\"nofollow\">Hoogle shows</a> many other packages providing this functionality, as well as a few <a href=\"https://www.haskell.org/hoogle/?hoogle=String-%3EString-%3EString-%3EString\" rel=\"nofollow\">relevant results</a> with the same type signature.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477701422, "post_id": 40314677, "comment_id": 67886917, "body": "Comments: (1) if you are already using <code>words</code>, you might as well rejoin words with <code>lines</code> rather than inserting <code>&quot; &quot;</code> by hand. (2) While this replacing function respectful of word boundaries is different than the <code>replace</code> in Jules&#39; answer, it can be implemented in terms of the other one: <code>replaceWord old new = lines . replace [old] [new] . words</code>. Rewriting the generalised <code>replace</code> from the libraries would be a worthy exercise as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1477706224, "post_id": 40314677, "comment_id": 67887696, "body": "Some of your base cases are wrong. I wouldn&#39;t expect <code>replace &quot;&quot; &quot;&quot; &quot;Hello&quot;</code> to produce <code>&quot;&quot;</code>, but that&#39;s what your version does."}, {"owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "edited": false, "score": 0, "creation_date": 1477747087, "post_id": 40314677, "comment_id": 67894886, "body": "Thanks for the advice fellas, fixed it as much as I could, saw the bug in the implementation, and @dupplude I do realize I could implement it that way, but I thought it would be fun just to be a little old school for learning purposes"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1477770415, "post_id": 40314677, "comment_id": 67901665, "body": "You still have base case issues. I don&#39;t know if you have other issues. I also don&#39;t understand why you care about word boundaries."}], "tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1477787898, "last_edit_date": 1477787898, "creation_date": 1477698968, "answer_id": 40314677, "question_id": 40313918, "link": "https://stackoverflow.com/questions/40313918/in-string-replacement-function-in-haskel/40314677#40314677", "title": "In string replacement function in Haskel", "body": "<p>Well you could use <a href=\"https://hackage.haskell.org/package/MissingH-1.4.0.1/docs/Data-String-Utils.html\" rel=\"nofollow\">replace</a> as mentioned above but I decided to make my own implementation of that same function (so to speak) mine is a little inneficient in comparison but it achieves the same result non-theless </p>\n\n<pre><code>replace :: String -&gt; String -&gt; String -&gt; String\nreplace x y frase = let find [] [] [] = []\n                        find x' y' (h:t) = if h /= y'\n                             then h ++ \" \"++ find x' y' t\n                             else x' ++ \" \"++ find x' y' t\n            in if y `elem` words frase\n               then find x y (words frase) else frase\n</code></pre>\n\n<p>is late and probably some of the patterns are redundant, all you are required to do is to recursively search for the matching string by braking the frase into words with <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:words\" rel=\"nofollow\">words</a> from <strong>Prelude</strong>, eitherway making your own version is always pointless if there is an efficient working version of it, but I thought this would help you understand how to the function works and maybe implement your own version (for fun or to learn).</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1477707409, "creation_date": 1477707409, "answer_id": 40315423, "question_id": 40313918, "link": "https://stackoverflow.com/questions/40313918/in-string-replacement-function-in-haskel/40315423#40315423", "title": "In string replacement function in Haskel", "body": "<p>Hmph. I feel like I really should've be answering this lousy question, but I can't resist.</p>\n\n<pre><code>replace :: Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]\nreplace _ _ [] = []\nreplace old new xs@(x':xs')\n  | old == front = new ++ replace old new rear\n  | otherwise = x' : replace old new xs'\n  where\n    (front, rear) = splitLength old xs\n\nsplitLength :: [a] -&gt; [b] -&gt; ([b], [b])\nsplitLength [] ys = ([], ys)\nsplitLength _ [] = []\nsplitLength (_:xs) (y:ys) =\n  let (l,r) = splitLength xs ys\n  in (y:l, r)\n</code></pre>\n\n<p>There is plenty of room to improve this simple implementation.</p>\n"}], "owner": {"reputation": 103, "user_id": 7087326, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FmwwcbQozgw/AAAAAAAAAAI/AAAAAAAACOI/9i0bxvfk1Mc/photo.jpg?sz=128", "display_name": "Ando Bando", "link": "https://stackoverflow.com/users/7087326/ando-bando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 3, "score": -3, "last_activity_date": 1477787898, "creation_date": 1477692911, "question_id": 40313918, "link": "https://stackoverflow.com/questions/40313918/in-string-replacement-function-in-haskel", "title": "In string replacement function in Haskel", "body": "<p>Does there exist a function in Haskell such that I can feed it something like</p>\n\n<p><code>replace \"Hello\" \"GoodBye\" \"Hello World\"</code></p>\n\n<p>and return something like </p>\n\n<p><code>\"GoodBye World\"</code> </p>\n\n<p>If  such a function does not exist how would I implement it?</p>\n\n<p>Many Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477693335, "post_id": 40313812, "comment_id": 67885130, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/31506839/how-does-this-state-monad-code-works\">How does this State monad code works?</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477693456, "post_id": 40313812, "comment_id": 67885164, "body": "(<code>get</code> works much like <code>fresh</code> in that example, except that the underlying function of <code>get</code> is simply <code>\\s -&gt; (s, s)</code>, while <code>fresh</code> also modifies the state.)"}], "answers": [{"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477771305, "post_id": 40314055, "comment_id": 67901893, "body": "&quot;And since in the type signature of cs you&#39;ve told the compiler what m is, get becomes:&quot; I cannot understand it. Can you say more about it?"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 1, "creation_date": 1477776248, "post_id": 40314055, "comment_id": 67903184, "body": "In the type of <code>get</code> there are two type variables. <code>s</code> is the type of the state value and can be anything, in general. <code>m</code> must be some data type which has a <code>MonadState</code> instance. Without type annotations, the compiler will use the most general types it can. Your <code>cs</code> function would end up with a type like <code>cs :: MonadState a m =&gt; b -&gt; m ()</code> since there are only two things the compiler knows for sure: your <code>m</code> has a <code>MonadState</code> instance (because you use <code>get</code>), and you return the value <code>()</code>."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 1, "creation_date": 1477776520, "post_id": 40314055, "comment_id": 67903260, "body": "Now since you explicitly gave it a type signature (which is good practice on top-level definitions), you are putting additional constraints on the type checker. In fact, you&#39;ve told it exactly which instance of <code>MonadState</code> you want: <code>StateT Int (ErrorT String IO)</code>.  Thus <code>get</code> goes from <code>MonadState s m =&gt; m s</code> to <code>StateT Int (ErrorT String IO) Int</code>. (i.e. <code>m = StateT Int (ErrorT String IO)</code> and <code>s = Int</code>)"}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477779389, "post_id": 40314055, "comment_id": 67903912, "body": "it is an awesome explanation! :)  Please explain me from where a state value is taken? I suppose that there is a initial state passed with <code>runStateT</code> but I cannot see how it is passed. Please note: I just called <code>get</code> function and I have a state. But, how did I get it? Magic? How the passing of state is &quot;chaining&quot;. I would like to understand it."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1477784283, "post_id": 40314055, "comment_id": 67904919, "body": "I&#39;m sure a search for &quot;how does state monad work&quot; would come up with a lot of results. A quick non-rigorous explanation is that the state monad is a function <code>\\s -&gt; (a,s)</code> where bind (<code>&gt;&gt;=</code>) &#39;composes&#39; states. Thus, it&#39;s a function which you &#39;run&#39; by applying to a <code>s</code> value. This is what <code>runState</code> and the like do."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 4, "last_activity_date": 1477693788, "creation_date": 1477693788, "answer_id": 40314055, "question_id": 40313812, "link": "https://stackoverflow.com/questions/40313812/haskell-and-calling-function/40314055#40314055", "title": "Haskell and calling function.", "body": "<p>Check out the type of <code>get</code>:</p>\n\n<pre><code>get :: MonadState s m =&gt; m s\n</code></pre>\n\n<p>And since in the type signature of <code>cs</code> you've told the compiler what <code>m</code> is, <code>get</code> becomes:</p>\n\n<pre><code>get :: StateT Int (ErrorT String IO) Int\n</code></pre>\n\n<p>That's just a monadic value, not a function. So where does the value named <code>mem</code> come from? Ultimately, the value that <code>get</code> provides comes from the initial state value supplied by <code>runStateT</code> (or <code>execStateT</code> or <code>evalStateT</code>).</p>\n\n<p>If that still seems mysterious, I recommend studying up on how the state monad works.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 40314055, "answer_count": 1, "score": 0, "last_activity_date": 1477693788, "creation_date": 1477692301, "question_id": 40313812, "link": "https://stackoverflow.com/questions/40313812/haskell-and-calling-function", "title": "Haskell and calling function.", "body": "<pre><code>data S = Sa Int\ntype PMO = StateT Int (ErrorT String IO)\n\ncs :: S -&gt; PMO ()\ncs _ = do\n  mem &lt;- get -- (*)\n  return ()\n</code></pre>\n\n<p>I've highlighted the line with (*). I have doubts why <code>get</code> function can be called. I know that <code>get</code> is function from <code>State</code> monad but I cannot see/grasp how it is known that there is such monad in fact. I see that returned type is PMO but it is just returned value. What does it has in common with <code>get</code>? </p>\n\n<p>Mainly, I have an experience with imperative language programming so it makes me trouble to understand it. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "edited": false, "score": 2, "creation_date": 1477685633, "post_id": 40312514, "comment_id": 67882307, "body": "You don&#39;t use parentheses to call functions in Haskell, simply put a space between the function name and its argument. Also, there are no nullary functions in Haskell, a function has to have at least one parameter. Other than that, put your equations one beneath the other (aligned) and it will work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477694403, "post_id": 40312514, "comment_id": 67885466, "body": "The code you posted seems to be meaningless. You should add some informal description about what you are actually trying to achieve."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1477686612, "creation_date": 1477686612, "answer_id": 40312797, "question_id": 40312514, "link": "https://stackoverflow.com/questions/40312514/function-result-as-parameter-to-another-function-in-where/40312797#40312797", "title": "Function result as parameter to another function in where", "body": "<p>something like this?</p>\n\n<pre><code>&gt; let b = goo a\n|       where goo f = sum . map f\n|             a = \\x -&gt; x * x\n|\n&gt; b [1..3]\n14\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": true, "score": 1, "last_activity_date": 1527764330, "last_edit_date": 1527764330, "creation_date": 1477695910, "answer_id": 40314360, "question_id": 40312514, "link": "https://stackoverflow.com/questions/40312514/function-result-as-parameter-to-another-function-in-where/40314360#40314360", "title": "Function result as parameter to another function in where", "body": "<p>First you wouldn't call a function like a method in OO languages <strong>()</strong> &lt;- this is not a valid call. But anyway, your question is vague and not very descriptive so I am giving you this answer based mainly on assumption. Calling <strong>b</strong> is simply done by:</p>\n\n<pre><code>where b = goo a\n      a = foo\n</code></pre>\n"}], "owner": {"reputation": 661, "user_id": 2577617, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d29a361a351417ab00ff65ac317f1eb3?s=128&d=identicon&r=PG", "display_name": "adamhala007", "link": "https://stackoverflow.com/users/2577617/adamhala007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 40314360, "answer_count": 2, "score": -4, "last_activity_date": 1527764330, "creation_date": 1477685295, "question_id": 40312514, "link": "https://stackoverflow.com/questions/40312514/function-result-as-parameter-to-another-function-in-where", "title": "Function result as parameter to another function in where", "body": "<p>I am new to Haskell.\nI would like to ask, how can I do something like this:</p>\n\n<pre><code>where b = goo(a) a = foo()\n</code></pre>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1477684594, "creation_date": 1477684594, "answer_id": 40312373, "question_id": 40312231, "link": "https://stackoverflow.com/questions/40312231/parsing-a-date-form-a-string-of-form-yyyy-mm-dd-in-haskell/40312373#40312373", "title": "Parsing a date form a string of form YYYY-MM-DD in Haskell", "body": "<p><a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Format.html\" rel=\"nofollow\"><code>Data.Time</code></a> provides <code>parseTimeM</code>, which is a bit unwieldy. I might be overlooking a simpler alternative.</p>\n\n<pre><code>&gt; import Data.Time\n&gt; parseTimeM False defaultTimeLocale \"%Y-%m-%d\" \"2016-10-20\" :: Maybe UniversalTime\nJust 2016-10-20 00:00:00\n</code></pre>\n\n<p>The return type is fairly open. You can return the value to any monad; <code>Maybe</code> seemed like a good example to reflect an answer or a failure to parse the string. The type wrapped by <code>Maybe</code> is any instance of the <code>ParseTime</code> typeclass; <code>UniversalTime</code> is defined in the library.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1477684594, "creation_date": 1477683922, "question_id": 40312231, "link": "https://stackoverflow.com/questions/40312231/parsing-a-date-form-a-string-of-form-yyyy-mm-dd-in-haskell", "title": "Parsing a date form a string of form YYYY-MM-DD in Haskell", "body": "<p>Is there a way in Haskell to parse a date from a string of format \"YYYY-MM-DD\"? That is, something like <code>parseDateFromString 2016-10-20</code> that would then return a date in some commonly used Haskell date format.</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1477681793, "post_id": 40311741, "comment_id": 67880642, "body": "What are <code>x</code> and <code>y</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1477681861, "post_id": 40311741, "comment_id": 67880672, "body": "Are you asking for <code>read</code>?"}, {"owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477682268, "post_id": 40311741, "comment_id": 67880824, "body": "x and y are types i have definced myself.  Read is only for converting a string of numbers to int isn&#39;t it?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477682345, "post_id": 40311741, "comment_id": 67880849, "body": "Your input string references variable names?"}, {"owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477682606, "post_id": 40311741, "comment_id": 67880973, "body": "The input string is in form [((Int,Int), Animal)] where Animal = Dog | Cat, so no references to variable names, only type."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477683594, "post_id": 40312092, "comment_id": 67881438, "body": "Thank you so much! Worked perfectly! Hours of googling, yet the solution is so simple... Thanks again!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1477683325, "creation_date": 1477683325, "answer_id": 40312092, "question_id": 40311741, "link": "https://stackoverflow.com/questions/40311741/haskell-convert-input-string-directly-to-list/40312092#40312092", "title": "Haskell: Convert input string directly to list", "body": "<p>You just need to define a <code>Read</code> instance for your type.</p>\n\n<pre><code>&gt; data Animal = Dog | Cat deriving (Read, Show)\n&gt; read \"[((1,2),Dog),((3,2),Cat)]\" :: [((Int, Int), Animal)]\n[((1,2),Dog),((3,2),Cat)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477683855, "post_id": 40312146, "comment_id": 67881559, "body": "Thanks! Should I specify the type annotation even if it works, or is it mostly for safety/prevents errors in the future?"}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "reply_to_user": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477684522, "post_id": 40312146, "comment_id": 67881862, "body": "Look at the type of <code>read</code>: <code>read :: Read a =&gt; String -&gt; a</code>. If you constrain the type variable <code>a</code> so that it is completely unambiguous (by using the result of <code>read</code> in a context which makes the type clear), then the compiler will know which <code>Read</code> instances to use and you won&#39;t need to add an annotation. In other cases, like my code above, it&#39;ll complain that a type variable is ambiguous."}, {"owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "edited": false, "score": 0, "creation_date": 1477730986, "post_id": 40312146, "comment_id": 67891389, "body": "Okay! Thank you"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 2, "last_activity_date": 1477683517, "creation_date": 1477683517, "answer_id": 40312146, "question_id": 40311741, "link": "https://stackoverflow.com/questions/40311741/haskell-convert-input-string-directly-to-list/40312146#40312146", "title": "Haskell: Convert input string directly to list", "body": "<p>As mentioned, you can use <code>read</code> to convert your <code>String</code> into a value of type <code>[((Int, Int), Animal)]</code>, provided <code>Animal</code> is an instance of <code>Read</code>. The instance can be derived automatically:</p>\n\n<pre><code>data Animal = Dog | Cat deriving (Show, Read)\n</code></pre>\n\n<p>Another potential pitfall is that you should specify the type annotation explicitly so <code>read</code> knows what to parse for:</p>\n\n<pre><code>main :: IO ()\nmain =\n    do let list = read \"[((1,2),Dog),((3,2),Cat)]\" :: [((Int, Int), Animal)]\n        animals = map snd list\n    print animals\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>$ runhaskell test.hs\n[Dog,Cat]\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 5331575, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SGm_bmDhEsE/AAAAAAAAAAI/AAAAAAAAADc/ZfKKEuvQWWo/photo.jpg?sz=128", "display_name": "Sebastian Paulsen", "link": "https://stackoverflow.com/users/5331575/sebastian-paulsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 40312092, "answer_count": 2, "score": 3, "last_activity_date": 1477683958, "creation_date": 1477681714, "last_edit_date": 1477683273, "question_id": 40311741, "link": "https://stackoverflow.com/questions/40311741/haskell-convert-input-string-directly-to-list", "title": "Haskell: Convert input string directly to list", "body": "<p>Is there any way to convert an input string directly to a list?</p>\n\n<p>The input string is already in the form of a list e.g.:</p>\n\n<pre><code>[((1,2),x),((3,2),y)]\n</code></pre>\n\n<p>I just want to convert it to <code>[((1,2),x),((3,2),y)]</code> which can be used in another function without having to through the string to get all the values and then make an identical list. </p>\n\n<p>Is this possible? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477680454, "post_id": 40311398, "comment_id": 67879912, "body": "Try <code>group &quot;aaaabbbcc&quot;</code>, after importing <code>Data.List</code>"}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477680939, "post_id": 40311398, "comment_id": 67880185, "body": "@chi I&#39;ve updated the question, this better reflects my problem! group would be ideal if I could pass a custom grouping condition to it"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1477681290, "post_id": 40311398, "comment_id": 67880374, "body": "Description doesn&#39;t match the code.  Where are the contiguous <code>a</code>s?  If you want to split on <code>...</code> check Data.List.Split.splitOn."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477682481, "post_id": 40311398, "comment_id": 67880915, "body": "@BabraCunningham Did you see <code>groupBy</code>, which is parametric on the condition?"}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477686430, "post_id": 40311398, "comment_id": 67882653, "body": "@chi thank you again, solution found using groupBy!"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1477680902, "creation_date": 1477680372, "last_edit_date": 1477680902, "question_id": 40311398, "link": "https://stackoverflow.com/questions/40311398/creating-lists-of-contiguous-characters", "title": "Creating lists of contiguous characters?", "body": "<p>Basic question, but I can't seem to get a solution that works.</p>\n\n<p>I have the following [Char]: </p>\n\n<pre><code>\"cdea...x...pwpee\"\n</code></pre>\n\n<p>and I wish to covert this to [[Char]]:</p>\n\n<pre><code>[[cdea], [x], [pwpee]] --create a lists of contiguous a's\n</code></pre>\n\n<p>My current solution only manages to get the first three a's:</p>\n\n<pre><code>myFunction :: [Char] -&gt; [[Char]]\nmyFunction (x : xs)\n  | x == 'a' = [x] : myFunction xs\n  | otherwise = [] \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[c,d,e,a]\n</code></pre>\n\n<p>Is there an obvious solution to get the result I intend? </p>\n"}, {"tags": ["haskell", "opengl", "nixos"], "comments": [{"owner": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "edited": false, "score": 1, "creation_date": 1484133212, "post_id": 40310973, "comment_id": 70382206, "body": "See my <a href=\"http://stackoverflow.com/questions/41527061/nixos-haskell-opengl-problems-with-building-and-running-opengl-programs/41588628#41588628\">answer</a> on a similar question."}], "answers": [{"comments": [{"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 1, "creation_date": 1511974835, "post_id": 40317723, "comment_id": 82073530, "body": "nixos does not use the LSB filesystem hierarchy. That&#39;s the whole point of the question."}, {"owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "reply_to_user": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1511987313, "post_id": 40317723, "comment_id": 82080158, "body": "@Turion: I was not referring to the LSB filesystem hierachy, but the requirements of the LSB set on which <b>libraries</b> must be available <b>by name</b> if it&#39;s a desktop environment <a href=\"http://refspecs.linuxfoundation.org/LSB_5.0.0/LSB-Desktop-generic/LSB-Desktop-generic/opengllib.html\" rel=\"nofollow noreferrer\">refspecs.linuxfoundation.org/LSB_5.0.0/LSB-Desktop-generic/&hellip;</a> \u2013 take note that only the basename of the library is specified, but not where it&#39;s located in the filesystem tree. BTW: I&#39;m close friends with some of the NixOS devs and enjoy technical discussions with them (also about Nix)."}], "tags": [], "owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "is_accepted": false, "score": -1, "last_activity_date": 1477733376, "creation_date": 1477733376, "answer_id": 40317723, "question_id": 40310973, "link": "https://stackoverflow.com/questions/40310973/nixos-haskell-opengl-prerequisites/40317723#40317723", "title": "nixos + haskell + opengl (prerequisites)", "body": "<p>On Linux (Nix is a Linux distribution) the LSB specifies that <code>libGL</code> is part of the desktop profile. That means having at least the X11 client libraries installed. <code>libGL</code> is a bit special though and is permitted to be overridden by the graphics driver installation.</p>\n\n<p>What this boils down to is: Install the graphics drivers for your GPU. If you're using an Intel or a AMD GPU install the Mesa drivers. If your system has a NVidia GPU I recommend the proprietary NVidia drivers.</p>\n"}, {"tags": [], "owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "is_accepted": false, "score": -1, "last_activity_date": 1538037636, "last_edit_date": 1538037636, "creation_date": 1512243895, "answer_id": 47611846, "question_id": 40310973, "link": "https://stackoverflow.com/questions/40310973/nixos-haskell-opengl-prerequisites/47611846#47611846", "title": "nixos + haskell + opengl (prerequisites)", "body": "<p>In nixos, libraries aren't usually available on the path where <code>cabal</code> expects them to be. Try the following:</p>\n\n<p><code>nix-shell -p libGL libGLU freeglut\ncabal install GLUT\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 1, "last_activity_date": 1514449524, "creation_date": 1514449524, "answer_id": 48004084, "question_id": 40310973, "link": "https://stackoverflow.com/questions/40310973/nixos-haskell-opengl-prerequisites/48004084#48004084", "title": "nixos + haskell + opengl (prerequisites)", "body": "<p>If you want to use <code>nix-shell</code>:</p>\n\n<pre><code>$ nix-shell -p 'haskellPackages.ghcWithPackages (p: [ p.GLUT ])'\n</code></pre>\n\n<p>will give you a shell with <code>ghc</code> that know <code>GLUT</code></p>\n\n<p>I've try with this code (from the wiki <a href=\"https://wiki.haskell.org/OpenGLTutorial1\" rel=\"nofollow noreferrer\">page</a> you mentioned)</p>\n\n<pre><code>import Graphics.UI.GLUT\n\nmain :: IO ()\nmain = do\n  (_progName, _args) &lt;- getArgsAndInitialize\n  _window &lt;- createWindow \"Hello World\"\n  displayCallback $= display\n  mainLoop\n\ndisplay :: DisplayCallback\ndisplay = do\n  clear [ ColorBuffer ]\n  flush\n</code></pre>\n\n<hr>\n\n<p>But the more preferable way is to create <code>shell.nix</code> so you don't need to remember it. To use <code>shell.nix</code>, just call <code>nix-shell</code> without argument in the directory where it is or <code>nix-shell /path/to/shell.nix</code> anywhere.</p>\n\n<p><code>shell.nix</code> adopted from the <a href=\"https://nixos.org/nixpkgs/manual/#how-to-create-ad-hoc-environments-for-nix-shell\" rel=\"nofollow noreferrer\">manual</a></p>\n\n<pre><code>{ nixpkgs ? import &lt;nixpkgs&gt; {} }:\nwith nixpkgs;\nlet\n  ghc = haskellPackages.ghcWithPackages (ps: with ps; [\n          GLUT\n        ]);\nin\nstdenv.mkDerivation {\n  name = \"my-haskell-env\";\n  buildInputs = [ ghc ];\n  shellHook = \"eval $(egrep ^export ${ghc}/bin/ghc)\";\n}\n</code></pre>\n\n<hr>\n\n<p>For a bigger project you might want to use <code>cabal</code> or <code>stack</code> but I think that would be another story.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1538037636, "creation_date": 1477678628, "question_id": 40310973, "link": "https://stackoverflow.com/questions/40310973/nixos-haskell-opengl-prerequisites", "title": "nixos + haskell + opengl (prerequisites)", "body": "<p>Unfortunately, I'm not getting a simple example program from <a href=\"https://wiki.haskell.org/OpenGLTutorial1\" rel=\"nofollow\">this</a> open gl tutorial to work.</p>\n\n<pre><code>ghc --make gfx.hs\nCould not find module \u2018Graphics.UI.GLUT\u2019\n[..]\n</code></pre>\n\n<p>Then I tried the following:</p>\n\n<pre><code>cabal install GLUT\n\nWarning: The package list for 'hackage.haskell.org' is 44.1 days old.\nRun 'cabal update' to get the latest list of available packages.\nResolving dependencies...\nConfiguring OpenGLRaw-3.2.2.0...\nFailed to install OpenGLRaw-3.2.2.0\nBuild log ( /home/m/.cabal/logs/OpenGLRaw-3.2.2.0.log ):\nConfiguring OpenGLRaw-3.2.2.0...\nsetup-Simple-Cabal-1.22.5.0-x86_64-linux-ghc-7.10.3: Missing dependency on a\nforeign library:\n* Missing C library: GL\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.\ncabal: Error: some packages failed to install:\nGLURaw-2.0.0.2 depends on OpenGLRaw-3.2.2.0 which failed to install.\nGLUT-2.7.0.10 depends on OpenGLRaw-3.2.2.0 which failed to install.\nOpenGL-3.0.1.0 depends on OpenGLRaw-3.2.2.0 which failed to install.\nOpenGLRaw-3.2.2.0 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>It looks like the missing C library is the problem. I'm using nixOS, does anybody know which steps I'd have to do in order to get this running?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1477681264, "post_id": 40310960, "comment_id": 67880356, "body": "This question is very broad. Please give some actual code and a description of the problem"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1477681588, "last_edit_date": 1477681588, "creation_date": 1477681260, "answer_id": 40311627, "question_id": 40310960, "link": "https://stackoverflow.com/questions/40310960/loading-shell-script-files-to-access-their-functions-in-haskell/40311627#40311627", "title": "Loading Shell Script Files to Access Their Functions In Haskell", "body": "<p>If you have a shell script like</p>\n\n<pre><code>#!/bin/bash\n\nfoo() {\n    echo \"foo\"\n}\n</code></pre>\n\n<p>you can use the <a href=\"http://hackage.haskell.org/package/process-1.4.2.0/docs/System-Process.html#v:readCreateProcess\" rel=\"nofollow\"><code>readCreateProcess</code></a> function from the <em>process</em> package to source the script and execute the function in one go, like this:</p>\n\n<pre><code>module Main where\n\nimport System.Process\n\nmain :: IO ()\nmain = do\n    -- I had to put the full path of the script for it to work\n    result &lt;- readCreateProcess ((shell \". /tmp/foo.sh &amp;&amp; foo\")) \"\"\n    print result\n</code></pre>\n\n<p>This solution assumes that the script only does things like defining functions and setting environment variables, without running undesired \"effectful\" code each time it is sourced.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 40311627, "answer_count": 1, "score": 1, "last_activity_date": 1477681588, "creation_date": 1477678561, "last_edit_date": 1477680891, "question_id": 40310960, "link": "https://stackoverflow.com/questions/40310960/loading-shell-script-files-to-access-their-functions-in-haskell", "title": "Loading Shell Script Files to Access Their Functions In Haskell", "body": "<p>I have a shell script file named <code>/path/to/shell_script.sh</code> which contains a function defintion <code>shell_function() { ...}</code>.</p>\n\n<p>I'd like to be able to do something in Haskell like <code>readProcessWithExitCode shell_function [] \"\"</code> to eventually get a hold of an <code>IO (String)</code>.</p>\n\n<p>How to do this?</p>\n"}, {"tags": ["haskell", "haskell-platform", "nix", "nixos"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477692561, "post_id": 40310403, "comment_id": 67884886, "body": "<a href=\"http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure\" rel=\"nofollow noreferrer\">User\u2019s Guide to the Haskell Infrastructure</a> sounds relevant."}, {"owner": {"reputation": 2373, "user_id": 3335288, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qfxhh.jpg?s=128&g=1", "display_name": "Zimm i48", "link": "https://stackoverflow.com/users/3335288/zimm-i48"}, "edited": false, "score": 0, "creation_date": 1477845067, "post_id": 40310403, "comment_id": 67917225, "body": "Have you tried <code>nix-env -iA nixos.ghc</code>? What are you missing?"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1484259516, "creation_date": 1484259516, "answer_id": 41624029, "question_id": 40310403, "link": "https://stackoverflow.com/questions/40310403/install-haskell-platform-on-nixos/41624029#41624029", "title": "install haskell-platform on nixOS", "body": "<p>The philosophy of the nix packagers is not to assemble the platform packages and tools together, but that it is more \"nixy\" to just provide a the various ghc compiler versions and tools individually in a standard nix way. Since nix also handles haskell package management for you, the platform approach indeed just provides friction in this case, and you're better off following the User's Guide to Haskell Infrastructure from nix as linked above.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1484259516, "creation_date": 1477676094, "question_id": 40310403, "link": "https://stackoverflow.com/questions/40310403/install-haskell-platform-on-nixos", "title": "install haskell-platform on nixOS", "body": "<p>It's said to be a good starting point for haskell-beginners: the haskell platform. unfortunately, it looks like it's been removed from the nix-os package manager.</p>\n\n<p>What would be the preferred way to quickly get this up and running on a nix-os system?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1477673575, "post_id": 40309557, "comment_id": 67876592, "body": "It looks like the type error is coming from the <code>domain</code> function. The type checker is deducing <code>m ~ IO</code>, for some reason. Can you show us the code for your refactored <code>domain</code> function? The version which calls <code>helper</code>."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1477674123, "post_id": 40309557, "comment_id": 67876863, "body": "thank you, updated to include refactored version."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1477680142, "post_id": 40309557, "comment_id": 67879747, "body": "Lose the <code>liftIO $ runExceptT</code> and the <code>case</code> expression."}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "edited": false, "score": 0, "creation_date": 1477705804, "post_id": 40309557, "comment_id": 67887614, "body": "You might want to take a look at <code>servant-client</code> 0.9.*. It wraps up the manager and base url in a <code>Reader</code>. That might suffice by itself, but if not, it allows you to use <code>enter</code> to change the monad easily."}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1477684719, "creation_date": 1477672930, "last_edit_date": 1477684719, "question_id": 40309557, "link": "https://stackoverflow.com/questions/40309557/how-to-perform-this-refactoring-in-haskell", "title": "How to perform this refactoring in Haskell?", "body": "<p>I'm working with functions generated by <code>servant-client</code> and trying to wrap them in a custom monad. I have a function generated by <code>servant-client</code> with the following signature:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>getDomain\n    :: AuthenticateReq (AuthProtect \"x-api-key\")\n    -&gt; Maybe Int\n    -&gt; Maybe Int\n    -&gt; Manager\n    -&gt; BaseUrl\n    -&gt; ExceptT ServantError IO Domain\n</code></pre>\n\n<p>and a following wrapper around it:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>domain\n  :: (MonadReader Env m, MonadIO m, MonadThrow m, MonadError ServantError m)\n  =&gt; Int -&gt; m (Domain)\ndomain domId = do\n  auth &lt;- mkAuth\n  manager &lt;- asks envManager\n  url &lt;- asks envBaseUrl\n  baseUrl &lt;- parseBaseUrl url\n  r &lt;-\n    liftIO $ runExceptT $ getDomain auth (Just domId) Nothing manager baseUrl\n  case r of\n    Left e -&gt; throwError e\n    Right x -&gt; return x\n</code></pre>\n\n<p>As I will have a number of such functions and wrappers I would like to extract a helper function which would:</p>\n\n<ul>\n<li>take a servant-generated function applied to all but last two arguments</li>\n<li>using MonadReader grab manager and baseUrl, feed it to the servant function and return it fully applied</li>\n</ul>\n\n<p>My attempt so far looks as follows:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>helper\n  :: (Monad m, MonadIO m, MonadReader Env m, MonadThrow m)\n  =&gt; (Manager -&gt; BaseUrl -&gt; m b) -&gt; m b\nhelper f =  do\n  manager &lt;- asks envManager\n  url &lt;- asks envBaseUrl\n  baseUrl &lt;- parseBaseUrl url\n  f manager baseUrl\n</code></pre>\n\n<p>but unfortunately it doesn't compile due to following error:</p>\n\n<pre><code>Could not deduce (MonadReader Env IO)\n  arising from a use of \u2018helper\u2019\nfrom the context (MonadReader Env m,\n                  MonadIO m,\n                  MonadThrow m,\n                  MonadError ServantError m)\n  bound by the type signature for\n             domain :: (MonadReader Env m, MonadIO m, MonadThrow m,\n                        MonadError ServantError m) =&gt;\n                       Int -&gt; m Domain\n</code></pre>\n\n<p>and I don't understand why the compiler is infering MonadReader Env IO constraint. I would like to know why that's happening and what would be proper way to do this refactoring if it is possible at all. Would I need to make any changes to the <code>domain</code> function itself to accommodate this change?</p>\n\n<p><hr />\n<strong>UPDATE:</strong></p>\n\n<p>refactored version of <code>domain</code> is below:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>domain\n  :: (MonadReader Env m, MonadIO m, MonadThrow m, MonadError ServantError m)\n  =&gt; Int -&gt; m (Domain)\ndomain domId = do\n  auth &lt;- mkAuth\n  r &lt;-\n    liftIO $ runExceptT $ helper $ getDomain auth (Just domId) Nothing\n  case r of\n    Left e -&gt; throwError e\n    Right x -&gt; return x\n</code></pre>\n\n<hr />\n\n<p><strong>UPDATE 2:</strong></p>\n\n<p>I have now arrived at a solution that:</p>\n\n<ul>\n<li>appears to compile and work</li>\n<li>I admit I don't really understand</li>\n</ul>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>domain\n  :: (MonadReader Env m, MonadIO m, MonadThrow m, MonadError ServantError m)\n  =&gt; Int -&gt; m (Domain)\ndomain domId = do\n  auth &lt;- mkAuth\n  helper $ getDomain auth (Just domId) Nothing\n\nhelper\n  :: (MonadReader Env m, MonadIO m, MonadError e m)\n  =&gt; (Manager -&gt; BaseUrl -&gt; ExceptT e IO b) -&gt; m b\nhelper f = do\n  env &lt;- ask\n  r &lt;- liftIO $ runExceptT $ runReaderT (helper1 f) env\n  case r of\n    Left e -&gt; throwError e\n    Right x -&gt; return x\n\n-- based on\n-- https://github.com/passy/giphy-api/blob/4b006db2fe566b7200f6c81b8c56cabe2a595b90/src/Web/Giphy.hs#L359\nhelper1\n  :: (Monad m, MonadTrans t, MonadThrow (t m), MonadReader Env (t m))\n  =&gt; (Manager -&gt; BaseUrl -&gt; m b) -&gt; t m b\nhelper1 f = do\n  manager &lt;- asks envManager\n  url &lt;- asks envBaseUrl\n  baseUrl &lt;- parseBaseUrl url\n  lift $ f manager baseUrl\n</code></pre>\n\n<p>It would also be nice to merge <code>helper</code> and <code>helper1</code> into a single function which so far I haven't been successful with. I'm still unclear on the original problem but I would assume it's something to do with <code>getDomain</code> explicitly using <code>IO</code> as the base monad.</p>\n\n<p>Dropping <code>liftIO $ runExceptT</code> and the <code>case</code> expression as suggested by Benjamin</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>domain\n  :: (MonadReader Env m, MonadIO m, MonadThrow m, MonadError ServantError m)\n  =&gt; Int -&gt; m (Domain)\ndomain domId = do\n  auth &lt;- mkAuth\n  helper $ getDomain auth (Just domId) Nothing\n\nhelper\n  :: (Monad m, MonadIO m, MonadReader Env m, MonadThrow m)\n  =&gt; (Manager -&gt; BaseUrl -&gt; m b) -&gt; m b\nhelper f =  do\n  manager &lt;- asks envManager\n  url &lt;- asks envBaseUrl\n  baseUrl &lt;- parseBaseUrl url\n  f manager baseUrl\n</code></pre>\n\n<p>resulted in the following error:</p>\n\n<pre><code>Couldn't match type \u2018m\u2019 with \u2018ExceptT ServantError IO\u2019\n  \u2018m\u2019 is a rigid type variable bound by\n      the type signature for\n        domain :: (MonadReader Env m, MonadIO m, MonadThrow m,\n                    MonadError ServantError m) =&gt;\n                   Int -&gt; m Domain\n      at &lt;path&gt;\nExpected type: m Domain\n  Actual type: ExceptT ServantError IO Domain\nRelevant bindings include\n  domain :: Int -&gt; m Domain\n    (bound at &lt;path&gt;)\nIn a stmt of a 'do' block:\n  helper $ getDomain auth (Just domId) Nothing\nIn the expression:\n  do { auth &lt;- mkAuth;\n       helper $ getDomain auth (Just domId) Nothing }\nIn an equation for \u2018domain\u2019:\n    domain domId\n      = do { auth &lt;- mkAuth;\n             helper $ getDomain auth (Just domId) Nothing }\n</code></pre>\n\n<p>even when using type holes would indicate the return value to be of correct type:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>domain\n  :: (MonadReader Env m, MonadIO m, MonadThrow m, MonadError ServantError m)\n  =&gt; Int -&gt; m (Domain)\ndomain domId = do\n  auth &lt;- mkAuth\n  x &lt;- helper $ getDomain auth (Just domId) Nothing\n  return _\n\nhelper\n  :: (Monad m, MonadIO m, MonadReader Env m, MonadThrow m)\n  =&gt; (Manager -&gt; BaseUrl -&gt; m b) -&gt; m b\nhelper f =  do\n  manager &lt;- asks envManager\n  url &lt;- asks envBaseUrl\n  baseUrl &lt;- parseBaseUrl url\n  f manager baseUrl\n</code></pre>\n\n<p>error:</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: Domain\nRelevant bindings include\n  x :: Domain (bound at &lt;path&gt;)\n  auth :: AuthenticateReq (AuthProtect \"x-api-key\")\n    (bound at &lt;path&gt;)\n  domId :: Int (bound at &lt;path&gt;)\n  domain :: Int -&gt; m Domain\n    (bound at &lt;path&gt;)\nIn the first argument of \u2018return\u2019, namely \u2018_\u2019\nIn a stmt of a 'do' block: return _\nIn the expression:\n  do { auth &lt;- mkAuth;\n       x &lt;- helper $ getDomain auth (Just domId) Nothing;\n       return _ }\n</code></pre>\n"}, {"tags": ["haskell", "repa"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1477674197, "post_id": 40309501, "comment_id": 67876907, "body": "This sort of goes against the point of <code>repa</code> (that isn&#39;t to say this isn&#39;t possible though). <code>repa</code> is all about parallelizing computation on arrays of different shapes. <code>IO</code>, however, is sequential by nature. Also, <code>traverse</code> does not mean the same thing as <code>Data.Traversable.traverse</code>..."}, {"owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1477674639, "post_id": 40309501, "comment_id": 67877190, "body": "in my actual code it says Data.Array.Repa.traverse, but thanks, that was a headache for a bit.  Let me know if this makes sense, i want parallelization on each frame of GL drawing, so that, even thought each frame is sequential, the drawing of all of the individual components of each frame are parallel.  thanks for the quick reply"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1477676022, "post_id": 40309501, "comment_id": 67877861, "body": "If each of the individual components can be drawn independently, you could try to make <code>drawTile</code> pure, then fold over the array to combine the pure components, and finally actually draw to screen."}, {"owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1477676614, "post_id": 40309501, "comment_id": 67878134, "body": "are you saying that i can create pure functions beforehand, compose them together, and they wont execute until i call them in main?"}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "is_accepted": true, "score": 1, "last_activity_date": 1477829312, "creation_date": 1477829312, "answer_id": 40328875, "question_id": 40309501, "link": "https://stackoverflow.com/questions/40309501/haskell-repa-traversing-a-2d-array/40328875#40328875", "title": "Haskell Repa - traversing a 2D array", "body": "<p>i did what user alec suggested and returned a list of IO then sequenced them all together using the following function:</p>\n\n<pre><code>resequence_ :: [IO ()] -&gt; IO ()\nresequence_ = foldr (&gt;&gt;) (return ())\n</code></pre>\n\n<p>thanks again for the help.  for future reference, i was mistakenly passing around IO, and the problem wasnt with repa.</p>\n"}], "owner": {"reputation": 33, "user_id": 7086288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J1P1Z.gif?s=128&g=1", "display_name": "Vince Moosetaffy", "link": "https://stackoverflow.com/users/7086288/vince-moosetaffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 1, "accepted_answer_id": 40328875, "answer_count": 1, "score": 1, "last_activity_date": 1477829312, "creation_date": 1477672746, "question_id": 40309501, "link": "https://stackoverflow.com/questions/40309501/haskell-repa-traversing-a-2d-array", "title": "Haskell Repa - traversing a 2D array", "body": "<p>I am trying to traverse a 2D array i created using repa, so far i have the function that gets called on every element, but i dont understand what fundamental concept exists that wont let me execute expressions inside that function, what i have so far is as follows:</p>\n\n<pre><code> drawTile ::(DIM2 -&gt; Int) -&gt; DIM2 -&gt; Int\n drawTile f (Z :. i :. j) = do\n   &lt;this is where i want to do some IO&gt;\n\n drawScene :: [GLuint] -&gt; Array U DIM2 Int -&gt; GLFW.Window -&gt; IO()\n drawScene texs map win = do\n   x &lt;- computeP $(traverse map id drawTile)::IO (Array UDIM2 Int)\n   return ()\n</code></pre>\n\n<p>You can ignore the stuff about textures and OpenGL, this is going to be a game.  i get compile errors when i try and use a function with side effects in the drawTile function.  how do i execute some sort of expression (print \"hello\" for example), where I want? is there some other easier way to apply a function to each element in a repa array?</p>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1477670346, "post_id": 40308729, "comment_id": 67875011, "body": "What should happen in your example if there are less than 2 occurrences of <code>-</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1477681810, "last_edit_date": 1477681810, "creation_date": 1477671444, "answer_id": 40309161, "question_id": 40308729, "link": "https://stackoverflow.com/questions/40308729/deleting-every-character-after-the-nth-occurence-of-a-character-in-haskell/40309161#40309161", "title": "Deleting every character after the nth occurence of a character in Haskell", "body": "<p>There's no convenient <code>split</code> function in the standard library, so you essentially have to roll your own. One approach:</p>\n\n<pre><code>dropAfter :: Int -&gt; Char -&gt; String -&gt; String\n\ndropAfter _ _ \"\" = \"\"\ndropAfter 0 d (x:xs) = \"\"\ndropAfter 1 d (x:xs) | x == d = \"\"\ndropAfter n d (x:xs) | x == d = x : dropAfter (n-1) d xs\n                     | otherwise = x : dropAfter n d xs\n</code></pre>\n\n<p>The <code>split</code> package, though, does provide <code>splitOn :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]</code>:</p>\n\n<pre><code>import Data.List.Split (splitOn)\nimport Data.List (intercalate)\ndropAfter n d = intercalate [d] . take n . splitOn [d]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1477680231, "post_id": 40310295, "comment_id": 67879797, "body": "why <code>(`seq` [])</code> rather than <code>const []</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1477680501, "post_id": 40310295, "comment_id": 67879934, "body": "@rampion, it&#39;s my habit to help out strictness analysis (and therefore unboxing) when I can. That <code>seq</code> ensures that the value of the updated accumulator is always demanded. It may not be necessary in this case, but I have seen similar forms with <code>const</code> go funny once they end up in a sufficiently complicated context."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1477679253, "last_edit_date": 1477679253, "creation_date": 1477675715, "answer_id": 40310295, "question_id": 40308729, "link": "https://stackoverflow.com/questions/40308729/deleting-every-character-after-the-nth-occurence-of-a-character-in-haskell/40310295#40310295", "title": "Deleting every character after the nth occurence of a character in Haskell", "body": "<p>The fold fiend strikes again.</p>\n\n<pre><code>dropAfter :: Int -&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]\ndropAfter n _ _ | n &lt; 1 = []\ndropAfter n f xs = foldr go (`seq` []) xs n where\n  go x r !k\n    | f x = if k == 1 then [] else x : r (k - 1)\n    | otherwise = x : r k\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1477675723, "creation_date": 1477675723, "answer_id": 40310296, "question_id": 40308729, "link": "https://stackoverflow.com/questions/40308729/deleting-every-character-after-the-nth-occurence-of-a-character-in-haskell/40310296#40310296", "title": "Deleting every character after the nth occurence of a character in Haskell", "body": "<p>Alternately, you could use this as a stepping stone to start using parsers:</p>\n\n<pre><code>\u03bb import Text.Parsec\n\u03bb runParser (many (noneOf \"-\") `sepBy` char '-') () \"example from question\" \"2016-01-43\"\nRight [\"2016\",\"01\",\"43\"]\n\u03bb import Data.List\n\u03bb intercalate \"-\" . take 2 &lt;$&gt; it\nRight \"2016-01\"\n</code></pre>\n\n<p>The nice thing about making the switch now is that, as you learn more about your input (and what it can and can't look like), it's fairly easy to update a parser to match, where using a custom function can get real hinky real fast.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1477681810, "creation_date": 1477669738, "question_id": 40308729, "link": "https://stackoverflow.com/questions/40308729/deleting-every-character-after-the-nth-occurence-of-a-character-in-haskell", "title": "Deleting every character after the nth occurence of a character in Haskell", "body": "<p>For a string <code>str</code>, how does one delete every character after the <code>n</code>th occurence of the character <code>c</code>?</p>\n\n<p>For example, if <code>str</code> is <code>\"2016-10-20\"</code>, how could one delete every character after the 2nd occurrence of the character <code>-</code>, yielding <code>\"2016-10\"</code>?</p>\n"}, {"tags": ["haskell", "random", "particles", "gloss"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1477668094, "post_id": 40308161, "comment_id": 67873693, "body": "Remember that all Haskell functions are <i>pure</i>. With this in mind, how can <code>randomFloat :: StdGen -&gt; Float -&gt; Float -&gt; Float</code> be expected to give different results from call to call?"}, {"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1477668421, "post_id": 40308161, "comment_id": 67873922, "body": "I thought it should give different results if it&#39;s being passed a unique generator every call. At least, that&#39;s what Im trying to do.."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1477669179, "post_id": 40308161, "comment_id": 67874380, "body": "You discard the new generator state by discarding the second half of the value returned from <code>randomR</code>."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1477671330, "post_id": 40308553, "comment_id": 67875465, "body": "Thanks for your reply! It makes sense, however, the starfield is still not random. Remarkably, there is a decrease in particle size / speed, from the top of the screen to the bottom... Is this because I&#39;m reusing <code>gen</code> in my <code>spawnParticle</code> function?"}, {"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1477671897, "post_id": 40308553, "comment_id": 67875772, "body": "I should&#39;ve tried it first before asking: I applied the same technique in <code>spawnParticle</code> as you used in <code>timeHandler</code> and it&#39;s working now!"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1477669136, "creation_date": 1477669136, "answer_id": 40308553, "question_id": 40308161, "link": "https://stackoverflow.com/questions/40308161/haskell-gloss-random-starfield-not-random/40308553#40308553", "title": "Haskell Gloss: random starfield not random?", "body": "<p>This is nothing to do with gloss, just with the semantics of pure random number generation. Re-initializing a new generator with a new seed every time does <em>not</em> give you pseudo-random numbers, because the randomness only comes from the fact that the <em>new generator</em> created by e.g. <code>randomR</code> or <code>split</code> will have seeds very different from the original. You simply have <code>map mkStdGen [0..]</code>, as you are simply adding <code>1</code> to <code>timer</code> at each step.</p>\n\n<p>Consider the difference in the following distributions:</p>\n\n<pre><code>map (fst . randomR (1,1000) . mkStdGen) [0..1000]\ntake 1000 $ randomRs (1,1000) (mkStdGen 123)\n</code></pre>\n\n<p>The first is what you are doing, and the second is proper random numbers. </p>\n\n<p>The solution is simple, just use <code>split</code> inside your time update function (you already have it inside of <code>spawnParticle</code>) : </p>\n\n<pre><code>timeHandler dt world = \n  let (newRndGen, g) = split (rndGen world) in \n   world { rndGen = newRndGen \n         , timer  = (timer world) + 1 , \n         , stars  = spawnParticle world g : updateParticles (stars world) dt world\n         }\n</code></pre>\n\n<p>Note that now <code>timer</code> isn't used, and it probably makes more sense to have <code>timer = timer world + dt</code> anyways (the time deltas may not be exactly equal).</p>\n\n<p>Also keep in mind you shouldn't reuse generators, so if you have many local functions which take a generator as a parameter, you may want something like:</p>\n\n<pre><code>timeHandler dt world = \n  let (newRndGen:g0:g1:g2:_) = unfoldr (Just . split) (rndGen world) in \n   world { rndGen = newRndGen \n         , timer  = (timer world) + 1 , \n         , stars  = spawnParticle world g0 : updateParticles (stars world) dt world\n         , stuff0 = randomStuff0 g1 , stuff1 = randomStuff1 g2 }\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 40308553, "answer_count": 1, "score": 1, "last_activity_date": 1477669136, "creation_date": 1477667771, "question_id": 40308161, "link": "https://stackoverflow.com/questions/40308161/haskell-gloss-random-starfield-not-random", "title": "Haskell Gloss: random starfield not random?", "body": "<p>Using Haskell\u2019s Gloss library, I\u2019m trying to simulate a starfield. The visual aspect (drawing \u2018stars\u2019 with various speeds and sizes to the screen) is working. However, for some reason the stars aren\u2019t being randomly distributed, resulting in a simulation which has a pattern. I also have this problem with an explosion simulation, but for simplicity\u2019s sake, I\u2019ll leave that one out for now. This is a simplified version of my code so far:</p>\n\n<pre><code>type Position       = (Float, Float)\ntype Velocity       = (Float, Float)\ntype Size           = Float\ntype Speed          = Float\ntype Drag           = Float\ntype Life           = Int\n\ntype Particle       = (Position, Velocity, Speed, Drag, Life, Size)\n\n-- timeHandler is called every frame by the gloss \u2018Play\u2019 function. It's being passed\n-- the delta time and the world it needs to update.\ntimeHandler dt world = world {rndGen = mkStdGen (timer world),\n                              timer  = (timer world) + 1,\n                              stars  = spawnParticle world (rndGen world) : updateParticles (stars world) dt world}\n\nrandomFloat :: StdGen -&gt; Float -&gt; Float -&gt; Float\nrandomFloat rand min max = fst $ randomR (min, max) rand\n\nspawnParticle :: World -&gt; StdGen -&gt; Particle\nspawnParticle world gen = ((pos, (1 * speed, 0), speed, 1, 0, size), snd (split gen))\nwhere pos   = (px', py')\n      px'   = randomFloat gen (-600) (-500)\n      py'   = randomFloat gen (-250) 250\n      speed = size * (randomFloat gen 100 300) -- the smaller a particle, the slower \n      size  = randomFloat gen 0.1 1.3\n\nupdateParticles :: [Particle] -&gt; Float -&gt; World -&gt; [Particle]\nupdateParticles []     _  _     = []\nupdateParticles (x:xs) dt world | fst(posPart x) &gt; 500 = updateParticles xs dt world\n                                | otherwise            = updatedPart : updateParticles xs dt world\n    where pos'        = updateParticlePosition dt x world\n          updatedPart = (pos', velPart x, speedPart x, 1, 0, sizePart x)\n</code></pre>\n\n<p>Note: <code>velPart</code>, <code>speedPart</code> etc. are functions to get a property out of a given particle. Again, drawing works fine, so I\u2019ll leave that code out. <code>updateParticlePosition</code> simply adds the velocity to the current position of a star.</p>\n\n<p>I think the problem has something to do with the fact that my random generators are not passed properly, but I\u2019m too confused to come up with a solution\u2026 Any help is much appreciated! </p>\n"}, {"tags": ["performance", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1477662441, "post_id": 40306253, "comment_id": 67870110, "body": "There is an additional necessary reason why it doesn&#39;t matter: pattern matching (in GHC) is <a href=\"http://stackoverflow.com/q/9027384/2751851\">constant time in the number of patterns</a>."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 7, "last_activity_date": 1477842477, "last_edit_date": 1477842477, "creation_date": 1477661714, "answer_id": 40306253, "question_id": 40306218, "link": "https://stackoverflow.com/questions/40306218/performance-in-pattern-matching/40306253#40306253", "title": "Performance in pattern matching", "body": "<p>Nope, this offers no performance increase whatsoever. In both cases the compiler has to evaluate the argument to it's WHNF to check whether it's the empty list or not.</p>\n\n<p>Actually, it is pretty likely that this function will be rewritten during compilation an generate code entirely different from what you wrote (assuming you compiled with optimizations).</p>\n\n<p>Looking at the generated core (compiled <em>without</em> optimizations):</p>\n\n<pre><code>(letrec {\n   f1_aLn [Occ=LoopBreaker] :: [Integer] -&gt; Integer\n   [LclId, Arity=1, Str=DmdType]\n   f1_aLn =\n     \\ (ds_d1gX :: [Integer]) -&gt;\n       case ds_d1gX of _ [Occ=Dead] {\n         [] -&gt; fromInteger @ Integer GHC.Num.$fNumInteger 0;\n         : ds1_d1h4 xs_at0 -&gt;\n           + @ Integer\n             GHC.Num.$fNumInteger\n             (fromInteger @ Integer GHC.Num.$fNumInteger 1)\n             (f1_aLn xs_at0)\n       }; } in\nf1_aLn (enumFromTo @ Integer GHC.Enum.$fEnumInteger 1 100))\n\n(letrec {\n   f2_aBk [Occ=LoopBreaker] :: [Integer] -&gt; Integer\n   [LclId, Arity=1, Str=DmdType]\n   f2_aBk =\n     \\ (ds_d1gP :: [Integer]) -&gt;\n       case ds_d1gP of _ [Occ=Dead] {\n         [] -&gt; fromInteger @ Integer GHC.Num.$fNumInteger 0;\n         : ds1_d1gW xs_aBh -&gt;\n           + @ Integer\n             GHC.Num.$fNumInteger\n             (fromInteger @ Integer GHC.Num.$fNumInteger 1)\n             (f2_aBk xs_aBh)\n       }; } in\nf2_aBk (enumFromTo @ Integer GHC.Enum.$fEnumInteger 1 100))\n</code></pre>\n\n<p>We can see that the compiler generates equivalent statements. Just fyi, this was the code:</p>\n\n<pre><code>main = do\n         print $ f1 [1..100]\n         print $ f2 [1..100]\n\nf1 [] = 0\nf1 (_:xs) = 1 + f1 xs\nf2 (_:xs) = 1 + f2 xs\nf2 [] = 0\n</code></pre>\n\n<p>compiled with <code>ghc -ddump-simpl file.hs</code></p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1477662604, "creation_date": 1477662604, "answer_id": 40306524, "question_id": 40306218, "link": "https://stackoverflow.com/questions/40306218/performance-in-pattern-matching/40306524#40306524", "title": "Performance in pattern matching", "body": "<p>With only two cases, the order doesn't matter all. With <em>three</em> cases, the order won't affect performance, but it may simplify the code. For example, say you have a function that does roughly the same thing for an empty or singleton list, but recurses on a list that has 2 or more items. You could write your patterns simplest to most complex:</p>\n\n<pre><code>foo [] = []\nfoo [x] = [x]\nfoo (x:y:rest) = x+y : foo (y:rest)\n</code></pre>\n\n<p>or, you could reduce this to two cases by handling the more complex one first:</p>\n\n<pre><code>foo (x:y:rest) = x+y : foo (y:rest)\nfoo short = short\n</code></pre>\n\n<p>since <code>foo = id</code> for both of the short cases.</p>\n"}], "owner": {"reputation": 547, "user_id": 4614840, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cbKfT.png?s=128&g=1", "display_name": "Aristu", "link": "https://stackoverflow.com/users/4614840/aristu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 40306253, "answer_count": 2, "score": 3, "last_activity_date": 1543555103, "creation_date": 1477661589, "last_edit_date": 1543555103, "question_id": 40306218, "link": "https://stackoverflow.com/questions/40306218/performance-in-pattern-matching", "title": "Performance in pattern matching", "body": "<p>I'm reading <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">Learn you a Haskell</a>, specifically the chapter about pattern matching. Here's the code presented in the tutorial for computing the length of a list:</p>\n\n<pre><code>length' :: (Num b) =&gt; [a] -&gt; b  \nlength' [] = 0  \nlength' (_:xs) = 1 + length' xs\n</code></pre>\n\n<p>My question is, would inverting the order of recursion (by placing the base case bellow) show any significant performance increase?</p>\n\n<pre><code>length' :: (Num b) =&gt; [a] -&gt; b\nlength' (_:xs) = 1 + length' xs\nlength' [] = 0\n</code></pre>\n"}, {"tags": ["linux", "haskell", "sudo", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1477655813, "post_id": 40302660, "comment_id": 67866077, "body": "You could try running <code>stack exec bash</code> and then <code>sudo ghci</code>."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1477662841, "post_id": 40302660, "comment_id": 67870372, "body": "@sjakobi. Sorry I&#39;m not aware of <code>stack exec bash</code> and <code>sudo ghci</code> doesn&#39;t seem to work either. Do you mind explaining?"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1477706805, "creation_date": 1477648782, "last_edit_date": 1477706805, "question_id": 40302660, "link": "https://stackoverflow.com/questions/40302660/running-stack-as-super-user", "title": "Running Stack as super user", "body": "<p>I am trying to run the <a href=\"https://hackage.haskell.org/package/honk\" rel=\"nofollow\">honk package</a>. Since this package has not been ported to Stackage, I started a new Stack project, copied the source files, and setup the .cabal file. It builds ok.</p>\n\n<p>Now when I am trying to run a simple 1 liner program (<code>main = playOne $ Note 1 440</code>) I get a \"permission denied\" message on execution: <code>beepOpen: permission denied (Permission denied)</code></p>\n\n<p>This is normal and documented <a href=\"https://lambda.xyz/honk/learn/\" rel=\"nofollow\">here</a>, as \"<em>under Linux, for security reasons, only the root user can control the PC speaker.</em>\" (*)</p>\n\n<p>I tried to \"sudo\" stack commands (as in <code>sudo stack ghci</code> or <code>sudo stack exec myprogram-exe</code>) but I only get a <code>sudo: stack: command not found</code> error message back. I am mostly interested in running this program under ghci.</p>\n\n<p><strong>My question</strong> : how to run <code>stack ghci</code> as root and get this running? Also, if there is a way to <code>stack exec</code> as root, I am interested to know too.</p>\n\n<p>(*) I am on Ubuntu 14.04 64bit.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "edited": false, "score": 0, "creation_date": 1477649832, "post_id": 40302866, "comment_id": 67863013, "body": "Yes, I just realized it myself. A silly mistake! Thanks."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1477649469, "creation_date": 1477649469, "answer_id": 40302866, "question_id": 40302439, "link": "https://stackoverflow.com/questions/40302439/parsec-optionmaybe-always-consuming-input/40302866#40302866", "title": "Parsec optionMaybe always consuming input", "body": "<p>The whole of <code>between (char '/') (char '/') $ many1 (noneOf \"/\")</code> fails due to the missing closing <code>'/'</code> in <code>\"/abc\"</code> , and so <code>optionMaybe $ try $ between ...</code> doesn't consume anything (and results in <code>Nothing</code>). You're left with all of <code>\"/abc\"</code> of the input, which of course doesn't match the remaining parser <code>many1 (noneOf \"/\")</code>.</p>\n"}], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 40302866, "answer_count": 1, "score": 1, "last_activity_date": 1477669641, "creation_date": 1477648136, "last_edit_date": 1477669641, "question_id": 40302439, "link": "https://stackoverflow.com/questions/40302439/parsec-optionmaybe-always-consuming-input", "title": "Parsec optionMaybe always consuming input", "body": "<p>I'm trying to debug why despite combining <code>optionMaybe</code> with <code>try</code>, parsec is consuming the input. Basically in the below code, why is the second run not returning <code>Right \"abc\"</code> (which is what I expect)?</p>\n\n<p>Given</p>\n\n<pre><code>myParser = do\n    optionMaybe $ try (between (char '/') (char '/') $ many1 (noneOf \"/\")\n    many1 (noneOf \"/\")\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>&gt; parse myParser \"\" \"/abc/def\"\nRight \"def\"\n\n&gt; parse myParser \"\" \"/abc\"\nLeft (line 1, column 5):\nunexpected end of input\nexpecting \"/\"\n</code></pre>\n"}, {"tags": ["haskell", "traversable"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1477652220, "post_id": 40302035, "comment_id": 67864243, "body": "Could you please be more precise about what you don&#39;t understand? Are you okay with folding, <code>Functor</code> and  <code>Applicative</code> already? It is hard to know how much one would need to write in order to answer your question in its current form."}, {"owner": {"reputation": 15, "user_id": 6120348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf35ea5f670308363b19ad5d367031e0?s=128&d=identicon&r=PG&f=1", "display_name": "beHappy", "link": "https://stackoverflow.com/users/6120348/behappy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477722175, "post_id": 40302035, "comment_id": 67889972, "body": "yes, i kown a little about Functor and Applicative. how can (:) &lt;$&gt; f a &lt;*&gt; b ::f [b]?  (:) :: a-&gt;[a]-&gt;[a],  (&lt;$&gt;):: a-&gt;b-&gt;f a-&gt;f b,  should (:) &lt;$&gt; be   f (a-&gt;[a])-&gt;f [a]?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477744045, "post_id": 40302035, "comment_id": 67894149, "body": "You should edit your question to add what you just said to it. That way, it will be much less likely that it ends up ignored, or closed, for being unclear or too broad."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477921147, "post_id": 40302035, "comment_id": 67940773, "body": "Note that the five downvotes you got would have been entirely avoidable, if only you had explained clearly what you wanted to ask in your original question. Keep that in mind for future questions."}, {"owner": {"reputation": 15, "user_id": 6120348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf35ea5f670308363b19ad5d367031e0?s=128&d=identicon&r=PG&f=1", "display_name": "beHappy", "link": "https://stackoverflow.com/users/6120348/behappy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477926108, "post_id": 40302035, "comment_id": 67943857, "body": "Thank you very much"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 6120348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf35ea5f670308363b19ad5d367031e0?s=128&d=identicon&r=PG&f=1", "display_name": "beHappy", "link": "https://stackoverflow.com/users/6120348/behappy"}, "edited": false, "score": 1, "creation_date": 1477926208, "post_id": 40343336, "comment_id": 67943913, "body": "got it,  I&#39;ve stayed here for a few days, thank you for your help!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 0, "last_activity_date": 1477921052, "creation_date": 1477921052, "answer_id": 40343336, "question_id": 40302035, "link": "https://stackoverflow.com/questions/40302035/how-can-i-understand-this-traversable-implementation-for-lists/40343336#40343336", "title": "How can i understand this Traversable implementation for lists", "body": "<blockquote>\n  <p>what's wrong with the following derivation?</p>\n</blockquote>\n\n<p>The problem is with this passage:</p>\n\n<pre><code>(:) &lt;$&gt; f :: ((-&gt;) a) ([a] -&gt; [a])\n</code></pre>\n\n<p>Function application always has precedence over any operator, and so <code>(:) &lt;$&gt; f a</code> is not <code>((:) &lt;$&gt; f) a</code>, as in your derivation, but <code>(:) &lt;$&gt; (f a)</code>. The rest follows smoothly (you may want to try finishing it yourself before reading the solution below):</p>\n\n\n\n<pre><code>(:) &lt;$&gt;     :: F a -&gt; F ([a] -&gt; [a]) -- The third line of your derivation.\nf           :: a -&gt; A b\nf a         :: A b\n(:) &lt;$&gt; f a :: A ([b] -&gt; [b])\n</code></pre>\n\n\n\n<pre><code>(&lt;*&gt;)             :: A (a -&gt; b) -&gt; A a -&gt; A b\n(:) &lt;$&gt; f a       :: A ([b] -&gt; [b])\n(:) &lt;$&gt; f a &lt;*&gt;   :: A [b] -&gt; A [b]\nb                 :: A [b]\n(:) &lt;$&gt; f a &lt;*&gt; b :: A [b]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 6120348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf35ea5f670308363b19ad5d367031e0?s=128&d=identicon&r=PG&f=1", "display_name": "beHappy", "link": "https://stackoverflow.com/users/6120348/behappy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "closed_date": 1479461097, "accepted_answer_id": 40343336, "answer_count": 1, "score": -5, "last_activity_date": 1480735319, "creation_date": 1477646731, "last_edit_date": 1480735319, "question_id": 40302035, "link": "https://stackoverflow.com/questions/40302035/how-can-i-understand-this-traversable-implementation-for-lists", "closed_reason": "Needs details or clarity", "title": "How can i understand this Traversable implementation for lists", "body": "<p>I'm having trouble to understand the following <a href=\"https://github.com/NICTA/course/blob/9414bf23b5dd7987c13f0fa5a5631cb2b22a6bce/src/Course/Traversable.hs\" rel=\"nofollow noreferrer\">example from the NICTA course</a>:</p>\n\n<pre><code>instance Traversable List where\n    traverse ::\n        Applicative f =&gt;\n        (a -&gt; f b)\n        -&gt; List a\n        -&gt; f (List b)\n    traverse f =\n        foldRight (\\a b -&gt; (:.) &lt;$&gt; f a &lt;*&gt; b) (pure Nil)\n</code></pre>\n\n<p>In what follows, I will replace <code>List</code> with <code>[]</code>, so we have:</p>\n\n<pre><code>instance Traversable [] where\n    traverse ::\n        Applicative f =&gt;\n        (a -&gt; f b)\n        -&gt; [a]\n        -&gt; f ([b])\n    traverse f =\n        foldRight (\\a b -&gt; (:) &lt;$&gt; f a &lt;*&gt; b) []\n</code></pre>\n\n<p>In particular, what's wrong with the following derivation of the type of <code>(&lt;*&gt;)</code>?</p>\n\n<pre><code>(:)    :: a -&gt; [a] -&gt; [a]\n(&lt;$&gt;)   :: a -&gt; b -&gt; F a -&gt; F b,   F for Functor\n</code></pre>\n\n<p>(therefore...)</p>\n\n<pre><code>(:) &lt;$&gt;  :: F a -&gt; F ([a] -&gt; [a])\nf      :: a -&gt; A b :: ((-&gt;) a) (A b),    A for Applicative\n</code></pre>\n\n<p>(therefore...)</p>\n\n<pre><code>(:) &lt;$&gt; f :: ((-&gt;) a) ([a] -&gt; [a])\n(:) &lt;$&gt; f a  :: [a] -&gt; [a]\n(&lt;*&gt;) :: A (a -&gt; b) -&gt; A a -&gt; A b\n</code></pre>\n"}, {"tags": ["haskell", "refactoring", "parsec", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 5, "creation_date": 1477641357, "post_id": 40300399, "comment_id": 67858663, "body": "You can also use <code>&lt;$ :: Functor f =&gt; a -&gt; f b -&gt; f a</code> to keep &quot;the semantics&quot; at the far left."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 7, "last_activity_date": 1477640741, "creation_date": 1477640741, "answer_id": 40300399, "question_id": 40300278, "link": "https://stackoverflow.com/questions/40300278/using-applicative-notation-for-parsers-whose-result-is-discarded/40300399#40300399", "title": "Using Applicative notation for parsers whose result is discarded", "body": "<p>You can use <code>*&gt;</code> and <code>&lt;*</code> to include actions whose result is discarded (but their effect is run):</p>\n\n<pre><code>(*&gt;) :: f a -&gt; f b -&gt; f b\n(&lt;*) :: f a -&gt; f b -&gt; f a\n</code></pre>\n\n<p>giving</p>\n\n<pre><code>filePath :: GenParser Char st Info\nfilePath = optional \"./\" *&gt; Song &lt;$&gt; artist &lt;*&gt; slash *&gt; album &lt;*&gt; slash *&gt; track\n</code></pre>\n"}], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 40300399, "answer_count": 1, "score": 4, "last_activity_date": 1477669776, "creation_date": 1477640192, "last_edit_date": 1477669776, "question_id": 40300278, "link": "https://stackoverflow.com/questions/40300278/using-applicative-notation-for-parsers-whose-result-is-discarded", "title": "Using Applicative notation for parsers whose result is discarded", "body": "<p>I have a question on refactoring <a href=\"http://book.realworldhaskell.org/read/using-parsec.html\" rel=\"nofollow\">Parsec</a> code to use the <code>Applicative</code> interface. Suppose I have a parser using the monadic interface like this:</p>\n\n<pre><code>filePath0 :: GenParser Char st Info\nfilePath0 = do\n  optional (string \"./\")\n  r &lt;- artist\n  slash\n  l &lt;- album\n  slash\n  t &lt;- track\n  return $ Song r l t\n</code></pre>\n\n<p>I'd like to turn it into something like this:</p>\n\n<pre><code>filePath :: GenParser Char st Info\nfilePath = Song &lt;$&gt; artist &lt;*&gt; album &lt;*&gt; track\n</code></pre>\n\n<p>But as you can see it is not complete. My question: where, in this refactored version, would I insert <code>optional (string \"./\")</code> and <code>slash</code> parsers?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477623187, "post_id": 40297001, "comment_id": 67852698, "body": "Some observations: (1) The hint in dfeuer&#39;s answer is indeed decisive. (2) Note that you aren&#39;t actually building the first list with the values before the split point. (3) Style nitpicking: the parentheses around <code>xs</code> in your <code>otherwise</code> case are superfluous and should be dropped."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1477623867, "post_id": 40297001, "comment_id": 67852888, "body": "Note on your edit point: it seems unlikely to be efficient to first check that the element is in the list and then split it there. The process of checking if an element is in a list can be expensive; it&#39;s usually a good idea to &quot;hold the place&quot; where you found it. If you show how this function fits in context, we will probably be able to help more."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1477623115, "last_edit_date": 1477623115, "creation_date": 1477622814, "answer_id": 40297280, "question_id": 40297001, "link": "https://stackoverflow.com/questions/40297001/split-a-list-at-the-first-occurrence-of-an-element/40297280#40297280", "title": "Split a list at the first occurrence of an element", "body": "<p>You have committed to the wrong result type, which is preventing the type checker from helping you as much as it could. You say you want</p>\n\n<pre><code>splitAtFirst 2 listT = [[1,3],[5,6,3,2,6]]\n</code></pre>\n\n<p>This pins you to</p>\n\n<pre><code>splitAtfirst::(Eq a)=&gt; a-&gt;[a]-&gt;[[a]]\n</code></pre>\n\n<p>which allows the list to be split into arbitrarily many lists.</p>\n\n<p>But in fact you want to split the list into <em>two</em>. One point you don't address in your question is what you want the result to be if I ask something like <code>splitAtFirst 2 [1,3]</code>, where the element is not found. There are three options that seem reasonable:</p>\n\n<pre><code>splitAtFirst :: Eq a =&gt; a -&gt; [a] -&gt; Maybe ([a],[a])\n-- splitAtFirst 2 [1,3] = Nothing\n\nsplitAtFirst :: Eq a =&gt; a -&gt; [a] -&gt; ([a],[a])\n-- splitAtFirst 2 [1,3] = ([1,3],[])\n\nsplitAtFirst :: Eq a =&gt; a -&gt; [a] -&gt; ([a], Maybe [a])\n-- splitAtFirst 2 [1,3] = ([1,3],Nothing)\n</code></pre>\n\n<p>Note that I did not suggest</p>\n\n<pre><code>-- splitAtFirst 2 [1,3] = ([], [1,3])\n</code></pre>\n\n<p>The reason has to do with laziness and efficiency&mdash;can you figure out why? The first <code>Maybe</code> version also has this potential problem, but it makes up for it by being more useful.</p>\n\n<p>Once you commit to one of these options, you will likely find it easier to get the implementation right.</p>\n"}, {"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1477640325, "post_id": 40297465, "comment_id": 67858217, "body": "I find <code>(id *** drop 1)</code> clearer than <code>fmap</code> in these sorts of jobs."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1477651570, "post_id": 40297465, "comment_id": 67863885, "body": "@pigworker A fair point. Here, I considered using <code>second</code> instead of <code>fmap</code> for the reason you mention. I settled on <code>fmap</code> mainly because it seemed possible that the OP hadn&#39;t been introduced to either of them, and in such a case a first encounter with <code>Functor</code> would perhaps be more fruitful than one with <code>Bifucntor</code> or <code>Arrow</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 8, "last_activity_date": 1477625098, "last_edit_date": 1477625098, "creation_date": 1477624146, "answer_id": 40297465, "question_id": 40297001, "link": "https://stackoverflow.com/questions/40297001/split-a-list-at-the-first-occurrence-of-an-element/40297465#40297465", "title": "Split a list at the first occurrence of an element", "body": "<p>Since dfeuer has already pointed the way towards fixing your implementation, I will just chime in with the ready-made solution:</p>\n\n<pre><code>splitAtFirst :: Eq a =&gt; a -&gt; [a] -&gt; ([a], [a])\nsplitAtFirst x = fmap (drop 1) . break (x ==)\n</code></pre>\n\n<p>This <code>splitAtFirst</code> implements the second option from the three suggestions in dfeuer's answer. A few notes on each of the components:</p>\n\n<ul>\n<li><p><code>(x ==)</code> is a function which tests for equality with <code>x</code>, returning a <code>Bool</code>.</p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:break\" rel=\"noreferrer\"><code>break</code></a> uses a boolean test (here, <code>(x ==)</code>) to break a list in two, the second list beginning with the first element that passes the test. The two lists are returned as a pair (see dfeuer's answer for the reason why it is so).</p></li>\n<li><p><code>drop 1</code> drops the first element of a list if it is not empty (and leaves it alone if it is empty).</p></li>\n<li><p><code>fmap</code> would take quite a bit longer to explain properly, so I will just say that <code>fmap f</code> applied on a pair (such as the result of <code>break</code>) applies the function <code>f</code> to the second element of the pair. In our case, <code>fmap (drop 1)</code> will remove the first element of the second list -- that is, the separator. (To find out more about <code>fmap</code>, search for the keyword \"functor\", or just try using it on a list or a <code>Maybe</code>-value and see what happens.)</p></li>\n</ul>\n"}], "owner": {"reputation": 311, "user_id": 4596959, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kSpD_6-FKBk/AAAAAAAAAAI/AAAAAAAACBY/4-a0KotSAgQ/photo.jpg?sz=128", "display_name": "David Leonardo Ardila Herrera", "link": "https://stackoverflow.com/users/4596959/david-leonardo-ardila-herrera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1434, "favorite_count": 1, "accepted_answer_id": 40297280, "answer_count": 2, "score": 4, "last_activity_date": 1477625098, "creation_date": 1477620877, "last_edit_date": 1477623493, "question_id": 40297001, "link": "https://stackoverflow.com/questions/40297001/split-a-list-at-the-first-occurrence-of-an-element", "title": "Split a list at the first occurrence of an element", "body": "<p>I was wondering if there is a function that lets me split a list at the first occurrence of an element, excluding that element. Basically, suppose:</p>\n\n<pre><code>listT= [1,3,2,5,6,3,2,6]\n</code></pre>\n\n<p>then I want to define (or not, if it already exists), a function splitAtFirst so that</p>\n\n<pre><code>splitAtFirst 2 listT = [[1,3],[5,6,3,2,6]]\n</code></pre>\n\n<p>my attempt so far looks like this:</p>\n\n<pre><code>splitAtfirst::(Eq a)=&gt; a-&gt;[a]-&gt;[[a]]\nsplitAtfirst _ []=[]\nsplitAtfirst a (x:xs) \n   |a==x        = [xs]\n   |otherwise   = [x]: splitAtfirst a (xs) \n</code></pre>\n\n<p>However, I get</p>\n\n<pre><code>&gt;splitAtfirst 2 [1,3,2,5,6,3,2,6]\n&gt;[[1],[3],[5,6,3,2,6]]\n</code></pre>\n\n<p>I know why the problem happens, but so far I haven't been able to find a good solution</p>\n\n<p>I appreciate any help!</p>\n\n<p>Edit: this is an auxiliary function that only will be called after checking that elem is in the list, so dealing with the case when it does not exist it's not really necessary. I appreciate your help </p>\n"}, {"tags": ["haskell", "types", "syntax", "pattern-matching", "logic"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477657513, "post_id": 40295838, "comment_id": 67867052, "body": "Not really relevant: double check your <code>update</code> function -- it looks wrong to me, since the then branch always returns <code>INDETERMINATE</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477657882, "post_id": 40295838, "comment_id": 67867278, "body": "Note that there was a rather blatant mistake in the code within my answer as I originally wrote it. If you were left wondering why it didn&#39;t work, check the updated version."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1477657667, "last_edit_date": 1477657667, "creation_date": 1477618322, "answer_id": 40296626, "question_id": 40295838, "link": "https://stackoverflow.com/questions/40295838/mismatched-types-with-propositional-logic-implementation-in-haskell/40296626#40296626", "title": "Mismatched types with propositional logic implementation in haskell", "body": "<p>Your problem is that you are mixing up <code>Logical_value</code>, the <em>type</em> with constructors <code>TRUE</code>, <code>FALSE</code> and <code>INDETERMINATE</code>, and <code>Logical_value</code>, the <em>constructor</em> of the <code>Propositional_expression</code> type. The fact that you are using the same names throughout is obscuring quite a few distinctions and issues. For one, the <code>Logical_value</code> case of <code>Propositional_expression</code> doesn't actually contain a <code>Logical_value</code>, as it is just an atomic value. What follows is an adjustment of your types so that they have clearer names and behave in the way you want them to:</p>\n\n<pre><code>-- I'm changing the names to CamelCase out of habit -- feel free not to. \n\n-- It will be considered three logical values.\ndata LogicalValue = TRUE | FALSE | INDETERMINATE deriving (Show, Eq)\n\n-- A propositional symbol (variable) is a string.\ntype PropositionalSymbol = String \n\n-- Four basics logicals connectives.\ndata PropositionalConnective\n    = And \n    | Or \n    | Impl \n    | Dimpl \n    deriving (Show, Eq)\n\n-- A well-formed formula (propositional expression) can be a logical\n-- value, a propositional symbol, the negation of a well-formed formula,\n-- two well-formed formulas connected by a logical connective and the \n-- conjunction or disjunction of well-formed formulas.\ndata PropositionalExpression \n    = ValueExpr LogicalValue\n    | SymbolExpr PropositionalSymbol\n    | NegExpr PropositionalExpression\n    | ConnectiveExpr\n        PropositionalExpression PropositionalConnective PropositionalExpression\n    | ListExpr PropositionalConnective [PropositionalExpression] \n        -- Semantic will throw error if connective is not And or Or.\n    deriving (Show, Eq)\n\n-- Semantic\n-- Type to assign logical values to propositional symbols.\ntype Interpretation = PropositionalSymbol -&gt; LogicalValue\n</code></pre>\n\n<p>And here is how <code>interpretation</code> would look like. Note how the constructors (<code>ValueExpr</code>, <code>SymbolExpr</code>, etc.) are used to pick the case that each equation handles. That is what lies behind your type error -- <code>TRUE</code>, <code>FALSE</code> and <code>INDETERMINATE</code> are not constructors of <code>PropositionalExpression</code>, neither in your original code nor in my modified version (by the way, you were right in suspecting it wasn't a syntax error: the syntax in your original code was legal, but it didn't do what you expected, leading to a type error). </p>\n\n<pre><code>-- Function to obtain the logical value from a propositional expression\n-- and the interpretation from basic propositional variables.\ninterpretation :: PropositionalExpression -&gt; Interpretation -&gt; LogicalValue\n-- Logical Values\n-- All three cases here can be subsumed into one.\n-- _ simply means \"ignore this argument\".\ninterpretation (ValueExpr x) _ = x\n-- And so forth for the other PropositionalExpression cases\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 5931298, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wI3gT.jpg?s=128&g=1", "display_name": "Jorge Garc&#237;a", "link": "https://stackoverflow.com/users/5931298/jorge-garc%c3%ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 1, "accepted_answer_id": 40296626, "answer_count": 1, "score": 1, "last_activity_date": 1477657667, "creation_date": 1477611567, "last_edit_date": 1477618573, "question_id": 40295838, "link": "https://stackoverflow.com/questions/40295838/mismatched-types-with-propositional-logic-implementation-in-haskell", "title": "Mismatched types with propositional logic implementation in haskell", "body": "<p>I'm trying to implement propositional logic in haskell with the following code:</p>\n\n<pre><code>module Propositional_Logic where\n\n--Syntax\n--It will be considered three logical values.\ndata Logical_value = TRUE | FALSE | INDETERMINATE deriving (Show, Eq)\n--A propositional symbol (variable) is a string.\ntype Propositional_symbol = String \n--Four basics logicals connectives.\ndata Propositional_connective = And \n                              | Or \n                              | Impl \n                              | Dimpl \n                              deriving (Show, Eq)\n--A well-formed formula (propositional expression) can be a logical value, a propositional symbol, the negation of a well-formed formula, two well-formed formulas connected by a logical connective and the conjunction or disjunction of well-formed formulas.\ndata Propositional_expression = Logical_value\n                              | Propositional_symbol\n                              | Neg Propositional_expression\n                              | Propositional_expression Propositional_connective Propositional_expression\n                              | Propositional_connective [Propositional_expression] -- Semantic will throw error if connective is not And or Or.\n                              deriving (Show, Eq)\n\n--Semantic\n--Type to assign logical values to propositional symbols.\ntype Interpretation = Propositional_symbol -&gt; Logical_value\n\ninterpretationInit :: Interpretation\ninterpretationInit _ = INDETERMINATE\n\n--Function to add interpretations for basic propositional symbols.\nupdate :: Interpretation -&gt; Interpretation -&gt; Interpretation\nupdate i1 i2 = (\\x -&gt; if i2 x == INDETERMINATE then i2 x else i1 x)\n\n--Function to obtain the logical value from a propositional expression and the interpretation from basic propositional variables.\ninterpretation :: Propositional_expression -&gt; Interpretation -&gt; Logical_value\n--Logical Values\ninterpretation (TRUE) i = TRUE\ninterpretation (FALSE) i = FALSE\ninterpretation (INDETERMINATE) i = INDETERMINATE\n</code></pre>\n\n<p>I'm having the following compiling error:</p>\n\n<pre><code>[1 of 1] Compiling Propositional_Logic ( propositional_logic.hs, interpreted )\n\npropositional_logic.hs:36:21:\nCouldn't match expected type \u2018Propositional_expression\u2019\n            with actual type \u2018Logical_value\u2019\nIn the pattern: TRUE\nIn an equation for \u2018interpretation\u2019: interpretation (TRUE) i = TRUE\n\npropositional_logic.hs:37:21:\nCouldn't match expected type \u2018Propositional_expression\u2019\n            with actual type \u2018Logical_value\u2019\nIn the pattern: FALSE\nIn an equation for \u2018interpretation\u2019:\n    interpretation (FALSE) i = FALSE\n\npropositional_logic.hs:38:21:\nCouldn't match expected type \u2018Propositional_expression\u2019\n            with actual type \u2018Logical_value\u2019\nIn the pattern: INDETERMINATE\nIn an equation for \u2018interpretation\u2019:\n    interpretation (INDETERMINATE) i = INDETERMINATE\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I think my syntax is correct: if a propositional_expression can be a Logical_value I expected Haskell matches it correctly but it must be something I'm missing. Can anyone help me?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["html", "haskell", "canvas", "graph", "haste"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 6857949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7e6af79e59c5cd8efa3347eaebc076?s=128&d=identicon&r=PG&f=1", "display_name": "EL-", "link": "https://stackoverflow.com/users/6857949/el"}, "edited": false, "score": 0, "creation_date": 1477673720, "post_id": 40295821, "comment_id": 67876667, "body": "Thank you for the suggestion. The y-axis shifted correctly, but when applying x=x*0.02 -150, the y-axis doesn&#39;t shift to the center and disappears instead."}, {"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "reply_to_user": {"reputation": 15, "user_id": 6857949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7e6af79e59c5cd8efa3347eaebc076?s=128&d=identicon&r=PG&f=1", "display_name": "EL-", "link": "https://stackoverflow.com/users/6857949/el"}, "edited": false, "score": 0, "creation_date": 1477675387, "post_id": 40295821, "comment_id": 67877570, "body": "Ah, my mistake. Thanks for pointing it out. I&#39;ve edited it out of the post."}, {"owner": {"reputation": 15, "user_id": 6857949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7e6af79e59c5cd8efa3347eaebc076?s=128&d=identicon&r=PG&f=1", "display_name": "EL-", "link": "https://stackoverflow.com/users/6857949/el"}, "edited": false, "score": 0, "creation_date": 1477676786, "post_id": 40295821, "comment_id": 67878219, "body": "No problems, thank you for the help.  x = (x-((fromIntegral y) / 2)) * scale turned out to work correctly."}], "tags": [], "owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1477675361, "last_edit_date": 1477675361, "creation_date": 1477611394, "answer_id": 40295821, "question_id": 40295620, "link": "https://stackoverflow.com/questions/40295620/making-my-canvas-dispaly-the-graph-correctly/40295821#40295821", "title": "Making my canvas dispaly the graph correctly", "body": "<p>You're probably used to working with 2D coordinate systems where positive <code>y</code> is up, but as you noted in HTML canvas positive <code>y</code> goes down. To simulate the coordinate system you want, you need to flip all the <code>y</code>-values over the line <code>y=0</code> (aka the <code>x</code>-axis).</p>\n\n<p>Here are a few <code>y</code>-values and their corresponding corrections you can use as tests. Note that I'm assuming <code>y</code> has already been scaled properly; it looks like you've already got that part.</p>\n\n<ul>\n<li>150 -> 0</li>\n<li>0 -> 150</li>\n<li>-150 -> 300</li>\n</ul>\n\n<p>The pattern is <code>y_new = -(y_old - 150)</code> where 150 is <code>canvas_height/2</code>. Therefore, after scaling you need to apply this formula to all your <code>y</code> values.</p>\n\n<p>To shift the <code>y</code>-axis to the center you need to do the same sort of thing to derive the appropriate linear transformation. </p>\n"}], "owner": {"reputation": 15, "user_id": 6857949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7e6af79e59c5cd8efa3347eaebc076?s=128&d=identicon&r=PG&f=1", "display_name": "EL-", "link": "https://stackoverflow.com/users/6857949/el"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 40295821, "answer_count": 1, "score": 0, "last_activity_date": 1477675361, "creation_date": 1477610094, "question_id": 40295620, "link": "https://stackoverflow.com/questions/40295620/making-my-canvas-dispaly-the-graph-correctly", "title": "Making my canvas dispaly the graph correctly", "body": "<p>I am trying to create a graph calculator and making it display the graph correctly on a \"canvas\". When I load the HTML file and write x e.g it starts from the upper left corner and goes down to the lower right corner. So the problem is that it displays the graph upside down and it does not include negative values.\nI know that the canvas starts from (0,0) in pixel value in the upper left corner and ends at (300,300) in the lower right corner. I want it to display something like the green canvas from this link:  <a href=\"http://www.cse.chalmers.se/edu/course/TDA555/lab4.html\" rel=\"nofollow\">http://www.cse.chalmers.se/edu/course/TDA555/lab4.html</a></p>\n\n<pre><code>points :: Expr -&gt; Double -&gt; (Int,Int) -&gt; [Point]\npoints exp scale (x, y) = [(x, realToPix (eval exp (pixToReal x))) | x&lt;-[0..(fromIntegral canWidth)] ]\n              where\n              pixToReal :: Double -&gt; Double  --converts a pixel x-coordinate to a real x-coordinate\n              pixToReal x = x * 0.02\n              realToPix :: Double -&gt; Double  --converts a real y-coordinate to a pixel y-coordinate\n              realToPix y = y / 0.02\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1477609638, "post_id": 40295505, "comment_id": 67849527, "body": "Are you using aeson? Please update your question to reflect this; it&#39;s best to add an import line."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477610796, "post_id": 40295505, "comment_id": 67849845, "body": "Yes, using Aeson. I&#39;ve added tag to the question."}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477638436, "post_id": 40296040, "comment_id": 67857242, "body": "Thank you. Can you give a pointer on what you mean by &quot;parsing Aeson&#39;s AST to a meaningful data type&quot;."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "reply_to_user": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 1, "creation_date": 1477639531, "post_id": 40296040, "comment_id": 67857812, "body": "Define a data type that suits your application (what does the object with a &#39;label&#39; and a &#39;delta&#39; <i>mean</i>?), implement functions to process it (e.g. an accessor function for the &#39;delta&#39;, so that you can use it with <code>sortBy</code>) and implement a parser for it (usually by creating an <code>instance FromJSON YourDataType</code>)."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477640499, "post_id": 40296040, "comment_id": 67858284, "body": "Oh, I see - makes sense. Indeed in my real-world case (i.e. not the simplified version in the question) my list of <code>Value</code> comes from properly defined types. It is done by <code>mappend</code>ing a list of <code>entityIdToJSON</code> persistent&#39;s <code>Entity</code>. So I think I must use code like you posted in the answer, or is there a better way? - <a href=\"https://gist.github.com/amitaibu/6b43645692addceebff2548cf2add0b7#file-example-hs-L13\" rel=\"nofollow noreferrer\">gist.github.com/amitaibu/&hellip;</a>"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1477654750, "post_id": 40296040, "comment_id": 67865534, "body": "If you have an Entity type and a function entityFoo :: Entity -&gt; Foo then as long as Foo is an instance of Ord you can sort a [Entity] with &quot;sortBy (comparing entityFoo)&quot;"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1477657452, "post_id": 40296040, "comment_id": 67867008, "body": "Or, what&#39;s probably more appropriate: only use <code>Foo</code>-typed objects after you retrieve the data from storage and parsed it. Your list would be <code>[Foo]</code>, and not <code>[Entity]</code> or <code>[Value]</code>, and then you can simply <code>sortBy (comparing getDeltaFromFoo)</code> (only implement an <code>Ord</code> instance if it makes sense to talk about the &quot;order&quot; of <code>Foo</code> objects without further context)."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "is_accepted": true, "score": 1, "last_activity_date": 1477613054, "creation_date": 1477613054, "answer_id": 40296040, "question_id": 40295505, "link": "https://stackoverflow.com/questions/40295505/sort-value-by-key/40296040#40296040", "title": "Sort [Value] by key", "body": "<p>This is quite a bit more involved thanks to the structure of Aeson. I'll post the code without much explanation, other than \"<code>sortBy</code> and <code>comparing</code> are your friends\":</p>\n\n<pre><code>import Data.Aeson.Types (parseMaybe, Value, Parser)\nimport Data.Ord (comparing)\nimport Data.List (sortBy)\nimport Data.Scientific (Scientific)\nimport Data.Text (Text)\n\nsortByKeyForNumberField :: Text -&gt; [Value] -&gt; [Value]\nsortByKeyForNumberField key = sortBy (comparing $ parseMaybe parserFunction)\n  where\n    parserFunction :: Value -&gt; Parser Scientific\n    parserFunction = withObject \"some object\" (.: key)\n</code></pre>\n\n<p>You can then calculate your desired list by evaluating <code>sortByKeyForNumberField \"delta\" lists</code>.</p>\n\n<p>However, you're much better off parsing Aeson's AST to a meaningful data type (which you'll have to define yourself, because you know the application) and implementing sorting for it. Aeson is really made as an AST for parsing and rendering JSON, and not for manipulating JSON.</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 40296040, "answer_count": 1, "score": -2, "last_activity_date": 1477613054, "creation_date": 1477609313, "last_edit_date": 1477611845, "question_id": 40295505, "link": "https://stackoverflow.com/questions/40295505/sort-value-by-key", "title": "Sort [Value] by key", "body": "<p>I have the following list of <code>Value</code> that I'd like to sort by the <code>delta</code> key.</p>\n\n<pre><code>{-# LANGUAGE Haskell2010 #-}\n{-# LANGUAGE OverloadedStrings #-}\nimport Data.Aeson\n\nlists :: [Value]\nlists =\n    [ object [\"label\" .= String \"foo\", \"delta\" .= Number 2]\n    , object [\"label\" .= String \"bar\", \"delta\" .= Number 3]\n    , object [\"label\" .= String \"baz\", \"delta\" .= Number 1]\n    ]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1477611308, "post_id": 40294849, "comment_id": 67849998, "body": "I don&#39;t think that&#39;s possible, because your program doesn&#39;t receive input from any files, only the command line arguments, and Windows doesn&#39;t give you a way to copy a file to the command line arguments (besides manual copy-paste)."}, {"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1477613640, "post_id": 40294849, "comment_id": 67850570, "body": "Hi, i think you&#39;re right, Image now this code if you can: main = do a &lt;- getArgs             w &lt;- getContents  In there, a will be the args in the command line right?(ex: :main a b)  And w will came from the studin right?"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "edited": false, "score": 0, "creation_date": 1477616984, "post_id": 40296218, "comment_id": 67851268, "body": "It runs, but the program is not giving back what i want... But i think i may have something wrong in the .txt file I&#39;m using, thank you..."}], "tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": false, "score": 2, "last_activity_date": 1477614623, "creation_date": 1477614623, "answer_id": 40296218, "question_id": 40294849, "link": "https://stackoverflow.com/questions/40294849/haskell-calling-a-file-has-input/40296218#40296218", "title": "Haskell calling a file has input", "body": "<p>Use the <code>&lt;</code> input redirection operator when running the program:</p>\n\n<pre><code>program otherargumentsgohere &lt; inputfile.txt\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1477614623, "creation_date": 1477605453, "last_edit_date": 1477614592, "question_id": 40294849, "link": "https://stackoverflow.com/questions/40294849/haskell-calling-a-file-has-input", "title": "Haskell calling a file has input", "body": "<p>Imagine that I have compiled the file program.hs where:</p>\n\n<pre><code>main :: IO ()\nmain = do a &lt;- getArgs \n          w &lt;- getContents\n...\n</code></pre>\n\n<p>My question is how can I run that program in the windows command line such that it receives input from file.txt?</p>\n"}, {"tags": ["haskell", "types", "data-kinds"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477601486, "post_id": 40293902, "comment_id": 67846422, "body": "What would your <code>get</code> function do if it was given a list (that is, if <code>\u03c4</code> was <code>[]</code>)?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1477601489, "post_id": 40293902, "comment_id": 67846425, "body": "Well, it makes an implicit assumption that&#39;s not going to work. There&#39;s no reason to assume a type with a final type variable of kind * has a single constructor that takes a single argument of the type in question."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 10, "last_activity_date": 1477604136, "creation_date": 1477604136, "answer_id": 40294567, "question_id": 40293902, "link": "https://stackoverflow.com/questions/40293902/functions-with-higher-kinds/40294567#40294567", "title": "Functions with higher kinds?", "body": "<p>How about this type?</p>\n\n<pre><code>newtype Pred a = Pred (a -&gt; Bool)\n</code></pre>\n\n<p>Or this one?</p>\n\n<pre><code>data Proxy a = Proxy\n</code></pre>\n\n<p>There's no way to get an <code>a</code> out of a <code>Pred a</code>. You can only put <code>a</code>s in. Likewise, there's no way to get an <code>a</code> out of a <code>Proxy a</code>, because there aren't any <code>a</code>s inside it.</p>\n\n<p>So a function <code>get :: forall f a. f a -&gt; a</code> can't exist in general. You need to use a type class to distinguish between those types <code>f</code> from which you can extract an <code>a</code> and those from which you can't.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1477608382, "creation_date": 1477608382, "answer_id": 40295380, "question_id": 40293902, "link": "https://stackoverflow.com/questions/40293902/functions-with-higher-kinds/40295380#40295380", "title": "Functions with higher kinds?", "body": "<p>Well, that unconstrained generic type of <code>get</code> certainly can't work. This would also allow you to extract, say, a <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Void.html\" rel=\"nofollow\"><code>Void</code></a> value from <code>Const () :: Const () Void</code>.</p>\n\n<p>You can however obtain a suitably constrained version of this function quite simply with <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Generics.html\" rel=\"nofollow\">generics</a>. You still need a type class, but not need to define instances in the traditional sense. It ultimately looks like this:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DeriveGeneric, DeriveAnyClass #-}\nimport GHC.Generics\n\nclass Get \u03c4 where\n  get :: \u03c4 a -&gt; a\n\ndata X a = X a deriving (Generic1, Get)\ndata Y a = Y a deriving (Generic1, Get)\ndata Z a = Z a deriving (Generic1, Get)\n</code></pre>\n\n<p>To actually get this to work, we only need two weird representation-type instances:</p>\n\n<pre><code>instance Get f =&gt; Get (M1 i t f) where get = get . unM1\ninstance Get Par1 where get = unPar1\n</code></pre>\n\n<p>Now the actual implementation for <code>X</code>, <code>Y</code> and <code>Z</code> can just use a default signature and reduce the extraction to the underlying type-representation. To this end, define the class thus:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass Get \u03c4 where\n  get :: \u03c4 a -&gt; a\n  default get :: (Generic1 \u03c4, Get (Rep1 \u03c4)) =&gt; \u03c4 a -&gt; a\n  get = get . from1\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 3984779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ffc1be2da398ed6ac0947f8a7424307?s=128&d=identicon&r=PG&f=1", "display_name": "Jace Cole", "link": "https://stackoverflow.com/users/3984779/jace-cole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1477608382, "creation_date": 1477601066, "question_id": 40293902, "link": "https://stackoverflow.com/questions/40293902/functions-with-higher-kinds", "title": "Functions with higher kinds?", "body": "<p>Suppose the following data types are defined: </p>\n\n<pre><code>data X a = X {getX :: a}\ndata Y a = Y {getY :: a}\ndata Z a = Z {getZ :: a}\n</code></pre>\n\n<p>Must there be three separate functions, <code>getX</code>, <code>getY</code>, and <code>getZ</code>? It seems to me that there could be a function defined something like this:  </p>\n\n<pre><code>get :: forall (\u03c4 :: (* -&gt; *)) (a :: *). \u03c4 a -&gt; a\nget (_ x) = x\n</code></pre>\n\n<p>Obviously this is not valid standard Haskell, but there are so many extensions to GHC that seem like they might have a solution (<code>RankNTypes</code>,<code>ExistentialQuantification</code>,<code>DataKinds</code>,etc.). Besides the simple reason of avoiding a tiny amount of typing, there is the benefit of avoiding the namespace pollution that the record solution creates. I suppose this is really just a more implicit solution than using a type class like this: </p>\n\n<pre><code>class Get f where\n  get :: f a -&gt; a\n</code></pre>\n\n<p>However, it appears that defining a generic function would be more useful than a type class, because the fact that it is implicitly defined means it could be used in many more places, in the same way that <code>($)</code> or <code>(.)</code> is used. So my question has three parts: is there a way to accomplish this, is it a good idea, and if not, what is a better way?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1477600482, "post_id": 40293205, "comment_id": 67845914, "body": "First you must convert each <code>[Value]</code> into a <code>Vector Value</code> and then convert that to a <code>Value</code> with <code>Array :: Vector Value -&gt; Value</code>. Then convert the entire hashmap to a value with <code>Object :: Map Text Value -&gt; Value</code>. e.g. <code>Object . fmap (Array . fromList)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1477600488, "post_id": 40293205, "comment_id": 67845917, "body": "Please try to minimize your failure. I would bet you can make a version that gives essentially the same error, but doesn&#39;t involve any DB backend, yesod dependency, logging, or even any compiler extensions. Not only will this lower the effort threshold for people here to reproduce your problem (and test their proposed fixes), it will also make it more likely that the problem becomes apparent to you without our help at all. You should also include the full error."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477600817, "post_id": 40293205, "comment_id": 67846099, "body": "Sure, I&#39;ll try to minimize it. Still struggling with getting the types right."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477601989, "post_id": 40293205, "comment_id": 67846629, "body": "I&#39;ve updated the error. btw, The problems of being a newbie is that it&#39;s actually hard  to minimize it :) But I&#39;m trying.."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477604619, "post_id": 40293205, "comment_id": 67847743, "body": "I have edited the question, and hopefully helped others in helping me :)"}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1477605572, "post_id": 40294742, "comment_id": 67848090, "body": "Works perfectly. Thank you for taking the time to explain it step by step. I think I will actually know how to do it the next time!"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": true, "score": 1, "last_activity_date": 1477606123, "last_edit_date": 1477606123, "creation_date": 1477604973, "answer_id": 40294742, "question_id": 40293205, "link": "https://stackoverflow.com/questions/40293205/inject-a-list-of-json-values-into-a-hashmap/40294742#40294742", "title": "Inject a list of Json Values into a HashMap", "body": "<p><code>HashMap.insert</code> has the type <code>k -&gt; v -&gt; HashMap k v -&gt; HashMap k v</code>. Your <code>storeJson</code> is not a <code>HashMap</code> but a <code>Value</code>\u2014one made with an <code>Object :: HashMap Text Value -&gt; Value</code> constructor. This means <code>v ~ Value</code> (in case you're not familiar, you can read <code>~</code> as type equality). However, this is then a problem since your <code>productsJson</code> is not a <code>Value</code> but actually a <code>[Value]</code>.</p>\n\n<p>Therefore, to solve your problem, you need to:</p>\n\n<ol>\n<li><p>Extract the <code>HashMap</code> from <code>storeJson</code>.</p>\n\n<pre><code>let storeHM = case storeJson of\n                Object h -&gt; h\n</code></pre>\n\n<p>You should ensure to handle other constructors here properly, of course, since this will crash if <code>storeJson</code> isn't constructed with <code>Object</code>.</p></li>\n<li><p>Convert <code>productJson</code> to a <code>Value</code>. One of <code>Value</code>'s constructors is <code>Array :: Vector Value -&gt; Value</code> and you can get a <code>Vector Value</code> from <code>[Value]</code> using <code>Data.Vector.fromList</code>:</p>\n\n<pre><code>import qualified Data.Vector as V\n[...]\nlet productsValue = Array (V.fromList productsJson)\n</code></pre></li>\n<li><p>Finally, insert <code>productsValue</code> into the <code>storeHM</code> <code>HashMap</code>:</p>\n\n<pre><code>let storeHMWithProducts = HM.insert \"products\" productsValue storeHM\n</code></pre></li>\n</ol>\n\n<p>You can then proceed as you did, using <code>object</code> to convert <code>storeHMWithProducts</code> into a JSON <code>Value</code> again:</p>\n\n<pre><code>return $ object [\"data\" .= storeHMWithProducts]\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 40294742, "answer_count": 1, "score": 1, "last_activity_date": 1477606123, "creation_date": 1477598204, "last_edit_date": 1477605271, "question_id": 40293205, "link": "https://stackoverflow.com/questions/40293205/inject-a-list-of-json-values-into-a-hashmap", "title": "Inject a list of Json Values into a HashMap", "body": "<p>I have a <code>Product</code> referencing a <code>Store</code> model. \nI'd like the response of <code>/stores/1</code> to return a JSON that has also the referencing products. Something like:</p>\n\n<pre><code>{\n  data: {\n    storeName: \"Store1\",\n    id: 1\n    products: {\n       { productName : \"Product1\",  productPrice: 10},\n       { productName : \"Product2\",  productPrice: 100},\n    }\n  }\n}\n</code></pre>\n\n<p>I'm currently stuck on my Yesod handler with getting the products injected in the right place.</p>\n\n<pre><code>getStoreR :: StoreId -&gt; Handler Value\ngetStoreR storeId = do\n    store &lt;- runDB $ get404 storeId\n\n    products &lt;- runDB $ selectList [StoreId ==. storeId] []\n    let productsJson = [entityIdToJSON (Entity k r) | Entity k r &lt;- products]\n\n    let storeJson = entityIdToJSON (Entity storeId store)\n\n    -- Inject productsJson under \"products\" property fails\n    let storeJsonWithProducts = HM.insert \"products\" productsJson storeJson\n\n    return $ object [\"data\" .= storeJsonWithProducts]\n</code></pre>\n\n<p>fails with:</p>\n\n<pre><code>Couldn't match expected type \u2018HM.HashMap k0 [Value]\u2019\n            with actual type \u2018Value\u2019\nRelevant bindings include\n  storeJsonWithProducts :: HM.HashMap k0 [Value]\n    (bound at Main.hs:80:9)\nIn the third argument of \u2018HM.insert\u2019, namely \u2018storeJson\u2019\nIn the expression: HM.insert \"products\" productsJson storeJson\n</code></pre>\n\n<p>(btw, I have created a single file app with this <a href=\"https://github.com/amitaibu/yesod-restful-example/blob/98e82a51e19a8fb0486b4c5ac81a2344a2076778/Main.hs#L79-L80\" rel=\"nofollow\">here</a>)</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1477591139, "post_id": 40291206, "comment_id": 67840851, "body": "<code>&lt;$&gt;</code> is just infix <code>fmap</code>: <code>f &lt;$&gt; x = fmap f x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1477594049, "post_id": 40291350, "comment_id": 67842455, "body": "Nitpick: in this case there is no wrapping and unwrapping going on &quot;behind the scenes&quot;. The instances you mention are available for bare functions, so the <code>Reader</code> wrapper (which exists primarily to provide extra clarity and readability) is not involved here."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1477594105, "post_id": 40291350, "comment_id": 67842478, "body": "@duplode Yeah, I see that is unclear. I&#39;ll add that, thank you."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 5, "last_activity_date": 1477594164, "last_edit_date": 1477594164, "creation_date": 1477591306, "answer_id": 40291350, "question_id": 40291206, "link": "https://stackoverflow.com/questions/40291206/haskell-what-does-type-f-a-actually-mean/40291350#40291350", "title": "Haskell: What does type f a actually mean?", "body": "<p>The functor <code>f</code> in your example is the so-called \"reader functor\", which is defined like this:</p>\n\n<pre><code>newtype Reader r = Reader (r -&gt; a)\n</code></pre>\n\n<p>Of course, in Haskell, this is implemented natively for functions, so there is no wrapping or unwrapping at runtime.</p>\n\n<p>The corresponding <code>Functor</code> and <code>Applicative</code> instances look like this:</p>\n\n<pre><code>instance Functor f where\n  fmap :: (a -&gt; b) -&gt; (r -&gt; a)_-&gt; (r -&gt; b)\n  fmap f g = \\x -&gt; f (g x) -- or: fmap = (.)\n\ninstance Applicative f where\n  pure :: a -&gt; (r -&gt; a) -- or: a -&gt; r -&gt; a\n  pure x = \\y -&gt; x -- or: pure = const\n  (&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n  frab &lt;*&gt; fra = \\r -&gt; frab r (fra r)   \n</code></pre>\n\n<p>In a way, the reader functor is a \"box\" too, like all the other functors, having a context <code>r</code> which produces a type <code>a</code>.</p>\n\n<p>So let's look at <code>(,) &lt;$&gt; sum</code>:</p>\n\n<pre><code>:t (,) :: a -&gt; b -&gt; (a, b)\n:t fmap :: (d -&gt; e) -&gt; (c -&gt; d) -&gt; (c -&gt; e)\n:t sum :: Foldable t, Num f =&gt; t f -&gt; f\n</code></pre>\n\n<p>We can now specialize the <code>d</code> type to <code>a ~ f</code>, <code>e</code> to <code>b -&gt; (a, b)</code> and <code>c</code> to <code>t f</code>. Now we get:</p>\n\n<pre><code>:t (&lt;$&gt;) -- spcialized for your case\n:: Foldable t, Num f =&gt; (a -&gt; (b -&gt; (a, b))) -&gt; (t f -&gt; f) -&gt; (t f -&gt; (b -&gt; (a, b)))\n:: Foldable t, Num f =&gt; (f -&gt; b -&gt; (f, b)) -&gt; (t f -&gt; f) -&gt; (t f -&gt; b -&gt; (f, b))\n</code></pre>\n\n<p>Applying the functions:</p>\n\n<pre><code>:t (,) &lt;$&gt; sum\n:: Foldable t, Num f =&gt; (t f -&gt; b -&gt; (f, b))\n</code></pre>\n\n<p>Which is exactly what ghc says.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1477601268, "creation_date": 1477601268, "answer_id": 40293950, "question_id": 40291206, "link": "https://stackoverflow.com/questions/40291206/haskell-what-does-type-f-a-actually-mean/40293950#40293950", "title": "Haskell: What does type f a actually mean?", "body": "<p>The short answer is that <code>f ~ (-&gt;) (t a)</code>. To see why, just rearrange the type signature for <code>sum</code> slightly, using <code>-&gt;</code> as a prefix operator instead of an infix operator.</p>\n\n<pre><code>sum :: (Foldable t, Num a) =&gt; (-&gt;) (t a) a\n                              ~~~~~~~~~~\n                                  f\n</code></pre>\n\n<hr>\n\n<p>In general, <code>(-&gt;) r</code> is a functor for any argument type <code>r</code>.</p>\n\n<pre><code>instance Functor ((-&gt;) r) where\n    fmap = (.)\n</code></pre>\n\n<p>It's easy to show that <code>(.)</code> is the only possible implementation for <code>fmap</code> here by plugging <code>((-&gt;) r)</code> into the type of <code>fmap</code> for <code>f</code>:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n     :: (a -&gt; b) -&gt; ((-&gt;) r) a -&gt; ((-&gt;) r) b\n     :: (a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>This is the type signature for composition, and composition is the unique function that has this type signature.</p>\n\n<hr>\n\n<p>Since <code>Data.Functor</code> defines <code>&lt;$&gt;</code> as an infix version of <code>fmap</code>, we have</p>\n\n<pre><code>(,) &lt;$&gt; sum == fmap (,) sum\n            == (.) (,) sum\n</code></pre>\n\n<p>From here, it is a relatively simple, though tedious, job of confirming that the resulting type is, indeed, <code>(Foldable t, Num a) =&gt; t a -&gt; b -&gt; (a, b)</code>.  We have</p>\n\n<pre><code>(b' -&gt; c') -&gt; (a' -&gt; b') -&gt; (a' -&gt; c')  -- composition\nb' -&gt; c' ~ a -&gt; b -&gt; (a,b)              -- first argument (,)\na' -&gt; b' ~ t n -&gt; n                     -- second argument sum\n----------------------------------------------------------------\na' ~ t n\nb' ~ a ~ n\nc' ~ a -&gt; b -&gt; (a,b)\n----------------------------------------------------------------\na' -&gt; c' ~ t a -&gt; b -&gt; (a,b)\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 705, "favorite_count": 0, "accepted_answer_id": 40291350, "answer_count": 2, "score": 6, "last_activity_date": 1477624187, "creation_date": 1477590736, "last_edit_date": 1477624187, "question_id": 40291206, "link": "https://stackoverflow.com/questions/40291206/haskell-what-does-type-f-a-actually-mean", "title": "Haskell: What does type f a actually mean?", "body": "<p>I have stumbled on this piece of code <code>fold ((,) &lt;$&gt; sum &lt;*&gt; product)</code> with type signature <code>:: (Foldable t, Num a) =&gt; t a -&gt; (a, a)</code> and I got completely lost.</p>\n\n<p>I know what it does, but I don't know how. So I tried to break it into little pieces in ghci:</p>\n\n<pre><code>\u03bb: :t (&lt;$&gt;)\n(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n\u03bb: :t (,)\n(,) :: a -&gt; b -&gt; (a, b)\n\u03bb: :t sum\nsum :: (Foldable t, Num a) =&gt; t a -&gt; a\n</code></pre>\n\n<p>Everything is okay, just basic stuff.</p>\n\n<pre><code>\u03bb: :t (,) &lt;$&gt; sum\n(,) &lt;$&gt; sum :: (Foldable t, Num a) =&gt; t a -&gt; b -&gt; (a, b)\n</code></pre>\n\n<p>And I am lost again...</p>\n\n<p>I see that there is some magic happening that turns <code>t a -&gt; a</code> into <code>f a</code> but how it is done is mystery to me. (<code>sum</code> is not even instance of <code>Functor</code>!)</p>\n\n<p>I have always thought that <code>f a</code> is some kind of box <code>f</code> that contains <code>a</code> but it looks like the meaning is much deeper.</p>\n"}, {"tags": ["haskell", "monads", "maybe"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1477581932, "post_id": 40288303, "comment_id": 67835233, "body": "It should be clear that you can&#39;t do this in general, because the input and output types may vary. You can write a function of type <code>(a -&gt; Maybe a) -&gt; a -&gt; a</code> but not <code>(a -&gt; Maybe b) -&gt; a -&gt; b</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1477582099, "post_id": 40288303, "comment_id": 67835348, "body": "I&#39;d first turn <code>[Int -&gt; Maybe Int]</code> into <code>[Int -&gt; Int]</code> using <code>fromMaybe</code> as you did. After that, I&#39;d compose the list of endos."}, {"owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "edited": false, "score": 1, "creation_date": 1477582791, "post_id": 40288303, "comment_id": 67835864, "body": "<code>foldr1 (&gt;=&gt;) [a, b, c]</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "edited": false, "score": 0, "creation_date": 1477586608, "post_id": 40288303, "comment_id": 67838319, "body": "@AlexanderVoidExRuchkin That has a different semantics from <code>\\i -&gt; e i [a,b,c]</code> (where <code>e</code> is defined above in the question)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477587040, "post_id": 40288303, "comment_id": 67838584, "body": "<code>e = fromMaybe 75 . foldr1 (&gt;=&gt;) [a,b,c]</code>, though."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1477590304, "post_id": 40288303, "comment_id": 67840380, "body": "<code>e = \\i es -&gt; fromMaybe i $ foldr (\\fn fns -&gt; fns &gt;=&gt; liftA2 (&lt;|&gt;) fn return) pure es i</code>, and it actually generalizes quite nicely: <code>\\i es -&gt; foldr (\\fn fns -&gt; fns &gt;=&gt; liftA2 (&lt;|&gt;) fn return) pure es i</code> works for any <code>(Foldable f, Alternative m) =&gt; f (b -&gt; m b)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1477599646, "post_id": 40288303, "comment_id": 67845483, "body": "I hope your real <code>a</code>, <code>b</code>, and <code>c</code> are more complicated, or else you could just write <code>e = const</code> and be done with it."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1477603735, "post_id": 40288303, "comment_id": 67847381, "body": "@DanielWagner Yes, this is just a minimal example."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477586517, "post_id": 40288787, "comment_id": 67838256, "body": "This does something different from the OP code. The OP code, when <code>a x</code> returns <code>Nothing</code>, feeds <code>x</code> to <code>b</code>. Monadic chaining does not do that."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1477582589, "creation_date": 1477582589, "answer_id": 40288787, "question_id": 40288303, "link": "https://stackoverflow.com/questions/40288303/is-there-a-a-predefined-way-to-skip-calculations-that-result-in-nothing/40288787#40288787", "title": "Is there a a predefined way to skip calculations that result in Nothing?", "body": "<p>Are you looking for the maybe monad?</p>\n\n<pre><code>*Main&gt; let f x = a x &gt;&gt;= b &gt;&gt;= c &gt;&gt; return x\n*Main&gt; f 1\nJust 1\n*Main&gt; f 100\nNothing\n*Main&gt;\n</code></pre>\n\n<p>Then if the result is Nothing we can get to your desired end state with <code>fromMaybe</code> (or just <code>maybe</code> and <code>id</code>, same thing):</p>\n\n<pre><code>*Main&gt; let g x = maybe x id (f x)\n*Main&gt; g 100\n100\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1477587339, "last_edit_date": 1477587339, "creation_date": 1477586599, "answer_id": 40290082, "question_id": 40288303, "link": "https://stackoverflow.com/questions/40288303/is-there-a-a-predefined-way-to-skip-calculations-that-result-in-nothing/40290082#40290082", "title": "Is there a a predefined way to skip calculations that result in Nothing?", "body": "<p>Well, you can create a <code>a -&gt; a</code> from a <code>a -&gt; Maybe a</code>:</p>\n\n<pre><code>repair :: (a -&gt; Maybe a) -&gt; a -&gt; a\nrepair f x = fromMaybe x (f x)\n</code></pre>\n\n<p>Afterwards, you can just combine <code>(.)</code> and <code>repair</code>:</p>\n\n<pre><code>andThen :: (a -&gt; Maybe a) -&gt; (a -&gt; Maybe a) -&gt; a -&gt; a\nandThen f g = repair g . repair f\n</code></pre>\n\n<p>But there's no library function for that, since there is no general way to get a value out of a <code>Monad</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1477590322, "post_id": 40290279, "comment_id": 67840395, "body": "<code>e = appEndo . foldMap (Endo . totalize)</code>?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1477603735, "post_id": 40290279, "comment_id": 67847382, "body": "You can also do it without the <code>Endo</code> abstraction: <code>compose = foldr (.) id; e = compose . map totalize</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1477593446, "last_edit_date": 1477593446, "creation_date": 1477587288, "answer_id": 40290279, "question_id": 40288303, "link": "https://stackoverflow.com/questions/40288303/is-there-a-a-predefined-way-to-skip-calculations-that-result-in-nothing/40290279#40290279", "title": "Is there a a predefined way to skip calculations that result in Nothing?", "body": "<p>Expanding my comment above -- this approach is not too different from the code the OP posted.</p>\n\n<p>We first define how to turn a function <code>a -&gt; Maybe a</code> into <code>a -&gt; a</code>, substituting the input for <code>Nothing</code>.</p>\n\n<pre><code>totalize :: (a -&gt; Maybe a) -&gt; (a -&gt; a)\ntotalize f x = fromMaybe x (f x)\n</code></pre>\n\n<p>Then, we exploit the above: we make every function \"total\" (meaning no-<code>Nothing</code>s), wrap it as an <code>Endo</code>, then we compose the list of endomorphisms (<code>mconcat</code> is composition in the <code>Endo</code> monoid).</p>\n\n<pre><code>e :: [a -&gt; Maybe a] -&gt; a -&gt; a\ne = appEndo . mconcat . map (Endo . totalize)\n</code></pre>\n\n<p>or even (as suggested below)</p>\n\n<pre><code>e :: Foldable t =&gt; t (a -&gt; Maybe a) -&gt; a -&gt; a\ne = appEndo . foldMap (Endo . totalize)\n</code></pre>\n"}], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 40290279, "answer_count": 3, "score": 5, "last_activity_date": 1477593446, "creation_date": 1477581212, "question_id": 40288303, "link": "https://stackoverflow.com/questions/40288303/is-there-a-a-predefined-way-to-skip-calculations-that-result-in-nothing", "title": "Is there a a predefined way to skip calculations that result in Nothing?", "body": "<p>I have a these three functions    </p>\n\n<pre><code>a :: Int -&gt; Maybe Int\na i = if i &lt; 100 then Just i else Nothing\n\nb :: Int -&gt; Maybe Int\nb i = if i &lt; 50 then Just i else Nothing\n\nc :: Int -&gt; Maybe Int\nc i = if i &gt; 0 then Just i else Nothing\n</code></pre>\n\n<p>And I want to chain them together so that when the result of one function results in a <code>Nothing</code> the input of that function is returned instead.</p>\n\n<p>I can achieve this with this function:</p>\n\n<pre><code>import Data.Maybe (fromMaybe)\n\ne :: Int -&gt; [Int -&gt; Maybe Int] -&gt; Int\ne i [] = i\ne i (f:fs) = e (fromMaybe i $ f i) fs\n</code></pre>\n\n<p>-</p>\n\n<pre><code>*Main&gt; e 75 [a,b,c]\n75\n</code></pre>\n\n<p>Is there an existing function, Monad instance, or other way in the base libraries that exhibits this behavior? </p>\n"}, {"tags": ["haskell", "exception"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1477587933, "post_id": 40288287, "comment_id": 67839072, "body": "I don&#39;t think there&#39;s a general way which can do that without having to change the exception-throwing code. I think you have to rework it so that e.g. you call <code>show</code>, evaluate char-by-char the result, expecting some exception at every step. You could write <code>foo :: String -&gt; IO (String, Maybe Exception)</code> so that the resulting string is the longest non-exceptional prefix, and any possible exception is reported."}, {"owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1477588173, "post_id": 40288287, "comment_id": 67839215, "body": "@chi I had some similar thoughts. But can you, please, explain how to evaluate the result char-by-char?"}], "answers": [{"comments": [{"owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "edited": false, "score": 0, "creation_date": 1477640325, "post_id": 40290672, "comment_id": 67858218, "body": "Thanks a lot, this is exactly what I need. For somebody who wants to use it: to make the code work replace, <code>Exception</code> by, for example, <code>SomeException</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1477656873, "last_edit_date": 1477656873, "creation_date": 1477588790, "answer_id": 40290672, "question_id": 40288287, "link": "https://stackoverflow.com/questions/40288287/haskell-getting-more-informative-exceptions/40290672#40290672", "title": "Haskell: getting more informative exceptions", "body": "<p>You could exploit something like: (untested)</p>\n\n<pre><code>safePrefix :: String -&gt; IO (String, Maybe SomeException)\nsafePrefix s = do\n   r1 &lt;-try (evaluate s)\n   case r1 of\n      Left exc -&gt; return (\"\", Just exc)\n      Right \"\" -&gt; return (\"\", Nothing)\n      Right (x:xs) -&gt; do\n         r2 &lt;- try (evaluate x)\n         case r2 of\n            Left exc -&gt; return (\"\", Just exc)\n            Right x' -&gt; do\n               (p, exc) &lt;- safePrefix xs\n               return (x':p, exc)\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 40290672, "answer_count": 1, "score": 2, "last_activity_date": 1477656873, "creation_date": 1477581161, "question_id": 40288287, "link": "https://stackoverflow.com/questions/40288287/haskell-getting-more-informative-exceptions", "title": "Haskell: getting more informative exceptions", "body": "<p>Suppose I have two functions:\n</p>\n\n<pre><code>not_force_eval :: IO (Either SomeException [[[Integer]]])\nnot_force_eval = (try $ evaluate [[[3 + 4, 6 * 2, 5 `div` 0]]])\n                    :: IO (Either SomeException [[[Integer]]])\n\nforce_eval :: IO (Either SomeException [[[Integer]]])\nforce_eval = (try $ evaluate $!! [[[3 + 4, 6 * 2, 5 `div` 0]]]) \n                    :: IO (Either SomeException [[[Integer]]])\n</code></pre>\n\n<p><code>force_eval</code> is almost the same as <code>not_force-eval</code> except for having <code>($!!)</code>, that's why the expression <code>[[[3 + 4, 6 * 2, 5 `div` 0]]]</code> is force evaluated. </p>\n\n<p>Then I try to find out whether my fuctions throw any exceptions. \n</p>\n\n<pre><code>show_res = do\n    res &lt;- force_eval\n    case res of\n        Left exc   -&gt; print $ displayException exc\n        Right smth -&gt; print smth\n</code></pre>\n\n<p>And running <code>show_res</code> I get:</p>\n\n<blockquote>\n  <p>\"divide by zero\"</p>\n</blockquote>\n\n<p>then I replace <code>force_eval</code> by <code>not_force_eval</code>\n</p>\n\n<pre><code>show_res = do\n    res &lt;- not_force_eval\n    case res of\n        Left exc   -&gt; print $ displayException exc\n        Right smth -&gt; print smth\n</code></pre>\n\n<p>Running <code>show_res</code> I obviously get:</p>\n\n<blockquote>\n  <p>[[[7,12,*** Exception: divide by zero</p>\n</blockquote>\n\n<p>So, the question: is there any way to get the result that has been evaluated before the exception is thrown? For example, I'd like to make a string like:</p>\n\n<blockquote>\n  <p>\"divide by zero; [[[7,12, ...\"</p>\n</blockquote>\n"}, {"tags": ["haskell", "functional-programming", "algebraic-data-types", "type-theory"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1477582137, "post_id": 40288168, "comment_id": 67835379, "body": "This question is very broad. In the first case you could simply interpret <code>Neg n</code> as denoting <code>-(n+1)</code>. In the second, if you want <code>Rational 1 2 == Rational 2 4</code> to hold judgmentally, you need <a href=\"http://jozefg.bitbucket.org/posts/2014-10-17-quotients.html\" rel=\"nofollow noreferrer\">quotient types</a> which don&#39;t feature in Haskell"}], "answers": [{"comments": [{"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1477584304, "post_id": 40288725, "comment_id": 67836894, "body": "Thx a lot, I think this answer is exactly what I want. But I still want to know what is  <a href=\"http://jozefg.bitbucket.org/posts/2014-10-17-quotients.html\" rel=\"nofollow noreferrer\">quotient types</a>  which  @Benjamin Hodgson has mentioned about (in the comment of this problem), and if dependent type can handle all these problems, why we need the quotient types?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1477593238, "post_id": 40288725, "comment_id": 67842057, "body": "@luochen1990 well, quotient types essentially fix the ambiguity of implementation-different values that are supposed to form an equivalence class <i>on the language-level</i>. You can always fake this on the code level, and with dependent types you can in fact kind of <i>implement</i> it in the types."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1478209075, "last_edit_date": 1478209075, "creation_date": 1477582407, "answer_id": 40288725, "question_id": 40288168, "link": "https://stackoverflow.com/questions/40288168/is-there-any-way-to-restrain-the-adt-data-so-that-only-the-valid-data-could-be-c/40288725#40288725", "title": "Is there any way to restrain the ADT data so that only the valid data could be constructed?", "body": "<p>For integers this is very easy:</p>\n\n<pre><code>data Nat = Zero | Positive Pos\ndata Pos = One | Succ Pos\ndata Int = Pos Nat | Neg Pos\n</code></pre>\n\n<p>Alternatively you could just stay with <code>Int = Pos Nat | Neg Nat</code> but interpret <code>Neg n</code> to represent <code>-(n+1)</code> instead of <code>-n</code>, so \u201c<code>-0</code>\u201d won't be possible.</p>\n\n<p>For rationals it's more tricky. I think it's usually the best thing to just leave these non-normalised values implementationally possible but semantically consider only equivalence classes of these values, or normalise them using a smart constructor. That's certainly the approach that <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Ratio.html\" rel=\"nofollow noreferrer\"><code>Rational</code></a> takes.<br>\nIt <em>is</em> possible to restrict the definition so only a single representative of each equivalenct class exists. This is <a href=\"https://agda.github.io/agda-stdlib/Data.Rational.html\" rel=\"nofollow noreferrer\">how Agda defines the rationals:</a></p>\n\n<pre><code>record \u211a : Set where\n  field\n    numerator     : \u2124\n    denominator-1 : \u2115\n    isCoprime     : True (C.coprime? \u2223 numerator \u2223 (suc denominator-1))\n\n  denominator : \u2124\n  denominator = + suc denominator-1\n\n  coprime : Coprime numerator denominator\n  coprime = toWitness isCoprime\n</code></pre>\n\n<p>So, it basically just encodes the gcd \u2261 1 condition in its dependent type system. Lucky those who have such a type system...</p>\n\n<p>I don't know how well such a definition could be translated to Haskell. It should be possible <em>somehow</em>, but I doubt it's feasible.</p>\n\n<p>One solution that would definitely work but probably be very inefficient is to <a href=\"http://www.cs.utexas.edu/users/sandip/acl2-09/presentations/rationals-talk.pdf\" rel=\"nofollow noreferrer\">enumerate all rational numbers</a>, and simply store just the index of that enumeration as a single <code>Nat</code>. Or rather implement that Calkin-Wilf tree of all positive rationals:</p>\n\n<pre><code>data PosRational = UnitRatio\n                 | RatSucc PosRational\n                 | RecipSucc PosRational\n</code></pre>\n\n<p>The interesting thing would be how to define the <code>Num</code> etc. instances for that. Let's see...</p>\n\n<pre><code>instance Fractional PosRational where\n  recip UnitRatio = UnitRatio\n  recip (RecipSucc x) = RatSucc $ recip x\n  recip (RatSucc x) = RecipSucc $ recip x\n\ninstance Num PosRational where\n  UnitRatio + x = RatSucc x\n  x + UnitRatio = RatSucc x\n  RatSucc x + y = RatSucc $ x + y\n  x + RatSucc y = RatSucc $ x + y\n  RecipSucc (RecipSucc x) + RecipSucc (RecipSucc y)\n   -- = recip (1 + 1 + x) + recip (1 + 1 + y)\n   -- = (2+y + 2+x) / ((2+x)*(2+y))\n   -- = (4 + x + y) / (4 + 2*x + 2*y + x*y)\n   -- = 1 / (1 + (x+y+x*y)/(4+x+y))\n      = RecipSucc $ (4+x+y)/(x+y+x*y)\n  RecipSucc (RatSucc x) + RecipSucc (RatSucc y)\n   -- = recip (1 + recip (1+x)) + recip (1 + recip (1+y))\n   -- = (1+x) / (1+x + 1) + (1+y) / (1+y + 1)\n   -- = ((1+x)*(2+y)+(1+y)*(2+x)) / ((2+x)*(2+y))\n   -- = (2+2*x+y+x*y + 2+x+2*y+x*y) / (4+2*x+2*y+x*y)\n   -- = (4 + 3*x + 3*y + 2*x*y) / (4+2*x+2*y+x*y)\n   -- = (4+2*x+2*y+x*y + x+y+x*y) / (4+2*x+2*y+x*y)\n   -- = 1 + (x+y+x*y) / (4+2*x+2*y+x*y)\n   -- = 1 + 1 / (1 + (4+x+y)/(x+y+x*y))\n      = RatSucc . RecipSucc $ (4+x+y)/(x+y+x*y)\n  ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1477584832, "last_edit_date": 1477584832, "creation_date": 1477582470, "answer_id": 40288746, "question_id": 40288168, "link": "https://stackoverflow.com/questions/40288168/is-there-any-way-to-restrain-the-adt-data-so-that-only-the-valid-data-could-be-c/40288746#40288746", "title": "Is there any way to restrain the ADT data so that only the valid data could be constructed?", "body": "<p>Mathematically, integers would be defined from natural numbers in the same way rationals are defined from integers: as a pair of natural numbers, but with the <em>difference</em> being the defining factor.</p>\n\n<pre><code>data MyInt = I Nat Nat\n-- I (Succ Zero) Zero is 1\n-- I Zero (Succ Zero) is -1\n</code></pre>\n\n<hr>\n\n<p>Now, we have the same problem for both, which is that <code>I</code> and <code>Rational</code> both can create multiple distinct but <em>equivalent</em> values. You could just ignore this and define all your operations to handle it. Here are simple <code>Eq</code> instances for each:</p>\n\n<pre><code>-- for reference\ninstance Eq Nat where\n  Zero == Zero = True\n  (Succ n1) == (Succ n2) = n1 == n2\n  _ == _ = False\n\n-- No Num instance for Nat, since you can't negate a Nat\nnatAdd (Succ n) m = Succ (natAdd n m)\nnatAdd Zero m = m\n\ninstance Eq MyInt where\n  (I a b) == (I c d) = a `natAdd` d == b `natAdd` c\n\n-- Assuming an appropriate Num MyInt instance for (*)\ninstance Eq Rational where\n  (Rational n1 d1) == (Rational n2 d2) = n1 * d2 == n2 * d1\n</code></pre>\n\n<p>For other operations, the actual value used to represent an integer doesn't really matter. Here's part of the <code>Num</code> instance for <code>MyInt</code>, where we work with the relative difference between the pair, not caring about the pair itself.</p>\n\n<pre><code>instance Num MyInt where\n\n  negate (I a b) = I b a\n  signum (I a b) | a == b = I Zero\n                 | a &gt; b = I (Succ Zero) Zero\n                 | otherwise = I Zero (Succ Zero)\n  abs (I a b) | a &gt;= b = I a b\n              | otherwise  = I b a\n (I a b) + (I c d) == I (a `natAdd` c) (b `natAdd` d)\n (I a b) * (I c d) == ... -- you get the idea\n</code></pre>\n\n<hr>\n\n<p>Or, you can avoid the use of the constructor directly and only allow values to be created via smart constructors. This way, only one canonical representation can be created for each integer/rational value.</p>\n\n<pre><code>-- Ensure that Zero is always used as a base for\n-- defining an integer\nmkInt :: Nat -&gt; Nat -&gt; MyInt\nmkInt a b | a &gt; b = I (a - b) Zero\n          | otherwise = I Zero (b - a)\n\n-- assuming gcd :: MyInt -&gt; MyInt -&gt; MyInt is defined somewhere\nmkRat :: MyInt -&gt; MyInt -&gt; Rational\nmkRat n d :: Rational (gcd n d) intOne\n             where intOne = mkInt (Succ Zero) Zero\n</code></pre>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1478209075, "creation_date": 1477580823, "last_edit_date": 1477582219, "question_id": 40288168, "link": "https://stackoverflow.com/questions/40288168/is-there-any-way-to-restrain-the-adt-data-so-that-only-the-valid-data-could-be-c", "title": "Is there any way to restrain the ADT data so that only the valid data could be constructed?", "body": "<p>When I want to define <strong>Integer</strong>, I tried this </p>\n\n<pre><code>data Int = Pos Nat | Neg Nat\ndata Nat = Zero | Succ Nat\n</code></pre>\n\n<p>but after written down the above codes, I found that both <code>Pos Zero</code> and <code>Neg Zero</code> are possible to be constructed, which is not expected.</p>\n\n<p>And  when I want to define <strong>Rational</strong>, the same problem occurs again</p>\n\n<pre><code>data Rational = Rational Int Int \n</code></pre>\n\n<p>I\u2019m expecting that for any <code>Rational n m</code>, it should satisfy <code>m &gt; 0 &amp;&amp; gcd n m == 1</code> </p>\n\n<p>But I have known no way to make sure that my ADT data satisfies these properties. So when I\u2019m writing some functions which process it as input, I have to consider these Illegal situations. <strong>I hope that there is some way I can define the properties once when the ADT is defined, instead of checking the properties each time when I\u2019m using it</strong>.</p>\n"}, {"tags": ["haskell", "memory", "profiling", "bytestring", "memory-profiling"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1477578242, "post_id": 40285384, "comment_id": 67832586, "body": "The profile says <code>202,383,488 bytes maximum residency</code> which means your program did not use more than 202MB of memory within its lifetime at any given instant (that little spike all the way at the end - seems about right to me). <code>635 MB total memory in use</code> again refers to a maximum (not a total!!) - specifically, the maximum amount of memory the OS allocated to the program. The .hp graph only measure the memory which the GC is aware of - if you GC&#39;ed some memory but the OS did not reclaim it yet, you would see the higher memory usage in e.g. <code>docker stats</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1477578828, "post_id": 40285384, "comment_id": 67833012, "body": "The <a href=\"https://downloads.haskell.org/~ghc/6.12.1/docs/html/users_guide/prof-heap.html#mem-residency\" rel=\"nofollow noreferrer\">ghc user guide</a> gives several explanations as to why residency reported by OS tools will differ from that of the GHC profiler. tl;dr don&#39;t worry about the disrepency, this is the profiler doing it&#39;s job (trying to eliminate sources of memory allocation which you do not control and cannot possible affect in your program, i.e. the garbage collecter, the runtime itself)"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1477582023, "post_id": 40285384, "comment_id": 67835294, "body": "I&#39;m not sure I understand what the problem is here. Is it that 202 \u2260 635? Those numbers measure different things, and will normally be different. For more discussion see this recent question: <a href=\"http://stackoverflow.com/questions/40044364/making-sense-from-ghc-profiler\" title=\"making sense from ghc profiler\">stackoverflow.com/questions/40044364/&hellip;</a>"}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1477586339, "post_id": 40285384, "comment_id": 67838153, "body": "@ReidBarton You&#39;re right I had mixed up the two quantities. There is also the amount of memory measured from the docker stats -  around 650 Mb as well coincidentally - but user2407038 had some comments on why that one is larger."}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1477573582, "creation_date": 1477573582, "last_edit_date": 1495542801, "question_id": 40285384, "link": "https://stackoverflow.com/questions/40285384/haskell-profiler-sees-too-little-memory-use", "title": "Haskell profiler sees too little memory use", "body": "<p>I'm trying to debug a program that uses too much memory. I've got the profiling running and use the run time options <code>-s -p -h -xt</code>. Then I use <code>hp2ps</code> to plot the resulting <code>.hp</code> file:</p>\n\n<p><a href=\"https://i.stack.imgur.com/hAVsg.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hAVsg.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>However the actual memory usage is somewhere around 650 Mb (the program is running in a docker container and I see this using <code>docker stats</code>.</p>\n\n<p>The <code>-s</code> option gives me this output, which confirms the 650 Mb:</p>\n\n<pre><code>157,666,975,520 bytes allocated in the heap\n 311,897,256 bytes copied during GC\n 202,383,488 bytes maximum residency (609 sample(s))\n  64,558,856 bytes maximum slop\n         635 MB total memory in use (200 MB lost due to fragmentation)\n\n                                 Tot time (elapsed)  Avg pause  Max pause\nGen  0     301713 colls,     0 par    1.932s   1.803s     0.0000s    0.0022s\nGen  1       609 colls,     0 par    2.743s   2.694s     0.0044s    0.0104s\n\nTASKS: 5 (1 bound, 4 peak workers (4 total), using -N1)\n\nSPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\nINIT    time    0.001s  (  0.001s elapsed)\nMUT     time   64.448s  ( 84.663s elapsed)\nGC      time    4.499s  (  4.320s elapsed)\nRP      time    0.000s  (  0.000s elapsed)\nPROF    time    0.176s  (  0.177s elapsed)\nEXIT    time    0.001s  (  0.001s elapsed)\nTotal   time   69.137s  ( 88.985s elapsed)\n\nAlloc rate    2,446,431,692 bytes per MUT second\n\nProductivity  93.2% of total user, 72.4% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>Reading <a href=\"http://neilmitchell.blogspot.ie/2013/02/chasing-space-leak-in-shake.html\" rel=\"nofollow noreferrer\">this post</a> it seems like a similar problem was resolved using the options <code>-xt -hy</code>, but that didn't work for me (and gave me even less information in the plot). I've also tried solutions suggested in <a href=\"https://stackoverflow.com/questions/24939604/debugging-a-memory-leak-that-doesnt-show-on-heap-profiling\">this</a>, <a href=\"https://stackoverflow.com/questions/20478805/what-does-pinned-mean-in-hc-profile-of-haskell-program\">this</a> and <a href=\"https://stackoverflow.com/questions/5306717/how-should-i-interpret-the-output-of-the-ghc-heap-profiler\">this</a> question.</p>\n\n<p>I suspect that a function using <code>ByteString</code> is responsible because it uses <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/GC/Pinned\" rel=\"nofollow noreferrer\">pinned memory</a>: </p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 2, "creation_date": 1477572999, "post_id": 40284854, "comment_id": 67828708, "body": "&quot;I&#39;m supposed to write a program which checks whether two word have the same vowels.&quot;  What does that mean exactly? Same set of vowels? Same counts for all vowels? Same vowels in the same order?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1477573023, "post_id": 40284854, "comment_id": 67828723, "body": "So far, your attempt is going in the direction of  checking that the two strings have <i>a</i> vowel in the same position, the not the <i>same</i> vowel."}, {"owner": {"reputation": 149, "user_id": 6304666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0cabb73627f77addcd1cca45659d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Readler", "link": "https://stackoverflow.com/users/6304666/readler"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1477574247, "post_id": 40284854, "comment_id": 67829548, "body": "@Thilo It means the same set of vowels in the same order. I&#39;m sorry for the confusion. So <code>vowelEq apple angle</code> should thus return <code>True</code>.     @chepner Welp, you&#39;re right! Hadn&#39;t thought of that! I don&#39;t have a particular idea of fixing that right now, but changing <code>vowelCheck</code> in a way that it returns another <code>Char</code> which then get compared should do the job, right?"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 6304666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0cabb73627f77addcd1cca45659d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Readler", "link": "https://stackoverflow.com/users/6304666/readler"}, "edited": false, "score": 0, "creation_date": 1477573167, "post_id": 40285049, "comment_id": 67828822, "body": "Yes! That was exactly what I wanted to do, however I thought that wouldn&#39;t work since tail returns a list and not a string."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 149, "user_id": 6304666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0cabb73627f77addcd1cca45659d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Readler", "link": "https://stackoverflow.com/users/6304666/readler"}, "edited": false, "score": 2, "creation_date": 1477573480, "post_id": 40285049, "comment_id": 67829014, "body": "@Readler: <code>type String = [Char]</code>. <code>String</code> is just another name for a list of characters, nothing more."}, {"owner": {"reputation": 149, "user_id": 6304666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0cabb73627f77addcd1cca45659d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Readler", "link": "https://stackoverflow.com/users/6304666/readler"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1477573770, "post_id": 40285049, "comment_id": 67829227, "body": "@chepner Well now I feel mighty stupid. So just to get back at my example, using <code>vowelEq(tail s1)</code> would then work to shorten the string each time? I&#39;d check it myself, but unfortunately I&#39;m on the road at the moment."}], "tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1477576315, "last_edit_date": 1477576315, "creation_date": 1477572649, "answer_id": 40285049, "question_id": 40284854, "link": "https://stackoverflow.com/questions/40284854/how-do-i-check-through-the-individual-strings-of-a-word-in-haskell/40285049#40285049", "title": "How do I check through the individual strings of a word in Haskell?", "body": "<p>You can use <code>tail s1</code> to get the rest of the string (which may be empty).</p>\n\n<p>Use that to call the function recursively with increasingly shorter strings (until the string is empty).</p>\n\n<blockquote>\n  <p>the same set of vowels in the same order.</p>\n</blockquote>\n\n<p>This means that you only need to look at the vowels: If a string starts with a non-vowel, you can just ignore that and continue with the <code>tail</code> for that string.</p>\n\n<blockquote>\n  <p>I had the idea to use tail recursively but that doesn't work with the signature of vowelEq</p>\n</blockquote>\n\n<p>Why not? The two tails are still two strings.</p>\n"}, {"tags": [], "owner": {"reputation": 11591, "user_id": 1097347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/efffb39e9e98d002a5b9afe2fde7e50d?s=128&d=identicon&r=PG", "display_name": "Uri Goren", "link": "https://stackoverflow.com/users/1097347/uri-goren"}, "is_accepted": false, "score": 1, "last_activity_date": 1477578991, "creation_date": 1477578991, "answer_id": 40287454, "question_id": 40284854, "link": "https://stackoverflow.com/questions/40284854/how-do-i-check-through-the-individual-strings-of-a-word-in-haskell/40287454#40287454", "title": "How do I check through the individual strings of a word in Haskell?", "body": "<p>Something like this should work:</p>\n\n<pre><code>isVowel c= or $ map (c==) ['a','A','e','E','i','I','o','O','U','u']\nvowelEq a b = (filter isVowel a) == (filter isVowel b)\n</code></pre>\n\n<p>And to test:</p>\n\n<pre><code>vowelEq \"behind\" \"rewind\"\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 6304666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0cabb73627f77addcd1cca45659d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Readler", "link": "https://stackoverflow.com/users/6304666/readler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1477578991, "creation_date": 1477572059, "last_edit_date": 1477572246, "question_id": 40284854, "link": "https://stackoverflow.com/questions/40284854/how-do-i-check-through-the-individual-strings-of-a-word-in-haskell", "title": "How do I check through the individual strings of a word in Haskell?", "body": "<p>So I have this task that I'm kind of struggling with right now. I'm supposed to write a program which checks whether two word have the same vowels.\nThat's it's signature:</p>\n\n<pre><code>vowelEq :: String -&gt; String -&gt; Bool\n</code></pre>\n\n<p>In order to do this, I made a function called vowelCheck, which basically checks if a Char is a vowel and returns a boolean accordingly.</p>\n\n<pre><code>vowelCheck :: Char -&gt; Bool\nvowelCheck v | (v == 'a' || v == 'A') = True\n             | (v == 'e' || v == 'E') = True\n             | (v == 'i' || v == 'I') = True\n             | (v == 'o' || v == 'O') = True\n             | (v == 'u' || v == 'U') = True\n             | otherwise = False\n</code></pre>\n\n<p>So far, that's what I've got:</p>\n\n<pre><code>vowelEq :: String -&gt; String -&gt; Bool\nvowelEq s1 s2 | vowelCheck(head(s1)) == vowelCheck(head(s2)) = True\n              | otherwise = False\n</code></pre>\n\n<p>It can only check whether the first Char of the word (head s1) is a vowel and if it's the same as on the other word. \nNow here's my problem: I don't know how to check the rest of the word. I had the idea to use tail recursively but that doesn't work with the signature of vowelEq (which I'm not allowed to change, mind you). Or just deleting the first element of the string would help tremendously, too.\nBut so far we've only learnt how to do very basic functions as well as how to declare data types, so not a whole lot of stuff.</p>\n\n<p>I'm a total beginner and that's the first task we got for class, so I'd appreciate it if you explained your advice and solution!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1477563213, "post_id": 40280784, "comment_id": 67822115, "body": "See <a href=\"http://stackoverflow.com/questions/11046590/the-seq-function-and-strictness\">this</a> for information on <code>seq</code> and why it is a 2-argument-function."}], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1477564542, "post_id": 40282150, "comment_id": 67822950, "body": "Can you elaborate why would evaluation of a thunk break the purity? I believe thunks and values are meant to be interchangeable and the difference is only in operational semantics. And this does not answer why <code>rpar</code> and <code>rseq</code> are made differently."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1477573286, "post_id": 40282150, "comment_id": 67828894, "body": "<code>rseq</code> and <code>rpar</code> create a dependency between the evaluation of the <code>Eval</code> value they return and the evaluation of their argument. This works in the context of <code>Eval</code>, because <code>(&gt;&gt;=)</code> for <code>Eval</code> forces evaluation of its first argument before passing a value to its second argument."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 0, "last_activity_date": 1477563791, "creation_date": 1477563791, "answer_id": 40282150, "question_id": 40280784, "link": "https://stackoverflow.com/questions/40280784/haskell-seq-par-rseq-rpar-signatures/40282150#40282150", "title": "Haskell: seq, par, rseq, rpar signatures", "body": "<p>To put it short, <code>seq</code> doen <em>not</em> evaluate its argument, it just introduces a dependency between <code>a</code> and <code>b</code>: whenever <code>b</code> is evaluated to WHNF, <code>a</code> is also evaluated.</p>\n\n<p><code>par</code> does this the same way: whenever <code>b</code> is evaluated <code>a</code> <em>may</em> be evaluated parallelly.</p>\n\n<p>This semantic is the reason why <code>seq a a</code> and hence <code>seq a</code> is useless. Also, allowing <code>seq</code> to directly evaluate <code>a</code> would break the purity.</p>\n"}, {"tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": true, "score": 3, "last_activity_date": 1477584408, "creation_date": 1477584408, "answer_id": 40289434, "question_id": 40280784, "link": "https://stackoverflow.com/questions/40280784/haskell-seq-par-rseq-rpar-signatures/40289434#40289434", "title": "Haskell: seq, par, rseq, rpar signatures", "body": "<p>There is already a function of type <code>a -&gt; a</code> that is strict, namely <code>id</code>.\nHaskell is non-strict, so the only reason a function is called is when you need the result of the function, so when <code>id y</code> is called you need that value.  In a similar way, when <code>seq x y</code> is called it's because you need that value.</p>\n\n<p>The operational semantics of <code>seq</code> is not specified in Haskell, which might be why you find it mysterious.  And easier function to understand is <code>pseq</code>.  The <code>pseq</code> function evaluates its first argument to WHNF and then returns its second argument.\nThe <code>seq</code> function might do the same as <code>pseq</code>, but it might also not.\nIt is defined by its denotational semantics instead (section 6.2 in the Haskell report):</p>\n\n<pre><code>seq \u22a5 b = \u22a5\nseq a b = b, if a /= \u22a5\n</code></pre>\n\n<p>From this we can conclude that <code>seq</code> is strict in both arguments.  For strict functions it's quite possible for the caller to evaluate the arguments since this makes no semantic difference.  So in a call to <code>seq</code> the caller might evaluate any combination of the arguments in any order.</p>\n"}], "owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 1, "accepted_answer_id": 40289434, "answer_count": 2, "score": 0, "last_activity_date": 1477584408, "creation_date": 1477560005, "last_edit_date": 1477560341, "question_id": 40280784, "link": "https://stackoverflow.com/questions/40280784/haskell-seq-par-rseq-rpar-signatures", "title": "Haskell: seq, par, rseq, rpar signatures", "body": "<p>I'm trying to understand parallelism in Haskell and one thing that I'm curious about is the signature difference between <code>seq</code> / <code>rseq</code> and <code>par</code> / <code>rpar</code></p>\n\n<pre><code>seq :: a -&gt; b -&gt; b\npar :: a -&gt; b -&gt; b\n\nrseq :: a -&gt; Eval a\nrpar :: a -&gt; Eval a\n</code></pre>\n\n<p>I understand that <code>rseq</code> and <code>rpar</code> are monadic versions so they bear the <code>Eval</code> part. <strong>But why aren't <code>seq</code> and <code>par</code> both just <code>a -&gt; a</code>?</strong> Kind of like strict identities... A reason for \"encomplication\" should exist.</p>\n\n<p>There also seems to be a lot of mystery around <code>seq</code>. Some sources say <code>a</code> is evaluated when <code>b</code> is evaluated (to WHNF). Other sources say <code>a</code> is evaluated at call time. It's really confusing! While it's possible to test-drive some things with actual tests I'm afraid I can easily misinterpret the results.</p>\n"}, {"tags": ["haskell", "stm"], "comments": [{"owner": {"reputation": 4517, "user_id": 125421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4b385fddccf1b5305dbf5c7f6f4d0ecc?s=128&d=identicon&r=PG", "display_name": "Nathan Howell", "link": "https://stackoverflow.com/users/125421/nathan-howell"}, "edited": false, "score": 3, "creation_date": 1477546809, "post_id": 40275716, "comment_id": 67812596, "body": "Switching out the IORef to a TVar alleviates the problem, though it&#39;s not obvious why. I prefer to keep all my atomic operations within one transaction whenever possible, so (imo) this is a preferrable change... however it&#39;s not an answer to why this particular case is problematic. Here&#39;s a version that works for me: <a href=\"https://gist.github.com/NathanHowell/b54e2805c10ff047dc46ec3e818afcd8\" rel=\"nofollow noreferrer\">gist.github.com/NathanHowell/b54e2805c10ff047dc46ec3e818afcd&zwnj;&#8203;8</a>"}, {"owner": {"reputation": 730, "user_id": 2155932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d264ae1b9edf72beae58b4dfbd606c8?s=128&d=identicon&r=PG", "display_name": "user2155932", "link": "https://stackoverflow.com/users/2155932/user2155932"}, "reply_to_user": {"reputation": 4517, "user_id": 125421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4b385fddccf1b5305dbf5c7f6f4d0ecc?s=128&d=identicon&r=PG", "display_name": "Nathan Howell", "link": "https://stackoverflow.com/users/125421/nathan-howell"}, "edited": false, "score": 0, "creation_date": 1477566496, "post_id": 40275716, "comment_id": 67824280, "body": "@NathanHowell, great, this works for me too! Please, make your comment an answer so I can properly upvote it, as it addresses an essential part of the problem."}], "answers": [{"tags": [], "owner": {"reputation": 4517, "user_id": 125421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4b385fddccf1b5305dbf5c7f6f4d0ecc?s=128&d=identicon&r=PG", "display_name": "Nathan Howell", "link": "https://stackoverflow.com/users/125421/nathan-howell"}, "is_accepted": true, "score": 1, "last_activity_date": 1477576735, "creation_date": 1477576735, "answer_id": 40286600, "question_id": 40275716, "link": "https://stackoverflow.com/questions/40275716/memory-leak-when-using-control-concurrent-stm-tbqueue/40286600#40286600", "title": "Memory leak when using Control.Concurrent.STM.TBQueue", "body": "<p>Without digging in to the space leak itself, one solution is simply moving the consumer logic entirely into the STM. This is as simple as replacing the <code>IORef</code> with a <code>TVar</code>. But to fully take advantage of the STM the queue read and state updates should be placed into a single <code>atomically</code> block. Both operations will be executed in a transaction. A helpful side effect is that we've also gained exception safety.</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Concurrent.STM\nimport Control.Monad\nimport System.Random\n\nimport qualified Data.Map.Strict as M\n\ndata Item = Item {-# UNPACK #-} !Int {-# UNPACK #-} !Int\n\ndata SinkState = SinkState {\n  myMap :: !(M.Map Int Int)\n}\n\nmain :: IO ()\nmain = do\n  chan &lt;- newTBQueueIO 1000\n\n  forkIO . forever $ do\n    threadDelay 500\n    key &lt;- getStdRandom $ randomR (1,5000)\n    value &lt;- getStdRandom $ randomR (1,1000000)\n    atomically . writeTBQueue chan $ Item key value\n\n  state &lt;- newTVarIO SinkState {\n      myMap = M.empty\n    }\n\n  forever . atomically $ do\n    Item key value &lt;- readTBQueue chan\n    modifyTVar' state $ \\s -&gt; s { myMap = M.insert key value (myMap s) }\n</code></pre>\n"}], "owner": {"reputation": 730, "user_id": 2155932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d264ae1b9edf72beae58b4dfbd606c8?s=128&d=identicon&r=PG", "display_name": "user2155932", "link": "https://stackoverflow.com/users/2155932/user2155932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 40286600, "answer_count": 1, "score": 4, "last_activity_date": 1477576735, "creation_date": 1477539531, "question_id": 40275716, "link": "https://stackoverflow.com/questions/40275716/memory-leak-when-using-control-concurrent-stm-tbqueue", "title": "Memory leak when using Control.Concurrent.STM.TBQueue", "body": "<p>I have two threads: producer and consumer. Producer produces some (key,value) pairs and consumer inserts them into <code>Map</code>, wrapped into <code>Data.IORef</code>. I tried to use <code>Control.Concurrent.BoundedChan</code> for communication between producer and consumer, and it works fine (memory usage is constant), provided that I use BangPatterns where needed. The code is as follows:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmodule Main where\n\nimport qualified Data.Map.Strict as M\nimport Control.Concurrent\nimport Control.Concurrent.STM\nimport Control.Concurrent.STM.TBQueue\nimport qualified Control.Concurrent.BoundedChan as BC\nimport qualified Control.Concurrent.Chan.Unagi.Bounded as UBC\nimport qualified Data.Text as T\nimport System.Random\nimport Data.IORef\nimport Control.Monad\n\ndata Item = Item !Int !Int\n\ndata SinkState = SinkState {\n  myMap :: !(M.Map Int Int)\n}\n\ntestBCs = do\n  chan &lt;- BC.newBoundedChan 1000\n\n  forkIO $ source chan\n  sink chan\n  where\n    source chan = forever $ do\n      threadDelay 500\n      key &lt;- getStdRandom (randomR (1,5000))\n      value &lt;- getStdRandom (randomR (1,1000000))\n      BC.writeChan chan $ Item key value\n\n    sink chan = do\n      state &lt;- newIORef SinkState {\n          myMap = M.empty\n        }\n      forever $ do\n        (Item key value) &lt;- BC.readChan chan\n        atomicModifyIORef' state (\\s -&gt; (s { myMap = myMap s `seq` M.insert key value (myMap s) }, ()))\n</code></pre>\n\n<p>Now, when I switch from <code>BoundedChan</code> to <code>Control.Concurrent.STM.TBQueue</code>, memory starts to leak:</p>\n\n<pre><code>testTBs = do\n  chan &lt;- atomically $ newTBQueue 1000\n\n  forkIO $ source chan\n  sink chan\n  where\n    source chan = forever $ do\n      threadDelay 500\n      key &lt;- getStdRandom (randomR (1,5000))\n      value &lt;- getStdRandom (randomR (1,1000000))\n      atomically $ writeTBQueue chan $ Item key value\n\n    sink chan = do\n      state &lt;- newIORef SinkState {\n          myMap = M.empty\n        }\n      forever $ do\n        (Item key value) &lt;- chan `seq` atomically $ readTBQueue chan\n        atomicModifyIORef' state (\\s -&gt; (s { myMap = myMap s `seq` M.insert key value (myMap s) }, ()))\n</code></pre>\n\n<p>And the profiling results looks like this (ran with <code>+RTS -hd</code>):\n<a href=\"https://i.stack.imgur.com/SclWa.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/SclWa.png\" alt=\"Profiling results\"></a></p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>What's going on in the second case?</li>\n<li>What are those stg_ap_2_upd_info and other symbols?</li>\n<li>How to fix leak?</li>\n</ol>\n"}]