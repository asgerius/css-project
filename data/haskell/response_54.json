[{"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1453335909, "post_id": 34912922, "comment_id": 57561912, "body": "It&#39;s not likely to be monad transformers, I don&#39;t think. <code>IO</code> can only be at the base of a monad transformer stack."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453342084, "post_id": 34912922, "comment_id": 57563605, "body": "@dfeuer Are you sure? <code>ExceptT IO e</code> is a perfectly reasonable monad (built out of transformers) to which both <code>Either e</code> and <code>IO</code> actions can reasonably be lifted."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453351617, "post_id": 34912922, "comment_id": 57566131, "body": "@DanielWagner, that&#39;s a good point. <code>IO</code> is still at the base, so you have to wrap the whole thing in <code>runExceptT</code> or whatever, but on the inside things are more convenient. user3237465 has turned that into an answer."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 6, "last_activity_date": 1453366989, "last_edit_date": 1453366989, "creation_date": 1453335447, "answer_id": 34913183, "question_id": 34912922, "link": "https://stackoverflow.com/questions/34912922/bind-a-monadic-value-m2-a-inside-some-other-monad-m1/34913183#34913183", "title": "bind a monadic value (m2 a) inside some other monad m1", "body": "<p>You can't, in general. The whole do block has to be one specific monad (because <code>example</code> needs to have some specific type). If you could bind an arbitrary other monad inside that do block, you'd have <code>unsafePerformIO</code>.</p>\n\n<p>Monad transformers allow you to produce one monad combining the kinds of things multiple other monads can do. But you have to decide that <em>all</em> the actions in your do block use the same monad transformer stack to use those, they're not a way to arbitrarily switch monads mid do-block.</p>\n\n<p>Your solution with <code>case</code> only works because you've got a particular known monad (Either) that has a way of extracting values from inside it. Not all monads provide this, so it's impossible to build a general solution without knowing the particular monads involved. That's why the do block syntax doesn't provide such a shortcut.</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 2, "last_activity_date": 1453340502, "last_edit_date": 1453340502, "creation_date": 1453340053, "answer_id": 34913872, "question_id": 34912922, "link": "https://stackoverflow.com/questions/34912922/bind-a-monadic-value-m2-a-inside-some-other-monad-m1/34913872#34913872", "title": "bind a monadic value (m2 a) inside some other monad m1", "body": "<p>You need to make that expression <em>type check</em>; just as in pure code. Here,</p>\n\n<pre><code>... = do a &lt;- act1  -- m1 monad\n         b &lt;- act2  -- m2 monad\n         ...\n</code></pre>\n\n<p>de-sugars to:</p>\n\n<pre><code>... = act1 &gt;&gt;= (\\a -&gt; act2 &gt;&gt;= \\b -&gt; ...)\n</code></pre>\n\n<p><code>&gt;&gt;=</code> is of signature:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>the outer <em>bind</em> is specialized with <code>m1</code>, so it expects that the expression inside parenthesis be of type: <code>a -&gt; m1 b</code>, whereas the inner bind is specialized with <code>m2</code>, so the expression inside parenthesis will be of type <code>a -&gt; m2 b</code>:</p>\n\n<pre><code>-- outer bind expects (    \\a   -&gt;   m1 b      )\n             act1 &gt;&gt;= (\\a -&gt; act2 &gt;&gt;= \\b -&gt; ...)\n-- inner bind results (    \\a   -&gt;   m2 b      )\n</code></pre>\n\n<p>for this to <em>type check</em>, you need a function of signature <code>m2 b -&gt; m1 b</code> in between the two; that is what <a href=\"http://hackage.haskell.org/package/transformers-0.5.1.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow\"><code>lift</code></a> does for a <strong>certain class</strong> of <code>m2</code> and <code>m1</code> monads: namely <code>m1 ~ t m2</code> where <code>t</code> is an instance of <code>MonadTrans</code>:</p>\n\n<pre><code>lift :: (Monad m, MonadTrans t) =&gt; m a -&gt; t m a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1453343867, "last_edit_date": 1453343867, "creation_date": 1453343050, "answer_id": 34914327, "question_id": 34912922, "link": "https://stackoverflow.com/questions/34912922/bind-a-monadic-value-m2-a-inside-some-other-monad-m1/34914327#34914327", "title": "bind a monadic value (m2 a) inside some other monad m1", "body": "<p>In general, monad transformers are for this kind of interleaving. You can use <code>ExceptT</code></p>\n\n<pre><code>example :: IO (Either String ())\nexample = runExceptT $ do\n    input &lt;- liftIO getLine\n    parsed &lt;- parseOnly parser input\n    ...\n</code></pre>\n\n<p>Note that <code>parseOnly</code> must return <code>ExceptT String IO a</code> for some <code>a</code>. Or better <code>ExceptT String m a</code> for any <code>m</code>. Or if you want <code>parseOnly</code> to return <code>Either String a</code> it's</p>\n\n<pre><code>example :: IO (Either String ())\nexample = runExceptT $ do\n    input &lt;- lift getLine\n    parsed &lt;- ExceptT $ return $ parseOnly parser input\n    ...\n</code></pre>\n\n<p>But I think all you need is just</p>\n\n<pre><code>eitherToIO :: Either String a -&gt; IO a\neitherToIO (Left s)  = error s\neitherToIO (Right x) = return x\n\nparseOnly :: ... -&gt; String -&gt; Either String Int\n\nexample :: IO ()\nexample = do\n    input  &lt;- getLine\n    parsed &lt;- eitherToIO $ parseOnly parser input\n    ...\n</code></pre>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 2, "accepted_answer_id": 34913183, "answer_count": 3, "score": 2, "last_activity_date": 1453366989, "creation_date": 1453333907, "question_id": 34912922, "link": "https://stackoverflow.com/questions/34912922/bind-a-monadic-value-m2-a-inside-some-other-monad-m1", "title": "bind a monadic value (m2 a) inside some other monad m1", "body": "<p>Working in a Coding Dojo today I tried the following</p>\n\n<pre><code>example :: IO ()\nexample = do input &lt;- getLine\n             parsed &lt;- parseOnly parser input\n             ...\n</code></pre>\n\n<p>where <code>parseOnly :: Parser a -&gt; Either String a</code> (from <code>attoparsec</code>) of course the compiler complained that <code>Either ..</code> is not <code>IO ..</code> essentially telling me I am mixing monads.</p>\n\n<p>Of course this can be solved by</p>\n\n<pre><code>             case parseOnly parser input of .. -&gt; ..\n</code></pre>\n\n<p>which is kind of unelegant, I think. Also my guess is that somebody else had this problem earlier and the solution I think is related to monad transformers, but the last bits I cannot piece together.</p>\n\n<p>It also reminded me of <code>liftIO</code> - but this is the other way around I think which solves the problem of lifting an IO action happening inside some surrounding monad (more precisely <code>MonadIO</code> - say for example inside <code>Snap</code> when one wants to print something to <code>stdout</code> while getting some http).</p>\n\n<p>More general this problem seems to be for a <code>Monad m1</code> and a (different) <code>Monad m2</code> how can I do something like</p>\n\n<pre><code>example = do a &lt;- m1Action\n             b &lt;- m2Action\n             ..\n</code></pre>\n"}, {"tags": ["haskell", "asynchronous"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1453413963, "creation_date": 1453413963, "answer_id": 34935245, "question_id": 34912779, "link": "https://stackoverflow.com/questions/34912779/does-asynchronous-message-transmission-and-reception-make-sense-in-psql-protocol/34935245#34935245", "title": "Does asynchronous message transmission and reception make sense in PSQL protocol?", "body": "<p>The library in question appears to be in its very early stages. The file you are asking about doesn't even parse; and after fixing the parse errors doesn't compile. I doubt very much whether it's possible to give serious answers to any question about this codebase for some time yet. Still, I will make an attempt.</p>\n\n<blockquote>\n  <p>I am wondering how and when it would be useful to have this notion of an asynchronous send and receive. If I am getting the responses back on a separate thread, how do I know which request any given response belongs to.</p>\n</blockquote>\n\n<p>It's not clear to me that \"asynchronous\" implies \"you must send and receive on separate threads\". However, it may imply that doing so is allowed; in which case presumably your two threads will need to be in communication with each other somehow.</p>\n\n<blockquote>\n  <p>Additionally, if a particular message caused an error, how would I know which message caused that error?</p>\n</blockquote>\n\n<p>Presumably messages will include an identifier of some sort, and the error would report that identifier.</p>\n"}], "owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1453413963, "creation_date": 1453333185, "question_id": 34912779, "link": "https://stackoverflow.com/questions/34912779/does-asynchronous-message-transmission-and-reception-make-sense-in-psql-protocol", "title": "Does asynchronous message transmission and reception make sense in PSQL protocol?", "body": "<p>I am trying to understand the following code (taken from <a href=\"https://github.com/zadarnowski/postgresql-wire-protocol\" rel=\"nofollow\">https://github.com/zadarnowski/postgresql-wire-protocol</a>) which asynchronously sends and receives PSQL wire protocol messages. I am wondering how and when it would be useful to have this notion of an asynchronous send and receive. If I am getting the responses back on a separate thread, how do I know which request any given response belongs to.</p>\n\n<p>Additionally, if a particular message caused an error, how would I know which message caused that error?</p>\n\n<pre><code>module Database.PostgreSQL.Protocol.Client.Connection (\n  Frontend\n) where\n\nimport Control.Concurrent.Chan\nimport Control.Concurrent.MVar\n\n\n data FrontendSession = FrontendSession {\n   frontendSendQueue  :: Chan FrontendMessage,\n   frontendRecvQueue  :: Chan BackendMessage,\n   frontendProcQueue  :: Chan BackendMessageHandler,\n   frontendSendThread :: ThreadId,\n   frontendRecvThread :: ThreadId,\n   frontendProcThread :: ThreadId\n }\n\n newtype BackendMessageHandler :: Consume (BackendMessage -&gt; IO BackendMessageHandler) | Pass\n\n\n beginFrontendSession :: (Int32 -&gt; IO Lazy.ByteString) -&gt; (Lazy.ByteString -&gt; IO ()) -&gt; IO FrontendSession\n beginFrontendSession readData writeData = do\n   sendQueue &lt;- newChan\n   recvQueue &lt;- newChan\n   procQueue &lt;- newChan\n   sendThread &lt;- forkIO $ forever $ readChan sendQueue &gt;&gt;= writeData . toLazyByteString . frontendMessage\n   recvThread &lt;- forkIO $ forever $ readBackendMessage readData &gt;&gt;= writeChan recvQueue\n   procThread &lt;- forkIO $ let getNextMessage h = readChan recvQueue &gt;&gt;= apply h\n                              apply (Consume h) m = h m &gt;&gt;= getNextMessage\n                              apply (Pass) m = readChan procQueue &gt;&gt;= flip apply m\n                           in getNextMessage Pass\n   return FrontendSession {\n     frontendSendQueue  = sendQueue,\n     frontendRecvQueue  = recvQueue,\n     frontendProcQueue  = procQueue,\n     frontendSendThread = sendThread,\n     frontendRecvThread = recvThread\n}\n</code></pre>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1453328825, "post_id": 34911014, "comment_id": 57559303, "body": "<code>(Num, Ord)</code> is too weak to ensure sane behavior. It should probably demand <code>Integral</code> instead."}, {"owner": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453373780, "post_id": 34911014, "comment_id": 57577341, "body": "@dfeuer: To elaborate, if you&#39;re working with <code>Set</code>s of complex numbers, you need an instance <code>Ord a =&gt; Ord (Complex a)</code> (arguably, this is a design flaw in <code>Set</code>) and then the question &quot;What does <code>replicate (0 :+ 1) foo</code> mean?&quot; rears its head. The law <code>concat . replicate a . replicate b === replicate (a*b)</code> is going to be broken, I think!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "edited": false, "score": 1, "creation_date": 1453396396, "post_id": 34911014, "comment_id": 57593230, "body": "@yatima2975, the existence of the inherently-broken instances <code>Num Double</code> and <code>Ord Double</code> is another concern. One could also, I think, imagine a type expressing ideas related to non-standard analysis (with infinitesimals) that could be bad for <code>replicate</code> even if perfectly sane."}], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1453427422, "post_id": 34911324, "comment_id": 57607773, "body": "Correct answer. Worth adding, though: GHC <i>might</i> generate better code for the version with the narrower type declaration\u2014in <i>some cases</i>.  (Don&#39;t go hardcoding any functions to use <code>Int</code> without benchmarking!)"}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 2, "last_activity_date": 1453327198, "last_edit_date": 1453327198, "creation_date": 1453326742, "answer_id": 34911324, "question_id": 34911014, "link": "https://stackoverflow.com/questions/34911014/difference-in-use-between-predefined-typeclasses-and-basic-types/34911324#34911324", "title": "Difference in use between predefined typeclasses and basic types", "body": "<p>The second version only works with an <code>Int</code> as the first parameter. The first version is more general and works with any type in the <code>Num</code> and <code>Ord</code> typeclasses. The <code>Num</code> typeclass defines basic operations used with numerical types. In this case, <code>replicate'</code> needs to be able to subtract 1 from the parameter <code>n</code>. <code>Ord</code> defines comparison operations. This is needed since you use <code>&lt;=</code>. Note that <code>Int</code> is in both of these typeclasses and so it supports both of the required operations. By declaring the function with more a more general type signature, <code>replicate'</code> can be used with any other type which supports the required operations.</p>\n"}], "owner": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1453327198, "creation_date": 1453325616, "question_id": 34911014, "link": "https://stackoverflow.com/questions/34911014/difference-in-use-between-predefined-typeclasses-and-basic-types", "title": "Difference in use between predefined typeclasses and basic types", "body": "<p>I am reading through some of the examples in LYAH and I came across this snippet of code:</p>\n\n<pre><code>replicate' :: (Num i, Ord i) =&gt; i -&gt; a -&gt; [a]  \nreplicate' n x  \n  | n &lt;= 0    = []  \n  | otherwise = x:replicate' (n-1) x  \n</code></pre>\n\n<p>This is from the online version, but I also have a copy of the book which has this instead:</p>\n\n<pre><code>replicate' :: Int -&gt; a -&gt; [a]  \nreplicate' n x  \n  | n &lt;= 0    = []  \n  | otherwise = x:replicate' (n-1) x  \n</code></pre>\n\n<p>I have tried both of these out and they both work but my question is:</p>\n\n<p>Are these implementations different and when should I use the typeclasses instead of the regular types?</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1453331452, "post_id": 34910992, "comment_id": 57560420, "body": "&quot;I&#39;m not able to do it&quot; isn&#39;t a question - you&#39;ve included a single line of code, but not even the error message you get when you run this hypothetical code. If you tried it and it gave an error, why not include the error to save people some time? You should isolate your problem to code which is small enough to put in your question"}, {"owner": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453419278, "post_id": 34910992, "comment_id": 57605373, "body": "Ok I played with it and went further and edited the question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453419805, "post_id": 34910992, "comment_id": 57605524, "body": "Well the issue is evident now - IO is not lazy. Using IO like you have is certainly an antipattern. If you want this to work with IO, you&#39;ll have to use <code>unsafeInterleaveIO</code>, which is obviously terrible. Better that you remove the logic of your game from IO, then the desired semantics (i.e. <code>takeWhile p someInfiniteList</code> and variants) will work as expected. Instead of having <code>updateGameState :: GameState -&gt; IO GameState</code> you must have <code>updateGameState :: UserInput -&gt; GameState -&gt; GameState</code> and then <code>readUserInput :: IO [UserInput]</code> is trivial - just <code>map read . lines &lt;$&gt; getContents</code>."}], "answers": [{"comments": [{"owner": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "edited": false, "score": 0, "creation_date": 1453780164, "post_id": 34970115, "comment_id": 57741118, "body": "Thanks for help Michael, this is exactly what I wanted. I have one related question. How can I construct function for testing where I will just pass [Char] instead of IO. I know I can use S.each and return Stream but I want to be runGameInfiniteStream as big as possible."}, {"owner": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "edited": false, "score": 0, "creation_date": 1453780343, "post_id": 34970115, "comment_id": 57741169, "body": "I took out the update state function  <code>runGameInfiniteStream ::  Monad m =&gt; (GameState -&gt; m GameState) -&gt; GameState -&gt; Stream (S.Of GameState) m () runGameInfiniteStream updateGameStateFunction gs = S.take 1 $ S.dropWhile gameInProgress steps    where    --steps :: Monad m =&gt; GameState -&gt; (GameState -&gt; m GameState) -&gt; Stream (S.Of GameState) m ()    steps = S.iterateM updateGameStateFunction (return gs)</code> How can I construct one which will allow me to pass inside [Char] and will update the state accordingly. I tried to use StateMonad for that but without success."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "edited": false, "score": 0, "creation_date": 1453835984, "post_id": 34970115, "comment_id": 57770502, "body": "Something l ike <code>pureSteps gs chars = S.scan updateState gs id (S.each chars)</code>  yields the updated states corresponding to a list of character inputs. (<code>scan</code> is complicated by an extra field to fit with the <code>foldl</code> library)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "edited": false, "score": 0, "creation_date": 1453836093, "post_id": 34970115, "comment_id": 57770566, "body": "Then something like <code>runPure txt inputs = S.toList $ S.take 1 $ S.dropWhile (not . gameEnded) $ pureSteps (newGameState txt) inputs</code> will give a 0- or 1-member list with the end result, given a list of Chars as &#39;inputs&#39;. So if I write <code>runPure &quot;car&quot; &quot;cxar&quot;</code> in ghci, I get <code>[GameState {secretWord = &quot;car&quot;, lives = 4, guesses = &quot;rac&quot;}] :&gt; ()</code>"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1453840899, "last_edit_date": 1453840899, "creation_date": 1453590868, "answer_id": 34970115, "question_id": 34910992, "link": "https://stackoverflow.com/questions/34910992/iterate-io-actions-and-laziness/34970115#34970115", "title": "iterate IO actions and laziness", "body": "<p>I think the scheme of using <code>iterate</code> to make an ostensibly pure list of IO actions is the source of the trouble here. Your plan is to update state by user input, but to consider the succession of states as a stream that you can 'treat like a list'. If I use a genuine <code>iterateM</code> to produce a proper stream things, then things go exactly as you were wanting them to go. So if I add the imports</p>\n\n<pre><code>import Streaming -- cabal install streaming\nimport qualified Streaming.Prelude as S\n</code></pre>\n\n<p>and after your main definitions write something like</p>\n\n<pre><code>runGameInfiniteStream gs =  S.print $ S.take 1 $ S.dropWhile (not . gameEnded) steps\n  where\n  steps :: Stream (Of GameState) IO ()\n  steps = S.iterateM updateGameState (return gs)\n\nmain :: IO ()\nmain = runGameInfiniteStream (newGameState \"car\")\n</code></pre>\n\n<p>then I get </p>\n\n<pre><code>&gt;&gt;&gt; main\nYou have 5 lifes. The word is \"___\"\nGuess a letter: \nc\nYou have 5 lifes. The word is \"c__\"\nGuess a letter: \na\nYou have 5 lifes. The word is \"ca_\"\nGuess a letter: \nr\nGameState {secretWord = \"car\", lives = 5, guesses = \"rac\"}\n</code></pre>\n\n<p>I think this is exactly the program you intended, but using a proper stream concept rather than mixing IO and lists in some complicated way. Something similar could be done with <code>pipes</code> and <code>conduit</code> and similar packages.</p>\n\n<hr>\n\n<p>(Added later:)</p>\n\n<p>To stream to states corresponding to a pure list of Chars (emulating the result coming from user input), you can just use <code>scan</code></p>\n\n<pre><code>pureSteps\n   :: (Monad m) =&gt; GameState -&gt; [Char] -&gt; Stream (Of GameState) m ()\npureSteps gs chars = S.scan updateState gs id (S.each chars)\n</code></pre>\n\n<p>this is basically the same as <code>Prelude.scanl</code> which can also be used (in the pure case) to view the updates:</p>\n\n<pre><code>&gt;&gt;&gt; S.print $ pureSteps (newGameState \"hi\") \"hxi\"\nGameState {secretWord = \"hi\", lives = 5, guesses = \"\"}\nGameState {secretWord = \"hi\", lives = 5, guesses = \"h\"}\nGameState {secretWord = \"hi\", lives = 4, guesses = \"h\"}\nGameState {secretWord = \"hi\", lives = 4, guesses = \"ih\"}\n\n&gt;&gt;&gt; mapM_ print $ scanl updateState (newGameState \"hi\") \"hxi\"\nGameState {secretWord = \"hi\", lives = 5, guesses = \"\"}\nGameState {secretWord = \"hi\", lives = 5, guesses = \"h\"}\nGameState {secretWord = \"hi\", lives = 4, guesses = \"h\"}\nGameState {secretWord = \"hi\", lives = 4, guesses = \"ih\"}\n</code></pre>\n\n<p>To view the final 'winning' state, if it exists, you can write, e.g. </p>\n\n<pre><code>runPureInfinite\n  :: Monad m =&gt; GameState -&gt; [Char] -&gt; m (Of [GameState] ())\nrunPureInfinite gs = S.toList . S.take 1 . S.dropWhile (not . gameEnded) . pureSteps gs\n\n-- &gt;&gt;&gt; S.print $ runPureInfinite (newGameState \"car\") \"caxyzr\"\n-- [GameState {secretWord = \"car\", lives = 2, guesses = \"rac\"}] :&gt; ()\n</code></pre>\n\n<p>and so on. </p>\n"}], "owner": {"reputation": 211, "user_id": 1698641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/55e5b0d7a78344b0c97dbe685af5aad1?s=128&d=identicon&r=PG", "display_name": "user1698641", "link": "https://stackoverflow.com/users/1698641/user1698641"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 34970115, "answer_count": 1, "score": -1, "last_activity_date": 1453840899, "creation_date": 1453325537, "last_edit_date": 1453419251, "question_id": 34910992, "link": "https://stackoverflow.com/questions/34910992/iterate-io-actions-and-laziness", "title": "iterate IO actions and laziness", "body": "<p>I would like to write Hangman game <a href=\"https://github.com/fokot/reactive-hangman/blob/master/src/Hangman.hs\" rel=\"nofollow\">https://github.com/fokot/reactive-hangman/blob/master/src/Hangman.hs</a> with seeing list of user actions as lazy stream. My recursive versions works ok (in code runGameRecursively (newGameState \"secret\"))</p>\n\n<p>I got stuck on laziness issue</p>\n\n<pre><code>updateGameState :: GameState -&gt; IO GameState\nupdateGameState gs = do\n   l &lt;- getALetter gs\n   return $ updateState gs l\n\nff :: (a -&gt; Bool) -&gt; [IO a] -&gt; IO a\nff f (i:is) = do\n  res &lt;- i\n  if f res then return res else ff f is\n\nrunGameInfinite :: GameState -&gt; IO ()\nrunGameInfinite gs =\n  -- infinite lazy game loop\n  let repl = tail $ iterate (\\x -&gt; x &gt;&gt;= updateGameState) (return gs) :: [IO GameState]\n  in do\n    endState &lt;- ff gameEnded repl\n    putStrLn $ showState endState\n\nmain = runGameInfinite (newGameState \"car\")\n</code></pre>\n\n<p>When you run the game every single step in repl need to reevaluate all previous even if they already were. I tried to play with $! but did not find correct answer ho to do it yet. Thanks</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1453322234, "post_id": 34908965, "comment_id": 57555733, "body": "Thanks for this. &quot;Using the lens compatible package for aeson could probably simplify this quite a bit though&quot; -- do you have an example for that, I couldn&#39;t find?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1453325971, "last_edit_date": 1453325971, "creation_date": 1453318594, "answer_id": 34908965, "question_id": 34907953, "link": "https://stackoverflow.com/questions/34907953/add-nested-property-to-returned-record/34908965#34908965", "title": "Add nested property to returned record", "body": "<p>To do this you'll have to convert your <code>Entity</code> to a <code>Value</code> manually, then use the functions in <code>unordered-containers:Data.HashMap.Strict</code> to insert the <code>\"_links\"</code> key, then build a <code>Value</code> out of it again.  Using the lens compatible package for <code>aeson</code> could probably simplify this quite a bit though:</p>\n\n<pre><code>buildEntityWithLink :: Entity -&gt; Text -&gt; Maybe Value\nbuildEntityWithLink entity renderedUrl = case toJSON entity of\n    Object obj -&gt; \n        let links = object [\"self\" .= renderedUrl]\n            entityWithLink = HashMap.insert \"_links\" links obj\n        in Just (Object entityWithLink)\n    _ -&gt; Nothing\n</code></pre>\n\n<p>(I'm assuming that <code>renderedUrl</code> has type <code>Text</code>, change if needed)</p>\n\n<p>Then you can just pass in your <code>Entity</code> and <code>renderedUrl</code> to get a new <code>Value</code> with the <code>\"_links\"</code> key included.  I've used <code>Maybe</code> here to guard against the case where <code>toJSON :: Entity -&gt; Value</code> does not return a <code>Value</code> with the <code>Object</code> constructor.  This will protect you in the future if you change the <code>Entity</code> type and how it converts to JSON but forget to update all of your codebase to reflect this change.</p>\n\n<p>EDIT: If you were to use <code>lens-aeson</code> You could write it like this, though this requires swapping the argument order just for neatness:</p>\n\n<pre><code>buildEntityWithLink :: Text -&gt; Entity -&gt; Value\nbuildEntityWithLink renderedUrl = (\n    over _Object $\n         HashMap.insert \"_links\" $\n                        object [\"self\" .= renderedUrl]\n    ) . toJSON\n</code></pre>\n\n<p>This actually lets you drop the <code>Maybe</code>, you want to anyway, since the way lenses work means that if the <code>Object</code> isn't the top level then the original value is returned, so <code>buildEntityWithLink \"testlink\" ([] :: [Entity])</code> Would just return the same as <code>toJSON ([] :: [Entity])</code>, namely an empty <code>Array</code>.  The <code>toJSON</code> has to be on the outside of the lens operation because in order to compose with <code>_Object</code> it has to be able to be a setter, and <code>toJSON</code> can't be easily made into a setter.  Instead, we just pre-process our <code>Entity</code> into a <code>Value</code>, then feed it in to the lens expression.  I've added whitespace where I've lined up the arguments to each function, makes it a bit more readable IMO, but this is all technically 1 line of code.  A useful feature about this implementation is that it's now easy to relax the type signature to <code>ToJSON a =&gt; Text -&gt; a -&gt; Value</code>, so you can add a <code>_links</code> to any type you want to.</p>\n"}, {"tags": [], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "is_accepted": false, "score": 0, "last_activity_date": 1462303369, "last_edit_date": 1495542232, "creation_date": 1453321954, "answer_id": 34909930, "question_id": 34907953, "link": "https://stackoverflow.com/questions/34907953/add-nested-property-to-returned-record/34909930#34909930", "title": "Add nested property to returned record", "body": "<p>Based on <a href=\"https://stackoverflow.com/a/34908965/750039\">bheklilr's</a> <em>working</em> comment - here's the final code I now have:</p>\n\n<pre><code>import Data.HashMap.Strict as HashMap (insert)\n\ngetEventR :: EventId -&gt; Handler Value\ngetEventR eid = do\n    event &lt;- runDB $ get404 eid\n\n    render &lt;- getUrlRender\n    let renderedUrl = render $ EventR eid\n\n    let returnVal = object\n          [ \"data\" .= [buildEntityWithLink (Entity eid event) renderedUrl]]\n\n    return returnVal\n\n\nbuildEntityWithLink :: Entity Event -&gt; Text -&gt; Maybe Value\nbuildEntityWithLink entity renderedUrl =\n    case toJSON entity of\n        Object obj -&gt;\n            let links = object [\"self\" .= renderedUrl]\n                entityWithLink = HashMap.insert \"_links\" links obj\n            in Just (Object entityWithLink)\n        _ -&gt; Nothing\n</code></pre>\n\n<p>And now indeed, the JSON appears as expected with the <code>self</code> link</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 34908965, "answer_count": 2, "score": 0, "last_activity_date": 1462303369, "creation_date": 1453315322, "question_id": 34907953, "link": "https://stackoverflow.com/questions/34907953/add-nested-property-to-returned-record", "title": "Add nested property to returned record", "body": "<p>I have a Yesod route handler that returns a JSON with the object</p>\n\n<pre><code>{ id: 1,\n  title: \"foo\"\n  content: \"bar\"\n}\n</code></pre>\n\n<p>I would like to add a <code>_links</code> property with some metadata, that doesn't exist in on the Entity itself, e.g.</p>\n\n<pre><code>{ id: 1,\n  title: \"foo\"\n  content: \"bar\"\n  _links: {self: http://localhost:3000/events/1}\n}\n</code></pre>\n\n<p>How can I add the <code>_links</code> to the existing Entity record? Here's my handler:</p>\n\n<pre><code>getEventR :: EventId -&gt; Handler Value\ngetEventR eid = do\n    event &lt;- runDB $ get404 eid\n\n    render &lt;- getUrlRender\n    let renderedUrl = render $ EventR eid\n\n    let links = object\n          [ \"self\" .= renderedUrl\n          ]\n\n    let returnVal = object\n          [ \"data\" .= (Entity eid event)\n          , \"_links\" .= links\n          ]\n\n    return returnVal\n</code></pre>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1453312455, "post_id": 34907036, "comment_id": 57550217, "body": "You&#39;ve declared the type of the first argument to <code>dupElem</code> to be an instance of the <code>Num</code> type class, but then you attempt to call it like a function. (That said, the structure of <code>dupElem</code> looks a lot like the implementation of <code>fmap</code> if you were making <code>BinTreeInt</code> an instance of <code>Functor</code>.)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453312471, "post_id": 34907036, "comment_id": 57550226, "body": "<code>f</code> in your case is a <code>a</code> ... but you try to apply this <code>n</code> to this <code>Num a</code>...."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453312586, "post_id": 34907036, "comment_id": 57550298, "body": "I guess with <code>duplicate</code> you want <code>f</code> to be an operation like <i>double a number</i> (something like <code>4 -&gt; 8</code>, <code>3 -&gt; 6</code>) right? In this case your signature should be <code>dupElem :: (Num a) =&gt; (a -&gt; a) -&gt; BinTreeInt -&gt; BinTreeInt</code> (and ofc <code>BinTreeInt</code> might be misnamed) - and you should call it like <code>dupElem (*2) myTree</code>"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1453314144, "post_id": 34907036, "comment_id": 57551209, "body": "Think what you mean by <code>(f n)</code> where both are Nums. Do you want to multiply them i.e. for f=2 will be doubling?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1453314377, "post_id": 34907036, "comment_id": 57551352, "body": "Please provide sample input and intended output to clarify what <code>dupElem</code> is supposed to do."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453312678, "post_id": 34907197, "comment_id": 57550373, "body": "I don&#39;t think so (&quot;with the same structure but with all duplicate values&quot;)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453314340, "post_id": 34907197, "comment_id": 57551331, "body": "I could read that as &quot;duplicate the tree, with each node having the same (given) value&quot;, or &quot;duplicate the tree with each node&#39;s value being duplicated [whatever that means]&quot;. I went with the interpretation that preserves the given type signature."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1453312876, "last_edit_date": 1453312876, "creation_date": 1453312623, "answer_id": 34907197, "question_id": 34907036, "link": "https://stackoverflow.com/questions/34907036/bintree-haskell/34907197#34907197", "title": "BinTree haskell", "body": "<p>If I understand correctly, you simply want to replace <code>n</code> with <code>f</code>, not apply <code>f</code> as a function to <code>n</code>.</p>\n\n<pre><code>dupElem :: (Num a) =&gt; a -&gt; BinTreeInt -&gt; BinTreeInt\ndupElem _ Void = Void\ndupElem f (Node n l r) = Node f (dupElem f l)(dupElem f r)\n</code></pre>\n\n<p>For instance, <code>dupElem 3 (BinTreeInt 1 (BinTreeInt 2 Void Void) Void)</code> would return <code>(BinTreeInt 3 (BinTreeInt 3 Void Void) Void)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1476307590, "creation_date": 1476307590, "answer_id": 40008629, "question_id": 34907036, "link": "https://stackoverflow.com/questions/34907036/bintree-haskell/40008629#40008629", "title": "BinTree haskell", "body": "<p>According to your function signature \"<strong>a</strong>\" is constrained as a Num type but you are calling <strong>a</strong> as a function over n.</p>\n\n<p><code>dupElem :: (Num a) =&gt; a -&gt; BinTreeInt -&gt; BinTreeInt</code></p>\n\n<p>So my suggestion would be to change: </p>\n\n<p><code>Node (f n) (dupElem f l)(dupElem f r)</code></p>\n\n<p>for</p>\n\n<p><code>Node f (dupElem f l)(dupElem f r)</code></p>\n\n<p>as <strong>chepner</strong> suggested above.</p>\n"}], "owner": {"reputation": 1, "user_id": 5817291, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TpybT1d7oTo/AAAAAAAAAAI/AAAAAAAAAmQ/Z3TbQxe4ftA/photo.jpg?sz=128", "display_name": "Jose Miguel Alem&#225;n", "link": "https://stackoverflow.com/users/5817291/jose-miguel-alem%c3%a1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1476307590, "creation_date": 1453312087, "question_id": 34907036, "link": "https://stackoverflow.com/questions/34907036/bintree-haskell", "title": "BinTree haskell", "body": "<p>I try to implement a function that returns a tree with the same structure but with all duplicate values \u200b\u200b( nodes )</p>\n\n<pre><code>data BinTreeInt = Void | Node Int BinTreeInt BinTreeInt deriving Show\n\ndupElem :: (Num a) =&gt; a -&gt; BinTreeInt -&gt; BinTreeInt\ndupElem f Void = Void\ndupElem f (Node n l r) = Node (f n) (dupElem f l)(dupElem f r)\n</code></pre>\n\n<p>I got this error:</p>\n\n<pre><code>P4.hs:382:32:\n    Could not deduce (a ~ (Int -&gt; Int))\n    from the context (Num a)\n      bound by the type signature for\n                 dupElem :: Num a =&gt; a -&gt; BinTreeInt -&gt; BinTreeInt\n      at P4.hs:380:12-51\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for\n            dupElem :: Num a =&gt; a -&gt; BinTreeInt -&gt; BinTreeInt\n          at P4.hs:380:12\n    Relevant bindings include\n      f :: a (bound at P4.hs:382:9)\n      dupElem :: a -&gt; BinTreeInt -&gt; BinTreeInt (bound at P4.hs:381:1)\n    The function \u2018f\u2019 is applied to one argument,\n    but its type \u2018a\u2019 has none\n    In the first argument of \u2018Node\u2019, namely \u2018(f n)\u2019\n    In the expression: Node (f n) (dupElem f l) (dupElem f r)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Seems to be easy but... Haskell is not my love!</p>\n\n<p>Gracias</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1453312653, "post_id": 34906006, "comment_id": 57550356, "body": "&quot;You also need a value, not a value constructor&quot; <code>[P, P ..]</code> works just fine. A nullary value constructor <i>is</i> a value."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1453313788, "post_id": 34906006, "comment_id": 57551039, "body": "@sepp2k you are right. needs an extra space before <code>..</code>. without it <code>[P,P..]</code> errors."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1453314084, "last_edit_date": 1453314084, "creation_date": 1453309110, "answer_id": 34906006, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt/34906006#34906006", "title": "Creating infinite list out of ADT", "body": "<p><code>[n,n'..]</code> is syntax sugar for <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Enum.html#enumFromThen\" rel=\"nofollow\"><code>enumFromThen</code></a> so you need your type be an instance of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Enum.html#Enum\" rel=\"nofollow\"><code>Enum</code></a> type class.</p>\n\n<p><s>You also need a value, not a value constructor</s>:</p>\n\n<pre><code>\\&gt; data Subunit = O | P deriving (Eq, Show, Enum)\n\\&gt; let a = P\n\\&gt; take 6 [a,a..]\n[P,P,P,P,P,P]\n</code></pre>\n\n<p>or (per @sepp2k comment):</p>\n\n<pre><code>\\&gt; take 6 [P,P ..]\n   --         ^ space\n[P,P,P,P,P,P]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1453330239, "post_id": 34906081, "comment_id": 57559903, "body": "May as well use <code>infiniteSubunit = fix (P:)</code> instead of doing the circularity yourself."}], "tags": [], "owner": {"reputation": 2082, "user_id": 474197, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/ZRH5k.png?s=128&g=1", "display_name": "HKTonyLee", "link": "https://stackoverflow.com/users/474197/hktonylee"}, "is_accepted": false, "score": 1, "last_activity_date": 1453309310, "creation_date": 1453309310, "answer_id": 34906081, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt/34906081#34906081", "title": "Creating infinite list out of ADT", "body": "<p>You may use this line to generate infinite list of ADT.</p>\n\n<pre><code>infiniteSubunit = P:infiniteSubunit\n</code></pre>\n\n<p>Then you can use it as is.</p>\n\n<pre><code>b :: [Subunit]                                                                   \nb = take 6 infiniteSubunit\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1453309319, "creation_date": 1453309319, "answer_id": 34906085, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt/34906085#34906085", "title": "Creating infinite list out of ADT", "body": "<p>as an alternative to behzads answer you can do</p>\n\n<pre><code>b :: [Subunit]\nb = take 6 $ repeat P\n</code></pre>\n\n<p>too - this one does not need the <code>Enum</code></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1453313754, "last_edit_date": 1453313754, "creation_date": 1453313433, "answer_id": 34907398, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt/34907398#34907398", "title": "Creating infinite list out of ADT", "body": "<p>Nice catch! Indeed it errors out ...</p>\n\n<pre><code>&gt; take 10 [P, P..]\n\n&lt;interactive&gt;:6:16: parse error on input \u2018]\u2019\n</code></pre>\n\n<p>... but this does not</p>\n\n<pre><code>&gt; take 10 [P, P ..]   -- one more space\n[P,P,P,P,P,P,P,P,P,P]\n</code></pre>\n\n<p>Why the whitespace is significant? Because otherwise the syntax overlaps with module-prefixed names, which have the form <code>Module.name</code>. Here's how the operator <code>.</code> from <code>Prelude</code> is accessed, for instance.</p>\n\n<pre><code>&gt; :t (Prelude..)\n(Prelude..) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n&gt; :t succ Prelude.. succ   -- infix use!\nsucc Prelude.. succ :: Enum c =&gt; c -&gt; c\n</code></pre>\n\n<p>Hence, <code>P..</code> is <code>.</code> from module <code>P</code>, while <code>P ..</code> works fine in a list enumeration.</p>\n\n<p>(Yes, this is an unfortunate quirk of the syntax ...)</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1453331572, "creation_date": 1453331572, "answer_id": 34912453, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt/34912453#34912453", "title": "Creating infinite list out of ADT", "body": "<p>As yet another alternative, to do what it looks like you want to do directly, use</p>\n\n<pre><code>b :: [Subunit]\nb = replicate 6 P\n</code></pre>\n"}], "owner": {"reputation": 4718, "user_id": 1805129, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5754dda1f072edff8efc699b1a876d36?s=128&d=identicon&r=PG", "display_name": "Dilawar", "link": "https://stackoverflow.com/users/1805129/dilawar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 34907398, "answer_count": 5, "score": 6, "last_activity_date": 1453331572, "creation_date": 1453308738, "question_id": 34905869, "link": "https://stackoverflow.com/questions/34905869/creating-infinite-list-out-of-adt", "title": "Creating infinite list out of ADT", "body": "<p>In Haskell, </p>\n\n<pre><code> &gt; a = [1,1..]\n</code></pre>\n\n<p>creates an infinite list. Now I have the following</p>\n\n<pre><code>data Subunit = O | P deriving (Eq, Show)           \n</code></pre>\n\n<p>And if I do</p>\n\n<pre><code>b :: [Subunit]                                                                   \nb = take 6 [P,P..]  \n</code></pre>\n\n<p>I get the following:</p>\n\n<pre><code> parse error on input \u2018]\u2019\n</code></pre>\n\n<p>Why this is failing? What I need to add to be able to create an infinite list?</p>\n"}, {"tags": ["windows", "haskell", "configuration", "yaml", "haskell-stack"], "comments": [{"owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 0, "creation_date": 1453308655, "post_id": 34905113, "comment_id": 57547687, "body": "Which version are you using of <code>stack</code>? Because <code>stack</code> changes the codepage of the Windows console to avoid this kind of problem. Could you run <code>chcp 65001</code> before the <code>stack install</code> and verify if the problem persists?"}, {"owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 0, "creation_date": 1453308858, "post_id": 34905113, "comment_id": 57547814, "body": "Actually, I just made a test and you are absolutely right. <code>stack</code> changes the codepage just to output correctly the GHC messages, as shown by the first message when one runs <code>stack</code>:  &gt; Setting codepage to UTF-8 (65001) to ensure correct output from GHC"}, {"owner": {"reputation": 468, "user_id": 1581353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fc121f3c3780a4b7aa802414995a0208?s=128&d=identicon&r=PG", "display_name": "Ren&#233; Martin", "link": "https://stackoverflow.com/users/1581353/ren%c3%a9-martin"}, "reply_to_user": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 0, "creation_date": 1453308865, "post_id": 34905113, "comment_id": 57547816, "body": "<code>stack --version</code> returns: <code>Version 1.0.2, Git revision fa09a980d8bb3df88b2a9193cd9bf84cc6c419b3 (3084 commits) x86_64</code>,  <code>chcp 65001</code> also won&#39;t help"}, {"owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 5, "creation_date": 1453309087, "post_id": 34905113, "comment_id": 57547973, "body": "Maybe you could change the <code>STACK_ROOT</code> system variable as <a href=\"http://docs.haskellstack.org/en/stable/install_and_upgrade.html#windows\" rel=\"nofollow noreferrer\">recommend in their manual</a>."}, {"owner": {"reputation": 468, "user_id": 1581353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fc121f3c3780a4b7aa802414995a0208?s=128&d=identicon&r=PG", "display_name": "Ren&#233; Martin", "link": "https://stackoverflow.com/users/1581353/ren%c3%a9-martin"}, "reply_to_user": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 1, "creation_date": 1453310166, "post_id": 34905113, "comment_id": 57548683, "body": "using <code>SET STACK_ROOT ...</code> did not help, but it worked when i set the environment varibale samually in the windows system settings under advanced settings &gt; environment variables"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453328088, "post_id": 34905113, "comment_id": 57558955, "body": "@Ren&#233;Martin: It depends on your shell. CMD will happily accept <code>SET STACK_ROOT=...</code>, but forgets the environment variables at the end of your session, PowerShell needs a variable assignment via <code>$env:STACK_ROOT=...</code> and also forgets about the assignment as soon as you close it (unless specified in an init script). The environment variable settings is more or less the only &quot;sane&quot; place on Windows to save <code>STACK_ROOT</code> in a persistent way."}], "answers": [{"tags": [], "owner": {"reputation": 6152, "user_id": 53974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a676c96a88feb813010e67af012ca0?s=128&d=identicon&r=PG", "display_name": "Blaisorblade", "link": "https://stackoverflow.com/users/53974/blaisorblade"}, "is_accepted": false, "score": 1, "last_activity_date": 1471437205, "creation_date": 1471437205, "answer_id": 38996791, "question_id": 34905113, "link": "https://stackoverflow.com/questions/34905113/how-to-change-the-default-location-of-stack-yaml-on-windows/38996791#38996791", "title": "How to change the default location of stack.yaml on windows?", "body": "<p>This was indeed a stack bug, fixed after 1.1.2, and due in the end to a bug in the YAML library (details in <a href=\"https://github.com/commercialhaskell/stack/issues/2491\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/2491</a> and <a href=\"https://github.com/snoyberg/yaml/pull/91\" rel=\"nofollow\">https://github.com/snoyberg/yaml/pull/91</a>).</p>\n"}], "owner": {"reputation": 468, "user_id": 1581353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fc121f3c3780a4b7aa802414995a0208?s=128&d=identicon&r=PG", "display_name": "Ren&#233; Martin", "link": "https://stackoverflow.com/users/1581353/ren%c3%a9-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1471681678, "creation_date": 1453306630, "last_edit_date": 1471681678, "question_id": 34905113, "link": "https://stackoverflow.com/questions/34905113/how-to-change-the-default-location-of-stack-yaml-on-windows", "title": "How to change the default location of stack.yaml on windows?", "body": "<p>I am trying to install Stack for Haskell on a Windows machine. For the Installation I used the 64bit installer.\nAfter the installer finished I wanted to install stack dependencies with</p>\n\n<pre><code>stack install\n</code></pre>\n\n<p>in command line. However, I get this error:</p>\n\n<pre><code>Could not parse 'C:\\Users\\Ren\u251c\u00ae\\AppData\\Roaming\\stack\\config.yaml':\nInvalidYaml (Just (YamlException \"Yaml file not found: C:\\\\Users\\\\Ren\\233\\\\AppData\\\\Roaming\\\\stack\\\\config.yaml\"))\nSee http://docs.haskellstack.org/en/stable/yaml_configuration.html.\n</code></pre>\n\n<p>If I had to guess it is because the default stack.yaml configuration file of stack is stored in AppData which folder name contains my user name. And I guess special characters in this folder name are not supported (since the actual user and the users folder is called \"Ren\u00e9\").</p>\n\n<p>I also allready tried installing Stack in the default location (which is also inside AppData) and a different folder outside of the users folder - still the same problem.</p>\n\n<p>Is there any possibility to change the location where stacks takes its default stack.yaml file from or any other known workaround for this issue?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453301617, "post_id": 34903120, "comment_id": 57542489, "body": "here <code>return []</code> is not <code>\\ x -&gt; [x]</code> as in the monad instance for <code>[]</code> - it&#39;s the <code>return</code> function from the <code>m</code> monad (so the result will depend on what <code>m</code> really is) - think <code>m = Maybe</code> if it helps you - so <code>return []</code> would be <code>Just []</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453301775, "post_id": 34903120, "comment_id": 57542607, "body": "2.) if you call <code>sequence [Just 5, Just 9]</code> then the type of a will be some <code>Num</code> yes (<code>a</code>will be <code>5</code> and <code>9</code>) - and there is no &quot;Monad&quot; in the <code>Num</code>/<code>5</code> - you could say it<code>s in </code>Just` ;)"}], "answers": [{"comments": [{"owner": {"reputation": 891, "user_id": 357891, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f262321612616d775a50f7bef02fb25b?s=128&d=identicon&r=PG", "display_name": "Tachy", "link": "https://stackoverflow.com/users/357891/tachy"}, "edited": false, "score": 0, "creation_date": 1453304717, "post_id": 34903765, "comment_id": 57544801, "body": "Thanks. That makes things much more clear. The fact that <code>m [t]</code> for the list monad is <code>[[t]] </code> eluded me until you pointed it out. And I think it helps a bit with my second confusion about the type of <code>a</code>. I thought it had to be a monad wrapped value because I couldn&#39;t figure out how a Num would combine with a <code>m [t]</code> for example, but if  <code>return []</code> is essentially <code>[[]]</code>, how does <code>(Num : [[]])</code> work?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 891, "user_id": 357891, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f262321612616d775a50f7bef02fb25b?s=128&d=identicon&r=PG", "display_name": "Tachy", "link": "https://stackoverflow.com/users/357891/tachy"}, "edited": false, "score": 0, "creation_date": 1453313012, "post_id": 34903765, "comment_id": 57550591, "body": "Extended the answer to hopefully clear up your confusion."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 3, "last_activity_date": 1453312998, "last_edit_date": 1453312998, "creation_date": 1453302952, "answer_id": 34903765, "question_id": 34903120, "link": "https://stackoverflow.com/questions/34903120/questions-on-haskells-sequence-function/34903765#34903765", "title": "Questions on Haskell&#39;s sequence function", "body": "<p>The type of <code>return []</code> is <code>Monad m =&gt; m [t]</code> - here, the <code>[]</code> is an instance of <code>[t]</code>, i.e. a list of some arbitrary type (the type is arbitrary since it's the empty list, so there are no instances of the type anyway). If you substitute the list monad, the type of <code>return</code> is <code>t -&gt; [t]</code>, and <code>return []</code> yields <code>[[]]</code>. The confusing thing is that both the monad and the contained value are lists.</p>\n\n<p>The type of <code>return</code> in general is <code>Monad m =&gt; t -&gt; m t</code>. If you specialize for lists, you get <code>t -&gt; [t]</code>, so the list type takes the place of <code>m</code>. The special syntax for lists makes this a bit more confusing; if you use the maybe monad instead, specialized return has the type <code>t -&gt; Maybe t</code>, so you can see clearly how the <code>m</code> was replaced by <code>Maybe</code>. In the maybe monad, the type of <code>return []</code> is <code>Maybe [t]</code>: the monad now wraps some list.</p>\n\n<p>The type of <code>return []</code> is <code>Monad m =&gt; m [t]</code>, a list wrapped by the monad. If you use the list monad, you substitute the <code>m</code> with the list constructor and get <code>[[t]]</code>, which is the right type.</p>\n\n<p>As for the second question, why do you think that <code>a</code> must be a monad?</p>\n\n<p><strong>Edit after clarification in comment</strong></p>\n\n<p>In the example call <code>sequence [Just 5, Just 9]</code> you gave, the monad is maybe, not list; that list is an ordinary list as required by the type of <code>sequence</code>. Remember that it takes a <code>[m a]</code> as input. As you supply a <code>Num a =&gt; [Maybe a]</code> as input, that makes the monad <code>Maybe</code>, and the result type is <code>Num a =&gt; Maybe [a]</code>. <code>sequence</code> turns a list of optional values into an optional list. This means that in the first case of <code>sequence</code>, the <code>return []</code> applies to <code>Maybe</code>'s <code>return</code> and means <code>Just []</code>. This makes sense, as calling <code>sequence []</code> in the maybe monad should return <code>Just []</code>.</p>\n\n<p>Now, in the do-block of the second case, we have a bunch of variables, and it helps to figure out the type of each. I'll do that for the concrete case of <code>Maybe</code> and <code>Int</code> for the numbers; getting the generic types comes down to simply replacing <code>Maybe</code> with <code>m</code> and <code>Int</code> with <code>a</code> in all these cases, and adding constraints.</p>\n\n<p>The entire input has type <code>[Maybe Int]</code>. The second case pattern-matches this with <code>(ma:mas)</code>, picking the first element off the list. So <code>ma</code> has the type of the list's element, <code>Maybe Int</code>, whereas <code>mas</code> is the remainder of the list and thus has type <code>[Maybe Int]</code>.</p>\n\n<p>In the do-block, <code>ma</code> is unwrapped with the arrow notation, and the result is <code>a</code>, whose type is therefore that of <code>ma</code> with the monad stripped, i.e. <code>Int</code>.</p>\n\n<p>Then, <code>sequence</code> is called recursively with the rest of the input, <code>mas</code>, which has type <code>[Maybe Int]</code>. Substituting into the type of <code>sequence</code> shows that the result type is <code>Maybe [Int]</code>. This value is again unwrapped, so the target <code>as</code> has type <code>[Int]</code>.</p>\n\n<p>In the last line, <code>a</code> (type <code>Int</code>) is prepended to <code>as</code> (type <code>[Int]</code>), yielding a longer list (<code>[Int]</code>). The result is given to <code>return</code>, which wraps it in a <code>Just</code> (<code>Maybe [Int]</code>) to match the result type of <code>sequence</code>.</p>\n\n<p>By the way, if you want to track the types through do-blocks in detail, you should first desugar them to normal composition with lambdas.</p>\n"}], "owner": {"reputation": 891, "user_id": 357891, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f262321612616d775a50f7bef02fb25b?s=128&d=identicon&r=PG", "display_name": "Tachy", "link": "https://stackoverflow.com/users/357891/tachy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2068, "favorite_count": 0, "accepted_answer_id": 34903765, "answer_count": 1, "score": 2, "last_activity_date": 1453312998, "creation_date": 1453301142, "last_edit_date": 1453311847, "question_id": 34903120, "link": "https://stackoverflow.com/questions/34903120/questions-on-haskells-sequence-function", "title": "Questions on Haskell&#39;s sequence function", "body": "<p>I've been going through UPenn's CS194 and currently on Lecture 7, Monads. I thought I was getting an okay handle on Monads until I saw the implementation of the sequence function and started poking around.</p>\n\n<pre><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]\nsequence [] = return []\nsequence (ma:mas) = do\n  a  &lt;- ma\n  as &lt;- sequence mas\n  return (a:as)\n</code></pre>\n\n<p>This seems intuitive at first glance, but as I delved into it, I came up against a bunch of questions:</p>\n\n<ol>\n<li><p>The type of <code>return []</code> is : <code>return [] :: Monad m =&gt; m [t]</code> . Earlier in the same lesson, the <code>Monad</code> instance for <code>[]</code> defines return as:  <code>return x = [x]</code>.  How did this lead to the type signature <code>m [t]</code> for <code>return []</code>?</p></li>\n<li><p><code>a &lt;- ma</code> . What is type of <code>a</code> here, assuming I called sequence with <code>[Just 5, Just 9]</code> ?  By the <code>Monad</code> instance definition of <code>Maybe</code>:   </p>\n\n<pre><code>Just x  &gt;&gt;= k = k x\n</code></pre>\n\n<p>I would think <code>x</code>, or <code>a</code> in the case of <code>sequence</code> would be a <code>Num</code>. But it must really be a <code>Monad</code> of <code>Num</code>. How did <code>x</code> become a monad of <code>Num</code> here when <code>Just x</code> from the instance definition of <code>Maybe</code> seems to be pulling <code>x</code> out of <code>Just</code>?</p></li>\n</ol>\n"}, {"tags": ["haskell", "graphics", "haskell-diagrams"], "answers": [{"comments": [{"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1453821656, "post_id": 34929113, "comment_id": 57761278, "body": "Unfortunately the paths I&#39;m working with are continuous, but not &quot;smooth&quot; (they have &quot;spikes&quot;) and &quot;framing&quot; them as suggested can lead to mixed results. But I agree that it seems the best solution currently. Diagrams.TwoD.Offset offsetTrails functions would be better but I had problem with them."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 1, "last_activity_date": 1453393720, "creation_date": 1453393720, "answer_id": 34929113, "question_id": 34902240, "link": "https://stackoverflow.com/questions/34902240/diagrams-boundingrect-including-the-lines-width/34929113#34929113", "title": "Diagrams boundingRect including the lines&#39; width", "body": "<p>Unfortunately there's no way to do this automatically yet. The easiest way would be to <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-Combinators.html#v:frame\" rel=\"nofollow noreferrer\"><code>frame</code></a> the diagram before finding the <code>boundingRect</code>. Since you're using the local units you just need to <code>frame</code> half the local width used in the diagram (add half of the line width used for the bounding rectangle if that has a line too).</p>\n\n<p>Here's a simple example:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Diagrams.Prelude\nimport Diagrams.Backend.Rasterific.CmdLine\n\nmain :: IO ()\nmain = mainWith $ frame 1 rects\n\nrects :: Diagram B\nrects = hsep 1 $ map (dia &lt;&gt;) [br1, br2, br3]\n  where\n    br1 = boundingRect dia # lwL 0.2 # lc red\n    br2 = boundingRect (frame 0.1 dia) # fc dodgerblue # lw none\n    br3 = boundingRect (frame 0.2 dia) # lwL 0.2 # lc red\n\ndia :: Diagram B\ndia = circle 3 # fc orange # lwL 0.2\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/4ukiV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4ukiV.png\" alt=\"bounding rectangles\"></a></p>\n\n<p>A more general solution would be to draw the offset curves of each path using the local line width in the <code>Diagram</code> and find the bounding box of that. <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-TwoD-Offset.html\" rel=\"nofollow noreferrer\"><code>Diagrams.TwoD.Offset</code></a> can almost do this but I don't think it works for all cases.</p>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 34929113, "answer_count": 1, "score": 1, "last_activity_date": 1453393720, "creation_date": 1453298785, "last_edit_date": 1453299844, "question_id": 34902240, "link": "https://stackoverflow.com/questions/34902240/diagrams-boundingrect-including-the-lines-width", "title": "Diagrams boundingRect including the lines&#39; width", "body": "<p>Is there an equivalent to the <a href=\"http://projects.haskell.org/diagrams/haddock/Diagrams-TwoD-Combinators.html#v:boundingRect\" rel=\"nofollow\">boundingRect</a> function which includes the diagram's lines width(*), so that each line, however thick it is, is entirely contained within the bounding rectangle? (the <code>boundingRect</code> function \"ignores\" their thickness and parts of the lines stay outside the bounding rectangle). </p>\n\n<p>(*) My question is for lines with width expressed in local units.</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1453311530, "post_id": 34901907, "comment_id": 57549601, "body": "Not an answer to your question, but I think <code>fold x2</code> will in fact be O(n). When walking left-to-right across a binary tree, you have to look at all of the elements to find the last non-<code>Nothing</code>. Plugging in <code>Last</code> doesn&#39;t magically make the traversal change direction. Folding a <a href=\"https://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Reverse.html\" rel=\"nofollow noreferrer\"><code>Reverse (BinaryTree (First a))</code></a> on the other hand should get you the same answer in O(n)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453311570, "post_id": 34901907, "comment_id": 57549624, "body": "I might be wrong, but I guess that the original <code>O(log n)</code> bound does not depend on the tree being balanced, but only on how many <code>Nothing</code>s you find before hitting a <code>Just</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1453311709, "post_id": 34901907, "comment_id": 57549700, "body": "PS you can <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/deriving.html#deriving-typeable\" rel=\"nofollow noreferrer\">derive Foldable</a> to save you some boilerplate"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1453312161, "post_id": 34901907, "comment_id": 57550048, "body": "In fact, thinking about it further, O(log(n)) is only the <i>best case</i> for <code>fold x1</code>. If you&#39;re looking for the first <code>Just</code> in a tree of <code>Nothing</code>s you have to inspect them all. I would describe all of these functions as having O(n) complexity"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453324692, "post_id": 34901907, "comment_id": 57557085, "body": "Not an answer, but note that some defaults (e.g., for <code>foldr</code> and <code>foldl</code>) are quite good, others (e.g., for <code>sum</code> and <code>maximum</code>) are pretty lousy."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1453331405, "post_id": 34901907, "comment_id": 57560399, "body": "For the purpose of the question assume no &quot;Nothing&#39;s&quot; and balanced. If either of these aren&#39;t true you of course can get O(n) performance regardless of the algorithm (eg if the tree is n deep or there&#39;s all Nothing&#39;s and you have to check them all)"}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": false, "score": 2, "last_activity_date": 1453415229, "last_edit_date": 1453415229, "creation_date": 1453379075, "answer_id": 34923765, "question_id": 34901907, "link": "https://stackoverflow.com/questions/34901907/performance-of-foldables-default-methods/34923765#34923765", "title": "Performance of Foldable&#39;s default methods", "body": "<p>Yes, it has O(log(n)) best case performance.</p>\n\n<p><code>Endo</code> is a wrapper around (a -> a) kind of functions that:</p>\n\n<pre><code>instance Monoid (Endo a) where\n  mempty = Endo id\n  Endo f `mappend` Endo g = Endo (f . g)\n</code></pre>\n\n<p>And the default implementation of <code>foldr</code> in Data.Foldable:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr f z t = appEndo (foldMap (Endo #. f) t) z\n</code></pre>\n\n<p>The definition of <code>.</code> (function composition) in case:</p>\n\n<pre><code>(.) f g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>Endo is defined by newtype constructor, so it only exists at compile stage, not run-time.\n<code>#.</code> operator changes the type of it's second operand and discard the first.\nThe newtype constructor and <code>#.</code> operator guarantee that you can ignore the wrapper when considering performance issues.</p>\n\n<p>So the default implementation of <code>foldr</code> can be reduced to:</p>\n\n<pre><code>-- mappend = (.), mempty = id from instance Monoid (Endo a)\nfoldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr f z t = foldMap f t z\n</code></pre>\n\n<p>For your <code>Foldable BinaryTree</code>:</p>\n\n<pre><code>foldr f z t\n  = foldMap f t z\n  = case t of\n    Leaf a -&gt; f a z\n    -- what we care\n    BinaryTree l r -&gt; ((foldMap f l) . (foldMap f r)) z\n</code></pre>\n\n<p>The default lazy evaluation in Haskell is ultimately simple, there are just two rules:</p>\n\n<ol>\n<li>function application first</li>\n<li>evaluate the arguments from left to right if the values matter</li>\n</ol>\n\n<p>That makes it easy to trace the evaluation of the last line of the code above:</p>\n\n<pre><code>  ((foldMap f l) . (foldMap f r)) z\n= (\\z -&gt; foldMap f l (foldMap f r z)) z\n= foldMap f l (foldMap f r z)\n-- let z' = foldMap f r z\n= foldMap f l z' -- height 1\n-- if the branch l is still not a Leaf node\n= ((foldMap f ll) . (foldMap f lr)) z'\n= (\\z -&gt; foldMap f ll (foldMap f lr)) z'\n= foldMap f ll (foldMap f lr z')\n-- let z'' = foldMap f lr z'\n= foldMap f ll z'' -- height 2\n</code></pre>\n\n<p>The right branch of the tree is never expanded before the left has been fully expanded, and it goes one level higher after an O(1) operation of function expansion and application, therefore when it reached the left-most Leaf node:</p>\n\n<pre><code>= foldMap f leaf@(Leaf a) z'heightOfLeftMostLeaf\n= f a z'heightOfLeftMostLeaf\n</code></pre>\n\n<p>Then <code>f</code> looks at the value <code>a</code> and decides to ignore its second argument (like what <code>mappend</code> will do to <code>First</code> values), the evaluation short-circuits, results O(height of the left-most leaf), or O(log(n)) performance when the tree is balanced.</p>\n\n<p><code>foldl</code> is all the same, it's just <code>foldr</code> with <code>mappend</code> flipped i.e. O(log(n)) best case performance with <code>Last</code>.</p>\n\n<p><code>foldl'</code> and <code>foldr'</code> are different.</p>\n\n<pre><code>foldl' :: (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldl' f z0 xs = foldr f' id xs z0\n  where f' x k z = k $! f z x\n</code></pre>\n\n<p>At every step of reduction, the argument is evaluated first and then the function application, the tree will be traversed i.e. O(n) best case performance.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1453415229, "creation_date": 1453297909, "question_id": 34901907, "link": "https://stackoverflow.com/questions/34901907/performance-of-foldables-default-methods", "title": "Performance of Foldable&#39;s default methods", "body": "<p>I've been exploring the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> class and also the the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html\" rel=\"nofollow\"><code>Monoid</code></a> class. </p>\n\n<p>Firstly, lets say I want to fold over a list of the Monoid <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow\"><code>First</code></a>. Like so:</p>\n\n<pre><code>x :: [First a]\n\nfold? mappend mempty x\n</code></pre>\n\n<p>Then I assume in this case the most appropriate fold would be <code>foldr</code>, as <code>mappend</code> for <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow\"><code>First</code></a> is lazy in it's second argument.</p>\n\n<p>Conversely, for <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:Last\" rel=\"nofollow\"><code>Last</code></a> we'd want to <code>foldl'</code> (or just <code>foldl</code> I'm not sure). </p>\n\n<p>Now moving away from lists, I've defined a simple binary tree like so:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata BinaryTree a where\n  BinaryTree :: BinaryTree a -&gt; BinaryTree a -&gt; BinaryTree a\n  Leaf :: a -&gt; BinaryTree a\n</code></pre>\n\n<p>And I've made it <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> with the most straightforward definition:</p>\n\n<pre><code>instance Foldable BinaryTree where\n  foldMap f (BinaryTree left right) = \n    (foldMap f left) `mappend` (foldMap f right)\n  foldMap f (Leaf x) = f x\n</code></pre>\n\n<p>As <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> defines <code>fold</code> as simply <code>foldMap id</code> we can now do:</p>\n\n<pre><code>x1 :: BinaryTree (First a)\nfold x1 \n\nx2 :: BinaryTree (Last a)\nfold x2\n</code></pre>\n\n<p>Assuming our BinaryTree is balanced, and there's not many <code>Nothing</code> values, these operations should take <code>O(log(n))</code> time I believe. </p>\n\n<p>But <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> also defines a whole lot of default methods like <code>foldl</code>, <code>foldl'</code>, <code>foldr</code> and <code>foldr'</code> based on <code>foldMap</code>.</p>\n\n<p>These default definitions seem to be implemented by composing a bunch of functions, wrapped in a Monoid called <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow\"><code>Endo</code></a>, one for each element in the collection, and then composing them all.</p>\n\n<p>For the purpose of this discussion I am not modifying these default definitions.</p>\n\n<p>So lets now consider:</p>\n\n<pre><code>x1 :: BinaryTree (First a)\nfoldr mappend mempty x1 \n\nx2 :: BinaryTree (Last a)\nfoldl mappend mempty x2 \n</code></pre>\n\n<p>Does running these retain <code>O(log(n))</code> performance of the ordinary <code>fold</code>? (I'm not worried about constant factors for the moment). Does laziness result in the tree not needing to be fully traversed? Or will the default definitions of <code>foldl</code> and <code>foldr</code> require an entire traversal of the tree?</p>\n\n<p>I tried to go though the algorithm step by step (much like they did on the <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow\">Foldr Foldl Foldl'</a> article) but I ended up completely confusing myself as this is a bit more complex as it involves an interaction between <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a>, <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html\" rel=\"nofollow\"><code>Monoid</code></a> and <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow\"><code>Endo</code></a>.</p>\n\n<p>So what I'm looking for is an explanation of why (or why not) the default definition of say <code>foldr</code>, would only take <code>O(log(n))</code> time on a balanced binary tree like above. A step by step example like what's from the <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow\">Foldr Foldl Foldl'</a> article would be really helpful, but I understand if that's too difficult, as I totally confused myself attempting it.</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1453296932, "post_id": 34901115, "comment_id": 57539055, "body": "Have you tried reading any of the numerous resources already available online before coming here?"}, {"owner": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1453298503, "post_id": 34901115, "comment_id": 57540204, "body": "@BartekBanachewicz Yes"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1453299002, "post_id": 34901115, "comment_id": 57540567, "body": "I once wrote a detailed evaluation chain for a Haskell function here: <a href=\"http://stackoverflow.com/questions/29898999/how-does-this-list-comprehension-over-the-inits-of-itself-work/29900144#29900144\" title=\"how does this list comprehension over the inits of itself work\">stackoverflow.com/questions/29898999/&hellip;</a> Maybe that will help you."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1453299187, "post_id": 34901115, "comment_id": 57540702, "body": "I think the first evaluation step here is not very honest if you really should explain the lazy-part ..."}, {"owner": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1453300696, "post_id": 34901115, "comment_id": 57541846, "body": "@SebastianRedl That does help thank you"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453301335, "post_id": 34901115, "comment_id": 57542312, "body": "@Carsten Indeed, those lines are just plain wrong."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453395072, "post_id": 34901115, "comment_id": 57592319, "body": "@Carsten that&#39;s what I was thinking too, but actually, <code>evens</code> demands at least 3 elements from its input, and <code>exchange</code> only knows how to produce them by pairs, so demands them by pairs too from its supplier. to produce three, it must have four of them. :) this is a really trickily written code. (normally, it&#39;d be <code>evens [] = [] ; ...</code> same for <code>exchange</code>)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453395424, "post_id": 34901115, "comment_id": 57592565, "body": "@WillNess if you want to demonstrate laziness you have to begin by &quot;expanding&quot; <code>take</code> first (the rest can stay a unevaluated thunk for now) - and that is just the beginning"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453396559, "post_id": 34901115, "comment_id": 57593319, "body": "@WillNess look I don&#39;t think that us arguing will help anyone and it&#39;s a minor point but I would start the evaluation by rewriting first take and then <code>evens</code>, ... you now like <code>take 0 undefined</code>..."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "edited": false, "score": 0, "creation_date": 1453310920, "post_id": 34902063, "comment_id": 57549196, "body": "Kinda I don&#39;t know what interim entity means though"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "edited": false, "score": 0, "creation_date": 1453322691, "post_id": 34902063, "comment_id": 57555997, "body": "the <code>x1</code> and the <code>xs1</code>, etc. What <i>forces</i> the calculation of an expression&#39;s value is the need to pattern match it, when that need arises. like with <code>take</code>, the <code>take 0 ... = ...</code> doesn&#39;t match the  call <code>take 5 (...)</code>; so we move on to the next clause in <code>take</code>&#39;s defintion, and try to match the call <code>take 5 (...)</code> with <code>take n (x:xs) = ...</code>. So <code>n</code> matches with 5, by registering <code>n = 5</code>. Next, we must see whether <code>(evens ...)</code> matches with <code>(x:xs)</code> (but, we renamed them to <code>x1:xs1</code> (NB!)). So we go on to see the definition of <code>evens</code>. And so on. -- don&#39;t hesitate to ask more. :)"}, {"owner": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "edited": false, "score": 0, "creation_date": 1453386500, "post_id": 34902063, "comment_id": 57586238, "body": "Ok I think I get it am I on the right track with this? ... take 5 (evens (2:1:(exchange (3:4:first_four)))) = <code>take 5 (2:(evens (exchange 3:4:first_four)))</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "edited": false, "score": 0, "creation_date": 1453394889, "post_id": 34902063, "comment_id": 57592203, "body": "turns out your were right all along. :) <code>even</code> demands 3 elements, but <code>exchange</code> only know how to produce them in pairs."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1453742528, "last_edit_date": 1453742528, "creation_date": 1453298309, "answer_id": 34902063, "question_id": 34901115, "link": "https://stackoverflow.com/questions/34901115/demonstrating-lazy-evaluation-in-haskell/34902063#34902063", "title": "Demonstrating Lazy evaluation in Haskell?", "body": "<p>Treat your definitions as re-write equations, and always (<em>uniquely</em>) name the interim entities as they come into play:</p>\n\n<pre><code>take 5 (evens (exchange first_four))\n  -- match: take 0 .... = ....    ? FAIL\n  -- match: take n (x:xs) = ....   ? SUCCESS\n  n1 = 5 \n  (x1:xs1) ?= evens (exchange first_four)   \n    -- evens [x,y] = ....\n    [x2,y2] ?= exchange first_four\n      -- exchange [x,y] = ....\n      [x3,y3] ?= first_four\n  ......\n</code></pre>\n\n<p>etc. The operation is mechanical. \"Laziness\" here means, we proceed left-to-right, never trying to find out values of expressions too soon, only doing so when we actually need to pattern match some definition with them.</p>\n\n<p>Here's what I meant by <em>\"naming\"</em> the <em>interim</em> entities:</p>\n\n<pre><code>take 5 (evens (exchange first_four)) =\ntake 5 xs   where xs = evens (exchange first_four)\n       (x1:xs1) ?= xs  -- &lt;---- THIS\n                 = evens (exchange first_four)\n                 = evens ys   where ys = exchange first_four\n                         [x2,y2] ?= ys  -- &lt;--- AND THIS\n                         .     .  = exchange first_four\n                         .     .          -- ^^ &lt;--- already named\n                         .     .       [x3,y3] ?= first_four\n                         .     .               FAIL\n                         .     .       (x3:y3:xs3) ?= first_four\n                         .     .                    = 1:2:3:4:first_four\n                         .     .               SUCCESS: x3=1\n                         .     .                        y3=2\n                         .     .                        xs3=3:4:first_four\n                         .     .   ys = y3:x3:exchange xs3   !\n                         .     .   [] ?= exchange xs3\n                         .             = ...\n                         .             FAIL\n                         (x2:_:xs2) ?= ys\n                                       SUCCESS: x2=y3\n                                                xs2=...\n</code></pre>\n\n<p>Of course working to this fine details resolution is very tiresome and seldom needed, only perhaps to track some \"timing\" issues; it is easier to see what each definition does, separately, and treat them as separate producers connected in a chain. </p>\n\n<p>By \"timing\" I mean, whether the \"inner\" producer is ready to produce its element when the \"outer\" one needs it. because if not, the whole process becomes stuck, <em>\"non-productive\"</em>. Here the most inner producer is an infinite stream, directly defined, so there's no such problems. </p>\n\n<p>So mentally, we could say to ourselves: \"<code>first_four</code> is infinite repeating stream of 1 to 4; <code>exchange</code> swaps each pair of elements it gets; <code>evens</code> throws away every element in odd position; <code>take</code> takes n elements\".</p>\n\n<p><strong>So actually, it turns out <em>you were right all along</em>.</strong> </p>\n\n<p>Because of how the definitions are written, <code>evens</code> forces out of <code>exchange</code> its output elements in groups of four, more or less. Mainly, the culprit is the unnecessary matching for <code>[x,y]</code> in <code>evens</code> and <code>exchange</code>, which demands <em>three</em> elements from its input, to see whether the tail is empty (<code>[]</code>) or not. </p>\n\n<p><code>evens</code> demands three elements, but <code>exchange</code> only knows how to produce them by pairs.</p>\n\n<p>But <code>exchange</code> too demands at least three elements from its supplier. So, coarsely:</p>\n\n<pre>\ntake 5 <b>(evens (exchange first_four))</b>\ntake 5 (evens <b>(exchange first_four)</b>)\ntake 5 (evens (exchange (<b>1:2:3:</b>(4:first_four)))\ntake 5 (evens (2:1:exchange (<b>3:4:1:</b>(2:3:4:first_four))))\ntake 5 (evens (<b>2:1:4:</b>(3:exchange (1:2:3:4:first_four))))\ntake 5 (<b>2:</b>evens (4:3:exchange (1:2:3:4:first_four)))\n2:take 4 (evens (4:3:<b>exchange (1:2:3:4:first_four)</b>))\n2:take 4 (evens (<b>4:3:2:</b>(1:exchange (3:4:first_four))))\n2:take 4 (<b>4:</b>evens (2:1:exchange (3:4:first_four)))\n2:4:take 3 (evens (2:1:exchange (<b>3:4:1:</b>(2:3:4:first_four))))\n2:4:take 3 (evens (<b>2:1:4:</b>(3:exchange (1:2:3:4:first_four))))\n2:4:take 3 (<b>2:</b>evens (4:3:exchange (1:2:3:4:first_four)))\n........\n</pre>\n\n<p>I'm sure you can finish this now. :) </p>\n\n<p>To illustrate, here's <code>exchange</code> looked at <em>procedurally</em>, as a stream transformer, which can <code>pull</code> an element from its input; <code>peek</code> whether its input has an element ready to be pulled; and <code>push</code> an element into its output.</p>\n\n<pre><code>exchange:\n   pull(X)  ...  on_fail: ERROR\n   pull(Y)  ...  on_fail: ERROR\n   peek     ...  on_fail: push(Y); push(X); STOP\n   push(Y); push(X)\n   LOOP\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 3441503, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c427484639b03d03d322c422ace67a9?s=128&d=identicon&r=PG&f=1", "display_name": "OrbitalFriendshipCannon", "link": "https://stackoverflow.com/users/3441503/orbitalfriendshipcannon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 2, "accepted_answer_id": 34902063, "answer_count": 1, "score": 2, "last_activity_date": 1453742528, "creation_date": 1453295781, "last_edit_date": 1453296613, "question_id": 34901115, "link": "https://stackoverflow.com/questions/34901115/demonstrating-lazy-evaluation-in-haskell", "title": "Demonstrating Lazy evaluation in Haskell?", "body": "<p>This is a question from one of my homework assignments that I haven't been able to answer. It's to do with reasoning about Haskell code by demonstrating how the Haskell compiler (interpreter?) executes programs.</p>\n\n<p>I'm given a few different functions...</p>\n\n<pre><code>-- built-in\ntake :: Int -&gt; [a] -&gt; [a] \ntake 0 _ = [] \ntake n (x:xs) = x : (take (n - 1) xs) \n\n-- exchanging entries\nexchange :: [a] -&gt; [a] \nexchange [x,y] = [y,x] \nexchange (x:y:xs) = (y:x:(exchange xs))\n\n-- picking even numbered entries\nevens :: [a] -&gt; [a] \nevens [x,y] = [x] \nevens (x:_:xs) = x:(evens xs) \n\n-- first four numbers repeated\nfirst_four :: [Int] \nfirst_four = 1:2:3:4:first_four \n</code></pre>\n\n<p>Now I have to demonstrate understanding of Lazy Evaluation by \"pretending to be the compiler\". By breaking down how this statement would be executed...</p>\n\n<pre><code>&gt; take 5 (evens (exchange first_four))\n[2,4,2,4,2] \n</code></pre>\n\n<p>I'm given the first few lines to help get started...</p>\n\n<pre><code>take 5 (evens (exchange first_four)) =\ntake 5 (evens (exchange (1:2:3:4:first_four))) =\ntake 5 (evens (2:1:(exchange (3:4:first_four)))) =\n...\n</code></pre>\n\n<p>I'd like some help with understanding how lazy evaluation works so I can do this question. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453286171, "post_id": 34897366, "comment_id": 57531701, "body": "Related: <a href=\"https://stackoverflow.com/questions/27067905/when-are-type-signatures-necessary-in-haskell\" title=\"when are type signatures necessary in haskell\">stackoverflow.com/questions/27067905/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453286051, "post_id": 34897553, "comment_id": 57531637, "body": "Does that line generate actual code (like some runtime type checking? I&#39;m completely new to Haskell..)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453286149, "post_id": 34897553, "comment_id": 57531686, "body": "you should read it as a hint to the compiler (which might or might not change the generated code based on those hints) - if you don&#39;t give it the compiler will try to infer it"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453286344, "post_id": 34897553, "comment_id": 57531809, "body": "<i>&quot;You are right, they are absolutely not necessary.&quot;</i> In <b><i>this</i></b> case. There are several cases where GHC will yell at you if you leave the type signature and spit out several pages of ambiguity errors."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 2, "creation_date": 1453290594, "post_id": 34897553, "comment_id": 57534787, "body": "@JohnsonSteward: Nope!  Haskell is statically typed, and all types are resolved at compile time.  Whether you tell the compiler what the type is (with a type signature like that), or you let the compiler figure it out for itself (via type inference), the resulting generated code is the same.  (One exception: if you give the code a <i>more specific</i> type, then the compiler may generate different output.)"}, {"owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453295485, "post_id": 34897553, "comment_id": 57538099, "body": "Read further, and discovered this: <code>zipWith&#39;\u00a0::\u00a0(a\u00a0-&gt;\u00a0b\u00a0-&gt;\u00a0c)\u00a0-&gt;\u00a0[a]\u00a0-&gt;\u00a0[b]\u00a0-&gt;\u00a0[c]</code>. Seems like this is not easily deducible for the compiler..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453334894, "post_id": 34897553, "comment_id": 57561622, "body": "@JohnsonSteward Haskell should be able to infer that type from any of the obvious implementations. Have you <i>tried</i> any of this?"}, {"owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1453336435, "post_id": 34897553, "comment_id": 57562058, "body": "@Ben for <code>zipWith&#39;</code>? I implemented with this: <code>zipWith</code> _ [] _ = [] \\n<code>, </code>zipWith&#39; _ _ [] = [] \\n` and <code>zipWith&#39; f (x:xs) (y:ys) = f x y : zipWith&#39; f xs ys \\n</code>"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453337075, "post_id": 34897553, "comment_id": 57562252, "body": "@JohnsonSteward With your code in a file (nothing else; no type signature), I can load it in ghci, type <code>:t zipWith&#39;</code> and it shows <code>zipWith&#39; :: (t -&gt; t2 -&gt; t1) -&gt; [t] -&gt; [t2] -&gt; [t1]</code>.  Although I did correct that your first equation has <code>zipWith =</code> instead of <code>zipWith&#39; =</code>; wasn&#39;t sure if that was just an issue of display here, given the slightly messed up code formatting."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453337290, "post_id": 34897553, "comment_id": 57562320, "body": "@JohnsonSteward Vanilla Haskell (no extensions) has almost complete type inference (I believe the only exceptions involve type-class-polymorphic code that doesn&#39;t actually pin down the particular type). You can often write full programs without <i>any</i> type annotations at all (although most Haskellers would choose to add them anyway)."}, {"owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1453338954, "post_id": 34897553, "comment_id": 57562793, "body": "@Ben That&#39;s a typo, I&#39;m on a phone and mistakenly typed <code>`</code> for <code>&#39;</code>."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 6, "last_activity_date": 1453290359, "last_edit_date": 1453290359, "creation_date": 1453285931, "answer_id": 34897553, "question_id": 34897366, "link": "https://stackoverflow.com/questions/34897366/function-pattern-matching-in-haskell/34897553#34897553", "title": "Function pattern matching in Haskell", "body": "<p>You are right, they are absolutely not necessary. However, it's a very common practice to state the type of the function nevertheless, for at least two reasons :</p>\n\n<ul>\n<li>To tell the compiler what you actually mean. In case you make a mistake writing the function, the compiler will not infer a bad type, but warn you of your mistake</li>\n<li>To tell the people who read your code. They'll have to find out the type of the function anyway while understanding the code, so you might as well make it easier for them. Having the type explicitly makes the code more readable.</li>\n</ul>\n\n<p>This is why, although they are optional, the types of top level functions are almost always spelled out in Haskell code.</p>\n\n<hr>\n\n<p>To complete with what Zeta said, it is not necessary in this case. However, in some situations, it is necessary to specify the type of the function when the code is too ambiguous to infer.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1453286475, "post_id": 34897697, "comment_id": 57531906, "body": "1. Link is broken. 2. Currently, your answer is almost a link-only answer. Add more information into the answer itself."}, {"owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453287610, "post_id": 34897697, "comment_id": 57532740, "body": "@Zeta 2 agreed, 1 link is not broken though."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "edited": false, "score": 0, "creation_date": 1453287890, "post_id": 34897697, "comment_id": 57532958, "body": "@JohnsonSteward: Ninja edit during the first five minutes."}, {"owner": {"reputation": 1161, "user_id": 668087, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/dc7f2c29b780a53050de35720f1c21bf?s=128&d=identicon&r=PG&f=1", "display_name": "optimusfrenk", "link": "https://stackoverflow.com/users/668087/optimusfrenk"}, "edited": false, "score": 0, "creation_date": 1453292611, "post_id": 34897697, "comment_id": 57536214, "body": "Yes, I did a ninja edit after the first comment. By the way the I think the link has a good explaination for a haskell beginner."}], "tags": [], "owner": {"reputation": 1161, "user_id": 668087, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/dc7f2c29b780a53050de35720f1c21bf?s=128&d=identicon&r=PG&f=1", "display_name": "optimusfrenk", "link": "https://stackoverflow.com/users/668087/optimusfrenk"}, "is_accepted": false, "score": -2, "last_activity_date": 1453286323, "creation_date": 1453286323, "answer_id": 34897697, "question_id": 34897366, "link": "https://stackoverflow.com/questions/34897366/function-pattern-matching-in-haskell/34897697#34897697", "title": "Function pattern matching in Haskell", "body": "<p>For documentation purpose, and because for some type extensions the automatic inference fails. Read <a href=\"https://wiki.haskell.org/Type_signatures_as_good_style\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 493, "user_id": 5520728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A7cry.png?s=128&g=1", "display_name": "Johnson Steward", "link": "https://stackoverflow.com/users/5520728/johnson-steward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 34897553, "answer_count": 2, "score": 0, "last_activity_date": 1453290359, "creation_date": 1453285406, "question_id": 34897366, "link": "https://stackoverflow.com/questions/34897366/function-pattern-matching-in-haskell", "title": "Function pattern matching in Haskell", "body": "<p>I'm trying to learn Haskell in guidance of <em>Learn You a Haskell</em>, but the following puzzles me.</p>\n\n<pre><code>lucky\u00a0::\u00a0(Integral\u00a0a)\u00a0=&gt;\u00a0a\u00a0-&gt;\u00a0String\nlucky\u00a07\u00a0=\u00a0\"LUCKY\u00a0NUMBER\u00a0SEVEN!\"\u00a0\u00a0\nlucky\u00a0x\u00a0=\u00a0\"Sorry,\u00a0you're\u00a0out\u00a0of\u00a0luck,\u00a0pal!\"\n</code></pre>\n\n<p>As you can see, there's one line up there stating the exact types of the function. But is this necessary? Can't the types of parameters and return values be deduced from the patterns below that line?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1453284000, "post_id": 34896147, "comment_id": 57530281, "body": "I prefer upload resources using ajax but if you want forms, read <a href=\"https://github.com/haskell-servant/servant/issues/133\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant/issues/133</a>"}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1453284445, "post_id": 34896147, "comment_id": 57530592, "body": "Can you advice on the differences? I thought supporting multiparts was more &quot;standard&quot; way of doing it plus it will allow faster uploads due to parallelism"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1453290099, "post_id": 34896147, "comment_id": 57534504, "body": "&quot;I prefer&quot; why I prefer expose my services as client API (and you can upload many files at a time, has more fine grained control over each request, ...). Using (e.g) FORM is more cheap but much more coupled (ui &lt;-&gt; ws)."}], "answers": [{"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 1, "last_activity_date": 1458144556, "creation_date": 1458144556, "answer_id": 36041073, "question_id": 34896147, "link": "https://stackoverflow.com/questions/34896147/servant-upload-file-as-multipart-form-data/36041073#36041073", "title": "Servant: upload file as multipart/form-data", "body": "<p>This combinator works well. Just put it in a file in your app.  <a href=\"https://github.com/haskell-servant/servant/issues/133#issuecomment-125235662\" rel=\"nofollow\">https://github.com/haskell-servant/servant/issues/133#issuecomment-125235662</a></p>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 781, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1458144556, "creation_date": 1453282061, "question_id": 34896147, "link": "https://stackoverflow.com/questions/34896147/servant-upload-file-as-multipart-form-data", "title": "Servant: upload file as multipart/form-data", "body": "<p>What is the way to implement a file upload API with <code>Servant</code>?\nI am trying to handle \"standard\" <code>multipart/form-data</code> but cannot figure out how to declare it in Servant. </p>\n\n<p>This obviously doesn't work as it cannot handle multiparts:</p>\n\n<pre><code>type API = \"file\" :&gt; ReqBody '[OctetStream] ByteString :&gt; Post '[OctetStream] ()\n</code></pre>\n\n<p>Does Servant support file uploads?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1453290905, "post_id": 34894035, "comment_id": 57534984, "body": "the free arguments wouldn&#39;t be ambiguous if the arguments to <code>-a</code> were constrained to not begin with <code>-</code>, though."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1569521363, "post_id": 34894035, "comment_id": 102633514, "body": "Good answer. Want to emphasize not to use &#39;value&#39; modifier when using some/many. If your opt parsing hangs, this may be the culprit."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1453275258, "creation_date": 1453275258, "answer_id": 34894035, "question_id": 34889516, "link": "https://stackoverflow.com/questions/34889516/optparse-applicative-option-with-multiple-values/34894035#34894035", "title": "optparse-applicative option with multiple values", "body": "<p>Aside from commands, <code>optparse-applicative</code> follows the <a href=\"http://manpages.ubuntu.com/manpages/wily/en/man1/getopts.1posix.html\" rel=\"noreferrer\"><code>getopts</code></a> convention: a single argument on the command line corresponds to a single option argument. It's even a little bit more strict, since <code>getopts</code> will allow multiple options with the same switch:</p>\n\n<pre><code>./program-with-getopts -i input1 -i input2 -i input3\n</code></pre>\n\n<p>So there's no \"magic\" that can help you immediately to use your program like </p>\n\n<pre><code>./program-with-magic -a 1 2 3 -b foo bar crux\n</code></pre>\n\n<p>since <code>Options.Applicative.Parser</code> wasn't written with this in mind; it also contradicts the <a href=\"https://www.gnu.org/software/libc/manual/html_node/Argument-Syntax.html\" rel=\"noreferrer\">POSIX conventions</a>, where options take either one argument or none.</p>\n\n<p>However, you can tackle this problem from two sides: either use <code>-a</code> several times, as you would in <code>getopts</code>, or tell the user to use quotes:</p>\n\n<pre><code>./program-as-above -a \"1 2 3\" -b \"foo bar crux\" \n# works already with your program!\n</code></pre>\n\n<p>To enable the multiple use of an option you have to use <code>many</code> (if they're optional) or <code>some</code> (if they aren't). You can even combine both variants:</p>\n\n<pre><code>multiString desc = concat &lt;$&gt; some single\n  where single = option (str &gt;&gt;= parseStringList) desc\n\nconfig :: Parser MyOptions\nconfig = MyOptions\n     &lt;$&gt; multiString (short 'a' &lt;&gt; long \"aFiles\" &lt;&gt; help \"Use quotes/multiple\")\n     &lt;*&gt; multiString (short 'b' &lt;&gt; long \"bFiles\" &lt;&gt; help \"Use quotes/multiple\")\n</code></pre>\n\n<p>which enables you to use</p>\n\n<pre><code>./program-with-posix-style -a 1 -a \"2 3\" -b foo -b \"foo bar\"\n</code></pre>\n\n<p>But your proposed style isn't supported by any parsing library I know, since the position of free arguments would be ambiguous. If you really want to use <code>-a 1 2 3 -b foo bar crux</code>, you have to parse the arguments yourself.</p>\n"}], "owner": {"reputation": 622, "user_id": 525332, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e1b627d65d47e7ad08d669b0de9c23d2?s=128&d=identicon&r=PG", "display_name": "ironchicken", "link": "https://stackoverflow.com/users/525332/ironchicken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1560, "favorite_count": 1, "accepted_answer_id": 34894035, "answer_count": 1, "score": 10, "last_activity_date": 1453275258, "creation_date": 1453250137, "question_id": 34889516, "link": "https://stackoverflow.com/questions/34889516/optparse-applicative-option-with-multiple-values", "title": "optparse-applicative option with multiple values", "body": "<p>I'm using <code>optparse-applicative</code> and I'd like to be able to parse command line arguments such as:</p>\n\n<pre><code>$ ./program -a file1 file2 -b filea fileb\n</code></pre>\n\n<p>i.e., two switches, both of which can take multiple arguments.</p>\n\n<p>So I have a data type for my options which looks like this:</p>\n\n<pre><code>data MyOptions = MyOptions {\n    aFiles :: [String]\n  , bFiles :: [String] }\n</code></pre>\n\n<p>And then a <code>Parser</code> like this:</p>\n\n<pre><code>config :: Parser MyOptions\nconfig = MyOptions\n         &lt;$&gt; option (str &gt;&gt;= parseStringList)\n             ( short 'a' &lt;&gt; long \"aFiles\" )\n         &lt;*&gt; option (str &gt;&gt;= parseStringList)\n             ( short 'b' &lt;&gt; long \"bFiles\" )\n\nparseStringList :: Monad m =&gt; String -&gt; m [String]\nparseStringList = return . words\n</code></pre>\n\n<p>This approach fails in that it will give the expected result when just one argument is supplied for each switch, but if you supply a second argument you get \"Invalid argument\" for that second argument.</p>\n\n<p>I wondered if I could kludge it by pretending that I wanted four options: a boolean switch (i.e. <code>-a</code>); a list of strings; another boolean switch (i.e. <code>-b</code>); and another list of strings. So I changed my data type:</p>\n\n<pre><code>data MyOptions = MyOptions {\n    isA    :: Bool\n  , aFiles :: [String]\n  , isB    :: Bool\n  , bFiles :: [String] }\n</code></pre>\n\n<p>And then modified the parser like this:</p>\n\n<pre><code>config :: Parser MyOptions\nconfig = MyOptions\n         &lt;$&gt; switch\n             ( short 'a' &lt;&gt; long \"aFiles\" )\n         &lt;*&gt; many (argument str (metavar \"FILE\"))\n         &lt;*&gt; switch\n             ( short 'b' &lt;&gt; long \"bFiles\" )\n         &lt;*&gt; many (argument str (metavar \"FILE\"))\n</code></pre>\n\n<p>This time using the <code>many</code> and <code>argument</code> combinators instead of an explicit parser for a string list.</p>\n\n<p>But now the first <code>many (argument str (metavar \"FILE\"))</code> consumes <em>all</em> of the arguments, including those following the <code>-b</code> switch.</p>\n\n<p>So how can I write this arguments parser?</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1453243470, "post_id": 34888287, "comment_id": 57515133, "body": "compiled code vs interpreted"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1453243879, "post_id": 34888287, "comment_id": 57515333, "body": "The base modules contain a heck lot of stream fusion rules. When you run something like <code>last $ filter odd [1..20000000]</code>, you may not actually get a list of all numbers from 1 to 20000000, which is then traversed to remove even numbers, which is then traversed to the last element. The compiler is allowed to apply a lot of transformations which it knows won&#39;t change the result, but reckons might be more efficient cache/etc.-wise. \u2014 But apart from that... as karafka said the reason can be as simple as not having compiled the functions with optimisations. And, how did you obtain those timings?"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1453244143, "post_id": 34888287, "comment_id": 57515455, "body": "@karakfa is that all it is ?  I guess I was wrong in thinking that filter was also interpreted in interpreted or is it just the .hs that is loaded that is is interpreted??"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1453258344, "post_id": 34888287, "comment_id": 57519606, "body": "Be to sure to check out <a href=\"http://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453277954, "post_id": 34892344, "comment_id": 57526513, "body": "In 7.10, at least, <code>last</code> is defined as a fold, so it should fuse with <code>filter</code>. The enumeration passed to filter is defined, ultimately, using <code>build</code>, so it will fuse with <code>filter</code> too. None of this will happen without the appropriate <code>RULES</code> in the list library."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453278013, "post_id": 34892344, "comment_id": 57526543, "body": "@dfeuer: can we still agree that the largest effect that @matthias saw was because of <code>filter1</code>/<code>filter2</code>/<code>filter3</code> being interpreted?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453314353, "post_id": 34892344, "comment_id": 57551337, "body": "In GHCi, that&#39;s true, since fusion doesn&#39;t happen there."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1453268459, "creation_date": 1453268459, "answer_id": 34892344, "question_id": 34888287, "link": "https://stackoverflow.com/questions/34888287/haskell-speed-of-pre-defined-function-vs-copying-source-code/34892344#34892344", "title": "Haskell speed of pre-defined function vs copying source code", "body": "<p>The difference is because when you load <code>MyFilter.hs</code> directly into GHCi, it is interpreted instead of compiled.</p>\n\n<p>To wit, here are the timings on my machine, using GHC 7.8.3, by loading everything into GHCi:</p>\n\n<pre><code>$ ghci-7.8.3 MyFilter.hs\nGHCi, version 7.8.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n[1 of 1] Compiling MyFilter     ( MyFilter.hs, interpreted )\nOk, modules loaded: MyFilter.\n*MyFilter&gt; let xs = [1..20000000] :: [Int]\n*MyFilter&gt; :set +s\n*MyFilter&gt; last xs  -- Just to remove any effect of evaluating `xs` itself\n20000000\n(3.00 secs, 627134572 bytes)\n*MyFilter&gt; last $ filter odd xs\n19999999\n(2.00 secs, 1451220660 bytes)\n*MyFilter&gt; last $ filter1 odd xs\n19999999\n(17.55 secs, 2627102272 bytes)\n*MyFilter&gt; last $ filter2 odd xs\n19999999\n(13.54 secs, 1877989348 bytes)\n*MyFilter&gt; last $ filter3 odd xs\n19999999\n(15.44 secs, 2256212504 bytes)\n</code></pre>\n\n<p>Note especially the <code>MyFilter.hs, interpreted</code> line.</p>\n\n<p>Now if we compile it before loading it into GHCi, the timing numbers between <code>filter</code> and <code>filter1</code>/<code>filter2</code>/<code>filter3</code> suddenly line up:</p>\n\n<pre><code>$ ghc-7.8.3 --make MyFilter.hs\n[1 of 1] Compiling MyFilter     ( MyFilter.hs, MyFilter.o )\n$ ghci-7.8.3 MyFilter.hs\nGHCi, version 7.8.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nOk, modules loaded: MyFilter.\nPrelude MyFilter&gt; let xs = [1..20000000] :: [Int]\nPrelude MyFilter&gt; :set +s\nPrelude MyFilter&gt; last xs\n20000000\n(2.84 secs, 710745024 bytes)\nPrelude MyFilter&gt; last $ filter odd xs\n19999999\n(2.07 secs, 1374513668 bytes)\nPrelude MyFilter&gt; last $ filter1 odd xs\n19999999\n(2.07 secs, 1499566524 bytes)\nPrelude MyFilter&gt; last $ filter2 odd xs\n19999999\n(2.12 secs, 1499505652 bytes)\nPrelude MyFilter&gt; last $ filter3 odd xs\n19999999\n(2.26 secs, 1500830732 bytes)\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 34892344, "answer_count": 1, "score": 3, "last_activity_date": 1453268459, "creation_date": 1453243039, "last_edit_date": 1453267601, "question_id": 34888287, "link": "https://stackoverflow.com/questions/34888287/haskell-speed-of-pre-defined-function-vs-copying-source-code", "title": "Haskell speed of pre-defined function vs copying source code", "body": "<p>why is that when I use predefined <code>filter</code>, it works so much faster than if I use a function which is an exact copy of the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.List.html#filter\" rel=\"nofollow\">source file from Hackage</a>?</p>\n\n<p>so  comparing predefined <code>filter</code> with</p>\n\n<pre><code>filter1 :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter1 _pred []    = []\nfilter1 pred (x:xs)\n  | pred x         = x : filter1 pred xs\n  | otherwise      = filter1 pred xs\n</code></pre>\n\n<p>and while we are at it</p>\n\n<pre><code>filter2 ::  (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter2 pred  xs = [x | x &lt;- xs, pred x]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>filter3 :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter3 pred = foldr (\\x ys -&gt; if pred x then x : ys else ys) []\n</code></pre>\n\n<p>running <code>last $ filter odd [1..20000000]</code> for all gives:</p>\n\n<pre><code>*Main&gt; :set +s\n\n*Main&gt; last $ filter odd [1..20000000]\n19999999\n(**2.42 secs**, 4,716,736,640 bytes)\n\n*Main&gt; last $ filter1 odd [1..20000000]\n19999999\n(**15.72 secs**, 6,883,675,064 bytes)\n\n*Main&gt; last $ filter2 odd [1..20000000]\n19999999\n(**13.17 secs**, 5,839,140,920 bytes)\n\n*Main&gt; last $ filter3 odd [1..20000000]\n19999999\n(**11.09 secs**, 6,486,331,496 bytes)\n</code></pre>\n\n<p>why would <code>filter1</code> be different from <code>filter</code> (considering <code>filter1</code> is the source code) and why is the source code slower than 2 other implementations? (using list comprehensions or <code>foldr</code>)</p>\n\n<p>NB there is no purpose the final function. I was just testing the different speeds...</p>\n"}, {"tags": ["haskell", "types", "haskell-lens"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453237858, "post_id": 34886206, "comment_id": 57512190, "body": "On deriving proofs from types, you should look up &quot;free theorems&quot;. I&#39;m not sure if that&#39;s what you really want, though."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453238836, "post_id": 34886206, "comment_id": 57512752, "body": "<i>&quot;It takes some effort or experience to notice that <code>s :: * -&gt; *</code>&quot;</i>. That&#39;s wrong. <code>class Field1 s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s</code> introduces <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow noreferrer\">functional dependencies</a>. <code>x y -&gt; z</code> means that <code>z</code> can be determined by <code>x</code> and <code>y</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453256419, "post_id": 34886206, "comment_id": 57519111, "body": "&quot; you seem to be able to produce values of any type out of &quot;thin air&quot; &quot; - you produced the value <code>(&quot;yup&quot;, Nothing)</code> but both of those values are in the literal source code of the expression that produced that value, so I would hard call this &quot;out of thin air&quot;. I would argue that the meaning of a type is that type itself, and that <code>Field1</code> is one of many possible interpretations of that type."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1453303680, "post_id": 34886206, "comment_id": 57544020, "body": "<code>s b -&gt; t</code> AND <code>s :: *</code>? Oh boy, deserves question of its own (or more learning on my part)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453325153, "post_id": 34886206, "comment_id": 57557360, "body": "<a href=\"http://comonad.com/reader/2012/mirrored-lenses/\" rel=\"nofollow noreferrer\">comonad.com/reader/2012/mirrored-lenses</a> (the section entitled &quot;Why is it a lens family&quot;) expresses part of what&#39;s missing from the type and why."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453325252, "post_id": 34886206, "comment_id": 57557424, "body": "The <code>s b -&gt; t</code> is <i>not</i> a type signature, though it looks like one. It&#39;s a functional dependency meaning that <code>t</code> is determined by <code>s</code> and <code>a</code>. I agree that the syntax is a bit confusing."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1453234803, "creation_date": 1453234803, "question_id": 34886206, "link": "https://stackoverflow.com/questions/34886206/proofs-from-type-signatures", "title": "Proofs from type signatures", "body": "<p>Is it possible to derive proofs from <code>Haskell</code> type signatures about relationships of their parts?</p>\n\n<p>For example:</p>\n\n<pre><code>type role ReifiedLens representational nominal representational nominal\nnewtype ReifiedLens s t a b = Lens {...}\n        -- Defined in \u2018Control.Lens.Reified\u2019\n\ntype Lens s t a b =\n  forall (f :: * -&gt; *). Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>This signature is very dry and doesn't tell me much. </p>\n\n<p>One might expect that this is an exact encoding of what it <code>Lens</code> concept means. It does not. The <code>Lens</code> concept includes some laws not shown in the types. It may also reflect type system limitations of <code>Haskell</code> (it would be nice to know if some limits influenced the signature).</p>\n\n<p>Just by looking at signature, one may have intuition that many types substituted for <code>s</code> will never be part of a <code>Lens</code> since you cannot get <code>f t</code> from <code>s</code> if they are completely unrelated. It's like hidden functional dependency. Yet you seem to be able to  produce values of any type out of \"thin air\" if you want:</p>\n\n<pre><code>Prelude Control.Lens&gt; (%~) _1 (const \"yup\") ((), Nothing)\n(\"yup\",Nothing)\n</code></pre>\n\n<p>If you know where to look for you can find something resembling the above idea:</p>\n\n<pre><code>class Field1 s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s\n</code></pre>\n\n<p>That is, a \"subclass\" of <code>Lens</code> that expresses some functional dependencies one would expect to see in many typical instances. But it is still hard to grasp what <code>s</code> means in this context. It takes some effort or experience to notice that <code>s :: * -&gt; *</code> (hopefully no extension invalidates this as well).</p>\n\n<p>It would be great if there were a way to discover proofs about values above and a way to explore the space of possible relationships. Or is documentation best way to express the meaning of such types?</p>\n"}, {"tags": ["java", "haskell", "types", "polymorphism", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 496316, "user_id": 57695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/53ee9941b3fefef67175daf212e62d41?s=128&d=identicon&r=PG", "display_name": "Peter Lawrey", "link": "https://stackoverflow.com/users/57695/peter-lawrey"}, "edited": false, "score": 0, "creation_date": 1453234894, "post_id": 34886128, "comment_id": 57510365, "body": "Given <code>null</code> is one of the most used and re-used techniques in many languages, a billion-dollar mistake is likely to be sensationalised, some people struggle with it esp beginners but I don&#39;t see it as a problem.  An <code>Object</code> reference can point to any object type."}, {"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 1, "creation_date": 1453234905, "post_id": 34886128, "comment_id": 57510372, "body": "I think generics is the thing that comes the closest but it&#39;s still a long way away. Overall though, I don&#39;t think it&#39;s a very productive idea to try to map ideas one-to-one from two such different paradigms. For example, a kind of polymorphism is built into inheritance, a variable of type <code>Object</code> can hold any value, but it doesn&#39;t work the other way around. Does that stunted parallel help you understand either Haskell or Java better? I doubt it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1453234927, "post_id": 34886128, "comment_id": 57510382, "body": "Polymorphic values values work through <i>parametric polymorphism</i>, which Java doesn&#39;t have. So, this is basically impossible in the same way inheritance is \u201cimpossible\u201d in C: you can certainly emulate it in several ways (<a href=\"https://en.wikipedia.org/wiki/Turing_completeness\" rel=\"nofollow noreferrer\">obviously</a>), but whether that&#39;s sensible or you wouldn&#39;t be off better with something more idiomatic is doubtful."}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 2, "creation_date": 1453236236, "post_id": 34886128, "comment_id": 57511244, "body": "Generics are a form of parametric polymorphism. This is more a matter of syntax and type inference."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453241477, "post_id": 34886128, "comment_id": 57514251, "body": "You might want to look at <a href=\"https://github.com/eallik/learning-haskell-runtime-in-java\" rel=\"nofollow noreferrer\">github.com/eallik/learning-haskell-runtime-in-java</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1445, "user_id": 4614310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xnsI3zTW6mo/AAAAAAAAAAI/AAAAAAAADnU/aVuD4Jp3YIY/photo.jpg?sz=128", "display_name": "Mateusz Herych", "link": "https://stackoverflow.com/users/4614310/mateusz-herych"}, "edited": false, "score": 4, "creation_date": 1453236293, "post_id": 34886563, "comment_id": 57511273, "body": "Good answer. But I guess it&#39;s better to use <code>Collections.emptyList()</code> since <code>Arrays.asList()</code> allocates a new object each time you invoke it. However, <code>Collections.emptyList()</code> is immutable."}], "tags": [], "owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "is_accepted": false, "score": 2, "last_activity_date": 1453236176, "creation_date": 1453236176, "answer_id": 34886563, "question_id": 34886128, "link": "https://stackoverflow.com/questions/34886128/polymorphic-values-in-java/34886563#34886563", "title": "Polymorphic values in Java", "body": "<p>A polymorphic value like <code>[]</code> can only be represented as a method in Java. In fact, this method already exists in the <code>Arrays</code> class and is called <code>asList</code>. And because of Java's type inference, you don't even need to provide type arguments:</p>\n\n<pre><code>import java.util.Arrays;\nimport java.util.List;\n\npublic class Test {\n    public static void main(String[] args) {\n        List&lt;String&gt; myList = Arrays.asList();\n    }\n}\n</code></pre>\n\n<p>If you ignore all the noise, <code>[]</code> \u2261 <code>Arrays.asList()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1453272288, "post_id": 34887272, "comment_id": 57523886, "body": "The problem with your first example is that <code>fst</code> is not a value in Java. A method reference like <code>YourClass::fst</code> is, but it isn&#39;t polymorphic: it&#39;ll only work if it infers <code>A</code> and <code>B</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1453239529, "last_edit_date": 1453239529, "creation_date": 1453238951, "answer_id": 34887272, "question_id": 34886128, "link": "https://stackoverflow.com/questions/34886128/polymorphic-values-in-java/34887272#34887272", "title": "Polymorphic values in Java", "body": "<p>This is more a comment than an actual answer, but I require more space.</p>\n\n<p>While the type systems of Java and Haskell are quite apart, some similarities can be found in certain features. Here are a few examples: just keep in mind that there is no perfect correspondence between the related constructs shown below.</p>\n\n<p>Polymorphic functions (as in FP, not OOP polymorphism):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fst :: forall a b. (a, b) -&gt; a\nfst (x,y) = x\n</code></pre>\n\n<pre class=\"lang-java prettyprint-override\"><code>&lt;A,B&gt; A fst(A a, B b) {\n    return a;\n}\n</code></pre>\n\n<p>Note that polymorphic non-function values can not be translated as easily. Even in Haskell, values such as <code>3 :: Num a =&gt; a</code> are functions in disguise. Further, <code>[] :: [a]</code> and <code>Nothing :: Maybe a</code> are also treated as functions, taking a \"type\" parameter in some stages of compilation -- albeit, IIRC at runtime these parameter disappear.</p>\n\n<p>Type arguments:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data T a = T a Int a\n</code></pre>\n\n<pre class=\"lang-java prettyprint-override\"><code>class T&lt;A&gt; {\n    A x;\n    int n;\n    A y;\n\n    T(A x, int n, A y) {\n        this.x = x; this.n = n; this.y = y;\n    }\n}\n</code></pre>\n\n<p>Algebraic data types (e.g. <code>data</code> with many constructors): these are not directly available in Java. Some other JVM languages, like Scala, have ADT supported directly in the language, as well as pattern patching and non-exhaustiveness warnings. In Java, you can use the so-called <a href=\"https://en.wikipedia.org/wiki/Visitor_pattern\" rel=\"noreferrer\">Visitor pattern</a> to simulate ADT value elimination, which is a basic form of pattern matching.</p>\n"}], "owner": {"reputation": 10772, "user_id": 427598, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/Fq5PZ.jpg?s=128&g=1", "display_name": "Konstantin Milyutin", "link": "https://stackoverflow.com/users/427598/konstantin-milyutin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 34887272, "answer_count": 2, "score": 3, "last_activity_date": 1453239529, "creation_date": 1453234546, "question_id": 34886128, "link": "https://stackoverflow.com/questions/34886128/polymorphic-values-in-java", "title": "Polymorphic values in Java", "body": "<p>I'm studying Haskell and came across <em>polymorphic values</em>. These are the values that have different type depending on the context. For example, <code>Nothing</code> has type <code>Maybe a</code> or <code>[]</code> has type <code>[a]</code>. So <code>[]</code> is list of anything you want and you can use it everywhere any list is expected.</p>\n\n<p>I struggle to find a similar thing in Java, apart from \"billion-dollar mistake\" <code>null</code>, which is basically of any type. May be generics with unbounded wildcard is similar, but again, I can't think of an example. </p>\n\n<p>Is there something similar in Java?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 965, "user_id": 3783565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yhgn8.png?s=128&g=1", "display_name": "Kevin W.", "link": "https://stackoverflow.com/users/3783565/kevin-w"}, "edited": false, "score": 2, "creation_date": 1453222950, "post_id": 34882567, "comment_id": 57503171, "body": "The formatting of this code is incorrect; however, even after fixing that, there&#39;s still some issues.  Look at the type of <code>(:)</code> and the return type of <code>i</code>; you should find your problem then."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1453224428, "creation_date": 1453224428, "answer_id": 34883250, "question_id": 34882567, "link": "https://stackoverflow.com/questions/34882567/basic-haskell-defining-sorting-function-by-recursion/34883250#34883250", "title": "basic Haskell: defining sorting function by recursion", "body": "<p>Let me give you some hints to get you started. First of all, let's fix the formatting:</p>\n\n<pre><code>i :: Ord a =&gt; [a] -&gt; [a]\ni [] = []\ni (x:xs) \n    | x &lt;= head (xs) = x: i xs\n    | otherwise = i xs : x\n</code></pre>\n\n<p>This throws an error which says:</p>\n\n<pre><code>In the first argument of \u2018(:)\u2019, namely \u2018i xs\u2019\nIn the expression: i xs : x\n</code></pre>\n\n<p>Now, this expression <code>i xs : x</code> is problematic. The type of <code>(:)</code> is <code>(:) :: a -&gt; [a] -&gt; [a]</code>. But in your expression you are passing a list instead of a value. What you meant to use was possibly <code>++</code>. Using that fixes the compile error:</p>\n\n<pre><code>i :: Ord a =&gt; [a] -&gt; [a]\ni [] = []\ni (x:xs)\n    | x &lt;= head (xs) = x: i xs\n    | otherwise = i xs ++ [x]\n</code></pre>\n\n<p>Now, if you try it in <code>ghci</code>, you will get a runtime exception:</p>\n\n<pre><code>ghci&gt; i [3,2,1]\n*** Exception: Prelude.head: empty list\n</code></pre>\n\n<p>Can you guess why ? That's because you haven't handled the case where the list is of length <code>1</code>. So handling the case will give you this:</p>\n\n<pre><code>i :: Ord a =&gt; [a] -&gt; [a]\ni [] = []\ni (x:[]) = [x]\ni (x:xs)            \n    | x &lt;= head (xs) = x: i xs\n    | otherwise = i xs ++ [x]\n</code></pre>\n\n<p>Now, you may think that this works:</p>\n\n<pre><code>ghci&gt; i [3,2,1]\n[1,2,3]\nghci&gt; i [3,1,2]\n[1,2,3]\n</code></pre>\n\n<p>But it doesn't actually work, because there is a flaw in your algorithm. Just comparing the first two elements of the list won't give you an sorted array.</p>\n\n<pre><code>ghci&gt; i [2,1,3]\n[1,3,2]\n</code></pre>\n\n<p>I hope this is enough to get you started.</p>\n"}], "owner": {"reputation": 1, "user_id": 4765563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d12435cbb43728e96a2bfa6ebd44b7?s=128&d=identicon&r=PG&f=1", "display_name": "szeloba", "link": "https://stackoverflow.com/users/4765563/szeloba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1526350940, "creation_date": 1453222551, "last_edit_date": 1526350940, "question_id": 34882567, "link": "https://stackoverflow.com/questions/34882567/basic-haskell-defining-sorting-function-by-recursion", "title": "basic Haskell: defining sorting function by recursion", "body": "<p>So I have slight problem with sorting function. I need to define (using recursion) a function <em>i</em>, that takes as an argument a list of arguments <em>a</em> (this list needs to belong to <em>Ord</em>), which outputs ordered list of elements of type <em>a</em>.\nExample: \ni [3,2,1] = [1,2,3]</p>\n\n<p>I have managed to come with this solution:</p>\n\n<pre><code>i :: Ord a =&gt; [a] -&gt; [a]\n\ni [] = []\ni (x:xs) \n\n| x &lt;= head (xs) = x: i xs\n| otherwise = i xs : x\n</code></pre>\n\n<p>But it doesn't compute, outputting many errors. What is wrong? </p>\n"}, {"tags": ["performance", "haskell", "monads", "ghc", "memoization"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453222371, "post_id": 34881810, "comment_id": 57502821, "body": "FWIW: <code>run</code> is evaluated just once even with <code>-O2</code> here on my machine (so I don&#39;t observe your &quot;caching is lost&quot; behavior)."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453232592, "post_id": 34881810, "comment_id": 57508917, "body": "@DanielWagner Interesting! What GHC version are you on? I&#39;m on GHC 7.10.3."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1453233198, "post_id": 34881810, "comment_id": 57509296, "body": "@MathematicalOrchid Yup!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453240165, "post_id": 34881810, "comment_id": 57513555, "body": "@AnupamJain 7.10.2 -- I&#39;m surprised this behavior has changed across point releases!"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453241098, "post_id": 34881810, "comment_id": 57514041, "body": "@DanielWagner: Can confirm, GHC 7.10.3 on Windows using stack. <code>-O2</code> provides a better <code>fib</code>, but all three <code>run</code> calculated it anew. <code>ddump-simpl</code> reveals that <code>--O0</code> floats <code>run :: IO ()</code> outwards, whereas <code>-O2</code> inlines it into <code>mainK :: Int# -&gt; State# ... -&gt; (State#, () #)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1453234033, "post_id": 34882451, "comment_id": 57509826, "body": "&quot;Oh, the I/O actions it encodes get executed three times, but the expression (or rather, its subexpressions) evaluate only once.&quot; I&#39;m not sure I understand that. How does the expression get evaluated beyond the first <code>bind</code>? It looks like some ghc magic which optimises the case when the result of the IO part is not being used."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1453298558, "post_id": 34882451, "comment_id": 57540257, "body": "Suppose I write <code>foo = print (2 + 2)</code>. Now <code>print</code> is an ordinary function; it&#39;s result just happens to be a data structure that encodes an I/O operation. If you execute that operation 3 times, the sub-expression <code>2 + 2</code> is only evaluated once, even though the <code>print</code> I/O action executes 3 times..."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1453257324, "last_edit_date": 1453257324, "creation_date": 1453222245, "answer_id": 34882451, "question_id": 34881810, "link": "https://stackoverflow.com/questions/34881810/how-to-control-automatic-memoisation-in-haskell-ghc/34882451#34882451", "title": "How to control automatic memoisation in Haskell (GHC)?", "body": "<p>Here <code>run</code> is a constant expression. So, like any other constant expression, it only gets evaluated once. Oh, the I/O actions it encodes get <em>executed</em> three times, but the expression (or rather, its subexpressions) evaluate only once.</p>\n\n<p>My guess (and it's only a guess) is that not naming it would probably cause it to be re-evaluated each time. As in</p>\n\n<pre><code>main = do\n  mapM_ (print . fib) [1..40]\n  mapM_ (print . fib) [1..40]\n  mapM_ (print . fib) [1..40]\n</code></pre>\n\n<p>would <em>probably</em> evaluate it multiple times. But I'm not 100% certain.</p>\n\n<p>Now, if <code>run</code> was a <em>function</em>:</p>\n\n<pre><code>main = run 40 &gt;&gt; run 40 &gt;&gt; run 40\n  where\n    run n = mapM_ (print . fibs) [1..n]\n</code></pre>\n\n<p>then it would <em>probably</em> evaluate multiple times. I think GHC would avoid keeping the result of an arbitrary function call like that.</p>\n"}], "owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1453257324, "creation_date": 1453220490, "last_edit_date": 1453233508, "question_id": 34881810, "link": "https://stackoverflow.com/questions/34881810/how-to-control-automatic-memoisation-in-haskell-ghc", "title": "How to control automatic memoisation in Haskell (GHC)?", "body": "<p>Here's a small program that prints the first 40 fibonacci numbers <strong><em>thrice</em></strong> -</p>\n\n<pre><code>module Main where\n\nfib :: Int -&gt; Int\nfib 1 = 1\nfib 2 = 1\nfib n = fib (n-1) + fib (n-2)\n\nmain :: IO ()\nmain = run &gt;&gt; run &gt;&gt; run\n  where\n    run = mapM_ (print . fib) [1..40]\n</code></pre>\n\n<p>If I compile it with <code>ghc Main.hs</code>, then the computational part of \"run\" is saved by GHC, so that executing <code>run</code> three times takes roughly the same time as running it once. This was quite a surprise! I was under the impression that monadic effects are not automatically memoised like this.</p>\n\n<p>Also, if I compile it with <code>ghc -O2 Main.hs</code> then the memoisation is lost. (Atleast on my machine with ghc 7.10.3)</p>\n\n<p>How can I predict when something is going to be memoised? Is there some documented rule of thumb somewhere? How does this play with <code>unsafePerformIO</code> and the like?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1453220034, "last_edit_date": 1453220034, "creation_date": 1453219588, "answer_id": 34881491, "question_id": 34881265, "link": "https://stackoverflow.com/questions/34881265/passing-list-to-another-function/34881491#34881491", "title": "Passing list to another function", "body": "<p>You don't <em>pass</em> something to a function, like some list. That's imperative thinking. What you do in Haskell is, you <em>evaluate</em> some function with e.g. a list as its argument. Normally, you'd just leave <code>primes</code> as it is and use the result as the argument for <code>someText</code>. Like<sup>&dagger;</sup>,</p>\n\n<pre><code>main :: IO ()\nmain = print (someText $ primes 100)\n</code></pre>\n\n<p>or simply in the REPL</p>\n\n<pre><code>GHCi&gt; someText $ primes 100\n\"List starts  with2\"\n</code></pre>\n\n<p>Of course, you can also redefine <code>primes</code> to include <code>someText</code>. But obviously, the result will then be a string and not a list anymore!</p>\n\n<pre><code>primes' :: Integer -&gt; String\nprimes' n = someText $ sieve [2..n]\n where sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\n</code></pre>\n\n<p>It's probably better not to do this, because such a string is pretty useless when you want to use the prime list in any other way. You can better just invoke the original <code>primes</code> function:</p>\n\n<pre><code>primes' :: Integer -&gt; String\nprimes' = someText . primes\n</code></pre>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Actually this doesn't work: your function <code>someText</code> isn't complete. The pattern <code>x:[]</code> <em>only</em> matches a list which has exactly one element (this is more handily written <code>someText [x] = ...</code>). You want to match on <em>any</em> list which starts with one element; do that with the pattern <code>x:_</code>.</sub></p>\n"}], "owner": {"reputation": 341, "user_id": 4306487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74eafe48018d1836d1acc9e2038cff08?s=128&d=identicon&r=PG&f=1", "display_name": "Cardano", "link": "https://stackoverflow.com/users/4306487/cardano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "accepted_answer_id": 34881491, "answer_count": 1, "score": 1, "last_activity_date": 1453220164, "creation_date": 1453218997, "last_edit_date": 1453220164, "question_id": 34881265, "link": "https://stackoverflow.com/questions/34881265/passing-list-to-another-function", "title": "Passing list to another function", "body": "<p>I have this code which generates prime numbers from 2 to <em>n</em></p>\n\n<pre><code>primes :: Integer -&gt; [Integer]\nprimes n = sieve [2..n]\nwhere\n sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\n</code></pre>\n\n<p>How do I pass the <code>sieve</code>d list (which has my primes) to another function?</p>\n\n<p>Something like this doesn't work (parse error)</p>\n\n<pre><code>someText:: [Integer] -&gt; String\nsomeText (x:[]) = \"List starts  with\" ++ show x\n\nprimes :: Integer -&gt; [Integer]\nprimes n = sieve [2..n]\nwhere\n sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\n someText sieve\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1453174263, "post_id": 34867214, "comment_id": 57475234, "body": "Maybe parse (a|b|c)+ and reject it later if it ends with c?"}], "answers": [{"comments": [{"owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 1, "creation_date": 1453204521, "post_id": 34868654, "comment_id": 57490154, "body": "thanks, that works. I was half expecting it not work because of <code>anyToken</code> I had assumed to mean just that, whether that be a &#39;d&#39;, &#39;\\n&#39;, or whatever. I was thinking something like <code>myParser = many (a &lt;|&gt; b &lt;|&gt; (c &lt;* (lookAhead (try a &lt;|&gt; try b) &lt;?&gt; &quot;non C token&quot;))) &lt;* eof</code>. However, your definition of <code>myParser</code> <i>does</i> work. E.g. Parsing &quot;ca&quot; returns &quot;ca&quot;, whereas trying to parse &quot;cd&quot; fails with &quot;unexpected &#39;d&#39;. expecting &quot;a&quot;, &quot;b&quot;, &quot;c&quot; or end of input&quot;. Why is it the <code>anyToken</code> combinator only willing to accept &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 1, "creation_date": 1453204994, "post_id": 34868654, "comment_id": 57490457, "body": "@RobStewart: Due to <code>&lt;* eof</code>. <code>myParser</code> expects to consume all input."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1453178749, "creation_date": 1453178749, "answer_id": 34868654, "question_id": 34867214, "link": "https://stackoverflow.com/questions/34867214/haskell-parsec-many-combinator-inside-an-optional-combinator/34868654#34868654", "title": "Haskell parsec: `many` combinator inside an `optional` combinator", "body": "<p>We can also state this slightly different: <code>c</code> in your parser may only succeed if it's followed by any token, which can be done with a single <code>lookAhead</code>:</p>\n\n<pre><code>myParser = many (a &lt;|&gt; b &lt;|&gt; (c &lt;* (lookAhead anyToken &lt;?&gt; \"non C token\"))) &lt;* eof\n</code></pre>\n"}], "owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 2, "accepted_answer_id": 34868654, "answer_count": 1, "score": 9, "last_activity_date": 1453178749, "creation_date": 1453168030, "last_edit_date": 1453168584, "question_id": 34867214, "link": "https://stackoverflow.com/questions/34867214/haskell-parsec-many-combinator-inside-an-optional-combinator", "title": "Haskell parsec: `many` combinator inside an `optional` combinator", "body": "<p>I'd like to implement this grammar rule using Haskell's parsec library:</p>\n\n<pre><code>((a | b | c)* (a | b))?\n</code></pre>\n\n<p>Which is a parser rule that accepts an optional (i.e. potentially empty) string. If the string it acccepts is not empty, then it can be consumed by passing through zero or more occurrences of the <code>a</code> <code>b</code> or <code>c</code> parsers, but the accepted string by the outer most <code>?</code> optional parser <em>must</em> be consumed either by parser <code>a</code> or <code>b</code>, but not <code>c</code>. Here's an example:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>module Main where\n\nimport Text.Parsec\nimport Text.Parsec.Text\n\na,b,c :: GenParser () Char\na = char 'a'\nb = char 'b'\nc = char 'c'\n\n-- ((a | b | c)* (a | b))?\nmyParser = undefined\n\nshouldParse1,shouldParse2,shouldParse3,\n      shouldParse4,shouldFail :: Either ParseError String\n-- these should succeed\nshouldParse1 = runParser myParser () \"\" \"\" -- because ? optional\nshouldParse2 = runParser myParser () \"\"  \"b\"\nshouldParse3 = runParser myParser () \"\" \"ccccccb\"\nshouldParse4 = runParser myParser () \"\" \"aabccab\"\n\n-- this should fail because it ends with a 'c'\nshouldFail = runParser myParser () \"\" \"aabccac\"\n\nmain = do\n  print shouldParse1\n  print shouldParse2\n  print shouldParse3\n  print shouldParse4\n  print shouldFail\n</code></pre>\n\n<p>A first attempt might look like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>myParser = option \"\" $ do\n  str &lt;- many (a &lt;|&gt; b &lt;|&gt; c)\n  ch  &lt;- a &lt;|&gt; b\n  return (str ++ [ch])\n</code></pre>\n\n<p>But the <code>many</code> just consumes all 'a' 'b' and 'c' characters in each test case, leaving <code>a &lt;|&gt; b</code> no characters to consume.</p>\n\n<p><strong>The question</strong>:</p>\n\n<p>Using parsec combinators, what is the correct implementation of <code>((a | b | c)* (a | b))?</code> to define <code>myParser</code>?</p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453194015, "post_id": 34866729, "comment_id": 57482904, "body": "Style comment: <code>(map (fst) l)</code> is more commonly written <code>map fst l</code> -- no parentheses needed."}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1453235165, "post_id": 34866729, "comment_id": 57510545, "body": "Uniform tuples are a bit annoying if you want to apply an operation to all elements. If you used lists instead of tuples, you could write <code>sumAll</code> simply as <code>foldr (zipWith (+)) [0, 0 ..] :: Num a =&gt; [[a]] -&gt; [a]</code>. However, the shortest input list would determine the length of the output."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4709293"}, "edited": false, "score": 0, "creation_date": 1453165708, "post_id": 34866868, "comment_id": 57473003, "body": "Functions fst and snd redefined. Thank you!"}], "tags": [], "owner": {"reputation": 1560, "user_id": 2183486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45048e0ba1d38e754f933ca3e5ed8d06?s=128&d=identicon&r=PG", "display_name": "ohw", "link": "https://stackoverflow.com/users/2183486/ohw"}, "is_accepted": true, "score": 4, "last_activity_date": 1453165457, "creation_date": 1453165457, "answer_id": 34866868, "question_id": 34866729, "link": "https://stackoverflow.com/questions/34866729/dealing-with-tuples-and-bindings/34866868#34866868", "title": "Dealing with tuples and bindings", "body": "<p>Consider how your <code>fst</code>, <code>snd</code>, and <code>trd</code> are defined. If you are using <code>fst</code> from <code>Prelude</code>, then it has a type of <code>fst :: (a, b) -&gt; a</code>, which does not work for 3-tuples.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4709293"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "accepted_answer_id": 34866868, "answer_count": 1, "score": 0, "last_activity_date": 1453165457, "creation_date": 1453164427, "question_id": 34866729, "link": "https://stackoverflow.com/questions/34866729/dealing-with-tuples-and-bindings", "title": "Dealing with tuples and bindings", "body": "<p>I'm writing a function that sums the elements of a list of tuples like this:</p>\n\n<pre><code>sumAll [(2,4,11), (3,1,-5), (10,-3,6)] = (15,2,12)\n</code></pre>\n\n<p>I do have this:</p>\n\n<pre><code>sumAll :: (Num a, Num b, Num c) =&gt; [(a,b,c)] -&gt; (a,b,c)\nsumAll l = (foldr (+) 0 as, foldr (+) 0 bs, foldr (+) 0 cs) \n               where trd (a,b,c) = c\n                     as = (map (fst) l) \n                     bs = (map (snd) l)\n                     cs = (map (trd) l)\n</code></pre>\n\n<p>However the compiler complains:</p>\n\n<pre><code>Couldn't match type `(a, b, c)' with `(b1, b0)'\n    Expected type: [(b1, b0)]\n      Actual type: [(a, b, c)]\n    Relevant bindings include\n      as :: [b1] (bound at ficha3.hs:22:22)\n      cs :: [c] (bound at ficha3.hs:24:22)\n      l :: [(a, b, c)] (bound at ficha3.hs:20:12)\n      sumAll :: [(a, b, c)] -&gt; (a, b, c) (bound at ficha3.hs:20:1)\n    In the second argument of `map', namely `l'\n    In the expression: (map (fst) l)\n</code></pre>\n\n<p>And the same for the expression (map (snd) l).</p>\n\n<p>If I delete 'c' parameters from function definition it Works. \nLike this:</p>\n\n<pre><code>sumAll :: (Num a, Num b) =&gt; [(a,b)] -&gt; (a,b)\nsumAll l = (foldr (+) 0 as, foldr (+) 0 bs) \n               where as = (map (fst) l) \n                     bs = (map (snd) l)\n</code></pre>\n\n<p>My questions, if possible: </p>\n\n<ol>\n<li>Why is 'c' \"screwing\" the output tuple?</li>\n<li>How can I work this around?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1453159274, "post_id": 34864528, "comment_id": 57471079, "body": "You&#39;re not stuck.  There is an algorithm that tells you exactly how to proceed.  Google &quot;bracket abstraction&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 1, "creation_date": 1453159902, "post_id": 34864528, "comment_id": 57471278, "body": "@Michael, sometimes (not this time) rewriting things point-free can lead to some sort of insight into a deeper structure. Sometimes (not this time) rewriting something point-free can allow it to be implemented using <code>#.</code> and/or <code>.#</code> from <code>Data.Profunctor.Unsafe</code>, which sometimes has substantial efficiency advantages."}], "answers": [{"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 11, "last_activity_date": 1453159149, "creation_date": 1453159149, "answer_id": 34865901, "question_id": 34864528, "link": "https://stackoverflow.com/questions/34864528/two-attempts-to-get-to-point-free-one-of-them-gets-me-stuck-is-this-normal/34865901#34865901", "title": "Two attempts to get to point-free. One of them gets me stuck. Is this normal?", "body": "<pre><code>--Second path:\naddAndDrop x y = (+1) (const x y)\naddAndDrop x y = ((+1) . (const x)) y\naddAndDrop x = (+1) . (const x) --Here I'm stuck!\naddAndDrop x = ((+1) .) (const x)\naddAndDrop x = (((+1) .) . const) x\naddAndDrop = ((+1) .) . const\n</code></pre>\n\n<p>In general, the pattern is that <code>\\x -&gt; f . (g x)</code> becomes <code>(f .) . g</code></p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "accepted_answer_id": 34865901, "answer_count": 1, "score": 3, "last_activity_date": 1453159149, "creation_date": 1453153051, "question_id": 34864528, "link": "https://stackoverflow.com/questions/34864528/two-attempts-to-get-to-point-free-one-of-them-gets-me-stuck-is-this-normal", "title": "Two attempts to get to point-free. One of them gets me stuck. Is this normal?", "body": "<p>I want to make the function</p>\n\n<pre><code>addAndDrop x y = x + 1\n</code></pre>\n\n<p>point-free. I start with this obviously:</p>\n\n<pre><code>addAndDrop x y = (+1) x\n</code></pre>\n\n<p>But from here there are two different paths I can take.</p>\n\n<pre><code>--First path:\naddAndDrop x y = const ((+1) x) y\naddAndDrop x = const ((+1) x)\naddAndDrop x = (const . (+1)) x\naddAndDrop = const . (+1) --I'm done!\n\n--Second path:\naddAndDrop x y = (+1) (const x y)\naddAndDrop x y = ((+1) . (const x)) y\naddAndDrop x = (+1) . (const x) --Here I'm stuck!\n</code></pre>\n\n<p>In the first path everything goes smoothly. But in the second path I get stuck.</p>\n\n<p>Is there a way to continue and finish the second path or am I really stuck as I think I am?</p>\n\n<p>And if I really am stuck, is there any fundamental fancy, mathematical/functional/whatever reason for why I get stuck in one path and not in the other path?</p>\n"}, {"tags": ["haskell", "process", "signals", "posix"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453155112, "post_id": 34863102, "comment_id": 57469353, "body": "Are you working on Linux or in Windows (Cygwin) ?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453155510, "post_id": 34863102, "comment_id": 57469534, "body": "Also, does compiling with -threaded chage anything?"}, {"owner": {"reputation": 79, "user_id": 2882096, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/64cf82e08e5b9050047c287899b6f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "user2882096", "link": "https://stackoverflow.com/users/2882096/user2882096"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453156317, "post_id": 34863102, "comment_id": 57469861, "body": "Linux (Debian). <code>-threaded</code> did the trick, thanks! I&#39;m new to posting at SO, do I accept an answer or something?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453167712, "post_id": 34863102, "comment_id": 57473535, "body": "I have expanded my comment into an answer."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1453167451, "last_edit_date": 1453167451, "creation_date": 1453167001, "answer_id": 34867087, "question_id": 34863102, "link": "https://stackoverflow.com/questions/34863102/haskell-getprocessstatus-blocking-sigint/34867087#34867087", "title": "Haskell: getProcessStatus blocking SIGINT", "body": "<p><code>getProcessStatus</code> uses an <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/ffi.html#ffi-interruptible\" rel=\"nofollow\">interruptible FFI</a> call internally. But why is <code>-threaded</code> necessary?</p>\n\n<p><a href=\"http://neilmitchell.blogspot.com.es/2015/05/handling-control-c-in-haskell.html\" rel=\"nofollow\">This blog post</a> about handling ctrl-c in Haskell suggests that signal handling is done in a separate thread that kills the main thread using an asynchronous exception:</p>\n\n<blockquote>\n  <p>When the user hits Ctrl-C, GHC raises an async exception of type\n  UserInterrupt on the main thread. This happens because GHC installs an\n  interrupt handler which raises that exception, sending it to the main\n  thread with throwTo.</p>\n</blockquote>\n\n<p>But the <a href=\"https://hackage.haskell.org/package/base-4.4.1.0/docs/Control-Concurrent.html#g:5\" rel=\"nofollow\">documentation</a> for the async package mentions that:</p>\n\n<blockquote>\n  <p>Different Haskell implementations have different characteristics with\n  regard to which operations block all threads.</p>\n  \n  <p>Using GHC without the -threaded option, <strong>all foreign calls will block\n  all other Haskell threads in the system</strong>, although I/O operations will\n  not. With the -threaded option, only foreign calls with the unsafe\n  attribute will block all other threads.</p>\n</blockquote>\n\n<p>So maybe that's why proper handling of SIGINT in presence of interruptible ffi calls requires <code>-threaded</code>: otherwise, the thread that throws the asynchronous exception will be prevented from running.</p>\n"}], "owner": {"reputation": 79, "user_id": 2882096, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/64cf82e08e5b9050047c287899b6f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "user2882096", "link": "https://stackoverflow.com/users/2882096/user2882096"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 2, "accepted_answer_id": 34867087, "answer_count": 1, "score": 1, "last_activity_date": 1453167451, "creation_date": 1453147333, "question_id": 34863102, "link": "https://stackoverflow.com/questions/34863102/haskell-getprocessstatus-blocking-sigint", "title": "Haskell: getProcessStatus blocking SIGINT", "body": "<p>I'm trying to write a simple shell in Haskell, but I cant get the signal handling to work. If no command is running, sending <code>SIGINT</code> to the shell process triggers the signal handler. But when a blocking call to <code>getProcessStatus</code> is made, the signal is ignored. Sending a signal immediately to the child process of course kills the child and makes the blocking call return. </p>\n\n<p>Replacing the blocking call with <code>Control.Concurrent.threadDelay</code> does not prevent the signal, i.e., everything works as intended. Replacing the blocking flag to <code>getProcessStatus</code> with <code>False</code> makes the function return before the child process has finished.</p>\n\n<p>Reference to process package: <a href=\"https://hackage.haskell.org/package/unix-2.7.1.0/docs/System-Posix-Process.html#v:getProcessStatus\" rel=\"nofollow\">https://hackage.haskell.org/package/unix-2.7.1.0/docs/System-Posix-Process.html#v:getProcessStatus</a></p>\n\n<p>The relevant code is below, see the (only) commented line.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    pidRef &lt;- (newIORef [] :: IO (IORef [ProcessID]))\n    setSigHant pidRef\n    doPrompt pidRef\n\nprintPrompt :: IO ()\nprintPrompt = fdWrite stdError \"\u03bb\u2794 \" &gt;&gt; return ()\n\ndoPrompt :: IORef [ProcessID] -&gt; IO ()\ndoPrompt pidRef = do\n    printPrompt\n    tryLine &lt;- try getLine :: IO (Either SomeException String)\n    case tryLine of \n        Left _ -&gt; do\n            putStrLn \"\"\n            exitSuccess\n        Right line -&gt; do\n            tryCl &lt;- try (parse line) :: IO (Either SomeException [Command])\n            case tryCl of \n                Left e -&gt; fdWrite stdError (show e ++ \"\\n\") &gt;&gt; return ()\n                Right cl -&gt; \n                    if length cl &gt; 0 &amp;&amp; (cmd . head) cl == \"cd\" then\n                        cd (head cl)\n                    else do\n                        execCommands pidRef cl (stdInput, stdOutput)\n                        pids &lt;- readIORef pidRef\n\n                        -- This call to getProcessStatus blocks the signals\n                        _ &lt;- sequence $ map (getProcessStatus True False) pids\n                        _ &lt;- writeIORef pidRef []\n                        return ()\n            doPrompt pidRef\n\nsetSigHant :: (IORef [ProcessID]) -&gt; IO ()\nsetSigHant pidRef = do\n    let handler = Catch (sigIntHandler pidRef)\n    installHandler sigINT handler Nothing\n    return ()\n\n\nsigIntHandler :: (IORef [ProcessID]) -&gt; IO ()\nsigIntHandler pidRef = do\n    pids &lt;- readIORef pidRef\n    sequence_ $ map (signalProcess sigINT) pids\n    fdWrite stdError \"\\n\"\n    printPrompt\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 4, "last_activity_date": 1453147366, "last_edit_date": 1453147366, "creation_date": 1453147039, "answer_id": 34863014, "question_id": 34860796, "link": "https://stackoverflow.com/questions/34860796/svg-parsing-and-data-type/34863014#34863014", "title": "SVG parsing and data type", "body": "<p>I personally prefer the approach of enumerating all possible <code>TagName</code>s.  This way, the compiler can give you errors and warnings if you make any careless mistakes.  For example, if I want to write a function that covers every possible type of <code>Element</code>, then if every type is enumerated in an ADT, the compiler can give you non-exhaustive match warnings.  If you represent it as a string, this is not possible.  Additionally, if I want to match an <code>Element</code> of a specific type, and I accidentally misspell the <code>TagName</code>, the compiler will catch it.  A third reason, which probably doesn't really apply here, but is worth noting in general is that if I later decide to add or remove a variant of <code>TagName</code>, then the compiler will tell me every place that needs to be modified.  I doubt this will happen for SVG tag names, but in general it is something to keep in mind.</p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 4, "last_activity_date": 1453163156, "creation_date": 1453163156, "answer_id": 34866529, "question_id": 34860796, "link": "https://stackoverflow.com/questions/34860796/svg-parsing-and-data-type/34866529#34866529", "title": "SVG parsing and data type", "body": "<p><strong>To answer your question:</strong></p>\n\n<p>You can do this either way depending on what you are going to do with your parse tree after you make it.</p>\n\n<p>If all you care to do with you SVG parser is describe the shape of the SGV data, you are just fin with a string.</p>\n\n<p>On the other hand if you want to somehow transform that SVG data into something like a graphic (that is you anticipate evaluating your AST) you will find that it is best to represent all semantic information in the type system. It will make the next steps much easier.</p>\n\n<p>The question in my mind is whether the parsing pass is exactly the place to make that happen.  (Full disclosure, I have only a passing familiarity with SVG.)  I suspect that rather then just a flat list of tags, you would be better off with <code>Element</code> each with it's own set of required and optional attributes. if this transformation \"happens later in the program\" there is no need to create a <code>TagName</code> data type.  You can catch all the type errors at the same time you merge the attributes into the <code>Element</code>s.</p>\n\n<p>On the other hand, a good argument could be made to parse straight into a complete Element tree in which case, I would drop the generic <code>[Attribute]</code> and <code>[SVG]</code> fields of the <code>Element</code> constructor and instead make appropriate fields in your <code>TagName</code> constructor.</p>\n\n<hr>\n\n<p><strong>Another answer to the question you didn't ask:</strong></p>\n\n<p>Put source code location into your parse tree early. From personal experence, I can tell you it gets harder the larger your program gets.</p>\n"}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 34863014, "answer_count": 2, "score": 5, "last_activity_date": 1453163156, "creation_date": 1453138639, "last_edit_date": 1453139863, "question_id": 34860796, "link": "https://stackoverflow.com/questions/34860796/svg-parsing-and-data-type", "title": "SVG parsing and data type", "body": "<p>I'm writing an SVG parser, mainly as an exercise for learning how to use Parsec.  Currently I'm using the following data type to represent my SVG file:</p>\n\n<pre><code>data SVG = Element String [Attribute] [SVG]\n         | SelfClosingTag [Attribute]\n         | Body String\n         | Comment String\n         | XMLDecl String\n</code></pre>\n\n<p>This works quite well, however I'm not sure about the <code>Element String [Attribute] [SVG]</code> part of my data type.\nSince there is only a limited number of potential <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element\">tags</a> for an SVG, I was thinking about using a type to represent an SVG element instead of using a String. Something like this:</p>\n\n<pre><code>data SVG = Element TagName [Attribute] [SVG]\n         | ...\n\ndata TagName = A\n             | AltGlyph\n             | AltGlyphDef\n             ...\n             | View\n             | Vkern\n</code></pre>\n\n<p>Is it a good idea? What would be the benefits of doing this if there are any?\nIs there a more elegant solution?</p>\n"}, {"tags": ["haskell", "polymorphism", "type-inference", "ambiguity"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1453125590, "post_id": 34855841, "comment_id": 57452365, "body": "@Carsten It doesn&#39;t at all matter that both are in <code>Eq</code>; it is illegal because choosing one could give a different result from other (for this program it wouldn&#39;t, of course, but the compiler doesn&#39;t and shouldn&#39;t know this)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1453127212, "post_id": 34855841, "comment_id": 57453366, "body": "@AlexeyRomanov well sorry ..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1453137031, "post_id": 34855841, "comment_id": 57459892, "body": "Can you say carefully why this is not a duplicate of <a href=\"http://stackoverflow.com/q/34776282/791604\">your previous question</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 10, "last_activity_date": 1453187862, "last_edit_date": 1453187862, "creation_date": 1453125254, "answer_id": 34856415, "question_id": 34855841, "link": "https://stackoverflow.com/questions/34855841/type-mysteries-why-does-this-piece-of-code-compile/34856415#34856415", "title": "Type mysteries. Why does this piece of code compile?", "body": "<p>The definition for ambiguity in this context is given in <a href=\"https://www.haskell.org/onlinereport/decls.html\" rel=\"nofollow\">Section 4.3.4 of Haskell Report</a>: </p>\n\n<blockquote>\n  <p>We say that an expression <code>e</code> has an ambiguous type if, in its type <code>forall us. cx =&gt; t</code>, there is a type variable <code>u</code> in <code>us</code> that occurs in <code>cx</code> but not in <code>t</code>. Such types are invalid.</p>\n</blockquote>\n\n<p>In <code>foo :: (Fractional a, Eq a) =&gt; a -&gt; Bool</code>, there is no such variable (because <code>a</code> occurs in <code>a -&gt; Bool</code>). In <code>1.0 == 1.0</code> the type is actually <code>(Fractional a, Eq a) =&gt; Bool</code>, so there is such a variable.</p>\n\n<p>The <em>reason</em> this kind of ambiguity is an error is because there is no way for compiler to choose between different instantiations of the variable <code>a</code>, and the result of the program can depend on which one it chooses. In this case <code>1.0 == 1.0</code> should always be <code>True</code> for any <em>reasonable</em> instantiation, but 1) the compiler doesn't know this; 2) not all instantiations are reasonable. </p>\n"}, {"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": false, "score": 4, "last_activity_date": 1453125689, "creation_date": 1453125689, "answer_id": 34856571, "question_id": 34855841, "link": "https://stackoverflow.com/questions/34855841/type-mysteries-why-does-this-piece-of-code-compile/34856571#34856571", "title": "Type mysteries. Why does this piece of code compile?", "body": "<p>The second piece of code compiles because</p>\n\n<pre><code>foo :: (Fractional a, Eq a) =&gt; a -&gt; Bool\nfoo x = x == 1.0\n\n(==) :: Eq a =&gt; a -&gt; a\n</code></pre>\n\n<p>so the compiler will know that the float number literal <code>1.0 :: Rational a =&gt; a</code> have the same type with <code>x</code>, which has an <code>Eq</code> instance i.e. the \"meaning\" of <code>==</code> in this function is deterministic for every call.</p>\n\n<p>While in the first piece of code, the literal can be any type <code>(Rational a, Eq a) =&gt; a</code>, so the \"meaning\" of <code>==</code> is ambiguous, the value of h can be either True or False, depends on the type of the literal, which is not provided.</p>\n"}, {"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 0, "last_activity_date": 1453204340, "creation_date": 1453204340, "answer_id": 34876115, "question_id": 34855841, "link": "https://stackoverflow.com/questions/34855841/type-mysteries-why-does-this-piece-of-code-compile/34876115#34876115", "title": "Type mysteries. Why does this piece of code compile?", "body": "<p>Here'a another, conceptual way to put it:</p>\n\n<p>Both cases have intrinsic ambiguity, but the first one is a dead end \u2014 there is no hope for the compiler to infer its way out of the ambiguity. </p>\n\n<p>The second case is also ambiguous, but the ambiguity is open \u2014 whoever calls the ambiguous code, must resolve the ambiguity, or delegate/bubble it further up the call stack. </p>\n\n<p>That's all there is to it \u2014 polymorphism is controlled ambiguity. The first case is uncontrolled ambiguity so it's not useful (i.e. polymorphism-related) ambiguity. So it gets rejected until it's annotated to unambiguity. </p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 2, "closed_date": 1453331679, "accepted_answer_id": 34856415, "answer_count": 3, "score": 2, "last_activity_date": 1453204397, "creation_date": 1453123449, "last_edit_date": 1453204397, "question_id": 34855841, "link": "https://stackoverflow.com/questions/34855841/type-mysteries-why-does-this-piece-of-code-compile", "closed_reason": "Duplicate", "title": "Type mysteries. Why does this piece of code compile?", "body": "<p>The code</p>\n\n<pre><code>default ()\nh :: Bool\nh = 1.0 == 1.0 --Error. Ambiguity.\n</code></pre>\n\n<p>does not compile. This is expected because there is ambiguity. It could be either <code>Float</code> or <code>Double</code> and Haskell doesn't know which one we want.</p>\n\n<p>But the code</p>\n\n<pre><code>default ()\nfoo :: (Fractional a, Eq a) =&gt; a -&gt; Bool\nfoo x = x == 1.0\n</code></pre>\n\n<p>compiles successfully. I don't fully understand why. Why isn't this also ambiguous?</p>\n\n<p>I have the feeling that this is because whenever we call <code>foo</code>, we are guaranteed to have picked a concrete type in place of <code>a</code>, i.e., we are guaranteed to have fixed <code>a</code> to either <code>Float</code> or <code>Double</code> (or our custom type that has instances of both <code>Fractional</code> and <code>Eq</code>) at compile-time and therefore there is no ambiguity.</p>\n\n<p>But this is just a feeling and I don't know if it's 100% accurate.</p>\n"}, {"tags": ["xml", "haskell", "hxt"], "answers": [{"tags": [], "owner": {"reputation": 14780, "user_id": 210905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9e2d3ebb7e06cd11a5ca3fdaf12cce9?s=128&d=identicon&r=PG", "display_name": "Odomontois", "link": "https://stackoverflow.com/users/210905/odomontois"}, "is_accepted": true, "score": 1, "last_activity_date": 1453126415, "last_edit_date": 1453126415, "creation_date": 1453120356, "answer_id": 34854892, "question_id": 34852100, "link": "https://stackoverflow.com/questions/34852100/hxt-attach-xml-namespace-to-only-root-element/34854892#34854892", "title": "HXT attach XML namespace to only root element", "body": "<p>I did achieve desired output manually creating <code>xmlns:w</code> attribute at toplevel node :</p>\n\n<pre><code>we::ArrowXml a=&gt;String-&gt;a XmlTree XmlTree-&gt;a XmlTree XmlTree\nwe name child = w name [] [child]  \n\nresult::ArrowXml a=&gt;a XmlTree XmlTree\nresult = \n  w \"wordDocument\" [sattr \"xmlns:w\" wordNS] [body children]\n  where\n    children = txt \"Hello World!!!\"\n    body = we \"body\" . we \"p\" .  we \"r\"\n</code></pre>\n\n<p>But I still searching for more convenient solution.</p>\n"}], "owner": {"reputation": 14780, "user_id": 210905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9e2d3ebb7e06cd11a5ca3fdaf12cce9?s=128&d=identicon&r=PG", "display_name": "Odomontois", "link": "https://stackoverflow.com/users/210905/odomontois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 34854892, "answer_count": 1, "score": 0, "last_activity_date": 1453126415, "creation_date": 1453111895, "last_edit_date": 1453112866, "question_id": 34852100, "link": "https://stackoverflow.com/questions/34852100/hxt-attach-xml-namespace-to-only-root-element", "title": "HXT attach XML namespace to only root element", "body": "<p>I'm using ghc-7.10 and hxt-9.3.1.15. I have simple <a href=\"https://msdn.microsoft.com/en-us/library/office/aa212812(v=office.11).aspx\" rel=\"nofollow\">Open XML Word</a> generator prog like </p>\n\n<pre><code>import Text.XML.HXT.Core\nimport System.Environment\n\nreadParams::IO (String, String)\nreadParams = do \n  args &lt;- getArgs\n  let defaultSrc = \"methods.xml\"\n      defaultDst = \"output.docx\" \n  return $ case args of    \n    [src]      -&gt; (src, defaultDst)\n    [src, dst] -&gt; (src, dst)\n    _other     -&gt; (defaultSrc, defaultDst)\n\nresult::ArrowXml a=&gt;a XmlTree XmlTree\nresult = structure where\n  wordNS = \"http://schemas.microsoft.com/office/word/2003/wordml\"\n  w      = mkqelem . flip (mkQName \"w\") wordNS\n  structure =\n    w \"wordDocument\" [] [\n      w \"body\" [] [\n        w \"p\" [] [\n          w \"r\" [] [\n            w \"t\" [] [txt \"Hello World\"]\n          ]]]] \n    &gt;&gt;&gt; attachNsEnv (toNsEnv [(\"w\", wordNS)])\n\n\nmain::IO ()\nmain = do\n  (src, dst) &lt;- readParams\n  _ &lt;- runX $\n    readDocument [withValidate no] src\n    &gt;&gt;&gt;\n    root [] [ deep ( isElem &gt;&gt;&gt; hasName \"types\" &gt;&gt;&gt; result) ]\n    &gt;&gt;&gt;\n    writeDocument[withIndent yes] dst \n  return ()\n</code></pre>\n\n<p>It's generating valid XML like </p>\n\n<pre><code>&lt;w:wordDocument xmlns:w=\"http://schemas.microsoft.com/office/word/2003/wordml\"&gt;\n  &lt;w:body xmlns:w=\"http://schemas.microsoft.com/office/word/2003/wordml\"&gt;\n    &lt;w:p xmlns:w=\"http://schemas.microsoft.com/office/word/2003/wordml\"&gt;\n      &lt;w:r xmlns:w=\"http://schemas.microsoft.com/office/word/2003/wordml\"&gt;\n        &lt;w:t xmlns:w=\"http://schemas.microsoft.com/office/word/2003/wordml\"&gt;Hello World&lt;/w:t&gt;\n      &lt;/w:r&gt;\n    &lt;/w:p&gt;\n  &lt;/w:body&gt;\n&lt;/w:wordDocument&gt;\n</code></pre>\n\n<p>However I'd like to keep <code>xmlns:w=...</code> only at top node.</p>\n\n<p>Any attempt to replace <code>attachNsEnv (toNsEnv [(\"w\", wordNS)])</code> with <a href=\"https://hackage.haskell.org/package/hxt-9.1.2/docs/Text-XML-HXT-Arrow-Namespace.html#v:uniqueNamespaces\" rel=\"nofollow\"><code>uniqueNamespaces</code></a> or <a href=\"https://hackage.haskell.org/package/hxt-9.1.2/docs/Text-XML-HXT-Arrow-Namespace.html#v:uniqueNamespacesFromDeclAndQNames\" rel=\"nofollow\"><code>uniqueNamespacesFromDeclAndQNames</code></a> leads to result with no namespace declarations at all.</p>\n\n<p>How can I actually cleanup my XML output?</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453103465, "post_id": 34848706, "comment_id": 57439145, "body": "have you tried the <code>MAP_AS_DICT</code> switch? (see the <a href=\"https://hackage.haskell.org/package/json-0.9.1/docs/src/Text-JSON.html#JSON\" rel=\"nofollow noreferrer\">source code</a>) - I guess the first version does not know how to handle the object into a map"}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453103635, "post_id": 34848706, "comment_id": 57439238, "body": "@Carsten I guess I would need to recompile if I wanted to use that switch. Something I&#39;d like to avoid if possible ..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453103748, "post_id": 34848706, "comment_id": 57439293, "body": "well yes - this, keep your version or switch to aeson - atm I don&#39;t see another way (but I never used this package before and only had a quick glance at haddock)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453104187, "post_id": 34848706, "comment_id": 57439505, "body": "don&#39;t thank me (I could not help) - maybe someone will see this and give you a real answer yet"}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453104894, "post_id": 34848706, "comment_id": 57439841, "body": "@Carsten Well, <code>decode content :: Maybe [Map String String]</code> works with Aeson so I&#39;m pretty happy although not quite what I was going with."}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": false, "score": 1, "last_activity_date": 1453107730, "last_edit_date": 1453107730, "creation_date": 1453107340, "answer_id": 34850646, "question_id": 34848706, "link": "https://stackoverflow.com/questions/34848706/how-to-use-haskell-json-package-to-parse-to-type-map-string-string/34850646#34850646", "title": "How to use Haskell &quot;json&quot; package to parse to type [Map String String]?", "body": "<p>Without <code>MAP_AS_DICT</code> switch, the <code>JSON (MAP a b)</code> instance will be:</p>\n\n<pre><code>instance (Ord a, JSON a, JSON b) =&gt; JSON (M.Map a b) where\n  showJSON = encJSArray M.toList\n  readJSON = decJSArray \"Map\" M.fromList\n</code></pre>\n\n<p>So only JSON array can be parsed to Data.Map, otherwise it will call <code>mkError</code> and terminate.</p>\n\n<p>Due to haskell's restriction on instances, you won't be able to write an instance for <code>JSON (Map a b)</code> yourself, so your current workaround may be the best solution.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1453107730, "creation_date": 1453099548, "last_edit_date": 1453102700, "question_id": 34848706, "link": "https://stackoverflow.com/questions/34848706/how-to-use-haskell-json-package-to-parse-to-type-map-string-string", "title": "How to use Haskell &quot;json&quot; package to parse to type [Map String String]?", "body": "<p>I've got some sample JSON data like this:</p>\n\n<pre><code>[{\n  \"File:FileSize\": \"104 MB\",\n  \"File:FileModifyDate\": \"2015:04:11 10:39:00-07:00\",\n  \"File:FileAccessDate\": \"2016:01:17 22:37:23-08:00\",\n  \"File:FileInodeChangeDate\": \"2015:04:26 07:50:50-07:00\"\n}]\n</code></pre>\n\n<p>and I'm trying to parse the data using the <a href=\"https://hackage.haskell.org/package/json\" rel=\"nofollow\">json</a> package (not <a href=\"https://hackage.haskell.org/package/aeson\" rel=\"nofollow\">aeson</a>):</p>\n\n<pre><code>import qualified Data.Map.Lazy as M\nimport Text.JSON\n\ncontent &lt;- readFile \"file.txt\"\ndecode content :: Result [M.Map String String]\n</code></pre>\n\n<p>This gives me an error:</p>\n\n<pre><code>Error \"readJSON{Map}: unable to parse array value\"\n</code></pre>\n\n<p>I can get as far as this:</p>\n\n<pre><code>fmap \n  (map (M.fromList . fromJSObject)) \n  (decode content :: Result [JSObject String])\n</code></pre>\n\n<p>but it seems like an awfully manual way to do it. Surely the JSON data could be parsed directly into a type <code>[Map String String]</code>. Pointers?</p>\n"}, {"tags": ["haskell", "runtime-error"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453098101, "post_id": 34848154, "comment_id": 57436741, "body": "<code>undefined</code>, <code>error ...</code>, not enough memory, exceptions. using partial functions outside their value domain (e.g. <code>head []</code>)"}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "edited": false, "score": 0, "creation_date": 1453103695, "post_id": 34848154, "comment_id": 57439272, "body": "Simple examples are arithmetic errors related to input data. Static typing cannot find these, e.g. division by zero when the operands are input data."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1453139764, "post_id": 34848713, "comment_id": 57461449, "body": "Are you sure <i>most</i> are implemented by <code>error</code>? A whole slew of them come in the much more palatable <code>throwIO</code> style."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453201763, "post_id": 34848713, "comment_id": 57488279, "body": "@dfeuer yes you are right, I only checked some modules of pure functions but not the modules doing IO. Thanks for your comment."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 15, "last_activity_date": 1456074948, "last_edit_date": 1456074948, "creation_date": 1453099590, "answer_id": 34848713, "question_id": 34848154, "link": "https://stackoverflow.com/questions/34848154/what-kinds-of-runtime-errors-can-haskell-have/34848713#34848713", "title": "What kinds of runtime errors can Haskell have?", "body": "<p>All the runtime exceptions may be throw by the standard libraries (the <code>base</code> package) are defined in <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception.html#t:Exception\" rel=\"nofollow\">Control.Exception</a> and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Exception.html\" rel=\"nofollow\">GHC.Exception</a>.</p>\n\n<p><code>error</code> is a function defined in GHC.Err (based on GHC.Exception) as</p>\n\n<pre><code>error :: [Char] -&gt; a\nerror s = raise# (errorCallException s)\n</code></pre>\n\n<p>It throws an <code>ErrorCall</code> exception and print an error message to the stderr if isn't catched by some handler, most of the run-time exceptions raised by pure functions in <code>base</code> are implemented by <code>error</code>.</p>\n\n<p>A few examples:</p>\n\n<p><code>undefined</code>, a placeholder for code yet to be implemented, is defined as</p>\n\n<pre><code>undefined :: a\nundefined = error \"undefined\"\n</code></pre>\n\n<p>It will pass the compilation step due to it's type and will raise an exception when it's evaluated at run-time.</p>\n\n<p>The GHC standard library exports some partial functions by historical reasons, e.g. <code>head</code>:</p>\n\n<pre><code>head                    :: [a] -&gt; a\nhead (x:_)              =  x\nhead []                 =  badHead\n\nbadHead :: a\nbadHead = errorEmptyList \"head\"\n\nerrorEmptyList :: String -&gt; a\nerrorEmptyList fun =\n    error (prel_list_str ++ fun ++ \": empty list\")\n</code></pre>\n\n<p><code>IOException</code> concludes most of the ordinary IO exceptions you may have seen in other programming languages, e.g. FileNotFound, NoPermission, UnexpectedEOF etc. It's further extended in <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO-Error.html\" rel=\"nofollow\"><code>System.IO.Error</code></a> and is only throwed in the context of IO monad.</p>\n\n<p>There are six arithmetic exceptions in <code>base</code>, which are</p>\n\n<pre><code>data ArithException\n  = Overflow\n  | Underflow\n  | LossOfPrecision\n  | DivideByZero\n  | Denormal\n  | RatioZeroDenominator\n</code></pre>\n\n<p>Two array access exceptions, which are:</p>\n\n<pre><code>data ArrayException\n  = IndexOutOfBounds    String\n  | UndefinedElement    String\n</code></pre>\n\n<p>Four async exceptions, i.e. exceptions designed to be passed between processes, which are:</p>\n\n<pre><code>data AsyncException\n  = StackOverflow\n  | HeapOverflow\n  | ThreadKilled\n  | UserInterrupt\n</code></pre>\n\n<p>When a computation obviously won't terminate: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:NonTermination\" rel=\"nofollow\"><code>NonTermination</code></a><br>\nWhen one or more processes are blocked forever: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:BlockedIndefinitelyOnMVar\" rel=\"nofollow\"><code>BlockedIndefinitelyOnMVar</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Deadlock\" rel=\"nofollow\"><code>Deadlock</code></a>, etc.<br>\nWhen pattern matching failed (mainly in monads): <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:PatternMatchFail\" rel=\"nofollow\"><code>PatternMatchFail</code></a><br>\nWhen an assertion failed: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:AssertionFailed\" rel=\"nofollow\"><code>AssertionFailed</code></a></p>\n\n<p>and much, much more.</p>\n"}], "owner": {"reputation": 623, "user_id": 966276, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8742a26abaedb6d4d7ef4fd2418496d?s=128&d=identicon&r=PG", "display_name": "Rusty Fieldstone", "link": "https://stackoverflow.com/users/966276/rusty-fieldstone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1764, "favorite_count": 3, "accepted_answer_id": 34848713, "answer_count": 1, "score": 2, "last_activity_date": 1456074948, "creation_date": 1453096801, "question_id": 34848154, "link": "https://stackoverflow.com/questions/34848154/what-kinds-of-runtime-errors-can-haskell-have", "title": "What kinds of runtime errors can Haskell have?", "body": "<p>I've read that Haskell can actually have runtime errors, despite being statically typed and functional. But, no one says <em>what</em> runtime errors those might be. Anyone know?</p>\n"}, {"tags": ["haskell", "compiler-construction", "happy", "alex"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 5, "last_activity_date": 1453097790, "creation_date": 1453097790, "answer_id": 34848313, "question_id": 34847211, "link": "https://stackoverflow.com/questions/34847211/getting-line-number-information-in-the-semantic-analysis-phase-using-alex-happy/34848313#34848313", "title": "Getting line number information in the Semantic Analysis Phase (using Alex,Happy)", "body": "<p>You can have access to the position information in a Happy rule, if they are available in your lexer output. This is exactly how e.g. GHC itself puts <code>SrcLoc</code>s into its own internal representation of Haskell code.</p>\n\n<p>Basically, you would use <a href=\"https://www.haskell.org/alex/doc/html/wrappers.html#id462357\">the <code>posn</code> Alex wrapper</a> to inject position information into your token type:</p>\n\n<pre><code>data L a = L{ getPos :: AlexPosn, unPos :: a }\n</code></pre>\n\n<p>(so your Alex tokenizer would return <code>L Token</code> values); and then you combine the individual token positions in your Happy rule into a position for the nonterminal (so you could, for example, have a rule from <code>Expr + Expr</code> to <code>L (combinedPosn [getPos $1, getPos $2, getPos $3] $ PlusExpr (unPos $1) (unPos $3)</code>.</p>\n"}], "owner": {"reputation": 311, "user_id": 5803465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7346402b78bdd223b92798bef605773c?s=128&d=identicon&r=PG&f=1", "display_name": "user5803465", "link": "https://stackoverflow.com/users/5803465/user5803465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 971, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1455848329, "creation_date": 1453090299, "last_edit_date": 1455848329, "question_id": 34847211, "link": "https://stackoverflow.com/questions/34847211/getting-line-number-information-in-the-semantic-analysis-phase-using-alex-happy", "title": "Getting line number information in the Semantic Analysis Phase (using Alex,Happy)", "body": "<p>I am doing semantic analysis for an experimental language. I am using Alex and Happy to generate the lexer and the parser (actually I am using BNFC tool to generate Alex and Happy files). I wanted to get an error message with the line number and the column number whenever there is a  semantic error, say, a type error. </p>\n\n<p><strong>It seems that I would have to store the line number information while building my symbol table or the AST. My problem would would be solved if I can somehow have access to the position information in the the rules sections of the Happy file.</strong></p>\n\n<p>Any suggestions in this regard would be highly appreciated.</p>\n\n<p>I tried implementing the answer suggested below but unfortunately have not had any success with this. Lets consider for a very simple grammar :-</p>\n\n<pre><code>Expr -&gt; Expr + Term\n       | Term\nTerm -&gt; Int\n</code></pre>\n\n<p>My lexer for this looks like below.</p>\n\n<pre><code>%wrapper \"posn\"\n\n$digit = 0-9            -- digits\n$alpha = [a-zA-Z]       -- alphabetic characters\n\ntokens :-\n\n  $white+               ;\n  \"--\".*                ;\n  $digit+               { \\p s -&gt; L {getPos = p , unPos = Tok_Int (read s) }}\n  \\+                    { \\p s -&gt; L {getPos = p , unPos = Tok_Plus} }\n\n\n{\ndata L a = L{ getPos :: AlexPosn, unPos :: a } deriving (Eq,Show)\n\ndata Token =\n      Tok_Plus \n    | Tok_Int Int \n    deriving (Eq,Show)\n\n\ngetToken :: IO [L Token]\ngetToken = do \n    args &lt;- getArgs\n    case length args == 0 of\n        True  -&gt; do \n               error $ \"\\n****************Error: Expecting file name as an argument.\\n\" \n        False -&gt; do\n            let fname  = args !! 0 \n            conts &lt;- readFile fname\n            let tokens = alexScanTokens conts \n            return tokens \n\n}\n</code></pre>\n\n<p>My Yacc file is as under and this is where I am struggling. How to embed the position information in my syntax tree.</p>\n\n<pre><code>{\n{-# OPTIONS_GHC -fno-warn-incomplete-patterns -fno-warn-overlapping-patterns #-}\nmodule Parser where\nimport Lexer\n\n}\n\n%name pExpr Exp \n%name pTerm Term \n\n%tokentype {L Token}\n%error { parseError }\n\n%token\n      int             { L { getPos = _,unPos = Tok_Int $$ } }\n      '+'             { L { getPos = _,unPos = Tok_Plus } }\n\n%%\nExp :: {L Expr} \nExp  : Exp '+' Term           { L { getPos =  getPos $1 , unPos = EAdd (unPos $1) (unPos $3) } }\n     | Term                   { $1 }\n\nTerm :: {L Expr}\nTerm : int                   { L {getPos =  getPos $1, unPos =  EInt (unPos $1) } } \n\n{\n\ndata Expr =  EAdd Expr Expr \n            | EInt Int \n            deriving (Eq,Show)\n\n\nreturnM :: a -&gt; Err a\nreturnM = return\n\nthenM :: Err a -&gt; (a -&gt; Err b) -&gt; Err b\nthenM = (&gt;&gt;=)\n\n\nparseError :: [L Token] -&gt; a\nparseError _ = error \"Parse error\"\n\n}\n</code></pre>\n\n<p>I get the following type errors when trying to compile the generated Haskell file.</p>\n\n<pre><code>Parser.hs:109:39:\n    Couldn't match expected type `L a0' with actual type `Int'\n    In the first argument of `getPos', namely `happy_var_1'\n    In the `getPos' field of a record\n    In the first argument of `HappyAbsSyn5', namely\n      `(L {getPos = getPos happy_var_1,\n           unPos = EInt (unPos happy_var_1)})'\n\nParser.hs:109:73:\n    Couldn't match expected type `L Int' with actual type `Int'\n    In the first argument of `unPos', namely `happy_var_1'\n    In the first argument of `EInt', namely `(unPos happy_var_1)'\n    In the `unPos' field of a record\n</code></pre>\n\n<p><strong>Can you guys suggest me how to get this thing working?</strong></p>\n"}, {"tags": ["haskell", "client-server", "push", "rpc", "haste"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453064171, "post_id": 34843524, "comment_id": 57427773, "body": "I would abstract the comm. layer out, model 2-way communication algebraically, in a way that is agnostic of whether it happens in memory or crosses the HTTP barrier, and therefore the Haskell-JS barrier. Then, you can just write an &quot;interpreter&quot; for this algebra that chooses the appropriate communication implementation, such as long polling. Haste should be capable enough for this; if not, there&#39;s GHCJS."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453064596, "post_id": 34843524, "comment_id": 57427947, "body": "Do I understand correctly that your comment is about a general communication layer abstraction between server and client? Because if so, that could make sense. However, for now, I am getting acquainted with Haste, which already implements a layer on top of WebSockets. And WebSockets AFAIU are full-duplex, meaning it should be very much possible for the server to send data to the client, but I am not seeing how I can do that using the API provided by Haste, hence my original question."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453070080, "post_id": 34843524, "comment_id": 57429805, "body": "Yeah, my comment was quite high level."}], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 2, "creation_date": 1453064778, "post_id": 34843620, "comment_id": 57428023, "body": "Thanks for the input! Yes, I&#39;m already using a library build on top of WebSockets. See this comment of mine for some more details: <a href=\"http://stackoverflow.com/questions/34843524/in-haste-is-it-possible-to-call-into-client-side-code-with-rpc-from-the-server?noredirect=1#comment57427947_34843524\" title=\"in haste is it possible to call into client side code with rpc from the server\">stackoverflow.com/questions/34843524/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1983507"}, "reply_to_user": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1453065311, "post_id": 34843620, "comment_id": 57428233, "body": "You&#39;re welcome. I see our messages crossed each other. Regarding socket-communication specifically within Haste I cannot help you. Hope you find the answer soon!"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1983507"}, "is_accepted": false, "score": 1, "last_activity_date": 1453064476, "creation_date": 1453064476, "answer_id": 34843620, "question_id": 34843524, "link": "https://stackoverflow.com/questions/34843524/in-haste-is-it-possible-to-call-into-client-side-code-with-rpc-from-the-server/34843620#34843620", "title": "In Haste, is it possible to call into client side code with RPC from the server?", "body": "<p>So far I have never used it, but look into html5 web-sockets.</p>\n\n<p>This provides a way for full-duplex communication, meaning your client can initiate communication to the server and vice versa. Hence the client does not need to poll every second anymore to see if a message is available at the server-side.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1453064707, "creation_date": 1453063938, "last_edit_date": 1453064707, "question_id": 34843524, "link": "https://stackoverflow.com/questions/34843524/in-haste-is-it-possible-to-call-into-client-side-code-with-rpc-from-the-server", "title": "In Haste, is it possible to call into client side code with RPC from the server?", "body": "<p><a href=\"https://hackage.haskell.org/package/haste-compiler-0.5.2\" rel=\"nofollow\">In Haste</a>, is it possible to call into client side code with RPC from the server just like it is possible to call into the server side code from the client side? E.g. to broadcast a message that someone has entered in a chatroom to all participants.</p>\n\n<p><a href=\"https://github.com/valderman/haste-compiler/blob/master/examples/chatbox/chatbox.hs#L70\" rel=\"nofollow\">In here</a> I see a similar example is implemented, the way I understand it \u2014 with a technique similar to long polling; the client requests, and the server blocks sending a response until it has some to send; then the client requests again and so on.</p>\n\n<p>But is it not possible to simply send something out without the client requesting it?</p>\n"}, {"tags": ["haskell", "stackage"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453065191, "post_id": 34842333, "comment_id": 57428193, "body": "I don&#39;t believe there is an equivalent command. I use shell aliases to do something similar. Something like <code>alias b=&#39;stack build --fast --ghc-options=&quot;-Wall&quot; &amp;&amp; stack exec&#39;</code>"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453067909, "post_id": 34842333, "comment_id": 57429100, "body": "@haoformayor This is getting close to what I am looking for. One sec, I&#39;ll extend my question a bit."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1453069248, "post_id": 34842333, "comment_id": 57429546, "body": "it&#39;s fairly easy to grab the executable name if you need it: <code>grep &#39;^executable&#39; *.cabal | cut -d &#39; &#39; -f 2 | head -n 1</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1453075448, "post_id": 34842333, "comment_id": 57431312, "body": "There is also <code>stack runghc .&#47;src&#47;Main.hs</code>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1552250907, "post_id": 34842333, "comment_id": 96929083, "body": "This is an old question, but: there is now a real <code>stack run</code> command in the latest release!"}], "answers": [{"comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1453058146, "post_id": 34842448, "comment_id": 57425744, "body": "it&#39;s also possible to pass some command line arguments: <code>stack exec -- &lt;project-name&gt; &lt;arg1&gt; &lt;arg2&gt;</code>"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 7, "creation_date": 1453063086, "post_id": 34842448, "comment_id": 57427359, "body": "Well, I am a bit confused by this answer. @Govind How is your answer different than what I mentioned in my question about <code>stack exec</code>? I&#39;m looking for a command that would <code>stack build</code> + <code>stack exec</code> a project, similarly to how I remember <code>cabal run</code> doing it."}], "tags": [], "owner": {"reputation": 139, "user_id": 3305173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c2d3fc89e6c669fbd009849f04f5256?s=128&d=identicon&r=PG&f=1", "display_name": "Govind Krishna Joshi", "link": "https://stackoverflow.com/users/3305173/govind-krishna-joshi"}, "is_accepted": false, "score": 13, "last_activity_date": 1453057762, "creation_date": 1453057762, "answer_id": 34842448, "question_id": 34842333, "link": "https://stackoverflow.com/questions/34842333/is-there-a-stack-run-similar-to-cabal-run/34842448#34842448", "title": "Is there a `stack run` similar to `cabal run`?", "body": "<p>As it's mentioned here <a href=\"http://docs.haskellstack.org/en/stable/README.html#quick-start-guide\">http://docs.haskellstack.org/en/stable/README.html#quick-start-guide</a>, you can use <code>stack exec my-project-exe</code> where <code>my-project-exe</code> is the name of the executable in your .cabal file.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453068647, "post_id": 34844041, "comment_id": 57429335, "body": "By the way, if you have both cabal <i>and</i> stack installed, you could also run <code>stack build --exec &quot;cabal run&quot;</code>. But that&#39;s somewhat contrived."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 10, "last_activity_date": 1453098623, "last_edit_date": 1453098623, "creation_date": 1453066776, "answer_id": 34844041, "question_id": 34842333, "link": "https://stackoverflow.com/questions/34842333/is-there-a-stack-run-similar-to-cabal-run/34844041#34844041", "title": "Is there a `stack run` similar to `cabal run`?", "body": "<p>You can use <a href=\"http://docs.haskellstack.org/en/stable/build_command.html#other-flags\" rel=\"noreferrer\"><code>--exec</code></a> to tell stack what program should be run after a successful built:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>stack build --exec &lt;executable-name&gt;\n</code></pre>\n\n<p>You can also specify arguments for the executable, e.g.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack unpack pandoc &amp;&amp; cd pandoc*\nstack build --exec \"pandoc --version\"\n</code></pre>\n\n<p>That's probably the closest you'll get compared to <code>cabal run</code>, since both <code>stack exec</code> and the <code>--exec</code> flag need an executable name. The cleanest variant, however, would be an additional <code>stack-run</code> command, that does <code>stack build --exec &lt;first-executable in .cabal&gt;</code>. It could be worth <a href=\"https://github.com/commercialhaskell/stack/issues\" rel=\"noreferrer\">a feature request</a> on the project's GitHub issue tracker.</p>\n"}, {"comments": [{"owner": {"reputation": 268, "user_id": 3966975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/815dd8af3359a059a745e93f236c9770?s=128&d=identicon&r=PG", "display_name": "\u8c37\u53e3\u6602\u5e73", "link": "https://stackoverflow.com/users/3966975/%e8%b0%b7%e5%8f%a3%e6%98%82%e5%b9%b3"}, "edited": false, "score": 2, "creation_date": 1542535405, "post_id": 35107441, "comment_id": 93596207, "body": "Now stack 1.9.1 has <code>stack run</code> !"}], "tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": true, "score": 9, "last_activity_date": 1522939683, "last_edit_date": 1522939683, "creation_date": 1454189880, "answer_id": 35107441, "question_id": 34842333, "link": "https://stackoverflow.com/questions/34842333/is-there-a-stack-run-similar-to-cabal-run/35107441#35107441", "title": "Is there a `stack run` similar to `cabal run`?", "body": "<p>I've had quite a good experience using:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/stack-run\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/stack-run</a></p>\n\n<hr>\n\n<p>Edit 2018-04-05: <a href=\"https://github.com/commercialhaskell/stack/issues/233\" rel=\"nofollow noreferrer\">Relevant stack issue</a>.</p>\n\n<hr>\n\n<p>Old answer:</p>\n\n<p>This is what I ended up doing for now.</p>\n\n<pre><code>#/usr/bin/env sh\n\nstack build &amp;&amp; stack exec `basename \"$PWD\"` \"$@\"\n</code></pre>\n\n<p>I've put the following into a file named <code>stack-run</code> under my <code>$PATH</code>. <code>~/.local/bin/stack-run</code> in my case.</p>\n\n<p>Which allows me to </p>\n\n<pre><code>$ stack-run\n</code></pre>\n\n<p>in any directory, and even  </p>\n\n<pre><code>$ stack run\n</code></pre>\n\n<p>Since in almost all of my projects the executable of the project bears the same name as the folder, this works. But I hope to extend it with support for differing names as well.</p>\n\n<hr>\n\n<p><em>Edit 2016-09-26:</em> I've also found this, but haven't given it a try yet:\n<a href=\"https://hackage.haskell.org/package/stack-run\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/stack-run</a></p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6946, "favorite_count": 4, "accepted_answer_id": 35107441, "answer_count": 3, "score": 18, "last_activity_date": 1522939683, "creation_date": 1453057165, "last_edit_date": 1453068207, "question_id": 34842333, "link": "https://stackoverflow.com/questions/34842333/is-there-a-stack-run-similar-to-cabal-run", "title": "Is there a `stack run` similar to `cabal run`?", "body": "<p>Up until recently, I was executing this <em>beauty</em> to build + run a project with stack:</p>\n\n<pre><code>stack build &amp;&amp; .stack-work/install/x86_64-linux/lts-4.1/7.10.3/bin/&lt;project-name&gt;\n</code></pre>\n\n<p>I was told on IRC that this can be simplified to</p>\n\n<pre><code>stack build &amp;&amp; stack exec &lt;project-name&gt;\n</code></pre>\n\n<p>Can this be simplified even more, to </p>\n\n<pre><code>stack run\n</code></pre>\n\n<p>or at least</p>\n\n<pre><code>stack run &lt;project-name&gt;\n</code></pre>\n\n<p>?</p>\n\n<p>If I recall correctly this was possible with <code>cabal run</code>.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>@haoformayor's comment is getting close:</p>\n\n<pre><code>alias b='stack build --fast --ghc-options=\"-Wall\" &amp;&amp; stack exec'\n</code></pre>\n\n<p>Although this still needs the project name, right?</p>\n\n<p>I've also started to get close with</p>\n\n<pre><code>function stack-run () { stack build &amp;&amp; stack exec `basename \"$PWD\"` }\n</code></pre>\n\n<p>Although this only works if the project name matches with the folder name.  Maybe we can query cabal/stack for the first <code>executable</code> entry in the .cabal file? Or Maybe we could do it with <code>sed</code>... </p>\n"}, {"tags": ["haskell", "ide", "haskell-stack"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453049498, "post_id": 34840632, "comment_id": 57422454, "body": "Doesn&#39;t <code>stack exec -- $SHELL</code> exactly do what you want?"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453056309, "post_id": 34840632, "comment_id": 57425060, "body": "I don&#39;t know. I get &quot;Use of GHC&#39;s environment variable GHC_PACKAGE_PATH is incompatible with Cabal.&quot; error with <code>ghc-mod</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1453133047, "post_id": 34840632, "comment_id": 57457386, "body": "Have you tried using the custom ghc-mod cradle (<a href=\"https://github.com/DanielG/ghc-mod#custom-ghc-mod-cradle\" rel=\"nofollow noreferrer\">github.com/DanielG/ghc-mod#custom-ghc-mod-cradle</a>), try <code>echo &quot;global\\nuser&quot; &gt;&gt; ghc-mod.package-db-stack</code> in the project directory"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1453075575, "creation_date": 1453048066, "last_edit_date": 1453075575, "question_id": 34840632, "link": "https://stackoverflow.com/questions/34840632/ghc-haskell-tooling-paths", "title": "GHC Haskell tooling paths", "body": "<p>What are the paths required to set up development environment with <code>GHC</code> project? Or more specifically, a <code>stack</code> managed <code>GHC</code> environment?</p>\n\n<p>I'm confused about what is needed by <code>GHC</code>, <code>cabal</code>, <code>stack</code>, <code>ghc-mod</code> and <code>hdevtools</code>.</p>\n\n<p>I know that <code>stack path</code> will print out managed paths but I think it prints them under different key names than environment variables or command line arguments which I need for <code>GHC</code> and other tools, so it's not directly useful to me. </p>\n\n<p>For example, when working with typical <code>Java</code> project I need only to set <code>PATH</code>, <code>JAVA_HOME</code> and all tooling I need will work in this environment (for <code>Java</code> I often don't need separate <code>maven</code> repository for each project as linking is done differently).</p>\n\n<p>Ideally I'd like to call <code>stack $SHELL</code> and have everything configured in environment (no <code>stack ghci</code> afterwards).</p>\n"}, {"tags": ["macos", "haskell", "cabal", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453057752, "post_id": 34840621, "comment_id": 57425599, "body": "Paste the output to your <code>ghc-mod debug</code> please."}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1453048015, "creation_date": 1453048015, "question_id": 34840621, "link": "https://stackoverflow.com/questions/34840621/ghc-mod-tries-to-execute-cabal-for-a-stack-project-even-though-no-dist-dir-is", "title": "ghc-mod tries to execute cabal for a stack project (even though no dist/ dir is present)", "body": "<p>I'm using ghc-mod installed using stack on OSX:</p>\n\n<pre><code>$ ghc-mod --version\nghc-mod version 5.4.0.0 compiled by GHC 7.10.3\n</code></pre>\n\n<p>However, when I try to use it in spacemacs or from the command line with a stack project which <em>does not</em> have a dist/ dir, it keeps trying to execute cabal.</p>\n\n<pre><code>$ ls\nLICENSE     Setup.hs    app     foo.cabal   src     stack.yaml  test\n$ ghc-mod check app/Main.hs\nghc-mod: cabal: readCreateProcess: runInteractiveProcess: exec: does not exist (No such file or directory)\n</code></pre>\n\n<p>Why is this?</p>\n\n<p>Note I previously had the OSX ghc/cabal installation from <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow\">https://ghcformacosx.github.io/</a> . However, I've deleted the ~/Library/Haskell directory where cabal was residing as well as the app directory it installs from Applicaitons. Also, ghc-mod here was built using stack and stack's build of ghc. </p>\n"}, {"tags": ["haskell", "monads", "applicative", "comonad"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1453025895, "post_id": 34837150, "comment_id": 57415257, "body": "<code>ComonadApply is to Comonad like Applicative is to Monad.</code>  <a href=\"http://hackage.haskell.org/package/comonad-4.2.7.2/docs/Control-Comonad.html#t:ComonadApply\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/comonad-4.2.7.2/docs/&hellip;</a> It doesn&#39;t seem to be very different from Applicative..."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1453026365, "post_id": 34837150, "comment_id": 57415374, "body": "sounds like an answer !"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1453030598, "post_id": 34837150, "comment_id": 57416532, "body": "@danidiaz I see that a <code>ComonadApply</code> must be a <code>Comonad</code> -- unlike <code>Applicative</code>s which do not have to be <code>Monad</code>s. This looks as a main difference to me."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1453033215, "post_id": 34837150, "comment_id": 57417261, "body": "@chi: <code>ComonadApply</code> looks like <code>Apply</code> (<code>Applicative</code> without <code>pure</code>). It also looks like it can be implemented without any <code>Comonad</code> specific terms. The main difference to <code>Applicative</code> is the documentation of the <code>extract</code>/<code>duplicate</code> + <code>&lt;*&gt;</code> laws (and of course <code>pure</code>; see PureScript&#39;s typeclass hierarchy for an example of <code>Apply f =&gt; Applicative f</code>)."}, {"owner": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453116523, "post_id": 34837150, "comment_id": 57446685, "body": "@chi: So, the superclass implication arrow <code>Applicative a =&gt; Monad a</code> <i>also</i> is reversed? ;-P"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "edited": false, "score": 0, "creation_date": 1453121596, "post_id": 34837150, "comment_id": 57449932, "body": "@yatima2975 Well, adding &quot;co-&quot; shouldn&#39;t reverse <i>all</i> arrows... ;)"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1559058804, "post_id": 34837150, "comment_id": 99296846, "body": "adding co- should reverse all arrows in the category that the typeclass represents. Although that only really helps when there&#39;s an identity arrow - without the identity arrow we don&#39;t have a category so then it&#39;s harder to think about."}], "answers": [{"comments": [{"owner": {"reputation": 1136, "user_id": 1610313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55cbb010f6d57d7ef9014e34e80e8966?s=128&d=identicon&r=PG", "display_name": "Matias Pequeno", "link": "https://stackoverflow.com/users/1610313/matias-pequeno"}, "edited": false, "score": 0, "creation_date": 1543085846, "post_id": 34886224, "comment_id": 93794189, "body": "No, not Extract... <a href=\"https://www.merriam-webster.com/dictionary/extractive\" rel=\"nofollow noreferrer\">Extractive</a>!"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1559058966, "post_id": 34886224, "comment_id": 99296952, "body": "ComonadApply w isn&#39;t (Apply w, Comonad w). ComonadApply requires zippiness (not growing a structure, rather than Apply&#39;s act of growing a structure). For example, the ComonadApply instance for [a] is different to the Apply instance for [a] - it&#39;s closer to that of ZipList."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1559138235, "post_id": 34886224, "comment_id": 99327969, "body": "Of course I mean to use NonEmpty as an example rather than []"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1453270705, "last_edit_date": 1453270705, "creation_date": 1453234862, "answer_id": 34886224, "question_id": 34837150, "link": "https://stackoverflow.com/questions/34837150/applicative-is-to-monad-what-x-is-to-comonad/34886224#34886224", "title": "Applicative is to monad what X is to comonad", "body": "<p>After giving it some thought, I think this is actually a backward question. One might think that <a href=\"https://hackage.haskell.org/package/comonad-4.2.7.2/docs/Control-Comonad.html#t:ComonadApply\" rel=\"noreferrer\"><code>ComonadApply</code></a> is to <code>Comonad</code> what <code>Applicative</code> is to <code>Monad</code>, but that is not the case. But to see this, let us use PureScript's typeclass hierarchy:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n\nclass Functor f =&gt; Apply f where\n    apply :: f (a -&gt; b) -&gt; f a -&gt; f b -- (&lt;*&gt;)\n\nclass Apply f =&gt; Applicative f where\n    pure :: a -&gt; f a\n\nclass Applicative m =&gt; Monad m where\n    bind :: m a -&gt; (a -&gt; m b) -&gt; m b  -- (&gt;&gt;=)\n -- join :: m (m a) -&gt; m a\n -- join = flip bind id\n</code></pre>\n\n<p>As you can see, <code>ComonadApply</code> is merely <code>(Apply w, Comonad w) =&gt; w</code>. However, <code>Applicative</code>'s ability to inject values into the functor with <code>pure</code> is the real difference.</p>\n\n<p>The definition of a <code>Comonad</code> as the categorical dual consists of <code>return</code>'s dual <code>extract</code> and <code>bind</code>'s dual <code>extend</code> (or the alternative definiton via <code>duplicate</code> as <code>join</code>'s dual):</p>\n\n<pre><code>class Functor w =&gt; Comonad w where\n    extract   :: w a -&gt; a        \n    extend    :: (w a -&gt; b) -&gt; w a -&gt; w b\n -- extend f  = fmap f . duplicate k\n -- duplicate :: w a -&gt; w (w a)\n -- duplicate = extend id\n</code></pre>\n\n<p>So if we look at the step from <code>Applicative</code> to <code>Monad</code>, the logical step between would be a typeclass with <code>pure</code>'s dual:</p>\n\n<pre><code>class Apply w =&gt; Extract w where\n    extract :: w a -&gt; a\n\nclass Extract w =&gt; Comonad w where\n    extend :: (w a -&gt; b) -&gt; w a -&gt; w b\n</code></pre>\n\n<p>Note that we cannot define <code>extract</code> in terms of <code>extend</code> or <code>duplicate</code>, and neither can we define <code>pure</code>/<code>return</code> in terms of <code>bind</code> or <code>join</code>, so this seems like the \"logical\" step. <code>apply</code> is mostly irrelevant here; it can be defined for either <code>Extract</code> or <code>Monad</code>, as long as their laws hold:</p>\n\n<pre><code>applyC f = fmap $ extract f   -- Comonad variant; needs only Extract actually (*)\napplyM f = bind f . flip fmap -- Monad variant; we need join or bind\n</code></pre>\n\n<p>So <code>Extract</code> (getting values out) is to <code>Comonad</code>  what <code>Applicative</code> (getting values in) is to <code>Monad</code>. <code>Apply</code> is more or less a happy little accident along the way. It would be interesting whether there are types in Hask that have <code>Extract</code>, but not <code>Comonad</code> (or <code>Extend</code> but not <code>Comonad</code>, see below), but I guess those are rather rare.</p>\n\n<p>Note that <code>Extract</code> doesn't exist&mdash;yet. But neither did <code>Applicative</code> in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/\" rel=\"noreferrer\">2010 report</a>. Also, any type that is both an instance of <code>Extract</code> and <code>Applicative</code> automatically is both a <code>Monad</code> and a <code>Comonad</code>, since you can define <code>bind</code> and <code>extend</code> in terms of <code>extract</code> and <code>pure</code>:</p>\n\n<pre><code>bindC :: Extract w =&gt; w a -&gt; (a -&gt; w b) -&gt; w b\nbindC k f = f $ extract k\n\nextendM :: Applicative w =&gt; (w a -&gt; b) -&gt; w a -&gt; w b\nextendM f k = pure $ f k    \n</code></pre>\n\n<p><sub>* Being able to define <code>apply</code> in terms of <code>extract</code> is a sign that <code>class Extend w =&gt; Comonad w</code> could be more feasible, but one could have split <code>Monad</code> into <code>class (Applicative f, Bind f) =&gt; Monad f</code> and therefore <code>Comonad</code> into <code>(Extend w, Extract w) =&gt; Comonad w</code>, so it's more or less splitting hair.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 8294974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05afa45a282b74df6f2b5f163d0ce87f?s=128&d=identicon&r=PG&f=1", "display_name": "Arseniy Alekseyev", "link": "https://stackoverflow.com/users/8294974/arseniy-alekseyev"}, "is_accepted": false, "score": 0, "last_activity_date": 1555524844, "last_edit_date": 1555524844, "creation_date": 1555506209, "answer_id": 55728199, "question_id": 34837150, "link": "https://stackoverflow.com/questions/34837150/applicative-is-to-monad-what-x-is-to-comonad/55728199#55728199", "title": "Applicative is to monad what X is to comonad", "body": "<p>To me it seems that <code>Apply</code> class should not be a part of the picture at all.</p>\n\n<p>For example the definition of <code>apply</code> in @Zeta's answer does not seem to be well-behaved. In particular, it always discards the context of the first argument and only uses the context of the second argument.</p>\n\n<p>Intuitively, it seems that comonad is about \"splitting\" the context instead of combining, and so \"co-applicative\" should be the same.</p>\n\n<p>This question seems to have better answers: <a href=\"https://cstheory.stackexchange.com/questions/16241/is-there-a-concept-of-something-like-co-applicative-functors-sitting-between-com\">Is there a concept of something like co-applicative functors sitting between comonads and functors?</a>.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 2, "accepted_answer_id": 34886224, "answer_count": 2, "score": 13, "last_activity_date": 1555524844, "creation_date": 1453025288, "question_id": 34837150, "link": "https://stackoverflow.com/questions/34837150/applicative-is-to-monad-what-x-is-to-comonad", "title": "Applicative is to monad what X is to comonad", "body": "<p>Can we solve this equation for X ?</p>\n\n<blockquote>\n  <p>Applicative is to monad what X is to comonad</p>\n</blockquote>\n"}, {"tags": ["haskell", "functional-programming", "arrows", "free-monad"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1453087260, "post_id": 34837008, "comment_id": 57433836, "body": "Something like <a href=\"http://stackoverflow.com/q/12001350/477476\">this</a>, maybe?"}, {"owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1453118384, "post_id": 34837008, "comment_id": 57447851, "body": "@Cactus thanks. I&#39;ve already read both the question and the answer, but I&#39;m not sure that I fully understand what&#39;s going on there. As for the question I&#39;m not quite sure how <code>eff a b</code> should look like, my guess is that it is a pure function wrapped in a type constructor, but how should I interpret it then? I mean other than just apply a function? As for the answer it&#39;s too theoretical for me, I&#39;m not very good in theory (yet, I hope). Can you please explain it somehow simpler?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453136268, "post_id": 34837008, "comment_id": 57459421, "body": "&quot;how should I interpret it then&quot; - isn&#39;t that the point? It is completely up to you. If you&#39;ve got a value of type <code>forall eff . FreeArrow eff a b</code> then it was built without any additional assumptions about the underlying structure. This is identical to a value <code>forall arr . Arrow arr =&gt; arr x y</code> - this is essentially what it means to be a &quot;free&quot; structure. If your <code>eff</code> is IO for example, you could represent this as <code>data IO_Eff a b where PutStr :: IO_Eff String (); GetLine :: IO_Eff () String; ...</code> - can you see how you would write a function <code>forall a b . IO_Eff a b -&gt; Kleisli IO a b</code>?"}, {"owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453288129, "post_id": 34837008, "comment_id": 57533142, "body": "@user2407038 thanks. Now I get it. In <code>Operational</code> and <code>Free</code> monad base functor should wrap some value and (for some unknown reason) I thought that <code>eff a b</code> should too and had a hard time trying to understand what value it should be. Now I see how it should be done."}], "owner": {"reputation": 175, "user_id": 4914903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ac7fcfbb9192989cd71ccfb042dc6b?s=128&d=identicon&r=PG&f=1", "display_name": "starper", "link": "https://stackoverflow.com/users/4914903/starper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1453024041, "creation_date": 1453024041, "question_id": 34837008, "link": "https://stackoverflow.com/questions/34837008/arrows-free-monads-and-io", "title": "Arrows, Free Monads and IO", "body": "<p>Gabriel Gonzalez in his <a href=\"http://www.haskellforall.com/2012/07/purify-code-using-free-monads.html\" rel=\"nofollow\">blog post</a> describes a way to purify code using free monads. Let's say we have <code>FreeMonadIO a</code>, then we can write different interpreters, for example, one for testing purposes and one for actual IO.</p>\n\n<p>I wonder if something similar could be done for <code>Arrows</code>. Something like <code>FreeArrowIO a b</code>, which would be a pure representation of a computation with side effects and with an explicit input, which then could be interpreted in different ways (one of them is IO).</p>\n\n<p>I know that I can write something like <code>FreeArrowIO = Kleisli FreeMonadIO</code>, but is there a way to skip monad step and define FreeArrowIO directly?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1453011894, "post_id": 34835713, "comment_id": 57412502, "body": "You got it, just stick with it. <code>class Defaultable a where</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1453016423, "post_id": 34835713, "comment_id": 57413242, "body": "This is <code>flip $ foldr const  :: Foldable t =&gt; t b -&gt; b -&gt; b</code>. For data types which contain possibly more than 1 value, like lists, this gets the left most value or the supplied default if there are no values. It is probably good practice to define your own class anyways..."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1453021003, "post_id": 34836587, "comment_id": 57414173, "body": "My first intuition is to comment &quot;you could make this more generic by having two type parameters (and a functional dependency between them), i.e. <code>class Defaultable c a | c -&gt; a where def :: c -&gt; a -&gt; a</code>&quot;, but I don&#39;t have any good monomorphic example off the top of my head."}], "tags": [], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "is_accepted": true, "score": 3, "last_activity_date": 1453020220, "creation_date": 1453020220, "answer_id": 34836587, "question_id": 34835713, "link": "https://stackoverflow.com/questions/34835713/how-can-i-generalise-defaulting-across-maybe-and-either/34836587#34836587", "title": "How can I generalise defaulting across Maybe and Either?", "body": "<p>Turns out it was the syntax around creating the instance for Either that was confusing me.</p>\n\n<p>Here is what I finished up with:</p>\n\n<pre><code>class Defaultable a where\n  def \u2237  a b \u2192 b \u2192 b\n\ninstance Defaultable (Either m) where\n  def e d = either (const d) id e\n\ninstance Defaultable Maybe where\n   def m d = fromMaybe d m\n</code></pre>\n\n<hr>\n\n<p>And some tests</p>\n\n<pre><code>def (Just 1) 2\n&gt;&gt; 1\n\ndef Nothing 2\n&gt;&gt; 2\n\ndef (Right 2) 5\n&gt;&gt; 2\n\ndef (Left 3) 5\n&gt;&gt; 5\n\ndef (Left \"Arrghh\") 5\n&gt;&gt; 5\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 1, "accepted_answer_id": 34836587, "answer_count": 1, "score": 3, "last_activity_date": 1453020220, "creation_date": 1453011535, "last_edit_date": 1453019192, "question_id": 34835713, "link": "https://stackoverflow.com/questions/34835713/how-can-i-generalise-defaulting-across-maybe-and-either", "title": "How can I generalise defaulting across Maybe and Either?", "body": "<p>In Haskell, if I have two functions like this:</p>\n\n<pre><code>defEither \u2237   Either l r \u2192 r \u2192 r\ndefEither  eith defVal = either (const defVal) id eith\n</code></pre>\n\n<p>and </p>\n\n<pre><code>defMaybe \u2237   Maybe a \u2192 a \u2192 a\ndefMaybe m d = fromMaybe d m\n</code></pre>\n\n<p>How do I write a type class (or something to similar effect)  such that I can generalise the concept of \"defaultable\" across both Either and Maybe?</p>\n\n<p>Something like</p>\n\n<pre><code>class Defaultable ???? where\n  def \u2237  a b \u2192 b \u2192 b\n</code></pre>\n"}, {"tags": ["haskell", "types", "typeclass", "assertions", "hspec"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1452989873, "post_id": 34833572, "comment_id": 57408900, "body": "You can do <code>deriving Eq</code> while declaring <code>Animal</code> or implement your own instances for <code>Eq</code>."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1452991177, "post_id": 34833572, "comment_id": 57409163, "body": "but is it possible to derive in the test without deriving in the actual source?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1452991374, "post_id": 34833572, "comment_id": 57409198, "body": "you can write your own instance declaration; should be uses the <code>(==)</code> operator internally which is provided by <code>Eq</code> thus you cannot test without it"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452991399, "post_id": 34833572, "comment_id": 57409202, "body": "You could create a module with only the tests, and define there a standalone instance, so that it does not get exported elsewhere."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1452991521, "post_id": 34833572, "comment_id": 57409217, "body": "Maybe you can define instances of <code>Eq</code> for your data type in your test module. But I would ask you to re-think your approach. If you feel your testing requires <code>Eq</code> instances and the code doesn&#39;t require it, then there is some problem with the design."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1452991645, "post_id": 34833572, "comment_id": 57409243, "body": "you can also add <code>#ifdef</code>s to enable the derive clause with a flag"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1453105794, "post_id": 34833572, "comment_id": 57440269, "body": "@Sibi, I don&#39;t think that follows. Checking internal assumptions can be valuable."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 2, "last_activity_date": 1452994720, "last_edit_date": 1452994720, "creation_date": 1452993371, "answer_id": 34834029, "question_id": 34833572, "link": "https://stackoverflow.com/questions/34833572/testing-custom-data-types-which-do-not-implement-eq/34834029#34834029", "title": "Testing custom data types which do not implement Eq", "body": "<p>It's a bit of a strange requirement. But you can just add the <code>Eq</code> instance inside your test. Haskell doesn't have a restriction on having the instance in the same source file or module as the data type or type class.</p>\n\n<p>If you wanted to derive the instance, rather than writing it yourself, you can (in GHC) use the extension <code>StandaloneDeriving</code> and write:</p>\n\n<pre><code>deriving instance Eq Animal\n</code></pre>\n\n<p><em>Edit</em>: Having said that, I can't see a good reason why you wouldn't just add the instance along with your main definition of <code>Animal</code>. It won't do any harm, and it's pretty standard to add common typeclass derivations up front, just in case you need them later.</p>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1453024511, "creation_date": 1453024511, "answer_id": 34837052, "question_id": 34833572, "link": "https://stackoverflow.com/questions/34833572/testing-custom-data-types-which-do-not-implement-eq/34837052#34837052", "title": "Testing custom data types which do not implement Eq", "body": "<blockquote>\n  <p>My question is, is it possible to temporarily, within the scope of the tests, implement the Eq typeclass on Animal?</p>\n</blockquote>\n\n<p>Within the scope of the module, sure. But if that module gets imported, you're going to leak the instance into other modules. That's why creating instances is only recommended in the same module the data type has been defined, or where the class has been defined. Otherwise you end up with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/separate-compilation.html#orphan-modules\" rel=\"nofollow\">orphan instances</a>.</p>\n\n<blockquote>\n  <p>Or is there a better way to do this?</p>\n</blockquote>\n\n<p>Is it even remotely possible that the user want to compare characteristics? Then derive <code>Eq</code>. It's the cleanest way. Also, you're going to need a <code>Show</code> instance, so you're probably deriving something already:</p>\n\n<pre><code>data Animal = Characteristics [Char] (Set.Set [Char]) deriving (Show, Eq)\n</code></pre>\n\n<p>If you cannot change the original source you can still use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#stand-alone-deriving\" rel=\"nofollow\"><code>-XStandaloneDeriving</code></a> to derive the instance in another module (see orphan instances above, though).</p>\n\n<p>However if you actually want to use some special <code>Eq</code> test you can either fiddle around with <code>newtype</code> wrappers, or simply write your own combinator:</p>\n\n<pre><code>-- newtype variant\nnewtype TAnimal = TAnimal Animal\ninstance Eq TAnimal where ...\ninstance Show TAnimal where...\n\nanimalShouldBe :: Animal -&gt; Animal -&gt; Expectation\nanimalShouldBe = shouldBe `on` TAnimal\n\n-- custom operator variant\nwithShouldBe :: (Show a) =&gt; (a -&gt; a -&gt; Bool) -&gt; a -&gt; a -&gt; Expectation\nwithShouldBe f a e = unless (f a e) $ expectationFailure msg\n where msg = \"expected: \" ++ show e ++ \", but got \" ++ show a\n\n animalShouldBe = withShouldBe animalEqualityTest\n\n-- Fun fact: shouldBe = withShouldBe (==)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1453098128, "last_edit_date": 1453098128, "creation_date": 1453085614, "answer_id": 34846597, "question_id": 34833572, "link": "https://stackoverflow.com/questions/34833572/testing-custom-data-types-which-do-not-implement-eq/34846597#34846597", "title": "Testing custom data types which do not implement Eq", "body": "<p>You should test observable behaviour, not implementation details. If, for whatever reason, whether two Animals are equal is not something that should be observable (and hence you don't want to implement Eq in your source code), then don't use that property in your test.</p>\n\n<p>So instead of testing that checkAnimalType returns a particular list of animals, focus on what you're supposed to be able to <em>do</em> with that list, and check that those properties hold.</p>\n\n<p>E.g. If you can get names out of them, check those. If it's supposed to be returning all the Animals that have some particular relationship to the input Animal, check that that relationship holds (and possibly that it doesn't hold for any other Animals). If Animal is not Eq, but you can canonically convert it to something that is (say if Animal holds some internal implementation gunk that's not Eq friendly, but you can serialize them or otherwise convert them to a more \"just data\" format), convert the output of checkAnimalType and then use the Eq of that.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 34837052, "answer_count": 3, "score": 1, "last_activity_date": 1453098128, "creation_date": 1452989132, "last_edit_date": 1452991282, "question_id": 34833572, "link": "https://stackoverflow.com/questions/34833572/testing-custom-data-types-which-do-not-implement-eq", "title": "Testing custom data types which do not implement Eq", "body": "<p>Lets say I have the following custom data type:</p>\n\n<pre><code>data Animal = Characteristics [Char] (Set.Set [Char])\n</code></pre>\n\n<p>and some function</p>\n\n<pre><code>checkAnimalType :: [Char] -&gt; Animal -&gt; [Animal]\n</code></pre>\n\n<p>now I'm trying to write hspec tests for this like so:</p>\n\n<pre><code>describe \"checkAnimalType\" $ do\n      it \"returns a list of animals\" $ do\n        (checkAnimalType [\"foo\", \"coo\", \"doo\", \"bar\", \"moo\"](Characteristics \"foo\" $ Set.fromList([\"foo\", \"coo\"]))) $ `shouldBe` [(Characteristics \"foo\" $ Set.fromList([\"cockadoodledoo\"]))]\n</code></pre>\n\n<p>this fails with:</p>\n\n<pre><code>No instance for (Eq Animal) arising from a use of \u2018shouldBe\u2019\n</code></pre>\n\n<p>My question is, is it possible to temporarily, within the scope of the tests, implement the Eq typeclass on <code>Animal</code>? Or is there a better way to do this?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1453020481, "post_id": 34834078, "comment_id": 57414055, "body": "If it&#39;s a duplicate, flag the post. When you have over 250 rep, you can also vote to close a question as a duplicate (needs 5 votes). I removed the &quot;this is a duplicate&quot; part, since it&#39;s not necessary for your (otherwise well-written) answer."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 10, "last_activity_date": 1453020515, "last_edit_date": 1453020515, "creation_date": 1452993912, "answer_id": 34834078, "question_id": 34832072, "link": "https://stackoverflow.com/questions/34832072/what-is-the-point-of-pass-and-listen-in-writer-monad/34834078#34834078", "title": "What is the point of pass and listen in Writer monad?", "body": "<p>Here is code from <code>Control.Monad.Trans.Writer.Strict</code> that defined <code>listen</code> and <code>pass</code>:</p>\n\n<pre><code>listen :: (Monoid w, Monad m) =&gt; WriterT w m a -&gt; WriterT w m (a, w)\nlisten m = WriterT $ do\n    (a, w) &lt;- runWriterT m\n    return ((a, w), w)\n\npass :: (Monoid w, Monad m) =&gt; WriterT w m (a, w -&gt; w) -&gt; WriterT w m a\npass m = WriterT $ do\n    ((a, f), w) &lt;- runWriterT m\n    return (a, f w)\n</code></pre>\n\n<p><code>WriterT</code> is a monad transformer which provides <code>Writer</code> functionality to other monads, the simple <code>Writer</code> type is defined as  <code>type Writer w = WriterT w Identity</code>, in <code>Identity</code> monad the bind function (<code>&lt;-</code> and <code>&gt;&gt;=</code>) is just variable binding, so if we break down the monadic part of the code above:</p>\n\n<pre><code>listen :: (Monoid w) =&gt; Writer w a -&gt; Writer w (a, w)\nlisten m = Writer $\n    let (a, w) = runWriter m\n    in ((a, w), w)\n\npass :: (Monoid w) =&gt; Writer w (a, w -&gt; w) -&gt;\u3000Writer w a\npass m = Writer $\n    let ((a, f), w) = runWriter m\n    in (a, f w)\n</code></pre>\n\n<p>It's now clear that <code>listen</code> gives you access to the log produced by a Writer action inside the Writer monad, and <code>pass</code> gives you a way to alter the log inside the Writer monad.</p>\n\n<p>Assume you have a <code>Writer [String]</code> and want to log an action only if the log produced by it satisfies some condition:</p>\n\n<pre><code>deleteOn :: (Monoid w) =&gt; (w -&gt; Bool) -&gt; Writer w a -&gt; Writer w a\ndeleteOn p m = pass $ do\n    (a, w) &lt;- listen m\n    if p w\n        then return (a, id)\n        else return (a, const mempty)\n\n-- Or pass alone\ndeleteOn' :: (Monoid w) =&gt; (w -&gt; Bool) -&gt; Writer w a -&gt; Writer w a\ndeleteOn' p m = pass $ do\n    a &lt;- m\n    return (a, (\\w -&gt; if p w then mempty else w))\n\nlogTwo :: Writer [String] ()\nlogTwo = do\n    deleteOn ((&gt; 5) . length . head) $ tell [\"foo\"]\n    deleteOn ((&gt; 5) . length . head) $ tell [\"foobar\"]\n{-\n*Main&gt; runWriter logTwo\n((),[\"foo\"])\n-}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 6, "last_activity_date": 1452998968, "last_edit_date": 1452998968, "creation_date": 1452997098, "answer_id": 34834407, "question_id": 34832072, "link": "https://stackoverflow.com/questions/34832072/what-is-the-point-of-pass-and-listen-in-writer-monad/34834407#34834407", "title": "What is the point of pass and listen in Writer monad?", "body": "<p>Inside a <code>Writer</code> you can't inspect what has been written, until you run (or \"unwrap\") the monad, using <code>execWriter</code> or <code>runWriter</code>. However, you can use <code>listen</code> to inspect what some sub-action wrote to the writer, before the value is appended to the writer state, and you can use <code>pass</code> to modify what is written.</p>\n\n<p>Consider this example of an application that uses <code>WriterT</code> for logging:</p>\n\n<pre><code>import Control.Monad.Writer\n\n-- Monad stack for the application uses IO, wrapped in a logging WriterT\ntype App a = WriterT [String] IO a\n\n-- utility to write to the log\nlogMsg :: String -&gt; App ()\nlogMsg msg = tell [msg]\n\n-- gets an Int from user input (and logs what it does)\ngetInt :: App Int\ngetInt = do\n    logMsg \"getting data\"\n    n &lt;- liftIO getLine\n    logMsg $ \"got line: \" ++ show n\n    return . read $ n\n\n-- application logic that uses getInt and increments the result by 1\napp :: App Int\napp = do\n    n &lt;- getInt\n    return $ n + 1\n\n-- main code runs the application and prints the log\nmain = do\n    (res, logs) &lt;- runWriterT app\n    print $ \"Result = \" ++ show res\n    putStrLn \"Log: \"\n    mapM_ putStrLn logs\n</code></pre>\n\n<p>Now, for some reason, inside <code>app</code>, I want to know what messages <code>getInt</code> wrote to the log. I can do that with <code>listen</code>:</p>\n\n<pre><code>app :: App Int\napp = do\n    (n, logs) &lt;- listen getInt\n    let numLogLines = length logs\n    logMsg $ \"getInt logged \" ++ show numLogLines ++ \" lines\"\n    return $ n + 1\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 4716940, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/363a400a9b096b10c2ba8070f7b12f35?s=128&d=identicon&r=PG&f=1", "display_name": "demathieu", "link": "https://stackoverflow.com/users/4716940/demathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 1, "closed_date": 1453020371, "accepted_answer_id": 34834078, "answer_count": 2, "score": 6, "last_activity_date": 1453028484, "creation_date": 1452977990, "last_edit_date": 1453028484, "question_id": 34832072, "link": "https://stackoverflow.com/questions/34832072/what-is-the-point-of-pass-and-listen-in-writer-monad", "closed_reason": "Duplicate", "title": "What is the point of pass and listen in Writer monad?", "body": "<p>I have been learning about monads in the book <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">learnyouahaskell</a>.\nAfter reading about the writer monad, I decided to check the documentation of the <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Class.html\" rel=\"nofollow\">Control.Monad.Writer.Class</a>.</p>\n\n<p>There I saw that they also implemented the <code>listen</code> and <code>pass</code> functions but I was not able to understand what they are used for. Could someone give me a good example so I can understand how to use <code>listen</code> and <code>pass</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1452971192, "post_id": 34830900, "comment_id": 57403510, "body": "The fact that moving things between modules affects behavior <i>strongly</i> suggests that GHC&#39;s inliner is involved. Most likely, some transformation enabled by inlining is either <i>helping</i> you or <i>hurting</i> you."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1452972496, "post_id": 34830900, "comment_id": 57403937, "body": "an unrelated issue is your arithmetic in exampleFunction is getting defaulted to Integer which will be quite slow. Turn on <code>-Wall</code>."}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1452972830, "post_id": 34830900, "comment_id": 57404046, "body": "@jberryman exampleFunction is intended to be an example only - to show the memory increase."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1452973387, "post_id": 34830900, "comment_id": 57404231, "body": "Check out the compiling both the foldM and foldlM versions with <code>ghc --make -fforce-recomp -Wall -O1 -ddump-simpl -dsuppress-all -ddump-inlinings -ddump-rule-firings -ddump-to-file</code> and gvimdiff the *.dump-simpl and *.dump-inlinings files. In your slow version lists aren&#39;t getting fused away (you can grep for &quot;:&quot;). You could try to puzzle out why this happened if you like doing this sort of thing, but better to report a bug I think."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452975330, "post_id": 34830900, "comment_id": 57404862, "body": "Both monadic versions exhibit the same behavior (~2GB memory usage) on my system. Are you sure that <code>foldlM</code> uses less memory?"}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452978791, "post_id": 34830900, "comment_id": 57406013, "body": "@Zeta Yes I have just copied the exact code above to verify, and foldlM uses less memory.  This is on windows if it makes any difference."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1452981230, "post_id": 34830900, "comment_id": 57406730, "body": "(Forgot to say: I replicated the runtime difference you saw between the synonymous foldM/foldlM versions with 7.10, on linux; this is basically just an inlining/list fusion bug that should be reported to lib maintainers)"}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1452982156, "post_id": 34830900, "comment_id": 57406960, "body": "@jberryman so are you saying this is a library issues and the problem is specific to these functions?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1452985140, "post_id": 34830900, "comment_id": 57407754, "body": "@pticawr yes I think so; the primary difference I saw in your slow version is that the intermediate list is not fused away, which is all a library-level issue: it&#39;s controlled with rewrite rules and INLINE pragmas (which can be both quite brittle, and difficult to understand). The authors would I think like to know how <code>foldlM</code> did not exhibit the same behavior as <code>foldM</code> w/r/t inlining and optimization."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453021217, "post_id": 34830900, "comment_id": 57414222, "body": "@pticawr: My bad. I used <code>ghc -prof</code>, and apparently <code>foldM</code> takes the same time as <code>foldlM</code> in a profiled build. Your observation holds (am also on Windows)."}, {"owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "edited": false, "score": 0, "creation_date": 1453089111, "post_id": 34830900, "comment_id": 57434239, "body": "Maybe this question should be retitled, something like &quot;Unexpected memory growth with Control.Monad foldM&quot;?"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1453112605, "post_id": 34830900, "comment_id": 57444366, "body": "I noticed something similiar when using <code>foldM</code> to implement a <a href=\"https://github.com/frerich/brainfuck/blob/master/src/Data/Language/Brainfuck/Interpreter.hs#L31\" rel=\"nofollow noreferrer\">BF interpreter</a>: it is a very tight loop, and the fact that <code>foldM</code> didn&#39;t get inlined greatly slowed things down."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1453059195, "post_id": 34836245, "comment_id": 57426092, "body": "The reason is that things marked <code>SPECIALIZE</code> are compiled specialized to the given type, and when that type is seen at use sites the specialized version is used; GHC (generally?) does <i>not</i> consider inlining instead. For something as simple as <code>foldM</code>, specialization seems almost certain to be worse than inlining in general, so those pragmas should be removed."}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453158677, "post_id": 34836245, "comment_id": 57470820, "body": "@dfeuer ; J.J. :  While removing the specialisation resolves one problem (when using the source files as above).  Can you explain why the problem returns when merging the source files into one, but for both foldM and foldlM showing memory usage growth?"}, {"owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "reply_to_user": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "edited": false, "score": 0, "creation_date": 1453159213, "post_id": 34836245, "comment_id": 57471056, "body": "@pticawr without optimization flag like <code>-O1</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "edited": false, "score": 0, "creation_date": 1453159490, "post_id": 34836245, "comment_id": 57471156, "body": "@pticawr, the inliner is a scary, hairy beast. I seem to recall that things marked <code>INLINEABLE</code> are <i>not</i> inlined in the modules in which they&#39;re defined, but I could be remembering wrong. The inliner is scary and subtle because it&#39;s based on various heuristics that aim to enable as many useful transformations as it can without making code size explode. It usually works, but when it doesn&#39;t you lose. It tends to be especially touchy around things like list fusion."}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "edited": false, "score": 0, "creation_date": 1453192846, "post_id": 34836245, "comment_id": 57482208, "body": "Disabling optimization (-O0) does not resolve this - only effect is that it takes twice as long."}, {"owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453193632, "post_id": 34836245, "comment_id": 57482672, "body": "@dfeuer, my problem here is that if I saw this sort of inconsistent behaviour from say a C++ compiler, I would consider it to be a compiler bug.  Being unable to predict what the compiler will do seems a problem.  Is there something fundamentally wrong with using foldM over a large list?  In some cases I have had to nest foldM across a partitioned list to minimize the memory impact.  Is there a reliable alternative?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "edited": false, "score": 0, "creation_date": 1453195735, "post_id": 34836245, "comment_id": 57484047, "body": "@pticawr, writing everything out with explicit recursIon is generally reliable, but it&#39;s also painful. I wish I could tell you there&#39;s a magic bullet somewhere, but I haven&#39;t found one."}], "tags": [], "owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "is_accepted": false, "score": 3, "last_activity_date": 1453016892, "creation_date": 1453016892, "answer_id": 34836245, "question_id": 34830900, "link": "https://stackoverflow.com/questions/34830900/unexpected-memory-growth-with-control-monad-foldm/34836245#34836245", "title": "Unexpected memory growth with Control.Monad foldM", "body": "<p>Here is <code>foldlM</code> from <code>Foldable.hs</code> (ghc)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | Monadic fold over the elements of a structure,\n-- associating to the left, i.e. from left to right.\nfoldlM :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b\nfoldlM f z0 xs = foldr f' return xs z0\n  where f' x k z = f z x &gt;&gt;= k\n</code></pre>\n\n<p>and <code>foldM</code> from <code>Monad.hs</code></p>\n\n<pre><code>foldM          :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b\n{-# INLINEABLE foldM #-}\n{-# SPECIALISE foldM :: (a -&gt; b -&gt; IO a) -&gt; a -&gt; [b] -&gt; IO a #-}\n{-# SPECIALISE foldM :: (a -&gt; b -&gt; Maybe a) -&gt; a -&gt; [b] -&gt; Maybe a #-}\nfoldM          = foldlM\n</code></pre>\n\n<p>I placed these definitions to a separate module Test and tested the execution with and without INLINEABLE / SPESIALISE lines. Whatever the reason is, leaving out the SPECIALISE directives helped and the execution time and memory usage was like with foldlM.</p>\n\n<p>After a little bit more digging, removing line</p>\n\n<pre><code>{-# SPECIALISE foldM :: (a -&gt; b -&gt; IO a) -&gt; a -&gt; [b] -&gt; IO a #-}\n</code></pre>\n\n<p>effected the most.</p>\n"}], "owner": {"reputation": 481, "user_id": 5787123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tlxfJ.jpg?s=128&g=1", "display_name": "pticawr", "link": "https://stackoverflow.com/users/5787123/pticawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1453112307, "creation_date": 1452970878, "last_edit_date": 1453112307, "question_id": 34830900, "link": "https://stackoverflow.com/questions/34830900/unexpected-memory-growth-with-control-monad-foldm", "title": "Unexpected memory growth with Control.Monad foldM", "body": "<p>I have the following code, which has been stripped down and is I think as minimal as possible that has some very odd behaviour.</p>\n\n<p>The code consists of two source files:\nOne to define some data:</p>\n\n<pre><code>module MyFunction where\n\ndata MyFunction =\n    MyFunction {\n        functionNumber :: Int,\n        functionResult :: IO String\n        }\n\nmakeMyFunction :: Show a =&gt; Int -&gt; IO a -&gt; MyFunction\nmakeMyFunction number result = MyFunction {\n    functionNumber = number,\n    functionResult = result &gt;&gt;= return . show }\n</code></pre>\n\n<p>And the other is Main:</p>\n\n<pre><code>module Main (main) where\n\nimport System.CPUTime (getCPUTime)\nimport Data.List (foldl')\nimport Data.Foldable (foldlM)\nimport Control.Monad (foldM)\nimport MyFunction\n\nexampleFunction = do\n    --let x = foldl' (\\a b -&gt; a `seq` (a + b)) 0 [1..20000000]      -- This works\n    --x &lt;- foldlM (\\a b -&gt; a `seq` return (a + b)) 0 [1..20000000]  -- This works (*)\n    x &lt;- foldM (\\a b -&gt; a `seq` return (a + b)) 0 [1..20000000]    -- This doesn't\n    print x\n    return ()\n\nrunFunction fn = do\n    result &lt;- functionResult fn\n    duration &lt;- getCPUTime\n    if result /= \"()\"\n        then putStrLn \"\"\n        else return ()\n    putStrLn (show (fromIntegral duration / (10^9)) ++ \"ms\")\n    return fn\n\nmain = do\n    runFunction (makeMyFunction 123 exampleFunction)\n    return ()\n</code></pre>\n\n<p>The code as above (compiled using GHC 7.10.3 with stack 1.0.0 with default flags) has a rapid increase in memory usage (exceeding 1GB), and takes typically 3.3 seconds.</p>\n\n<p>If I make a changes to the code, for example:</p>\n\n<ul>\n<li>Use one of the commented alternatives to the problem line</li>\n<li>Take out any line from <code>runFunction</code></li>\n</ul>\n\n<p>The memory usage will remain minimal, and takes only about 1 second.</p>\n\n<p>One feature that I think is most surprising to me is that replacing <code>foldM</code> with <code>foldlM</code> (which as far as I know <code>foldM = foldlM</code>) fixes the problem.</p>\n\n<p>Also making changes to code that I don't see has any relationship to the problem lines of code also fixes the problem.  For example removing the last putStrLn.</p>\n\n<p><strong>Another oddity is that if I merge the MyFunction module into the Main module, while it doesn't fix the problem, it actually causes <code>foldlM</code> to behave as <code>foldM</code> using excessive memory.</strong></p>\n\n<p>In the real code that this came from, I have a large number <code>exampleFunction</code>s, and there is significantly more <code>Main</code> code, and every so often I encounter this sort of unexplained memory usage from functions, that can usually be resolved by some sort of voodoo.</p>\n\n<p>I'm looking for an explanation for the behaviour.  If I know why this occurs I can then look into avoiding it.  Could this be a compiler issue, or maybe just a misunderstanding on my part?</p>\n\n<p><strong>(*) I've highlighted the secondary issue that causes the same memory growth to occur with foldlM.</strong></p>\n"}, {"tags": ["user-interface", "haskell", "html-table", "wxwidgets", "wxhaskell"], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1452980063, "post_id": 34832116, "comment_id": 57406397, "body": "In my widget library building, I am trying to keep things as general as possible, but the particular application I have in mind would contain only text and small icons, in addition to the reactive widget I mentioned. That widget is in turn an elevated button that snapshots a time-varying value at click-time."}, {"owner": {"reputation": 18238, "user_id": 15275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WNTZ3.jpg?s=128&g=1", "display_name": "VZ.", "link": "https://stackoverflow.com/users/15275/vz"}, "reply_to_user": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1452987879, "post_id": 34832116, "comment_id": 57408424, "body": "This looks doable with wxDVC but you&#39;d have to write a custom renderer for the widget."}, {"owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1452990987, "post_id": 34832116, "comment_id": 57409118, "body": "I am used to writing custom renderers for my widgets. Do you have any examples/guides that might help me implement the DVC table? I don&#39;t have a lot of familiarity with the library."}, {"owner": {"reputation": 18238, "user_id": 15275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WNTZ3.jpg?s=128&g=1", "display_name": "VZ.", "link": "https://stackoverflow.com/users/15275/vz"}, "reply_to_user": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1452994157, "post_id": 34832116, "comment_id": 57409693, "body": "As usual, look at the <a href=\"https://github.com/wxWidgets/wxWidgets/blob/WX_3_0_2/samples/dataview/dataview.cpp\" rel=\"nofollow noreferrer\">sample</a>"}, {"owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "edited": false, "score": 0, "creation_date": 1453077848, "post_id": 34832116, "comment_id": 57431815, "body": "this is interesting, but not especially useful to me as it stands (I may be missing something though), as wxHaskell doesn&#39;t seem to implement this. I will probably try to go about writing a custom widget for this purpose."}], "tags": [], "owner": {"reputation": 18238, "user_id": 15275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WNTZ3.jpg?s=128&g=1", "display_name": "VZ.", "link": "https://stackoverflow.com/users/15275/vz"}, "is_accepted": false, "score": 2, "last_activity_date": 1452978235, "creation_date": 1452978235, "answer_id": 34832116, "question_id": 34830818, "link": "https://stackoverflow.com/questions/34830818/table-like-ui-element-for-wxhaskell-wxwidgets/34832116#34832116", "title": "&lt;table&gt;-like UI element for wxHaskell/wxWidgets", "body": "<p>HTML table can contain just about anything in its cells so it's too rich to be represented by any native control. It's really hard to make a recommendation without knowing what exactly you have in the table, but the different possibilities are:</p>\n\n<ul>\n<li><code>wxHtmlWindow</code>: this can be used to reuse your HTML provided it's simple enough (HTML4 basically) and you can embed native controls into it if needed.</li>\n<li><code>wxGrid</code>: this is the most flexible widget, but it's not native.</li>\n<li><code>wxDataViewCtrl</code>: this is native control under GTK and OS X (but not MSW where you'd need to use <code>wxListCtrl</code> for 100% native approach) but it's pretty limited compared to either of the above solutions.</li>\n</ul>\n"}], "owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1453157719, "creation_date": 1452970419, "last_edit_date": 1453157719, "question_id": 34830818, "link": "https://stackoverflow.com/questions/34830818/table-like-ui-element-for-wxhaskell-wxwidgets", "title": "&lt;table&gt;-like UI element for wxHaskell/wxWidgets", "body": "<p>I am working on writing a GUI in Haskell (and Ur/Web, but that is another story), and have several development branches using different libraries and approaches that I am working on contemporaneously. In trying to migrate some of the code I had from browser-backed UI libraries with HTML elements (threepenny-gui, to be precise) to native GUI applets using a WX graphical backend (wxHaskell, reactive-banana), I encountered some trouble figuring out how to migrate some code I had that was based on constructing a <code>&lt;table&gt;</code> element to an equivalent wxWidgets construct. It seemed to me that there was no easy way to implement such a thing on my own, and no native equivalent. I am looking for implementation suggestions, pointers to extant implementations, suitable alternatives, and so forth. I can provide more in-depth specifics of the design I am looking for, should that be required.</p>\n\n<p>The html table is merely used for aligning and displaying data, where one cell in every row is a reactive control, and the number of rows displayed at any given time can also vary reactively.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1452979824, "post_id": 34831106, "comment_id": 57406333, "body": "Thank you very much for your detailed explanation! I was not aware of the requirement to convert types."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1452972131, "creation_date": 1452972131, "answer_id": 34831106, "question_id": 34830462, "link": "https://stackoverflow.com/questions/34830462/generating-the-first-n-terms-of-the-continued-fraction-expansion-of-a-number/34831106#34831106", "title": "generating the first n terms of the continued fraction expansion of a number", "body": "\n\n<p>The Haskell numeric tower strikes again. So general! Yet such obtuse error messages!</p>\n\n<pre><code>continuedFraction x n\n  | x &lt; 0 || n &lt; 1 =\n    []\n  | otherwise =\n    floor x : take n (continuedFraction (1 / (x - floor x)) (n - 1))\n</code></pre>\n\n<p>So, if you throw this code into an interpreter and then infer the type you get</p>\n\n<pre><code>continuedFraction\n  :: (Integral a, Integral t, RealFrac a) =&gt; a -&gt; Int -&gt; [t]\n</code></pre>\n\n<p>There's a hidden problem here! There's no good way to resolve the two <code>Integral a, RealFrac a</code> constraints.</p>\n\n<pre><code>\u03bb&gt; :info Integral\nclass (Real a, Enum a) =&gt; Integral a where\n   ...\ninstance Integral Word -- Defined in \u2018GHC.Real\u2019\ninstance Integral Integer -- Defined in \u2018GHC.Real\u2019\ninstance Integral Int -- Defined in \u2018GHC.Real\u2019\n\u03bb&gt; :info RealFrac\nclass (Real a, Fractional a) =&gt; RealFrac a where\n   ...\ninstance RealFrac Float -- Defined in \u2018GHC.Float\u2019\ninstance RealFrac Double -- Defined in \u2018GHC.Float\u2019\n</code></pre>\n\n<p>Integral types by definition aren't fractional types; fractional types by definition aren't integral types. There are ways of converting between the two, of course, but none were invoked here. The obtuseness of GHC's error messages masks this problem.</p>\n\n<p>The problem arises from this expression: <code>x - floor x</code>. <code>floor x</code> has an integral type, <code>x</code> has a fractional type. In order for <code>(-) :: (Num a) =&gt; a -&gt; a -&gt; a</code> to typecheck, we get the impossible <code>(Integral a, RealFrac a)</code> constraint.</p>\n\n<p>The solution is to lift <code>floor x</code> with <code>fromInteger :: Num a =&gt; Integer -&gt; a</code>.</p>\n\n<pre><code>continuedFraction' :: (Integral t, RealFrac a) =&gt; a -&gt; Int -&gt; [t]\ncontinuedFraction' x n\n  | x &lt; 0 || n &lt; 1 =\n    []\n  | otherwise =\n    floor x : take n (continuedFraction' (1 / decimal) (n - 1))\n    where\n      decimal = x - fromInteger (floor x)\n\n\u03bb&gt; continuedFraction' 3.14159 4\n[3,7,15,1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1452974125, "post_id": 34831221, "comment_id": 57404484, "body": "btw it would be a good exercise to use a <code>fold</code> to get the original fraction back!"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1452979990, "post_id": 34831221, "comment_id": 57406377, "body": "Danke very much for your tips! That would be my next challenge=) Currently I am using learnyouahaskell.com but can you recommend other tutorials?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1452980519, "post_id": 34831221, "comment_id": 57406517, "body": "Bitte gern geschehen - I don&#39;t know what your learing type is - but there is some material here <a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a> and if you are lucky there might be a local meetup group/user group near you (in vienna we are called lambdaheads). Also there are some functional programming university courses out there you can check out."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 3, "last_activity_date": 1452972851, "creation_date": 1452972851, "answer_id": 34831221, "question_id": 34830462, "link": "https://stackoverflow.com/questions/34830462/generating-the-first-n-terms-of-the-continued-fraction-expansion-of-a-number/34831221#34831221", "title": "generating the first n terms of the continued fraction expansion of a number", "body": "<h2>Advice</h2>\n\n<p>If you are a beginner at Haskell there are a few rules you should stick to:</p>\n\n<ul>\n<li>if you have a function, make sure you give it a type signature which expresses your intended input/output</li>\n<li>if in doubt stick to concrete types <code>Double</code> over typeclasses <code>Fractional a</code></li>\n<li>if your function is working as intended remove the type signature or use the language extension <code>-XScopedTypeVariables</code> and ghci to explore the signatures the compiler would infer to get a feel for typeclasses</li>\n</ul>\n\n<h2>Answer</h2>\n\n<p>Now let us explore your function - you want to generate a continued fraction i assume the formula you have written down for generating it is correct. Haskell is powerful enough to model infinite lists so let us use that power and get rid of that second parameter and generate a (possibly) infinite list.</p>\n\n<pre><code>continuedFraction :: Double -&gt; [Int]\n</code></pre>\n\n<p>So we see - you are expecting a <code>Double</code> input and as a result <code>[Int]</code>, i.e. a list of integers, I chose <code>Int</code> for simplicity - as for huge <code>Integer</code> I don't think this algorithm is neither stable nor efficient - and using <code>Double</code>'s I guess the real problem will be floating point arithmetics.</p>\n\n<pre><code>continued fraction x | x &lt; 0     = []\n                     | otherwise = let i = floor x\n                                       x' = 1/(x - fromIntegral i)\n                                   in i : continuedFraction x'\n</code></pre>\n\n<p>This is the simplest solution you came up with, the problems you had were</p>\n\n<ul>\n<li><p><code>i :: Int</code>, <code>x :: Double</code> in Haskell you cannot subtract things of different type, there is no autoboxing/automatic coercion. We like the control over those things - the compiler is <strong>not</strong> smart enough to infer what we 'obviously' wanted to calculate (you see what this leads to if you use MS Excel).</p></li>\n<li><p>the solution to this problem is explicit conversion <code>fromIntegral :: Double -&gt; Int</code> in this case</p></li>\n<li><p>for readability I also switched the <code>[a] ++</code> to <code>a :</code> which is equivalent, less to write and more performant, but performance is not of concern here</p></li>\n</ul>\n\n<p>using the function now in ghci: <code>ghci myfile.hs</code></p>\n\n<pre><code>&gt; continuedFraction 3.1415\n[3,.....] --infinite list\n&gt; take 4 $ continuedFraction 3.1415\n[3,7,14,1]\n</code></pre>\n\n<p>now you can explore the function!</p>\n\n<h2>How to use the advice</h2>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables#-}\n\nmodule SO34830462 where\n\n--continuedFraction :: Double -&gt; [Int]\ncontinuedFraction :: Double -&gt; _\ncontinuedFraction x | x &lt; 0  = []\n                    | otherwise = let i = floor x\n                                      x' = 1/ (x - fromIntegral i)\n                                  in i : continuedFraction  x'\n</code></pre>\n\n<p><code>ghci myfile.hs</code> leads to an error</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling SO34830462       ( 34830462.hs, interpreted )\n\nmyfile.hs:6:32:\n    Found hole \u2018_\u2019 with type: [t]\n    [...]\n               continuedFraction :: Integral t =&gt; Double -&gt; [t]\n    [...]\nFailed, modules loaded: none.\n</code></pre>\n\n<p>It tells you in short - \"oh you didn't specify a correct type signature\", but ghc could use this type signature.</p>\n\n<p>you can substitute the type signature and do the same with the <code>Double</code> parameter, exploring the function bit by bit.</p>\n\n<p>if you are not sure what to start with you can omit the type signature and call <code>:t continuedFraction</code> iside a ghci session.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1452972851, "creation_date": 1452968377, "last_edit_date": 1452970427, "question_id": 34830462, "link": "https://stackoverflow.com/questions/34830462/generating-the-first-n-terms-of-the-continued-fraction-expansion-of-a-number", "title": "generating the first n terms of the continued fraction expansion of a number", "body": "<p><strong><em>EDIT: @Downvoters:</strong> Could you at least please tell me how I can improve this question? I tried the best I can, and getting downvotes without any comment is not constructive in my opinion.</em></p>\n\n<p>Im still new to Haskell, and as an exercises, I'm trying to make function, that returns the first <code>n</code> terms of the continued fraction expansion of <code>x</code>. The first argument <code>x</code> can be a floting point or an integral, the second argument must be an <code>int</code>. This is my code so far, which does load without error:</p>\n\n<pre><code>continuedFraction x n | x &lt; 0  = []\n                      | n &lt; 1 = []\n                      | otherwise = [floor x] ++ (take n (continuedFraction (1 / (x - floor x)) (n-1) ) )\n</code></pre>\n\n<p>(I am aware that this is not very elegant, but It was the simplest one I was able to come up with at that point.) </p>\n\n<p>As soon as I actually use the function e.g. <code>continuedFraction 3.1415 4</code> I get the error message below. Can anyone point out my error / explain that message?</p>\n\n<p>(I did try to make a type definition with the ideas above, but without success too: <code>continuedFraction :: (Num x) =&gt; x -&gt; Int -&gt; [Integer]</code>)</p>\n\n<p>The error message (when running without the type definition):</p>\n\n<pre><code>*Main&gt; continuedFraction 3.1415 4\n\n&lt;interactive&gt;:86:1:\n    Could not deduce (Integral a0)\n      arising from a use of `continuedFraction'\n    from the context (Integral t)\n      bound by the inferred type of it :: Integral t =&gt; [t]\n      at &lt;interactive&gt;:86:1-26\n    The type variable `a0' is ambiguous\n    Note: there are several potential instances:\n      instance Integral Integer -- Defined in `GHC.Real'\n      instance Integral Int -- Defined in `GHC.Real'\n      instance Integral Word -- Defined in `GHC.Real'\n    In the expression: continuedFraction 3.1415 4\n    In an equation for `it': it = continuedFraction 3.1415 4\n\n&lt;interactive&gt;:86:19:\n    Could not deduce (Fractional a0) arising from the literal `3.1415'\n    from the context (Integral t)\n      bound by the inferred type of it :: Integral t =&gt; [t]\n      at &lt;interactive&gt;:86:1-26\n    The type variable `a0' is ambiguous\n    Note: there are several potential instances:\n      instance Integral a =&gt; Fractional (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      instance Fractional Double -- Defined in `GHC.Float'\n      instance Fractional Float -- Defined in `GHC.Float'\n    In the first argument of `continuedFraction', namely `3.1415'\n    In the expression: continuedFraction 3.1415 4\n    In an equation for `it': it = continuedFraction 3.1415 4\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "primes"], "answers": [{"comments": [{"owner": {"reputation": 178, "user_id": 5635144, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/cdad212c64e09721be44eb2adb694709?s=128&d=identicon&r=PG&f=1", "display_name": "naturesenshi", "link": "https://stackoverflow.com/users/5635144/naturesenshi"}, "edited": false, "score": 0, "creation_date": 1452967560, "post_id": 34830229, "comment_id": 57402267, "body": "Great! Thank you!! :D"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1452967881, "last_edit_date": 1452967881, "creation_date": 1452967033, "answer_id": 34830229, "question_id": 34830131, "link": "https://stackoverflow.com/questions/34830131/pattern-matching-error-in-haskell/34830229#34830229", "title": "Pattern matching error in haskell", "body": "<p>The problem with the function <code>isitprime2</code> is that it doesn't handle all cases. Like what happens when:</p>\n\n<ul>\n<li><code>y &gt; 1 &amp;&amp; x mod y != 0</code></li>\n<li><code>y == 1 &amp;&amp; x mod y != 0</code></li>\n</ul>\n\n<p>Handle other cases and your code will work fine. You can also use <code>otherwise</code> clause for handling all the edge case:</p>\n\n<pre><code>isitprime2 :: Int-&gt;Int-&gt;Bool\nisitprime2 x y \n  | y &gt; 1 &amp;&amp; x `mod` y == 0 = False \n  | y == 1 &amp;&amp; x `mod` y == 0 = True\n  | otherwise = ??? -- handle all edge case\n</code></pre>\n"}], "owner": {"reputation": 178, "user_id": 5635144, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/cdad212c64e09721be44eb2adb694709?s=128&d=identicon&r=PG&f=1", "display_name": "naturesenshi", "link": "https://stackoverflow.com/users/5635144/naturesenshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1452967881, "creation_date": 1452966511, "question_id": 34830131, "link": "https://stackoverflow.com/questions/34830131/pattern-matching-error-in-haskell", "title": "Pattern matching error in haskell", "body": "<p>Hello I have been attempting to answer a question that deals with checking if a number is a prime number. I came up with this code below: </p>\n\n<pre><code>isitprime :: Int-&gt;Bool\nisitprime n \n   | n&lt;=1 = False\n   | otherwise = isitprime2 n (n-1)\n\nisitprime2 :: Int-&gt;Int-&gt;Bool\nisitprime2 x y \n  | y &gt; 1 &amp;&amp; x `mod` y == 0 = False \n  | y == 1 &amp;&amp; x `mod` y == 0 = True\n</code></pre>\n\n<p>When run in winhugs, it returns an error saying \"pattern matching failure: isitprime2 a a-1 \" for any value greater than 2. </p>\n\n<p>However it returns false for any values which are directly multiplied by 2, e.g. isitprime2 2 1 returns false, isitprime2 4 2, isitprime2 6 3, isitprime2 10 5 etc. all return false.    </p>\n\n<p>What is going wrong and why?</p>\n\n<p>Thanks :D</p>\n"}, {"tags": ["multithreading", "haskell", "clojure", "functional-programming", "erlang"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1452975437, "post_id": 34828560, "comment_id": 57404900, "body": "Threads are never a goal, always a tool. You normally want to forget about them as much as possible and only let some low level, very well thought machinery do the threading for you under the hood."}], "answers": [{"tags": [], "owner": {"reputation": 14588, "user_id": 3166303, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/877b076ec96e4ab48f7f4567c1ea2741?s=128&d=identicon&r=PG", "display_name": "leeor", "link": "https://stackoverflow.com/users/3166303/leeor"}, "is_accepted": false, "score": 8, "last_activity_date": 1452958219, "creation_date": 1452958219, "answer_id": 34828715, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/34828715#34828715", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I can provide an answer for the <code>clojure</code> case. In <code>clojure</code>, if you need to co-ordinate access to shared state, there are constructs in the language that are designed to deal with these situations. </p>\n\n<p>In this case, you could use an <code>atom</code> to hold the value. Changes made to an <code>atom</code> are atomic, and will be made optimistically by way of clojure's <a href=\"http://clojure.org/reference/refs\">STM</a>. Atoms are one of clojure's reference types. An atom is essentially a reference to a value, which can change over time in a controlled way via the atom's mutation functions.</p>\n\n<p>See the clojure <a href=\"http://clojure.org/reference/atoms\">docs</a> for more information on atoms and the other references types.</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452975487, "post_id": 34829258, "comment_id": 57404916, "body": "-1 for not addressing the real issue \u2014 a misconception in how threads should be used, especially in a language like Haskell."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452977328, "post_id": 34829258, "comment_id": 57405504, "body": "@ErikAllik I was just showing one of the mechanism of how threads communicate with each other. I would be glad to read your answer."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1567760210, "last_edit_date": 1567760210, "creation_date": 1452961667, "answer_id": 34829258, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/34829258#34829258", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I will address the Haskell part. <code>MVar</code> is one of the communication mechanism for threads. This is one of the example taken from Simon Marlow's book (the program is self-explanatory):</p>\n\n<pre><code>main = do\n  m &lt;- newEmptyMVar\n  forkIO $ do putMVar m 'x'; putMVar m 'y'\n  r &lt;- takeMVar m\n  print r\n  r &lt;- takeMVar m\n  print r\n</code></pre>\n\n<p>The output for the above program will be:</p>\n\n<pre><code>'x'\n'y'\n</code></pre>\n\n<p>You can see in the above example how the <code>MVar</code> value in variable <code>m</code> is shared between threads. You can learn more about these techniques in <a href=\"https://www.oreilly.com/library/view/parallel-and-concurrent/9781449335939/\" rel=\"nofollow noreferrer\">this book</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 0, "last_activity_date": 1453089756, "creation_date": 1453089756, "answer_id": 34847133, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/34847133#34847133", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I will also address the Haskell part.</p>\n\n<p>First, I want to clear something up:</p>\n\n<blockquote>\n  <p>Instead of changing value of variables we create new variables in\n  functional programming when we need to update a variable.</p>\n</blockquote>\n\n<p>That's not so accurate. We create new \"variables\" in FP when we need them, not when we need to mutate existing ones. We don't even think in terms of mutation when we do what you describe; we may just think we're creating a new value that's similar to one we have.</p>\n\n<p>What you're describing with threads is a bit different. You're actually looking for a side-effect (increment a counter). Haskell, being pure, will not just allow you to throw side-effects without being very explicit of it. So in this case you will need to resort to reference types / mutable cells. The most simple one is called <code>IORef</code> and it's very much like a variable in this sense; you can assign a value, read the current value, and so on.</p>\n\n<p>So, as you can see, when you're looking for these kind of stuff, you really do have just one copy of the counter.</p>\n\n<p>The above is the essence of my answer, but you've asked  concretely about threads so I'll respond to that as-well.<br />\n<code>IORef</code>s are not actually thread-safe. So there are <code>MVar</code>s as suggested. They are not like regular variables, but they are close, and they get the job done elegantly. Generally and loosely speaking: they abstract variables and locking. I think you might find <code>TVar</code>s easier though. They behave like <code>IORef</code>/variables, only that unlike both, they are thread-safe; you can compose their operations into one operation, and any operation done to them is done atomically (STM).</p>\n\n<p>By the way, you might find ways to avoid state altogether, and this is <em>very</em> encouraged. E.g. you can have the two threads execute an asynchronous recursive function that remembers through an argument how many requests have been made, and later have it as a return value. The total requests count is the sum of requests all your threads returned. This can avoid the side-effect on the counter, but it could only yield you a result when the threads are finished. That's quite limited, so sometimes you might want that side-effect.</p>\n"}, {"tags": [], "owner": {"reputation": 114, "user_id": 3745665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a42807d4c55c63bb4422d54298b6c2?s=128&d=identicon&r=PG", "display_name": "Soniku", "link": "https://stackoverflow.com/users/3745665/soniku"}, "is_accepted": false, "score": 0, "last_activity_date": 1453127479, "last_edit_date": 1453127479, "creation_date": 1453126568, "answer_id": 34856853, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/34856853#34856853", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>Well I will try to provide more general explanation when holding state since I think that is what you really want to know. </p>\n\n<p>Generally you can accomplish the same thing through recursion, so for example if you have function below:</p>\n\n<pre><code>somefun ()-&gt;\n   somefun(0).\nsomefun (X) -&gt;\n  perform_http_request(),\n  if(something!=quit)\n     somefun(X+1)\nend function.\n\ngenerate_thread(0, Accumulator) -&gt;\n      Accumulator;\ngenerate_thread(X, Accumulator) -&gt;\n      Y = somefun(),\n      NewAccumulator = add_to_accumulator(Y),\n      generate_thread(X-1, NewAccumulator).\n</code></pre>\n\n<p>I just typed this in a hurry and this is a very generic explanation (you won't be able to use this code directly) but think you can find that you don't really the mutability here... The function will finish when all of the threads finish their processing, now the actual thread sync you can do depending on the language of your choice and different languages have different ways of handling concurrency and \"threads\" .. I would suggest that you take a look at Erlang if you are into concurrency as it has a really good concurrency model imo. </p>\n\n<p>Anyways at the end you can just sum all the values in the accumulator that are returned and display that, take a look at foldl and foldr functions as well by the way. </p>\n"}, {"tags": [], "owner": {"reputation": 1718, "user_id": 2711378, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/100000919862380/picture?type=large", "display_name": "Amanuel Nega", "link": "https://stackoverflow.com/users/2711378/amanuel-nega"}, "is_accepted": false, "score": 0, "last_activity_date": 1567538693, "creation_date": 1567538693, "answer_id": 57777661, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/57777661#57777661", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I'm not a guru myself, but I think you might have miss understood.</p>\n\n<p><strong>Without keeping state, you can't create a program that would be much useful</strong>. There needs to state one way or another. The target of FP is not to avoid state, <strong>it's to keep usage of state under control</strong>. </p>\n\n<p>Look at it this way, your state should be as isolated and as safe as your database entries. <strong><em>If you treat state as you would treat a database, I think you'll be fine</em></strong> </p>\n\n<p>This implies, </p>\n\n<ul>\n<li>You won't have some login like <code>(inc count)</code>. You will rather have a function <code>increment-count!</code> that will safely update the count. Notice <code>!</code>, this means side effect. </li>\n<li><strong>You will not have a code that will depend on the side effects</strong>. Rather you'll depend on functions that expect everything from their parameter. Unless they absolutely have to depend on the state. Like updating count, which is an undeniable call for a state.</li>\n<li><strong>Your first choice should be to avoid state.</strong> When passing it to the function becomes impossible, then you'll create states that are updated properly. </li>\n<li>Treat states as you would treat external APIs. Something remote you have to use some kind of protocol to access.</li>\n</ul>\n\n<p>I hope this makes sense. </p>\n"}, {"tags": [], "owner": {"reputation": 318, "user_id": 7058044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nHSvr.jpg?s=128&g=1", "display_name": "Ming L.", "link": "https://stackoverflow.com/users/7058044/ming-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1567693931, "creation_date": 1567693931, "answer_id": 57807760, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming/57807760#57807760", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I will the address Erlang part. There is no magic for synchronization even in Erlang, that someone somewhere has to deal with synchronization. It\u2019s just Erlang with the benefit with immutability (aka no variable) helps to prevent common sync mistakes in concurrent programming. Erlang/OTP like gen_server already has the infrastructure to manage the state. In fact, gen_server is single threaded that any message it receives are queued up in mailbox. Here is a link about Erlang\u2019s message concurrency. <a href=\"https://stackoverflow.com/questions/18459633/how-erlang-processes-access-mailbox-concurrently\">How Erlang processes access mailbox concurrently</a></p>\n\n<p>In the original post case, to peg a http request counter, you can use a single gen_server OTP (Erlang). You will be surprised how much throughput it can handle. If a single gen_server throughput is really insufficient, there can be a hierarchical gen_server to aggregate the counts. Erlang/OTP comes with a set of runtime API to measure performance in real time. </p>\n"}], "owner": {"reputation": 2073, "user_id": 1815646, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/y1tPx.jpg?s=128&g=1", "display_name": "Narayan Prusty", "link": "https://stackoverflow.com/users/1815646/narayan-prusty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 34829258, "answer_count": 6, "score": 6, "last_activity_date": 1567760210, "creation_date": 1452957304, "question_id": 34828560, "link": "https://stackoverflow.com/questions/34828560/problems-with-immutable-data-in-functional-programming", "title": "Problems with Immutable Data in Functional Programming", "body": "<p>I am new to functional programming. What I understood is functional programming is writing code using pure functions and without changing value of data. </p>\n\n<p>Instead of changing value of variables we create new variables in functional programming when we need to update a variable.</p>\n\n<p>Suppose we have a variable <code>x</code> which represents the total number of HTTP requests made by the program. If we have two threads then I want the threads to increment <code>x</code> whenever a HTTP request is made by any thread. If both threads make a different copy of the variable <code>x</code> then how can they synchronize the value of <code>x</code>. For example: if thread 1 make 10 HTTP requests and thread 2 made 11 HTTP requests then they will print 10 and 11 respectively but how would I print 21.</p>\n"}, {"tags": ["function", "haskell", "yesod", "hamlet"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 3, "last_activity_date": 1452957213, "creation_date": 1452957213, "answer_id": 34828539, "question_id": 34828334, "link": "https://stackoverflow.com/questions/34828334/call-a-function-inside-a-hamlet-file/34828539#34828539", "title": "Call a function inside a hamlet file", "body": "<p>You can use any Haskell expression which is in scope using <code>#{}</code> interpolation. Just make sure you function produces something of <code>ToHTML</code> instance.</p>\n"}, {"tags": [], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "is_accepted": false, "score": 0, "last_activity_date": 1453041091, "creation_date": 1453041091, "answer_id": 34839475, "question_id": 34828334, "link": "https://stackoverflow.com/questions/34828334/call-a-function-inside-a-hamlet-file/34839475#34839475", "title": "Call a function inside a hamlet file", "body": "<p>Something like this should work:</p>\n\n<pre><code>myhamlet key lang = [hamlet|\n    &lt;h1&gt; for key = #{key}, lang = #{lang}, value = #{getValue lang key}\n |]\n</code></pre>\n\n<p>... or in a .hamlet file :</p>\n\n<pre><code>    &lt;h1&gt; for key = #{key}, lang = #{lang}, value = #{getValue lang key}\n</code></pre>\n\n<p>(assuming that <code>key</code> and <code>lang</code> are in scope).</p>\n"}], "owner": {"reputation": 302, "user_id": 4742633, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b64bd428ea67772ed5eb5a1aa4d6108d?s=128&d=identicon&r=PG", "display_name": "Xlaech", "link": "https://stackoverflow.com/users/4742633/xlaech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1453041091, "creation_date": 1452956064, "question_id": 34828334, "link": "https://stackoverflow.com/questions/34828334/call-a-function-inside-a-hamlet-file", "title": "Call a function inside a hamlet file", "body": "<p>I have writen a small language lookup with a function</p>\n\n<pre><code>getValue :: String -&gt; String -&gt; String\ngetValue lang key = ( \n    head $\n    filter ((== key) . head) langData)\n    !! getLangIndex lang\n</code></pre>\n\n<p>now i want to call this lookup function inside a hamlet file.</p>\n\n<p>Is this possible and how do i have to change the function to make it callable?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1452951398, "post_id": 34827456, "comment_id": 57396863, "body": "Money doesn&#39;t look like a functor at all, much less an applicative. Does it make a sense to talk about <code>Money String</code> or <code>Money ()</code> or <code>Money (Int, [Double-&gt;IO()])</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1452952303, "post_id": 34827456, "comment_id": 57397148, "body": "@n.m. I would agree. Yet, it might just be that <code>Money</code> is simply a bad term for the idea. It seems that a <code>Money a</code> is just a value of type <code>a</code> decorated with a message &quot;note that prices are in currency C&quot; -- with a <code>Maybe</code> on top to handle failure. Also, the currency is set and tested at run-time (which could be good or bad depending on the actual aim...)"}, {"owner": {"reputation": 1911, "user_id": 1088499, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/9f1b450ba8b27beca7285892c5c2ed59?s=128&d=identicon&r=PG", "display_name": "djfm", "link": "https://stackoverflow.com/users/1088499/djfm"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1452953491, "post_id": 34827456, "comment_id": 57397496, "body": "@n.m. thanks, really convincing when you put it this way :)"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1452977518, "post_id": 34827456, "comment_id": 57405578, "body": "I would not recommend learnyouahaskell for haskell learning. unless you really like comics but in that area, there are also some better ones, like Tintin"}, {"owner": {"reputation": 1911, "user_id": 1088499, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/9f1b450ba8b27beca7285892c5c2ed59?s=128&d=identicon&r=PG", "display_name": "djfm", "link": "https://stackoverflow.com/users/1088499/djfm"}, "reply_to_user": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1453036531, "post_id": 34827456, "comment_id": 57418227, "body": "@nicolas what would you recommend for learning haskell? The comics on learnyouahaskell don&#39;t bother me, I find they make the pages more appealing and less frightening. Form aside, do you object to the content on this website?"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1452953973, "last_edit_date": 1452953973, "creation_date": 1452952544, "answer_id": 34827765, "question_id": 34827456, "link": "https://stackoverflow.com/questions/34827456/trying-to-build-an-applicative-instance-that-handles-monetary-amounts-in-differe/34827765#34827765", "title": "Trying to build an Applicative instance that handles monetary amounts in different currencies, am I on the wrong track?", "body": "<blockquote>\n  <p>is Applicative really not a solution to simplify this sort of problem?</p>\n</blockquote>\n\n<p>Yes, it isn't. As you already said, the problem is that </p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>needs to work with any <code>a</code> and <code>b</code>, but you allow only <code>a ~ Double</code>, <code>b ~ Double</code>. </p>\n\n<p>However, if we think of any <code>Applicative f</code> as a container that knows how to apply functions, it seems rather weird to store some kind of <code>Money</code> in there. Also, it seems like you only want the <code>Applicative</code> instance for <code>(+) &lt;$&gt; a &lt;*&gt; b</code>, which is a misuse. Instead, write a small little helper:</p>\n\n<pre><code>($+) :: Money a -&gt; Money a -&gt; Money a\n(Amount c a) $+ (Amount c' b) = ...\n</code></pre>\n\n<p>This also gives you a lot more power for later changes. For example, you could use a phantom type instead of your current approach to tag the Money with the currency:</p>\n\n<pre><code>newtype Money c a = Amount a deriving Show\n\ndata USD\ndata EUR\n\nusd :: Num a =&gt; a -&gt; Money USD a\nusd = Amount\n\neur :: Num a =&gt; a -&gt; Money EUR a\neur = Amount\n\n($+) :: Money c a -&gt; Money c a -&gt; Money c a\n(Amount a) $+ (Amount b) = Amount $ a + b\n\n-- eur 5 $+ usd 4 = type error\n</code></pre>\n\n<p>However, keep in mind that currency is a rather bad type for compile-time conversion, since the rates change all the time. A more realistic approach would be</p>\n\n<pre><code>($+) :: Fractional a =&gt; CurrencyEnv -&gt; Money a -&gt; Money a -&gt; Maybe (Money a)\n</code></pre>\n\n<p>where you load the <code>CurrencyEnv</code> at the beginning of your program. Keep in mind that you shouldn't use <code>Double</code> for currency related tasks, unless you want to explain your boss why you're missing some pennies. <code>Data.Ratio.Rational</code> is better suited.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452959959, "post_id": 34828118, "comment_id": 57399576, "body": "Sorry, accidentally edited instead of comment: Use <code>&amp;times;</code> instead of <code>*</code>, or use <code>\\*</code> to make sure that the asterisk doesn&#39;t get interpreted as markdown."}], "tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": false, "score": 1, "last_activity_date": 1452977399, "last_edit_date": 1452977399, "creation_date": 1452954629, "answer_id": 34828118, "question_id": 34827456, "link": "https://stackoverflow.com/questions/34827456/trying-to-build-an-applicative-instance-that-handles-monetary-amounts-in-differe/34828118#34828118", "title": "Trying to build an Applicative instance that handles monetary amounts in different currencies, am I on the wrong track?", "body": "<p>I think what you want is called a \"<a href=\"http://research.microsoft.com/en-us/um/people/akenn/units/CEFP09TypesForUnitsOfMeasure.pdf\" rel=\"nofollow\">unit of measure</a>\", which is a type quotient by some algebraic theory to unify say, dollar.eur^2 with eur.dollar.eur</p>\n\n<p>Zeta's solution uses <a href=\"http://www.cs.ox.ac.uk/ralf.hinze/publications/With.pdf\" rel=\"nofollow\">phantom types</a> to ensure \"from inside\" some consistency while letting people use your types \"from outside\" </p>\n\n<p>It's a first step, but the equational part would be missing which can be a problem or not.</p>\n\n<p>I think one would need a ring solver (isn't it the term ?) to handle the equivalence between exponents of your types.</p>\n"}], "owner": {"reputation": 1911, "user_id": 1088499, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/9f1b450ba8b27beca7285892c5c2ed59?s=128&d=identicon&r=PG", "display_name": "djfm", "link": "https://stackoverflow.com/users/1088499/djfm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 34827765, "answer_count": 2, "score": 2, "last_activity_date": 1452977399, "creation_date": 1452950505, "question_id": 34827456, "link": "https://stackoverflow.com/questions/34827456/trying-to-build-an-applicative-instance-that-handles-monetary-amounts-in-differe", "title": "Trying to build an Applicative instance that handles monetary amounts in different currencies, am I on the wrong track?", "body": "<p>I'm giving yet another go at Haskell (reading the awesome <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow\">learnyouahaskell</a> tutorial) and I'm desperately looking for a nail to apply this magnificient hammer to.</p>\n\n<p>My day job is in E-Commerce, and we have tons of software design issues manipulating prices. So I figured, it could be nice to use the Haskell type system to abstract away things like converting between currencies or pre-tax / after-tax prices while guaranteeing correctness.</p>\n\n<p>Here is a rough idea of what I'm trying to achieve (obviously not-compiling, wouldn't be here otherwise):</p>\n\n<pre><code>data Money a = Amount String a | ConversionError\n    deriving Show\n\nconvert :: String -&gt; Money Double -&gt; Money Double\nconvert toCurrency (Amount fromCurrency 0) = Amount toCurrency 0\nconvert \"EUR\" (Amount \"USD\" x) = Amount \"EUR\" (0.92 * x)\nconvert \"USD\" (Amount \"EUR\" x) = Amount \"USD\" (1.09 * x)\nconvert _ _ = ConversionError\n\ninstance Functor Money where\n    fmap f (Amount currency number) = Amount currency (f number)\n\ninstance Applicative Money where\n    ConversionError &lt;*&gt; _ = ConversionError\n    Amount x f &lt;*&gt; amount = let Amount _ n = convert x amount\n                            in\n                                Amount x (f n)\n    pure = Amount \"EUR\"\n\neur5 = Amount \"EUR\" 5\nusd5 = Amount \"USD\" 5\n\n\nmain = do\n    print $ fmap (+1) eur5 -- Amount \"EUR\" 6\n    print $ convert \"EUR\" usd5 -- Amount \"EUR\" 4.6000000000000005\n    print $ (+) &lt;$&gt; eur5 &lt;*&gt; usd5 -- I'd like it to print: Amount \"EUR\" 9.58\n</code></pre>\n\n<p>This doesn't compile because:</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018Double\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for\n        (&lt;*&gt;) :: Money (a -&gt; b) -&gt; Money a -&gt; Money b\n      at src/Main.hs:14:21\nExpected type: Money Double\n  Actual type: Money a\n</code></pre>\n\n<p>And I understand why.</p>\n\n<p>I think a possible fix would be to let the Money type carry the conversion function, but it makes the whole thing less elegant, I'd have to declare my prices like this:</p>\n\n<pre><code>data Money a = Amount (String -&gt; (Money a) -&gt; (Money a)) a\neur5 = Amount convert \"EUR\" 5\n</code></pre>\n\n<p>What I'd really like is if I could start worrying about conversions only when computations happen and not need to embed the conversion function inside the <code>Money</code> values.</p>\n\n<p>So, am I on the right track but mis-understanding something, or is Applicative really not a solution to simplify this sort of problem?</p>\n"}, {"tags": ["haskell", "testing", "monads", "assertions", "hspec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452947745, "post_id": 34826824, "comment_id": 57395746, "body": "The type of <code>safeHead [] `shouldBe` Nothing</code> is ambiguous because there is nothing to tell the compiler which element type to use in comparisons of the list elements (of course, it does&#39;t matter, since there are no elements, but the compiler doesn&#39;t know that). You can fix it by giving an explicit type: <code>safeHead [] `shouldBe` (Nothing :: Maybe Int)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1452949462, "last_edit_date": 1452949462, "creation_date": 1452949100, "answer_id": 34827224, "question_id": 34826824, "link": "https://stackoverflow.com/questions/34826824/testing-functions-that-return-a-maybe-monad/34827224#34827224", "title": "testing functions that return a Maybe Monad", "body": "<pre><code>shouldBe                :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Expectation\nsafeHead                ::         [a] -&gt;    Maybe a\n[]                      ::         [a]\nsafeHead []             ::                   Maybe a\nNothing                 ::                   Maybe a\nshouldBe (safeHead [])  :: (Eq a, Show a) =&gt; Maybe a -&gt; Expectation\n\nshouldBe (safeHead []) Nothing ::                       Expectation -- but what's `a`?\n</code></pre>\n\n<p>As you can see, <code>a</code> is completely ambiguous. It can a be any type that has <code>Show</code> and <code>Eq</code> instances. This is also part of your error message:</p>\n\n<pre>\nNo instance for (Eq a0) arising from a use of \u2018shouldBe\u2019\n<strong>The type variable \u2018a0\u2019 is ambiguous</strong>\n</pre>\n\n<p>So pick one:</p>\n\n<pre><code>it \"returns Nothing for an empty list\" $\n    safeHead [] `shouldBe` (Nothing :: Maybe ())\n</code></pre>\n\n<p>While you're at it, use QuickCheck to verify that <code>safeHead</code> works like <code>head</code>:</p>\n\n<pre><code>it \"returns Just (head xs) for a non-empty list\" $ property $ \\(NonEmpty xs) -&gt;\n    safeHead xs `shouldBe` (Just (head xs) :: Maybe Integer)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1452949367, "post_id": 34827247, "comment_id": 57396243, "body": "very interesting. I&#39;d love to know what the relative pros and cons of this solution are with respect to giving a type specification? Or is it literally &quot;pros: less typing, cons: looser types&quot;?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1452949489, "post_id": 34827247, "comment_id": 57396288, "body": "@AbrahamP basically yes, less typing is probably the only pros :)"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1452950376, "last_edit_date": 1452950376, "creation_date": 1452949237, "answer_id": 34827247, "question_id": 34826824, "link": "https://stackoverflow.com/questions/34826824/testing-functions-that-return-a-maybe-monad/34827247#34827247", "title": "testing functions that return a Maybe Monad", "body": "<p>As user2407038 commented, compiler doesn't know how to instantiate <code>a</code>. The fix he proposed is probably the best one -- you should specify type of <code>a</code> explicitly.</p>\n\n<p>But for completeness I'd like to note, that there is other solution, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"nofollow\">extended default rules</a>:</p>\n\n<pre><code>{-# LANGUAGE ExtendedDefaultRules #-}\n\ndescribe \"Example.safeHead\" $ do\n  it \"returns the head\" $ do\n    safeHead [1,2,3] `shouldBe` Just 1\n\n  it \"returns Nothing for an empty list\" $\n    safeHead [] `shouldBe` Nothing\n</code></pre>\n\n<p>The extension modifies <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow\">the standard defaulting rules</a> to include more cases, e.g. <code>Eq</code> type class.</p>\n\n<p><strong>Added:</strong> After some thinking I reconsider my answer a bit. Results of unit testing of polymorphic functions should not depend of a particular way to instantiate type variables. So probably extended default rules is The Right Thing in tests? I never used them it real code, so I can't say for sure, but it definitely worth thinking about.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8145390, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8976W.jpg?s=128&g=1", "display_name": "hackbell", "link": "https://stackoverflow.com/users/8145390/hackbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1544042724, "creation_date": 1544042724, "answer_id": 53640455, "question_id": 34826824, "link": "https://stackoverflow.com/questions/34826824/testing-functions-that-return-a-maybe-monad/53640455#53640455", "title": "testing functions that return a Maybe Monad", "body": "<p>This code tests a Maybe Monad that returns a \"Just\" value:</p>\n\n<pre><code>     import Test.Tasty\n     import Test.Tasty.HUnit\n     import Data.List         \n\n     main = defaultMain tests\n\n     tests = testGroup \"Tests uncons form Data.List\"\n\n     [testCase \"Show uncons [1,2,3,4] = (1, [2,3,4])\" $\n     Just (1,[2,3,4]) @=? (uncons [1,2,3,4])]\n</code></pre>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1544042724, "creation_date": 1452946561, "question_id": 34826824, "link": "https://stackoverflow.com/questions/34826824/testing-functions-that-return-a-maybe-monad", "title": "testing functions that return a Maybe Monad", "body": "<p>Say I have a function:</p>\n\n<pre><code>safeHead :: [a] -&gt; Maybe a\nsafeHead [] = Nothing\nsafeHead xs = Just $ head xs\n</code></pre>\n\n<p>And a test:</p>\n\n<pre><code>describe \"Example.safeHead\" $ do\n  it \"returns the head\" $ do\n    safeHead [1,2,3] `shouldBe` Just 1\n\n  it \"returns Nothing for an empty list\" $\n    safeHead [] `shouldBe` Nothing\n</code></pre>\n\n<p>This however produces:</p>\n\n<pre><code>No instance for (Eq a0) arising from a use of \u2018shouldBe\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance (Eq a, Eq b) =&gt; Eq (Either a b)\n    -- Defined in \u2018Data.Either\u2019\n  instance forall (k :: BOX) (s :: k). Eq (Data.Proxy.Proxy s)\n    -- Defined in \u2018Data.Proxy\u2019\n  instance (GHC.Arr.Ix i, Eq e) =&gt; Eq (GHC.Arr.Array i e)\n    -- Defined in \u2018GHC.Arr\u2019\n  ...plus 88 others\nIn the second argument of \u2018($)\u2019, namely\n  \u2018safeHead [] `shouldBe` Nothing\u2019\nIn a stmt of a 'do' block:\n  it \"returns Nothing for an empty list\"\n  $ safeHead [] `shouldBe` Nothing\nIn the second argument of \u2018($)\u2019, namely\n  \u2018do { it \"returns the head\"\n        $ do { safeHead [...] `shouldBe` Just 1 };\n        it \"returns Nothing for an empty list\"\n        $ safeHead [] `shouldBe` Nothing }\u2019\n</code></pre>\n\n<p>Why? And how can I fix it?</p>\n"}, {"tags": ["haskell", "c-preprocessor", "ghc", "cabal", "hspec"], "comments": [{"owner": {"reputation": 4864, "user_id": 1376657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae62a1f143f2e5a022a0672f87bf85dd?s=128&d=identicon&r=PG", "display_name": "Nadir Sampaoli", "link": "https://stackoverflow.com/users/1376657/nadir-sampaoli"}, "edited": false, "score": 1, "creation_date": 1452943336, "post_id": 34826018, "comment_id": 57394514, "body": "The suggested way seems to be to use flags (like <a href=\"http://stackoverflow.com/questions/31821952/flags-in-cabal-files\">this question asker</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 4864, "user_id": 1376657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae62a1f143f2e5a022a0672f87bf85dd?s=128&d=identicon&r=PG", "display_name": "Nadir Sampaoli", "link": "https://stackoverflow.com/users/1376657/nadir-sampaoli"}, "edited": false, "score": 1, "creation_date": 1452943210, "post_id": 34826273, "comment_id": 57394478, "body": "Aren&#39;t you doing the opposite of what you wanted, though? <code>#ifndef</code> means &quot;if it&#39;s not defined&quot; so you&#39;re making the function <code>alphabet</code> always public, except when <code>TEST</code> is defined."}], "tags": [], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1452942714, "creation_date": 1452942714, "answer_id": 34826273, "question_id": 34826018, "link": "https://stackoverflow.com/questions/34826018/hspec-failing-to-import-private-code-dependency-despite-cpp-override/34826273#34826273", "title": "hspec failing to import (private) code dependency despite CPP override", "body": "<p>The problem was a simply syntax error. <code>#ifdef</code> is wrong, <code>#ifndef</code> is right</p>\n"}, {"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1452987804, "post_id": 34827409, "comment_id": 57408410, "body": "You&#39;re a rockstar.... I swear you&#39;ve done more for my Haskell in the last 24 hours than hours of blogs/tinkering did in over the past few weeks :) Thank you"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1452950236, "creation_date": 1452950236, "answer_id": 34827409, "question_id": 34826018, "link": "https://stackoverflow.com/questions/34826018/hspec-failing-to-import-private-code-dependency-despite-cpp-override/34827409#34827409", "title": "hspec failing to import (private) code dependency despite CPP override", "body": "<blockquote>\n  <p>Why is my CPP not working as expected? </p>\n</blockquote>\n\n<p>Two-step building. Since your tests depend on the library, it gets build first. The library doesn't have any CPP options set, therefore <code>alphabet</code> doesn't get exported.</p>\n\n<p>When the tests get built, your library is already compiled, and <code>alphabet</code> doesn't get exported. It's a separation of concerns.</p>\n\n<blockquote>\n  <p>How can I fix it?</p>\n</blockquote>\n\n<p>There are several tricks to work with \"hidden\" (e.g. non-exported) functions. For one, you can put them all into a <code>.Internal</code> module. That way, users that want to use the hidden bits can do so rather easily, but the casual user doesn't have too many tools at hand.</p>\n\n<p>Another way to handle this is to drop the dependency in the test and instead add the <code>src</code> directory to the tests:</p>\n\n<pre><code> hs-source-dirs:      tests, src\n</code></pre>\n\n<p>However, this also means that you have to rebuild the whole library for tests, but it will enable using CPP.</p>\n\n<p>A third option is to not test <code>alphabet</code>, but instead the observable behaviour of exported functions that depend on it. So instead of testing <code>alphabet</code>, you would test <code>filterAlpha</code>:</p>\n\n<pre><code>filterAlpha :: String -&gt; String\nfilterAlpha = filter (`elem` alphabet)\n</code></pre>\n\n<p>You have to test <code>filterAlpha</code> anyway. If there are many functions that use <code>alphabet</code>, it is likely that you will have some test that will notice a regression if you accidentally change it.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 34827409, "answer_count": 2, "score": 1, "last_activity_date": 1452950236, "creation_date": 1452941030, "last_edit_date": 1452941966, "question_id": 34826018, "link": "https://stackoverflow.com/questions/34826018/hspec-failing-to-import-private-code-dependency-despite-cpp-override", "title": "hspec failing to import (private) code dependency despite CPP override", "body": "<p>Let's say I have a src file like so:</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\nmodule Alphabet (\n#ifdef TEST\n  alphabet\n#endif\n) where\n  alphabet :: [Char]\n  alphabet = \"abcdefghijklmnopqrstuvwxyz\"\n</code></pre>\n\n<p>a <code>.cabal</code> file like so:</p>\n\n<pre><code>name:                Alphabet\nversion:             0.1.0.0\nlibrary\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9, containers &gt;=0.5 &amp;&amp; &lt;0.6, split &gt;=0.2 &amp;&amp; &lt;0.3\n  hs-source-dirs:      src\n  Exposed-modules:     Alphabet\n  default-language:    Haskell2010\ntest-suite alphabet-test\n  ghc-options:         -Wall -Werror\n  cpp-options:         -DTEST\n  default-extensions:  OverloadedStrings\n  type:                exitcode-stdio-1.0\n  main-is:             Spec.hs\n  hs-source-dirs:      tests\n  build-depends:       Alphabet, base &gt;= 4.8 &amp;&amp; &lt; 4.9, containers &gt;= 0.5 &amp;&amp; &lt;0.6, split &gt;= 0.2 &amp;&amp; &lt; 0.3, hspec, QuickCheck\n  default-language:    Haskell2010\n</code></pre>\n\n<p>A master test file like so:</p>\n\n<pre><code> {-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>and a test file like:</p>\n\n<pre><code>module AphabetSpec (spec) where\n\n  import Test.Hspec\n  import Alphabet (alphabet)\n\n  spec :: Spec\n  spec = do\n    describe \"Alphabet.alphabet\" $ do\n      it \"returns the alphabet\" $ do\n        alphabet `shouldBe` \"abcdefghijklmnopqrstuvwxyz\"\n\nnow running `cabal test`:\ncabal test\nPreprocessing library Alphabet-0.1.0.0...\nIn-place registering Alphabet-0.1.0.0...\nPreprocessing test suite 'alphabet-test' for Alphabet-0.1.0.0...\n[1 of 1] Compiling Main             ( tests/AlphabetSpec.hs, dist/build/alphabet-test/alphabet-test-tmp/AlphabetSpec.o )\n\ntests/AlphabetSpec.hs:4:27:\nModule \u2018Alphabet\u2019 does not export \u2018alphabet\u2019\n</code></pre>\n\n<p>Why is my CPP not working as expected? How can I fix it?</p>\n"}, {"tags": ["haskell", "cabal", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1452937711, "post_id": 34825499, "comment_id": 57393116, "body": "changing hs-source-dirs to src/tests produces the message: cabal: can&#39;t find source for HSpecTests in dist/build/my-tests/my-tests-tmp, src/tests"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1452936950, "creation_date": 1452936950, "answer_id": 34825499, "question_id": 34825465, "link": "https://stackoverflow.com/questions/34825465/cabal-misconfiguration-for-tests/34825499#34825499", "title": "cabal misconfiguration for tests", "body": "<p>Your <code>hs-source-dirs</code> is wrong:</p>\n\n<pre><code> hs-source-dirs:      tests\n</code></pre>\n\n<p>Given that <code>HSpecTests</code>'s path is <code>src/tests/HSpecTests.hs</code>, it should be</p>\n\n<pre><code> hs-source-dirs:      src/tests\n</code></pre>\n\n<p>However, keep in mind that <code>tests</code> are usually in the top-level folder:</p>\n\n<pre><code>MyProject\n     | - src\n          | - Main.hs\n          | - Other.hs\n     | - tests\n          | -HSpecTests.hs\n     | - dist\n     | - MyProj.cabal\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1452939382, "last_edit_date": 1495542159, "creation_date": 1452939382, "answer_id": 34825807, "question_id": 34825465, "link": "https://stackoverflow.com/questions/34825465/cabal-misconfiguration-for-tests/34825807#34825807", "title": "cabal misconfiguration for tests", "body": "<p>There was two things wrong:</p>\n\n<p>1) (thanks to @Zeta for getting me on track with my file structure), the tests needed to be in a tests directory at the root level</p>\n\n<p>2) As documented here: <a href=\"https://stackoverflow.com/questions/23803725/error-while-creating-test-suites-cannot-satisfy-package-id\">Error while creating test suites: &quot;cannot satisfy -package-id&quot;</a> my tests could not depend on an executable and required the creation of a library</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 34825499, "answer_count": 2, "score": 0, "last_activity_date": 1452939382, "creation_date": 1452936624, "last_edit_date": 1452937873, "question_id": 34825465, "link": "https://stackoverflow.com/questions/34825465/cabal-misconfiguration-for-tests", "title": "cabal misconfiguration for tests", "body": "<p>My <code>.cabal</code> file contains the following hspec configuration:</p>\n\n<pre><code>-- The name of the package.\nname:                MyModule\n\nversion:             0.1.0.0\n\ncabal-version:       &gt;=1.10\n...\ntest-suite my-tests\n  ghc-options:         -Wall -Werror\n  cpp-options:         -DTEST\n  default-extensions:  OverloadedStrings\n  type:                exitcode-stdio-1.0\n  main-is:             HSpecTests.hs\n  hs-source-dirs:      tests\n  build-depends:       MyModule, base &gt;= 4.8 &amp;&amp; &lt; 4.9, containers &gt;= 0.5 &amp;&amp; &lt;0.6, split &gt;= 0.2 &amp;&amp; &lt; 0.3, hspec\n  default-language:    Haskell2010\n</code></pre>\n\n<p>My directory structure is as follows:</p>\n\n<pre><code>MyProject\n     | - src\n          | - Main.hs\n          | - Other.hs\n          | - tests\n             | -HSpecTests.hs\n     | - dist\n     | - MyProj.cabal\n</code></pre>\n\n<p>when I run <code>cabal build</code>, my source build succesfully to an executable <code>./dist/build/myproj/myproj</code>.</p>\n\n<p><code>cabal build</code> then fails with:</p>\n\n<pre><code>cabal: can't find source for HSpecTests in\ndist/build/my-tests/my-tests-tmp, tests\n</code></pre>\n\n<p>Inspecting the <code>build</code> directory shows that the <code>my-tests</code> directory is missing.</p>\n\n<p>changing the <code>hs-source-dirs</code> to <code>src/tests</code>\nproduces:</p>\n\n<pre><code>cabal: can't find source for HSpecTests in \ndist/build/my-tests/my-tests-tmp, src/tests\n</code></pre>\n\n<p>While moving all tests to the top level under root/tests, and changing the <code>.cabal</code> file to <code>hs-source-dirs:  tests</code> produces:</p>\n\n<pre><code>&lt;command line&gt;: cannot satisfy -package-id MyModule-0.1.0.0-inplace\n    (use -v for more information)\n</code></pre>\n\n<p>How have I misconfigured this?</p>\n"}, {"tags": ["c", "haskell", "linker-errors", "ghc", "ffi"], "comments": [{"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1453333088, "post_id": 34823628, "comment_id": 57561021, "body": "GHC bug for this: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11201#comment:3\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/11201#comment:3</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "is_accepted": true, "score": 4, "last_activity_date": 1452931133, "creation_date": 1452931133, "answer_id": 34824824, "question_id": 34823628, "link": "https://stackoverflow.com/questions/34823628/calling-haskell-from-c-getting-multiple-definition-of-main-linker-error/34824824#34824824", "title": "Calling Haskell from C, getting &quot;multiple definition of main&quot; linker error", "body": "<p>I did the following:</p>\n\n<ol>\n<li>renamed inc.c to inc_main.c because having C object file inc.o might overlap with haskell object</li>\n<li>run <code>ghc -c -no-hs-main Inc.hs -o Inc.o</code></li>\n<li>Produce C object file by <code>gcc -O -Wall -I/usr/lib/ghc/include -c inc_main.c</code></li>\n<li>Link to an executable with <code>ghc -no-hs-main Inc.o inc_main.o -o simplest</code> </li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 4, "last_activity_date": 1452936995, "creation_date": 1452936995, "answer_id": 34825506, "question_id": 34823628, "link": "https://stackoverflow.com/questions/34823628/calling-haskell-from-c-getting-multiple-definition-of-main-linker-error/34825506#34825506", "title": "Calling Haskell from C, getting &quot;multiple definition of main&quot; linker error", "body": "<p>This is just explanation of what's going on, see @Hakala's answer for the solution.</p>\n\n<p>The problem is that on Windows file names are case insensitive.<br>\nWhen you are executing </p>\n\n<pre><code>$ ghc -no-hs-main inc.c Inc -o simplest\n</code></pre>\n\n<p>GHC calls GCC to compile <code>inc.c</code> into object file <code>inc.o</code>. But on Windows it also overwrites <code>Inc.o</code> generated by <code>ghc -c Inc.hs</code>. So, it is actually the same as executing</p>\n\n<pre><code>$ ghc -no-hs-main inc.c inc.o -o simplest\n</code></pre>\n\n<p>And linking <code>inc.o</code> twice will obviously result in \"multiple definition\" error.</p>\n"}], "owner": {"reputation": 75, "user_id": 4805052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o5nge.jpg?s=128&g=1", "display_name": "Benjamin Figueiredo", "link": "https://stackoverflow.com/users/4805052/benjamin-figueiredo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "accepted_answer_id": 34824824, "answer_count": 2, "score": 4, "last_activity_date": 1452936995, "creation_date": 1452919835, "question_id": 34823628, "link": "https://stackoverflow.com/questions/34823628/calling-haskell-from-c-getting-multiple-definition-of-main-linker-error", "title": "Calling Haskell from C, getting &quot;multiple definition of main&quot; linker error", "body": "<p>I am trying to learn how to interface Haskell and C. To start it out, I wrote <code>Inc.hs</code>, the simplest thing I can conceive:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Inc where\n\nimport Foreign\nimport Foreign.C.Types\n\ninc :: Int -&gt; Int\ninc = (+1)\n\nforeign export ccall cinc :: CInt -&gt; CInt\ncinc :: CInt -&gt; CInt\ncinc = fromIntegral . inc . fromIntegral\n</code></pre>\n\n<p>And compiled it to produce <code>Inc_stub.h</code>:</p>\n\n<pre><code>ghc -c Inc.hs\n</code></pre>\n\n<p>Worked fine. I then wrote the C file, also trying to be as simple as humanly possible:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"Inc_stub.h\"\n\nint main(int argc, char *argv[]) {\n    int a = 1;\n    hs_init(&amp;argc, &amp;argv);\n\n    a = cinc(a);\n\n    hs_exit();\n    if (a == 2) {\n        puts(\"Worked!\");\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>Tried to compile it, got this linker error:</p>\n\n<pre><code>ghc -no-hs-main inc.c Inc -o simplest\nLinking simplest.exe ...\ninc.o:inc.c:(.text+0x0): multiple definition of `main'\nInc.o:inc.c:(.text+0x0): first defined here\nInc.o:inc.c:(.text+0x31): undefined reference to `cinc'\nc:/program files/haskell platform/7.10.2-a/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: Inc.o: bad reloc address 0x0 in section `.pdata'\ncollect2: ld returned 1 exit status\n</code></pre>\n\n<p>Everything was compiled using GHC 7.10.2 on Windows 10 64-bit.</p>\n"}, {"tags": ["haskell", "yesod", "parse-error"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1452902016, "post_id": 34820878, "comment_id": 57386100, "body": "it&#39;s just a wild guess - but have you tried indenting the 11th line (<code>&#47; HomeR GET</code>) by at least 2 spaces - or putting the <code>mkYesod</code> until <code>|]</code> in one line?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452902919, "post_id": 34820878, "comment_id": 57386381, "body": "Just guessing: try using <code>[parseRoutes|</code> instead of <code>[parseRoutes |</code> (no space) ?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1452909023, "creation_date": 1452909023, "answer_id": 34822675, "question_id": 34820878, "link": "https://stackoverflow.com/questions/34820878/basic-yesod-hello-world-giving-me-parse-error/34822675#34822675", "title": "Basic Yesod Hello World! giving me parse error", "body": "<p>I got your file to load (with warnings) by deleting the spaces before the pipes in the quasiquoter lines, so <code>[parseRoutes|</code> instead of <code>[parseRoutes |</code> and <code>[whamlet|</code> instead of <code>[whamlet |</code>.</p>\n"}], "owner": {"reputation": 137, "user_id": 5486662, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/isNIe.jpg?s=128&g=1", "display_name": "GuitarGuy365", "link": "https://stackoverflow.com/users/5486662/guitarguy365"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 34822675, "answer_count": 1, "score": 0, "last_activity_date": 1452909023, "creation_date": 1452896544, "last_edit_date": 1452897101, "question_id": 34820878, "link": "https://stackoverflow.com/questions/34820878/basic-yesod-hello-world-giving-me-parse-error", "title": "Basic Yesod Hello World! giving me parse error", "body": "<p>I am beginning to learn Yesod through the book Developing Web Applications with Haskell and Yesod. The first thing the book has you do after installing a few requirements is write a <code>Hello World!</code> Despite copying the program verbatim from the book, I am getting a parse error. As a bit of background, I have no experience in web development, and my knowledge of Haskell is pretty much contained to Learn You a Haskell, so I am quite lost.</p>\n\n<p>Here is the said code: </p>\n\n<pre><code>-- hello world with Yesod\n\n{-# LANGUAGE TemplateHaskell, TypeFamilies, QuasiQuotes, MultiParamTypeClasses,\n    OverloadedStrings #-}\n\nimport Yesod\n\ndata HelloWorld = HelloWorld\n\nmkYesod \"HelloWorld\" [parseRoutes |\n/ HomeR GET\n|]\n\ninstance Yesod HelloWorld\n\ngetHomeR :: Handler RepHtml\ngetHomeR = defaultLayout [whamlet | Hello World! |]\n\nmain :: IO()\nmain = warpDebug 3000 HelloWorld\n</code></pre>\n\n<p>The compiler is telling me this:</p>\n\n<pre><code>C:\\Haskell\\Yesod&gt;runhaskell helloWorld.hs\n\nhelloWorld.hs:11:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n"}, {"tags": ["haskell", "lisp", "symbols"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452892077, "post_id": 34819740, "comment_id": 57382103, "body": "Can you write the code using something like <code>ByteString</code> as your symbol type and then explain what you want to be different?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1452892119, "post_id": 34819740, "comment_id": 57382121, "body": "Why not make it polymorphic and let the user decide what a symbol looks like? Make an instance of <a href=\"http://hackage.haskell.org/package/these-0.6.1.0/docs/Data-Align.html\" rel=\"nofollow noreferrer\">Align</a> for <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Tree.html\" rel=\"nofollow noreferrer\">Tree</a>, for example, seems like pretty much exactly what you want."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 1, "creation_date": 1452914499, "post_id": 34819740, "comment_id": 57388709, "body": "After hacking at it for over an hour, I discovered that <code>Align</code> isn&#39;t actually what you need :)"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1452949212, "post_id": 34819740, "comment_id": 57396198, "body": "You cannot describe many nested lists of arbitrary depth as a list in Haskell since list in Haskell is homogenous. The corresponding data structure is a rose tree having values only on leaf nodes, i.e. <code>data RoseTree a = Leaf a | Forest [RoseTree a]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1452955234, "post_id": 34828206, "comment_id": 57398020, "body": "Note the <code>Tree a</code> and <code>Map k v</code> are from the <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a> package"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1452955142, "creation_date": 1452955142, "answer_id": 34828206, "question_id": 34819740, "link": "https://stackoverflow.com/questions/34819740/haskell-lisp-like-symbol-functionality/34828206#34828206", "title": "Haskell - Lisp-like symbol functionality", "body": "<p>I don't have much knowledge about lisp so I don't know if you are setting variables or creating an associative array.</p>\n\n<p>You could do something like - to set variables:</p>\n\n<pre><code>Main Data.Tree&gt; let (Node a ((Node b []):c:[])) = Node 'a' [Node 'b' [],Node 'c' []]\n*Main Data.Tree&gt; a\n'a'\n*Main Data.Tree&gt; b\n'b'\n*Main Data.Tree&gt; c\nNode {rootLabel = 'c', subForest = []}\n</code></pre>\n\n<p>But honestly <strong>I wouldn't recommend it</strong> - matching on lists is very unsafe and as far as my knowledge is concerned I don't know about a \"safe\" pattern matching that would result in a <code>Maybe x</code>.</p>\n\n<p>If you want to have an associative array, you can use a function like this</p>\n\n<pre><code>aux :: Ord k =&gt; Tree k -&gt; Tree v -&gt; Map k v\naux a b = fromList (go a b)\n  where go :: Tree k -&gt; Tree v -&gt; [(k,v)]\n        go (Node k kk) (Node v vv) = (k,v):(concat $ zipWith go kk vv)\n</code></pre>\n\n<p><strong>Note:</strong> this function only works if those trees have the same structure</p>\n\n<pre><code>atree = Node 'a' [Node 'b' [],Node 'c' []]\nbtree = Node 1 [Node 2 [],Node 3 []]\nctree = Node 1 [Node 2 [],Node 3 [], Node 4 []]\n\nGHCi&gt; aux atree btree\n fromList [('a','1'),('b','2'),('c','3')]\nGHCi&gt; aux atree ctree\n fromList [('a','1'),('b','2'),('c','3')]\n</code></pre>\n\n<p>So you see this function cuts the <code>Node 4 []</code> off.</p>\n"}, {"tags": [], "owner": {"reputation": 6787, "user_id": 549641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c97f3ebc820da8f94f4495a7ba8dc9b6?s=128&d=identicon&r=PG", "display_name": "jmg", "link": "https://stackoverflow.com/users/549641/jmg"}, "is_accepted": false, "score": 0, "last_activity_date": 1452977915, "creation_date": 1452977915, "answer_id": 34832060, "question_id": 34819740, "link": "https://stackoverflow.com/questions/34819740/haskell-lisp-like-symbol-functionality/34832060#34832060", "title": "Haskell - Lisp-like symbol functionality", "body": "<p>As others have already noted, Haskell is strictly typed. Therefore lists cannot hold arbitrary list structures without reflecting it in the type. Until you have clarified that, I'll go with the most simple case. Let's assume we have the following</p>\n\n<pre><code>a :: [String]\na = [\"a\", \"b\", \"c\"]\nb :: [Integer]\nb = [1, 2, 3]\n\nmatch = zip\nmatch a b == [(\"a\",1),(\"b\",2),(\"c\",3)]\n</code></pre>\n\n<p>Depending on which type you would actually like to use, have a look at the usually provided zip function.</p>\n"}], "owner": {"reputation": 129, "user_id": 5198356, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/ba4271f1b82eccb039694cb6e83beac2?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfe Macfarlane", "link": "https://stackoverflow.com/users/5198356/wolfe-macfarlane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1452977915, "creation_date": 1452891449, "question_id": 34819740, "link": "https://stackoverflow.com/questions/34819740/haskell-lisp-like-symbol-functionality", "title": "Haskell - Lisp-like symbol functionality", "body": "<p>I wrote a LISP function a while back that matched nested lists of symbols against other lists. It worked something like this:</p>\n\n<pre><code>(match '(a b c) '(1 2 3))\n  =&gt; ((a 1) (b 2) (c 3))\n(match '(a b (c d)) '(1 (2 3) (4 5)))\n  =&gt; ((a 1) (b (2 3)) (c 4) (d 5))\n</code></pre>\n\n<p>I am now trying to achieve a similar functionality in Haskell. What I am looking for is something that allows readable symbols to be used in indexing the results. I could use integers, but the lists involved tended to get a bit unreadable like that. Is there an easy symbol like type in Haskell?</p>\n\n<p>I have come across Data.Atom.Simple, I just want something that is less awkward than that.</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 0, "creation_date": 1452882250, "post_id": 34817300, "comment_id": 57376900, "body": "You were right about the [a:b:[]] issue, but I still receive the same error.   Furthermore, your cleaner implementation compiles, but is it the same thing? Wouldn&#39;t 1 be interpreted as the value 1 and not some list of some size?"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 0, "creation_date": 1452882361, "post_id": 34817300, "comment_id": 57376959, "body": "@Rade I found another problem with your implementation; I&#39;ll update the answer soon."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 1, "creation_date": 1452882587, "post_id": 34817300, "comment_id": 57377078, "body": "@Rade by the way, it is not &quot;1&quot;, it is small letter &quot;L&quot;. I changed it to prevent further confusion."}, {"owner": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 0, "creation_date": 1452882976, "post_id": 34817300, "comment_id": 57377272, "body": "Oops, my mistake there! I run into this issue when using it tho:  <code>No instance for (Num int) arising from the literal &#39;0&#39;</code>. Any idea what I&#39;m doing wrong? I&#39;m trying to simpy say <code>sum = listsum [1..10]</code>"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 1, "creation_date": 1452883934, "post_id": 34817300, "comment_id": 57377797, "body": "@Rade Oh, I didn&#39;t notice that, sorry. In Haskell, type names begin with capital latters, while <code>int</code> is treated as a <i>type variable</i>; it&#39;s name really has almost no meaning. When we use <code>(+)</code> operator on objects of variable type <code>int</code>, Haskell expects <code>int</code> to be an instance of class <code>Num</code>, where <code>(+)</code> is defined, but <code>int</code> has no constraints in the function signature. You can simply change <code>int</code> to <code>Int</code>, where the latter is the standard Haskell integer type. Alternatively, you can change the signature to <code>listsum :: (Num a) =&gt; [a] -&gt; a</code> and learn about polymorphic functions and typeclasses."}, {"owner": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 1, "creation_date": 1452884577, "post_id": 34817300, "comment_id": 57378153, "body": "Thank you so very much, this is exactly the explanation I needed to understand. Thank you very much for all of your help!"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "edited": false, "score": 0, "creation_date": 1452884819, "post_id": 34817300, "comment_id": 57378280, "body": "@Rade I&#39;m happy to be of service."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 5, "last_activity_date": 1452882555, "last_edit_date": 1452882555, "creation_date": 1452881846, "answer_id": 34817300, "question_id": 34817219, "link": "https://stackoverflow.com/questions/34817219/haskell-recursive-list-summation/34817300#34817300", "title": "Haskell Recursive List Summation", "body": "<pre><code>listsum [a:b:[]] = a + b\n</code></pre>\n\n<p>Here, <code>a:b:[]</code> means the list <code>[a, b]</code>, so <code>[a:b:[]]</code> means <code>[[a, b]]</code>, which is not what you want.</p>\n\n<p>Simply change this to</p>\n\n<pre><code>listsum (a:b:[]) = a + b\n</code></pre>\n\n<p>Now, in</p>\n\n<pre><code>listsum x = head x + listsum tail x\n</code></pre>\n\n<p>the part <code>listsum tail x</code> means <em>apply <code>listsum</code> to <code>tail</code>, and then apply the result to <code>x</code></em>. I suppose you meant <em>apply <code>tail</code> to <code>x</code> and then apply <code>listsum</code> to the result</em>, which can be expressed as <code>listsum (tail x)</code>.</p>\n\n<hr>\n\n<p>I suggest a bit cleaner implementation, which assumes that summing empty list yields zero.</p>\n\n<pre><code>listsum [] = 0\nlistsum (x:t) = x + listsum t\n</code></pre>\n\n<p>This differs in functionality from your implementation, since it handles lists with zero or one element correctly.</p>\n"}], "owner": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3816, "favorite_count": 0, "accepted_answer_id": 34817300, "answer_count": 1, "score": 1, "last_activity_date": 1452882555, "creation_date": 1452881518, "question_id": 34817219, "link": "https://stackoverflow.com/questions/34817219/haskell-recursive-list-summation", "title": "Haskell Recursive List Summation", "body": "<p>I'm new to functional programming and haskell, so I'm just starting out learning both by attempting some Euler problems. This involves a great deal of list summations.</p>\n\n<p>So I'm trying to write a recursive list summation function that takes one list as input and returns an integer as output, for instance:</p>\n\n<pre><code>-- Sum up a list\nlistsum :: [int] -&gt; int\nlistsum [a:b:[]] = a + b\nlistsum x = head x + listsum tail x\n</code></pre>\n\n<p>When compiling this code, I receive this error: </p>\n\n<pre><code>Couldn't match expected type `[[int] -&gt; int]'\n            with actual type `[a0] -&gt; [a0]'\nRelevant bindings include\n  x :: [int]\n    (bound at C:\\Users\\Rade\\Documents\\GitHub\\haskell\\euler_2.hs:15:9)\n  listsum :: [int] -&gt; int\n    (bound at C:\\Users\\Rade\\Documents\\GitHub\\haskell\\euler_2.hs:14:1)\nProbable cause: `tail' is applied to too few arguments\nIn the first argument of `listsum', namely `tail'\nIn the second argument of `(+)', namely `listsum tail x'\n</code></pre>\n\n<p>I've tried to research the pattern matching, but I cannot understand what it means with expected type versus actual type. Where am I going wrong?</p>\n"}, {"tags": ["haskell", "reflection", "types", "metaprogramming", "type-constraints"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452889159, "post_id": 34817085, "comment_id": 57380625, "body": "Are you willing to have <code>usingIF</code> return a different type? Perhaps instead of working with <i>any</i> <code>b</code> it can only work with your expression type, and then you add a class constraint like <code>.. (forall s1 s2 . NotOccurs &#39;[ s1, s2 ] r) =&gt; Proxy s1 -&gt; Proxy s2 -&gt; Rel (Var s1) (Var s2) =&gt; r) ..</code> - then the <code>NotOccurs</code> class takes care of name supply by taking an existing expression and computing free names for that expression."}], "answers": [{"comments": [{"owner": {"reputation": 425, "user_id": 132318, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f9025aa7a0566a5063b1cad85771fa?s=128&d=identicon&r=PG", "display_name": "Owen", "link": "https://stackoverflow.com/users/132318/owen"}, "edited": false, "score": 0, "creation_date": 1453081273, "post_id": 34837141, "comment_id": 57432524, "body": "This is helpful, thank you! I ended up trying something sort of similar to this, actually. Opening an existential did seem to do the trick.  To preserve the association between v1 and p etc, I ended up refactoring so that I&#39;m passing around a pair with a value and a singleton type (instead of a Proxy).  This lets me move easily between the static and dynamic world and build up more complex relationships between the type variables."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 2, "last_activity_date": 1453025213, "creation_date": 1453025213, "answer_id": 34837141, "question_id": 34817085, "link": "https://stackoverflow.com/questions/34817085/creating-instances-of-a-type-class-based-on-runtime-comparisons-in-haskell/34837141#34837141", "title": "Creating instances of a type class based on runtime comparisons in Haskell", "body": "<p>A possible trick is to hook in to the generativity that already exists in the type system.</p>\n\n<p>The following function is ill-typed:</p>\n\n<pre><code>f :: a -&gt; b -&gt; a\nf x y = x `asTypeOf` y\n</code></pre>\n\n<p>Even though <code>b</code> might actually be the same as <code>a</code> in some instantiation, since it also may not, <code>a</code> and <code>b</code> are treated as different types.  Particularly for higher rank types, the way this is implemented is that the compiler makes up a type on the fly for each quantified type variable, so <code>x :: Fresh_a</code> and <code>y :: Fresh_b</code>.  These <code>Fresh_a</code>s are the \"rigid\" variables the compiler complains about.  Essentially, the dual thing happens when opening an existential.  In fact, I'll use an existential since it seems a bit clearer and more explicit.</p>\n\n<pre><code>-- Needs ExistentialQuantification and PolyKinds, but the same effect\n-- could be accomplished without either.\ndata Gen = forall (n :: k). Gen (Proxy n)\ngen = Gen Proxy -- Probably need to turn off the monomorphism restriction\n\nusingIf :: t -&gt; t\n        -&gt; (forall s1 s2 . Proxy s1 -&gt; Proxy s2 -&gt; Rel (Var s1) (Var s2) =&gt; b)\n        -&gt; b \n        -&gt; b\nusingIf v1 v2 ifTrue ifFalse = \n    if cmp v1 v2 then\n      case gen of Gen p -&gt; -- the compiler has forgotten what went in to gen so it must\n          case gen of Gen q -&gt; -- assume p and q have types distinct from everything\n              using (Def Rel (DVar p) (DVar q)) (ifTrue p q)\n    else \n      ifFalse\n</code></pre>\n\n<p>I don't have your code so I have no idea if this will actually work for you, but it is how I would start attacking it.  You may need to massage it a little.</p>\n"}], "owner": {"reputation": 425, "user_id": 132318, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f9025aa7a0566a5063b1cad85771fa?s=128&d=identicon&r=PG", "display_name": "Owen", "link": "https://stackoverflow.com/users/132318/owen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 34837141, "answer_count": 1, "score": 3, "last_activity_date": 1453025213, "creation_date": 1452881000, "last_edit_date": 1452886144, "question_id": 34817085, "link": "https://stackoverflow.com/questions/34817085/creating-instances-of-a-type-class-based-on-runtime-comparisons-in-haskell", "title": "Creating instances of a type class based on runtime comparisons in Haskell", "body": "<p>Following the technique described <a href=\"https://www.schoolofhaskell.com/user/thoughtpolice/using-reflection\" rel=\"nofollow\">here</a>,\nI've been using the <code>constraints</code> and <code>reflection</code> packages to \ncreate local instances of a type class <code>Rel</code> that represents (at the type level) a relation on values of type <code>t</code>.</p>\n\n<p>Now I would to create instances based on comparisons of runtime values, allowing code that requires those comparisons to hold at runtime to express that requirement as a constraint where the values are represented by some kind of type-level 'variable'.  I can \"sort of\" accomplish this with the following code. </p>\n\n<pre><code>usingIf :: t -&gt; t -- Two values of type t to compare \n           -&gt; (forall s1 s2 . Proxy s1 -&gt; Proxy s2 -&gt; Rel (Var s1) (Var s2) =&gt; b) \n              -- ^ Then branch: a term with a constraint that requires \n              --   two type-level \"variables\" to be in a relation 'Rel'\n           -&gt; b -- Else branch: the term to evaluate if the values (of type t) are \n                --   not in the relation \n           -&gt; b\nusingIf v1 v2 ifTrue ifFalse = \n    if cmp v1 v2 then\n      using (Def Rel (DVar (Proxy :: Proxy 0)) (DVar (Proxy :: Proxy 1)))\n                 (ifTrue (Proxy :: Proxy 0) (Proxy :: Proxy 1))\n    else \n      ifFalse\n</code></pre>\n\n<p>This code takes two <code>t</code> values, v1 and v2, and compares them. If <code>cmp</code> returns true, then an instance, <code>Def Rel ...</code>, of the type class Rel is created to represent the fact that these values are in the relation, where v1 and v2 are represented at the type level by two variables with id 0 and 1. </p>\n\n<p>This code compiles and runs as I would expect (in my project), but the problem is that the ids of the variables will not be unique if multiple <code>usingIf</code> applications are composed.  What I really need is, for instance, a way of tracking how many instances have been added to the Rel dictionary or something equivalent to that so that I can create fresh ids for each Var.  </p>\n\n<p>Any suggestions on how I could tackle this problem? I'd prefer not to use Template Haskell, but am willing to if that's the only/cleanest option.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "haskell-platform"], "comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 2, "creation_date": 1452854131, "post_id": 34809109, "comment_id": 57360313, "body": "Seems that file names are case sensitive on your OS. Try to rename <code>Project.Cabal</code> to <code>Project.cabal</code>."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "reply_to_user": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1452880241, "post_id": 34809109, "comment_id": 57375963, "body": "Thank you! If you write it up as answer, I will accept"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1452856513, "creation_date": 1452856513, "answer_id": 34809828, "question_id": 34809109, "link": "https://stackoverflow.com/questions/34809109/fails-to-find-cabal-file-when-file-present/34809828#34809828", "title": "fails to find cabal file when file present", "body": "<p>There's already a hint in the error message:</p>\n\n<blockquote>\n<pre><code>cabal: No cabal file found.\nPlease create a package description file &lt;pkgname&gt;.cabal\n</code></pre>\n</blockquote>\n\n<p>Cabal <a href=\"https://hackage.haskell.org/package/Cabal-1.22.6.0/docs/Distribution-Simple-Utils.html#v:findPackageDesc\" rel=\"nofollow\">only looks for <code>.cabal</code> files</a>, not <code>.Cabal</code>. Change the extension of your <code>Project.Cabal</code> to the lowercase one.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1911, "favorite_count": 0, "accepted_answer_id": 34809828, "answer_count": 1, "score": 0, "last_activity_date": 1452856513, "creation_date": 1452853962, "question_id": 34809109, "link": "https://stackoverflow.com/questions/34809109/fails-to-find-cabal-file-when-file-present", "title": "fails to find cabal file when file present", "body": "<p>I have the following directory structure:\n<code>ls</code>: </p>\n\n<pre><code>  Project.Cabal\n  LICENSE\n  Setup.hs\n  cabal.sandbox.config\n  dist\n  src\n     Main.hs\n     otherstuff\n  tests\n</code></pre>\n\n<p>running <code>cabal install --only-denendencies</code> produces:\n  cabal: Error reading local package.\n  Couldn't find .cabal file in: .</p>\n\n<p>running <code>cabal install -v3 --only-dependencies</code> produces relatively lengthy output that I'm currently choosing not to post in full to avoid being immediatly overwhelming. The final few lines before error are:</p>\n\n<pre><code>The package database already exists:\n/Users/abraham/github/hamming_distance/.cabal-sandbox/x86_64-osx-ghc-7.10.2-packages.conf.d\nReading available packages...\nReading installed packages...\n(\"/usr/bin/ghc-pkg\",[\"dump\",\"--package-db=/Users/abraham/github/hamming_distance/.cabal-sandbox/x86_64-osx-ghc-7.10.2-packages.conf.d\",\"-v0\"])\n(\"/usr/bin/ghc\",[\"--print-libdir\"])\nFound no modified add-source deps.\nReading installed packages...\n(\"/usr/bin/ghc-pkg\",[\"dump\",\"--global\",\"-v0\"])\n(\"/usr/bin/ghc-pkg\",[\"dump\",\"--package-db=/Users/abraham/github/hamming_distance/.cabal-sandbox/x86_64-osx-ghc-7.10.2-packages.conf.d\",\"-v0\"])\n(\"/usr/bin/ghc\",[\"--print-libdir\"])\nReading available packages...\ncabal: Error reading local package.\nCouldn't find .cabal file in: .\n</code></pre>\n\n<p>Similiarly, running <code>cabal build</code> produces:</p>\n\n<pre><code>Package has never been configured. Configuring with default flags. If this\nfails, please run configure manually.\ncabal: No cabal file found.\nPlease create a package description file &lt;pkgname&gt;.cabal\n\nWhile running `cabal build -v3` produces:\n..\n..\n..\nThe package database already exists:\n/Users/abraham/github/hamming_distance/.cabal-sandbox/x86_64-osx-ghc-7.10.2-packages.conf.d\nReading installed packages...\n(\"/usr/bin/ghc-pkg\",[\"dump\",\"--global\",\"-v0\"])\n(\"/usr/bin/ghc-pkg\",[\"dump\",\"--package-db=/Users/abraham/github/hamming_distance/.cabal-sandbox/x86_64-osx-ghc-7.10.2-packages.conf.d\",\"-v0\"])\n(\"/usr/bin/ghc\",[\"--print-libdir\"])\nReading available packages...\ncabal: No cabal file found.\nPlease create a package description file &lt;pkgname&gt;.cabal\n</code></pre>\n\n<p>What is going on? Why is my cabal failing? And how do I fix it?</p>\n"}, {"tags": ["templates", "haskell", "yesod", "hamlet", "shakespeare-text"], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 8, "last_activity_date": 1452946392, "last_edit_date": 1452946392, "creation_date": 1452941662, "answer_id": 34826114, "question_id": 34806347, "link": "https://stackoverflow.com/questions/34806347/what-is-the-comment-syntax-in-yesod-hamlet-templates/34826114#34826114", "title": "What is the comment syntax in Yesod (hamlet) templates?", "body": "<p>In the latest version the line comment starts with <code>$#</code>, also ordinary html comment delimited by <code>&lt;!--</code> and <code>--&gt;</code> is available. Check it in the <a href=\"https://github.com/yesodweb/shakespeare/blob/cddb06487220c0fae5fa9176d244391f45226f0b/Text/Hamlet/Parse.hs#L157\" rel=\"noreferrer\">source file</a>.</p>\n"}], "owner": {"reputation": 833, "user_id": 961601, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/9645eb192426d3088a9fccec467f7a21?s=128&d=identicon&r=PG", "display_name": "s9gf4ult", "link": "https://stackoverflow.com/users/961601/s9gf4ult"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 2, "accepted_answer_id": 34826114, "answer_count": 1, "score": 12, "last_activity_date": 1452946392, "creation_date": 1452843721, "question_id": 34806347, "link": "https://stackoverflow.com/questions/34806347/what-is-the-comment-syntax-in-yesod-hamlet-templates", "title": "What is the comment syntax in Yesod (hamlet) templates?", "body": "<p>I just can not find how to comment line in hamlet template. Is there some syntax for comments? Like</p>\n\n<pre><code>-- &lt;p&gt;Some code should be ignored by template\n</code></pre>\n\n<p>or something?</p>\n"}, {"tags": ["haskell", "substring"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1452840786, "post_id": 34805138, "comment_id": 57353819, "body": "Although the other question doesn&#39;t show effort, it contains an excellent answer that pretty much explains everything. By the way, is there currently a Haskell course going on, or why do both you and @Chris need that particular code?"}, {"owner": {"reputation": 97, "user_id": 5184122, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1050059711694160/picture?type=large", "display_name": "ajanakos", "link": "https://stackoverflow.com/users/5184122/ajanakos"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452842709, "post_id": 34805138, "comment_id": 57354553, "body": "Yes, Comparative Programming Languages course at UC Santa Cruz. Also I would have loved to get help with my solution as it is different and I don&#39;t think we are supposed to use packages..oh well"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452845701, "post_id": 34805138, "comment_id": 57355736, "body": "@ajanakos thanks for being honest! While I have no problem with you asking questions (maybe not the same over and over again - use the search ;) ) - wouldn&#39;t it be better if you would all come together and learn in real life? I know I am getting old but in my days this was where it made <i>click</i> for most students (that or the tutorials on campus)"}, {"owner": {"reputation": 97, "user_id": 5184122, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1050059711694160/picture?type=large", "display_name": "ajanakos", "link": "https://stackoverflow.com/users/5184122/ajanakos"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452845834, "post_id": 34805138, "comment_id": 57355795, "body": "@Carsten Yes...heading to lab section tomorrow haha :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452846130, "post_id": 34805138, "comment_id": 57355940, "body": "Yeah I guess it&#39;s not easy when you struggle with the syntax and the concepts and IMO the Haskell community on this side does a great job in helping students out but the format here is not a good fit for tutor situations where you would want an iterative approach instead of the full answer up front - that&#39;s why I always learned a lot more in 3-4 person study groups - especially if there was no &quot;know-all&quot; around"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452855443, "post_id": 34805138, "comment_id": 57361019, "body": "@ajanakos: The other answer by leftroundabout isn&#39;t using packages, since <code>Data.Char.isNumber</code> is part of base. However, you can write <code>isNumber :: Char -&gt; Bool</code> yourself, it&#39;s a small, valuable exercise. By the way, if your text only contains <code>[</code> and <code>]</code> for references, you don&#39;t even have to parse numbers\u2026"}, {"owner": {"reputation": 97, "user_id": 5184122, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1050059711694160/picture?type=large", "display_name": "ajanakos", "link": "https://stackoverflow.com/users/5184122/ajanakos"}, "edited": false, "score": 0, "creation_date": 1452879133, "post_id": 34805138, "comment_id": 57375407, "body": "True. Thanks for all the help!"}], "owner": {"reputation": 97, "user_id": 5184122, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1050059711694160/picture?type=large", "display_name": "ajanakos", "link": "https://stackoverflow.com/users/5184122/ajanakos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1452840663, "answer_count": 0, "score": 1, "last_activity_date": 1452854227, "creation_date": 1452837407, "last_edit_date": 1452854227, "question_id": 34805138, "link": "https://stackoverflow.com/questions/34805138/haskell-counting-substring", "closed_reason": "Duplicate", "title": "Haskell + counting substring", "body": "<p>I am very close to getting this but I still got stuck :/</p>\n\n<pre><code>txt :: String\ntxt = \"[1] and [2] both feature characters who will do whatever it takes to \" ++\n  \"get to their goal, and in the end the thing they want the most ends \" ++\n  \"up destroying them.  In case of [3] this is a whale...\"\nreferences :: String -&gt; Int\n\nsplit :: String -&gt; [String]\nsplit str = words str\n\nfind :: [String] -&gt; [String]\nfind xs = [ x | x &lt;- xs, x == \"[\"++\"1\"++\"]\" ]                           \nreferences x = length (find (split x ))\n</code></pre>\n\n<p>I need to find the times <code>[n]</code> occurs in a string where <code>n</code> is an number <code>0</code> to whatever.</p>\n\n<p>In the example above <code>n = 3</code>.</p>\n\n<p>I cannot seem to write a predicate to catch all numbers represented as a string enclosed by brackets <code>\"[1]\"</code> or <code>\"[3]\"</code>.\n(I hard coded 1 in my code here)</p>\n"}, {"tags": ["algorithm", "haskell", "knuth-morris-pratt"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1452812780, "post_id": 34801061, "comment_id": 57346124, "body": "Instead of trying to fix it right away, try to really understand what is happening.  Testing individual helper functions and using <code>Debug.Trace</code> are your friends when things don&#39;t work how you expect."}, {"owner": {"reputation": 330, "user_id": 5021764, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dc1f8d5f08ef935d1f2a51db7cf02144?s=128&d=identicon&r=PG&f=1", "display_name": "the spectre", "link": "https://stackoverflow.com/users/5021764/the-spectre"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1452813471, "post_id": 34801061, "comment_id": 57346417, "body": "I did that. That&#39;s why I think the problem lies with the length of the pattern vs. length of string.  Maybe I&#39;m misunderstanding, but the table T at T[i] contains the length of the partial match on the pattern at i, so if I put T[i] in the place of i, i will sometimes be the length of the pattern, so I overshoot the length."}], "answers": [{"tags": [], "owner": {"reputation": 330, "user_id": 5021764, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dc1f8d5f08ef935d1f2a51db7cf02144?s=128&d=identicon&r=PG&f=1", "display_name": "the spectre", "link": "https://stackoverflow.com/users/5021764/the-spectre"}, "is_accepted": true, "score": 1, "last_activity_date": 1452835756, "last_edit_date": 1452835756, "creation_date": 1452816455, "answer_id": 34802139, "question_id": 34801061, "link": "https://stackoverflow.com/questions/34801061/knuth-morris-pratt-implementation-in-haskell-index-out-of-bounds/34802139#34802139", "title": "Knuth-Morris-Pratt implementation in Haskell -- Index out of bounds", "body": "<p>Simple solution: I mixed up m and i in the last condition of kmp.</p>\n\n<pre><code>| otherwise = search 0 (m+1)\n</code></pre>\n\n<p>Becomes</p>\n\n<pre><code>| otherwise = search (m+1) 0\n</code></pre>\n\n<p>And the issue is resolved.</p>\n\n<p>Aside from that, it's necessary to use unboxed arrays in the ST monad or the table generation takes an absurd amount of time.</p>\n"}], "owner": {"reputation": 330, "user_id": 5021764, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dc1f8d5f08ef935d1f2a51db7cf02144?s=128&d=identicon&r=PG&f=1", "display_name": "the spectre", "link": "https://stackoverflow.com/users/5021764/the-spectre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "accepted_answer_id": 34802139, "answer_count": 1, "score": 1, "last_activity_date": 1452835756, "creation_date": 1452810810, "last_edit_date": 1452813003, "question_id": 34801061, "link": "https://stackoverflow.com/questions/34801061/knuth-morris-pratt-implementation-in-haskell-index-out-of-bounds", "title": "Knuth-Morris-Pratt implementation in Haskell -- Index out of bounds", "body": "<p>I've used the pseudocode from Wikipedia in an attempt to write a KMP algorithm in Haskell.</p>\n\n<p>It's giving \"index out of bounds\" when I try to search beyond the length of the pattern and I can't seem to find the issue; my \"fixes\" have only ruined the result.</p>\n\n<pre><code>import Control.Monad\nimport Control.Lens\nimport qualified Data.ByteString.Char8 as C\nimport qualified Data.Vector.Unboxed as V\n\n(!) :: C.ByteString -&gt; Int -&gt; Char\n(!) = C.index\n\n-- Make the table for the KMP. Directly from Wikipedia. Works as expected for inputs from Wikipedia article.\nmkTable :: C.ByteString -&gt; V.Vector Int\nmkTable pat = make 2 0 (ix 0 .~ (negate 1) $ V.replicate l 0)\n    where\n        l = C.length pat\n\n        make :: Int -&gt; Int -&gt; V.Vector Int -&gt; V.Vector Int\n        make p c t\n            | p &gt;= l    = t\n            | otherwise = proc\n            where\n                proc | pat ! (p-1) == pat ! c\n                                 = make (p+1) (c+1) (ix p .~ (c+1) $ t)\n                     | c &gt; 0     = make p (t V.! c) t\n                     | otherwise = make (p+1) c (ix p .~ 0 $ t)\n\nkmp :: C.ByteString -&gt; C.ByteString -&gt; V.Vector Int -&gt; Int\nkmp text pat tbl = search 0 0\n    where\n        l = C.length text\n        search m i\n            | m + i &gt;= l = l\n            | otherwise  = cond\n            where\n                -- The conditions for the loop, given in the wiki article\n                cond | pat ! i == text ! (m+i)\n                          = if i == C.length pat - 1\n                            then m\n                            else search m (i+1)\n                     | tbl V.! i &gt; (-1)\n                          = search (m + i - (tbl V.! i)) (tbl V.! i)\n                     | otherwise\n                          = search 0 (m+1)\n\nmain :: IO()\nmain = do\n    t &lt;- readLn\n    replicateM_ t $ do\n        text &lt;- C.getLine\n        pat  &lt;- C.getLine\n        putStrLn $ kmp text pat (mkTable pat)\n</code></pre>\n"}, {"tags": ["haskell", "functor", "recursive-datastructures", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1452845982, "post_id": 34801660, "comment_id": 57355861, "body": "indeed that&#39;s what i was thinking of doing. interesting !"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1452814021, "last_edit_date": 1452814021, "creation_date": 1452813664, "answer_id": 34801660, "question_id": 34800925, "link": "https://stackoverflow.com/questions/34800925/bifunctor-in-haskell-after-the-least-fixed-type/34801660#34801660", "title": "bifunctor in haskell after the least fixed type", "body": "<p>I haven't done this construction before, but I think I'm seeing something. Your intuition about adding an argument to <code>Mu</code> is good, but you need to pass it along so that <code>Free f</code> fits, i.e. so that <code>f</code> takes two arguments instead of one:</p>\n\n<pre><code>newtype Mu f a = In { out :: f (Mu f a) a }\n</code></pre>\n\n<p><code>Mu f</code> ought to be a <code>Functor</code> under suitable conditions, which would give you the instance you're looking for.  What are those conditions?  We need:</p>\n\n<pre><code>fmap' :: (a -&gt; b) -&gt; f (Mu f a) a -&gt; f (Mu f b) b\n</code></pre>\n\n<p>We expect <code>f</code> to be functorial in its second argument, so that's no problem.  So what we really need a way to get</p>\n\n<pre><code>f (Mu f a) b -&gt; f (Mu f b) b\n           ^               ^\n           +--not varying--+\n</code></pre>\n\n<p>We can use the instance recursively to get <code>Mu f a -&gt; Mu f b</code>, so it looks like we just need <code>f</code> to be a functor in its first argument too.  Hence:</p>\n\n<pre><code>class Bifunctor f where\n    bimap :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; f a b -&gt; f c d\n</code></pre>\n\n<p>Then you should be able to write the suitable instances</p>\n\n<pre><code>instance (Functor f) =&gt; Bifunctor (FreeF f) ...\ninstance (Bifunctor f) =&gt; Functor (Mu f) ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452862328, "post_id": 34801913, "comment_id": 57364865, "body": "Isn&#39;t <code>In . out</code> redundant? (both occurrences)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452867170, "post_id": 34801913, "comment_id": 57367786, "body": "It is. I guess I followed the type holes a bit too dumbly. Edited."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1452867118, "last_edit_date": 1452867118, "creation_date": 1452815034, "answer_id": 34801913, "question_id": 34800925, "link": "https://stackoverflow.com/questions/34800925/bifunctor-in-haskell-after-the-least-fixed-type/34801913#34801913", "title": "bifunctor in haskell after the least fixed type", "body": "<blockquote>\n  <p><code>mu f</code> is a functor for the same <code>f</code> and here it varies in type.</p>\n</blockquote>\n\n<p>Fortunately we're defining <code>Functor (Free f)</code>, and we actually use this <code>Functor</code> instance to map over the <code>a</code>'s in the <code>PureF</code> constructors. <code>Functor (Free f)</code> abstracts over all \"internal\" occurrences of <code>a</code>.</p>\n\n<p>So, whenever we want to map over both occurrences of <code>a</code>, for example when we want to implement <code>FreeF f a (Mu (FreeF f a)) -&gt; FreeF f b (Mu (FreeF f b))</code>, we can do that by wrapping everything up all the way back to <code>Free</code>, mapping, then unwrapping again. </p>\n\n<p>The following checks out with your original data definitions:</p>\n\n<pre><code>newtype Free f a = Free {unFree :: Mu (FreeF f a)} -- add \"unFree\"\n\ninstance Functor f =&gt; Functor (Free f) where\n     fmap h (Free (In (PureF a)))  = Free (In (PureF (h a)))\n     fmap h (Free (In (FreeF fn))) =\n       Free (In (FreeF (fmap (unFree . fmap h . Free) fn)))\n</code></pre>\n\n<p>Some testing:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances, StandaloneDeriving #-}\n\nderiving instance Show (f (Mu f)) =&gt; Show (Mu f)\nderiving instance Show (Mu (FreeF f a)) =&gt; Show (Free f a)       \n\nfoo :: Free [] Int\nfoo = Free $ In $ FreeF [ In $ PureF 100, In $ PureF 200 ]\n\n&gt; fmap (+100) foo\nFree {unFree = In {out = FreeF [In {out = PureF 200},In {out = PureF 300}]}}\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 2, "accepted_answer_id": 34801913, "answer_count": 2, "score": 5, "last_activity_date": 1452867118, "creation_date": 1452810130, "question_id": 34800925, "link": "https://stackoverflow.com/questions/34800925/bifunctor-in-haskell-after-the-least-fixed-type", "title": "bifunctor in haskell after the least fixed type", "body": "<p>I am not sure how to derive the functor instance after making a fixed point :</p>\n\n<pre><code>data FreeF f a next  = PureF a | FreeF (f next)  deriving (Functor)\n\ndata Mu f  = In { out :: f ( Mu f ) }\n\nnewtype Free f a = Free(  Mu (FreeF f a)  )\n\ninstance Functor f =&gt; Functor (Free f) where\n     fmap h (Free (out -&gt; PureF a))  = Free (In (PureF (h a)))\n     fmap h (Free (out -&gt; FreeF fn)) = Free (In (fmap undefined undefined)) --stuck\n</code></pre>\n\n<p>If I modify Mu to accept an extra type parameter, I can progress until... : </p>\n\n<pre><code>data Mu f a  = In { out :: f ( Mu f a )  } deriving (Functor)\n\nnewtype Free f a = Free(  Mu (FreeF f a) a )\n\ninstance Functor f =&gt; Functor (Free f ) where\n     fmap h (Free (out -&gt; PureF a))  = Free . In . PureF $ h a\n     fmap h (Free (out -&gt; FreeF fn)) = Free . In . FreeF $ fmap undefined fn \n</code></pre>\n\n<p>Here I need to have <code>undefined :: Mu (FreeF f a) a -&gt; Mu (FreeF f b) b</code> but <code>mu f</code> is a functor for the same <code>f</code> and here it varies in type.</p>\n\n<p>What is the correct way to tackle this ?</p>\n"}, {"tags": ["haskell", "character-encoding"], "answers": [{"comments": [{"owner": {"reputation": 4337, "user_id": 649727, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1cb3b3d7e0ccce5f039c37f9bd85de11?s=128&d=identicon&r=PG", "display_name": "phynfo", "link": "https://stackoverflow.com/users/649727/phynfo"}, "edited": false, "score": 0, "creation_date": 1452840501, "post_id": 34801634, "comment_id": 57353726, "body": "Thanks for the answert. I agree, that it is nearly impossible to handle <b>all</b> encodings with the proper method. But: Maybe there are methods to detect at least some encodings beforehand. And if not possible and when an exception is thrown, I want that my program proceeds and tries another readFile-function or just simply skips that text file and goes to the next."}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 2, "last_activity_date": 1452813504, "creation_date": 1452813504, "answer_id": 34801634, "question_id": 34800760, "link": "https://stackoverflow.com/questions/34800760/haskell-character-encoding-problems-with-readfile/34801634#34801634", "title": "Haskell character encoding problems with readFile", "body": "<p>What you want is impossible, for the following reason:</p>\n\n<p>There are many, many 8-bit encodings where all or most possible 8-bit patterns are assigned to some character. There is simply no way to find out which encoding it is. You absolutely need to know beforehand what it is that is encoded: some russian or greek text, perhaps? Or just german, where most characters will be in the 7-bit ASCII plane, and only occasionally there will be an \u00e4 or an \u00df.</p>\n\n<p>For this reason, smart people invented Unicode and UTF-8, and all you need to do is to say: From today on I will</p>\n\n<ul>\n<li>write all texts in UTF-8</li>\n<li>not accept any file which is not UTF-8 encoded.</li>\n<li>will cancel all social relationships with people that supply alledgedly UTF-8 encoded files, when it turns out that the file starts with a so called \"byte-order-mark\" (BOM).</li>\n</ul>\n\n<p>Let's make people that stick to 40 year old proprietary encodings a minority, and even giants like Microsoft will be forced to give up on their bad habits!</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1452828295, "creation_date": 1452828295, "answer_id": 34803898, "question_id": 34800760, "link": "https://stackoverflow.com/questions/34800760/haskell-character-encoding-problems-with-readfile/34803898#34803898", "title": "Haskell character encoding problems with readFile", "body": "<p>For all the reasons the other answer mentioned, this isn't easy. But all is not lost. Use <a href=\"https://hackage.haskell.org/package/charsetdetect-1.0/docs/Codec-Text-Detect.html\" rel=\"nofollow\">charsetdetect</a> \u2013\u00a0it's based a Mozilla algorithm, apparently \u2013 to detect the encoding for each bytestring. Then pass the detected encoding to <a href=\"http://hackage.haskell.org/package/text-icu\" rel=\"nofollow\">text-icu</a> or <a href=\"https://hackage.haskell.org/package/encoding\" rel=\"nofollow\">encoding</a> for decoding. Detection won't work for the most weird and recondite text encodings, but it should work the rest.</p>\n"}], "owner": {"reputation": 4337, "user_id": 649727, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1cb3b3d7e0ccce5f039c37f9bd85de11?s=128&d=identicon&r=PG", "display_name": "phynfo", "link": "https://stackoverflow.com/users/649727/phynfo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 835, "favorite_count": 0, "accepted_answer_id": 34803898, "answer_count": 2, "score": 5, "last_activity_date": 1452846709, "creation_date": 1452809470, "last_edit_date": 1452846709, "question_id": 34800760, "link": "https://stackoverflow.com/questions/34800760/haskell-character-encoding-problems-with-readfile", "title": "Haskell character encoding problems with readFile", "body": "<p>Although I went through a bunch of Haskell-encoding-problems-Questions I was not able to get along the following problems: </p>\n\n<p>I want to read many different text files; the character encoding of the files is probably not consistent and any readFile-Function I was using is throwing exceptions when reading some files.</p>\n\n<p>I tried to condense the problem: The following situation sums up the core of the it. </p>\n\n<pre><code>import Prelude hiding (writeFile, readFile)\nimport qualified Text.Pandoc.UTF8 as UTF (readFile, writeFile, putStr, putStrLn)\nimport qualified Prelude as Prel (writeFile, readFile)\nimport Data.ByteString.Lazy (ByteString, writeFile, readFile)\n</code></pre>\n\n<p>and in ghci I get the following results: </p>\n\n<pre><code>*Main&gt; Prel.readFile \"Test/A.txt\"\n*** Exception: Test/A.txt: hGetContents: invalid argument (invalid byte sequence) \"\\226\\8364\n*Main&gt; Prel.readFile \"Test/C.txt\"\n\"\\8230\\n\"\n\n*Main&gt; UTF.readFile \"Test/A.txt\"\n\"\\8221\\n\"\n\n*Main&gt; UTF.readFile \"Test/C.txt\"\n*** Exception: Cannot decode byte '\\x85':      \nData.Text.Internal.Encoding.Fusion.streamUtf8: Invalid UTF-8 stream \n</code></pre>\n\n<p>Maybe the following infos help:</p>\n\n<ul>\n<li>The <code>getLocaleEncoding</code> yields <code>CP1252</code></li>\n<li>The ByteString of the two \"problematic\" text files: </li>\n</ul>\n\n<p><code>\n      *Main&gt; readFile \"Test/A.txt\"\n      \"\\226\\128\\157\\r\\n\"\n      *Main&gt; readFile \"Test/C.txt\"\n      \"\\133\\r\\n\"\n</code></p>\n\n<p><strong>My question is</strong>: How can I catch / deal with / avoid these character encoding errors? The point is: I do not know the encoding of text files in advance, I need one readFile-method that works for all. \nAnd if not possible and when an exception is thrown, I want the exception to be catched and my program to proceed in order to be able to try another readFile-function or just simply skip that text file and go to the next. </p>\n"}, {"tags": ["haskell", "ghc", "ghcjs", "ghcjs-dom"], "comments": [{"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 1, "creation_date": 1452801853, "post_id": 34798142, "comment_id": 57340481, "body": "I&#39;ve been using ghcjs with the ghcjs-dom package and never installed webkitgtk ( at least not intentionally and as far as I know not at all ).  How are you going about installing ghcjs/ghcjs-dom ?"}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452802229, "post_id": 34798142, "comment_id": 57340711, "body": "@Dave I run <code>cabal install ghcjs-dom</code>, sometimes with different variants.  It keeps getting hung up on something like <code>Failed to install webkitgtk3-0.14.1.1</code>.  Is there a better way?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 1, "creation_date": 1452802353, "post_id": 34798142, "comment_id": 57340782, "body": "have you installed ghcjs already ?  I believe you should do this as a first step."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452802638, "post_id": 34798142, "comment_id": 57340955, "body": "Yes, I have done that successfully"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452802984, "post_id": 34798142, "comment_id": 57341147, "body": "Here&#39;s a project I created to try out ghcjs :  <a href=\"https://github.com/dc25/ghcjs_demo\" rel=\"nofollow noreferrer\">github.com/dc25/ghcjs_demo</a>"}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452803522, "post_id": 34798142, "comment_id": 57341483, "body": "Cloned and tried to compile...when I ran <code>ghcjs -o demo Main.hs</code> I got  `Main.hs:1:8: Could not find module \u2018GHCJS.DOM\u2019`` and other errors for all the DOM extensions.  How did you install the DOM package?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452804004, "post_id": 34798142, "comment_id": 57341748, "body": "If you clone that project, you should be able to run the following commands...      cabal configure --ghcjs;     cabal sandbox init;     cabal install --only-dependencies --ghcjs;     cabal configure --ghcjs;     cabal build;  ... from within the project to build using ghcjs.  The extra configure command was necessary for me because the project seems to forget the ghcjs configuration after the install  I just verified that this works on my ubuntu linux machine.  The &quot;cabal install&quot; took about 10 minutes  You &quot;cabal&quot; will need to be up-to-date enough to support the --ghcjs option."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452804190, "post_id": 34798142, "comment_id": 57341860, "body": "You must already have ghcjs-dom installed.  When I run <code>cabal configure --ghcjs</code> I get <code>cabal: At least the following dependencies are missing: ghcjs-dom</code>"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452804205, "post_id": 34798142, "comment_id": 57341870, "body": "Those cabal commands were supposed to be on different lines.  The comment system had other plans though so I added semicolons."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 1, "creation_date": 1452804225, "post_id": 34798142, "comment_id": 57341882, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/100703/discussion-between-dave-and-mark-karavan\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1452810901, "post_id": 34798142, "comment_id": 57345363, "body": "The answer given is more succinct than the steps mentioned in the comments above and discussed in the chat.  If you just want to use the ghcjs-dom library with ghcjs, then all you need to do is &quot;cabal install ghcjs-dom --ghcjs&quot;.  At that point, the ghcjs-dom functionality is available for import and you can compile with ghcjs ( &quot;cabal build&quot; is not required )."}], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 4, "last_activity_date": 1452810247, "creation_date": 1452810247, "answer_id": 34800949, "question_id": 34798142, "link": "https://stackoverflow.com/questions/34798142/using-ghcjs-dom-without-webkitgtk/34800949#34800949", "title": "Using GHCJS-DOM without webkitgtk", "body": "<p>To install ghcjs-dom for use with ghcjs use :</p>\n\n<pre><code>cabal install ghcjs-dom --ghcjs\n</code></pre>\n\n<p>This requires a version of cabal recent enough to include ghcjs support.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 1, "accepted_answer_id": 34800949, "answer_count": 1, "score": 1, "last_activity_date": 1470711474, "creation_date": 1452800041, "last_edit_date": 1470711474, "question_id": 34798142, "link": "https://stackoverflow.com/questions/34798142/using-ghcjs-dom-without-webkitgtk", "title": "Using GHCJS-DOM without webkitgtk", "body": "<p>I have installed GHCJS and compiled a few \"Hello, World\" programs.  Now I'd like to work with the DOM.  Does anyone know if it is possible to install the ghcjs-dom package without webkitgtk?  I'm having a lot of difficulty loading the webkitgtk package, and I really just want to work with the DOM at this point.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1452792003, "post_id": 34795615, "comment_id": 57334825, "body": "Did you mean <code>y&lt;-[0..x]</code> rather than <code>y&lt;-[0,x]</code>?"}, {"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1452792029, "post_id": 34795615, "comment_id": 57334842, "body": "@MathematicalOrchid nice shout, thank you!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452792329, "post_id": 34795615, "comment_id": 57335059, "body": "err ... now your input does neither compile nor correspond to the output ... may I ask what the <i>question</i> is?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452792346, "post_id": 34795615, "comment_id": 57335072, "body": "After the edit the question is impossible to understand, since the output is now wrong! You should not correct the error after you ask, if that was the whole issue. Think of who will read the question afterwards, and of who has already replied."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452792609, "post_id": 34795615, "comment_id": 57335232, "body": "can you please at least edit the output that <i>baffles</i> you? ... look if you just copy&amp;paste it into GHCi (removing the <code>)</code> vs <code>]</code> mistake) you get: <code>[(0,0),(1,0),(1,1),(2,0),(2,1),(2,2)]</code> from this new line"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1452802353, "post_id": 34795615, "comment_id": 57340781, "body": "this question only makes sense as originally asked. Any new question should be asked anew, as a separate entry. :)"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452792340, "post_id": 34795795, "comment_id": 57335067, "body": "I meant [0..x] I didn&#39;t realise until Mathematical Orchid Pointed out. My apologies!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452792391, "post_id": 34795795, "comment_id": 57335092, "body": "so basically you tell me that both my answer and indeed your question is <i>void</i>?"}, {"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452792479, "post_id": 34795795, "comment_id": 57335152, "body": "I&#39;m sorry, I made a mistake. I didn&#39;t notice it at first!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452792539, "post_id": 34795795, "comment_id": 57335190, "body": "@JaneDoe ... but this new line does not correspond to your given output at all - and of course you don&#39;t have to wonder anymore because now the missing <i>piece</i> will be in there..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1452802548, "post_id": 34795795, "comment_id": 57340899, "body": "I rolled the Q back. :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1452836007, "post_id": 34795795, "comment_id": 57352524, "body": "@WillNess Thank you!"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1452837321, "post_id": 34795795, "comment_id": 57352898, "body": "This answer is very badly structured. &quot;which of course is simply no - the output is consistent&quot; ????"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1452839556, "post_id": 34795795, "comment_id": 57353480, "body": "@immibis you are of course free to add your own - but thanks for giving a reason - and maybe it would help you if you would indeed read the rest of the answer"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1452840493, "post_id": 34795795, "comment_id": 57353724, "body": "@Carsten If you proof-read your answer the whole way through, you might see what I mean."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1452842032, "post_id": 34795795, "comment_id": 57354287, "body": "@immibis ok yes I see what you mean (I honestly don&#39;t know how this happened - most guess one paste to much...)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 7, "last_activity_date": 1452841995, "last_edit_date": 1452841995, "creation_date": 1452792097, "answer_id": 34795795, "question_id": 34795615, "link": "https://stackoverflow.com/questions/34795615/list-comprehension-output-not-what-i-assumed/34795795#34795795", "title": "List-comprehension output not what I assumed", "body": "<h2>case <code>[(x,y) | x &lt;- [0..2], y&lt;-[0,x]]</code></h2>\n\n<p><code>[0,x]</code>  is:</p>\n\n<ul>\n<li><code>[0,0]</code> for <code>x=0</code></li>\n<li><code>[0,1]</code> for <code>x=1</code></li>\n<li><code>[0,2]</code> for <code>x=2</code></li>\n</ul>\n\n<p>so if you pair each of those <code>y</code>s up with the corresponding <code>x</code> you get:</p>\n\n<pre><code>   [(0,0),(0,0)] -- x = 0\n++ [(1,0),(1,1)] -- x = 1\n++ [(2,0),(2,2)] -- x = 2\n</code></pre>\n\n<p>which yields your given output</p>\n\n<hr>\n\n<p>note: <code>[0,2]</code> has length 2 and is quite different from <code>[0..2]</code> which has length 3 and contains <code>1</code></p>\n\n<hr>\n\n<h2>case <code>[(x,y) | x &lt;- [0..2], y&lt;-[0..x]]</code></h2>\n\n<p>it's not that different - <code>[0..x]</code>  is:</p>\n\n<ul>\n<li><code>[0]</code>     for <code>x=0</code></li>\n<li><code>[0,1]</code>   for <code>x=1</code></li>\n<li><code>[0,1,2]</code> for <code>x=2</code></li>\n</ul>\n\n<p>and if you pair each of those <code>y</code>s up with the corresponding <code>x</code> you get</p>\n\n<pre><code>   [(0,0))]            -- x = 0\n++ [(1,0),(1,1)]       -- x = 1\n++ [(2,0),(2,1),(2,2)] -- x = 2\n</code></pre>\n\n<p>which then would give you the result</p>\n\n<pre><code>[(0,0),(1,0),(1,1),(2,0),(2,1),(2,2)]\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 34795795, "answer_count": 1, "score": -1, "last_activity_date": 1452841995, "creation_date": 1452791514, "last_edit_date": 1452802522, "question_id": 34795615, "link": "https://stackoverflow.com/questions/34795615/list-comprehension-output-not-what-i-assumed", "title": "List-comprehension output not what I assumed", "body": "<p>I assume its simple as its in a past paper of my university but the function is:</p>\n\n<pre><code>[(x,y) | x &lt;- [0..2], y&lt;-[0,x])\n</code></pre>\n\n<p>and the output </p>\n\n<pre><code>  [(0,0),(0,0),(1,0), (1,1), (2,0), (2,2)]\n</code></pre>\n\n<p>The (2,0) confuses me, if y maps to 0 to x whilst x is equal to 1 = (1,1) wouldnt it be</p>\n\n<pre><code>[(0,0),(0,0),(1,0), (1,1), **(2,1)**, (2,2)]\n</code></pre>\n\n<p>or is it because due to the y using all its numbers in its list [0,1] it reverts back to 0?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452794758, "post_id": 34795483, "comment_id": 57336418, "body": "Thanks! It works but how exactly is it filtering?  Since it returns the triples, I&#39;m assuming it filters based on pyTheorem returning true?"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452794933, "post_id": 34795483, "comment_id": 57336507, "body": "Take a look at <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/Data-List.html#g:13\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452795819, "post_id": 34795483, "comment_id": 57337010, "body": "I see the explanation shows: <code>filter p xs = [ x | x &lt;- xs, p x]</code> but how does that translate from the above code?"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452796009, "post_id": 34795483, "comment_id": 57337132, "body": "that&#39;s another way of looking at it. A filter iterates over the input list, runs pyTheorem and throws away each element that evaluates to false"}, {"owner": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452797692, "post_id": 34795483, "comment_id": 57338102, "body": "So how would I express it using the above syntax?"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "edited": false, "score": 0, "creation_date": 1452798009, "post_id": 34795483, "comment_id": 57338276, "body": "<code>[ x | x &lt;- xs, pyTheorem x]</code>"}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1452799359, "post_id": 34795483, "comment_id": 57339019, "body": "You could also write filter directly with recursion : <code>filter p [] = []; filter p (x:xs) | p x = x : filter p xs | otherwise = filter p xs</code>. Or rather on several line (if I wasn&#39;t in a comment)"}], "tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": true, "score": 5, "last_activity_date": 1452793365, "last_edit_date": 1452793365, "creation_date": 1452791126, "answer_id": 34795483, "question_id": 34795429, "link": "https://stackoverflow.com/questions/34795429/taking-list-of-tuples-as-parameters-in-haskell/34795483#34795483", "title": "Taking list of tuples as parameters in Haskell", "body": "<p>I think is all you need</p>\n\n<pre><code>filterPy : [(Int,Int,Int)] -&gt; [(Int,Int,Int)]\nfilterPy ls = filter pyTheorem ls\n</code></pre>\n\n<p>Real afficionados would also write it 'point free'</p>\n\n<pre><code>filterPy = filter pyTheorem\n</code></pre>\n"}], "owner": {"reputation": 1363, "user_id": 5779452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5c07c442a138d5852b368944ecf43a4c?s=128&d=identicon&r=PG&f=1", "display_name": "DxAlpha", "link": "https://stackoverflow.com/users/5779452/dxalpha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 34795483, "answer_count": 1, "score": 0, "last_activity_date": 1452793365, "creation_date": 1452790956, "question_id": 34795429, "link": "https://stackoverflow.com/questions/34795429/taking-list-of-tuples-as-parameters-in-haskell", "title": "Taking list of tuples as parameters in Haskell", "body": "<p>I would like to know how to take a list of tuples as a parameter or if there is an easier solution.</p>\n\n<p>I am new to Haskell (only started a week ago) and I made this function to check if the tuple acts as a Pythagorean Triple.</p>\n\n<pre><code>pyTheorem (a,b,c) = a ^ 2 + b ^ 2 == c ^ 2\n\nlet x = pyTheorem (3,4,5)  \n</code></pre>\n\n<p>So how would I define a function where it takes a list of tuples and returns the tuples that are Pythagorean Triples? Also, if there is a better way of doing this, please elaborate.</p>\n\n<p>I looked up some similar questions but I couldn't find something that seemed to fit this example.</p>\n\n<p><strong>Side Note:</strong> I find that some of the examples in LYAH I can't seem to use in the online terminal: <a href=\"https://ghc.io/\" rel=\"nofollow\">https://ghc.io/</a></p>\n\n<p>So I am using <a href=\"http://www.tutorialspoint.com/compile_haskell_online.php\" rel=\"nofollow\">http://www.tutorialspoint.com/compile_haskell_online.php</a> instead.  Are there any big differences I should be aware of? </p>\n\n<p>Thanks.  </p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452787717, "post_id": 34794132, "comment_id": 57331921, "body": "<code>\\x -&gt; ...</code> is a way to define a (unnamed) function - in this case (I guess you are talking about <code>showCatalogue</code> here?) <code>x</code> will <i>see</i> every element in <code>toList c</code> and use <code>formatLine (...</code> to <i>map</i> it into some other value and all those values will be a list with the same order again ... I mean this is really basic stuff - maybe you can make your question a bit more concrete?"}, {"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452787832, "post_id": 34794132, "comment_id": 57331996, "body": "@Carsten yes, that&#39;s the one"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1452787704, "creation_date": 1452787704, "answer_id": 34794256, "question_id": 34794132, "link": "https://stackoverflow.com/questions/34794132/meaning-of-backslash-in-haskell-code/34794256#34794256", "title": "Meaning of backslash in Haskell code?", "body": "<p>That's Haskell's syntax for lambda abstraction. The Haskell</p>\n\n<pre><code>\\x -&gt; e\n</code></pre>\n\n<p>corresponds to the mathematical</p>\n\n<pre><code>\u03bbx.e\n</code></pre>\n\n<p>In this case,</p>\n\n<pre><code>\\(x, y) -&gt; length $ fst y\n</code></pre>\n\n<p>is a function that takes a pair <code>(x,y)</code> and returns the length of the first component of the pair <code>y</code>. This is a slightly odd way to write the expression; it would be better to write it as</p>\n\n<pre><code>\\(x, (y1, y2)) -&gt; length y1\n</code></pre>\n\n<p>or as</p>\n\n<pre><code>length . fst . snd\n</code></pre>\n\n<p>for consistency.</p>\n"}, {"comments": [{"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1452788432, "post_id": 34794297, "comment_id": 57332387, "body": "So this whole code <code>(\\x -&gt; (formatLine (longestProductLen (toList testDB)) x) ++ &quot;\\n&quot;)</code> defines a function with parameter <code>toList c</code> which returns a list and then maps <code>x</code> to every element from the <code>toList c</code> list ?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1452788575, "post_id": 34794297, "comment_id": 57332481, "body": "It defines a function with the parameter <code>x</code> which it then passes to the function <code>formatLine (longestProductionLen (toList testDB))</code>, which returns a <code>String</code> (a list of <code>Char</code>s), since the next step is <code>++ &quot;\\n&quot;</code>."}, {"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1452788961, "post_id": 34794297, "comment_id": 57332754, "body": "<code>longestProductionLen (toList testDB)</code> returns an <code>int</code> and second parameter <code>x</code> must be of type <code>(Barcode, Item)</code> to get matched with <code>formatLine</code>. But how does <code>x</code> get assigned with each element ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1452789051, "post_id": 34794297, "comment_id": 57332805, "body": "@southpaw93, <code>map</code> calls the anonymous function with each element of the list. I think you should really be working through tutorials instead of random code you found somewhere."}, {"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452789120, "post_id": 34794297, "comment_id": 57332859, "body": "@dfeuer that&#39;s what I was thinking but I wasn&#39;t sure and wanted to verify, so map does that, now it&#39;s clear :) thanks."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1452789147, "post_id": 34794297, "comment_id": 57332879, "body": "@southpaw93 The function <code>(\\x -&gt; (formatLine ... x) ++ &quot;\\n&quot;)</code> is being passed as an argument to the function <code>map</code>.  The <code>map</code> function takes a function and a list, applies that function to each item of the list and returns a list of all those results."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 16, "last_activity_date": 1452787838, "creation_date": 1452787838, "answer_id": 34794297, "question_id": 34794132, "link": "https://stackoverflow.com/questions/34794132/meaning-of-backslash-in-haskell-code/34794297#34794297", "title": "Meaning of backslash in Haskell code?", "body": "<p>The syntax</p>\n\n<pre><code>function x y = &lt;body&gt;\n</code></pre>\n\n<p>Is equivalent to</p>\n\n<pre><code>function = \\x y -&gt; &lt;body&gt;\n</code></pre>\n\n<p>And is called a lambda or anonymous function.  The compiler actually turns all your functions into assignments of lambda functions (the second form) since it's just giving a function value (functions are values in Haskell) a name.</p>\n\n<p>If you see it given as an argument to another function like <code>map</code>:</p>\n\n<pre><code>map (\\x -&gt; x + 1) [1, 2, 3]\n</code></pre>\n\n<p>This is semantically equivalent to</p>\n\n<pre><code>map add1 [1, 2, 3] where add1 x = x + 1\n</code></pre>\n\n<p>Lambdas can perform arbitrary pattern matching on their arguments, too.  Also, if you have a definition like</p>\n\n<pre><code>fib 0 = 1\nfib 1 = 1\nfib n = fib (n - 1) + fib (n - 2)\n</code></pre>\n\n<p>This is equivalent to</p>\n\n<pre><code>fib = \\n -&gt; case n of\n    0 -&gt; 1\n    1 -&gt; 1\n    n -&gt; fib (n - 1) + fib (n - 2)\n</code></pre>\n\n<p>Because the compiler will first translate the multiple pattern matching into a case statement, then convert it to assigning a lambda to a name (in this case assigning the lambda to the name <code>fib</code>).</p>\n"}], "owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6193, "favorite_count": 0, "accepted_answer_id": 34794297, "answer_count": 2, "score": 5, "last_activity_date": 1452787927, "creation_date": 1452787392, "last_edit_date": 1452787927, "question_id": 34794132, "link": "https://stackoverflow.com/questions/34794132/meaning-of-backslash-in-haskell-code", "title": "Meaning of backslash in Haskell code?", "body": "<p>So I have this haskell code, and I understand half of it, but I can't get my head around this <code>\\x -&gt;</code> here:</p>\n\n<pre><code>testDB :: Catalogue\ntestDB = fromList [\n (\"0265090316581\", (\"The Macannihav'nmor Highland Single Malt\", \"75ml bottle\")),\n (\"0903900739533\", (\"Bagpipes of Glory\", \"6-CD Box\")),\n (\"9780201342758\", (\"Thompson - \\\"Haskell: The Craft of Functional Programming\\\"\", \"Book\")),\n (\"0042400212509\", (\"Universal deep-frying pan\", \"pc\"))\n ]\n\n\n-- Exercise 1\n\nlongestProductLen :: [(Barcode, Item)] -&gt; Int\nlongestProductLen = maximum . map (\\(x, y) -&gt; length $ fst y) \n\nformatLine :: Int -&gt; (Barcode, Item) -&gt; String\nformatLine k (x, (y1, y2)) = x ++ \"...\" ++ y1 ++ (take  (k - length y1) (repeat '.')) ++ \"...\" ++ y2\n\nshowCatalogue :: Catalogue -&gt; String\nshowCatalogue c = foldr (++) \"\" $ map (\\x -&gt; (formatLine (longestProductLen (toList testDB)) x) ++ \"\\n\") $ toList c\n</code></pre>\n\n<p>I understand that <code>longestProductLen</code> returns and integer meaning the longest title in <code>testDB</code> and then it uses this integer to match <code>k</code> in <code>formatLine</code>, but I can't understnad how it matches <code>(Bardcode, Item)</code> and I guess it has something to do with <code>\\x -&gt;</code>, if it does can you please explain how it does that?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1452778954, "post_id": 34790721, "comment_id": 57325371, "body": "but those two behave differently: <code>delete 1 (insert 1 (insert 1 empty))</code> will be empty in one but not in the other... (which you can check with <code>member</code> if you argue that there is no equality implied)"}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1452779144, "post_id": 34790721, "comment_id": 57325516, "body": "@Carsten, you just found a bug in my implementation."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1452779233, "post_id": 34790721, "comment_id": 57325578, "body": ";) - it&#39;s just that I think of  a very specific entity if I say <code>Set</code> (that&#39;s why I would call it collection or something"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1452836247, "post_id": 34790721, "comment_id": 57352595, "body": "@Carsten Seems easy enough to fix by having <code>delete</code> for <code>List</code> delete <i>all</i> matching items, not just the first one."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1452837760, "post_id": 34790721, "comment_id": 57353000, "body": "You might also be interested in the answers to <a href=\"http://stackoverflow.com/questions/25191659/why-is-haskell-missing-obvious-typeclasses\">Why is Haskell missing &quot;obvious&quot; Typeclasses</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 1, "creation_date": 1452778827, "post_id": 34791093, "comment_id": 57325277, "body": "That code comes with a: Warning: This module should be considered highly experimental."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1452965599, "post_id": 34791093, "comment_id": 57401529, "body": "Still somewhat true, but it hasn&#39;t changed in a significant way in over a year I believe."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 5, "last_activity_date": 1452824300, "last_edit_date": 1452824300, "creation_date": 1452778711, "answer_id": 34791093, "question_id": 34790721, "link": "https://stackoverflow.com/questions/34790721/where-is-the-set-type-class/34791093#34791093", "title": "Where is the Set type class?", "body": "<p>You can try <a href=\"http://haddock.stackage.org/lts-4.1/mono-traversable-0.10.0.1/Data-Containers.html\" rel=\"nofollow\"><code>Data.Containers</code> from <code>mono-traversable</code></a></p>\n\n<p>Haskell code in general tends to have less of a leaning towards generalizing data types like this than, say, Java, which is why these abstractions aren't in <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow\"><code>containers</code></a> or <a href=\"https://hackage.haskell.org/package/unordered-containers\" rel=\"nofollow\"><code>unordered-containers</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1452785558, "post_id": 34792111, "comment_id": 57330302, "body": "I reckon a major reason Haskell doesn&#39;t have so many superclasses is that, if you really need such a class, you can <i>at any point later</i> define it yourself and make the suitable instances for any types you want. The type doesn&#39;t need to know anything about classes you put it in, unlike with Java where the types themselves are classes and need to specify their superclasses themselves."}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 1, "creation_date": 1452848341, "post_id": 34792111, "comment_id": 57357037, "body": "Sometimes the needs of your program might change or perhaps aren&#39;t so clearcut to begin with, without testing which Set implementation has the best performance in your specific program."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 7, "last_activity_date": 1452792238, "last_edit_date": 1452792238, "creation_date": 1452781918, "answer_id": 34792111, "question_id": 34790721, "link": "https://stackoverflow.com/questions/34790721/where-is-the-set-type-class/34792111#34792111", "title": "Where is the Set type class?", "body": "<p>For whatever reason, Haskell tends not to do the whole thing of having deep hierarchies of type classes for representing all possible sorts of containers.</p>\n\n<p>Generally, different sorts of containers have performance properties for different operations. Typically you know what operations are important to you, and you choose the most suitable container and use that explicitly. There's not much requirement to be able to write really generic code that operates over every possible kind of container.</p>\n\n<p>Note that there are <em>some</em> type classes for dealing with containers already &mdash; they're just not the ones you might be expecting. For example:</p>\n\n<ul>\n<li><p><code>Functor</code> allows you to apply a function to every element of a container &mdash; <em>any</em> container &mdash; and collect the results into a new container of the same type.</p></li>\n<li><p><code>Applicative</code> and/or <code>Monad</code> allow you to apply a function to every element and produce more than one element as result. (It may not be obvious, but you can use this to perform \"filtering\" and even \"deletion\", although it's probably not efficient.)</p></li>\n<li><p><code>Monoid</code> provides your <code>empty</code> and <code>union</code> methods (but named <code>mempty</code> and <code>mappend</code>).</p></li>\n<li><p><code>Alternative</code>, <code>Foldable</code> and <code>Traversable</code> let you do further interesting magic.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "edited": false, "score": 0, "creation_date": 1452849782, "post_id": 34801510, "comment_id": 57357870, "body": "I think your answer is the closest to the answer I&#39;m looking for, but I&#39;m still wondering how specifically you would choose to use this insight in the best possible way (in your opinion), to implement enough polymorphic operations that you can easily switch to a different implementation of a set, simply by changing the type of a function."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 6, "last_activity_date": 1452813038, "creation_date": 1452813038, "answer_id": 34801510, "question_id": 34790721, "link": "https://stackoverflow.com/questions/34790721/where-is-the-set-type-class/34801510#34801510", "title": "Where is the Set type class?", "body": "<p>I'll annotate the class a bit:</p>\n\n<pre><code>-- The functional dependency here ties in to the issues with \n-- restricted type class instances, for which there is no one\n-- globally adopted solution.\nclass Set set a | set -&gt; a where\n  -- This is a `Monoid`- or `Alternative`-like constant\n  empty :: set\n\n  -- This is an `Applicative`-like operation\n  singleton :: a -&gt; set\n\n  -- If you have `singleton` and `union` you have `insert`.\n  -- Which means that `insert` might fall out of the \n  -- `Alternative` class.\n  insert :: a -&gt; set -&gt; set\n\n  -- This looks like a variant of `filter` below.\n  delete :: a -&gt; set -&gt; set\n\n  -- These two are `Semigroup` operations\n  union :: set -&gt; set -&gt; set\n  intersection :: set -&gt; set -&gt; set\n\n  -- Can't think of anything for this one.\n  member :: a -&gt; set -&gt; Bool\n\n  -- This is very `Monad`-like operation.  You can write this\n  -- in terms of a bind/`unionMap` operation + your `singleton`\n  -- and `empty`.\n  filter :: (a -&gt; Bool) -&gt; set -&gt; set\n</code></pre>\n\n<p>So basically, the community prefers a lot of small classes that are more reusable than this <code>Set</code> class would be.  </p>\n\n<p>Here's another point that might be useful.  You seem to be mentally tying classes to <em>types</em>, as a mental classification of types that are similar because they \"represent sets.\"  But the Haskell community more often ties classes to <strong>operations</strong>.  You can see this in the annotation above, I hope\u2014most of the operations that you propose remind me of some already existing class.  The black mark is the fact that most of those classes won't work with a type like <code>Set</code> that has an element type constraint...</p>\n"}], "owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1452848149, "creation_date": 1452777739, "last_edit_date": 1495540326, "question_id": 34790721, "link": "https://stackoverflow.com/questions/34790721/where-is-the-set-type-class", "title": "Where is the Set type class?", "body": "<p>In Haskell <a href=\"http://hackage.haskell.org/package/containers/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>Data.Set</code></a> implements a concrete set type. Normal <code>[]</code> lists also implement all operations of a set (in <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html\" rel=\"nofollow noreferrer\"><code>Data.List</code></a>). But there seems to be no predefined <code>Set</code> typeclass that they both implement. You can implement one yourself:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FunctionalDependencies #-}\n\nmodule Set where\n\nimport qualified Data.List as ConcreteList\nimport qualified Data.Set as ConcreteSet\n\nclass Set set a | set -&gt; a where\n  empty :: set\n  singleton :: a -&gt; set\n  insert :: a -&gt; set -&gt; set\n  delete :: a -&gt; set -&gt; set\n  union :: set -&gt; set -&gt; set\n  intersection :: set -&gt; set -&gt; set\n  member :: a -&gt; set -&gt; Bool\n  filter :: (a -&gt; Bool) -&gt; set -&gt; set\n\ninstance (Ord a) =&gt; Set (ConcreteSet.Set a) a where\n  empty = ConcreteSet.empty\n  singleton = ConcreteSet.singleton\n  insert = ConcreteSet.insert\n  delete = ConcreteSet.delete\n  union = ConcreteSet.union\n  intersection = ConcreteSet.intersection\n  member = ConcreteSet.member\n  filter = ConcreteSet.filter\n\ninstance (Eq a) =&gt; Set [a] a where\n  empty = []\n  singleton e = [e]\n  insert = (:)\n  delete = ConcreteList.delete\n  union = ConcreteList.union\n  intersection = ConcreteList.intersect\n  member = ConcreteList.elem\n  filter = ConcreteList.filter\n</code></pre>\n\n<p>but it seems that this would already have been done if this was the way to go. So my question is: Where is the <code>Set</code> typeclass or what alternative solution has the Haskell community come up with?</p>\n\n<p>My question is admittedly quite similar to <a href=\"https://stackoverflow.com/questions/25191659/why-is-haskell-missing-obvious-typeclasses\">Why is Haskell missing \u201cobvious\u201d Typeclasses</a>, but by being more concrete (focusing on a specific example with sample implementation), I'm hoping to get some more concrete answers as well.</p>\n"}, {"tags": ["list", "haskell", "tuples", "template-haskell"], "comments": [{"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1452774501, "post_id": 34789371, "comment_id": 57322428, "body": "I feel the need to mention <a href=\"http://hackage.haskell.org/package/tuple-th\" rel=\"nofollow noreferrer\">the &quot;tuple-th&quot; library</a>, which I&#39;ve found very useful in my practice."}], "answers": [{"comments": [{"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452778720, "post_id": 34789512, "comment_id": 57325175, "body": "Wouldn&#39;t one be better off using a new data type though?  Like <code>data X = A Int | B Char | C String</code> or something along this line?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452778855, "post_id": 34789512, "comment_id": 57325297, "body": "@Akaberto: I wouldn&#39;t advocate for this for several reasons: (a) as said before, the compiler cannot do much typechecking which can solve many problems, (b) the number of types is endless, and one should thus need to learn what <code>A</code>, <code>B</code>,... means (c) what will you do with polymorphic types (d) it is more inefficient as it implies another indirection,..."}, {"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452779817, "post_id": 34789512, "comment_id": 57325980, "body": "Oops, I meant something like <code>data Person = Person { firstName :: String, lastName :: String, age :: Int }</code>  Isn&#39;t this similar to a tuple?"}, {"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452780113, "post_id": 34789512, "comment_id": 57326209, "body": "Also, with the above (a) should be handled by the type checker, (b), while the number of types are indeed endless, you would still know what you are dealing with (perhaps even more so with record types as you can name the fields explicitly).  (c) can be handled via type constructors and isn&#39;t (d) present in tuples too (or are they optimized to avoid an indirection).  Even with that, is it worth the trouble to use arbitrary tuples?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 1, "creation_date": 1452780354, "post_id": 34789512, "comment_id": 57326374, "body": "@Akaberto, it&#39;s the same. But when generating source with TH, you likely don&#39;t have meaningful names to use, or know how many fields you have to deal with."}, {"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452781316, "post_id": 34789512, "comment_id": 57327027, "body": "@dfeuer: Oh, so it is useful when generating code.  I have to read up on TH (been dodging it for a while now).  Just skimmed through HaskellWiki&#39;s entry on TH and do see a lot of code involving tuples.  Thanks."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452781605, "post_id": 34789512, "comment_id": 57327261, "body": "@Akaberto: template Haskell has nothing to do with tuples itself. They only use it as an example. To put it bold: with template Haskell you write code that writes code for you. Compare it to templates in C++. The advantage is that if you do it properly, you are less likely to make errors, and code can be more compact. Instead of specifying an <code>instance Functor</code> for every tuple yourself, describe how such instance for a generic tuple would look like."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 12, "last_activity_date": 1452812126, "last_edit_date": 1452812126, "creation_date": 1452774163, "answer_id": 34789512, "question_id": 34789371, "link": "https://stackoverflow.com/questions/34789371/why-are-arbitrary-sized-tuples-useful-template-haskell/34789512#34789512", "title": "Why are arbitrary sized tuples useful? (Template Haskell)", "body": "<p>With <em>arbitrary</em> one means arbitrary <strong>at compile time</strong>. So if you want tuples with fifteen elements, template Haskell will generate a function for a tuple with fifteen elements. After compilation however, the number of elements is fixed. The advantage of using a tuple is that you can <em>access each element in constant time O(1)</em>. So you can <em>use the type system to enforce the tuple still contains a fixed amount of elements</em>.</p>\n\n<p>Furthermore the <code>sel</code> in the example can work with tuples where the <strong>elements have arbitrary types</strong>. For instance <code>sel 2 3</code> will generate a function:</p>\n\n<pre><code>$(sel 2 3) :: (a,b,c) -&gt; b\n$(sel 5 5) :: (a,b,c,d,e) -&gt; e\n</code></pre>\n\n<p>whereas if you use a list <code>[a]</code>, this means that the list <strong>can only contain data for a certain type</strong>:</p>\n\n<pre><code>(!!3) :: [a] -&gt; a\n</code></pre>\n\n<p>so all items have type <code>a</code>. Furthermore in this case you are not sure that the list will have three elements. The more you can check at compile time, the more safe your code is (and in many cases more efficient as well).</p>\n\n<p>A <strong>list</strong> on the other hand has an arbitrary size <strong>at runtime</strong>. The same type - for instance <code>[Int]</code> - can specify a list with two, five, hundred or thousands of integers. Furthermore in the case of a list, accessing the <em>k</em>-th element requires <em>O(k)</em> time. There are datastructures like <em>arrays</em> that of course can access elements in constant time.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 1, "accepted_answer_id": 34789512, "answer_count": 1, "score": 4, "last_activity_date": 1452812126, "creation_date": 1452773674, "last_edit_date": 1452775639, "question_id": 34789371, "link": "https://stackoverflow.com/questions/34789371/why-are-arbitrary-sized-tuples-useful-template-haskell", "title": "Why are arbitrary sized tuples useful? (Template Haskell)", "body": "<p>In the <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"nofollow\">introductory text for Template Haskell</a> one of the examples for why Template Haskell is useful is working with arbitrary sized tuples.</p>\n\n<p>What is the purpose of arbitrary sized tuples? If the data type is the same why not use a list? And if the data types in the tuple are different, how can it be expanded to arbitrary sizes?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1452770085, "post_id": 34787805, "comment_id": 57319722, "body": "Note: I believe you are doing some exercises/assignments. Just <i>yesterday</i> questions similar to yours were asked about finding prime numbers (<a href=\"http://stackoverflow.com/q/34770836/510937\">here</a>). Also: do <i>not</i> add the <code>(Haskell)</code> to the title. A title should be a sentence not something with some tags added to it. We already have tags on question, there is no need to add them to the title too."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452772265, "post_id": 34787805, "comment_id": 57321045, "body": "Note: You&#39;ve asked six questions in five days. If you post two questions per day, you will <a href=\"https://meta.stackexchange.com/questions/164899/the-complete-rate-limiting-guide\">hit the limit on questions</a>. However, I think you would be better off with some kind of mentoring, at least while you&#39;re still dabbling with Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "edited": false, "score": 0, "creation_date": 1452770052, "post_id": 34788127, "comment_id": 57319707, "body": "Thanks a million for your help ,only now I get it yohoooo :)"}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 1, "creation_date": 1452771310, "post_id": 34788127, "comment_id": 57320440, "body": "Additionally, GHC complained that it couldn&#39;t find an <code>Eq</code> instance for the <code>delete</code> function. As suggested by compiler, adding typeclass context <code>Eq a =&gt;</code> to the <code>removeif</code> function solved the issue."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 7, "last_activity_date": 1452769916, "creation_date": 1452769916, "answer_id": 34788127, "question_id": 34787805, "link": "https://stackoverflow.com/questions/34787805/function-for-infinite-list-excluding-multiples-of-three/34788127#34788127", "title": "Function for infinite list excluding multiples of three", "body": "<p><code>removeif</code> wants a <em>function</em> as first argument. But <code>x `mod` 3 == 0</code> is not a function. It's an expression that references a non-existing name <code>x</code>.</p>\n\n<p>You want to use a <em>lambda abstraction</em>: <code>\\x -&gt; x `mod` 3 == 0</code>.\nThe <code>\\x -&gt;</code> part says that this is a function with one parameter called <code>x</code>.\nThe result is given by the following expression.</p>\n\n<p>Alternatively you could simply use sections and function composition: <code>(== 0) . (`mod` 3)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "edited": false, "score": 1, "creation_date": 1453035559, "post_id": 34789904, "comment_id": 57417925, "body": "Thank you, I am a new learner of Haskell, I did not know that its also possible this way, Thanks!!!! :)"}], "tags": [], "owner": {"reputation": 126, "user_id": 5766031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-APTQZlmDZaQ/AAAAAAAAAAI/AAAAAAAAAG4/u-iOSDRTsOo/photo.jpg?sz=128", "display_name": "Zacharie 007", "link": "https://stackoverflow.com/users/5766031/zacharie-007"}, "is_accepted": false, "score": 3, "last_activity_date": 1452776005, "last_edit_date": 1452776005, "creation_date": 1452775273, "answer_id": 34789904, "question_id": 34787805, "link": "https://stackoverflow.com/questions/34787805/function-for-infinite-list-excluding-multiples-of-three/34789904#34789904", "title": "Function for infinite list excluding multiples of three", "body": "<p>Using composition :</p>\n\n<pre><code> removeThreeMultiple =  filter ( (/= 0) . (`mod` 3))\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code> Prelude&gt;  removeThreeMultiple  [1,2,3,4,9,0]\n [1,2,4]\n</code></pre>\n\n<p>Make it simple, try to write correctly the intermediate function that checks if a number is a mutliple of three or not. Then use it to clean your list.  </p>\n"}], "owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 1, "accepted_answer_id": 34788127, "answer_count": 2, "score": 1, "last_activity_date": 1452776005, "creation_date": 1452768989, "last_edit_date": 1495539898, "question_id": 34787805, "link": "https://stackoverflow.com/questions/34787805/function-for-infinite-list-excluding-multiples-of-three", "title": "Function for infinite list excluding multiples of three", "body": "<p>This question is related to my previous question <a href=\"https://stackoverflow.com/questions/34785585/removing-items-from-a-list-if-a-predicate-holds-haskell/34785741#34785741\">Removing items from a list if a predicate holds</a> .</p>\n\n<p>I am struggling with outputting an infinite list which does not contain any multiple of three.\nFor that I have these few functions till now: </p>\n\n<pre><code>delete :: Eq a =&gt; a -&gt; [a] -&gt; [a]\ndelete deleted xs = [ x | x &lt;- xs, x /= deleted ]\n\nremoveif ::(a -&gt; Bool)-&gt;[a]-&gt;[a]\nremoveif func [] = []\nremoveif func (h:t)= if func h then delete h (h:t) else removeif func t\n\nnothreefolds :: [Integer]\nnothreefolds = removeif (x `mod` 3 == 0) [1..]\n</code></pre>\n\n<p>But the problem is that I am missing some syntax knowledge and I want to tell <code>removeif</code> to remove the elements from natural numbers if they are multiple of 3.</p>\n\n<p>If you can please help me to the right direction, I will be thoroughly grateful.</p>\n"}, {"tags": ["list", "haskell", "predicate"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1452763163, "post_id": 34785585, "comment_id": 57315317, "body": "<code>removeIf p = filter (not . p)</code>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1452763208, "post_id": 34785585, "comment_id": 57315345, "body": "I don&#39;t understand the question. A predicate is a function with type <code>a -&gt; Bool</code> for some <code>a</code>. The condition of <code>if</code> needs a <code>Bool</code> so there&#39;s not much you can do if you want to use code similar to that."}, {"owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1452764667, "post_id": 34785585, "comment_id": 57316288, "body": "@Cactus Thank you so much, its  good idea to start with :)"}, {"owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1452764679, "post_id": 34785585, "comment_id": 57316293, "body": "@Bakuriu Thank you so much, I was confused about it, Now its very clear to me about predicate and how I should continue further. Thank you a millions!!!! :)"}], "answers": [{"tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 3, "last_activity_date": 1452763383, "creation_date": 1452763383, "answer_id": 34785741, "question_id": 34785585, "link": "https://stackoverflow.com/questions/34785585/removing-items-from-a-list-if-a-predicate-holds/34785741#34785741", "title": "Removing items from a list if a predicate holds", "body": "<p>A predicate should be a function of type <code>a -&gt; Bool</code>. Therefore, the signature of <code>removeif</code> should be</p>\n\n<pre><code>removeif :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>If <code>threefolds</code> has type <code>a -&gt; Bool</code>, you'll be fine :-)</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "edited": false, "score": 0, "creation_date": 1452765548, "post_id": 34786400, "comment_id": 57316878, "body": "Thank you, I will try it :)"}, {"owner": {"reputation": 126, "user_id": 5766031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-APTQZlmDZaQ/AAAAAAAAAAI/AAAAAAAAAG4/u-iOSDRTsOo/photo.jpg?sz=128", "display_name": "Zacharie 007", "link": "https://stackoverflow.com/users/5766031/zacharie-007"}, "reply_to_user": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "edited": false, "score": 2, "creation_date": 1452765671, "post_id": 34786400, "comment_id": 57316949, "body": "Then use filter as cactus said in your definition of removeIf:"}], "tags": [], "owner": {"reputation": 126, "user_id": 5766031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-APTQZlmDZaQ/AAAAAAAAAAI/AAAAAAAAAG4/u-iOSDRTsOo/photo.jpg?sz=128", "display_name": "Zacharie 007", "link": "https://stackoverflow.com/users/5766031/zacharie-007"}, "is_accepted": false, "score": 1, "last_activity_date": 1452765238, "creation_date": 1452765238, "answer_id": 34786400, "question_id": 34785585, "link": "https://stackoverflow.com/questions/34785585/removing-items-from-a-list-if-a-predicate-holds/34786400#34786400", "title": "Removing items from a list if a predicate holds", "body": "<p>Threefolds should return a boolean, something like this:</p>\n\n<pre><code>   let threefolds x =  x `mod` 3 == 0\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 5769707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ddc1d07e117c045e0fb404507e3f40a7?s=128&d=identicon&r=PG&f=1", "display_name": "Nia", "link": "https://stackoverflow.com/users/5769707/nia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 1, "accepted_answer_id": 34785741, "answer_count": 2, "score": 0, "last_activity_date": 1452769613, "creation_date": 1452762917, "last_edit_date": 1452769613, "question_id": 34785585, "link": "https://stackoverflow.com/questions/34785585/removing-items-from-a-list-if-a-predicate-holds", "title": "Removing items from a list if a predicate holds", "body": "<p>I am trying to make a function which takes as input a predicate and a list. and removes all elements from the list for which the predicate holds. What I have so far is the following function:</p>\n\n<pre><code>removeif :: func-&gt;[a]-&gt;[a]\nremoveif [] = []\nremoveif func (h:t)= if func then delete h (h:t) else removeif func t\n</code></pre>\n\n<p>I am confused about the <code>func</code> part of the <code>func-&gt;[a]-&gt;[a]</code> because I don't know how should I tell that its a predicate.</p>\n\n<p>For example what I want is that I give from the terminal this command</p>\n\n<pre><code>removeif threefolds [1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p><code>threefolds</code> is a local function I have and it returns an infinite list with multiples of three and I want to remove those multiples from the input list. I am thinking of making <code>threefold</code> a bool function but not sure if that is necessary.</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1452748621, "creation_date": 1452748621, "answer_id": 34782191, "question_id": 34782014, "link": "https://stackoverflow.com/questions/34782014/appending-monad/34782191#34782191", "title": "Appending monad", "body": "<p>The <a href=\"http://hackage.haskell.org/package/transformers-0.5.0.0/docs/Control-Monad-Trans-Writer.html\">Writer</a> monad does this:</p>\n\n<pre><code>&gt; let g = tell \"b\" &gt;&gt; tell \"c\" &gt;&gt; tell \"d\"\n&gt; runWriter (tell \"a\" &gt;&gt; g &gt;&gt; tell \"e\")\n((),\"abcde\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1452762522, "post_id": 34782196, "comment_id": 57314852, "body": "Is <code>DList</code> necessary? <code>Control.Monad.Writer</code> has pretty <a href=\"https://mail.haskell.org/pipermail/libraries/2013-March/019528.html\" rel=\"nofollow noreferrer\">pure perfomance</a>, and with just <code>List</code> <code>runAppend $ do append xs; append ys; append zs</code> will desugar to <code>xs ++ ys ++ zs</code> and not to <code>(xs ++ ys) ++ zs</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1452763096, "post_id": 34782196, "comment_id": 57315274, "body": "Well doesn&#39;t that depend on the shape of your real functions playing the parts of <code>f</code> and <code>g</code>?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1452764052, "post_id": 34782196, "comment_id": 57315925, "body": "Yes, taking <code>f</code> and <code>g</code> from the question, <code>g</code> will be traversed twice. I&#39;m just not sure whether this optimization worth introducing possible syntactic overhead (<code>toList</code>, <code>fromList</code> \u2014 that stuff). I would use the strict <code>Writer</code> from the link I mentioned, if I would want to optimize."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 7, "last_activity_date": 1452748647, "creation_date": 1452748647, "answer_id": 34782196, "question_id": 34782014, "link": "https://stackoverflow.com/questions/34782014/appending-monad/34782196#34782196", "title": "Appending monad", "body": "<p>You can use a <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer.html\"><code>Writer</code> monad</a> for this:</p>\n\n<pre><code>import Control.Monad.Writer\nimport Data.DList (DList)\nimport qualified Data.DList as DList\n\ntype Append c = Writer (DList c)\n\nappend :: c -&gt; Append c ()\nappend = tell . pure\n\nrunAppend :: Append c () -&gt; [c]\nrunAppend = DList.toList . execWriter\n\nf, g :: Append Char ()\n</code></pre>\n\n<p>This is a bit more complicated than necessary because it uses a <code>DList Char</code> instead of a <code>String</code>. <a href=\"https://hackage.haskell.org/package/dlist-0.5\"><code>DList</code></a> gives you an efficient <code>Monoid</code> instance for this case where you keep appending to the end. </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 1, "accepted_answer_id": 34782196, "answer_count": 2, "score": 0, "last_activity_date": 1452748727, "creation_date": 1452747462, "last_edit_date": 1452748727, "question_id": 34782014, "link": "https://stackoverflow.com/questions/34782014/appending-monad", "title": "Appending monad", "body": "<p>With just <code>putChar</code> I can do stuff like this:</p>\n\n<pre><code>f = \n  do\n    putChar 'a'\n    putChar 'b'\n    g\n    putChar 'f'\n    putChar 'g'\n\ng =\n  do\n    putChar 'c'\n    putChar 'd'\n    putChar 'e'\n</code></pre>\n\n<p>And what I will find when I \"run\" this (by saying <code>main = f</code>) it'll just print the characters out in order.</p>\n\n<p>What I'm looking for is a non-<code>IO</code> version. Something that works a bit like this:</p>\n\n<pre><code>f = \n  do\n    append 'a'\n    append 'b'\n    g\n    append 'f'\n    append 'g'\n\ng =\n  do\n    append 'c'\n    append 'd'\n    append 'e'\n</code></pre>\n\n<p>And a function, say <code>runAppend :: t a -&gt; [a]</code> </p>\n\n<p>Such that <code>runAppend f</code> = <code>['a','b','c','d','e','f','g']</code></p>\n\n<p>Naturally I'd want this to run in linear time (i.e. not suffer issues like <code>++</code> does when you do the concatenations in a bad order).</p>\n\n<p>This seems like a fairly common use case so I'm guessing it exists, if someone could point me to it that would be good, I didn't want to reinvent the wheel.</p>\n"}, {"tags": ["haskell", "emulation"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 8, "creation_date": 1452749551, "post_id": 34781651, "comment_id": 57309166, "body": "At first, I thought &quot;ha, how large would that state be?&quot;. But <i>&quot;I&#39;m writing my first real Haskell project</i>, [...] <b><i>a Gameboy Color emulator&quot;</i></b>. Ambitious first steps."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452782771, "post_id": 34787916, "comment_id": 57328165, "body": "From an efficiency standpoint, <code>STRef</code> currently sucks for this sort of thing, while <code>StateT BigRecord (ST s)</code> is painful but fast."}, {"owner": {"reputation": 285, "user_id": 1563749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5c74c1bc48024ca1775693ea786d1ec?s=128&d=identicon&r=PG", "display_name": "Nikhil Unni", "link": "https://stackoverflow.com/users/1563749/nikhil-unni"}, "edited": false, "score": 0, "creation_date": 1452794093, "post_id": 34787916, "comment_id": 57336034, "body": "Thank you! Follow up -- why is boxing small types wasteful? From what I can tell, the difference is between updating just the _ime field (for example), vs a fresh MemRefs every time I update any of the fields."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452794711, "post_id": 34787916, "comment_id": 57336393, "body": "It&#39;s mostly wasteful in terms of memory (using a 64-bit pointer to adress a seperate 16-bit data entry), and bad for cache coherence. Luckily, you don&#39;t need to follow these pointers when updating <i>another</i> record field, but it&#39;s still quite a bit of garbage floating around. But, I&#39;m not sure how much influence it would really have in your application."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1452769273, "creation_date": 1452769273, "answer_id": 34787916, "question_id": 34781651, "link": "https://stackoverflow.com/questions/34781651/how-to-organize-large-amounts-of-state-in-haskell-projects/34787916#34787916", "title": "How to organize large amounts of state in Haskell projects", "body": "<p>Lenses are definitely a great help for this kind of stuff, but you'd rather use them with a big, nested <em>pure</em> state object in a <code>State</code> monad, rather than <code>ST</code>. And I think that would probably be ok for all those variables, though it would probably not be acceptable for the arrays (which would need to be deep-copied with every modification.</p>\n\n<p>So I could think of two options:</p>\n\n<ul>\n<li>Switch from arrays to a data structure with efficient pure functional updates, like <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Sequence.html\">Sequence</a>. Ditch those <code>STRefs</code> entirely, in favour of lens-based updates in <code>State</code>.<br>That'll be nowhere as efficient as destructive array updates in <code>ST</code>, but for simulating a Game Boy on a fast modern computer it might just work.</li>\n<li><p>Split up the memory type so you can keep the arrays in <code>ST</code>, but group all the other state in a single <code>STRef</code> to a pure data structure. On that you can then use lenses.</p>\n\n<pre><code>data Memory s = Memory { memory :: STUArray s Word16 Word8\n                       , registers :: STUArray s Word8 Word8\n                       , memRefs :: STRef s MemRefs\n                       , window :: Window\n                       , renderer :: Renderer\n                       }\n\ndata MemRefs = MemRefs { _sp :: Word16\n                       , _pc :: Word16\n                       , _cycles :: Word16\n                       , _ime :: Bool --Interrupt Master Enable Flag\n                       , _halt :: Bool --Are we halted or not\n                       , _mode :: GPUMode -- GPU mode\n                       , _line :: Word8 -- GPU line\n                       , _transferred :: Bool\n                       , _gpuCycles :: Word16\n                       }\nmkLenses ''MemRefs\n</code></pre></li>\n</ul>\n\n<p>The good thing is, you can now group the <code>MemRef</code> type al gusto, and use lenses to conveniently reach down into the structure. By making the structure more tree-like, the updates will actually become more efficient. (You probably also want to unbox those <code>Word16</code> and <code>Bool</code> fields, it's really quite wasteful to keep such small types boxed.)</p>\n\n<p>Even so, you should be prepared that this will not run as fast as a similarly complex implementation in, say, C++. To achieve comparable performance, you'd probably have to hand-taylor all that state to use <em>a single</em> <code>STArray</code> in which all the state information is encoded, and write ugly OO-style getters and setters in <code>ST</code> to make it remotely convenient.</p>\n"}], "owner": {"reputation": 285, "user_id": 1563749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5c74c1bc48024ca1775693ea786d1ec?s=128&d=identicon&r=PG", "display_name": "Nikhil Unni", "link": "https://stackoverflow.com/users/1563749/nikhil-unni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 1, "accepted_answer_id": 34787916, "answer_count": 1, "score": 11, "last_activity_date": 1452769273, "creation_date": 1452744913, "question_id": 34781651, "link": "https://stackoverflow.com/questions/34781651/how-to-organize-large-amounts-of-state-in-haskell-projects", "title": "How to organize large amounts of state in Haskell projects", "body": "<p>I'm writing my first real Haskell project, and I'm having trouble organizing state in the program. It's a Gameboy Color emulator, so there are a lot of little flags, and the entire state looks like </p>\n\n<pre><code>data Memory s = Memory { memory :: STUArray s Word16 Word8\n                       , registers :: STUArray s Word8 Word8\n                       , sp :: STRef s Word16\n                       , pc :: STRef s Word16\n                       , cycles :: STRef s Word16\n                       , ime :: STRef s Bool --Interrupt Master Enable Flag\n                       , halt :: STRef s Bool --Are we halted or not\n                       , mode :: STRef s GPUMode -- GPU mode\n                       , line :: STRef s Word8 -- GPU line\n                       , transferred :: STRef s Bool\n                       , gpuCycles :: STRef s Word16\n                       , window :: Window\n                       , renderer :: Renderer\n                       }\n</code></pre>\n\n<p>And I do all read/write of the state like : </p>\n\n<pre><code> data Address = OneRegister Register\n          | TwoRegister {registerA :: Register, registerB :: Register}\n          | MemAddr Word16\n          | SP\n          | PC\n          | CYCLES\n          | IME\n          | HALT_STATE\n          | GPU_MODE\n          | GPU_LINE\n          | GPU_TRANSFERRED_LINE\n          | GPU_CYCLES\n\n  data MemVal = MemVal8 Word8\n          | MemVal16 Word16\n          | Flag Bool\n          | Mode GPUMode\n\n  read :: Memory s -&gt; Address -&gt; ST s MemVal\n  write :: Memory s -&gt; Address -&gt; MemVal -&gt; ST s ()\n</code></pre>\n\n<p>You can see : <a href=\"https://github.com/nikhilunni/HaskellBoy/blob/master/src/Memory.hs\">https://github.com/nikhilunni/HaskellBoy/blob/master/src/Memory.hs</a></p>\n\n<p>Is there any cleaner way for me to organize everything? I'd like to split up the state between the various components (CPU, GPU, cartridge bank switching, etc), if possible. Is it idiomatic to have a big monolithic state type in Haskell?</p>\n\n<p>It's a pretty big pain to add new state to the program. The Control.Lens package seems to be up the right alley, but I'm not sure if I can combine it with ST very easily.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 4, "creation_date": 1452736230, "post_id": 34780347, "comment_id": 57305763, "body": "Can you clarify what you mean by this? <code>instance Show Snowman where show _ = &quot;\u2603&quot;</code> certainly works in Haskell."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1452739442, "post_id": 34780347, "comment_id": 57306605, "body": "You have misunderstood the answer to the linked question. The Show instance <b>for String</b> uses only printable ASCII characters <b>by choice</b> (in order to ensure the output is viewable in any terminal, I assume). That has nothing to do with the Show typeclass itself. You are perfectly free to define your own Show instances that produce non-ASCII output."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1452739662, "post_id": 34780347, "comment_id": 57306666, "body": "@ReidBarton, the relevant instance is the one for <code>Char</code>."}, {"owner": {"reputation": 6179, "user_id": 2969544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b66660630d54cf58a7d4675be1d6ff?s=128&d=identicon&r=PG", "display_name": "oklas", "link": "https://stackoverflow.com/users/2969544/oklas"}, "edited": false, "score": 0, "creation_date": 1455618237, "post_id": 34780347, "comment_id": 58558150, "body": "Hi @Harpo it is uncivilly. You are delete question. I have spent much time to to answer your questions  here <a href=\"http://stackoverflow.com/questions/35426726/does-the-hiredis-redis-library-create-its-own-thread-for-async-callbacks\" title=\"does the hiredis redis library create its own thread for async callbacks\">stackoverflow.com/questions/35426726/&hellip;</a> Question It is very difficult and interesting for people. People votes your quetion. Not each man can understand and solve that problem. It does not show you as mistake.  Do not be shy. It show you as qualified developer asks dificult question."}, {"owner": {"reputation": 2282, "user_id": 123642, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/73aa7ad0c97ecb6a1d766fa8810aba29?s=128&d=identicon&r=PG", "display_name": "kolen", "link": "https://stackoverflow.com/users/123642/kolen"}, "edited": false, "score": 0, "creation_date": 1578109753, "post_id": 34780347, "comment_id": 105341641, "body": "The problem is real. Try entering <code>show &#39;\u03b1&#39;</code> in repl. It outputs <code>&quot;&#39;\\\\945&#39;&quot;</code>. The same for <code>&quot;\u03b1&quot;</code>. Makes using Show for debugging hard if your data contains non-english text."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1452737485, "post_id": 34780471, "comment_id": 57306119, "body": "I am not so certain as you about the nature of HarpoRoeder&#39;s misunderstanding; especially the clause &quot;but the rest of the language does [support unicode]&quot; makes me think he may not necessarily have fallen into the &quot;<code>Char</code> is ASCII-only&quot; trap."}, {"owner": {"reputation": 385, "user_id": 5725848, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1086e1b40cdecc9467217bd45406c126?s=128&d=identicon&r=PG&f=1", "display_name": "44701", "link": "https://stackoverflow.com/users/5725848/44701"}, "edited": false, "score": 0, "creation_date": 1452737981, "post_id": 34780471, "comment_id": 57306252, "body": "This is wrong. Show supports a subset of string. <a href=\"http://stackoverflow.com/a/14039878/5725848\">stackoverflow.com/a/14039878/5725848</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 385, "user_id": 5725848, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1086e1b40cdecc9467217bd45406c126?s=128&d=identicon&r=PG&f=1", "display_name": "44701", "link": "https://stackoverflow.com/users/5725848/44701"}, "edited": false, "score": 2, "creation_date": 1452739518, "post_id": 34780471, "comment_id": 57306629, "body": "@HarpoRoeder, the <code>show</code> and <code>showList</code> methods of the <code>Show</code> instance for <code>Char</code> escapes some  characters. That has nothing to do with <code>show</code> or <code>showList</code> proper, and there is no restriction on what characters the instances you write produce."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1452736761, "creation_date": 1452736761, "answer_id": 34780471, "question_id": 34780347, "link": "https://stackoverflow.com/questions/34780347/unicode-version-of-show-typeclass/34780471#34780471", "title": "Unicode version of show typeclass", "body": "<p>I think this question is ill-posed. In <code>show :: (Show a) =&gt; a -&gt; String</code>, <code>String</code> is a type synonym for <code>[Char]</code> and <code>Char</code> is a smart enough data type to represent any Unicode character. </p>\n\n<blockquote>\n  <p>The character type Char is an enumeration whose values represent Unicode (or equivalently ISO/IEC 10646) characters (see <a href=\"http://www.unicode.org/\" rel=\"nofollow\">http://www.unicode.org/</a> for details). This set extends the ISO 8859-1 (Latin-1) character set (the first 256 characters), which is itself an extension of the ASCII character set (the first 128 characters). A character literal in Haskell has type Char.</p>\n</blockquote>\n\n<p>This is the kind of power in simplicity you get when you choose simple data types and may come as a surprise to people immigrating from other languages where the default string type can only represent up to ASCII or UTF-16 or whatever else garbage.</p>\n\n<p>So in that sense <code>show</code> already <em>is</em> the Unicode version of <code>show</code>. Whether or not <code>String</code> is an efficient representation of a Unicode, well that's another question entirely.</p>\n"}], "owner": {"reputation": 385, "user_id": 5725848, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1086e1b40cdecc9467217bd45406c126?s=128&d=identicon&r=PG&f=1", "display_name": "44701", "link": "https://stackoverflow.com/users/5725848/44701"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 34780471, "answer_count": 1, "score": -3, "last_activity_date": 1452738524, "creation_date": 1452735985, "last_edit_date": 1495542749, "question_id": 34780347, "link": "https://stackoverflow.com/questions/34780347/unicode-version-of-show-typeclass", "title": "Unicode version of show typeclass", "body": "<p>The Haskell typeclass show does not support unicode but the rest of the language does. I was unable to find a standard alternative typeclass for unicode. Does Haskell have a version of show for unicode?</p>\n\n<p>This property is described in \"<a href=\"https://stackoverflow.com/questions/14039726/how-to-make-haskell-or-ghci-able-to-show-chinese-characters-and-run-chinese-char/14039878#14039878\">How to make Haskell or ghci able to show Chinese characters and run Chinese characters named scripts?</a>\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1452735020, "post_id": 34779980, "comment_id": 57305375, "body": "@luqui I strongly disagree. I think &quot;variable-ness&quot; and &quot;parameter-ness&quot;/&quot;argument-ness&quot; emphasize very different things."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452738444, "post_id": 34780136, "comment_id": 57306360, "body": "Since types are generally opposed to terms, perhaps &quot;type-level language&quot; or some such would be better."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452738602, "post_id": 34780136, "comment_id": 57306397, "body": "Also, a <i>parameter</i> is often opposed to an <i>index</i>, so I&#39;d use &quot;argument&quot; from both ends and historical terminology be damned. In fact, the whole parameter/argument nonsense seems to be mostly bad pedantry."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452743845, "post_id": 34780136, "comment_id": 57307675, "body": "@dfeuer Not sure I&#39;m on board with the &quot;language&quot; suggestion. A language is a collection of terms."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452779951, "post_id": 34780136, "comment_id": 57326081, "body": "A language is a collection of words."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1452735713, "last_edit_date": 1452735713, "creation_date": 1452734547, "answer_id": 34780136, "question_id": 34779980, "link": "https://stackoverflow.com/questions/34779980/is-type-variable-the-alias-of-type-parameter/34780136#34780136", "title": "Is &quot;type variable&quot; the alias of &quot;type parameter&quot;?", "body": "<p>Here is an abbreviated syntax for type-level terms:</p>\n\n<pre><code>type ::= variable\n       | type type\n       | constructor\n       | \"(\" type \")\"\n\nvar ::= &lt;lowercase letter&gt;*\nconstructor ::= &lt;uppercase letter&gt;&lt;lowercase letter&gt;*\n              | \"-&gt;\"\n              | \"[]\"\n</code></pre>\n\n<p>And here's an abbreviated syntax for declarations of new data types:</p>\n\n<pre><code>decl     ::= \"data\" constructor var* \"=\" branches\nbranches ::= branch | branch \"|\" branches\nbranch   ::= constructor type*\n</code></pre>\n\n<p>It's not quite precise or complete (see the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-650004.1.2\" rel=\"noreferrer\">Report</a> for the canonical details), but it's enough to get the discussion off the ground.</p>\n\n<p>Here is a smattering of terms and what I mean when I say them:</p>\n\n<ul>\n<li><strong>type variable</strong>: a type-level term built by the <code>var</code> production above; for example, <code>a</code>, <code>graph</code>, <code>foo</code> would be fine type variables if they appeared in a context expecting a type, but <code>[a]</code>, <code>Tree</code>, <code>Ord x</code> are not type variables and <code>graph</code> would not be a type variable in the term declaration <code>f graph = undefined</code>.</li>\n<li><strong>type parameter</strong>: a <em>position</em> in a data declaration that points to one of the <code>var</code> arguments; for example, in <code>data Foo a b c = Bar a Int</code> I would call the <code>a</code>, <code>b</code>, and <code>c</code> to the left of <code>=</code> type parameters, but the <code>a</code> to the right would not be. To a lesser extent, \"type parameter\" also gets used to mean \"type argument\", see below, though this usage is a little bit sloppy in my opinion.</li>\n<li><strong>type argument</strong>: a type filling in for the second part of the <code>type ::= type type</code> production above; for example, in <code>Foo (Maybe a)</code>, I would call <code>a</code> a type argument and <code>(Maybe a)</code> a type argument, but <code>Foo</code> and <code>Maybe</code> would not be. As a special case, we have <code>[a]</code> as a sort of syntactic sugar for the application <code>[] a</code>; in that case, I would also call <code>a</code> a type argument even though it is in sort of a funny position.</li>\n</ul>\n\n<p>With this terminology in mind, in the type <code>[a] -&gt; a</code>, I would certainly call <code>a</code> a type variable; I would object to calling <code>a</code> a type parameter; and I would be okay with calling <code>a</code> a type argument (since it is used in the type application <code>[] a</code> written in sugary style).</p>\n\n<p>Note that even though in this case one might reasonably call <code>a</code> both a type variable and a type argument this does <em>not</em> mean that the two terms are synonymous! Saying that <code>a</code> is a type variable is pointing out that it has not yet been made concrete, whereas saying that <code>a</code> is a type argument is pointing out that it is being used to fill in a parameter of some other type -- which is emphasizing two very different things about <code>a</code> in that type!</p>\n\n<p>Just to round out some the answer with some examples demonstrating the difference between the terms, consider these type declarations taken from the Prelude:</p>\n\n<pre><code>undefined :: a\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\nnot :: Bool -&gt; Bool\notherwise :: Bool\n</code></pre>\n\n<p>The <code>a</code> in the type of <code>undefined</code> is a type variable but not a type argument; likewise the <code>m</code> in the type of <code>(&gt;&gt;=)</code> is a type variable but in most of the places it appears is not a type argument.</p>\n\n<p>Both appearances of <code>Bool</code> in the type of <code>not</code> are type arguments but not type variables. (Just like the type <code>[t]</code> is sugar for <code>[] t</code>, the type <code>t1 -&gt; t2</code> is sugar for <code>(-&gt;) t1 t2</code>.)</p>\n\n<p>The <code>a</code> and <code>b</code> in the type of <code>(&gt;&gt;=)</code> are both type variables and type arguments.</p>\n\n<p>The <code>Bool</code> in the type of <code>otherwise</code> is neither a type variable nor a type argument.</p>\n"}], "owner": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "accepted_answer_id": 34780136, "answer_count": 1, "score": 2, "last_activity_date": 1452735713, "creation_date": 1452733515, "last_edit_date": 1452733952, "question_id": 34779980, "link": "https://stackoverflow.com/questions/34779980/is-type-variable-the-alias-of-type-parameter", "title": "Is &quot;type variable&quot; the alias of &quot;type parameter&quot;?", "body": "<p>Are <code>type variable</code> and <code>type parameter</code> the same thing in Haskell? E.g.: </p>\n\n<pre><code>ghci&gt; :t last\nlast :: [a] -&gt; a\n</code></pre>\n\n<p><code>a</code> is both <code>type variable</code> and <code>type parameter</code>.</p>\n"}, {"tags": ["sql", "haskell", "aggregate-functions"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452730712, "post_id": 34779431, "comment_id": 57304097, "body": "I don&#39;t know. You lost me at <code>!!</code> which has no business being in this code. Also, I suggest you write drafts of &quot;having&quot; and &quot;group by&quot; first, then think about what you might need to do to combine them."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452730907, "post_id": 34779431, "comment_id": 57304148, "body": "@dfeuer <code>at = (!!)</code> is to extract the nth column/field. This is used in <code>groupBySql</code> to group rows based upon equality of the &quot;city&quot; field, (i.e. column <code>2</code>). I&#39;ve just asked another question about the equality by a field:  `<a href=\"http://stackoverflow.com/questions/34778469/changing-the-return-type-of-a-function-in-haskell\" title=\"changing the return type of a function in haskell\">stackoverflow.com/questions/34778469/&hellip;</a>"}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452730985, "post_id": 34779431, "comment_id": 57304166, "body": "@dfeuer Regarding your second point, my current understanding is that <code>HAVING</code> cannot be written independent from <code>GROUP BY</code>. This, of course, is part of my question, both about SQL and the Haskell interpretation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452731798, "post_id": 34779431, "comment_id": 57304395, "body": "Even if I don&#39;t particularly enjoy them, note that GHC has <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#generalised-list-comprehensions\" rel=\"nofollow noreferrer\">SQL-like list comprehensions</a> as an extension."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452732505, "post_id": 34779431, "comment_id": 57304613, "body": "@chi Thanks for pointing that out:) I sometimes think that the description of SQL is based on rules and not very clear. That&#39;s why I want to use the clarity of Haskell here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452737511, "post_id": 34779431, "comment_id": 57306133, "body": "Ah, I misunderstood the <code>!!</code>. I wouldn&#39;t recommend representing a row by a list."}], "answers": [{"comments": [{"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1453085292, "post_id": 34836906, "comment_id": 57433415, "body": "Thanks for the clear explanation. It seems to me that the first implementation is more intuitive. The second implementation with <code>havingCity</code> seems to have <b>repeated</b> the aggregate function <code>max(temp_lo)</code> intelligently/unnaturally in the having clause via <code>not . any ( (40&lt;=) . temp_lo)</code>. Do you think actual SQL execution will behave like this? i.e. will it be smart enough to implement the same <code>max()</code> twice differently?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1453097913, "post_id": 34836906, "comment_id": 57436688, "body": "@tinlyx Given that both <code>max(...)</code> happen on the same <code>SELECT</code> level <i>and</i> the same field, I hope that this is the case. That depends on the implementation in your DBMS, but given the example is from the documentation (and the fact that it&#39;s basically a <code>split-&gt;map-&gt;reduce</code>), there&#39;s strong evidence that for a single-level <code>SELECT</code>, PostgreSQL does this kind of optimization. The second variant models a version that&#39;s not doing this kind of optimization."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1453023039, "creation_date": 1453023039, "answer_id": 34836906, "question_id": 34779431, "link": "https://stackoverflow.com/questions/34779431/sql-group-by-and-having-in-haskell/34836906#34836906", "title": "SQL &quot;Group By&quot; and Having in Haskell?", "body": "<p><sup>Note: This post is written in literate Haskell. You can save it as Main.lhs and try it in your GHCi.</sup></p>\n\n<p>To model this in Haskell, we should use the appropriate types:</p>\n\n<pre><code>&gt; import Data.Function (on)\n&gt; import Data.List (maximumBy, sortBy, groupBy)\n&gt; import Data.Ord (comparing)\n&gt;\n&gt; type WEntry = (Int, Int, String)\n\n&gt; temp_lo (t, _, _) = t\n&gt; city    (_, _, c) = c\n</code></pre>\n\n<p>Now, a select in SQL can be thought as a function from one (or many) table(s) to a table of results:</p>\n\n<pre><code>&gt; type Result = (Int, String)\n\n&gt; select :: [WEntry] -&gt; [Result]\n&gt; select = map (\\(l,h,c) -&gt; (l, c))\n</code></pre>\n\n<p>Note that this does not account aggregation. Now, we group the entries by their cities:</p>\n\n<pre><code>&gt; groupByCity :: [WEntry] -&gt; [[WEntry]]\n&gt; groupByCity  = groupBy ((==) `on` city) . sortBy (comparing city)\n</code></pre>\n\n<p>Since both <code>HAVING</code> and the original <code>SELECT</code> use <code>max(temp_lo)</code>, we aggregate the maximum lowest temperature here for some optimization:</p>\n\n<pre><code>&gt; aggregate :: [[WEntry]] -&gt; [WEntry]\n&gt; aggregate = map (maximumBy (comparing temp_lo))\n</code></pre>\n\n<p>You can think of <code>groupByCity</code> and <code>GROUP BY</code> as creating temporary sub tables. If we wouldn't use aggregates those tables would be concatenated in the end.</p>\n\n<p>Now we need to filter those with a valid temperature:</p>\n\n<pre><code>&gt; having :: [WEntry] -&gt; [WEntry]\n&gt; having     = filter ((&lt;40) . temp_lo)\n</code></pre>\n\n<p>And then put all things together:</p>\n\n<pre><code>&gt; query :: [WEntry] -&gt; [Result]\n&gt; query = select . having . aggregate . groupByCity\n</code></pre>\n\n<p>An alternative would have been</p>\n\n<pre><code>havingCity :: [[WEntry]] -&gt; [[WEntry]]\nhavingCity = filter (not . any ((40&lt;=) . temp_lo))\nquery = select . aggregate . havingCity . groupByCity\n</code></pre>\n\n<p>The important part is that an aggregate usually folds intermediate results. If you don't use grouping, <code>max(temp_lo)</code> will return a single value (the maximum lowest temperature of the whole table). If you group, <code>max(temp_lo)</code> will be maximum lowest temperature of a specific group. Likewise <code>HAVING</code> makes it possible to check the result an aggregate would return.</p>\n\n<p>Last but not least, here's a main so that you can actually try it:</p>\n\n<pre><code>&gt; weather :: [WEntry]\n&gt; weather =\n&gt;   [ (10,  30, \"Berlin\")\n&gt;   , (45,  99, \"San Francisco\")\n&gt;   , ( 0,   3, \"Springfield\")\n&gt;   , (14,  35, \"Berlin\")\n&gt;   , (55, 103, \"San Francisco\")\n&gt;   , ( 5,  29, \"Springfield\")\n&gt;   ]\n&gt;\n&gt; main = print $ query weather\n&gt; -- Result: [(14,\"Berlin\"),(5,\"Springfield\")]\n</code></pre>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 2, "accepted_answer_id": 34836906, "answer_count": 1, "score": 1, "last_activity_date": 1453023039, "creation_date": 1452729920, "question_id": 34779431, "link": "https://stackoverflow.com/questions/34779431/sql-group-by-and-having-in-haskell", "title": "SQL &quot;Group By&quot; and Having in Haskell?", "body": "<p>I am trying to understand the semantics of SQL <code>GROUP BY</code> and <code>HAVING</code> clauses by mimicking it in Haskell with a minimal mock-up. </p>\n\n<p>For example, the following SQL taken from the <a href=\"http://www.postgresql.org/docs/9.5/static/tutorial-agg.html\" rel=\"nofollow\">Postgres tutorial</a></p>\n\n<pre><code>SELECT city, max(temp_lo)\n    FROM weather\n    GROUP BY city\n    HAVING max(temp_lo) &lt; 40;\n</code></pre>\n\n<p>return the cities that have all lowest temperature values below 40.</p>\n\n<p>My understanding is that <code>HAVING</code> depends on <code>GROUP BY</code>, so <code>HAVING</code> can be implemented on top of <code>GROUP BY</code>. To keep things simple, I use ordinal numbers to represent columns/fields. So here is what I have: </p>\n\n<pre><code>import Data.List\nimport Data.Function\n\nat = flip (!!)\n\ngroupBySql n  = groupBy ((==) `on` (at n)). sortBy (comparing (at n) )\n\nhavingGroupBy f n tab = [ filter f | g &lt;- groupBySql 2 tab ]\n</code></pre>\n\n<p>And the test data:</p>\n\n<pre><code>--mimick weather table: temp_lo, temp_hi, city\nweather = [ [10, 30, 1], \n            [45, 99, 2],\n            [0, 3, 3],\n            [10, 35, 1],\n            [55, 103, 2],\n            [5, 29, 3]\n          ]\n\ntest1 = havingGroupBy ( (&lt;40).(at 0) ) 2 weather\n</code></pre>\n\n<p>But I have an error in writing <code>havingGroupBy</code>, and run out of time/energy.</p>\n\n<pre><code>*Main&gt; test1\n\n&lt;interactive&gt;:53:1:\n    No instance for (Show ([[b0]] -&gt; [[b0]]))\n      (maybe you haven't applied enough arguments to a function?)\n</code></pre>\n\n<p>A bunch of questions here:</p>\n\n<ol>\n<li><p>Obviously, I didn't get the types right while mimicking the <code>HAVING</code>, how to fix it.</p></li>\n<li><p>Is there a way to add type notation just for a parameter like <code>f</code> in <code>havingGroupBy f n tab = [ filter f | g &lt;- groupBySql 2 tab ]</code>, for debugging? My intended type for <code>f</code> is a boolean function on a row: <code>[a]-&gt;Bool</code>.</p></li>\n<li><p>Is my understanding of <code>GROUP BY</code> and <code>HAVING</code> correct so far?</p></li>\n</ol>\n"}]