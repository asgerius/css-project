[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1515627786, "post_id": 48197784, "comment_id": 83376802, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17495179/haskell-is-there-an-idiomatic-way-to-insert-every-item-in-a-list-into-its-own-l\">Haskell: Is there an idiomatic way to insert every item in a list into its own list?</a>, <a href=\"https://stackoverflow.com/questions/26772517/inverse-of-concat-transforming-a-flattened-list-into-a-nested-list/26772681\" title=\"inverse of concat transforming a flattened list into a nested list\">stackoverflow.com/questions/26772517/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/44815858/wraps-around-each-top-level-element-of-list\" title=\"wraps around each top level element of list\">stackoverflow.com/questions/44815858/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "is_accepted": false, "score": 2, "last_activity_date": 1515627629, "creation_date": 1515627629, "answer_id": 48197833, "question_id": 48197784, "link": "https://stackoverflow.com/questions/48197784/how-to-convert-list-into-nested-list-in-haskell/48197833#48197833", "title": "How to convert list into nested list in Haskell", "body": "<pre><code>nest [] = []\nnest (x:xs) = [x]:nest xs\n</code></pre>\n\n<p><code>nest (x:xs) = [x]:nest xs</code></p>\n\n<p>This splits the input up in to the first value of the array (x) and the rest of the array (xs) and then puts the first value in to an array and puts it at the start of an array where the next value is the next part of the array.</p>\n\n<p><code>nest [] = []</code></p>\n\n<p>This terminates the recursion when the list is empty.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1515628466, "post_id": 48197836, "comment_id": 83376978, "body": "Thank you, I could not achieve that.."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1515628482, "post_id": 48197836, "comment_id": 83376984, "body": "This is why I wish we had a standard library function <code>singleton x = [x]</code>. <code>(:[])</code> just looks like a golfing technique and <code>return</code> is confusing since it&#39;s so general. <code>map singleton [2, 5, 6]</code> would look far more natural IMHO."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515629226, "post_id": 48197836, "comment_id": 83377186, "body": "@SilvioMayolo Very true. I typed <code>(:[])</code> and had an immediate doubt if it will work at all."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1515629476, "post_id": 48197836, "comment_id": 83377264, "body": "Part of learning Haskell is learning to abstract and generalize. <code>return</code> (or <code>pure</code>) is a pretty low hurdle to clear, relatively speaking."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 3, "last_activity_date": 1515627641, "creation_date": 1515627641, "answer_id": 48197836, "question_id": 48197784, "link": "https://stackoverflow.com/questions/48197784/how-to-convert-list-into-nested-list-in-haskell/48197836#48197836", "title": "How to convert list into nested list in Haskell", "body": "<p>You should apply it every element of the list, not to the list itself, which can be achieved using <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a>:</p>\n\n<pre><code>map (\\x -&gt; [x]) [2, 5, 6]\n</code></pre>\n\n<p>or, equivalently</p>\n\n<pre><code>map (:[]) [2, 5, 6]\n</code></pre>\n\n<p>or, as you suggest, using <code>return</code> in place of <code>\\x -&gt; [x]</code></p>\n\n<pre><code>map return [2, 5, 6]\n</code></pre>\n\n<p>Note that in the latter case, the type of the value returned will be <code>(Monad m) =&gt; [m a]</code>, which is more general than <code>[[a]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 1, "last_activity_date": 1515628552, "creation_date": 1515628552, "answer_id": 48197951, "question_id": 48197784, "link": "https://stackoverflow.com/questions/48197784/how-to-convert-list-into-nested-list-in-haskell/48197951#48197951", "title": "How to convert list into nested list in Haskell", "body": "<p>A simple list comprehension also works here:</p>\n\n<pre><code>toNested :: [a] -&gt; [[a]]\ntoNested xs = [[x] | x &lt;- xs]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "closed_date": 1515644074, "accepted_answer_id": 48197836, "answer_count": 3, "score": 0, "last_activity_date": 1515628552, "creation_date": 1515627265, "question_id": 48197784, "link": "https://stackoverflow.com/questions/48197784/how-to-convert-list-into-nested-list-in-haskell", "closed_reason": "Duplicate", "title": "How to convert list into nested list in Haskell", "body": "<p>How can I turn a list into the nested list such as:</p>\n\n<pre><code>[p,q,q]  -&gt; [[p],[q],[q]]\n</code></pre>\n\n<p>I have tried this way:</p>\n\n<pre><code>return [2,5,6]  // But the result is wrong -&gt; [[2,5,6]] (correct would be  [[2],[5],[6]] )\n</code></pre>\n\n<p>Implementation of <code>return</code> looks like this:</p>\n\n<pre><code>return x = [x]\n</code></pre>\n"}, {"tags": ["haskell", "fold", "strictness"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515626383, "post_id": 48197627, "comment_id": 83376420, "body": "<code>map Just [1..]</code> is not equivalent to <code>Just [1..]</code>. The result is <code>[Just 1, Just 2, ...]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1515627059, "post_id": 48197627, "comment_id": 83376594, "body": "I think the OP is asking if <code>sequence</code> can construct the theoretical answer <code>Just [1..]</code> without having to examine the infinitely many elements of its input."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1515627847, "post_id": 48197627, "comment_id": 83376812, "body": "I feel like there are two separate questions here. Perhaps consider asking the <code>seqOptional</code> part as a separate question, with an MCVE of the behavior you describe. I can&#39;t exactly see how changing the order of the first two patterns would change anything, so if you have a specific call that does so, please post it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515629408, "post_id": 48197627, "comment_id": 83377241, "body": "&quot;Why does changing order of the first two patterns make function loop forever&quot; - I can&#39;t reproduce this behaviour. Please include a MCVE. You can&#39;t optimize <code>sequence (map Just [1..])</code> to <code>Just [1..]</code> because the former is bottom while the latter is not (these two terms do not denote the same value - the first doesn&#39;t even have a value). Maybe your question is, can one define a function <code>s</code> such that <code>s = sequence</code> for finite lists and <code>s (map Just [1..]) = Just [1..]</code> - the answer is still no, because <code>s</code> would have to examine infinitely many elements, and then terminate (which is nonsense)."}], "answers": [{"tags": [], "owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "is_accepted": false, "score": 1, "last_activity_date": 1515668406, "creation_date": 1515668406, "answer_id": 48205488, "question_id": 48197627, "link": "https://stackoverflow.com/questions/48197627/can-sequence-over-infinite-maybes-ever-terminate/48205488#48205488", "title": "Can sequence over infinite maybes ever terminate?", "body": "<p>I cannot answer your second question, but can answer your first one.</p>\n\n<p>In theory the compiler can detect and optimize cases like this, but due to the Halting Problem it's impossible for it to detect <em>every</em> instance of this pattern. The best it can do is a bunch of ad-hoc heuristics, and I think it would be more confusing if the termination of your program depended on whether a particular rewrite rule fired or not.</p>\n"}, {"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1597356931, "post_id": 48211470, "comment_id": 112114504, "body": "So, should I understand that in Haskell semantics, multiplying infinite amount of <code>1</code>s is bottom and not <code>1</code>? Where can I read more about this?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1597462808, "post_id": 48211470, "comment_id": 112147729, "body": "@sevo The <a href=\"https://en.wikibooks.org/wiki/Haskell/Denotational_semantics\" rel=\"nofollow noreferrer\">wikibook page on denotational semantics</a> is where I got started."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1515696150, "last_edit_date": 1515696150, "creation_date": 1515687218, "answer_id": 48211470, "question_id": 48197627, "link": "https://stackoverflow.com/questions/48197627/can-sequence-over-infinite-maybes-ever-terminate/48211470#48211470", "title": "Can sequence over infinite maybes ever terminate?", "body": "<p>Even if it could, it shouldn't.  As in @user2407038's comment, according to Haskell's <a href=\"https://en.wikibooks.org/wiki/Haskell/Denotational_semantics\" rel=\"nofollow noreferrer\">denotational semantics</a>, <code>sequence (map Just [1..])</code>  denotes a different value than <code>Just [1..]</code>.</p>\n\n<p>Haskell functions are <em>continuous</em>, which is the key tool for reasoning precisely about infinite data structures.  To illustrate what continuity means, suppose we have an infinite sequence of values which are increasingly defined, for example:</p>\n\n<pre><code>\u27c2\n1:\u27c2\n1:2:\u27c2\n1:2:3:\u27c2\n</code></pre>\n\n<p>Now, apply a function to each of them, let's say <code>tail</code>:</p>\n\n<pre><code>tail \u27c2             = \u27c2\ntail (1:\u27c2)         = \u27c2\ntail (1:2:\u27c2)       = 2:\u27c2\ntail (1:2:3:\u27c2)     = 2:3:\u27c2\n     \u22ee                 \u22ee\ntail [1..]         = [2..]\n</code></pre>\n\n<p>What it means for a function to be continuous is that if you apply the function to the <em>limit</em> of the sequence of arguments, you get the <em>limit</em> of the sequence of results, as illustrated in the final line.</p>\n\n<p>Now some observations about <code>sequence</code> on partially defined lists:</p>\n\n<pre><code>-- a \u27c2 after a bunch of Justs makes the result \u27c2\nsequence (Just 1 : Just 2 : \u27c2) = \u27c2\n-- a Nothing anywhere before the \u27c2 ignores the \u27c2 (early termination)\nsequence (Just 1 : Nothing : \u27c2) = Nothing\n</code></pre>\n\n<p>We only need the first observation.  We can now ask your question:</p>\n\n<pre><code>sequence (map Just \u27c2)       = sequence \u27c2                     = \u27c2\nsequence (map Just (1:\u27c2))   = sequence (Just 1 : \u27c2)          = \u27c2\nsequence (map Just (1:2:\u27c2)) = sequence (Just 1 : Just 2 : \u27c2) = \u27c2\n          \u22ee                                   \u22ee                 \u22ee\nsequence (map Just [1..])                                    = \u27c2\n</code></pre>\n\n<p>So by continuity, <code>sequence (map Just [1..]) = \u27c2</code>.  If you \"optimized\" it to give a different answer, that optimization would be incorrect.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 48211470, "answer_count": 2, "score": 3, "last_activity_date": 1590997192, "creation_date": 1515626115, "last_edit_date": 1590997192, "question_id": 48197627, "link": "https://stackoverflow.com/questions/48197627/can-sequence-over-infinite-maybes-ever-terminate", "title": "Can sequence over infinite maybes ever terminate?", "body": "<p>In other words, can the following be optimized to <code>Just [1..]</code>?</p>\n\n<pre><code>&gt; sequence (map Just [1..])\n*** Exception: stack overflow\n</code></pre>\n\n<p>There is also a more specific example in <code>data61/fp-course</code> where early termination is expected iff an <code>Empty</code> value is present.</p>\n\n<pre><code>seqOptional ::\n  List (Optional a)\n  -&gt; Optional (List a)\nseqOptional =\n    foldRight f (Full Nil)\n      where\n          f Empty _ = Empty\n          f _ Empty = Empty\n          f (Full a) (Full as) = Full (a :. as)\n</code></pre>\n\n<p>Why does changing order of the first two patterns make function loop forever as if <code>Empty</code> cannot be ever matched? I vaguely understand that such definition would make <code>f</code> strict in the infinite list, but I don't see what is actually causing this. </p>\n\n<p>Or are these unrelated problems?</p>\n\n<p>Side question: does it matter that stack is exhausted and not heap?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1515620047, "post_id": 48196423, "comment_id": 83373866, "body": "Use <code>div</code>, not <code>&#47;</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515620155, "post_id": 48196423, "comment_id": 83373918, "body": "Integer division is <code>div</code>, not <code>&#47;</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515621045, "post_id": 48196423, "comment_id": 83374367, "body": "@chepner, if you leave out the stated pre-condition, the correct division operation will be <code>quot</code>, not <code>div</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1515621163, "post_id": 48196423, "comment_id": 83374408, "body": "You have to put <code>div</code> in backquotes if you want to use it like an operator."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515621176, "post_id": 48196423, "comment_id": 83374418, "body": "In case anyone noticed that blip: I closed as dup then saw the edit.  It&#39;s basically a typo now but answerable."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1515621249, "post_id": 48196423, "comment_id": 83374450, "body": "Replace <code>x&#47;y</code> by <code>x `div` y</code> or <code>div x y</code>, but not <code>x div y</code>."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1515621252, "post_id": 48196423, "comment_id": 83374451, "body": "I was in the process of answering his follow-up questions when this was closed as dupe. I&#39;m not certain it&#39;s actually a duplicate of that, at least not insofar as anyone searching &quot;removing digits from an integer&quot; could be reasonably helped by the target."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515621294, "post_id": 48196423, "comment_id": 83374470, "body": "@WillemVanOnsem, I tend to think of <code>div</code> as a special-purpose function. The best default is probably &quot;Euclidean&quot; division, which it&#39;s sadly missing from the <code>Prelude</code>. Therefore <code>quot</code>, which is less distant from machine division, should be preferred."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1515621751, "post_id": 48196423, "comment_id": 83374680, "body": "FYI, you can use the following (imo easier to follow) code: <code>transform = (subtract 1) . (`quot` 100) . (*5) . (+9) . (*4) . (+6) . (*5)</code>, although the answer to &quot;Are there any other solutions better than trucating by a divisor?&quot; is already given in my <a href=\"https://stackoverflow.com/questions/48194477/drop-digits-from-an-integer/48194868#48194868\">answer to your other question</a>, so probably doesn&#39;t need repeating here."}, {"owner": {"reputation": 121, "user_id": 8178029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4f8246a1970468c61891554064bc5cb?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Temple", "link": "https://stackoverflow.com/users/8178029/christian-temple"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1515622074, "post_id": 48196423, "comment_id": 83374795, "body": "@hnefatl nice one"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515622420, "post_id": 48196423, "comment_id": 83374938, "body": "@dfeuer Google tells me \u201cEuclidean division\u201d is division that produces a result and a remainder. That exists in the Prelude as divMod, so I\u2019m not sure what you\u2019re trying to say."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1515626314, "post_id": 48196423, "comment_id": 83376392, "body": "@HTNW, I&#39;m referring specifically to the version that ensures <code>0 &lt;= mod x y &lt; y</code> along with the more obvious <code>y * div x y + mod x y = x</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515691111, "post_id": 48196423, "comment_id": 83406535, "body": "@dfeuer That <i>is</i> how mod works. mod\u2019s result has the same sign as the divisor, which fits your inequality for positive divisors."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1515711037, "post_id": 48196423, "comment_id": 83416099, "body": "@HTNW, yes, but not for negative divisors! It also happens that the way the <code>Prelude</code> does it takes one more comparison."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 8178029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4f8246a1970468c61891554064bc5cb?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Temple", "link": "https://stackoverflow.com/users/8178029/christian-temple"}, "edited": false, "score": 0, "creation_date": 1515622283, "post_id": 48196862, "comment_id": 83374883, "body": "can you take a look at my last question posted at the end? thanks."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 121, "user_id": 8178029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4f8246a1970468c61891554064bc5cb?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Temple", "link": "https://stackoverflow.com/users/8178029/christian-temple"}, "edited": false, "score": 0, "creation_date": 1515622371, "post_id": 48196862, "comment_id": 83374916, "body": "@ChristianTemple It&#39;s because <code>div</code> isn&#39;t an infix function, so the compiler gets confused by the precedence. Using <code>`div`</code> as Chepner commented will fix this. However, as you were told on your previous question, you should <b>post new questions</b>, rather than edit your existing one."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 3, "last_activity_date": 1515621875, "creation_date": 1515621875, "answer_id": 48196862, "question_id": 48196423, "link": "https://stackoverflow.com/questions/48196423/removing-digits-from-an-integer/48196862#48196862", "title": "Removing digits from an integer", "body": "<p>Removing digits at arbitrary positions is an interesting problem. This is probably easiest to do by converting to string and performing string manipulation, then reading back as an Int. Since <code>Int</code> implements both <code>Show</code> and <code>Read</code>, you can do:</p>\n\n<pre><code>type Digit = Int\n\nremoveDigits :: [Digit] -&gt; Int -&gt; Int\nremoveDigits digits = read . go 1 . show\n  where\n  go _ []     = []\n  go i (c:cs) | i `elem` digits = go cs (i+1)\n              | otherwise       = c : go cs (i+1)\n-- N.B. I chose 1-indexing here instead of 0-indexing because of your word choice\n-- \"remove the first, second, and sixth digits\" maps naturally to [1, 2, 6],\n-- though programmers may find that off-putting. YMMV.\n</code></pre>\n\n<p><code>removeDigits</code> here could be re-written as</p>\n\n<pre><code>read [c | (i, c) &lt;- zip [1..] (show n), i `notElem` digits]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 3, "last_activity_date": 1515625935, "last_edit_date": 1515625935, "creation_date": 1515624013, "answer_id": 48197263, "question_id": 48196423, "link": "https://stackoverflow.com/questions/48196423/removing-digits-from-an-integer/48197263#48197263", "title": "Removing digits from an integer", "body": "<p><strong>Can anyone explain what the error means?</strong></p>\n\n<p>The precedence in your first line is off - infix functions (like <code>/</code>) usually have a higher precedence than normal ones, so <code>print (...) / 100</code> is equivalent to <code>(print ...) / 100</code>, which is obviously problematic. You can wrap everything in brackets, or use the <code>$</code> function:</p>\n\n<pre><code>print $ ((((i * 5) + 6) * 4 + 9) * 5) / 100 - 1\n</code></pre>\n\n<p>Now as you've constrained <code>i</code> to be an <code>Int</code>, this will still give an error: <code>/</code> is only defined for instances of the <code>Fractional</code> typeclass, and <code>Int</code> isn't. You want integer division, <code>div</code> or <code>quot</code>, which operates only on <code>Integral</code>s (of which <code>Int</code> is an instance) and perform truncation as you want:</p>\n\n<pre><code>print $ ((((i * 5) + 6) * 4 + 9) * 5) `div` 100 - 1\n</code></pre>\n\n<p>Note the backticks (`), which allow a normal function to be used infix. You could write this as:</p>\n\n<pre><code>print $ (div ((((i * 5) + 6) * 4 + 9) * 5) 100) - 1\n</code></pre>\n\n<p>But then the brackets are making things really hard to read.</p>\n\n<hr>\n\n<p><strong>Are there any other solutions better than truncating by a divisor?</strong></p>\n\n<p>In general probably not, but <a href=\"https://stackoverflow.com/questions/48194477/drop-digits-from-an-integer\">as mentioned on your other question</a>, this particular equation will always give you the <strong>same result as your input</strong>, so you can just write:</p>\n\n<pre><code>main = getLine &gt;&gt;= print\n</code></pre>\n\n<hr>\n\n<p><strong>How can I remove digits at arbitrary positions?</strong></p>\n\n<p>Converting to a string and removing characters is likely your best bet. Something like the following will work, although it's arguably a bit dense:</p>\n\n<pre><code>removeDigits :: [Int] -&gt; Int -&gt; Int\nremoveDigits indices x = read . reverse . filterIndices indices . reverse . show $ x\n\nfilterIndices :: [Int] -&gt; [a] -&gt; [a]\nfilterIndices inds elems = map snd . filter ((`notElem` inds) . fst) . zip [1..] $ elems\n</code></pre>\n\n<p>Note this treats the last digit as the \"1st\" digit - it's a bit more natural to refer to digits with.</p>\n\n<hr>\n\n<p>An (in my opinion) easier to read representation of your existing code is:</p>\n\n<pre><code>transform = (subtract 1) . (`quot` 100) . (*5) . (+9) . (*4) . (+6) . (*5)\n</code></pre>\n\n<p>With this way of writing it, composition overrides the arithmetic precedence laws, letting us write it how it's read (\"times 5, add 6, times 4, ...\"). We have to use <code>subtract 1</code>, as <code>-1</code> is interpreted as the literal value <code>-1</code>, not as a unary function.</p>\n"}], "owner": {"reputation": 121, "user_id": 8178029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4f8246a1970468c61891554064bc5cb?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Temple", "link": "https://stackoverflow.com/users/8178029/christian-temple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 48197263, "answer_count": 2, "score": 1, "last_activity_date": 1515625935, "creation_date": 1515619971, "last_edit_date": 1515622177, "question_id": 48196423, "link": "https://stackoverflow.com/questions/48196423/removing-digits-from-an-integer", "title": "Removing digits from an integer", "body": "<p>Here's a homework problem I came across:</p>\n\n<blockquote>\n  <p>Input an integer, greater than or equal to 0. Multiply it by 5, add 6 to the product, multiply by 4, add 9 and multiply by 5. Then, remove the last two digits of the final number and subtract 1. Output the answer.</p>\n</blockquote>\n\n<p>Here's my code:</p>\n\n<pre><code>1  main = do\n2      putStrLn \"enter a non-negative integer: \"\n3      input &lt;- getLine\n4      let i = (read input :: Int)\n5      print ((((i * 5) + 6) * 4 + 9) * 5)/100-1\n</code></pre>\n\n<p>Here, I'm trying to truncate the last two digits by dividing it by 100, since this works in other languages. \nHowever, it gives me this error and I'm not sure what it means:</p>\n\n<pre><code>$ runhaskell Computations.hs\n\nComputations.hs:5:5: error:\n    \u2022 No instance for (Fractional (IO ())) arising from a use of \u2018/\u2019\n    \u2022 In the first argument of \u2018(-)\u2019, namely\n        \u2018print ((((x * 5) + 6) * 4 + 9) * 5) / 100\u2019\n      In a stmt of a 'do' block:\n        print ((((x * 5) + 6) * 4 + 9) * 5) / 100 - 1\n      In the expression:\n        do { putStrLn \"enter a non-negative integer: \";\n             input1 &lt;- getLine;\n             let x = (read input1 :: Int);\n             print ((((x * 5) + 6) * 4 + 9) * 5) / 100 - 1 }\n\nComputations.hs:5:5: error:\n    \u2022 No instance for (Num (IO ())) arising from a use of \u2018-\u2019\n    \u2022 In a stmt of a 'do' block:\n        print ((((x * 5) + 6) * 4 + 9) * 5) / 100 - 1\n      In the expression:\n        do { putStrLn \"enter a non-negative integer: \";\n             input1 &lt;- getLine;\n             let x = (read input1 :: Int);\n             print ((((x * 5) + 6) * 4 + 9) * 5) / 100 - 1 }\n      In an equation for \u2018main\u2019:\n          main\n            = do { putStrLn \"enter a non-negative integer: \";\n                   input1 &lt;- getLine;\n                   let x = ...;\n                   .... }\n</code></pre>\n\n<p>So, can anyone explain what the error means?</p>\n\n<p>Are there any other solutions better than trucating by a divisor?</p>\n\n<p>How can I remove digits at arbitrary positions? For example, remove the first, second and sixth digits from an integer?</p>\n\n<p>ps: input and output should match if done correctly.</p>\n\n<p>Update: I've changed \"/\" to \"div\" and it gives me this:</p>\n\n<pre><code>Computations.hs:5:12: error:\n    \u2022 Couldn't match expected type \u2018(Integer -&gt; Integer -&gt; Integer)\n                                    -&gt; Integer -&gt; Integer\u2019\n                  with actual type \u2018Int\u2019\n    \u2022 The function \u2018(((i * 5) + 6) * 4 + 9) * 5\u2019\n      is applied to two arguments,\n      but its type \u2018Int\u2019 has none\n      In the first argument of \u2018(-)\u2019, namely\n        \u2018((((i * 5) + 6) * 4 + 9) * 5) div 100\u2019\n      In the first argument of \u2018print\u2019, namely\n        \u2018(((((i * 5) + 6) * 4 + 9) * 5) div 100 - 1)\u2019\n</code></pre>\n\n<p>This part is strange: \"The function \u2018(((i * 5) + 6) * 4 + 9) * 5\u2019 is applied to two arguments\", why does haskell interpret it as a function?</p>\n"}, {"tags": ["haskell", "internationalization", "yesod"], "comments": [{"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1515988306, "post_id": 48195808, "comment_id": 83496079, "body": "You could open an issue at <a href=\"https://github.com/yesodweb/shakespeare/issues\" rel=\"nofollow noreferrer\">github.com/yesodweb/shakespeare/issues</a> for it."}, {"owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "reply_to_user": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 0, "creation_date": 1516040477, "post_id": 48195808, "comment_id": 83520459, "body": "Did that @Qwertie thanks <a href=\"https://github.com/yesodweb/shakespeare/issues/215\" rel=\"nofollow noreferrer\">github.com/yesodweb/shakespeare/issues/215</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1515620031, "creation_date": 1515620031, "answer_id": 48196430, "question_id": 48195808, "link": "https://stackoverflow.com/questions/48195808/is-it-possible-to-have-messages-with-multiple-lines-in-translation-files-of-yeso/48196430#48196430", "title": "Is it possible to have messages with multiple lines in translation files of Yesod?", "body": "<p>Judging from the source, no, it is not possible:</p>\n\n<pre><code>loadLangFile :: FilePath -&gt; IO [Def]\nloadLangFile file = do\n    bs &lt;- S.readFile file\n    let s = unpack $ decodeUtf8 bs\n    defs &lt;- fmap catMaybes $ mapM (parseDef . T.unpack . T.strip . T.pack) $ lines s\n    return defs\n</code></pre>\n\n<p>The <code>parseDef</code> function operates on the result of <code>lines</code> call, which splits the file contents by newline character.</p>\n"}], "owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 48196430, "answer_count": 1, "score": 1, "last_activity_date": 1515620031, "creation_date": 1515617250, "question_id": 48195808, "link": "https://stackoverflow.com/questions/48195808/is-it-possible-to-have-messages-with-multiple-lines-in-translation-files-of-yeso", "title": "Is it possible to have messages with multiple lines in translation files of Yesod?", "body": "<p>I am doing i18n in a Yesod scaffolded application as instructed in the following links: <a href=\"https://github.com/yesodweb/yesod/wiki/i18n-messages-in-the-scaffolding\" rel=\"nofollow noreferrer\">https://github.com/yesodweb/yesod/wiki/i18n-messages-in-the-scaffolding</a>, <a href=\"https://www.yesodweb.com/book/internationalization\" rel=\"nofollow noreferrer\">https://www.yesodweb.com/book/internationalization</a> and <a href=\"http://haddock.stackage.org/nightly-2016-04-19/shakespeare-2.0.8.1/Text-Shakespeare-I18N.html\" rel=\"nofollow noreferrer\">http://haddock.stackage.org/nightly-2016-04-19/shakespeare-2.0.8.1/Text-Shakespeare-I18N.html</a></p>\n\n<p>It looks like an <code>en.msg</code> file like:</p>\n\n<pre><code>Hello: Hello World!\nMultilineText: \n  line 1.\n  line 2.\n  etc...\nSingleLine: A single line message.\n</code></pre>\n\n<p>is not supprted, because of the <strong>MultilineText</strong> definition. Is this true or there is a way/syntax to do this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1515608895, "post_id": 48193207, "comment_id": 83368342, "body": "You only need to wrap the length in <code>fromIntegral</code>. <code>sum</code> gives a non-concrete <code>Num a</code> result, it&#39;s only <code>length</code> that forces its result to <code>Int</code>."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1515606192, "creation_date": 1515606192, "answer_id": 48193207, "question_id": 48193087, "link": "https://stackoverflow.com/questions/48193087/haskell-average-coding-method/48193207#48193207", "title": "Haskell average coding method", "body": "<p>The division operator <code>/</code> only works on fractional numbers (this is what the compiler is telling you in the error message).</p>\n\n<p>If you want to use integer division, use the <code>div</code> function:</p>\n\n<pre><code>print ( sum x `div` length x )\n</code></pre>\n\n<p>But then, of course, your average will also be integer, thus inaccurate.</p>\n\n<p>If you want to work with fractional numbers, you need to convert both <code>sum x</code> and <code>length x</code> to a fractional type first with <code>fromIntegral</code>, then divide:</p>\n\n<pre><code>print ( fromIntegral (sum x) / fromIntegral (length x) )\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5445766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1153f43f90506b1d234fd363e7c71b43?s=128&d=identicon&r=PG&f=1", "display_name": "J.Doe", "link": "https://stackoverflow.com/users/5445766/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "closed_date": 1515611995, "accepted_answer_id": 48193207, "answer_count": 1, "score": -2, "last_activity_date": 1515608256, "creation_date": 1515605765, "last_edit_date": 1515607643, "question_id": 48193087, "link": "https://stackoverflow.com/questions/48193087/haskell-average-coding-method", "closed_reason": "Duplicate", "title": "Haskell average coding method", "body": "<p>Can someone explain why i can't average using this kind of format</p>\n\n<pre><code>main = do\n    let x = [1,2,3,4]\n    print(sum x/length x)\n</code></pre>\n\n<p>I get this error for doing so </p>\n\n<pre><code> No instance for (Fractional Int) arising from a use of \u2018/\u2019\n     In the first argument of \u2018print\u2019, namely \u2018(sum x / length x)\u2019\n      In a stmt of a 'do' block: print (sum x / length x)\n</code></pre>\n"}, {"tags": ["haskell", "io", "monads", "io-monad"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1515583704, "post_id": 48186231, "comment_id": 83352442, "body": "Small nitpick: it&#39;s a <code>IO (IO a)</code>."}, {"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1515586105, "post_id": 48186231, "comment_id": 83353780, "body": "@Zeta thanks! now fixed"}], "answers": [{"comments": [{"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 0, "creation_date": 1515586378, "post_id": 48186924, "comment_id": 83353973, "body": "Could you add an example of what you talk about in the last paragraph?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "edited": false, "score": 0, "creation_date": 1515594008, "post_id": 48186924, "comment_id": 83358738, "body": "@Jsevillamol Updated my answer."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1515683019, "last_edit_date": 1515683019, "creation_date": 1515585261, "answer_id": 48186924, "question_id": 48186231, "link": "https://stackoverflow.com/questions/48186231/what-are-the-consequences-of-returning-an-io-action/48186924#48186924", "title": "What are the consequences of returning an IO action?", "body": "<p><code>IO</code> is often approximated to <code>State RealWorld</code>, that is a <code>State</code> monad that operates on the \"real world\". <code>return</code> for <code>State</code> produces an action that does not alter contained state. So, by analogy, <code>return</code>ing anything to <code>IO</code> doesn't do anything as well. Not only when you <code>return</code> some <code>IO a</code>, but any <code>a</code>.</p>\n\n<p>Returning an <code>IO</code> action may be used to build up a computation in one place (capturing some values into a closure along the way) and execute it somewhere else. Much like passing a callback in C.</p>\n\n<p>Actually, to build up an <code>IO</code> computation and pass it somewhere else you can use a <code>let</code> inside of a do-block:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let act = readFile \"somefile\" -- action is not performed yet\n  foo act -- pass the action as a parameter\n\nfoo :: IO () -&gt; IO ()\nfoo act = do\n  .. do something\n  result &lt;- act -- actually perform the action\n  ..\n</code></pre>\n\n<p>In this case you don't need to <code>return</code> an <code>IO a</code> value.</p>\n\n<p>But if the process of building that computation itself requires you to perform <code>IO</code> actions, that's where you'd need such a thing. In our example, let's ask user of filename to be opened:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  act &lt;- do\n    filename &lt;- getLine\n    return (readFile filename)\n  foo act\n</code></pre>\n\n<p>Here, we need a <code>filename</code> to create our action, but <code>getLine</code> is in <code>IO</code> as well. That's where additional level of <code>IO</code> comes out. Of course, this example is synthetic, as you can just do <code>filename &lt;- getLine</code> right in <code>main</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1515592657, "last_edit_date": 1515592657, "creation_date": 1515590458, "answer_id": 48188423, "question_id": 48186231, "link": "https://stackoverflow.com/questions/48186231/what-are-the-consequences-of-returning-an-io-action/48188423#48188423", "title": "What are the consequences of returning an IO action?", "body": "<p>Under the hood, the runtime effectively discards the <em>result</em> of the <code>IO</code> action <code>main</code>, which is why it is usually defined as <code>IO ()</code>. This means that if <code>main</code> actually has a type like <code>IO (IO Int)</code>, there is no real issue. The <code>IO</code> action is executed, and the result (another <code>IO</code> action) is discarded, unexecuted.</p>\n\n<p>Deeper in your program, you are more likely to just trigger a type error. For example, <code>fmap doSomething (return . getLine)</code> won't type-check if you meant <code>fmap doSomething getLine</code>.</p>\n"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 48186924, "answer_count": 2, "score": 3, "last_activity_date": 1515683019, "creation_date": 1515582973, "last_edit_date": 1515593022, "question_id": 48186231, "link": "https://stackoverflow.com/questions/48186231/what-are-the-consequences-of-returning-an-io-action", "title": "What are the consequences of returning an IO action?", "body": "<p>In Haskell, the type constructor <code>IO</code> is a monad equipped with a <code>return</code> statement that lifts any expression to its <code>IO</code> version.</p>\n\n<p>Nothing prevents us from lifting what is already an <code>IO</code> action to its <code>IO</code> version - giving us a type of the form <code>IO (IO a)</code>.</p>\n\n<p>So I can for example write the following program:</p>\n\n<pre><code>main = return . print $ \"Hello world\"\n</code></pre>\n\n<p>Which upon execution does exactly nothing.</p>\n\n<p>My question is, what happens under the hood when this main is executed?</p>\n\n<p>Are there any situations where it makes sense to <code>return</code> an IO action?</p>\n"}, {"tags": ["haskell", "nixos"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1515589699, "post_id": 48186040, "comment_id": 83356000, "body": "The solution would be to add <code>emacs</code> to the dependency list, though, rather than using an impure environment, right?"}, {"owner": {"reputation": 402, "user_id": 4476886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826ef771ed046477d324a4dc64aa17b1?s=128&d=identicon&r=PG&f=1", "display_name": "SongWithoutWords", "link": "https://stackoverflow.com/users/4476886/songwithoutwords"}, "edited": false, "score": 0, "creation_date": 1515601748, "post_id": 48186040, "comment_id": 83364231, "body": "Thanks! I haven&#39;t had time to use your suggestions just yet, but this is very informative."}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": true, "score": 3, "last_activity_date": 1515593155, "last_edit_date": 1515593155, "creation_date": 1515582438, "answer_id": 48186040, "question_id": 48182820, "link": "https://stackoverflow.com/questions/48182820/running-shell-commands-from-haskell-in-nixos/48186040#48186040", "title": "Running shell commands from Haskell in NixOS", "body": "<p>Both your shell and <code>callCommand</code> use the <code>PATH</code> environment variable, so it seems like stack is changing that. It turns out that stack uses a pure nix shell by default, but you also want to access your user environment, which is 'impure'.</p>\n\n<p>To quote the <a href=\"https://docs.haskellstack.org/en/v1.0.2/nix_integration/#the-nix-shell\" rel=\"nofollow noreferrer\">stack documenation</a></p>\n\n<blockquote>\n  <p>By default, stack will run the build in a pure Nix build environment (or shell), which means the build should fail if you haven't specified all the dependencies in the packages: section of the stack.yaml file, even if these dependencies are installed elsewhere on your system. This behaviour enforces a complete description of the build environment to facilitate reproducibility. To override this behaviour, add pure: false to your stack.yaml or pass the --no-nix-pure option to the command line.</p>\n</blockquote>\n\n<p>Another solution is to add Emacs to <code>nix.dependencies</code> in <code>stack.yaml</code> (thanks @chepner). It has the benefit that some version of Emacs will always be available when a developer runs the tests, but that Emacs may not be the Emacs they want to use. You may be able to work around that using something like <code>~/.config/nixpkgs/config.nix</code>, unless they have configured their Emacs elsewhere, like the system configuration or perhaps a home manager. I'd prefer the simple but impure <code>$PATH</code> solution.</p>\n"}], "owner": {"reputation": 402, "user_id": 4476886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826ef771ed046477d324a4dc64aa17b1?s=128&d=identicon&r=PG&f=1", "display_name": "SongWithoutWords", "link": "https://stackoverflow.com/users/4476886/songwithoutwords"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 48186040, "answer_count": 1, "score": 5, "last_activity_date": 1515593155, "creation_date": 1515571572, "last_edit_date": 1515576226, "question_id": 48182820, "link": "https://stackoverflow.com/questions/48182820/running-shell-commands-from-haskell-in-nixos", "title": "Running shell commands from Haskell in NixOS", "body": "<p>I'm fairly new to NixOS, and am trying to invoke emacs from a Haskell program using the following function:</p>\n\n<pre><code>ediff :: String -&gt; String -&gt; String -&gt; IO ()\nediff testName a b = do\n  a' &lt;- writeSystemTempFile (testName ++ \".expected\") a\n  b' &lt;- writeSystemTempFile (testName ++ \".received\") b\n  let quote s = \"\\\"\" ++ s ++ \"\\\"\"\n  callCommand $ \"emacs --eval \\'(ediff-files \" ++ quote a' ++ quote b' ++ \")\\'\"\n</code></pre>\n\n<p>When I run the program that invokes this command using <code>stack test</code>, I get the following result (interspersed with unit test results):</p>\n\n<pre><code>/bin/sh: emacs: command not found\nException: callCommand: emacs --eval '(ediff-files \"/run/user/1000/ast1780695788709393584.expected\" \"/run/user/1000/ast4917054031918502651.received\")'\n</code></pre>\n\n<p>When I run the command that failed to run above from my shell, it works flawlessly. How can I run processes from Haskell in NixOS, as though I had invoked them directly, so that they can access the same commands and configurations as my user?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1515560359, "post_id": 48180483, "comment_id": 83341041, "body": "&quot;Aren&#39;t these two statements the same?&quot; Obviously they are not."}, {"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1515564994, "post_id": 48180483, "comment_id": 83342456, "body": "And obviously that was a rhetorical question meaning &quot;why are they not the same&quot;..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1515566547, "post_id": 48180483, "comment_id": 83342954, "body": "A rhetorical question? What is this, literarycriticism.stackexchange.com? Anyway the answer is pretty straightforward if you replace <code>[x,-x]</code> with a non-list. Try <code>(-x, x)</code>. The first list happily computes away and the second one becomes an error."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1515595099, "post_id": 48180483, "comment_id": 83359539, "body": "Why would they be the same? <code>&lt;-</code> does not assign the list <code>[x, -x]</code> to <code>pxnx</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "edited": false, "score": 0, "creation_date": 1515565202, "post_id": 48180735, "comment_id": 83342517, "body": "What do you mean by &quot;one by one&quot;? That seems to be the key difference."}, {"owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "reply_to_user": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "edited": false, "score": 0, "creation_date": 1515602773, "post_id": 48180735, "comment_id": 83364905, "body": "By &quot;one by one&quot; I mean that each element in a list is mapped to a single element in the output or intermediate list. This is what the <code>&lt;-</code> operator does. For example, say we just had <code>[x | x &lt;- [1, -1]]</code> this would yield a list where the elements in <code>[1, -1]</code> are each separate elements in the resulting list."}, {"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "edited": false, "score": 0, "creation_date": 1515625407, "post_id": 48180735, "comment_id": 83376086, "body": "Ah! Okay now I see. I had a wrong idea of what <code>&lt;-</code> does."}], "tags": [], "owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "is_accepted": false, "score": 2, "last_activity_date": 1515561494, "creation_date": 1515561494, "answer_id": 48180735, "question_id": 48180483, "link": "https://stackoverflow.com/questions/48180483/why-does-constructing-elements-of-list-comprehensions-in-place-produce-a-differe/48180735#48180735", "title": "Why does constructing elements of list comprehensions in place produce a different result from constructing in a constraint?", "body": "<p>Let's take a look at both of those expressions.</p>\n\n<p>In the first one we can see that on the left side of the list comprehension we have a list of two elements <code>x</code> and <code>-x</code>, so we know that the list we get from the list comprehension must be at least a depth 2 list <code>[[a]]</code> for some type <code>a</code> (probably bound by some number typeclass).</p>\n\n<p>On the right side of the list comprehension we are taking the positive integers <code>1..</code> and storing them, one by one, into <code>x</code>.</p>\n\n<p>So this expression should give us a list of lists of the positive intergers paired with their negative counterparts.</p>\n\n<pre><code>[[x,-x] | x &lt;- [1..]]\n</code></pre>\n\n<p>In the second one we can see that the left side just contains a variable, so all we can determine from that alone is that the list must be of at least depth 1.</p>\n\n<p>If we look at the right side we can see that like in the previous expression it is storing the positive integers into <code>x</code>. However, unlike the previous expression it is placing the + - integer pairs one by one into <code>pxnx</code>.</p>\n\n<p>This results in this expression yielding a list of type <code>[a]</code>, as opposed to the previous expression's type of <code>[[a]]</code>.</p>\n\n<p>Additionally, this list contains all of the positive numbers and their negative counterparts, like the previous list, however it instead stores them all in the same list, rather than storing each pair in a separate list.</p>\n\n<pre><code>[pxnx | x &lt;- [1..], pxnx &lt;- [x,-x]]\n</code></pre>\n\n<p>This difference is due to the fact that in <code>pxnx &lt;- [x,-x]</code>, the values <code>x</code> and <code>-x</code> are stored, <strong>one by one</strong>, into pxnx. Whereas in the first expression they are stored as a combined list.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1515662633, "post_id": 48184044, "comment_id": 83387958, "body": "&quot;sugar&quot; is a bit too strong a claim;  <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">haskell2010 report</a> says: &quot;List comprehensions satisfy these identities, which may be used as a translation into the kernel&quot; and then gives a set of re-write rules based in <code>concatMap</code> directly. <code>MonadComprehensions</code> probably do translate into <code>do</code> code. (Just a side note.)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1515667540, "post_id": 48184044, "comment_id": 83391339, "body": "@WillNess: Fair enough, made the wording a bit more bitter. ;)"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 3, "last_activity_date": 1515666970, "last_edit_date": 1515666970, "creation_date": 1515576214, "answer_id": 48184044, "question_id": 48180483, "link": "https://stackoverflow.com/questions/48180483/why-does-constructing-elements-of-list-comprehensions-in-place-produce-a-differe/48184044#48184044", "title": "Why does constructing elements of list comprehensions in place produce a different result from constructing in a constraint?", "body": "<pre><code>l1 = [[x,-x] | x &lt;- [1..]]\n\nl2 = [pxnx | x &lt;- [1..], pxnx &lt;- [x,-x]]\n</code></pre>\n\n<p>These list comprehensions are equivalent to operations in the list monad. In <code>do</code> notation they would be:</p>\n\n<pre><code>l1 = do\n  x &lt;- [1..]\n  return [x,-x]\n\nl2 = do\n  x &lt;- [1..]\n  pxnx &lt;- [x,-x]\n  return pxnx\n</code></pre>\n\n<p>These, in turn, desugar into calls to bind (<code>&gt;&gt;=</code>) and <code>return</code>:</p>\n\n<pre><code>l1 = [1..] &gt;&gt;= \\x -&gt; return [x,-x]\n\nl2 = [1..] &gt;&gt;= \\x -&gt; [x,-x] &gt;&gt;= \\pxnx -&gt; return pxnx\n</code></pre>\n\n<p>Finally, we can inline the definitions of <code>&gt;&gt;=</code> and <code>return</code> for lists:</p>\n\n<pre><code>l1 = concatMap (\\x -&gt; [[x,-x]]) [1..]\n\nl2 = concatMap (\\x -&gt; concatMap (\\pxnx -&gt; [pxnx]) [x,-x]) [1..]\n</code></pre>\n\n<p>And simplify:</p>\n\n<pre><code>l1 = map (\\x -&gt; [x,-x]) [1..]\n\nl2 = concatMap (\\x -&gt; [x,-x]) [1..]\n</code></pre>\n\n<p>So <code>l2</code> is exactly the same as <code>concat l1</code>. Note that <code>&lt;-</code> implies \u201cexecute this action\u201d, which for the list monad means \u201citerate over each element of the list\u201d. If you wanted something resembling <code>l2</code> but with the same result as <code>l1</code>, you might use <code>let</code> instead of <code>&lt;-</code>:</p>\n\n<pre><code>l2 = [pxnx | x &lt;- [1..], let pxnx = [x,-x]]\n</code></pre>\n\n<p>This is just as if you had written the following in <code>do</code> notation:</p>\n\n<pre><code>l2 = do\n  x &lt;- [1..]\n  let pxnx = [x,-x]\n  return pxnx\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 1, "last_activity_date": 1515601000, "creation_date": 1515601000, "answer_id": 48191740, "question_id": 48180483, "link": "https://stackoverflow.com/questions/48180483/why-does-constructing-elements-of-list-comprehensions-in-place-produce-a-differe/48191740#48191740", "title": "Why does constructing elements of list comprehensions in place produce a different result from constructing in a constraint?", "body": "<p>They produce a different result because <code>&lt;-</code> is not <code>=</code>.</p>\n\n<p>These are the same:</p>\n\n<pre><code>l1 = [[x,-x] | x &lt;- [1..]]\n\nl2 = [pxnx | x &lt;- [1..], let pxnx = [x,-x]]\n</code></pre>\n\n<p>But <code>pxnx &lt;- [x, -x]</code> loosely means <code>for pxnx in [x, -x]</code>, so in your case, we get one of each of <code>x</code> and <code>-x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1515611606, "creation_date": 1515611606, "answer_id": 48194528, "question_id": 48180483, "link": "https://stackoverflow.com/questions/48180483/why-does-constructing-elements-of-list-comprehensions-in-place-produce-a-differe/48194528#48194528", "title": "Why does constructing elements of list comprehensions in place produce a different result from constructing in a constraint?", "body": "<p>Your definitions can be written equivalently, as others have noted, as</p>\n\n<pre><code>l1 = [[x,-x] | x &lt;- [1..]]\n   = [pxnx | x &lt;- [1..], let pxnx = [x,-x]  ]\n   = [pxnx | x &lt;- [1..], pxnx &lt;-   [[x,-x]] ]      -- NB\n\nl2 = [pxnx | x &lt;- [1..], pxnx &lt;-    [x,-x]  ]\n</code></pre>\n\n<p>As can readily be seen, these are <em>not</em> equivalent expressions.</p>\n\n<p>The question boils down to the meaning of <code>&lt;-</code> in list comprehensions. </p>\n\n<p>More generally, this can be written in pseudocode as</p>\n\n<pre><code>l1 = for each x in [1..]:\n        yield [x,-x]\n\n   = for each x in [1..]:\n        for each pxnx in [[x,-x]]:    -- NB: only _one_ element in this list\n            yield pxnx\n\nl2 = for each x in [1..]:\n        for each pxnx in  [x,-x] :    -- NB: _two_ elements in this list\n            yield pxnx\n</code></pre>\n\n<p>Though the two <code>for</code> loops are <em>nested</em>, the <code>yield</code> is \"the same\": it specifies the next element in the list being constructed.</p>\n\n<p>So you see, you do <em>not</em> \"construct it in the constraint\". This is a <em>nested generator</em>.</p>\n"}], "owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 48194528, "answer_count": 4, "score": 2, "last_activity_date": 1515666970, "creation_date": 1515559777, "question_id": 48180483, "link": "https://stackoverflow.com/questions/48180483/why-does-constructing-elements-of-list-comprehensions-in-place-produce-a-differe", "title": "Why does constructing elements of list comprehensions in place produce a different result from constructing in a constraint?", "body": "<p>Why do these two comprehensions produce different lists?</p>\n\n<pre><code>l1 = [[x,-x] | x &lt;- [1..]]\n\nl2 = [pxnx | x &lt;- [1..], pxnx &lt;- [x,-x]]\n</code></pre>\n\n<p>Aren't these two statements the same? The results look like this:</p>\n\n<pre><code>Prelude&gt; take 10 l1\n[[1,-1],[2,-2],[3,-3],[4,-4],[5,-5],[6,-6],[7,-7],[8,-8],[9,-9],[10,-10]]\n\nPrelude&gt; take 10 l2\n[1,-1,2,-2,3,-3,4,-4,5,-5]\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "is_accepted": true, "score": 3, "last_activity_date": 1515559399, "creation_date": 1515559399, "answer_id": 48180437, "question_id": 48180070, "link": "https://stackoverflow.com/questions/48180070/haskell-appending-lists-and-recursion/48180437#48180437", "title": "haskell appending lists and recursion", "body": "<p>The issue you appear to be having is a precedence problem.</p>\n\n<p>When you have the following expression.</p>\n\n<pre><code>f y:xs\n</code></pre>\n\n<p>It is treated by the compiler as the following.</p>\n\n<pre><code>(f y) : xs\n</code></pre>\n\n<p>You can see this in action in the error message, where it actually refers to the first arguement of <code>:</code> as being <code>f y</code> rather than just <code>y</code>.</p>\n\n<pre><code>Couldn't match expected type \u2018Int\u2019 with actual type \u2018[Int]\u2019\nIn the first argument of \u2018(:)\u2019, namely \u2018f y\u2019\nIn the expression: f y : xs\n</code></pre>\n\n<p>In this case the fix is easy. You just need to specially note that the <code>:</code> operation should be applied and its result passed into the call to <code>f</code>.</p>\n\n<p>To do this, you just need to wrap it in parentheses.</p>\n\n<pre><code>f (y:xs)\n</code></pre>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 48180437, "answer_count": 1, "score": -1, "last_activity_date": 1515559399, "creation_date": 1515556532, "question_id": 48180070, "link": "https://stackoverflow.com/questions/48180070/haskell-appending-lists-and-recursion", "title": "haskell appending lists and recursion", "body": "<p>In haskell I want to write code which will do the following using recursion:\n1. compare first 2 elements if x is less than y then append y then recursively do the comparison else append x and do the recursion again.</p>\n\n<p>I did like this:</p>\n\n<pre><code>f:: [Int] -&gt; [Int]\nf(x:[]) = [x]\nf(x:y:xs)\n    | x &lt;= y    = y:f xs\n    | otherwise = x:f xs\n</code></pre>\n\n<p>but this will do append after taking next 2 elements, i want to append before passing to recursion. But below didn't work as compiler seems to be passing first element for recursion and then the list hence compilation errors.</p>\n\n<pre><code>f(x:[]) = [x]\nf(x:y:xs)\n    | x &lt;= y    = f y:xs\n    | otherwise = f x:xs\n</code></pre>\n\n<p>How shall i append the element to the list before passing to next recursion.</p>\n"}, {"tags": ["haskell", "generics", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515559439, "post_id": 48179380, "comment_id": 83340789, "body": "What do the <code>Rep</code> types look like for those? You are actually deriving <code>Generic</code> for them, right?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515559981, "post_id": 48179380, "comment_id": 83340939, "body": "Side note: it looks like <code>t</code> is supposed to be a proxy of your choice; no need for <code>undefined</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515599784, "post_id": 48179380, "comment_id": 83362871, "body": "@dfeur yeah the last issue was I just didn&#39;t derive the Generic instance :/ I&#39;ve added a working answer and edited the question so the Q and A are both clearer"}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 6, "last_activity_date": 1515599662, "last_edit_date": 1515599662, "creation_date": 1515553642, "answer_id": 48179707, "question_id": 48179380, "link": "https://stackoverflow.com/questions/48179380/getting-the-data-constructor-name-as-a-string-using-ghc-generics/48179707#48179707", "title": "Getting the data constructor name as a string using GHC.Generics", "body": "<p>Adapting this gist by Nathan Howell: <a href=\"https://gist.github.com/NathanHowell/6201625\" rel=\"noreferrer\">https://gist.github.com/NathanHowell/6201625</a> :</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport GHC.Generics\n\nconstrName :: (HasConstructor (Rep a), Generic a)=&gt; a -&gt; String\nconstrName = genericConstrName . from \n\nclass HasConstructor (f :: * -&gt; *) where\n  genericConstrName :: f x -&gt; String\n\ninstance HasConstructor f =&gt; HasConstructor (D1 c f) where\n  genericConstrName (M1 x) = genericConstrName x\n\ninstance (HasConstructor x, HasConstructor y) =&gt; HasConstructor (x :+: y) where\n  genericConstrName (L1 l) = genericConstrName l\n  genericConstrName (R1 r) = genericConstrName r\n\ninstance Constructor c =&gt; HasConstructor (C1 c f) where\n  genericConstrName x = conName x\n\n--------------\ndata Foo = Bar Int | Baz Float deriving Generic\nnewtype X = X Char deriving Generic\ndata Y = Y deriving Generic\n</code></pre>\n\n<p>We can do:</p>\n\n<pre><code>*Main&gt; constrName (Bar 1)\n\"Bar\"\n*Main&gt; constrName $ X 'a'\n\"X\"\n*Main&gt; constrName Y\n\"Y\"\n</code></pre>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1515599662, "creation_date": 1515550934, "last_edit_date": 1515599305, "question_id": 48179380, "link": "https://stackoverflow.com/questions/48179380/getting-the-data-constructor-name-as-a-string-using-ghc-generics", "title": "Getting the data constructor name as a string using GHC.Generics", "body": "<p>I'd like something like the following:</p>\n\n<pre><code>constrName :: Data a=&gt; a -&gt; String\nconstrName = showConstr . toConstr\n</code></pre>\n\n<p>But for <code>GHC.Generics</code>. I see the <code>Constructor</code> class, but don't see any instances in scope. I'm using <code>base-4.8.1.0</code>.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515546051, "post_id": 48178849, "comment_id": 83337795, "body": "I&#39;m very confused. There&#39;s no plus sign in your first example, yet there&#39;s a <code>BinOp Plus</code> in the last. The first only differs in indentation, and the last differs significantly and also seems like it might be missing some parentheses. Are the two examples related in any way?"}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515546597, "post_id": 48178849, "comment_id": 83337936, "body": "Sorry I wrote that in a confusing way. I&#39;ve just updated the question."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515546866, "post_id": 48178849, "comment_id": 83338003, "body": "Do you simply want it to be indented in some uniform way, or do you want the indentation to match the indentation of the input? If the former, I believe @LeventErkok&#39;s answer is correct. The latter is a bit more complicated."}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515547020, "post_id": 48178849, "comment_id": 83338044, "body": "I would like the indentation to match how many places to the right the element is in the tree."}], "answers": [{"comments": [{"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "edited": false, "score": 0, "creation_date": 1515547302, "post_id": 48178953, "comment_id": 83338107, "body": "Hi Levent, thank you for the reply. Although I could use a library is there not a simple method of achieving something like this in a functional language? If mutable variables were possible it would be a matter of storing the places traversed to the right and adding it as indentation. I understand I might be asking for something more difficult then it sounds."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "edited": false, "score": 0, "creation_date": 1515601395, "post_id": 48178953, "comment_id": 83363998, "body": "Hi Michael.. Well, somebody has to write the code. You can surely do it, but efficient and &quot;pretty&quot; printing is a surprisingly tricky topic. (Google search will find you lots of papers on the topic, and hackage has many packages.) The advantage of <code>pretty-show</code> is that it&#39;s easy to use and does all the heavy lifting for you. You can even &quot;convince&quot; ghci to use it as you play with the command line. See here: <a href=\"http://teh.id.au/posts/2017/02/13/interactive-print/index.html\" rel=\"nofollow noreferrer\">teh.id.au/posts/2017/02/13/interactive-print/index.html</a>"}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "edited": false, "score": 0, "creation_date": 1515619891, "post_id": 48178953, "comment_id": 83373800, "body": "That makes sense. Thank you for the doc it looks interesting. I&#39;ll give pretty-show a try. Thank you for the help."}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 2, "last_activity_date": 1515546762, "creation_date": 1515546762, "answer_id": 48178953, "question_id": 48178849, "link": "https://stackoverflow.com/questions/48178849/printing-an-ast-to-show-indentation/48178953#48178953", "title": "Printing an AST to show indentation", "body": "<p>There are several packages on Hackage that lets you show such tree structures in an \"indented\" way. Previously, I used Iavor Diatchki's <code>pretty-show</code> package, and it does a really good job. You might want to give that a try:  <a href=\"https://hackage.haskell.org/package/pretty-show\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/pretty-show</a></p>\n"}, {"tags": [], "owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "is_accepted": false, "score": 1, "last_activity_date": 1515552903, "creation_date": 1515552903, "answer_id": 48179622, "question_id": 48178849, "link": "https://stackoverflow.com/questions/48178849/printing-an-ast-to-show-indentation/48179622#48179622", "title": "Printing an AST to show indentation", "body": "<p>You could create your own <code>prettyPrint</code> function which takes in the AST and the level of indentation and then recursively prints the nodes in the AST, incrementing the indentation level as necessary.</p>\n\n<p>In this function you will need to specifically handle the AST nodes that increase the indentation levels.</p>\n\n<p>Here is an example of such a function.</p>\n\n<pre><code>data AST =\n    Function String [String] [AST]\n  | BinOp AST AST AST\n  | Plus\n  | FunctionCall String [AST]\n  | Variable String\n  deriving (Show)\n\nprettyPrint :: Int -&gt; AST -&gt; String\nprettyPrint n (Function a b c) = \"Function \" ++ show a ++ \" \" ++ show b ++\n    foldl (++) \"\" (map (\\x -&gt; \"\\n\" ++ take (n + 1) (repeat '\\t') ++\n    prettyPrint (n + 1) x) c)\nprettyPrint n a = show a\n</code></pre>\n\n<p>Note that there is probably a much cleaner way to write this function, but this version shows the idea in action.</p>\n\n<p>If we run this on the example AST you gave, we get the following.</p>\n\n<pre><code>\u03bb ~ let a = (Function \"foo\" [\"x\",\"y\"] [FunctionCall \"foo\" [Variable \"x\",Variable \"y\"], BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])])\n\u03bb ~ putStrLn (prettyPrint 0 a)\nFunction \"foo\" [\"x\",\"y\"]\n    FunctionCall \"foo\" [Variable \"x\",Variable \"y\"]\n    BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])\n</code></pre>\n\n<p>This also works with multiple levels of indentation.</p>\n\n<pre><code>\u03bb ~ let b = (Function \"foo\" [\"x\",\"y\"] [FunctionCall \"foo\" [Variable \"x\",Variable \"y\"], BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" []), Function \"bar\" [\"x\"] [BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])]])\nb :: AST\n\u03bb ~ putStrLn (prettyPrint 0 b)\nFunction \"foo\" [\"x\",\"y\"]\n    FunctionCall \"foo\" [Variable \"x\",Variable \"y\"]\n    BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])\n    Function \"bar\" [\"x\"]\n        BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])\n</code></pre>\n\n<p>Note, that this is only if you want to implement the functionality yourself. It is probably a much better move in the long run to use a pretty printing library that handles this for you.</p>\n"}], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 1, "accepted_answer_id": 48178953, "answer_count": 2, "score": 0, "last_activity_date": 1515552903, "creation_date": 1515545842, "last_edit_date": 1515546566, "question_id": 48178849, "link": "https://stackoverflow.com/questions/48178849/printing-an-ast-to-show-indentation", "title": "Printing an AST to show indentation", "body": "<p>I would like to print an Abstract Syntax Tree in Haskell. Currently I can print the tree out line by line but what I would prefer is to indent it out for each block the parsed code is within.    </p>\n\n<p><strong>E.g.</strong></p>\n\n<p><strong>Code to parse:</strong></p>\n\n<pre><code>module test\nfoo(x,y):\n    foo x y\n    x + y \n</code></pre>\n\n<p>Here are my functions to create and print the AST.</p>\n\n<p><strong>Returns the tree.</strong></p>\n\n<pre><code>parse :: String -&gt; Either ParseError [Expr]\nparse = runParser (many expr &lt;* eof) () \"[input]\" . indentConfig\n</code></pre>\n\n<p><strong>Prints the tree.</strong></p>\n\n<pre><code>printTree :: String -&gt; IO ()\nprintTree line = do\n    let res = parse line\n    case res of\n        Left err -&gt; print err\n        Right ex -&gt; mapM_ print ex\n</code></pre>\n\n<p><strong>Current output:</strong></p>\n\n<pre><code>Function \"foo\" [\"x\",\"y\"] (FunctionCall \"foo\" [Variable \"x\",Variable \"y\"])\nBinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])\n</code></pre>\n\n<p><strong>Desired output:</strong></p>\n\n<pre><code>Function \"foo\" [\"x\",\"y\"] \n    (FunctionCall \"foo\" [Variable \"x\",Variable \"y\"])\n    BinOp Plus (FunctionCall \"x\" []) (FunctionCall \"y\" [])\n</code></pre>\n\n<p>What is the best method of achieving this? </p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 6, "creation_date": 1515545036, "post_id": 48178750, "comment_id": 83337549, "body": "Can you say more than &quot;is not worked well&quot;? What problems did you run into?  Did you try to fix that? Have you tried any other solutions such as the <code>async</code> package?"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "is_accepted": false, "score": 0, "last_activity_date": 1515598088, "creation_date": 1515598088, "answer_id": 48190778, "question_id": 48178750, "link": "https://stackoverflow.com/questions/48178750/parallel-random-number-generation/48190778#48190778", "title": "Parallel random number generation", "body": "<p>Try forkIO from the Control.Concurrent package:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent.html</a></p>\n\n<p>Like this:</p>\n\n<pre><code>rs &lt;- forM params $ \\n -&gt; forkIO $ do\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9195860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01be63b75d2c7713daca022d97b07ba9?s=128&d=identicon&r=PG&f=1", "display_name": "ijaketak", "link": "https://stackoverflow.com/users/9195860/ijaketak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1515598088, "creation_date": 1515544913, "question_id": 48178750, "link": "https://stackoverflow.com/questions/48178750/parallel-random-number-generation", "title": "Parallel random number generation", "body": "<p>I want to execute the very long calculation with random number generations parallely.</p>\n\n<pre><code>import Control.DeepSeq\nimport Control.Parallel.Strategies\nimport Control.Monad\nimport System.Random.MWC\nimport System.Random.MWC.Distributions\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n - 1) + fib (n - 2)\n\nmain = do\n  gen &lt;- createSystemRandom\n  let params =  [30, 31 .. 34]\n  rs &lt;- forM params $ \\n -&gt; do\n    xs &lt;- replicateM n $ normal 0 1 gen\n    return $ fib n `deepseq` xs\n  print $ withStrategy (parList rdeepseq) $ map last rs\n</code></pre>\n\n<p>How to execute <code>\\n -&gt; do ...</code> parallely?\n<a href=\"http://hackage.haskell.org/package/monad-parallel\" rel=\"nofollow noreferrer\">monad-parallel</a> package is not worked well.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515538376, "post_id": 48177824, "comment_id": 83335803, "body": "It is not a statement..."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1515538494, "post_id": 48177824, "comment_id": 83335835, "body": "<code>return</code> works entirely differently in Haskell than it does it different languages. Pretend it&#39;s not even called <code>return</code>. <code>inject</code> would probably be a slightly better name to think of it as."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1515538663, "post_id": 48177824, "comment_id": 83335888, "body": "To start, I suggest starting ghci and typing <code>:t return</code>. (You may need to import the correct module first.) This will give you some information about its type that can give you some clues about how it works."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515538664, "post_id": 48177824, "comment_id": 83335889, "body": "<code>return</code> is actually just a simple function in Haskell. It does <i>not</i> return something. It wraps a value into a monad."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1515538736, "post_id": 48177824, "comment_id": 83335916, "body": "Also, you should study about type classes. The <code>Monad</code> type class is used here."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515538796, "post_id": 48177824, "comment_id": 83335937, "body": "Further, a function doesn&#39;t need any special return statement in Haskell. The return value of a function is simply the value computed by the body of the function. Note that neither <code>f1</code> nor <code>f2</code> is a function at all; they are simply values, as a function by definition takes exactly one argument."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515539059, "post_id": 48177824, "comment_id": 83336016, "body": "This can be called class polymorphism or sometimes ad-hoc polymorphism (although truly ad-hoc classes are generally discouraged)."}, {"owner": {"reputation": 73, "user_id": 6095026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41162abeef142672afea33f4259ad29?s=128&d=identicon&r=PG&f=1", "display_name": "shajen", "link": "https://stackoverflow.com/users/6095026/shajen"}, "edited": false, "score": 1, "creation_date": 1515539838, "post_id": 48177824, "comment_id": 83336265, "body": "Looks like return is an overloaded function. Normally a function is overloaded  based on type of function argument, But in this case it is overloaded based on return type."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1515542621, "post_id": 48177824, "comment_id": 83337051, "body": "@shajen Haskell doesn&#39;t have overloaded functions. It has polymorphic functions. It&#39;s similar to implementing an interface in OO languages."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1515543231, "post_id": 48177824, "comment_id": 83337178, "body": "@shajen &quot;in this case it is overloaded based on return type&quot; This is sometimes called &quot;return-type polymorphism&quot; <a href=\"https://softwareengineering.stackexchange.com/questions/105662/is-return-type-only-polymorphism-in-haskell-a-good-thing\" title=\"is return type only polymorphism in haskell a good thing\">softwareengineering.stackexchange.com/questions/105662/&hellip;</a> A simpler example of it is <code>mempty</code> for the <code>Monoid</code> typeclass."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515545349, "post_id": 48177824, "comment_id": 83337623, "body": "@Carcigenicate Or simply use <code>pure</code> instead of inventing <code>inject</code>, since <code>pure</code> already exists and is a (more powerful) synonym of <code>return</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515555140, "post_id": 48177824, "comment_id": 83339833, "body": "@Carcigenicate Going to agree with amalloy here. It&#39;s not always an injection anyway (<code>Proxy</code> provides a counterexample)."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1515583907, "post_id": 48177824, "comment_id": 83352544, "body": "@amalloy That&#39;s fair. I used Inject because I was trying to think of a word while walking, and Inject was used in an article I read years ago on the topic."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1515541282, "creation_date": 1515541282, "answer_id": 48178267, "question_id": 48177824, "link": "https://stackoverflow.com/questions/48177824/how-does-return-statement-work-in-haskell/48178267#48178267", "title": "How does return statement work in Haskell?", "body": "<p>The <code>return</code> function is from the Monad class:</p>\n\n<pre><code>class Applicative m =&gt; Monad (m :: * -&gt; *) where\n  ...\n  return :: a -&gt; m a\n</code></pre>\n\n<p>So return takes any value of type <code>a</code> and results in a value of type <code>m a</code>.  The monad, <code>m</code>, as you've observed is polymorphic using the Haskell type class <code>Monad</code> for ad hoc polymorphism.</p>\n\n<p>At this point you probably realize <code>return</code> is not an good, intuitive, name.  It's not even a built in function or a statement like in many other languages.  In fact a better-named and identically-operating function exists - <code>pure</code>. In almost all cases <code>return = pure</code>.</p>\n\n<p>That is, the function <code>return</code> is the same as the function <code>pure</code> (from the Applicative class) - I often think to myself \"this monadic value is purely the underlying <code>a</code>\" and I try to use pure instead of return if there isn't already a convention in the codebase.</p>\n\n<p>You can use <code>return</code> (or pure) for any type that is a class of <code>Monad</code>.  This includes the Maybe monad to get a value of type <code>Maybe a</code>:</p>\n\n<pre><code>instance Monad Maybe where\n...\n    return      = pure  -- which is from Applicative\n\n...\ninstance Applicative Maybe where\n    pure = Just\n</code></pre>\n\n<p>Or for the list monad to get a value of <code>[a]</code>:</p>\n\n<pre><code>instance Applicative [] where\n    {-# INLINE pure #-}\n    pure x    = [x]\n</code></pre>\n\n<p>Or, as a more complex example, Aeson's parse monad to get a value of type <code>Parser a</code>:</p>\n\n<pre><code>instance Applicative Parser where\n    pure a = Parser $ \\_path _kf ks -&gt; ks a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 6095026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41162abeef142672afea33f4259ad29?s=128&d=identicon&r=PG&f=1", "display_name": "shajen", "link": "https://stackoverflow.com/users/6095026/shajen"}, "edited": false, "score": 0, "creation_date": 1515716081, "post_id": 48179711, "comment_id": 83417553, "body": "So Haskell applies two things in this situation. First it does a type deduction and then look for a Monad that has the &#39;return&#39; implemented for that type. I guess same thing is happening in these examples too:  fromJust (return 1)  and  head (return 1). Thanks for the explanation. Thomas&#39;s answer explained how there is multiple versions of &#39;return&#39;"}], "tags": [], "owner": {"reputation": 593, "user_id": 2743454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HyMgn.gif?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/2743454/tim"}, "is_accepted": true, "score": 10, "last_activity_date": 1515553676, "creation_date": 1515553676, "answer_id": 48179711, "question_id": 48177824, "link": "https://stackoverflow.com/questions/48177824/how-does-return-statement-work-in-haskell/48179711#48179711", "title": "How does return statement work in Haskell?", "body": "<p>This is a long meandering answer!</p>\n\n<p>As you've probably seen from the comments and Thomas's excellent (but very technical) answer You've asked a very hard question.  Well done! </p>\n\n<p>Rather than try to explain the technical answer I've tried to give you a broad overview of what Haskell does behind the scenes without diving into technical detail. Hopefully it will help you to get a big picture view of what's going on.</p>\n\n<p><code>return</code> is an example of <em>type inference</em>.</p>\n\n<p>Most modern languages have some notion of polymorphism.  For example <code>var x = 1 + 1</code> will set <code>x</code> equal to 2. In a statically typed language 2 will usually be an int. If you say <code>var y = 1.0 + 1.0</code> then <code>y</code> will be a float.  The operator <code>+</code> (which is just a function with a special syntax)</p>\n\n<p>Most imperative languages, especially object oriented languages, can only do type inference one way.  Every variable has a fixed type.  When you call a function it looks at the types of the argument and chooses a version of that function that fits the types (or complains if it can't find one).</p>\n\n<p>When you assign the result of a function to a variable the variable already has a type and if it doesn't agree with the type of the return value you get an error.  </p>\n\n<p>So in an imperative language the \"flow\" of type deduction follows time in your program Deduce the type of a variable, do something with it and deduce the type of the result.  In a dynamically typed language (such as Python or javascript) the type of a variable is not assigned until the value of the variable is computed (which is why there don't seem to be types).  In a statically typed language the types are worked out ahead of time (by the compiler) but the logic is the same. The compiler  works out what the types of variables are going to be, but it does so by following the logic of the program in the same way as the program runs.</p>\n\n<p>In Haskell the type inference also follows the logic of the program. Being Haskell it does so in a very mathematically pure way (called System F). The language of types (that is the rules by which types are deduced) are similar to Haskell itself. </p>\n\n<p>Now remember Haskell is a lazy language.  It doesn't work out the value of anything until it needs it. That's why it makes sense in Haskell to have infinite data structures. It never occurs to Haskell that a data structure is infinite because it doesn't bother to work it out until it needs to. </p>\n\n<p>Now all that lazy magic happens at the type level too. In the same way that Haskell doesn't work out what the value of an expression is until it really needs to, Haskell doesn't work out what the type of an expression is until it really needs to.</p>\n\n<p>Consider this function</p>\n\n<pre><code>func (x : y : rest) = (x,y) : func rest\nfunc _ = []\n</code></pre>\n\n<p>If you ask Haskell for the type of this function it has a look at the definition, sees <code>[]</code> and <code>:</code> and deduces that it's working with lists. But it never needs to look at the types of x and y, it just knows that they have to be the same because they end up in the same list. So it deduces the type of the function as <code>[a] -&gt; [a]</code> where a is a type that it hasn't bothered to work out yet.</p>\n\n<p>So far no magic. But it's useful to notice the difference between this idea and how it would be done in an OO language.  Haskell doesn't convert the arguments to Object, do it's thing and then convert back. Haskell just hasn't been asked explicitly what the type of the list is. So it doesn't care.</p>\n\n<p>Now try typing the following into ghci</p>\n\n<pre><code>maxBound - length \"\"\nmaxBound : \"Hello\"\n</code></pre>\n\n<p>Now what just happened !?  minBound bust be a Char because I put it on the front of a string and it must be an integer because I added it to 0 and got a number. Plus the two values are clearly very different.</p>\n\n<p>So what is the type of minBound? Let's ask ghci!</p>\n\n<pre><code>:type minBound\nminBound :: Bounded a =&gt; a\n</code></pre>\n\n<p>AAargh! what does that mean?  Basically it means that it hasn't bothered to work out exactly what <code>a</code> is, but is has to be <code>Bounded</code> if you type <code>:info Bounded</code> you get three useful lines</p>\n\n<pre><code>class Bounded a where\n  minBound :: a\n  maxBound :: a\n</code></pre>\n\n<p>and a lot of less useful lines</p>\n\n<p>So if <code>a</code> is <code>Bounded</code> there are values minBound and maxBound of type <code>a</code>. \nIn fact under the hood <code>Bounded</code> is just a value, it's \"type\" is a record with fields minBound and maxBound. Because it's a value Haskell doesn't look at it until it really needs to. </p>\n\n<p>So I appear to have meandered somewhere in the region of the answer to your question.  Before we move onto <code>return</code>  (which you may have noticed from the comments is a wonderfully complex beast.) let's look at <code>read</code>.</p>\n\n<p>ghci again</p>\n\n<pre><code>read \"42\" + 7\nread \"'H'\" : \"ello\"\nlength (read \"[1,2,3]\")\n</code></pre>\n\n<p>and hopefully you won't be too surprised to find that there are definitions</p>\n\n<pre><code>read :: Read a =&gt; String -&gt; a\nclass Read where\n  read :: String -&gt; a\n</code></pre>\n\n<p>so <code>Read a</code> is just a record containing a single value which is a function <code>String -&gt; a</code>.  Its very tempting to assume that there is one read function which looks at a string, works out what type is contained in the string and returns that type. But it does the opposite. It completely ignores the string until it's needed.  When the value is needed, Haskell first works out what type it's expecting, once it's done that it goes and gets the appropriate version of the read function and combines it with the string.</p>\n\n<p>now consider something slightly more complex </p>\n\n<pre><code>readList :: Read a =&gt; [String] -&gt; a\nreadList strs = map read strs\n</code></pre>\n\n<p>under the hood readList actually takes two arguments\n    readList' (Read a) -> [String] -> [a]\n    readList' {read = f} strs = map f strs</p>\n\n<p>Again as Haskell is lazy it only bothers looking at the arguments when it's needs to find out the return value, at that point it knows what <code>a</code> is, so the compiler can go and fine the right version of Read. Until then it doesn't care. </p>\n\n<p>Hopefully that's given you a bit of an idea of what's happening and why Haskell can \"overload\" on the return type. But it's important to remember it's not overloading in the conventional sense. Every function has only one definition. It's just that one of the arguments is a bag of functions. <code>read_str</code> doesn't ever know what types it's dealing with. It just knows it gets a function <code>String -&gt; a</code> and some Strings, to do the application it just passes the arguments to <code>map</code>. <code>map</code> in turn doesn't even know it gets strings. When you get deeper into Haskell it becomes very important that functions don't know very much about the types they're dealing with.</p>\n\n<p>Now let's look at <code>return</code>. </p>\n\n<p>Remember how I said that the type system in Haskell was very similar to Haskell itself. Remember that in Haskell functions are just ordinary values. \nDoes this mean I can have a type that takes a type as an argument and returns another type?  Of course it does!</p>\n\n<p>You've seen some type functions <code>Maybe</code> takes a type <code>a</code> and returns another type which can either be <code>Just a</code> or <code>Nothing</code>.  <code>[]</code> takes a type <code>a</code> and returns a list of <code>a</code>s. Type functions in Haskell are usually containers. For example I could define a type function <code>BinaryTree</code> which stores a load of <code>a</code>'s in a tree like structure. There are of course lots of much stranger ones.</p>\n\n<p>So, if these type functions are similar to ordinary types I can have a typeclass that contains type functions.  One such typeclass is <code>Monad</code></p>\n\n<pre><code>class Monad m where\n  return a -&gt; m a\n  (&gt;&gt;=) m a (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>so here <code>m</code> is some type function. If I want to define <code>Monad</code> for <code>m</code> I need to define <code>return</code> and the scary looking operator below it (which is called bind)  </p>\n\n<p>As others have pointed out the <code>return</code> is a really misleading name for a fairly boring function. The team that designed Haskell have since realised their mistake and they're genuinely sorry about it. <code>return</code> is just an ordinary function that takes an argument and returns a <code>Monad</code> with that type in it. (You never asked what a Monad actually is so I'm not going to tell you)</p>\n\n<p>Let's define <code>Monad</code> for <code>m = Maybe</code>!\nFirst I need to define <code>return</code>. What should <code>return x</code> be? Remember I'm only allowed to define the function once, so I can't look at <code>x</code> because I don't know what type it is. I could always return <code>Nothing</code>, but that seems a waste of a perfectly good function.  Let's define <code>return x = Just x</code> because that's literally the only other thing I can do.</p>\n\n<p>What about the scary bind thing? what can we say about <code>x &gt;&gt;= f</code>? well <code>x</code> is a <code>Maybe a</code> of some unknown type <code>a</code> and <code>f</code> is a function that takes an <code>a</code> and returns a <code>Maybe b</code>. Somehow I need to combine these to get a Maybe b`</p>\n\n<p>So I need to define <code>Nothing &gt;== f</code>. I can't call <code>f</code> because it needs an argument of type <code>a</code> and I don't have a value of type <code>a</code> I don't even know what 'a' is. I've only got one choice which is to define </p>\n\n<pre><code>Nothing &gt;== f = Nothing\n</code></pre>\n\n<p>What about <code>Just x &gt;&gt;= f</code>? Well I know <code>x</code> is of type <code>a</code> and <code>f</code> takes <code>a</code> as an argument, so I can set <code>y = f a</code> and deduce that <code>y</code> is of type <code>b</code>. Now I need to make a <code>Maybe b</code> and I've got a <code>b</code> so ...</p>\n\n<p>Just x >>= f = Just (f x)</p>\n\n<p>So I've got a <code>Monad</code>!  what if <code>m</code> is <code>List</code>?  well I can follow a similar sort of logic and define </p>\n\n<pre><code>return x = [x]\n[] &gt;&gt;= f = []\n(x : xs) &gt;&gt;= a = f x ++ (xs &gt;&gt;= f)\n</code></pre>\n\n<p>Hooray another <code>Monad</code>!  It's a nice exercise to go through the steps and convince yourself that there's no other sensible way of defining this.</p>\n\n<p>So what happens when I call <code>return 1</code>?  </p>\n\n<p>Nothing!</p>\n\n<p>Haskell's Lazy remember.  The <em>thunk</em> <code>return 1</code> (technical term) just sits there until someone needs the value. As soon as Haskell needs the value it know what type the value should be. In particular it can deduce that <code>m</code> is <code>List</code>. Now that it knows that Haskell can find the instance of <code>Monad</code> for <code>List</code>. As soon as it does that it has access to the correct version of return. </p>\n\n<p>So finally Haskell is ready To call return, which in this case returns [1]!</p>\n"}], "owner": {"reputation": 73, "user_id": 6095026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41162abeef142672afea33f4259ad29?s=128&d=identicon&r=PG&f=1", "display_name": "shajen", "link": "https://stackoverflow.com/users/6095026/shajen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7563, "favorite_count": 1, "closed_date": 1515542303, "accepted_answer_id": 48179711, "answer_count": 2, "score": 6, "last_activity_date": 1515553676, "creation_date": 1515538350, "last_edit_date": 1515538514, "question_id": 48177824, "link": "https://stackoverflow.com/questions/48177824/how-does-return-statement-work-in-haskell", "closed_reason": "Duplicate", "title": "How does return statement work in Haskell?", "body": "<p>Consider these functions</p>\n\n<pre><code>f1 :: Maybe Int\nf1 = return 1\n\nf2 :: [Int]\nf2 = return 1\n</code></pre>\n\n<p>Both have the same statement <code>return 1</code>. But the results are different. <code>f1</code> gives value <code>Just 1</code> and <code>f2</code> gives value <code>[1]</code></p>\n\n<p>Looks like Haskell invokes two different versions of <code>return</code> based on return type. I like to know more about this kind of function invocation. Is there a name for this feature in programming languages? </p>\n"}, {"tags": ["list", "haskell", "reverse"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 4, "last_activity_date": 1515526690, "creation_date": 1515526690, "answer_id": 48175522, "question_id": 48175351, "link": "https://stackoverflow.com/questions/48175351/haskell-reversing-partially-a-list/48175522#48175522", "title": "Haskell, reversing partially a list", "body": "<p>We write four functions. That makes reasoning a lot simpler and the functions easier to maintain:</p>\n\n<pre><code>reverseFirst :: [a] -&gt; [a]\nreverseFirst (x:y:xs) = y : x : xs\nreverseFirst xs       = xs\n\nreverseLast :: [a] -&gt; [a]\nreverseLast [x, y] = [y, x]\nreverseLast (x:xs) = x : reverseLast xs\nreverseLast xs     = xs\n\nlengthAtLeast :: [a] -&gt; Int -&gt; Bool\nlengthAtLeast xs n = not $ null $ drop (n - 1) xs\n</code></pre>\n\n<p>Now, with those helpers, it's easy to write the fourth and last function:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf xs\n  | xs `lengthAtLeast` 4 = reverseLast $ reverseFirst xs\n  | otherwise           = xs\n</code></pre>\n\n<p>We can drop <code>lengthAtLeast</code> if we pattern match:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf (a:b:xs@(_:_:_)) = b : a : reverseLast xs\ntransf xs               = xs\n</code></pre>\n\n<h1>Exercise</h1>\n\n<p>Make the amount of characters reversed at the end and start customizeable:</p>\n\n<pre><code>transform :: Int -&gt; Int -&gt; [a] -&gt; [a]\ntransform = ...\n</code></pre>\n\n<p>It should work like this:</p>\n\n<pre><code>transform 1 1 [1,2,3,4] = [1,2,3,4]\ntransform 1 2 [1,2,3,4] = [1,2,4,3]\ntransform 1 3 [1,2,3,4] = [1,4,3,2]\ntransform 1 4 [1,2,3,4] = [1,2,3,4] -- list isn't 5 elements long\ntransform 2 2 [1,2,3,4] = [2,1,4,3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 8857002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ADRWy.jpg?s=128&g=1", "display_name": "pr0d1gyban", "link": "https://stackoverflow.com/users/8857002/pr0d1gyban"}, "edited": false, "score": 1, "creation_date": 1515531930, "post_id": 48175557, "comment_id": 83333173, "body": "Thank you very much. The explanation helped a lot and I can see clearly what I have to do."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1515526817, "creation_date": 1515526817, "answer_id": 48175557, "question_id": 48175351, "link": "https://stackoverflow.com/questions/48175351/haskell-reversing-partially-a-list/48175557#48175557", "title": "Haskell, reversing partially a list", "body": "<p>Usually it is better to use pattern matching over using <code>length</code>. If for instance a list has an infinite length, <code>length</code> will loop forever. So wen can define a function:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf (a:b:c:d:es) = ...\ntransf x = x\n</code></pre>\n\n<p>So here we define a pattern <code>(a:b:c:d:es)</code> which is the pattern to define a list with at least four elements (<code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>) and the rest of the list <code>es</code>.</p>\n\n<p>Now in that case we know that we have to reverse the first two elements of the list, so the result is something like <code>b : a : ...</code>. Now the question is how we calculate the rest of the list. We can not add <code>c</code> and <code>d</code> to the list, since it is possible that <code>es</code> is the empty list, in which case, we want to reverse <code>d</code> and <code>c</code>. This can result in a lot of cases.</p>\n\n<p>We can however use an as-pattern here, to match both the first two items, as well as the rest of the list (and the rest of the list should contain at least two items). Like:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf (a:b:cs@(_:_:_)) = b : a : ...\ntransf x = x\n</code></pre>\n\n<p>So now we only have to fill in the <code>...</code>. This needs to reverse the last two items. Instead of letting <code>transf</code> have all the fun, we can define a new function <code>swaplast :: [a] -&gt; [a]</code> which swaps the last items. What to do if the list has no two elements can be decided by ourselves since we know that the list with which we will call the function will have at least two elements. We can for instance decide that empty lists and singleton lists, are simply returned without a modification. So we can implement such function as:</p>\n\n<pre><code>swaplast :: [a] -&gt; [a]\nswaplast [] = []\nswaplast [a, b] = [b, a]\nswaplast (a:bs) = a : swaplast bs\n</code></pre>\n\n<p>So then we obtain the implementation:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf (a:b:cs@(_:_:_)) = b : a : swaplast cs\ntransf x = x\n\nswaplast :: [a] -&gt; [a]\nswaplast [] = []\nswaplast [a, b] = [b, a]\nswaplast (a:bs) = a : swaplast bs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 0, "last_activity_date": 1515534115, "creation_date": 1515534115, "answer_id": 48177063, "question_id": 48175351, "link": "https://stackoverflow.com/questions/48175351/haskell-reversing-partially-a-list/48177063#48177063", "title": "Haskell, reversing partially a list", "body": "<p>Something like this, works only for finite lists</p>\n\n<pre><code>-- works only for finite lists\nf :: [a] -&gt; [a]\nf ls\n    | n &lt;= 4     = ls\n    | otherwise  = let (a:b:hs, [x, y]) = splitAt (n - 2) ls \n                   in  b:a:(hs ++ [y, x])\n    where\n        n = length ls\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8857002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ADRWy.jpg?s=128&g=1", "display_name": "pr0d1gyban", "link": "https://stackoverflow.com/users/8857002/pr0d1gyban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1515534115, "creation_date": 1515526032, "question_id": 48175351, "link": "https://stackoverflow.com/questions/48175351/haskell-reversing-partially-a-list", "title": "Haskell, reversing partially a list", "body": "<p>I am trying to create a function that takes a list and, if the length of the list is at least 4, it reverses the first and second element and the last two elements of said list.\nImagine the input is [1,2,3,4,5,6] this should give me [2,1,3,4,6,5].</p>\n\n<p>I am trying to figure it out but it's being a pain in the ass.</p>\n\n<p>So, this is what I've got:</p>\n\n<pre><code>transf :: [a] -&gt; [a]\ntransf [] = []\ntransf xs | length xs &gt;= 4 = ???\n          | otherwise = xs\n</code></pre>\n\n<p>So I thought that I could do a aux function that would only reverse those elements and then calling it on the transf function.\nAny help?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1515518045, "post_id": 48173387, "comment_id": 83326348, "body": "<a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html\" rel=\"nofollow noreferrer\">GHCi</a>. What do you mean &#39;use this function via console&#39;? You said you&#39;ve loaded it already."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 4, "last_activity_date": 1515533605, "last_edit_date": 1515533605, "creation_date": 1515518375, "answer_id": 48173513, "question_id": 48173387, "link": "https://stackoverflow.com/questions/48173387/haskell-basic-function-definition/48173513#48173513", "title": "Haskell basic function definition", "body": "<p>read the type of the function as</p>\n\n<pre><code>iter :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a\n        ^^^    ^^^^^^^^    ^    ^\n        arg      arg      arg  result\n</code></pre>\n\n<p>meaning if you provide an <code>Int</code>, a <code>(a-&gt;a)</code> function, and an <code>a</code>, it will give you back another <code>a</code>.  Here <code>a</code> stands for any type.  For example</p>\n\n<pre><code>iter 4 (+1) 0\n</code></pre>\n\n<p>will be <code>4</code>, that is performs <code>(+1)</code> on <code>0</code> four times.</p>\n"}, {"comments": [{"owner": {"reputation": 353, "user_id": 8495354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/524c00e2a5fc88b833cd57191a7641c9?s=128&d=identicon&r=PG&f=1", "display_name": "Romas Augustinavi\u010dius", "link": "https://stackoverflow.com/users/8495354/romas-augustinavi%c4%8dius"}, "edited": false, "score": 0, "creation_date": 1515519110, "post_id": 48173533, "comment_id": 83326947, "body": "Many thanks!!! And can you give an example of this: &quot;interleave :: Stream a -&gt; Stream a -&gt; Stream a&quot;?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1515518431, "creation_date": 1515518431, "answer_id": 48173533, "question_id": 48173387, "link": "https://stackoverflow.com/questions/48173387/haskell-basic-function-definition/48173533#48173533", "title": "Haskell basic function definition", "body": "<p>You need to give it <em>a function</em>, more specifically, an <em>endofunction</em> (mapping any type to itself). For example,</p>\n\n<pre><code>*Main&gt; iter 3 sqrt 256\n2.0\n</code></pre>\n\n<p>Of course, this can also be a custom function, like</p>\n\n<pre><code>*Main&gt; let f x = x+2\n*Main&gt; iter 3 f 7\n13\n</code></pre>\n\n<p>or even an anonymous one defined right in the invocation:</p>\n\n<pre><code>*Main&gt; iter 3 (\\str -&gt; \"(\"++str++\")\") \"...\"\n\"(((...)))\"\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 8495354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/524c00e2a5fc88b833cd57191a7641c9?s=128&d=identicon&r=PG&f=1", "display_name": "Romas Augustinavi\u010dius", "link": "https://stackoverflow.com/users/8495354/romas-augustinavi%c4%8dius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 48173533, "answer_count": 2, "score": 0, "last_activity_date": 1515533605, "creation_date": 1515517875, "last_edit_date": 1515518471, "question_id": 48173387, "link": "https://stackoverflow.com/questions/48173387/haskell-basic-function-definition", "title": "Haskell basic function definition", "body": "<p>I'am learning haskell and I don't realy understand function definitions, for example:</p>\n\n<pre><code>module TestModule where\n\niter :: Int -&gt; (a -&gt; a) -&gt; (a -&gt; a)\n\niter n f \n  | n&gt;0         = f . iter (n-1) f\n  | otherwise   = id\n\niter_2 n f = foldr (.) id (replicate n f)\n</code></pre>\n\n<p>What I suppose to give this function? I have loaded this function via console and don't really understand how to use it.</p>\n\n<p>My question how to use this function via console. Like \"iter 5 ???\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515516904, "post_id": 48173004, "comment_id": 83325723, "body": "Considering lists <i>as sets</i>, it&#39;s doesn&#39;t make any difference whether you sort the end result. If the order is important, it better be specified in the question."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 0, "creation_date": 1515516926, "post_id": 48173004, "comment_id": 83325733, "body": "According to the task, it doesn&#39;t."}, {"owner": {"reputation": 386, "user_id": 8199377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cd3a2b62fec6025eac1b6ec4f9e717be?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/8199377/coder"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515517010, "post_id": 48173004, "comment_id": 83325783, "body": "Sorry, I didn&#39;t include that in my question. The list needs to be sorted. @leftaroundabout"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515517096, "post_id": 48173004, "comment_id": 83325840, "body": "So your question is really: <i>why is <code>[a|a&lt;-[1..n],x&lt;-[1..n],y&lt;-[1..n],x^2+y^3==a]</code> sorted?</i>"}, {"owner": {"reputation": 386, "user_id": 8199377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cd3a2b62fec6025eac1b6ec4f9e717be?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/8199377/coder"}, "edited": false, "score": 0, "creation_date": 1515517148, "post_id": 48173004, "comment_id": 83325867, "body": "Yes. And why it isn&#39;t sorted when a comes after x and y."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1515517404, "post_id": 48173004, "comment_id": 83325987, "body": "Omit the sort, omit the filter, <a href=\"https://ideone.com/jHxxAO\" rel=\"nofollow noreferrer\">observe what happens</a>, explain."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1515518008, "post_id": 48173004, "comment_id": 83326324, "body": "By the way <code>..., a&lt;-[1..n], x^2+y^3==a]</code> is an antipattern, which will slow down your code considerably. This tries all values in <code>[1..n]</code> just to see if <code>x^2+y^3</code> is there. It would be much better to <code>let a = x^2+y^3</code> and require <code>1 &lt;= a , a &lt;= n</code>. In this way we move from O(n) to O(1) complexity."}, {"owner": {"reputation": 386, "user_id": 8199377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cd3a2b62fec6025eac1b6ec4f9e717be?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/8199377/coder"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515518633, "post_id": 48173004, "comment_id": 83326678, "body": "I did that but I didn&#39;t really get why it happened the way it did, that&#39;s why I asked a question. Thank you! @chi"}], "answers": [{"comments": [{"owner": {"reputation": 386, "user_id": 8199377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cd3a2b62fec6025eac1b6ec4f9e717be?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/8199377/coder"}, "edited": false, "score": 0, "creation_date": 1515518567, "post_id": 48173260, "comment_id": 83326640, "body": "Okay. So when a comes after x and y we will draw every argument for x and then go to y and do the same etc?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1515517458, "creation_date": 1515517458, "answer_id": 48173260, "question_id": 48173004, "link": "https://stackoverflow.com/questions/48173004/list-comprehensions-with-arguments-drawn-from-the-same-list-in-haskell/48173260#48173260", "title": "List comprehensions with arguments drawn from the same list in Haskell", "body": "<p>This list is sorted:</p>\n\n<pre><code>    [ 1, 1, 1\n    , 2, 2, 2\n    , 3, 3, 3\n    , 4, 4, 4 ]\n</code></pre>\n\n<p>This one isn't:</p>\n\n<pre><code>    [ 1, 2, 3, 4\n    , 1, 2, 3, 4\n    , 1, 2, 3, 4 ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1515526695, "creation_date": 1515526695, "answer_id": 48175525, "question_id": 48173004, "link": "https://stackoverflow.com/questions/48173004/list-comprehensions-with-arguments-drawn-from-the-same-list-in-haskell/48175525#48175525", "title": "List comprehensions with arguments drawn from the same list in Haskell", "body": "<p>This is only vaguely related to the question: it addresses the programming challenge, but does not answer the question as asked about why the existing approaches work. But it was too fun to avoid writing a snippet about it, so here goes.</p>\n\n<p>With appropriate imports, you can very efficiently generate even the infinite list of square-cube sums. The basic idea is to make an infinite list of infinite lists; we will maintain the invariant that the outer infinite list is sorted by the heads of the inner infinite lists. Then it's easy and efficient to merge all of these. With <a href=\"https://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html\" rel=\"nofollow noreferrer\">the appropriate package</a> it's a one-liner, and very succinctly matches the problem description:</p>\n\n<pre><code>import Data.List.Ordered\nsquareCubes = unionAll [[x^2+y^3 | x &lt;- [1..]] | y &lt;- [1..]]\n</code></pre>\n\n<p>We can compare the efficiency of this to the existing two approaches. Here's the test program, which I compiled with <code>-O2</code>:</p>\n\n<pre><code>import Data.List\nimport Data.List.Ordered\nimport System.Environment\n\nsquareCubes = unionAll [[x^2+y^3 | x &lt;- [1..]] | y &lt;- [1..]]\nsquareCube n = takeWhile (&lt;=n) squareCubes\nsquareCube' n = [a|a&lt;-[1..n],x&lt;-[1..n],y&lt;-[1..n],x^2+y^3==a]\nsquareCube'' n = sort [a|x&lt;-[1..n],y&lt;-[1..n],a&lt;-[1..n],x^2+y^3==a]\n\nmain = do\n    [kind, limit] &lt;- getArgs\n    let f = case kind of\n            \"inf\" -&gt; squareCube\n            \"unsorted\" -&gt; squareCube'\n            \"sorted\" -&gt; squareCube''\n    print . sum . f . read $ limit\n</code></pre>\n\n<p>And here are the timings, which are quite stark indeed:</p>\n\n<pre><code>% /usr/bin/time ./test unsorted 700  \n57465\n9.60user 0.01system 0:09.63elapsed 99%CPU (0avgtext+0avgdata 4156maxresident)k\n% /usr/bin/time ./test sorted 700 \n57465\n1.87user 0.00system 0:01.87elapsed 99%CPU (0avgtext+0avgdata 4056maxresident)k\n% /usr/bin/time ./test inf 700   \n50895\n0.00user 0.00system 0:00.00elapsed 100%CPU (0avgtext+0avgdata 3616maxresident)k\n</code></pre>\n\n<p>The others take seconds (aeons in computer time) while the one that's in some ways more capable than the others doesn't even register on the timer! I also experimented to find how large of an input we could give before arriving at the timings for the other two implementations. I found that an input of 500000000 takes 8.88 seconds -- almost six orders of magnitude higher in the roughly the same time.</p>\n\n<p>Wait, wait, you say: those outputs are different. So what gives? Well, it turns out that the slow implementations have what I consider to be a bug: they will spit out a single number multiple times if there are multiple ways to construct it as the sum of squares and cubes. For example,</p>\n\n<pre><code>&gt; squareCube' 17\n[2,5,9,10,12,17,17]\n&gt; squareCube 17\n[2,5,9,10,12,17]\n</code></pre>\n\n<p>because 3^2 + 2^3 = 4^2 + 1^3. On the other hand, if this is the intended behavior, one can easily achieve it in the efficient, lazy one-liner by replacing <code>unionAll</code> with <code>mergeAll</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1515752955, "last_edit_date": 1515752955, "creation_date": 1515587496, "answer_id": 48187561, "question_id": 48173004, "link": "https://stackoverflow.com/questions/48173004/list-comprehensions-with-arguments-drawn-from-the-same-list-in-haskell/48187561#48187561", "title": "List comprehensions with arguments drawn from the same list in Haskell", "body": "<p>To see clearly what's going on with list comprehensions, try</p>\n\n<pre><code>do { print [  (x,[10..13])           | x &lt;- [1,2]]\n   ; print [ [(x,y) | y &lt;- [10..13]] | x &lt;- [1,2]]\n   ; print [ r                       | x &lt;- [1,2], r &lt;- [(x,y) | y &lt;- [10..13]]]\n   ; print [  (x,y)                  | x &lt;- [1,2],               y &lt;- [10..13] ] \n   }\n=&gt;\n[ (1,[10,11,12,13]),             (2,[10,11,12,13])           ]\n[[(1,10),(1,11),(1,12),(1,13)], [(2,10),(2,11),(2,12),(2,13)]]\n[ (1,10),(1,11),(1,12),(1,13),   (2,10),(2,11),(2,12),(2,13) ]\n[ (1,10),(1,11),(1,12),(1,13),   (2,10),(2,11),(2,12),(2,13) ]\n</code></pre>\n\n<p>On the other hand,</p>\n\n<pre><code>do { print [  ([1,2],y)              | y &lt;- [10..13] ]\n   ; print [  (x,y)                  | y &lt;- [10..13], x &lt;- [1,2] ]\n   }\n=&gt;\n[ ([1,2],10),    ([1,2],11),    ([1,2],12),    ([1,2],13)    ]\n[ (1,10),(2,10), (1,11),(2,11), (1,12),(2,12), (1,13),(2,13) ]\n</code></pre>\n\n<p>List comprehensions work in the <em>nested</em> fashion.</p>\n\n<hr>\n\n<p>You could re-write your first code as</p>\n\n<pre><code>map (\\(a,_,_) -&gt; a) $\n  filter (\\(a,x,y) -&gt; x^2+y^3==a) $\n    liftA3 (,,) [1..n] [1..n] [1..n]     -- (1)\n</code></pre>\n\n<p>and the second as</p>\n\n<pre><code>map (\\(_,_,a) -&gt; a) $\n  filter (\\(x,y,a) -&gt; x^2+y^3==a) $\n    liftA3 (,,) [1..n] [1..n] [1..n]     -- (2)\n</code></pre>\n\n<p>You could be tempted to see <code>(1)</code> and <code>(2)</code> as a very general \"all combinations of three elements drawn from same list\" thing. But Haskell is a <em>deterministic</em> language. It produces the same results for the same inputs. Thus it imposes a certain order on the resulting list. </p>\n\n<p>And this is what it means when we say that list comprehensions work in a nested fashion &mdash; the leftmost list's element changes the slowest, and the rightmost's the fastest, in the resulting combination &mdash; like in an odometer.</p>\n\n<hr>\n\n<p>To solve your problem, you could write </p>\n\n<pre><code>sort [a | x2 &lt;- takeWhile (&lt;= n) [x^2    | x &lt;- [1..]]\n        , a  &lt;- takeWhile (&lt;= n) [x2+y^3 | y &lt;- [1..]] ]\n</code></pre>\n\n<p>but this requires careful thought, the code doesn't express the original intent as clearly, and isn't still as optimal as the one using <code>Data.List.Ordered.mergeAll</code> (from <code>data-ordlist</code> package) as seen in the answer by Daniel Wagner,</p>\n\n<pre><code>takeWhile (&lt;= n) . mergeAll $ [[x^2+y^3 | x &lt;- [1..]] | y &lt;- [1..]]\n</code></pre>\n\n<p>although both have the same time complexity, more or less. <code>mergeAll</code> merges the ordered non-decreasing lists it is presented with, by using pairwise merges arranged in a tree <a href=\"https://wiki.haskell.org/Prime_numbers#Tree_merging\" rel=\"nofollow noreferrer\">slanted to the right</a>.</p>\n\n<p>Come to think of it, we too could write the more natural-looking</p>\n\n<pre><code>   sort . concat . map (takeWhile (&lt;= n))   \n                 $ [[x^2+y^3 | x &lt;- [1..n]] | y &lt;- [1..n]]\n</code></pre>\n\n<p>This doesn't work with the infinite list of lists. To fix this, we could write</p>\n\n<pre><code>-- sort . concat . takeWhile (not . null) . map (takeWhile (&lt;= n)) \n   sort . concat . map (takeWhile (&lt;= n)) . takeWhile ((&lt;= n).head)\n                 $ [[x^2+y^3 | x &lt;- [1..]] | y &lt;- [1..]]\n</code></pre>\n\n<p>In Haskell, it is quite often better not to try too hard to figure it all out ourselves, but leave it to the lazy evaluation to take care of things. Here it didn't quite worked unfortunately, and we had to take special care to be able to deal with infinite list<sup>1</sup>, with those explicit <code>takeWhile</code>s superfluous to the task's logic. </p>\n\n<p>Indeed it is true, for any <em><code>n</code></em>, that</p>\n\n<pre><i>  under n (union a b)         == nub . sort $ under n a ++ under n b\n  under n . unionAll . take m == under n . foldl union [] . take m\n  under n . unionAll          == nub . sort . concat \n                                     . takeWhile (not.null) . map (under n)</i></pre>\n\n<p>and</p>\n\n<pre><i>  under n (merge a b)         == sort $ under n a ++ under n b\n  under n . mergeAll . take m == under n . foldl merge [] . take m\n  under n . mergeAll          == sort . concat \n                                      . takeWhile (not.null) . map (under n)</i></pre>\n\n<p>using <code>under n = takeWhile (&lt;= n)</code>, with ordered increasing lists.</p>\n\n<p><sup>1</sup><code>Data.List.Ordered.mergeAll</code> takes care of the infinite lists all by itself, and is better in the sense that it is <em>on-line</em> - it starts producing its output much earlier than our tortured constructed function. The point wasn't that the library function isn't needed, but just to see what can be done without it.</p>\n"}, {"tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": true, "score": 0, "last_activity_date": 1515602281, "creation_date": 1515602281, "answer_id": 48192123, "question_id": 48173004, "link": "https://stackoverflow.com/questions/48173004/list-comprehensions-with-arguments-drawn-from-the-same-list-in-haskell/48192123#48192123", "title": "List comprehensions with arguments drawn from the same list in Haskell", "body": "<p>We need a sort function when <code>a</code> comes after <code>x</code> and <code>y</code> in the comprehension because of the order of evaluation. If <code>a &lt;- [1..]</code> is called first, each of the subsequent statements will be evaluated against each <code>a</code> in turn, so the <code>a</code>'s already form an increasing list:</p>\n\n<pre><code>a = 1\n  x &lt;- [1..n]\n    y &lt;- [1..n]\n    ...return a if there's a valid match\n\na = 2\n    x &lt;- [1..n]\n      y &lt;- [1..n]\n      ...return a if there's a valid match\n\netc.\n</code></pre>\n\n<p>However, if <code>a &lt;- [1..n]</code> is evaluated last, we may not get an ordered sequence of <code>a</code>s:</p>\n\n<pre><code>  x = 1\n    y &lt;- [1..n]\n      ...\n      y = 1\n        a &lt;- [1..n]\n        ...\n        a = 2                 2\n      y = 2\n        a &lt;- [1..n]\n        ...\n        a = 9                 9\n\n  x = 2\n    y &lt;- [1..n]\n      ...\n      y = 1\n        a &lt;- [1..n]\n        ...\n        a = 5                 5\n</code></pre>\n"}], "owner": {"reputation": 386, "user_id": 8199377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cd3a2b62fec6025eac1b6ec4f9e717be?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/8199377/coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 48192123, "answer_count": 4, "score": 2, "last_activity_date": 1515752955, "creation_date": 1515516662, "last_edit_date": 1515517029, "question_id": 48173004, "link": "https://stackoverflow.com/questions/48173004/list-comprehensions-with-arguments-drawn-from-the-same-list-in-haskell", "title": "List comprehensions with arguments drawn from the same list in Haskell", "body": "<p>I've a question regarding list comprehensions in Haskell. </p>\n\n<p>I have an exam later this week and therefore did some old exams where I found this question: </p>\n\n<p>\"Write a function that given a positive integer n returns a list of positive integers m \u2264 n such that there are two positive integers x and y, such that x^2 + y^3 = m. The list needs to be sorted\" </p>\n\n<p>There were two possible answers, \neither </p>\n\n<pre><code>squareCube::Int-&gt;[Int]\nsquareCube n =[a|a&lt;-[1..n],x&lt;-[1..n],y&lt;-[1..n],x^2+y^3==a]\n</code></pre>\n\n<p>or </p>\n\n<pre><code>import Data.List\nsquareCube::Int-&gt;[Int]\nsquareCube n =\nsort [a|x&lt;-[1..n],y&lt;-[1..n],a&lt;-[1..n],x^2+y^3==a]\n</code></pre>\n\n<p>I wonder why I need to use the sort function when a comes after x and y in my comprehension. Why does the order between the arguments matter? </p>\n"}, {"tags": ["haskell", "functional-programming", "macros", "scheme"], "comments": [{"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 3, "creation_date": 1515513173, "post_id": 48171938, "comment_id": 83323404, "body": "<i>Is it something to do with the fact that Haskell is pure, so it much harder to alter functional code?</i> No: macros are mostly pure functions from code to code."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 3, "creation_date": 1515568577, "post_id": 48171938, "comment_id": 83343767, "body": "Scheme/Lisp macros have only the name in common with C preprocessor macros."}], "answers": [{"tags": [], "owner": {"reputation": 7185, "user_id": 4949918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebe74084d2bf2feab20ec74c7b05ba?s=128&d=identicon&r=PG&f=1", "display_name": "Axnyff", "link": "https://stackoverflow.com/users/4949918/axnyff"}, "is_accepted": false, "score": 3, "last_activity_date": 1515513181, "creation_date": 1515513181, "answer_id": 48171991, "question_id": 48171938, "link": "https://stackoverflow.com/questions/48171938/why-is-it-harder-to-add-macros-to-haskell-than-to-scheme/48171991#48171991", "title": "Why is it harder to add macros to Haskell than to Scheme", "body": "<p><a href=\"https://stackoverflow.com/a/267880/4949918\">This should help you</a>. Lisp languages' syntax are a lot simpler than other languages and the parser is directly accessible from the language. </p>\n\n<p>Clojure is a type of lisp that is both lazy and can deal with pure code but still has the powerful macros of Lisp.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 6, "creation_date": 1515525592, "post_id": 48172100, "comment_id": 83330183, "body": "Certainly I agree that laziness and purity don&#39;t matter, and that the simpler syntax of Scheme does matter. I don&#39;t really get what this has to do with being static, or compiled, though: macros typically don&#39;t produce code at runtime."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515526730, "post_id": 48172100, "comment_id": 83330702, "body": "Scheme itself has evolved to be better suited to compilation anyway. R5RS <code>eval</code> is very weak. Racket has staged imports. People aren&#39;t using <code>apply</code> as much."}, {"owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 1, "creation_date": 1515714800, "post_id": 48172100, "comment_id": 83417225, "body": "I&#39;m not going to downvote, but the static &amp; compiled nature of the language has nothing to do with macros. Racket is statically compiled, &amp; has an extremely rich macro system."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 0, "creation_date": 1515746869, "post_id": 48172100, "comment_id": 83426330, "body": "@JohnClements I&#39;ve not used Racket much, but I recall it as feeling in principle not that different from other Lisps, with the dynamic <i>types</i> facilitating a code-as-data approach. The fact that modern Lisp dialects are able to pre-compile a lot and JIT-optimise much of the rest is great, but IMO that doesn&#39;t change the fact that these languages are at least conceptually interpreted languages, whereas Haskell has intentionally a very solid boundary between compile time and run time."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515753453, "post_id": 48172100, "comment_id": 83430394, "body": "Yes, Racket is dynamic, but its macro system has a very static flavor. And that&#39;s quite intentional--it allows for much better compilation. Racket as a whole tends to try its best to prevent expensive dynamic features from slowing down code that doesn&#39;t use them."}, {"owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 0, "creation_date": 1515780671, "post_id": 48172100, "comment_id": 83445964, "body": "I think that the distinction between &quot;compiled&quot; and &quot;interpreted&quot; languages is no longer a real thing at all; consider JavaScript; you may think of it as an &quot;interpreted&quot; language, but there are plenty of JITs that can compile JS to assembly."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 0, "creation_date": 1515927719, "post_id": 48172100, "comment_id": 83480271, "body": "@JohnClements that&#39;s just a performance optimisation. The point is that the programmer doesn&#39;t need to be aware of any JIT to write correct code; the language is <i>conceptually</i> interpreted. Whereas in C++, Haskell or Rust, there&#39;s a very fundamental distinction that you know some things are guarenteed to get completely done at compile time, and other things are left to runtime. This is particularly interesting when you&#39;re not sure if something will work, but you&#39;re sure that if it fails it will already do so at compile time. Makes a lot of testing unnecessary."}, {"owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 0, "creation_date": 1515966649, "post_id": 48172100, "comment_id": 83491647, "body": "I think that when you say &quot;conceptually interpreted,&quot; you mean &quot;dynamically typed&quot;. Specifically, you say &quot;you&#39;re sure that if it falis it will already do so at compile time.&quot; I think that the top 30 examples on this list are all going to be type system errors. This is orthogonal to compilation. Also, you might be interested in Typed Racket, a statically typed member of the Racket family, which provides the same guarantees that you mention."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1515513554, "creation_date": 1515513554, "answer_id": 48172100, "question_id": 48171938, "link": "https://stackoverflow.com/questions/48171938/why-is-it-harder-to-add-macros-to-haskell-than-to-scheme/48172100#48172100", "title": "Why is it harder to add macros to Haskell than to Scheme", "body": "<p>It certainly has nothing to do with Haskell being pure or lazy, on the contrary.</p>\n\n<p>The main reason why macros aren't as common in Haskell is that it's a static, compiled language, thus changing code <em>at runtime</em> isn't possible anyway. Also, it doesn't have quite as simple syntax as Lisps do, so writing compile-time macros is always a bit more cumbersome.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Exp\" rel=\"noreferrer\">http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Exp</a></p>\n\n<p>Haskell's lazy evaluation and the abstraction capabilities of its strong type system however mean that you simply don't <em>need</em> macros in lots of situations where Scheme programmers would employ them. Basically, you can abstract over the notion of computation itself, which is a lot like macros (just much cooler, if you ask me...).</p>\n"}, {"tags": [], "owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "is_accepted": false, "score": 1, "last_activity_date": 1515714979, "creation_date": 1515714979, "answer_id": 48217635, "question_id": 48171938, "link": "https://stackoverflow.com/questions/48171938/why-is-it-harder-to-add-macros-to-haskell-than-to-scheme/48217635#48217635", "title": "Why is it harder to add macros to Haskell than to Scheme", "body": "<p>In addition to the prior answers, I would say that both Haskell and Scheme are largely academic languages, meaning specifically that work on them is driven by researchers, and their particular interests. For these languages, then, those that are interested in Macros are likely to gravitate toward the language with the syntax system (Scheme/Racket/Clojure) whose uniformity (everything is parenthesized) makes macro definitions dramatically easier.</p>\n"}], "owner": {"reputation": 6610, "user_id": 1449637, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/71baba15969012d4c07b755fb0441016?s=128&d=identicon&r=PG", "display_name": "Greg Peckory", "link": "https://stackoverflow.com/users/1449637/greg-peckory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 1, "accepted_answer_id": 48172100, "answer_count": 3, "score": 2, "last_activity_date": 1515714979, "creation_date": 1515512961, "question_id": 48171938, "link": "https://stackoverflow.com/questions/48171938/why-is-it-harder-to-add-macros-to-haskell-than-to-scheme", "title": "Why is it harder to add macros to Haskell than to Scheme", "body": "<p>Apparently it is harder to add macros to Haskell than Scheme.</p>\n\n<p>I'm very confused on what exactly macros are in functional programming, but from what I understand in C it is code which alters the \"code\" at preprocessing time, rather than the program itself.</p>\n\n<p>Is it something to do with the fact that Haskell is pure, so it much harder to alter functional code?</p>\n\n<p>Has it something to do with lazy evaluation?</p>\n"}, {"tags": ["list", "haskell", "maybe"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515497306, "post_id": 48167166, "comment_id": 83313415, "body": "If you run this in a <i>shell</i>, then you define multiple <code>myHead</code> functions."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1515514592, "post_id": 48167166, "comment_id": 83324257, "body": "Your title is misleading. Where does your error say &quot;Non exhaustive patterns?&quot; Please change it accordingly."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515505919, "post_id": 48167868, "comment_id": 83318614, "body": "I wonder what the type system would need to be able to recognize that the value of <code>show Nothing</code> is independent of the concrete type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1515506232, "post_id": 48167868, "comment_id": 83318798, "body": "@chepner That would also require proving that the argument of <code>print</code> is indeed <code>Nothing</code>, which is unfeasible in general. Still, for the cases where this is feasible, it would be indeed interesting to have such a &quot;partially dependent&quot; type system. If we had subtyping, we could let &#39;Nothing` to have its own subtype of <code>Maybe a&#39;, and define </code>Show` on the subtype. (This opens new cans of worms, like overlapping instances, though.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515506778, "post_id": 48167868, "comment_id": 83319142, "body": "I figured it would have something to do with dependent types. I was thinking only of direct uses like <code>show Nothing</code>, not <code>show expressionThatMightReduceToNothing</code>, so I see that&#39;s the big stumbling block: too much (undecidable) work for the type checker."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 81, "user_id": 7334370, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-vlQRvZMKqto/AAAAAAAAAAI/AAAAAAAADu0/Oq_HBklkrwQ/photo.jpg?sz=128", "display_name": "M&#225;rton Kardos", "link": "https://stackoverflow.com/users/7334370/m%c3%a1rton-kardos"}, "edited": false, "score": 0, "creation_date": 1515512940, "post_id": 48167868, "comment_id": 83323232, "body": "@M&#225;rtonKardos If this answer solved your problem, you should also accept it as such!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1515499484, "creation_date": 1515499484, "answer_id": 48167868, "question_id": 48167166, "link": "https://stackoverflow.com/questions/48167166/not-typed-empty-list-haskell/48167868#48167868", "title": "Not typed empty list : Haskell", "body": "<p>There's nothing wrong with <code>myHead</code>, you would have the same issue if you used:</p>\n\n<pre><code>main = do\n   print Nothing\n</code></pre>\n\n<p>The issue here is that <code>Nothing</code> and <code>myHead []</code> have a polymorphic type <code>Maybe a</code>, for any <code>a</code>. Then, <code>print</code> is called to write that value. For that, <code>print</code> has to require that <code>Maybe a</code> is convertible to string: it does that by requiring <code>Show (Maybe a)</code>, which in turn it requires <code>Show a</code>.</p>\n\n<p>However, there is no universal instance of <code>Show a</code>: the compiler now needs to know what <code>a</code> is before it can convert that to string.</p>\n\n<p>Note this</p>\n\n<pre><code>print (Just 3 :: Maybe Int) -- OK\nprint (Just id :: Maybe (Int-&gt;Int)) -- Not OK! Functions can not be printed\n</code></pre>\n\n<p>The solution is to use a concrete type for your code</p>\n\n<pre><code>main = do\n   print (myHead [] :: Maybe Int) -- or any other showable type\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 7334370, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-vlQRvZMKqto/AAAAAAAAAAI/AAAAAAAADu0/Oq_HBklkrwQ/photo.jpg?sz=128", "display_name": "M&#225;rton Kardos", "link": "https://stackoverflow.com/users/7334370/m%c3%a1rton-kardos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 48167868, "answer_count": 1, "score": -2, "last_activity_date": 1515619417, "creation_date": 1515497212, "last_edit_date": 1515619417, "question_id": 48167166, "link": "https://stackoverflow.com/questions/48167166/not-typed-empty-list-haskell", "title": "Not typed empty list : Haskell", "body": "<p>I just tried to write the simplest maybe function I could imagine in Haskell, and got this error message. And magically it only appears, when I try to evaluate myHead for an empty list. What did I do wrong?</p>\n\n<pre><code>module Main \n  where\n\nmyHead :: [a] -&gt; Maybe a\nmyHead [] = Nothing\nmyHead (x:_) = Just x\n\nmain = do\nprint (myHead [])\n</code></pre>\n\n<p>When I run it from a file, I get this output :</p>\n\n<pre><code>main.hs:15:1: error:\n  \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019\n    prevents the constraint \u2018(Show a0)\u2019 from being solved.\n    Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n These potential instances exist:\n   instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n   instance Show Integer -- Defined in \u2018GHC.Show\u2019\n   instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n    ... plus 22 others\n     ...plus 12 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n \u2022 In a stmt of a 'do' block: print (myHead [])\n  In the expression: do { print (myHead []) }\n  In an equation for \u2018main\u2019: main = do { print (myHead []) }\n  &lt;interactive&gt;:3:1: error:\n   \u2022 Variable not in scope: main\n   \u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell", "opaleye"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1515502234, "post_id": 48167406, "comment_id": 83316351, "body": "Thanks a lot! After looking submitting my question I realized the tutorial referred to an old version of the documentation. In the <a href=\"https://hackage.haskell.org/package/product-profunctors-0.8.0.3/docs/Data-Profunctor-Product-TH.html\" rel=\"nofollow noreferrer\">newest version of <code>product-profuctors</code></a> this is also explained."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 2, "creation_date": 1515588068, "post_id": 48167406, "comment_id": 83355028, "body": "@DamianNadales I pushed this to improve the situation <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/commit/ddcee2f2ba0d20ab7f8e1d2bf09e940d23f04942\" rel=\"nofollow noreferrer\">github.com/tomjaguarpaw/haskell-opaleye/commit/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1515497973, "creation_date": 1515497973, "answer_id": 48167406, "question_id": 48167003, "link": "https://stackoverflow.com/questions/48167003/declaring-an-opaleye-table-without-using-templatehaskell/48167406#48167406", "title": "Declaring an Opaleye table without using TemplateHaskell", "body": "<p>GHC has a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debugging.html#dumping-out-compiler-intermediate-structures\" rel=\"nofollow noreferrer\"><code>-ddump-splices</code> option</a> to see the code generated with TH. I think that should be useful as it probably doesn't look too bad. (With <code>-ddump-to-file</code> and <code>-dumpdir</code> to control the output location.)</p>\n\n<p>Here's one way to write it:</p>\n\n<pre><code>instance (ProductProfunctor p, Default p a a', Default p b b') =&gt; Default p (Birthday' a b) (Birthday' a' b') where\n  def :: p (Birthday' a b) (Birthday' a' b')\n  def = pBirthday (Birthday def def)\n\n\npBirthday :: ProductProfunctor p =&gt;\n  Birthday' (p a a') (p b b') -&gt; p (Birthday a b) (Birthday a' b')\npBirthday (Birthday pa pb) =\n  Birthday `rmap` lmap bdName pa **** lmap bdDay pb\n  -- It generalizes the applicative construct\n  --   \"Birthday &lt;$&gt; pa &lt;*&gt; pb\"\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 48167406, "answer_count": 1, "score": 0, "last_activity_date": 1515497973, "creation_date": 1515496590, "question_id": 48167003, "link": "https://stackoverflow.com/questions/48167003/declaring-an-opaleye-table-without-using-templatehaskell", "title": "Declaring an Opaleye table without using TemplateHaskell", "body": "<p>The <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/blob/master/Doc/Tutorial/TutorialBasic.lhs\" rel=\"nofollow noreferrer\"><code>opaleye</code> basic tutorial</a> gives an example on how to use user defined types in record types and queries:</p>\n\n<pre><code>data Birthday' a b = Birthday { bdName :: a, bdDay :: b }\ntype Birthday = Birthday' String Day\ntype BirthdayColumn = Birthday' (Column PGText) (Column PGDate)\n\nbirthdayTable :: Table BirthdayColumn BirthdayColumn\nbirthdayTable = table \"birthdayTable\"\n    (pBirthday Birthday { bdName = tableColumn \"name\"\n                        , bdDay  = tableColumn \"birthday\" })\n</code></pre>\n\n<p>Function <code>pBirthday</code> is generated using <code>TemplateHaskell</code>:</p>\n\n<pre><code> $(makeAdaptorAndInstance \"pBirthday\" ''Birthday')\n</code></pre>\n\n<p>Where <code>makeAdaptorAndInstance</code> is a defined in <a href=\"https://hackage.haskell.org/package/product-profunctors-0.6.3.1/docs/Data-Profunctor-Product-TH.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Product.TH</code></a>.</p>\n\n<p>I would like to avoid using <code>TemplateHaskell</code>. The <code>opaleye</code> tutorial simply refers to the documentation of <code>Data.Functor.Product.TH</code>, which only explains that the instances generated by <code>makeAdaptorAndInstance</code> will be:</p>\n\n<pre><code>instance (ProductProfunctor p, Default p a a', Default p b b', Default p c c')\n  =&gt; Default p (Birthday a b c) (Birthday a' b' c')\n</code></pre>\n\n<p>and <code>pBirthday</code> will have the type:</p>\n\n<pre><code>pBirthday :: ProductProfunctor p =&gt;\n    Birthday (p a a') (p b b') (p c c') -&gt; p (Birthday a b c) (Birthday a' b' c')\n</code></pre>\n\n<p>But I cannot find any information on how to fill implement these functions by hand.</p>\n"}, {"tags": ["haskell", "comparison"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1515483923, "post_id": 48163259, "comment_id": 83306016, "body": "Why would GHC compare pointers before invoking Eq? If you want fast equality checks of giant data structures, why not use a Merkle tree or similar?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515485796, "post_id": 48163259, "comment_id": 83306904, "body": "You can also (although this i a terribly bad idea), define <code>_ == _ = False</code> (so everything is <code>False</code>), by comparing pointers, it would be <code>True</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515487384, "post_id": 48163259, "comment_id": 83307648, "body": "Furthermore one of the concepts behind Haskell is usually that you do not know about pointers (yes Haskell code gives a good idea how it works with pointers behind the curtains, but conceptually, it is unknown how the compiler translates this)."}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1515530200, "post_id": 48163259, "comment_id": 83332361, "body": "@Rein because if the pointers are equal, the contents are equal."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1515530761, "post_id": 48163259, "comment_id": 83332647, "body": "@FilipHaglund There&#39;s actually no law that says that <code>x == x = True</code>."}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1515540736, "post_id": 48163259, "comment_id": 83336515, "body": "Well, there could be one for Eq. If you want a non-reflexive equality you could define your own. In most cases, it&#39;s reflexive, and then this would be a performance optimization, and quite a big one for larger structures"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1515495070, "post_id": 48164587, "comment_id": 83312089, "body": "<code>containers</code> does use this, and has for a couple years. Where does <code>unordered-containers</code> use it?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515504379, "post_id": 48164587, "comment_id": 83317642, "body": "I don&#39;t think the use cases for <code>reallyUnsafePtrEquality</code> are &quot;very limited&quot; - I think you could use it in very many places where you want to improve the performance of equality checks. So long as you understand the caveats about false negatives; however, it will never give a false positive, so it&#39;s pretty safe. Also from what I can tell the GHC docs are wrong; it returns <code>#1</code> for equal and <code>#0</code> for not equal"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515506130, "post_id": 48164587, "comment_id": 83318741, "body": "@user2407038 Indeed. Good catch on the error; <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14653\" rel=\"nofollow noreferrer\">I&#39;ve filed a bug report</a> concerning the bad documentation"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515515371, "post_id": 48164587, "comment_id": 83324777, "body": "@dfeuer Thanks! I had recently surveyed the  open tickets of <code>containers</code> and <a href=\"https://github.com/haskell/containers/issues/226\" rel=\"nofollow noreferrer\">this</a> misled me. :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515515505, "post_id": 48164587, "comment_id": 83324843, "body": "@user2407038 I maintain that there is almost always lower hanging fruit. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515524301, "post_id": 48164587, "comment_id": 83329602, "body": "Yeah, that&#39;s what happens when I forget to close tickets, or forget they exist. Thanks for the tip. And you just made me realize that my next experiment will be using unboxed sums for unions and intersections rather than pointer equality. Can I put everything I want on the GHC stack? Maybe I can now."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1515517520, "last_edit_date": 1515517520, "creation_date": 1515488696, "answer_id": 48164587, "question_id": 48163259, "link": "https://stackoverflow.com/questions/48163259/does-ghc-compare-pointers-before-invoking-eq/48164587#48164587", "title": "Does GHC compare pointers before invoking Eq?", "body": "<p>No, it does not. <code>Eq</code> is a typeclass like any other, so <code>x == x</code> (the reflexive law) is a user-enforced guideline - not a compiler enforced one. As suggested in the comments, you could implement the following instance of <code>Eq</code> for which comparing pointers would actually be incorrect (since doing so might sometimes return <code>True</code>).</p>\n\n<pre><code>data NeverEqual = NeverEqual\n\ninstance Eq NeverEqual where\n  _ == _ = False\n</code></pre>\n\n<h3>Unsafe stuff, please don't use this - but yes, it exists:</h3>\n\n<p>That said, there are some <em>very limited</em> cases where one actually does want to do what you suggest. You can pretty much always eke out performance elsewhere instead, and this function I am about to mention is going to break referential transparency.</p>\n\n<p>For those cases, there is the <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.1.1/docs/GHC-Prim.html#v:reallyUnsafePtrEquality-35-\" rel=\"nofollow noreferrer\"><code>reallyUnsafePtrEquality# :: a -&gt; a -&gt; Int#</code></a> which compares the pointers of two boxed values of the same type returning <code>1#</code> when they are equal and <code>0#</code> otherwise. See <a href=\"https://github.com/tibbe/unordered-containers/blob/c0d3976fbc96d566ae3fc457b670a6618dae8a8d/Data/HashMap/Base.hs#L1348\" rel=\"nofollow noreferrer\"><code>unordered-containers</code></a> and <a href=\"https://github.com/haskell/containers/blob/71e293eb0849dee89dbabc6bd7fa258094b4db6c/Utils/Containers/Internal/PtrEquality.hs#L34-L38\" rel=\"nofollow noreferrer\"><code>containers</code></a> for example uses.</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "closed_date": 1515508669, "accepted_answer_id": 48164587, "answer_count": 1, "score": 1, "last_activity_date": 1515517520, "creation_date": 1515483046, "question_id": 48163259, "link": "https://stackoverflow.com/questions/48163259/does-ghc-compare-pointers-before-invoking-eq", "closed_reason": "Needs more focus", "title": "Does GHC compare pointers before invoking Eq?", "body": "<p><a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2014-August/115668.html\" rel=\"nofollow noreferrer\">This entry on the mailing list</a> from 2014 seems to indicate that the answer is no. If it's still no, how can I quickly compare two giant data structures where one is either an exact match of the other, or a slightly changed version? </p>\n"}, {"tags": ["haskell", "operator-overloading"], "answers": [{"comments": [{"owner": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "edited": false, "score": 0, "creation_date": 1515516390, "post_id": 48161782, "comment_id": 83325393, "body": "Interesting! Is there any documentation for <code>:</code> being &quot;upper-case punctuation&quot;? I can&#39;t find any references to that term."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "edited": false, "score": 1, "creation_date": 1515520744, "post_id": 48161782, "comment_id": 83327790, "body": "@DylanSp The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\" rel=\"nofollow noreferrer\">Haskell Report</a> is the canonical source. See especially the production rule for <i>consym</i>, though the whole linked section is pretty related. To help you read these rules, the subscript notation in production rules means &quot;all of the things in the normal text, except none of the things in the subscripted text&quot; (this is described earlier in the document)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1515474735, "creation_date": 1515474735, "answer_id": 48161782, "question_id": 48161715, "link": "https://stackoverflow.com/questions/48161715/why-cant-i-redefine-the-operator-in-haskell/48161782#48161782", "title": "Why can&#39;t I redefine the : operator in Haskell?", "body": "<p>It is impossible to redefine <code>:</code>, but that is not why you are getting that error. You are getting that error because <code>:</code> is considered \"upper-case punctuation\" -- that is, any name that starts with <code>:</code> must be an (infix) value constructor. Nevertheless, even with <code>NoImplicitPrelude</code> and <code>RebindableSyntax</code> turned on, you will find that, e.g.</p>\n\n<pre><code>data Foo = Foo : Foo\n</code></pre>\n\n<p>gives you an error, saying:</p>\n\n<pre><code>error: Illegal binding of built-in syntax: :\n</code></pre>\n\n<p>Presumably with some extra engineering effort, a future GHC could support redefining <code>:</code> with some suitable extensions turned on, but for now it's not possible.</p>\n"}], "owner": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 48161782, "answer_count": 1, "score": 1, "last_activity_date": 1515474735, "creation_date": 1515474260, "last_edit_date": 1592644375, "question_id": 48161715, "link": "https://stackoverflow.com/questions/48161715/why-cant-i-redefine-the-operator-in-haskell", "title": "Why can&#39;t I redefine the : operator in Haskell?", "body": "<p>I'm trying to reimplement some functionality of the list data type in Haskell for learning purposes. When I try to redefine <code>:</code> with this code:</p>\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\n\ndata List a = Nil\n            | Cons a (List a)\n\n(:) :: a -&gt; List a -&gt; List a\n(:) = Cons\n</code></pre>\n<p>I get the following error with <code>stack runghc</code>:</p>\n<blockquote>\n<p>Invalid type signature: (:) :: ...</p>\n<p>Should be of form &lt;variable&gt; :: &lt;type&gt;</p>\n</blockquote>\n<p>Is it impossible to redefine <code>:</code>? Is that why I'm getting this error?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "stackage"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1515465736, "post_id": 48160590, "comment_id": 83300989, "body": "That &quot;where did my dump files go?&quot; thing is super-annoying. Do you know if it works to add <code>-dumpdir=mydumps</code> to the GHC options, or does stack override that?"}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 1, "creation_date": 1515540110, "post_id": 48160590, "comment_id": 83336351, "body": "Yeah, sorry about that, stack parses ddump-hi to get info for recompilation detection.  Ideally, it could only redirect that particular ddump"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1515464185, "creation_date": 1515464185, "answer_id": 48160590, "question_id": 48160458, "link": "https://stackoverflow.com/questions/48160458/how-can-i-get-ghc-core-output-via-stack/48160590#48160590", "title": "How can I get GHC Core output via stack?", "body": "<p>Make sure to clean before, or force recompilation via the stack option <code>--force-dirty</code> and ghc option <code>-fforce-recomp</code>.</p>\n\n<p>The files are dumped somewhere around <code>.stack-work/dist/.../build/hello_world/hello_world-tmp/</code>.</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 567, "favorite_count": 1, "accepted_answer_id": 48160590, "answer_count": 1, "score": 6, "last_activity_date": 1546440758, "creation_date": 1515462780, "last_edit_date": 1546440758, "question_id": 48160458, "link": "https://stackoverflow.com/questions/48160458/how-can-i-get-ghc-core-output-via-stack", "title": "How can I get GHC Core output via stack?", "body": "<p>How do I get a <code>stack build</code> command to dump the GHC Core?\nI've tried this, to no avail:</p>\n\n<pre><code>stack build :hello_world --ghc-options '-ddump-simpl'\n</code></pre>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1515467121, "post_id": 48160345, "comment_id": 83301294, "body": "There is no IO here.  Deserializing and it&#39;s performance was one of my first annoyances with Haskell.  You could look Kat the pureMD5 package and the word 32 deserialization for one method."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1515524375, "last_edit_date": 1515524375, "creation_date": 1515467723, "answer_id": 48160962, "question_id": 48160345, "link": "https://stackoverflow.com/questions/48160345/efficient-conversion-of-bytestring-to-word16/48160962#48160962", "title": "Efficient Conversion of Bytestring to [Word16]", "body": "<p>I suspect the big problem you're encountering with <code>Data.Binary.Get</code> is that the decoders are inherently much too strict for your purpose. This also appears to be the case for <code>serialise</code>, and probably also the other serialization libraries. I think the fundamental trouble is that while <em>you</em> know that the operation will succeed as long as the <code>ByteString</code> has an even number of bytes, the library does not know that. So it has to read in the whole <code>ByteString</code> before it can conclude \"Ah yes, all is well\" and construct the list you've requested. Indeed, the way you're building the result, it's going to build a slew of closures (proportional in number to the length) before actually doing anything useful.</p>\n\n<p>How can you fix this? Just use the <code>bytestring</code> library directly. The easiest thing is to use <code>unpack</code>, but I think you'll probably get slightly better performance like this:</p>\n\n<pre><code>{-# language BangPatterns #-}\nmodule Wordy where\nimport qualified Data.ByteString as BS\nimport Data.ByteString (ByteString)\nimport Data.Word (Word16)\nimport Data.Maybe (fromMaybe)\nimport Data.Bits (unsafeShiftL)\n\ntoDBs :: ByteString -&gt; Maybe [Word16]\ntoDBs bs0\n  | odd (BS.length bs0) = Nothing\n  | otherwise = Just (go bs0)\n  where\n    go bs = fromMaybe [] $ do\n      (b1, bs') &lt;- BS.uncons bs\n      (b2, bs'') &lt;- BS.uncons bs'\n      let !res = (fromIntegral b1 `unsafeShiftL` 8) + fromIntegral b2\n      Just (res : go bs'')\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 9190576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc0817820a89882e146e2d961dc1ae16?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan B.", "link": "https://stackoverflow.com/users/9190576/dylan-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 48160962, "answer_count": 1, "score": 3, "last_activity_date": 1551482702, "creation_date": 1515461655, "last_edit_date": 1551482702, "question_id": 48160345, "link": "https://stackoverflow.com/questions/48160345/efficient-conversion-of-bytestring-to-word16", "title": "Efficient Conversion of Bytestring to [Word16]", "body": "<p>I am attempting to do a plain conversion from a bytestring to a list of Word16s. The implementation below using Data.Binary.Get works, though it is a performance bottleneck in the code. This is understandable as IO is always going to be slow, but I was wondering if there isn't a more efficient way of doing this.</p>\n\n<pre><code>getImageData' = do\n    e &lt;- isEmpty\n    if e then return []\n      else do\n      w &lt;- getWord16be\n      ws &lt;- getImageData'\n      return $ w : ws\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1515460831, "post_id": 48159763, "comment_id": 83299975, "body": "I voted &quot;unclear what you&#39;re asking&quot; because this seems more like a log of frustrations.  Do you have any specific question, or maybe you want to post some code at <a href=\"https://codereview.stackexchange.com/\">codereview</a> (which I&#39;d be happy to look at and make suggestions if you ping me)?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 7, "creation_date": 1515461604, "post_id": 48159763, "comment_id": 83300142, "body": "Go all-in with mtl style. Write <code>type Ingest m = (Logging m, ReadFile m, MonadReader Options m, MonadError String m)</code>, then write <code>Ingest m =&gt; m a</code> instead of <code>Ingest m a</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1515534809, "post_id": 48159763, "comment_id": 83334443, "body": "@AlexisKing I didn&#39;t know you can use <code>type</code> to define constraint synonyms. Is that new?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1515534899, "post_id": 48159763, "comment_id": 83334496, "body": "@amalloy No, it\u2019s always been allowed by using the <code>ConstraintKinds</code> language extension, which has been available since GHC 7.4.1."}], "answers": [{"tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 1, "last_activity_date": 1600721013, "last_edit_date": 1600721013, "creation_date": 1600668964, "answer_id": 63987051, "question_id": 48159763, "link": "https://stackoverflow.com/questions/48159763/how-to-create-a-limited-version-of-the-io-monad/63987051#63987051", "title": "How to create a limited version of the IO monad", "body": "<p>Instead of using <code>IO</code> directly, wrap it in a <em>abstract</em> <code>newtype</code> e.g:</p>\n<pre><code>module IOLog(IOLog, logMsg) where \n\nnewtype IOLog a = IOLog (IO a)\n\ninstance Functor IOLog where ...\n\ninstance Monad IOLog where ...\n\nlogMsg :: String -&gt; IOLog ()\nlogMsg =  logIO . log\n\n -- local definitions --\n --\nlogIO :: IO a -&gt; IOLog a\nlogIO =  IOLog\n\nlog :: String -&gt; IO ()\n         .\n         .\n         .\n</code></pre>\n<p>and use that to define <code>Ingest</code>:</p>\n<pre><code>type Ingest a = EitherT String (ReaderT Options IOLog) a\n</code></pre>\n<p>In this way you can control what subset of I/O the rest of the program can use, for the price of an extra module - <a href=\"https://www.parsonsmatt.org/2019/12/26/write_junior_code.html\" rel=\"nofollow noreferrer\">no type-system extensions needed!</a></p>\n"}], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1600721013, "creation_date": 1515456264, "question_id": 48159763, "link": "https://stackoverflow.com/questions/48159763/how-to-create-a-limited-version-of-the-io-monad", "title": "How to create a limited version of the IO monad", "body": "<p>I have written a number of functions using a monad transformer stack:</p>\n\n<pre><code>data Options\ndata Result\ndata Input\ntype Ingest a = EitherT String (ReaderT Options IO) a\n\nfoo :: Input -&gt; Ingest Result\n</code></pre>\n\n<p>and so on. Now, most of these functions are fundamentally pure. I only need IO in one of these functions: this function reads a file, and logs (using <code>log :: String -&gt; IO ()</code>) that it has done so. So the impurity of this one function \"infects\" my whole codebase, making all these functions capable of doing IO even though they don't need to, except to call this one function. This is distasteful for two reasons: </p>\n\n<ul>\n<li>It doesn't make it clear what limited subset of IO these might perform</li>\n<li>It doesn't make it clear which functions actually perform that IO</li>\n</ul>\n\n<p>A colleague suggested parameterizing <code>Ingest</code> over a base monad type, which I like. Specifically, define a typeclass for reading the contents of a file, and provide an instance for IO as well as perhaps for some other monad to use in writing tests:</p>\n\n<pre><code>class Monad m =&gt; ReadFile m where\n  readFile :: FilePath -&gt; m Text\n\ninstance ReadFile IO where\n  readFile = Data.Text.IO.readFile\n</code></pre>\n\n<p>A typeclass for logging already exists, so I could just use that existing typeclass. But then I'm not sure how to use this new class. Firstly, what do I replace my type alias with? I can't write </p>\n\n<pre><code>type Ingest m a = (Logging m, ReadFile m) =&gt; EitherT String (ReaderT Options m) a\n</code></pre>\n\n<p>because constraints are not permitted on type synonyms. Must I add that constraint to each of my functions? In principle this is nice because it flags the functions which may need to read a file, but in practice these functions are mutually recursive, and so all of them need that permission, making it a pain to write them all out.</p>\n\n<p>I could define a newtype wrapper instead of a type synonym, but I don't think that makes things any better: I still have to add this new constraint to each of my functions.</p>\n\n<p>Secondly, how do I actually call the functions of my new typeclass, from within the EitherT/ReaderT stack? I can't simply write</p>\n\n<pre><code>foo :: ReadFile m =&gt; FilePath -&gt; Ingest m Text\nfoo = readFile\n</code></pre>\n\n<p>because this ignores the EitherT and ReaderT wrappers. Do I instead write this?</p>\n\n<pre><code>foo :: ReadFile m =&gt; FilePath -&gt; Ingest m Text\nfoo = lift . lift $ readFile\n</code></pre>\n\n<p>Seems kinda a pain and quite fragile to the structure of the transformer stack. Do I write a number of instances like</p>\n\n<pre><code>instance ReadFile m =&gt; ReadFile (EitherT e m) where\n  readFile = lift readFile\n</code></pre>\n\n<p>? That seems like a frustrating amount of boilerplate as well.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515452180, "post_id": 48158787, "comment_id": 83297946, "body": "Looks like the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Type-Reflection.html#v:App\" rel=\"nofollow noreferrer\">pattern synonyms</a> in the library are what you need"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515453232, "post_id": 48158787, "comment_id": 83298284, "body": "Aren&#39;t those only for pattern matching? Not construction?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515453381, "post_id": 48158787, "comment_id": 83298315, "body": "@luqui Nevermind. Just tried it in GHCi and it definitely worked. Can&#39;t remember why I thought that. I&#39;ll see if I get it working with the pattern synonyms."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515512194, "post_id": 48158787, "comment_id": 83322752, "body": "@luqui Tried it this morning again and realized what I did wrong. the <code>pattern App</code> is bi-directional, but <code>Con</code> and <code>Con&#39;</code> are not. If you try to use them as constructors you get the following error message: &quot;non-bidirectional pattern synonym Con&#39; used in an expression&quot;"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515514752, "post_id": 48158787, "comment_id": 83324363, "body": "ah yeah, because <code>TyCon</code> has no type information about the constructor, so there&#39;s no way to reflect it to the type level.  But using e.g. <code>(typeRep :: TypeRep Maybe)</code> works fine to construct a literal constructor rep."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515599773, "post_id": 48158787, "comment_id": 83362862, "body": "@luqui Is there a way to infer the <code>Maybe</code> portion of your example from a <code>(TyCon, [SomeTypeRep])</code>? That&#39;s what I would need to be able to reconstruct the type reps I think."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1515624856, "post_id": 48158787, "comment_id": 83375883, "body": "Haskell is not dependenly typed, so there is no way for information to flow from the value level to the type level like that.   Besides, in asking this question, you have already lost the connection between the <code>TyCon</code> and the type it represents ... it&#39;s unclear how you would use this inference to your advantage even if you could."}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1515449470, "creation_date": 1515449470, "question_id": 48158787, "link": "https://stackoverflow.com/questions/48158787/how-can-you-decompose-compose-types-using-the-type-reflection-library", "title": "How can you decompose/compose types using the Type.Reflection library?", "body": "<p><sub>This is related to a <a href=\"https://stackoverflow.com/questions/46348867/how-can-you-extract-type-information-from-a-proxy\">previous question of mine</a>, where I was directed to the new functionality in GHC 8.2.</sub></p>\n\n<hr>\n\n<p>The new (in base 4.10) <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Type-Reflection.html\" rel=\"nofollow noreferrer\">Type.Reflection</a> library claims: </p>\n\n<blockquote>\n  <p>The interface provides TypeRep, a type representation which can be safely decomposed and composed. See <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\">Data.Dynamic</a> for an example of this.</p>\n</blockquote>\n\n<p><code>Data.Dynamic</code> shows a way to safely compose/decompose values using <code>TypeRep</code> and checking for type-level equality. In my case, I'd like to inspect and return the underlying types of a given <code>TypeRep</code>. </p>\n\n<p>It's easy to peek into a type to see what makes it up now using a variety of tools. One of which is the function <code>splitApps :: TypeRep a -&gt; (TyCon, [SomeTypeRep])</code>. </p>\n\n<p>The problem seems to be that any way I can look into a <code>TypeRep</code> only provides back the non-indexed version of the type: <code>SomeTypeRep</code>. So, I looked around and found <code>mkTrCon :: forall k (a :: k). TyCon -&gt; [SomeTypeRep] -&gt; TypeRep a</code> which has the exact type signature I'm looking for and allows me to rebuild a <code>TypeRep</code> from its constituent parts! Except, it's not exposed by the module. </p>\n\n<p>So what am I missing? Is there a way to actually rebuild a <code>TypeRep</code> from <code>SomeTypeRep</code> (i.e. <code>f :: SomeTypeRep -&gt; TypeRep a</code>) or to get the underlying <code>TypeRep</code>'s that build up a type? Do I just need to copy the source of <code>Data.Typeable.Internal</code> to get access to the functions I want to use?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515447587, "post_id": 48157516, "comment_id": 83296345, "body": "Did you include <code>{-# LANGUAGE CPP #-}</code> in the module of interest?"}, {"owner": {"reputation": 41, "user_id": 7992349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1690b3a2d71cd720c16243dda3b6b574?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Feller", "link": "https://stackoverflow.com/users/7992349/erik-feller"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515448026, "post_id": 48157516, "comment_id": 83296513, "body": "@ThomasM.DuBuisson Yes I have included the CPP language extension in the file."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7992349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1690b3a2d71cd720c16243dda3b6b574?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Feller", "link": "https://stackoverflow.com/users/7992349/erik-feller"}, "edited": false, "score": 0, "creation_date": 1515454606, "post_id": 48158564, "comment_id": 83298646, "body": "Thanks, out of curiosity why would you avoid using CPP like this? If I have multiple modules that will need to change based on being a release or not isn&#39;t it easier to adjust these at compile time rather than passing a variable through the whole program?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1515464424, "post_id": 48158564, "comment_id": 83300729, "body": "You can also combine cabal flags with the following approach in order to get rid of CPP altogether in many cases <a href=\"http://blog.haskell-exists.com/yuras/posts/stop-abusing-cpp-in-haskell.html\" rel=\"nofollow noreferrer\">blog.haskell-exists.com/yuras/posts/&hellip;</a>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1515509023, "post_id": 48158564, "comment_id": 83320586, "body": "Also, don&#39;t use <code>configurator</code>. It&#39;s outdated and not maintained. use <code>configurator-ng</code> instead: <a href=\"https://hackage.haskell.org/package/configurator-ng\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/configurator-ng</a>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 5, "last_activity_date": 1515509290, "last_edit_date": 1515509290, "creation_date": 1515448179, "answer_id": 48158564, "question_id": 48157516, "link": "https://stackoverflow.com/questions/48157516/conditional-compilation-in-haskell-submodule/48158564#48158564", "title": "Conditional Compilation in Haskell submodule", "body": "<p>I would solve this with the help of flags</p>\n\n<h2><code>cppstuf.cabal</code>-file</h2>\n\n<pre><code>name:                cppstuf\nversion:             0.1.0.0\n...\ncabal-version:       &gt;=1.10\n\nflag StableRelease {\n  Description: Stable release settings like port ...\n  Default:     False\n  }\n\nexecutable cppstuf\n  main-is:             Main.hs\n  build-depends:       base &gt;=4.9 &amp;&amp; &lt;5.00\n  default-language:    Haskell2010\n  extensions: CPP\n  if flag(StableRelease) {\n    GHC-Options: -DSTABLE\n  }\n</code></pre>\n\n<h2><code>Main.hs</code></h2>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain =\n#if STABLE\n  putStrLn \"Hello, Haskell!\"\n#else\n  putStrLn \"Hello, Haskell?\"\n#endif\n</code></pre>\n\n<p>and compiling it</p>\n\n<pre><code>stack build\n</code></pre>\n\n<p>or</p>\n\n<pre><code>stack build --flag cppstuf:stablerelease\n</code></pre>\n\n<h2>Personal Note aside from the answer</h2>\n\n<p>I would not use CPP to manage configuration options - either providing command-line options I like <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\">optparse-applicative</a> but there is also <a href=\"https://hackage.haskell.org/package/cmdargs\" rel=\"nofollow noreferrer\">cmdargs</a>,and or a configuration file I have used <strike><a href=\"https://hackage.haskell.org/package/configurator\" rel=\"nofollow noreferrer\">configurator</a> for that</strike>, but there are several options out there on hackage. One being <a href=\"https://hackage.haskell.org/package/configurator-ng\" rel=\"nofollow noreferrer\">configurator-ng</a> as @Shersh said - the other one is not being developed anymore.</p>\n\n<p><code>CPP</code> on the other hand I tend to use for making libraries work across multiple GHC/library versions.</p>\n\n<h2>Update - w\\ regards to the comment.</h2>\n\n<ul>\n<li>If I deliver a program, the operations team should be able to change ports, hostname or handle file location of input files etc. without knowing haskell let alone recompiling a project.</li>\n<li>It makes error chasing a lot easier if your production source code does not differ from your development sources, say you would have a postgres db in dev mode, but an oracle in production - you'll never find the oracle specific bug.</li>\n<li>For things like optimization levels - I don't mind too much.</li>\n<li>But make sure you test multi-threaded stuff properly, I once ran out of file handles because I was opening a lot but not closing fast enough - If your dev-setting is single threaded you'll deliver a bug.</li>\n</ul>\n"}], "owner": {"reputation": 41, "user_id": 7992349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1690b3a2d71cd720c16243dda3b6b574?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Feller", "link": "https://stackoverflow.com/users/7992349/erik-feller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1515509290, "creation_date": 1515442922, "last_edit_date": 1515447465, "question_id": 48157516, "link": "https://stackoverflow.com/questions/48157516/conditional-compilation-in-haskell-submodule", "title": "Conditional Compilation in Haskell submodule", "body": "<p>I'm trying to have a submodule in my program compile conditionally to switch small parts of the code between release builds and development builds.</p>\n\n<p>Currently I'm attempting to use <a href=\"http://hackage.haskell.org/package/cpphs-1.17/src/docs\" rel=\"nofollow noreferrer\">cpphs</a> however when I change the flags passed into GHC to define a variable and change an ifdef statement stack won't recompile those files. </p>\n\n<p>For example, I've got a port number that I want to switch based on which target I have built. The code I have defining this number looks like this.</p>\n\n<pre><code>#ifdef StableRelease \n  port = 12345\n#else \n  port = 54321 \n#endif\n</code></pre>\n\n<p>the stable build has the following options in its cabal file </p>\n\n<pre><code>ghc-options: -threaded -rtsopts -with-rtsopts=-N -pgmP cpphs -optP \"-DStableRelease\"\n</code></pre>\n\n<p>When I run <code>stack build</code> though it doesn't seem to actually pre-process the code above.\nDoes anyone have experience with cpphs or another preprocessing solution? </p>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 2, "creation_date": 1515426127, "post_id": 48153186, "comment_id": 83285815, "body": "Show how you define <code>Parser</code>. Also, which version of Megaparsec are you using?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 2, "creation_date": 1515426442, "post_id": 48153186, "comment_id": 83286014, "body": "@Mark Isn&#39;t that the <code>Parser</code> from <code>Text.Megaparsec.String</code>? That being said, I cannot reproduce that issue with the <code>Parser</code> from <code>Text.Megaparsec.String</code>\u2026"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1515426654, "post_id": 48153186, "comment_id": 83286150, "body": "@Zeta, Yes, I suspect this is Megaparsec 5 (according to the link), and I&#39;m having a hard time imagining how this issue could happen... We need a full reproducing example with clarification about actual version of the library used."}, {"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 0, "creation_date": 1515426904, "post_id": 48153186, "comment_id": 83286290, "body": "megaparsec 5.3.1"}], "answers": [{"comments": [{"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 0, "creation_date": 1515425740, "post_id": 48153313, "comment_id": 83285575, "body": "That gives me  ```     * Could not deduce: Token s0 ~ Char         arising from a use of spaceChar       from the context: (Token s ~ Char, MonadParsec e s f)         bound by the type signature for:                    x :: (Token s ~ Char, MonadParsec e s f) =&gt; f ()         at BLAH       The type variable s0 is ambiguous     * In the first argument of void, namely spaceChar       In the expression: void spaceChar       In an equation for `x&#39;: x = void spaceChar ```"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1515425383, "creation_date": 1515425383, "answer_id": 48153313, "question_id": 48153186, "link": "https://stackoverflow.com/questions/48153186/type-resolution-in-haskell-megaparsec-parsing-a-single-space/48153313#48153313", "title": "Type Resolution in Haskell: MegaParsec/ Parsing a single space", "body": "<p>ghci suggests the type <code>(Token s ~ Char, MonadParsec e s f) =&gt; f ()</code>. That one should work. Where did you get the name <code>Parser</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "is_accepted": true, "score": 0, "last_activity_date": 1515427279, "creation_date": 1515427279, "answer_id": 48153876, "question_id": 48153186, "link": "https://stackoverflow.com/questions/48153186/type-resolution-in-haskell-megaparsec-parsing-a-single-space/48153876#48153876", "title": "Type Resolution in Haskell: MegaParsec/ Parsing a single space", "body": "<p>I've tracked down the issue whilst trying to create a reproduction. The problem was a bit abstruse: I wasn't importing Control.Monad. Instead, it looks like void was being picked up somewhere else (not sure where) and this definition of void caused that error to occur. Thank you for everyone who tried to help.</p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 48153876, "answer_count": 2, "score": 1, "last_activity_date": 1515427279, "creation_date": 1515424912, "last_edit_date": 1515424999, "question_id": 48153186, "link": "https://stackoverflow.com/questions/48153186/type-resolution-in-haskell-megaparsec-parsing-a-single-space", "title": "Type Resolution in Haskell: MegaParsec/ Parsing a single space", "body": "<p>If I look at the <a href=\"https://www.stackage.org/haddock/lts-9.17/megaparsec-5.3.1/Text-Megaparsec-Lexer.html\" rel=\"nofollow noreferrer\">documentation for <code>space</code></a> it suggests using <code>void spaceChar</code>.</p>\n\n<p>However, if I actually try:</p>\n\n<pre><code>x :: Parser ()\nx = void spaceChar\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>* Couldn't match type `Token s0' with `Char'\n    arising from a use of `spaceChar'\n  The type variable `s0' is ambiguous\n* In the first argument of `void', namely `spaceChar'\n  In the expression: void spaceChar\n  In an equation for `x': x = void spaceChar\n</code></pre>\n\n<p>I think the expression is correct, but there's something I need to do to convince the type checker. How do I get this to work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515420791, "post_id": 48151769, "comment_id": 83282492, "body": "It would be helpful if you gave a bit more information about the dependencies, what the changes are, what does <i>not</i> change, etc.."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1515421376, "creation_date": 1515421376, "answer_id": 48152256, "question_id": 48151769, "link": "https://stackoverflow.com/questions/48151769/multiversion-api-implementation/48152256#48152256", "title": "Multiversion API implementation", "body": "<p>This seems like a use case of <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Backpack\" rel=\"nofollow noreferrer\">backpack</a>. Separate the types and instances that change between the two versions in one library for each version, and write the rest of the project against the common interface, which you can instantiate twice, similarly to ML functors.</p>\n\n<p>If you don't want to duplicate the type declarations, I'm not certain it would work well, but maybe you can declare  types with a phantom parameter of kind <code>Version</code> in a common library:</p>\n\n<pre><code>data Version = V1 | V2\n\ndata MyData (v :: Version) = ...\ndata MyData2 (v :: Version) = C X Y (MyData v) | ...\n</code></pre>\n\n<p>and have two libraries declaring orphan instances for <code>MyData V1</code> and <code>MyData V2</code> respectively.</p>\n\n<blockquote>\n  <p>importing of type only, w/o its instances</p>\n</blockquote>\n\n<p>Instances are always exported and cannot be hidden, that's how Haskell's typeclass system works to ensure coherence (to the extent possible). My suggestion above introduces instances for two disjoint types <code>MyData V1</code>, <code>MyData V2</code>, while making it possible to freely coerce from one to the other.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 1, "accepted_answer_id": 48152256, "answer_count": 1, "score": 3, "last_activity_date": 1515421376, "creation_date": 1515419747, "question_id": 48151769, "link": "https://stackoverflow.com/questions/48151769/multiversion-api-implementation", "title": "Multiversion API implementation", "body": "<p>If I have library which implements API to some REST service  (in several modules: types+API calls+JSON instances...), what is the best (and convenient?) way to implement support for new API (version 2)? To create totally new library? But mostly code is the same, there are some breaking changes in JSON instances, API calls are the same, types mostly are the same. In this case any bug in common code must be \"fixed\" twice: in both libraries (also this involves tests modification in both libraries). How to \"replace\" only instances? Such flexible module modification is possible in ML and in F#, but I didn't find a way to do it in Haskell: importing of type only, w/o its instances and recreate for it new instance leads to error about duplicated instance (although instances are not exported and imported). So, what is the right and best was to create new API without big repeat of code? PS. Client will use both versions together</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "is_accepted": false, "score": 3, "last_activity_date": 1515418734, "creation_date": 1515418734, "answer_id": 48151486, "question_id": 48151407, "link": "https://stackoverflow.com/questions/48151407/haskell-no-instance-for-ord-pos-arising-from-a-use-of-minimum/48151486#48151486", "title": "Haskell - No instance for (Ord Pos) arising from a use of `minimum&#39;", "body": "<p>Your <code>Pos</code> datatype needs to be an instance of the <code>Ord</code> type class in order to be used by <code>minimum</code>. That type class provides comparison functions, such as <code>&lt;</code>. Just add <code>Ord</code> after <code>Show</code> and <code>Eq</code> to let GHC derive the necessary functions for you automatically.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1515419039, "creation_date": 1515419039, "answer_id": 48151564, "question_id": 48151407, "link": "https://stackoverflow.com/questions/48151407/haskell-no-instance-for-ord-pos-arising-from-a-use-of-minimum/48151564#48151564", "title": "Haskell - No instance for (Ord Pos) arising from a use of `minimum&#39;", "body": "<p>First said, albeit unrelated to your question: don't wrap tuples in <code>data</code>, better make them <em>fields</em> of the data type. In this case you also want to make the fields strict, for performance:</p>\n\n<pre><code>data Pos = Pos { xPosition, yPosition :: !Int }\n  deriving (Show, Eq)\n</code></pre>\n\n<p>Now, you need an <code>Ord</code> instance too. Well, the easiest way is to add that to the <code>deriving</code> list!</p>\n\n<pre><code>data Pos = Pos { xPosition, yPosition :: !Int }\n  deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>Alternatively, you could also define it yourself, perhaps because you want a different ordering from the standard one. To do that, you'd write</p>\n\n<pre><code>instance Ord Pos\n</code></pre>\n\n<p>The compiler would then complain:</p>\n\n<pre><code>warning: [-Wmissing-methods]\n    \u2022 No explicit implementation for\n        either \u2018compare\u2019 or \u2018&lt;=\u2019\n    \u2022 In the instance declaration for \u2018Ord Pos\u2019\n  |\n3 | instance Ord Pos\n  |          ^^^^^^^\n</code></pre>\n\n<p>Ok, so we'd better add one of those methods. <code>&lt;=</code> is easier to understand, but <code>compare</code> more directly covers all cases and is therefore recommended. To see what you need to do, start with a stub:</p>\n\n<pre><code>instance Ord Pos where\n  compare = _\n</code></pre>\n\n<p>GHC answers:</p>\n\n<pre><code>\u2022 Found hole: _ :: Pos -&gt; Pos -&gt; Ordering\n\u2022 In the expression: _\n  In an equation for \u2018compare\u2019: compare = _\n  In the instance declaration for \u2018Ord Pos\u2019\n\u2022 Relevant bindings include\n    compare :: Pos -&gt; Pos -&gt; Ordering\n      (bound at /tmp/wtmpf-file6330.hs:4:3)\n</code></pre>\n\n<p>So you need to implement <code>compare</code> as a function with that signature.</p>\n"}], "owner": {"reputation": 45, "user_id": 7330220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c3f8e5f67877cc55b5a9961253d746?s=128&d=identicon&r=PG&f=1", "display_name": "Vacation", "link": "https://stackoverflow.com/users/7330220/vacation"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "accepted_answer_id": 48151564, "answer_count": 2, "score": 1, "last_activity_date": 1515419122, "creation_date": 1515418430, "question_id": 48151407, "link": "https://stackoverflow.com/questions/48151407/haskell-no-instance-for-ord-pos-arising-from-a-use-of-minimum", "title": "Haskell - No instance for (Ord Pos) arising from a use of `minimum&#39;", "body": "<p>I am currently having a bit of an issue with making this bit of code work with my data type. It works fine when I use </p>\n\n<p><code>type Pos = (Int, Int)</code> </p>\n\n<p>however I need to use </p>\n\n<p><code>data Pos = Pos (Int, Int) deriving (Show, Eq)</code>.</p>\n\n<p>For the rest of the code I have been able to change it to <code>(Pos(x,y))</code> which has worked however for this one function it is throwing this error message.</p>\n\n<pre><code>* No instance for (Ord Pos) arising from a use of `minimum'\n* In the second argument of `(.)', namely `minimum'\n  In the expression: snd . minimum\n  In the expression:\n    snd . minimum $ [(score p, p) | p &lt;- allBlanks puzzle]\n</code></pre>\n\n<p>This is my function:</p>\n\n<pre><code>blankX2 puzzle = \n  snd\n  . minimum $ \n  [(score p, p) | p &lt;- allBlanks puzzle] where\n    score (Pos(y,x)) = rowScore y + colScore x + sqScore (div x 3, div y 3)\n    rowScore r = blanksInBlock (row r puzzle)\n    colScore c = blanksInBlock (column c puzzle)\n    sqScore sq = blanksInBlock (square sq puzzle)\n</code></pre>\n"}, {"tags": ["list", "haskell", "io", "functional-programming", "sudoku"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1515417415, "post_id": 48150890, "comment_id": 83280499, "body": "If <code>Puzzle</code> is an alias of <code>[[Maybe Int]]</code>, it should already have a <code>Show</code> instance, which means that you can use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:print\" rel=\"nofollow noreferrer\"><code>print</code></a> with it."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1515417551, "post_id": 48150890, "comment_id": 83280597, "body": "This may, however, not give you the desired formatting. Perhaps <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:unlines\" rel=\"nofollow noreferrer\"><code>unlines</code></a> or <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:intercalate\" rel=\"nofollow noreferrer\"><code>intercalate</code></a> could be helpful to you..."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1515433016, "post_id": 48150890, "comment_id": 83289566, "body": "This question could benefit from a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Exactly <b>how</b> are you wanting to format the output?"}], "answers": [{"tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 6, "last_activity_date": 1515418608, "last_edit_date": 1515418608, "creation_date": 1515417607, "answer_id": 48151178, "question_id": 48150890, "link": "https://stackoverflow.com/questions/48150890/outputting-a-list-of-lists-in-haskell/48151178#48151178", "title": "Outputting a list of lists in Haskell?", "body": "<p>Simple pretty-printing of this can be done really succinctly with something like the following:</p>\n\n<pre><code>import Data.Char (intToDigit)\n\nshowRow :: [Maybe Int] -&gt; String\nshowRow = map (maybe ' ' intToDigit)\n\nshowPuzzle :: [[Maybe Int]] -&gt; [String]\nshowPuzzle = map showRow\n\nprintPuzzle :: [[Maybe Int]] -&gt; IO ()\nprintPuzzle = mapM_ putStrLn . showPuzzle\n</code></pre>\n\n<ul>\n<li><p><code>showRow</code> takes a single row from your grid and prints it - using the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Maybe.html#v:maybe\" rel=\"noreferrer\"><code>maybe</code></a> function from <code>Data.Maybe</code>, we can write this as a quick map from each <code>Maybe Int</code> value to either a default \"blank space\" value or the character representing the number (using <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Char.html#v:intToDigit\" rel=\"noreferrer\"><code>intToDigit</code></a>).</p></li>\n<li><p><code>showPuzzle</code> simply maps <code>showRow</code> over the outer list.</p></li>\n<li><p><code>printPuzzle</code> just uses the previous pure definitions to give the impure action which prints a grid, by <code>putStrLn</code>'ing the pretty-print of each row.</p></li>\n</ul>\n\n<hr>\n\n<p>A quick demo:</p>\n\n<pre><code>&gt; printPuzzle [[Just 1, Nothing, Just 3],\n               [Nothing, Just 3, Just 6],\n               [Just 2, Just 4, Just 5]]\n1 3\n 36\n245\n</code></pre>\n\n<p>Though you can easily modify the above code to print something more explicit, like:</p>\n\n<pre><code>1X3\nX36\n245\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 5418269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb9ada8316f7a7c2b0431dcf9f38eef2?s=128&d=identicon&r=PG&f=1", "display_name": "sea1997", "link": "https://stackoverflow.com/users/5418269/sea1997"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 627, "favorite_count": 0, "accepted_answer_id": 48151178, "answer_count": 1, "score": 3, "last_activity_date": 1515418608, "creation_date": 1515416646, "question_id": 48150890, "link": "https://stackoverflow.com/questions/48150890/outputting-a-list-of-lists-in-haskell", "title": "Outputting a list of lists in Haskell?", "body": "<p>I am a complete beginner to Haskell but I'm being asked to create a sudoku solver. I've been making some steady progress with it but one of the things it is asking me to do is print a valid representation of a sudoku puzzle s. The Puzzle data type is defined as a list of lists, so <code>[[Maybe Int]]</code> and this is composed of Block values (<code>[Maybe Int]</code>, representing a row). </p>\n\n<p>Function signature is this: </p>\n\n<p><code>printPuzzle :: Puzzle -&gt; IO ()</code></p>\n\n<p>How do I output this? I know this may be a simple question and I'm missing the point but I'm still not at the stage where I've got my ahead around the syntax yet. Any help would be much appreciated! </p>\n"}, {"tags": ["list", "haskell", "division"], "comments": [{"owner": {"reputation": 2613, "user_id": 9156061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69150721b719cef2eb990fc78bc9cc0?s=128&d=identicon&r=PG&f=1", "display_name": "mdatsev", "link": "https://stackoverflow.com/users/9156061/mdatsev"}, "edited": false, "score": 0, "creation_date": 1515413979, "post_id": 48150131, "comment_id": 83278549, "body": "what is <code>jot</code> ?"}, {"owner": {"reputation": 4337, "user_id": 649727, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1cb3b3d7e0ccce5f039c37f9bd85de11?s=128&d=identicon&r=PG", "display_name": "phynfo", "link": "https://stackoverflow.com/users/649727/phynfo"}, "edited": false, "score": 3, "creation_date": 1515414127, "post_id": 48150131, "comment_id": 83278639, "body": "Please provide complete example + error messages"}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 2, "creation_date": 1515414224, "post_id": 48150131, "comment_id": 83278684, "body": "map (<code>div</code> 2) [1,2,3,4,5,6] evaluates as [0,1,1,2,2,3], but from your code it looks like you&#39;re trying to do something more complicated..."}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515414296, "post_id": 48150131, "comment_id": 83278735, "body": "this is the latest function in a series of functions defining themselves one after another, jot xs is taking the length of the last of a list of lists intended to represent a graph"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515414683, "post_id": 48150131, "comment_id": 83278957, "body": "from hundreds of error messages im guessing that the problem lies in the type but I simply am not familiar enough with haskell types to understand"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1515414881, "post_id": 48150131, "comment_id": 83279054, "body": "Well, <code>map (&#47; j) hs</code> most certainly does work, provided <code>j</code> is a dividable number and <code>hs</code> a list of such numbers. Apparently the problem lies elsewhere and e.g. <code>hs</code> is <i>not</i> a list of numbers. Always give your functions type signatures, so you&#39;ll see mistakes right where they are, not somewhere completely different. (Also, always use type signatures because they make it much easier to understand what your code is supposed to be doing.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1515415413, "post_id": 48150131, "comment_id": 83279353, "body": "Perhaps unrelated to your problem, but note that the code as given doesn&#39;t even parse. You can&#39;t indent Haskell code like this; all the bindings in a <code>where</code> block must start at the same indentation. (You can add space before the <code>=</code> if you want those to line up, though I daresay this is more often than not a rather bad idea.)"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515415563, "post_id": 48150131, "comment_id": 83279440, "body": "I have all my code lined up correctly in my actual terminal I was just a bit sloppy transferring it as I surf the net and code on two different computers, largely due to the limited capacities of both individually"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1515415864, "post_id": 48150131, "comment_id": 83279620, "body": "Then please use SSH, or FTP, or heck, Email or whatever to move code between the two computers. How are we supposed to analyse the problem if you post code that has completely new issues, and probably does <i>not</i> include the real problem?"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515415927, "post_id": 48150131, "comment_id": 83279652, "body": "fair point my apologies"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1515418180, "last_edit_date": 1515418180, "creation_date": 1515415584, "answer_id": 48150614, "question_id": 48150131, "link": "https://stackoverflow.com/questions/48150131/how-to-divide-a-list-by-a-variable-haskell/48150614#48150614", "title": "How to divide a list by a variable haskell", "body": "<pre><code> where divhs = div hs\n          hs = tupleTest1 xs\n           j = jot xs\n</code></pre>\n\n<p>This is not a correct indentation. The first nonspace character of each line (after <code>where</code>) is what matters. Since each line starts as more indented than the previous, the whole <code>where</code> block is parsed as if it were on a single line.</p>\n\n<pre><code>   where divhs = div hs hs = tupleTest1 xs j = jot xs\n</code></pre>\n\n<p>Hence, errors arise, especially since <code>hs</code> and <code>j</code> are being parsed as additional arguments, and there are too many <code>=</code> signs on that line.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515416341, "post_id": 48150768, "comment_id": 83279900, "body": "absolutely positive"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515416397, "post_id": 48150768, "comment_id": 83279926, "body": "it cant produce anything other than a list of numbers no matter what the input is"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417026, "post_id": 48150768, "comment_id": 83280290, "body": "I just did it again and my error message is                                                                    -                                                                                                                                   -      * couldn&#39;t match expected type &#39;[[int]]&#39; with actual type <code>int</code>                                   -      * In the second argument of <code>map&#39; , namely </code>j&#39;                                                       -        In the expression: map divhs j                                                                   -        In an equation for <code>diver</code> :"}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417111, "post_id": 48150768, "comment_id": 83280344, "body": "@BenjBarrett then your input variable <code>j</code> is apparently not an integer, but instead it is a list of lists of int"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417151, "post_id": 48150768, "comment_id": 83280371, "body": "diver xs                                                                                                                         -   = map div hs j                                                                                                         -   where                                                                                                                     -           hs = tupleTest1 xs                                                                                          -           j = jot xs"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417225, "post_id": 48150768, "comment_id": 83280409, "body": "its meant to be a list of numbers formed of the lengths of lists in a list"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417242, "post_id": 48150768, "comment_id": 83280418, "body": "any advice on how to fix the type?"}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417318, "post_id": 48150768, "comment_id": 83280460, "body": "@BenjBarrett I cannot really read that badly formatted comment. You might want to include your error message in your question, as well as any further details that need nice formatting. Basically what it means when <code>j</code> has the wrong type is that your <code>j = jot xs</code> is not returning what you think it would. The mistake is probably within your function <code>jot</code> or further back"}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 1, "creation_date": 1515417495, "post_id": 48150768, "comment_id": 83280562, "body": "as soon as i remove any attempt at this function everything is working perfectly :["}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515417555, "post_id": 48150768, "comment_id": 83280600, "body": "and jot and tupleTest1 are both returning a number and list of numbers respectively"}], "tags": [], "owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "is_accepted": false, "score": 0, "last_activity_date": 1515418587, "last_edit_date": 1515418587, "creation_date": 1515416243, "answer_id": 48150768, "question_id": 48150131, "link": "https://stackoverflow.com/questions/48150131/how-to-divide-a-list-by-a-variable-haskell/48150768#48150768", "title": "How to divide a list by a variable haskell", "body": "<p>Your suggestion with <code>map</code> should work.<br>\nSee below my example in ghci:</p>\n\n<pre><code>Prelude&gt; let mylist = 1:2:3:4:5:[]\nPrelude&gt; mylist\n[1,2,3,4,5]\nPrelude&gt; let diver xs d = map (/ d) xs\nPrelude&gt; diver mylist 2\n[0.5,1.0,1.5,2.0,2.5]\nPrelude&gt;\n</code></pre>\n\n<p>or with your short version</p>\n\n<pre><code>Prelude&gt; map (/ 2) mylist\n[0.5,1.0,1.5,2.0,2.5]\n</code></pre>\n\n<hr>\n\n<p>Based on your comments and your error message</p>\n\n<pre><code> couldn't match expected type '[[int]]' with actual type int - * In the second argument of map' , namely j' - In the expression: map divhs j \n</code></pre>\n\n<p>the problem is that the input variable <code>j</code> is not an int as you're expecting, but instead a list of lists of int.<br>\nThe problem thus probably lies in your function <code>jot</code> because you set <code>j</code> with <code>where j = jot xs</code>.</p>\n\n<hr>\n\n<p>You say that <code>jot</code> returns you a number. I would recommend</p>\n\n<ul>\n<li>trying whether <code>diver</code> works if you manually input arguments</li>\n<li>making sure <code>jot</code> does not actually return something like <code>[[1337]]</code>. If it actually returns a list of lists, like the error message suggests, yet you think it is only one number, then it might be the case that it is just a single int wrapped into a list of lists.</li>\n</ul>\n\n<p>If the second bullet point is the case, you could unpack it as a quick fix (but it would be preferable to fix your code of <code>jot</code>) :</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let myunpack (x:xs) = unpackagain x\nPrelude|                        where\nPrelude|                          unpackagain (y:ys) = y\nPrelude| :}\nPrelude&gt; myunpack [[123]]\n123\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1515418587, "creation_date": 1515413806, "question_id": 48150131, "link": "https://stackoverflow.com/questions/48150131/how-to-divide-a-list-by-a-variable-haskell", "title": "How to divide a list by a variable haskell", "body": "<p>Doing a small project but after hours of work i still cant work out how to divide every element in a list by a variable</p>\n\n<pre><code>diver xs = map divhs j\n       where divhs = div hs\n                hs = tupleTest1 xs\n                 j = jot xs\n</code></pre>\n\n<p>wont work and neither does</p>\n\n<pre><code> map (/ j) hs\n</code></pre>\n\n<p>anyone help at all would be most welcome</p>\n\n<p>yours truly\nhaskell scrub</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1515391644, "post_id": 48144977, "comment_id": 83268094, "body": "typo? you have &quot;&lt;&quot; on the first and second line."}, {"owner": {"reputation": 43, "user_id": 7163068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c53e72578f731d47d08d3cd5e6fbe1b?s=128&d=identicon&r=PG", "display_name": "Dystr", "link": "https://stackoverflow.com/users/7163068/dystr"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1515395260, "post_id": 48144977, "comment_id": 83269365, "body": "Indeed. I&#39;m confused how I managed to let that one slip... Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 7163068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c53e72578f731d47d08d3cd5e6fbe1b?s=128&d=identicon&r=PG", "display_name": "Dystr", "link": "https://stackoverflow.com/users/7163068/dystr"}, "edited": false, "score": 0, "creation_date": 1515395429, "post_id": 48145067, "comment_id": 83269423, "body": "I ended up not spotting the typo and rewriting everything using something close the tuple approach you pointed out."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1515445298, "post_id": 48145067, "comment_id": 83295382, "body": "@Elmex80s <code>sortBy</code> consumes <code>Ordering</code>s, and using <code>compare</code> (rather than <code>&lt;=</code>) is the idiomatic way to produce an <code>Ordering</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1515488667, "post_id": 48145067, "comment_id": 83308302, "body": "@Elmex80s No: as observed in my answer, he is storing the tuples in &quot;reverse order&quot; (day-month-year instead of year-month-day) compared to what he would need to get the sort order he wants from plain old <code>sort</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1515391961, "creation_date": 1515391961, "answer_id": 48145067, "question_id": 48144977, "link": "https://stackoverflow.com/questions/48144977/haskell-sortby-with-multiple-parameters-birth-dates/48145067#48145067", "title": "Haskell: SortBy with multiple parameters (Birth dates)", "body": "<p>You haven't covered the <code>year1 &gt; year2</code> case, because you have a typo on this line:</p>\n\n<pre><code>  | year1 &lt; year2 = GT\n</code></pre>\n\n<p>Instead of trying to carefully juggle <code>EQ</code>s and non-<code>EQ</code>s, you can just use the <code>Monoid</code> instance for <code>Ordering</code> to combine results:</p>\n\n<pre><code>sortBD (d1, m1, y1) (d2, m2, y2)\n    = compare y1 y2\n   &lt;&gt; compare m1 m2\n   &lt;&gt; compare d1 d2\n</code></pre>\n\n<p>Even better still, the tuple instance already does this, so you can just reuse that:</p>\n\n<pre><code>sortBD (d1, m1, y1) (d2, m2, y2) = compare (y1, m1, d1) (y2, m2, d2)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7163068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c53e72578f731d47d08d3cd5e6fbe1b?s=128&d=identicon&r=PG", "display_name": "Dystr", "link": "https://stackoverflow.com/users/7163068/dystr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 1, "accepted_answer_id": 48145067, "answer_count": 1, "score": 4, "last_activity_date": 1515395866, "creation_date": 1515391420, "last_edit_date": 1515395866, "question_id": 48144977, "link": "https://stackoverflow.com/questions/48144977/haskell-sortby-with-multiple-parameters-birth-dates", "title": "Haskell: SortBy with multiple parameters (Birth dates)", "body": "<p>I'm trying to sort a list of Birth dates according to Y > M > D priorities using sortBy.</p>\n\n<p>Since nesting guards isn't possible, I've come up with this kind of ugly solution:</p>\n\n<pre><code>sortBD (day1, month1, year1) (day2, month2, year2)\n  | year1 &lt; year2 = GT\n  | year1 &lt; year2 = LT   -- Typo: &lt; should be &gt;\n  | year1 == year2 = if compare month1 month2 == EQ then compare day1 day2 else compare month1 month2\n</code></pre>\n\n<p>This however returns an Exception due to non exhaustive patterns.</p>\n\n<p>[EDIT]: To save others running into issues with the same problem the confusion: The problem in the code above is a typo, as pointed out in answers, not the approach itself.</p>\n"}, {"tags": ["haskell", "optparse-applicative"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1515408940, "post_id": 48146244, "comment_id": 83275832, "body": "Thanks! I find it useful as well."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1515409573, "post_id": 48146244, "comment_id": 83276199, "body": "Applied your suggestions in this PR for <code>hs-init</code>: <a href=\"https://github.com/vrom911/hs-init/pull/43\" rel=\"nofollow noreferrer\">github.com/vrom911/hs-init/pull/43</a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1515398247, "creation_date": 1515398247, "answer_id": 48146244, "question_id": 48144402, "link": "https://stackoverflow.com/questions/48144402/how-do-i-specify-names-for-missing-commands-in-the-help-message-generated-by-opt/48146244#48146244", "title": "How do I specify names for missing commands in the help message generated by optparse-applicative?", "body": "<p>It seems you can use <code>metavar</code> on the command.</p>\n\n<pre><code>com1 = subparser $ mconcat\n  [ metavar c\n  , command c $ info (pure Com1) fullDesc)\n  ] where c = \"com1\"\n</code></pre>\n\n<p>Whereas here each command is its own subparser, the docs of <code>optparse-applicative</code> prefer to combine <code>command</code> modifiers first before applying <code>subparser</code> to the whole, so we would only see a single <code>COMMAND</code> and <code>metavar</code> wouldn't work well.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 2, "accepted_answer_id": 48146244, "answer_count": 1, "score": 7, "last_activity_date": 1515398247, "creation_date": 1515387206, "question_id": 48144402, "link": "https://stackoverflow.com/questions/48144402/how-do-i-specify-names-for-missing-commands-in-the-help-message-generated-by-opt", "title": "How do I specify names for missing commands in the help message generated by optparse-applicative?", "body": "<p>I am attempting to use Hackage's <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"noreferrer\">optparse-applicative</a> package and have a question regarding how to specify a certain aspect of the help message displayed when the program is run with insufficient commands specified.</p>\n\n<p>The following example program illustrates my issue. When run from the command line it takes one of two commands as input. That is, it is intended to be run either as <code>$ program com1</code> or <code>$ program com2</code>.</p>\n\n<pre><code>module Main where\n\nimport Options.Applicative\nimport Data.Semigroup ((&lt;&gt;))\n\ndata Command = Com1\n             | Com2\n\ncom1 :: Parser Command\ncom1 = subparser $ command \"com1\" $ info (pure Com1) fullDesc\n\ncom2 :: Parser Command\ncom2 = subparser $ command \"com2\" $ info (pure Com2) fullDesc\n\ncommandParser :: Parser Command\ncommandParser = com1\n            &lt;|&gt; com2\n\nrunCommand :: Command -&gt; IO ()\nrunCommand Com1 = putStrLn \"&gt;&gt;&gt; Com1 &lt;&lt;&lt;\"\nrunCommand Com2 = putStrLn \"&gt;&gt;&gt; Com2 &lt;&lt;&lt;\"\n\nopts :: ParserInfo Command\nopts = info (commandParser &lt;**&gt; helper)\n  $ fullDesc  \n  &lt;&gt; progDesc \"=== progDesc ===\"\n  &lt;&gt; header \"=== header ===\"\n  &lt;&gt; footer \"=== footer ===\"\n\nmain :: IO ()\nmain = runCommand =&lt;&lt; execParser opts\n</code></pre>\n\n<p>When this program is run with neither command <code>com1</code> nor <code>com2</code> specified, a help message is displayed.</p>\n\n<pre><code>$ program\nMissing: (COMMAND | COMMAND)\n\nUsage: options-applicative-example-exe (COMMAND | COMMAND)\n  === progDesc ===\n</code></pre>\n\n<p>This help message displays <code>(COMMAND | COMMAND)</code> instead of <code>(com1 | com2)</code>, and I think that specifying the names in this help message would be clearer and more useful.</p>\n\n<p>Specifying the <code>--help</code> option as in <code>$ program --help</code> gives a different output.</p>\n\n<pre><code>$ program --help\n=== header ===\n\nUsage: options-applicative-example-exe (COMMAND | COMMAND)\n  === progDesc ===\n\nAvailable options:\n  -h,--help                Show this help text\n\nAvailable commands:\n  com1\n  com2\n\n=== footer ===\n</code></pre>\n\n<p>The command names <code>com1</code> and <code>com2</code> are listed in the \"Available commands\" section. Here too, however, I think the usage section would be clearer as <code>(com1 | com2)</code> instead of <code>(COMMAND | COMMAND)</code>.</p>\n\n<p><strong>How can I specify the usage section of the help message to be <code>(com1 | com2)</code> instead of <code>(COMMAND | COMMAND)</code>?</strong></p>\n"}, {"tags": ["haskell", "mutual-recursion"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1515604539, "post_id": 48143692, "comment_id": 83365906, "body": "the fix expression is equivalent to <code>let g (x,y) = (y,1) ; r = g r in r</code>."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 21, "last_activity_date": 1515381231, "creation_date": 1515381231, "answer_id": 48143804, "question_id": 48143692, "link": "https://stackoverflow.com/questions/48143692/haskell-let-expression-converges-while-similar-expression-using-fix-does-not/48143804#48143804", "title": "Haskell let expression converges while similar expression using fix does not", "body": "<p>By default, the outermost patterns used in <code>let</code> bindings are lazy. However, patterns used in lambda bindings are strict, so the pattern match against the tuple forces too much too early. You can explicitly write a lazy pattern match by prefixing it with <code>~</code>, making the lambda pattern equivalent to the <code>let</code> pattern:</p>\n\n<pre><code>ghci&gt; fix (\\(~(x, y)) -&gt; (y, 1))\n(1,1)\n</code></pre>\n\n<p>This defers the actual evaluation of the pattern match until one of bound variables is forced, instead of when the function is called, avoiding the loop.</p>\n\n<p>For more information, see the <a href=\"https://wiki.haskell.org/Lazy_pattern_match\" rel=\"noreferrer\">Haskell wiki article on lazy patterns</a>.</p>\n"}], "owner": {"reputation": 213, "user_id": 9186026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e56a5c3402d9d1acc9c670307d3ca662?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Wittmond", "link": "https://stackoverflow.com/users/9186026/alexander-wittmond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 48143804, "answer_count": 1, "score": 17, "last_activity_date": 1515381314, "creation_date": 1515380125, "last_edit_date": 1515381314, "question_id": 48143692, "link": "https://stackoverflow.com/questions/48143692/haskell-let-expression-converges-while-similar-expression-using-fix-does-not", "title": "Haskell let expression converges while similar expression using fix does not", "body": "<p>I have been having difficulty understanding why the haskell expression <code>let (x,y) = (y,1) in (x,y)</code> converges to <code>(1,1)</code> as expected but <code>fix (\\(x,y)-&gt; (y,1))</code> results in <code>&lt;&lt;loop&gt;&gt;</code> being thrown.  Can anyone explain this?</p>\n"}, {"tags": ["java", "haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 3, "creation_date": 1515375914, "post_id": 48143268, "comment_id": 83264756, "body": "Scala uses inheritance to emulate sum types. You can&#39;t force Java to make a type &quot;sealed&quot; (that is, someone else could come along and write something foolish like <code>class Apollo11 extends Either&lt;Integer, Integer&gt;</code>), but you can simply not write any more subclasses yourself and hope for the best. &quot;Safely&quot; doing this is outside of the abilities of Java&#39;s type system, but doing it is possible with inheritance."}, {"owner": {"reputation": 1621, "user_id": 7525132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c72d31f05d9da64a764fb02b48f384b8?s=128&d=identicon&r=PG&f=1", "display_name": "Izruo", "link": "https://stackoverflow.com/users/7525132/izruo"}, "edited": false, "score": 1, "creation_date": 1515375963, "post_id": 48143268, "comment_id": 83264765, "body": "Looking at the signature of <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/Collections.html#newSetFromMap(java.util.Map)\" rel=\"nofollow noreferrer\"><code>Collections.newSetFromMap()</code></a> I think it should be perfectly ok to just define an arbitrary generic type, such as <code>class Left&lt;L&gt; extends Either&lt;L, Object&gt;</code>."}, {"owner": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1515376120, "post_id": 48143268, "comment_id": 83264792, "body": "@silvio a <code>final</code> class cannot be extended in Java."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "edited": false, "score": 2, "creation_date": 1515376197, "post_id": 48143268, "comment_id": 83264807, "body": "@Dragonthoughts Yes, but we want to extend it a limited number of times and then lock it. Scala has this in the form of the <code>sealed</code> keyword, but in Java, you either leave a class open to everyone or make it <code>final</code> and block even yourself from inheriting."}, {"owner": {"reputation": 1621, "user_id": 7525132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c72d31f05d9da64a764fb02b48f384b8?s=128&d=identicon&r=PG&f=1", "display_name": "Izruo", "link": "https://stackoverflow.com/users/7525132/izruo"}, "edited": false, "score": 2, "creation_date": 1515376333, "post_id": 48143268, "comment_id": 83264827, "body": "By making all constructors <code>package-private</code>, inheritance can be limited to the enclosing package though. Instantiation must then be performed through static factory, as it is already done here."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 1621, "user_id": 7525132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c72d31f05d9da64a764fb02b48f384b8?s=128&d=identicon&r=PG&f=1", "display_name": "Izruo", "link": "https://stackoverflow.com/users/7525132/izruo"}, "edited": false, "score": 0, "creation_date": 1515376398, "post_id": 48143268, "comment_id": 83264838, "body": "@Izruo Hmm, your solution seems right, but I&#39;ve had trouble putting Functional Interface types into <code>Object</code>. Eg <code>Object a = () -&gt; {};</code> doesn&#39;t compile. Is <code>Object</code> still the base of every concrete type?"}, {"owner": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "edited": false, "score": 2, "creation_date": 1515376440, "post_id": 48143268, "comment_id": 83264842, "body": "You could have a base that is package visible only but have the derived classes final and public."}, {"owner": {"reputation": 1621, "user_id": 7525132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c72d31f05d9da64a764fb02b48f384b8?s=128&d=identicon&r=PG&f=1", "display_name": "Izruo", "link": "https://stackoverflow.com/users/7525132/izruo"}, "edited": false, "score": 1, "creation_date": 1515376692, "post_id": 48143268, "comment_id": 83264879, "body": "As the point of that &#39;wildcard&#39; is, that the <code>right</code> member of an instance of type <code>Left</code> is never assigned, this won&#39;t matter. By the way, the compiler error is probably because it cannot determine the type of functional interface. It should therefore work with an explicit cast: <code>Object a = (Runnable) () -&gt; {}</code>, although I don&#39;t see a point in this."}, {"owner": {"reputation": 9489, "user_id": 614800, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/IZDYN.png?s=128&g=1", "display_name": "beluchin", "link": "https://stackoverflow.com/users/614800/beluchin"}, "edited": false, "score": 0, "creation_date": 1568762165, "post_id": 48143268, "comment_id": 102375265, "body": "check out <a href=\"https://github.com/pakoito/JavaSealedUnions\" rel=\"nofollow noreferrer\">github.com/pakoito/JavaSealedUnions</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515377000, "post_id": 48143341, "comment_id": 83264926, "body": "What is the role of the enclosing <code>EitherTest</code> type?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 2, "creation_date": 1515377104, "post_id": 48143341, "comment_id": 83264942, "body": "Nothing in particular. Just wrapping it all in one file so all the classes can be public. Java requires that each file have at most one public class. If you implement this solution in your project, there&#39;s no reason to have <code>EitherTest</code>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 8, "last_activity_date": 1515376980, "last_edit_date": 1515376980, "creation_date": 1515376557, "answer_id": 48143341, "question_id": 48143268, "link": "https://stackoverflow.com/questions/48143268/java-tagged-union-sum-types/48143341#48143341", "title": "Java tagged union / sum types", "body": "<p>Alright, so the inheritance solution is definitely the most promising. The thing we would like to do is <code>class Left&lt;L&gt; extends Either&lt;L, ?&gt;</code>, which we unfortunately cannot do because of Java's generic rules. However, if we make the concessions that the type of <code>Left</code> or <code>Right</code> must encode the \"alternate\" possibility, we can do this.</p>\n\n<pre><code>public class Left&lt;L, R&gt; extends Either&lt;L, R&gt;`\n</code></pre>\n\n<p>Now, we would like to be able to convert <code>Left&lt;Integer, A&gt;</code> to <code>Left&lt;Integer, B&gt;</code>, since it doesn't actually <em>use</em> that second type parameter. We can define a method to do this conversion internally, thus encoding that freedom into the type system.</p>\n\n<pre><code>public &lt;R1&gt; Left&lt;L, R1&gt; phantom() {\n  return new Left&lt;L, R1&gt;(contents);\n}\n</code></pre>\n\n<p>Complete example:</p>\n\n<pre><code>public class EitherTest {\n\n  public abstract static class Either&lt;L, R&gt; {}\n\n  public static class Left&lt;L, R&gt; extends Either&lt;L, R&gt; {\n\n    private L contents;\n\n    public Left(L x) {\n      contents = x;\n    }\n\n    public &lt;R1&gt; Left&lt;L, R1&gt; phantom() {\n      return new Left&lt;L, R1&gt;(contents);\n    }\n\n  }\n\n  public static class Right&lt;L, R&gt; extends Either&lt;L, R&gt; {\n\n    private R contents;\n\n    public Right(R x) {\n      contents = x;\n    }\n\n    public &lt;L1&gt; Right&lt;L1, R&gt; phantom() {\n      return new Right&lt;L1, R&gt;(contents);\n    }\n\n  }\n\n}\n</code></pre>\n\n<p>Of course, you'll want to add some functions for actually accessing the contents, and for checking whether a value is <code>Left</code> or <code>Right</code> so you don't have to sprinkle <code>instanceof</code> and explicit casts everywhere, but this should be enough to get started, at the very least.</p>\n"}, {"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515381252, "post_id": 48143514, "comment_id": 83265681, "body": "This already mirrors the remainder of my implementation what I&#39;d hidden in the <code>...</code>, as it&#39;s adjacent to the actual issue of implementing the sum type, but it is definitely an important part of the Either type&#39;s implementation"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1515422969, "post_id": 48143514, "comment_id": 83283856, "body": "A main selling point of this approach is that there is no need to use type casts (nor <code>instanceof</code>) to eliminate the sum type. In other words, this would also work in a fragment of Java where potentially dangerous constructs such as type casts are forbidden."}, {"owner": {"reputation": 912, "user_id": 612169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8df2c9fb8dc016dcdce04b633ba9a6b4?s=128&d=identicon&r=PG", "display_name": "Gabriel Garcia", "link": "https://stackoverflow.com/users/612169/gabriel-garcia"}, "edited": false, "score": 0, "creation_date": 1590502837, "post_id": 48143514, "comment_id": 109699692, "body": "FWIW, I have explored a similar ADT encoding in Java in my blog: <a href=\"https://garciat.com/2020/05/07/java-adt/\" rel=\"nofollow noreferrer\">garciat.com/2020/05/07/java-adt</a>"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 25, "last_activity_date": 1541120156, "last_edit_date": 1541120156, "creation_date": 1515378338, "answer_id": 48143514, "question_id": 48143268, "link": "https://stackoverflow.com/questions/48143268/java-tagged-union-sum-types/48143514#48143514", "title": "Java tagged union / sum types", "body": "<p>A standard way of encoding sum types is Boehm\u2013Berarducci encoding (often referred to by the name of its cousin, Church encoding) which represents an algebraic data type as its <em>eliminator</em>, i.e., a function that does pattern-matching. In Haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>left :: a -&gt; (a -&gt; r) -&gt; (b -&gt; r) -&gt; r\nleft x l _ = l x\n\nright :: b -&gt; (a -&gt; r) -&gt; (b -&gt; r) -&gt; r\nright x _ r = r x\n\nmatch :: (a -&gt; r) -&gt; (b -&gt; r) -&gt; ((a -&gt; r) -&gt; (b -&gt; r) -&gt; r) -&gt; r\nmatch l r k = k l r\n\n-- Or, with a type synonym for convenience:\n\ntype Either a b r = (a -&gt; r) -&gt; (b -&gt; r) -&gt; r\n\nleft :: a -&gt; Either a b r\nright :: b -&gt; Either a b r\nmatch :: (a -&gt; r) -&gt; (b -&gt; r) -&gt; Either a b r -&gt; r\n</code></pre>\n\n<p>In Java this would look like a visitor:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public interface Either&lt;A, B&gt; {\n    &lt;R&gt; R match(Function&lt;A, R&gt; left, Function&lt;B, R&gt; right);\n}\n\npublic final class Left&lt;A, B&gt; implements Either&lt;A, B&gt; {\n\n    private final A value;\n\n    public Left(A value) {\n        this.value = value;\n    }\n\n    public &lt;R&gt; R match(Function&lt;A, R&gt; left, Function&lt;B, R&gt; right) {\n        return left.apply(value);\n    }\n\n}\n\npublic final class Right&lt;A, B&gt; implements Either&lt;A, B&gt; {\n\n    private final B value;\n\n    public Right(B value) {\n        this.value = value;\n    }\n\n    public &lt;R&gt; R match(Function&lt;A, R&gt; left, Function&lt;B, R&gt; right) {\n        return right.apply(value);\n    }\n\n}\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>Either&lt;Integer, String&gt; result = new Left&lt;Integer, String&gt;(42);\nString message = result.match(\n  errorCode -&gt; \"Error: \" + errorCode.toString(),\n  successMessage -&gt; successMessage);\n</code></pre>\n\n<p>For convenience, you can make a factory for creating <code>Left</code> and <code>Right</code> values without having to mention the type parameters each time; you can also add a version of <code>match</code> that accepts <code>Consumer&lt;A&gt; left, Consumer&lt;B&gt; right</code> instead of <code>Function&lt;A, R&gt; left, Function&lt;B, R&gt; right</code> if you want the option of pattern-matching without producing a result.</p>\n"}, {"comments": [{"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "edited": false, "score": 0, "creation_date": 1515439483, "post_id": 48143584, "comment_id": 83292655, "body": "I would introduce an enum into this, to give a way to exhaustively match against the cases"}, {"owner": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 0, "creation_date": 1515456104, "post_id": 48143584, "comment_id": 83299014, "body": "It might be wise to name the method generics differently from the class&#39; generics. E.g., maybe <code>AL</code>, <code>BL</code>, <code>AR</code>, and <code>BR</code> so that it&#39;s easy to distinguish which ones are being used where."}, {"owner": {"reputation": 197, "user_id": 4559558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bc8ad8c3f52cdc90854ee7258d29de7?s=128&d=identicon&r=PG&f=1", "display_name": "JbGi", "link": "https://stackoverflow.com/users/4559558/jbgi"}, "edited": false, "score": 1, "creation_date": 1515496218, "post_id": 48143584, "comment_id": 83312777, "body": "note this approach can be industrialised with a JSR269 annotation processor to generate the boilerplate (the static left and right methods and others, like hashCode/equals). See my project <a href=\"https://github.com/derive4j/derive4j#derive4j-java-8-annotation-processor-for-deriving-algebraic-data-types-constructors-pattern-matching-and-more\" rel=\"nofollow noreferrer\">Derive4J</a>."}, {"owner": {"reputation": 6648, "user_id": 464306, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W8KCe.png?s=128&g=1", "display_name": "gdejohn", "link": "https://stackoverflow.com/users/464306/gdejohn"}, "reply_to_user": {"reputation": 1537, "user_id": 3620458, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/297fb06ade2f562f43977cc168384faf?s=128&d=identicon&r=PG&f=1", "display_name": "Bragolgirith", "link": "https://stackoverflow.com/users/3620458/bragolgirith"}, "edited": false, "score": 1, "creation_date": 1575998616, "post_id": 48143584, "comment_id": 104752102, "body": "@vtosh that was because I was using anonymous-class type-argument inference, which was added in Java 9, but I&#39;ve edited it to make the type arguments explicit so that now it will compile on Java 8"}], "tags": [], "owner": {"reputation": 6648, "user_id": 464306, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W8KCe.png?s=128&g=1", "display_name": "gdejohn", "link": "https://stackoverflow.com/users/464306/gdejohn"}, "is_accepted": true, "score": 61, "last_activity_date": 1575997862, "last_edit_date": 1575997862, "creation_date": 1515379096, "answer_id": 48143584, "question_id": 48143268, "link": "https://stackoverflow.com/questions/48143268/java-tagged-union-sum-types/48143584#48143584", "title": "Java tagged union / sum types", "body": "<p>Make <code>Either</code> an abstract class with no fields and only one constructor (private, no-args, empty) and nest your \"data constructors\" (<code>left</code> and <code>right</code> static factory methods) inside the class so that they can see the private constructor but nothing else can, effectively sealing the type.</p>\n\n<p>Use an abstract method <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Either.html#v:either\" rel=\"noreferrer\"><code>either</code></a> to simulate exhaustive pattern matching, overriding appropriately in the concrete types returned by the static factory methods. Implement convenience methods (like <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Either.html#v:fromLeft\" rel=\"noreferrer\"><code>fromLeft</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Either.html#v:fromRight\" rel=\"noreferrer\"><code>fromRight</code></a>, <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Bifunctor.html#v:bimap\" rel=\"noreferrer\"><code>bimap</code></a>, <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Bifunctor.html#v:first\" rel=\"noreferrer\"><code>first</code></a>, <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Bifunctor.html#v:second\" rel=\"noreferrer\"><code>second</code></a>) in terms of <code>either</code>.</p>\n\n<pre><code>import java.util.Optional;\nimport java.util.function.Function;\n\npublic abstract class Either&lt;A, B&gt; {\n    private Either() {}\n\n    public abstract &lt;C&gt; C either(Function&lt;? super A, ? extends C&gt; left,\n                                 Function&lt;? super B, ? extends C&gt; right);\n\n    public static &lt;A, B&gt; Either&lt;A, B&gt; left(A value) {\n        return new Either&lt;A, B&gt;() {\n            @Override\n            public &lt;C&gt; C either(Function&lt;? super A, ? extends C&gt; left,\n                                Function&lt;? super B, ? extends C&gt; right) {\n                return left.apply(value);\n            }\n        };\n    }\n\n    public static &lt;A, B&gt; Either&lt;A, B&gt; right(B value) {\n        return new Either&lt;A, B&gt;() {\n            @Override\n            public &lt;C&gt; C either(Function&lt;? super A, ? extends C&gt; left,\n                                Function&lt;? super B, ? extends C&gt; right) {\n                return right.apply(value);\n            }\n        };\n    }\n\n    public Optional&lt;A&gt; fromLeft() {\n        return this.either(Optional::of, value -&gt; Optional.empty());\n    }\n}\n</code></pre>\n\n<p>Pleasant and safe! No way to screw it up. Because the type is effectively sealed, you can rest assured that there will only ever be two cases, and every operation ultimately must be defined in terms of the <code>either</code> method, which forces the caller to handle both of those cases.</p>\n\n<p>Regarding the problem you had trying to do <code>class Left&lt;L&gt; extends Either&lt;L,?&gt;</code>, consider the signature <code>&lt;A, B&gt; Either&lt;A, B&gt; left(A value)</code>. The type parameter <code>B</code> doesn't appear in the parameter list. So, given a value of some type <code>A</code>, you can get an <code>Either&lt;A, B&gt;</code> for <em>any</em> type <code>B</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515459816, "post_id": 48156368, "comment_id": 83299790, "body": "You missed a third case, where the common API provides only the <code>switch</code>, which unwraps the structure for you and provides control flow, like Haskell&#39;s pattern match. I doubt there would be a situation where you need to decide control flow based on the type, but then use the whole object, instead of just the contained value."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515459891, "post_id": 48156368, "comment_id": 83299802, "body": "See <a href=\"https://stackoverflow.com/a/48143514/6112457\">Jon Purdy&#39;s answer</a> for something similar to my implementation"}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515460079, "post_id": 48156368, "comment_id": 83299830, "body": "@ZoeyHewll Yeah. One of the issues though, is that different cases can have can different numbers of values, with different types. Java doesn&#39;t give you a way to deal with that"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515460751, "post_id": 48156368, "comment_id": 83299954, "body": "<a href=\"https://gist.github.com/anonymous/0eea8d3768c571a9230f54fd31d43ba0\" rel=\"nofollow noreferrer\">It definitely does</a>"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515460878, "post_id": 48156368, "comment_id": 83299990, "body": "By passing in the functions to be called in each case, you can have the enclosed values passed to a function that expects exactly that number of values, of the required types"}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515461840, "post_id": 48156368, "comment_id": 83300206, "body": "@ZoeyHewll I&#39;m not quite getting it, could you show me an example of the usage?"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515462299, "post_id": 48156368, "comment_id": 83300302, "body": "See my comment on the gist for a better formatted example, but: <code>Maybe&lt;Integer&gt; m = someOperation(); m.match(       (Integer value) -&gt; System.out.println(&quot;value = &quot; + value),       () -&gt; System.out.println(&quot;there is no value&quot;) );</code>"}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1515462628, "post_id": 48156368, "comment_id": 83300378, "body": "@ZoeyHewll I see, so the super class declares an abstract match method that takes <code>n</code> functions for each of the <code>n</code> cases, each taking as parameters the values associated with that case. Then each subclass calls one of of those <code>n</code> functions, passing it members (associated values) as arguments. Correct?"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515463089, "post_id": 48156368, "comment_id": 83300471, "body": "Yes. The <code>match</code> function directly mirrors Haskell&#39;s <code>case</code> expression in this regard"}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1515463804, "post_id": 48156368, "comment_id": 83300602, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/162777/discussion-between-alexander-and-zoey-hewll\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "is_accepted": false, "score": 1, "last_activity_date": 1515465666, "last_edit_date": 1515465666, "creation_date": 1515437327, "answer_id": 48156368, "question_id": 48143268, "link": "https://stackoverflow.com/questions/48143268/java-tagged-union-sum-types/48156368#48156368", "title": "Java tagged union / sum types", "body": "<p>Inheritance <em>can</em> be used to emulate sum types (Disjoint unions), but there are a few issues you need to deal with:</p>\n\n<ol>\n<li>You need to take care to keep others from adding new cases to your type. This is especially important if you want to exhaustively handle every case you might encounter. It's possible with a non-final super class, and package-private constructor.</li>\n<li>The lack of pattern patching makes it quite difficult to consume a value of this type. If you want compiler-checked way to guarantee that you've exhaustively handled all cases, you need to implement a match function yourself.</li>\n<li>You're forced into one of two styles of API, neither of which are ideal:\n\n<ul>\n<li>All cases implement a common API, throwing errors on API they don't support themselves. Consider <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html#get--\" rel=\"nofollow noreferrer\"><code>Optional.get()</code></a>. Ideally, this method would only be available on a disjoint type who's value is known to be <code>some</code> rather than <code>none</code>. But there's no way to do that, so it's an instance member of a general <code>Optional</code> type. It throws <code>NoSuchElementException</code> if you call it on an optional whose \"case\" is \"none\".</li>\n<li>Each case has a unique API that tells you exactly what it's capable of, but that requires a manual type check and cast every time you wish to call one of these subclass-specific methods.</li>\n</ul></li>\n<li>Changing \"cases\" requires new object allocation (and adds pressure on the GC if done often).</li>\n</ol>\n\n<p>TL;DR: Functional programming in Java is not a pleasant experience.</p>\n"}], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10023, "favorite_count": 13, "accepted_answer_id": 48143584, "answer_count": 4, "score": 48, "last_activity_date": 1575997862, "creation_date": 1515375718, "question_id": 48143268, "link": "https://stackoverflow.com/questions/48143268/java-tagged-union-sum-types", "title": "Java tagged union / sum types", "body": "<p>Is there any way to define a sum type in Java? Java seems to naturally support product types directly, and I thought enums might allow it to support sum types, and inheritance looks like maybe it could do it, but there is at least one case I can't resolve.\nTo elaborate, a sum type is a type which can have exactly one of a set of different types, like a tagged union in C.\nIn my case, I'm trying to implement haskell's Either type in Java:</p>\n\n<pre><code>data Either a b = Left a | Right b\n</code></pre>\n\n<p>but at the base level I'm having to implement it as a product type, and just ignore one of its fields:</p>\n\n<pre><code>public class Either&lt;L,R&gt;\n{\n    private L left = null;\n    private R right = null;\n\n    public static &lt;L,R&gt; Either&lt;L,R&gt; right(R right)\n    {\n        return new Either&lt;&gt;(null, right);\n    }\n\n    public static &lt;L,R&gt; Either&lt;L,R&gt; left(L left)\n    {\n        return new Either&lt;&gt;(left, null);\n    }\n\n    private Either(L left, R right) throws IllegalArgumentException\n    {\n        this.left = left;\n        this.right = right;\n        if (left != null &amp;&amp; right != null)\n        {\n            throw new IllegalArgumentException(\"An Either cannot be created with two values\");\n        }\n        if (left == right)\n        {\n            throw new IllegalArgumentException(\"An Either cannot be created without a value\");\n        }\n    }\n\n    .\n    .\n    .\n}\n</code></pre>\n\n<p>I tried implementing this with inheritance, but I have to use a wildcard type parameter, or equivalent, which Java generics won't allow:</p>\n\n<pre><code>public class Left&lt;L&gt; extends Either&lt;L,?&gt;\n</code></pre>\n\n<p>I haven't used Java's Enums much, but while they seem the next best candidate, I'm not hopeful.<br>\nAt this point, I think this might only be possible by type-casting <code>Object</code> values, which I would hope to avoid entirely, unless there's a way to do it once, safely, and be able to use that for all sum types.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1515366331, "post_id": 48142369, "comment_id": 83262788, "body": "Looks like its an OS mismatch. You&#39;re running windows, GNU readline is probably only included on POSIX systems. Have you tried building/installing the <a href=\"http://gnuwin32.sourceforge.net/packages/readline.htm\" rel=\"nofollow noreferrer\">GNU readline application for windows</a>?"}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1515366698, "post_id": 48142369, "comment_id": 83262886, "body": "Just installed it and tried it out. The same error occurs."}, {"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1515384336, "post_id": 48142369, "comment_id": 83266281, "body": "Doesn&#39;t seem like readline is officially supported on windows. The homepage says it has to be installed through cygwin."}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "edited": false, "score": 0, "creation_date": 1515409671, "post_id": 48142369, "comment_id": 83276241, "body": "Okay I&#39;ll have a look at installing it through that tonight and see how I go thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 2, "last_activity_date": 1517001425, "creation_date": 1517001425, "answer_id": 48469661, "question_id": 48142369, "link": "https://stackoverflow.com/questions/48142369/how-to-install-readline-with-cabal-on-windows/48469661#48469661", "title": "How to install &#39;readline&#39; with Cabal on Windows", "body": "<p>If you are using an msys distro that includes <code>pacman</code> (the one that ships with the windows haskell platform installer should be such a distro) then you can use <code>pacman</code> to install the readline library, and this <em>should</em> let you link against it.</p>\n\n<p>Also note that ghc ships with the <code>haskeline</code> library, which is a pure-haskell replacement for readline that is more portable.</p>\n"}], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517001425, "creation_date": 1515366165, "question_id": 48142369, "link": "https://stackoverflow.com/questions/48142369/how-to-install-readline-with-cabal-on-windows", "title": "How to install &#39;readline&#39; with Cabal on Windows", "body": "<p>I would like to install 'readline' using Cabal on Windows. When running the command it is saying that readline isn't found. Cabal is up to date. </p>\n\n<p>Command</p>\n\n<pre><code>cabal install readline\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>Resolving dependencies...\nNotice: installing into a sandbox located at\nC:\\Users\\Michael\\Desktop\\haskell-project\\.cabal-sandbox\nConfiguring readline-1.0.3.0...\nFailed to install readline-1.0.3.0\nBuild log ( C:\\Users\\Michael\\Desktop\\haskell-project\\.cabal-sandbox\\logs\\readline-1.0.3.0.log ):\nConfiguring readline-1.0.3.0...\nchecking for gcc... gcc\nchecking for C compiler default output file name... a.exe\nchecking whether the C compiler works... yes\nchecking whether we are cross compiling... no\nchecking for suffix of executables... .exe\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking for GNUreadline.framework... checking for readline... no\nchecking for tputs in -lncurses... no\nchecking for tputs in -ltermcap... no\nchecking for tputs in -lcurses... no\nchecking for rl_readline_version... no\nconfigure: error: readline not found, so this package cannot be built\nSee `config.log' for more details.\ncabal: Error: some packages failed to install:\nreadline-1.0.3.0 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>What could be the reason for this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 10, "creation_date": 1515365723, "post_id": 48142097, "comment_id": 83262666, "body": "Maybe I completely miss it, but what is wrong with <code>reverse xs == xs</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1515364806, "post_id": 48142176, "comment_id": 83262445, "body": "Thanks very much! How are foldr and zipwith working together for this example?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1515365020, "post_id": 48142176, "comment_id": 83262508, "body": "N.B. <code>foldr (&amp;&amp;) True == all id</code>"}, {"owner": {"reputation": 31754, "user_id": 2194470, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=128&d=identicon&r=PG", "display_name": "Szymon Stepniak", "link": "https://stackoverflow.com/users/2194470/szymon-stepniak"}, "reply_to_user": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1515366127, "post_id": 48142176, "comment_id": 83262748, "body": "@blazing <code>foldr</code> function uses a result from <code>zipWith</code> as an input. Both functions are higher order functions: they take function as an argument (<code>(&amp;&amp;)</code> in case of <code>foldr</code> and <code>(==)</code> in case of <code>zipWith</code>) and they can return a function thanks to currying. <code>foldr (&amp;&amp;) True</code> can be even replaced by <code>and</code> function, because folding right a list of <code>[Bool]</code> type using <code>&amp;&amp;</code> is what <code>and</code> function does."}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1515366472, "post_id": 48142176, "comment_id": 83262821, "body": "But why do you produce a boolean list, are you comparing the reverse list with the input list: [a,b,b,a] and [a,b,b,a] and storing [True,True,True,True], and then if the list contains all True&#39;s then it is a palindrome?"}, {"owner": {"reputation": 31754, "user_id": 2194470, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=128&d=identicon&r=PG", "display_name": "Szymon Stepniak", "link": "https://stackoverflow.com/users/2194470/szymon-stepniak"}, "edited": false, "score": 0, "creation_date": 1515367062, "post_id": 48142176, "comment_id": 83262981, "body": "Correct. <code>zipWith</code> zips elements from <code>xs</code> and <code>reverse xs</code>, applies <code>(==)</code> function on each pair and creates <code>[Bool]</code> list as a result. It evaluates to <code>True</code> if all elements are <code>True</code> (<code>foldr (&amp;&amp;) True xs</code> or <code>and xs</code>). It&#39;s a lot if we compare it with the simplest (I guess) possible version <code>isPalindrome xs = xs == reverse xs</code>, but I thought that you were looking for an alternative to recursive approach."}, {"owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "edited": false, "score": 0, "creation_date": 1515367189, "post_id": 48142176, "comment_id": 83263023, "body": "I was looking for an alternative recursive approach, Thanks very much!"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1515378959, "post_id": 48142176, "comment_id": 83265234, "body": "There\u2019s also a cute point-free version of the non-recursive definition: <code>isPalindrome = (==) &lt;*&gt; reverse</code>"}], "tags": [], "owner": {"reputation": 31754, "user_id": 2194470, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=128&d=identicon&r=PG", "display_name": "Szymon Stepniak", "link": "https://stackoverflow.com/users/2194470/szymon-stepniak"}, "is_accepted": true, "score": 2, "last_activity_date": 1515365153, "last_edit_date": 1515365153, "creation_date": 1515364342, "answer_id": 48142176, "question_id": 48142097, "link": "https://stackoverflow.com/questions/48142097/palindrome-of-list-in-haskell-with-higher-order-functions/48142176#48142176", "title": "Palindrome of List in Haskell with Higher-Order functions", "body": "<p>You can try <code>foldr</code> + <code>zipWith</code> combination:</p>\n\n<pre><code>isPalindrome xs = foldr (&amp;&amp;) True $ zipWith (==) xs (reverse xs)\n</code></pre>\n\n<ul>\n<li><code>zipWith (==) xs (reverse xs)</code> produces a <code>[Bool]</code> list: in case of palindrome it will contain only <code>True</code> values</li>\n<li><code>foldr (&amp;&amp;) True</code> will use the result of <code>zipWith</code> function to test if all values are <code>True</code></li>\n</ul>\n\n<p>It can be also simplified to:</p>\n\n<pre><code>isPalindrome xs = and $ zipWith (==) xs (reverse xs)\n</code></pre>\n\n<p>In GHCi:</p>\n\n<pre><code>Prelude&gt; isPalindrome [1,2,1]\nTrue\nPrelude&gt; isPalindrome [1,2,1,1]\nFalse\nPrelude&gt; isPalindrome \"salas\"\nTrue\nPrelude&gt; isPalindrome \"salsa\"\nFalse\n</code></pre>\n"}], "owner": {"reputation": 455, "user_id": 8962399, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ff8ec113f543442bb737f3eac77b8d65?s=128&d=identicon&r=PG&f=1", "display_name": "blazing", "link": "https://stackoverflow.com/users/8962399/blazing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1001, "favorite_count": 0, "accepted_answer_id": 48142176, "answer_count": 1, "score": 2, "last_activity_date": 1515365153, "creation_date": 1515363695, "last_edit_date": 1515364740, "question_id": 48142097, "link": "https://stackoverflow.com/questions/48142097/palindrome-of-list-in-haskell-with-higher-order-functions", "title": "Palindrome of List in Haskell with Higher-Order functions", "body": "<p>This is my code to check if a list is a palindrome:</p>\n\n<pre><code>isPalindrome :: Eq a =&gt; [a] -&gt; Bool\n\nisPalindrome []  = True\nisPalindrome [_] = True\nisPalindrome xs  = (head xs == last xs) &amp;&amp; (isPalindrome (tail (init xs)))\n</code></pre>\n\n<p>Is it possible to do this by using higher-order functions in Haskell?</p>\n"}, {"tags": ["haskell", "random", "state-monad"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515363533, "post_id": 48141845, "comment_id": 83262139, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1956518/state-monad-sequences-of-random-numbers-and-monadic-code\">State Monad, sequences of random numbers and monadic code</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515364232, "post_id": 48141845, "comment_id": 83262312, "body": "You use the <code>random</code> library by passing around an <code>StdGen</code> as state (e.g. passing it into <code>random</code>, then proceeding with the <code>StdGen</code> returned from the call for your next pseudo-random value, etc). So you should call <code>mkStdGen</code> basically once. I would start by rewriting <code>mkEvenPoly</code> to be of type <code>StdGen -&gt; [Integer]</code>, ignoring the <code>State</code> monad for now"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515364361, "post_id": 48141845, "comment_id": 83262339, "body": "In terms of how to use <code>State</code> to abstract the &quot;stateful&quot; passing of <code>StdGen</code>, I think you should either start from one of the many small examples online, adapting it to your function incrementally, or just accept that you may need to invest some time to learn them."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1515366923, "post_id": 48141845, "comment_id": 83262946, "body": "<code>MonadRandom</code> offers a fairly nice interface, and I think there may be other similar ones."}, {"owner": {"reputation": 1178, "user_id": 1568590, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/b6bb720c28219294cf31d0693ed47388?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1568590/alasdair"}, "edited": false, "score": 0, "creation_date": 1515379705, "post_id": 48141845, "comment_id": 83265377, "body": "Thanks folks.  Yes, of course - I am spending time to learn this - but it&#39;s taking quite a lot of time!  And it&#39;s also somewhat frustrating: every time I think I have a concept licked, there&#39;s some small detail which requires another investment in digging into details.  Ah well.  No royal road, as they say..."}], "answers": [{"comments": [{"owner": {"reputation": 1178, "user_id": 1568590, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/b6bb720c28219294cf31d0693ed47388?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1568590/alasdair"}, "edited": false, "score": 0, "creation_date": 1515454755, "post_id": 48148015, "comment_id": 83298675, "body": "This is great - thank you very much!  Elegant code which not only answers my question, but also provides me with an example from which to learn.  Such examples are not easy to find in the Haskell world, at least in package and module descriptions and code from hackage.  Thank you again - this is more than I could have hoped for."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 3, "last_activity_date": 1515405935, "creation_date": 1515405935, "answer_id": 48148015, "question_id": 48141845, "link": "https://stackoverflow.com/questions/48141845/generating-new-and-different-random-lists-in-haskell-without-io/48148015#48148015", "title": "Generating new and different random lists in Haskell (without IO)?", "body": "<p>Here's an \"off the shelf\" solution that uses <code>MonadRandom</code> and comes pretty close to what (I think) you have in mind.  </p>\n\n<p>I rewrote your <code>randomPoly</code> and <code>mkEvenPoly</code> functions to return a <code>Rand</code> monad.  As such, they can be composed in a do statement into a composite <code>Rand</code> monad .  Inside the do loop that generates this composite monad, random variables are set without the explicit use of a generator.  A single generator is passed to runRand along with the composite monad to generate multiple random values.</p>\n\n<pre><code>import Control.Monad.Random\n\nrandomPoly :: Rand StdGen [Integer]\nrandomPoly = map (`mod` 10) &lt;$&gt; take 4 &lt;$&gt; getRandoms\n\nmkEvenPoly :: Rand StdGen [Integer]\nmkEvenPoly = do\n  p &lt;- randomPoly\n  let res\n        | even $ sum p = return p\n        | otherwise = mkEvenPoly\n  res\n\n-- Use do notation to compose multiple monads into one.\nrandomStuff :: Rand StdGen (Float, [[Integer]])\nrandomStuff = do\n  f &lt;- getRandom\n  p0 &lt;- randomPoly\n  p1 &lt;- randomPoly\n  e0 &lt;- mkEvenPoly\n  e1 &lt;- mkEvenPoly\n  e2 &lt;- mkEvenPoly\n  return (f, [p0, p1, e0, e1, e2])\n\nmain = do\n  -- set an initial seed once.\n  g0 &lt;- getStdGen \n\n  -- actually generate the random values.\n  let (stuff, g1) = runRand randomStuff g0  \n\n  print stuff\n</code></pre>\n"}], "owner": {"reputation": 1178, "user_id": 1568590, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/b6bb720c28219294cf31d0693ed47388?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1568590/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 633, "favorite_count": 0, "accepted_answer_id": 48148015, "answer_count": 1, "score": 4, "last_activity_date": 1515405935, "creation_date": 1515361759, "question_id": 48141845, "link": "https://stackoverflow.com/questions/48141845/generating-new-and-different-random-lists-in-haskell-without-io", "title": "Generating new and different random lists in Haskell (without IO)?", "body": "<p>This is very much a newbie question, and although I can find partial answers, I'm still having difficulty getting the whole thing to work.  I have a collection of functions in a module with work with a particular data type I've designed.  And sometimes I need to create a list of random values.  We might consider my types as polynomials, given as lists of their coefficients.  So I should just need to call a <code>randomPoly</code> function (say) to generate new lists each time it's called.  For simplicity all lists can be the same length (say 4) and with the same sized elements - say between 0 and 9.</p>\n\n<p>So what I want is to be able to do something like this (in ghci):</p>\n\n<pre><code>&gt;&gt;&gt; setRandomSeed 42\n&gt;&gt;&gt; randomPoly\n[6,5,0,4]\n&gt;&gt;&gt; randomPoly\n[9,6,3,5]   \n &gt;&gt;&gt; randomPoly\n[7,3,9,2]\n</code></pre>\n\n<p>I can of course obtain different random lists by simply passing a new seed to the generator each time I need a new list:</p>\n\n<pre><code>&gt;&gt;&gt; randomPoly st = map (`mod` 10) $ take 4 $ randoms (mkStdGen st) :: [Integer]\n</code></pre>\n\n<p>But I don't want to do this: I want to set an initial seed once, and let State take care of managing the current value of the generator from then on.</p>\n\n<p>At this stage I'm not much interested in the nitty-gritty of monads, State, and all the rest - I'm looking for as close to an \"off the shelf\" solution as possible.  I just want something I can use.  Most examples seem to be very keen to teach all about how the State monad works - and this is a very honorable notion - but right now all I want is some quick and simple method of creating random lists when I want them.</p>\n\n<p>For example here's a silly function which creates random lists until a sum of all values is even:</p>\n\n<pre><code>mkEvenPoly :: Int -&gt; [Integer]\nmkEvenPoly st\n  | even $ sum p = p\n  | otherwise    = mkEvenPoly $ s+1\n  where\n    p = map (`mod` 10) $ take 4 $ randoms (mkStdGen st) :: [Integer]\n</code></pre>\n\n<p>Note that each time I need to pass a new generating value to <code>mkStdGen</code>.  Can I do this sort of thing with the State monad - storing the current value of the generator (which is returned by <code>mkStdGen</code>) and then using it for the next random call?</p>\n"}, {"tags": ["c++", "haskell", "data-structures", "tree"], "comments": [{"owner": {"reputation": 54818, "user_id": 962089, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/b6SVs.jpg?s=128&g=1", "display_name": "chris", "link": "https://stackoverflow.com/users/962089/chris"}, "edited": false, "score": 0, "creation_date": 1515347833, "post_id": 48139962, "comment_id": 83257670, "body": "A deque might be good enough, though it doesn&#39;t fully meet the third requirement."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "reply_to_user": {"reputation": 54818, "user_id": 962089, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/b6SVs.jpg?s=128&g=1", "display_name": "chris", "link": "https://stackoverflow.com/users/962089/chris"}, "edited": false, "score": 0, "creation_date": 1515347883, "post_id": 48139962, "comment_id": 83257689, "body": "@chris It doesn&#39;t meet the second one at all"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1515347948, "post_id": 48139962, "comment_id": 83257709, "body": "Possibly a set where the set element is a type that maintains both a value and an insertion ordering."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1515347995, "post_id": 48139962, "comment_id": 83257715, "body": "@Angnew Access to a deque is only O(1) if you know in advance where to look. Otherwise it is O(N)."}, {"owner": {"reputation": 54818, "user_id": 962089, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/b6SVs.jpg?s=128&g=1", "display_name": "chris", "link": "https://stackoverflow.com/users/962089/chris"}, "edited": false, "score": 0, "creation_date": 1515348504, "post_id": 48139962, "comment_id": 83257875, "body": "@NeilButterworth, Fair, I didn&#39;t think that through when looking at cppreference. Amortized constant might also be good enough, or it might not."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515348517, "post_id": 48139962, "comment_id": 83257877, "body": "Are you looking for something immutable (as in <code>Data.Sequence</code>) or something mutable?"}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "edited": false, "score": 0, "creation_date": 1515348559, "post_id": 48139962, "comment_id": 83257893, "body": "Well, yeah, <code>std::deque</code> doesn&#39;t meet the third requirement, though it meets others. It has <code>O(1)</code> access by an index, it is even better than <code>O(logn)</code>. I&#39;m not interested in searching element, just getting it by an index. However <code>std::deque</code> has <code>O(n)</code> insert in the middle."}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "edited": false, "score": 0, "creation_date": 1515348593, "post_id": 48139962, "comment_id": 83257900, "body": "You can implement binary search tree that meets all requirements, that is roughly speaking how <code>Data.Sequence</code> is implemented (It is actually Finger Tree, as far as I know). Rope structure has similar properties, and you can find Rope for <code>C++</code>. I just wonder, is there anything like Generic Rope (for any element type)."}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515348655, "post_id": 48139962, "comment_id": 83257922, "body": "@dfeuer mutable."}, {"owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1515372594, "post_id": 48139962, "comment_id": 83264128, "body": "How about a <code>std::map</code> where you map the insertion order (an int that you need to keep track of) to each datum? A<code>std::map</code> is a tree, so meets all requirements."}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "edited": false, "score": 0, "creation_date": 1515374235, "post_id": 48139962, "comment_id": 83264457, "body": "It would work only if I know all indexes of elements beforehand. But it is rarely the case, otherwise, I wouldn&#39;t need to insert into the middle, I would just sort by index and use <code>std::vector</code> or so. I mean in <code>Data.Sequence</code> if you have two elements, their indexes: [0, 1]. If you insert another element into the middle, you change the index of the last element to 2. <code>std::map</code> doesn&#39;t allow that in O(log(N))"}], "answers": [{"comments": [{"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 1, "creation_date": 1515397346, "post_id": 48144311, "comment_id": 83270183, "body": "I wrote this data structure a long time ago in C++, as a binary tree just like yours. Don&#39;t think I&#39;ll find the source in reasonable time. But I didn&#39;t know anything about cache locality or allocation strategies at the time. If I were to do it again, and it needed to be fast, I&#39;d probably use an approach based on B-trees for better cache locality, and (at least) standard allocator support."}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "reply_to_user": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 2, "creation_date": 1515421110, "post_id": 48144311, "comment_id": 83282689, "body": "Yeah, also, just a binary tree is not enough. You need to keep it balanced. So Red-Black, Splay, or B-Tree. (I&#39;ve implemented such thing via Splay Tree before, not for real project though). As was mentioned by @ArneVogel, B-Tree would be better because it should be more cache friendly. standard allocator support is another thing to remember. That is why I asked about a library - there are many things to be aware of if you want to implement it by yourself."}, {"owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "edited": false, "score": 1, "creation_date": 1515421840, "post_id": 48144311, "comment_id": 83283105, "body": "My current question wasn&#39;t caused by some real project needs (Should&#39;ve mentioned it in the question). I wondered &quot;just in case&quot; - Haskell is the only language I know that has such functionality. So it seems the answer is - no. C++ doesn&#39;t have such library. Maybe nobody just needs it. <code>std::vector</code> or <code>std::deque</code> work fast enough. Anyway, thanks for your response, and benchmark references. I think I&#39;ll mark your question as accepted (after waiting a bit to be sure nobody comes up with such library). Could you please add the info from my previous comment?"}], "tags": [], "owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "is_accepted": true, "score": 4, "last_activity_date": 1515427518, "last_edit_date": 1592644375, "creation_date": 1515386429, "answer_id": 48144311, "question_id": 48139962, "link": "https://stackoverflow.com/questions/48139962/is-there-anything-like-haskell-data-sequence-in-c/48144311#48144311", "title": "Is there anything like Haskell Data.Sequence in C++?", "body": "<p>It seems to me that the way to implement* such a data structure you'd need a tree that stores the number of elements in each node. It allows insertion and retrieval in O(log(N)), and indices are maintained simply by counting how many elements there are to the &quot;left&quot; of a given node in the tree.</p>\n<p>* <em>I'm answering maybe a slightly different question here, the actual question asks for a recommendation for a library, which is explicitly off-topic at SO.</em></p>\n<p>A node of this tree would look like this:</p>\n<pre><code>template&lt;typename T&gt;\nstruct Node {\n  Node* left;\n  Node* right;\n  size_t elements;\n  T value\n  \n  T&amp; access(size_t index) {\n    if (left-&gt;elements == index) {\n      return value;\n    } else if (left-&gt;elements &gt; index) {\n      return left-&gt;access(index);\n    } else {\n      return right-&gt;access(index - left-&gt;elements - 1);\n    }\n  }\n\n  void insert(size_t index, T&amp;&amp; value) {\n    // insert `value` at right place, increment `elements`\n  }\n}\n</code></pre>\n<p>(I left the <code>insert</code> method as an exercise to the reader.)</p>\n<p><strong>Edit</strong>: As willir (OP) mentioned in the comments below, the tree would need to be a balanced tree. Arne Vogel suggests that B-trees would be the best choice for cache locality.</p>\n<hr />\n<h1>But:</h1>\n<p>If you do implement something like this, make sure that you measure your application, compare it to <code>std::vector</code>. Inserting into a vector at an arbitrary location is O(N), not O(log(N)), but it's O(N) of a <strong>very</strong> cheap operation. A vector has many advantages over such a data structure:</p>\n<ol>\n<li><p>No code to maintain.</p>\n</li>\n<li><p>Less stuff to store (in a tree you need to store two pointers and a count, which are not necessary in a vector), meaning more of your data fits in the cache at the same time.</p>\n</li>\n<li><p>Data is always accessed in the same order in which it is stored. With trees you need to traverse nodes that can be stored in arbitrary locations in memory, they don't need to be close together, and are likely not stored in the order in which they're read.</p>\n</li>\n</ol>\n<p>Points 2 and 3 mean that vectors have <strong>many</strong> fewer cache misses. This can make for a <strong>huge</strong> difference in timings.</p>\n<p>Moving data around in a vector becomes rather slow if each data element is large. But in this case you should keep pointers to your data in the vector, so that you're moving lists of pointers around, rather than your actual data. For such large data elements, I would suggest allocating each one independently, and keeping its pointer in a <code>std::vector&lt;std::unique_ptr&lt;T&gt;&gt;</code>.</p>\n<p>Here are some relevant links:</p>\n<ul>\n<li><p>DZone: <a href=\"https://dzone.com/articles/c-benchmark-%E2%80%93-stdvector-vs\" rel=\"nofollow noreferrer\">C++ benchmark \u2013 std::vector VS std::list</a></p>\n</li>\n<li><p>YouTube: <a href=\"https://youtu.be/0iWb_qi2-uI?t=2680\" rel=\"nofollow noreferrer\">Day 1 Keynote - Bjarne Stroustrup: C++11 Style</a></p>\n</li>\n<li><p>SO: <a href=\"https://stackoverflow.com/q/238008/7328782\">Relative performance of std::vector vs. std::list vs. std::slist?</a></p>\n</li>\n</ul>\n"}], "owner": {"reputation": 529, "user_id": 1081184, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e509fc265b1faea3d0d63db256495a?s=128&d=identicon&r=PG", "display_name": "willir", "link": "https://stackoverflow.com/users/1081184/willir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 48144311, "answer_count": 1, "score": 6, "last_activity_date": 1515427518, "creation_date": 1515347580, "last_edit_date": 1515348904, "question_id": 48139962, "link": "https://stackoverflow.com/questions/48139962/is-there-anything-like-haskell-data-sequence-in-c", "title": "Is there anything like Haskell Data.Sequence in C++?", "body": "<p>Does any <code>C++</code> library implements something like <code>Haskell</code> <code>Data.Sequence</code> container?</p>\n\n<p>I'm mostly interested in:</p>\n\n<ol>\n<li>Maintaining the elements order (In which they were inserted).</li>\n<li><code>O(logn)</code> access by an index. Aka <code>operator[](size_type pos)</code>.</li>\n<li><code>O(logn)</code> insertion/deletion in the middle (by an index).</li>\n</ol>\n"}, {"tags": ["list", "haskell", "heap"], "comments": [{"owner": {"reputation": 9, "user_id": 9184775, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5dgFBfpLfqM/AAAAAAAAAAI/AAAAAAAACkA/OIzC2HhvPdk/photo.jpg?sz=128", "display_name": "TiagoGomes", "link": "https://stackoverflow.com/users/9184775/tiagogomes"}, "reply_to_user": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 1, "creation_date": 1515346003, "post_id": 48139477, "comment_id": 83257044, "body": "Well, my thought process was: generate a list using randomRIO from (0,30), through a function that receives an lnt (which is the length of the list to generate) , then my problem is getting the generated (sorted) list, into an heap. Maybe my problem is just syntax-wise."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1515610722, "post_id": 48139477, "comment_id": 83369302, "body": "What, exactly, is your question? It&#39;s not at all clear what you are asking."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 9184775, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5dgFBfpLfqM/AAAAAAAAAAI/AAAAAAAACkA/OIzC2HhvPdk/photo.jpg?sz=128", "display_name": "TiagoGomes", "link": "https://stackoverflow.com/users/9184775/tiagogomes"}, "edited": false, "score": 0, "creation_date": 1515350097, "post_id": 48139929, "comment_id": 83258386, "body": "I&#39;ll try to implement that later today and I&#39;ll give the feedback thank you!"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1515347611, "last_edit_date": 1515347611, "creation_date": 1515347298, "answer_id": 48139929, "question_id": 48139477, "link": "https://stackoverflow.com/questions/48139477/create-a-random-heap-from-a-list/48139929#48139929", "title": "Create a Random Heap from a List", "body": "<p>I'll assume the heap shall be selected uniformly at random from all possibilities. Let's investigate the number <code>f(n)</code> of possibile min-max heaps with <code>n</code> nodes. A uniquely determined node goes at the root, there is no choice in this. We choose a subset of the remaining nodes to go on the left side, then repeat this for both children. <code>f(n+1) = sum_{k=0}^{n}{(n over k) * f(k) * f(n-k)}; f(0) = 0</code>. The first few terms are 1, 1, 2, 6, 24 and 120, which suggests the factorial sequence (and the proof of sequence equality is child's play), which also describes the number of possible orders of our input list. Therefore we can hope that each list order corresponds to a min-max heap.</p>\n\n<p>Having mulled on it for a few minutes, it now seems obvious that after shuffling the list, we can split it at its minimum element, choosing the part of the list on the minimum's left as the mentioned subset, then splitting each half at the maximum element, then splitting each quarter at the minimum element, and so on. Different list orders yield different heaps, so this finite correspondence is one-to-one.</p>\n"}, {"comments": [{"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1515610610, "post_id": 48149556, "comment_id": 83369237, "body": "He specifically said that the heap is a min-max heap. See <a href=\"https://en.wikipedia.org/wiki/Min-max_heap\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Min-max_heap</a>"}], "tags": [], "owner": {"reputation": 1, "user_id": 9021635, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7fTNu5q2hhs/AAAAAAAAAAI/AAAAAAAAAEw/hTB1KWmkP_E/photo.jpg?sz=128", "display_name": "Bruno Sousa", "link": "https://stackoverflow.com/users/9021635/bruno-sousa"}, "is_accepted": false, "score": 0, "last_activity_date": 1515411605, "creation_date": 1515411605, "answer_id": 48149556, "question_id": 48139477, "link": "https://stackoverflow.com/questions/48139477/create-a-random-heap-from-a-list/48149556#48149556", "title": "Create a Random Heap from a List", "body": "<p>You're probably confused in the definition of heap.</p>\n\n<p>You must chose the root which is the max/min element of the argument, depending on the type of heap. Than use the randomRIO to choose which elements go to each node.</p>\n"}], "owner": {"reputation": 9, "user_id": 9184775, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5dgFBfpLfqM/AAAAAAAAAAI/AAAAAAAACkA/OIzC2HhvPdk/photo.jpg?sz=128", "display_name": "TiagoGomes", "link": "https://stackoverflow.com/users/9184775/tiagogomes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1515411605, "creation_date": 1515344304, "last_edit_date": 1592644375, "question_id": 48139477, "link": "https://stackoverflow.com/questions/48139477/create-a-random-heap-from-a-list", "title": "Create a Random Heap from a List", "body": "<p>i'm doing some college studying in haskell atm, and im stuck at this. The data type is the following:</p>\n<pre><code>data Heap a = Empty | Node a (Heap a) (Heap a)\n</code></pre>\n<p>(in this exercise <code>Heap</code> a is always a min-max heap, therefore each node at an even level in the tree is less than all of its descendants, while each node at an odd level in the tree is greater than all of its descendants).</p>\n<p>The Question:</p>\n<blockquote>\n<p>&quot;<code>randomHeap :: [a] -&gt; IO (Heap a)</code> which generates a random heap, containing all the elements from the argument list.</p>\n<p>&quot;Use the function <code>randomRIO :: Random t =&gt; (t,t) -&gt; IO t</code> (which is present in <code>System.Random</code>) to calculate a random value within a certain range.</p>\n<p>&quot;Note that for a non empty list, the choice of which element to use for the root is unique, what should vary are which elements are used to build the sub-trees.&quot;</p>\n</blockquote>\n"}, {"tags": ["haskell", "code-generation", "record", "template-haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1515342604, "post_id": 48139031, "comment_id": 83255887, "body": "Why not just make the last field a <code>[Maybe String]</code> and stick them all in there?"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1515343782, "post_id": 48139031, "comment_id": 83256253, "body": "This is maybe possible with Template Haskell (no idea), but otherwise unlikely."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1515348764, "post_id": 48139031, "comment_id": 83257967, "body": "@hnefatl The OP added the TH tag, so I think it&#39;s asking for that. It should be clarified in the question, though, since it&#39;s an important detail."}, {"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515351653, "post_id": 48139031, "comment_id": 83258821, "body": "@Carcigenicate I would except this is for an API client that consumes an API I have not control over."}, {"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515351655, "post_id": 48139031, "comment_id": 83258823, "body": "@chi I was thinking that maybe it was possible with TH but the recommendations I&#39;ve seen say to only use it when there is no other way."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1515353327, "post_id": 48139031, "comment_id": 83259315, "body": "Nothing but TH can generate record fields. Also note that TH runs at compile time, you can&#39;t generate record fields at runtime in any way, since that would break static typing. Perhaps you should share why do you want to do this, instead of using e.g. <code>Data.Map.Map</code> for the mapping."}, {"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515357651, "post_id": 48139031, "comment_id": 83260533, "body": "@chi I&#39;ve added an explanation to the question. I&#39;m hesitant about using <code>Data.Map.Map</code> because with a record I can use the <code>deriveJSON</code> splice from Data.Aeson.TH`. Also I think providing a record type to the user is better UX."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515359230, "post_id": 48139031, "comment_id": 83260960, "body": "Seems like you&#39;re looking for extensible records. However, this question lacks specifics. Generating a type from some specification is fairly straightforward with TH. The real question is what sorts of functions do you want to write which consume or produce such records. If you are just interested in representing JSON-like objects, just use a <code>Map</code> or even something like <code>Value</code> from <code>aeson</code>. There is no barrier to writing a &#39;record-like&#39; interface for these types (this is essentially the problem solved by <code>lens</code>)."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9184200"}, "is_accepted": false, "score": 0, "last_activity_date": 1515416149, "last_edit_date": 1515416149, "creation_date": 1515342258, "answer_id": 48139147, "question_id": 48139031, "link": "https://stackoverflow.com/questions/48139031/is-it-possible-to-generate-record-fields-in-haskell/48139147#48139147", "title": "Is it possible to generate record fields in haskell?", "body": "<p><strong>I don't think so.</strong></p>\n\n<p><code>data</code> means you are defining a new data type. Haskell is a static programming language meaning that all types are known at compile time.</p>\n\n<p>Use a List, Tree or some other data structure you can expand/ work on at runtime.</p>\n\n<p><strong>Idea:</strong><br>\nIf these attributes have all the same suffix, save the suffix and the other strings in a list. If you need them you just combine the suffix &amp; strings.</p>\n\n<p>Maybe something like this:</p>\n\n<pre><code>data A = A [String] String\n\ncreate :: A -&gt; [String]\ncreate (A ss suff) = create' ss suff\n  where create' [] _ = []\n        create' a b = ((head a) ++ b) : create' (tail a) b\n</code></pre>\n"}], "owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515416149, "creation_date": 1515341544, "last_edit_date": 1515357418, "question_id": 48139031, "link": "https://stackoverflow.com/questions/48139031/is-it-possible-to-generate-record-fields-in-haskell", "title": "Is it possible to generate record fields in haskell?", "body": "<p>Suppose I have a prefix <code>p</code> and list of strings <code>ss</code>. I would like to generate a record field name, <code>p ++ s</code>, for each of the strings <code>s</code> in <code>ss</code>.</p>\n\n<pre><code>data Example = Example\n  { field1 :: String\n  , field2 :: String\n  -- the rest of the fields are generated\n  , prefixString1 :: Maybe String\n  , prefixString2 :: Maybe String\n  , prefixString3 :: Maybe String\n  -- ...\n  } deriving (Eq, Show)\n</code></pre>\n\n<p>I'm writing an API client for an API I do not own. Provided certain query parameters, the endpoint will provide additional parameters on the object.</p>\n\n<pre><code>-- without query param\n{\n  \"field_1\": \"\",\n  \"field_2\": \"\"\n}\n\n-- with query param \"x\"\n{\n  \"field_1\": \"\",\n  \"field_2\": \"\",\n  \"field_1_x\": \"\",\n  \"field_2_x\": \"\"\n}\n\n-- with query param \"y\"\n{\n  \"field_1\": \"\",\n  \"field_2\": \"\",\n  \"field_1_y\": \"\",\n  \"field_2_y\": \"\"\n}\n</code></pre>\n\n<p>There are ~30 different values the query parameter can be so I'd end up have a huge record of over 60 fields that are all basically the same except the suffix is different.</p>\n"}, {"tags": ["list", "haskell", "recursion", "infinite", "let"], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 5622934, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ac80aebf3caef245b0627aaff0a6039?s=128&d=identicon&r=PG&f=1", "display_name": "BigMeister", "link": "https://stackoverflow.com/users/5622934/bigmeister"}, "edited": false, "score": 0, "creation_date": 1515340304, "post_id": 48138824, "comment_id": 83255126, "body": "And the evaluation happens when the function concat is called, right?"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 241, "user_id": 5622934, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ac80aebf3caef245b0627aaff0a6039?s=128&d=identicon&r=PG&f=1", "display_name": "BigMeister", "link": "https://stackoverflow.com/users/5622934/bigmeister"}, "edited": false, "score": 2, "creation_date": 1515340404, "post_id": 48138824, "comment_id": 83255158, "body": "@BigMeister Because Haskell is lazy, this evaluation occurs only when it is absolutely necessary, such as when you print out the result of calling <code>infiniteList</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1515340599, "post_id": 48138824, "comment_id": 83255227, "body": "Don&#39;t think of <code>ls ++ v</code> as constructing a value that is then assigned to <code>v</code>; rather, it is just a <i>rule</i> for evaluating <code>v</code>. &quot;When you see <code>v</code>, replace it with <code>ls ++ v</code>.&quot; Whether then recursive occurrence of <code>v</code> needs to be evaluated depends on the consumer of the original <code>v</code>."}, {"owner": {"reputation": 241, "user_id": 5622934, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ac80aebf3caef245b0627aaff0a6039?s=128&d=identicon&r=PG&f=1", "display_name": "BigMeister", "link": "https://stackoverflow.com/users/5622934/bigmeister"}, "edited": false, "score": 0, "creation_date": 1515340999, "post_id": 48138824, "comment_id": 83255355, "body": "Yes, I got it now! I was misunderstanding the meaning of the let but now It is clear. Thank you both!"}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 7, "last_activity_date": 1515340131, "creation_date": 1515340131, "answer_id": 48138824, "question_id": 48138787, "link": "https://stackoverflow.com/questions/48138787/let-recursiveness-in-haskell/48138824#48138824", "title": "Let recursiveness in Haskell", "body": "<p>To evaluate <code>v</code>, just replace it with its definition:</p>\n\n<pre><code>v = ls ++ v\n  = ls ++ ls ++ v\n  = ls ++ ls ++ ls ++ v\n  = ls ++ ls ++ ls ++ ls ++ v\n  = ls ++ ls ++ ls ++ ls ++ ls ++ v\n  = ls ++ ls ++ ls ++ ls ++ ls ++ ls ++ v\n</code></pre>\n\n<p>Clearly this will never end.</p>\n"}], "owner": {"reputation": 241, "user_id": 5622934, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ac80aebf3caef245b0627aaff0a6039?s=128&d=identicon&r=PG&f=1", "display_name": "BigMeister", "link": "https://stackoverflow.com/users/5622934/bigmeister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 1, "accepted_answer_id": 48138824, "answer_count": 1, "score": 3, "last_activity_date": 1515347713, "creation_date": 1515339866, "last_edit_date": 1515347713, "question_id": 48138787, "link": "https://stackoverflow.com/questions/48138787/let-recursiveness-in-haskell", "title": "Let recursiveness in Haskell", "body": "<p>Could someone explain the behaviour of this little piece of code with the following input: <code>[[1,2],[3,4]]</code>?</p>\n\n<pre><code>infiniteList ls = let v = ls ++ v\n                  in concat v\n</code></pre>\n\n<p>The result is an infinite list but I don't realise why. I've understood that the trick is in:</p>\n\n<pre><code>ls ++ v\n</code></pre>\n\n<p>But how exactly work the let since we do not define the initial value for the variable <code>v</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1515336219, "post_id": 48137709, "comment_id": 83253784, "body": "I believe this is a feature of your shell; a character is added that indicates end-of-output so that the next prompt can be printed at the beginning of the line (in bash you would see your prompt printed in place of the &quot;%&quot;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515338163, "post_id": 48137709, "comment_id": 83254412, "body": "Try <code>show (length input) ++ &quot;\\n&quot;</code> to add a newline at the end. Still, note that the <code>interact</code> approach quickly becomes hard. Unless the problem is very simple like this one, I&#39;d not recommend <code>interact</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515359408, "post_id": 48137899, "comment_id": 83261000, "body": "One could also write <code>interact&#39; f = interact ((++&quot;\\n&quot;) . f)</code>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1515333834, "creation_date": 1515333834, "answer_id": 48137899, "question_id": 48137709, "link": "https://stackoverflow.com/questions/48137709/haskells-stack-or-interact-are-adding-characters/48137899#48137899", "title": "Haskells stack or interact are adding characters", "body": "<p>That is because the definition of interact uses <code>putStr</code> instead of <code>putStrLn</code>.</p>\n\n<p>You can take a look at the source code <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/System.IO.html#interact\" rel=\"nofollow noreferrer\">here</a>. </p>\n\n<blockquote>\n<pre><code>interact        ::  (String -&gt; String) -&gt; IO ()\ninteract f      =   do s &lt;- getContents\n                       putStr (f s)\n</code></pre>\n</blockquote>\n\n<p>To remedy your issue I would go on and create a similar function</p>\n\n<pre><code>interact' :: (String -&gt; String) -&gt; IO ()\ninteract' f = do s &lt;- getContents\n                putStrLn (f s)\n</code></pre>\n\n<p>or if you like to mix it up and write a bit terser code</p>\n\n<pre><code>interact' f = putStrLn =&lt;&lt; (f &lt;$&gt; getContents)\n</code></pre>\n\n<p>I don't know what the <code>%</code> is or why it is showing up, my guess would be that it is the escaped <code>CTRL-D</code>.</p>\n\n<p>With regards to your second question about the additional \"non-existing\" character, I am also not sure, but here my guess would be that this is the <code>\\EOF</code>.</p>\n\n<p>Btw. you can always check using <code>more testinput | wc -c</code> it should yield the same result as your haskell program.</p>\n"}], "owner": {"reputation": 14335, "user_id": 110963, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/096c2c331fa0c946d103e9038930f80e?s=128&d=identicon&r=PG", "display_name": "Achim", "link": "https://stackoverflow.com/users/110963/achim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515334134, "creation_date": 1515332630, "last_edit_date": 1515334134, "question_id": 48137709, "link": "https://stackoverflow.com/questions/48137709/haskells-stack-or-interact-are-adding-characters", "title": "Haskells stack or interact are adding characters", "body": "<p>I'm doing my first steps using Haskell. I created a project using <code>stack</code> and changed the Main.hs into</p>\n\n<pre><code>module Main where\n\nmy_fkt :: String -&gt; String\nmy_fkt input = show (length input)\n\nmain :: IO ()\nmain = interact my_fkt\n</code></pre>\n\n<p>I build the project via <code>stack build</code>, run it via <code>stack exec firststeps-exe</code>, enter \"abcd\" and finish input via <code>&lt;CTRL&gt;-D</code>. In the console I now see </p>\n\n<pre><code>abcd4%\n</code></pre>\n\n<p>The <code>%</code>is inverted. If I use a text file containing the \"abcd\" (without line break) and execute <code>more sample.txt | stack exec firststeps-exe</code> I see </p>\n\n<pre><code>abcd5%\n</code></pre>\n\n<p>Why do I get one additional character in the second case and what is the inverted percentage sign?</p>\n"}, {"tags": ["haskell", "tree", "monads", "abstract-syntax-tree", "free-monad"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1515319981, "post_id": 48136060, "comment_id": 83249582, "body": "For the desugaring of <code>do</code> notation, see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">the Haskell2010 report here</a>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1515320394, "post_id": 48136060, "comment_id": 83249670, "body": "When representing ASTs as a monad, the constructor <code>Empty</code> (as it&#39;s called here) corresponds to a hole (containing a temporary value), and <code>(&gt;&gt;=)</code> implements substitutions in those holes (where the new expressions can depend on the temporary values they replace). <code>(&gt;&gt;)</code> implements substitution by a constant expression."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1515320908, "post_id": 48136060, "comment_id": 83249776, "body": "<code>Append</code> is a trick to make &quot;substitution&quot; behave as concatenation. I&#39;m not 100% sure this satisfies the monad laws but that seems to be the case (modulo some syntactic trivialities such as the fact that <code>Append</code> should be viewed as a monoidal operation)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515325552, "post_id": 48136060, "comment_id": 83250860, "body": "<code>&gt;&gt;</code> does not default to <code>*&gt;</code>!"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515325902, "post_id": 48136060, "comment_id": 83250935, "body": "@dfeuer <code>m &gt;&gt; k = m &gt;&gt;= (\\_ -&gt; k)</code>. Ok got it."}], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1515323641, "post_id": 48136464, "comment_id": 83250408, "body": "Certainly, this is not much of a monad. Only the <code>&gt;&gt;</code> is used and that&#39;s a strong hint that from a computational point all that&#39;s needed is a monoid. But to get at the &#39;do&#39; notation I have to have a Monad, don&#39;t I? The &#39;do&#39; notation achieves the goal (i.e. to succinctly define syntax trees) with the least syntactic noise, as far as I can tell."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1515326679, "post_id": 48136464, "comment_id": 83251086, "body": "With the right language extension, you can also use a form of <code>do</code> notation for arrows: <a href=\"https://www.haskell.org/arrows/syntax.html\" rel=\"nofollow noreferrer\">haskell.org/arrows/syntax.html</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1515327089, "post_id": 48136464, "comment_id": 83251176, "body": "@Davislor yes, but what has that to do with the subject here? The OP&#39;s type isn&#39;t even really a functor, much less an arrow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515327541, "post_id": 48136464, "comment_id": 83251277, "body": "It certainly is a functor; only the instance is a bit sketchy."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515330720, "post_id": 48136464, "comment_id": 83252075, "body": "@dfeuer sure, but it is a functor <i>for the sake of enabling monad syntax</i>, not because it has any inherent functor semantics. The only way this makes sense other than for syntax-abuse is by combining these trivial monad semantics with other monads, i.e. by setting the whole thing up as a monad <i>transformer</i>."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1515334224, "post_id": 48136464, "comment_id": 83253174, "body": "With the monad other nice features become available, such as <code>forM_ [1,2,3] (Comment . show)</code>"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1515337825, "post_id": 48136464, "comment_id": 83254313, "body": "@leftaroundabout &quot;Syntax abuse&quot; - oh no no I certainly don&#39;t want to be guilty of that ;-) Joking aside. I&#39;m fine with abusing syntax if it gives me what I want, i.e. an AST and a readable definition thereof without syntactic noise that carries no information."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515343614, "post_id": 48136464, "comment_id": 83256201, "body": "<code>s&#47;forM_&#47;flip foldMap&#47;</code>. \u2014 Sure, I myself use \u201cunmonadic <code>do</code>\u201d a lot. Just make sure you don&#39;t brick the option of using the syntax for stuff that actually is monadic, such as other monad transformers."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1515328696, "last_edit_date": 1515328696, "creation_date": 1515322784, "answer_id": 48136464, "question_id": 48136060, "link": "https://stackoverflow.com/questions/48136060/use-the-haskell-monad-do-notation-to-define-a-syntax-tree/48136464#48136464", "title": "Use the Haskell monad &quot;do&quot; notation to define a syntax tree", "body": "<p>I'm not sure if this whole approach is a good idea (though, I've actually though a number of times of doing something similar myself).</p>\n\n<p>Note that monads like <code>Blaze.MarkupM</code>, <a href=\"https://hackage.haskell.org/package/HaTeX-3.17.3.1/docs/Text-LaTeX-Base-Writer.html#t:LaTeXM\" rel=\"nofollow noreferrer\"><code>HaTeX.LaTeXM</code></a> etc. aren't really much of a monad. They're really just <strong>monoids</strong> that want access to monadic combinators (mostly, to abuse <code>do</code> notation, but it also allows stack monad transformers on top, which can make quite some sense). I.e., they're nothing but specialised <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Writer-Lazy.html#t:Writer\" rel=\"nofollow noreferrer\"><code>Writer</code></a> monads!<br>At the moment, you're really doing the same thing; if that's what you're intending then maybe the best way to go about it would be to just design your type as a <code>Monoid Tree</code>, then look at the structure of the <code>Writer Tree</code> monad and, if desired, refactor it into a <code>TreeM</code> data structure. (HaTeX doesn't do this but keeps <code>LaTeX</code> and <code>LaTeXM</code> separate types with only a common class interface, which is arguably a cleaner approach, though it may be not optimal for performance.)</p>\n\n<p>The result will be pretty like <code>Blaze.MarkupM</code> / the structure you have right now. I could discuss your individual questions, but really, they can all be answered by just looking at how the type is isomorphic to the writer monad.</p>\n\n<hr>\n\n<p>Actually you don't need a <code>Monad</code> instance at all to use <code>do</code>, as such:</p>\n\n<pre><code>Prelude&gt; 2 * do 1 + 1\n4\n</code></pre>\n\n<p>So if you just want to abuse <code>do</code> to avoid parentheses in a tree layout, but don't really have a sensible way of stashing bindable variables in your structure, consider <em>not</em> writing any monad instance. That instance is only needed for a <code>do</code> block <em>with multiple lines</em>, but if none of these lines bind any variables then you can always just replace the implicit <code>&gt;&gt;</code> with an explicit <code>&lt;&gt;</code>, like</p>\n\n<pre><code>    Function Void \"f\" $ do\n        Variable uint8 \"local_y\"\n     &lt;&gt; Comment \"etc. etc.\"\n</code></pre>\n\n<p>The only problem really is: these lines can't include the <code>$</code> operator, because that has lower precedence than <code>&lt;&gt;</code>. One nifty way to circumvent this is to observe that <code>($) = id</code>, so you can write your example as</p>\n\n<pre><code>ast = do\n    Variable uint8 \"i\"\n &lt;&gt; Function Void \"f\" `id`do\n        Variable uint8 \"local_y\"\n     &lt;&gt; Comment \"etc. etc.\"\n</code></pre>\n\n<p>Whether this is even more abuse of syntax than defining a not-much-of-a-monad instance is debatable. IMO, if you define such a monad instance you should right away make it a <em>monad transformer</em>, like <code>HaTeX</code> does, because that also gives the option to allow including <code>IO</code> actions in your AST build (for example, to hard-include external source files).</p>\n\n<hr>\n\n<p>All that said: for your application, it might actually make sense to have a <code>Monad</code> instance that's <em>not</em> just a &ldquo;sugared up monoid&rdquo; but actually binds, well, <strong>variables</strong> in a useful way. That's a feature not applicable to <code>blaze</code>, but certainly to C++/Python/JavaScript language like ASTs, and it could be quite useful because it ensures variables are defined before use, right within the Haskell syntax. Instead of your example, you'd write</p>\n\n<pre><code>ast = do\n    i &lt;- variable uint8\n    Function Void \"f\" $ do\n        local_y &lt;- variable uint8\n        Comment \"etc. etc.\"\n</code></pre>\n\n<p>The variables would under the hood then actually just be numbered identifiers, chosen according to a <em>state variable</em>.</p>\n\n<p>Implementation would be roughly like this:</p>\n\n<pre><code>type VariableName = Int\n\ndata TreeS = Variable Type VariableName\n           | Function Type VariableName TreeS\n           | Comment String\n           | PlaceHolder String\n           | Append TreeS TreeS\n           | Empty\ninstance Monoid where (&lt;&gt;) = Append\n\nnewtype TreeT m a\n    = TreeT { runTreeM :: StateT VariableName (WriterT TreeS m) a }\n    deriving (Functor, Applicative, Monad)\n\nvariable :: Type -&gt; TreeT m VariableName\nvariable typ = TreeT $ do\n   i &lt;- get\n   lift . tell $ Variable typ i\n   put $ i+1\n   return i\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "is_accepted": false, "score": 0, "last_activity_date": 1515471735, "creation_date": 1515471735, "answer_id": 48161404, "question_id": 48136060, "link": "https://stackoverflow.com/questions/48136060/use-the-haskell-monad-do-notation-to-define-a-syntax-tree/48161404#48161404", "title": "Use the Haskell monad &quot;do&quot; notation to define a syntax tree", "body": "<p>The path I took with this <code>Append</code> encoding of the AST seems to be a dead end, so I dug deeper into free monads. Here's the result:</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\">free monad</a> is a good fit for this type of problem. Free monads allow to separate the 'logic' of a program from its effects. ASTs fall into this pattern. In this example the 'logic' is the AST and the effect is just pretty printing.</p>\n\n<p>More generally, 'effect' can mean analysis, testing (dry runs, for example), running proofs, pretty printing, compressing, ..., and, of course, actual execution.</p>\n\n<p>A lot has been written about free monads, here are a few useful resources to get started:</p>\n\n<ul>\n<li><a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">\"Why free monads matter\"</a> by Gabriel Gonzalez</li>\n<li><a href=\"https://softwareengineering.stackexchange.com/questions/242795/what-is-the-free-monad-interpreter-pattern/242803#242803\">\"What is the \u201cFree Monad + Interpreter\u201d pattern?\"</a> (SE question)</li>\n<li><a href=\"https://stackoverflow.com/questions/24172117/navigating-and-modifying-asts-built-on-the-free-monad-in-haskell\">\"Navigating and modifying ASTs built on the Free monad in Haskell\"\n</a> (SE question)</li>\n</ul>\n\n<p>Now, using <code>Control.Monad.Free</code> a solution would look like this:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\nmodule Main where\n\nimport           Control.Monad.Free\nimport           Data.Monoid        ((&lt;&gt;))\nimport           Data.String.Utils  (rstrip)\n\ntype NumberOfBits = Word\ntype VariableName = String\n\ndata Type = UInt NumberOfBits\n        | Int NumberOfBits\n        | Void\n        deriving Eq\n\nuint8 = UInt 8\nint8 = Int 8\n\ninstance Show Type where\n    show (UInt w) = \"uint\" &lt;&gt; show w\n    show (Int w)  = \"int\" &lt;&gt; show w\n    show Void     = \"void\"\n\ndata AST n = Variable Type VariableName n                -- variable declaration\n            | Function Type VariableName (Free AST ()) n -- function declaration\n            | Comment String n                           -- a comment\n            | PlaceHolder String n                       -- a placeholder with @name holds holds more code\n            | End                                        \n            deriving (Eq, Show, Functor)\n\nend :: Free AST ()\nend = liftF End -- is exactly Pure ()\n\nvariable :: Type -&gt; VariableName -&gt; Free AST ()\nvariable y n = liftF (Variable y n ())\n\nfunction :: Type -&gt; VariableName -&gt; Free AST () -&gt; Free AST ()\nfunction t n p = liftF (Function t n p ())\n\nplaceHolder :: String -&gt; Free AST ()\nplaceHolder n = liftF (PlaceHolder n ())\n\ncomment :: String -&gt; Free AST ()\ncomment c = liftF (Comment c ())\n\nindent :: String -&gt; String\nindent s = rstrip $ unlines $ map (\"    \"&lt;&gt;) (lines s)\n\nrender :: Free AST r -&gt; String\nrender (Free (Variable y n next))   = \"Variable \" &lt;&gt; show y &lt;&gt; \" \" &lt;&gt; show n &lt;&gt; \"\\n\" &lt;&gt; render next\nrender (Free (Function t n f next)) = \"Function \\\"\" &lt;&gt; n &lt;&gt; \"\\\" returning \" &lt;&gt; show t &lt;&gt; \":\\n\"\n                                    &lt;&gt; indent (render f) &lt;&gt; \"\\n\" &lt;&gt; render next\nrender (Free (Comment c next))      = \"//  \" &lt;&gt; c &lt;&gt; \"\\n\" &lt;&gt; render next\nrender (Free (PlaceHolder s next))  = \"PlaceHolder \\\"\" &lt;&gt; s &lt;&gt; \"\\\"\\n\" &lt;&gt; render next\nrender (Free End)                   = \"end\"\nrender (Pure r)                     = \"return\\n\"\n\ncode :: Free AST ()\ncode = do\n    placeHolder \"includefiles\"\n    variable uint8 \"i\"\n    variable int8 \"j\"\n    function Void \"f\" $ do\n        comment \"This is a function!\"\n        variable (Int 8) \"local_i\"\n\nsub :: AST (Free AST b) -&gt; Free AST b\nsub (Variable t n next) = do\n    variable t n\n    next\nsub (Function t n f next) = do\n    function t n f\n    next\nsub (Comment c next) = do\n    comment c\n    next\nsub (PlaceHolder s next) = do\n    comment \"placeholder\"\n    next\n\nmain :: IO ()\nmain = do\n    putStrLn $ render code\n    putStrLn \"-- Apply subst\\n\"\n    putStrLn $ render (iterM sub code)\n</code></pre>\n\n<p>Not all of this needs to be spelt out so explicitly. Some of the boilerplate can be removed by using <code>Control.Monad.Free.TH</code>.</p>\n\n<p><code>Control.Monad.Free</code> is, in a way, the canonical implementation, but the chained data structure means quadratic complexity on some operations. This was addressed by the author himself, Ed Kmett, in <code>Control.Monad.Free.Church</code>, where a different encoding is used. See the <a href=\"https://github.com/feuerbach/freemonad-benchmark\" rel=\"nofollow noreferrer\">free monad benchmark</a> for benchmarks and pointers to other free monad implementations.</p>\n\n<p>Going beyond free monads, cofree monads formalize the interpreter and its relationship with the 'logic'. See, for example, <a href=\"http://dlaing.org/cofun/posts/free_and_cofree.html\" rel=\"nofollow noreferrer\">\"Free for DSLs, cofree for interpreters\"</a> by David Laing.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1515471735, "creation_date": 1515319130, "last_edit_date": 1515337097, "question_id": 48136060, "link": "https://stackoverflow.com/questions/48136060/use-the-haskell-monad-do-notation-to-define-a-syntax-tree", "title": "Use the Haskell monad &quot;do&quot; notation to define a syntax tree", "body": "<p>I'm attempting to construct an abstract syntax tree that allows definition using the monad <code>do</code> notation like so:</p>\n\n<pre><code>ast = do\n    Variable uint8 \"i\"\n    Function Void \"f\" $ do\n        Variable uint8 \"local_y\"\n        Comment \"etc. etc.\"\n</code></pre>\n\n<p>The construction I show here was gleaned from <a href=\"https://hackage.haskell.org/package/blaze-markup-0.8.0.0/docs/src/Text-Blaze-Internal.html#MarkupM\" rel=\"nofollow noreferrer\">Text.Blaze.Html</a>, where it is used to define an HTML tree.</p>\n\n<p><em>Questions are scattered throughout the following. The main question is how to do this correctly. Any input that helps with understanding this construct is greatly appreciated, of course.</em></p>\n\n<p>So, first of all, here's a small, flawed, but 'working' example. It's a syntax tree with declarations of variables and functions of certain type, comment lines, and a placeholder declaration that is used for substitutions:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\nmodule Question\nwhere\n\nimport           Control.Applicative\nimport           Data.Monoid         (Monoid, (&lt;&gt;))\nimport           Data.String.Utils   (rstrip)\n\ntype NumberOfBits = Word\ntype VariableName = String\n\ndata Type = UInt NumberOfBits\n          | Int NumberOfBits\n          | Void\n\nuint8 = UInt 8\nint8 = Int 8\n\ninstance Show Type where\n    show (UInt w) = \"uint\" &lt;&gt; show w\n    show (Int w)  = \"int\" &lt;&gt; show w\n    show Void     = \"void\"\n\ndata TreeM a = Variable Type VariableName            -- variable declaration\n             | Function Type VariableName (TreeM a)  -- function declaration\n             | Comment String                        -- a comment\n             | PlaceHolder String                    -- a placeholder with                  \n             | forall b. Append (TreeM b) (TreeM a)  -- combiner\n             | Empty a                               -- needed for what?\n\ntype Tree = TreeM ()\n\nsubTreeOf :: TreeM a -&gt; a\nsubTreeOf (Variable _ _)   = undefined\nsubTreeOf (Function _ _ t) = subTreeOf t\nsubTreeOf (Comment _)      = undefined\nsubTreeOf (Empty t)        = t\n\ninstance Monoid a =&gt; Monoid (TreeM a) where\n    mempty = Empty mempty\n    mappend = Append\n    mconcat = foldr Append mempty\n\ninstance Functor TreeM where\n    fmap f x = x `Append` (Empty (f (subTreeOf x))) -- fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n\ninstance Applicative TreeM where\n    pure x = Empty x\n    (&lt;*&gt;) x y = (x `Append` y) `Append` (Empty (subTreeOf x (subTreeOf y)))  -- (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n    (*&gt;) = Append\n\ninstance Monad TreeM where\n    return x = Empty x\n    (&gt;&gt;) = Append             -- not really needed: (&gt;&gt;) would default to (*&gt;)\n    t &gt;&gt;= f = t `Append` (f (subTreeOf t))\n\nindent :: String -&gt; String\nindent s = rstrip $ unlines $ map (\"    \"&lt;&gt;) (lines s)\n\nrender :: TreeM a -&gt; String\nrender (Variable y n)   = \"Variable \" &lt;&gt; (show y) &lt;&gt; \" \" &lt;&gt; show n\nrender (Function r n t) = \"Function\" &lt;&gt; \" \" &lt;&gt; n &lt;&gt; \" returning \" &lt;&gt; (show r) &lt;&gt; \":\\n\" &lt;&gt; indent (render t)\nrender (PlaceHolder n)  = \"Placeholder \\\"\" &lt;&gt; n &lt;&gt; \"\\\"\"\nrender (Append t t')    = (render t) &lt;&gt; \"\\n\" &lt;&gt; (render t')\nrender (Empty _)        = \"\"\n\n-- |In input tree t substitute a PlaceHolder of name n' with the Tree t'\nsub :: TreeM a -&gt; (String, TreeM a) -&gt; TreeM a\nsub t@(PlaceHolder n) (n', t') = if n == n' then t' else t\nsub (Function y n t) s         = Function y n (sub t s)\n--sub (Append t t') s            = Append (sub t s) (sub t' s)  -- Error!\nsub t _                        = t\n\ncode :: Tree\ncode = do\n    Variable uint8 \"i\"\n    Variable int8 \"j\"\n    Function Void \"f\" $ do\n        Comment \"my function f\"\n        Variable int8 \"i1\"\n        Variable int8 \"i2\"\n    PlaceHolder \"the_rest\"\n\nmain :: IO ()\nmain = do\n    putStrLn $ render code\n    putStrLn \"\\nNow apply substitution:\\n\"\n    putStrLn $ render (sub code (\"the_rest\", Comment \"There is nothing here\"))\n</code></pre>\n\n<p>This is (should be) a really neat way to define complex tree structures. In particular, this should be the syntactically least noisy, user-friendly, way to define a syntax tree. </p>\n\n<p>In general I struggle to understand the exact meaning of the <code>a</code> in <code>TreeM a</code>. The way I see it the <code>a</code> can be any of the types <code>Variable</code>, <code>Function</code>, <code>PlaceHolder</code>, etc.</p>\n\n<p>I note a few things that strike me as odd:</p>\n\n<ol>\n<li>In <code>forall b. Append (TreeM b) (TreeM a)</code> the order of <code>TreeM a</code> and <code>TreeM b</code>  arguments to <code>Append</code> seem to be reversed. In any case, the use of a existential quantifier in a sum type looks strange. If I understand this correctly, it defines a family of constructors for <code>TreeM</code>.</li>\n<li>Of all the functions required by <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> the only one actually used is the monad <code>&gt;&gt;</code>. (This indicates that a free monad might be the right tool for this job.) It actually never occurred to me that the do notation employs the <code>&gt;&gt;</code> operator and that this fact can be used. </li>\n<li>An <code>undefined</code> has to be used in <code>subTreeOf</code> in order to make the function total.</li>\n</ol>\n\n<p>As already noted, the example above is flawed: Parts of the construct are not appropriate for ASTs:</p>\n\n<ol start=\"4\">\n<li>The definition of <code>Empty</code> makes sense for HTML trees, it is used for empty tags like <code>&lt;br /&gt;</code>. But for the AST it makes no sense. It was left as is to keep the <code>Applicative</code> and <code>Functor</code> implementations working.</li>\n<li>Likewise, the implementations of <code>Functor</code> and <code>Applicative</code> may make sense for HTML trees, but not for the AST. Even for HTML I don't quite understand the purpose of the <code>fmap</code> and applicative <code>&lt;*&gt;</code>. Both extend the tree by pushing down a node and adding an <code>Empty</code> type. I don't quite see which natural transformation on HTML trees that represents.</li>\n</ol>\n\n<p>I'm surprised the <code>subTreeOf x (subTreeOf y)</code> in the definition of the applicative <code>&lt;*&gt;</code> is actually correct syntax, or is there an implicit <code>&gt;&gt;</code>?</p>\n\n<h3>AST transformations</h3>\n\n<p>It is natural to apply transformations on ASTs. The <code>PlaceHolder</code> serves as a little toy for applying a transformation. The function <code>sub</code>, having only a partial implementation, here, should substitute the placeholder \"the_rest\" with a comment. The necessary\n<code>sub (Append t t') s = Append (sub t s) (sub t' s)</code> does not compile however, the expected type of <code>s</code> is <code>(String, TreeM b)</code>, the actual type is <code>(String, TreeM a)</code>.\nChanging the type to \n<code>sub :: TreeM a -&gt; (String, TreeM b) -&gt; TreeM a</code>, on the other hand, breaks the definition of <code>sub p@(PlaceHolder n)</code> and now I'm stuck.</p>\n\n<p>In fact, isn't this <code>sub</code> exactly what <code>fmap</code> for ASTs should be?</p>\n\n<h3>Free monad?</h3>\n\n<p>The term 'free monad' regularly pops up when monads for ASTs are discussed. But the free monad relies on the <code>Functor</code> <code>fmap</code> for the free construction and the <code>fmap</code> shown here is not adequate for ASTs. Once the correct <code>fmap</code> is identified the free monad should do the rest - maybe.</p>\n\n<h3><code>fmap</code></h3>\n\n<p>It seems that a correct <code>fmap</code> is the key for success here, and the correct <code>&lt;*&gt;</code> will probably become more obvious.</p>\n\n<h2>Use-cases</h2>\n\n<p><strong>Loops</strong> can be written with <code>forM_</code>, a nice way to build up repetitive parts of ASTs:</p>\n\n<pre><code>forM_ [\"you\", \"get\", \"the\", \"idea\"] $ \\varName -&gt; do\n    Variable uint8 varName\n</code></pre>\n\n<p><strong>Conditional</strong> parts can use <code>when</code>, <code>unless</code>, etc.</p>\n\n<pre><code>when hasCppDestructor $ do\n    Comment \"We need the destructor\"\n    Function NoReturnType \"~SomeClass\" $ do\n        ...\n</code></pre>\n\n<p><strong>Semantic analysis</strong>, e.g. ensuring correct declaration order, is also possible as was pointed out in the first answer.</p>\n\n<p><strong>Visual clues</strong>: Another thing I like is that in the construct shown above control structures such as if-then-else, <code>forM_</code> etc. start lower-case whereas the AST lines start upper-case.</p>\n\n<h2>Background</h2>\n\n<p>A few words about where this is heading, possibly: The idea is to use a nice enough embedded DSL that allows to automatically define an AST that rather abstractly represents, say, a convoluted FSM that needs to be implemented in C, C++, Python, Java, Go, Rust, Javascript, whatever... A <code>render</code> function like the one above then maps the certifiably correct AST to the target language.</p>\n\n<h2>Updates</h2>\n\n<ul>\n<li>Note that <code>&gt;&gt;</code> does not default to <code>*&gt;</code>, but to <code>m &gt;&gt; k = m &gt;&gt;= (\\_ -&gt; k)</code> !</li>\n</ul>\n"}, {"tags": ["haskell", "job-scheduling"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1515311005, "post_id": 48135197, "comment_id": 83247743, "body": "You may want to post some code - solving this really depends on what you&#39;ve got so far. Glancing at the <code>System.Cron.Schedule</code> docs, it looks like you will likely be doing a fair bit of work in the <code>IO</code> monad (or something that is <code>MonadIO</code>). You could use an <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent-MVar.html#t:MVar\" rel=\"nofollow noreferrer\"><code>MVar</code></a> to prevent a job from starting until the previous has finished."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1515361584, "post_id": 48141774, "comment_id": 83261601, "body": "In real code I would suggest abstracting this functionality into its own unit, e.g. <code>oneAtATime :: MVar () -&gt; IO () -&gt; IO ()</code>"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1515362127, "last_edit_date": 1515362127, "creation_date": 1515361131, "answer_id": 48141774, "question_id": 48135197, "link": "https://stackoverflow.com/questions/48135197/how-to-handle-long-running-jobs-with-system-cron-schedule/48141774#48141774", "title": "How to handle long running jobs with System.Cron.Schedule?", "body": "<p>Here's the implementation of @Alec's suggestion. This creates an <code>MVar ()</code> (which is basically a semaphore), and then every time your job runs, it checks whether the <code>MVar</code> is free before it continues, and dies otherwise.</p>\n\n<pre><code>import Control.Concurrent.MVar\nimport Control.Monad\n\nmain :: IO ()\nmain = do sem &lt;- newMVar () -- starts off not taken\n          tids &lt;- execSchedule $ addJob (doBackup sem) \"* * * * *\" -- do x = x\n          print tids\n          forever $ threadDelay maxBound\n       -- all threads exit when main exits. ^ stops that from happening\n       -- Control.Monad.forever x = let loop = x &gt;&gt; loop in loop\n       -- don't do forever $ return () unless you want a CPU-nomming busyloop\n\n\ndoBackup :: MVar () -&gt; IO ()\ndoBackup sem = do res &lt;- tryTakeMVar sem\n               -- gives Nothing if the sem is taken and Just () if it isn't\n               -- you DON'T want takeMVar, since that'll block until sem is\n               -- free, essentially queueing the jobs up instead of\n               -- canceling the ones that run too early.\n                  case res of\n                       Nothing -&gt; return () -- already taken? do nothing\n                       Just () -&gt; do putStrLn \"Backing up system...\"\n                                     threadDelay 70000000\n                                     putStrLn \"Backup finished\"\n                                     putMVar sem () -- release the lock\n</code></pre>\n\n<p>FYI: this is not exception-safe. See the implementation of <code>withMVar</code> for pointers in that direction.</p>\n"}], "owner": {"reputation": 134, "user_id": 4723146, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ez7Rqkjohw4/AAAAAAAAAAI/AAAAAAAAL2k/CeVaWa8_eXA/photo.jpg?sz=128", "display_name": "Bill Sun", "link": "https://stackoverflow.com/users/4723146/bill-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 48141774, "answer_count": 1, "score": 3, "last_activity_date": 1515362127, "creation_date": 1515310209, "last_edit_date": 1515354170, "question_id": 48135197, "link": "https://stackoverflow.com/questions/48135197/how-to-handle-long-running-jobs-with-system-cron-schedule", "title": "How to handle long running jobs with System.Cron.Schedule?", "body": "<p>I'm trying to learn Haskell.  As a first stab, I'm looking to write a daemon that periodically runs a backup job for me.</p>\n\n<p>I'm using <a href=\"https://hackage.haskell.org/package/cron-0.6.1/docs/System-Cron-Schedule.html\" rel=\"nofollow noreferrer\"><code>System.Cron.Schedule</code></a> to do the scheduling for me and running the <a href=\"https://restic.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\"><code>restic</code></a> executable to do the backup.</p>\n\n<p>As this is a backup job, it can take a log time to run, to prevent the next scheduled backup from running when the previous one hasn't been completed yet, I want to make sure that I can only have 1 instance of the job running.  How do prevent a long running job from being run again?</p>\n\n<p>As an simplified example, how do I make the following not spawn another job every minute until the existing job is done?</p>\n\n<pre><code>main :: IO ()\nmain = do\n       tids &lt;- execSchedule $ do\n           addJob doBackup \"* * * * *\"\n       print tids\n\ndoBackup :: IO ()\ndoBackup = do\n    putStrLn \"Backing up system...\"\n    threadDelay 70000000\n    putStrLn \"Backup finished\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515273080, "post_id": 48131940, "comment_id": 83241019, "body": "Operators have lower precedence than function application. Compare <code>Some</code> with <code>+</code>, what do you expect for <code>id 1 + id 2</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1515273083, "post_id": 48131940, "comment_id": 83241021, "body": "I&#39;d say fixity is immaterial here, since application has higher precedence w.r.t. any infix operation."}, {"owner": {"reputation": 3290, "user_id": 4400065, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/kbo7S.gif?s=128&g=1", "display_name": "Siegmeyer", "link": "https://stackoverflow.com/users/4400065/siegmeyer"}, "edited": false, "score": 0, "creation_date": 1515273200, "post_id": 48131940, "comment_id": 83241053, "body": "So normally value constructor is a function but when I&#39;m using backticks constructor is an operator?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515273267, "post_id": 48131940, "comment_id": 83241068, "body": "@Siegmeyer: whether it is a constructor is irrelevant here. It is a function. If you put a function between backquotes, it acts like an operator (given it is of the type <code>a -&gt; b -&gt; c</code>. If you write <code>&lt;exp1&gt; `f` &lt;exp2&gt;</code>, it is equivalent to <code>f (&lt;exp1&gt;) (&lt;exp2&gt;)</code>."}, {"owner": {"reputation": 3290, "user_id": 4400065, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/kbo7S.gif?s=128&g=1", "display_name": "Siegmeyer", "link": "https://stackoverflow.com/users/4400065/siegmeyer"}, "edited": false, "score": 0, "creation_date": 1515273349, "post_id": 48131940, "comment_id": 83241087, "body": "Ok, gotcha, that clears it up. Thank you."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1515276987, "creation_date": 1515276987, "answer_id": 48132457, "question_id": 48131940, "link": "https://stackoverflow.com/questions/48131940/fixity-of-infix-value-constructors/48132457#48132457", "title": "Fixity of infix value constructors", "body": "<p>A constructor is a function as well: we can use a constructor <code>C</code> as a function that takes the parameters the constructor is going to hold as arguments, and then constructs a new instance of the type. So in your example, Haskell syntactically sees <code>Some</code> like it sees any function.</p>\n\n<p>If you write a function between backquotes (<code>`</code>), then it acts like an <em>operator</em>, like it is written in <a href=\"https://www.haskell.org/onlinereport/exps.html\" rel=\"nofollow noreferrer\"><em>Section 3 of the Haskell '98 report</em></a>:</p>\n\n<blockquote>\n  <p>An operator is either an operator symbol, such as <code>+</code> or <code>$$</code>, or is an <strong>ordinary identifier enclosed in grave accents</strong> (backquotes), such as <code>`op`</code>. For example, instead of writing the prefix application <code>op x y</code>, one can write the infix application <code>x `op` y</code>. <strong>If no fixity declaration is given for <code>`op`</code> then it defaults to highest precedence and left associativity</strong>.</p>\n</blockquote>\n\n<p>The section also describes that function application has priority over operators. We see that an expression <code>exp</code> can be a <code>fexp</code> (an function application expression). The arguments of such function application are <code>aexp</code>s. An <code>aexp</code> <em>can</em> contain an operator (through <code>exp</code>), but only in case it is between brackets (<code>()</code>), square brackets (<code>[]</code>, when we construct a list), etc. But not without a specification of priority. If we write: <code>f a b + g x a</code>, it is thus interpreted as <code>(f a b) + (g x y)</code>, <em>not</em> as <s><code>f a (b+g) x y</code></s>.</p>\n\n<p>Now the only question that is still open is what happens in case the expression contains other operators. In Haskell we assign precedence (and associativty) to operators. This is described in <a href=\"https://www.haskell.org/onlinereport/decls.html\" rel=\"nofollow noreferrer\"><em>Section 4 of the Haskell '98 report</em></a>. All operators are assigned a precedence between <code>0</code> and <code>9</code>. The <code>*</code> operator has for instance higher precedence than <code>+</code>, and that means that <code>2 + 3 * 2</code> is interpreted as <code>2 + (3 * 2)</code>, and not as <s><code>(2 + 3) * 2</code></s>. As is described in the quoted section, if you do <em>not</em> specify the precedence, then it is the highest. So <code>1 + id 2</code>Some<code>id 3 * 5</code> is interpreted as <code>1 + (((id 2) `Some` (id 3)) * 5)</code> (but this makes no sense here, since we can not multiply a <code>Some</code> object with <code>5</code>.</p>\n\n<p>So your expression:</p>\n\n<pre><code>id 1 `Some` id 2\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>Some (id 1) (id 2)\n</code></pre>\n"}], "owner": {"reputation": 3290, "user_id": 4400065, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/kbo7S.gif?s=128&g=1", "display_name": "Siegmeyer", "link": "https://stackoverflow.com/users/4400065/siegmeyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 48132457, "answer_count": 1, "score": 2, "last_activity_date": 1515276987, "creation_date": 1515272963, "question_id": 48131940, "link": "https://stackoverflow.com/questions/48131940/fixity-of-infix-value-constructors", "title": "Fixity of infix value constructors", "body": "<p>Let:</p>\n\n<pre><code>data Some a b = Some a b deriving (Show)\n</code></pre>\n\n<p>Then (in ghci):</p>\n\n<pre><code>&gt; Some (id 1) (id 2)\nSome 1 2\n</code></pre>\n\n<p>But (not surprisingly):</p>\n\n<pre><code>&gt; Some id 1 id 2\nCouldn't match expected type \u2018(a1 -&gt; a1) -&gt; Integer -&gt; t\u2019 ...\n</code></pre>\n\n<p>However:</p>\n\n<pre><code>&gt; id 1 `Some` id 2\nSome 1 2\n</code></pre>\n\n<p>Why is that? Does fixity of infix value constructors defaults to the lowest?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515271814, "post_id": 48131758, "comment_id": 83240644, "body": "Well it is almost equivalent, except that you replace <code>[&#39;a&#39;..&#39;z&#39;]</code> with the top 20 words, like <code>[&quot;a&quot;, &quot;the&quot;, &quot;and&quot;]</code>. And perhaps you need some way to make sure that uppercase and titlecase common words are dropped as well."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515272101, "post_id": 48131758, "comment_id": 83240721, "body": "Not my place, but are trying to simultaneously learn 3+ languages? You may want to narrow your focus. I can&#39;t see spreading your time that thin benefiting you in the long run."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 8849230, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/tjbHz.jpg?s=128&g=1", "display_name": "lylyly", "link": "https://stackoverflow.com/users/8849230/lylyly"}, "edited": false, "score": 0, "creation_date": 1515276322, "post_id": 48131849, "comment_id": 83241824, "body": "can I ask another question, I am trying do countCommonWords to count how many common words for the [&quot;the&quot;,&quot;planet&quot;,&quot;of&quot;,&quot;the&quot;,&quot;apes&quot;] list , I try use  countCommonWords xs  = map(\\w -&gt; (head w) common) $ group $ sort  xs  where common = [&quot;the&quot;, &quot;be&quot;, &quot;to&quot;, &quot;of&quot;, &quot;and&quot;, &quot;a&quot;, &quot;in&quot;, &quot;that&quot;, &quot;have&quot;, &quot;I&quot;, &quot;it&quot;, &quot;for&quot;, &quot;not&quot;, &quot;on&quot;, &quot;with&quot;, &quot;he&quot;, &quot;as&quot;, &quot;you&quot;,&quot;at&quot;,&quot;do&quot;] but here is error shows Variable not in scope: group :: t0 -&gt; [[[[Char]] -&gt; b]] did I miss something ? thank you"}, {"owner": {"reputation": 2613, "user_id": 9156061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69150721b719cef2eb990fc78bc9cc0?s=128&d=identicon&r=PG&f=1", "display_name": "mdatsev", "link": "https://stackoverflow.com/users/9156061/mdatsev"}, "reply_to_user": {"reputation": 91, "user_id": 8849230, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/tjbHz.jpg?s=128&g=1", "display_name": "lylyly", "link": "https://stackoverflow.com/users/8849230/lylyly"}, "edited": false, "score": 0, "creation_date": 1515276894, "post_id": 48131849, "comment_id": 83241948, "body": "<code>dropCommonWords xs = length $ filter (\\x -&gt; x `notElem` common ) xs   where common = [&quot;the&quot;, &quot;be&quot;, &quot;to&quot;, &quot;of&quot;, &quot;and&quot;, &quot;a&quot;, &quot;in&quot;, &quot;that&quot;, &quot;have&quot;, &quot;I&quot;, &quot;it&quot;, &quot;for&quot;, &quot;not&quot;, &quot;on&quot;, &quot;with&quot;, &quot;he&quot;, &quot;as&quot;, &quot;you&quot;, &quot;do&quot;, &quot;at&quot;]</code>"}], "tags": [], "owner": {"reputation": 2613, "user_id": 9156061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69150721b719cef2eb990fc78bc9cc0?s=128&d=identicon&r=PG&f=1", "display_name": "mdatsev", "link": "https://stackoverflow.com/users/9156061/mdatsev"}, "is_accepted": true, "score": 2, "last_activity_date": 1515272253, "creation_date": 1515272253, "answer_id": 48131849, "question_id": 48131758, "link": "https://stackoverflow.com/questions/48131758/haskell-how-to-get-the-common-words/48131849#48131849", "title": "Haskell: how to get the common words", "body": "<p>You will need a list of the common words and then you filter those which are not element of that list:</p>\n\n<pre><code>dropCommonWords xs = filter (\\x -&gt; x `notElem` common ) xs\n  where common = [\"the\", \"be\", \"to\", \"of\", \"and\", \"a\", \"in\", \"that\", \"have\", \"I\", \"it\", \"for\", \"not\", \"on\", \"with\", \"he\", \"as\", \"you\", \"do\", \"at\"]\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Prelude&gt; dropCommonWords [\"the\",\"planet\",\"of\",\"the\",\"apes\"]\n[\"planet\",\"apes\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 0, "last_activity_date": 1515294429, "last_edit_date": 1515294429, "creation_date": 1515294106, "answer_id": 48133968, "question_id": 48131758, "link": "https://stackoverflow.com/questions/48131758/haskell-how-to-get-the-common-words/48133968#48133968", "title": "Haskell: how to get the common words", "body": "<p>You can also use basic recursion for this:</p>\n\n<pre><code>import Data.Char\n\ndropCommonWords :: [String] -&gt; [String]\ndropCommonWords [] = []\ndropCommonWords (x:xs)\n    | map toLower x `notElem` commonWords = x : dropCommonWords xs\n    | otherwise = dropCommonWords xs\n    where commonWords = [\"the\", \"be\", \"to\", \"of\", \"and\", \"a\", \"in\", \"that\", \"have\", \"I\", \"it\", \"for\", \"not\", \"on\", \"with\", \"he\", \"as\", \"you\", \"do\", \"at\"]\n</code></pre>\n\n<p>Which also converts every word to lowercase before hand with <code>map toLower x</code>, since you could get strings such as <code>\"THE\"</code>, and that counts as a common word, just a different case. </p>\n\n<p>Here is the behavior of the above code:</p>\n\n<pre><code>*Main&gt; dropCommonWords [\"the\",\"planet\",\"of\",\"the\",\"apes\"]\n[\"planet\",\"apes\"]\n*Main&gt; dropCommonWords [\"THE\",\"planet\",\"of\",\"the\",\"apes\"]\n[\"planet\",\"apes\"]\n</code></pre>\n\n<p><strong>Note:</strong> Using <code>filter</code> is better here, I didn't post it since the above answer already mentioned it. </p>\n"}], "owner": {"reputation": 91, "user_id": 8849230, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/tjbHz.jpg?s=128&g=1", "display_name": "lylyly", "link": "https://stackoverflow.com/users/8849230/lylyly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 48131849, "answer_count": 2, "score": 0, "last_activity_date": 1515294429, "creation_date": 1515271665, "last_edit_date": 1515271724, "question_id": 48131758, "link": "https://stackoverflow.com/questions/48131758/haskell-how-to-get-the-common-words", "title": "Haskell: how to get the common words", "body": "<p>I am trying to do drop common words function, but I do not know how to get or find the common word list. Do I need to create a common words list? Thank you  </p>\n\n<p>The question : </p>\n\n<pre><code>Takes a list of strings and drops any word that is within the top 20  \nmost commonly used in English. Returns a list of strings without those words.\n</code></pre>\n\n<p>the result like :</p>\n\n<pre><code>dropCommonWords [\"the\",\"planet\",\"of\",\"the\",\"apes\"]\n[\"planet\",\"apes\"]\n</code></pre>\n\n<p>here my dropletters code</p>\n\n<pre><code>dropletters xs = filter (\\x -&gt; x `elem` ['a'..'z'] ) xs\n</code></pre>\n"}, {"tags": ["haskell", "pointfree", "tacit-programming"], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": false, "score": 5, "last_activity_date": 1515265591, "creation_date": 1515265591, "answer_id": 48130851, "question_id": 48130799, "link": "https://stackoverflow.com/questions/48130799/how-to-rewrite-in-point-free-style-with-a-repeating-variable/48130851#48130851", "title": "How to rewrite in point-free style with a repeating variable?", "body": "<p>If you go to <a href=\"http://pointfree.io/\" rel=\"noreferrer\">http://pointfree.io/</a></p>\n\n<p>For</p>\n\n<pre><code>p x y = x*x + y\n</code></pre>\n\n<p>It gives you</p>\n\n<pre><code>p = (+) . join (*)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": false, "score": 10, "last_activity_date": 1515265684, "creation_date": 1515265684, "answer_id": 48130867, "question_id": 48130799, "link": "https://stackoverflow.com/questions/48130799/how-to-rewrite-in-point-free-style-with-a-repeating-variable/48130867#48130867", "title": "How to rewrite in point-free style with a repeating variable?", "body": "<p>I asked <code>lambdabot</code></p>\n\n<pre><code>&lt;Iceland_jack&gt; @pl p x y = x*x + y\n&lt;lambdabot&gt; p = (+) . join (*)\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:join\" rel=\"noreferrer\"><code>join</code></a> is from <code>Control.Monad</code> and normally has this type</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>but using <code>instance Monad ((-&gt;) x)</code> (if we could <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12477\" rel=\"noreferrer\">left section types</a> this could be written <code>(x -&gt;)</code>) we get the following type / definition</p>\n\n<pre><code>join :: (x -&gt; x -&gt; a) -&gt; (x -&gt; a)\njoin f x = f x x\n</code></pre>\n\n<p>Let's ask <em>GHCi</em> to confirm the type:</p>\n\n<pre><code>&gt;&gt; import Control.Monad\n&gt;&gt; :set -XTypeApplications \n&gt;&gt; :t join @((-&gt;) _)\njoin @((-&gt;) _) :: (x -&gt; x -&gt; a) -&gt; x -&gt; a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1515272681, "creation_date": 1515272681, "answer_id": 48131903, "question_id": 48130799, "link": "https://stackoverflow.com/questions/48130799/how-to-rewrite-in-point-free-style-with-a-repeating-variable/48131903#48131903", "title": "How to rewrite in point-free style with a repeating variable?", "body": "<p>Just for fun, you can use the <code>State</code> monad to write</p>\n\n<pre><code>p = (+) . uncurry (*) . runState get\n</code></pre>\n\n<p><code>runState get</code> simply produces a pair <code>(x, x)</code> from an initial <code>x</code>; <code>get</code> copies the state to the result, and <code>runState</code> returns both the state and that result.</p>\n\n<p><code>uncurry (*)</code> takes a pair of values rather than 2 separate values (<code>(uncurry (*)) (3, 3) == (*) 3 3 == 9</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 6, "last_activity_date": 1515290275, "creation_date": 1515290275, "answer_id": 48133689, "question_id": 48130799, "link": "https://stackoverflow.com/questions/48130799/how-to-rewrite-in-point-free-style-with-a-repeating-variable/48133689#48133689", "title": "How to rewrite in point-free style with a repeating variable?", "body": "<p>Since you mentioned Lambda Calculus I will suggest how to solve this with SK combinators. \u03b7-reduction was a good try, but as you can tell you can't \u03b7-reduce when the variable is used twice.</p>\n\n<pre><code>S = \u03bbfgx.fx(gx)\nK = \u03bbxy.x\n</code></pre>\n\n<p>The feature of duplication is encoded by <code>S</code>. You simplified your problem to:</p>\n\n<pre><code>\u03bbx.(+)((*)xx)\n</code></pre>\n\n<p>So let us start there. <a href=\"https://en.wikipedia.org/wiki/Combinatory_logic#Completeness_of_the_S-K_basis\" rel=\"noreferrer\">Any lambda term can be algorithmically transformed to a SK term</a>.</p>\n\n<pre><code>T[\u03bbx.(+)((*)xx)]\n= S(T[\u03bbx.(+)])(T[\u03bbx.(*)xx])        -- rule 6\n= S(K(T[(+)]))(T[\u03bbx.(*)xx])        -- rule 3\n= S(K(+))(T[\u03bbx.(*)xx])             -- rule 1\n= S(K(+))(S(T[\u03bbx.(*)x])(T[\u03bbx.x]))  -- rule 6\n= S(K(+))(S(*)(T[\u03bbx.x]))           -- \u03b7-reduce\n= S(K(+))(S(*)I)                   -- rule 4\n</code></pre>\n\n<p>In Haskell, <code>S = (&lt;*&gt;)</code> and <code>K = pure</code> and <code>I = id</code>. Therefore:</p>\n\n<pre><code>= (&lt;*&gt;)(pure(+))((&lt;*&gt;)(*)id)\n</code></pre>\n\n<p>And rewriting:</p>\n\n<pre><code>= pure (+) &lt;*&gt; ((*) &lt;*&gt; id)\n</code></pre>\n\n<p>Then we can apply other definitions we know:</p>\n\n<pre><code>= fmap (+) ((*) &lt;*&gt; id)     -- pure f &lt;*&gt; x = fmap f x\n= fmap (+) (join (*))       -- (&lt;*&gt; id) = join for Monad ((-&gt;)a)\n= (+) . join (*)            -- fmap = (.) for Functor ((-&gt;)a)\n</code></pre>\n"}], "owner": {"reputation": 709, "user_id": 7143310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xrMna.jpg?s=128&g=1", "display_name": "Jader Martins", "link": "https://stackoverflow.com/users/7143310/jader-martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 48133689, "answer_count": 4, "score": 3, "last_activity_date": 1515290275, "creation_date": 1515265254, "question_id": 48130799, "link": "https://stackoverflow.com/questions/48130799/how-to-rewrite-in-point-free-style-with-a-repeating-variable", "title": "How to rewrite in point-free style with a repeating variable?", "body": "<p>How to rewrite the following expression in point-free style?</p>\n\n<pre><code>p x y = x*x + y\n</code></pre>\n\n<p>Using the lambda-calculus I did the following:</p>\n\n<pre><code>p = \\x -&gt; \\y -&gt; (+) ((*) x x) y\n  = \\x -&gt; (+) ((*) x x) -- here start my problem\n  = \\x -&gt; ((+) . ((*) x )) x\n  ... ?\n</code></pre>\n"}, {"tags": ["list", "haskell", "infinite", "list-manipulation"], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 19, "last_activity_date": 1515261893, "last_edit_date": 1515261893, "creation_date": 1515260049, "answer_id": 48129995, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48129995#48129995", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>This seems like the kind of thing that comprehensions are made for:</p>\n\n<pre><code>solution = 0 : [y | x &lt;- [1..], y &lt;- [x, -x]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 4, "last_activity_date": 1515260058, "creation_date": 1515260058, "answer_id": 48129997, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48129997#48129997", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>How about</p>\n\n<pre><code>concat (zipWith (\\x y -&gt; [x, y]) [0, -1 ..] [1 ..])\n</code></pre>\n\n<p>or</p>\n\n<pre><code>concat (transpose [[0, -1 ..], [1 ..]])\n</code></pre>\n\n<p>?</p>\n"}, {"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1515260315, "post_id": 48129999, "comment_id": 83236871, "body": "<code>iterate (\\i -&gt; fromEnum (i &lt; 1) - i)</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1515260834, "post_id": 48129999, "comment_id": 83237035, "body": "Isn&#39;t <code>flip (-)</code> <code>subtract</code>?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1515261472, "post_id": 48129999, "comment_id": 83237296, "body": "Excellent use of Applicative!"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1515264195, "post_id": 48129999, "comment_id": 83238171, "body": "You also wouldn&#39;t need to import <code>Control.Applicative</code> if you used <code>&lt;*&gt;</code> instead of the flipped argument version."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1515264245, "post_id": 48129999, "comment_id": 83238183, "body": "You need to flipped version so that <code>id</code> and <code>negate</code> alternate; <code>[id, negate] &lt;*&gt; [1..]</code> applies <code>id</code> to every element of the other list, then applies <code>negate</code> to the same. Since the second list is infinite, you never get the negative numbers. (More briefly, <code>&lt;**&gt;</code> is not just <code>flip &lt;*&gt;</code>.)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 12, "last_activity_date": 1515334472, "last_edit_date": 1515334472, "creation_date": 1515260062, "answer_id": 48129999, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48129999#48129999", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<h1>With <code>iterate</code></h1>\n\n<p>Perhaps a more elegant way to do this, is by using <a href=\"https://www.haskell.org/hoogle/?hoogle=iterate\" rel=\"nofollow noreferrer\"><strong><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]</code></strong></a> with a function that generates each time the next item. For instance:</p>\n\n<pre><code>solution = iterate nxt 0\n    where nxt i | i &gt; 0 = -i\n                | otherwise = 1-i\n</code></pre>\n\n<p>Or we can inline this with an <code>if</code>-<code>then</code>-<code>else</code>:</p>\n\n<pre><code>solution = iterate (\\i -&gt; if i &gt; 0 then -i else 1-i) 0\n</code></pre>\n\n<p>Or we can convert the boolean to an integer, like @melpomene says, with <code>fromEnum</code>, and then use this to add <code>1</code> or <code>0</code> to the answer, so:</p>\n\n<pre><code>solution = iterate (\\i -&gt; fromEnum (i &lt; 1)-i) 0\n</code></pre>\n\n<p>Which is more pointfree:</p>\n\n<pre><code>import Control.Monad(ap)\n\nsolution = iterate (ap subtract (fromEnum . (&lt; 1))) 0\n</code></pre>\n\n<h1>With <code>(&lt;**&gt;)</code></h1>\n\n<p>We can also use the <code>&lt;**&gt;</code> operator from applicate to produce each time the positive and negative variant of a number, like:</p>\n\n<pre><code>import Control.Applicative((&lt;**&gt;))\n\nsolution = 0 : ([1..] &lt;**&gt; [id, negate])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 5, "creation_date": 1515261359, "post_id": 48130082, "comment_id": 83237242, "body": "<code>nub</code> is going to give you quadratic runtime and leak memory. It has to hold onto all of the earlier elements to check whether they have already occurred."}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1515269916, "post_id": 48130082, "comment_id": 83240008, "body": "Right. I confused what <code>nub</code> does; I meant to remove only consecutive duplicates. And the reason I&#39;d favor that was a semantic one."}], "tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 4, "last_activity_date": 1515260615, "creation_date": 1515260615, "answer_id": 48130082, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48130082#48130082", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>How about:</p>\n\n<pre><code>tail $ [0..] &gt;&gt;= \\x -&gt; [x, -x]\n</code></pre>\n\n<p>On a moment's reflection, using <code>nub</code> instead of <code>tail</code> would be more elegant in my opinion.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 2, "last_activity_date": 1515263377, "last_edit_date": 1515263377, "creation_date": 1515261907, "answer_id": 48130282, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48130282#48130282", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>You could also use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow noreferrer\"><code>concatMap</code></a> instead of <code>foldr</code> here, and replace <code>map negate [1..]</code> with <code>[0, -1..]</code>:</p>\n\n<pre><code>solution = concatMap (\\(a, b) -&gt; [a, b]) $ zip [0, -1..] [1..]\n</code></pre>\n\n<p>If you want to use <code>negate</code> instead, then this is another option:</p>\n\n<pre><code>solution = concatMap (\\(a, b) -&gt; [a, b]) $ (zip . map negate) [0, 1..] [1..]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 4, "last_activity_date": 1515295023, "creation_date": 1515295023, "answer_id": 48134034, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48134034#48134034", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>another primitive solution</p>\n\n<pre><code>alt = 0 : go 1\n  where go n = n : -n : go (n+1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 0, "last_activity_date": 1515334907, "creation_date": 1515334907, "answer_id": 48138054, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48138054#48138054", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>Late to the party but this will do it as well</p>\n\n<pre><code>solution = [ (1 - 2 * (n `mod` 2)) * (n `div` 2) | n &lt;- [1 .. ] ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 1, "last_activity_date": 1515383066, "creation_date": 1515383066, "answer_id": 48143958, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell/48143958#48143958", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>Just because no one said it:</p>\n\n<pre><code>0 : concatMap (\\x -&gt; [x,-x]) [1..]\n</code></pre>\n"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1067, "favorite_count": 3, "accepted_answer_id": 48129995, "answer_count": 8, "score": 6, "last_activity_date": 1515383066, "creation_date": 1515259613, "question_id": 48129923, "link": "https://stackoverflow.com/questions/48129923/produce-the-infinite-list-0-1-1-2-2-in-haskell", "title": "Produce the infinite list [0, 1, -1, 2, -2, ... in Haskell", "body": "<p>So suppose we want to produce the list <code>[0, 1, -1, 2, -2, ...</code>in Haskell.</p>\n\n<p>What is the most elegant way of accomplishing this?</p>\n\n<p>I came up with this solution:</p>\n\n<pre><code>solution = [0] ++ foldr (\\(a,b) c-&gt;a:b:c) [] zip [1..] $ map negate [1..]\n</code></pre>\n\n<p>But I am sure there must be a better way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1515258689, "post_id": 48129777, "comment_id": 83236270, "body": "<code>words</code> expects a single string, not a list of strings. Are you sure you need <code>words</code> at all? The input seems to be already split into words."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1515258898, "creation_date": 1515258898, "answer_id": 48129821, "question_id": 48129777, "link": "https://stackoverflow.com/questions/48129777/haskell-how-to-count-words/48129821#48129821", "title": "Haskell : how to count words", "body": "<p>As @chi said - <code>words :: String -&gt; [String]</code>  so either change the input type for your function to a single string of words separated by whitespace, or omit the <code>words</code> part, i.e.</p>\n\n<pre><code>countWords :: [String] -&gt; [(String,Int)]\ncountWords xs = map (\\w -&gt; (head w, length w)) $ group $ sort xs\n</code></pre>\n\n<p>an example usage for this:</p>\n\n<pre><code>Prelude Data.List&gt; countWords [\"hello\", \"hello\", \"world\"]\n&gt; [(\"hello\",2),(\"world\",1)]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>countWords :: String -&gt; [(String,Int)]\ncountWords xs = map (\\w -&gt; (head w, length w)) $ group $ sort $ words xs\n</code></pre>\n\n<p>an example usage:</p>\n\n<pre><code>Prelude Data.List&gt; countWords \"hello hello world\"\n&gt; [(\"hello\",2),(\"world\",1)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 2, "last_activity_date": 1515259097, "creation_date": 1515259097, "answer_id": 48129851, "question_id": 48129777, "link": "https://stackoverflow.com/questions/48129777/haskell-how-to-count-words/48129851#48129851", "title": "Haskell : how to count words", "body": "<p>Let's break this down to a simpler example:</p>\n\n<pre><code>Prelude&gt; xs = [\"hello\", \"hello\", \"world\"]\nPrelude&gt; words xs\n\n&lt;interactive&gt;:2:7: error:\n    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n      Expected type: String\n        Actual type: [[Char]]\n    \u2022 In the first argument of \u2018words\u2019, namely \u2018xs\u2019\n      In the expression: words xs\n      In an equation for \u2018it\u2019: it = words xs\n</code></pre>\n\n<p>As you can see, we get a type error at the application of <code>words</code>. Further investigation shows us the problem:</p>\n\n<pre><code>Prelude&gt; :t words\nwords :: String -&gt; [String]\nPrelude&gt; :t xs\nxs :: [[Char]]\n</code></pre>\n\n<p>Here we see the types for <code>words</code> and <code>xs</code>. First, <code>words</code> expects a <code>String</code> as its argument. However, <code>xs</code> type is <code>[[Char]]</code>. Since <code>[Char]</code> is the same as <code>String</code>, <code>xs</code> type can also be given as <code>[String]</code>.</p>\n\n<p>Now we see the problem. You are passing a <code>[String]</code> (a list of <code>String</code>s) to a function which expects a single <code>String</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 8849230, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/tjbHz.jpg?s=128&g=1", "display_name": "lylyly", "link": "https://stackoverflow.com/users/8849230/lylyly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1776, "favorite_count": 2, "accepted_answer_id": 48129821, "answer_count": 2, "score": 1, "last_activity_date": 1515259097, "creation_date": 1515258600, "question_id": 48129777, "link": "https://stackoverflow.com/questions/48129777/haskell-how-to-count-words", "title": "Haskell : how to count words", "body": "<p>I am new Haskell learner, and trying to do count words, but there are errors.   how can i change to code and show the result like this</p>\n\n<pre><code>countWords [\"friend\",\"she\",\"she\"] \n &gt;[(\"friend\",1),(\"she\",2)\n</code></pre>\n\n<p>here is code</p>\n\n<pre><code>Prelude Data.List&gt; countWords xs = map(\\w -&gt; (head w, length w)) \n $group $ sort $ words xs\nPrelude Data.List&gt; countWords [\"hello\", \"hello\", \"world\"]\n</code></pre>\n\n<p>:101:13: error:\n    \u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the expression: \"hello\"\n      In the first argument of \u2018countWords\u2019, namely\n        \u2018[\"hello\", \"hello\", \"world\"]\u2019\n      In the expression: countWords [\"hello\", \"hello\", \"world\"]</p>\n\n<p>:101:22: error:\n    \u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the expression: \"hello\"\n      In the first argument of \u2018countWords\u2019, namely\n        \u2018[\"hello\", \"hello\", \"world\"]\u2019\n      In the expression: countWords [\"hello\", \"hello\", \"world\"]</p>\n\n<p>:101:31: error:\n    \u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the expression: \"world\"\n      In the first argument of \u2018countWords\u2019, namely\n        \u2018[\"hello\", \"hello\", \"world\"]\u2019\n      In the expression: countWords [\"hello\", \"hello\", \"world\"]</p>\n\n<p>Thank you </p>\n"}, {"tags": ["haskell", "coq", "agda", "idris", "dependent-type"], "comments": [{"owner": {"reputation": 52016, "user_id": 373025, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1916b08af2d329d0fe74b7fb9412369b?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre C.", "link": "https://stackoverflow.com/users/373025/alexandre-c"}, "edited": false, "score": 4, "creation_date": 1515253300, "post_id": 48128884, "comment_id": 83234515, "body": "<a href=\"https://stackoverflow.com/questions/292274/what-is-an-existential-type\" title=\"what is an existential type\">stackoverflow.com/questions/292274/what-is-an-existential-ty&zwnj;&#8203;pe</a>"}, {"owner": {"reputation": 944, "user_id": 1518588, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0dc57ef6856b371529d1db038cb2f358?s=128&d=identicon&r=PG", "display_name": "LP_", "link": "https://stackoverflow.com/users/1518588/lp"}, "edited": false, "score": 0, "creation_date": 1515350339, "post_id": 48128884, "comment_id": 83258450, "body": "@luochen1990 you are thinking of compile-time code execution, which many non-dependently-typed languages have, such as C++ and D, and which indeed cannot do what you describe. Think about a dependent type system as being able to reason about parametrized operations in the abstract, without necessarily executing them (which requires providing a concrete argument)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 45, "last_activity_date": 1515288161, "last_edit_date": 1515288161, "creation_date": 1515255227, "answer_id": 48129243, "question_id": 48128884, "link": "https://stackoverflow.com/questions/48128884/how-do-we-overcome-the-compile-time-and-runtime-gap-when-programming-in-a-depend/48129243#48129243", "title": "How do we overcome the compile time and runtime gap when programming in a Dependently Typed Language?", "body": "<p>Suppose we input <code>n :: Int</code> at runtime form STDIN. We then read <code>n</code> strings, and store them into <code>vn :: Vect n String</code> (pretend for the moment this can be done).\nSimilarly, we can read <code>m :: Int</code> and <code>vm :: Vect m String</code>. Finally, we concatenate the two vectors: <code>vn ++ vm</code> (simplifying a bit here). This can be type checked, and will have type <code>Vect (n+m) String</code>.</p>\n\n<p>Now it is true that the type checker runs at compile time, before the values <code>n,m</code> are known, and also before <code>vn,vm</code> are known. But this does not matter: we can still reason <em>symbolically</em> on the unknowns <code>n,m</code> and argue that <code>vn ++ vm</code> has that type, involving <code>n+m</code>, even if we do not yet know what <code>n+m</code> actually is.</p>\n\n<p>It is not that different from doing math, where we manipulate symbolic expressions involving unknown variables according to some rules, even if we do not know the values of the variables. We don't need to know what number is <code>n</code> to see that <code>n+n = 2*n</code>.</p>\n\n<p>Similarly, the type checker can type check</p>\n\n<pre><code>-- pseudocode\nreadNStrings :: (n :: Int) -&gt; IO (Vect n String)\nreadNStrings O     = return Vect.empty\nreadNStrings (S p) = do\n   s &lt;- getLine\n   vp &lt;- readNStrings p\n   return (Vect.cons s vp)\n</code></pre>\n\n<p>(Well, actually some more help from the programmer could be needed to typecheck this, since it involves dependent matching and recursion. But I'll neglect this.)</p>\n\n<p>Importantly, the type checker can check that without knowing what <code>n</code> is.</p>\n\n<p>Note that the same issue actually already arises with polymorphic functions.</p>\n\n<pre><code>fst :: forall a b. (a, b) -&gt; a\nfst (x, y) = x\n\ntest1 = fst @ Int @ Float (2, 3.5)\ntest2 = fst @ String @ Bool (\"hi!\", True)\n...\n</code></pre>\n\n<p>One might wonder \"how can the typechecker check <code>fst</code> without knowing what types <code>a</code> and <code>b</code> will be at runtime?\". Again, by reasoning symbolically.</p>\n\n<p>With type arguments this is arguably more obvious since we usually run the programs after type erasure, unlike value parameters like our <code>n :: Int</code> above, which can not be erased. Still, there is some similarity between universally quantifying over types or over <code>Int</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5355, "user_id": 377022, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c11c7cc23517cf5f043b51fc7914049a?s=128&d=identicon&r=PG", "display_name": "Jason Gross", "link": "https://stackoverflow.com/users/377022/jason-gross"}, "is_accepted": false, "score": 4, "last_activity_date": 1515753119, "last_edit_date": 1515753119, "creation_date": 1515745703, "answer_id": 48222248, "question_id": 48128884, "link": "https://stackoverflow.com/questions/48128884/how-do-we-overcome-the-compile-time-and-runtime-gap-when-programming-in-a-depend/48222248#48222248", "title": "How do we overcome the compile time and runtime gap when programming in a Dependently Typed Language?", "body": "<p>It seems to me that there are two questions here:</p>\n\n<ol>\n<li><p>Given that some values are unknown during compile-time (e.g., values read from STDIN), how can we make use of them in types? (Note that <a href=\"https://stackoverflow.com/a/48129243/377022\">chi has already given an excellent answer to this</a>.)</p></li>\n<li><p>Some operations (e.g., <code>getLine</code>) seem to make absolutely no sense at compile-time; how could we possibly talk about them in types?</p></li>\n</ol>\n\n<p>The answer to (1), as chi has said, is symbolic or abstract reasoning.  You can read in a number <code>n</code>, and then have a procedure that builds a <code>Vect n Nat</code> by reading from the command line <code>n</code> times, making use of arithmetic properties such as the fact that <code>1+(n-1) = n</code> for nonzero natural numbers.</p>\n\n<p>The answer to (2) is a bit more subtle.  Naively, you might want to say \"this function returns a vector of length <code>n</code>, where <code>n</code> is read from the command line\".  There are two types you might try to give this (apologies if I'm getting Haskell notation wrong)</p>\n\n<pre><code>unsafePerformIO (do n &lt;- getLine; return (IO (Vect (read n :: Int) Nat)))\n</code></pre>\n\n<p>or (in pseudo-Coq notation, since I'm not sure what Haskell's notation for existential types is)</p>\n\n<pre><code>IO (exists n, Vect n Nat)\n</code></pre>\n\n<p>These two types can actually both be made sense of, and say different things.  The first type, to me, says \"at compile time, read <code>n</code> from the command line, and return a function which, at runtime, gives a vector of length <code>n</code> by performing IO\".  The second type says \"at runtime, perform IO to get a natural number <code>n</code> and a vector of length <code>n</code>\".</p>\n\n<p>The way I like looking at this is that all side effects (other than, perhaps, non-termination) are monad transformers, and there is only one monad: the \"real-world\" monad.  Monad transformers work just as well at the type level as at the term level; the one thing which is special is <code>run :: M a -&gt; a</code> which executes the monad (or stack of monad transformers) in the \"real world\".  There are two points in time at which you can invoke <code>run</code>: one is at compile time, where you invoke any instance of <code>run</code> which shows up at the type level.  Another is at runtime, where you invoke any instance of <code>run</code> which shows up at the value level.  Note that <code>run</code> only makes sense if you specify an evaluation order; if your language does not specify whether it is call-by-value or call-by-name (or call-by-push-value or call-by-need or call-by-something-else), you can get incoherencies when you try to compute a type.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1782, "favorite_count": 6, "answer_count": 2, "score": 38, "last_activity_date": 1515753119, "creation_date": 1515253019, "question_id": 48128884, "link": "https://stackoverflow.com/questions/48128884/how-do-we-overcome-the-compile-time-and-runtime-gap-when-programming-in-a-depend", "title": "How do we overcome the compile time and runtime gap when programming in a Dependently Typed Language?", "body": "<p>I'm told that in dependent type system, \"types\" and \"values\" is mixed, and we can treat both of them as \"terms\" instead.</p>\n\n<p>But there is something I can't understand: in a strongly typed programming language without Dependent Type (like Haskell), Types is decided (infered or checked) at <strong>compile time</strong>, but values is decided (computed or inputed) at <strong>runtime</strong>.</p>\n\n<p>I think there must be a gap between these two stages. Just think that if a value is interactively read from STDIN, how can we reference this value in a type which must be decided AOT?</p>\n\n<p>e.g. There is a natural number <code>n</code> and a list of natural number <code>xs</code> (which contains n elements) which I need to read from STDIN, how can I put them into a data structure <code>Vect n Nat</code>?</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1515250395, "post_id": 48128416, "comment_id": 83233686, "body": "do you mean sthg like <code>selectList (UserId &lt;-. [1..3]) []</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1516260515, "post_id": 48128776, "comment_id": 83617160, "body": "I got it working but I had to change it to <code>selectList [UserId &lt;-. users] []</code> where users is of the type [UserId]. If you could edit the answer to that I will accept it."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 0, "creation_date": 1516261306, "post_id": 48128776, "comment_id": 83617491, "body": "@qwertie fixed it, sorry for the typo"}, {"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1516270324, "post_id": 48128776, "comment_id": 83622798, "body": "It also can&#39;t be a list of ints, has to be a list of UserId or whatever type was created for the model ID."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1516261221, "last_edit_date": 1516261221, "creation_date": 1515252215, "answer_id": 48128776, "question_id": 48128416, "link": "https://stackoverflow.com/questions/48128416/select-list-from-list-of-ids-using-persistent/48128776#48128776", "title": "Select list from list of IDs using persistent", "body": "<p>Persistent has several combinators for creating queries the one you are looking for is <a href=\"https://www.stackage.org/haddock/lts-10.2/persistent-2.7.1/Database-Persist.html#v:-60--45-.\" rel=\"nofollow noreferrer\"><code>(&lt;-.) :: PersistField typ =&gt; EntityField v typ -&gt; [typ] -&gt; Filter v</code></a>.</p>\n\n<p>Then your query can be simplified to</p>\n\n<pre><code>selectList [UserId &lt;-. [1..3]] []\n</code></pre>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1516261221, "creation_date": 1515249422, "question_id": 48128416, "link": "https://stackoverflow.com/questions/48128416/select-list-from-list-of-ids-using-persistent", "title": "Select list from list of IDs using persistent", "body": "<p>In my application I need to be able to write a query that takes a list of IDs and returns a list of each of those records.</p>\n\n<p>From what I can tell from the <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">yesod persistent page</a> I could do something like </p>\n\n<pre><code>selectList (UserId ==. 1 ||. UserId ==. 2 ||. UserId ==. 3) []\n</code></pre>\n\n<p>Which I believe would return a list containing user 1, 2 and 3 but I can't work out how I would write this query when I don't know the list or how long it will be at compile time.</p>\n\n<p>How would I go about selecting a list of records using a list of IDs in Haskell persistent. </p>\n"}, {"tags": ["haskell", "cloud-haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1515241953, "post_id": 48126358, "comment_id": 83231316, "body": "I think you&#39;ll get a definitive answer if you <a href=\"https://github.com/haskell-distributed/distributed-static/issues/new\" rel=\"nofollow noreferrer\">ask</a> the <a href=\"https://github.com/haskell-distributed/distributed-static/graphs/contributors\" rel=\"nofollow noreferrer\">authors</a>."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1515244217, "post_id": 48126358, "comment_id": 83231930, "body": "@Zeta, I did: <a href=\"https://github.com/haskell-distributed/distributed-static/issues/18\" rel=\"nofollow noreferrer\">github.com/haskell-distributed/distributed-static/issues/18</a>"}], "answers": [{"tags": [], "owner": {"reputation": 302, "user_id": 376654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45c2b504203472a566242c28ea847672?s=128&d=identicon&r=PG", "display_name": "qnikst", "link": "https://stackoverflow.com/users/376654/qnikst"}, "is_accepted": true, "score": 1, "last_activity_date": 1515452449, "creation_date": 1515452449, "answer_id": 48159272, "question_id": 48126358, "link": "https://stackoverflow.com/questions/48126358/why-remote-tables-and-staticlabels-are-still-used-in-cloudhaskell/48159272#48159272", "title": "Why remote tables and StaticLabels are still used in CloudHaskell?", "body": "<p>One of the main reasons for doing that is that we had to have backwards compatibility and support 3 major versions of GHC. It was also not obvious if we want to jump in the static-pointers solution straight away. As for example their \"stability\" weaker. Basically the only guarantee is that for the same version of compiler, libraries and the same source-code - static-pointers will be compiled to the same value. Actually distributed-process was defined with that in mind, but some people want to have more stable pointers and static labels gives that as you can define your own rules for the label and have the same label even across the different executables.</p>\n\n<p>If guarantees of the static pointers is enough for you, then there is <a href=\"https://hackage.haskell.org/package/distributed-closure\" rel=\"nofollow noreferrer\" title=\"distributed-closure\">distributed-closure</a> package, that provides a static-pointers based functions referencing. With this package you don't need to use remotetable at all and leave that only for the distributed-process internals and backward compatibility.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "accepted_answer_id": 48159272, "answer_count": 1, "score": 5, "last_activity_date": 1515452449, "creation_date": 1515233823, "question_id": 48126358, "link": "https://stackoverflow.com/questions/48126358/why-remote-tables-and-staticlabels-are-still-used-in-cloudhaskell", "title": "Why remote tables and StaticLabels are still used in CloudHaskell?", "body": "<p>I'm reading the source code of <code>distributed-process</code> and related packages.\nIn <code>distributed-static</code> we have the definition of <code>StaticLabel</code>:</p>\n\n<pre><code>data StaticLabel =\n    StaticLabel String\n  | StaticApply !StaticLabel !StaticLabel\n  | StaticPtr SDynamic\n  deriving (Eq, Ord, Typeable, Show)\n</code></pre>\n\n<p>Which is then used to define <code>Static</code> as a newtype wrapper around\n<code>StaticLabel</code> with a phantom variable attached for type safety:</p>\n\n<pre><code>newtype Static a = Static StaticLabel\n  deriving (Eq, Ord, Typeable, Show)\n</code></pre>\n\n<p>I have no questions about <code>StaticApply</code>, it just lumps together two static\nvalues. However, <code>StaticLabel</code> and <code>StaticPtr</code> seem to achieve the same goal\nin different ways.</p>\n\n<p>If we go with <code>StaticLabel</code> we just have/transimt a <code>String</code> label which\nthen can be used to lookup a <code>Dynamic</code> value from <code>RemoteTable</code>:</p>\n\n<pre><code>newtype RemoteTable = RemoteTable (Map String Dynamic)\n</code></pre>\n\n<p>Where <code>Dynamic</code> is (defined in <code>rank1dynamic</code>):</p>\n\n<pre><code>data Dynamic = Dynamic TypeRep GHC.Any\n</code></pre>\n\n<p>Which is almost the same as <code>SDynamic</code> contained in <code>StaticPtr</code>:</p>\n\n<pre><code>data SDynamic = SDynamic TypeRep (StaticPtr GHC.Any)\n</code></pre>\n\n<p>The difference being, with <code>Dynamic</code> we have <code>GHC.Any</code> without indirection,\nwith <code>SDynamic</code> we must lookup the value. The result is the same: we receive\nthat <code>Any</code> value which we can <code>unsafeCoerce</code> if the target <code>TypeRep</code> is\n<a href=\"https://hackage.haskell.org/package/rank1dynamic-0.4.0/docs/Data-Rank1Typeable.html#v:isInstanceOf\" rel=\"noreferrer\"><code>instanceOf</code></a>\nof the <code>TypeRep</code> we store in <code>SDynamic</code> or <code>Dynamic</code>.</p>\n\n<p>Management of remote tables, although automated to some extent via TH, is\nstill kind of annoying, so why not use just <code>StaticPtr</code>s? Does <code>StaticLabel</code>\nexist only for backward compatibility with older GHCs or am I missing\nsomething?</p>\n"}, {"tags": ["haskell", "functional-programming", "coq", "agda", "idris"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515206807, "post_id": 48123613, "comment_id": 83224541, "body": "Your 2nd type is difficult to work with because it is quite a silly encoding. How about <code>data IsNib : Char -&gt; Type where IsNib : &#39;0&#39; &lt;= c -&gt; c &lt;= &#39;f&#39; -&gt; IsNib c</code> with some suitable encoding of <code>&lt;=</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1515220167, "post_id": 48123613, "comment_id": 83226649, "body": "Have you checked that your second encoding is more efficient?  I don&#39;t know what kinds of optimizations idris does, but without optimizations the proof term for <code>IsHex</code> is almost the same as your first encoding (to see this, ignore its type parameter), and then you <i>tuple</i> it with a string that contains the same information"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1515235348, "post_id": 48123613, "comment_id": 83229682, "body": "If you want an efficient representation, use an efficient representation (like an <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html\" rel=\"nofollow noreferrer\">unboxed vector</a>)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1515404546, "post_id": 48123613, "comment_id": 83273329, "body": "@BenjaminHodgson Idris has unboxed vectors?"}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 3, "last_activity_date": 1515215438, "creation_date": 1515215438, "answer_id": 48124463, "question_id": 48123613, "link": "https://stackoverflow.com/questions/48123613/is-it-possible-to-define-functions-for-a-type-and-then-compile-it-to-an-isomorp/48124463#48124463", "title": "Is it possible to define functions for a type, and then compile it to an isomorphic representation of it?", "body": "<p>If I understand your question correctly, one answer is to rewrite the constructors as constant identifiers: <code>H0 = IsNib '0'</code>, etc.</p>\n\n<p>In this case, adding <code>deriving Enum</code> to your first definition would allow the default <code>toEnum</code> and <code>fromEnum</code> to convert between your first encoding and numbers from 0 to 15.  You can then convert those using your library of choice (such as bit-shifts and bitwise and from <code>Data.Bits</code> or <code>intHex</code> from <code>Data.ByteString.Builder</code>).  You could also derive an instance of <code>Show</code> to convert hex digits to a one-<code>Char</code> <code>String</code> and <code>concat</code> them.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1515215438, "creation_date": 1515204368, "question_id": 48123613, "link": "https://stackoverflow.com/questions/48123613/is-it-possible-to-define-functions-for-a-type-and-then-compile-it-to-an-isomorp", "title": "Is it possible to define functions for a type, and then compile it to an isomorphic representation of it?", "body": "<p>Suppose that I define the following type for hexadecimal strings:</p>\n\n<pre><code>data HexDigit\n  = H0 | H1 | H2 | H3\n  | H4 | H5 | H6 | H7\n  | H8 | H9 | HA | HB\n  | HC | HD | HE | HF\n\nHex : Type\nHex = List HexDigit\n</code></pre>\n\n<p>This type is very simple, but probably inefficient when compiled to the JS backend. Another way to represent hexadecimal strings would be to use a subset of the native <code>string</code> type:</p>\n\n<pre><code>data IsNib : Char -&gt; Type where\n  IsNib0 : IsNib '0'\n  IsNib1 : IsNib '1'\n  IsNib2 : IsNib '2'\n  IsNib3 : IsNib '3'\n  IsNib4 : IsNib '4'\n  IsNib5 : IsNib '5'\n  IsNib6 : IsNib '6'\n  IsNib7 : IsNib '7'\n  IsNib8 : IsNib '8'\n  IsNib9 : IsNib '9'\n  IsNibA : IsNib 'a'\n  IsNibB : IsNib 'b'\n  IsNibC : IsNib 'c'\n  IsNibD : IsNib 'd'\n  IsNibE : IsNib 'e'\n  IsNibF : IsNib 'f'\n\ndata IsHex : String -&gt; Type where\n  IsHexNil : IsHex \"0x\"\n  IsHexApp : IsHex s -&gt; IsNib c0 -&gt; IsNib c1 -&gt; IsHex (s ++ singleton c0 ++ singleton c1)\n\nHex : Type\nHex = (s : String ** IsHex)\n</code></pre>\n\n<p>This would probably be more efficient, but I'm having <a href=\"https://stackoverflow.com/questions/48123439/how-to-prove-that-a-string-is-in-hexadecimal-format\">a lot of issues</a> working with that type (possibly due to not having enough experience on Idris yet).</p>\n\n<p><strong>Is it possible to build a library based on the first definition of <code>Hex</code>, but then, after compiling it to a backend, actually use the second definition, given that they're clearly isomorphic?</strong></p>\n"}, {"tags": ["haskell", "do-while"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1515197528, "post_id": 48122945, "comment_id": 83222853, "body": "What result do you expect?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1515197576, "post_id": 48122945, "comment_id": 83222870, "body": "Please, can you remove all code that&#39;s not relevant to the question?"}, {"owner": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1515198576, "post_id": 48122945, "comment_id": 83223075, "body": "Just the same result but i&#39;m not sure if the code is what do while is because the return still says While b s or is it already correct? @epsilonhalbe"}, {"owner": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1515198640, "post_id": 48122945, "comment_id": 83223091, "body": "sorry sir I removed irrelevant codes already @leftaroundabout"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "edited": false, "score": 0, "creation_date": 1515199097, "post_id": 48123051, "comment_id": 83223219, "body": "you mean this part? strans (While b c)    = code ++ [LOOP (strans_bool b, strans c)] I don&#39;t really understand. @ luqui"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "edited": false, "score": 0, "creation_date": 1515205426, "post_id": 48123051, "comment_id": 83224341, "body": "For the first option I mean <code>return (Seq s (While b s))</code> at the end of the parser instead of just <code>While b s</code> (which essentially makes do while a &quot;macro&quot;)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1515215234, "post_id": 48123051, "comment_id": 83225812, "body": "Did you mean for the first pseudocode block to have <code>do while</code> rather than <code>while</code>? I suspect you did."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515215317, "post_id": 48123051, "comment_id": 83225819, "body": "@dfeuer yes I did and gosh that must have been confusing.  Thanks"}, {"owner": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "edited": false, "score": 0, "creation_date": 1515494808, "post_id": 48123051, "comment_id": 83311925, "body": "@luqui what should i change in the strans (While b c) = code ++ [LOOP (strans_bool b, strans c)] part when i use Dowhile (c b) ?"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1515215290, "last_edit_date": 1515215290, "creation_date": 1515197875, "answer_id": 48123051, "question_id": 48122945, "link": "https://stackoverflow.com/questions/48122945/haskell-while-to-do-while/48123051#48123051", "title": "Haskell while to do while", "body": "<p>A \"do while\" statement is slightly different than a \"while\" statement, in that it always executes the block once before checking the condition. </p>\n\n<pre><code>do BLOCK while (COND)\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>BLOCK;\nwhile (COND)  BLOCK\n</code></pre>\n\n<p>You could integrate this into your program by either returning an expression tree with a copy of the block sequenced before it (using <code>Seq</code>), or by adding a <code>DoWhile</code> case to the <code>Com</code> data type, and extending the <code>strans</code> function to handle it. </p>\n\n<p>Also, you probably need to preserve the existing parsing of <code>while</code> when adding <code>do while</code> -- that is, instead of changing <code>whilestatement</code> to do what you want, add a new <code>dowhilestatement</code> parser and then add it to the <code>com</code> parser.</p>\n"}], "owner": {"reputation": 1, "user_id": 9179482, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx8dSoJDog0/AAAAAAAAAAI/AAAAAAAAABg/_ZN-8NEs7Jc/photo.jpg?sz=128", "display_name": "SayoNara IIT", "link": "https://stackoverflow.com/users/9179482/sayonara-iit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515215290, "creation_date": 1515196896, "last_edit_date": 1515198432, "question_id": 48122945, "link": "https://stackoverflow.com/questions/48122945/haskell-while-to-do-while", "title": "Haskell while to do while", "body": "<p>I'm new to Haskell and I've been working on this for months now and I would be glad if someone would be willing to help me! I'm trying to get this program to work with a do while loop.</p>\n\n<p>I have this while statement that can run this factorial program \"x = 4; y = 1; while !(x == 0) do (y = y * x; x = x - 1)\" that gives me the output \"[(\"x\",Integer 0),(\"y\",Integer 24)]\". The program goes like this:</p>\n\n<pre><code>whilestatement :: Parser Com\nwhilestatement = \n    do\n        symbol \"while\"\n        b &lt;- bexpr\n        symbol \"do\"\n        s &lt;- com\n        return (While b s)\n</code></pre>\n\n<p>and the task is to make a do while statement that could run this factorial program \"x =  4 ;  y = 1; do (y = y * x; x = x - 1) while !(x == 0)\". What I did is that I just made some changes in the while statement. I changed this part just interchanged the symbol \"do\" and symbol \"while\":</p>\n\n<pre><code>whilestatement :: Parser Com\nwhilestatement = \n    do\n        symbol \"do\"\n        s &lt;- com\n        symbol \"while\"\n        b &lt;- bexpr\n        return (While b s)\n</code></pre>\n\n<p>the program runs and gives the same output. But is this the right way to make a do while statement or can you help me how to make this while statement to do while statement. Thanks</p>\n"}, {"tags": ["sqlite", "haskell", "yesod"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515213659, "post_id": 48122327, "comment_id": 83225570, "body": "I&#39;m suspicious of that use of <code>db</code>. I also don&#39;t know where it&#39;s defined or what it does. I should add that I don&#39;t know Yesod, maybe it&#39;s a standard thing from its scaffolding?"}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515231609, "post_id": 48122327, "comment_id": 83228800, "body": "You&#39;re right, I added the definition above."}], "owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1515230079, "creation_date": 1515192194, "last_edit_date": 1515230079, "question_id": 48122327, "link": "https://stackoverflow.com/questions/48122327/fill-database-table-with-data-from-config-files-on-app-startup", "title": "Fill database table with data from config files on app startup", "body": "<p>I want the initial database state in my yesod web app to be defined by config files that are parsed on app startup. My current approach to achieve this compiles, but doesn't seem to do anything, I suspect this is because the database may not be ready for use at that point or needs to be accessed differently.</p>\n\n<pre><code>import System.Directory \nimport Data.Ini    \n\n-- | The @main@ function for an executable running this site.\nappMain :: IO ()\nappMain = do\n  settings &lt;- loadYamlSettingsArgs\n      [configSettingsYmlValue]\n      useEnv\n\n  foundation &lt;- makeFoundation settings\n\n  loadConfigs -- | load configs and fill db\n\n  app &lt;- makeApplication foundation\n  runSettings (warpSettings foundation) app\n\n\nloadConfigs :: IO ()\nloadConfigs = do allFiles &lt;- getDirectoryContents \"/config\"\n                 let filtered = filter (isSuffixOf \".cfg\") allFiles\n                 forM_ filtered parseConfig\n\nparseConfig :: String -&gt; IO ()\nparseConfig fileName = do \n                        res &lt;- readIniFile fileName\n                        case res of\n                            Left msg -&gt; do\n                                return ()\n                            Right ini -&gt; do\n                                let name = fromRight (pack \"-\") $ lookupValue (pack \"name\")  (pack \"-\") ini\n                                db $ insert (User name \"\" \"\")\n                                return ()\n\n-- | Run DB queries\ndb :: ReaderT SqlBackend (HandlerT App IO) a -&gt; IO a\ndb = handler . runDB\n</code></pre>\n\n<p>Could you please enlighten an unexperienced haskeller? Thanks!</p>\n"}, {"tags": ["haskell", "cloud-haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1515180354, "post_id": 48119827, "comment_id": 83216529, "body": "<code>liftIO (return x)</code> never performs any IO, regardless of what <code>x</code> is. <code>return :: a -&gt; IO a</code> is an IO action which does no IO, so you achieve nothing by lifting it. Why do you think this should work?"}], "answers": [{"tags": [], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "is_accepted": false, "score": -1, "last_activity_date": 1515245055, "creation_date": 1515245055, "answer_id": 48127785, "question_id": 48119827, "link": "https://stackoverflow.com/questions/48119827/send-message-in-cloudhaskell-from-io-monad/48127785#48127785", "title": "Send message in CloudHaskell from IO monad", "body": "<p>I solved the problem. Maybe it'll be useful for anybody.</p>\n\n<pre><code>anyMethod ::App -&gt; Handler ()\nanyMethod app = do\n    ...      \n    (appMesSender app) pid (QnrAnswers questionnaire questionnaireAnswers)\n\ndata App = App{appMesSender :: (ProcessId -&gt; UnitMessage -&gt; IO ())\n               ...\n              }\n</code></pre>\n\n<p>In fact, I prepared the function in advance.</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1515245055, "creation_date": 1515179364, "question_id": 48119827, "link": "https://stackoverflow.com/questions/48119827/send-message-in-cloudhaskell-from-io-monad", "title": "Send message in CloudHaskell from IO monad", "body": "<p>I want to send message (Cloud Haskell) inside not Process monad.</p>\n\n<pre><code>anyMethod :: Handler ()\nanyMethod = do\n    ...      \n    liftIO $ return $ do _ &lt;- send pid (QnrMes q a)\n                         return ()\n</code></pre>\n\n<p>Here pid is ProcessId.\nEverything is compiled, but the messages do not come to the process.\nIs it possible to implement this?</p>\n"}, {"tags": ["haskell", "typeclass", "type-constraints"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1515158284, "post_id": 48114347, "comment_id": 83204659, "body": "Community: perhaps we should have a reference q/a for problems related to misunderstanding universal and existential quantification. These are starting to get more and more common, recently."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1515159765, "post_id": 48114347, "comment_id": 83205505, "body": "&quot;But surely if a is constrained to Num, and b is constrained to Num, passing through the same value should work in this case&quot; - surely not, or else the same argument applies to <code>bad :: a -&gt; b; bad x = x</code>. Type variables are judgementally equal only to themselves, which is why the compiler says it can&#39;t match two distinct type variables. In a way, this is indeed a limitation of the compiler - it limits you from writing completely wrong code."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1515174660, "last_edit_date": 1515174660, "creation_date": 1515158170, "answer_id": 48114409, "question_id": 48114347, "link": "https://stackoverflow.com/questions/48114347/using-type-constraints-across-typeclass-instances/48114409#48114409", "title": "Using type constraints across typeclass instances", "body": "<pre><code>plotable :: Num b =&gt; a -&gt; (b, b)\n</code></pre>\n\n<p>means that any of these must type check</p>\n\n<pre><code>plotable :: a -&gt; (Int, Int)\nplotable :: a -&gt; (Integer, Integer)\nplotable :: a -&gt; (Double, Double)\n...\n</code></pre>\n\n<p>In other words, that polymorphic type promises to the user that <code>plotable</code> can use whichever numeric type <code>b</code> the user can choose.</p>\n\n<p><code>id :: a -&gt; a</code> does not let the user choose <code>b</code>, so it is not general enough.</p>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 48114409, "answer_count": 1, "score": 0, "last_activity_date": 1515174660, "creation_date": 1515157879, "question_id": 48114347, "link": "https://stackoverflow.com/questions/48114347/using-type-constraints-across-typeclass-instances", "title": "Using type constraints across typeclass instances", "body": "<p>I'm trying to define a type class <code>Plotable</code> that provides a function <code>plotable</code> to return a tuple representing co-ordinates in a chart <code>(x,y)</code>, it the type of <code>x</code> and <code>y</code> does not have to be specific (ie <code>Double</code>), I think they can be any number type (they're being handed over to <a href=\"https://hackage.haskell.org/package/Chart\" rel=\"nofollow noreferrer\">Chart</a>).</p>\n\n<p>I want <code>plotable</code> to be able to deal with <code>Num a =&gt; Complex a</code> and <code>Num a =&gt; (a, a)</code>, so I wrote:</p>\n\n<pre><code>class Plotable a where\n  plotable :: Num b =&gt; a -&gt; (b, b)\n\ninstance Num a =&gt; Plotable (a, a) where\n  plotable = id\n\ninstance Num a =&gt; Plotable (Complex a) where\n  plotable c = (realPart c, imagPart c)\n</code></pre>\n\n<p>Which makes sense to me, however I'm getting the error:</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018b\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the instance declaration\n    at /Users/dan.brooks/Code/haskell/coding-the-matrix/src/TheField/Plot.hs:12:10-33\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      plotable :: forall b. Num b =&gt; (a, a) -&gt; (b, b)\n    at /Users/dan.brooks/Code/haskell/coding-the-matrix/src/TheField/Plot.hs:13:3-10\n  Expected type: (a, a) -&gt; (b, b)\n    Actual type: (b, b) -&gt; (b, b)\n</code></pre>\n\n<p>But surely if <code>a</code> is constrained to <code>Num</code>, and <code>b</code> is constrained to <code>Num</code>, passing through the same value should work in this case? Is this simply a limitation of the compilier? or am I misusing typeclasses and type constraints?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1515162043, "post_id": 48113603, "comment_id": 83206840, "body": "Btw, the first definition is equivalent to <code>liftA2 (,)</code>, and the second definition is equivalent to the <code>either</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515255706, "post_id": 48114050, "comment_id": 83235333, "body": "I do not understand, why it is called <code>factorizer</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515260834, "post_id": 48114050, "comment_id": 83237034, "body": "It factorizes <code>f</code> and <code>g</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515261114, "post_id": 48114050, "comment_id": 83237134, "body": "Aha, that why it is called product."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515261280, "post_id": 48114050, "comment_id": 83237216, "body": "No. The &quot;product&quot; operation that &quot;factorizer&quot; refers to here is function composition (or morphism composition in a more general category). The factorizer factorizes <code>f</code> as the composition <code>f = fst . factorizer f g</code> and <code>g</code> as the composition <code>g = snd . factorizer f g</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515261722, "post_id": 48114050, "comment_id": 83237390, "body": "Now am I confuse. I did not get the sense of a <code>factorizer</code>. What does  <code>factorizes</code> mean? Can you please explain it for dummy person like me."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1515263047, "post_id": 48114050, "comment_id": 83237809, "body": "&quot;factorize&quot; means &quot;to write as a product&quot;. The meaning of &quot;product&quot; depends on the context. The best-known context is of course number theory, where the &quot;product&quot; operation is multiplication. In the context of category theory, we &quot;factorize&quot; morphisms as <i>compositions</i> of other, simpler morphisms.  The <code>factorizer</code> function returns a (common) factor of <code>f</code> and <code>g</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1515263331, "post_id": 48114050, "comment_id": 83237887, "body": "If we can write <code>x = y . z</code> (for some operation <code>(.)</code>) we can say that <code>y</code> and <code>z</code> are factors of <code>x</code>. Another definition of &quot;to factorize&quot; is &quot;to find the factors of something&quot;. What constitutes a good factor depends on the context. Often the factorization is meant to be unique in some sense."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1515271518, "post_id": 48114050, "comment_id": 83240552, "body": "Awesome explanation. Thanks a lot."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1515165584, "last_edit_date": 1515165584, "creation_date": 1515156719, "answer_id": 48114050, "question_id": 48113603, "link": "https://stackoverflow.com/questions/48113603/simple-definition-of-factorizer/48114050#48114050", "title": "Simple definition of factorizer", "body": "<p>In both cases, <code>factorizer</code> is the factorizer. From the blog post:</p>\n\n<blockquote>\n  <p>A (higher order) function that produces the factorizing function m from two candidates is sometimes called the factorizer.</p>\n</blockquote>\n\n<p>The pattern is that in both cases these functions give the <em>only</em> solution to certain equations.</p>\n\n<p>For products, for every <code>f</code> and <code>g</code>, <code>factorizer f g</code> is the only function such that <code>fst . factorizer f g = f</code> and <code>snd . factorizer f g = g</code>.</p>\n\n<p>For coproducts, for every <code>f</code> and <code>g</code>, <code>factorizer f g</code> is the only function such that <code>factorizer f g . Left = f</code> and <code>factorizer f g . Right = g</code>.</p>\n\n<p>The existence of factorizers characterizes the <code>Either</code> and <code>(,)</code> types up to isomorphism. That provides an alternative way of describing products and sums that can be generalized to other categories (it's only about composition of morphisms). In contrast, a definition by <code>data (,) a b = (,) a b</code> and <code>data Either a b = Left a | Right b</code> is ad-hoc to a particular language.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 2, "accepted_answer_id": 48114050, "answer_count": 1, "score": 3, "last_activity_date": 1515165584, "creation_date": 1515155071, "last_edit_date": 1515155198, "question_id": 48113603, "link": "https://stackoverflow.com/questions/48113603/simple-definition-of-factorizer", "title": "Simple definition of factorizer", "body": "<p>I am reading the great post from Bartosz Milewski about <a href=\"https://bartoszmilewski.com/2015/01/07/products-and-coproducts/\" rel=\"nofollow noreferrer\">Products and Coproducts</a>.   </p>\n\n<p>Consider following functions:</p>\n\n<pre><code>factorizer :: (c -&gt; a) -&gt; (c -&gt; b) -&gt; (c -&gt; (a, b))\nfactorizer p q = \\x -&gt; (p x, q x)\n</code></pre>\n\n<p>Is <code>(c -&gt; (a, b))</code> the factorizer? If yes, why? Honestly, for me the sample is just a function, that expects two higher order function. I can't see the pattern of the <code>Product</code>.  </p>\n\n<p>The next sample:</p>\n\n<pre><code>factorizer :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c\nfactorizer i j (Left a)  = i a\nfactorizer i j (Right b) = j b\n</code></pre>\n\n<p>How can I recognize the pattern of <code>Coproducts</code> corresponding to the code above?</p>\n"}, {"tags": ["java", "haskell", "design-patterns", "clojure", "functional-programming"], "comments": [{"owner": {"reputation": 3700, "user_id": 8339141, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f00f93d54fda2f5c1fbe9b21b48f5c95?s=128&d=identicon&r=PG&f=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/8339141/roman"}, "edited": false, "score": 2, "creation_date": 1515148002, "post_id": 48111558, "comment_id": 83198826, "body": "In FP you have algebraic data structures and one you could use in this case would be Either."}, {"owner": {"reputation": 191, "user_id": 4809201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ed14425256b20859d58bfdafa48d528?s=128&d=identicon&r=PG&f=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/4809201/vicky"}, "reply_to_user": {"reputation": 3700, "user_id": 8339141, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f00f93d54fda2f5c1fbe9b21b48f5c95?s=128&d=identicon&r=PG&f=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/8339141/roman"}, "edited": false, "score": 2, "creation_date": 1515148398, "post_id": 48111558, "comment_id": 83199039, "body": "@Roman: Kindly explain this with a sample code if you could."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515163387, "post_id": 48111558, "comment_id": 83207708, "body": "How is the above code <i>&quot;totally imperative&quot;?</i> It isn&#39;t <i>total</i>, but it has no intermediate state. You could write the same code in Haskell, with exceptions and all... Would you consider that imperative as well?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1515163560, "post_id": 48111558, "comment_id": 83207821, "body": "If you consider exceptions as an incarnation of <a href=\"https://en.wikipedia.org/wiki/Bottom_type\" rel=\"nofollow noreferrer\">bottom</a>, then the above <code>divide</code> method look <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">referentially transparent</a> to me; i.e. it&#39;s a <a href=\"https://en.wikipedia.org/wiki/Pure_function\" rel=\"nofollow noreferrer\">function</a>."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1515159556, "post_id": 48112479, "comment_id": 83205388, "body": "Just note this is an example of a <i>partial</i> function, one that isn&#39;t defined for all inputs, because it raises an exception. (Contrast with a <i>total</i> function, like the one shown <a href=\"https://stackoverflow.com/a/48112518/1126841\">Roman&#39;s Haskell example</a>, that returns some value for any input.)"}], "tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 2, "last_activity_date": 1515151283, "last_edit_date": 1515151283, "creation_date": 1515150971, "answer_id": 48112479, "question_id": 48111558, "link": "https://stackoverflow.com/questions/48111558/functional-programming-how-to-handle-exceptions-in-functional-programming-or-wh/48112479#48112479", "title": "Functional Programming: How to handle exceptions in Functional Programming or what is its equivalent", "body": "<p>In Clojure this isn't really different from Java:</p>\n\n<pre><code>(defn divide\n  [dividend divisor]\n  (if (or (zero? divisor)\n          (and (= Integer/MIN_VALUE\n                  dividend)\n               (= -1 divisor)))\n    (throw (DivisionException.))\n    (/ dividend divisor)))\n</code></pre>\n\n<p>Your code isn't mutating any variables and therefore is already pretty much functional. Exceptions are just as much a part of Clojure, because it adopts the execution model of the JVM.</p>\n"}, {"comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1515153371, "post_id": 48112518, "comment_id": 83201820, "body": "I think the <code>maybe</code> monad would be more suitable for this, actually no, you are right, if you want to pass an error message this would be nice :D"}, {"owner": {"reputation": 3700, "user_id": 8339141, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f00f93d54fda2f5c1fbe9b21b48f5c95?s=128&d=identicon&r=PG&f=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/8339141/roman"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1515154412, "post_id": 48112518, "comment_id": 83202381, "body": "@Netwave I also thought to take Maybe, but then I took Either because of the error message :P"}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1515155241, "post_id": 48112518, "comment_id": 83202893, "body": "Your answer is fully correct in terms of how to handle this type of thing in Haskell, but as a small nitpick, the OP&#39;s code isn&#39;t rejecting negative - he&#39;s trying to prevent an incorrect result that would happen if you divided the smallest integer possible by -1."}], "tags": [], "owner": {"reputation": 3700, "user_id": 8339141, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f00f93d54fda2f5c1fbe9b21b48f5c95?s=128&d=identicon&r=PG&f=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/8339141/roman"}, "is_accepted": false, "score": 10, "last_activity_date": 1589290666, "last_edit_date": 1589290666, "creation_date": 1515151077, "answer_id": 48112518, "question_id": 48111558, "link": "https://stackoverflow.com/questions/48111558/functional-programming-how-to-handle-exceptions-in-functional-programming-or-wh/48112518#48112518", "title": "Functional Programming: How to handle exceptions in Functional Programming or what is its equivalent", "body": "<p>The following shows how you could do it in Haskell.</p>\n\n<p>Based on the type siginure <code>divide :: Int -&gt; Int -&gt; Either [Char] Int</code> you can see that the function <code>divide</code> will return either a <code>Left string</code> or a <code>Right Int</code>.  </p>\n\n<p><code>Either</code> is an <em>algebraic data structure</em> and there are many more and you can write your own to.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>divide :: Int -&gt; Int -&gt; Either [Char] Int\ndivide dividend divisor\n    | (divisor == 0) = Left \"Sorry, 0 is not allowed :o\"\n    | (dividend == (minBound :: Int)) &amp;&amp; (divisor == -1) = Left \"somethig went wrong\"\n    | otherwise = Right (dividend `div` divisor)\n\nmain = do\n    print (divide 4 2)                     -- Right 2\n    print (divide 4 0)                     -- Left \"Sorry, 0 is not allowed :o\"\n    print (divide (minBound :: Int) (-1))  -- Left \"somethig went wrong\"\n\n</code></pre>\n\n<p>You can play with it on <a href=\"https://repl.it/repls/InternationalKnobbyBass\" rel=\"nofollow noreferrer\">repl.it</a></p>\n\n<p>In Haskell you can throw errors to with <code>error \"and your error message\"</code> but this will crash you programm.. and this is not what we want.</p>\n"}, {"tags": [], "owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "is_accepted": false, "score": 4, "last_activity_date": 1515168576, "last_edit_date": 1515168576, "creation_date": 1515160252, "answer_id": 48114971, "question_id": 48111558, "link": "https://stackoverflow.com/questions/48111558/functional-programming-how-to-handle-exceptions-in-functional-programming-or-wh/48114971#48114971", "title": "Functional Programming: How to handle exceptions in Functional Programming or what is its equivalent", "body": "<p>The <code>divide</code> function is not total: some values from its input domain have no image.</p>\n\n<h3>Make the function total</h3>\n\n<p>Change the output domain so that it can return either an error or a number.\nThe caller is responsible for checking whether the value is really a number, or an error.</p>\n\n<p>In a dynamically typed language like Clojure, you could return <code>nil</code>, but any other value could work too, as long as you can distinguish it from a number.\nIn a statically typed language like Haskell, use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Either.html\" rel=\"nofollow noreferrer\"><code>Data.Either</code></a> or your own datatype if you need. </p>\n\n<ul>\n<li><p>The check is done consistently and statically in Haskell. You must do the check every time, even if you are sure the divisor can't be null. However, you can also have a wrapper function, <code>must-divide</code>, which then would throws an exception on errors.</p></li>\n<li><p>In Clojure, you may forget to check for <code>nil</code>, either from a bug or because you have more information about the divisor than the compiler. You could however force a consistent checking by exporting a <code>divide</code> macro that requires you to consider the error path: </p>\n\n<pre><code>(divide x y :on-error (throw ...))\n(divide x y :on-error default-value)\n</code></pre>\n\n<p>... could be respectively expanded as:</p>\n\n<pre><code>(or (maybe-divide x y) (throw ...))\n(or (maybe-divide x y) default-value)\n</code></pre>\n\n<p>... with </p>\n\n<pre><code>(defn maybe-divide [dividend divisor]\n  (and (not (zero? divisor)) \n       (or (not= Integer/MIN_VALUE dividend)\n           (not= -1 divisor))\n       (/ dividend divisor)))\n</code></pre></li>\n</ul>\n\n<h3>Throw an exception</h3>\n\n<p>Mathematical operations are composed to form bigger expressions: adding an explicit error handling path inside them can quickly become unreadable.\nAlso, you may expect most of your operations to call <code>divide</code> with valid inputs, and don't want to check if the result is valid each time you call it (e.g. some mathematical equation come with a proof that the divisor won't possibly ever be null). In that case, Clojure and Haskell support exceptions. This allows you to catch errors higher up in the call stack in case you have bugs.</p>\n"}, {"tags": [], "owner": {"reputation": 3034, "user_id": 681159, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/cc450e2d8db7b8d5dcc656a1c301034e?s=128&d=identicon&r=PG", "display_name": "Jeel Shah", "link": "https://stackoverflow.com/users/681159/jeel-shah"}, "is_accepted": false, "score": 0, "last_activity_date": 1584019794, "creation_date": 1584019794, "answer_id": 60655171, "question_id": 48111558, "link": "https://stackoverflow.com/questions/48111558/functional-programming-how-to-handle-exceptions-in-functional-programming-or-wh/60655171#60655171", "title": "Functional Programming: How to handle exceptions in Functional Programming or what is its equivalent", "body": "<p>In Clojure(script), you can use the <a href=\"https://github.com/adambard/failjure\" rel=\"nofollow noreferrer\">Failjure</a> library which provides a way to handle exceptions in a functionally pure way.</p>\n\n<pre class=\"lang-clj prettyprint-override\"><code>(ns stackoverflow\n    (:require\n      [failjure.core :as f]))\n\n(defn divide\n  [dividend divisor]\n  (cond\n    (zero? divisor) (f/fail \"The divisor is 0; unable to perform operation.\")\n    (and (= Integer/MIN_VALUE dividend) (neg? divisor)) (f/fail \"Unable to perform division with a negative dividend and divisor\")\n    :else (/ dividend divisor)))\n</code></pre>\n\n<p><code>(f/fail ..)</code> will return a Failure object which you can use for your error handling. </p>\n"}], "owner": {"reputation": 191, "user_id": 4809201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ed14425256b20859d58bfdafa48d528?s=128&d=identicon&r=PG&f=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/4809201/vicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1932, "favorite_count": 2, "answer_count": 4, "score": 9, "last_activity_date": 1589290666, "creation_date": 1515147817, "last_edit_date": 1544548241, "question_id": 48111558, "link": "https://stackoverflow.com/questions/48111558/functional-programming-how-to-handle-exceptions-in-functional-programming-or-wh", "title": "Functional Programming: How to handle exceptions in Functional Programming or what is its equivalent", "body": "<p>Let's say, I've the below code. </p>\n\n<pre><code>public int divide(int dividend, int divisor) {\n    if( divisor == 0 || (dividend == Integer.MIN_VALUE &amp;&amp; divisor == -1)) \n          throw new DivisionException();\n    return dividend/divisor;\n}\n</code></pre>\n\n<p>How to write this in Functional Programming?</p>\n\n<p>I have a logic similar to the above written in Java and would like to migrate that to functional code in Haskell/Clojure. \nHow to handle this in the callers of <code>divide</code>?</p>\n\n<p>I know that the above code is <em>totally imperative</em>. It was not written with the forethought of migrating it to FP in future.</p>\n\n<p>Kindly advise me with a sample code in <em>Haskell</em> or <em>Clojure</em>.</p>\n"}, {"tags": ["haskell", "stm"], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 3, "last_activity_date": 1515142109, "creation_date": 1515142109, "answer_id": 48110082, "question_id": 48109661, "link": "https://stackoverflow.com/questions/48109661/creating-a-unique-time-based-id-generator-with-tmvar/48110082#48110082", "title": "Creating a unique time based ID generator with TMVar", "body": "<p>Suppose we call <code>next</code> a few times within the same second and <code>getTime 1</code> returns 42 each time.</p>\n\n<p>The first time, t is 42, v is 0, t /= v so t' is 42.</p>\n\n<p>The second time, t is 42, v is 42, t == v so t' is 43, we store 43.</p>\n\n<p>The third time, t is 42, v is 43, t /= v so t' is 42, we store 42.</p>\n\n<p>The fourth time, t is 42, v is 42, t == v so t' is 43, we store 43.</p>\n\n<p>See the problem?</p>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 48110082, "answer_count": 1, "score": 0, "last_activity_date": 1515142109, "creation_date": 1515140289, "question_id": 48109661, "link": "https://stackoverflow.com/questions/48109661/creating-a-unique-time-based-id-generator-with-tmvar", "title": "Creating a unique time based ID generator with TMVar", "body": "<p>I am making a naive time based unique ID generator to learn some concepts in concurrent Haskell.</p>\n\n<p><code>next</code> should return a unique sequential POSIX time but this timestamp does not have to match the exact moment that I called next.</p>\n\n<p>This code obviously does not generate unique timestamps, and I don't understand why:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Concurrent.Async (mapConcurrently)\nimport Data.Time.Clock.POSIX    (getPOSIXTime)\nimport Data.Time                (UTCTime)\nimport Control.Concurrent.STM   (TMVar, atomically, takeTMVar, putTMVar, newTMVarIO)\nimport Data.List                (nub)\n\ngetTime :: (Integral b, RealFrac a) =&gt; a -&gt; IO b\ngetTime precision =\n  round . (* precision) . fromRational . toRational &lt;$&gt; getPOSIXTime\n\nnext :: Integral b =&gt; TMVar b -&gt; IO b\nnext s = do\n  t &lt;- getTime 1 -- one second precision\n  atomically $ do\n    v &lt;- takeTMVar s\n    let t' = if t == v then t + 1 else t\n    putTMVar s t'\n    return t'\n\nmain = do\n  next' &lt;- next &lt;$&gt; newTMVarIO 0\n  res &lt;- mapConcurrently id [next' | _ &lt;- [1 .. 100]]\n  print $ length $ nub res -- expected 100\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "polymorphism"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515125853, "post_id": 48106325, "comment_id": 83189806, "body": "Based on your description, it shouldn&#39;t handle this case (i.e. it should give an error), because you&#39;ve defined <code>Data</code> without a constructor for pairs, so the type <code>(a,b) -&gt; a</code> or even <code>(Int, Int) -&gt; Int</code> can&#39;t be represented. Your code will give a type error like <code>no instance for Arg (a,b)</code>. This is easy to fix - add pairs to <code>Data</code>. However such code also can&#39;t handle polymorphic function (e.g. <code>a -&gt; b -&gt; a</code> or <code>a -&gt; a</code>) - this is just a limitation of the technique."}, {"owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515129238, "post_id": 48106325, "comment_id": 83190517, "body": "Oh whoops that&#39;s just a bad example. I actually have an implementation for pairs but I omitted it for simplicity. Can you think of any other approach because I&#39;m stumped by this."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1515146403, "post_id": 48106325, "comment_id": 83197832, "body": "Do you mean something like defining an instance <code>Arg (forall a b. a -&gt; b -&gt; a)</code>? If you actually need that you could wrap the polymorphism in a constructor: <code>newtype P = P (forall a b. a -&gt; b -&gt; a)</code>  and define an instance <code>Arg P</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515159509, "post_id": 48106325, "comment_id": 83205363, "body": "It&#39;s not clear what you want to accomplish, so I can&#39;t recommend another approach. The types of polymorphic functions cannot appear in the heads of classes or on the LHS of a type family, so you can&#39;t &#39;pattern match&#39; on a polymorphic type in the way you can with monomorphic types."}], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1515129264, "creation_date": 1515118630, "last_edit_date": 1515129264, "question_id": 48106325, "link": "https://stackoverflow.com/questions/48106325/haskell-wrapped-data-applied-to-polymorphic-functions", "title": "Haskell: Wrapped Data Applied to Polymorphic Functions", "body": "<p>I'm trying to create a system that allows a list data with unknown types to be applied to a function with the possibility of failure. </p>\n\n<p>The data and the functions must be of the same type. For instance, the data is stored as such: </p>\n\n<pre><code>data Data = DInt Int | DBool Bool ...\n</code></pre>\n\n<p>Whilst the functions, after some currying, will be of type:</p>\n\n<pre><code>[Data] -&gt; Either Error Data\n</code></pre>\n\n<p>I posted a similar <a href=\"https://stackoverflow.com/questions/47996905/haskell-function-application-on-wrapped-data\">question</a> a week ago and with some tweaking I've managed to make a rough yet working solution for functions, using type classes. The problem I'm having is that my code works fine for non polymorphic functions e.g.</p>\n\n<pre><code>Int -&gt; Bool -&gt; Int\n</code></pre>\n\n<p>But it can't handle something like this:</p>\n\n<pre><code>a -&gt; b -&gt; a\n</code></pre>\n\n<p>A sample of what I've gotten working already is below.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances#-}\n\ndata Data =   DInt Int | DBool Bool \ndata Error = TypeError String Data | MissingArg | ExtraArgs\n\nclass Arg a where \n    getArg :: Data -&gt; Either Error a  \n    wrap   :: a -&gt; Data\n\ninstance Arg Int where\n    getArg (DInt x) = Right x\n    getArg       x  = Left $ TypeError \"DInt\" x\n    wrap         x  = DInt x\ninstance Arg Bool where\n    getArg (DBool x) = Right x\n    getArg        x  = Left $ TypeError \"DBool\" x\n    wrap          x  = DBool x\n\nclass Function a where\n    exec :: a -&gt; [Data] -&gt; Either Error Data  \n\ninstance Arg a =&gt; Function a where\n    exec x [] = Right (wrap x)\n    exec _ _  = Left ExtraArgs     \n\ninstance {-# OVERLAPPING #-} (Function f, Arg a) =&gt; Function (a -&gt; f) where\n    exec f (x:xs)  = do\n                  x' &lt;- getArg x\n                  exec (f x') xs\n    exec _ []       = Left $ MissingArg   \n</code></pre>\n\n<p>Can I create an Arg typeclass for handling polymorphic types or is there another way to achieve this behaviour that would be better suited?\nThanks, please let me know if you need any clarification about the question? </p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "continuations", "continuation-passing"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515121726, "post_id": 48105863, "comment_id": 83188978, "body": "Are you restricted to using <code>ContT</code> here? This is exactly the sort of situation <code>Free</code> or <code>Operational</code> was built to handle."}, {"owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515122641, "post_id": 48105863, "comment_id": 83189167, "body": "@Carl I&#39;m not restricted at all, and I&#39;m definitely open to exploring those solutions. Thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515141258, "post_id": 48105863, "comment_id": 83194892, "body": "@Carl, I think <code>FT Cmd m</code> is more likely than <code>Free Cmd</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515144068, "post_id": 48105863, "comment_id": 83196351, "body": "You might need an existential wrapper. It&#39;s hard to understand if you actually need that, though."}], "answers": [{"comments": [{"owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "edited": false, "score": 0, "creation_date": 1515121491, "post_id": 48106556, "comment_id": 83188937, "body": "With a polymorphic result type, how will the continuation know what to return?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "edited": false, "score": 0, "creation_date": 1515121636, "post_id": 48106556, "comment_id": 83188963, "body": "Has to be defined for each case. <code>GetChar</code> would return a <code>Char</code> wrapped in an <code>IO Result</code> or whatever you call it, and <code>PutChar</code> would return <code>()</code>. They\u2019d call different constructors."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "edited": false, "score": 0, "creation_date": 1515121861, "post_id": 48106556, "comment_id": 83189000, "body": "You could also do a more complicated AST, where a <code>GetChar</code> node has a daughter node that the type system will only let you fill with something that takes an <code>IO Char</code> as input, and if you want to ignore the result, you put in an ignore-a-<code>Char</code> command as the terminal node."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 0, "last_activity_date": 1515120835, "creation_date": 1515120835, "answer_id": 48106556, "question_id": 48105863, "link": "https://stackoverflow.com/questions/48105863/how-to-dispatch-different-types-from-a-contt/48106556#48106556", "title": "How to dispatch different types from a ContT?", "body": "<p>Either your commands all need to be closures that return the same type (such as <code>IO ()</code>, in which case you can\u2019t do <code>getChar</code>) or you need to have a polymorphic result type that can hold either <code>IO ()</code> or <code>IO Char</code>, and <code>ContinueIO</code> needs to take this as its argument.  Then you need to decide what happens when you pass an <code>IO Char</code> to <code>GetChar</code> or nothing to <code>PutChar</code>.  (This version could be a <code>Monoid</code> with <code>&lt;&gt; = ContinueIO</code> and <code>mempty = id</code>, and then you could <code>foldMap</code> over any <code>Foldable</code> structure.)</p>\n"}], "owner": {"reputation": 1075, "user_id": 4282604, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ujVHc.png?s=128&g=1", "display_name": "robbie", "link": "https://stackoverflow.com/users/4282604/robbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1515122836, "creation_date": 1515114823, "last_edit_date": 1515122836, "question_id": 48105863, "link": "https://stackoverflow.com/questions/48105863/how-to-dispatch-different-types-from-a-contt", "title": "How to dispatch different types from a ContT?", "body": "<p>I want to create a generalized form of IO based on <code>ContT</code>. I created a GADT to represent different IO actions:</p>\n\n<pre><code>data Cmd a where\n  PutChar :: Char -&gt; Cmd ()\n  GetChar :: Cmd Char\n</code></pre>\n\n<p>I wrote a function that transforms these into <code>IO</code> commands for use in the IO monad like so:</p>\n\n<pre><code>continueIO :: Cmd a -&gt; IO a\ncontinueIO (PutChar c) = putChar c\ncontinueIO GetChar = getChar\n</code></pre>\n\n<p>Here's what a sample usage of this should look like:</p>\n\n<pre><code>echoChar :: (Monad m) =&gt; ContT r m (Cmd a)\nechoChar = ContT $ \\k -&gt; do\n  c &lt;- k GetChar\n  k (PutChar c)\n</code></pre>\n\n<p>It should be run with something like <code>runContT echoChar continueIO</code>. However, the <code>PutChar</code> and <code>GetChar</code> commands conflict in their types. How can I dispatch both types from the same ContT?</p>\n\n<p>P.S. Sorry if anything in this question is awkwardly worded. I'm trying to give myself a challenge here and I don't completely understand what I'm trying to do.</p>\n\n<p>Edit: I am not restricted in my solution, and I do not have to use <code>ContT</code>.</p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515106076, "post_id": 48103625, "comment_id": 83185064, "body": "Every term has a set of <a href=\"https://en.wikipedia.org/wiki/Free_variables_and_bound_variables\" rel=\"nofollow noreferrer\">free variables</a>. A variable does not appear free in a term if the the variable is not a member of the set of free variables of the term."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 5, "last_activity_date": 1515100892, "last_edit_date": 1515100892, "creation_date": 1515100507, "answer_id": 48103672, "question_id": 48103625, "link": "https://stackoverflow.com/questions/48103625/what-makes-a-variable-not-appear-free-in-a-lambda-expression/48103672#48103672", "title": "What makes a variable &#39;not appear free&#39; in a lambda expression", "body": "<p><code>a</code> does not appear free in <code>o</code> if (and only if) all occurrences of <code>a</code> in <code>o</code> are within a lambda that binds <code>a</code>.</p>\n\n<p>So for example if <code>o = \\a. a</code> or <code>o = x</code> (<code>a</code> does not appear at all), <code>a</code> does not appear free in <code>o</code>, but if <code>o = a</code> or <code>o = \\b. a b</code>, <code>a</code> does appear free.</p>\n"}], "owner": {"reputation": 14629, "user_id": 21115, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d5e190845525aa75c8da275c072c23be?s=128&d=identicon&r=PG", "display_name": "davetapley", "link": "https://stackoverflow.com/users/21115/davetapley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515106268, "creation_date": 1515100209, "last_edit_date": 1515106268, "question_id": 48103625, "link": "https://stackoverflow.com/questions/48103625/what-makes-a-variable-not-appear-free-in-a-lambda-expression", "title": "What makes a variable &#39;not appear free&#39; in a lambda expression", "body": "<p>Page 11 in <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf\" rel=\"nofollow noreferrer\">Philip Wadler's Monads for functional programming</a> states:</p>\n\n<blockquote>\n  <p>The operations of a monad satisfy three laws.</p>\n  \n  <p>...</p>\n  \n  <p><em>Associative</em>. Compute <code>m</code>, bind the result to <code>a</code>, compute <code>n</code>, bind the result to <code>b</code>, compute <code>o</code>. The order of parentheses in such a computation is irrelevant.</p>\n\n<pre>m &starf; (\u03bba. n &starf; \u03bbb. o) = (m &starf; \u03bba. n) &starf; \u03bbb. o.</pre>\n  \n  <p>The scope of the variable <em>a</em> includes <em>o</em> on the left but excludes <em>o</em> on the right, so this law is valid only when <em>a</em> does not appear free in <em>o</em>.</p>\n</blockquote>\n\n<p>What makes a variable 'not appear free' in this context?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1515095131, "post_id": 48102204, "comment_id": 83180224, "body": "On recent versions of GHC you can use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-TypeLits.html#t:TypeError\" rel=\"nofollow noreferrer\"><code>TypeError</code></a>"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515095802, "post_id": 48102204, "comment_id": 83180585, "body": "@user2407038 cheers that\u2019ll do nicely thanks. If you want to make that the answer I\u2019ll tick it."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1515097413, "post_id": 48102204, "comment_id": 83181374, "body": "You can use <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint.html#t:Bottom\" rel=\"nofollow noreferrer\"><code>Bottom</code></a> too."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515282211, "post_id": 48102204, "comment_id": 83243209, "body": "What is <code>ProxyT</code> for? What is it&#39;s kind? What do its instances look like? I&#39;m wondering if there might be a more constructive approach."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 9, "last_activity_date": 1515096017, "creation_date": 1515096017, "answer_id": 48102691, "question_id": 48102204, "link": "https://stackoverflow.com/questions/48102204/nice-way-to-write-an-unsatisfiable-constraint/48102691#48102691", "title": "Nice way to write an unsatisfiable constraint?", "body": "<p>On recent versions of GHC you can use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-TypeLits.html#t:TypeError\" rel=\"noreferrer\"><code>TypeError</code></a>:</p>\n\n<pre><code>import GHC.TypeLits \n\ntype Unsatisfiable = TypeError ('Text \"oops\")\n</code></pre>\n\n<p>However, I recommend you just use <code>TypeError</code> directly at use sites and give a custom error message:</p>\n\n<pre><code>type family NEq t1 t2 :: Constraint where\n  NEq t t = TypeError ('Text \"Expected a type distinct from \" ':&lt;&gt;: 'ShowType t)\n  NEq _ _ = ()\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 48102691, "answer_count": 1, "score": 6, "last_activity_date": 1515096017, "creation_date": 1515094046, "question_id": 48102204, "link": "https://stackoverflow.com/questions/48102204/nice-way-to-write-an-unsatisfiable-constraint", "title": "Nice way to write an unsatisfiable constraint?", "body": "<p>I've found myself writing this:</p>\n\n<pre><code>data T1\ndata T2\n\ntype Unsatisfiable = T1 ~ T2\n</code></pre>\n\n<p>So I can do something like this:</p>\n\n<pre><code>type family NEq t1 t2 :: Constraint where\n  NEq t t = Unsatisfiable\n  NEq _ _ = ()\n\ntype HasProxyT t = NEq t (ProxyT t)\n</code></pre>\n\n<p>Then I can use <code>HasProxyT</code> to restrict default methods to not loop if the proxy type is the same as themselves (doesn't stop two instances from looping to each other's default methods, but you'd have to be pretty stupid to do such a thing).</p>\n\n<p>But the definition of <code>Unsatisfiable</code> seems a bit ugly? Is there a nicer way of defining <code>Unsatisfiable</code> or is this just the way it's done?</p>\n"}, {"tags": ["list", "haskell", "zip", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1515093960, "post_id": 48102168, "comment_id": 83179645, "body": "Beat me to saying the exact same thing, but you were way more detailed. Well played."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1515094096, "post_id": 48102168, "comment_id": 83179703, "body": "Looks like the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:zip\" rel=\"nofollow noreferrer\">docs</a> specify <code>zip</code> to be right-lazy, but <code>zip3</code> is under no such restriction. This would explain the discrepancy in implementation, and it also raises an interesting point about the benefit of doing code in the OP&#39;s style that I hadn&#39;t considered before."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1515094308, "post_id": 48102168, "comment_id": 83179812, "body": "@SilvioMayolo: well as far as I know pattern matching is done left-to-right. So it will also first match the first parameter with <code>(a:as)</code>, so afaik, there is no difference in semantics. Anyway, it is funny that we both mention the source code of the Prelude :)"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1515095205, "post_id": 48102168, "comment_id": 83180271, "body": "Hm... I can&#39;t seem to construct a counterexample. It seems you&#39;re correct about the semantics then."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1515096787, "post_id": 48102168, "comment_id": 83181035, "body": "The two are equivalent, it seems. <a href=\"https://gist.github.com/Mercerenies/b9174f7ff0bf8637df055b6462ffe917\" rel=\"nofollow noreferrer\">gist.github.com/Mercerenies/b9174f7ff0bf8637df055b6462ffe917</a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 15, "last_activity_date": 1515095385, "last_edit_date": 1515095385, "creation_date": 1515093896, "answer_id": 48102168, "question_id": 48102083, "link": "https://stackoverflow.com/questions/48102083/haskell-my-own-zip3-function/48102168#48102168", "title": "Haskell - My own zip3 function", "body": "<p>It works fine. If you want to make the program shorter, you can write:</p>\n\n<pre><code>zip3' :: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]\nzip3' (a:as) (b:bs) (c:cs) = (a,b,c) : zip3' as bs cs\nzip3' _      _      _ = []\n</code></pre>\n\n<p>Since the first line will only fail to fire if there is at least one of the three lists that is not <code>(_:_)</code> (so <code>[]</code>). But this is sometimes seen as an anti-pattern, since in a very unlike event that one adds a constructor to the list data type, this might end up with an empty list (whereas in that case, we perhaps better get an error). I agree that for lists this is close to impossible: a lot of libraries and programs would no longer work. But in general it is not uncommon that you for instance design a data type, and later change your mind and add an extra constructor.</p>\n\n<p>If we inspect the source code of <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:zip3\" rel=\"noreferrer\"><strong><code>zip3 :: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]</code></strong></a>, then we see it is implemented that way <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.List.html#zip3\" rel=\"noreferrer\">[source]</a>:</p>\n\n<blockquote>\n<pre><code>zip3 :: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]\n-- Specification\n-- zip3 =  zipWith3 (,,)\nzip3 (a:as) (b:bs) (c:cs) = (a,b,c) : zip3 as bs cs\nzip3 _      _      _      = []\n</code></pre>\n</blockquote>\n\n<p>For some reason <code>zip</code> itself is implemented in the \"question\" style <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.List.html#zip\" rel=\"noreferrer\">[source]</a>:</p>\n\n<blockquote>\n<pre><code>zip :: [a] -&gt; [b] -&gt; [(a,b)]\nzip []     _bs    = []\nzip _as    []     = []\nzip (a:as) (b:bs) = (a,b) : zip as bs\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 6, "last_activity_date": 1515093924, "creation_date": 1515093924, "answer_id": 48102174, "question_id": 48102083, "link": "https://stackoverflow.com/questions/48102083/haskell-my-own-zip3-function/48102174#48102174", "title": "Haskell - My own zip3 function", "body": "<p>There's nothing inherently wrong with your approach, but you can collapse the first three cases into a catch-all at the end.</p>\n\n<pre><code>zip3' :: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]\nzip3' (a:as) (b:bs) (c:cs) = (a,b,c) : zip3' as bs cs\nzip3' _ _ _ = []\n</code></pre>\n\n<p>In fact, this is <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.List.html#zip3\" rel=\"noreferrer\">how GHC does it</a>.</p>\n"}], "owner": {"reputation": 380, "user_id": 9090849, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/307621803079298/picture?type=large", "display_name": "Filipe N&#243;brega", "link": "https://stackoverflow.com/users/9090849/filipe-n%c3%b3brega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 1, "accepted_answer_id": 48102168, "answer_count": 2, "score": 9, "last_activity_date": 1517239384, "creation_date": 1515093496, "last_edit_date": 1517239384, "question_id": 48102083, "link": "https://stackoverflow.com/questions/48102083/haskell-my-own-zip3-function", "title": "Haskell - My own zip3 function", "body": "<p>Is there a better way to re-create this function? It compiles fine.</p>\n\n<p>This is what I have:</p>\n\n<pre><code>zip3' :: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]\nzip3' [] _ _ = []\nzip3' _ [] _ = []\nzip3' _ _ [] = []\nzip3' (a:as) (b:bs) (c:cs) = (a,b,c) : zip3' as bs cs\n</code></pre>\n\n<p>I'm just wondering if there is a better way to summarize this:</p>\n\n<pre><code>zip3' [] _ _ = []\nzip3' _ [] _ = []\nzip3' _ _ [] = []\n</code></pre>\n"}, {"tags": ["string", "haskell", "text"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1515095573, "post_id": 48101740, "comment_id": 83180474, "body": "The <code>IsString</code> class is not intended to represent &#39;string like objects&#39; - its purpose is only to allow overloading of string literals. Any type for which there is a finite representation (even of just a subset of the type) can have a sensible instance of <code>IsString</code>. In my opinion, the author of <code>string-combinators</code> is not using <code>IsString</code> correctly; there is absolutely no guarantee or even convention that <code>IsString</code> and <code>Monoid</code> agree (i.e. <code>fromString (a + b) = fromString a + fromString b</code> and <code>fromString 0 = 0</code>) - without this fact those functions are not going to have reasonable behaviour."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1515097394, "post_id": 48101740, "comment_id": 83181355, "body": "This problem might be more appropriate to solve with a backpack-style module, rather than a typeclass."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515117867, "post_id": 48101740, "comment_id": 83188194, "body": "One reason you might <i>not</i> wish to do this is that if <code>OverloadedStrings</code> is on (common, depending on the codebase), then your user&#39;s literals will all require type annotations"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1515092741, "creation_date": 1515092741, "answer_id": 48101926, "question_id": 48101740, "link": "https://stackoverflow.com/questions/48101740/generic-haskell-stringy-functions-or-where-is-lines-isstring-a-a-a/48101926#48101926", "title": "Generic Haskell &#39;stringy&#39; functions, Or: Where is lines :: IsString a =&gt; a -&gt; [a]?", "body": "<p><code>IsString a</code> only provides a conversion from <code>String</code> to <code>a</code>. This makes writing a meaningful <code>lines</code> unfeasible, in general.</p>\n\n<p>For instance, here's a trivial case.</p>\n\n<pre><code>data T = T\n\ninstance IsString T where\n   fromString _ = T\ninstance Monoid T where\n   mempty = T\n   mappend _ _ = T\n</code></pre>\n\n<p>We can't really define <code>lines :: T -&gt; [T]</code>: the only possible (non bottom) result of that function is a list of the form <code>[T,T,T,...,T]</code> which is hardly useful, since it is completely unrelated to the input of <code>fromString</code>.</p>\n\n<p>If possible, I'd suggest to use a more rich type class to allow for a <code>lines</code> function.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1515092812, "creation_date": 1515091971, "last_edit_date": 1592644375, "question_id": 48101740, "link": "https://stackoverflow.com/questions/48101740/generic-haskell-stringy-functions-or-where-is-lines-isstring-a-a-a", "title": "Generic Haskell &#39;stringy&#39; functions, Or: Where is lines :: IsString a =&gt; a -&gt; [a]?", "body": "<p>I'm searching for the inverse of the <code>unlines</code> function in <code>Data.String.Combinators</code>, <code>unlines</code> joins lines by appending newlines:</p>\n<p><code>unlines :: (Monoid s, IsString s) =&gt; [s] -&gt; s</code></p>\n<p>The inverse of <code>unlines</code> should be <code>lines</code>, it splits a stringlike object on newlines:</p>\n<p><code>lines :: IsString s =&gt; s -&gt; [s]</code></p>\n<p>An extensive search on <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a> and <a href=\"https://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">hayoo</a>, also variations of <code>split</code>, <code>splitOn</code> etc. returns nothing. The naming of the function <code>unlines</code> even hints at the existence of its inverse <code>lines</code>. All <code>Data.String</code>, <code>Data.Text</code>, <code>Data.ByteString</code> etc. have a <code>lines</code> function, but no generic implementation seems to exist.</p>\n<p><strong>It strikes me as odd that such a function should not exist. Are there any fundamental reasons for that?</strong></p>\n<p><em>Background:</em> Since <code>String</code> is still widely used, even though everybody (?) knows that it shouldn't be in almost all cases, I thought it would be good to replace my own <code>String-&gt;String</code>, and similar, functions by <code>IsString s =&gt; s -&gt; s</code> or <code>(IsString s, Monoid s) =&gt; s -&gt; s</code>. That way at least I don't contribute to a bias towards <code>String</code> while still allowing <code>String</code> for ease of use.</p>\n<h3>Update</h3>\n<p>It's clear to me, now, that the <code>IsString</code> typeclass, offering only <code>fromString</code>, is not sufficient for such a <code>lines</code> function. So the question morphs into: What properties are needed and what typeclass, if any, 'encapsulates' them?</p>\n"}, {"tags": ["python", "haskell", "complex-numbers"], "answers": [{"comments": [{"owner": {"reputation": 123770, "user_id": 577088, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5UZyo.jpg?s=128&g=1", "display_name": "senderle", "link": "https://stackoverflow.com/users/577088/senderle"}, "edited": false, "score": 0, "creation_date": 1515089106, "post_id": 48101023, "comment_id": 83177284, "body": "The <code>cmath</code> module in Python provides a <a href=\"https://docs.python.org/3.6/library/cmath.html#power-and-logarithmic-functions\" rel=\"nofollow noreferrer\">complex-aware</a> <code>log</code> function. I&#39;m taking a look at the source now."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 123770, "user_id": 577088, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5UZyo.jpg?s=128&g=1", "display_name": "senderle", "link": "https://stackoverflow.com/users/577088/senderle"}, "edited": false, "score": 0, "creation_date": 1515089207, "post_id": 48101023, "comment_id": 83177338, "body": "@senderle Nice. With <code>from cmath import log, exp</code>, I get <code>exp(2 * log(3j))</code> printing out exactly what Haskell printed for <code>(0 :+ 3) ** 2</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515111636, "post_id": 48101023, "comment_id": 83186636, "body": "<code>Data.Complex</code> is in <code>base</code>, so bugs should be reported on the GHC Trac system with a &quot;core libraries&quot; component field."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1515089138, "last_edit_date": 1515089138, "creation_date": 1515088823, "answer_id": 48101023, "question_id": 48100794, "link": "https://stackoverflow.com/questions/48100794/differences-between-complex-number-implementations-in-haskell-and-python/48101023#48101023", "title": "Differences between complex number implementations in Haskell and Python", "body": "<p>In Haskell, <code>(**)</code> for <code>Complex</code> is essentially</p>\n\n<pre><code>a ** b = exp (b * log a)\n</code></pre>\n\n<p>which has many opportunities for bad rounding errors to creep in. (I don't know enough Python to check what it would do with an analogous log-then-exp expression; the thing I tried complained that it wasn't ready to handle <code>log(3j)</code>.) It has a bunch of special cases to thwart rounding errors, but none check for a fully-real integer exponent. You might consider this a bug or infelicity and report it to the folks in charge of the <code>Complex</code> type as another special case worth adding to the implementation of <code>(**)</code>.</p>\n\n<p>In the meantime, if you know your exponent is integral, you can use <code>(^)</code> (for positive numbers only) or <code>(^^)</code> instead:</p>\n\n<pre><code>Data.Complex&gt; (0 :+ 3) ^ 2\n(-9.0) :+ 0.0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 123770, "user_id": 577088, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5UZyo.jpg?s=128&g=1", "display_name": "senderle", "link": "https://stackoverflow.com/users/577088/senderle"}, "is_accepted": false, "score": 4, "last_activity_date": 1515096652, "creation_date": 1515096652, "answer_id": 48102849, "question_id": 48100794, "link": "https://stackoverflow.com/questions/48100794/differences-between-complex-number-implementations-in-haskell-and-python/48102849#48102849", "title": "Differences between complex number implementations in Haskell and Python", "body": "<p>Although the results given by the two languages are different, they aren't <em>very</em> different (as others have indicated in the comments). So you might guess that it's just a matter of slightly different implementations -- and you'd be right. </p>\n\n<p><a href=\"https://stackoverflow.com/a/48101023/577088\">Daniel Wagner</a> indicates that in Haskell, the <code>**</code> operator is defined as</p>\n\n<pre><code>a ** b = exp (b * log a)\n</code></pre>\n\n<p>Haskell does some special casing, but most of the time, the operation relies on the general-purpose definitions of <code>exp</code> and <code>log</code> for complex numbers.</p>\n\n<p>In Python, it's a little different: powers are calculated using a <em>polar</em> representation. This approach involves using a different set of general-purpose functions -- most of them basic trigonometric functions over ordinary floating point numbers -- and does almost no special-casing. It's not clear to me that this approach is better overall, but it does happen to give a more correct answer in the particular case you've chosen. </p>\n\n<p>Here's the <a href=\"https://github.com/python/cpython/blob/6f0eb93183519024cb360162bdd81b9faec97ba6/Objects/complexobject.c#L125-L134\" rel=\"nofollow noreferrer\">core of the implementation</a>:</p>\n\n<pre><code>vabs = hypot(a.real,a.imag);\nlen = pow(vabs,b.real);\nat = atan2(a.imag, a.real);\nphase = at*b.real;\nif (b.imag != 0.0) {\n    len /= exp(at*b.imag);\n    phase += b.imag*log(vabs);\n}\nr.real = len*cos(phase);\nr.imag = len*sin(phase);\n</code></pre>\n\n<p>Here, <code>a</code> is the base and <code>b</code> is the exponent. <code>vabs</code> and <code>at</code> give the polar representation of <code>a</code>, such that</p>\n\n<pre><code>a.real = vabs * cos(at)\na.imag = vabs * sin(at)\n</code></pre>\n\n<p>And as you can see in the last two lines of code, <code>len</code> and <code>phase</code> give the corresponding polar representation of the result, <code>r</code>. </p>\n\n<p>When <code>b</code> is real, the <code>if</code> block isn't executed, and this simplifies to <a href=\"https://en.wikipedia.org/wiki/De_Moivre%27s_formula\" rel=\"nofollow noreferrer\">De Moivre's formula</a>. I can't find a canonical formula covering the complex or imaginary cases, but it appears to be pretty simple!</p>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 0, "accepted_answer_id": 48101023, "answer_count": 2, "score": 2, "last_activity_date": 1515096652, "creation_date": 1515087924, "question_id": 48100794, "link": "https://stackoverflow.com/questions/48100794/differences-between-complex-number-implementations-in-haskell-and-python", "title": "Differences between complex number implementations in Haskell and Python", "body": "<p>I'm trying to map the complex number functionality in Python, to <code>Data.Complex</code> in Haskell, but I've reached a point where they differ, and I am unsure as to why. </p>\n\n<p>In python:</p>\n\n<pre><code>&gt;&gt;&gt; x = 3j\n3j\n&gt;&gt;&gt; x.real\n0.0\n&gt;&gt;&gt; x.imag\n3.0\n</code></pre>\n\n<p>In Haskell:</p>\n\n<pre><code>&gt; import Data.Complex\n&gt; let j n = 0 :+ n\n&gt; let x = j 3.0\n&gt; realPart x\n0.0\n&gt; imagPart x\n3.0\n</code></pre>\n\n<p>So far they look the same. Looks like operating on them doesn't differ much either:</p>\n\n<p>Python:</p>\n\n<pre><code>&gt;&gt;&gt; y = 1 + x\n(1+3j)\n&gt;&gt;&gt; y.real\n1.0\n&gt;&gt;&gt; y.imag\n3.0\n</code></pre>\n\n<p>Haskell:</p>\n\n<pre><code>&gt; let y = 1 + x\n&gt; realPart y\n1.0\n&gt; imagPart y\n3.0\n</code></pre>\n\n<p>In isolation <code>+ - * / **</code> all seem to work the same way. However this operation yields two different results:</p>\n\n<pre><code>&gt;&gt;&gt; z = (y - 1) ** 2\n(-9+0j)\n&gt;&gt;&gt; z.real\n-9.0\n&gt;&gt;&gt; z.imag\n0.0\n</code></pre>\n\n<p>But in Haskell:</p>\n\n<pre><code>&gt; let z = (y - 1) ** 2\n&gt; realPart z\n-9.000000000000002\n&gt; imagPart z\n1.1021821192326181e-15\n</code></pre>\n\n<p>Why is this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1515086684, "post_id": 48100438, "comment_id": 83176053, "body": "This is because <code>(-6)</code> is not a function, but <i>minus six</i>. If you want <code>\\x -&gt; x - 6</code>, use <code>subtract 6</code>."}, {"owner": {"reputation": 520, "user_id": 8832008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/756f7ba5fd8d5e18aab8b50dabb2c367?s=128&d=identicon&r=PG&f=1", "display_name": "cmosig", "link": "https://stackoverflow.com/users/8832008/cmosig"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515088125, "post_id": 48100438, "comment_id": 83176765, "body": "Thank you! This problem was &quot;too obvious&quot;.."}], "owner": {"reputation": 520, "user_id": 8832008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/756f7ba5fd8d5e18aab8b50dabb2c367?s=128&d=identicon&r=PG&f=1", "display_name": "cmosig", "link": "https://stackoverflow.com/users/8832008/cmosig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1515086756, "answer_count": 0, "score": 0, "last_activity_date": 1515086556, "creation_date": 1515086556, "question_id": 48100438, "link": "https://stackoverflow.com/questions/48100438/difference-between-those-two-function-calls", "closed_reason": "Duplicate", "title": "Difference between those two function calls", "body": "<pre><code>unfold :: (t -&gt; Bool) -&gt; (t -&gt; a) -&gt; (t -&gt; t) -&gt; t -&gt; [a]\nunfold p f g x \n    | p x = []\n    | otherwise = f x : unfold p f g (g x)\n</code></pre>\n\n<p>This is the function I am currently working with. It is basically a function that \"unfolds\" the argument x and uses two functions and a predicate to determine when the list is supposed to end. Inserting:</p>\n\n<pre><code>unfold (&gt;100) (+6) (+6) 2\n&gt;&gt; [8,14,20,26,32,38,44,50,56,62,68,74,80,86,92,98,104]\n</code></pre>\n\n<p>That output is fine an right. \nBut when I try: </p>\n\n<pre><code>unfold (&gt;100) (+6) (-6) 2\n&lt;interactive&gt;:55:1: error:\n\u2022 Non type-variable argument in the constraint: Num (a -&gt; a)\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    it :: forall a. (Num (a -&gt; a), Num a, Ord a) =&gt; [a]\n</code></pre>\n\n<p>I recieve this error. I tried finding other examples with this error, but those didn't really help me. Do any of you know a solution for that?</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1515067566, "post_id": 48094826, "comment_id": 83164381, "body": "Don&#39;t you just want <code>let gen = arbitrary</code>? (or <code>elems &lt;- vectorOf n arbitrary</code>)."}, {"owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1515067977, "post_id": 48094826, "comment_id": 83164663, "body": "@Lee, I feel stupid now. Indeed, that is the case, <code>gen</code> should not be &quot;unwrapped&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1515074831, "creation_date": 1515074831, "answer_id": 48096992, "question_id": 48094826, "link": "https://stackoverflow.com/questions/48094826/how-to-fix-ambiguity-of-an-arbitrary-instance-of-a-list-like-type/48096992#48096992", "title": "How to fix ambiguity of an Arbitrary instance of a list-like type", "body": "<p><code>vectorOf</code> expects a <code>Gen a</code>. Therefore, GHC tries to find an instance of <code>Arbitrary</code> for <code>Gen a</code>, which doesn't exist.</p>\n\n<p>Use <code>vectorOf n arbitrary</code> or just <code>vector n</code>. Also, it's recommended to use <a href=\"https://hackage.haskell.org/package/QuickCheck-2.10.1/docs/Test-QuickCheck.html#v:sized\" rel=\"nofollow noreferrer\"><code>sized</code></a> to have QuickCheck choose the size:</p>\n\n<pre><code>genList :: Arbitrary a =&gt; Gen (List a)\ngenList = sized $ \\n -&gt;\n    elems &lt;- vector n\n    return $ build elems\n  where build [] = Nil\n        build (e:es) = Cons e (build es)\n</code></pre>\n\n<p>However, at that point we're already better of using <code>listOf</code> instead:</p>\n\n<pre><code>genList :: Arbitrary a =&gt; Gen (List a)\ngenList = build &lt;$&gt; listOf arbitary\n  where build = foldr Cons Nil\n</code></pre>\n\n<p>Note that <code>genList = Cons &lt;$&gt; arbitrary &lt;*&gt; arbitrary</code> won't generate empty lists, whereas <code>foldr Cons Nil &lt;$&gt; listOf arbitrary</code> will.</p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 48096992, "answer_count": 1, "score": 1, "last_activity_date": 1515074831, "creation_date": 1515067209, "question_id": 48094826, "link": "https://stackoverflow.com/questions/48094826/how-to-fix-ambiguity-of-an-arbitrary-instance-of-a-list-like-type", "title": "How to fix ambiguity of an Arbitrary instance of a list-like type", "body": "<p>Consider the following:</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Checkers\nimport Test.QuickCheck.Classes\n\ndata List a = Nil | Cons a (List a) deriving (Eq, Show)\n\ninstance Functor List where\n    fmap _ Nil = Nil\n    fmap f (Cons a l) = Cons (f a) (fmap f l)\n\ninstance Eq a =&gt; EqProp (List a) where (=-=) = eq\n\ngenList :: Arbitrary a =&gt; Gen (List a)\ngenList = do\n    n &lt;- choose (3 :: Int, 5)\n    gen &lt;- arbitrary\n    elems &lt;- vectorOf n gen\n    return $ build elems\n  where build [] = Nil\n        build (e:es) = Cons e (build es)\n\ninstance Arbitrary a =&gt; Arbitrary (List a) where\n    arbitrary = frequency [ (1, return Nil)\n                          , (3, genList)\n                          ]\n\nmain = quickBatch $ functor (Nil :: List (Int, String, Int))\n</code></pre>\n\n<p>This doesn't compile because of the ambiguity in <code>genList</code>:</p>\n\n<pre><code>\u2022 Could not deduce (Arbitrary (Gen a))\n    arising from a use of \u2018arbitrary\u2019\n  from the context: Arbitrary a\n    bound by the type signature for:\n               genList :: forall a. Arbitrary a =&gt; Gen (List a)\n    at reproducer.hs:13:1-38\n\u2022 In a stmt of a 'do' block: gen &lt;- arbitrary\n  In the expression:\n    do n &lt;- choose (3 :: Int, 5)\n       gen &lt;- arbitrary\n       elems &lt;- vectorOf n gen\n       return $ build elems\n  In an equation for \u2018genList\u2019:\n      genList\n        = do n &lt;- choose (3 :: Int, 5)\n             gen &lt;- arbitrary\n             elems &lt;- vectorOf n gen\n             ....\n        where\n            build [] = Nil\n            build (e : es) = Cons e (build es)\n   |\n16 |     gen &lt;- arbitrary\n   |            ^^^^^^^^^\n</code></pre>\n\n<p>I know that I can write <code>genList</code> as <code>genList = Cons &lt;$&gt; arbitrary &lt;*&gt; arbitrary</code>, but I would like to know. How do I remove the ambiguity? Isn't the type assertion in <code>main</code> supposed to clear it?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1515063752, "post_id": 48093699, "comment_id": 83162132, "body": "Is this homework?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1515064726, "post_id": 48093699, "comment_id": 83162670, "body": "Hint: <code>Foldable =&gt; Traversable</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1515066986, "post_id": 48093699, "comment_id": 83164028, "body": "What progress have you made so far?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1515086638, "post_id": 48100161, "comment_id": 83176027, "body": "Thanks to semantic saturation, &quot;blink&quot; just seems like a sound effect to me now instead of a legitimate English word."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1515109600, "post_id": 48100161, "comment_id": 83186076, "body": "How did you get from <code>traverse f x = g (foldMap h x)</code> to <code>traverse f x = g mempty</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1515111952, "post_id": 48100161, "comment_id": 83186726, "body": "@BenjaminHodgson From the definition of <code>foldMap</code>, namely, <code>foldMap f _ = mempty</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1515086283, "last_edit_date": 1515086283, "creation_date": 1515085436, "answer_id": 48100161, "question_id": 48093699, "link": "https://stackoverflow.com/questions/48093699/how-to-implement-traverse-use-foldmap/48100161#48100161", "title": "how to implement traverse use foldMap", "body": "<p>There are <code>Foldable</code> instances for which it can't be done.</p>\n\n<pre><code>data Blonk a = Blink | Blank\n\ninstance Functor Blonk where\n    fmap f Blink = Blink\n    fmap f Blank = Blank\n\ninstance Foldable Blonk where\n    foldMap f _ = mempty\n</code></pre>\n\n<p>The above are the only possible total, law-abiding implementations of <code>Functor</code> and <code>Foldable</code> for <code>Blonk</code>. Now there is a law for <code>Traversable</code>:</p>\n\n<pre><code>traverse Identity = Identity\n</code></pre>\n\n<p>Let's see how it plays out, under the assumption that <code>traverse</code> is implemented in terms of <code>foldMap</code>, that is, that there are some terms <code>g</code> and <code>h</code> (which may mention <code>f</code> if they like) for which:</p>\n\n<pre><code>traverse f = g . foldMap h\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>traverse f x = g (foldMap h x)\n             = g mempty\n-- THEREFORE\ntraverse Identity x = g mempty\n</code></pre>\n\n<p>Note that <code>g mempty</code> does not depend on <code>x</code>, hence must either be <code>Identity Blink</code> or <code>Identity Blank</code> to fit the type. In the former case,</p>\n\n<pre><code>traverse Identity Blank = Identity Blink\n                       != Identity Blank\n</code></pre>\n\n<p>and the law is violated. Similarly <code>traverse Identity Blink</code> is a witness that the law is violated in the other case.</p>\n\n<p>(And, just to prove I'm not pulling any punches, there is a law abiding <code>Traversable</code> instance:</p>\n\n<pre><code>instance Traversable Blonk where\n    traverse f Blink = pure Blink\n    traverse f Blank = pure Blank\n</code></pre>\n\n<p>)</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1515294055, "last_edit_date": 1515294055, "creation_date": 1515289689, "answer_id": 48133647, "question_id": 48093699, "link": "https://stackoverflow.com/questions/48093699/how-to-implement-traverse-use-foldmap/48133647#48133647", "title": "how to implement traverse use foldMap", "body": "<p>Daniel Wagner gave a very good example of a type with a valid <code>Traversable</code> instance that cannot be defined in terms of its <code>Foldable</code> instance. But there are also types with valid <code>Functor</code> and <code>Foldable</code> instances that <em>don't</em> have valid <code>Traversable</code> instances. The main reason for this is that <code>Foldable</code> has practically no laws.</p>\n\n<p>For example, if we wanted, we could write</p>\n\n<pre><code>instance Foldable IO where\n  foldMap _ _ = mempty\n</code></pre>\n\n<p>Such an instance is more confusing than useful, but there's nothing inherently <em>wrong</em> with it. But what happens when we try to write an instance of <code>Traversable IO</code>?</p>\n\n<pre><code>traverse f m = _1\n-- m :: IO a\n-- f :: a -&gt; f b\n-- _1 :: f (IO b)\n</code></pre>\n\n<p>OK, so we need to make something of type <code>f (IO b)</code>. We don't have anything wrapped in <code>f</code> yet, so we can't use <code>&lt;*&gt;</code> to make it; we can only use <code>pure</code>.</p>\n\n<pre><code>traverse f m = pure _2\n-- m :: IO a\n-- f :: a -&gt; f b\n-- _2 :: IO b\n</code></pre>\n\n<p>Uh oh. We know how to make <code>f b</code> values, but we have no way to make <code>b</code> values. Sometimes <code>IO</code> lets us punt using exceptions, but the <code>Traversable</code> identity law doesn't let us get away with that this time.</p>\n"}], "owner": {"reputation": 5756, "user_id": 1436450, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/49ade21b14846e41684616c6e7209db3?s=128&d=identicon&r=PG", "display_name": "Chinaxing", "link": "https://stackoverflow.com/users/1436450/chinaxing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1515294055, "creation_date": 1515063257, "last_edit_date": 1515282836, "question_id": 48093699, "link": "https://stackoverflow.com/questions/48093699/how-to-implement-traverse-use-foldmap", "title": "how to implement traverse use foldMap", "body": "<p>foldMap can be implemented by traverse as :</p>\n\n<pre><code>foldMap f = getConst . traverse (Const . f)\n</code></pre>\n\n<p>so, my question is how to implement traverse by foldMap:</p>\n\n<pre><code>traverse f = ...\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>it Can't be accomplished ?\n</code></pre>\n"}, {"tags": ["performance", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515067054, "post_id": 48093503, "comment_id": 83164087, "body": "I don&#39;t know if this helps, but you can pass arguments to the test executable like this: <code>stack test --test-arguments &quot;my-arg&quot;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1515076195, "last_edit_date": 1515076195, "creation_date": 1515074304, "answer_id": 48096844, "question_id": 48093503, "link": "https://stackoverflow.com/questions/48093503/using-ekg-with-stack-while-testing/48096844#48096844", "title": "Using ekg with stack while testing", "body": "<p>As Mark said, use <code>--test-arguments</code> to provide command line arguments to your test application:</p>\n\n\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack test --test-arguments=\"+RTS -T\"\n</code></pre>\n\n<p>If you don't use <code>stack test</code> but <code>stack exec</code>, make sure to disable RTS parsing in <code>stack</code> itself:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack --RTS exec &lt;executable-name&gt; +RTS &lt;rts-options&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 0, "last_activity_date": 1515076207, "creation_date": 1515076207, "answer_id": 48097394, "question_id": 48093503, "link": "https://stackoverflow.com/questions/48093503/using-ekg-with-stack-while-testing/48097394#48097394", "title": "Using ekg with stack while testing", "body": "<p>Another possibility is to set the compiler options in the <code>.cabal</code> (or <code>package.yaml</code> if using <code>hpack</code>) file:</p>\n\n<pre><code>ghc-options:\n# ...\n- -with-rtsopts=-N\n# ... Add the -T options on top of the other `RTS` options:\n- -with-rtsopts=-T\n# ...\n</code></pre>\n\n<p>Since the <code>-T</code> option has little overhead, this approach does not require to pass any flags to <code>stack</code> in order to get relevant <code>ekg</code> metrics.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 48096844, "answer_count": 2, "score": 0, "last_activity_date": 1515076207, "creation_date": 1515062489, "question_id": 48093503, "link": "https://stackoverflow.com/questions/48093503/using-ekg-with-stack-while-testing", "title": "Using ekg with stack while testing", "body": "<p>I've written some endurance tests, which I run with <code>stack test</code>. I'm also using <a href=\"https://hackage.haskell.org/package/ekg\" rel=\"nofollow noreferrer\"><code>ekg</code></a> for monitoring the performance. This package recommends:</p>\n\n<blockquote>\n  <p>To make full use out of this module you must first enable GC statistics collection in the run-time system. To enable GC statistics collection, either run your program with</p>\n\n<pre><code>+RTS -T\n</code></pre>\n  \n  <p>or compile it with</p>\n\n<pre><code>-with-rtsopts=-T\n</code></pre>\n</blockquote>\n\n<p>I know that stack supports the <code>--profile</code> and <code>--trace</code> options, but I couldn't find any option for passing the <code>+RTS -T</code> options to the test program. Are there any flags I can use for achieving this effect?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1515051277, "post_id": 48090590, "comment_id": 83155584, "body": "Yes, just found this.  Thank you."}], "tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": true, "score": 3, "last_activity_date": 1515050935, "creation_date": 1515050935, "answer_id": 48090590, "question_id": 48090431, "link": "https://stackoverflow.com/questions/48090431/error-creating-new-project-with-haskell-stack/48090590#48090590", "title": "Error creating new project with Haskell Stack", "body": "<p>Same as <a href=\"https://github.com/fpco/stackage/issues/2759\" rel=\"nofollow noreferrer\">https://github.com/fpco/stackage/issues/2759</a> .<br>\nUpgrade stack to v1.6.1</p>\n"}], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1294, "favorite_count": 0, "accepted_answer_id": 48090590, "answer_count": 1, "score": 0, "last_activity_date": 1515050935, "creation_date": 1515050173, "last_edit_date": 1515050646, "question_id": 48090431, "link": "https://stackoverflow.com/questions/48090431/error-creating-new-project-with-haskell-stack", "title": "Error creating new project with Haskell Stack", "body": "<p>Right now I'm not able to do <code>stack new my-project</code> anywhere in my filesystem.  When I do, I get</p>\n\n<pre><code>| =&gt; stack new my-project\nDownloading template \"new-template\" to create project \"my-project\" in my-project/ ...\n\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- my-project/my-project.cabal\n\nSelecting the best among 12 snapshots...\n\nDownloaded lts-10.2 build plan.\nAesonException \"Error in $.packages.cassava.constraints.flags['bytestring--lt-0_10_4']: Invalid flag name: \\\"bytestring--lt-0_10_4\\\"\"\n</code></pre>\n\n<p>This prevents me from setting up and building the project:</p>\n\n<pre><code>| =&gt; cd my-project; stack build\nError parsing targets: The specified targets matched no packages.\nPerhaps you need to run 'stack init'?\n</code></pre>\n\n<p>I have Stack Version 1.5.1 and GHC 8.0.2.  What could be causing this?  I'm really at a loss.  I haven't found anything documented online similar to what I'm describing.  </p>\n"}, {"tags": ["haskell", "ghc", "cabal", "parsec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1515035949, "post_id": 48088143, "comment_id": 83151169, "body": "What happens if you leave off <code>-package parsec</code>? So just run <code>ghc -o main main.hs</code>. <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#ghc-flag--package%20%E2%9F%A8pkg%E2%9F%A9\" rel=\"nofollow noreferrer\"><code>-package</code></a> may not be doing what you think it is."}, {"owner": {"reputation": 233, "user_id": 1306570, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/IfMtg.png?s=128&g=1", "display_name": "Gapry", "link": "https://stackoverflow.com/users/1306570/gapry"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1515036163, "post_id": 48088143, "comment_id": 83151214, "body": "the result is same."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515045480, "post_id": 48088143, "comment_id": 83153393, "body": "Are we to understand the <code>rm:</code> and <code>.&#47;run.sh</code> lines of the error are produced by ghc?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515045571, "post_id": 48088143, "comment_id": 83153425, "body": "What happens when you <code>ghc-pkg check</code> as the error instructs?"}, {"owner": {"reputation": 233, "user_id": 1306570, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/IfMtg.png?s=128&g=1", "display_name": "Gapry", "link": "https://stackoverflow.com/users/1306570/gapry"}, "edited": false, "score": 0, "creation_date": 1515070262, "post_id": 48088143, "comment_id": 83165989, "body": "Dear Thomas, I&#39;m so sorry the message let you unclear. The <code>rm</code> and <code>.&#47;run.sh</code> doesn&#39;t provide by ghc. <code>run.sh</code> just my script to help compile and excute"}, {"owner": {"reputation": 233, "user_id": 1306570, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/IfMtg.png?s=128&g=1", "display_name": "Gapry", "link": "https://stackoverflow.com/users/1306570/gapry"}, "edited": false, "score": 0, "creation_date": 1515070491, "post_id": 48088143, "comment_id": 83166140, "body": "&#39;ghc-pkg check` provide a lot of warning message such as below  <code>Warning: haddock-interfaces: &#47;usr&#47;share&#47;doc&#47;pandoc&#47;html&#47;pandoc.haddock doesn&#39;t exist or isn&#39;t a file</code> <code>Warning: haddock-html: &#47;usr&#47;share&#47;doc&#47;pandoc&#47;html doesn&#39;t exist or isn&#39;t a directory</code> <code>Warning: haddock-interfaces: &#47;usr&#47;share&#47;doc&#47;haskell-xml&#47;html&#47;xml.haddock doesn&#39;t exist or isn&#39;t a file</code> <code>Warning: haddock-html: &#47;usr&#47;share&#47;doc&#47;haskell-xml&#47;html doesn&#39;t exist or isn&#39;t a directory</code> <code>Warning: haddock-interfaces: &#47;usr&#47;share&#47;doc&#47;haskell-texmath&#47;html&#47;texmath.haddock doesn&#39;t exist or isn&#39;t a file</code>"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 0, "last_activity_date": 1515053998, "creation_date": 1515053998, "answer_id": 48091267, "question_id": 48088143, "link": "https://stackoverflow.com/questions/48088143/how-to-use-text-parsec-in-ghc-8-2-2-and-cabal-2-0-0-1/48091267#48091267", "title": "How to use Text.Parsec in GHC-8.2.2 and Cabal-2.0.0.1", "body": "<p>Manjaro might have inherited from Arch's issues with Haskell.</p>\n\n<h3>What is going on</h3>\n\n<p>Arch installs dynamic libraries, but <code>ghc</code> links statically by default. This is also what the error message \"There are files missing in the ... package\", indicating that the package exists but does not contain what <code>ghc</code> is looking for.</p>\n\n<p>If I try compiling with the <code>-v</code> verbose flag on, the error message expands to:</p>\n\n<pre><code>ghc -v main.hs\n\n(...)\nLocations searched:\n  Text/Parsec.hs\n  Text/Parsec.lhs\n  Text/Parsec.hsig\n  Text/Parsec.lhsig\n  /usr/lib/ghc-8.2.2/site-local/parsec-3.1.11/Text/Parsec.hi\n(...)\n</code></pre>\n\n<p>In particular, look into the last reported location, which may be different on your system; if my guess is correct, <code>ghc</code> is looking for a static interface file <code>.hi</code> as the message indicates but there is only a dynamic one <code>.dyn_hi</code>.</p>\n\n<h3>Fix</h3>\n\n<p>Compile with the <code>-dynamic</code> flag.</p>\n\n<pre><code> ghc -dynamic main.hs\n</code></pre>\n\n<p>And if that works read this to fix the setup:</p>\n\n<p><a href=\"https://wiki.archlinux.org/index.php/Haskell\" rel=\"nofollow noreferrer\">https://wiki.archlinux.org/index.php/Haskell</a></p>\n\n<p>You will have to choose between static and dynamic linking; I don't actually understand the trade-off here.</p>\n"}], "owner": {"reputation": 233, "user_id": 1306570, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/IfMtg.png?s=128&g=1", "display_name": "Gapry", "link": "https://stackoverflow.com/users/1306570/gapry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 48091267, "answer_count": 1, "score": 0, "last_activity_date": 1515053998, "creation_date": 1515035465, "question_id": 48088143, "link": "https://stackoverflow.com/questions/48088143/how-to-use-text-parsec-in-ghc-8-2-2-and-cabal-2-0-0-1", "title": "How to use Text.Parsec in GHC-8.2.2 and Cabal-2.0.0.1", "body": "<p>As I know <code>Text.ParserCombinators.Parsec</code> is replaced by <code>Text.Parsec</code></p>\n\n<p>Here, it is my environment</p>\n\n<pre><code>4.9.73-1-MANJARO\n\nThe Glorious Glasgow Haskell Compilation System, version 8.2.2\n\ncabal-install version 2.0.0.1\ncompiled using version 2.0.1.0 of the Cabal library \n</code></pre>\n\n<p>The following source code is my <code>main.hs</code></p>\n\n<pre><code>module Main where\nimport System.Environment\nimport Text.Parsec\n\nmain :: IO ()\nmain = do\n     args &lt;- getArgs\n     putStrLn (readExpr (args !! 0))\n</code></pre>\n\n<p>and then I compile it</p>\n\n<pre><code>$ ghc -package parsec -o main main.hs\n</code></pre>\n\n<p>It occurs the following error messages</p>\n\n<pre><code>[1 of 1] Compiling Main             ( main.hs, main.o )\n\nmain.hs:3:1: error:\n    Could not find module \u2018Text.Parsec\u2019\n    There are files missing in the \u2018parsec-3.1.11\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n  |\n3 | import Text.Parsec\n  | ^^^^^^^^^^^^^^^^^^\nrm: cannot remove '*.hi': No such file or directory\n./run.sh: line 11: ./TestProj: No such file or directory\n</code></pre>\n\n<p>I make sure I have installed <code>parsec</code>. So I want to ask any mistake I've done?</p>\n\n<pre><code>$ cabal install parsec\nResolving dependencies...\nAll the requested packages are already installed:\nparsec-3.1.11\nUse --reinstall if you want to reinstall anyway.\n</code></pre>\n"}]