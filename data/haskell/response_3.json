[{"tags": ["haskell", "types", "monads"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 4, "creation_date": 1422482927, "post_id": 28203347, "comment_id": 44772777, "body": "What do you think the type of that function would be?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3140285"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 2, "creation_date": 1422483794, "post_id": 28203347, "comment_id": 44773160, "body": "I don&#39;t know. At first glance this seems impossible to me. But writing variadic functions in Haskell also seemed impossible to me, until I saw how it can be done with some typeclass magic. Maybe this is possible too, using typeclasses, or one of the type system extensions. I can&#39;t tell, which is why I am asking here."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1422485359, "post_id": 28203347, "comment_id": 44773773, "body": "There are values <code>x</code> such that <code>join x</code> <i>and</i> <code>join1 x</code> <i>and</i> <code>join2 x</code> are all well-typed. If you have this <code>joinN</code> function and say <code>joinN x</code>, which of the joins will get selected and why?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3140285"}, "edited": false, "score": 0, "creation_date": 1422531684, "post_id": 28203347, "comment_id": 44791189, "body": "Thank you for all your great answers! Reading them has really helped me to understand Haskell&#39;s type system better."}], "answers": [{"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 5, "last_activity_date": 1422488752, "last_edit_date": 1422488752, "creation_date": 1422488409, "answer_id": 28204531, "question_id": 28203347, "link": "https://stackoverflow.com/questions/28203347/taking-monadic-functions-out-of-a-monad/28204531#28204531", "title": "Taking monadic functions out of a monad", "body": "<p>You can do something like this with a fair amount of ugliness if you really desire.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Control.Monad (join, liftM)\n\nclass Joinable m z | z -&gt; m where\n  joins :: m z -&gt; z\n\ninstance Monad m =&gt; Joinable m (m a) where\n  joins = join\n\ninstance (Monad m, Joinable m z) =&gt; Joinable m (r -&gt; z) where\n  joins m r = joins (liftM ($ r) m)\n</code></pre>\n\n<p>But, as you can see this relies on some shaky typeclass magic (in particular, the unenviable <code>UndecidableInstances</code>). It is quite possibly better\u2014if ugly looking\u2014to write all of the instances <code>join1</code>...<code>join10</code> and export them directly. This is the pattern established in the <code>base</code> library as well.</p>\n\n<p>Notably, inference won't work too well under this regime. For instance</p>\n\n<pre><code>\u03bb&gt; joins (return (\\a b -&gt; return (a + b))) 1 2\nOverlapping instances for Joinable ((-&gt;) t0) (t0 -&gt; t0 -&gt; IO t0)\n  arising from a use of \u2018joins\u2019\nMatching instances:\n  instance Monad m =&gt; Joinable m (m a)\n    -- Defined at /Users/tel/tmp/ASD.hs:11:10\n  instance (Monad m, Joinable m z) =&gt; Joinable m (r -&gt; z)\n    -- Defined at /Users/tel/tmp/ASD.hs:14:10\n</code></pre>\n\n<p>but if we give an explicit type to our argument</p>\n\n<pre><code>\u03bb&gt; let {q :: IO (Int -&gt; Int -&gt; IO Int); q = return (\\a b -&gt; return (a + b))}\n</code></pre>\n\n<p>then it can still work as we hope</p>\n\n<pre><code>\u03bb&gt; joins q 1 2\n3\n</code></pre>\n\n<p>This arises because with typeclasses alone it becomes quite difficult to indicate whether you want to operate on the monad <code>m</code> in the final return type of the function chain or the monad <code>(-&gt;) r</code> that <em>is the function chain</em> itself.</p>\n"}, {"tags": [], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "is_accepted": false, "score": 3, "last_activity_date": 1422498902, "last_edit_date": 1422498902, "creation_date": 1422489153, "answer_id": 28204643, "question_id": 28203347, "link": "https://stackoverflow.com/questions/28203347/taking-monadic-functions-out-of-a-monad/28204643#28204643", "title": "Taking monadic functions out of a monad", "body": "<p>The short answer is no. The slightly longer answer is you could probably define an infix operator.</p>\n\n<p>Take a look at the implementation for <code>liftM</code>: <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/Control-Monad.html#liftM\" rel=\"nofollow\">http://hackage.haskell.org/package/base-4.7.0.2/docs/src/Control-Monad.html#liftM</a></p>\n\n<p>It defines up to liftM5. This is because it's not possible to define liftMN, just like your joinN isn't possible.</p>\n\n<p>But we can take a lesson from Appicative <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> and define our own infix operator:</p>\n\n<pre><code>&gt; let infixr 1 &lt;~&gt; ; x &lt;~&gt; f = fmap ($ x) f\n&gt; :t (&lt;~&gt;)\n(&lt;~&gt;) :: Functor f =&gt; a -&gt; f (a -&gt; b) -&gt; f b\n&gt; let foo x y = Just (x + y)\n&gt; let foobar = Just foo\n&gt; join $ 1 &lt;~&gt; 2 &lt;~&gt; foobar\nJust 3\n</code></pre>\n\n<p>This is quite reminiscent of a common applicative pattern:</p>\n\n<pre><code>f &lt;$&gt; a1 &lt;*&gt; a2 .. &lt;*&gt; an\njoin $ a1 &lt;~&gt; a2 .. &lt;~&gt; an &lt;~&gt; f\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422494021, "post_id": 28204928, "comment_id": 44776526, "body": "As far as I&#39;m concerned, &quot;works with <code>IncoherentInstances</code>&quot; means &quot;doesn&#39;t work&quot;, and &quot;works with <code>OverlappingInstances</code>&quot; means &quot;might work sometimes, but shouldn&#39;t be relied on.&quot;"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422494177, "post_id": 28204928, "comment_id": 44776566, "body": "@dfeuer: It seems okay here if you just don&#39;t export the class so nobody else can add any instances. (Well, unless it&#39;s already broken for <code>(-&gt;) r</code>.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422499520, "post_id": 28204928, "comment_id": 44777898, "body": "This makes me wonder if a closed type family distinguishing functions from other things might help matters. In the event that such a thing works, it might be less shady, maybe."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 1, "last_activity_date": 1422490678, "creation_date": 1422490678, "answer_id": 28204928, "question_id": 28203347, "link": "https://stackoverflow.com/questions/28203347/taking-monadic-functions-out-of-a-monad/28204928#28204928", "title": "Taking monadic functions out of a monad", "body": "<p>A single function for every possible <code>N</code>? Not really. Generalizing over functions with different numbers of arguments like this is difficult in Haskell, in part because \"number of arguments\" is not always well-defined. The following are all valid specializations of <code>id</code>'s type:</p>\n\n<pre><code>id :: a -&gt; a\nid :: (a -&gt; a) -&gt; a -&gt; a\nid :: (a -&gt; a -&gt; a) -&gt; a -&gt; a -&gt; a\n...\n</code></pre>\n\n<p>We'd need <em>some</em> way to get <code>N</code> at the type level, and then do a different thing depending on what <code>N</code> is.</p>\n\n<p>Existing \"variadic\" functions like <code>printf</code> do this with typeclasses. They establish what <code>N</code> is by induction on <code>-&gt;</code>: they have a \"base case\" instance for a non-function type like <code>String</code> and a recursive instance for functions:</p>\n\n<pre><code>instance PrintfType String ...\ninstance (PrintfArg a, PrintfType r) =&gt; PrintfType (a -&gt; r) ...\n</code></pre>\n\n<p>We can (after a lot of thinking :P) use the same approach here, with one caveat: our base case is a bit ugly. We want to start with the normal <code>join</code>, which produces a result of type <code>m a</code>; the problem is that to support <em>any</em> <code>m a</code>, we have to overlap with normal functions. This means that we need to enable a few scary extensions and that we might confuse the type inference system when we actually use our <code>joinN</code>. But, with the right type signatures in place, I believe it should work correctly.</p>\n\n<p>First off, here's the helper class:</p>\n\n<pre><code>class Monad m =&gt; JoinN m ma where\n  joinN :: m ma -&gt; ma\n</code></pre>\n\n<p><code>ma</code> will take the relevant function type like <code>a -&gt; m b</code>, <code>a -&gt; b -&gt; m c</code> and so on. I couldn't figure out how to leave <code>m</code> out of the class definition, so right off the bat we need to enable <code>MultiParamTypeClasses</code>.</p>\n\n<p>Next, our base case, which is just normal <code>join</code>:</p>\n\n<pre><code>instance Monad m =&gt; JoinN m (m a) where\n  joinN = join\n</code></pre>\n\n<p>Finally, we have our recursive case. What we need to do is \"peel off\" an argument and then implement the function in terms of a smaller <code>joinN</code>. We do this with <code>ap</code>, which is <code>&lt;*&gt;</code> specialized to monads:</p>\n\n<pre><code>instance (Monad m, JoinN m ma) =&gt; JoinN m (b -&gt; ma) where\n  joinN m arg = joinN (m `ap` return arg)\n</code></pre>\n\n<p>We can read the <code>=&gt;</code> in the instance as implication: if we know how to <code>joinN</code> an <code>ma</code>, we also know how to do a <code>b -&gt; ma</code>.</p>\n\n<p>This instance is slightly weird, so it requires <code>FlexibleInstances</code> to work. More troublingly, because our base case (<code>m (m a)</code>) is made up entirely of variables, it actually overlaps with a bunch of other reasonable types. To actually make this work we have to enable <code>OverlappingInstances</code> and <code>IncoherentInstances</code>, which are relatively tricky and bug-prone.</p>\n\n<p>After a bit of cursory testing, it <em>seems</em> to work:</p>\n\n<pre><code>\u03bb&gt; let foo' = do getLine &gt;&gt;= \\ x -&gt; return $ \\ a b c d -&gt; putStrLn $ a ++ x ++ b ++ x ++ c ++ x ++ d\n\u03bb&gt; let join4 m a b c d = m &gt;&gt;= \\ f -&gt; f a b c d\n\u03bb&gt; join4 foo' \"a\" \"b\" \"c\" \"d\"\n\na  b  c  d\n\u03bb&gt; joinN foo' \"a\" \"b\" \"c\" \"d\"\n\na  b  c  d\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3140285"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 28204531, "answer_count": 3, "score": 2, "last_activity_date": 1422498902, "creation_date": 1422482841, "question_id": 28203347, "link": "https://stackoverflow.com/questions/28203347/taking-monadic-functions-out-of-a-monad", "title": "Taking monadic functions out of a monad", "body": "<p>Haskell has the function <code>join</code>, which \"runs\" a monadic action which is inside a monad:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\njoin m = m &gt;&gt;= \\f -&gt; f\n</code></pre>\n\n<p>We can write a similar function for monadic functions with one argument:</p>\n\n<pre><code>join1 :: Monad m =&gt; m (a -&gt; m b) -&gt; (a -&gt; m b)\njoin1 m arg1 = m &gt;&gt;= \\f -&gt; f arg1\n</code></pre>\n\n<p>And for two arguments:</p>\n\n<pre><code>join2 :: Monad m =&gt; m (a -&gt; b -&gt; m c) -&gt; (a -&gt; b -&gt; m c)\njoin2 m arg1 arg2 = m &gt;&gt;= \\f -&gt; f arg1 arg2\n</code></pre>\n\n<p>Is it possible to write a general function <code>joinN</code>, that can handle monadic functions with N arguments?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 4, "creation_date": 1422483806, "post_id": 28203214, "comment_id": 44773172, "body": "Like everything else in Haskell, the <code>IO</code> value is not strict and therefore is evaluated only as needed."}, {"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1422483813, "post_id": 28203214, "comment_id": 44773175, "body": "All types -- including <code>IO ()</code> -- have an extra value called <a href=\"https://wiki.haskell.org/Bottom\" rel=\"nofollow noreferrer\">bottom</a>. So <code>main</code> is technically &quot;returning&quot; an <code>IO ()</code>; it&#39;s just that it&#39;s returning the most boring <code>IO ()</code>: \u22a5. Haskell can never evaluate the &quot;whole&quot; <code>main</code>, but due to non-strictness it can try."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1422483994, "post_id": 28203214, "comment_id": 44773238, "body": "If you think you&#39;re confused now, just wait till you learn about <code>fixIO::(a-&gt;IO a)-&gt;IO a</code>."}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1422484360, "post_id": 28203214, "comment_id": 44773409, "body": "@IanHenry: At the top level it&#39;s strict, but the subexpressions are not.  So I guess &quot;WHNF&quot; would be a better way to say it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 1, "creation_date": 1422485427, "post_id": 28203214, "comment_id": 44773800, "body": "@IanHenry, <code>main</code> <i>is</i> an <code>IO ()</code> which means that it <i>returns</i>  a <code>()</code>. The <code>()</code> it returns is \u22a5, which is no more boring than the only other value of that type, namely <code>()</code>. This particular \u22a5, however, can never be reached, no matter what. It&#39;s similar in that regard to the one that occurs in the list <code>[1::Integer ..] ++ undefined</code>."}, {"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422485933, "post_id": 28203214, "comment_id": 44774030, "body": "@dfeuer a pretty important distinction that makes this make a lot more sense to me, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 10, "creation_date": 1422484258, "post_id": 28203302, "comment_id": 44773362, "body": "You may want to mention that for <code>IO</code>, the <code>&gt;&gt;=</code> operation is strict in its left operand, but lazy in its right operand. It needs to know what to do first, but it doesn&#39;t need to know how to figure out what comes next until it&#39;s done the first thing."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 15, "last_activity_date": 1422482663, "creation_date": 1422482663, "answer_id": 28203302, "question_id": 28203214, "link": "https://stackoverflow.com/questions/28203214/why-how-does-recursive-io-work/28203302#28203302", "title": "Why/how does recursive IO work?", "body": "<p>In this case, <code>main</code> is a <em>value</em> of type <code>IO ()</code> rather than a function. You can think of it as a sequence of <code>IO a</code> values:</p>\n\n<pre><code>main = getLine &gt;&gt;= putStrLn &gt;&gt; main\n</code></pre>\n\n<p>This makes it a recursive value, not unlike infinite lists:</p>\n\n<pre><code>foo = 1 : 2 : foo\n</code></pre>\n\n<p>We can return a value like this without needing to evaluate the whole thing. In fact, it's a reasonably common idiom.</p>\n\n<p><code>foo</code> <em>will</em> loop forever if you try to use the whole thing. But that's true of <code>main</code> too: unless you use some external method to break out of it, it will never stop looping! But you can start getting elements out of <code>foo</code>, or executing parts of <code>main</code>, without evaluating all of it.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 8, "last_activity_date": 1422514712, "creation_date": 1422514712, "answer_id": 28208704, "question_id": 28203214, "link": "https://stackoverflow.com/questions/28203214/why-how-does-recursive-io-work/28208704#28208704", "title": "Why/how does recursive IO work?", "body": "<p>The value <code>main</code> denotes is an infinite program:</p>\n\n<pre><code>main = do\n  line &lt;- getLine\n  putStrLn line\n  line &lt;- getLine\n  putStrLn line\n  line &lt;- getLine\n  putStrLn line\n  line &lt;- getLine\n  putStrLn line\n  line &lt;- getLine\n  putStrLn line\n  line &lt;- getLine\n  putStrLn line\n  ...\n</code></pre>\n\n<p>But it's <em>represented</em> in memory as a recursive structure that references itself. That representation is finite, unless someone tries to unfold the entire thing to get a non-recursive representation of the entire program - <em>that</em> would never finish.</p>\n\n<p>But just as you can probably figure out how to start executing the infinite program I wrote above without waiting for me to tell you \"all\" of it, so can Haskell's runtime system figure out how to execute <code>main</code> without unfolding the recursion up-front.</p>\n\n<p>Haskell's lazy evaluation is actually interleaved with the runtime system's execution of the <code>main</code> IO program, so this works even for a function that returns an <code>IO</code> action which recursively invokes the function, like:</p>\n\n<pre><code>main = foo 1\n\nfoo :: Integer -&gt; IO ()\nfoo x = do\n  print x\n  foo (x + 1)\n</code></pre>\n\n<p>Here <code>foo 1</code> is not a recursive <em>value</em> (it contains <code>foo 2</code>, not <code>foo 1</code>), but it's still an infinite program. However this works just fine, because the program denoted by <code>foo 1</code> is only generated lazily on-demand; it can be produced as the runtime system's execution of <code>main</code> goes along.</p>\n\n<p>By default Haskell's laziness means that nothing is evaluated until it's needed, and then only \"just enough\" to get past the current block. Ultimately the source of all the \"need\" in \"until it's needed\" comes from the runtime system needing to know what the next step in the <code>main</code> program is so it can execute it. But it's only ever the <em>next</em> step; the rest of the program after that can remain unevaluated until after the next step has been fully executed. So infininte programs can be executed and do useful work so long as it's always only a finite amount of work to generate \"one more step\".</p>\n"}], "owner": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 28203302, "answer_count": 2, "score": 10, "last_activity_date": 1422545422, "creation_date": 1422482341, "last_edit_date": 1422545422, "question_id": 28203214, "link": "https://stackoverflow.com/questions/28203214/why-how-does-recursive-io-work", "title": "Why/how does recursive IO work?", "body": "<p>Haskell IO is often explained in terms of the entire program being a pure function (<code>main</code>) that returns an IO value (often described as an imperative IO program), which is then executed by the runtime.</p>\n\n<p>This mental model works fine for simple examples, but fell over for me as soon as I saw a recursive <code>main</code> in <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"noreferrer\">Learn You A Haskell</a>. For example:</p>\n\n<pre><code>main = do\n  line &lt;- getLine\n  putStrLn line\n  main \n</code></pre>\n\n<p>Or, if you prefer:</p>\n\n<pre><code>main = getLine &gt;&gt;= putStrLn &gt;&gt; main\n</code></pre>\n\n<p>Since <code>main</code> never terminates, it never actually returns an IO value, yet the program endlessly reads and echoes back lines just fine - so the simple explanation above doesn't quite work. Am I missing something simple or is there a more complete explanation (or is it 'simply' compiler magic) ?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 4, "creation_date": 1422482828, "post_id": 28203125, "comment_id": 44772735, "body": "I don&#39;t understand your constraints. Why is <code>foldr</code> allowed, but constructors are not? Is <code>foldr</code> the only list function that is allowed?"}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 2, "last_activity_date": 1422483361, "creation_date": 1422483361, "answer_id": 28203477, "question_id": 28203125, "link": "https://stackoverflow.com/questions/28203125/generic-version-of-tail-for-list-type-in-haskell/28203477#28203477", "title": "Generic version of tail for List type in Haskell", "body": "<p>I'm assuming that by \"without using constructors\" you mean \"without pattern matching on the constructors for the <code>[]</code> type\".  If this assumption is wrong then this answer might not be what you're looking for.</p>\n\n<hr>\n\n<p>You can do it pretty easily using <code>Maybe</code>:</p>\n\n<pre><code>import Data.Maybe\n\ntail'\n    = fromJust    -- Substitute if you want a different error message for empty lists\n    . foldl go Nothing\n    where\n        go Nothing _ = Just []\n        go (Just y) x = Just $ y ++ [x]\n</code></pre>\n\n<p>This isn't the most efficient solution, it's just a proof by construction.</p>\n\n<p>Similarly you can implement <code>init</code> with</p>\n\n<pre><code>init'\n    = fromJust'\n    . foldr go Nothing\n    where\n        go _ Nothing = Just []\n        go x (Just y) = Just $ x : y\n        fromJust' (Just x) = x\n        fromJust' Nothing = error \"init': empty list\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1422522831, "creation_date": 1422522831, "answer_id": 28210823, "question_id": 28203125, "link": "https://stackoverflow.com/questions/28203125/generic-version-of-tail-for-list-type-in-haskell/28210823#28210823", "title": "Generic version of tail for List type in Haskell", "body": "<p><code>foldr</code> roughly transforms the list into its Church encoding of type</p>\n\n<pre><code>forall b . b -&gt; (a -&gt; b -&gt; b) -&gt; b\n</code></pre>\n\n<p>Essentially, strips away all the <code>:</code> and <code>[]</code> constructors, replacing them with two user-provided values.</p>\n\n<p>If you want the head, then you can do it easily, as you noticed. However, if you want the tail, you have to re-insert the <code>:</code> constructor which has been stripped away. For instance, @bheklilr's solution has to use constructors in its <code>go</code> part for this reason.</p>\n"}], "owner": {"reputation": 61, "user_id": 4034814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d349f98e4c1f9702fcb29b1966f15e14?s=128&d=identicon&r=PG&f=1", "display_name": "kindl", "link": "https://stackoverflow.com/users/4034814/kindl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1422522831, "creation_date": 1422481974, "last_edit_date": 1495541191, "question_id": 28203125, "link": "https://stackoverflow.com/questions/28203125/generic-version-of-tail-for-list-type-in-haskell", "title": "Generic version of tail for List type in Haskell", "body": "<p>It is quite easy to express <em>head</em> with <em>foldr</em>:</p>\n\n<pre><code>head xs = foldr const (error \"Empty list\") xs\n</code></pre>\n\n<p>Is there a generic way to express <em>tail</em> without using constructors?\nI already found this answer (<a href=\"https://stackoverflow.com/questions/15651772/getting-the-head-and-tail-of-a-custom-list-type-haskell\">Getting the head and tail of a custom List type Haskell</a>) which says \"no\". If this is impossible could someone please explain why?</p>\n"}, {"tags": ["haskell", "nix"], "answers": [{"tags": [], "owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "is_accepted": false, "score": 4, "last_activity_date": 1447946214, "creation_date": 1447946214, "answer_id": 33807727, "question_id": 28202394, "link": "https://stackoverflow.com/questions/28202394/nix-haskell-using-default-nix-from-cabal2nix-and-a-generic-shell-nix/33807727#33807727", "title": "Nix &amp; Haskell - using default.nix from cabal2nix and a generic shell.nix", "body": "<p>The <code>propagatedNativeBuildInputs</code> attribute is used by Haskell <em>libraries</em> to\npropagate their build inputs down to other builds that depend on them. Your\npackage, however, is not a library --- it's an executable ---, so there's no\nneed to propagate the build inputs and thus <code>propagatedNativeBuildInputs</code> is\nempty. Instead, you'll find the information you need in\n<code>hs.thispackage.extraBuildInputs</code>.</p>\n\n<p>Generally speaking, the definition of these kind of <code>nix-shell</code> environments\nhas become a lot easier in the release-15.09 branch (or nixos-unstable),\nthough. Simply run <code>cabal2nix --shell . &gt;shell.nix</code> and you get a <code>shell.nix</code>\nfile that you can use for building with <code>nix-build shell.nix</code> as well as for\nentering an interactive development environment with <code>nix-shell</code>.</p>\n\n<p><a href=\"http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure\" rel=\"nofollow\">http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure</a> has\na lot more information about the subject.</p>\n"}], "owner": {"reputation": 51, "user_id": 1232404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620d5322f11856571ea64db9f56f9f5c?s=128&d=identicon&r=PG", "display_name": "GIB", "link": "https://stackoverflow.com/users/1232404/gib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1447946214, "creation_date": 1422479195, "question_id": 28202394, "link": "https://stackoverflow.com/questions/28202394/nix-haskell-using-default-nix-from-cabal2nix-and-a-generic-shell-nix", "title": "Nix &amp; Haskell - using default.nix from cabal2nix and a generic shell.nix", "body": "<p>From a pretty basic cabal file</p>\n\n<pre><code>cabal2nix ./. &gt; default.nix \n</code></pre>\n\n<p>and then a shell.nix of </p>\n\n<pre><code>let\n  pkgs = import &lt;nixpkgs&gt; {};\n  haskellPackages = pkgs.haskellPackages_ghc784.override {\n    extension = self: super: {\n      thispackage = self.callPackage ./default.nix {};\n    };\n  };\nin pkgs.myEnvFun {\n     name = haskellPackages.thispackage.name;\n     buildInputs = [\n       (haskellPackages.ghcWithPackages (hs: ([\n         hs.cabalInstall\n       ] ++ hs.thispackage.propagatedNativeBuildInputs)))\n     ];\n   }\n</code></pre>\n\n<p>When in the nix-shell and running cabal configure it complains of missing packages such as text.</p>\n\n<p>If I put the text package explicitly into the shell.nix such as</p>\n\n<pre><code>let\n  pkgs = import &lt;nixpkgs&gt; {};\n  haskellPackages = pkgs.haskellPackages_ghc784.override {\n    extension = self: super: {\n      thispackage = self.callPackage ./default.nix {};\n    };\n  };\nin pkgs.myEnvFun {\n     name = haskellPackages.thispackage.name;\n     buildInputs = [\n       (haskellPackages.ghcWithPackages (hs: ([\n         hs.cabalInstall\n         hs.text\n       ] ++ hs.thispackage.propagatedNativeBuildInputs)))\n     ];\n   } \n</code></pre>\n\n<p>The cabal configure is fine, but I would expect hs.thispackage.propagatedNativeBuildInputs to be supplying these packages.</p>\n\n<p>The very basic haskell project can be seen at </p>\n\n<p><a href=\"https://github.com/fatlazycat/haskell-nix-helloworld\" rel=\"nofollow\">https://github.com/fatlazycat/haskell-nix-helloworld</a></p>\n\n<p>Am I wrong in assuming you can work in this way ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1422477380, "creation_date": 1422477380, "answer_id": 28201930, "question_id": 28201653, "link": "https://stackoverflow.com/questions/28201653/trouble-with-list-padding-function-types/28201930#28201930", "title": "Trouble with list padding function types", "body": "<p>Here's how to fix it:</p>\n\n<pre><code>padList :: (Num a) =&gt; [a] -&gt; Int -&gt; [a]\n                             ^^^\npadList x len = if length(x) &gt;= len then x else padList ([0] ++ x) len\n                                                        ^^^^^^^^^^\n</code></pre>\n\n<p>The expression <code>([0]:x)</code> means that x is a list and <code>[0]</code> is an example of an element of x. That is, x is a list of a list of Ints.</p>\n\n<p>The expression <code>[0] ++ x</code> means that both <code>[0]</code> and <code>x</code> are lists of the same type, i.e. both are lists of Ints. Alternatively you could use <code>(0:x)</code>.</p>\n\n<p>Also, <code>length x</code> returns an Int, not a general <code>Num a</code>, so you can't use <code>a</code> as the type for the second argument.</p>\n"}, {"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 1, "last_activity_date": 1422478392, "creation_date": 1422478392, "answer_id": 28202183, "question_id": 28201653, "link": "https://stackoverflow.com/questions/28201653/trouble-with-list-padding-function-types/28202183#28202183", "title": "Trouble with list padding function types", "body": "<p>A couple of things are wrong here, so let's break it down:</p>\n\n<pre><code>padList :: (Num a) =&gt; [a] -&gt; a -&gt; [a]                  \npadList x len = if length(x) &gt;= len then x else padList ((x ++ 0) len)\n</code></pre>\n\n<p>The type of length is <code>length :: [a] -&gt; Int</code>, so when comparing <code>length x &gt;= len</code> this forces <code>len</code> to be of the type <code>Int</code>. Since a more specific type is required then what you've declared this will throw an error. This can be fixed by changing the type signature.</p>\n\n<pre><code>padList :: (Num a) =&gt; [a] -&gt; Int -&gt; [a] \n</code></pre>\n\n<p>The type is now correct, but the function still isn't. The type of <code>(++)</code> is <code>(++) :: [a] -&gt; [a] -&gt; [a]</code> which means it expects all the elements to be of the same type. </p>\n\n<p>If you were to define the function </p>\n\n<pre><code>padList x len = if length(x) &gt;= len then x else padList (x ++ 0) len\n</code></pre>\n\n<p>without a type signature the compiler would actually except it due to the <code>Num</code> typeclass. But the inferred type would be <code>Num [a] =&gt; [a] -&gt; Int -&gt; [a]</code></p>\n\n<p>This is because what you're actually doing when doing <code>(x++0)</code> I have a <code>x</code> which is of some type <code>[a]</code> and a <code>0</code> which is of type <code>Num a =&gt; a</code> so if I should be able to use <code>(++)</code> on these two items, then there must be a Num instance out there for <code>Num [a] =&gt; a</code>. This is most certainly not what you want.</p>\n\n<p>Instead you want to add the list of <code>[0]</code> to <code>x</code> :</p>\n\n<pre><code>padList x len = if length(x) &gt;= len then x else padList ((x ++ [0]) len)\n</code></pre>\n\n<p>Now to answer your original problem, the error you're getting </p>\n\n<pre><code>`padList' is applied to too few arguments\n</code></pre>\n\n<p>is because you're extra parenthesis are making the compiler think that <code>((x ++ [0]) len)</code> is one argument, it's thinking you're applying <code>(x ++ [0])</code> to <code>len</code>. You don't want the parenthesis</p>\n\n<pre><code>padList x len = if length(x) &gt;= len then x else padList (x ++ [0]) len\n</code></pre>\n\n<p>also the one around <code>length(x)</code> isn't needed either, you can simply do <code>length x</code></p>\n"}], "owner": {"reputation": 47363, "user_id": 146780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48ea519fede5177604945a5c430e6e19?s=128&d=identicon&r=PG", "display_name": "jmasterx", "link": "https://stackoverflow.com/users/146780/jmasterx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 28201930, "answer_count": 2, "score": 0, "last_activity_date": 1422478392, "creation_date": 1422476479, "last_edit_date": 1422477138, "question_id": 28201653, "link": "https://stackoverflow.com/questions/28201653/trouble-with-list-padding-function-types", "title": "Trouble with list padding function types", "body": "<p>I'm working on a function that pads a list of Num with 0s until it is at least as long as the requested length.</p>\n\n<pre><code>main = do\n       putStrLn $ show ( padList [1,2,3] 5)\n\npadList :: (Num a) =&gt; [a] -&gt; a -&gt; [a]                  \npadList x len = if length(x) &gt;= len then x else padList ((x ++ 0) len)\n</code></pre>\n\n<p>But I keep getting:</p>\n\n<pre><code>prog.hs:9:49:\n    Couldn't match expected type `[a]'\n                with actual type `Integer -&gt; [Integer]'\n    In the return type of a call of `padList'\n    Probable cause: `padList' is applied to too few arguments\n    In the expression: padList (([0] : x) len)\n    In the expression:\n      if length (x) &gt;= len then x else padList ((x ++ 0) len)\n</code></pre>\n\n<p>Could anyone point me in the right direction as to what I'm doing wrong?</p>\n\n<p>I'm trying to append x to list [0] until I get:</p>\n\n<pre><code>[1,2,3,0,0]\n</code></pre>\n\n<p>However, my lists might be float so:\n[1.0,2.0,3.0] might become => [1.0,2.0,3.0,0.0,0.0]</p>\n\n<p>I'm not too concerned with performance, I'm just trying to learn functional programming.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["parsing", "haskell", "types", "monads"], "comments": [{"owner": {"reputation": 1702, "user_id": 1408005, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f155380babfb7dd23b13b5fb9c6abc2?s=128&d=identicon&r=PG", "display_name": "Elliot", "link": "https://stackoverflow.com/users/1408005/elliot"}, "edited": false, "score": 0, "creation_date": 1483440827, "post_id": 28200987, "comment_id": 70089666, "body": "I don&#39;t know the answer, but I believe that these lectures go along with the module called Text.ParserCombinators.HuttonMeijer . After installing this I was able to go like in the lectures, except typing papply instead of parse: ///// Prelude&gt; :m Text.ParserCombinators.HuttonMeijer ///// Prelude Text.ParserCombinators.HuttonMeijer&gt; ///// Prelude Text.ParserCombinators.HuttonMeijer&gt; papply item &quot;abc&quot; ///// [(&#39;a&#39;,&quot;bc&quot;)]"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1422480300, "post_id": 28201550, "comment_id": 44771449, "body": "Thanks; that makes more sense. A word is missing from your sentence: &quot;You could your <i>own monad</i> instance [...]&quot;. Did you mean &quot;define&quot;? Also, I don&#39;t think Meijer is using anything fancier than the code in my question. I&#39;m surprised that his code doesn&#39;t work as advertised."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1422480863, "post_id": 28201550, "comment_id": 44771728, "body": "@Jubobs: Oh yes, that was a typo. Fixed it now. I&#39;m not sure what he&#39;s doing, and I can&#39;t watch the lecture right now, but if he defined his own <code>return</code> (with that exact name, unlike your <code>return&#39;</code>), he&#39;s probably doing <i>something</i> special. But I really don&#39;t know."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 5, "last_activity_date": 1422480767, "last_edit_date": 1422480767, "creation_date": 1422476128, "answer_id": 28201550, "question_id": 28200987, "link": "https://stackoverflow.com/questions/28200987/why-am-i-getting-a-type-error-in-this-sequence-of-parsers-lecture-8-by-erik-mei/28201550#28201550", "title": "Why am I getting a type error in this sequence of parsers (lecture 8 by Erik Meijer)?", "body": "<p>This error message is a little bit confusing because GHC unpacked your <code>Parser</code> type into its definition of <code>String -&gt; [(a, String)]</code>. If we undo this transformation, it'll start making a bit more sense:</p>\n\n<pre><code>Expected type: Parser (Char, Char)\n  Actual type: Parser ([(Char, String)], [(Char, String)])\n</code></pre>\n\n<p>Now it's starting to make a bit more sense. What it looks like is that you took the result of two calls to a <code>Parser Char</code> (ie <code>[(Char, String)]</code>) and then used them as if they were normal <code>Char</code>s. The error happens at line 15, which is your call to <code>return'</code>:</p>\n\n<pre><code>return' (x, y)\n</code></pre>\n\n<p>This tells us that <code>x</code> and <code>y</code> are the two problematic results.</p>\n\n<p>The do block you have is using the monad instance for functions of the type <code>String -&gt; b</code>; what this does is combine them into a larger function of <code>String -&gt; b</code> by stringing the input (<code>String</code>) through all of the functions. A line like <code>x &lt;- item</code> lets you get the <code>b</code> element from the <code>String -&gt; b</code> function while maintaining all the plumbing to pass the <code>String</code> argument through. Unfortunately, <code>item</code> is a <code>Parser Char</code>, which means the <code>b</code> is actually a <code>[(Char, String)]</code> and not just a <code>Char</code>.</p>\n\n<p>This extra returned structure is needed to parse correctly. The <code>String</code> represents the rest of the input that was not consumed to parse the <code>Char</code> (or whatever you're parsing) and the whole thing is a list because there can be multiple possible ways to validly parse part of the input which all need to be handled.</p>\n\n<p>To make this work, you have to have some way to take care of this extra structure. However, since I haven't followed the course or watched the lecture, I don't know what it is. You could define <em>your own</em> monad instance instead of relying on the built-in instance for functions, but you might not have gotten far enough into the class to do this yourself, or Meijer might be using a non-standard library to avoid this issue, in which case you need to make sure your setup matches what the class expects.</p>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1423948092, "post_id": 28201685, "comment_id": 45357420, "body": "As far as I can tell, your answer is spot on. Because <code>Parser a</code> is not a derived instance of <code>Monad</code>, the do syntax that applies is not the one the author expects. The <a href=\"http://www.cs.nott.ac.uk/~gmh/errata.html\" rel=\"nofollow noreferrer\">book&#39;s errata</a> mentions a problem, which I believe is the one I was experiencing. Everything works as expected if, instead of using the do syntax, I use the desugared syntax, with Hutton&#39;s definition for <code>&gt;&gt;=</code>. The author also posted a <a href=\"http://www.cs.nott.ac.uk/~gmh/Parsing.lhs\" rel=\"nofollow noreferrer\">different version of the code</a>, in which <code>Parser a</code> is made an instance of <code>Monad</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1422476555, "creation_date": 1422476555, "answer_id": 28201685, "question_id": 28200987, "link": "https://stackoverflow.com/questions/28200987/why-am-i-getting-a-type-error-in-this-sequence-of-parsers-lecture-8-by-erik-mei/28201685#28201685", "title": "Why am I getting a type error in this sequence of parsers (lecture 8 by Erik Meijer)?", "body": "<p>The problem is that the do notation in your definition of <code>p</code> is not using the monad you want it to use.</p>\n\n<p>I could be wrong, but it looks like <code>p</code> is using a version of the Reader monad.</p>\n\n<p>If you use this definition you'll see that <code>x</code> and <code>y</code> are not <code>Char</code> values but have type <code>[(Char,String)]</code>:</p>\n\n<pre><code>import Debug.Trace\n\np :: Parser (Char,Char)\np = do x &lt;- item\n       y &lt;- item\n       let foo = trace (\"x = \" ++ show x) 'a'\n           bar = trace (\"y = \" ++ show y) 'b'\n       return' (foo,bar)\n\ntest = p \"qwe\"\n</code></pre>\n\n<p>If you want to use <code>do</code> notation, you should create a <code>newtype</code> or <code>data</code> declaration for <code>Parser</code> so you can define how the bind operator (>>=) works, e.g.:</p>\n\n<pre><code>newtype Parser a = Parser { parse :: String -&gt; [ (a,String) ] }\n\ninstance Monad Parser where\n    return   = Parser . return'\n    (&gt;&gt;=)    = ...\n</code></pre>\n\n<p>Here is a good blog post on how to define a parser monad instance using <code>newtype</code>: <a href=\"https://cseweb.ucsd.edu/classes/wi12/cse230-a/lectures/parsers.html\" rel=\"nofollow\">(link)</a></p>\n"}], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "accepted_answer_id": 28201685, "answer_count": 2, "score": 5, "last_activity_date": 1424034871, "creation_date": 1422474204, "last_edit_date": 1422474589, "question_id": 28200987, "link": "https://stackoverflow.com/questions/28200987/why-am-i-getting-a-type-error-in-this-sequence-of-parsers-lecture-8-by-erik-mei", "title": "Why am I getting a type error in this sequence of parsers (lecture 8 by Erik Meijer)?", "body": "<p>I'm in the process of watching the <em>Functional Programming Fundamentals</em> lecture series by Erik Meijer (with slides by Graham Hutton).</p>\n\n<p>In <a href=\"https://www.youtube.com/watch?v=OrAVS4QbMqo\" rel=\"noreferrer\">lecture 8 (on functional parsers)</a>, after defining the <a href=\"https://www.youtube.com/watch?v=OrAVS4QbMqo#t=15m44s\" rel=\"noreferrer\"><code>Parser a</code></a> type, introducing a few parsing primitives (including <a href=\"https://www.youtube.com/watch?v=OrAVS4QbMqo#t=16m35s\" rel=\"noreferrer\"><code>item</code></a> and <a href=\"https://www.youtube.com/watch?v=OrAVS4QbMqo#t=20m30s\" rel=\"noreferrer\"><code>return</code></a>, which I named <code>return'</code>), Erik gives a <a href=\"https://www.youtube.com/watch?v=OrAVS4QbMqo#t=31m35s\" rel=\"noreferrer\">simple example</a> of how his parsers can be combined in a sequence, using the do syntax:</p>\n\n<pre><code>type Parser a = String -&gt; [(a,String)]\n\nitem :: Parser Char                                                  \nitem = \\inp -&gt; case inp of                                                   \n                 []     -&gt; []                                             \n                 (x:xs) -&gt; [(x,xs)]\n\nreturn' :: a -&gt; Parser a                                                   \nreturn' v = \\inp -&gt; [(v,inp)]\n\np :: Parser (Char,Char)\np = do x &lt;- item\n       item\n       y &lt;- item\n       return' (x,y)\n</code></pre>\n\n<p>However, when I try to load this in GHCi, I get the following type error, which I didn't expect and don't understand:</p>\n\n<pre><code>Couldn't match type \u2018[(Char, String)]\u2019 with \u2018Char\u2019\nExpected type: String -&gt; [((Char, Char), String)]\n  Actual type: Parser ([(Char, String)], [(Char, String)])\nIn a stmt of a 'do' block: return' (x, y)\nIn the expression:\n  do { x &lt;- item;\n       item;\n       y &lt;- item;\n       return' (x, y) }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1422472733, "post_id": 28200386, "comment_id": 44767328, "body": "You should include the log file to see the details of the error, or run <code>cabal install ... -v3</code>. However, exit code 9 has to do with being out of memory - what are the specs of your machine?"}, {"owner": {"reputation": 147, "user_id": 1013714, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/69157917cf86663aef2d66bf0f7a9f4c?s=128&d=identicon&r=PG", "display_name": "mast", "link": "https://stackoverflow.com/users/1013714/mast"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422473190, "post_id": 28200386, "comment_id": 44767603, "body": "It&#39;s a VPN running at DigitalOcean, 512 mb of memory. <code>free -m</code> shows 317 mb free before running <code>cabal install...</code>. I guess I&#39;ll look into increasing the ram on this machine and see if it helps. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 1013714, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/69157917cf86663aef2d66bf0f7a9f4c?s=128&d=identicon&r=PG", "display_name": "mast", "link": "https://stackoverflow.com/users/1013714/mast"}, "is_accepted": true, "score": 1, "last_activity_date": 1422474807, "creation_date": 1422474807, "answer_id": 28201171, "question_id": 28200386, "link": "https://stackoverflow.com/questions/28200386/cant-update-cabal-from-1-16-to-1-18/28201171#28201171", "title": "Can&#39;t update cabal from 1.16 to 1.18", "body": "<p>@user2407038 was right, the exit code 9 is caused by running out of memory. Upgrading the ram on the VPS fixed the issue.</p>\n"}], "owner": {"reputation": 147, "user_id": 1013714, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/69157917cf86663aef2d66bf0f7a9f4c?s=128&d=identicon&r=PG", "display_name": "mast", "link": "https://stackoverflow.com/users/1013714/mast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 28201171, "answer_count": 1, "score": 1, "last_activity_date": 1422474807, "creation_date": 1422471992, "question_id": 28200386, "link": "https://stackoverflow.com/questions/28200386/cant-update-cabal-from-1-16-to-1-18", "title": "Can&#39;t update cabal from 1.16 to 1.18", "body": "<p>I have cabal 1.16 installed and trying to update:</p>\n\n<pre><code>alex@cf:~# cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library \n</code></pre>\n\n<p>Trying to update:</p>\n\n<pre><code>alex@cf:~# sudo cabal install --global cabal-install\ncabal: There is no package named 'cabal-install'.\nYou may need to run 'cabal update' to get the latest list of available\npackages\n</code></pre>\n\n<p>At which point I run a <code>cabal update</code>, after which running <code>cabal install</code> returns the same as above. I followed by getting cabal from git, checking out 1.20.0.2 and run <code>sudo cabal install Cabal/ cabal-install/</code></p>\n\n<p>After a couple of minutes the prompt stops at that line:</p>\n\n<pre><code>[17 of 78] Compiling Distribution.PackageDescription ( Distribution/PackageDescription.hs, dist/build/Distribution/PackageDescription.o )\n</code></pre>\n\n<p>with the following message:</p>\n\n<pre><code>[17 of 78] Compiling Distribution.PackageDescription (Distribution/PackageDescription.hs, dist/build/Distribution/PackageDescription.o )\nFailed to install Cabal-1.20.0.2\ncabal: Error: some packages failed to install:\nCabal-1.20.0.2 failed during the building phase. The exception was:\nExitFailure 9\ncabal-install-1.20.0.3 depends on Cabal-1.20.0.2 which failed to install.\n</code></pre>\n\n<p>Couldn't find anything about how to fix this and the error message is quite vague. Does anybody have any pointers? This is on a VPS running Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-43-generic x86_64)</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "asynchronous", "f#", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1422467014, "post_id": 28198807, "comment_id": 44764113, "body": "How do you want the two to interact? For instance you could use an intermediary to store the asynchronous requests and then have a portion of the state computation expression pull from that the perform the actual update, but that would involve stalling the resultant updates until the state computation checks. I don&#39;t believe there is an alternative though without breaking a lot of guarantees about the state computation (since you no longer know when it can change, and can no longer simply stream it through your process as a single immutable value)."}, {"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1422468716, "post_id": 28198807, "comment_id": 44765103, "body": "I&#39;m finishing my first attempt. When I finish it, I&#39;ll post it as an edit to let you know my requirements. Then, any improvement would be welcome."}], "answers": [{"tags": [], "owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "is_accepted": true, "score": 4, "last_activity_date": 1579334759, "last_edit_date": 1579334759, "creation_date": 1422472159, "answer_id": 28200426, "question_id": 28198807, "link": "https://stackoverflow.com/questions/28198807/how-to-update-the-state-with-async-requests-using-the-state-monad/28200426#28200426", "title": "How to update the state with async requests using the state monad?", "body": "<p>Basically there are 2 approaches to combine monads: use monad transformers or create a custom monad by hand which combines both monads.</p>\n\n<p>Since there are no native type classes in F# you usually end up with the latter solution, but you can use <a href=\"https://github.com/gmpl/FSharpPlus\" rel=\"nofollow noreferrer\">F#+</a> to combine Async and State a-la Haskell and get the desired computation expression.</p>\n\n<p>Here's an example translated from Haskell:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>#r @\"FSharpPlus.dll\"\n\nopen FSharpPlus\nopen FSharpPlus.Data\n\nlet print x = async {printfn \"%A\" x}\n\n#nowarn \"0025\" // Incomplete pattern match, list is assumed not to be empty.\nlet code  =\n    let inline io (x: Async&lt;_&gt;)  : StateT&lt;_,Async&lt;_&gt;&gt; = liftAsync x\n    let pop  = monad {\n        let! (x::xs) = get\n        do! put xs\n        return x}\n    monad {\n        let! x = pop\n        do! io &lt;| print x\n        let! y = pop\n        do! io &lt;| print y\n        return () }\n\nlet main = StateT.run code [1..10] &gt;&gt;= fun _ -&gt; result ()\n\n// try Async.RunSynchronously main\n</code></pre>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/19129277/can-i-use-different-workflows-simultaneously-in-f/19143542#19143542\">this</a> and <a href=\"https://stackoverflow.com/questions/12376833/combine-f-async-and-maybe-computation-expression/32953319#32953319\">this</a> related questions.</p>\n"}], "owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "accepted_answer_id": 28200426, "answer_count": 1, "score": 1, "last_activity_date": 1579334759, "creation_date": 1422466744, "last_edit_date": 1466410960, "question_id": 28198807, "link": "https://stackoverflow.com/questions/28198807/how-to-update-the-state-with-async-requests-using-the-state-monad", "title": "How to update the state with async requests using the state monad?", "body": "<p>I'm doing an app using F# and I wonder if I could <strong>a)</strong> Keep the state under the State computation expression (using FSharpx's implementation) and <strong>b)</strong> be able to modify the state asynchronously (handling the user's input).</p>\n\n<p>I believe I know how to handle each problem separately; either:</p>\n\n<ul>\n<li>Keep the state in mutable variables and use async &amp; MailboxProcessor to receive async requests to modify the state</li>\n<li>Use the state computation expression but not being able to process the user input.</li>\n</ul>\n\n<p>How could I use both the state and the async computation expressions in FSharp or Haskell?</p>\n"}, {"tags": ["shell", "haskell", "monads"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422464723, "post_id": 28197650, "comment_id": 44762685, "body": "My first question in why you would use <code>Either String Bool</code> here. That&#39;s strange for two reasons. 1. Conventionally, and because of the way its <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances are written, the <code>Right</code> side of either is the &quot;all went well&quot; side and the <code>Left</code> side is the &quot;something went sideways&quot; one. 2. If the weird side is always <code>True</code>, why do you need it? One option would be to use <code>Maybe String</code> instead. A more natural approach, however, would be to use <code>Either Int String</code>, so you either get the concatenated output or you get the exit code. (cont)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422464743, "post_id": 28197650, "comment_id": 44762695, "body": "(cont) Another natural thing to consider (perhaps not in your application) is <code>Either (Int,String) String</code>, which either gives the standard output or gives the standard error and the exit code.   (Edit: I&#39;m not actually sure what type an exit code is. It may well not be <code>Int</code>.)"}, {"owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "edited": false, "score": 0, "creation_date": 1422465273, "post_id": 28197650, "comment_id": 44763058, "body": "Uhm, there&#39;s also something with the type signature. You&#39;re trying to use a monad transformer without actually using one, that might bring you lots of pain in the future. You should look up the package Either made by Edward Kmett, or ErrorT in the standard library."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "edited": false, "score": 0, "creation_date": 1422465307, "post_id": 28197650, "comment_id": 44763086, "body": "@Juli&#225;n, there&#39;s also <code>Control.Monad.Trans.Either</code> in <code>transformers</code>."}, {"owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422465410, "post_id": 28197650, "comment_id": 44763145, "body": "@dfeuer I just looked it up, and EitherT is from the either package. <a href=\"https://hackage.haskell.org/package/transformers-0.4.2.0\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/transformers-0.4.2.0</a>. Although a second look at the code reminds me that there&#39;s throw and catch in the standard library, using IO. So it might just be better to throw an exception when something fails."}, {"owner": {"reputation": 442, "user_id": 655903, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/80378221e2e4070a5da804c229df463d?s=128&d=identicon&r=PG", "display_name": "Elzair", "link": "https://stackoverflow.com/users/655903/elzair"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422465716, "post_id": 28197650, "comment_id": 44763307, "body": "@dfeuer I only want the output if something goes haywire. That is why I have the output in the Left column."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1422466235, "creation_date": 1422466235, "answer_id": 28198644, "question_id": 28197650, "link": "https://stackoverflow.com/questions/28197650/how-do-i-execute-a-series-of-shell-commands-in-haskell-and-break-on-an-error/28198644#28198644", "title": "How do I execute a series of shell commands in Haskell and break on an error?", "body": "<p>You can use <code>mapM_</code>, which has the type</p>\n\n<pre><code>mapM_ :: ( (CmdSpec, FilePath)  -&gt; ExceptT String IO ())\n      -&gt;  [(CmdSpec, FilePath)] -&gt; ExceptT String IO ()\n</code></pre>\n\n<p>and appropriate short-circuiting behavior.</p>\n"}, {"tags": [], "owner": {"reputation": 1282, "user_id": 807631, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3120b244b19cab8e1c52845139b3fc23?s=128&d=identicon&r=PG&f=1", "display_name": "Misguided", "link": "https://stackoverflow.com/users/807631/misguided"}, "is_accepted": false, "score": 2, "last_activity_date": 1422467243, "creation_date": 1422467243, "answer_id": 28198950, "question_id": 28197650, "link": "https://stackoverflow.com/questions/28197650/how-do-i-execute-a-series-of-shell-commands-in-haskell-and-break-on-an-error/28198950#28198950", "title": "How do I execute a series of shell commands in Haskell and break on an error?", "body": "<p>Well, this might solve your problem:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport System.IO\nimport System.Process\nimport System.Exit\nimport Control.Exception\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Maybe\n\ncreateCommand :: CmdSpec -&gt; FilePath -&gt; CreateProcess\ncreateCommand (ShellCommand command) curDir =\n  (shell command){std_out = CreatePipe, std_err = CreatePipe, cwd = Just curDir}\ncreateCommand (RawCommand command arguments) curDir =\n  (proc command arguments){std_out = CreatePipe, std_err = CreatePipe, cwd = Just curDir}\n\nexecCommand :: CmdSpec -&gt; FilePath -&gt; IO ()\nexecCommand command curDir = do\n    (_, Just hout, Just herr, procHandle) &lt;- createProcess $ createCommand command curDir\n    exitCode &lt;- waitForProcess procHandle\n    when (exitCode /= ExitSuccess) $ do\n        stdOut   &lt;- hGetContents hout\n        stdErr   &lt;- hGetContents herr\n        throwIO $ stdOut ++ stdErr\n\ninstance Exception String\n\nexecList :: [(CmdSpec, FilePath)] -&gt; MaybeT IO String\nexecList xs = do\n    out &lt;- liftIO $ try $ mapM_ (uncurry execCommand) xs\n    case out of\n        Left c -&gt; return c\n        Right _ -&gt; mzero\n</code></pre>\n\n<p>Notice that this uses FlexibleInstances. This was required for making String an instance of the Exception typeclass (the problem lies in the fact that String = [Char]). You could remove the extension by creating a new type which encloses a string and making it an instance of Exception.</p>\n"}, {"tags": [], "owner": {"reputation": 442, "user_id": 655903, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/80378221e2e4070a5da804c229df463d?s=128&d=identicon&r=PG", "display_name": "Elzair", "link": "https://stackoverflow.com/users/655903/elzair"}, "is_accepted": false, "score": 1, "last_activity_date": 1422468933, "creation_date": 1422468933, "answer_id": 28199494, "question_id": 28197650, "link": "https://stackoverflow.com/questions/28197650/how-do-i-execute-a-series-of-shell-commands-in-haskell-and-break-on-an-error/28199494#28199494", "title": "How do I execute a series of shell commands in Haskell and break on an error?", "body": "<p>Well, I am pretty sure I figured it out. Instead of using \"fancy\" stuff, I fell back to good ol' recursion.</p>\n\n<pre><code>runCommands :: [String] -&gt; FilePath -&gt; IO (Maybe String)\nrunCommands [] _ = return Nothing\nrunCommands (command:rest) curDir = do\n  result &lt;- execCommand command curDir\n  case result of\n    Nothing  -&gt; runCommands rest curDir\n    Just err -&gt; return $ Just err\n</code></pre>\n"}], "owner": {"reputation": 442, "user_id": 655903, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/80378221e2e4070a5da804c229df463d?s=128&d=identicon&r=PG", "display_name": "Elzair", "link": "https://stackoverflow.com/users/655903/elzair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1422468933, "creation_date": 1422463295, "last_edit_date": 1422468450, "question_id": 28197650, "link": "https://stackoverflow.com/questions/28197650/how-do-i-execute-a-series-of-shell-commands-in-haskell-and-break-on-an-error", "title": "How do I execute a series of shell commands in Haskell and break on an error?", "body": "<p>Suppose I have a list of <code>String</code>s representing shell commands to execute.</p>\n\n<pre><code>commands = [\"git clone https://github.com/test/repo.git\", \"git checkout origin\"]\n</code></pre>\n\n<p>Also, suppose I have a command, <code>execCommand</code> that takes a string, executes it as a shell command, retrieves the exit code, stdout and stderr, and, if the exit code is nonzero, returns <code>Just</code> the concatenation of stdout and stderr; otherwise, it returns <code>Nothing</code>.</p>\n\n<p>Now, how would I execute that list of commands sequentially while ensuring that subsequent commands do not execute after one command yields an error?</p>\n\n<p>Below is the full code for <code>execCommand</code>.</p>\n\n<pre><code>import System.IO\nimport System.Process\nimport System.Exit\n\ncreateCommand :: String -&gt; FilePath -&gt; CreateProcess\ncreateCommand command curDir =\n  (shell command){std_out = CreatePipe, std_err = CreatePipe, cwd = Just curDir}\n\nexecCommand :: String -&gt; FilePath -&gt; IO (Maybe String)\nexecCommand command curDir = do\n  (_, Just hout, Just herr, procHandle) &lt;- createProcess $ createCommand command curDir\n  exitCode &lt;- waitForProcess procHandle\n  stdOut   &lt;- hGetContents hout\n  stdErr   &lt;- hGetContents herr\n  if exitCode /= ExitSuccess\n     then return $ Just $ concat [stdOut, stdErr]\n     else return $ Nothing\n</code></pre>\n"}, {"tags": ["haskell", "reflection", "typeclass"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422456305, "post_id": 28194340, "comment_id": 44756888, "body": "To my knowledge it is not possible to extract the typeclass instances for a particular value at runtime.  It&#39;s not part of the <code>Data.Typeable</code> or <code>Data.Data</code> APIs that I could find."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422456376, "post_id": 28194340, "comment_id": 44756938, "body": "If this were possible separate compilation would be quite hard to perform correctly. I don&#39;t think it&#39;s possible."}, {"owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422457192, "post_id": 28194340, "comment_id": 44757485, "body": "If I would be willing to settle for &quot;typeclass instances visible through the imports to the module in which <code>isShowable</code> is defined&quot;, will it change your answer?  @bheklilr @chi"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422457468, "post_id": 28194340, "comment_id": 44757687, "body": "In that case there might be some type class hack which could achieve that, exploiting <code>IncoherentInstances</code> or related extensions. I am not so fluent in that area to give a definite answer, though."}, {"owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422457564, "post_id": 28194340, "comment_id": 44757757, "body": "@chi - I just wish to note that if isShowable is always forcibly inlined using Template Haskell (like a C macro), then it becomes much more usable under the restriction I&#39;ve mentioned. That is why I am still interested in this case."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1422522117, "post_id": 28202681, "comment_id": 44785610, "body": "You mean <code>wrapShow x = Showable x (show x)</code> , right?"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 4, "last_activity_date": 1422522739, "last_edit_date": 1495542035, "creation_date": 1422480288, "answer_id": 28202681, "question_id": 28194340, "link": "https://stackoverflow.com/questions/28194340/generically-finding-out-whether-the-type-of-a-value-belongs-to-a-type-class-or-n/28202681#28202681", "title": "Generically finding out whether the type of a value belongs to a type class or not", "body": "<p>I'm not sure what is your real intention is, but it looks like you'd like to embed Java idiom into Haskell.</p>\n\n<p>As mentioned <a href=\"https://stackoverflow.com/a/28170590/1308058\">in other SO question</a> what you are doing is going to turn into anti-pattern.</p>\n\n<p>You have added a clarification:</p>\n\n<blockquote>\n  <p>If I would be willing to settle for \"typeclass instances visible through the imports to the module in which <code>isShowable</code> is defined\".</p>\n</blockquote>\n\n<p>Why wouldn't you wrap your type in:</p>\n\n<pre><code>data MaybeShowable a where\n  Showable :: forall b. Show b =&gt; b -&gt; MaybeShowable b\n  Opaque   :: forall b.           b -&gt; MaybeShowable b\n\ninstance Show (MaybeShowable a) where\n  show (Showable x) = show x\n  show (Opaque x)   = \"&lt;&lt;OPAQUE&gt;&gt;\"\n</code></pre>\n\n<p>And have your functions operate on <code>MaybeShowable a</code>, instead of plain <code>a</code>.</p>\n\n<p>Yet this is ugly still. Isn't it be easier to operate directly on <code>Show a =&gt; a</code>, or <code>a</code>.</p>\n\n<p>Other way is to capture <code>Show a</code> dictionary early enough, i.e. have data type:</p>\n\n<pre><code>data MaybeShowable a = Showable a String -- Or even Showable a (a -&gt; String)\n                     | Opaque a\n\ninstance Show (MaybeShowable a) where\n  show (Showable x s) = s\n  show (Opaque x)     = \"&lt;&lt;OPAQUE&gt;&gt;\"\n\nwrapShow :: Show a =&gt; a -&gt; MaybeShowable a\nwrapShow x = Showable x (show x) -- Showable x show\n\nwrapOpaque :: a -&gt; MaybeShowable a\nwrapOpaque = Opaque\n</code></pre>\n\n<p>The variation of this approach is used in e.g. <a href=\"https://hackage.haskell.org/package/QuickCheck-2.4.0.1/docs/src/Test-QuickCheck-Property.html#forAll\" rel=\"nofollow noreferrer\">QuickCheck's <code>forAll</code></a>. That part is Haskell98. There the <code>show x</code> is closed over into closure, which maybe executed or not. Lazyness is the key point here!</p>\n"}, {"comments": [{"owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "edited": false, "score": 0, "creation_date": 1422785414, "post_id": 28207790, "comment_id": 44880239, "body": "Can this function be used inside <code>f</code> from my original question? I get the impression that it only works for monomorphic input types."}, {"owner": {"reputation": 1178, "user_id": 1940209, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/247799acb8cb63c48d278c09eb455283?s=128&d=identicon&r=PG", "display_name": "aavogt", "link": "https://stackoverflow.com/users/1940209/aavogt"}, "reply_to_user": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "edited": false, "score": 0, "creation_date": 1422849248, "post_id": 28207790, "comment_id": 44897289, "body": "Well <code>$(isInst &#39;&#39;Show) :: Typeable a =&gt; a -&gt; Bool</code>, so technically yes it&#39;s polymorphic. But if you get a True, that doesn&#39;t let you call show, so it&#39;s kind of inadequate. We can generate a class with a method that figures out which GADT constructor to apply to a type (a manual part of @phadej &#39;s solution). hat&#39;s done here: <a href=\"https://gist.github.com/aavogt/3d9d2b468fb51ec5d3ca\" rel=\"nofollow noreferrer\">gist.github.com/aavogt/3d9d2b468fb51ec5d3ca</a>"}], "tags": [], "owner": {"reputation": 1178, "user_id": 1940209, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/247799acb8cb63c48d278c09eb455283?s=128&d=identicon&r=PG", "display_name": "aavogt", "link": "https://stackoverflow.com/users/1940209/aavogt"}, "is_accepted": false, "score": 2, "last_activity_date": 1422510596, "creation_date": 1422510596, "answer_id": 28207790, "question_id": 28194340, "link": "https://stackoverflow.com/questions/28194340/generically-finding-out-whether-the-type-of-a-value-belongs-to-a-type-class-or-n/28207790#28207790", "title": "Generically finding out whether the type of a value belongs to a type class or not", "body": "<p>You can ask using template haskell which instances are available:</p>\n\n<pre><code>    module IsInstance where\n\n    import Language.Haskell.TH; import Data.Typeable\n    import Data.Generics; import Data.Monoid\n\n    -- $(isInst ''Show) :: Typeable a =&gt; a -&gt; Bool\n    isInst :: Name -&gt; ExpQ\n    isInst className = do\n        ClassI _ insts &lt;- reify className\n        ClassI _ typeableInsts &lt;- reify ''Typeable\n        let typeOfs = [ [| typeRep (Proxy :: Proxy $(return ty)) |]\n                            | InstanceD _ (AppT _ ty) _ &lt;- insts,\n                              hasNoVarT ty,\n                              or [ ty_ == ty | InstanceD _ (AppT _ ty_) _ &lt;- typeableInsts ] ]\n        [| \\ val -&gt; typeOf val `elem` $(listE typeOfs) |]\n\n    hasNoVarT xs = getAll $ everything\n        (&lt;&gt;)\n        (mkQ mempty (\\ x -&gt; case x of\n                      VarT {} -&gt; All False\n                      _ -&gt; mempty))\n        xs\n</code></pre>\n\n<p><code>$(isInst ''Show) (1 :: Int)</code> is true, but unfortunately \n<code>$(isInst ''Show) (1 :: Rational)</code> is false, since here using <code>==</code> doesn't say that an instance for <code>Show (Ratio a)</code> can be used with <code>type Rational = Ratio Integer</code>. So a complete solution is going to have to know how instances are selected.</p>\n"}], "owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1422522739, "creation_date": 1422454218, "last_edit_date": 1422466642, "question_id": 28194340, "link": "https://stackoverflow.com/questions/28194340/generically-finding-out-whether-the-type-of-a-value-belongs-to-a-type-class-or-n", "title": "Generically finding out whether the type of a value belongs to a type class or not", "body": "<p>I want to write the <code>isShowable</code> function as part of this code.</p>\n\n<pre><code>data MaybeShowable = forall a . Show a =&gt; Showable a | Opaque\nf :: (Data d) =&gt; d -&gt; String\nf x = case isShowable x of\n        Showable s -&gt; show s\n        Opaque -&gt; \"&lt;&lt;OPAQUE&gt;&gt;\"\nisShowable :: (Data d) =&gt; d -&gt; MaybeShowable\nisShowable = ???\n</code></pre>\n\n<p>Is this possible by using the <code>Data</code> instance? If not, what is the best way to do it?</p>\n\n<p>Note: If there's no other option, I'm willing to settle for this a version that works only for type class instances visible through the imports to the module in which <code>isShowable</code> is defined.</p>\n"}, {"tags": ["haskell", "import", "module", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422455735, "post_id": 28194710, "comment_id": 44756516, "body": "In the final example you give, I think the question of which one is the correct module to load is trivial: whichever is found first on the search path or in search order. That&#39;s how this is resolved in many other languages. I&#39;m not saying that is a pro or con w.r.t. your answer -- just that I see it as a trivial problem and think allowing people to re-use the same module name if they prefer seems fine to me. Preventing it doesn&#39;t really &#39;protect&#39; you from anything."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422455927, "post_id": 28194710, "comment_id": 44756647, "body": "Also, the docs about all this suggest that it is perfectly valid &amp; reasonable to do many things in Haskell: define more than one module per file is OK; define one module across more than one file is OK (exactly by re-using the same module name and ensuring no declared names conflict); and naming the module something different than the file name is also OK (you can still import it as a package, or in GHCi with the file name). All these are listed in the docs I linked in my question. So while mapping modules to file paths might be common practice, it&#39;s certainly not enforced by the language."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422456004, "post_id": 28194710, "comment_id": 44756700, "body": "@prpl.mnky.dshwshr If you just use the first one found on the path, what ordering method are you using?  Unicode ordering?  Ok, so now one of them always gets loaded and the other does not, how do you then load the second module?  Also, I know of no language that actually does what you say.  In .NET languages you can&#39;t, although the filename has nothing to do with the module structure. In Python the filename is exactly the module name, you don&#39;t get to declare your module name."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422456112, "post_id": 28194710, "comment_id": 44756770, "body": "@prpl.mnky.dshwshr The example in the docs you linked to really only applies to the <code>Main</code> module and using the <code>:load</code> command. In fact, that documentation states &quot;Question: How does GHC find the filename which contains module M? Answer: it looks for the file M.hs, or M.lhs. This means that for most modules, <b>the module name must match the filename. If it doesn&#39;t, GHCi won&#39;t be able to find it.</b>&quot; (emphasis mine)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422456192, "post_id": 28194710, "comment_id": 44756821, "body": "&quot;There is one exception to this general rule: when you load a program with :load, or specify it when you invoke ghci, you can give a filename rather than a module name. This filename is loaded if it exists, and it may contain any module you like. This is particularly convenient if you have several Main modules in the same directory and you can&#39;t call them all Main.hs.&quot; - The exception is that in GHCi you can use <code>:load</code> on a filename specifically, but this is an implementation feature in GHCi, it is not part of the language of Haskell.  The Haskell language specifies a file structure."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422456326, "post_id": 28194710, "comment_id": 44756899, "body": "<a href=\"https://www.haskell.org/tutorial/modules.html\" rel=\"nofollow noreferrer\">&quot;There is no formal connection between a Haskell module and the file system that would (typically) support it. In particular, there is no connection between module names and file names, and more than one module could conceivably reside in a single file (one module may even span several files).&quot;</a>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422457164, "post_id": 28194710, "comment_id": 44757466, "body": "@prpl.mnky.dshwshr Ok, so the Haskell language doesn&#39;t necessarily care, but <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/users_guide/syntax-extns.html#hierarchical-modules\" rel=\"nofollow noreferrer\">GHC does</a>.  If you want to use it in GHCi, you&#39;ll have to follow GHCi&#39;s rules.  Also, the sentence before what you quoted is &quot;Module names are alphanumeric and must begin with an uppercase letter.&quot;  You wouldn&#39;t be able to have the module <code>My.Module</code> without GHC&#39;s standard at all.  This is actually a deviation from Haskell98."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422457330, "post_id": 28194710, "comment_id": 44757589, "body": "The Python trick you linked to is not renaming a module either.  The module name there would still be <code>oldmodule</code> according to the <code>__name__</code> variable, but it would be imported elsewhere as <code>newmodule</code>.  Initially, the interpreter still sees it as <code>oldmodule</code> during the first import, but then the module is inserted into the <code>sys.modules</code> dictionary under a new name.  This doesn&#39;t change the name of the module, it just changes the search path at runtime.  Python does go with the first instance found in its search path, though."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422463132, "post_id": 28194710, "comment_id": 44761594, "body": "@prpl.mnky.dshwshr IMHO clear, straightforward and almost branchless search mechanism of GHC clearly simplifies reasoning about modules &amp; filesystem connection. <a href=\"http://stackoverflow.com/questions/28159068/packagename-with-ghc-generics/28177069#\">With <code>PackageImports</code> you can already make some grey hair to your co-workers</a> <a href=\"https://gist.github.com/phadej/8b628d579ddf6958d937\" rel=\"nofollow noreferrer\">(gist)</a>. If you cannot alter the directory structure where file is, you can make a properly arranged &quot;copy&quot; of it with symlinks."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422467711, "post_id": 28194710, "comment_id": 44764494, "body": "@phadej I am not making normative claims about whether this version of importing is good or bad. I&#39;m not interested in whether it is good or bad, just whether it can be done. We have to assume the symlink approach won&#39;t work: suppose there is already some other file sitting in the directory path &quot;My/Module.hs&quot; and it is <i>also</i> named My.Module. We want to import from the other file MyModule.hs (that also has My.Module as the module name despite not residing at that path), and say the modules were set up this way intentionally; the namespaces don&#39;t conflict and it&#39;s desired for them to overlap."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422467916, "post_id": 28194710, "comment_id": 44764630, "body": "Similar to the way folks sometimes do qualified imports like <code>import Data.Thing as T; import Data.Thing.Stuff as T, ...</code>, having taken care to ensure <code>Data.Thing</code> and <code>Data.Thing.Stuff</code> don&#39;t conflict. Since Haskell permits modules to reside across more than one source file, someone may have created <code>module My.Module where ...</code> residing in file <code>src&#47;My&#47;Module.hs</code> and then later wanted to extend it by placing code in <code>src&#47;MyModule.hs</code> using <code>module My.Module where ...</code>. Again, not at all saying it&#39;s good, just saying it can be done and you can inherit it and need to import it in ghci."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1422455273, "creation_date": 1422455273, "answer_id": 28194710, "question_id": 28193295, "link": "https://stackoverflow.com/questions/28193295/load-a-module-in-ghci-by-module-name-when-module-name-doesnt-match-file-name/28194710#28194710", "title": "Load a module in GHCi by module name when module name doesn&#39;t match file name", "body": "<p>You can't where the name contains a dot, as per the <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/users_guide/separate-compilation.html#search-path\" rel=\"nofollow\">documentation</a></p>\n\n<blockquote>\n  <p>For each of these directories, it tries appending basename.extension to the directory, and checks whether the file exists. The value of basename is the module name with dots replaced by the directory separator ('/' or '\\', depending on the system), and extension is a source extension (hs, lhs)...</p>\n</blockquote>\n\n<p>The key part being</p>\n\n<blockquote>\n  <p>The value of basename is the module name with dots replaced by the directory separator ('/' or '\\', depending on the system)</p>\n</blockquote>\n\n<p>So your module name of <code>My.Module</code> will be searched for as <code>My/Module.hs</code>.  You would need to have a directory structure like</p>\n\n<pre><code>project/\n    My/\n        Module.hs\n    project.cabal\n</code></pre>\n\n<p>And from the folder <code>project</code> you could run</p>\n\n<pre><code>$ cabal repl\nGHCi, version 7.8.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n&gt; import My.Module\n</code></pre>\n\n<p>You <em>can</em> do this if your file is named <code>MyModule.hs</code> and your module name is <code>MyModule</code>, but it's just a special case of the rule above.</p>\n\n<p>There are good reasons for this, namely that it enforces a structure to simplify your project structure and GHC's search algorithm.  If this rule wasn't in place, what would stop me from having</p>\n\n<pre><code>project/\n    MyModule1.hs\n    MyModule2.hs\n</code></pre>\n\n<p>where both <code>.hs</code> files had the module declaration <code>My.Module</code>?  Which one would be correct to load in GHCi if I ran <code>import My.Module</code>?  By specifying what the filename and path is, you immediately know that the module <code>X.Y.Z.W.Q.R.S.T</code> is at the path <code>X/Y/Z/W/Q/R/S/T.hs</code>, no searching required.  It reduces a lot of the ambiguity that could occur with looser module name specifications.</p>\n"}], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1192, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1422455273, "creation_date": 1422451097, "last_edit_date": 1422452961, "question_id": 28193295, "link": "https://stackoverflow.com/questions/28193295/load-a-module-in-ghci-by-module-name-when-module-name-doesnt-match-file-name", "title": "Load a module in GHCi by module name when module name doesn&#39;t match file name", "body": "<p>Suppose I am given a source file called <code>MyModule.hs</code> and inside it the module declaration is <code>module My.Module where ...</code> (note: <em>not</em> <code>module MyModule where ...</code>).</p>\n\n<p>I am not permitted to alter this source file or change the directory structure where the file resides.</p>\n\n<p>From reading <a href=\"https://downloads.haskell.org/~ghc/7.4.2/docs/html/users_guide/loading-source-files.html\" rel=\"nofollow\">some docs about importing modules in GHCi</a>, it looks like there are ways to import <em>by file name</em> (e.g. either <code>import</code> or <code>:load</code>), but not any ways to specify a module name that will be searched for in all files of the local directory.</p>\n\n<p>Is there a way to import <code>My.Module</code> in GHCi without doing it by specifying the file's name (only the module name) and without installing it (e.g. not building it with <code>cabal</code>, just quickly tossing it into GHCi by module name)?</p>\n"}, {"tags": ["haskell", "functional-programming", "tuples", "combinations"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 20, "last_activity_date": 1422444829, "creation_date": 1422444829, "answer_id": 28191224, "question_id": 28191103, "link": "https://stackoverflow.com/questions/28191103/iterate-over-all-pair-combinations-without-repetition-in-haskell/28191224#28191224", "title": "Iterate over all pair combinations without repetition in Haskell", "body": "<p>What about:</p>\n\n<pre><code>[ (x,y) | (x:rest) &lt;- tails xs , y &lt;- rest ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 1, "last_activity_date": 1521298902, "last_edit_date": 1521298902, "creation_date": 1521298602, "answer_id": 49338274, "question_id": 28191103, "link": "https://stackoverflow.com/questions/28191103/iterate-over-all-pair-combinations-without-repetition-in-haskell/49338274#49338274", "title": "Iterate over all pair combinations without repetition in Haskell", "body": "<p>If I copy and simplify <code>Math.Combinat.Sets.choose</code> for the particular case <code>k=2</code>, this gives </p>\n\n<pre><code>pairs :: [a] -&gt; [[a]]\npairs []     = []\npairs (x:xs) = map (\\y -&gt; x:[y]) xs ++ pairs xs -- replace with \\y -&gt; (x,y) to get 2-tuples\n\n&gt;&gt;&gt; pairs [1,2,3]\n[[1,2],[1,3],[2,3]]\n</code></pre>\n"}], "owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1997, "favorite_count": 3, "accepted_answer_id": 28191224, "answer_count": 2, "score": 10, "last_activity_date": 1521298902, "creation_date": 1422444470, "last_edit_date": 1521249240, "question_id": 28191103, "link": "https://stackoverflow.com/questions/28191103/iterate-over-all-pair-combinations-without-repetition-in-haskell", "title": "Iterate over all pair combinations without repetition in Haskell", "body": "<p>In haskell, given a list of elements, <code>xs</code>, the simplest way to iterate over all pair permutations with repetitions is:</p>\n\n<pre><code>[(x,y) | x &lt;- xs, y &lt;- xs]\n</code></pre>\n\n<p>I wish to be able to do the same, but only on combinations. If x and y were comparable, I could do</p>\n\n<pre><code>[(x,y) | x &lt;- xs, y &lt;- xs, x &gt; y]\n</code></pre>\n\n<p>But I'd prefer a solution that is more generic and more efficient (I know that asympotitic complexity will remain squared, but we can halve actual runtime complexity by avoiding the usage of a filtering condition)</p>\n"}, {"tags": ["haskell", "wxhaskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1422436055, "post_id": 28187187, "comment_id": 44744765, "body": "I don&#39;t know wxWidgets, but the command you&#39;re looking for is typically called &quot;pack&quot; or &quot;repack&quot;..."}, {"owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1422465873, "post_id": 28187187, "comment_id": 44763387, "body": "Thanks, I found a function called <code>refit</code> which does the trick."}], "answers": [{"tags": [], "owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "is_accepted": true, "score": 1, "last_activity_date": 1422465970, "creation_date": 1422465970, "answer_id": 28198561, "question_id": 28187187, "link": "https://stackoverflow.com/questions/28187187/change-wxhaskell-layout-programmatically/28198561#28198561", "title": "change wxhaskell layout programmatically", "body": "<p>I found the answer myself after googeling with MathematicalOrchid's comment in mind. The function is called <code>refit</code>.</p>\n"}], "owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 28198561, "answer_count": 1, "score": 0, "last_activity_date": 1422465970, "creation_date": 1422431602, "question_id": 28187187, "link": "https://stackoverflow.com/questions/28187187/change-wxhaskell-layout-programmatically", "title": "change wxhaskell layout programmatically", "body": "<p>I want to switch layouts after an event (ie click on button). So I set the new layout and repaint the panel, but the layout doesn't change. (It does so only after I resize the frame by hand.) What's the magic sauce that's missing? Thank's for helping me out!</p>\n\n<pre><code>import Graphics.UI.WX\n\nbuildGUI = do\n  f &lt;- frame [ text := \"Hello\" ]\n\n  controls &lt;- panel f []\n  ctext &lt;- staticText controls [ text := \"Foo\" ]\n  butn &lt;- button controls [text := \"change layout\"]\n  set controls [ layout := row 0 [margin 5 (widget ctext),\n                                  margin 5 (widget butn) ]]\n\n  set f [ layout := widget controls ]\n\n  set butn [on command := do\n      -- switch layout, button first, text second\n      set controls [layout := row 0 [ margin 5 (widget butn)\n                                    , margin 5 (widget ctext) ]]\n  {-\n     repaint doesn't do it, but if I resize the frame by hand,\n     the layout changes\n  -}    \n      repaint controls         ]\n\n  return ()\n\nmain = start buildGUI\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1429633961, "post_id": 28186243, "comment_id": 47686317, "body": "Note that <code>flipThree</code> itself can be implemented with applicative stuff alone; no need for the full power of monads here, since the result of one coin toss doesn&#39;t affect the subsequent coin tosses to be carried out."}], "answers": [{"comments": [{"owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "edited": false, "score": 0, "creation_date": 1422454617, "post_id": 28186640, "comment_id": 44755766, "body": "Also, is there a way to do this with a monadic style, perhaps in a do expression? I would like to use this exercise to gain understanding of how to work with Monads. I see that you did something like this with the <code>MonadPlus</code> idea, but we lost the information about False (in this case it it trivial to deduce that the probability of not getting all three tails is <code>1%1 - 9%40</code>, but in more general applications there might be more than 2 choices so that reasoning won&#39;t quite work."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "edited": false, "score": 0, "creation_date": 1422465698, "post_id": 28186640, "comment_id": 44763299, "body": "Firstly, I have to caution against trying to use monads everywhere. This is a fairly straightforward function - there is no reason to try to write it in a &quot;monadic&quot; style. do notation would not improve clarity or performance here. I imagine that you want <code>Prob</code> to group things like this &quot;automatically&quot; (as a part of the bind function). In this <i>specific</i> case, it is impossible, because the <code>runProb</code> function introduced an <code>Eq a</code> constraint, which wouldn&#39;t work with Monad, Functor, or Applicative."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1422429725, "last_edit_date": 1422429725, "creation_date": 1422429363, "answer_id": 28186640, "question_id": 28186243, "link": "https://stackoverflow.com/questions/28186243/using-monads-folding-over-part-of-its-contents/28186640#28186640", "title": "Using monads: folding over part of its contents", "body": "<p>The function that you want is </p>\n\n<pre><code>import Data.Function\nimport Data.List \n\nrunProb :: Eq a =&gt; Prob a -&gt; [(a, Rational)]\nrunProb =  map (\\x -&gt; (fst (head x), sum (map snd x))) \n         . groupBy ((==) `on` fst) \n         . getProb \n</code></pre>\n\n<p>so that </p>\n\n<pre><code>&gt;runProb flipThree\n[(False,31 % 40),(True,9 % 40)]\n</code></pre>\n\n<p>You could also make your type an instance of <code>MonadPlus</code> to sort-of get this result \"directly\":</p>\n\n<pre><code>instance MonadPlus Prob where \n  mzero = Prob [] \n  mplus (Prob x) (Prob y) = Prob (x++y) \n\nflipThree' = do\n    a &lt;- coin\n    b &lt;- coin\n    c &lt;- loadedCoin\n    guard (all (== Tails) [a, b, c])\n\n&gt; runProb flipThree'\n[((),9 % 40)]\n</code></pre>\n"}], "owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 28186640, "answer_count": 1, "score": 0, "last_activity_date": 1422429725, "creation_date": 1422427649, "question_id": 28186243, "link": "https://stackoverflow.com/questions/28186243/using-monads-folding-over-part-of-its-contents", "title": "Using monads: folding over part of its contents", "body": "<p>I'm just finishing up learn you a Haskell for great good and am still struggling with how to work with Monads. </p>\n\n<p>At the very end of the chapter <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#making-monads\" rel=\"nofollow\">for a few monads more</a> the author gives an exercise (second to last paragraph). Specifically, he encourages us to write a function that will collapse all the <code>(False, Rational)</code> values into a single value <code>(False, sum Rationals)</code>.</p>\n\n<p>I have written out all the code that was presented in the chapter and included the relevant portion here</p>\n\n<pre><code>import Data.Ratio\nimport Control.Monad\nimport Control.Applicative\nimport Data.List (all)\n\nnewtype Prob a = Prob { getProb :: [(a, Rational)]} deriving (Show)\n\ninstance Functor Prob where\n    fmap f (Prob xs) = Prob $ map (\\(x, p) -&gt; (f x, p)) xs\n\nflatten :: Prob (Prob a) -&gt; Prob a\nflatten (Prob xs) = Prob $ concat $ map multAll xs\n    where multAll (Prob innerxs, p) = map (\\(x, r) -&gt; (x, p*r)) innerxs\n\ninstance Applicative Prob where\n    pure  = return\n    (&lt;*&gt;) = ap\n\ninstance Monad Prob where\n    return x = Prob [(x, 1%1)]\n    m &gt;&gt;= f = flatten (fmap f m)\n    fail _ = Prob []\n\ndata Coin = Heads | Tails deriving (Show, Eq)\n\ncoin :: Prob Coin\ncoin = Prob [(Heads, 1%2), (Tails, 1%2)]\n\nloadedCoin :: Prob Coin\nloadedCoin = Prob [(Heads, 1%10), (Tails, 9%10)]\n\nflipThree :: Prob Bool\nflipThree = do\n    a &lt;- coin\n    b &lt;- coin\n    c &lt;- loadedCoin\n    return (all (== Tails) [a, b, c])\n</code></pre>\n\n<p>When I run this code I get</p>\n\n<pre><code>ghci&gt; getProb  flipThree\n[(False,1 % 40),(False,9 % 40),(False,1 % 40),(False,9 % 40),(False,1 % 40),(False,9 % 40),(False,1 % 40),(True,9 % 40)]\n</code></pre>\n\n<p>I would like to somehow filter the elements of <code>flipThree</code> that have a <code>False</code> in their first position and then sum the associated probabilities. I have written some ugly non-monadic code to do this, but am confident there is a better way.</p>\n\n<p>The desired output would be</p>\n\n<pre><code>ghci&gt; getProb  flipThree\n[(False,31 % 40),(True,9 % 40)]\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "edited": false, "score": 0, "creation_date": 1422414716, "post_id": 28183867, "comment_id": 44737039, "body": "Am I under the false impression that <code>pure</code> will embed a hidden input field?"}, {"owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "edited": false, "score": 0, "creation_date": 1422415468, "post_id": 28183867, "comment_id": 44737240, "body": "Indeed, changing it from <code>pure</code> to <code>areq hiddenField &quot;&quot; (Just i)</code> makes it work if I provide an arbitrary <code>Entity Counter</code> field. Still doesn&#39;t work with undefined."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1422466325, "post_id": 28183867, "comment_id": 44763656, "body": "One approach you could take is to move the counter ID into the URL. I&#39;m not sure what your current URL structure looks like, but if you could POST to /counters/1/increment or whatever, you wouldn&#39;t need to store the counter ID in a hidden field."}, {"owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1422505657, "post_id": 28183867, "comment_id": 44779211, "body": "I had thought of that, and it is what I am currently doing. I just thought that this method should work as well, and wanted to know why it doesn&#39;t. I was hoping Haskells laziness would have allowed me to use <code>undefined</code> when reading forms back in."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1422506277, "post_id": 28183867, "comment_id": 44779357, "body": "Cool, I would probably avoid <code>undefined</code>. For doing it with hidden fields, I just posted an answer that would work for you."}], "answers": [{"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 0, "last_activity_date": 1422505952, "creation_date": 1422505952, "answer_id": 28207052, "question_id": 28183867, "link": "https://stackoverflow.com/questions/28183867/which-form-to-run/28207052#28207052", "title": "Which form to run?", "body": "<p>So, I'd probably advise moving your counter ID into the URL, so you're doing something like POSTing to /counters/1/increment or something. Feels slightly off to have the ID in a hidden field.</p>\n\n<p>However, if you did want to keep it in a hidden field, you can have the form take a <code>Maybe (Entity Counter)</code> as an argument. What you'll do is when the user GETs the page and you're generating the form, you'll pass in a <code>(Just entity)</code> as the argument which you'll use to populate the hidden field. When the user POSTs to you and you run the form, you'll provide no default value (because you want the value that was stored in the hidden field).</p>\n\n<p>Here's an example of what that would look like:</p>\n\n<pre><code>data MyForm = MyForm\n    { increment :: Integer\n    , counterId :: CounterId\n    }\n  deriving Show\n\nmyForm :: Maybe (Entity Counter) -&gt; AForm Handler MyForm\nmyForm maybeEntity = MyForm\n        &lt;$&gt; areq intField \"How much to increment?\" Nothing\n        &lt;*&gt; areq hiddenField \"\" (entityKey &lt;$&gt; maybeEntity)\n</code></pre>\n\n<p>When generating the form, provide a value for the hidden field:</p>\n\n<pre><code>(widget, enctype) &lt;- generateFormPost $ renderBootstrap (myForm (Just someEntity))\n</code></pre>\n\n<p>When running the form, don't provide a default value; the hidden field should have the data already:</p>\n\n<pre><code>((res, widget), enctype) &lt;- runFormPost $ renderBootstrap (myForm Nothing)\n</code></pre>\n"}], "owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 28207052, "answer_count": 1, "score": 2, "last_activity_date": 1422505952, "creation_date": 1422413963, "last_edit_date": 1422414608, "question_id": 28183867, "link": "https://stackoverflow.com/questions/28183867/which-form-to-run", "title": "Which form to run?", "body": "<p>I'm trying to build a page with multiple similar forms on one page. Each form is very simple, it provides an integer input and a submit button. Each form corresponds to a counter, and the counter is supposed to be increased when the form is submitted.</p>\n\n<pre><code>incrementCounterForm :: Entity Counter -&gt; Form (CounterId, Int)\nincrementCounterForm (Entity i _) = renderBoostrap3 BootstrapInlineForm\n                                      $ (,) \n                                        &lt;$&gt; pure i \n                                        &lt;*&gt; areq intField \"value\" Nothing\n</code></pre>\n\n<p>In my GET handler I do</p>\n\n<pre><code>counters &lt;- runDB $ selectList [] [] -- Get all the current counters\nforms &lt;- mapM (generateFormPost . incrementCounterForm) counters -- Generate the forms\n</code></pre>\n\n<p>Then in my hamlet file I iterate over the forms and render them all individually (they all go to the same handler).</p>\n\n<p>My question relates to the POST handler. How do I do the runFormPost?</p>\n\n<pre><code>((result,_),_) &lt;- runFormPost $ incrementCounterForm undefined\n</code></pre>\n\n<p>What should <code>undefined</code> be here? I want to get the counter from the form, not have to provide one.</p>\n\n<p>EDIT: I lied about providing an arbitrary counter working</p>\n\n<p><s>If I do provide an arbitrary <code>Entity Counter</code> it seems to work (the provided counter is not used in the result). Yet, I can't leave it as <code>undefined</code> because runFormPost seems to evaluate it.</s></p>\n"}, {"tags": ["haskell", "type-kinds"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 11, "last_activity_date": 1422412658, "creation_date": 1422412658, "answer_id": 28183675, "question_id": 28183641, "link": "https://stackoverflow.com/questions/28183641/type-instance-that-returns/28183675#28183675", "title": "Type instance that returns * -&gt; *", "body": "<p>The default kind for arguments is <code>*</code>; but you can override the default by giving a kind annotation. Like this:</p>\n\n<pre><code>type family LowerTriPacked (v :: * -&gt; *) :: * -&gt; *\n</code></pre>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 28183675, "answer_count": 1, "score": 4, "last_activity_date": 1422418247, "creation_date": 1422412428, "last_edit_date": 1422418247, "question_id": 28183641, "link": "https://stackoverflow.com/questions/28183641/type-instance-that-returns", "title": "Type instance that returns * -&gt; *", "body": "<p>I'm using the <code>linear</code> library, and I'm trying to create a way to reason about triangular matrices. </p>\n\n<p>As a first step, I'm trying to create a way to figure out the size of a lower triangular matrix. So for example, a <code>M22</code> has a lower triangular matrix with 3 elements, so it would be mapped to <code>V3</code>.</p>\n\n<p>Here is my attempt:</p>\n\n<pre><code>import Linear\n\ntype family LowerTriPacked v :: * -&gt; *\ntype instance LowerTriPacked V0 = V0\ntype instance LowerTriPacked V1 = V1\ntype instance LowerTriPacked V2 = V3\n</code></pre>\n\n<p>But it doesn't type check, with:</p>\n\n<pre><code>Expecting one more argument to \u2018V0\u2019\nThe first argument of \u2018LowerTriPacked\u2019 should have kind \u2018*\u2019,\n  but \u2018V0\u2019 has kind \u2018* -&gt; *\u2019\nIn the type \u2018V0\u2019\nIn the type instance declaration for \u2018LowerTriPacked\u2019\n</code></pre>\n\n<p>This does type check:</p>\n\n<pre><code>type family LowerTriPacked2 v :: *\ntype instance LowerTriPacked2 (V0 a) = V0 a\ntype instance LowerTriPacked2 (V1 a) = V1 a\ntype instance LowerTriPacked2 (V2 a) = V3 a\n</code></pre>\n\n<p>But it's not what I want, since now I can't use</p>\n\n<pre><code>class (Traversable (LowerTriPacked2 v a)) =&gt; Triangular v a\n</code></pre>\n\n<p>Because <code>Traversable</code> has kind <code>* -&gt; *</code>. </p>\n\n<p>What's wrong with my syntax for the first attempt?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1422406577, "post_id": 28182292, "comment_id": 44734919, "body": "Where do you want to perform the compiles - on your computer or the other computer?"}], "answers": [{"comments": [{"owner": {"reputation": 3418, "user_id": 738762, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0ef9a1ef193431ba6a0e2fc5c71ab22d?s=128&d=identicon&r=PG", "display_name": "nomen", "link": "https://stackoverflow.com/users/738762/nomen"}, "edited": false, "score": 0, "creation_date": 1422558288, "post_id": 28183333, "comment_id": 44808090, "body": "This is very close, but I had to adjust the <code>sed</code> command.  Thank you!"}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 1, "creation_date": 1479429575, "post_id": 28183333, "comment_id": 68566136, "body": "Adjust it to what?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 0, "creation_date": 1479432626, "post_id": 28183333, "comment_id": 68566843, "body": "@IvanPerez Just run <code>cabal install --dependencies-only --dry-run</code> and eyeball the output. Most of the lines will be a package name and version number like <code>my-great-package-3.2.0.0</code>, but there will be a few lines that obviously don&#39;t fit that pattern. Use whatever tool you&#39;re comfortable with to strip out those lines."}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "reply_to_user": {"reputation": 3418, "user_id": 738762, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0ef9a1ef193431ba6a0e2fc5c71ab22d?s=128&d=identicon&r=PG", "display_name": "nomen", "link": "https://stackoverflow.com/users/738762/nomen"}, "edited": false, "score": 1, "creation_date": 1479483566, "post_id": 28183333, "comment_id": 68591796, "body": "I was asking @nomen.  Thanks, although &quot;check by yourself&quot; does not help. I&#39;m happy using <code>sed</code>, that&#39;s not the point at all. Another way of asking @nomen what I asked is &quot;Is what you changed something ad-hoc for your case, or something that could be helpful for others? If it&#39;s the latter, could you explain what it is?&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 0, "creation_date": 1479490120, "post_id": 28183333, "comment_id": 68596021, "body": "@IvanPerez Do you believe that I did not answer those questions? I believe I did: I explained what might have to change for other people, and gave (what I thought was) a helpful explanation of how to figure out what to do to recover from the differences between my machine and theirs. Indeed, I think &quot;check by yourself&quot; is more likely to help than &quot;do whatever nomen says he did two years ago and hope he remembered it right and that it works for you, too&quot;."}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 2, "creation_date": 1479593869, "post_id": 28183333, "comment_id": 68626196, "body": "@DanielWagner Please stop this. I was really asking nomen. Neither of your comments added any useful information. I&#39;m not trying to insult you. I&#39;m not here to pick a fight. I&#39;m just talking to someone else, to see if s/he has something useful to add.  Your command worked for me, and I was just trying to understand what might have to be changed in other cases."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1422409959, "creation_date": 1422409959, "answer_id": 28183333, "question_id": 28182292, "link": "https://stackoverflow.com/questions/28182292/cabal-fetch-dependencies-for-current-package/28183333#28183333", "title": "Cabal fetch dependencies for current package", "body": "<p>You could try this:</p>\n\n<pre><code>cabal fetch `cabal install --dependencies-only --dry-run | sed 1,2d`\n</code></pre>\n\n<p>You might want to do it in a fresh sandbox so it doesn't skip dependencies that are already installed.</p>\n\n<p>Aren't *nix tools great?</p>\n"}], "owner": {"reputation": 3418, "user_id": 738762, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0ef9a1ef193431ba6a0e2fc5c71ab22d?s=128&d=identicon&r=PG", "display_name": "nomen", "link": "https://stackoverflow.com/users/738762/nomen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 28183333, "answer_count": 1, "score": 1, "last_activity_date": 1422409959, "creation_date": 1422403157, "question_id": 28182292, "link": "https://stackoverflow.com/questions/28182292/cabal-fetch-dependencies-for-current-package", "title": "Cabal fetch dependencies for current package", "body": "<p>I wrote a package that I am trying to build.  For reasons, I do not want to install it on my laptop.  I want to download all of its dependencies and install it on another computer.  How can I do that?  If I run</p>\n\n<pre><code>$ cd my-package\n$ cabal fetch .\n</code></pre>\n\n<p>cabal says <code>no packages requested</code>.  If I do</p>\n\n<pre><code>$ cabal fetch my-package.cabal\n</code></pre>\n\n<p>it does read the cabal file, but then it actually tries to download packages that don't exist on hackage, but are in my sandbox.</p>\n"}, {"tags": ["haskell", "dependent-type"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1422400508, "post_id": 28181467, "comment_id": 44732865, "body": "Just a note: you can&#39;t really do induction with the built in type level naturals, because arithmetic is done with type families, which are non-injective, and you end up not being able to convince the typechecker of very obvious things. This particular application is well suited for type nats because no induction is required."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422400644, "post_id": 28181467, "comment_id": 44732914, "body": "@user2407038: Ah, good point. My own uses also didn&#39;t need induction, so it didn&#39;t come to mind. I have run into other cases where I couldn&#39;t convince it of very obvious things though :)."}, {"owner": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422456169, "post_id": 28181467, "comment_id": 44756807, "body": "Thank you so much for providing the detailed answer! I am still digesting the source code of modular-arithmetic and might come up with more questions. Thanks!"}, {"owner": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422632113, "post_id": 28181467, "comment_id": 44839558, "body": "@TikhonJelvis: I am confused by the line #81 in your module. <code>code</code> instance (Read i, Integral i, KnownNat n) =&gt; Read (i <code>Mod</code> n)   where readsPrec prec = map (first toMod) . readsPrec prec <code>code</code>. First, since the toMod has not been implemented as an instance of Arrow, how does &quot;first&quot; make sense; second, I am always confused by the readsPrec function - seems a cyclic definition (left side and right side both use the same function with same argument). Please help. Thanks!"}, {"owner": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422632600, "post_id": 28181467, "comment_id": 44839876, "body": "@TikhonJelvis: Another question about the Arrow class - in the function &quot;first&quot;, where comes the class variable &quot;d&quot; on the right side?"}, {"owner": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422636375, "post_id": 28181467, "comment_id": 44842298, "body": "@TikhonJelvis: OK. Now I understand the &quot;first&quot; - considering &quot;-&gt;&quot; as an Arrow type. So the only thing I do not understand is how &quot;(10 :: (Int/3))&quot; can be parsed by the system - since there is no Read instance for the &quot;3&quot; type defined in GHC.TypeLits. The Read instance SomeNat, as I understand, cannot parse the string &quot; (10 :: (Int/3)) &quot;."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422644723, "post_id": 28181467, "comment_id": 44846539, "body": "@xiphoid: <code>read</code> only determines how to parse things from a string, not how the compiler parses normal code. Indeed, <code>read &quot;10 :: (Int&#47;3)&quot;</code> would not work, but that&#39;s the desired behavior. <code>readsPrec</code> is implemented in terms of <code>readsPrec</code> for the underlying type (ie <code>Int</code> or <code>Integer</code>); I just read one of those and then apply <code>toMod</code> to it."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "edited": false, "score": 0, "creation_date": 1422644780, "post_id": 28181467, "comment_id": 44846573, "body": "@xiphoid: Also, if you have any more questions, just post them as a GitHub issue or email me; using StackOverflow comments for this is a bit awkward."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 5, "last_activity_date": 1422405804, "last_edit_date": 1422405804, "creation_date": 1422398800, "answer_id": 28181467, "question_id": 28181234, "link": "https://stackoverflow.com/questions/28181234/haskell-how-to-define-the-dependent-type-remainder-i-e-rmndr-modulo/28181467#28181467", "title": "Haskell - How to define the dependent type Remainder (i.e. Rmndr modulo)?", "body": "<p>The trick is to use a typeclass to associate each natural number type with a <strong>singleton</strong> value. We do this by creating an instance for <code>Zero</code> associating with <code>0</code> and a recursive instance for <code>Succ x</code>. To access the type itself, we need to take a dummy proxy argument. The idiom for proxy arguments is to use a type variable called <code>proxy a</code>; when you go to call this, you would most often use <code>Proxy</code> from <code>Data.Proxy</code>.</p>\n\n<p>Here's the relevant class:</p>\n\n<pre><code>class SingNat n where\n  sing :: proxy n -&gt; Integer\n</code></pre>\n\n<p>and the instances:</p>\n\n<pre><code>instance SingNat Zero where sing _ = 0\n\ninstance SingNat n =&gt; SingNat (Succ n) where\n  sing _ = 1 + sing (Proxy :: Proxy n)\n</code></pre>\n\n<p>To make all of this work, you also have to enable <code>ScopedTypeVariables</code> which ensures the <code>n</code> in <code>:: Proxy n</code> is the same as the one in <code>SingNat (Succ n)</code>.</p>\n\n<p>A good intuition here is that the two typelcass instances are like the two cases of your <code>decat</code> function, but at the typelevel. Typeclasses used like this function as a little typelevel logic programming language, not unlike a mini Prolog.</p>\n\n<p>Now you can use <code>sing</code> to get the modulo bound in your definition of <code>Eq</code> (and elsewhere):</p>\n\n<pre><code>instance SingNat n =&gt; Eq (Rmndr n) where\n  Rmndr x == Rmndr y = (x `mod` modulo) == (y `mod` modulo)\n    where modulo = sing (Proxy :: Proxy n)\n</code></pre>\n\n<p>This sort of code is a great way to get the hang of type level programming. However, in real code, you probably don't want to roll your own natural number type because GHC has one built-in with <code>DataKinds</code>. Apart from being standard, this also gives you some syntax sugar at the type level letting you write types like <code>Rmndr 10</code>. If you're curious about this approach, take a look at my <a href=\"https://hackage.haskell.org/package/modular-arithmetic\" rel=\"nofollow\">modular-arithmetic</a> package, which implements your reminder type but using the built-in type level numbers and some nicer syntax. The code is short, so just read the source.</p>\n"}], "owner": {"reputation": 63, "user_id": 4500614, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3EhMGMyPaE/AAAAAAAAAAI/AAAAAAAAAS0/Tx9b-TmGKk0/photo.jpg?sz=128", "display_name": "xiphoid", "link": "https://stackoverflow.com/users/4500614/xiphoid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1422405804, "creation_date": 1422397707, "question_id": 28181234, "link": "https://stackoverflow.com/questions/28181234/haskell-how-to-define-the-dependent-type-remainder-i-e-rmndr-modulo", "title": "Haskell - How to define the dependent type Remainder (i.e. Rmndr modulo)?", "body": "<p>My understanding is that the remainder type is a dependent type (depending on the modulo). I read about the DataKinds extension and was able to define it like the following:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, TypeOperators, GADTs #-}\ndata Nat = Zero | Succ Nat\n\ndata Rmndr modulo where\n    Nil :: Rmndr Zero\n    Rmndr :: Integer -&gt; Rmndr modulo\n</code></pre>\n\n<p>But then when I preceeded to implement the Eq class, I stuck at the condition</p>\n\n<pre><code>Rmndr x == Rmndr y = (x `mod` modulo) == (y `mod` modulo)\n</code></pre>\n\n<p>because modulo is not a value, but a type. Even if we can write a function as follow:</p>\n\n<pre><code>decat :: Nat -&gt; Integer\ndecat Zero = 0\ndecat (Succ nat) = decat nat + 1\n</code></pre>\n\n<p>we cannot use it as follows</p>\n\n<pre><code>instance Eq (Rmndr modulo) where\n    Nil == Nil = True\n    Rmndr x == Rmndr y =\n        x `mod` (decat modulo) == y `mod` (decat modulo)\n</code></pre>\n\n<p>because \"modulo\" in this syntax is not a variable.</p>\n\n<p>Can any one help on this puzzle? Thanks a lot! </p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1422394011, "post_id": 28180118, "comment_id": 44729721, "body": "You could install the new ghc into a different $prefix. You would have to add $newprefix/bin to your PATH, but otherwise you wouldn&#39;t have to worry about overwriting anything."}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 21, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1422393256, "creation_date": 1422393256, "question_id": 28180118, "link": "https://stackoverflow.com/questions/28180118/install-prefix-bin-ghc-x-y-z-but-not-overwrite-prefix-bin-ghc", "title": "install $prefix/bin/ghc-X.Y.Z, but not overwrite $prefix/bin/ghc", "body": "<p>I want to install a fresh ghc version (a RC, say), but not overwrite the previous one. (So it should be available as <code>ghc-X.Y.Z</code>, but not as <code>ghc</code>)</p>\n\n<p>I think the only place where overwriting actually happens, is the symlinks for executables. How can I avoid this? (some magic option for <code>make install</code>?) </p>\n\n<p>I know as a work-around I can keep the previous build and re-install.</p>\n"}, {"tags": ["haskell", "state-monad", "io-monad"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 3, "creation_date": 1422387191, "post_id": 28178336, "comment_id": 44726123, "body": "Wait, so it&#39;s the computer that guesses the number?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1422387248, "post_id": 28178336, "comment_id": 44726155, "body": "@Jefffrey yes, in the Lisp version, the computer guesses, not the person; that&#39;s why it&#39;s so much more fun to implement"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1422411979, "post_id": 28178336, "comment_id": 44736338, "body": "See also <a href=\"http://stackoverflow.com/q/10048213/791604\">Managing state</a>."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422388822, "post_id": 28178670, "comment_id": 44726977, "body": "Do you mean you want to interact with the user via the REPL? You can&#39;t use your existing code because a signature like <code>State Bound ()</code> does not permit any IO to be performed and you can&#39;t run <code>bigger</code> and <code>smaller</code> from the REPL - it doesn&#39;t make any sense. You can call <code>runState bigger</code> from the REPL but then you have to also supply the state."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1422387879, "creation_date": 1422387879, "answer_id": 28178670, "question_id": 28178336, "link": "https://stackoverflow.com/questions/28178336/guess-my-number-a-monadic-headache/28178670#28178670", "title": "Guess My Number, a monadic headache", "body": "<p>Here's a solution using the <code>StateT</code> transformer. Notable points:</p>\n\n<ol>\n<li>It reads user input using <code>getLine</code> instead of using the REPL.</li>\n<li>It reads very much like an imperative program except that you have to add <code>liftIO</code> to any IO actions.</li>\n<li>You run the loop with <code>runStateT</code> where you also provide the initial state.</li>\n</ol>\n\n<p>The program:</p>\n\n<pre><code>import Control.Monad.State\n\nloop :: StateT (Int,Int) IO ()\nloop = do\n  (lo,hi) &lt;- get\n  let g = div (lo+hi) 2\n  liftIO $ putStrLn $ \"I guess \" ++ show g\n  ans &lt;- liftIO getLine\n  case ans of\n    \"lower\"  -&gt; do put (lo,g); loop\n    \"higher\" -&gt; do put (g,hi); loop\n    \"exact\"  -&gt; return ()\n    _        -&gt; do liftIO $ putStrLn \"huh?\"; loop\n\nmain = runStateT loop (0,50)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422388132, "post_id": 28178688, "comment_id": 44726633, "body": "I&#39;d like to be able to use my existing code if possible"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1422388386, "post_id": 28178688, "comment_id": 44726757, "body": "@ElectricCoffee: What if your existing code is wrong?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1422388777, "post_id": 28178688, "comment_id": 44726949, "body": "Good programming is all about separation of concerns, having one function that does everything compared to smaller reusable functions is generally always better. What I have right now behaves the way I expect it to, it&#39;s just the remaining bits that need to fall into place"}, {"owner": {"reputation": 186, "user_id": 4499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aefe0c63e15cf14535cabf70a3e005c?s=128&d=identicon&r=PG&f=1", "display_name": "hpdeifel", "link": "https://stackoverflow.com/users/4499466/hpdeifel"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422388887, "post_id": 28178688, "comment_id": 44727009, "body": "@ElectricCoffee I have changed the transformer example to use adaptions of your <code>smaller</code> and <code>bigger</code> functions. I hope you see how this composes. Using your original code exactly is not possible."}], "tags": [], "owner": {"reputation": 186, "user_id": 4499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aefe0c63e15cf14535cabf70a3e005c?s=128&d=identicon&r=PG&f=1", "display_name": "hpdeifel", "link": "https://stackoverflow.com/users/4499466/hpdeifel"}, "is_accepted": false, "score": 2, "last_activity_date": 1422388807, "last_edit_date": 1422388807, "creation_date": 1422387934, "answer_id": 28178688, "question_id": 28178336, "link": "https://stackoverflow.com/questions/28178336/guess-my-number-a-monadic-headache/28178688#28178688", "title": "Guess My Number, a monadic headache", "body": "<p>You don't have to use the State monad at all in this example. Here is an example that passes the state as parameter:</p>\n\n<pre><code>loop :: Bound -&gt; IO ()\nloop bd@(l,u) = do\n  putStr \"&gt; \"\n  line &lt;- getLine\n  case line of\n   \"(guess)\" -&gt; print (guess bd) &gt;&gt; loop bd\n   \"(smaller)\" -&gt; do\n     let newUpper = max l $ dec $ guess bd\n     print $ guess (l, newUpper)\n     loop (l, newUpper)\n   \"(bigger)\" -&gt; do\n     let newLower = min u $ inc $ guess bd\n     print $ guess (newLower, u)\n     loop (newLower, u)\n   \"\" -&gt; return ()\n   _ -&gt; putStrLn \"Can't parse input\" &gt;&gt; loop bd\n\nmain :: IO ()\nmain = loop initial\n</code></pre>\n\n<p>Otherwise, the concept you are looking for are <em>monad transformers</em>. For example using StateT:</p>\n\n<pre><code>smaller :: StateT Bound IO ()\nsmaller = do\n  bd@(l, _) &lt;- get\n  let newUpper = max l $ dec $ guess bd\n  put $ (l, newUpper)\n\nbigger :: StateT Bound IO ()\nbigger = do\n  bd@(_, u) &lt;- get\n  let newLower = min u $ inc $ guess bd\n  put $ (newLower, u)\n\nguessM :: StateT Bound IO ()\nguessM = get &gt;&gt;= lift . print . guess\n\nloop :: StateT Bound IO ()\nloop = do\n  lift $ putStr \"&gt; \"\n  line &lt;- lift getLine\n  case line of\n   \"(guess)\" -&gt; guessM &gt;&gt; loop\n   \"(smaller)\" -&gt; do\n     smaller\n     guessM\n     loop\n   \"(bigger)\" -&gt; do\n     bigger\n     guessM\n     loop\n   \"\" -&gt; return ()\n   _ -&gt; lift (putStrLn \"Can't parse input\") &gt;&gt; loop\n\nmain :: IO ()\nmain = evalStateT loop initial\n</code></pre>\n\n<p>See this <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow\">chapter of Real World Haskell</a> for a tutorial on the subject of monad transformers.</p>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422389191, "post_id": 28178900, "comment_id": 44727171, "body": "very nice, very simple, very elegant! This is exactly what I had in mind"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422389482, "post_id": 28178900, "comment_id": 44727307, "body": "wouldn&#39;t it be better to write <code>print $ guess s</code> instead of <code>putStrLn (show . guess $ s)</code>?, the <code>print</code> function calls <code>show</code> internally anyway"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 12, "last_activity_date": 1422389741, "last_edit_date": 1422389741, "creation_date": 1422388700, "answer_id": 28178900, "question_id": 28178336, "link": "https://stackoverflow.com/questions/28178336/guess-my-number-a-monadic-headache/28178900#28178900", "title": "Guess My Number, a monadic headache", "body": "<p>You can combine different monads using monad transformers - in this case <code>StateT</code>. You can use your existing code by changing the type signatures to use <code>StateT</code>:</p>\n\n<pre><code>bigger, smaller :: Monad m =&gt; StateT Bound m ()\n</code></pre>\n\n<p>then you can write a function to run the game given a state parameter:</p>\n\n<pre><code>game :: StateT Bound IO ()\ngame = do\n  s &lt;- get\n  liftIO $ print (guess s)\n  verdict &lt;- (liftIO getLine)\n  case verdict of\n    \"smaller\" -&gt; smaller &gt;&gt; game\n    \"bigger\" -&gt; bigger &gt;&gt; game\n    \"ok\" -&gt; return ()\n    _ -&gt; (liftIO $ putStrLn $ \"Unknown verdict \" ++ verdict) &gt;&gt; game\n</code></pre>\n\n<p>you use <code>liftIO</code> to lift an <code>IO</code> action into the <code>StateT Bound IO</code> monad, allowing you to prompt for input and read the next line.</p>\n\n<p>Finally you can run the game using <code>runStateT</code>:</p>\n\n<pre><code>runStateT game initial\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 7, "last_activity_date": 1422389037, "creation_date": 1422389037, "answer_id": 28178999, "question_id": 28178336, "link": "https://stackoverflow.com/questions/28178336/guess-my-number-a-monadic-headache/28178999#28178999", "title": "Guess My Number, a monadic headache", "body": "<p>What you ask is sort of possible...</p>\n\n<pre><code>import Data.IORef\n\nmakeGame :: IO (IO (), IO (), IO ())\nmakeGame = do\n    bound &lt;- newIORef (1, 100)\n    let guess = do\n            (min, max) &lt;- readIORef bound\n            print $ (min + max) `div` 2\n\n        smaller = do\n            (min, max) &lt;- readIORef bound\n            let mid = (min + max) `div` 2\n            writeIORef bound (min, mid)\n            guess\n\n        bigger = do\n            (min, max) &lt;- readIORef bound\n            let mid = (min + max) `div` 2\n            writeIORef bound (mid, max)\n            guess\n\n    return (guess, smaller, bigger)\n</code></pre>\n\n<p>Nevermind how much redundancy is in that code, this was just a quick proof of concept. Here's an example session:</p>\n\n<pre><code>$ ghci guess.hs \nGHCi, version 7.9.20141202: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( guess.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; (guess, smaller, bigger) &lt;- makeGame \n*Main&gt; guess\n50\n*Main&gt; smaller\n25\n*Main&gt; bigger\n37\n*Main&gt; \n</code></pre>\n\n<p>Nested <code>IO</code> types can be fun and useful.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 1, "accepted_answer_id": 28178900, "answer_count": 4, "score": 8, "last_activity_date": 1422548324, "creation_date": 1422386463, "last_edit_date": 1422548324, "question_id": 28178336, "link": "https://stackoverflow.com/questions/28178336/guess-my-number-a-monadic-headache", "title": "Guess My Number, a monadic headache", "body": "<p>To test my skills in Haskell, I decided I wanted to implement the very first game you find in <em>Land of Lisp</em> / <em>Realm of Racket</em>. The <em>\"Guess My Number\"</em> game. The game relies on mutable state to run, as it constantly has to update upper and lower bounds for the program to home in on the value the user is thinking of.</p>\n\n<p>It goes a little something like this:</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>&gt; (guess)\n50\n&gt; (smaller)\n25\n&gt; (bigger)\n37\n</code></pre>\n\n<p>Now, this sort of thing (to my knowledge) isn't entirely possible in Haskell, calling some function from the REPL that modifies global mutable state, then prints the result immediately after, as it violates the principle of immutability. Therefore all of the interaction must live inside of an <code>IO</code> and/or <code>State</code> monad. And that's where I'm stuck. </p>\n\n<p>I can't seem to be able to wrap my mind around combining the <code>IO</code> monad and the <code>State</code> monad, so I can get input, print results and modify state, all in the same function.</p>\n\n<p>Here's what I got so far:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Bound = (Int, Int) -- left is the lower bound, right is the upper\n\ninitial :: Bound\ninitial = (1, 100)\n\nguess :: Bound -&gt; Int\nguess (l, u) = (l + u) `div` 2\n\nsmaller :: State Bound ()\nsmaller = do\n  bd@(l, _) &lt;- get\n  let newUpper = max l $ pred $ guess bd\n  put $ (l, newUpper)\n\nbigger :: State Bound ()\nbigger = do\n  bd@(_, u) &lt;- get\n  let newLower = min u $ succ $ guess bd\n  put $ (newLower, u)\n</code></pre>\n\n<p>All I need to do now, is to devise a way to</p>\n\n<ul>\n<li>print initial guess</li>\n<li>receive command wanting smaller/bigger number</li>\n<li>modify state accordingly</li>\n<li>call the function recursively so it guesses again</li>\n</ul>\n\n<p>How do I combine <code>IO</code> and <code>State</code> in an elegant way to achieve this?</p>\n\n<p>Note: I'm aware that this can probably be achieved without the use of state at all; but I want to make it stay true to the original</p>\n"}, {"tags": ["haskell", "compiler-optimization"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1422383786, "post_id": 28177383, "comment_id": 44724280, "body": "How slow is it? How does it compare to the C version?"}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1422383887, "post_id": 28177383, "comment_id": 44724346, "body": "@DavidYoung github benchmark shows next results :  java  real    0m1.290s haskell real    0m30.538s"}], "answers": [{"comments": [{"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "edited": false, "score": 1, "creation_date": 1422388261, "post_id": 28178194, "comment_id": 44726702, "body": "Great answer,thanks. What&#39;s the reason that this code is still some times slower than code in the second version?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422388809, "post_id": 28178194, "comment_id": 44726970, "body": "Remove the conditional jump from <code>cmpsum</code>. Use <code>{-#LANGUAGE MagicHash#-}</code> and <code>import GHC.Exts (I#, (+#), (==#))</code> and then define <code>cmpsum (I# i) (I# j) (I# k) = I# (i +# j ==# k)</code>. No guarantees, but it&#39;ll probably work. LLVM might be doing that already."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422389037, "post_id": 28178194, "comment_id": 44727079, "body": "Ah, but then again, it&#39;s possible branch prediction is actually working right here, and you shouldn&#39;t interfere with it. Hmmmmmm."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422406607, "post_id": 28178194, "comment_id": 44734925, "body": "Very interesting update. I think I know what&#39;s happening here: GHC sees that the three lists are constant, and all but the first are used multiple times. Therefore, it makes the mistake of pulling the constant expressions out of the loop (probably in the first full laziness pass) before the <code>enumFromTo</code> expressions have had a chance to inline and fuse with <code>foldr</code>. I bet you could hack around it by using <code>j &lt;- [1 .. foo 1000 i]</code> and <code>k &lt;- [1 .. foo 1000 j]</code>, where <code>foo</code> is a <code>NOINLINE</code> version of <code>const</code>, but this is definitely troubling, and the compiler gurus may want to make an adjustment."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 9, "last_activity_date": 1422403523, "last_edit_date": 1422403523, "creation_date": 1422385965, "answer_id": 28178194, "question_id": 28177383, "link": "https://stackoverflow.com/questions/28177383/what-are-possible-haskell-optimizations-keys/28178194#28178194", "title": "What are possible Haskell optimizations keys?", "body": "<p>Not a complete answer, sorry. Compiling with GHC 7.10 on my machine I get ~12s for your version.</p>\n\n<p>I'd suggest always compiling with <code>-Wall</code> which shows us that our numbers are being defaulted to the infinite precision <code>Integer</code> type. Fixing that:</p>\n\n<pre><code>module Main where\n\ncmpsum :: Int -&gt; Int -&gt; Int -&gt; Int\ncmpsum i j k =\n    if i + j == k then 1 else 0\n\nmain :: IO ()\nmain = print (sum([cmpsum i j k |\n    i &lt;- [1..1000], j &lt;- [1..1000], k &lt;- [1..1000]]))\n</code></pre>\n\n<p>This runs in ~5s for me. Running with <code>+RTS -s</code> seems to show we have a loop in constant memory:</p>\n\n<pre><code>          87,180 bytes allocated in the heap\n           1,704 bytes copied during GC\n          42,580 bytes maximum residency (1 sample(s))\n          18,860 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    4.920s  (  4.919s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    4.920s  (  4.921s elapsed)\n\n  %GC     time       0.0%  (0.0% elapsed)\n\n  Alloc rate    17,719 bytes per MUT second\n\n  Productivity 100.0% of total user, 100.0% of total elapsed\n</code></pre>\n\n<p><code>-fllvm</code> shaves off another second or so. Maybe someone else can look into it further.</p>\n\n<p><strong>Edit</strong>: Just digging into this a little further. It doesn't look like fusion is happening. Even if I change <code>sum</code> to a <code>foldr (+) 0</code> which is an explicit <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/rewrite-rules.html\" rel=\"nofollow\">\"good producer/good consumer\"</a> pair.</p>\n\n<pre><code>Rec {\n$wgo [InlPrag=[0], Occ=LoopBreaker] :: Int# -&gt; Int#\n[GblId, Arity=1, Str=DmdType &lt;S,U&gt;]\n$wgo =\n  \\ (w :: Int#) -&gt;\n    let {\n      $j :: Int# -&gt; Int#\n      [LclId, Arity=1, Str=DmdType]\n      $j =\n        \\ (ww [OS=OneShot] :: Int#) -&gt;\n          letrec {\n            $wgo1 [InlPrag=[0], Occ=LoopBreaker] :: [Int] -&gt; Int#\n            [LclId, Arity=1, Str=DmdType &lt;S,1*U&gt;]\n            $wgo1 =\n              \\ (w1 :: [Int]) -&gt;\n                case w1 of _ [Occ=Dead] {\n                  [] -&gt; ww;\n                  : y ys -&gt;\n                    case $wgo1 ys of ww1 { __DEFAULT -&gt;\n                    case lvl of _ [Occ=Dead] {\n                      [] -&gt; ww1;\n                      : y1 ys1 -&gt;\n                        case y of _ [Occ=Dead] { I# y2 -&gt;\n                        case y1 of _ [Occ=Dead] { I# y3 -&gt;\n                        case tagToEnum# @ Bool (==# (+# w y2) y3) of _ [Occ=Dead] {\n                          False -&gt;\n                            letrec {\n                              $wgo2 [InlPrag=[0], Occ=LoopBreaker] :: [Int] -&gt; Int#\n                              [LclId, Arity=1, Str=DmdType &lt;S,1*U&gt;]\n                              $wgo2 =\n                                \\ (w2 :: [Int]) -&gt;\n                                  case w2 of _ [Occ=Dead] {\n                                    [] -&gt; ww1;\n                                    : y4 ys2 -&gt;\n                                      case y4 of _ [Occ=Dead] { I# y5 -&gt;\n                                      case tagToEnum# @ Bool (==# (+# w y2) y5) of _ [Occ=Dead] {\n                                        False -&gt; $wgo2 ys2;\n                                        True -&gt; case $wgo2 ys2 of ww2 { __DEFAULT -&gt; +# 1 ww2 }\n                                      }\n                                      }\n                                  }; } in\n                            $wgo2 ys1;\n                          True -&gt;\n                            letrec {\n                              $wgo2 [InlPrag=[0], Occ=LoopBreaker] :: [Int] -&gt; Int#\n                              [LclId, Arity=1, Str=DmdType &lt;S,1*U&gt;]\n                              $wgo2 =\n                                \\ (w2 :: [Int]) -&gt;\n                                  case w2 of _ [Occ=Dead] {\n                                    [] -&gt; ww1;\n                                    : y4 ys2 -&gt;\n                                      case y4 of _ [Occ=Dead] { I# y5 -&gt;\n                                      case tagToEnum# @ Bool (==# (+# w y2) y5) of _ [Occ=Dead] {\n                                        False -&gt; $wgo2 ys2;\n                                        True -&gt; case $wgo2 ys2 of ww2 { __DEFAULT -&gt; +# 1 ww2 }\n                                      }\n                                      }\n                                  }; } in\n                            case $wgo2 ys1 of ww2 { __DEFAULT -&gt; +# 1 ww2 }\n                        }\n                        }\n                        }\n                    }\n                    }\n                }; } in\n          $wgo1 lvl } in\n    case w of wild {\n      __DEFAULT -&gt; case $wgo (+# wild 1) of ww { __DEFAULT -&gt; $j ww };\n      1000 -&gt; $j 0\n    }\nend Rec }\n</code></pre>\n\n<p>In fact, looking at the core for <code>print $ foldr (+) (0:: Int) $ [ i+j | i &lt;- [0..10000], j &lt;- [0..10000]]</code> it seems as though only the first layer of the list comprehension is fused. Is that a bug?</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422387905, "post_id": 28178399, "comment_id": 44726518, "body": "Nope. See jberryman&#39;s answer. The lists are never actually created (because of <code>foldr&#47;build</code> fusion), but the arbitrary-precision integers <i>are</i>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422388016, "post_id": 28178399, "comment_id": 44726575, "body": "<a href=\"https://gist.github.com/2eb24b5d21ef07554d0b\" rel=\"nofollow noreferrer\">A similar but shorter implementation</a>.  I haven&#39;t compared it to the java one, but it runs in ~2.3s on my machine.  BangPatterns didn&#39;t make a real difference in execution time, either."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422388839, "post_id": 28178399, "comment_id": 44726981, "body": "<a href=\"https://gist.github.com/53a34d6fc0359580a843\" rel=\"nofollow noreferrer\">Got it faster and more imperative-looking</a>.  Defined my own <code>for</code> function that generalizes the pattern, and it ends up being about twice as fast as my last test clocking in at ~1.1 to 1.2s on my machine."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422389077, "post_id": 28178399, "comment_id": 44727097, "body": "@bheklilr, does the Core explain why your way works better than specializing the OP code to <code>Int</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422389147, "post_id": 28178399, "comment_id": 44727138, "body": "@dfeuer I haven&#39;t looked at the core yet, but my guess is that the simple recursion is easier to optimize than folding over a list, even with fusion and all that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1422389515, "post_id": 28178399, "comment_id": 44727326, "body": "@bheklilr, desugaring produces just a single <code>build</code> form from the comprehension. <code>sum</code> translates to <code>foldl</code>, which the combination of arity analysis and demand analysis usually can handle properly. So I&#39;m a bit surprised. But I want to go outside while it&#39;s light instead of poring over core."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422390521, "post_id": 28178399, "comment_id": 44727840, "body": "By specializing cmpsum to Int (using the code from jberryman&#39;s answer), the time for the list version goes down to ~25s (from 35s). Still not even close to a version not using lists. I would have expected the list version to be slightly slower, but not so slow. Using the unboxed version of cmpsum actually increases it by about 2s. I&#39;m still on 7.8.3, so I&#39;m curious if there is some big performance difference between that and 7.10. 7.6.3 performs identically to 7.8.3, but I can&#39;t get 7.10 to test it right now."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422397432, "post_id": 28178399, "comment_id": 44731530, "body": "@user2407038, yes, 7.10 has a new arity analysis supporting a new definition of <code>sum</code>, allowing it to fuse with &quot;good producers&quot; like list comprehensions. This erases the lists and allows the <code>Int</code>s  to be unboxed."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422401129, "post_id": 28178399, "comment_id": 44733106, "body": "@dfeuer actually I took a quick peek at core, and it&#39;s doing lots of case-ing on lists, but I didn&#39;t investigate further"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422401261, "post_id": 28178399, "comment_id": 44733149, "body": "@dfeuer &quot;arity analysis&quot; - I looked it up it and it seems likes very cool stuff! Thanks for letting me know."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1422402016, "post_id": 28178399, "comment_id": 44733425, "body": "@jberryman, if it&#39;s doing that with <code>Int</code> in 7.10, then something is a bit strange and might be a bug. See what happens if you manually expand <code>foldl&#39;</code> into its <code>foldr</code> implementation."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422403773, "post_id": 28178399, "comment_id": 44734054, "body": "@dfeuer, yeah see my updated answer. When I try a very simple <code>foldr&#47;comprehension</code> pair on <code>[ i+j | i &lt;- [0..10], j &lt;- [0..10]]</code> it looks to me like only the first level is getting fused, so we get one intermediate list. Seems like that&#39;s at least a documentation bug"}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422406919, "post_id": 28178399, "comment_id": 44735027, "body": "@dfeuer I know essentially nothing of Core or other lower-level optimizations, but for what it&#39;s worth, the brain-dead translation of C loops into Haskell folds is only around 2x slower than this answer and is much faster than the code jberryman posted. See this <a href=\"https://gist.github.com/anonymous/e82fa6dd41c23d4c4183\" rel=\"nofollow noreferrer\">gist</a>. That took around 4.7 seconds to run on my machine compared to 2.0 seconds for this answer, 24.9 seconds for jberryman&#39;s code and 33.8 seconds for the original Haskell code."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1422413965, "post_id": 28178399, "comment_id": 44736833, "body": "FWIW I disagree that the haskell version isn&#39;t a valid translation of the C code. The lists are control structures, and from the documentation we ought to be assured that GHC optimizes them away."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1422410960, "last_edit_date": 1422410960, "creation_date": 1422386670, "answer_id": 28178399, "question_id": 28177383, "link": "https://stackoverflow.com/questions/28177383/what-are-possible-haskell-optimizations-keys/28178399#28178399", "title": "What are possible Haskell optimizations keys?", "body": "<p>You are comparing looping over a single statement to counting by generating an intermediate structure (a list) and folding over it. I don't know how great the performance in Java would be if you created a linked list with a billion elements iterated over it. </p>\n\n<p>Here is Haskell code which is (approximately) equivalent to your Java code.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmain = print (loop3 1 1 1 0) \n\nloop1 :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nloop1 !i !j !k !cc | k &lt;= 1000 = loop1 i j (k+1) (cc + fromEnum (i + j == k))\n                   | otherwise = cc \n\nloop2 :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nloop2 !i !j !k !cc | j &lt;= 1000 = loop2 i (j+1) k (loop1 i j k cc)\n                   | otherwise = cc \n\nloop3 :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nloop3 !i !j !k !cc | i &lt;= 1000 = loop3 (i+1) j k (loop2 i j k cc)\n                   | otherwise = cc \n</code></pre>\n\n<p>And the execution on my machine (test2 is your Haskell code):</p>\n\n<pre><code>$ ghc --make -O2 test1.hs &amp;&amp; ghc --make -O2 test2.hs &amp;&amp; javac test3.java\n$ time ./test1.exe &amp;&amp; time ./test2.exe &amp;&amp; time java test3\n499500\n\nreal    0m1.614s\nuser    0m0.000s\nsys     0m0.000s\n499500\n\nreal    0m35.922s\nuser    0m0.000s\nsys     0m0.000s\n499500\n\nreal    0m1.589s\nuser    0m0.000s\nsys     0m0.015s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1422414127, "post_id": 28183147, "comment_id": 44736886, "body": "Awesome detective work! There ought to be a ticket for this I think; did you happen to check?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1422415586, "post_id": 28183147, "comment_id": 44737264, "body": "@jberryman, I opened one once for something very similar. It turns out to be a bit of a Hard Problem to know when to do what with these things, based on what the gurus said :-/. One of several hard problems is that full laziness is a rather wild transformation that&#39;s not always good, but GHC depends on it quite heavily to support other transformations."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1422416144, "last_edit_date": 1422416144, "creation_date": 1422408457, "answer_id": 28183147, "question_id": 28177383, "link": "https://stackoverflow.com/questions/28177383/what-are-possible-haskell-optimizations-keys/28183147#28183147", "title": "What are possible Haskell optimizations keys?", "body": "<p>This code gets the job done in 1 second and no extra allocation in GHC 7.10 with <code>-O2</code> (see the bottom for profiling output):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>cmpsum :: Int -&gt; Int -&gt; Int -&gt; Int\ncmpsum i j k = fromEnum (i+j==k)\n\nmain = print $ sum [cmpsum i j k | i &lt;- [1..1000],\n                                   j &lt;- [1..const 1000 i],\n                                   k &lt;- [1..const 1000 j]]\n</code></pre>\n\n<p>In GHC 7.8, you can get almost the same results in this case (1.4 seconds) if you add the following at the beginning:</p>\n\n<pre><code>import Prelude hiding (sum)\n\nsum xs = foldr (\\x r a -&gt; a `seq` r (a+x)) id xs 0\n</code></pre>\n\n<p>There are three issues here:</p>\n\n<ol>\n<li><p>Specializing the code to <code>Int</code> instead of letting it default to <code>Integer</code> is crucial.</p></li>\n<li><p>GHC 7.10 offers list fusion for <code>sum</code> that GHC 7.8 does not. This is because the new definition of <code>sum</code>, based on a new definition of <code>foldl</code>, can be very bad in some cases without the \"call arity\" analysis Joachim Breitner created for GHC 7.10.</p></li>\n<li><p>GHC performs a limited \"full laziness\" pass very early in compilation, before any inlining occurs. As a result, the constant <code>[1..1000]</code> terms for <code>j</code> and <code>k</code>, which are used multiple times in the loop, get hoisted out of the loop. This would be good if these were actually expensive to calculate, but in this context it's much cheaper to do the additions over and over and over instead of saving the results. What the code above does is trick GHC. Since <code>const</code> isn't inlined until a little bit later, this first full laziness pass doesn't see that the lists are constant, so it doesn't hoist them out. I wrote it this way because it's nice and short, but it is, admittedly, a little on the fragile side. To make it more robust, use phased inlining:</p>\n\n<pre><code>main = print $ sum [cmpsum i j k | i &lt;- [1..1000],\n                                   j &lt;- [1..konst 1000 i],\n                                   k &lt;- [1..konst 1000 j]]\n\n{-# INLINE [1] konst #-}\nkonst = const\n</code></pre>\n\n<p>This guarantees that <code>konst</code> will be inlined in simplifier phase 1, but no earlier. Phase 1 occurs <em>after</em> list fusion is complete, so it's perfectly safe to let GHC see everything then.</p></li>\n</ol>\n\n<pre class=\"lang-none prettyprint-override\"><code>          51,472 bytes allocated in the heap\n           3,408 bytes copied during GC\n          44,312 bytes maximum residency (1 sample(s))\n          17,128 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0002s    0.0002s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    1.071s  (  1.076s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.073s  (  1.077s elapsed)\n\n  %GC     time       0.0%  (0.0% elapsed)\n\n  Alloc rate    48,059 bytes per MUT second\n\n  Productivity  99.9% of total user, 99.6% of total elapsed\n</code></pre>\n"}], "owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 3, "accepted_answer_id": 28178399, "answer_count": 3, "score": 5, "last_activity_date": 1422416144, "creation_date": 1422382965, "question_id": 28177383, "link": "https://stackoverflow.com/questions/28177383/what-are-possible-haskell-optimizations-keys", "title": "What are possible Haskell optimizations keys?", "body": "<p>I found benchmark that solves really simple task in different languages <a href=\"https://github.com/starius/lang-bench\">https://github.com/starius/lang-bench</a> . Here 's the code for Haskell : </p>\n\n<pre><code>cmpsum i j k =\n    if i + j == k then 1 else 0\n\nmain = print (sum([cmpsum i j k |\n    i &lt;- [1..1000], j &lt;- [1..1000], k &lt;- [1..1000]]))\n</code></pre>\n\n<p>This code runs very slow as you can see in benchmark and I found this very strange. \nI tried to inline the function cmpsum and compile with the next flags: </p>\n\n<pre><code>ghc -c -O2 main.hs\n</code></pre>\n\n<p>but it really didn't help. I am not asking about optimizing the algorithm cause it's the same for all languages, but about possible compiler or code optimizations that can make this code run faster.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 2, "creation_date": 1422382978, "post_id": 28177347, "comment_id": 44723783, "body": "Why are you <code>flip</code>ping <code>==</code>? It should be commutative."}, {"owner": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1422383091, "post_id": 28177347, "comment_id": 44723834, "body": "Without filpping this error is still actually"}], "answers": [{"comments": [{"owner": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "edited": false, "score": 0, "creation_date": 1422383219, "post_id": 28177424, "comment_id": 44723914, "body": "Unfortunetlly i have to be point free because this is my task"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "edited": false, "score": 1, "creation_date": 1422383254, "post_id": 28177424, "comment_id": 44723936, "body": "@KoinArab Your task is write unreadable code for the sake of being point free?"}, {"owner": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "edited": false, "score": 0, "creation_date": 1422383349, "post_id": 28177424, "comment_id": 44723993, "body": "Exacly. It&#39;s one of my test exercises."}, {"owner": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "edited": false, "score": 0, "creation_date": 1422383658, "post_id": 28177424, "comment_id": 44724174, "body": "I agree with you but i do nothing with this."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "edited": false, "score": 0, "creation_date": 1422384383, "post_id": 28177424, "comment_id": 44724647, "body": "@KoinArab Use the <code>pointfree</code> program from the Wild Wide Web to convert your functions to point-free style."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1422389929, "post_id": 28177424, "comment_id": 44727527, "body": "@n.m., I have actually used lambdabot&#39;s @pl feature for real live code (to produce <code>(.)</code> that could actually be turned to coercing <code>(#.)</code> or <code>(.#)</code>, not just to make things unreadable)."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 4, "last_activity_date": 1422383129, "creation_date": 1422383129, "answer_id": 28177424, "question_id": 28177347, "link": "https://stackoverflow.com/questions/28177347/error-in-types-in-haskell/28177424#28177424", "title": "Error in types in haskell", "body": "<p>You are trying way too hard to be point free, just use:</p>\n\n<pre><code>f :: (Eq a) =&gt; a -&gt; [a] -&gt; [a]\nf x = filter (== x)\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>numocc :: (Eq a) =&gt; a -&gt; [[a]] -&gt; [Int]\nnumocc x = map (length . f x)\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/bebf26af109eebb1\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "is_accepted": true, "score": 3, "last_activity_date": 1422383643, "creation_date": 1422383643, "answer_id": 28177561, "question_id": 28177347, "link": "https://stackoverflow.com/questions/28177347/error-in-types-in-haskell/28177561#28177561", "title": "Error in types in haskell", "body": "<p>If I put the definition of <code>f</code> in ghci, I get:</p>\n\n<pre><code>Expected type: (a -&gt; Bool) -&gt; [a] -&gt; a\n  Actual type: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nIn the first argument of `(.)', namely `filter'\nIn the expression: filter . (flip (==))\n</code></pre>\n\n<p>In other words, what results here is a list of type a, when a single instance of type a is expected.\nIf you're applying a predicate to a list, and the result should be a single instance, then you'll probably want to make a fold of some kind.</p>\n\n<p>Changing the type of <code>f</code> to </p>\n\n<pre><code>f:: (Eq a) =&gt; a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>makes this code compile.</p>\n"}], "owner": {"reputation": 839, "user_id": 3498366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/91a7263852ab7602c0c2b013d1a2a2aa?s=128&d=identicon&r=PG&f=1", "display_name": "Koin Arab", "link": "https://stackoverflow.com/users/3498366/koin-arab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 28177561, "answer_count": 2, "score": 1, "last_activity_date": 1422383643, "creation_date": 1422382839, "question_id": 28177347, "link": "https://stackoverflow.com/questions/28177347/error-in-types-in-haskell", "title": "Error in types in haskell", "body": "<p>I get this error:</p>\n\n<pre><code>Type error in application\n*** Expression     : length (filter (flip (==) x))\n*** Term           : filter (flip (==) x)\n*** Type           : [b] -&gt; [b]\n*** Does not match : [a]\n</code></pre>\n\n<p>This is my code:</p>\n\n<pre><code>numocc::(Eq a) =&gt; a -&gt; [[a]] -&gt; [Int]\nnumocc = map.((length.).(f))\n\nf:: (Eq a) =&gt; a -&gt; [a] -&gt; a\nf = filter.(flip (==))\n</code></pre>\n\n<p>I cannot understand the types. Can anybody help me?</p>\n"}, {"tags": ["html", "haskell", "svg", "blaze-html"], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1422390405, "post_id": 28176835, "comment_id": 44727769, "body": "I was using the above packages to generate emails sent with ses-html (relies on blaze-html) and with Chart + Chart-diagrams. The problem is that Gmail does not support SVG."}], "tags": [], "owner": {"reputation": 186, "user_id": 4499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aefe0c63e15cf14535cabf70a3e005c?s=128&d=identicon&r=PG&f=1", "display_name": "hpdeifel", "link": "https://stackoverflow.com/users/4499466/hpdeifel"}, "is_accepted": true, "score": 2, "last_activity_date": 1422381121, "creation_date": 1422381121, "answer_id": 28176835, "question_id": 28175106, "link": "https://stackoverflow.com/questions/28175106/how-to-render-blaze-svg-markup-within-blaze-html/28176835#28176835", "title": "How to render blaze-svg markup within blaze-html", "body": "<p><code>try2</code> first generates a string representation of the SVG with <code>renderSvg</code>, escapes it (<code>toHtml</code>) and includes the result into the HTML output. Using it, you should see the source of the SVG instead of the resulting image.</p>\n\n<p><code>try1</code> should actually work. <code>toHtml</code> is defined as the identity on the <code>Svg</code> type, so you could also just use <code>diagram1</code> directly.</p>\n\n<p>Here is a complete example that generates a HTML document with embedded SVG:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Prelude hiding (head)\nimport Text.Blaze.Svg11 hiding (title)\nimport Text.Blaze.Svg11.Attributes hiding (title)\nimport Text.Blaze.Html5\nimport Text.Blaze.Html.Renderer.Pretty\n\ndiagram1 :: Svg\ndiagram1 = svg ! width \"100\" ! height \"100\" $\n  circle ! cx \"50\" ! cy \"50\" ! r \"40\" ! stroke \"green\"\n         ! strokeWidth \"4\" ! fill \"yellow\"\n\ntry2 :: Html\ntry2 = docTypeHtml $ do\n  head $ title \"Works\"\n  body $ do\n    h1 \"My first diagram\"\n    diagram1\n\nmain :: IO ()\nmain = putStr $ renderHtml try2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1422382384, "creation_date": 1422382384, "answer_id": 28177222, "question_id": 28175106, "link": "https://stackoverflow.com/questions/28175106/how-to-render-blaze-svg-markup-within-blaze-html/28177222#28177222", "title": "How to render blaze-svg markup within blaze-html", "body": "<p>Here is the example from the <code>blaze-svg</code> package modified to be embedded in an HTML document:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Text.Blaze.Svg11 ((!), mkPath, rotate, l, m)\nimport qualified Text.Blaze.Svg11 as S\nimport qualified Text.Blaze.Svg11.Attributes as A\nimport Text.Blaze.Svg.Renderer.String (renderSvg)\nimport qualified Text.Blaze.Html5 as H\nimport Text.Blaze.Html.Renderer.Text\nimport qualified Data.Text.Lazy.IO as TL\n\nmain :: IO ()\nmain = do\n  let a = renderHtml try1 -- renderSvg svgDoc\n  TL.putStrLn a\n\ntry1 :: H.Html\ntry1 = H.html $\n  H.body $ do\n    H.h1 \"My first diagram\"\n    svgDoc\n\n-- svgDoc :: S.Svg\nsvgDoc = S.svg ! A.version \"1.1\" ! A.width \"150\" ! A.height \"100\" ! A.viewbox \"0 0 3 2\" $ do\n    S.g ! A.transform makeTransform $ do\n      S.rect ! A.width \"1\" ! A.height \"2\" ! A.fill \"#008d46\"\n      S.rect ! A.width \"1\" ! A.height \"2\" ! A.fill \"#ffffff\"\n      S.rect ! A.width \"1\" ! A.height \"2\" ! A.fill \"#d2232c\"\n      S.path ! A.d makePath\n\nmakePath :: S.AttributeValue\nmakePath = mkPath $ do\n  l 2 3\n  m 4 5\n\nmakeTransform :: S.AttributeValue\nmakeTransform = rotate 50\n</code></pre>\n"}], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 670, "favorite_count": 1, "accepted_answer_id": 28176835, "answer_count": 2, "score": 1, "last_activity_date": 1422390639, "creation_date": 1422375676, "last_edit_date": 1422390639, "question_id": 28175106, "link": "https://stackoverflow.com/questions/28175106/how-to-render-blaze-svg-markup-within-blaze-html", "title": "How to render blaze-svg markup within blaze-html", "body": "<p>I want to include a svg diagram generated with blaze-svg directly in html generated with blaze-html. Both are based on blaze-markup, so I expected it to be easy.</p>\n\n<pre><code>diagram1 :: Svg\ndiagram1 = ... \n\ntry1 :: Html\ntry1 = html $\n  body $ do\n    h1 \"My first diagram\"\n    toHtml diagram1\n\ntry2 :: Html\ntry2 :: html $\n  body $ do\n    h1 \"My first diagram\"\n    toHtml $ renderSvg diagram1\n</code></pre>\n\n<p>Both try1 and try2 passes the compiler but neither shows the diagram. What is the right way? Is it a problem with including the svg tag directly?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422368916, "post_id": 28172694, "comment_id": 44714740, "body": "Note that your <code>f</code> helper isn&#39;t really useful\u2014<code>(!!!)</code> can just call itself recursively."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1422369098, "post_id": 28172694, "comment_id": 44714861, "body": "@dfeuer It wouldn&#39;t actually be equivalent, the way he has it defined means that if the index is out of bounds the error message will contain the original list and index passed to <code>!!!</code>, which isn&#39;t possible (to my knowledge) without a helper function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422381916, "post_id": 28172694, "comment_id": 44723190, "body": "@bheklilr, ah yes, I didn&#39;t notice that. I don&#39;t usually pay too much attention to the contents of error messages! I should note that doing things like this can have a performance impact as it needs to hold on to a pointer to the front of the list until it completes successfully."}], "answers": [{"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": true, "score": 8, "last_activity_date": 1422377892, "last_edit_date": 1422377892, "creation_date": 1422368731, "answer_id": 28172805, "question_id": 28172694, "link": "https://stackoverflow.com/questions/28172694/why-does-my-alternative-to-function-have-this-type/28172805#28172805", "title": "why does my (alternative to !!) function have this type", "body": "<p>You need some  parenthesis (or a <code>$</code>) in the last line:</p>\n\n<pre><code>error (\"!!!: list \"++(show as)++\" has less than \"++show y++\" elements\")\n</code></pre>\n\n<p>Right now its being parsed as </p>\n\n<pre><code>(error \"!!!: list \") ++ (show as) ++ \" has less than \" ++ show y ++\" elements\"\n</code></pre>\n\n<p>which makes Haskell think that <code>(!!!)</code> is returning a string, which then would mean that its input must be a list of strings.</p>\n"}, {"comments": [{"owner": {"reputation": 305, "user_id": 1487253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1257d24c9fe7e9a62f70cf321ea943ea?s=128&d=identicon&r=PG", "display_name": "timwaagh", "link": "https://stackoverflow.com/users/1487253/timwaagh"}, "edited": false, "score": 0, "creation_date": 1422371594, "post_id": 28172818, "comment_id": 44716523, "body": "thanks. I&#39;ll probably graduate to maybe and its ilk some day."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 6, "last_activity_date": 1422369409, "last_edit_date": 1422369409, "creation_date": 1422368778, "answer_id": 28172818, "question_id": 28172694, "link": "https://stackoverflow.com/questions/28172694/why-does-my-alternative-to-function-have-this-type/28172818#28172818", "title": "why does my (alternative to !!) function have this type", "body": "<p>It's because of your use of <code>error</code>.  The type of <code>error</code> is <code>String -&gt; a</code>, and the way you've typed it the compiler sees it as</p>\n\n<pre><code>f [] _ = (error \"!!!: list \") ++ (show as) ++ \" has less than \" ++ (show y) ++ \" elements\"\n</code></pre>\n\n<p>Since you have a value of type <code>a</code> concatenated with a <code>String</code> (i.e. <code>error \"!!!: list \" ++ show as</code>), then <code>a</code> must be <code>String</code>, and so the return type of <code>f</code> must be <code>String</code>.  You have <code>f (x:xs) 0 = x</code>, so <code>x</code> must have type <code>String</code>, and therefore <code>xs :: [String]</code>.</p>\n\n<p>You can fix this with <code>$</code>:</p>\n\n<pre><code>f [] _ = error $ \"!!!: list \" ++ show as ++ \" has less than \" ++ show y ++ \" elements\"\n</code></pre>\n\n<p>And now the type of this function is <code>(!!!) :: (Show t, Show a, Num a, Eq a) =&gt; [t] -&gt; a -&gt; t</code>, more like what you want.</p>\n\n<p>However, if you want a better way to handle this in code instead of just in a runtime error message you can use the <code>Maybe</code> data type, or even the <code>Either</code> type if you want more information:</p>\n\n<pre><code>(!!?) :: [a] -&gt; Int -&gt; Maybe a\n[]     !!? _ = Nothing\n(x:_)  !!? 0 = Just x\n(_:xs) !!? n = xs !!? (n - 1)\n\n(!!^?) :: [a] -&gt; Int -&gt; Either ([a], Int) a\nys !!^? m = go ys m\n    where\n        go []     _ = Left (ys, m)\n        go (x:_)  0 = Right x\n        go (_:xs) n = go xs $ n - 1\n</code></pre>\n\n<p>Then you could have</p>\n\n<pre><code>showIndexError :: Show a =&gt; Either ([a], Int) a -&gt; String\nshowIndexError (Left (xs, n)) = \"!!^?: list \" ++ show xs ++ \" has less than \" ++ show y ++ \" elements\"\nshowIndexError (Right x) = show x\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 1487253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1257d24c9fe7e9a62f70cf321ea943ea?s=128&d=identicon&r=PG", "display_name": "timwaagh", "link": "https://stackoverflow.com/users/1487253/timwaagh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 28172805, "answer_count": 2, "score": 3, "last_activity_date": 1422377892, "creation_date": 1422368376, "question_id": 28172694, "link": "https://stackoverflow.com/questions/28172694/why-does-my-alternative-to-function-have-this-type", "title": "why does my (alternative to !!) function have this type", "body": "<p>Being a little bit frustrated over the error messages some prelude functions (like !!) give, I tried to write a different version.</p>\n\n<pre><code>--(!!!) :: (Show a,Integral b)=&gt; [a]-&gt;b-&gt;a\nas !!! y=f as y\n    where f (x:xs) b= if b==0\n                      then x\n                      else f xs (b-1)\n          f [] _= error \"!!!: list \"++(show as)++\" has less than \"++show y++\" elements\"\n</code></pre>\n\n<p>However the function type is </p>\n\n<pre><code>*Handydandy&gt; :type (!!!)\n(!!!) :: (Show a, Num a, Eq a) =&gt; [[Char]] -&gt; a -&gt; [Char]\n</code></pre>\n\n<p>I do not understand why the first argument is inferred to be a list of Strings here instead of just a list of show instances. Could anybody explain? </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422365792, "post_id": 28171748, "comment_id": 44712727, "body": "Could you make a type class called Container, and then register all of your container data types as instances of that type class? Then instead of <code>mapUnknown</code> you could do <code>mapContainer</code>, and that function would be one that is required as part of the <code>Container</code> type class."}, {"owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422367396, "post_id": 28171748, "comment_id": 44713733, "body": "See edit -- it doesn&#39;t work."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1422373746, "post_id": 28171748, "comment_id": 44717982, "body": "What you are trying to do won&#39;t work, because <code>forall n. Num n =&gt; Num (v n)</code> is not a valid constraint. However, using the <a href=\"https://hackage.haskell.org/package/constraints-0.4.1.3/docs/Data-Constraint.html\" rel=\"nofollow noreferrer\">constraints package</a>, you can reify the constraint you want as a function of type <code>forall n . Num n :- Num (v n)</code>. The full type of your function could be <code>(forall n . Num n :- Num (v n)) -&gt; (v b -&gt; a) -&gt; [b] -&gt; [a]</code> - but I don&#39;t know what you actually want it to do. Your second example works if you enable <code>OverlappingInstances</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "edited": false, "score": 0, "creation_date": 1422419317, "post_id": 28181276, "comment_id": 44738249, "body": "Sorry, I&#39;m still not entirely getting it. If I have a function signature <code>(Applicative v, NumToNum v) =&gt; v String -&gt; ()</code> would the compiler automatically realize that any <code>v Double</code>s I create are <code>Num</code>s? Or would I have to wrap everything in a pattern match to force it to realize it?"}, {"owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "edited": false, "score": 0, "creation_date": 1422419860, "post_id": 28181276, "comment_id": 44738399, "body": "Would <code>:-</code> from <code>Data.Constraint</code> be useful here?"}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "edited": false, "score": 0, "creation_date": 1422491377, "post_id": 28181276, "comment_id": 44775803, "body": "Yes, you&#39;d have to use pattern matching everywhere. Yes, <code>:-</code> seems a way to go; I was just showing you how to do this by yourself."}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": false, "score": 1, "last_activity_date": 1422397877, "creation_date": 1422397877, "answer_id": 28181276, "question_id": 28171748, "link": "https://stackoverflow.com/questions/28171748/logical-implication-in-type-constraints-haskell/28181276#28181276", "title": "Logical implication in type constraints (Haskell)", "body": "<p>Well, if I understand correctly, you want to make a class, let's say <code>NumToNum</code>, such that from two instances <code>NumToNum v</code> and <code>Num n</code> the compiler would be able to deduce that there is an instance of <code>Num (v n)</code>. Here is how you can accomplish this.</p>\n\n<p>The key thing here is to create a type, say, <code>NumI :: * -&gt; *</code>, such that there won't be any values of type <code>NumI n</code>, unless <code>n</code> is of class <code>Num</code>. Strictly speaking, that's impossible, since any type in Haskell is inhabited (by <code>(_|_)</code>, at least). But, if you avoid explicitly marking implementation methods as <code>undefined</code> and delving into deep recursion, you'd be relatively safe with this:</p>\n\n<pre><code>data NumI n where NumI :: Num n =&gt; NumI n\n</code></pre>\n\n<p>So, if <code>n</code> is not of class <code>Num</code>, there is still the value <code>undefined</code> of type <code>Num n</code>, but not much else.</p>\n\n<p>Of course, you need <code>GADTs</code> extension for that.</p>\n\n<p>Now, the aforementioned class can be defined in this manner:</p>\n\n<pre><code>class NumToNum v where numToNum :: Num n =&gt; NumI (v n)\n</code></pre>\n\n<p>With that in hand, you could get your <code>Num (v n)</code> instance with pattern matching:</p>\n\n<pre><code>case (numToNum :: NumI (v n)) of NumI =&gt; do_something\n</code></pre>\n\n<p>Here <code>do_something</code> already knows about <code>Num (v n)</code> instance, thanks to the type signature of the constructor <code>NumI</code>.</p>\n\n<p>Declaring instances of <code>NumToNum</code> class is easy, you just say</p>\n\n<pre><code>data V n = -- whatever\ninstance Num n =&gt; Num (V n) where -- some implementation\ninstance NumToNum V where numToNum = NumI\n</code></pre>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 947, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1422397877, "creation_date": 1422365573, "last_edit_date": 1422367381, "question_id": 28171748, "link": "https://stackoverflow.com/questions/28171748/logical-implication-in-type-constraints-haskell", "title": "Logical implication in type constraints (Haskell)", "body": "<p>How do I express the idea of a container that fulfills certain \"transparency properties\"? For example, consider a container type <code>v</code> such that <code>Show a</code> implies <code>Show (v a)</code>. </p>\n\n<p>The use case is that I want to have a function where the callee decides what container to use, but the container is guaranteed to be well behaved with respect to many type-class constraints. </p>\n\n<p>Here's a (non-working) example of what I have in mind: </p>\n\n<pre><code>mapUnknown :: (forall v. (Functor v, (forall n. Num n =&gt; Num (v n)) =&gt; v b -&gt; a)) \n              -&gt; [b] -&gt; [a]\n</code></pre>\n\n<p>The idea is that you pass in a function, which must be able to handle any container type <code>v</code>. It is guaranteed that <code>v</code> is a <code>Functor</code> and that <code>Num b</code> implies <code>Num (v b)</code>. If the <code>b</code> you pass in isn't a <code>Num</code>, then that rule is ignored.</p>\n\n<p>Is this possible?</p>\n\n<p>Note:</p>\n\n<p>The following does not work:</p>\n\n<pre><code>class Container c a where\n  foo :: c a -&gt; [a]\n\ninstance forall a c. (Container c a, Show a) =&gt; Show (c a) where\n  show _ = \"whatever\"\n\nf :: (Container c a, Show a) =&gt; c a -&gt; String\nf as =\n  show as\n</code></pre>\n\n<p>This is because we can define an instance <code>Container V a</code> and also <code>Show (V a)</code>. GHC then can't figure out whether to use the <code>show</code> defined by <code>Container</code> or the show defined by <code>Show (V a)</code>. We don't want to define a new <code>show</code> function, we just want to assert that it exists once the type of the container is known.</p>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1422358136, "post_id": 28169297, "comment_id": 44708377, "body": "Use <code>Control.Concurrent.Thread</code> package which has <code>wait</code>. Standard <code>Control.Concurrent</code> threads cannot be waited for. If you want to use them, you need a separate signalling mechanism and each thread needs to explicitly report &quot;I&#39;m done&quot;. See <a href=\"http://hackage.haskell.org/package/concurrent-extra-0.3/docs/Control-Concurrent-Thread.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/concurrent-extra-0.3/docs/&hellip;</a>"}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1422358866, "post_id": 28169297, "comment_id": 44708733, "body": "Could you please give some example link? Thanks."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1422359386, "post_id": 28169297, "comment_id": 44709021, "body": "This problem is discussed in a 2007 Haskell Cafe thread, and you&#39;ll also find some example code there: <a href=\"https://www.haskell.org/pipermail/haskell-cafe/2007-November/035329.html\" rel=\"nofollow noreferrer\">(link)</a>"}, {"owner": {"reputation": 15445, "user_id": 3446, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b785d79619fc2a21e66d5b849341952a?s=128&d=identicon&r=PG", "display_name": "rcreswick", "link": "https://stackoverflow.com/users/3446/rcreswick"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1449532365, "post_id": 28169297, "comment_id": 56039045, "body": "@n.m. It looks like that module went away in v-0.5 for some reason."}], "answers": [{"comments": [{"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "edited": false, "score": 0, "creation_date": 1422360350, "post_id": 28169967, "comment_id": 44709558, "body": "Thank you very much. It&#39;s simple and indeed very useful."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 22, "last_activity_date": 1488194356, "last_edit_date": 1488194356, "creation_date": 1422359870, "answer_id": 28169967, "question_id": 28169297, "link": "https://stackoverflow.com/questions/28169297/how-to-force-main-thread-to-wait-for-all-its-child-threads-finish-in-haskell/28169967#28169967", "title": "How to force main thread to wait for all its child threads finish in Haskell", "body": "<p>What I did in the past was to create a little MVar for each forked thread and then use <code>forkFinally</code> to fork the threads such that at the very end, each thread would put a dummy value into the MVar (i.e. I used the MVar as a synchronisation primitive). I could then call <code>takeMVar</code> on those MVars to wait.</p>\n\n<p>I wrapped it into a little helper function:</p>\n\n<pre><code>forkThread :: IO () -&gt; IO (MVar ())\nforkThread proc = do\n    handle &lt;- newEmptyMVar\n    _ &lt;- forkFinally proc (\\_ -&gt; putMVar handle ())\n    return handle\n</code></pre>\n\n<p>Using this, your code could be changed to something like</p>\n\n<pre><code>-- Fork four threads\nthreads &lt;- forM [5, 3, 7, 1] (\\v -&gt; forkThread (transTest n v))\n\n-- Wait for all of them\nmapM_ takeMVar threads\n</code></pre>\n\n<p><em>However</em>, that was before I read the (most excellent) book \"Parallel and Concurrent Programming in Haskell\" by Simon Marlow, which made me aware of the <a href=\"https://hackage.haskell.org/package/async-2.0.2/docs/Control-Concurrent-Async.html\" rel=\"noreferrer\">async</a> package. The package provides an abstraction which not only takes care of all these things, so you can write just</p>\n\n<pre><code>-- Runs 'transTest n {5,3,7,1}' in parallel and waits for all threads\n_ &lt;- mapConcurrently (transTest n) [5, 3, 7, 1]\n</code></pre>\n\n<p>...it also takes care of things such as (asynchronous) exceptions.</p>\n"}], "owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3252, "favorite_count": 4, "accepted_answer_id": 28169967, "answer_count": 1, "score": 11, "last_activity_date": 1488194356, "creation_date": 1422357669, "question_id": 28169297, "link": "https://stackoverflow.com/questions/28169297/how-to-force-main-thread-to-wait-for-all-its-child-threads-finish-in-haskell", "title": "How to force main thread to wait for all its child threads finish in Haskell", "body": "<p>In the following Haskell code, how to force main thread to wait till all its child threads finish. </p>\n\n<p>I could not able to use forkFinally as given in the section \"Terminating the Program\" here in this link: (<a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Concurrent.html\" rel=\"noreferrer\">http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Concurrent.html</a>).</p>\n\n<p>I get desired result when using TMVar. But I want to do this with TVar.\nPlease help.</p>\n\n<pre><code>module Main\nwhere\nimport Control.Monad\nimport Control.Concurrent\nimport Control.Concurrent.STM\n\ntype TInt = TVar Int\n\ntransTest :: TInt -&gt; Int -&gt; IO ()\ntransTest n t = do \n    atomically $ do \n        t1 &lt;- readTVar n                    \n        doSomeJob t\n        t2 &lt;- readTVar n\n        writeTVar n t\n\ndoSomeJob :: Int -&gt; STM ()\ndoSomeJob t = do\n    x &lt;- newTVar 0\n    let l = 10^6*t\n    forM_ [1..l] (\\i -&gt; do \n        writeTVar x i )            \n\nmain :: IO ()\nmain = do\n    n &lt;- newTVarIO 0\n\n    let v = 5\n    forkIO (transTest n v)\n\n    let v = 3\n    forkIO (transTest n v)\n\n    let v = 7\n    forkIO (transTest n v)\n\n    let v = 1\n    forkIO (transTest n v)  \n\n\n    r &lt;- atomically $ readTVar n\n    putStrLn(\"Last updated value = \" ++ (show r))\n</code></pre>\n"}, {"tags": ["haskell", "dynamic", "static", "typeclass", "dispatch"], "answers": [{"comments": [{"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1422360711, "post_id": 28170189, "comment_id": 44709764, "body": "Thanks that&#39;s awesome - could you clarify re Flipping from Left to Right - could the state of Flippable be determined at runtime?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1422361102, "post_id": 28170189, "comment_id": 44709985, "body": "You can add a method to <code>Flippable</code> interface to determine whether it&#39;s left or right. But this sounds already that, you are searching for ADT: <code>Either a a</code> or <code>(Bool, a)</code> (boolean tells the state)."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1422362224, "last_edit_date": 1422362224, "creation_date": 1422360562, "answer_id": 28170189, "question_id": 28169119, "link": "https://stackoverflow.com/questions/28169119/is-the-dispatch-of-a-haskell-typeclass-dynamic/28170189#28170189", "title": "Is the dispatch of a Haskell TypeClass dynamic?", "body": "<p>It depends what you mean by \"dynamic\" dispatch. There aren't subtyping in haskell, so your Java example is hard to translate.</p>\n\n<p>In situation when you have type class, say <code>Show</code> and want to put different elements into the list, you can use existential quantification:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Showable = forall a. Show a =&gt; Showable a\n\ninstance Show Showable where\n  show (Showable x) = show x\n\ntest :: main ()\ntest = let list = [Showable True, Showable \"string\"]\n       in print list\n\n-- &gt;&gt;&gt; test\n-- [True,\"string\"]\n</code></pre>\n\n<p>Here you can say that dispatch happens \"dynamically\". It happens in the same way as in C++ or Java. The <code>Show</code> dictionary is carried with an object, like a <em>vtable</em> in C++ (or class definition ptr in Java, dunno how it's called).</p>\n\n<p>Yet, as <strong>@MathematicalOrchid</strong> explained, this is an anti-pattern.</p>\n\n<hr>\n\n<p>Yet if you want to flip from <code>Left</code> to <code>Right</code> and back, you can state that in type class definition.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nclass Flippable a b | a -&gt; b where\n  flip' :: Flippable b a =&gt; a -&gt; b\n\nnewtype INL = INL Int deriving Show\nnewtype INR = INR Int deriving Show\n\ninstance Flippable INL INR where\n  flip' (INL x) = INR x\n\ninstance Flippable INR INL where\n  flip' (INR x) = INL x\n\n-- &gt;&gt;&gt; flip' $ INL 1\n-- INR 1\n-- &gt;&gt;&gt; flip' $ flip' $ INL 1\n-- INL 1\n</code></pre>\n\n<p>In this case <code>flip'</code> calls are resolved already at compile-time.</p>\n\n<hr>\n\n<p>You could have have <code>class Flip a where flip' :: a -&gt; Flippable</code> using existential quantification too. Then consecutive calls will be dispatched dynamically. As always, it depends on your needs.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\nclass Flip a where\n  flip' :: a -&gt; Flippable\n\n-- Show is only for repl purposes\ndata Flippable = forall a. (Flip a, Show a) =&gt; Flippable a\n\nderiving instance Show Flippable\n\ninstance Flip Flippable where\n  flip' (Flippable x) = flip' x\n\nnewtype INL = INL Int deriving Show\nnewtype INR = INR Int deriving Show\n\ninstance Flip INL where\n  flip' (INL x) = Flippable (INR x)\n\ninstance Flip INR where\n  flip' (INR x) = Flippable (INL x)\n\n-- &gt;&gt;&gt; flip' $ flip' $ flip' $ INL 1\n-- Flippable (INR 1)\n</code></pre>\n\n<hr>\n\n<p>Hopefully this answers your question.</p>\n"}, {"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 2, "creation_date": 1422362374, "post_id": 28170590, "comment_id": 44710740, "body": "doesn&#39;t <code>Typeable</code> gives possibility to &quot;downcast&quot; (not saying it&#39;s a good idea though)."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422362484, "post_id": 28170590, "comment_id": 44710801, "body": "@phadej Quite right. The pattern I showed above does <i>not</i> allow downcasting. But <code>Typeable</code> and <code>Dynamic</code> exist precisely to allow downcasting."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 6, "creation_date": 1422366233, "post_id": 28170590, "comment_id": 44713002, "body": "It&#39;s not true that Haskell 2010 doesn&#39;t require runtime polymorphism.  Polymorphic recursion is runtime polymorphism, and part of the Haskell 2010 standard.  <code>f :: Show a =&gt; a -&gt; Int -&gt; String ;  f x 0 = show x ; f x n = f (x,x) (n - 1)</code>, for instance."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1422367009, "post_id": 28170590, "comment_id": 44713498, "body": "@Carl That&#39;s interesting. This is the first example of polymorphic recursion I&#39;ve seen that doesn&#39;t actually admit a static resolution. It still seems a bit contrived though; I can&#39;t imaging much real-world code does this..."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1422368252, "post_id": 28170590, "comment_id": 44714303, "body": "Not much, but occasionally it happens. Some of the algorithms working over <code>Data.Sequence.Seq</code> involve polymorphic recursion, due to the definition of the structure."}, {"owner": {"reputation": 1826, "user_id": 519568, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2d77dac9b768c1f5e134afda30314c07?s=128&d=identicon&r=PG", "display_name": "David Jeske", "link": "https://stackoverflow.com/users/519568/david-jeske"}, "edited": false, "score": 0, "creation_date": 1493943753, "post_id": 28170590, "comment_id": 74629940, "body": "&quot;if you have a list of AnyFoo, the only thing you can do with it is call foo or bar on it. So... why not just store the result of foo and bar?&quot; --&gt; Because foo and bar have side effects! In Java UI, it is very common to put objects into List&lt;Drawable&gt; and repeatedly take those objects out and ask them to .draw(), never downcasting them again."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 6, "last_activity_date": 1422361875, "creation_date": 1422361875, "answer_id": 28170590, "question_id": 28169119, "link": "https://stackoverflow.com/questions/28169119/is-the-dispatch-of-a-haskell-typeclass-dynamic/28170590#28170590", "title": "Is the dispatch of a Haskell TypeClass dynamic?", "body": "<p>If your code is Haskell 2010, with no language extensions turned on, Haskell actually doesn't support run-time polymorphism <em>at all!</em></p>\n\n<p>That's quite surprising. Haskell feels like a very polymorphic language. But in fact, all the types can in principle be decided purely at compile-time. (GHC chooses not to, but that's an implementation detail.)</p>\n\n<p>This is exactly the same situation as C++ templates. When you write something like <code>std::vector&lt;int&gt;</code>, the compiler knows, at compile-time, all the times involved. The really surprising thing is just how rarely you actually <em>need</em> true run-time polymorphism!</p>\n\n<p>Now, there are scenarios where you want to run different code based on run-time circumstances. But in Haskell, you can do that just by passing a function as an argument; you don't need to create a \"class\" (in the OOP sense) merely to achieve this.</p>\n\n<p>Now, if you turn on some language extensions (most conspicuously <code>ExistentialQuantification</code>) then you get true, <em>run-time</em> polymorphism.</p>\n\n<p>Note that the main reason people seem to do this is so you can do</p>\n\n<pre><code>class Foo f where\n  bar :: f -&gt; Int\n  baz :: f -&gt; Bool\n\ndata AnyFoo = forall f. Foo =&gt; AnyFoo f\n\nmy_list :: [AnyFoo]\n...\n</code></pre>\n\n<p>This is widely considered a Haskell anti-pattern. In particular, if you upcast stuff in Java to put it into a list, you then later <em>downcast</em> it again. But the code above offers no possibility to ever downcast. You also can't use run-time reflection (since Haskell doesn't have that either). So really, if you have a list of <code>AnyFoo</code>, the <em>only</em> thing you can do with it is call <code>foo</code> or <code>bar</code> on it. So... why not just store the result of <code>foo</code> and <code>bar</code>?</p>\n\n<pre><code>data AnyFoo = AnyFoo {foo :: Int, bar :: Bool}\n</code></pre>\n\n<p>It lets you do exactly the same stuff, but doesn't require any non-standard extensions. In fact, in some ways, it's actually a bit more flexible. You now don't even <em>need</em> a <code>Foo</code> class, you don't <em>need</em> to define a new type for every sort of <code>Foo</code> you might have, just a function that constructs the <code>AnyFoo</code> data structure for it.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1353, "favorite_count": 0, "accepted_answer_id": 28170189, "answer_count": 2, "score": 1, "last_activity_date": 1422362224, "creation_date": 1422357093, "question_id": 28169119, "link": "https://stackoverflow.com/questions/28169119/is-the-dispatch-of-a-haskell-typeclass-dynamic", "title": "Is the dispatch of a Haskell TypeClass dynamic?", "body": "<p>Given the following Haskell code snapshot:</p>\n\n<pre><code>class Foo a where\n   bar  :: a -&gt; ...\n   quux :: a -&gt; ...\n   ...\n</code></pre>\n\n<p>Where the value of a is determined at runtime - the class dispatches on this value. </p>\n\n<p>I'm assuming that the compiler can statically check the types at compile-time, and ensure that no invalid types can dispatch on it. </p>\n\n<p>Now if we compare this to a dynamic dispatch in Java:</p>\n\n<pre><code>interface Flippable {\n  Flippable flip();\n}\n\nclass Left implements Flippable {\n  Right flip();\n}\n\nclass Right implements Flippable {\n  Left flip();\n}\n\nclass Demo {\n  public static void main(String args[]) {\n    Flippable flippable = new Right();\n    System.out.println(flippable.flip);\n  }\n}\n</code></pre>\n\n<p><strong>Assumptions:</strong></p>\n\n<ul>\n<li>Haskell can dispatch on return type as well as multiple arguments making dispatch different to other languages. </li>\n</ul>\n\n<p>My question is: <strong>Is the dispatch of a Haskell TypeClass dynamic?</strong></p>\n"}, {"tags": ["haskell", "types", "type-signature"], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422356220, "post_id": 28167997, "comment_id": 44707268, "body": "the <code>type</code> declaration will be painful to work with, though. Related <a href=\"http://stackoverflow.com/questions/21259931/how-to-work-with-higher-rank-types\">SO Q/A</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1422354206, "last_edit_date": 1422354206, "creation_date": 1422353869, "answer_id": 28167997, "question_id": 28167918, "link": "https://stackoverflow.com/questions/28167918/why-does-the-type-signature-look-like-this-converting-church-number-to-int/28167997#28167997", "title": "Why does the type signature look like this? (Converting Church number to Int)", "body": "<p>If you use <code>a</code> in the <code>c2i</code> signature, then it has to work with <em>any</em> <code>a</code>.\nIn other words, <code>a</code> is chosen by the <em>caller</em> of your function.\nConcretely, it has to work with</p>\n\n<pre><code>c2i :: Church String -&gt; Int\n-- that is\nc2i :: ((String -&gt; String) -&gt; String -&gt; String) -&gt; Int\n</code></pre>\n\n<p>Since the code does not work when <code>a = String</code>, the polymorphic type is invalid.</p>\n\n<p>If you do not add a type, the compiler is able to infer some type making the code work. A simpler type could be:</p>\n\n<pre><code>c2i :: Church Int -&gt; Int\n</code></pre>\n\n<p>or, after enabling a few extensions,</p>\n\n<pre><code>c2i :: (forall a. Church a) -&gt; Int\n</code></pre>\n\n<p>In the latter case, we are specifying that <code>a</code> is chosen by <code>c2i</code>, not by the caller. The caller instead has to pass an argument which must have a polymorphic type: i.e., it has to pass a <code>Church a</code> for all <code>a</code>, not just a <code>Church String</code>.</p>\n\n<p>Alternatively, one can even declare</p>\n\n<pre><code>type Church = forall a . (a-&gt;a)-&gt;a-&gt;a\n</code></pre>\n\n<p>and pass around polymorphic values, only.</p>\n"}], "owner": {"reputation": 1913, "user_id": 1332817, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2b78e2725a5c8c1cd3ab2e502afff71?s=128&d=identicon&r=PG", "display_name": "abcdabcd987", "link": "https://stackoverflow.com/users/1332817/abcdabcd987"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 28167997, "answer_count": 1, "score": 3, "last_activity_date": 1422354206, "creation_date": 1422353606, "question_id": 28167918, "link": "https://stackoverflow.com/questions/28167918/why-does-the-type-signature-look-like-this-converting-church-number-to-int", "title": "Why does the type signature look like this? (Converting Church number to Int)", "body": "<p>I'm learning Haskell and trying to write a function that convert a Church number into a Int. My code works only if I don't write a type signature.</p>\n\n<pre><code>type Church a = (a -&gt; a) -&gt; a -&gt; a\n\nzero :: Church a\nzero s z = z\n\nc2i :: Church a -&gt; Int   -- This line fails\nc2i x = x (+1) 0\n</code></pre>\n\n<p>I've got the right type signature of <code>c2i</code> using <code>:t c2i</code></p>\n\n<pre><code>c2i :: (Num a1, Num a) =&gt; ((a -&gt; a) -&gt; a1 -&gt; t) -&gt; t\n</code></pre>\n\n<p>but I'm wondering why it is?</p>\n"}, {"tags": ["haskell", "compiler-errors", "typeclass", "type-safety"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1422322476, "post_id": 28161681, "comment_id": 44694878, "body": "&quot;There should be no conflict because Line is not an instance of BoundLinear&quot;. This is untrue, because classes are open and someone can come along and make Line and instance of BoundedLinear. More technically, there is a conflict because <code>bdl</code> (a free type variable) can be instantiated to <code>Line</code>. Even more technically, ghc only looks at the head of the instance (the part to the right of the <code>=&gt;</code>) when deciding if instances are overlapping. You can enabled <code>OverlappingInstances</code> to make your code pass the typechecker."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1422323635, "post_id": 28161681, "comment_id": 44695194, "body": "But you probably shouldn&#39;t because <code>OverlappingInstances</code> is way too complicated/messy/fragile."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422324811, "post_id": 28161681, "comment_id": 44695448, "body": "There are some interesting tricks with type families I&#39;ve seen around here; I&#39;m not sure if one of them would apply here."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1422325201, "post_id": 28161681, "comment_id": 44695553, "body": "You could have a <code>newtype BL a = BL{ unBL :: a}</code> wrapper and write the <code>TopVec</code> and <code>PointSet</code> instances for those, e.g. <code>instance (BoundLinear bdl) =&gt; TopVec (BL bdl) where linearSpan (BL bdline) = Line 0 0</code>. Then you can opt-in to use the <code>BoundLinear</code>-based instances by wrapping your type in <code>BL</code>."}, {"owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1422326152, "post_id": 28161681, "comment_id": 44695767, "body": "@Cactus, that would work, but it would also undermine the overloading that is the whole point of working with type classes and type families."}, {"owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "edited": false, "score": 0, "creation_date": 1422326252, "post_id": 28161681, "comment_id": 44695791, "body": "Is there some way to tell the compiler that a certain type will never be made an instance of another class?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422332051, "post_id": 28161681, "comment_id": 44697218, "body": "In this case, I&#39;d use <code>liesInLine</code> in the last instance definition. So we can help compiler to pick the right method, unambiguously."}, {"owner": {"reputation": 14780, "user_id": 210905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9e2d3ebb7e06cd11a5ca3fdaf12cce9?s=128&d=identicon&r=PG", "display_name": "Odomontois", "link": "https://stackoverflow.com/users/210905/odomontois"}, "edited": false, "score": 1, "creation_date": 1422347628, "post_id": 28161681, "comment_id": 44702571, "body": "If more precisely you want to define <code>TopVec</code> and <code>PointSet</code> as superclasses of <code>BoundLinear</code> which instances could be automatically build upon subclass instance.   This is <a href=\"https://ghc.haskell.org/trac/ghc/wiki/IntrinsicSuperclasses\" rel=\"nofollow noreferrer\">already proposed here</a> so you could wait couple years for new GHC version or wrap it to the <code>newtype</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422385291, "post_id": 28161681, "comment_id": 44725099, "body": "FYI, I found the funky type family question I was looking for: <a href=\"http://stackoverflow.com/questions/26641559/closed-type-families-and-strange-function-types\" title=\"closed type families and strange function types\">stackoverflow.com/questions/26641559/&hellip;</a>. I don&#39;t think it applies directly, but you might be able to find a way to use some of those ideas."}], "owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1422321577, "creation_date": 1422321577, "question_id": 28161681, "link": "https://stackoverflow.com/questions/28161681/overlapping-type-class-instances-in-haskell", "title": "Overlapping Type Class Instances in Haskell", "body": "<p>I'm writing a geometry library in Haskell that makes good use of type classes and the type checker to help enforce the validity of geometric operations. However the compiler complains that I have overlapping instances. Below is a minimal example, where I have replaced vector types with <code>Int</code> to simplify the code.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nclass PointSet a where\n  liesIn :: Int -&gt; a -&gt; Bool\n\ndata Line = Line Int Int\n\nclass TopVec a where\n  linearSpan :: a -&gt; Line\n\ninstance PointSet Line where\n  point `liesIn` _ = True\n\nclass BoundLinear a where\n  direction  :: a -&gt; Int\n\ninstance (BoundLinear bdl) =&gt; TopVec bdl where\n  linearSpan bdline = Line 0 0\n\ninstance (BoundLinear bdl) =&gt; PointSet bdl where\n  point `liesIn` bdline = point `liesIn` (linearSpan bdline)\n</code></pre>\n\n<p>The compiler (GHC 6.10.3) complains that I have overlapping instances for <code>PointSet Line</code>, arising from the use of <code>liesIn</code>. The matching instances are <code>PointSet Line</code> and <code>(BoundLinear bdl) =&gt; PointSet bdl</code>. But this doesn't make sense, because the the only instances of <code>PointSet</code> should be <code>Line</code> and any instance of <code>BoundLinear</code>. There should be no conflict because <code>Line</code> is not an instance of <code>BoundLinear</code>. Can anybody throw some light on this?</p>\n"}, {"tags": ["haskell", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422308478, "post_id": 28159134, "comment_id": 44689853, "body": "sure you can do that in C#, and it&#39;s fairly easy too; if you know how anyway"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1422309327, "post_id": 28159134, "comment_id": 44690283, "body": "They are simply two different data structures with perhaps different uses, advantages, disadvantages (and perhaps not). For example, <code>Data.IntMap</code> is of the latter form (data only on leaves) and <code>Data.Map</code> is of the former. What&#39;s the point of having both? The documentation has this to say: &quot;[IntMap] performs especially well on binary operations like union and intersection. However, my benchmarks show that it is also (much) faster on insertions and deletions when compared to [Data.Map]&quot;. Finally, I wouldn&#39;t say the second version is &quot;much more prevalent&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422308818, "post_id": 28159269, "comment_id": 44690044, "body": "I can see it in the case of a parse tree, where, say an operator is the branch, and an operand is the leaf; I still, however can&#39;t see the benefit of having a data tree with the data in the leaves, you&#39;d just end up having this giant tree containing no data at all, and then a bunch of data at the end. Wouldn&#39;t doing that hurt lookup time like crazy? and wouldn&#39;t it then just be better to use a normal list?"}, {"owner": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422309011, "post_id": 28159269, "comment_id": 44690127, "body": "@ElectricCoffee I think that depends on what you want to do. If you&#39;re not storing elements in sorted order, you could either have a rigidly-prescribed structure for the trees (for example, perfect binary trees) and then look up individual elements by index by using math on the sizes of those trees. This is actually sometimes done in practice; check out skew binomial random access lists for an example. If you&#39;re trying to make a BST, though, it&#39;s definitely not a good idea to store the elements purely in the leaves without leaving some auxiliary data up in the nodes."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 5, "creation_date": 1422318146, "post_id": 28159269, "comment_id": 44693666, "body": "@ElectricCoffee A Huffman tree is all about paths taken through the tree. The nodes don&#39;t need anything other than pointers to their children. It&#39;s just one of many example of a use case where the nodes don&#39;t need data."}, {"owner": {"reputation": 3211, "user_id": 898649, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/63c72161fba6e27cb05c078651c5e969?s=128&d=identicon&r=PG", "display_name": "Alexey", "link": "https://stackoverflow.com/users/898649/alexey"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1511168705, "post_id": 28159269, "comment_id": 81729585, "body": "@ElectricCoffee, &quot;giant tree containing no data at all, and then a bunch of data at the end&quot;: as can be seen from your diagrams in the question, the set of leaves is more &quot;giant&quot; than the rest of the tree."}], "tags": [], "owner": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "is_accepted": false, "score": 6, "last_activity_date": 1422309306, "last_edit_date": 1422309306, "creation_date": 1422308559, "answer_id": 28159269, "question_id": 28159134, "link": "https://stackoverflow.com/questions/28159134/trees-with-values-on-the-leaves-only/28159269#28159269", "title": "Trees with values on the leaves only", "body": "<p>I think this depends on what you're trying to model and how you're trying to model it.</p>\n\n<p>A tree where the internal nodes store values and the leaves are just leaves is essentially a standard binary tree (tree each leaf as <code>NULL</code> and you basically have an imperative-style binary tree). If the values are stored in sorted order, you now have a binary search tree. There are many specific advantages to storing data this way, most of which transfer directly over from imperative settings.</p>\n\n<p>Trees where the leaves store the data and the internal nodes are just for structure do have their advantages. For example, red/black trees support two powerful operations called <code>split</code> and <code>join</code> that have advantages in some circumstances. <code>split</code> takes as input a key, then destructively modifies the tree to produce two trees, one of which contains all keys less than the specified input key and one containing the remaining keys. <code>join</code> is, in a sense, the opposite: it takes in two trees where one tree's values are all less than the other tree's values, then fuses them together into a single tree. These operations are particularly difficult to implement on most red/black trees, but are much simpler if all the data is stored in the leaves only rather than in the internal nodes. <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.109.4875&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow\">This paper detailing an imperative implementation of red/black trees</a> mentions that some older implementations of red/black trees used this approach for this very reason.</p>\n\n<p>As another potential advantage of storing keys in the leaves, suppose that you want to implement the concatenate operation, which joins two lists together. If you don't have data in the leaves, this is as simple as</p>\n\n<pre><code>concat first second = Branch first second\n</code></pre>\n\n<p>This works because no data is stored in those nodes. If the data is stored in the leaves, you need to somehow move a key from one of the leaves up to the new concatenation node, which takes more time and is trickier to work with.</p>\n\n<p>Finally, in some cases, you might want to store the data in the leaves because the leaves are fundamentally different from internal nodes. Consider a parse tree, for example, where the leaves store specific terminals from the parse and the internal nodes store all the nonterminals in the production. In this case, there really are two different types of nodes, so it doesn't make sense to store arbitrary data in the internal nodes.</p>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1422326745, "creation_date": 1422326745, "answer_id": 28162394, "question_id": 28159134, "link": "https://stackoverflow.com/questions/28159134/trees-with-values-on-the-leaves-only/28162394#28162394", "title": "Trees with values on the leaves only", "body": "<p>More is <del>better</del> <del>worse</del> more. I'll explain just a couple <em>basic</em> considerations to show why your intuition fails. The general idea, though, is that different data structures need different things.</p>\n\n<p>Empty leaf nodes can actually be a space (and therefore time) problem in some contexts. If a node is represented by a bit of information and two pointers to its children, you'll end up with two null pointers per node whose children are both leaves. That's two machine words per leaf node, which can add up to quite a bit of space. Some structures avoid this by ensuring that each leaf holds at least one piece of information to justify its existence. In some cases (such as <a href=\"https://hackage.haskell.org/package/rope\" rel=\"nofollow\">ropes</a>), each leaf may have a fairly large and dense payload.</p>\n\n<p>Making internal nodes bigger (by storing information in them) makes it more expensive to modify the tree. Changing a leaf in a balanced tree typically forces you to allocate replacements for <code>O(log n)</code> internal nodes. If each of those is larger, you've just allocated more space and spent extra time to copy more words. The extra size of the internal nodes also means that you can fit less of the tree <em>structure</em> into the CPU cache.</p>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1422352292, "post_id": 28166963, "comment_id": 44704918, "body": "it&#39;s all very nice that adding branches to the tree is easier with this kind of list; I just can&#39;t see what good that would do if the branches themselves don&#39;t contain any data. Why add more data-less branches? Doesn&#39;t it just unnecessarily increase the size of the tree?"}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1422353141, "post_id": 28166963, "comment_id": 44705337, "body": "Note that this data type includes (non-empty) linked lists as a subset, since you could just set all the left-hand branches to be <code>Leaf a</code>. So this data structure is capable of doing anything a regular linked list can do (and also it has fast access to the last element, fast snoc, fast append etc).  The non-empty list is <code>data List a = Leaf a | Branch a (List a)</code> -- would you say that this has data at the branches? If so, then in a sense the tree with data at the leaves also has data at the branches (it&#39;s just that the data is in the form of another tree)."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 4, "last_activity_date": 1422350660, "creation_date": 1422350660, "answer_id": 28166963, "question_id": 28159134, "link": "https://stackoverflow.com/questions/28159134/trees-with-values-on-the-leaves-only/28166963#28166963", "title": "Trees with values on the leaves only", "body": "<p>You described a tree with data at the leaves as \"a poorly designed alternative to a List.\"</p>\n\n<p>I agree that this could be used as an alternative to a list, but it's not necessarily poorly designed! Consider the data type</p>\n\n<pre><code>data Tree t = Leaf t | Branch (Tree t) (Tree t)\n</code></pre>\n\n<p>You can define <code>cons</code> and <code>snoc</code> (append to end of list) operations -</p>\n\n<pre><code>cons :: t -&gt; Tree t -&gt; Tree t\ncons t (Leaf s)     = Branch (Leaf t) (Leaf s)\ncons t (Branch l r) = Branch (cons t l) r\n\nsnoc :: Tree t -&gt; t -&gt; Tree t\nsnoc (Leaf s)     t = Branch (Leaf s) (Leaf t)\nsnoc (Branch l r) t = Branch l (snoc r t)\n</code></pre>\n\n<p>These run (for roughly balanced lists) in O(log n) time where n is the length of the list. This contrasts with the standard linked list, which has O(1) <code>cons</code> and O(n) <code>snoc</code> operations. You can also define a constant-time <code>append</code> (as in templatetypedef's answer)</p>\n\n<pre><code>append :: Tree t -&gt; Tree t -&gt; Tree t\nappend l r = Branch l r\n</code></pre>\n\n<p>which is O(1) for two lists of any size, whereas the standard list is O(n) where n is the length of the left argument.</p>\n\n<p>In practice you would want to define slightly smarter versions of these functions which attempt to keep the tree balanced. To do this it is often useful to have some additional information at the branches, which could be done by having multiple kinds of branch (as in a red-black tree which has \"red\" and \"black\" nodes) or explicitly include additional data at the branches, as in</p>\n\n<pre><code>data Tree b a = Leaf a | Branch b (Tree b a) (Tree b a)\n</code></pre>\n\n<p>For example, you can support an O(1) <code>size</code> operation by storing the total number of elements in both subtrees in the nodes. All of your operations on the tree become slightly more complicated since you need to correctly persist the information about subtree sizes -- in effect the work of computing the size of the tree is amortized over all the operations that construct the tree (and cleverly persisted, so that minimal work is done whenever you need to reconstruct a size later).</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3438, "favorite_count": 3, "answer_count": 3, "score": 12, "last_activity_date": 1422350660, "creation_date": 1422307940, "question_id": 28159134, "link": "https://stackoverflow.com/questions/28159134/trees-with-values-on-the-leaves-only", "title": "Trees with values on the leaves only", "body": "<p>A few years ago, during a C# course I learned to write a binary tree that looked more or less like this:</p>\n\n<pre><code>data Tree a = Branch a (Tree a) (Tree a) | Leaf\n</code></pre>\n\n<p>I saw the benefit of it, it had its values on the branches, which allowed for quick and easy lookup and insertion of values, because it would encounter a value on the root of each branch all the way down until it hit a leaf, that held no value.</p>\n\n<p><img src=\"https://i.stack.imgur.com/y7Vsk.png\" alt=\"Each circle with a number is a Branch\"></p>\n\n<p>Ever since I started learning Haskell, however; I've seen numerous examples of trees that are defined like this:</p>\n\n<pre><code>data Tree a = Branch (Tree a) (Tree a) | Leaf a\n</code></pre>\n\n<p>That definition puzzles me. I can't see the usefulness of having data on the elements that <strong>don't</strong> branch, because it would end up leading to a tree that looks like this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/PCe9W.png\" alt=\"The circles with numbers are Leaf nodes\"></p>\n\n<p>Which to me, seems like a poorly designed alternative to a List. It also makes me question the lookup time of it, since it can't asses which branch to go down to find the value it's looking for; but rather needs to go through every node to find what it's looking for.</p>\n\n<p>So, can anyone shed some light on why the second version (value on leaves) is so much more prevalent in Haskell than the first version?</p>\n"}, {"tags": ["haskell", "ghc-generics"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422338188, "post_id": 28159068, "comment_id": 44698934, "body": "AFAIK no. But it&#39;s impossible to have same module twice in the same program (even from different packages)."}, {"owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422340472, "post_id": 28159068, "comment_id": 44699721, "body": "[1] even with <code>PackageImports</code>? (haven&#39;t used it, just heard about it)"}, {"owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422340617, "post_id": 28159068, "comment_id": 44699769, "body": "[2] what does &quot;program&quot; mean, in this context? what if you import two different modules from different packages, which each import the &quot;same&quot; module which are from different packages, neither of which packages  (the latter two) you directly depend on. does that code not compile? And thanks!"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422341743, "post_id": 28159068, "comment_id": 44700218, "body": "Seems that with <code>PackageImports</code> you can import the same module from different packages, even into the same module: <a href=\"https://gist.github.com/phadej/8b628d579ddf6958d937\" rel=\"nofollow noreferrer\">gist.github.com/phadej/8b628d579ddf6958d937</a> Didn&#39;t ever tried to do anything like that!"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422342570, "post_id": 28159068, "comment_id": 44700553, "body": "I created a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10030#ticket\" rel=\"nofollow noreferrer\">ghc ticket</a> let&#39;s see what more wise people respond."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1422381882, "creation_date": 1422381882, "answer_id": 28177069, "question_id": 28159068, "link": "https://stackoverflow.com/questions/28159068/packagename-with-ghc-generics/28177069#28177069", "title": "&quot;packageName&quot; with GHC.Generics", "body": "<p>So far it's impossible to get package name using Generics. There is a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/17\" rel=\"nofollow\">GHC feature request -ticket</a> now. It was straightforward to implement, but let's see when the patch lands release version.</p>\n"}], "owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1422381882, "creation_date": 1422307677, "last_edit_date": 1422337962, "question_id": 28159068, "link": "https://stackoverflow.com/questions/28159068/packagename-with-ghc-generics", "title": "&quot;packageName&quot; with GHC.Generics", "body": "<p>I have a class that provides a globally unique identifier for types:</p>\n\n<pre><code>class Named a where\n nameOf :: a -&gt; (String,String,String) -- (Package, Module, Identifier)\n default nameOf :: (Generic a, Named' (Rep a)) =&gt; a -&gt; (String,String,String)\n nameOf = nameOf' . from\n</code></pre>\n\n<p>which almost works:</p>\n\n<pre><code>&gt;&gt;&gt; data D = C\n&gt;&gt;&gt; instance Named D\n&gt;&gt;&gt; nameOf C\n(\"\",\"Main\",\"D\")\n</code></pre>\n\n<p>but I can't get the datatype's package with <code>GHC.Generics</code>:</p>\n\n<pre><code>class Named' f where  nameOf' :: f a -&gt; (String,String,String)\ninstance (Datatype t) =&gt; Named' (M1 D t f) where nameOf' d = (\"\", moduleName d, datatypeName d)\n</code></pre>\n\n<p>Can I? The GUI's not really \"globally\" unique without the package.</p>\n\n<p>btw, I know that with <code>Data.Typeable</code> I can write:</p>\n\n<pre><code>&gt;&gt;&gt; import Data.Typeable\n&gt;&gt;&gt; :set -XDeriveDataTypeable\n&gt;&gt;&gt; let nameOf = (\\t -&gt; (tyConPackage t, tyConModule t, tyConName t)) . typeRepTyCon . typeRep\n&gt;&gt;&gt; data D = C deriving Typeable\n&gt;&gt;&gt; nameOf (Proxy :: Proxy D)\n(\"interactive\" \"Ghci3\" \"D\")\n</code></pre>\n\n<p>Which is what I may do. But I'm curious about <code>GHC.Generics</code>.</p>\n"}, {"tags": ["haskell", "openshift", "cabal", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 1510, "user_id": 1576064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47c868b652ffdc287498a8c604a30013?s=128&d=identicon&r=PG", "display_name": "Lubom&#237;r Sedl&#225;\u0159", "link": "https://stackoverflow.com/users/1576064/lubom%c3%adr-sedl%c3%a1%c5%99"}, "is_accepted": true, "score": -1, "last_activity_date": 1475823590, "last_edit_date": 1592644375, "creation_date": 1422692665, "answer_id": 28249681, "question_id": 28157282, "link": "https://stackoverflow.com/questions/28157282/cabal-build-failure-on-readargs-when-deploying-to-openshift/28249681#28249681", "title": "Cabal build failure on ReadArgs when deploying to OpenShift", "body": "<p>It turns out this was a bug in the cartridge and is fixed now.</p>\n<p>It used to be <a href=\"https://bitbucket.org/accursoft/haskell-cloud/issues/3/failed-to-install-packages-depending-on\" rel=\"nofollow noreferrer\">issue #3</a>, but the issue tracker seems to have been erased since.</p>\n"}], "owner": {"reputation": 1510, "user_id": 1576064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47c868b652ffdc287498a8c604a30013?s=128&d=identicon&r=PG", "display_name": "Lubom&#237;r Sedl&#225;\u0159", "link": "https://stackoverflow.com/users/1576064/lubom%c3%adr-sedl%c3%a1%c5%99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 28249681, "answer_count": 1, "score": 3, "last_activity_date": 1475823590, "creation_date": 1422300379, "question_id": 28157282, "link": "https://stackoverflow.com/questions/28157282/cabal-build-failure-on-readargs-when-deploying-to-openshift", "title": "Cabal build failure on ReadArgs when deploying to OpenShift", "body": "<p>I am trying to deploy a web application to OpenShift. My app is written with <a href=\"http://www.yesodweb.com/\" rel=\"nofollow\">Yesod web framework</a>. I would like to use the Yesod cartridge from <a href=\"https://wiki.haskell.org/Web/Cloud\" rel=\"nofollow\">Haskell wiki</a>.</p>\n\n<p>I can create the application and deploy the example supplied with the cartridge. However, when I add more dependencies to the cabal file, the build after pushing fails.</p>\n\n<p>An example of failing dependency is <code>ReadArgs</code>. It fails with the following error:</p>\n\n<pre><code>remote: ReadArgs.hs:11:8:\nremote:     Could not find module `Filesystem.Path'\nremote:     There are files missing in the `system-filepath-0.4.12' package,\nremote:     try running 'ghc-pkg check'.\nremote:     Use -v to see a list of the files searched for.\nremote:\nremote: ReadArgs.hs:12:8:\nremote:     Could not find module `Filesystem.Path.CurrentOS'\nremote:     There are files missing in the `system-filepath-0.4.12' package,\nremote:     try running 'ghc-pkg check'.\nremote:     Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>The <code>ghc-pkg check</code> command says following about <code>system-filepath</code>:</p>\n\n<pre><code>There are problems in package system-filepath-0.4.12:\n  Warning: library-dirs: /var/lib/openshift/52a44a9e4382ecf07100007e/app-root/data/workspace/Haskell-Cloud/usr/lib/system-filepath-0.4.12/ghc-7.8.4 doesn't exist or isn't a directory\n  Warning: haddock-interfaces: /var/lib/openshift/52a44a9e4382ecf07100007e/app-root/data/workspace/Haskell-Cloud/usr/share/doc/system-filepath-0.4.12/html/system-filepath.haddock doesn't exist or isn't a file\n  Warning: haddock-html: /var/lib/openshift/52a44a9e4382ecf07100007e/app-root/data/workspace/Haskell-Cloud/usr/share/doc/system-filepath-0.4.12/html doesn't exist or isn't a directory\n  import-dirs: /var/lib/openshift/52a44a9e4382ecf07100007e/app-root/data/workspace/Haskell-Cloud/usr/lib/system-filepath-0.4.12/ghc-7.8.4 doesn't exist or isn't a directory\n  cannot find any of [\"Filesystem/Path.hi\",\"Filesystem/Path.p_hi\",\"Filesystem/Path.dyn_hi\"]\n  cannot find any of [\"Filesystem/Path/CurrentOS.hi\",\"Filesystem/Path/CurrentOS.p_hi\",\"Filesystem/Path/CurrentOS.dyn_hi\"]\n  cannot find any of [\"Filesystem/Path/Rules.hi\",\"Filesystem/Path/Rules.p_hi\",\"Filesystem/Path/Rules.dyn_hi\"]\n  cannot find any of [\"Filesystem/Path/Internal.hi\",\"Filesystem/Path/Internal.p_hi\",\"Filesystem/Path/Internal.dyn_hi\"]\n  cannot find any of [\"libHSsystem-filepath-0.4.12.a\",\"libHSsystem-filepath-0.4.12.p_a\",\"libHSsystem-filepath-0.4.12-ghc7.8.4.so\",\"libHSsystem-filepath-0.4.12-ghc7.8.4.dylib\",\"HSsystem-filepath-0.4.12-ghc7.8.4.dll\"] on library path\n</code></pre>\n\n<p>These seem like serious problems, however it does not tell me how to fix it.</p>\n\n<p>How can I find out why the build fails? How can I get it to build?</p>\n"}, {"tags": ["list", "haskell", "list-comprehension", "primes"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1422304230, "post_id": 28156707, "comment_id": 44687673, "body": "Technically 0 is not a prime. In fact the <a href=\"http://en.wikipedia.org/wiki/Goldbach%27s_conjecture\" title=\"Wikipedia article for Goldbach&#39;s conjecture\" rel=\"nofollow noreferrer\">Goldbach&#39;s conjecture</a> states that every even <i>greater than 2</i>, can be written as the sum of two primes."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1422299967, "creation_date": 1422299967, "answer_id": 28157170, "question_id": 28156707, "link": "https://stackoverflow.com/questions/28156707/generating-tuples-of-primes-with-a-list-comprehension-each-tuple-having-higher/28157170#28157170", "title": "Generating tuples of primes with a list comprehension, each tuple having higher sum", "body": "<p>Since this sounds like a fun programming exercise, I will give a hint rather than a complete solution. Here's a template to get you started: <code>[findPair n | n &lt;- [2,4..]]</code>. You can also implement <code>findPair</code> with a list comprehension (plus <code>head</code> -- which is not recursive -- if you believe the conjecture to be true!).</p>\n"}], "owner": {"reputation": 63, "user_id": 4313075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/600556dcb662c9e66ce23ddc4aafed4d?s=128&d=identicon&r=PG&f=1", "display_name": "m b", "link": "https://stackoverflow.com/users/4313075/m-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 28157170, "answer_count": 1, "score": 1, "last_activity_date": 1422299967, "creation_date": 1422298247, "last_edit_date": 1422299966, "question_id": 28156707, "link": "https://stackoverflow.com/questions/28156707/generating-tuples-of-primes-with-a-list-comprehension-each-tuple-having-higher", "title": "Generating tuples of primes with a list comprehension, each tuple having higher sum", "body": "<p>I searched, but I didn't find something that helped, so I post a new question. I am learning Haskell, and this is an exercise I don't understand.</p>\n\n<p>I want to create an infinite list of tuples of prime numbers, each tuple's sum being a higher even number, beginning with 2. So the output should be e.g. : <code>[(0,2), (2,2), (3,3), (3,5)...</code></p>\n\n<p>I want to do it with a list comprehension only, no recursion. The problem is that each tuple's sum must be higher. I defined my own primetest function <code>prim</code>, and started like:</p>\n\n<pre><code>goldbachList :: [(Int, Int)]\ngoldbachList = [(a,b) | b &lt;- [1 ..], a &lt;- [0 .. b], prim a || a == 0, prim b, a+b &gt;= 2, even (a+b)]\n</code></pre>\n\n<p>but obviously this creates a infinite list with much more tuples than what I want to have. Is there a possibility to include the condition, that every tuple must sum the next even number compared to its predecessor inside the list comprehension?</p>\n"}, {"tags": ["haskell", "f#", "functional-programming", "records"], "comments": [{"owner": {"reputation": 15644, "user_id": 1366219, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iRGsP.png?s=128&g=1", "display_name": "latkin", "link": "https://stackoverflow.com/users/1366219/latkin"}, "edited": false, "score": 3, "creation_date": 1422318941, "post_id": 28156167, "comment_id": 44693923, "body": "No, this is not possible in F# today. Adding support for this (not just for records, but for regular .NET types too) is <i>the</i> top F# <a href=\"https://fslang.uservoice.com/forums/245727-f-language/suggestions/5663326-syntax-for-turning-properties-into-functions\" rel=\"nofollow noreferrer\">language feature request</a> at the moment."}, {"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "reply_to_user": {"reputation": 15644, "user_id": 1366219, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iRGsP.png?s=128&g=1", "display_name": "latkin", "link": "https://stackoverflow.com/users/1366219/latkin"}, "edited": false, "score": 0, "creation_date": 1422322262, "post_id": 28156167, "comment_id": 44694817, "body": "I added my votes. Thanks!"}, {"owner": {"reputation": 440, "user_id": 6621101, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kTLvt.jpg?s=128&g=1", "display_name": "EricP", "link": "https://stackoverflow.com/users/6621101/ericp"}, "reply_to_user": {"reputation": 15644, "user_id": 1366219, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iRGsP.png?s=128&g=1", "display_name": "latkin", "link": "https://stackoverflow.com/users/1366219/latkin"}, "edited": false, "score": 0, "creation_date": 1609692649, "post_id": 28156167, "comment_id": 115896403, "body": "@latkin that link is dead.  Did this feature request get added?"}], "answers": [{"comments": [{"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 0, "creation_date": 1422297995, "post_id": 28156583, "comment_id": 44684521, "body": "Sorry I wasn&#39;t clear enough. Having to define the function manually is precisely what I&#39;m trying to avoid. I edited the question to be precise about this."}, {"owner": {"reputation": 4789, "user_id": 2807130, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/FgiVz.png?s=128&g=1", "display_name": "kaefer", "link": "https://stackoverflow.com/users/2807130/kaefer"}, "reply_to_user": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 0, "creation_date": 1422300303, "post_id": 28156583, "comment_id": 44685654, "body": "@LayGonz&#225;lez I surmise the preferred way to access record fields in F# is via <code>record pattern</code> or property-like dot-notation."}, {"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 0, "creation_date": 1422308859, "post_id": 28156583, "comment_id": 44690060, "body": "I agree that it is very handy. Yet, couldn&#39;t we have both options? without defining manually the function, you could not do things like: <code>a |&gt; labelA</code>"}], "tags": [], "owner": {"reputation": 4789, "user_id": 2807130, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/FgiVz.png?s=128&g=1", "display_name": "kaefer", "link": "https://stackoverflow.com/users/2807130/kaefer"}, "is_accepted": false, "score": 2, "last_activity_date": 1422305500, "last_edit_date": 1422305500, "creation_date": 1422297776, "answer_id": 28156583, "question_id": 28156167, "link": "https://stackoverflow.com/questions/28156167/is-it-possible-to-use-f-records-labels-as-functions-like-in-haskell-or-someth/28156583#28156583", "title": "Is it possible to use F# record&#39;s labels as functions like in Haskell, or something similar?", "body": "<p>It's easily defined.</p>\n\n\n\n<pre class=\"lang-ml prettyprint-override\"><code>type ARecord = { labelA : string; labelB : int }\nlet labelA { labelA = s } = s\n// val labelA : ARecord -&gt; string\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>The following function would compile to identical IL, with direct read access to the backing field, instead of the automatically generated instance property.\nIn contrast to normal experience with object-orientated <em>dot-notation</em>, it doesn't require type annotation to determine the record type.</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let labelA' aRecord = aRecord.labelA\n// val labelA' : aRecord:ARecord -&gt; string\n</code></pre>\n"}], "owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1422305500, "creation_date": 1422296137, "last_edit_date": 1422297955, "question_id": 28156167, "link": "https://stackoverflow.com/questions/28156167/is-it-possible-to-use-f-records-labels-as-functions-like-in-haskell-or-someth", "title": "Is it possible to use F# record&#39;s labels as functions like in Haskell, or something similar?", "body": "<p>In Haskell, given this record:</p>\n\n<pre><code>data ARecord { labelA :: String, labelB :: Int }\n</code></pre>\n\n<p>we get this functions:</p>\n\n<pre><code>labelA :: ARecord -&gt; String\nlabelB :: ARecord -&gt; Int\n</code></pre>\n\n<p>F# doesn't seem to work this way. But, is there something similar?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>By something similar I mean something that saves me from having to define the functions manually, as @kaefer suggested.</p>\n"}, {"tags": ["haskell", "fay"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1422292619, "post_id": 28152174, "comment_id": 44681670, "body": "Unfortunate, sounds like a bug or misfeature."}, {"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 1, "creation_date": 1422293798, "post_id": 28152174, "comment_id": 44682336, "body": "I wouldn&#39;t say there is some correct type for serializing <code>Maybe a</code>. You could use aeson to read and write a <code>Maybe a</code> to/from JSON, provided you know how to read and write <code>a</code> to/from JSON. Or, you could use binary serialization from the cereal package. Both of these packages will work seamlessly with <code>Maybe a</code> provided <code>a</code> has the relevant instances defined. As far as I can tell, <code>showToFay</code> is for converting a Haskell value into something that a JavaScript interpreter could <code>eval()</code>. I don&#39;t think it&#39;s intended for serialization."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1422325038, "post_id": 28152174, "comment_id": 44695506, "body": "Just to clarify, if you know the type on both ends, this misfeature only makes deserialization impossible if you have something like <code>Maybe (Maybe T)</code>, since then you can&#39;t discriminate between <code>Nothing</code> and <code>Just Nothing</code>."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1422349970, "post_id": 28152174, "comment_id": 44703718, "body": "need to pattern match all the time - perhaps not, you can write instances for Monad, MonadPlus, etc."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 0, "creation_date": 1424536906, "post_id": 28152174, "comment_id": 45594094, "body": "@AlexanderVieth I think you could turn your comment into an answer -- it is very much to the point."}], "owner": {"reputation": 5892, "user_id": 293205, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/49d9dd9a9dc4f639823256df0ae14535?s=128&d=identicon&r=PG", "display_name": "coubeatczech", "link": "https://stackoverflow.com/users/293205/coubeatczech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1422282930, "creation_date": 1422282930, "question_id": 28152174, "link": "https://stackoverflow.com/questions/28152174/serializing-maybe-types", "title": "Serializing Maybe types", "body": "<p>What is the correct type for serializing <code>Maybe</code> types? </p>\n\n<p>Given I have some data structure of <code>Maybe</code> type on the server and I serialize it with <code>showToFay</code> function, then it won't become one of the <code>{\"instance\":\"Nothing\"}</code> or <code>{\"instance\":\"Maybe\",\"slot1\":&lt;actual_value&gt;}</code>, but it is serialized as either <code>null</code> or bare inside of the <code>Just</code>. Then it's not possible for me to deserialize it on the client correctly. </p>\n\n<p>I'm using the <code>data MyMaybe a = MyNothing | MyJust a</code> type for now, but it's hard to do with as I need to pattern match all the time and I can't use the combinators defined on <code>Maybe</code>.  </p>\n"}, {"tags": ["haskell", "arrows", "maybe"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1422278733, "creation_date": 1422278733, "answer_id": 28150972, "question_id": 28150825, "link": "https://stackoverflow.com/questions/28150825/how-can-i-use-with-a-maybe-a/28150972#28150972", "title": "How can I use &amp;&amp;&amp; with a -&gt; Maybe a", "body": "<p>You can get pointfree version using <code>liftA2</code>, but I'm not sure if the point-free version is worth the trouble:</p>\n\n<pre><code>\u03bb&gt; :t \\f1 f2 -&gt; uncurry (liftA2 (,)) . (f1 &amp;&amp;&amp; f2)\n\\f1 f2 -&gt; uncurry (liftA2 (,)) . (f1 &amp;&amp;&amp; f2)\n  :: Applicative f =&gt; (b1 -&gt; f a) -&gt; (b1 -&gt; f b) -&gt; b1 -&gt; f (a, b)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422278990, "post_id": 28151003, "comment_id": 44673267, "body": "Cool! I&#39;d rather use <code>Applicative</code>&#39;s <code>liftA2</code> though."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 8, "last_activity_date": 1422279176, "last_edit_date": 1422279176, "creation_date": 1422278832, "answer_id": 28151003, "question_id": 28150825, "link": "https://stackoverflow.com/questions/28150825/how-can-i-use-with-a-maybe-a/28151003#28151003", "title": "How can I use &amp;&amp;&amp; with a -&gt; Maybe a", "body": "<pre><code>import Control.Arrow\nimport Control.Applicative\n\nh :: (Applicative f) =&gt; (a -&gt; f b) -&gt; (a -&gt; f c) -&gt; a -&gt; f (b, c)\nh = liftA2 (liftA2 (,))\n</code></pre>\n\n<p>which is equal to <code>h f g x = liftA2 (,) (f x) (g x)</code></p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 28151003, "answer_count": 2, "score": 4, "last_activity_date": 1422288016, "creation_date": 1422278243, "last_edit_date": 1422288016, "question_id": 28150825, "link": "https://stackoverflow.com/questions/28150825/how-can-i-use-with-a-maybe-a", "title": "How can I use &amp;&amp;&amp; with a -&gt; Maybe a", "body": "<p>I had two functions</p>\n\n<pre><code>f1:: String -&gt; Int\nf2:: String -&gt; Int\n\nf3:: String -&gt; (Int,Int)    \nf3 = f1 &amp;&amp;&amp; f2\n</code></pre>\n\n<p>then they was changed to String -> Maybe Int</p>\n\n<pre><code>f1:: String -&gt; Maybe Int\nf2:: String -&gt; Maybe Int\n\nf3:: String -&gt; (Maybe Int,Maybe Int)    \n</code></pre>\n\n<p>Is there pointfree way to get function </p>\n\n<pre><code>f4:: String -&gt; Maybe (Int, Int)\n</code></pre>\n\n<p>So if both f1 and f2 return Just, f4 will also return Just otherwise Nothing</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 2, "creation_date": 1422276711, "post_id": 28150432, "comment_id": 44672038, "body": "You don&#39;t need <code>Applicative</code> here. Ordinary function application will do: <code>reverse (buildMyList 100 1)</code> or <code>reverse $ buildMyList 100 1</code>."}, {"owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422276932, "post_id": 28150432, "comment_id": 44672146, "body": "yes, I agree with you. It&#39;s meant to be a toy example, as I&#39;m trying to understand why it doesn&#39;t work, so that I can build out my knowledge"}], "answers": [{"comments": [{"owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "edited": false, "score": 0, "creation_date": 1422278885, "post_id": 28150640, "comment_id": 44673196, "body": "thanks for this. I guess I was just trying to understand how I can chain together functions that are functors, in an elegant way. I suppose I could use do notation"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "edited": false, "score": 0, "creation_date": 1422279640, "post_id": 28150640, "comment_id": 44673606, "body": "If you want to chain functions of the form <code>Applicative f =&gt; a -&gt; f b</code> or <code>Monad m =&gt; a -&gt; m b</code>, there are many different ways, depending how you&#39;d like to chain them. <a href=\"http://stackoverflow.com/questions/28150825/how-can-i-use-with-a-maybe-a\">Recent question</a> has already two answers, which are probably interesting to work thru (e.g. which instances apply). I find both obscure, but they show the power of the abstraction."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1422278874, "last_edit_date": 1422278874, "creation_date": 1422277504, "answer_id": 28150640, "question_id": 28150432, "link": "https://stackoverflow.com/questions/28150432/haskell-applicative-functor-compilation-failure/28150640#28150640", "title": "Haskell applicative functor - compilation failure", "body": "<p>The <code>Applicative</code> could be better explained using <code>bulldMyList</code>.\nAssume you want to build an array of square matrix:\n<code>[(0,0), (0,1), (0,2), (1, 0) ...]</code>. Using list comprehensions:</p>\n\n<pre><code>buildMyMatrix :: Int -&gt; Int -&gt; [(Int, Int)]\nbuildMyMatrix maxX maxY = [(x, y) | x &lt;- [0..maxX], y &lt;- [0..maxY]]\n</code></pre>\n\n<p>Using applicative combinators it can be rewritten as:</p>\n\n<pre><code>buildMyMatrix maxX maxY = pure (\\x y -&gt; (x, y)) &lt;*&gt; [0..maxX] &lt;*&gt; [0..maxY]\n</code></pre>\n\n<p>And according to applicative laws we can rewrite <code>pure f &lt;*&gt; x = f &lt;$&gt; x</code>, for all <code>f</code> and <code>x</code>:</p>\n\n<pre><code>buildMyMatrix maxX maxY = (\\x y -&gt; (x, y)) &lt;$&gt; [0..maxX] &lt;*&gt; [0..maxY]\n</code></pre>\n\n<hr>\n\n<p>I had to use slightly more complicated <code>buildMyMatrix</code>, as your <code>buildMyList</code> is too trivial to benefit from Applicative:</p>\n\n<pre><code>buildMyList :: Float -&gt; Float -&gt; [Float]\nbuildMyList ul tick = [p | p &lt;- [0,tick..ul]]\nbuildMyList ul tick = id &lt;$&gt; [0,tick..ul] -- [by functor identity law]:\nbuildMyList ul tick = [0,tick..ul]\n</code></pre>\n"}], "owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1422289383, "creation_date": 1422276527, "last_edit_date": 1422289383, "question_id": 28150432, "link": "https://stackoverflow.com/questions/28150432/haskell-applicative-functor-compilation-failure", "title": "Haskell applicative functor - compilation failure", "body": "<p>I'm trying to chain together functions via the applicative functor pattern, but I'm having a problem compiling my code:</p>\n\n<pre><code>import Control.Applicative\n\nbuildMyList :: Float -&gt; Float -&gt; [Float]\nbuildMyList ul tick = [p | p &lt;- [0,tick..ul]]\n\nmyFunctionChain :: [Float]\nmyFunctionChain = reverse &lt;$&gt; buildMyList 100 1\n</code></pre>\n\n<p>When I attempt to compile this I get the following compilation error:</p>\n\n<pre><code>Couldn't match type 'Float' with '[a0]'\nExpected type: [[a0]]\n  Actual type: [Float]\nIn the return type of call of 'buildMyList'\n</code></pre>\n\n<p>It seems to me that I haven't managed to match the expected return context with the actual context. Not having enough experience in this area, I cant get any further!</p>\n"}, {"tags": ["performance", "haskell", "io", "buffering"], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 2630827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fb024f7b59a96ae41723576edbc0759?s=128&d=identicon&r=PG", "display_name": "Carsten S", "link": "https://stackoverflow.com/users/2630827/carsten-s"}, "edited": false, "score": 0, "creation_date": 1422261544, "post_id": 28146677, "comment_id": 44665243, "body": "So why didn&#39;t the OP see that kind of difference in his program?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 145, "user_id": 2630827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fb024f7b59a96ae41723576edbc0759?s=128&d=identicon&r=PG", "display_name": "Carsten S", "link": "https://stackoverflow.com/users/2630827/carsten-s"}, "edited": false, "score": 3, "creation_date": 1422262301, "post_id": 28146677, "comment_id": 44665572, "body": "The OP&#39;s program sets the buffering on a read handle, not the write handle."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423183136, "post_id": 28146677, "comment_id": 45056750, "body": "Even if the kernel has something buffered, don&#39;t you still need a system call to read it?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1423193573, "post_id": 28146677, "comment_id": 45059465, "body": "Sure, but the point is that adding another level of buffering (which is what hSetBuffering controls) for reads isn&#39;t necessarily going to speed things up."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 11, "last_activity_date": 1422262072, "last_edit_date": 1422262072, "creation_date": 1422260668, "answer_id": 28146677, "question_id": 28146009, "link": "https://stackoverflow.com/questions/28146009/how-to-speed-haskell-io-with-buffering/28146677#28146677", "title": "How to speed Haskell IO with buffering?", "body": "<p>On a modern OS it is likely that the buffer size has little effect on reading a file linearly due to 1) read-ahead performed by the kernel and 2) the file might already be in the page cache if you have already read the file recently.</p>\n\n<p>Here is a program which measures the effect of buffering on writes. Typical results are:</p>\n\n<pre><code>$ ./mkbigfile 32      -- 12.864733s\n$ ./mkbigfile 64      --  9.668272s\n$ ./mkbigfile 128     --  6.993664s\n$ ./mkbigfile 512     --  4.130989s\n$ ./mkbigfile 1024    --  3.536652s\n$ ./mkbigfile 16384   --  3.055403s\n$ ./mkbigfile 1000000 --  3.004879s\n</code></pre>\n\n<p>Source:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString as BS\nimport Data.ByteString (ByteString)\nimport Control.Monad\nimport System.IO\nimport System.Environment\nimport Data.Time.Clock\n\nmain = do\n  (arg:_) &lt;- getArgs\n  let size = read arg\n  let bs = \"abcdefghijklmnopqrstuvwxyz\"\n      n = 96000000 `div` (length bs)\n  h &lt;- openFile \"bigFile.txt\" WriteMode\n  hSetBuffering h (BlockBuffering (Just size))\n  startTime &lt;- getCurrentTime\n  replicateM_ n $ hPutStrLn h bs\n  hClose h\n  finishTime &lt;- getCurrentTime\n  print $ diffUTCTime finishTime startTime\n  return ()\n</code></pre>\n"}], "owner": {"reputation": 797, "user_id": 2799055, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94df8a6bb7ee4d9b77adb8ab4f381422?s=128&d=identicon&r=PG&f=1", "display_name": "azaviruha", "link": "https://stackoverflow.com/users/2799055/azaviruha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 1, "accepted_answer_id": 28146677, "answer_count": 1, "score": 4, "last_activity_date": 1422262072, "creation_date": 1422256511, "question_id": 28146009, "link": "https://stackoverflow.com/questions/28146009/how-to-speed-haskell-io-with-buffering", "title": "How to speed Haskell IO with buffering?", "body": "<p>I read about IO buffering in the \"Real World Haskell\" (ch. 7, p. 189), and tried to test, how different buffering size affects the performance.</p>\n\n<pre><code>import System.IO\nimport Data.Time.Clock\nimport Data.Char(toUpper)\n\nmain :: IO ()\nmain = do\n  hInp &lt;- openFile \"bigFile.txt\" ReadMode\n  let bufferSize = truncate $ 2**10\n  hSetBuffering hInp (BlockBuffering (Just bufferSize))\n  bufferMode &lt;- hGetBuffering hInp\n  putStrLn $ \"Current buffering mode: \" ++ (show bufferMode)\n\n  startTime &lt;- getCurrentTime\n  inp &lt;- hGetContents hInp\n  writeFile \"processed.txt\" (map toUpper inp)\n  hClose hInp\n  finishTime &lt;- getCurrentTime\n  print $ diffUTCTime finishTime startTime\n  return ()\n</code></pre>\n\n<p>Then I created a \"bigFile.txt\"</p>\n\n<pre><code>-rw-rw-r-- 1 user user 96M \u044f\u043d\u0432.  26 09:49 bigFile.txt\n</code></pre>\n\n<p>and run my program against this file, with different buffer size:</p>\n\n<pre><code>Current buffering mode: BlockBuffering (Just 32)\n9.744967s   \n\nCurrent buffering mode: BlockBuffering (Just 1024)\n9.667924s                                      \n\nCurrent buffering mode: BlockBuffering (Just 1048576)\n9.494807s    \n\nCurrent buffering mode: BlockBuffering (Just 1073741824)\n9.792453s   \n</code></pre>\n\n<p>But the program running time is almost the same. Is it normal, or I'm doing something wrong?</p>\n"}, {"tags": ["haskell", "warnings", "show", "ghci", "integral"], "comments": [{"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "edited": false, "score": 0, "creation_date": 1422256744, "post_id": 28145932, "comment_id": 44663717, "body": "Oh lol, I&#39;m silly I thought you just wanted a way to disable the warning. My bad."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1422259305, "post_id": 28145932, "comment_id": 44664472, "body": "BTW can be simplified with <code>map g . map f = map (g . f)</code>; <code>strout</code> is a third <code>map</code>. With <code>main = interact (unlines . map (show . factorial . read) . words</code> 3 helper functions can be removed."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422289491, "post_id": 28145932, "comment_id": 44679918, "body": "<code>-fno-warn-type-defaults</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 7, "last_activity_date": 1422256752, "creation_date": 1422256752, "answer_id": 28146047, "question_id": 28145932, "link": "https://stackoverflow.com/questions/28145932/how-do-i-print-out-integeral-values-in-haskell-without-warning-using-show/28146047#28146047", "title": "How do I print out Integeral values in haskell without warning using show?", "body": "<p>The compiler doesn't know which concrete implementation of <code>Integral</code> it should use. It <em>guesses</em> <code>Integer</code> would be ok.</p>\n\n<p>If you annotate e.g. <code>calc</code>, the warning will go away:</p>\n\n<pre><code>main :: IO ()\nmain = interact (unlines . strout . (calc :: [Integer] -&gt; [Integer]) . extinps . words)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 4493821, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nB5vIcuJrqM/AAAAAAAAAAI/AAAAAAAAALk/eqc_goQP1HM/photo.jpg?sz=128", "display_name": "Xios1306", "link": "https://stackoverflow.com/users/4493821/xios1306"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 28146047, "answer_count": 1, "score": 1, "last_activity_date": 1422256763, "creation_date": 1422256098, "last_edit_date": 1422256535, "question_id": 28145932, "link": "https://stackoverflow.com/questions/28145932/how-do-i-print-out-integeral-values-in-haskell-without-warning-using-show", "title": "How do I print out Integeral values in haskell without warning using show?", "body": "<p>When I run the following haskell code with warnings enabled </p>\n\n<pre><code>module Main where\nmain :: IO()\nmain = interact (unlines.strout.calc.extinps.words)\n\n--calculates factorial\nfactorial :: Integral a=&gt; a-&gt;a\nfactorial n = product [1..n]\n\n--Extracts numbers from the input\nextinps ::(Read b)=&gt;[String]-&gt;[b]\nextinps x=map read x\n\n--Calculates the factorial\ncalc :: (Integral b) =&gt; [b] -&gt; [b]\ncalc x= map factorial x\n\n--Converts the result to a string\nstrout::(Show b)=&gt;[b]-&gt;[[Char]]\nstrout x=[show a|a&lt;-x]\n</code></pre>\n\n<p>I get the warning following warning:</p>\n\n<pre><code>factout.hs:3:26: Warning:\nDefaulting the following constraint(s) to type `Integer'\n   (Show b0) arising from a use of `strout' at factout.hs:3:26-31\n   (Read b0) arising from a use of `extinps' at factout.hs:3:38-44\n   (Integral b0) arising from a use of `calc' at factout.hs:3:33-36    \nIn the first argument of `(.)', namely `strout'                       \nIn the second argument of `(.)', namely                                 \n   `strout . calc . extinps . words'                                   \nIn the first argument of `interact', namely                               \n   `( unlines . strout . calc . extinps . words)'\nOk, modules loaded: Main.                                            \n</code></pre>\n\n<p>How do I get rid of the it? </p>\n"}, {"tags": ["haskell", "gadt", "lenses"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422252775, "post_id": 28145369, "comment_id": 44662732, "body": "I have to ask: is it possible to write them by hand?"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 7, "last_activity_date": 1422270805, "last_edit_date": 1422270805, "creation_date": 1422255236, "answer_id": 28145814, "question_id": 28145369, "link": "https://stackoverflow.com/questions/28145369/makelenses-for-gadts-haskell/28145814#28145814", "title": "makeLenses for GADTs (Haskell)", "body": "<p>I don't think it can be done automatically, but writing some lenses by hand isn't that hard in this particular case:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Control.Lens\n\ndata D a b where\n  D :: (Ord a, Ord b) =&gt; !a -&gt; !b -&gt; D a b\n\nfield1 :: Lens' (D a b) a\nfield1 f (D x y) = fmap (\\x' -&gt; D x' y) (f x)\n\nfield2 :: Lens' (D a b) b\nfield2 f (D x y) = fmap (\\y' -&gt; D x y') (f y)\n\n{- If you want type-changing lenses, you can also use these signatures.\n - Note that then the target type Ord constraint has to escape.\n\nfield1 :: (Ord a2) =&gt; Lens (D a1 b) (D a2 b) a1 a2\nfield2 :: (Ord b2) =&gt; Lens (D a b1) (D a b2) b1 b2\n -}\n</code></pre>\n\n<p>There seems to be a somewhat relevant <a href=\"https://github.com/ekmett/lens/issues/409\" rel=\"noreferrer\">GitHub issue</a>, in which Kmett claims they cannot create lenses for existentially quantified fields.</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "answer_count": 1, "score": 8, "last_activity_date": 1422270805, "creation_date": 1422251955, "question_id": 28145369, "link": "https://stackoverflow.com/questions/28145369/makelenses-for-gadts-haskell", "title": "makeLenses for GADTs (Haskell)", "body": "<p>Is there an equivalent of <code>makeLenses</code> for GADTs? If I have a simple <code>GADT</code> like:</p>\n\n<pre><code>data D a b where\n  D :: (Ord a, Ord b) =&gt; !a -&gt; !b -&gt; D a b\n</code></pre>\n\n<p>Is there a way to generate lenses automatically by passing in a constructor and a list of field names?</p>\n"}, {"tags": ["xcode", "haskell", "syntax-highlighting"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1445074768, "post_id": 28144755, "comment_id": 54176260, "body": "just don&#39;t use XCode for Haskell. there are much better alternatives such as Emacs or Leksah or Vim or FPComplete etc."}, {"owner": {"reputation": 51, "user_id": 4493599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aed1fb7c110ac228e3cfe3887b5e2ebc?s=128&d=identicon&r=PG&f=1", "display_name": "gse6", "link": "https://stackoverflow.com/users/4493599/gse6"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1446198193, "post_id": 28144755, "comment_id": 54653858, "body": "I agree, I started with textmate and then moved over to using gvim. Thanks for the tip."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 4493599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aed1fb7c110ac228e3cfe3887b5e2ebc?s=128&d=identicon&r=PG&f=1", "display_name": "gse6", "link": "https://stackoverflow.com/users/4493599/gse6"}, "is_accepted": false, "score": 1, "last_activity_date": 1424302396, "creation_date": 1424302396, "answer_id": 28596033, "question_id": 28144755, "link": "https://stackoverflow.com/questions/28144755/xcode-haskell-syntax-highlighting/28596033#28596033", "title": "Xcode Haskell Syntax Highlighting", "body": "<p>I did not find an xcode solution, but I found an app called TextMate that handles syntax highlighting for Haskell. I find it to be a powerful IDE so far.</p>\n"}], "owner": {"reputation": 51, "user_id": 4493599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aed1fb7c110ac228e3cfe3887b5e2ebc?s=128&d=identicon&r=PG&f=1", "display_name": "gse6", "link": "https://stackoverflow.com/users/4493599/gse6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1445004882, "creation_date": 1422245991, "last_edit_date": 1422246140, "question_id": 28144755, "link": "https://stackoverflow.com/questions/28144755/xcode-haskell-syntax-highlighting", "title": "Xcode Haskell Syntax Highlighting", "body": "<p>When programming in Haskell, what options are available for syntax highlighting in Xcode? Haskell's website linked to an Xcode plugin, but that link is broken.</p>\n"}, {"tags": ["haskell", "persistent", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422251611, "post_id": 28143788, "comment_id": 44662464, "body": "Can you show the code?"}, {"owner": {"reputation": 19, "user_id": 649025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b447fbb575f4822572b24563e438939b?s=128&d=identicon&r=PG", "display_name": "Fl&#225;vio Botelho", "link": "https://stackoverflow.com/users/649025/fl%c3%a1vio-botelho"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422311459, "post_id": 28143788, "comment_id": 44691283, "body": "@Rufflewind <a href=\"https://github.com/nuncanada/omni/tree/master/src\" rel=\"nofollow noreferrer\">github repo</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 649025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b447fbb575f4822572b24563e438939b?s=128&d=identicon&r=PG", "display_name": "Fl&#225;vio Botelho", "link": "https://stackoverflow.com/users/649025/fl%c3%a1vio-botelho"}, "is_accepted": true, "score": 0, "last_activity_date": 1423790388, "creation_date": 1423790388, "answer_id": 28491020, "question_id": 28143788, "link": "https://stackoverflow.com/questions/28143788/snaplet-persistent-problems-with-initpersistent/28491020#28491020", "title": "Snaplet-persistent problems with initPersistent", "body": "<p>That was solved <a href=\"https://github.com/Soostone/snaplet-persistent/commit/8da830bd6a097119a8b7c0744e1b70f91ef9ad67\" rel=\"nofollow\">in github by eryx67</a></p>\n"}], "owner": {"reputation": 19, "user_id": 649025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b447fbb575f4822572b24563e438939b?s=128&d=identicon&r=PG", "display_name": "Fl&#225;vio Botelho", "link": "https://stackoverflow.com/users/649025/fl%c3%a1vio-botelho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 28491020, "answer_count": 1, "score": 0, "last_activity_date": 1423790388, "creation_date": 1422237224, "last_edit_date": 1422239938, "question_id": 28143788, "link": "https://stackoverflow.com/questions/28143788/snaplet-persistent-problems-with-initpersistent", "title": "Snaplet-persistent problems with initPersistent", "body": "<p>I am a beginner in Haskell, trying to use snaplet-persistent. Tried to follow the documentation but it is not working, the problem that is appearing :</p>\n\n<pre><code>src/Site.hs:120:32:\n    No instance for (MonadBaseControl\n                       IO (Initializer App PersistState))\n      arising from a use of \u2018initPersist\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018initPersist (runMigrationUnsafe migrateAuth)\u2019\n    In a stmt of a 'do' block:\n      d &lt;- nestSnaplet \"db\" db\n           $ initPersist (runMigrationUnsafe migrateAuth)\n    In the second argument of \u2018($)\u2019, namely\n      \u2018do { h &lt;- nestSnaplet \"\" heist $ heistInit \"templates\";\n            s &lt;- nestSnaplet \"sess\" sess\n                 $ initCookieSessionManager \"site_key.txt\" \"sess\" (Just 3600);\n            d &lt;- nestSnaplet \"db\" db\n                 $ initPersist (runMigrationUnsafe migrateAuth);\n            a &lt;- nestSnaplet \"auth\" auth\n                 $ initPersistAuthManager sess (persistPool $ view snapletValue d);\n            .... }\u2019\n</code></pre>\n\n<p>Running snaplet-persistent from github.</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "edited": false, "score": 0, "creation_date": 1422241803, "post_id": 28144010, "comment_id": 44660313, "body": "Sadly, with <code>exhaustive $ 42 == (6 * 7)</code>, the test still runs 100 times. I was trying to get a <code>Property Bool</code> instance for exhaustive and obviously didn&#39;t quite make it."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1422239387, "creation_date": 1422239387, "answer_id": 28144010, "question_id": 28143776, "link": "https://stackoverflow.com/questions/28143776/exhaustive-properties-in-haskell-quickcheck/28144010#28144010", "title": "Exhaustive properties in Haskell QuickCheck?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/QuickCheck-2.7.6/docs/src/Test-QuickCheck-Property.html#exhaustive\" rel=\"nofollow\">source</a> is really straight-forward.  The default definition for <code>exhaustive</code> is used for the <code>Property</code> instance and the default is <code>exhaustive _ = False</code>.  I think you probably want <code>exhaustive $ 42 == (6 * 7)</code></p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1422241188, "last_edit_date": 1422241188, "creation_date": 1422240428, "answer_id": 28144140, "question_id": 28143776, "link": "https://stackoverflow.com/questions/28143776/exhaustive-properties-in-haskell-quickcheck/28144140#28144140", "title": "Exhaustive properties in Haskell QuickCheck?", "body": "<p>It seems that you can use <code>once</code> to modify a property to run only once.</p>\n\n<p>Some example code:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Test.QuickCheck\nimport Test.QuickCheck.All\n\nprop_trivial :: Int -&gt; Bool\nprop_trivial x = x == x\nprop_trivial2 = once prop_trivial\nprop_true = True\nprop_true2 = once True\n\n-- Wacky boilerplate to make all tests run.\nreturn []\nrunTests = $quickCheckAll\nmain = do\n  putStrLn $ \"exhaustive prop_trivial  = \" ++ show (exhaustive prop_trivial)\n  putStrLn $ \"exhaustive prop_trivial2 = \" ++ show (exhaustive prop_trivial2)\n  putStrLn $ \"exhaustive prop_true     = \" ++ show (exhaustive prop_true)\n  putStrLn $ \"exhaustive prop_true2    = \" ++ show (exhaustive prop_true2)\n  runTests\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>exhaustive prop_trivial  = False\nexhaustive prop_trivial2 = False\nexhaustive prop_true     = True\nexhaustive prop_true2    = False\n=== prop_trivial from qc2.hs:5 ===\n+++ OK, passed 100 tests.\n\n=== prop_trivial2 from qc2.hs:7 ===\n+++ OK, passed 1 tests.\n\n=== prop_true from qc2.hs:8 ===\n+++ OK, passed 100 tests.\n\n=== prop_true2 from qc2.hs:9 ===\n+++ OK, passed 1 tests.\n</code></pre>\n\n<p><code>exhaustive</code> <em>prop</em> only returns True if testing of <em>prop</em> is known to be exhaustive - note the difference between <code>exhaustive True</code> and <code>exhaustive $ once True</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1422244058, "creation_date": 1422244058, "answer_id": 28144554, "question_id": 28143776, "link": "https://stackoverflow.com/questions/28143776/exhaustive-properties-in-haskell-quickcheck/28144554#28144554", "title": "Exhaustive properties in Haskell QuickCheck?", "body": "<p>You might like <a href=\"http://hackage.haskell.org/package/smallcheck\" rel=\"nofollow\">smallcheck</a>. It is not as developed as QuickCheck, but quite nice for exhaustive testing. Where QuickCheck generates random inputs, smallcheck generates its inputs systematically, running your properties on all inputs up to a given (by you) size. For types with finitely many inhabitants, this makes it pretty trivial to set up exhaustive tests, and because we're not trying to generate random stuff, it also makes it easy to avoid repeating tests. Here's a simple ghci example:</p>\n\n<pre><code>Test.SmallCheck&gt; smallCheck 10 (6*7 == 42)\nCompleted 1 tests without failure.\n</code></pre>\n\n<p>The <code>10</code> is a maximum depth used to choose when to stop generating inputs; since there are no inputs, it's ignored in this example. For an example where the size is used, consider:</p>\n\n<pre><code>Test.SmallCheck&gt; smallCheck 10 (\\x -&gt; x &lt;= (10 :: Integer))\nCompleted 21 tests without failure.\nTest.SmallCheck&gt; smallCheck 20 (\\x -&gt; x &lt;= (10 :: Integer))\nFailed test no. 22.\nthere exists 11 such that\n  condition is false\n</code></pre>\n"}], "owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 1, "accepted_answer_id": 28144140, "answer_count": 3, "score": 1, "last_activity_date": 1422244058, "creation_date": 1422237100, "question_id": 28143776, "link": "https://stackoverflow.com/questions/28143776/exhaustive-properties-in-haskell-quickcheck", "title": "Exhaustive properties in Haskell QuickCheck?", "body": "<p>Consider the following QuickCheck program in Haskell</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Test.QuickCheck\nimport Test.QuickCheck.All\n\nprop_trivial :: Bool\nprop_trivial = 42 == (6 * 7)\n\n-- Wacky boilerplate to make all tests run.\nreturn []\nrunTests = $quickCheckAll\nmain = do\n  runTests\n</code></pre>\n\n<p>This works with ghc version 7.8.3 and QuickCheck 2.7.6. Problem is that it repeats the test 100 times. I look around for a mitigation and find <code>exhaustive</code> in <a href=\"http://hackage.haskell.org/package/QuickCheck-2.7.6/docs/Test-QuickCheck.html#t:Property\" rel=\"nofollow\">the QuickCheck docs here</a>. Groovy!  I change my <code>prop_trivial</code> to the following:</p>\n\n<pre><code>prop_trivial = exhaustive $ property $ 42 == (6 * 7)\n</code></pre>\n\n<p>which type-checks and compiles, but fails:</p>\n\n<pre><code>=== prop_trivial from /blahblahblah/FooTest.hs:6 ===\n*** Failed! Falsifiable (after 1 test): \nFalse\n</code></pre>\n\n<p>I'm a bit stuck on how to understand and debug this result; the docs are a bit too thin for me to figure out what's going on.</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1422233733, "post_id": 28143342, "comment_id": 44658468, "body": "(super newbie here) what if you help haskell and tell what type the expressoin is? <code>fromJSON $ toJSON t :: TemperatureType</code>"}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1422234128, "post_id": 28143342, "comment_id": 44658535, "body": "There&#39;s no witness to what type you are expecting from &quot;fromJSON&quot;, you have to assign the type as @zerkms recommended. Consider the case of: &quot;Read a =&gt; String -&gt; Maybe a&quot; and it becomes more obvious why this would be the case."}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "edited": false, "score": 0, "creation_date": 1422234141, "post_id": 28143342, "comment_id": 44658537, "body": "No, that&#39;s a great idea. Turns out, <code>(fromJSON $ toJSON t) :: Result TemperatureType</code> works, as does <code>(decode $ encode t) :: Maybe TemperatureType</code>. Still seems to fail as an embedded value in another type, though. There must be more &quot;manual&quot; types I can specify. Strange that this compiles without ambiguity."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1422234266, "post_id": 28143342, "comment_id": 44658563, "body": "Ah, right <code>:: Result TemperatureType</code> &quot;Still seems to fail as an embedded value in another type, though&quot; --- keen to share?"}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "edited": false, "score": 0, "creation_date": 1422234714, "post_id": 28143342, "comment_id": 44658680, "body": "Ah, got it working in my wrapper type. The extra issue there seemed to be how I was encoding the other value. The same error message was appearing, making this ambiguous. Want to post your response as a solution, so I can select it as the answer?"}], "answers": [{"comments": [{"owner": {"reputation": 4450, "user_id": 590525, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c740358b2cce341557a23ffb981aacf2?s=128&d=identicon&r=PG", "display_name": "gnclmorais", "link": "https://stackoverflow.com/users/590525/gnclmorais"}, "edited": false, "score": 0, "creation_date": 1429675609, "post_id": 28143527, "comment_id": 47704566, "body": "I had a similar problem, and you had no idea the frustrations you spared me. Thank you!"}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 9, "last_activity_date": 1422234814, "creation_date": 1422234814, "answer_id": 28143527, "question_id": 28143342, "link": "https://stackoverflow.com/questions/28143342/haskell-adts-with-aeson/28143527#28143527", "title": "Haskell ADTs with aeson", "body": "<p>Haskell need help from you about the type of your expression result since in the current call it's not possible to infer it:</p>\n\n<pre><code>&gt; fromJSON $ toJSON t :: Result TemperatureType\n</code></pre>\n"}], "owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 28143527, "answer_count": 1, "score": 4, "last_activity_date": 1422234814, "creation_date": 1422233122, "last_edit_date": 1495535236, "question_id": 28143342, "link": "https://stackoverflow.com/questions/28143342/haskell-adts-with-aeson", "title": "Haskell ADTs with aeson", "body": "<p>I've been fighting with a simple ADT, trying to get it to round-trip back and forth to JSON, but I've had no luck, no matter how I try to massage or modify the type. What am I missing?</p>\n\n<p>When it compiles, I always get the same runtime error:</p>\n\n<pre><code>&gt; let t = Fahrenheit\n&gt; fromJSON $ toJSON t\nError \"when expecting a (), encountered Object instead\"\n</code></pre>\n\n<p>Trying this just gives me \"Nothing\", presumably because of the same error: decode $ encode t</p>\n\n<p>I've tried to follow these sources, but I can't seem to get around this runtime error, no matter what I try:\n<a href=\"https://stackoverflow.com/questions/25500871/haskell-aeson-parse-adt-based-on-field-value\">Haskell :: Aeson :: parse ADT based on field value</a>\n<a href=\"https://www.fpcomplete.com/user/Geraldus/algebraic-data-types-adts-with-aeson\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/user/Geraldus/algebraic-data-types-adts-with-aeson</a></p>\n\n<p>Here's one form of the code I'm using. At first, I tried to use this as a type embedded in another type, but when that didn't work I added the \"value\" key to try to make parsing of this easier (no luck).</p>\n\n<pre><code>data TemperatureType = Celsius\n                     | Fahrenheit\n                     deriving (Show,Read,Typeable,Data,Eq)\n\n-- This doesn't work either\n-- $(deriveJSON defaultOptions ''TemperatureType)\n\ninstance ToJSON TemperatureType where\n   toJSON Fahrenheit = object [ \"value\" .= String \"Fahrenheit\" ]\n   toJSON Celsius    = object [ \"value\" .= String \"Celsius\" ]\n\ninstance FromJSON TemperatureType where\n    parseJSON (Object x) = toTemperatureType &lt;$&gt; x .: \"value\"\n\ntoTemperatureType :: Text -&gt; TemperatureType\ntoTemperatureType \"Fahrenheit\" = Fahrenheit\ntoTemperatureType \"Celsius\"    = Celsius\n</code></pre>\n"}, {"tags": ["haskell", "constraints", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422232452, "post_id": 28143153, "comment_id": 44658184, "body": "I like the first solution but I think the 2nd would just be incredibly confusing to someone else reading the type signature."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422232663, "post_id": 28143153, "comment_id": 44658234, "body": "@user2407038 That&#39;s definitely a possibility. I probably could have picked some better names though. It would be easier to read with better names and a couple good comments/a decent haddock explanation (documentation would be important for this sort of trick, I feel)."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 6, "last_activity_date": 1422236955, "last_edit_date": 1422236955, "creation_date": 1422231318, "answer_id": 28143153, "question_id": 28142914, "link": "https://stackoverflow.com/questions/28142914/managing-explosion-of-constraints-haskell/28143153#28143153", "title": "Managing explosion of constraints (Haskell)", "body": "<p>A type family could be handy:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, KindSignatures, DataKinds, TypeOperators, ConstraintKinds #-}\n\nimport qualified Data.Vector.Generic as G\nimport GHC.Prim\n\ntype family Vectors v (a :: [*]) :: Constraint where\n  Vectors v '[]       = ()\n  Vectors v (a ': as) = (G.Vector v a, Vectors v as)\n</code></pre>\n\n<p>This creates a type level function that takes a list of types and makes the appropriate constraints for the generic <code>Vector</code>s with those types. You can use it like this:</p>\n\n<pre><code>foo :: (Vectors v [a, b, c, d, (a, b), (a, c), (c, b)]) =&gt; v a -&gt; v b -&gt; v c -&gt; v d\n</code></pre>\n\n<p>This isn't quite ideal, but it does reduce the code to a degree.</p>\n\n<h2>Dealing with the sharp increase in tuple constraints</h2>\n\n<p>You can better deal with this explosion of constraints due to pair types with some more type level tricks:</p>\n\n<pre><code>type family Combinations v (a :: [*]) :: Constraint where\n  Combinations v '[]       = ()\n  Combinations v (a ': as) = (G.Vector v a, CombComponent v a as, Combinations v as)\n\ntype family CombComponent v (a :: *) (bs :: [*]) :: Constraint where\n  CombComponent v a '[]       = ()\n  CombComponent v a (b ': bs) = (G.Vector v (a, b), G.Vector v (b, a), CombComponent v a bs)\n</code></pre>\n\n<p>It's a bit more complex, but now we can write that second <code>foo</code> signature like this:</p>\n\n<pre><code>foo :: (Combinations v [a, b, c, d]) =&gt; v a -&gt; v b -&gt; v c -&gt; v d\n</code></pre>\n\n<p>This could also be generalized further to allow for signatures like:</p>\n\n<pre><code>foo :: (Combinations (G.Vector v) [a, b, c, d]) =&gt; v a -&gt; v b -&gt; v c -&gt; v d\n</code></pre>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 28143153, "answer_count": 1, "score": 2, "last_activity_date": 1422236955, "creation_date": 1422229225, "question_id": 28142914, "link": "https://stackoverflow.com/questions/28142914/managing-explosion-of-constraints-haskell", "title": "Managing explosion of constraints (Haskell)", "body": "<p>I am writing a function which I would like to be generic over Vectors. In other words, I have something like:</p>\n\n<pre><code>import qualified Data.Vector.Generic as G\nfoo :: (G.Vector v a, G.Vector v b, G.Vector v c, G.Vector v d) \n    =&gt; v a -&gt; v b -&gt; v c -&gt; v d \n</code></pre>\n\n<p>This way the user gets to choose to use <code>Unboxed</code> vs <code>Storable</code> Vectors, etc.</p>\n\n<p>But if I need to put intermediate values inside <code>v</code>, I get a combinatorical explosion of Vector constraints like:</p>\n\n<pre><code>foo :: (G.Vector v a, G.Vector v b, G.Vector v c, G.Vector v d,\n        G.Vector v (a, b), G.Vector v (a, c), G.Vector v (c, b))\n    =&gt; v a -&gt; v b -&gt; v c -&gt; v d \n</code></pre>\n\n<p>How do I manage this verbosity? Is there a way to either have </p>\n\n<p>1) GHC generate the constraints implicitly</p>\n\n<p>2) Refactor the constraints into a common class somehow</p>\n"}, {"tags": ["haskell", "sandbox", "cabal", "package-managers"], "answers": [{"comments": [{"owner": {"reputation": 3119, "user_id": 255258, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e71567f551826c783efd8f91a577b43c?s=128&d=identicon&r=PG", "display_name": "Herberth Amaral", "link": "https://stackoverflow.com/users/255258/herberth-amaral"}, "edited": false, "score": 0, "creation_date": 1422222207, "post_id": 28141839, "comment_id": 44655326, "body": "Better than I thought. Thank you!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1422222454, "post_id": 28141839, "comment_id": 44655411, "body": "If you are not in the root directory of the cabal sandbox, you can still work in that sandbox by pointing cabal to the correct config file: <code>cabal --config=&lt;path&gt;\\cabal.sandbox.config &lt;command&gt;</code>."}], "tags": [], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "is_accepted": true, "score": 8, "last_activity_date": 1422222427, "last_edit_date": 1422222427, "creation_date": 1422221897, "answer_id": 28141839, "question_id": 28141705, "link": "https://stackoverflow.com/questions/28141705/why-cabal-sandbox-init-does-not-change-path-like-virtualenv-does/28141839#28141839", "title": "Why cabal sandbox init does not change PATH like virtualenv does?", "body": "<ol>\n<li><p>Yes, this how to use a sandbox.</p>\n\n<p><code>cabal sandbox init</code> will create some files / directories for you that will keep track of the packages you have installed.</p>\n\n<p><code>cabal install some_package</code> will install that package into the sandbox.</p></li>\n<li><p>You are more than welcome to install <code>yesod-bin</code> into a sandbox.</p></li>\n<li><p>Read point 2</p></li>\n<li><p><code>cabal sandbox init</code> doesn't change your path, because it doesn't really need to. Just add <code>PATH=.cabal-sandbox/bin:$PATH</code> in your <code>.bash_profile</code>. </p>\n\n<p>Unlike virtual-env, you never need to 'enable' or 'disable' a sandbox. You just <code>cd</code> into a directory, and it is automatically enabled.</p>\n\n<p>The only real downside I have found to cabal sandboxes, is that you need to be in the root directory in order to act upon a sandbox. Meaning, if you are in a sub-directory, running <code>cabal install some_package</code> will not install it into the sandbox that is up a level, instead it will install it into either the global or user database, depending on how you have <code>cabal</code> configured.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 6, "last_activity_date": 1422223187, "last_edit_date": 1422223187, "creation_date": 1422222484, "answer_id": 28141946, "question_id": 28141705, "link": "https://stackoverflow.com/questions/28141705/why-cabal-sandbox-init-does-not-change-path-like-virtualenv-does/28141946#28141946", "title": "Why cabal sandbox init does not change PATH like virtualenv does?", "body": "<p><code>cabal exec</code> lets you execute a program in the context of a sandbox. It changes the path to include the <code>bin</code> folder of the sandbox. You can see it by executing <code>cabal exec printenv</code> inside the sandbox. </p>\n\n<p>Also, the latest versions of <code>cabal</code> let you create sandboxes in folders without <code>.cabal</code> files. Once you run <code>cabal sandbox init</code>, you can just <code>cabal install</code> the dependencies you need.</p>\n\n<p>So, to use different versions of <code>yesod-bin</code>, install them in different sandboxes, and then invoke <code>cabal exec yesod-bin</code> on each one.</p>\n\n<p>(Extra tip: <code>cabal exec gchi</code> is a useful command that makes <code>ghci</code> aware of the contents of the sandbox.)</p>\n"}], "owner": {"reputation": 3119, "user_id": 255258, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e71567f551826c783efd8f91a577b43c?s=128&d=identicon&r=PG", "display_name": "Herberth Amaral", "link": "https://stackoverflow.com/users/255258/herberth-amaral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 863, "favorite_count": 3, "accepted_answer_id": 28141839, "answer_count": 2, "score": 9, "last_activity_date": 1422223187, "creation_date": 1422221127, "question_id": 28141705, "link": "https://stackoverflow.com/questions/28141705/why-cabal-sandbox-init-does-not-change-path-like-virtualenv-does", "title": "Why cabal sandbox init does not change PATH like virtualenv does?", "body": "<p>Haskell newbie and Python guy here.</p>\n\n<p>I think I may be missing something here but if you look at <a href=\"http://www.yesodweb.com/page/quickstart\">Yesod's quickstart</a>, the autor install some packages <strong>before</strong> <code>cabal sandbox init</code>. I have seen the same pattern elsewhere. Questions:</p>\n\n<ol>\n<li>Am I missing something? Is this the real way to use cabal sandbox?</li>\n<li>Why can't (or shouldn't) I install yesod-bin inside a sandbox?</li>\n<li>What if I use different versions of yesod-bin throughout some projects?</li>\n<li>If there is some libraries that install binaries inside .cabal-sandbox/bin, why <code>cabal sandbox init</code> don't change PATH in order to match the sandboxed version?</li>\n</ol>\n\n<p>Thank you very much in advance!</p>\n"}, {"tags": ["haskell", "cabal", "ihaskell"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 1, "creation_date": 1422223776, "post_id": 28141655, "comment_id": 44655839, "body": "Could you just install IHaskell and the packages into the same sandbox?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1422252746, "post_id": 28141655, "comment_id": 44662723, "body": "Would <code>cabal exec</code> as <a href=\"http://stackoverflow.com/a/28141946/1088108\">suggested in this answer</a> work for IHaskell?"}], "answers": [{"tags": [], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "is_accepted": false, "score": 0, "last_activity_date": 1528297046, "creation_date": 1528297046, "answer_id": 50723513, "question_id": 28141655, "link": "https://stackoverflow.com/questions/28141655/is-there-a-way-to-run-ihaskell-using-a-particular-sandbox-directory/50723513#50723513", "title": "Is there a way to run IHaskell using a particular sandbox directory?", "body": "<p>If you're using stack to manage your iHaskell instance, you can edit the <code>stack.yaml</code> file to include dependencies by listing them under the packages section. For example, say you want to include foo and bar that are located in folder <code>foobar</code> your <code>stack.yaml</code> would have: </p>\n\n<pre><code>packages:\n  - foobar/foo\n  - foobar/bar\n</code></pre>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1528297046, "creation_date": 1422220814, "last_edit_date": 1422222655, "question_id": 28141655, "link": "https://stackoverflow.com/questions/28141655/is-there-a-way-to-run-ihaskell-using-a-particular-sandbox-directory", "title": "Is there a way to run IHaskell using a particular sandbox directory?", "body": "<p>Exactly that - can I run IHaskell and have it load packages from a particular sandbox directory?</p>\n"}, {"tags": ["file", "haskell", "io", "output"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1422220621, "post_id": 28141450, "comment_id": 44654793, "body": "It would be easier to help if you would show us a little code."}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 3597322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd1241fb28377d8ae2f3a7bb1a9269e?s=128&d=identicon&r=PG&f=1", "display_name": "user3597322", "link": "https://stackoverflow.com/users/3597322/user3597322"}, "edited": false, "score": 0, "creation_date": 1422221493, "post_id": 28141577, "comment_id": 44655088, "body": "That is for writing text to the console. I don&#39;t see how that could be used for files?"}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 1, "last_activity_date": 1422221983, "last_edit_date": 1422221983, "creation_date": 1422220320, "answer_id": 28141577, "question_id": 28141450, "link": "https://stackoverflow.com/questions/28141450/format-output-text-file/28141577#28141577", "title": "Format output text file", "body": "<p>You are probably missing <code>putStrLn</code> which add a new line.</p>\n\n<p>Your question is about writing in a file. <code>writeFile</code> writes a string, therefore\nyou have to add manually the <code>\\n</code> whereever you want a new line.\nOtherwise, you can use the file version of <code>putStrLn</code> : <code>hPutStrLn</code> which take a <em>handle</em> as parameter. The handle can be obtainer with <code>openFile</code>.</p>\n\n<p>Those functions are in <code>System.Io</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 3597322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd1241fb28377d8ae2f3a7bb1a9269e?s=128&d=identicon&r=PG&f=1", "display_name": "user3597322", "link": "https://stackoverflow.com/users/3597322/user3597322"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 28141577, "answer_count": 1, "score": 0, "last_activity_date": 1422221983, "creation_date": 1422219564, "last_edit_date": 1422221642, "question_id": 28141450, "link": "https://stackoverflow.com/questions/28141450/format-output-text-file", "title": "Format output text file", "body": "<p>During my current side project in Haskell I have reached my first annoyance with the file writing. \nWhen I output my text to a file, it is written with no line breaks in-between. I cannot seem to format the output text file in any way.</p>\n\n<p>Is there some obvious solution that I'm missing here?</p>\n\n<p>EDIT: Added the code in question</p>\n\n<pre><code>main :: IO ()\nmain = do \n  args    &lt;- getArgs\n  article &lt;- loadArticle $ head args \n  let summary = summarize article\n  writeFile (args !! 1) summary \n  mapM_ putStrLn summary \n</code></pre>\n"}, {"tags": ["parsing", "haskell", "alex"], "answers": [{"comments": [{"owner": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "edited": false, "score": 0, "creation_date": 1426785442, "post_id": 28142583, "comment_id": 46523669, "body": "I forgot to thank you for your reply.  Thank you for the time and effort you put into this response, it helped me very much."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1422238281, "last_edit_date": 1422238281, "creation_date": 1422226706, "answer_id": 28142583, "question_id": 28141182, "link": "https://stackoverflow.com/questions/28141182/what-do-i-need-to-add-to-use-monaduserstate-with-alex-when-parsing/28142583#28142583", "title": "What do I need to add to use monadUserState with alex when parsing?", "body": "<p>Update: Working example available here: <a href=\"http://lpaste.net/119212\" rel=\"nofollow\">http://lpaste.net/119212</a></p>\n\n<p>The file \"tiger.x\" <a href=\"https://github.com/simonmar/alex/blob/master/examples/tiger.x\" rel=\"nofollow\">(link)</a> in the alex github repo contains an example of how to track embedded comments using the monadUserState wrapper.</p>\n\n<p>Well, unfortunately that example doesn't compile but the ideas there should work.</p>\n\n<p>Basically, these lines perform embedded comment processing:</p>\n\n<pre><code>&lt;0&gt;             \"/*\"         { enterNewComment `andBegin` state_comment }\n&lt;state_comment&gt; \"/*\"         { embedComment }\n&lt;state_comment&gt; \"*/\"         { unembedComment }\n&lt;state_comment&gt; .            ;\n&lt;state_comment&gt; \\n           { skip }\n</code></pre>\n\n<p>As for <code>alexEOF</code>, the idea is to add an EOF token to your token data type:</p>\n\n<pre><code>data Tokens = ... | EOF\n</code></pre>\n\n<p>and define <code>alexEOF</code> as:</p>\n\n<pre><code>alexEOF = return EOF\n</code></pre>\n\n<p>See the file tests/tokens_monadUserState_bytestring.x in the alex repo for an example of this.</p>\n"}], "owner": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 28142583, "answer_count": 1, "score": 2, "last_activity_date": 1538683841, "creation_date": 1422218229, "question_id": 28141182, "link": "https://stackoverflow.com/questions/28141182/what-do-i-need-to-add-to-use-monaduserstate-with-alex-when-parsing", "title": "What do I need to add to use monadUserState with alex when parsing?", "body": "<p>I am trying to write a program that will understand a language where embedded comments are allowed.  Such as:</p>\n\n<pre><code>/* Here's a comment\n  /* This comment is further embedded */ second comment is closed\nMust close first comment */\n</code></pre>\n\n<p>This should be recognized as a comment (and as such not stop at the first */ it sees unless it has only seen 1 comment opening prior).</p>\n\n<p>This would be an easy issue to fix in C, I could simply have a counter that incremented when it saw comment opens and decrements when it sees a comment close.  If the counter is at 0, we're in \"code section\".</p>\n\n<p>However, without having state in Haskell, it's a little more challenging.</p>\n\n<p>I've read up on monadUserState which supposedly allows to keep track of a state for this exact type of parsing.  However, I can't find very much reading material on it aside from the <a href=\"https://www.haskell.org/alex/doc/html/wrappers.html#id462498\" rel=\"nofollow\">tutorial page on alex.</a></p>\n\n<p>When I try to compile it gives the error </p>\n\n<pre><code>templates\\wrappers.hs:213:16: Not in scope: `alexEOF`\n</code></pre>\n\n<p>It should be noted that I directly changed from the \"basic\" wrapper to the \"monadUserState\" without changing my code (I don't know what to add in order to use it).  It says that this must be initialized in the user code:</p>\n\n<pre><code>data AlexState = AlexState {\n        alex_pos :: !AlexPosn,  -- position at current input location\n        alex_inp :: String,     -- the current input\n        alex_chr :: !Char,      -- the character before the input\n        alex_bytes :: [Byte],   -- rest of the bytes for the current char\n        alex_scd :: !Int,       -- the current startcode\n        alex_ust :: AlexUserState -- AlexUserState will be defined in the     user program\n    }\n</code></pre>\n\n<p>I'm a bit of a lexxing noob and I'm not at all sure what I should be adding here to make it at least compile... then I can worry about the logic of the thing.</p>\n"}, {"tags": ["list", "haskell", "tree"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1422220852, "post_id": 28140959, "comment_id": 44654871, "body": "There are many questions on binary search trees recently. Is this part of a lecture? By the way, <code>previousVal :: Ord a =&gt; a -&gt; SearchTree a -&gt; Maybe a</code> would be a little bit more safe."}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1422221170, "post_id": 28140959, "comment_id": 44654988, "body": "I&#39;m afraid I don&#39;t quite understand your question. Could you explain why it should return <code>7</code> given <code>9</code> and <code>t1</code> and input? Also, I don&#39;t really see a point in making the <code>previousValHelp</code> function. <code>previousVal</code> just directly calls it, without doing anything else. Why not just define <code>previousVal</code> the way you have <code>previousValHelp</code>?"}, {"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 0, "creation_date": 1422247658, "post_id": 28140959, "comment_id": 44661620, "body": "What do you think <code>previousVal 5 t1</code> should be? What about <code>previousVal 8 t1</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422565817, "post_id": 28140959, "comment_id": 44812390, "body": "I suggest you read about <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow noreferrer\">zippers</a> and then generalize this to look for an element <code>n</code> before or after the given one."}], "answers": [{"tags": [], "owner": {"reputation": 3104, "user_id": 799621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c1e37a53512886ada1c874829dec2b?s=128&d=identicon&r=PG", "display_name": "mange", "link": "https://stackoverflow.com/users/799621/mange"}, "is_accepted": false, "score": 0, "last_activity_date": 1422537757, "creation_date": 1422537757, "answer_id": 28215839, "question_id": 28140959, "link": "https://stackoverflow.com/questions/28140959/how-to-find-a-previous-value-to-a-given-x-in-trees-in-haskell/28215839#28215839", "title": "How to find a previous value to a given x in trees in Haskell?", "body": "<p>Note: in the below I assume that \"previous value to x\" means \"the greatest value in the tree less than x\" and that a <code>SearchTree</code> is a Binary Search Tree (ie. sorted).</p>\n\n<p>Let's first have a look at why your code isn't working how you want it to.</p>\n\n<p>One of the great things that Haskell gives us is expressive types, along with type inference, so let's see what type it thinks your <code>previousValHelp</code> function has:</p>\n\n<pre><code>Prelude&gt; :t previousValHelp\npreviousValHelp :: Bool -&gt; SearchTree Bool -&gt; Bool\n</code></pre>\n\n<p>Ah! There's a problem! Our implementation of <code>previousValHelp</code> only works for <code>SearchTree Bool</code>! That's not right, though, we want it to work for all <code>a</code> which fit the constraint <code>Ord a</code>. Try to work out why this is. (I'm not going to explain it here, but try working through the types to see why the <code>SearchTree</code> must be a <code>SearchTree Bool</code>.)</p>\n\n<p>Let's start re-writing our <code>previousVal</code> function. We'll start with a type signature:</p>\n\n<pre><code>previousVal :: Ord a =&gt; a -&gt; (SearchTree a) -&gt; Maybe a\n</code></pre>\n\n<p>This says \"assuming we can compare objects of some type <code>a</code>, we're going to define a function which takes an <code>a</code>, and a <code>SearchTree</code> containing <code>a</code>s, and returns to us either an <code>a</code> (wrapped in <code>Just</code>), or <code>Nothing</code>\". (We're going to use a <code>Maybe a</code> instead of <code>error</code>, because then we can use the type system to make sure our program doesn't crash by forcing us to explicitly handle the <code>Nothing</code> result. It also makes the implementation of the recursive function much easier.)</p>\n\n<p>Now, we know a <code>SearchTree</code> has two possible \"shapes\": either a <code>Node</code> or a <code>Leaf</code>. We'll have to implement a case for both of them.</p>\n\n<pre><code>previousVal x (Node v l r) = _\npreviousVal x (Leaf v) = _\n</code></pre>\n\n<p>Let's start with the <code>Node</code> case. There are two possible cases here: if the value at this <code>Node</code> is less than the value we're looking for, then we want to go down the right subtree (<code>r</code>), otherwise we want to go down the left subtree (<code>l</code>).</p>\n\n<pre><code>previousVal x (Node v l r) | v &lt; x = previousVal x r\n                           | otherwise = previousVal x l\n</code></pre>\n\n<p>For <code>Leaf</code>s the logic is even easier: if the value at the <code>Leaf</code> is less than the value we're looking for then we can return the value (because there's nothing else below us that could be \"closer\" to it than where we are currently). Otherwise, we just return <code>Nothing</code>.</p>\n\n<pre><code>previousVal x (Leaf v) | v &lt; x = Just v\n                       | otherwise = Nothing\n</code></pre>\n\n<p>Now, if you run the code we've written up until this point, you should find some cases where it works, and some where it fails. For example:</p>\n\n<pre><code>Prelude&gt; previousVal 5 t1\nJust 4\nPrelude&gt; previousVal 9 t1\nNothing\n</code></pre>\n\n<p>Why does it seem to work some times, but not others? Well, it turns out we've actually got a bug in our <code>Node</code> case above. See, when we go down the right-hand branch there the possibility that there won't be any values in that subtree which are less than <code>x</code>. In that case, the right hand tree will return a <code>Nothing</code> back to us. But if the right hand subtree returns a <code>Nothing</code>, then the <code>Node</code> we're currently at contains the largest value smaller than <code>x</code>, so we should return <code>Just v</code> instead. Instead of the <code>Node</code> case above we should have something like this:</p>\n\n<pre><code>previousVal x (Node v l r) | v &lt; x = case previousVal x r of\n                                       Nothing -&gt; Just v\n                                       value -&gt; value\n                           | otherwise = previousVal x l\n</code></pre>\n\n<p>Now it should work for 9, too:</p>\n\n<pre><code>Prelude&gt; previousVal 9 t1\nJust 7\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": false, "score": 1, "last_activity_date": 1422562521, "last_edit_date": 1422562521, "creation_date": 1422547286, "answer_id": 28219155, "question_id": 28140959, "link": "https://stackoverflow.com/questions/28140959/how-to-find-a-previous-value-to-a-given-x-in-trees-in-haskell/28219155#28219155", "title": "How to find a previous value to a given x in trees in Haskell?", "body": "<p>Haskell is about types. So it's best to start with the type signature of a function instead of the definition. And it also makes sense to let the type checker tell you what's wrong. It often leads to the solution.</p>\n\n<p>So, I tried to compile your code. Compiler output can sometimes be a bit confusing, but that's something everyone has to go through. I cheated a little to make the output more useful by changing <code>previousVal x t = previousValHelp x t</code> to <code>previousVal = previousValHelp</code> (that is called <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow\" title=\"eta reduction\">eta reduction</a>, but you may just ignore it if it's confusing for you).</p>\n\n<p>Here is the output:</p>\n\n<pre><code>SearchTree.hs:11:15:\n    Could not deduce (a ~ Bool)\n    from the context (Ord a)\n      bound by the type signature for\n                 previousVal :: Ord a =&gt; a -&gt; SearchTree a -&gt; a\n      at SearchTree.hs:10:16-48\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for\n            previousVal :: Ord a =&gt; a -&gt; SearchTree a -&gt; a\n          at SearchTree.hs:10:16\n    Expected type: a -&gt; SearchTree a -&gt; a\n      Actual type: Bool -&gt; SearchTree Bool -&gt; Bool\n    Relevant bindings include\n      previousVal :: a -&gt; SearchTree a -&gt; a (bound at SearchTree.hs:11:1)\n    In the expression: previousValHelp\n    In an equation for \u2018previousVal\u2019: previousVal = previousValHelp\n</code></pre>\n\n<p>See how it tells you what type it expected of <strong>previousValHelp</strong>, but what it got instead:</p>\n\n<pre><code>Expected type: a -&gt; SearchTree a -&gt; a\n  Actual type: Bool -&gt; SearchTree Bool -&gt; Bool\n</code></pre>\n\n<p>This type error shows also the logical error. The definition of <strong>previousValHelp</strong> is basically a <code>foo &lt; bar</code> (just ignore the brackets and the recursion for a second). <em>Mind that the above two lines do not show up in your initial version of the code... so try to figure out the meaning of the very first few lines of the whole compiler output as well.</em></p>\n\n<p>Anyway, let's check now what type <code>(&lt;)</code> has in ghci (<code>&lt;</code> is the <em>infix</em> version of <code>(&lt;)</code>):</p>\n\n<pre><code>Prelude&gt; :t (&lt;)\n(&lt;) :: Ord a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>So it returns a value of type Bool (if given those two <code>a</code> arguments). Makes sense.</p>\n\n<p>Remember how I told you to ignore the recursion and brackets for a second. Now let's figure out why not just the \"return type\" of your function is Bool, but the rest as well. Let's have a look:</p>\n\n<pre><code>previousValHelp x (Node n l r) =\n  max n (max (previousValHelp x l) (previousValHelp x r)) &lt; x\n</code></pre>\n\n<p>This might get a bit tricky. Since we already know that <code>previousValHelp</code> is a function that returns a Bool if given two parameters, we can deduce that the recursive calls <code>(previousValHelp x l)</code> and <code>(previousValHelp x r)</code> also return a Bool. That means we are running the inner function <code>max (previousValHelp x l) (previousValHelp x r)</code> with two Bool parameters and get back a Bool. See the type signature:</p>\n\n<pre><code>max :: Ord a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Now we have the outer function <code>max n (max (...) (...))</code> as well... we already know the type of it's second parameter which is Bool (see above). Since the types must be consistent (<code>max True True</code> works, but not <code>max True 1</code>) the first parameter <code>n</code> is assumed to be Bool as well. Aha. Check your definition of SearchTree... <code>n</code> is the type parameter of our SearchTree and as such we get <code>SearchTree Bool</code>!\nSimilarly, the parameters for <code>(&lt;)</code> must be consistent as well. <code>True &lt; False</code> works, while <code>True &lt; 1</code> does not.\nSo the last step is to figure out the type of x. We already know that the left-side parameter of <code>&lt;</code> is Bool... so <code>x</code> must also be Bool which is our first function parameter.</p>\n\n<p>My guess is that you probably want to use <code>(&lt;)</code> in a way that lets you choose what you want to do... instead of just returning the result.\nFor that purpose, there are <a href=\"https://en.wikipedia.org/wiki/Guard_%28computer_science%29\" rel=\"nofollow\" title=\"guards\">guards</a>.</p>\n\n<p>Again: for a language like haskell which has such a strong focus on types... it's really crucial to learn how to read type/compiler errors.</p>\n"}], "owner": {"reputation": 39, "user_id": 4417804, "user_type": "registered", "profile_image": "https://graph.facebook.com/1492087026/picture?type=large", "display_name": "Dasha V Kravets", "link": "https://stackoverflow.com/users/4417804/dasha-v-kravets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1422562521, "creation_date": 1422216748, "last_edit_date": 1422357976, "question_id": 28140959, "link": "https://stackoverflow.com/questions/28140959/how-to-find-a-previous-value-to-a-given-x-in-trees-in-haskell", "title": "How to find a previous value to a given x in trees in Haskell?", "body": "<p>The task is to find a previous value to the given x in a tree in Haskell. IMPORTANT! Using Lists in any part is not allowed:</p>\n\n<pre><code>data SearchTree a = Leaf a | Node a (SearchTree a) (SearchTree a)\n\nt1 = Node 5 ( Node 4 ( Leaf 1) \n                     ( Node 5 (Leaf 4) (Leaf 5))\n            ) \n            ( Node 7 ( Node 6  ( Leaf 5 ) ( Leaf 7  )) \n                     ( Node 10 ( Leaf 9 ) ( Leaf 11 )) \n            )\n\npreviousVal :: Ord a =&gt; a -&gt; (SearchTree a) -&gt; a\npreviousVal x t = previousValHelp x t \n\npreviousValHelp x (Leaf n) = error \"Es gibt nichts kleineres\"\npreviousValHelp x (Node n l r) = (max n (max (previousValHelp x l) (previousValHelp x r))) &lt; x \n</code></pre>\n\n<p>For example <code>previousVal 9 t1</code> should give <code>7</code> out. \nI managed to make this code, but it's wrong... Does anyone here have an idea?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "iterable-unpacking"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1422207950, "post_id": 28139347, "comment_id": 44650364, "body": "You could use lists as well, just so you know. You could even pattern match it in greater chunks using <code>(a:b:c:rest) = [1,2,3,4,5,6]</code> where <code>a = 1</code>, <code>b = 2</code>, <code>c = 3</code>, and <code>rest = [4,5,6]</code>. Furthermore, this is only necessary in <code>let</code> and <code>where</code> statements, not in base expression level."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 9, "creation_date": 1422208018, "post_id": 28139347, "comment_id": 44650378, "body": "Since we do not have <i>mutable</i> variables in Haskell, we call these &quot;bindings&quot; or &quot;definitions&quot; rather than &quot;assignments&quot;. Your code looks fine, and I wouldn&#39;t worry about the cost unless profiling points at it. Also, if you worry about this tuple, you don&#39;t want to know how <code>&quot;Bar&quot;</code> is actually represented at runtime... ;-)"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1422209859, "creation_date": 1422209859, "answer_id": 28139766, "question_id": 28139347, "link": "https://stackoverflow.com/questions/28139347/assigning-multiple-variables-in-haskell/28139766#28139766", "title": "Assigning multiple variables in Haskell", "body": "<p>Yes, that's perfectly fine. If you compile with optimizations enabled, the tuples will indeed by \"unboxed\", so they incur no extra cost. The code will be transformed to something vaguely like this:</p>\n\n<pre><code>(# var1, var2, var3 #) = \n    case foo &gt; 0 of\n        False -&gt; (# \"Bar\", \"Baz\", 1 #)\n        True -&gt; (# \"Foo\", \"Bar\", 3 #)\n</code></pre>\n\n<p>An unboxed 3-tuple is actually just three values\u2014it doesn't have any sort of extra structure. As a result, it can't be stored in a data structure, but that's okay. Of course, if <code>foo</code> is known at compile time, the <code>case</code> will be optimized away too, and you'll just get three definitions.</p>\n"}], "owner": {"reputation": 3179, "user_id": 869895, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd11f7a6ccc63150f72c564a90e2083e?s=128&d=identicon&r=PG", "display_name": "alexp", "link": "https://stackoverflow.com/users/869895/alexp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1321, "favorite_count": 2, "accepted_answer_id": 28139766, "answer_count": 1, "score": 7, "last_activity_date": 1422209859, "creation_date": 1422207355, "question_id": 28139347, "link": "https://stackoverflow.com/questions/28139347/assigning-multiple-variables-in-haskell", "title": "Assigning multiple variables in Haskell", "body": "<p>Just getting started in Haskell, and I'm trying to figure out the best way to assign multiple variables based on a single condition. So far I've just been packing and unpacking Tuples. Is there a better/more idiomatic way?</p>\n\n<pre><code>(var1, var2, var3) = \n    if foo &gt; 0\n        then (\"Foo\", \"Bar\", 3)\n        else (\"Bar\", \"Baz\", 1)\n</code></pre>\n\n<p>Also curious about the cost of packing and unpacking the Tuples. If I'm reading <a href=\"https://www.haskell.org/haskellwiki/Performance/Data_types\">this</a> correctly, it seems like this gets optimized away in functions, but not sure if that's the case with an assignment.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "edited": false, "score": 7, "creation_date": 1422209129, "post_id": 28139259, "comment_id": 44650784, "body": "<a href=\"http://cs.coloradocollege.edu/~bylvisaker/MonadMotivation/\" rel=\"nofollow noreferrer\">cs.coloradocollege.edu/~bylvisaker/MonadMotivation</a>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1422232144, "post_id": 28139259, "comment_id": 44658123, "body": "<a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow noreferrer\">blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.h&zwnj;&#8203;tml</a>"}, {"owner": {"reputation": 2958, "user_id": 781723, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/mYIzP.png?s=128&g=1", "display_name": "D.W.", "link": "https://stackoverflow.com/users/781723/d-w"}, "edited": false, "score": 4, "creation_date": 1422312152, "post_id": 28139259, "comment_id": 44691550, "body": "What research have you already done?  Where have you looked?  What resources have you found?  <a href=\"https://meta.stackoverflow.com/q/261592/781723\">We expect you to do a significant amount of research before asking, and show us in the question what research you&#39;ve done</a>.  There are many resources that try to explain the motivation for resources -- if you haven&#39;t found any at all, you might need to do a little more research.  If you&#39;ve found some but they didn&#39;t help you, it would make this a better question if you explained what you&#39;d found and why specifically they didn&#39;t work for you."}, {"owner": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 8, "creation_date": 1422312173, "post_id": 28139259, "comment_id": 44691553, "body": "This is definitely a better fit for Programmers.StackExchange and not a good fit for StackOverflow. I&#39;d vote to migrate if I could, but I can&#39;t. =("}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1422340953, "post_id": 28139259, "comment_id": 44699888, "body": "Because there is syntactic sugar associated with them."}, {"owner": {"reputation": 37420, "user_id": 237838, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/5jQlF.jpg?s=128&g=1", "display_name": "Andrew Barber", "link": "https://stackoverflow.com/users/237838/andrew-barber"}, "edited": false, "score": 0, "creation_date": 1422387650, "post_id": 28139259, "comment_id": 44726377, "body": "Since you <a href=\"http://meta.stackexchange.com/questions/247653/are-moderators-expert-in-every-subject\">posted related to this on Meta.SE</a>, please don&#39;t continue to &#39;argue&#39; about it here."}, {"owner": {"reputation": 8157, "user_id": 500202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f8622f992b847d49c77cdbec81c95?s=128&d=identicon&r=PG", "display_name": "Izkata", "link": "https://stackoverflow.com/users/500202/izkata"}, "reply_to_user": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 3, "creation_date": 1422455515, "post_id": 28139259, "comment_id": 44756360, "body": "@jpmc26 Most likely it would get closed there as &quot;primarily opinion-based&quot;; here it at least stands a chance (as shown by the huge number of upvotes, rapid reopen yesterday, and no more close votes yet)"}, {"owner": {"reputation": 2697, "user_id": 11059315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68263eac6b6be448f38d829a0832e2b9?s=128&d=identicon&r=PG&f=1", "display_name": "xilpex", "link": "https://stackoverflow.com/users/11059315/xilpex"}, "edited": false, "score": 0, "creation_date": 1598481399, "post_id": 28139259, "comment_id": 112476799, "body": "For future people coming here, take a look at this great lecture: <a href=\"https://www.youtube.com/watch?v=re96UgMk6GQ\" rel=\"nofollow noreferrer\">youtube.com/watch?v=re96UgMk6GQ</a>. You can start at 31:47 (and watch ~10-15 minutes), but I would recommend watching the whole thing as it is a great lecture."}], "answers": [{"comments": [{"owner": {"reputation": 1867, "user_id": 1993391, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/94b00ce75f65ed84787abf2fb6a98f26?s=128&d=identicon&r=PG", "display_name": "XrXr", "link": "https://stackoverflow.com/users/1993391/xrxr"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 65, "creation_date": 1422208802, "post_id": 28139260, "comment_id": 44650660, "body": "@Carl Please write a better answer to enlighten us"}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 15, "creation_date": 1422208961, "post_id": 28139260, "comment_id": 44650720, "body": "@Carl I think that it is clear in the answer that there are many many problems that benefit from this pattern (point 6) and that <code>IO</code> monad is just one more problem in the list <code>IO</code> (point 7). On the other hand <code>IO</code> only appears once and at the end, so, don&#39;t understand your &quot;most of its time talking ... about IO&quot;."}, {"owner": {"reputation": 1966, "user_id": 321108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0702e179e52194aede9c1b573faf4a?s=128&d=identicon&r=PG", "display_name": "yurez", "link": "https://stackoverflow.com/users/321108/yurez"}, "edited": false, "score": 1, "creation_date": 1422263857, "post_id": 28139260, "comment_id": 44666215, "body": "Does <code>&gt;&gt;=</code> have to be written once per (f,g,Monad) or (g,Monad)?"}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 1966, "user_id": 321108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0702e179e52194aede9c1b573faf4a?s=128&d=identicon&r=PG", "display_name": "yurez", "link": "https://stackoverflow.com/users/321108/yurez"}, "edited": false, "score": 1, "creation_date": 1422264193, "post_id": 28139260, "comment_id": 44666370, "body": "@yurez Only per monad. If you want a class to be a monad you have to define for it <code>&gt;&gt;=</code> and <code>return</code>. I.E                                                                   <code>class Monad m where       return :: a -&gt; m a       (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b </code>    (See: <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\">learnyouahaskell.com/a-fistful-of-monads</a>)"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1422267060, "post_id": 28139260, "comment_id": 44667643, "body": "Function composition doesn&#39;t determine which function is executed first (i.e. writing <code>\\x y -&gt; f (g x y)</code> doesn&#39;t mean that <code>g</code> will be executed before <code>f</code>). That is determined by the evaluation strategy. To prove this evaluate the following in GHCi, <code>let assert = const True . error</code> and <code>assert &quot;Function composition doesn&#39;t determine evaluation order.&quot;</code> The result is <code>True</code>, not an error. In a strict language it would throw an error. However because Haskell is non-strict by default it doesn&#39;t do so. Instead it evaluates <code>const</code> first and doesn&#39;t evaluate <code>error</code> at all."}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1422269245, "post_id": 28139260, "comment_id": 44668604, "body": "@AaditMShah &quot;The exception confirms the rule&quot;"}, {"owner": {"reputation": 31937, "user_id": 2642204, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIjBF.jpg?s=128&g=1", "display_name": "BartoszKP", "link": "https://stackoverflow.com/users/2642204/bartoszkp"}, "edited": false, "score": 0, "creation_date": 1422271453, "post_id": 28139260, "comment_id": 44669591, "body": "@cibercitizen1 That&#39;s a weak excuse for when you don&#39;t know what the rule is :)"}, {"owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "reply_to_user": {"reputation": 31937, "user_id": 2642204, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIjBF.jpg?s=128&g=1", "display_name": "BartoszKP", "link": "https://stackoverflow.com/users/2642204/bartoszkp"}, "edited": false, "score": 1, "creation_date": 1422272982, "post_id": 28139260, "comment_id": 44670314, "body": "@BartoszKP  In <code>const True . error</code> Does <code>const True</code> depends on <code>error</code>? Great example to prove what? That if you compose functions in which don&#39;t depend the outer function on the inner function&#39;s output, the inner one doesn&#39;t need to be evaluated? Great ;-)"}, {"owner": {"reputation": 31937, "user_id": 2642204, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIjBF.jpg?s=128&g=1", "display_name": "BartoszKP", "link": "https://stackoverflow.com/users/2642204/bartoszkp"}, "edited": false, "score": 1, "creation_date": 1422273166, "post_id": 28139260, "comment_id": 44670394, "body": "@cibercitizen1 I didn&#39;t say anything about <code>const True .error</code>, nor about any dependencies nor about composing functions. I don&#39;t know whether you&#39;re right or wrong. I&#39;ve only evaluated your previously expressed argument."}, {"owner": {"reputation": 3521, "user_id": 658087, "user_type": "registered", "accept_rate": 18, "profile_image": "https://i.stack.imgur.com/hvS4q.png?s=128&g=1", "display_name": "JD\u0142ugosz", "link": "https://stackoverflow.com/users/658087/jd%c5%82ugosz"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1422276132, "post_id": 28139260, "comment_id": 44671766, "body": "@carl not just IO, but it just happens that Monads (already known to the math people) provides a way to address <i>several</i> of the &quot;hard parts&quot; of pure functional programming, and the State hard part pretty much solves everything else. So, one set of syntactic sugar gives a lot of benefits. It is, in essence, adding stateful things into Haskell in a palletable manner."}, {"owner": {"reputation": 228, "user_id": 1796835, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f69df52127b611161950ee5c0dda2419?s=128&d=identicon&r=PG", "display_name": "vlastachu", "link": "https://stackoverflow.com/users/1796835/vlastachu"}, "edited": false, "score": 4, "creation_date": 1422359524, "post_id": 28139260, "comment_id": 44709101, "body": "The great misconceptions about monads: monads about state; monads about exception handling; there is no way to implement IO in pure FPL without monads;monads are unambiguous (contrargument is <code>Either</code>). The most of answer is about &quot;Why do we need functors?&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1422525770, "post_id": 28139260, "comment_id": 44787704, "body": "<i>&quot;6. 2. Have a composer/linker <code>g &gt;&gt;= f</code> to help connecting <code>g</code>&#39;s output to <code>f</code>&#39;s input, so we don&#39;t have to change any <code>f</code> at all.&quot;</i> <b>this is not right</b> at all. Before, in <code>f(g(x,y))</code>, <code>f</code> could produce anything. It could be <code>f:: Real -&gt; String</code>. With &quot;monadic composition&quot; <b>it must be changed</b> to produce <code>Maybe String</code>, or else the types won&#39;t fit. Moreover, <b><code>&gt;&gt;=</code></b> itself <b>doesn&#39;t fit</b>!! It&#39;s <code>&gt;=&gt;</code> that does this composition, not <code>&gt;&gt;=</code>. See the discussion with dfeuer under Carl&#39;s answer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1422526158, "post_id": 28139260, "comment_id": 44787920, "body": "Your answer is right in the sense that monads IMO indeed are best described as being about the composition/ality of &quot;functions&quot; (Kleisli arrows really), but the precise details of what type goes where are what makes them &quot;monads&quot;. you could wire the boxes in all kinds of manners (like Functor, etc.). This <i>specific</i> way of wiring them together is what defines &quot;the monad&quot;."}, {"owner": {"reputation": 4565, "user_id": 1968462, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6ef24851a32cb6519312916524da2586?s=128&d=identicon&r=PG", "display_name": "Kat", "link": "https://stackoverflow.com/users/1968462/kat"}, "edited": false, "score": 0, "creation_date": 1422735170, "post_id": 28139260, "comment_id": 44870263, "body": "For anyone learning Scala, the equivalent of the compose function (<code>&gt;&gt;=</code>) in Scala is usually the <code>map</code> method. For example, <code>Option.map</code> will apply the given function to the boxed in data if the type is <code>Some</code> and do nothing if the type if <code>None</code>. So instead of <code>g &gt;&gt;= f</code>, we&#39;d use <code>g map f</code>. The <code>Try</code> monad works similarly, but <code>Failure</code> will store an exception (and calling map on a <code>Failure</code> returns the unmodified <code>Failure</code>)."}], "tags": [], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "is_accepted": true, "score": 599, "last_activity_date": 1423812615, "last_edit_date": 1423812615, "creation_date": 1422206854, "answer_id": 28139260, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/28139260#28139260", "title": "Why do we need monads?", "body": "<h2>Why do we need monads?</h2>\n\n<ol>\n<li>We want to program <strong>only using functions</strong>. (\"functional programming (FP)\" after all).</li>\n<li><p>Then, we have a first big problem. This is a program:</p>\n\n<p><code>f(x) = 2 * x</code></p>\n\n<p><code>g(x,y) = x / y</code></p>\n\n<p>How can we say  <strong>what is to be executed first</strong>? How can we form an ordered sequence of functions (i.e. <strong>a program</strong>) <em>using no more than functions</em>?</p>\n\n<p>Solution: <strong>compose functions</strong>. If you want first <code>g</code> and then <code>f</code>, just write <code>f(g(x,y))</code>. This way, \"the program\" is a function as well: <code>main = f(g(x,y))</code>. OK, but ...</p></li>\n<li><p>More problems: some functions <strong>might fail</strong> (i.e. <code>g(2,0)</code>, divide by 0). We have <strong>no \"exceptions\"</strong> in FP (an exception is not a function). How do we solve it?</p>\n\n<p>Solution: Let's <strong>allow functions to return two kind of things</strong>: instead of having <code>g : Real,Real -&gt; Real</code> (function from two reals into a real), let's allow <code>g : Real,Real -&gt; Real | Nothing</code> (function from two reals into (real or nothing)). </p></li>\n<li><p>But functions should (to be simpler) return only <strong>one thing</strong>. </p>\n\n<p>Solution: let's create a new type of data to be returned, a \"<strong>boxing type</strong>\" that encloses maybe a real or be simply nothing. Hence, we can have <code>g : Real,Real -&gt; Maybe Real</code>. OK, but ...</p></li>\n<li><p>What happens now to <code>f(g(x,y))</code>? <code>f</code> is not ready to consume a <code>Maybe Real</code>. And, we don't want to change every function we could connect with <code>g</code> to consume a <code>Maybe Real</code>.</p>\n\n<p>Solution: let's <strong>have a special function to \"connect\"/\"compose\"/\"link\" functions</strong>. That way, we can, behind the scenes, adapt the output of one function to feed the following one. </p>\n\n<p>In our case:  <code>g &gt;&gt;= f</code> (connect/compose <code>g</code> to <code>f</code>). We want <code>&gt;&gt;=</code> to get <code>g</code>'s output, inspect it and, in case it is <code>Nothing</code> just don't call <code>f</code> and return <code>Nothing</code>; or on the contrary, extract the boxed <code>Real</code> and feed <code>f</code> with it. (This algorithm is just the implementation of <code>&gt;&gt;=</code> for the <code>Maybe</code> type). Also note that <code>&gt;&gt;=</code> must be written <strong>only once</strong> per \"boxing type\" (different box, different adapting algorithm).</p></li>\n<li><p>Many other problems arise which can be solved using this same pattern: 1. Use a \"box\" to codify/store different meanings/values, and have functions like <code>g</code> that return those \"boxed values\". 2. Have a composer/linker <code>g &gt;&gt;= f</code> to help connecting <code>g</code>'s output to <code>f</code>'s input, so we don't have to change any <code>f</code> at all.</p></li>\n<li><p>Remarkable problems that can be solved using this technique are: </p>\n\n<ul>\n<li><p>having a global state that every function in the sequence of functions (\"the program\") can share: solution <code>StateMonad</code>. </p></li>\n<li><p>We don't like \"impure functions\": functions that yield <em>different</em> output for <em>same</em> input. Therefore, let's mark those functions, making them to return a tagged/boxed value: <code>IO</code> monad.</p></li>\n</ul></li>\n</ol>\n\n<p>Total happiness!</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422219514, "post_id": 28141248, "comment_id": 44654436, "body": "Can you explain the relationship between categories generally and Kleisli categories? The three laws you describe hold in any category."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422229409, "post_id": 28141248, "comment_id": 44657475, "body": "@dfeuer Oh.  To put it in code, <code>newtype Kleisli m a b = Kleisli (a -&gt; m b)</code>. Kleisli categories are functions where the categorical return type (<code>b</code> in this case) is the argument to a type constructor <code>m</code>. Iff <code>Kleisli m</code> forms a category, <code>m</code> is a Monad."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422239578, "post_id": 28141248, "comment_id": 44659814, "body": "What is a categorical return type exactly? <code>Kleisli m</code> seems to form a category whose objects are Haskell types and such that the arrows from <code>a</code> to <code>b</code> are the functions from <code>a</code> to <code>m b</code>, with <code>id = return</code> and <code>(.) = (&lt;=&lt;)</code>. Is that about right, or am I mixing up different levels of things or something?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422246863, "post_id": 28141248, "comment_id": 44661467, "body": "@dfeuer That&#39;s correct. The objects are all types, and the morphisms are between types <code>a</code> and <code>b</code>, but they&#39;re not simple functions. They&#39;re decorated with an extra <code>m</code> in the return value of the function."}, {"owner": {"reputation": 375, "user_id": 3854340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec386363a0eadb401f5d281af2ed3fc?s=128&d=identicon&r=PG&f=1", "display_name": "aoeu256", "link": "https://stackoverflow.com/users/3854340/aoeu256"}, "edited": false, "score": 1, "creation_date": 1571445556, "post_id": 28141248, "comment_id": 103255808, "body": "Is the Category Theory terminology really needed?  Maybe, Haskell would be easier if you turned the types into pictures where the type would be the DNA for how the pictures are drawn (dependent types though*), and then you use the picture to write your program with the names being small ruby characters above the icon."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 228, "last_activity_date": 1545002651, "last_edit_date": 1545002651, "creation_date": 1422218602, "answer_id": 28141248, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/28141248#28141248", "title": "Why do we need monads?", "body": "<p>The answer is, of course, <strong>\"We don't\"</strong>. As with all abstractions, it isn't necessary.</p>\n\n<p>Haskell does not need a monad abstraction. It isn't necessary for performing IO in a pure language. The <code>IO</code> type takes care of that just fine by itself. The existing monadic desugaring of <code>do</code> blocks could be replaced with desugaring to <code>bindIO</code>, <code>returnIO</code>, and <code>failIO</code> as defined in the <code>GHC.Base</code> module. (It's not a documented module on hackage, so I'll have to point at <a href=\"https://github.com/ghc/ghc/blob/f006ed7965a0fa918d720cc387b33cb8e7083854/libraries/base/GHC/Base.hs#L1063\" rel=\"noreferrer\">its source</a> for documentation.) So no, there's no need for the monad abstraction.</p>\n\n<p>So if it's not needed, why does it exist? Because it was found that many patterns of computation form monadic structures. Abstraction of a structure allows for writing code that works across all instances of that structure. To put it more concisely - code reuse.</p>\n\n<p>In functional languages, the most powerful tool found for code reuse has been composition of functions. The good old <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</code> operator is exceedingly powerful. It makes it easy to write tiny functions and glue them together with minimal syntactic or semantic overhead.</p>\n\n<p>But there are cases when the types don't work out quite right.  What do you do when you have <code>foo :: (b -&gt; Maybe c)</code> and <code>bar :: (a -&gt; Maybe b)</code>? <code>foo . bar</code> doesn't typecheck, because <code>b</code> and <code>Maybe b</code> aren't the same type.</p>\n\n<p>But... it's almost right. You just want a bit of leeway. You want to be able to treat <code>Maybe b</code> as if it were basically <code>b</code>. It's a poor idea to just flat-out treat them as the same type, though. That's more or less the same thing as null pointers, which Tony Hoare famously called <a href=\"http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare\" rel=\"noreferrer\">the billion-dollar mistake</a>. So if you can't treat them as the same type, maybe you can find a way to extend the composition mechanism <code>(.)</code> provides.</p>\n\n<p>In that case, it's important to really examine the theory underlying <code>(.)</code>. Fortunately, someone has already done this for us. It turns out that the combination of <code>(.)</code> and <code>id</code> form a mathematical construct known as a <a href=\"http://bartoszmilewski.com/2014/11/04/category-the-essence-of-composition/\" rel=\"noreferrer\">category</a>. But there are other ways to form categories. A Kleisli category, for instance, allows the objects being composed to be augmented a bit. A Kleisli category for <code>Maybe</code> would consist of <code>(.) :: (b -&gt; Maybe c) -&gt; (a -&gt; Maybe b) -&gt; (a -&gt; Maybe c)</code> and <code>id :: a -&gt; Maybe a</code>. That is, the objects in the category augment the <code>(-&gt;)</code> with a <code>Maybe</code>, so <code>(a -&gt; b)</code> becomes <code>(a -&gt; Maybe b)</code>.</p>\n\n<p>And suddenly, we've extended the power of composition to things that the traditional <code>(.)</code> operation doesn't work on. This is a source of new abstraction power. Kleisli categories work with more types than just <code>Maybe</code>. They work with every type that can assemble a proper category, obeying the category laws.</p>\n\n<ol>\n<li>Left identity: <code>id . f</code> = <code>f</code></li>\n<li>Right identity: <code>f . id</code> = <code>f</code></li>\n<li>Associativity: <code>f . (g . h)</code> = <code>(f . g) . h</code></li>\n</ol>\n\n<p>As long as you can prove that your type obeys those three laws, you can turn it into a Kleisli category. And what's the big deal about that? Well, it turns out that monads are exactly the same thing as Kleisli categories. <code>Monad</code>'s <code>return</code> is the same as Kleisli <code>id</code>. <code>Monad</code>'s <code>(&gt;&gt;=)</code> isn't identical to Kleisli <code>(.)</code>, but it turns out to be very easy to write each in terms of the other. And the category laws are the same as the monad laws, when you translate them across the difference between <code>(&gt;&gt;=)</code> and <code>(.)</code>.</p>\n\n<p>So why go through all this bother? Why have a <code>Monad</code> abstraction in the language? As I alluded to above, it enables code reuse. It even enables code reuse along two different dimensions.</p>\n\n<p>The first dimension of code reuse comes directly from the presence of the abstraction. You can write code that works across all instances of the abstraction. There's the entire <a href=\"https://hackage.haskell.org/package/monad-loops\" rel=\"noreferrer\">monad-loops</a> package consisting of loops that work with any instance of <code>Monad</code>.</p>\n\n<p>The second dimension is indirect, but it follows from the existence of composition. When composition is easy, it's natural to write code in small, reusable chunks. This is the same way having the <code>(.)</code> operator for functions encourages writing small, reusable functions.</p>\n\n<p>So why does the abstraction exist? Because it's proven to be a tool that enables more composition in code, resulting in creating reusable code and encouraging the creation of more reusable code. Code reuse is one of the holy grails of programming. The monad abstraction exists because it moves us a little bit towards that holy grail.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1422942708, "post_id": 28146074, "comment_id": 44937545, "body": "This answer explains, why we need the Monad typeclass. The best way to understand, why we need monads and not something else, is to read about difference between monads and applicative functors: <a href=\"http://stackoverflow.com/questions/23342184/difference-between-monad-and-applicative-in-haskell\">one</a>, <a href=\"http://stackoverflow.com/questions/17409260/what-advantage-does-monad-give-us-over-an-applicative\">two</a>."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 24, "last_activity_date": 1422264048, "last_edit_date": 1422264048, "creation_date": 1422256935, "answer_id": 28146074, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/28146074#28146074", "title": "Why do we need monads?", "body": "<p>Benjamin Pierce said in <a href=\"http://www.cis.upenn.edu/~bcpierce/tapl/\" rel=\"noreferrer\">TAPL</a></p>\n\n<blockquote>\n  <p>A type system can be regarded as calculating a kind of static\n  approximation to the run-time behaviours of the terms in a program.</p>\n</blockquote>\n\n<p>That's why a language equipped with a powerful type system is strictly more expressive, than a poorly typed language. You can think about monads in the same way.</p>\n\n<p>As @Carl and <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"noreferrer\">sigfpe</a> point, you can equip a datatype with all operations you want without resorting to monads, typeclasses or whatever other abstract stuff. However monads allow you not only to write reusable code, but also to abstract away all redundant detailes.</p>\n\n<p>As an example, let's say we want to filter a list. The simplest way is to use the <code>filter</code> function: <code>filter (&gt; 3) [1..10]</code>, which equals <code>[4,5,6,7,8,9,10]</code>.</p>\n\n<p>A slightly more complicated version of <code>filter</code>, that also passes an accumulator from left to right, is</p>\n\n<pre><code>swap (x, y) = (y, x)\n(.*) = (.) . (.)\n\nfilterAccum :: (a -&gt; b -&gt; (Bool, a)) -&gt; a -&gt; [b] -&gt; [b]\nfilterAccum f a xs = [x | (x, True) &lt;- zip xs $ snd $ mapAccumL (swap .* f) a xs]\n</code></pre>\n\n<p>To get all <code>i</code>, such that <code>i &lt;= 10, sum [1..i] &gt; 4, sum [1..i] &lt; 25</code>, we can write</p>\n\n<pre><code>filterAccum (\\a x -&gt; let a' = a + x in (a' &gt; 4 &amp;&amp; a' &lt; 25, a')) 0 [1..10]\n</code></pre>\n\n<p>which equals <code>[3,4,5,6]</code>.</p>\n\n<p>Or we can redefine the <code>nub</code> function, that removes duplicate elements from a list, in terms of <code>filterAccum</code>:</p>\n\n<pre><code>nub' = filterAccum (\\a x -&gt; (x `notElem` a, x:a)) []\n</code></pre>\n\n<p><code>nub' [1,2,4,5,4,3,1,8,9,4]</code> equals <code>[1,2,4,5,3,8,9]</code>. A list is passed as an accumulator here. The code works, because it's possible to leave the list monad, so the whole computation stays pure (<code>notElem</code> doesn't use <code>&gt;&gt;=</code> actually, but it could). However it's not possible to safely leave the IO monad (i.e. you cannot execute an IO action and return a pure value \u2014 the value always will be wrapped in the IO monad). Another example is mutable arrays: after you have leaved the ST monad, where a mutable array live, you cannot update the array in constant time anymore. So we need a monadic filtering from the <code>Control.Monad</code> module:</p>\n\n<pre><code>filterM          :: (Monad m) =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]\nfilterM _ []     =  return []\nfilterM p (x:xs) =  do\n   flg &lt;- p x\n   ys  &lt;- filterM p xs\n   return (if flg then x:ys else ys)\n</code></pre>\n\n<p><code>filterM</code> executes a monadic action for all elements from a list, yielding elements, for which the monadic action returns <code>True</code>.</p>\n\n<p>A filtering example with an array:</p>\n\n<pre><code>nub' xs = runST $ do\n        arr &lt;- newArray (1, 9) True :: ST s (STUArray s Int Bool)\n        let p i = readArray arr i &lt;* writeArray arr i False\n        filterM p xs\n\nmain = print $ nub' [1,2,4,5,4,3,1,8,9,4]\n</code></pre>\n\n<p>prints <code>[1,2,4,5,3,8,9]</code> as expected.</p>\n\n<p>And a version with the IO monad, which asks what elements to return:</p>\n\n<pre><code>main = filterM p [1,2,4,5] &gt;&gt;= print where\n    p i = putStrLn (\"return \" ++ show i ++ \"?\") *&gt; readLn\n</code></pre>\n\n<p>E.g.</p>\n\n<pre><code>return 1? -- output\nTrue      -- input\nreturn 2?\nFalse\nreturn 4?\nFalse\nreturn 5?\nTrue\n[1,5]     -- output\n</code></pre>\n\n<p>And as a final illustration, <code>filterAccum</code> can be defined in terms of <code>filterM</code>:</p>\n\n<pre><code>filterAccum f a xs = evalState (filterM (state . flip f) xs) a\n</code></pre>\n\n<p>with the <code>StateT</code> monad, that is used under the hood, being just an ordinary datatype.</p>\n\n<p>This example illustrates, that monads not only allow you to abstract computational context and write clean reusable code (due to the composability of monads, as @Carl explains), but also to treat user-defined datatypes and built-in primitives uniformly.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3521, "user_id": 658087, "user_type": "registered", "accept_rate": 18, "profile_image": "https://i.stack.imgur.com/hvS4q.png?s=128&g=1", "display_name": "JD\u0142ugosz", "link": "https://stackoverflow.com/users/658087/jd%c5%82ugosz"}, "edited": false, "score": 0, "creation_date": 1422281053, "post_id": 28148780, "comment_id": 44674409, "body": "@jdlugosz: <a href=\"http://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-Trans-Cont.html#t:Cont\" rel=\"nofollow noreferrer\"><code>IO3 a \u2261 Cont IO2 a</code></a>. But I meant that comment more as a nod to those who already know the continuation monad, as it doesn&#39;t exactly have a reputation as being beginner-friendly."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 22, "last_activity_date": 1496661062, "last_edit_date": 1496661062, "creation_date": 1422269737, "answer_id": 28148780, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/28148780#28148780", "title": "Why do we need monads?", "body": "<p><em>I don't think <code>IO</code> should be seen as a particularly outstanding monad, but it's certainly one of the more astounding ones for beginners, so I'll use it for my explanation.</em></p>\n\n<h2>Na\u00efvely building an IO system for Haskell</h2>\n\n<p>The simplest conceivable IO system for a purely-functional language (and in fact the one Haskell started out with) is this:</p>\n\n<pre><code>main\u2080 :: String -&gt; String\nmain\u2080 _ = \"Hello World\"\n</code></pre>\n\n<p>With lazyness, that simple signature is enough to actually build interactive terminal programs &ndash; <em>very</em> limited, though. Most frustrating is that we can only output text. What if we added some more exciting output possibilities?</p>\n\n<pre><code>data Output = TxtOutput String\n            | Beep Frequency\n\nmain\u2081 :: String -&gt; [Output]\nmain\u2081 _ = [ TxtOutput \"Hello World\"\n          -- , Beep 440  -- for debugging\n          ]\n</code></pre>\n\n<p>cute, but of course a much more realistic \u201calterative output\u201d would be <em>writing to a file</em>. But then you'd also want some way to <em>read from</em> files. Any chance?</p>\n\n<p>Well, when we take our <code>main\u2081</code> program and simply <em>pipe a file to the process</em> (using operating system facilities), we have essentially implemented file-reading. If we could trigger that file-reading from within the Haskell language...</p>\n\n<pre><code>readFile :: Filepath -&gt; (String -&gt; [Output]) -&gt; [Output]\n</code></pre>\n\n<p>This would use an \u201cinteractive program\u201d <code>String-&gt;[Output]</code>, feed it a string obtained from a file, and yield a non-interactive program that simply executes the given one.</p>\n\n<p>There's one problem here: we don't really have a notion of <em>when</em> the file is read. The <code>[Output]</code> list sure gives a nice order to the <em>outputs</em>, but we don't get an order for when the <em>inputs</em> will be done.</p>\n\n<p>Solution: make input-events also items in the list of things to do.</p>\n\n<pre><code>data IO\u2080 = TxtOut String\n         | TxtIn (String -&gt; [Output])\n         | FileWrite FilePath String\n         | FileRead FilePath (String -&gt; [Output])\n         | Beep Double\n\nmain\u2082 :: String -&gt; [IO\u2080]\nmain\u2082 _ = [ FileRead \"/dev/null\" $ \\_ -&gt;\n             [TxtOutput \"Hello World\"]\n          ]\n</code></pre>\n\n<p>Ok, now you may spot an imbalance: you can read a file and make output dependent on it, but you can't use the file contents to decide to e.g. also read another file. Obvious solution: make the result of the input-events also something of type <code>IO</code>, not just <code>Output</code>. That sure includes simple text output, but also allows reading additional files etc..</p>\n\n<pre><code>data IO\u2081 = TxtOut String\n         | TxtIn (String -&gt; [IO\u2081])\n         | FileWrite FilePath String\n         | FileRead FilePath (String -&gt; [IO\u2081])\n         | Beep Double\n\nmain\u2083 :: String -&gt; [IO\u2081]\nmain\u2083 _ = [ TxtIn $ \\_ -&gt;\n             [TxtOut \"Hello World\"]\n          ]\n</code></pre>\n\n<p>That would now actually allow you to express any file operation you might want in a program (though perhaps not with good performance), but it's somewhat overcomplicated:</p>\n\n<ul>\n<li><p><code>main\u2083</code> yields a whole <em>list</em> of actions. Why don't we simply use the signature <code>:: IO\u2081</code>, which has this as a special case?</p></li>\n<li><p>The lists don't really give a reliable overview of program flow anymore: most subsequent computations will only be \u201cannounced\u201d as the result of some input operation. So we might as well ditch the list structure, and simply cons a \u201cand then do\u201d to each output operation.</p></li>\n</ul>\n\n\n\n<pre><code>data IO\u2082 = TxtOut String IO\u2082\n         | TxtIn (String -&gt; IO\u2082)\n         | Terminate\n\nmain\u2084 :: IO\u2082\nmain\u2084 = TxtIn $ \\_ -&gt;\n         TxtOut \"Hello World\"\n          Terminate\n</code></pre>\n\n<p>Not too bad!</p>\n\n<h2>So what has all of this to do with monads?</h2>\n\n<p>In practice, you wouldn't want to use plain constructors to define all your programs. There would need to be a good couple of such fundamental constructors, yet for most higher-level stuff we would like to write a function with some nice high-level signature. It turns out most of these would look quite similar: accept some kind of meaningfully-typed value, and yield an IO action as the result.</p>\n\n<pre><code>getTime :: (UTCTime -&gt; IO\u2082) -&gt; IO\u2082\nrandomRIO :: Random r =&gt; (r,r) -&gt; (r -&gt; IO\u2082) -&gt; IO\u2082\nfindFile :: RegEx -&gt; (Maybe FilePath -&gt; IO\u2082) -&gt; IO\u2082\n</code></pre>\n\n<p>There's evidently a pattern here, and we'd better write it as</p>\n\n<pre><code>type IO\u2083 a = (a -&gt; IO\u2082) -&gt; IO\u2082    -- If this reminds you of continuation-passing\n                                  -- style, you're right.\n\ngetTime :: IO\u2083 UTCTime\nrandomRIO :: Random r =&gt; (r,r) -&gt; IO\u2083 r\nfindFile :: RegEx -&gt; IO\u2083 (Maybe FilePath)\n</code></pre>\n\n<p>Now that starts to look familiar, but we're still only dealing with thinly-disguised plain functions under the hood, and that's risky: each \u201cvalue-action\u201d has the responsibility of actually passing on the resulting action of any contained function (else the control flow of the entire program is easily disrupted by one ill-behaved action in the middle). We'd better make that requirement explicit. Well, it turns out those are the <em>monad laws</em>, though I'm not sure we can really formulate them without the standard bind/join operators.</p>\n\n<p>At any rate, we've now reached a formulation of IO that has a proper monad instance:</p>\n\n<pre><code>data IO\u2084 a = TxtOut String (IO\u2084 a)\n           | TxtIn (String -&gt; IO\u2084 a)\n           | TerminateWith a\n\ntxtOut :: String -&gt; IO\u2084 ()\ntxtOut s = TxtOut s $ TerminateWith ()\n\ntxtIn :: IO\u2084 String\ntxtIn = TxtIn $ TerminateWith\n\ninstance Functor IO\u2084 where\n  fmap f (TerminateWith a) = TerminateWith $ f a\n  fmap f (TxtIn g) = TxtIn $ fmap f . g\n  fmap f (TxtOut s c) = TxtOut s $ fmap f c\n\ninstance Applicative IO\u2084 where\n  pure = TerminateWith\n  (&lt;*&gt;) = ap\n\ninstance Monad IO\u2084 where\n  TerminateWith x &gt;&gt;= f = f x\n  TxtOut s c &gt;&gt;= f = TxtOut s $ c &gt;&gt;= f\n  TxtIn g &gt;&gt;= f = TxtIn $ (&gt;&gt;=f) . g\n</code></pre>\n\n<p>Obviously this is not an efficient implementation of IO, but it's in principle usable.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422642249, "post_id": 28237600, "comment_id": 44845292, "body": "This has nothing to do with type families. What are you actually talking about?"}], "tags": [], "owner": {"reputation": 965, "user_id": 60823, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6346bcaa4782ea6c1a9f4d878b7cdd6e?s=128&d=identicon&r=PG", "display_name": "jdinunzio", "link": "https://stackoverflow.com/users/60823/jdinunzio"}, "is_accepted": false, "score": 4, "last_activity_date": 1422627091, "last_edit_date": 1422627091, "creation_date": 1422626677, "answer_id": 28237600, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/28237600#28237600", "title": "Why do we need monads?", "body": "<p>You need monads if you have a <strong>type constructor</strong> and <strong>functions that returns values of that type family</strong>. Eventually, you would like to <strong>combine these kind of functions together</strong>. These are the three key elements to answer <em>why</em>.</p>\n\n<p>Let me elaborate. You have <code>Int</code>, <code>String</code> and <code>Real</code> and functions of type <code>Int -&gt; String</code>, <code>String -&gt; Real</code> and so on. You can combine these functions easily, ending with <code>Int -&gt; Real</code>. Life is good. </p>\n\n<p>Then, one day, you need to create a <strong>new <em>family</em> of types</strong>. It could be because you need to consider the possibility of returning no value (<code>Maybe</code>), returning an error (<code>Either</code>), multiple results (<code>List</code>) and so on.</p>\n\n<p>Notice that <code>Maybe</code> is a type constructor. It takes a type, like <code>Int</code> and returns a new type <code>Maybe Int</code>. First thing to remember, <strong>no type constructor, no monad.</strong> </p>\n\n<p>Of course, <strong>you want to use your type constructor</strong> in your code, and soon you end with functions like <code>Int -&gt; Maybe String</code> and <code>String -&gt; Maybe Float</code>. Now, you can't easily combine your functions. Life is not good anymore.</p>\n\n<p>And here's when monads come to the rescue. They allow you to combine that kind of functions again. You just need to change the composition <strong>.</strong> for <strong>>==</strong>. </p>\n"}, {"tags": [], "owner": {"reputation": 374, "user_id": 1465449, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8d5d5d4b1efba2d0396ceac6e67a0d6f?s=128&d=identicon&r=PG", "display_name": "heisenbug", "link": "https://stackoverflow.com/users/1465449/heisenbug"}, "is_accepted": false, "score": 5, "last_activity_date": 1437661875, "creation_date": 1437661875, "answer_id": 31590384, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/31590384#31590384", "title": "Why do we need monads?", "body": "<p><em>Monads</em> are just a convenient framework for solving a class of recurring problems. First, monads must be <em>functors</em> (i.e. must support mapping without looking at the elements (or their type)), they must also bring a <em>binding</em> (or chaining) operation and a way to create a monadic value from an element type (<code>return</code>). Finally, <code>bind</code> and <code>return</code> must satisfy two equations (left and right identities), also called the monad laws. (Alternatively one could define monads to have a <code>flattening operation</code> instead of binding.)</p>\n\n<p>The <em>list monad</em> is commonly used to deal with non-determinism. The bind operation selects one element of the list (intuitively all of them in <em>parallel worlds</em>), lets the programmer to do some computation with them, and then combines the results in all worlds to single list (by concatenating, or flattening, a nested list). Here is how one would define a permutation function in the monadic framework of Haskell:</p>\n\n<pre><code>perm [e] = [[e]]\nperm l = do (leader, index) &lt;- zip l [0 :: Int ..]\n            let shortened = take index l ++ drop (index + 1) l\n            trailer &lt;- perm shortened\n            return (leader : trailer)\n</code></pre>\n\n<p>Here is an example <em>repl</em> session:</p>\n\n<pre><code>*Main&gt; perm \"a\"\n[\"a\"]\n*Main&gt; perm \"ab\"\n[\"ab\",\"ba\"]\n*Main&gt; perm \"\"\n[]\n*Main&gt; perm \"abc\"\n[\"abc\",\"acb\",\"bac\",\"bca\",\"cab\",\"cba\"]\n</code></pre>\n\n<p>It should be noted that the list monad is in no way a side effecting computation. A mathematical structure being a monad (i.e. conforming to the above mentioned interfaces and laws) does not imply side effects, though side-effecting phenomena often nicely fit into the monadic framework.</p>\n"}, {"tags": [], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "is_accepted": false, "score": 6, "last_activity_date": 1466295381, "creation_date": 1466295381, "answer_id": 37902770, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/37902770#37902770", "title": "Why do we need monads?", "body": "<p>Monads serve basically to compose functions together in a chain. Period.</p>\n\n<p>Now the way they compose differs across the existing monads, thus resulting in different behaviors (e.g., to simulate mutable state in the state monad).</p>\n\n<p>The confusion about monads is that being so general, i.e., a mechanism to compose functions, they can be used for many things, thus leading people to believe that monads are about state, about IO, etc, when they are only about \"composing functions\".</p>\n\n<p>Now, one interesting thing about monads, is that the result of the composition is always of type \"M a\", that is, a value inside an envelope tagged with \"M\". This feature happens to be really nice to implement, for example, a clear separation between pure from impure code: declare all impure actions as functions of type \"IO a\" and provide no function, when defining the IO monad, to take out the \"a\" value from inside the \"IO a\". The result is that no function can be pure and at the same time take out a value from an \"IO a\", because there is no way to take such value while staying pure (the function must be inside the \"IO\" monad to use such value). (NOTE: well, nothing is perfect, so the \"IO straitjacket\" can be broken using \"unsafePerformIO : IO a -> a\" thus polluting what was supposed to be a pure function, but this should be used very sparingly and when you really know to be not introducing any impure code with side-effects.</p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 2, "last_activity_date": 1614182726, "last_edit_date": 1614182726, "creation_date": 1596887902, "answer_id": 63315104, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads/63315104#63315104", "title": "Why do we need monads?", "body": "<blockquote>\n<p>Why do we need monadic types?</p>\n</blockquote>\n<p>Monadic types aren't <em>always</em> needed - from <a href=\"https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.91.3579&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">How to Declare an Imperative</a> by Philip Wadler:</p>\n<pre><code>(* page 25 *)\nval echoML    : unit -&gt; unit\nfun echoML () = let val c = getcML () in\n                if c = #&quot;\\n&quot; then\n                  ()\n                else\n                  (putcML c; echoML ())\n                end\n</code></pre>\n<p>where:</p>\n<pre><code>(* pages 25-26 *)\nfun putcML c  = TextIO.output1(TextIO.stdOut,c);\nfun getcML () = valOf(TextIO.input1(TextIO.stdIn));\n</code></pre>\n<p>Yes, alright - you're probably trying to learn Haskell, and that's why you eventually ended up here. As it happens, it was the quandary of I/O in nonstrict languages like Haskell that brought the monadic interface to such prominence - that's why I've chosen I/O for the running example.</p>\n<p>Now, you can write <code>echo</code> in Haskell like this:</p>\n<pre><code>echoH :: IO ()\nechoH =  do c &lt;- getChar\n            if c == '\\n' then\n              return ()\n            else\n              putChar c &gt;&gt; echoH\n</code></pre>\n<p>or this:</p>\n<pre><code>echoH' :: IO ()\nechoH' =  getChar   &gt;&gt;= \\c -&gt;\n          if c == '\\n' then return () else\n          putChar c &gt;&gt; echoH'\n</code></pre>\n<p>but you <strong>cannot</strong> write this:</p>\n<pre><code>errcho    :: () -&gt; ()\nerrcho () =  let c = getc () in\n             if c == '\\n' then\n               ()\n             else\n               putc c ; errcho ()\n\n -- fake primitives!\n(;)  :: a -&gt; b -&gt; b\nputc :: Char -&gt; ()\ngetc :: ()   -&gt; Char\n</code></pre>\n<p>That ain't legit Haskell...but this <em>almost</em> is:</p>\n<pre><code>echo   :: OI -&gt; ()\necho u =  let !u1:u2:u3:_ = parts u in\n          let !c          = getchar u1 in\n          if c == '\\n' then () else putchar c u2 `seq` echo u3\n</code></pre>\n<p>where:</p>\n<pre><code>data OI             -- abstract\nparts :: OI -&gt; [OI] -- primitive\n\n -- I'll leave these definitions to you ;-)\nputchar :: Char -&gt; OI -&gt; ()\ngetchar :: OI -&gt; Char\n</code></pre>\n<ul>\n<li><p><a href=\"https://downloads.haskell.org/%7Eghc/7.8.4/docs/html/users_guide/bang-patterns.html\" rel=\"nofollow noreferrer\">Bang-patterns</a> are an extension of Haskell 2010;</p>\n</li>\n<li><p><code>Prelude.seq</code> <a href=\"https://stackoverflow.com/questions/61479290/why-is-the-strictness-introducing-function-called-seq\">isn't actually sequential</a> - you would need an alternate definition of <code>seq</code> e.g:</p>\n<pre><code>   -- for GHC 8.6.5\n  {-# LANGUAGE CPP #-}\n  #define during seq\n  import qualified Prelude(during)\n\n  {-# NOINLINE seq #-}\n  infixr  0 `seq`\n  seq     :: a -&gt; b -&gt; b\n  seq x y = Prelude.during x (case x of _ -&gt; y)\n</code></pre>\n<p>or:</p>\n<pre><code>   -- for GHC 8.6.5\n  {-# LANGUAGE CPP #-}\n  #define during seq\n  import qualified Prelude(during)\n  import GHC.Base(lazy)\n\n  infixr 0 `seq`\n  seq     :: a -&gt; b -&gt; b\n  seq x y = Prelude.during x (lazy y)\n</code></pre>\n<p>(Yes - more extensions are being used, but they stay with each definition.)</p>\n</li>\n</ul>\n<p>It's clunkier, but this is regular Haskell:</p>\n<pre><code>echo   :: OI -&gt; ()\necho u =  case parts u of\n            u1:u2:u3:_ -&gt; case getchar u1 of\n                            c -&gt; if c == '\\n' then () else\n                                 case putchar c u2 of () -&gt; echo u3\n</code></pre>\n<p>Yes, that's it: no passing of results to continuations, no bundling of results with some abstract state - just a plain ordinary result. All you need to do is provide an all-new <code>OI</code> value - what a novel concept!</p>\n<p>It almost seems too good to be true...what about referential transparency: is it preserved?</p>\n<p>Well, the way we're using these <code>OI</code> values is similar to the use of <em>timestamps</em> as described by F. Warren Burton in <a href=\"https://academic.oup.com/comjnl/article-pdf/31/3/243/1157325/310243.pdf\" rel=\"nofollow noreferrer\">Nondeterminism with Referential Transparency in Functional Programming Languages</a> - the main difference is that timestamps must first be retrieved from trees, whereas <code>OI</code> values can be used directly.</p>\n<p>Burton's timestamps maintain referential transparency by ensuring:</p>\n<ul>\n<li><p>the effects involved in determining a timestamp only occur once - upon its initial use;</p>\n</li>\n<li><p>once determined, a timestamp remains constant - it doesn't change, even if it's reused.</p>\n</li>\n</ul>\n<p>If <code>OI</code> values also work in this manner, then referential transparency is preserved.</p>\n<p>Yes, it's a bit arcane, but together with a <a href=\"https://stackoverflow.com/a/64047524/13679816\">suitable definition of</a> <code>seq</code>, <code>parts</code> and <a href=\"https://stackoverflow.com/a/64365219/13679816\">those curious</a> <code>OI</code> values can allow you to do neat stuff like this:</p>\n<pre><code>runDialogue :: Dialogue -&gt; OI -&gt; ()    \nrunDialogue d =\n    \\u -&gt; foldr seq () (yet (\\l -&gt; zipWith respond (d l) (parts u)))\n\nrespond :: Request -&gt; OI -&gt; Response\nrespond Getq     = getchar `bind` (unit . Getp)\nrespond (Putq c) = putchar c `bind` \\_ -&gt; unit Putp\n</code></pre>\n<p>where:</p>\n<pre><code> -- types from page 14 of Wadler's paper\ntype Dialogue = [Response] -&gt; [Request]\n\ndata Request  = Getq | Putq Char\ndata Response = Getp Char | Putp\n\nyet      :: (a -&gt; a) -&gt; a\nyet f    =  f (yet f)\n\nunit     :: a -&gt; (OI -&gt; a)\nunit x   =  \\u -&gt; part u `seq` x\n\nbind     :: (OI -&gt; a) -&gt; (a -&gt; (OI -&gt; b)) -&gt; (OI -&gt; b)\nbind m k =  \\u -&gt; case part u of (u1, u2) -&gt; (\\x -&gt; x `seq` k x u2) (m u1)\n\npart     :: OI -&gt; (OI, OI)\npart u   =  case parts u of u1:u2:_ -&gt; (u1, u2)\n</code></pre>\n<p>It isn't working? Give this a try:</p>\n<pre><code>yet      :: (a -&gt; a) -&gt; a\nyet f    =  y where y = f y\n</code></pre>\n<p>Yes, continually typing out <code>OI -&gt;</code> would be annoying, and if this approach to I/O is going to work, it has to work everywhere. The simplest solution is:</p>\n<pre><code>type IO a = OI -&gt; a\n</code></pre>\n<p>to avoid the hassle of wrapping and unwrapping involved with using constructors. The change of type also provides <code>main</code> with an alternate type signature:</p>\n<pre><code>main :: OI -&gt; ()\n</code></pre>\n<p>To conclude - for Haskell, monadic types are a <em>convenience</em></p>\n<pre><code>echo' :: OI -&gt; ()\necho' =  getchar   `bind` \\c -&gt;\n         if c == '\\n' then unit () else\n         putchar c `bind` \\_ -&gt; echo'\n</code></pre>\n<p>rather than being an absolute <em>necessity</em>.</p>\n"}], "owner": {"reputation": 19024, "user_id": 286335, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6882f075e155c96b4ff0fe3bcab951f3?s=128&d=identicon&r=PG&f=1", "display_name": "cibercitizen1", "link": "https://stackoverflow.com/users/286335/cibercitizen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53686, "favorite_count": 241, "protected_date": 1422900202, "accepted_answer_id": 28139260, "answer_count": 8, "score": 381, "last_activity_date": 1614182726, "creation_date": 1422206854, "last_edit_date": 1495541436, "question_id": 28139259, "link": "https://stackoverflow.com/questions/28139259/why-do-we-need-monads", "title": "Why do we need monads?", "body": "<p>In my humble opinion the answers to the famous question <a href=\"https://stackoverflow.com/questions/44965/what-is-a-monad\">\"What is a monad?\"</a>, especially the most voted ones, try to explain what is a monad without clearly explaining <em>why monads are really necessary</em>.  Can they be explained as the solution to a problem?</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 2, "last_activity_date": 1422358297, "last_edit_date": 1422358297, "creation_date": 1422203409, "answer_id": 28138647, "question_id": 28138575, "link": "https://stackoverflow.com/questions/28138575/haskell-tree-searching-through-tree/28138647#28138647", "title": "Haskell Tree - searching through tree", "body": "<p>The type of <code>(++)</code> is <code>[a] -&gt; [a] -&gt; [a]</code>, but the type of <code>x</code> is <code>a</code>. Thus you can write</p>\n\n<p><code>x : (findValue x l) ++ (findValue x r)</code>\n(which uses the \"cons\" operator <code>(:) :: a -&gt; [a] -&gt; [a]</code>), or</p>\n\n<pre><code>[x] ++ (findValue x l) ++ (findValue x r)\n</code></pre>\n\n<p>Here's how you should determine this yourself:</p>\n\n<p>The error says <code>Couldn't match exptected type '[a]' with actual type 'a' ...\nin the first argument of '(++)', namely 'x'</code></p>\n\n<p>This means that the argument <code>x</code> to <code>(++)</code> (on the line indicated) <em>should</em> have type <code>[a]</code> (that's the <em>expected</em> type), but actually has type <code>a</code> (the <em>inferred</em> type).</p>\n\n<p>Then you should look up the type signature for <code>(++)</code> to see what the problem might be (e.g. using <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">hoogle</a>, <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow\">hayoo</a>, or <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/ghci-commands.html#idp7292880\" rel=\"nofollow\">ghci</a>) In your case, the problem was that the types of the first and second arguments to <code>(++)</code> were not the same, but they should be.</p>\n"}, {"comments": [{"owner": {"reputation": 17, "user_id": 4304517, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f93e80af23c2b87dffac85c3008b0126?s=128&d=identicon&r=PG&f=1", "display_name": "redrenoir", "link": "https://stackoverflow.com/users/4304517/redrenoir"}, "edited": false, "score": 0, "creation_date": 1422204930, "post_id": 28138723, "comment_id": 44649290, "body": "Thank you for you answer! When I read &quot;Couldn&#39;t match expected type \u2018[a]\u2019 with actual type \u2018a\u2019&quot;, I thought &quot;Okay, somewhere is an element where there should be a list&quot;, I looked at my code, didn&#39;t find the error where he told me to &quot;In the first argument f &#39;(++)&#39;, namely &#39;x&#39;&quot;, because I thought &quot;But I said x==a, why is suddenly x wrong, It&#39;s getting concatenated into a list, so it is a list at the end, and not a bare element. Maybe I mixed it up elsewhere and now Haskell can&#39;t read my line. Maybe it&#39;s syntax. Oh man, I should ask, I have no clue.&quot;"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 2, "last_activity_date": 1422205274, "last_edit_date": 1422205274, "creation_date": 1422203812, "answer_id": 28138723, "question_id": 28138575, "link": "https://stackoverflow.com/questions/28138575/haskell-tree-searching-through-tree/28138723#28138723", "title": "Haskell Tree - searching through tree", "body": "<p>Think about what you are doing. <code>findValue</code> is of the type <code>a -&gt; MyTree a -&gt; [a]</code> which means that <code>x</code> is of the type <code>a</code>.</p>\n\n<p>However, the <code>(++)</code> operator is of the type <code>[a] -&gt; [a] -&gt; [a]</code>, but you are writing <code>x ++ (findValue x l) ++ (findValue x r)</code>. Hence it gives you an error saying:</p>\n\n<pre><code>Couldn't match expected type \u2018[a]\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for findValue :: a -&gt; MyTree a -&gt; [a]\n          at assignment.hs:10:14\n    Relevant bindings include\n      r :: MyTree a (bound at assignment.hs:12:25)\n      l :: MyTree a (bound at assignment.hs:12:23)\n      a :: a (bound at assignment.hs:12:21)\n      x :: a (bound at assignment.hs:12:11)\n      findValue :: a -&gt; MyTree a -&gt; [a]\n        (bound at assignment.hs:11:1)\n    In the first argument of \u2018(++)\u2019, namely \u2018x\u2019\n    In the expression: x ++ (findValue x l) ++ (findValue x r)\n</code></pre>\n\n<p>The error message clearly says that it <code>Couldn't match expected type \u2018[a]\u2019 with actual type \u2018a\u2019</code>. It further tells you where the problem is, <code>In the first argument of \u2018(++)\u2019, namely \u2018x\u2019</code>. It even tells you where to find that expression, <code>In the expression: x ++ (findValue x l) ++ (findValue x r)</code>.</p>\n\n<p>Haskell error messages might look very scary, but they are actually quite informative and easy to understand. Don't let phrases like <code>\u2018a\u2019 is a rigid type variable bound by</code> scare you.</p>\n\n<p>I understand that it's easy to give up when the second sentence you read is something you don't understand, and I understand that it's easier to post a question about it on SO. Do yourself a favor and don't. Learn how to understand error messages.</p>\n\n<p>Give a man a fish and he'll eat for one day. Teach a man to fish and he'll eat for his entire life.</p>\n\n<hr>\n\n<p>BTW, why do you need a <code>findValue</code> function of the type <code>a -&gt; MyTree a -&gt; [a]</code>? It would make more sense to have:</p>\n\n<pre><code>hasValue :: a -&gt; MyTree a -&gt; Bool\nhasValue x Leaf         = False\nhasValue x (Node a l r)\n    | a == x            = True\n    | otherwise         = findValue x l || findValue x r\n\nnumValue :: a -&gt; MyTree a -&gt; Int\nnumValue x Leaf         = 0\nnumValue x (Node a l r)\n    | a == x            = depth + 1\n    | otherwise         = depth\n    where depth = findValue x l + findValue x r\n</code></pre>\n\n<p>To me it doesn't make any sense to have a <code>findValue</code> function because given <code>findValue x t</code> the result is:</p>\n\n<ol>\n<li>Either an empty list or a non-empty list (<code>False</code> or <code>True</code> respectively). Hence <code>hasValue</code>.</li>\n<li><p>A list of only <code>x</code> values repeated, in which case only the length matters. Hence <code>numValue</code>.</p>\n\n<pre><code>findValue :: a -&gt; MyTree a -&gt; [a]\nfindValue x t = replicate (numValue x t) x\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 17, "user_id": 4304517, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f93e80af23c2b87dffac85c3008b0126?s=128&d=identicon&r=PG&f=1", "display_name": "redrenoir", "link": "https://stackoverflow.com/users/4304517/redrenoir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 28138647, "answer_count": 2, "score": 0, "last_activity_date": 1422358297, "creation_date": 1422202977, "last_edit_date": 1422203732, "question_id": 28138575, "link": "https://stackoverflow.com/questions/28138575/haskell-tree-searching-through-tree", "title": "Haskell Tree - searching through tree", "body": "<p>I'm having issues with my assignment: I'm trying to write a code that makes a list of all node-values I tell him to (for example, all nodes with the value 4 into a neat list).</p>\n\n<p>I wrote the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>findValue :: a -&gt; (MyTree a) -&gt; [a]\nfindValue x Leaf = []\nfindValue x (Node a l r)\n    |a == x = x++(findValue x l)++(findValue x r)\n    |a /= x = (findValue x l)++(findValue x r)\n</code></pre>\n\n<p>I had defined trees as follow:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyTree a = Leaf  | Node a (MyTree a) (MyTree a)\n</code></pre>\n\n<p>I get the following error-message:</p>\n\n<pre><code>Couldn't match expected type \u2018[a]\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for findValue :: a -&gt; MyTree a -&gt; [a]\n          at assignment.hs:10:14\n    Relevant bindings include\n      r :: MyTree a (bound at assignment.hs:12:25)\n      l :: MyTree a (bound at assignment.hs:12:23)\n      a :: a (bound at assignment.hs:12:21)\n      x :: a (bound at assignment.hs:12:11)\n      findValue :: a -&gt; MyTree a -&gt; [a]\n        (bound at assignment.hs:11:1)\n    In the first argument of \u2018(++)\u2019, namely \u2018x\u2019\n    In the expression: x ++ (findValue x l) ++ (findValue x r)\n</code></pre>\n\n<p>I would be very happy if someone explained the error message to me. Thanks in advance!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 1, "creation_date": 1422198920, "post_id": 28137932, "comment_id": 44647421, "body": "<code>.</code> is the function composition operator. <code>(f . g) x == f (g x)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422206508, "post_id": 28137932, "comment_id": 44649866, "body": "Why anyone would do this is beyond me. As well as being unreadable, it&#39;s also inefficient."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1422214009, "post_id": 28137932, "comment_id": 44652564, "body": "which one of the 2 is the inefficient one? I believe that the second one is a little bit more inefficient, but this was just as a curiosity. It makes sense now although :)"}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 1, "creation_date": 1422214027, "post_id": 28137979, "comment_id": 44652568, "body": "Thank you very much for the explanation :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 5, "last_activity_date": 1422199495, "last_edit_date": 1422199495, "creation_date": 1422199130, "answer_id": 28137979, "question_id": 28137932, "link": "https://stackoverflow.com/questions/28137932/foldr-lambda-representation-haskell/28137979#28137979", "title": "foldr lambda representation - Haskell", "body": "<p><code>(.)</code> is function composition operator, <code>(f . g) x = f (g x)</code>, so</p>\n\n<pre><code>    ((+) . aux . (\\(a,b,c) -&gt; c)) (a,b,c) d \n  = ((+) . aux) ((\\(a,b,c) -&gt; c) (a,b,c)) d \n  = ((+) . aux) c d\n  = (+) (aux c) d \n  = aux c + d\n</code></pre>\n\n<p>This means that for <code>(foldr ((+) . aux . (\\(a,b,c) -&gt; c)) 0 list)</code> to be a well-typed expression, we must have types <code>list :: [(a,b,c)]</code> and <code>aux :: Num t =&gt; c -&gt; t</code>; then the fold of a list  <code>[x1,x2,...,xn]</code> is equivalent to</p>\n\n<pre><code>aux3 x1 + (aux3 x2 + (... + (aux3 xn + 0) ...))\n  where\n     aux3 (a,b,c) = aux c\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 28137979, "answer_count": 1, "score": 1, "last_activity_date": 1422199495, "creation_date": 1422198763, "question_id": 28137932, "link": "https://stackoverflow.com/questions/28137932/foldr-lambda-representation-haskell", "title": "foldr lambda representation - Haskell", "body": "<p>I understand this representation:</p>\n\n<pre><code>(foldr(\\x acc -&gt; x+10*acc) 0 n)\n</code></pre>\n\n<p>But recently i've come across with this one that i have not seen yet:</p>\n\n<pre><code>(foldr ((+) . aux . (\\(a,b,c) -&gt; c)) 0 list)\n</code></pre>\n\n<p>A brief explanation would be more than welcome!</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 17, "last_activity_date": 1422218053, "creation_date": 1422218053, "answer_id": 28141148, "question_id": 28137838, "link": "https://stackoverflow.com/questions/28137838/creating-monadbasecontrol-instance-for-newtype/28141148#28141148", "title": "creating MonadBaseControl instance for newtype", "body": "<p><code>Foo</code> is neither a \"base\" monad, nor a monad transformer. <code>defaultLiftBaseWith</code> won't be helpful here, since you want the instance for <code>Foo</code> to be identical to the one for <code>ReaderT Int IO</code>. </p>\n\n<p>First, use GND to get the boring instances:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Control.Monad.Trans.Control\nimport Control.Monad.Base \nimport Control.Monad.Reader \nimport Control.Applicative\n\nnewtype Foo a = Foo { unFoo :: ReaderT Int IO a } \n  deriving (Monad, Applicative, Functor, MonadBase IO)\n</code></pre>\n\n<p>The instance for <code>MonadBaseControl IO</code> just removes the newtype, uses the functions from the <code>ReaderT</code> instance, and puts the result back in the newtype:</p>\n\n<pre><code>instance MonadBaseControl IO Foo where\n  type StM Foo a = a \n  liftBaseWith f = Foo $ liftBaseWith $ \\q -&gt; f (q . unFoo)\n  restoreM = Foo . restoreM \n</code></pre>\n\n<p>Note that if <code>StM</code> <em>wasn't</em> an associated type family, you could do something like</p>\n\n<pre><code>newtype Foo a = Foo { unFoo :: ReaderT Int IO a } \n  deriving (Monad, Applicative, Functor, MonadBase IO, MonadBaseControl IO)\n\ntype instance StM Foo a = a \n</code></pre>\n"}], "owner": {"reputation": 274, "user_id": 916967, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f8ed1b2ce4fc4c398413326dfdf6333f?s=128&d=identicon&r=PG", "display_name": "xyzzyz", "link": "https://stackoverflow.com/users/916967/xyzzyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 774, "favorite_count": 0, "accepted_answer_id": 28141148, "answer_count": 1, "score": 14, "last_activity_date": 1422218053, "creation_date": 1422198149, "question_id": 28137838, "link": "https://stackoverflow.com/questions/28137838/creating-monadbasecontrol-instance-for-newtype", "title": "creating MonadBaseControl instance for newtype", "body": "<p>Suppose I have simple newtype declaration</p>\n\n<pre><code>newtype Foo a = Foo { unFoo :: ReaderT Int IO a }\n</code></pre>\n\n<p>I want to make Foo instance of MonadBaseControl IO. It should be easy, since ReaderT Int IO is already an instance of MonadBaseControl IO. However, automatically deriving it using GeneralizedNewtypeDeriving doesn't work, because MonadBaseControl class has an associated type.</p>\n\n<p>How can one write a MonadBaseControl IO instance for Foo? defaultLiftBaseWith and defaultRestoreM should be helpful, but it's a bit hard to decipher their types.</p>\n"}, {"tags": ["scala", "haskell", "typeclass", "implicit", "existential-type"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422205838, "post_id": 28137713, "comment_id": 44649661, "body": "Is there a reason you rolled back my edits, so the Haskell code and its output are now highlighted as though they were Scala?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422206942, "post_id": 28137713, "comment_id": 44650043, "body": "sorry, didn&#39;t mean to offend... the text output was actually easier to comprehend before (and I think <code>where</code> and <code>True</code> wouldn&#39;t be highlighted if the first snippet weren&#39;t recognized as Haskell, no?)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422208373, "post_id": 28137713, "comment_id": 44650495, "body": "I changed it again to highlight the Haskell right, but left the output alone."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422210351, "post_id": 28137713, "comment_id": 44651210, "body": "just curious: what do you think it was automatically highlighting the Haskell snippet as before?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422210893, "post_id": 28137713, "comment_id": 44651397, "body": "It was highlighting it as Scala, it seems."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422214044, "post_id": 28137713, "comment_id": 44652576, "body": "but <code>where</code>, <code>True</code>, <code>data</code> and <code>instance</code> are not keywords in Scala, yet it was highlighting them... odd."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422217167, "post_id": 28137713, "comment_id": 44653656, "body": "I don&#39;t even know Scala. I just saw that it was highlighting <code>Obj</code> and <code>Show</code> the same in each. <code>Show</code> is a Prelude class in Haskell, which a highlighter could theoretically be stupid enough to care about, but <code>Obj</code> means nothing."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423487152, "post_id": 28137713, "comment_id": 45154370, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/7213676/forall-in-scala\">forall in Scala</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422198220, "post_id": 28137768, "comment_id": 44647247, "body": "thanks! just curious though: why is this not possible with <code>forSome</code> directly?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422199065, "post_id": 28137768, "comment_id": 44647458, "body": "as to your question:   <code>def apply[T](x: T)(implicit show: Show[T]) = { type T0 = T; val x0 = x; val show0 = show; new Obj { type T = T0; val x = x0; val show = show0 } }</code>"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422199215, "post_id": 28137768, "comment_id": 44647497, "body": "@ErikAllik, thanks! yet I&#39;m not sure which variant is uglier :)"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422199295, "post_id": 28137768, "comment_id": 44647523, "body": "yes, the internals are clunkier but the outside world sees a nicer interface :)"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422200739, "post_id": 28137768, "comment_id": 44647945, "body": "how about just <code>type ObjE = (T, Show[T]) forSome { type T }</code> then? and then how do I construct values of <code>ObjE</code> anyway?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422201176, "post_id": 28137768, "comment_id": 44648104, "body": "@ErikAllik, for that you cannot define <code>Show</code> instance (implicit val) easily, as there is <code>tuple2Show[A1, A2](implicit A1: Show[A1], A2: Show[A2]): Show[(A1, A2)]</code>. I&#39;m sure that without wrapper (in Haskell type vs. newtype) around, you&#39;ll run in other troubles sooner or later as well."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422201306, "post_id": 28137768, "comment_id": 44648140, "body": "just figured the same thing out on my own :) however, how do I define a <code>Show</code> for <code>ObjE</code> then? this doesn&#39;t work: <code>implicit val showObjE = Show.shows[ObjE] { x =&gt; x.pair._2.shows(x.pair._1) }</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422201799, "post_id": 28137768, "comment_id": 44648280, "body": "@ErikAllik seems that you have to make an immediate value. Amended the answer with <code>showObjE</code>"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1422202236, "post_id": 28137768, "comment_id": 44648427, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/69554/discussion-between-oleg-grenrus-and-erik-allik\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1422254711, "last_edit_date": 1495535611, "creation_date": 1422197736, "answer_id": 28137768, "question_id": 28137713, "link": "https://stackoverflow.com/questions/28137713/translate-encode-haskells-data-obj-forall-a-show-a-obj-a-in-scala/28137768#28137768", "title": "Translate/encode Haskell&#39;s `data Obj = forall a. (Show a) =&gt; Obj a` in Scala", "body": "<p>You got it almost right:</p>\n\n<pre><code>import scalaz._\nimport scalaz.Scalaz._\n\ntrait Obj {\n  type T // existential type\n  val x: T\n  implicit val show: Show[T]\n}\n\nimplicit val objSow: Show[Obj] = Show.shows[Obj] { (x: Obj) =&gt;\n  x.show.shows(x.x)\n}\n\nobject Obj {\n  /* \"constructor\" */\n  def apply[U](_x: U)(implicit _show: Show[U]): Obj = new Obj {\n    type T = U\n    val x = _x\n    val show = _show\n  }\n}\n\nval test: List[Obj] = List(Obj(1), Obj(true), Obj(\"foo\"))\n\n/*\nscala&gt; test.shows\nres0: String = [1,true,\"foo\"]\n*/\n</code></pre>\n\n<p>P.S I'd like to use <code>T</code> and <code>show</code> in <code>apply</code>; not <code>U</code> and <code>_show</code>. If someone knows how to avoid shadowing, I'll appreciate!</p>\n\n<hr>\n\n<p>Alternatively you could use <code>forSome</code>:</p>\n\n<pre><code>import scala.language.existentials\n\ntrait ObjE {\n  val pair: Tuple2[T, Show[T]] forSome { type T }\n}\n\n/* And to define Show instance we have to help compiler unify `T` in pair components. */\ndef showDepPair[T] = Show.shows[Tuple2[T, Show[T]]] { x =&gt; x._2.shows(x._1) }\nimplicit val showObjE = Show.shows[ObjE] { x =&gt; showDepPair.shows(x.pair) }\n</code></pre>\n\n<p>Here we have to use <code>Tuple2</code> (or other auxillary type) to capture <code>Show</code>. I like the previous variant more. For me it's easier to wrap a mind around a type member.</p>\n\n<p>Also in <a href=\"http://www.scala-lang.org/news/roadmap-next#scala_don_giovanni\" rel=\"nofollow noreferrer\">Scala \"Don Giovanni\"</a> <code>forSome</code> syntax will be eliminated in favour of <code>val pair: ({ type \u03bb[T] = Tuple2[T, Show[T]] })#\u03bb[_] }</code>, which works already too. I hope there will be some syntax support for <a href=\"https://stackoverflow.com/questions/8736164/what-are-type-lambdas-in-scala-and-what-are-their-benefits\">type lambdas</a> as well. <a href=\"https://github.com/non/kind-projector\" rel=\"nofollow noreferrer\">kind-projector</a> doesn't help in this situation (repeated use of <code>T</code>). Maybe something like in <a href=\"https://github.com/typelevel/scala/wiki/Differences#type-lambdas\" rel=\"nofollow noreferrer\"><em>Typelevel</em> <code>scalac</code></a>: <code>val pair: ([T] =&gt; Tuple2[T, Show[T])[_])</code>.</p>\n\n<p>Another foundational change will be:</p>\n\n<blockquote>\n  <p>A single fundamental concept &ndash; type members &ndash; can give a precise meaning to generics, existential types, wildcards, and higher-kinded types.</p>\n</blockquote>\n\n<p>So the both forms will be equivalent from the point of view of the compiler (in former we unpack the tuple). <em>I'm not 100% sure what are the differences currently, if there are any</em>.</p>\n\n<p>P.S. <a href=\"http://www.infoq.com/presentations/data-types-issues#\" rel=\"nofollow noreferrer\">The Troubles with Types</a> helped me understand scala's current type system quirks.</p>\n"}, {"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 0, "last_activity_date": 1422229626, "last_edit_date": 1422229626, "creation_date": 1422228802, "answer_id": 28142861, "question_id": 28137713, "link": "https://stackoverflow.com/questions/28137713/translate-encode-haskells-data-obj-forall-a-show-a-obj-a-in-scala/28142861#28142861", "title": "Translate/encode Haskell&#39;s `data Obj = forall a. (Show a) =&gt; Obj a` in Scala", "body": "<p>I've \"packaged\" Oleg's answer into this generic and (seemingly) reusable structure:</p>\n\n<pre><code>import scala.language.{ higherKinds, implicitConversions }\n\ntrait AnyWithTC[TC[_]] { type T; val x: T; implicit val ev: TC[T] }\n\n// don't like the 'implicit' here; suggestions welcome\nimplicit def AnyWithTC[T, TC[_]](x: T)(implicit ev: TC[T]) = {\n  type T0 = T; val x0 = x; val ev0 = ev\n  new AnyWithTC[TC] { type T = T0; val x = x0; val ev = ev0 }\n}\n</code></pre>\n\n<p>then, <code>data Obj = forall a. (Show a) =&gt; Obj a</code> can be implemented like this:</p>\n\n<pre><code>type Obj = AnyWithTC[Show]\nimplicit val objShow = Show.shows[Obj] { x =&gt; \"Obj \" + x.show.shows(x.x)   }\nval xs: List[Obj] = List(1, true, \"hello\")\nprintln(xs.shows) // prints [Obj 1,Obj true, Obj hello]\n</code></pre>\n"}], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 2, "accepted_answer_id": 28137768, "answer_count": 2, "score": 1, "last_activity_date": 1422254711, "creation_date": 1422197394, "last_edit_date": 1422208300, "question_id": 28137713, "link": "https://stackoverflow.com/questions/28137713/translate-encode-haskells-data-obj-forall-a-show-a-obj-a-in-scala", "title": "Translate/encode Haskell&#39;s `data Obj = forall a. (Show a) =&gt; Obj a` in Scala", "body": "<p>I've not been able to come up with how to encode <code>Obj</code> in Scala:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Obj = forall a. (Show a) =&gt; Obj a\n\ninstance Show Obj where show (Obj a) = \"Obj \" ++ show a\n\nmain = print $ show [Obj \"hello\", Obj 3, Obj True]\n</code></pre>\n\n<p>when run, the above produces the following output:</p>\n\n<pre><code>[Obj \"hello\",Obj 3,Obj True]\n</code></pre>\n\n<p>In Scala, however, this does not seem to compile:</p>\n\n<pre><code>forSome { type T; implicit val ev: Show[T] }\n</code></pre>\n\n<p>and neither does this:</p>\n\n<pre><code>forSome { type T : Show[T] }\n</code></pre>\n\n<p>Is this even possible at the type system level, or do I need to \"capture\" the type class instance using something like this:</p>\n\n<pre><code>class Obj[T](val x: T)(implicit val: Show[T])  // ...or similar\n</code></pre>\n\n<p>Any insight would be appreciated!</p>\n"}, {"tags": ["haskell", "cabal", "agda"], "answers": [{"tags": [], "owner": {"reputation": 1066, "user_id": 1709190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/312687fd46a3b2a21bb469c2244c0668?s=128&d=identicon&r=PG", "display_name": "asr", "link": "https://stackoverflow.com/users/1709190/asr"}, "is_accepted": false, "score": 1, "last_activity_date": 1422192213, "last_edit_date": 1422192213, "creation_date": 1422191638, "answer_id": 28136796, "question_id": 28135554, "link": "https://stackoverflow.com/questions/28135554/problems-with-cabal-when-installing-agda/28136796#28136796", "title": "Problems with Cabal when installing Agda", "body": "<p>The path <code>~/Library/Haskell/bin</code> should be the first one in the list of your paths.</p>\n"}], "owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1422192213, "creation_date": 1422183118, "question_id": 28135554, "link": "https://stackoverflow.com/questions/28135554/problems-with-cabal-when-installing-agda", "title": "Problems with Cabal when installing Agda", "body": "<p>Im trying to get Agda working following <a href=\"http://williamdemeo.github.io/2014/02/27/learn-you-an-agda/\" rel=\"nofollow\">this turtorial</a>. However when I type <code>cabal install agda</code> I get an error saying I have the wrong version of alex installed, I then use <code>cabal install alex</code> and after alex is installed I checks so that <code>alex -v</code> gives me the correct version which it does. I then try to run <code>cabal install agda</code> again but still it is complaining about wrong version of alex. I then put the exact path to alex on my path which is:</p>\n\n<pre><code>/Users/me/Library/Haskell/ghc-7.6.3/lib/alex-3.1.4/bin\n</code></pre>\n\n<p>This works and fixes the problem for alex but now <code>cabal install agda</code> need the correct version of cpph.</p>\n\n<p>So my questions is why do i need to put ever package directly on my systems path for cabal to find the latest version? Why can it not use the following path which has all the correct symlinks and is also on my systems path:</p>\n\n<pre><code>~/Library/Haskell/bin:\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "persistent"], "comments": [{"owner": {"reputation": 815, "user_id": 439699, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92cef6f8c3bf4c7670c4dfffb2c046d4?s=128&d=identicon&r=PG", "display_name": "ace", "link": "https://stackoverflow.com/users/439699/ace"}, "edited": false, "score": 0, "creation_date": 1439819804, "post_id": 28135414, "comment_id": 52003653, "body": "Do you think it would make sense just to manually define the fields like <a href=\"http://stackoverflow.com/q/14097615/439699\">this</a>?"}, {"owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "reply_to_user": {"reputation": 815, "user_id": 439699, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92cef6f8c3bf4c7670c4dfffb2c046d4?s=128&d=identicon&r=PG", "display_name": "ace", "link": "https://stackoverflow.com/users/439699/ace"}, "edited": false, "score": 0, "creation_date": 1439848508, "post_id": 28135414, "comment_id": 52019462, "body": "@ace Sure, you could manually generate all the code which <code>mkPersist</code> generates for you. I posted this question originally, because I didn&#39;t find a place where it was well documented how to do that. However, as it turned out I actually needed extra columns in the table anyway. So, marshalling between two types turned out to be a good solution in my case."}], "answers": [{"comments": [{"owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "edited": false, "score": 0, "creation_date": 1424781763, "post_id": 28690597, "comment_id": 45682529, "body": "Thanks for your answer. Unfortunately, that&#39;s not exactly what I&#39;m looking for. <code>derivePersistField</code> will generate a type for a <i>column</i> of a table. However, I need a type for a <i>whole table</i>. The way I solved it in my case was to generate a new type like <code>PlayerEntry</code> above and then manually marshal between <code>Player</code> and <code>PlayerEntry</code>. For some of the fields within my type I used <code>derivePersistField</code> to generate the corresponding columns. I guess I should write this up in an answer here."}, {"owner": {"reputation": 815, "user_id": 439699, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92cef6f8c3bf4c7670c4dfffb2c046d4?s=128&d=identicon&r=PG", "display_name": "ace", "link": "https://stackoverflow.com/users/439699/ace"}, "reply_to_user": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "edited": false, "score": 0, "creation_date": 1439819447, "post_id": 28690597, "comment_id": 52003430, "body": "I would like to see how you did it @Lemming.  I&#39;m also trying to find a good solution for this issue and strongly considering moving away from persistent because of this."}, {"owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "reply_to_user": {"reputation": 815, "user_id": 439699, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92cef6f8c3bf4c7670c4dfffb2c046d4?s=128&d=identicon&r=PG", "display_name": "ace", "link": "https://stackoverflow.com/users/439699/ace"}, "edited": false, "score": 0, "creation_date": 1439848409, "post_id": 28690597, "comment_id": 52019418, "body": "@ace As requested, I added my solution."}], "tags": [], "owner": {"reputation": 766, "user_id": 490889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c100767232ba66deb47016e6fc65012?s=128&d=identicon&r=PG", "display_name": "Erik de Castro Lopo", "link": "https://stackoverflow.com/users/490889/erik-de-castro-lopo"}, "is_accepted": false, "score": 3, "last_activity_date": 1424764620, "last_edit_date": 1424764620, "creation_date": 1424764235, "answer_id": 28690597, "question_id": 28135414, "link": "https://stackoverflow.com/questions/28135414/store-existing-data-type-with-yesods-persistent/28690597#28690597", "title": "Store existing data-type with Yesod&#39;s Persistent", "body": "<p>From: <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow\">http://www.yesodweb.com/book/persistent</a></p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nmodule Employment where\n\nimport Database.Persist.TH\n\ndata Employment = Employed | Unemployed | Retired\n    deriving (Show, Read, Eq)\nderivePersistField \"Employment\"\n</code></pre>\n\n<p>The <code>derivePersistField</code> function is the template Haskell magic that makes it work.</p>\n\n<p>Note, you need to do the <code>derivePersistField</code> thing in a separate file to where you do the <code>mkPersist</code> to avoid a TH phase error.</p>\n"}, {"tags": [], "owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "is_accepted": true, "score": 1, "last_activity_date": 1439848346, "creation_date": 1439848346, "answer_id": 32060307, "question_id": 28135414, "link": "https://stackoverflow.com/questions/28135414/store-existing-data-type-with-yesods-persistent/32060307#32060307", "title": "Store existing data-type with Yesod&#39;s Persistent", "body": "<p>My solution to this problem was to add a new type through Yesod's <code>mkPersist</code>, and manually marshal between those.</p>\n\n<p><code>config/models</code>:</p>\n\n<pre><code>PlayerEntry\n    name Text\n    points Int\n    created UTCTime default=CURRENT_TIMESTAMP\n</code></pre>\n\n<p><code>Marshalling.hs</code>:</p>\n\n<pre><code>fromPlayerEntry :: PlayerEntry -&gt; Player\nfromPlayerEntry PlayerEntry {..} = Player { name = playerName\n                                          , points = playerPoints\n                                          }\n\ncreatePlayerEntry :: Text -&gt; YesodDB App (Entity PlayerEntry)\ncreatePlayerEntry name = do\n    currentTime &lt;- liftIO getCurrentTime\n    let player = PlayerEntry { playerName = name\n                             , playerPoints = 0\n                             , playerCreated = currentTime\n                             }\n    playerId &lt;- insert player\n    return $ Entity playerId player\n\nupdatePlayerEntry :: PlayerEntryId -&gt; Player -&gt; YesodDB App ()\nupdatePlayerEntry playerId Player {..} =\n    update playerId [ PlayerName =. name\n                    , PlayerPoints =. points\n                    ]\n</code></pre>\n\n<p>One possible advantage is that you can have fields in your table, that are not required in the internal record. In my example, it was useful to attach a creation date to the player. However, this was only used in the web-interface layer, it was never used in the internal game logic, which defined the <code>Player</code> type. However, due to the manual marshalling I could add that field to the same database table nonetheless.</p>\n"}], "owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 922, "favorite_count": 3, "accepted_answer_id": 32060307, "answer_count": 2, "score": 9, "last_activity_date": 1439848346, "creation_date": 1422181987, "question_id": 28135414, "link": "https://stackoverflow.com/questions/28135414/store-existing-data-type-with-yesods-persistent", "title": "Store existing data-type with Yesod&#39;s Persistent", "body": "<p>All the tutorials and references that I could find about Persistent describe in great detail how Persistent can automatically create a new data-type, schema, migration, etc. out of a single definition in its DSL. However, I couldn't find an explanation on how to get Persistent to handle already existing data-types.</p>\n\n<p><strong>An example:</strong> Suppose I have an already existing Haskell module for some game logic. It includes a record type for a player. (It's meant to be used through lenses, hence the underscores.)</p>\n\n<pre><code>data Player = Player { _name   :: String\n                     , _points :: Int\n                     -- more fields ...\n                     }\n$(makeLenses ''Player)\n</code></pre>\n\n<p><strong>Question:</strong> What's the canonical way to store such a type in a data-base with Persistent? Is there some type-class that I can implement. Or should I best define a new type through Persistent, e.g.</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPlayerEntry\n    name Text\n    points Int\n|]\n</code></pre>\n\n<p>and then manually map between these types?</p>\n\n<pre><code>playerToEntry :: Player -&gt; PlayerEntry\nplayerToEntry pl = PlayerEntry (pl^.name) (pl^.points)\n\nentryToPlayer :: PlayerEntry -&gt; Player\nentryToPlayer e = Player (name e) (points e)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1422213124, "post_id": 28135406, "comment_id": 44652227, "body": "It&#39;s <i>absurd</i> to try to close a question with a problem domain of just 16 (very simple) possible total functions under the close reason &quot;too broad&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1422217479, "post_id": 28135406, "comment_id": 44653760, "body": "@AndrewC, I think it likely that people are choosing to close based on reasoning that does not relate to the narrow rules of the help center. The OP would probably be better off visiting the teacher during office hours than asking strangers online."}], "answers": [{"tags": [], "owner": {"reputation": 3120, "user_id": 4402721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WCNcL.jpg?s=128&g=1", "display_name": "drRobertz", "link": "https://stackoverflow.com/users/4402721/drrobertz"}, "is_accepted": false, "score": 3, "last_activity_date": 1422217762, "last_edit_date": 1422217762, "creation_date": 1422183340, "answer_id": 28135585, "question_id": 28135406, "link": "https://stackoverflow.com/questions/28135406/finding-logical-connective-corresponding-to-given-fun-bool-bool-bool/28135585#28135585", "title": "Finding logical connective corresponding to given fun :: Bool -&gt; Bool -&gt; Bool", "body": "<p>The question is to match logical operations to functions implementing them.\nOne method is simply comparing the truth table for the logical connectives to\nthat of the functions.</p>\n\n<p>For instance, AND:</p>\n\n<pre><code>x    y    x AND y\n-----------------\nF    F       F\nF    T       F\nT    F       F\nT    T       T\n</code></pre>\n\n<p>matches</p>\n\n<pre><code>funA x True = x \nfunA _ _ = False \n</code></pre>\n\n<p>as</p>\n\n<pre><code>x    y      funA x y\n-------------------------\nF    F         F\nF    T         x == False\nT    F         F\nT    T         x == True\n</code></pre>\n\n<p>and similarly for the rest.</p>\n\n<p>Another option is to observe that <code>x AND y</code> is true iff <code>x</code> is true and <code>y</code> is true, and see which function satisfies that.</p>\n"}], "owner": {"reputation": 21, "user_id": 4338815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4ac72a9ecc92873b56900bf7963477a?s=128&d=identicon&r=PG&f=1", "display_name": "Washington Katemauswa", "link": "https://stackoverflow.com/users/4338815/washington-katemauswa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1422217762, "creation_date": 1422181946, "last_edit_date": 1422213232, "question_id": 28135406, "link": "https://stackoverflow.com/questions/28135406/finding-logical-connective-corresponding-to-given-fun-bool-bool-bool", "title": "Finding logical connective corresponding to given fun :: Bool -&gt; Bool -&gt; Bool", "body": "<p>The following questions appear in a mock exam and i cannot understand how the answers came about.\nAnyone care to derive a method of calculating the answer as a similar set of questions will appear in an exam tomorrow.</p>\n\n<p>Match each function definition with the logical operation it implements \nQuestion    Correct Match   Selected Match</p>\n\n<pre><code>funA x True = x\nfunA _ _    = False\n-- Correct A.   Logical AND\n\n\nfunB x False = x\nfunB x True  = not x\n-- Correct B.   Exclusive OR\n\n\nfunC False _ = True\nfunC True x  = x\n-- Correct C. Logical IMPLICATION\n\nfunD x False = x\nfunD _ True  = True\n-- Correct D.  Logical (Inclusive) OR\n\n\nfunE x True  = x\nfunE x False = not x\n-- Correct E.   Logical EQUIVALENCE\n</code></pre>\n"}, {"tags": ["haskell", "wxhaskell", "wxnotebook"], "answers": [{"tags": [], "owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "is_accepted": false, "score": 1, "last_activity_date": 1447446192, "last_edit_date": 1447446192, "creation_date": 1446732104, "answer_id": 33546547, "question_id": 28134804, "link": "https://stackoverflow.com/questions/28134804/how-to-get-the-newly-selected-page-index-upon-a-notebook-changed-page-event-with/33546547#33546547", "title": "How to get the newly selected page index upon a notebook changed page event with wxHaskell?", "body": "<p>This strange looking code works for me. I found it on a japanese (?) blog. Unfortunately I don't have the link anymore..</p>\n\n<pre><code>import Graphics.UI.WX\nimport Graphics.UI.WXCore\n\nimport Foreign.Marshal.Alloc\nimport Foreign.Storable\nimport Foreign.Ptr\nimport Foreign.C.Types\n\nimport System.IO.Unsafe\n\nmain :: IO ()\nmain = start gui\n\ngui :: IO ()\ngui = do\n    f  &lt;- frame []\n    nb &lt;- notebook f []\n    p1 &lt;- panel nb []\n    b1 &lt;- button p1 [text := \"*\"]\n    p2 &lt;- panel nb []\n    b2 &lt;- button p2 [text := \"!\"]\n\n    set nb [on click := (\\pt -&gt; onMouse nb pt &gt;&gt;= print)]\n    set f [ layout := tabs nb [ tab \"p1\" $ container p1 $ widget b1\n                              , tab \"p2\" $ container p2 $ widget b2]]\n\n\nonMouse :: Notebook() -&gt; Point -&gt; IO Int\nonMouse nb p = propagateEvent &gt;&gt; notebookHitTest nb p flag\n\n\n{-# NOINLINE flag #-}\nflag :: Ptr CInt\nflag  =  unsafePerformIO flag'\n  where flag' = do\n             work &lt;- malloc::IO (Ptr CInt)\n             poke work (fromIntegral wxBK_HITTEST_ONPAGE)\n             return work\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4491490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1024ebd50287f235544a421cbf4a696?s=128&d=identicon&r=PG&f=1", "display_name": "basil85", "link": "https://stackoverflow.com/users/4491490/basil85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1447446192, "creation_date": 1422176359, "question_id": 28134804, "link": "https://stackoverflow.com/questions/28134804/how-to-get-the-newly-selected-page-index-upon-a-notebook-changed-page-event-with", "title": "How to get the newly selected page index upon a notebook changed page event with wxHaskell?", "body": "<p>Below is a Haskell program which launches a wxHaskell notebook.</p>\n\n<p>It works, except that  I cannot manage to handle a page change event so as to get the index of the <em>newly</em> selected page. I get the previous one instead (see comment \"PROBLEM\" in the code below). </p>\n\n<p>There is a warning about this behaviour in the <a href=\"http://docs.wxwidgets.org/trunk/classwx_notebook.html#afe7ff049cb2b00bfcc7b55e31ea0f15e\" rel=\"nofollow\">C wxNotebook Class Reference documentation</a> (see section on getSelection) as well as in the \"Detailed Description\" section of the  <a href=\"http://docs.wxwidgets.org/trunk/classwx_book_ctrl_event.html#af2721f1f6e9d6e5b83612f03ef36c4b5\" rel=\"nofollow\">wxBookCtrlEvent Class Reference documetnation</a> but I do not understand at all how to make use of it. </p>\n\n<p>Could anyone please show me some working code for a notebook where one gets the  new page index when a new page is selected by the user (by clicking on its title)?</p>\n\n<p>A secondary question: I do not understand what the argument 0 is next to --???.</p>\n\n<p>Thank you in advance!</p>\n\n<pre><code>module Main where\n\nimport Graphics.UI.WX \nimport Graphics.UI.WXCore \n\nmain :: IO ()\nmain = \n   start $\n    do \n\n    f &lt;- frame []\n    nbk &lt;- notebook f []\n\n    pages &lt;- sequence [ do\n                        p &lt;- panel nbk []\n                        return $ tab (\"Page \"++show i) (container p $ label (\"Page \" ++ show i))\n                    | i &lt;- [0..3]]\n\n    set f [layout :=  fill $ tabs nbk pages,clientSize := sz 300 100]\n\n\n\n    let h event = case event of \n                    wxEVT_COMMAND_NOTEBOOK_PAGE_CHANGED -&gt; \n                        do\n                        i &lt;- notebookGetSelection nbk -- PROBLEM: gives the OLD index\n                        infoDialog f \"Event otification\" $ \"Notebook selected page: \" ++ show i\n                        propagateEvent\n\n    windowOnEvent nbk \n                  [wxEVT_COMMAND_NOTEBOOK_PAGE_CHANGED]\n                  0 -- ???\n                  h\n</code></pre>\n"}, {"tags": ["haskell", "intellij-idea", "sdk", "ghc"], "comments": [{"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 2, "creation_date": 1422458361, "post_id": 28134667, "comment_id": 44758292, "body": "I&#39;ve made it work by (1) creating a link <b>$ ln -s /usr/bin/ghci /usr/lib/ghc-7.8.4/bin/ghci</b> (2) placing GHC SDK location at <b>/usr</b> (<a href=\"https://github.com/Atsky/haskell-idea-plugin/issues/58\" rel=\"nofollow noreferrer\">github.com/Atsky/haskell-idea-plugin/issues/58</a>). This looks inelegant, to say the least."}], "answers": [{"comments": [{"owner": {"reputation": 1872, "user_id": 1833261, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/9gFOp.jpg?s=128&g=1", "display_name": "moshe beeri", "link": "https://stackoverflow.com/users/1833261/moshe-beeri"}, "edited": false, "score": 0, "creation_date": 1485379674, "post_id": 41817165, "comment_id": 70907690, "body": "mv /usr/lib/ghc/bin/ghc /usr/lib/ghc/bin/ghc_old"}, {"owner": {"reputation": 1872, "user_id": 1833261, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/9gFOp.jpg?s=128&g=1", "display_name": "moshe beeri", "link": "https://stackoverflow.com/users/1833261/moshe-beeri"}, "edited": false, "score": 0, "creation_date": 1485379683, "post_id": 41817165, "comment_id": 70907695, "body": "ln -s /opt/ghc/7.10.3/bin/ghc /usr/lib/ghc/bin/ghc"}], "tags": [], "owner": {"reputation": 1872, "user_id": 1833261, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/9gFOp.jpg?s=128&g=1", "display_name": "moshe beeri", "link": "https://stackoverflow.com/users/1833261/moshe-beeri"}, "is_accepted": false, "score": -1, "last_activity_date": 1485212116, "creation_date": 1485212116, "answer_id": 41817165, "question_id": 28134667, "link": "https://stackoverflow.com/questions/28134667/configure-haskell-sdk-for-the-haskell-intellij-plug-in/41817165#41817165", "title": "Configure Haskell SDK for the Haskell IntelliJ plug-in", "body": "<p>install Haskell stack.</p>\n\n<p>in case you run on Ubuntu do:</p>\n\n<p>curl -sSL <a href=\"https://get.haskellstack.org/\" rel=\"nofollow noreferrer\">https://get.haskellstack.org/</a> | sh</p>\n\n<p>On my System Stack has been installed to: /usr/local/bin/stack</p>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4634, "favorite_count": 0, "answer_count": 1, "score": 12, "last_activity_date": 1487859683, "creation_date": 1422175143, "last_edit_date": 1487859683, "question_id": 28134667, "link": "https://stackoverflow.com/questions/28134667/configure-haskell-sdk-for-the-haskell-intellij-plug-in", "title": "Configure Haskell SDK for the Haskell IntelliJ plug-in", "body": "<p>I'm trying to start <code>Tools -&gt; Start Haskell REPL</code>, but I'm getting this error:</p>\n\n<blockquote>\n  <p>Error: Cannot run program \"/usr/lib/ghc-7.8.4/bin/ghci\" (in directory ...): error=2, No such file or directory</p>\n</blockquote>\n\n<p>Which looks legitimate, as <code>ghci</code> resides elsewhere:</p>\n\n<pre><code>$ locate ghci\n/usr/bin/ghci\n/usr/bin/ghci-7.8.4\n/usr/lib/ghc-7.8.4/ghci-usage.txt\n...\n</code></pre>\n\n<p>(Haskell installed from the dedicated repository, Archlinux). Unfortunately, I've been given no leeway concerning Haskell SDK location. </p>\n\n<blockquote>\n  <p><code>Project Structure -&gt; Project SDK -&gt; GHC -&gt; Select Home Directory for GHC</code> </p>\n</blockquote>\n\n<p>forces <code>/usr/lib/ghc-7.8.4</code> choice on me.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 0, "creation_date": 1422201212, "post_id": 28134433, "comment_id": 44648112, "body": "That relationship between typeclasses and rank-2 types is pretty cool; I&#39;d never thought of it before. I can see that supporting higher ranked types probably leads you into needing to build a theorem prover for general first order logic, which seems very hard to get practical results and undecidable in general. Is that necessary though to fully support typeclasses? How does Djinn currently deal with typeclasses and could it be extended?"}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 0, "creation_date": 1422306650, "post_id": 28134433, "comment_id": 44688882, "body": "Or to state my follow-up question more clearly, it seems clear that being able to deal with rank-2 types is sufficient to deal with typeclasses but is it necessary?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 1, "creation_date": 1422308575, "post_id": 28134433, "comment_id": 44689917, "body": "@badcook I think it wouldn&#39;t be hard to turn a Djinn that deals with typeclasses correctly into a Djinn that handles rank-2 types by generating a fresh typeclass for the function arguments that make the type rank-2. Of course, the devil is in the details, and I haven&#39;t worked out the details, so I don&#39;t know for sure."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1422173019, "creation_date": 1422173019, "answer_id": 28134433, "question_id": 28134149, "link": "https://stackoverflow.com/questions/28134149/why-does-djinn-fail-to-realize-common-monadic-functions/28134433#28134433", "title": "Why does Djinn fail to realize common monadic functions?", "body": "<p>Supporting type classes properly looks a lot like supporting rank-2 types; compare:</p>\n\n<pre><code>join :: Monad m\n     =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>join :: (forall a. a -&gt; m a)\n     -&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)\n     -&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>Unfortunately, the techniques Djinn uses don't handle rank-2 types at all. If you float the foralls so that Djinn can process it, suddenly what you get instead are <em>concrete</em> choices:</p>\n\n<pre><code>join :: (b -&gt; m b)\n     -&gt; (m c -&gt; (c -&gt; m d) -&gt; m d)\n     -&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>which looks a lot less like you could implement it! If you tell Djinn which instantiations to use, it does a lot better, of course.</p>\n\n<pre><code>join :: (b -&gt; m b)\n     -&gt; (m (m a) -&gt; (m a -&gt; m a) -&gt; m a)\n     -&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>For this one, Djinn will give the right implementation. ...but then, that's cheating.</p>\n"}], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 3, "accepted_answer_id": 28134433, "answer_count": 1, "score": 11, "last_activity_date": 1422173019, "creation_date": 1422170085, "last_edit_date": 1422172432, "question_id": 28134149, "link": "https://stackoverflow.com/questions/28134149/why-does-djinn-fail-to-realize-common-monadic-functions", "title": "Why does Djinn fail to realize common monadic functions?", "body": "<p>I recently stumbled across <a href=\"https://hackage.haskell.org/package/djinn\">Djinn</a> and was briefly playing around with it to try to see whether it would be useful in my everyday coding workflow. I was excited to see that Djinn had monads and tried to see whether it might be able to find some cool functions.</p>\n\n<p>Djinn did in fact work some wonders. The type signature of the initially (at least to me) unintuitive function <code>&gt;&gt;= (&gt;&gt;=)</code> is <code>Monad m =&gt; ((a -&gt; m b) -&gt; m a) -&gt; (a -&gt; m b) -&gt; m b</code>. Djinn was able to immediately demystify this by stating </p>\n\n<pre><code>Djinn&gt; f ? Monad m =&gt; ((a -&gt; m b) -&gt; m a) -&gt; (a -&gt; m b) -&gt; m b\nf :: (Monad m) =&gt; ((a -&gt; m b) -&gt; m a) -&gt; (a -&gt; m b) -&gt; m b\nf a b = a b &gt;&gt;= b\n</code></pre>\n\n<p>Unfortunately, Djinn can't seem to find other standard functions on monads, despite knowing about the Monad typeclass.</p>\n\n<ul>\n<li><p><code>join</code> (which should be <code>join = (&gt;&gt;= id)</code> or in Djinn's more verbose syntax <code>join a = a &gt;&gt;= (\\x -&gt; x)</code>)</p>\n\n<pre><code>Djinn&gt; join ? Monad m =&gt; m (m a) -&gt; m a\n-- join cannot be realized.\n</code></pre></li>\n<li><p><code>liftM</code> (which should be <code>liftM f = (&gt;&gt;= (return . f))</code> or in Djinn's more verbose syntax <code>liftM a b = b &gt;&gt;= (\\x -&gt; return (a x))</code>)</p>\n\n<pre><code>Djinn&gt; liftM ? Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b\n-- liftM cannot be realized.\n</code></pre></li>\n<li><p>Even the basic <code>return :: Monad m =&gt; m a -&gt; m (m a)</code> cannot be found by Djinn or <code>return :: Monad m =&gt; (a, b) -&gt; m (a, b)</code>.</p>\n\n<pre><code>Djinn&gt; f ? Monad m =&gt; (a, b) -&gt; m (a, b)\n-- f cannot be realized.\n</code></pre></li>\n</ul>\n\n<p>Djinn knows how to use <code>\\</code> to construct anonymous functions so why is this the case?</p>\n\n<p>My rough suspicion is that perhaps Djinn has a simplistic notion of typeclass and somehow treats <code>m a</code> as \"fixed\" so that <code>m (a, b)</code> is not seen as a case of <code>m a</code>, but I have no idea how to make that any more concrete than its current hand-wavy form or whether that intuition is correct.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1422159569, "post_id": 28133136, "comment_id": 44638876, "body": "@dfeuer Okay, I&#39;ve taken the useless modifier out and replaced it with something precise."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422159784, "post_id": 28133136, "comment_id": 44638920, "body": "Less pathologically, look at the difference between the <code>&lt;*&gt;</code> definitions in <code>Data.Sequence</code> in <a href=\"http://hackage.haskell.org/package/containers-0.5.6.0/docs/src/Data-Sequence.html\" rel=\"nofollow noreferrer\">containers-0.5.6.0</a> vs. <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/src/Data-Sequence.html\" rel=\"nofollow noreferrer\">containers-0.5.6.3</a>. That was a lot of fun."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1422169625, "last_edit_date": 1422169625, "creation_date": 1422159083, "answer_id": 28133136, "question_id": 28132712, "link": "https://stackoverflow.com/questions/28132712/is-equivalent-to-the-following-with-respect-to-parsec/28133136#28133136", "title": "is &lt;* equivalent to the following with respect to parsec?", "body": "<p>Generally, when a type has instances of both <code>Applicative</code> and <code>Monad</code>, it is considered polite for those instances to agree in the way you suggest, at least semantically. In some instances the <code>Applicative</code> version may be more efficient (in some cases even asymptotically so!), though for parsec at least this is not the case; from the source:</p>\n\n<pre><code>instance Applicative.Applicative (ParsecT s u m) where\n    pure = return\n    (&lt;*&gt;) = ap -- TODO: Can this be optimized?\n</code></pre>\n"}], "owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 28133136, "answer_count": 1, "score": 2, "last_activity_date": 1422169625, "creation_date": 1422154255, "question_id": 28132712, "link": "https://stackoverflow.com/questions/28132712/is-equivalent-to-the-following-with-respect-to-parsec", "title": "is &lt;* equivalent to the following with respect to parsec?", "body": "<p>I recently started learning to use Parsec to write parsers. I am wondering if the following is true:</p>\n\n<p>Even though <code>&lt;*</code> is implemented as <code>(&lt;*) = liftA2 const</code>, when used with parsec, is it the same as:</p>\n\n<pre><code>p1 &lt;* p2 = do { r1 &lt;- p1; _ &lt;- p2; return r1 }\n</code></pre>\n\n<p>And it seems that when using parsec the operator <code>*&gt;</code> and <code>&gt;&gt;</code> are exactly the same since they both throw away the result of the first parser?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 3, "creation_date": 1422140432, "post_id": 28131204, "comment_id": 44635049, "body": "Looks like you&#39;re going to need some recursion..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1422141378, "post_id": 28131204, "comment_id": 44635326, "body": "Hint: you don&#39;t need to specify the whole skeleton of the tree; children of the current node can be bound by variables too. As in: <code>bstSize (Node a b l r) = ...</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1422193782, "last_edit_date": 1422193782, "creation_date": 1422141496, "answer_id": 28131380, "question_id": 28131204, "link": "https://stackoverflow.com/questions/28131204/viewing-the-size-of-bst/28131380#28131380", "title": "Viewing the Size of BST", "body": "<p>You need to use recursion:</p>\n\n<pre><code>Data BSearch q w = None | Node q w (BSearch q w) (BSearch q w)\nbstSize :: BSearch q w -&gt; Int\nbstSize None = 0\nbstSize(Node _ _ la lb) = 1 + bstSize la + bstSize lb\n</code></pre>\n\n<p>You made a small mistake with <code>Empty</code> to <code>None</code>.</p>\n\n<p>Furthermore the size of a <code>Node</code> is one plus the size of the left child and the right child. You can do this using <em>recursion</em>. With recursion you call the same method on a different input (in this case the children of the node).</p>\n\n<p>Since every tree is empty. Eventually all children will end.</p>\n\n<p><strong>How does this work?</strong></p>\n\n<p>Say you have value <code>Node a b None (Node a b None (Node a b None None))))</code>, then the function call</p>\n\n<pre><code>bstSize (Node a b None (Node a b None (Node a b None None))))) --1st call\n</code></pre>\n\n<p>will unify <code>la</code> with <code>None</code> and <code>lb</code> with <code>(Node a b None (Node a b None None)))</code>. Now the function calls <code>bstSize la</code> and <code>bstSize lb</code>. Since <code>la</code> is <code>None</code>, the first call will return <code>0</code>. For the second call it is more complicated.</p>\n\n<p>The second call is:</p>\n\n<pre><code>bstSize Node a b None (Node a b None None))))  --2nd call\n</code></pre>\n\n<p>Now in <strong>this</strong> function call, <code>la</code> is unified with <code>None</code> thus the result is zero, and <code>lb</code> with <code>Node a b None None</code>. This leads to a third call:</p>\n\n<pre><code>bstSize (Node a b None None) --3rd call\n</code></pre>\n\n<p>Since both <code>la</code> and <code>lb</code> unify with <code>None</code>, their result is both <code>0</code>, thus the result is:</p>\n\n<pre><code>bstSize (Node a b None None) --3rd call\n= 1 + bstSize None + bstSize None\n= 1+0+0\n= 1\n</code></pre>\n\n<p>The result returns to the second call:</p>\n\n<pre><code>bstSize Node a b None (Node a b None None)))) --2nd call\n= 1 + bstSize None + bstSize (Node a b None None)))) \n= 1 + 0 + 1\n= 2\n</code></pre>\n\n<p>And the final result is:</p>\n\n<pre><code>bstSize (Node a b None (Node a b None (Node a b None None))) --1st call\n= 1 + bstSize None + bstSize (Node a b None (Node a b None None))\n= 1 + 0 + 2\n= 3\n</code></pre>\n\n<p>Recursion is a powerful concept but can easily lead to infinite loops. You better make sure you always do recursive calls with different elements than the given one, and that the call tree is finite.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1422751841, "creation_date": 1422751841, "answer_id": 28258276, "question_id": 28131204, "link": "https://stackoverflow.com/questions/28131204/viewing-the-size-of-bst/28258276#28258276", "title": "Viewing the Size of BST", "body": "<p>Here's the way to cheat in any recent GHC. Don't bother trying this on a class assignment.</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveFunctor #-}\n\nmodule MyModuleNotYours\nimport qualified Data.Foldable as F\n\ndata BSearch x y = None\n                 | Node x y (BSearch x y) (BSearch x y)\n  deriving (F.Foldable, Functor)\n\nbstSize :: BSearch x y -&gt; Int\nbstSize = F.sum . (1 &lt;$)\n</code></pre>\n"}], "owner": {"reputation": 247, "user_id": 4441586, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-wtwj0CDF2fU/AAAAAAAAAAI/AAAAAAAAABI/MKN2fXgHWc4/photo.jpg?sz=128", "display_name": "Jubl", "link": "https://stackoverflow.com/users/4441586/jubl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1422751841, "creation_date": 1422140103, "last_edit_date": 1422749000, "question_id": 28131204, "link": "https://stackoverflow.com/questions/28131204/viewing-the-size-of-bst", "title": "Viewing the Size of BST", "body": "<p>Assuming I have <code>data BSearch x y = None | Node x y (BSearch x y) (BSearch x y)</code> (which means that the tree is either empty or it's not) and I am trying to write the function, <code>bstSize :: BSearch x y -&gt; Int</code> .</p>\n\n<p>It basically runs like, </p>\n\n<pre><code>&gt; bstSize None\n0\n&gt; bstSize (Node 0 57 Empty (Node 0 65 Empty Empty))\n2  \n</code></pre>\n\n<p>I know how to define a tree with 1 node and one with 2 nodes, but I'm having trouble figuring out how to implement the pattern into actual code for nth number of nodes. The only thing I can think of is counting the number of right parentheses, counting the number of times \"Nodes\" occurs in the argument, or counting the number of times \"Empty\" occurs in the argument minus 1 and I am not really sure how to do any of those things. I understand that I might have to use recursion, but I'm not sure how I would go about that. Here is what I have so far:</p>\n\n<pre><code>data BSearch q w = None | Node q w (BSearch q w) (BSearch q w)\nbstSize :: BSearch q w -&gt; Int\nbstSize Empty = 0\nbstSize(Node a b None None) = 1\nbstSize(Node a b None (Node a b None None))) = 2\nbstSize(Node a b None (Node a b None (Node a b None None))))) = 3\n</code></pre>\n\n<p>Obviously, I'm not supposed to flat out define what 2, 3, 4, etc. look like, but I did it to see what the pattern looked like and to see what I could use. So far, I don't really understand what to do.</p>\n"}, {"tags": ["validation", "haskell", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1422141737, "creation_date": 1422141737, "answer_id": 28131411, "question_id": 28131138, "link": "https://stackoverflow.com/questions/28131138/validation-at-type-level/28131411#28131411", "title": "Validation at type level", "body": "<p>The <code>validate</code> function, as written, is not usable in current GHC. Looking at its type signature:</p>\n\n<pre><code>validate :: Validated a =&gt; Underlying a -&gt; Bool\n</code></pre>\n\n<p>you might reasonably think that, given a value of type <code>Underlying a</code>, one can figure out which <code>Validated</code> instance to use, namely, the <code>a</code> one. But this is a mistake: since <code>Underlying</code> is not injective, there may be types <code>b</code> and <code>c</code> for which <code>Underlying b ~ Underlying c</code>; hence neither <code>b</code> nor <code>c</code> can be a canonical choice for which instance to use. That is, there <em>is</em> no good mapping <code>F</code> on types for which <code>F (Underlying a) ~ a</code> is always true!</p>\n\n<p>An alternative would be to use a data family rather than a type family.</p>\n\n<pre><code>class Validated a where\n    data Underlying a\n    validate :: Underlying a -&gt; Bool\n\ninstance Validated Name where\n    data Underlying Name = Underlying String\n    validate (Underlying name) = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1422217724, "post_id": 28131414, "comment_id": 44653847, "body": "I tried modifying my code as follows, but I am getting the same error message. What am I doing wrong?  <code>data Proxy a = Proxy</code>   ``   <code>class Validated a where</code>     <code>type Underlying a</code>     <code>validate :: Proxy a -&gt; Underlying a -&gt; Bool</code>     <code>construct :: Underlying a -&gt; a</code>     <code>use :: a -&gt; Underlying a</code>   ``  <code>makeValidated :: Validated a =&gt; Underlying a -&gt; Maybe a</code>   <code>makeValidated u = if validate (Proxy :: Proxy a) u</code>                       <code>then Just (construct u)</code>                       <code>else Nothing</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1422221174, "post_id": 28131414, "comment_id": 44654990, "body": "@NioBium You need to use <code>makeValidated :: forall a . Validated a =&gt; ...</code> and enable the <code>ScopedTypeVariables</code> language extension. Probably a better choice could be to remove <code>validate,construct</code> from your class and add <code>makeValidated</code> instead in the class."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1422142081, "last_edit_date": 1422142081, "creation_date": 1422141754, "answer_id": 28131414, "question_id": 28131138, "link": "https://stackoverflow.com/questions/28131138/validation-at-type-level/28131414#28131414", "title": "Validation at type level", "body": "<p><code>Underlying</code> is a type function, which might not be injective. That is:</p>\n\n<pre><code>instance Validate T1 where\n   type Underlying T1 = Int\n   validate = ... -- code A\n\ninstance Validate T2 where\n   type Underlying T2 = Int\n   validate = ... -- code B\n</code></pre>\n\n<p>Consider now</p>\n\n<pre><code>validate (42 :: Int)\n</code></pre>\n\n<p>What should this do? Should it call code <code>A</code> or <code>B</code>? Since <code>Underlying T1 = Underlying T2 = Int</code>, it's impossible to tell.</p>\n\n<p>It is impossible to call <code>validate</code> unambiguously. To avoid this, a possible fix is to add a \"proxy\" parameter to your validation function:</p>\n\n<pre><code>data Proxy a = Proxy\n\nclass Validate a where\n    validate :: Proxy a -&gt; Underlying a -&gt; Bool\n</code></pre>\n\n<p>Now you can use:</p>\n\n<pre><code>validate Proxy (42 :: Int)               -- still ambiguous!\nvalidate (Proxy :: Proxy T1) (42 :: Int) -- Now OK!\nvalidate (Proxy :: Proxy T2) (42 :: Int) -- Now OK!\n</code></pre>\n"}], "owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 1, "accepted_answer_id": 28131414, "answer_count": 2, "score": 6, "last_activity_date": 1422147215, "creation_date": 1422139556, "last_edit_date": 1422147215, "question_id": 28131138, "link": "https://stackoverflow.com/questions/28131138/validation-at-type-level", "title": "Validation at type level", "body": "<p>Say I would like to construct subtypes satisfying certain invariants without help of external tools such as LiquidHaskell (ideally I want to do this even without typeclasses). What is the most elegant way to do it? So far I tried the following:</p>\n\n<pre><code>class Validated a where\n  type Underlying a\n  validate :: Underlying a -&gt; Bool\n  construct :: Underlying a -&gt; a\n  use :: a -&gt; Underlying a\n\nmakeValidated :: Validated a =&gt; Underlying a -&gt; Maybe a\nmakeValidated u = if validate u \n                    then Just (construct u)\n                    else Nothing\n\n\nnewtype Name = Name String\ninstance Validated Name where\n  type Underlying Name = String\n  validate str = and  [ isUppercase (str !! 0 )\n                      , all isLetter str ]\n  construct = Name\n  use (Name str) = str\n</code></pre>\n\n<p>I assume that if I don't export the \"Name\" constructor from the module, I will have a working solution, because the only way to construct an element of the type would be through makeValidated function.</p>\n\n<p>However compiler complains as such:</p>\n\n<pre><code>Could not deduce (Underlying a0 ~ Underlying a)\nfrom the context (Validated a)\n  bound by the type signature for\n             makeValidated :: Validated a =&gt; Underlying a -&gt; Maybe a\n  at validated.hs:11:18-55\nNB: `Underlying' is a type function, and may not be injective\nThe type variable `a0' is ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nIn the first argument of `validate', namely `u'\nIn the expression: validate u\nIn the expression:\n  if validate u then Just (construct u) else Nothing\n</code></pre>\n\n<p>How do I fix it?</p>\n"}, {"tags": ["haskell", "clojure", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422140063, "post_id": 28131135, "comment_id": 44634949, "body": "If you don&#39;t care at all about efficiency, you can use <code>init</code> instead of <code>tail</code> and/or <code>++[a]</code> instead of <code>a:</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422140141, "post_id": 28131135, "comment_id": 44634968, "body": "Alternatively, you can find an implementation of <code>foldr</code> in terms of <code>foldl</code> (for finite lists) on the Internet."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422140185, "post_id": 28131135, "comment_id": 44634981, "body": "Well, I&#39;m using <code>conj</code> in the Clojure version, which is an efficient version of <code>++ [a]</code> (using a different data structure than linked lists). That doesn&#39;t actually fix it: you can get either xs or ys in the right order, but not both in any obvious way that I can see."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422140578, "post_id": 28131135, "comment_id": 44635088, "body": "<a href=\"http://blog.wakatta.jp/blog/2011/11/11/haskell-foldr-as-foldl/\" rel=\"nofollow noreferrer\">blog.wakatta.jp/blog/2011/11/11/haskell-foldr-as-foldl</a> gives you all you need, I&#39;m sure."}, {"owner": {"reputation": 22686, "user_id": 3758484, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/pJmdo.jpg?s=128&g=1", "display_name": "johnbakers", "link": "https://stackoverflow.com/users/3758484/johnbakers"}, "edited": false, "score": 0, "creation_date": 1422309844, "post_id": 28131135, "comment_id": 44690498, "body": "+1 for taking my question seriously the other day! glad to see this discussion continuing. i will be digesting all these answers and others i&#39;ve found before i comment further"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1422144880, "post_id": 28131457, "comment_id": 44636155, "body": "I was hoping for a solution of the form <code>zip = foldl f x</code>, so that I can say it&#39;s &quot;just&quot; a reduce. Of course I can reverse one of the lists, but then it ends up looking like <code>zip xs ys = foldl f x xs $ reverse ys</code>, which is less satisfying. I&#39;ll add that to the question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1422146116, "post_id": 28131457, "comment_id": 44636429, "body": "@amalloy I think you&#39;re taking the claim &quot;<code>foldl</code> is universal&quot; to be stronger than it really is. It is common to compute &quot;extra&quot; data in your fold and throw some of it away or otherwise do some post-processing; e.g. the natural way to express the function which picks out every other element of a list as a fold is to produce both the even elements and the odd elements as a tuple. The claim is not &quot;you always need exactly one <code>foldl</code> and nothing else&quot;, but rather, &quot;the only thing you need to do to <i>lists</i> is <code>foldl</code>&quot;, which property is still true in my proposed solution."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422146335, "post_id": 28131457, "comment_id": 44636466, "body": "Also common: using the fold to produce a function, and then applying the function, which is how <code>foldl</code> and <code>foldr</code> are defined in terms of each other."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1422142057, "creation_date": 1422142057, "answer_id": 28131457, "question_id": 28131135, "link": "https://stackoverflow.com/questions/28131135/how-to-implement-zip-with-foldl-in-an-eager-language/28131457#28131457", "title": "How to implement zip with foldl (in an eager language)", "body": "<p>Simply implement</p>\n\n<pre><code>reverse = foldl (flip (:)) []\n</code></pre>\n\n<p>and apply it to the second list.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1422309091, "post_id": 28136332, "comment_id": 44690171, "body": "Thanks! I have to say, it looks more readable in Haskell: <a href=\"https://www.refheap.com/37b61066156c2265969b7dd89\" rel=\"nofollow noreferrer\">refheap.com/37b61066156c2265969b7dd89</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1422318489, "post_id": 28136332, "comment_id": 44693783, "body": "@amalloy, note that in this case, it&#39;s <i>not</i> just folding over the list. It&#39;s folding over the list to produce a function, and then applying the function."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1422190710, "last_edit_date": 1495542740, "creation_date": 1422188585, "answer_id": 28136332, "question_id": 28131135, "link": "https://stackoverflow.com/questions/28131135/how-to-implement-zip-with-foldl-in-an-eager-language/28136332#28136332", "title": "How to implement zip with foldl (in an eager language)", "body": "<p><a href=\"https://stackoverflow.com/a/26285107/849891\">In Haskell</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- foldr f z xs == foldl (\\r x a-&gt; r (f x a)) id xs z\n\nzip1 xs ys = -- foldr f (const []) xs ys\n            foldl (\\r x a-&gt; r (f x a)) id xs (const []) ys\n  where\n    f x r []     = []\n    f x r (y:ys) = (x,y) : r ys\n</code></pre>\n\n<blockquote>\n  <p>Prelude> zip1 [1..9] [100..120] <br/>\n  [(1,100),(2,101),(3,102),(4,103),(5,104),(6,105),(7,106),(8,107),(9,108)]</p>\n</blockquote>\n\n<p>Since Clojure likes appending at the end of list, another variant is</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>zip2 xs ys = foldl f (const []) xs ys\n  where\n    f r x [] = []\n    f r x ys = let (ys0,y) = (init ys, last ys) -- use some efficient Clojure here\n               in r ys0 ++ [(x,y)]\n</code></pre>\n\n<blockquote>\n  <p>Prelude> zip2 [1..9] [100..120] <br />\n  [(1,112),(2,113),(3,114),(4,115),(5,116),(6,117),(7,118),(8,119),(9,120)]</p>\n</blockquote>\n\n<p>As you can see the <em>end</em> of lists lines up here, instead of the front. </p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1422310636, "creation_date": 1422310636, "answer_id": 28159764, "question_id": 28131135, "link": "https://stackoverflow.com/questions/28131135/how-to-implement-zip-with-foldl-in-an-eager-language/28159764#28159764", "title": "How to implement zip with foldl (in an eager language)", "body": "<p>Another Clojure expert pointed out that it's easier to do this in Clojure without trying to use the same structure as Haskell's foldr solution:</p>\n\n<pre><code>(defn zip [xs ys]\n  (first (reduce\n          (fn [[acc rest :as state] itm]\n            (if rest\n              [(conj acc [itm (first rest)])\n               (next rest)]\n              state))\n          [[] (seq ys)]\n          xs)))\n</code></pre>\n\n<p>This just folds over a pair, the first of which is a result sequence being built up, and the second is what remains of ys; xs are being fed in one item at a time via the reduce. In Haskell this would look like:</p>\n\n<pre><code>zip' :: [a] -&gt; [b] -&gt; [(a,b)]\nzip' xs ys = fst $ foldl f ([], ys) xs\n  where f state@(_, []) _x = state\n        f (acc, (y:ys)) x = ((acc ++ [(x, y)]), ys)\n</code></pre>\n\n<p>except that of course the <code>acc ++ [(x, y)]</code> is much more reasonable in Clojure than in Haskell, since it's efficient.</p>\n"}, {"tags": [], "owner": {"reputation": 25192, "user_id": 1756702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2aeb0631b89c7948ca82c71a725e8f4?s=128&d=identicon&r=PG&f=1", "display_name": "A. Webb", "link": "https://stackoverflow.com/users/1756702/a-webb"}, "is_accepted": false, "score": 1, "last_activity_date": 1422474053, "last_edit_date": 1495541385, "creation_date": 1422446055, "answer_id": 28191648, "question_id": 28131135, "link": "https://stackoverflow.com/questions/28131135/how-to-implement-zip-with-foldl-in-an-eager-language/28191648#28191648", "title": "How to implement zip with foldl (in an eager language)", "body": "<p><a href=\"https://stackoverflow.com/a/28136332/1756702\">These</a> <a href=\"https://stackoverflow.com/a/28159764/1756702\">two</a> solutions are both of the form <code>(-&gt; (reduce f init x) something)</code> rather than just <code>(reduce f init x)</code>. Both carry along a container with the accumulated sequence and a some extra state, then extract the sequence from the container. In one case the container is a closure, in the other a vector.</p>\n\n<p>If you want \"just\" <code>(reduce f init x)</code> then recognize that you already have all the state you need in the accumulated sequence itself -- its length.</p>\n\n<pre><code>(defn zip* [xs ys] \n  (let [xs (vec xs)\n        f (fn [a y]\n            (if (contains? xs (count a))\n              (conj a [(xs (count a)) y])\n              a))]\n    (reduce f [] ys)))\n</code></pre>\n"}], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1147, "favorite_count": 2, "accepted_answer_id": 28136332, "answer_count": 4, "score": 10, "last_activity_date": 1422474053, "creation_date": 1422139544, "last_edit_date": 1495540930, "question_id": 28131135, "link": "https://stackoverflow.com/questions/28131135/how-to-implement-zip-with-foldl-in-an-eager-language", "title": "How to implement zip with foldl (in an eager language)", "body": "<p>A Clojure programmer I know recently remarked that it's possible to implement lots of sequence functions in terms of Clojure's <code>reduce</code> (which is Haskell's <code>foldl'</code>), but that regrettably there's no way to implement <code>(map list xs ys)</code> (which is Haskell's <code>zip</code>) with just <code>reduce</code>.</p>\n\n<p>Now, I've read about the universality of folds, so I'm pretty sure this isn't true: certainly <code>zip</code> is possible with <code>foldr</code>, and I'd be surprised if it weren't possible with <code>foldl</code>. For purposes of this discussion we're ignoring the problems of the eagerness of <code>foldl</code> compared to <code>foldr</code>: imagine we have unlimited memory and only work with finite sequences.</p>\n\n<p>So, I took the Haskell code to <a href=\"https://stackoverflow.com/questions/235148/implement-zip-using-foldr\">implement zip with foldr</a>, and translated it to Clojure, doing my best to adjust for the difference between foldr and foldl:</p>\n\n<pre><code>(defn zip [xs ys]\n  (letfn [(done [_] [])\n          (step [z x]\n            (fn [ys]\n              (if (empty? ys)\n                []\n                (conj (z (rest ys)) [x (first ys)]))))]\n    ((reduce step done xs) ys)))\nuser&gt; (zip [1 2] '[a b c]) ;=&gt; [[1 b] [2 a]]\n</code></pre>\n\n<p>And indeed we do get pairs of elements from xs and ys tupled together, but out of order: the first element of xs is paired with the last element of ys, and so on down the line. I can kinda see the cause of the problem: the function we produce consumes ys starting from the left, but the outermost closure (which is called first) has closed over the last element of xs, so it can't pair them in the right order.</p>\n\n<p>I think the fix is to somehow build the closures inside-out, but I can't really see how to do it. I would happily accept a solution in either Haskell or Clojure.</p>\n\n<p>I'm hoping for a solution of the form <code>zip = foldl f x</code>, so that I can say it's \"just\" a reduce. Of course I can reverse one of the lists, but then it ends up looking like <code>zip xs ys = foldl f x xs $ reverse ys</code> which doesn't seem very satisfying or clean.</p>\n"}, {"tags": ["haskell", "lambda-calculus", "pointfree", "combinatory-logic"], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 11, "last_activity_date": 1422136399, "creation_date": 1422136399, "answer_id": 28130676, "question_id": 28130574, "link": "https://stackoverflow.com/questions/28130574/haskell-utility-to-make-function-point-free/28130676#28130676", "title": "Haskell utility to make function point free", "body": "<p>There is actually a program called \"pointfree\"</p>\n\n<p>Do this</p>\n\n<pre><code>cabal install pointfree\n</code></pre>\n\n<p>then this at the command line</p>\n\n<pre><code>&gt; pointfree \"\\x -&gt; x+1\"\n\n (1 +)\n</code></pre>\n\n<p>Warning- although some pointfree outcomes are wonderful, others are pretty scary....</p>\n"}, {"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": false, "score": 4, "last_activity_date": 1422137212, "creation_date": 1422137212, "answer_id": 28130780, "question_id": 28130574, "link": "https://stackoverflow.com/questions/28130574/haskell-utility-to-make-function-point-free/28130780#28130780", "title": "Haskell utility to make function point free", "body": "<p>The Haskell wiki covers tools for <a href=\"https://www.haskell.org/haskellwiki/Pointfree#Tool_support\" rel=\"nofollow\">pointfree refactoring here</a>. It mainly covers <a href=\"https://www.haskell.org/haskellwiki/Lambdabot\" rel=\"nofollow\">Lambdabot</a>, an IRC bot that does pointfree and pointful refactoring:</p>\n\n<pre><code>@pl \\x y -&gt; EQ == compare x y\n((EQ ==) .) . compare\n</code></pre>\n\n<p>[1] Example from <a href=\"http://ircbrowse.net/browse/haskell?id=19908612&amp;timestamp=1421726397#t1421726397\" rel=\"nofollow\">http://ircbrowse.net/browse/haskell?id=19908612&amp;timestamp=1421726397#t1421726397</a></p>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "closed_date": 1422431432, "answer_count": 2, "score": 0, "last_activity_date": 1422214173, "creation_date": 1422135829, "last_edit_date": 1422214173, "question_id": 28130574, "link": "https://stackoverflow.com/questions/28130574/haskell-utility-to-make-function-point-free", "closed_reason": "Not suitable for this site", "title": "Haskell utility to make function point free", "body": "<p>I'd like to quickly and correctly reduce functions to point free form in Haskell. I'd prefer to produce fairly readable outcomes. How should I go about this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422135236, "post_id": 28130447, "comment_id": 44633727, "body": "The specification, as you&#39;ve described it, is wrong."}, {"owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422135291, "post_id": 28130447, "comment_id": 44633747, "body": "@dfeuer can u elaborate?"}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1422135478, "post_id": 28130447, "comment_id": 44633789, "body": "@JoffreyBaratheon: there&#39;s simply no way to return the whole root node when the return type is <code>Maybe y</code>.  You can only expect to return the value of the right node."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422135519, "post_id": 28130447, "comment_id": 44633802, "body": "And you can&#39;t return a <code>Maybe a</code> one time and a <code>BinTree x y</code> the other. And <code>BinTree</code> can&#39;t possibly be lower case anyway."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1422135533, "post_id": 28130447, "comment_id": 44633806, "body": "<code>binSearch</code> needs to be capitalized - e.g. <code>data BinSearch ...</code>"}, {"owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422135620, "post_id": 28130447, "comment_id": 44633825, "body": "@Rufflewind But all Maybe means is that it&#39;s either nothing or something. Why would that pose a problem in finding the root node?"}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422135928, "post_id": 28130447, "comment_id": 44633896, "body": "@JoffreyBaratheon: your specifications say <code>result (Node 0 23 Empty Empty) == Node 0 23 Empty Empty</code>.  What you have on the right side is <i>not</i> a <code>Maybe y</code>, but a <code>BinSearch x y</code>, which contradicts your type specification <code>... -&gt; Maybe y</code>.  Therefore your problem is ill-posed."}, {"owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422136033, "post_id": 28130447, "comment_id": 44633925, "body": "@Rufflewind My bad, I just figured out what you meant. Error on my part. I just fixed EVERYTHING, hopefully."}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422136175, "post_id": 28130447, "comment_id": 44633974, "body": "@JoffreyBaratheon: I assume by <code>Maybe 44</code> you meant <code>Just 44</code>?"}, {"owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1422136264, "post_id": 28130447, "comment_id": 44633997, "body": "@Rufflewind Sorry, I&#39;m having a slow day lol."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1422135494, "creation_date": 1422135494, "answer_id": 28130517, "question_id": 28130447, "link": "https://stackoverflow.com/questions/28130447/printing-a-variable-from-a-bst/28130517#28130517", "title": "Printing a Variable from a BST", "body": "<p>Two small hints: first, it must be <code>BinSearch</code> with a capital <code>B</code>. I suspect this was a transcription error on your part. Second is a syntax hint; your pattern needs parentheses, like this:</p>\n\n<pre><code>result (Node a b None None) = ...\n</code></pre>\n\n<p>This is not a complete solution; but will get you over this hurdle and into the next (more interesting) error.</p>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1422138054, "post_id": 28130723, "comment_id": 44634468, "body": "<code>Just</code> is not a built-in function. It simply the constructor of a datatype, which is declared as <code>data Maybe a = Nothing | Just a</code>."}], "tags": [], "owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "is_accepted": false, "score": 0, "last_activity_date": 1422143267, "last_edit_date": 1422143267, "creation_date": 1422136787, "answer_id": 28130723, "question_id": 28130447, "link": "https://stackoverflow.com/questions/28130447/printing-a-variable-from-a-bst/28130723#28130723", "title": "Printing a Variable from a BST", "body": "<p>I got it. I'm dumb. You just have to put \"Just 44\" at the end. My problem was that I didn't know that \"Just\" was built in.</p>\n"}], "owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1422143267, "creation_date": 1422134985, "last_edit_date": 1422136884, "question_id": 28130447, "link": "https://stackoverflow.com/questions/28130447/printing-a-variable-from-a-bst", "title": "Printing a Variable from a BST", "body": "<p>I'm trying out an exercise where I have to print out a root node of a bst. They are telling me to use <code>data BinSearch x y = Empty | Node x y (BinSearch x y) (BinSearch x y)</code> (meaning a binary search tree either has nothing in it or it does) and the signature, <code>result :: BinSearch x y -&gt; Maybe y</code>. I need to run the program like,</p>\n\n<pre><code>&gt; result None\nNothing\n&gt; result (Node 0 44 None None)\nJust 44 \n</code></pre>\n\n<p>I'm a bit confused on how to do this. If I had control over the signature, it'd be easy, but I don't understand how to go about this. </p>\n\n<p>The only thing I've come up with is </p>\n\n<pre><code>data BinSearch x y = None | Node x y (BinSearch x y) (BinSearch x y)\nresult :: BinSearch x y -&gt; Maybe y\nresult (Node a b None None) = b \n</code></pre>\n\n<p>but the error I get there is that it couldn't match v with BinSearch x0 y0.</p>\n\n<p>EDIT: I have fixed all transcription errors, apologies. The problem is now stated EXACTLY as it was in the book.</p>\n"}, {"tags": ["haskell", "filter", "functional-programming", "filtering"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1422132325, "post_id": 28129938, "comment_id": 44632979, "body": "Short answer: using induction. For example check <a href=\"http://stackoverflow.com/a/14960598/1308058\">Structural induction in Haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1422132755, "last_edit_date": 1422132755, "creation_date": 1422132392, "answer_id": 28130077, "question_id": 28129938, "link": "https://stackoverflow.com/questions/28129938/filter-in-haskell/28130077#28130077", "title": "Filter in Haskell", "body": "<p>No, providing some <code>xs</code> samples is not what this exercise requires.</p>\n\n<p>This exercise is asking you to <em>prove</em> for all possible values of <code>p,q,xs</code>, the the equation holds. Note that there are infinitely many possible values for <code>p,q,xs</code>, so it is unfeasible to brute force all the possible cases: a general mathematical proof must be provided, leveraging some logical principle.</p>\n\n<p>Just to make a comparison, suppose you are asked to prove that <code>2*x+x = 3*x</code> in an exercise. The expected solution is not \"well, it holds on <code>x=4</code> and <code>x=10</code>\", neglecting all the other (infinitely many) values for <code>x</code>. A reasonable solution could be: \"I have <code>x=1*x</code>, and so by the distributive law \n<code>2*x+x = 2*x + 1*x = (2+1)*x = 3*x</code>\", which works for <em>all</em> <code>x</code>.</p>\n\n<p>In this kind of exercises, often one must proceed by induction on something. Here, <code>xs</code> looks as a good candidate for induction. So, to prove the equation true for all <code>xs</code>, it is necessary to prove</p>\n\n<ol>\n<li>the equation holds for <code>xs=[]</code></li>\n<li>if the equation holds for <code>xs=ys</code> (<code>ys</code> being arbitrary), then it must hold for <code>xs=y:ys</code> (<code>y</code> being an arbitrary value)</li>\n</ol>\n\n<p>If you prove 1. and 2. then you are done.</p>\n\n<p>Just one extra hint: since <code>y</code> is arbitrary, you do not know if it satisfies predicates <code>p</code> and/or <code>q</code>. You can however check all the possible four cases there: both <code>p,q</code> hold, only <code>p</code>, only <code>q</code>, neither.</p>\n"}], "owner": {"reputation": 467, "user_id": 3731142, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/mhNoB.jpg?s=128&g=1", "display_name": "migea", "link": "https://stackoverflow.com/users/3731142/migea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 28130077, "answer_count": 1, "score": -1, "last_activity_date": 1422132755, "creation_date": 1422131452, "last_edit_date": 1422131898, "question_id": 28129938, "link": "https://stackoverflow.com/questions/28129938/filter-in-haskell", "title": "Filter in Haskell", "body": "<p>I have the following problem.</p>\n\n<p>Prove that for all finite lists xs of some type and predicates p and q on that type:</p>\n\n<pre><code>filter p (filter q xs) = filter q ( filter p xs)\n</code></pre>\n\n<p>Do I need some sample xs lists for solving this? Or how must this problem be solved?\nThanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422131296, "post_id": 28129903, "comment_id": 44632647, "body": "Also <code>(10 ^ x)</code> requires <code>Integral</code>, not only <code>Num</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422131343, "post_id": 28129903, "comment_id": 44632665, "body": "And <code>ScopedTypeVariables</code> aren&#39;t required, the <code>a</code>s can be different."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422131765, "post_id": 28129903, "comment_id": 44632780, "body": "@OlegGrenrus, yes, I&#39;ve completely rewritten it now, and actually made sure it works this time."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1422132095, "post_id": 28129903, "comment_id": 44632903, "body": "I forgot to state that in this case the 10^x will be using only 32 bit representation with no signal. But this is amazing, thank you a lot to all of you, i love to learn in this community :)"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422132123, "post_id": 28129903, "comment_id": 44632913, "body": "@dfeuer, You probably should point out that using <code>Int</code> is quite safe, as OP probably won&#39;t have lists with overflowing length. Yet it caught my attention."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1422132469, "last_edit_date": 1422132469, "creation_date": 1422131203, "answer_id": 28129903, "question_id": 28129834, "link": "https://stackoverflow.com/questions/28129834/no-instance-for-num-a-arising-from-a-use-of-sum-instance-num/28129903#28129903", "title": "No instance for (Num a) arising from a use of `sum&#39; - Instance Num", "body": "<p>Almost, but not quite. The basic problem is that <code>length</code> has type <code>[a]-&gt;Int</code>. This will work:</p>\n\n<pre><code>fromDigits :: Num a =&gt; [a] -&gt; a\nfromDigits n = sum (zipWith (\\x y -&gt; x*y) (n) (f n 0))\n  where\n    f :: Num b =&gt; [b] -&gt; Int -&gt; [b]\n    f n x = if (x==length n) then []\n                             else (10^x):f n (x+1)\n</code></pre>\n\n<p>As Oleg Grenrus points out, one should always be careful to check if <code>Int</code> might overflow. It is in fact possible for this to happen if <code>Int</code> is 30, 31, or 32 bits, although it is relatively unlikely. However, if that is a concern, there is a way around it, using another function:</p>\n\n<pre><code>lengthIsExactly :: Integral n =&gt; n -&gt; [a] -&gt; Bool\nlengthIsExactly = -- I'll let you figure this one out.\n                  -- Remember: you can't use `length` here,\n                  -- and `genericLength` is horribly inefficient,\n                  -- and there's a completely different way.\n</code></pre>\n\n<p>You can make it easier to see how the types of <code>fromDigits</code> and <code>f</code> match up using a GHC extension. Enable the extension by adding</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n</code></pre>\n\n<p>to the very top of your source file. Then you can write</p>\n\n<pre><code>fromDigits :: forall a . Num a =&gt; [a] -&gt; a\nfromDigits n = sum (zipWith (\\x y -&gt; x*y) (n) (f n 0))\n  where\n    f :: [a] -&gt; Int -&gt; [a]\n    f n x = if (x==length n) then []\n                             else (10^x):f n (x+1)\n</code></pre>\n\n<p>This way, it's clear that the list arguments all have the same type.</p>\n"}, {"comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1422131752, "post_id": 28129962, "comment_id": 44632775, "body": "Doesn&#39;t the <code>Integral</code> constraint subsume the <code>Num</code> constraint?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1422131786, "post_id": 28129962, "comment_id": 44632795, "body": "<code>Eq</code> is a superclass of <code>Integral</code>: <code>class (Real a, Enum a) =&gt; Integral a where</code> and <code>class (Num a, Ord a) =&gt; Real a where</code>"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 1, "creation_date": 1422131879, "post_id": 28129962, "comment_id": 44632828, "body": "@skills, <code>Num a</code> doesn&#39;t imply <code>Eq a</code>, but <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#t:Integral\" rel=\"nofollow noreferrer\"><code>Integral a</code></a> does, thru <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#t:Real\" rel=\"nofollow noreferrer\"><code>Real a</code></a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1422131899, "post_id": 28129962, "comment_id": 44632835, "body": "You don&#39;t actually need to fuss with <code>Integral</code> at all. only the second argument of <code>f</code> needs to be <code>Integral</code>, and you can actually just make it <code>Int</code>. See my (revised) answer."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 2, "last_activity_date": 1422131611, "creation_date": 1422131611, "answer_id": 28129962, "question_id": 28129834, "link": "https://stackoverflow.com/questions/28129834/no-instance-for-num-a-arising-from-a-use-of-sum-instance-num/28129962#28129962", "title": "No instance for (Num a) arising from a use of `sum&#39; - Instance Num", "body": "<p>The problem is that you are using other functions that require even more of type a than just <code>Num a</code></p>\n\n<pre><code>(^) requires \"Integral a\"\n</code></pre>\n\n<p>This works</p>\n\n<pre><code>fromDigits' :: (Num a, Integral a)=&gt;[a] -&gt; a\nfromDigits' n = sum (zipWith (\\x y -&gt; x*y) (n) (f n 0))\n        where\n            f :: (Num a, Integral a)=&gt;[a] -&gt; a -&gt; [a]\n            f n x = if (x==fromIntegral (length n)) then []\n                                     else (10^x):f n (x+1)\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2424, "favorite_count": 0, "accepted_answer_id": 28129903, "answer_count": 2, "score": 0, "last_activity_date": 1422132469, "creation_date": 1422130859, "question_id": 28129834, "link": "https://stackoverflow.com/questions/28129834/no-instance-for-num-a-arising-from-a-use-of-sum-instance-num", "title": "No instance for (Num a) arising from a use of `sum&#39; - Instance Num", "body": "<p>this function works fine:</p>\n\n<pre><code>fromDigits :: [Int] -&gt; Int\nfromDigits n = sum (zipWith (\\x y -&gt; x*y) (n) (f n 0))\n            where\n                f :: [Int] -&gt; Int -&gt; [Int]\n                f n x = if (x==length n) then []\n                                         else (10^x):f n (x+1)\n</code></pre>\n\n<p>But if i want to change the type signature from the function, it does not work:</p>\n\n<pre><code>fromDigits :: (Num a) =&gt; [a] -&gt; a\nfromDigits n = sum (zipWith (\\x y -&gt; x*y) (n) (f n 0))\n            where\n                f :: (Num a) =&gt; [a] -&gt; a -&gt; [a]\n                f n x = if (x==length n) then []\n                                         else (10^x):f n (x+1)\n</code></pre>\n\n<p>Shouldn't this work too?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "edited": false, "score": 15, "creation_date": 1422109729, "post_id": 28126438, "comment_id": 44626041, "body": "<a href=\"http://en.wikipedia.org/wiki/Fermat%27s_Last_Theorem\" rel=\"nofollow noreferrer\">Fermat&#39;s Last Theorem</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1422121041, "post_id": 28127677, "comment_id": 44629427, "body": "Your answer has no code. You should be able to prove this with just a few tens of thousands of pages of Coq, Agda, or Isabelle."}, {"owner": {"reputation": 597, "user_id": 272733, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/da5919ad47133ec03dbb7b0bca904688?s=128&d=identicon&r=PG", "display_name": "Michael Tsang", "link": "https://stackoverflow.com/users/272733/michael-tsang"}, "edited": false, "score": 0, "creation_date": 1422161085, "post_id": 28127677, "comment_id": 44639151, "body": "Does that mean in Haskell if the program specifies a value which does not exist it will hang forever?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 597, "user_id": 272733, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/da5919ad47133ec03dbb7b0bca904688?s=128&d=identicon&r=PG", "display_name": "Michael Tsang", "link": "https://stackoverflow.com/users/272733/michael-tsang"}, "edited": false, "score": 1, "creation_date": 1422166429, "post_id": 28127677, "comment_id": 44639992, "body": "@MichaelTsang After much deliberation and consultation with some friendly folks on IRC about how the heck to answer this question: &quot;yes&quot;."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1422166792, "post_id": 28127677, "comment_id": 44640068, "body": "If the program specifies a computation that searches for a value that does not exist then that search will continue forever."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1422117303, "creation_date": 1422117303, "answer_id": 28127677, "question_id": 28126438, "link": "https://stackoverflow.com/questions/28126438/haskell-program-hangs/28127677#28127677", "title": "Haskell - program hangs", "body": "<p>There is nothing wrong with your program. It seems to hang forever because it <em>does</em> hang forever, because there are no such triples to find.</p>\n"}], "owner": {"reputation": 597, "user_id": 272733, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/da5919ad47133ec03dbb7b0bca904688?s=128&d=identicon&r=PG", "display_name": "Michael Tsang", "link": "https://stackoverflow.com/users/272733/michael-tsang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "accepted_answer_id": 28127677, "answer_count": 1, "score": -4, "last_activity_date": 1422117303, "creation_date": 1422109218, "question_id": 28126438, "link": "https://stackoverflow.com/questions/28126438/haskell-program-hangs", "title": "Haskell - program hangs", "body": "<p>I am now learning Haskell. As it is a purely functional language, which \"everything is a value\", I believe that I can compute whatever things I want, because \"everything is a value\"!</p>\n\n<p>However, considering the following program which attempts to find the smallest integer tuple (a, b, c) satisfying the condition a^n + b^n == c^n given a user input n, which is a positive integer:</p>\n\n<pre><code>func :: Integer -&gt; (Integer, Integer, Integer)\nfunc n = head $ filter (\\(a, b, c) -&gt; a ^ n + b ^ n == c ^ n) listOfTuples\n\nlistOfTuplesWith :: Integer -&gt; [(Integer, Integer, Integer)]\nlistOfTuplesWith 1 = [(1, 1, 1)]\nlistOfTuplesWith x = [(a, b, x) | a &lt;- [1 .. x - 1], b &lt;- [1 .. x - 1]] ++\n    [(a, x, b) | a &lt;- [1 .. x - 1], b &lt;- [1 .. x]] ++\n    [(x, a, b) | a &lt;- [1 .. x], b &lt;- [1 .. x]]\n\nlistOfTuples = concatMap listOfTuplesWith [1 .. ]\n\nmain = do\n    line &lt;- getLine\n    print $ func $ read line\n</code></pre>\n\n<p>When I key in 2, the program outputs the expected value (3, 4, 5), however, when I key in 3, the program seems to hang forever. What's wrong with my program?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422106421, "post_id": 28125891, "comment_id": 44625158, "body": "Have you tried running your code to see what happens? Both should work just fine. You can call them as e.g. <code>(10 ### 20) 30</code>."}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1422106697, "post_id": 28125891, "comment_id": 44625211, "body": "I know, both works fine. But I asked is the second variant an operator or it is a function? Any operator is a function, but not any function is an operator."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1422107575, "post_id": 28125891, "comment_id": 44625472, "body": "Both versions of the function are equivalent. There is no difference."}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1422107878, "post_id": 28125891, "comment_id": 44625544, "body": "I know they does the same. But what about their &quot;status&quot;? They both are not operators?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1422108749, "post_id": 28125891, "comment_id": 44625775, "body": "They&#39;re both operators when used in infix position (at least that is the terminology the Haskell Report uses)."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1422110168, "post_id": 28125891, "comment_id": 44626159, "body": "@Bush After all this dialogue, I&#39;ve decided to provide another, hopefully exhaustive, reply to <a href=\"http://stackoverflow.com/questions/28106953/what-is-the-operator-word-definition\" title=\"what is the operator word definition\">stackoverflow.com/questions/28106953/&hellip;</a>"}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1422111061, "post_id": 28125891, "comment_id": 44626440, "body": "thank you, I will read it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1422127182, "post_id": 28125891, "comment_id": 44631452, "body": "What hinges on whether you call this an operator or not? (Why should we care whether it is an operator?)"}], "answers": [{"comments": [{"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1422107012, "post_id": 28126004, "comment_id": 44625296, "body": "I asked about parameters count here: <a href=\"http://stackoverflow.com/questions/28106953/what-is-the-operator-word-definition\" title=\"what is the operator word definition\">stackoverflow.com/questions/28106953/&hellip;</a> As I see through the comments - operator must to have two parameters. Am I mistaken?"}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1422107321, "post_id": 28126004, "comment_id": 44625397, "body": "You want to say function is an operator when it has name with ascSymbol symbols <b>and not two parameters even</b>?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1422107481, "post_id": 28126004, "comment_id": 44625441, "body": "I have already said in the comments of the other question that this assumption is wrong. shang is right."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1422108613, "post_id": 28126004, "comment_id": 44625739, "body": "Yes, that&#39;s because <code>###</code> <i>is</i> an operator. The report states (as is quoted correctly in the other question) that the criterion for calling something an operator is whether it can syntactically be applied in infix position. This is true for <code>###</code>. It doesn&#39;t matter &quot;how many arguments it has&quot; or &quot;what its return type is&quot;."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 7, "last_activity_date": 1422106364, "creation_date": 1422106364, "answer_id": 28126004, "question_id": 28125891, "link": "https://stackoverflow.com/questions/28125891/can-operator-return-a-function/28126004#28126004", "title": "Can operator return a function?", "body": "<p>There is no rule that says an operator has to have two parameters and in fact, semantically all functions in Haskell only ever take a single parameter. Your two examples are exactly identical as the type <code>Int -&gt; Int -&gt; Int -&gt; Int</code> is implicitly bracketed as <code>Int -&gt; (Int -&gt; (Int -&gt; Int))</code>.</p>\n\n<p>You can use your operator like this</p>\n\n<pre><code>(1 ### 2) 3\n</code></pre>\n\n<p>or</p>\n\n<pre><code>1 ### 2 $ 3\n</code></pre>\n"}], "owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 28126004, "answer_count": 1, "score": 0, "last_activity_date": 1422106364, "creation_date": 1422105723, "last_edit_date": 1422106166, "question_id": 28125891, "link": "https://stackoverflow.com/questions/28125891/can-operator-return-a-function", "title": "Can operator return a function?", "body": "<p>I learn Haskell.</p>\n\n<p>This is not <em>an operator</em>, because an operator must to have <em>two</em> parameters:</p>\n\n<pre><code>(###) :: Int -&gt; Int -&gt; Int -&gt; Int\n(###) a b c = a + b + c\n</code></pre>\n\n<p>But what about this case:</p>\n\n<pre><code>(###) :: Int -&gt; Int -&gt; (Int -&gt; Int)\n(###) a b = \\c -&gt; a + b + c\n</code></pre>\n\n<p>This function has two parameters, but returns a function... Is it an <em>operator</em> now? I think it is not an operator still, because second variant is partial applied first. But I am not sure I am right. Can operator return a function?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "edited": false, "score": 0, "creation_date": 1422106269, "post_id": 28125418, "comment_id": 44625102, "body": "Thank you for your answer, Paired with Yuras&#39;s answer it&#39;s really helped me understand."}], "tags": [], "owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "is_accepted": false, "score": 0, "last_activity_date": 1422102255, "creation_date": 1422102255, "answer_id": 28125418, "question_id": 28125257, "link": "https://stackoverflow.com/questions/28125257/haskell-error-occurs-check-cannot-construct-the-infinite-type-t-t/28125418#28125418", "title": "Haskell Error; Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>Let's rewrite what you have to make clearer why this won't typecheck. We first desugar the do notation to get</p>\n\n<pre><code>sub :: Int -&gt; [Int]\nsub 5 = [1]\nsub x = sub (x-1) &gt;&gt;= \\xs -&gt; (x:xs)\n</code></pre>\n\n<p>Now recall how <code>&gt;&gt;=</code> is defined for lists: <code>ys &gt;&gt;= f = concat (map f ys)</code>. Here <code>f</code> is <code>\\xs -&gt; (x:xs)</code> and <code>ys</code> is <code>sub (x-1)</code>, so therefore we have:</p>\n\n<pre><code>sub :: Int -&gt; [Int]\nsub 5 = [1]\nsub x = concat (map (\\xs -&gt; (x:xs)) (sub (x-1)))\n</code></pre>\n\n<p>The type of <code>sub (x-1)</code> is <code>[Int]</code>, so the first argument to <code>map</code> must be a function that takes an <code>Int</code>. It is not - it expects a list!</p>\n\n<p>As you say, you used to have <code>sub 5 = return [1]</code>. Recall that for lists <code>return y = [y]</code>, so in that case your <code>sub</code> would have signature <code>Int -&gt; [[Int]]</code>. Now <code>sub (x-1)</code> in the above would be a list of lists, and the first argument to <code>map</code> should be a function that takes <em>lists</em>, which is indeed the case. So things typechecked.</p>\n\n<p>A piece of advice: Give your top-level definitions explicit signatures (is it <code>sub :: Int -&gt; [Int]</code> or <code>sub :: Int -&gt; [[Int]]</code> that you want?)! It'll make it easier to understand what's going on because it forces you to think about what you actually want.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "edited": false, "score": 0, "creation_date": 1422106221, "post_id": 28125447, "comment_id": 44625094, "body": "Thank you very much for the answer, Yuras. I understand the errors a bit better now, still have no clue how to fix it. But i&#39;ll try a few things later. Thanks again!"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 3, "last_activity_date": 1422102502, "creation_date": 1422102502, "answer_id": 28125447, "question_id": 28125257, "link": "https://stackoverflow.com/questions/28125257/haskell-error-occurs-check-cannot-construct-the-infinite-type-t-t/28125447#28125447", "title": "Haskell Error; Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>I'll try to expand what the error means.</p>\n\n<p>Lets desugar do notation (<a href=\"http://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow\">details</a>):</p>\n\n<pre><code>sub 5 =  [1]\nsub x =\n        sub (x - 1) &gt;&gt;= \\xs -&gt;\n        (x:xs)  \n</code></pre>\n\n<p>The <code>&gt;&gt;=</code> operator has the next type (see <a href=\"https://www.haskell.org/hoogle/?hoogle=%28%3E%3E=%29\" rel=\"nofollow\">here</a>):</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>The first its argument, <code>sub (x - 1)</code>, has type <code>[Int]</code>, so we can instantiate type variables <code>m</code> to <code>[]</code> and <code>a</code> to <code>Int</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: [Int] -&gt; (Int -&gt; [b]) -&gt; [b]\n</code></pre>\n\n<p>(Note that <code>[a]</code> is a special syntax for list type, you can read it as <code>[] a</code>)</p>\n\n<p>So the second argument, <code>\\xs -&gt; (x:xs)</code>, should have type <code>Int -&gt; [b]</code>. It should be clear now that <code>xs</code> has type <code>Int</code>, not <code>[Int]</code> as you seems to expect.</p>\n\n<p>Now lets consider <code>:</code>. Its type is <code>c -&gt; [c] -&gt; [c]</code>. Let write down all constrains:</p>\n\n<pre><code>(:)     :: c -&gt; [c] -&gt; [c]\nx       :: Int\nxs      :: Int\nx : xs  :: [Int]\n</code></pre>\n\n<p>They can't be satisfied at the same time because they require <code>c</code> and <code>[c]</code> both to be <code>Int</code>.</p>\n"}], "owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 431, "favorite_count": 0, "accepted_answer_id": 28125447, "answer_count": 2, "score": 0, "last_activity_date": 1422102502, "creation_date": 1422100903, "question_id": 28125257, "link": "https://stackoverflow.com/questions/28125257/haskell-error-occurs-check-cannot-construct-the-infinite-type-t-t", "title": "Haskell Error; Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>I asked a few questions yesterday and more and more problems kept creeping up in my code. </p>\n\n<p>I have a function called sub. Sub takes in a number and outputs a list of numbers, the code is below.</p>\n\n<pre><code>sub 5 =  [1]\nsub x =\n    do \n        xs &lt;- sub (x - 1)\n        (x:xs)  \n</code></pre>\n\n<p>I used to have to where on the top line had sub 5 = return [1] and on the bottom line, return (x:xs). Someone answered yesterday and told me to take these out as it's putting a list within a list, like so [[int]]. If I take out  the returns this generates an error (In the question title), I really can't get my head around this.</p>\n\n<p>Just wondering if anyone can make sense of it,</p>\n\n<p>Thanks </p>\n"}, {"tags": ["haskell", "warnings", "ghc", "compiler-warnings"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 5, "creation_date": 1422099683, "post_id": 28125038, "comment_id": 44623489, "body": "Indent the definitions accordingly and you&#39;re fine."}, {"owner": {"reputation": 53, "user_id": 4256416, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2c9944d676ee69805419e5548dd507b8?s=128&d=identicon&r=PG&f=1", "display_name": "user12345678", "link": "https://stackoverflow.com/users/4256416/user12345678"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1422100733, "post_id": 28125038, "comment_id": 44623739, "body": "looks like im blind because i dont see the mistake"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1422100959, "post_id": 28125038, "comment_id": 44623786, "body": "Put two spaces in front of every definition."}, {"owner": {"reputation": 53, "user_id": 4256416, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2c9944d676ee69805419e5548dd507b8?s=128&d=identicon&r=PG&f=1", "display_name": "user12345678", "link": "https://stackoverflow.com/users/4256416/user12345678"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1422101042, "post_id": 28125038, "comment_id": 44623806, "body": "ohh yeah... thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "is_accepted": false, "score": 6, "last_activity_date": 1422106044, "last_edit_date": 1422106044, "creation_date": 1422105357, "answer_id": 28125833, "question_id": 28125038, "link": "https://stackoverflow.com/questions/28125038/no-explict-implementation-warning/28125833#28125833", "title": "No explict implementation warning", "body": "<p>As @ThreeFx mentioned, indentation is important.</p>\n\n<p>What you wrote in your question is equivalent to:</p>\n\n<pre><code>instance Stack [] where\n-- no implementation here\n\n-- ordinary functions:\npush b bs = b:bs\ntop [] = mzero\ntop (b:bs) = return(b,bs)\nempty = []\nisEmpty [] = True\nisEmpty _ = False\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 4256416, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2c9944d676ee69805419e5548dd507b8?s=128&d=identicon&r=PG&f=1", "display_name": "user12345678", "link": "https://stackoverflow.com/users/4256416/user12345678"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1341, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1422127439, "creation_date": 1422099181, "last_edit_date": 1422127439, "question_id": 28125038, "link": "https://stackoverflow.com/questions/28125038/no-explict-implementation-warning", "title": "No explict implementation warning", "body": "<p>I defined a class Stack like this</p>\n\n<pre><code>class Stack stack where\n  push :: a -&gt; stack a -&gt; stack a\n  top :: MonadPlus m =&gt; stack a -&gt; m (a,stack a)\n  empty :: stack a\n  isEmpty :: stack a -&gt; Bool\n</code></pre>\n\n<p>but when i implement the methods</p>\n\n<pre><code>instance Stack [] where\npush b bs = b:bs\ntop [] = mzero\ntop (b:bs) = return(b,bs)\nempty = []\nisEmpty [] = True\nisEmpty _ = False\n</code></pre>\n\n<p>i get this warning:</p>\n\n<pre><code>Warning: No explicit implementation for\n  `Types.push', `Types.top', `Types.empty', and `Types.isEmpty'\nIn the instance declaration for `Stack []'\n</code></pre>\n\n<p>I have no idea why this warning is showing up. I read that it could be sth. with the indention but i dont have a clue what could be wrong about that.</p>\n"}, {"tags": ["haskell", "monads", "maybe", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1422112022, "post_id": 28124953, "comment_id": 44626702, "body": "Perhaps clarify for the benefit of others that he&#39;d have to wrap the <code>IO (Maybe Int)</code> computation in the <code>MaybeT</code> constructor"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 8, "last_activity_date": 1422116219, "last_edit_date": 1422116219, "creation_date": 1422098525, "answer_id": 28124953, "question_id": 28124844, "link": "https://stackoverflow.com/questions/28124844/refactoring-staircasing-with-case-of-maybe-values-in-io-code/28124953#28124953", "title": "Refactoring \u201cstaircasing\u201d with case of `Maybe` values in `IO` code", "body": "<p>You can use <code>MaybeT</code> and the <code>MonadPlus</code> instance to use <code>msum</code>:</p>\n\n<pre><code>f :: MaybeT IO Int\nf = msum [readInt, readInt, readInt]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1422098548, "creation_date": 1422098548, "answer_id": 28124956, "question_id": 28124844, "link": "https://stackoverflow.com/questions/28124844/refactoring-staircasing-with-case-of-maybe-values-in-io-code/28124956#28124956", "title": "Refactoring \u201cstaircasing\u201d with case of `Maybe` values in `IO` code", "body": "<p>First of all,</p>\n\n<pre><code>n2 &lt;- readInt\ncase n2 of\n      Just n' -&gt; return (Just n')\n      Nothing -&gt; return Nothing\n</code></pre>\n\n<p>is really just <code>readInt</code>. You are picking apart a <code>Maybe</code> value in order to put together the same one.</p>\n\n<p>For the rest, I think the most succinct way in this case is to use the <code>maybe</code> function.  Then you can get just</p>\n\n<pre><code>f = maybe readInt (return . Just) =&lt;&lt; readInt\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1422098890, "creation_date": 1422098890, "answer_id": 28125004, "question_id": 28124844, "link": "https://stackoverflow.com/questions/28124844/refactoring-staircasing-with-case-of-maybe-values-in-io-code/28125004#28125004", "title": "Refactoring \u201cstaircasing\u201d with case of `Maybe` values in `IO` code", "body": "<p>You need the alternative instance for <code>MaybeT</code>:</p>\n\n<pre><code>instance (Functor m, Monad m) =&gt; Alternative (MaybeT m) where\n    empty = mzero\n    (&lt;|&gt;) = mplus\n\ninstance (Monad m) =&gt; MonadPlus (MaybeT m) where\n    mzero = MaybeT (return Nothing)\n    mplus x y = MaybeT $ do\n        v &lt;- runMaybeT x\n        case v of\n            Nothing -&gt; runMaybeT y\n            Just _  -&gt; return v\n</code></pre>\n\n<p>I.e. compute the first argument and return the value if it's <code>Just</code>, otherwise compute the second argument and return the value.</p>\n\n<p>The code:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport Control.Monad.Trans.Maybe\nimport Text.Read\n\nreadInt :: MaybeT IO Int\nreadInt = MaybeT $ readMaybe &lt;$&gt; getLine \n\nmain = runMaybeT (readInt &lt;|&gt; readInt) &gt;&gt;= print\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1422101573, "creation_date": 1422101573, "answer_id": 28125337, "question_id": 28124844, "link": "https://stackoverflow.com/questions/28124844/refactoring-staircasing-with-case-of-maybe-values-in-io-code/28125337#28125337", "title": "Refactoring \u201cstaircasing\u201d with case of `Maybe` values in `IO` code", "body": "<p>Another way of doing this is with the <a href=\"http://hackage.haskell.org/package/free-4.10.0.1/docs/Control-Monad-Trans-Iter.html\" rel=\"nofollow\">iterative monad transformer</a> from the <code>free</code> package.</p>\n\n<pre><code>import Control.Monad.Trans.Iter (untilJust,retract,cutoff,IterT)\n\nreadInt :: IO (Maybe Int)\nreadInt = undefined\n\nf' :: IterT IO Int\nf' = untilJust readInt\n\nf :: IO (Maybe Int)\nf = (retract . cutoff 2) f'\n</code></pre>\n\n<p>Where <a href=\"http://hackage.haskell.org/package/free-4.10.0.1/docs/Control-Monad-Trans-Iter.html#v:cutoff\" rel=\"nofollow\"><code>cutoff</code></a> specifies the maximum number of retries.</p>\n\n<p>The advantage of this approach is that you can easily <a href=\"https://gist.github.com/danidiaz/e9382127d1c4025b9845\" rel=\"nofollow\">interleave other repeated actions</a> with <code>f'</code>, thanks to the <code>MonadPlus</code> instance of <code>IterT</code>. Logging actions for example, or wait actions.</p>\n"}], "owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "accepted_answer_id": 28124953, "answer_count": 4, "score": 7, "last_activity_date": 1422116219, "creation_date": 1422097788, "last_edit_date": 1422099119, "question_id": 28124844, "link": "https://stackoverflow.com/questions/28124844/refactoring-staircasing-with-case-of-maybe-values-in-io-code", "title": "Refactoring \u201cstaircasing\u201d with case of `Maybe` values in `IO` code", "body": "<p>The following function <code>f</code> attempts to read an <code>Int</code> twice by using an <code>IO (Maybe Int)</code> function twice, but \u201cshort-circuits\u201d execution after successfully reading one <code>Int</code>:</p>\n\n<pre><code>readInt :: IO (Maybe Int)\n\nf :: IO (Maybe Int)\nf = do\n  n1 &lt;- readInt\n  case n1 of\n      Just n' -&gt; return (Just n')\n      Nothing -&gt; do\n        n2 &lt;- readInt\n        case n2 of\n              Just n' -&gt; return (Just n')\n              Nothing -&gt; return Nothing\n</code></pre>\n\n<p>Is there a good way to refactor this code? This would get very hairy if I extended it to three attempts\u2026</p>\n\n<p>(My thought process: Seeing this \u201cstaircasing\u201d tells me that maybe I should be using the <code>Monad</code> instance of <code>Maybe</code>, but since this is already in the <code>IO</code> monad, I would then have to use <code>MaybeT</code>(?). However, I only need <em>one</em> of the <code>readInt</code> to succeed, so the <code>Maybe</code> monad's behaviour of erroring out on the first <code>Nothing</code> would be wrong here...)</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1422097859, "post_id": 28124825, "comment_id": 44623033, "body": "thank you, I was about to post the whole <code>ghc --info</code> but I see that is not necessary :)"}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 5, "last_activity_date": 1422097672, "creation_date": 1422097672, "answer_id": 28124825, "question_id": 28124633, "link": "https://stackoverflow.com/questions/28124633/ghc-7-8-3-not-producing-binary/28124825#28124825", "title": "GHC 7.8.3 not producing binary", "body": "<p>Your problem is the module name. GHC expects a function named <code>main</code> in a module named <code>Main</code> as a default. You can override this with the <code>-main-is</code> option. As in</p>\n\n<pre><code>ghc -O2 -main-is Test --make Test.hs\n</code></pre>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 28124825, "answer_count": 1, "score": 1, "last_activity_date": 1422097672, "creation_date": 1422096334, "question_id": 28124633, "link": "https://stackoverflow.com/questions/28124633/ghc-7-8-3-not-producing-binary", "title": "GHC 7.8.3 not producing binary", "body": "<p>No binary is produced when I <code>ghc -O2 --make Test.hs</code>, but only the .o and .hi files.\nTest.hs contains a <code>main :: IO ()</code> function and has module name <code>Test</code>.</p>\n\n<p>Is the linker not behaving? How can I fix this?\nI'm using GHC 7.8.3 on OSX, have Apple LLVM version 5.0 (clang-500.2.79) (based on LLVM 3.3svn) Target: x86_64-apple-darwin13.4.0</p>\n\n<p>Thank you in advance for any hints</p>\n"}, {"tags": ["json", "haskell", "haskell-lens", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 14, "last_activity_date": 1422093379, "last_edit_date": 1422093379, "creation_date": 1422092707, "answer_id": 28124183, "question_id": 28123867, "link": "https://stackoverflow.com/questions/28123867/aeson-and-lens-with-derivegeneric-and-makelenses-names-dont-line-up/28124183#28124183", "title": "Aeson and Lens with DeriveGeneric and makeLenses - names don&#39;t line up", "body": "<p>Both <code>lens</code> and <code>aeson</code> have functions to allow customizable handling of field and constructor names. Since <code>aeson</code>'s default is not what you want, and wouldn't work anyway if you want the lens names to be the same as the JSON field names, let's change the <code>aeson</code> configuration:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport GHC.Generics\nimport Data.Text hiding (drop)\nimport Data.Aeson\nimport Data.Aeson.TH\nimport Data.Aeson.Types\nimport Control.Lens\n\ndata Person = Person {\n    _firstName :: Text,\n    _lastName  :: Text,\n    _age       :: Int\n} deriving (Show, Generic)\n\nmakeLenses ''Person\n\nderiveJSON defaultOptions{fieldLabelModifier = drop 1} ''Person\n\n{- alternative Generic version\ninstance FromJSON Person where\n    parseJSON = genericParseJSON defaultOptions{fieldLabelModifier = drop 1}\ninstance ToJSON Person where\n    toJSON = genericToJSON defaultOptions{fieldLabelModifier = drop 1}\n-}\n</code></pre>\n\n<p>For <code>lens</code>, the corresponding configurable function would be <a href=\"http://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-TH.html#v:makeLensesWith\"><code>makeLensesWith</code></a>.</p>\n"}], "owner": {"reputation": 9174, "user_id": 64923, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfab0edbc971a92ada9c0d74bf93cc42?s=128&d=identicon&r=PG", "display_name": "James Davies", "link": "https://stackoverflow.com/users/64923/james-davies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 725, "favorite_count": 1, "accepted_answer_id": 28124183, "answer_count": 1, "score": 8, "last_activity_date": 1422093379, "creation_date": 1422089883, "question_id": 28123867, "link": "https://stackoverflow.com/questions/28123867/aeson-and-lens-with-derivegeneric-and-makelenses-names-dont-line-up", "title": "Aeson and Lens with DeriveGeneric and makeLenses - names don&#39;t line up", "body": "<p>Let's say I have a type <code>Person</code></p>\n\n<pre><code>import GHC.Generics\nimport Data.Text\nimport Data.Aeson\nimport Control.Lens\n\ndata Person = Person {\n    _firstName :: Text,\n    _lastName  :: Text,\n    _age       :: Int\n} deriving (Show, Generic)\n</code></pre>\n\n<p>And I want to automatically derive Lenses and JSON typeclasses for it</p>\n\n<pre><code>makeLenses ''Person\ninstance FromJSON Person\ninstance ToJSON Person\n</code></pre>\n\n<p>This works correctly, however DeriveGeneric sees my field names as having an underscore and expects my JSON to be formatted accordingly.</p>\n\n<pre><code>{ \"_firstName\": \"James\" ... etc} -- The underscore doesn't belong here.\n</code></pre>\n\n<p>Obviously I could remove the underscore from the <code>data</code> definition itself, but then <code>makeLenses</code> wouldn't be able to derive the required getters and setters.</p>\n\n<p>Ideally what I want to be able to do is something like this</p>\n\n<pre><code>let person = decode blob\nlet name = person ^. firstName\n</code></pre>\n\n<p>i.e. I want to be able to derive lenses and JSON instances with all field names lining up correctly with the values in the JSON-REST Api I'm consuming, without having to write much boilerplate.</p>\n\n<p>This seems like such a straight forward thing that I feel I'm missing something obvious?</p>\n"}, {"tags": ["haskell", "rust", "traits"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 8, "creation_date": 1422137557, "post_id": 28123453, "comment_id": 44634336, "body": "I don&#39;t know much about Rust. But common stumbling blocks for similar technologies in other languages are higher kinds (e.g. can traits range over parameterized types, but not their parameters?) and return-type polymorphism (e.g. can a trait type appear in the result of a function, but not anywhere in the arguments?). An example of the former in Haskell is <code>class Functor f where fmap :: (a -&gt; b) -&gt; (f a -&gt; f b)</code>; an example of the latter is <code>class Bounded a where maxBound :: a</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1422138076, "post_id": 28123453, "comment_id": 44634475, "body": "GHC also supports multi-parameter type classes (that is, traits involving several types) and functional dependencies, though this is not a part of the official Haskell specification. Judging from the Rust syntax suggested at your link, it can only support traits ranging over one type at a time, though that judgment is again not based on deep experience."}, {"owner": {"user_type": "does_not_exist", "display_name": "user395760"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1422153520, "post_id": 28123453, "comment_id": 44637733, "body": "@DanielWagner Return-type polymorphism exists (e.g. <code>std::default</code>), and multiparameter traits sort-of work (including an analogue of functional dependencies), though AFAIK one needs to work around the first parameter being privileged. No HKT however. They&#39;re on the far-future wishlist but not on the horizon yet."}, {"owner": {"reputation": 22050, "user_id": 497364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8fd4eb2ae966a16e698b3e61217a7e1?s=128&d=identicon&r=PG", "display_name": "Paolo Falabella", "link": "https://stackoverflow.com/users/497364/paolo-falabella"}, "edited": false, "score": 4, "creation_date": 1422285015, "post_id": 28123453, "comment_id": 44676964, "body": "another difference is the treatment of orphan instances. Rust tries to have stricter coherence rules on where a new impl for a trait can be written. See <a href=\"http://discuss.rust-lang.org/t/orphan-rules/1322\" rel=\"nofollow noreferrer\">this discussion</a> for more detail (in particular <a href=\"http://discuss.rust-lang.org/t/orphan-rules/1322/7\" rel=\"nofollow noreferrer\">here</a> )"}, {"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 1, "creation_date": 1422311283, "post_id": 28123453, "comment_id": 44691190, "body": "Rust supports <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0195-associated-items.md\" rel=\"nofollow noreferrer\">associated types and equality constraints</a> now, though they aren&#39;t as powerful as Haskell&#39;s type families. It also has existential types via <a href=\"https://github.com/rust-lang/rust-guidelines/blob/master/features/traits/objects.md\" rel=\"nofollow noreferrer\">trait objects</a>."}, {"owner": {"reputation": 25688, "user_id": 172531, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/16b8a9971551c67422fea478a6e73bae?s=128&d=identicon&r=PG", "display_name": "sellibitze", "link": "https://stackoverflow.com/users/172531/sellibitze"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1424352567, "post_id": 28123453, "comment_id": 45519242, "body": "@DanielWagner: I think parameterized traits qualify as something similar to multi-parameter type classes. <code>Self</code> is just another \u201cinput parameter\u201d that gets a bit of special treatment and is implicit."}, {"owner": {"reputation": 8277, "user_id": 1682419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19B6c.png?s=128&g=1", "display_name": "Jerry101", "link": "https://stackoverflow.com/users/1682419/jerry101"}, "edited": false, "score": 0, "creation_date": 1424589050, "post_id": 28123453, "comment_id": 45607416, "body": "I don&#39;t know enough about Haskell type classes to compare, but here&#39;s the Rust reference on traits <a href=\"http://doc.rust-lang.org/reference.html#traits\" rel=\"nofollow noreferrer\">doc.rust-lang.org/reference.html#traits</a> (it&#39;s currently out of date) and the accepted + partially implemented RFC to add associated items to traits <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0195-associated-items.md\" rel=\"nofollow noreferrer\">github.com/rust-lang/rfcs/blob/master/text/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 2, "creation_date": 1554942207, "post_id": 29388580, "comment_id": 97938900, "body": "Traits in Rust do not &quot;only intervene for expressions with dot notation&quot;. For example, consider the <code>Default</code> trait which has no methods, only non-method associated functions."}], "tags": [], "owner": {"reputation": 121, "user_id": 4716257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18cf30545c1f8fbedccc373cbdd19b5?s=128&d=identicon&r=PG&f=1", "display_name": "Anuj Gupta", "link": "https://stackoverflow.com/users/4716257/anuj-gupta"}, "is_accepted": false, "score": 8, "last_activity_date": 1427884519, "creation_date": 1427884519, "answer_id": 29388580, "question_id": 28123453, "link": "https://stackoverflow.com/questions/28123453/what-is-the-difference-between-traits-in-rust-and-typeclasses-in-haskell/29388580#29388580", "title": "What is the difference between traits in Rust and typeclasses in Haskell?", "body": "<p>Rust's \u201ctraits\u201d are analogous to Haskell's type classes.</p>\n\n<p>The main difference with Haskell is that traits only intervene for expressions with dot notation, i.e. of the form a.foo(b).</p>\n\n<p>Haskell type classes extend to higher-order types. Rust traits only don't support higher order types because they are missing from the whole language, i.e. it's not a philosophical difference between traits and type classes</p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 4, "creation_date": 1554941960, "post_id": 32659986, "comment_id": 97938845, "body": "Rust still does not have any form of higher kinded types. &quot;Infamous&quot; needs justification. Functor are incredibly pervasive and useful as a concept. Type families are the same as associated types. Functional dependencies are essentially redundant with associated types (including in Haskell). The thing Rust lacks wrt. fundeps is injectivity annotations. You have it backwards, Rust&#39;s traits and Haskell&#39;s type classes are different on the surface but many differences evaporate when you look beneath. Differences that remain are mostly inherent to the different domains the languages operate in."}, {"owner": {"reputation": 706, "user_id": 2640937, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2bdde9ada4ed0bf5df04bad03a51642d?s=128&d=identicon&r=PG", "display_name": "Vaelus", "link": "https://stackoverflow.com/users/2640937/vaelus"}, "edited": false, "score": 0, "creation_date": 1571058300, "post_id": 32659986, "comment_id": 103103557, "body": "Associated items are now considered idomatic in many circumstances, right?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 706, "user_id": 2640937, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2bdde9ada4ed0bf5df04bad03a51642d?s=128&d=identicon&r=PG", "display_name": "Vaelus", "link": "https://stackoverflow.com/users/2640937/vaelus"}, "edited": false, "score": 0, "creation_date": 1571086591, "post_id": 32659986, "comment_id": 103115976, "body": "@Vaelus You&#39;re right\u2014This answer should be updated a bit. Editing now."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 69, "last_activity_date": 1571086952, "last_edit_date": 1571086952, "creation_date": 1442605838, "answer_id": 32659986, "question_id": 28123453, "link": "https://stackoverflow.com/questions/28123453/what-is-the-difference-between-traits-in-rust-and-typeclasses-in-haskell/32659986#32659986", "title": "What is the difference between traits in Rust and typeclasses in Haskell?", "body": "<p>At the basic level, there's not much difference, but they're still there.</p>\n\n<p>Haskell describes functions or values defined in a typeclass as 'methods', just as traits describe OOP methods in the objects they enclose. However, Haskell deals with these differently, treating them as individual values rather than pinning them to an object as OOP would lead one to do. This is about the most obvious surface-level difference there is.</p>\n\n<p>The one thing that Rust could not do for a while was <em>higher-order typed traits</em>, such as the infamous <code>Functor</code> and <code>Monad</code> typeclasses.</p>\n\n<p>This means that Rust traits could only describe what's often called a 'concrete type', in other words, one without a generic argument. Haskell from the start could make higher-order typeclasses which use types similar to how higher-order functions use other functions: using one to describe another. For a period of time this was not possible in Rust, but since <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0195-associated-items.md#encoding-higher-kinded-types\" rel=\"noreferrer\">associated items</a> have been implemented, such traits have become commonplace and idiomatic.</p>\n\n<p>So if we ignore extensions, they are not exactly the same, but each can approximate what the other can do.</p>\n\n<p>It is also mentionable, as said in the comments, that GHC (Haskell's principal compiler) supports further options for typeclasses, including <a href=\"https://wiki.haskell.org/Multi-parameter_type_class\" rel=\"noreferrer\">multi-parameter</a> (i.e. many types involved) typeclasses, and <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"noreferrer\">functional dependencies</a>, a lovely option that allows for type-level computations, and leads on to <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"noreferrer\">type families</a>. To my knowledge, Rust has neither funDeps or type families, though it may in the future.\u2020</p>\n\n<p>All in all, traits and typeclasses have fundamental differences, which due to the way they interact, make them act and seem quite similar in the end.</p>\n\n<hr>\n\n<p></p>\n\n<p>\u2020 A nice article on Haskell's typeclasses (including higher-typed ones) can be found <a href=\"https://www.haskell.org/tutorial/classes.html\" rel=\"noreferrer\">here</a>, and the Rust by Example chapter on traits may be found <a href=\"https://doc.rust-lang.org/stable/rust-by-example/trait.html\" rel=\"noreferrer\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 3, "creation_date": 1554942563, "post_id": 45576167, "comment_id": 97938965, "body": "&quot;Type classes create no types&quot; -- I think it is best to understand <code>dyn Trait</code> as a form of existential typing as they relate to traits/type-classes. We can consider <code>dyn</code> an operator on bounds projecting them to types, i.e. <code>dyn : List Bound -&gt; Type</code>. Taking this idea to Haskell, and with regards to &quot;so you can&#39;t declare variables with the class name.&quot;, we can do this indirectly in Haskell: <code>data Dyn (c :: * -&gt; Constraint) = forall (t :: Type). c t =&gt; D t</code>. Having defined this, we may work with <code>[D True, D &quot;abc&quot;, D 42] :: [D Show]</code>."}, {"owner": {"reputation": 619, "user_id": 4996524, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5b7910ac129ed37a15e32deb4a2c3bd9?s=128&d=identicon&r=PG&f=1", "display_name": "YoTengoUnLCD", "link": "https://stackoverflow.com/users/4996524/yotengounlcd"}, "edited": false, "score": 0, "creation_date": 1607892123, "post_id": 45576167, "comment_id": 115408813, "body": "@Lii so traits are type classes that just also happen to implicitly define an existential type? That&#39;s not a big difference."}], "tags": [], "owner": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "is_accepted": false, "score": 22, "last_activity_date": 1576000741, "last_edit_date": 1576000741, "creation_date": 1502218929, "answer_id": 45576167, "question_id": 28123453, "link": "https://stackoverflow.com/questions/28123453/what-is-the-difference-between-traits-in-rust-and-typeclasses-in-haskell/45576167#45576167", "title": "What is the difference between traits in Rust and typeclasses in Haskell?", "body": "<p>I think the current answers overlook the most fundamental differences between Rust traits and Haskell type classes. These differences have to do with the way traits are related to object oriented language constructs. For information about this, see the <a href=\"https://doc.rust-lang.org/book/ch17-02-trait-objects.html\" rel=\"noreferrer\">Rust book</a>.</p>\n\n<ol>\n<li><p><strong>A trait declaration creates a trait type</strong>. This means that you can declare variables of such a type (or rather, references of the type). You can also use trait types as parameters on function, struct fields and type parameter instantiations.</p>\n\n<p>A trait reference variable can at runtime contain objects of different types, as long as the runtime type of the referenced object implements the trait.</p>\n\n<pre><code>// The shape variable might contain a Square or a Circle, \n// we don't know until runtime\nlet shape: &amp;Shape = get_unknown_shape();\n\n// Might contain different kinds of shapes at the same time\nlet shapes: Vec&lt;&amp;Shape&gt; = get_shapes();\n</code></pre>\n\n<p>This is not how type classes work. <strong>Type classes create no types</strong>, so you can't declare variables with the class name. <strong>Type classes act as bounds</strong> on type parameters, but the type parameters must be instantiated with a concrete type, not the type class itself.</p>\n\n<p>You can not have a list of different things of different types which implement the same type class. (Instead, existential types are used in Haskell to express a similar thing.) <sup><em>Note 1</em></sup></p></li>\n<li><p><strong>Trait methods can be dynamically dispatched</strong>. This is strongly related to the things that are described in the section above.</p>\n\n<p>Dynamic dispatch means that the runtime type of the object a reference points is used to determine which method that is called though the reference.</p>\n\n<pre><code>let shape: &amp;Shape = get_unknown_shape();\n\n// This calls a method, which might be Square.area or\n// Circle.area depending on the runtime type of shape\nprint!(\"Area: {}\", shape.area());\n</code></pre>\n\n<p>Again, existential types are used for this in Haskell.</p></li>\n</ol>\n\n<h3>In Conclusion</h3>\n\n<p>It seems to me like traits are in many aspects the same concept as type classes. It addition, they have the functionality of object oriented interfaces.</p>\n\n<p>On the other hand Haskell's type classes are more advanced. Haskell has for example higher-kinded types and extension like multi-parameter type classes.</p>\n\n<hr>\n\n<p><em>Note 1</em>: Recent versions of Rust have an update to differentiate the usage of trait names as types and the usage of trait names as bounds. In a trait type the name is prefixed by the <code>dyn</code> keyword. See for example this <a href=\"https://stackoverflow.com/questions/50650070/what-does-dyn-mean-in-a-type\">answer</a> for more information.</p>\n"}], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15876, "favorite_count": 33, "accepted_answer_id": 32659986, "answer_count": 3, "score": 172, "last_activity_date": 1576000741, "creation_date": 1422085844, "last_edit_date": 1445119771, "question_id": 28123453, "link": "https://stackoverflow.com/questions/28123453/what-is-the-difference-between-traits-in-rust-and-typeclasses-in-haskell", "title": "What is the difference between traits in Rust and typeclasses in Haskell?", "body": "<p><a href=\"http://rustbyexample.com/trait.html\">Traits</a> in Rust seem at least superficially similar to <a href=\"http://en.wikipedia.org/wiki/Type_class\">typeclasses</a> in Haskell, however I've seen people write that there are some differences between them. I was wondering exactly what these differences are.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1422070101, "post_id": 28121903, "comment_id": 44617980, "body": "Show us enough code that we can reproduce it for ourselves."}], "answers": [{"comments": [{"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1422084311, "post_id": 28122778, "comment_id": 44620294, "body": "You are correct and it turns out I just did something stupid. I split one module into 2 separate ones, where the import wasn&#39;t needed anymore. The warning was telling me that I wasn&#39;t even using Data.Set at all. Which I didn&#39;t notice until I removed it and it compiled fine. Thanks, that was a really silly thing to be stumped by."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471400982, "post_id": 28122778, "comment_id": 65326984, "body": "Is there any way to know <i>which</i> other module exports the module?"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471509277, "post_id": 28122778, "comment_id": 65377741, "body": "@bergi I would say &quot;try and see&quot; or looking at libraries source code. I don\u2019t know any compiler option that could help you (but I don\u2019t know every compiler option ;-)."}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 6, "last_activity_date": 1422079050, "creation_date": 1422079050, "answer_id": 28122778, "question_id": 28121903, "link": "https://stackoverflow.com/questions/28121903/warning-the-import-of-module-is-redundant-except-perhaps-to-import-instances/28122778#28122778", "title": "Warning: The import of `Module` is redundant except perhaps to import instances from `Module`", "body": "<p>It generally means either :</p>\n\n<ul>\n<li>you import a module but you don\u2019t use it at all,</li>\n<li>you import a module that is already imported by another module you import.</li>\n</ul>\n\n<p>It may be the effect of some refactoring where you don\u2019t use the module anymore. Or maybe you\u2019ve anticipated the future use of this module by importing it.</p>\n\n<p>This message is generated when you compile your project using the <code>-Wall</code> option.</p>\n\n<p>Try to delete the line which shows the error, it often works ;-)</p>\n"}], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1765, "favorite_count": 0, "accepted_answer_id": 28122778, "answer_count": 1, "score": 4, "last_activity_date": 1422079050, "creation_date": 1422069183, "question_id": 28121903, "link": "https://stackoverflow.com/questions/28121903/warning-the-import-of-module-is-redundant-except-perhaps-to-import-instances", "title": "Warning: The import of `Module` is redundant except perhaps to import instances from `Module`", "body": "<p>I've recently started coding in Sublime Text. This has brought to my attention some warnings I didn't notice when I used Leksah. So I got this one:</p>\n\n<pre><code>import qualified Data.Set as S\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>Warning:\n  The qualified import of `Data.Set' is redundant\n    except perhaps to import instances from `Data.Set'\n  To import instances alone, use: import Data.Set()\n</code></pre>\n\n<p>On the other hand, either of these two imports from <code>Data.Foldable</code> don't give any warnings:</p>\n\n<pre><code>import Data.Foldable (foldrM, mapM_,foldr,foldl',concat)\n-- or\nimport Data.Foldable\n</code></pre>\n\n<p>So I'm not really sure what the warning for Data.Set means. I would expect \"redundant\" means that it's not necessary. If I remove the import it doesn't compile because I'm using a lot of things for Data.Set.</p>\n\n<p>Meanwhile sitting next to it is <code>import qualified Data.Map as M</code> which also gives no warnings.</p>\n\n<p>So I'm completely confused about what that warning is saying.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1422068789, "post_id": 28121839, "comment_id": 44617820, "body": "Look at the type and definition of <code>map</code> for a hint."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 1, "creation_date": 1422068988, "post_id": 28121839, "comment_id": 44617849, "body": "<code>f</code> doesn&#39;t really take 2 arguments, <code>f</code> takes one argument and returns yet another function.  <code>f l</code> is itself a function, which can take an argument (like <code>x</code>).  <code>f</code> is a &quot;curried function&quot;."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1422074203, "post_id": 28121839, "comment_id": 44618608, "body": "Thank you guys, it was a stupid doubt."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 1, "creation_date": 1422121676, "post_id": 28121839, "comment_id": 44629632, "body": "Note that your solution won&#39;t work since <code>f [] x</code> is not handled."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1422126045, "post_id": 28121839, "comment_id": 44631101, "body": "You are right, added all the exhaustive patterns :)"}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1422074721, "post_id": 28121879, "comment_id": 44618705, "body": "Thank you for the insights Pat :)"}], "tags": [], "owner": {"reputation": 1031, "user_id": 326980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d8b642cd8e4b5aad212aef3b4390a1b?s=128&d=identicon&r=PG", "display_name": "Pat Wallace", "link": "https://stackoverflow.com/users/326980/pat-wallace"}, "is_accepted": true, "score": 3, "last_activity_date": 1422068896, "creation_date": 1422068896, "answer_id": 28121879, "question_id": 28121839, "link": "https://stackoverflow.com/questions/28121839/what-is-the-type-of-this-function/28121879#28121879", "title": "what is the type of this function?", "body": "<p>The function passed to map must only take one argument. However a function with more arguments can be partially applied (or <a href=\"http://learnyouahaskell.com/higher-order-functions#curried-functions\" rel=\"nofollow\" title=\"curried\">curried</a>), in which case it returns a new function that only takes the parameters you didn't supply.</p>\n\n<p>So if f is a function that takes 2 arguments (let's call them a and b), then <code>(f l2)</code> returns a new function in which a is already set to be 'l2' so the only thing you need to apply is a value for b. </p>\n\n<p>So f is a two-argument function, and we convert it into a one-argument function to pass it to map.</p>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 28121879, "answer_count": 1, "score": 0, "last_activity_date": 1422126026, "creation_date": 1422068221, "last_edit_date": 1422126026, "question_id": 28121839, "link": "https://stackoverflow.com/questions/28121839/what-is-the-type-of-this-function", "title": "what is the type of this function?", "body": "<p>I have 2 exercises to complete, the first one should create tuples from 2 lists, it's done. <strong>My doubt is on the second exercise</strong></p>\n\n<pre><code>Input\ncreatelist [1,2] ['a','b','c']\n\nOutput\n[[(1,'a'),(1,'b'),(1,'c')],[(2,'a'),(2,'b'),(2,'c')]]\n</code></pre>\n\n<p>On the second exercice, they ask me the type of the function <code>f</code>:</p>\n\n<pre><code>createlist l1 l2 = map (f l2) l1 \n               where f l x = ...\n</code></pre>\n\n<p>to my understanding, the f function here only receives a list (<strong>l2</strong>), why is there 2 arguments in the <strong>f</strong> function bellow?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Thank you all for the insights, i got it to work. </p>\n\n<p>Here it is:</p>\n\n<pre><code>linhaz :: [a] -&gt; [b] -&gt; [[(a,b)]]\nlinhaz [] _ = []\nlinhaz _ [] = []\nlinhaz l1 l2 = map (f l2) l1\n                where \n                    f [] x = []\n                    f l x = (x,head l):(f (tail l) x)\n</code></pre>\n"}, {"tags": ["haskell", "esqueleto"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422070349, "post_id": 28121228, "comment_id": 44618013, "body": "I don&#39;t know this library, and it all looks complicated, but it kind of looks like you need to lift some <code>Maybe</code> stuff to sync up with the SQL stuff. Or the other way &#39;round. I dunno."}], "answers": [{"comments": [{"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1422300092, "post_id": 28143933, "comment_id": 44685547, "body": "I&#39;ve tried all sixteen combinations of having and not having <code>just</code> around each of the four arguments to the two <code>==.</code> operators.  None of them results in compilable code."}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "reply_to_user": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1422307603, "post_id": 28143933, "comment_id": 44689391, "body": "@Sean what&#39;s with the <code>?.</code> ?"}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1422311196, "post_id": 28143933, "comment_id": 44691155, "body": "It&#39;s &quot;to project a field from a Maybe (Entity a)&quot; according to the Esqueleto docs."}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "reply_to_user": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1422338418, "post_id": 28143933, "comment_id": 44699011, "body": "@Sean try flipping those around to <code>^.</code> with the aforementioned combinations of <code>just</code> as well. I know the combinatorics / situation is ridiculous but type-based reasoning in Esqueleto is pretty hard. There&#39;s a fair bit of arbitrary behavior."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422382382, "post_id": 28143933, "comment_id": 44723469, "body": "Is there a saner package everyone should use instead?"}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1422382678, "post_id": 28143933, "comment_id": 44723631, "body": "The only variation using only <code>^.</code> that compiled was to put it on the right-hand side of both <code>==.</code> operators.  That produced a runtime error <code>PersistMarshalError &quot;int64 Expected integer, recevied: PersistNull</code>."}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "edited": false, "score": 0, "creation_date": 1422425274, "post_id": 28143933, "comment_id": 44740145, "body": "Need to fix the type so it mentions that the column may not exist, then fix the query if needs be (possibly with <code>just</code>)"}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422425315, "post_id": 28143933, "comment_id": 44740160, "body": "@dfeuer I haven&#39;t found anything better yet. I&#39;ve tried everything announced on the mailing list. I&#39;m not happy with this either."}], "tags": [], "owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "is_accepted": false, "score": 2, "last_activity_date": 1477515802, "last_edit_date": 1477515802, "creation_date": 1422238610, "answer_id": 28143933, "question_id": 28121228, "link": "https://stackoverflow.com/questions/28121228/cant-write-double-left-join-using-esqueleto/28143933#28143933", "title": "Can&#39;t write double left join using Esqueleto", "body": "<p>Try changing</p>\n\n<pre><code> on (teacher ^. TeacherSchoolId  ==. school   ?. SchoolId)\n</code></pre>\n\n<p>To</p>\n\n<pre><code> on (teacher ^. TeacherSchoolId  ==. just (school   ?. SchoolId))\n</code></pre>\n\n<p>If that doesn't work, slap 'just' on other components of the query expression until it works.</p>\n\n<p>Reference: used Esqueleto recently on a commercial project</p>\n\n<p>Update, 2016/10/26:</p>\n\n<p>I recently encountered this problem. I think it's a Persistent serialization problem interacting with Esqueleto's willingness to pretend the join doesn't produce nullable results.</p>\n\n<p>I recently changed a fragment of a query from:</p>\n\n<pre><code>  person  `LeftOuterJoin`\n  personExtra\n ) -&gt; do\n  on ((personExtra ^. PersonExtraPerson) ==. (person ^. PersonId))\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>  person  `LeftOuterJoin`\n  personExtra\n ) -&gt; do\n  on ((personExtra ?. PersonExtraPerson) ==. just (person ^. PersonId))\n</code></pre>\n\n<p>I also changed the return type of my query from <code>Entity PersonExtra</code> to <code>Maybe (Entity PersonExtra)</code>.</p>\n\n<p>Now Persistent expects the possibility of a <code>PersistNull</code> and the query works fine for me.</p>\n"}], "owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1477515802, "creation_date": 1422061812, "question_id": 28121228, "link": "https://stackoverflow.com/questions/28121228/cant-write-double-left-join-using-esqueleto", "title": "Can&#39;t write double left join using Esqueleto", "body": "<p>I have a database schema with teachers, schools, and districts.  The <code>TEACHERS</code> table has a nullable <code>SCHOOL_ID</code> column (a teacher may or may not belong to a school) and the <code>SCHOOLS</code> table has a nullable <code>DISTRICT_ID</code> column (a school may or may not belong to a district).</p>\n\n<p>Using Esqueleto, I want a list of teachers, each with a school (if they belong to one) and a district (if they belong to a school that belongs to a district).  It took a little while to figure out the right expression just for the teacher->school left join, but I eventually got it right:</p>\n\n<pre><code>select $\nfrom $ \\(teacher `LeftOuterJoin` school) -&gt; do\n  on (teacher ^. TeacherSchoolId  ==. school ?. SchoolId)\n  return (teacher, school)\n</code></pre>\n\n<p>I tried adding another left join on <code>DISTRICTS</code> using an analogous expression:</p>\n\n<pre><code>select $\nfrom $ \\(teacher `LeftOuterJoin` school `LeftOuterJoin` district) -&gt; do\n  on (school  ^. SchoolDistrictId ==. district ?. DistrictId)\n  on (teacher ^. TeacherSchoolId  ==. school   ?. SchoolId)\n  return (teacher, school, district)\n</code></pre>\n\n<p>But I get an error:</p>\n\n<pre><code>Couldn't match type \u2018Entity School\u2019 with \u2018Maybe (Entity School)\u2019\nExpected type: SqlExpr (Maybe (Entity School))\n  Actual type: SqlExpr (Entity School)\nIn the first argument of \u2018(?.)\u2019, namely \u2018school\u2019\nIn the second argument of \u2018(==.)\u2019, namely \u2018school ?. SchoolId\u2019\n</code></pre>\n\n<p>Can this double join be expressed using Esqueleto?  If so, how?</p>\n"}, {"tags": ["haskell", "graph", "typeclass", "contract", "foldable"], "comments": [{"owner": {"reputation": 3370, "user_id": 722938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MtO4E.jpg?s=128&g=1", "display_name": "is7s", "link": "https://stackoverflow.com/users/722938/is7s"}, "edited": false, "score": 0, "creation_date": 1422119607, "post_id": 28120879, "comment_id": 44628970, "body": "Do you intentionally want the instance to perform DFS?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3370, "user_id": 722938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MtO4E.jpg?s=128&g=1", "display_name": "is7s", "link": "https://stackoverflow.com/users/722938/is7s"}, "edited": false, "score": 0, "creation_date": 1422120816, "post_id": 28120879, "comment_id": 44629367, "body": "@is7s It&#39;d be pretty straightforward to write a <code>newtype</code> which utilises some other form of search strategy."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1422094161, "post_id": 28122153, "comment_id": 44622187, "body": "Could you elaborate on the specifics of the two laws you mention? And why do you think knot-tying with unique labelling doesn&#39;t make sense?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1422112243, "post_id": 28122153, "comment_id": 44626763, "body": "I see. Thanks for the advice"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1422107121, "last_edit_date": 1422107121, "creation_date": 1422072130, "answer_id": 28122153, "question_id": 28120879, "link": "https://stackoverflow.com/questions/28120879/should-a-foldable-always-return-all-its-results-exactly-once/28122153#28122153", "title": "Should a Foldable always return all its results exactly once?", "body": "<p>There are currently very few <code>Foldable</code> laws, so you can do all sorts of things. In fact, there are several different <code>Foldable</code> instances you could write, corresponding to different traversal orders. The <code>Foldable</code> laws describe relationships among the different <code>Foldable</code> members and, if the type is also a <code>Functor</code>, an additional law relating <code>fold</code>, <code>foldMap</code>, and <code>fmap</code>.</p>\n\n<p>Some specifics: There are straightforward \"laws\" about the relationships between <code>foldMap</code>, <code>foldl</code>, <code>foldr</code>, <code>sum</code>, etc., which just say that they should act pretty much like their default implementations except for strictness. For <code>fold</code>, this law is <code>fold = foldMap id</code>. If the container is also a <code>Functor</code>, there's a law specifying that you can go the other way: <code>foldMap f = fold . fmap f</code>. Nothing too exciting at all, as I said.</p>\n\n<p>On the other hand, I think trying to combine knot-tying with unique labeling smells a bit funny. I'm not sure what you're up to with that, or whether it really makes sense. The trouble, as I see it, is that although sharing leads to the graph being represented in memory as you want, this sharing is not reflected in the language at all. Within Haskell, a graph with cycles looks exactly like an infinite tree. There is, in fact, very little you can do with a cyclic graph that won't (potentially) turn it into an infinite tree. This is why people bother using things like <code>Data.Map</code> to represent graphs in the first place\u2014knot tying doesn't offer a clear view of the graph structure.</p>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 28122153, "answer_count": 1, "score": 1, "last_activity_date": 1422107121, "creation_date": 1422058854, "last_edit_date": 1495542133, "question_id": 28120879, "link": "https://stackoverflow.com/questions/28120879/should-a-foldable-always-return-all-its-results-exactly-once", "title": "Should a Foldable always return all its results exactly once?", "body": "<p>Here's a type for cyclic, directed graphs with labelled nodes and edges.</p>\n\n<pre><code>import qualified Data.Map as M\nimport Data.Foldable\nimport Data.Monoid\n\ndata Node n e = N n [(e, Node n e)]  -- the node's label and its list of neighbors\nnewtype Graph n e = G (M.Map n (Node n e))\n</code></pre>\n\n<p>To handle the case where the graph has a loop, it's <a href=\"https://stackoverflow.com/a/9732857/1523776\">possible</a> to 'tie the knot' and create infinitely recursive graphs in finite space.</p>\n\n<pre><code>type GraphInput n e = M.Map n [(e, n)]\n\nmkGraph :: Ord n =&gt; GraphInput n e -&gt; Graph n e\nmkGraph spec = G $ nodeMap\n    where nodeMap = M.mapWithKey mkNode (makeConsistent spec)\n          -- mkNode :: n -&gt; [(e, n)] -&gt; Node n e\n          mkNode lbl edges = N lbl $ map getEdge edges\n          -- We know that (!) can't fail because we ensured that\n          -- all edges have a key in the map (see makeConsistent)\n          getEdge (e, lbl) = (e, nodeMap ! lbl)\n\nmakeConsistent :: Ord n =&gt; GraphInput n e -&gt; GraphInput n e\nmakeConsistent m = foldr addMissing m nodesLinkedTo\n    where addMissing el m = M.insertWith (\\_ old -&gt; old) el [] m\n          nodesLinkedTo = map snd $ join $ M.elems m\n</code></pre>\n\n<p>By viewing the graph as a collection of nodes, we can write a <code>Foldable</code> instance which performs a depth-first traversal.*</p>\n\n<pre><code>newtype NodeGraph e n = NG {getNodeGraph :: Graph n e}\n\ninstance Foldable (NodeGraph e) where\n    foldMap f (NG (G m)) = foldMap mapNode (M.elems m)\n        where mapNode (N n es) = f n `mappend` foldMap mapEdge es\n              mapEdge (e, n) = mapNode n\n</code></pre>\n\n<p>However, even for simple tree-shaped graphs, this produces duplicate elements:</p>\n\n<pre><code>--   A\n--  / \\    X\n-- B   C\n--     |\n--     D\nghci&gt; let ng = NG $ mkGraph [('A', [(1, 'B'), (1, 'C')]), ('C', [(1, 'D')]), ('X', [])]\nghci&gt; let toList = Data.Foldable.foldr (:) []\nghci&gt; toList ng\n\"ABCDBCDDX\"\n</code></pre>\n\n<p>When the graph has a cycle, the effect is even more dramatic - <code>foldMap</code> recurses forever! The items in the loop are repeated, and some elements are never returned!</p>\n\n<p>Is this okay? Can a instance of <code>Foldable</code> return some of its elements more than once, or am I violating the contract of the class? Can an instance loop on a part of the structure infinitely? I've been looking for guidance on this issue - I was hoping for a set of 'Foldable laws' that would settle the question - but I haven't been able to find any discussion of the question online.</p>\n\n<hr>\n\n<p>One approach to get out of this would be to 'remember' the elements which have already been visited as I traverse the graph. However, this would add an <code>Eq</code> or <code>Ord</code> constraint to the signature of <code>foldMap</code>, which precludes my type being a member of <code>Foldable</code>.</p>\n\n<p><sub>* Incidentally, we can't write a <code>Functor</code> instance for <code>NodeGraph</code>, because it would break the invariant that nodes in a graph are uniquely labelled. (<code>fmap (const \"foo\")</code>, for example, will relabel every node to \"foo\", though they'll all have different sets of edges!) We can (with the appropriate <code>newtype</code>) write a <code>Functor</code> which maps all the <em>edge</em> labels, though.</sub></p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422053512, "post_id": 28119969, "comment_id": 44614276, "body": "What is the type of <code>sub</code>?  Try <code>:type sub</code> when you have this code loaded in GHCi."}, {"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422053839, "post_id": 28119969, "comment_id": 44614375, "body": "sub :: (Num t, Monad m, Eq t) =&gt; t -&gt; m [t], I did have it with the types above the functions but somebody said that over complicated things and to just try without, thanks for your reply"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422054043, "post_id": 28119969, "comment_id": 44614461, "body": "The type of <code>length</code> is <code>[a] -&gt; Int</code>.  As it turns out the list type <code>[]</code> is an instance of <code>Monad</code>, so when you call <code>length (sub x)</code>, the type of <code>sub</code> gets specialized to <code>t -&gt; [[t]]</code>, where <code>m</code> is replaced by <code>[]</code>."}, {"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422054124, "post_id": 28119969, "comment_id": 44614499, "body": "Oh i see, is there anyway to convert in haskell? I know other programming languages have toString or similar functions."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422054234, "post_id": 28119969, "comment_id": 44614532, "body": "Are you wanting to convert <code>[[t]]</code> into <code>[t]</code>?  There is the <code>concat</code> function which does this.  BTW, &quot;converting values from one type to another&quot; is precisely what functions are, and if you haven&#39;t noticed by now Haskell is really good at functions ;)"}, {"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1422054454, "post_id": 28119969, "comment_id": 44614604, "body": "haha yes, i&#39;ve noticed. however, if length is [a] -&gt; Int how come I can call  length [10,20,30]. Do the Int value get converted into characters?"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "edited": false, "score": 0, "creation_date": 1422056512, "post_id": 28120467, "comment_id": 44615222, "body": "Thanks for your answer, so you&#39;re saying my list is within a list at the moment? Also i tried to work with that code and it gave an error: Occurs check: cannot construct the infinite type: t ~ [t]"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "edited": false, "score": 0, "creation_date": 1422125527, "post_id": 28120467, "comment_id": 44630926, "body": "my mistake you need to replace the <code>xs &lt;-</code> by <code>let xs</code>. The code is then equivalent to <code>sub x = x:sub (x-1)</code> as pointed by Jedai"}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 2, "last_activity_date": 1422125472, "last_edit_date": 1422125472, "creation_date": 1422056236, "answer_id": 28120467, "question_id": 28119969, "link": "https://stackoverflow.com/questions/28119969/haskell-length-of-list-returning-the-value-1/28120467#28120467", "title": "Haskell, Length of list returning the value 1", "body": "<p>sub doesn't return <code>[10,9,8,6,1]</code> but <code>[[10,9,8,6,1]]</code> (a list of list) therefore the length is 1. You don't need the return. You are in a list monad, <code>return</code> wraps it's value into a list, this why you end up with nested list. Your code should be</p>\n\n<pre><code>sub 5 = [1] -- or return 1\nsub x = do\n       let xs = sub (x -1)\n       (x:xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "is_accepted": false, "score": 2, "last_activity_date": 1422122456, "creation_date": 1422122456, "answer_id": 28128523, "question_id": 28119969, "link": "https://stackoverflow.com/questions/28119969/haskell-length-of-list-returning-the-value-1/28128523#28128523", "title": "Haskell, Length of list returning the value 1", "body": "<p>The problem is that this sub function is written like you were in an imperative language and that return doesn't mean the same thing in Haskell : it means \"wrap this thing in a Monad (which Monad depends on the context)\". Here since you use length on the result of sub the list [] monad is used and the result is [ [10, 9, 8, 7, 6, 5] ] a list of one element which happen to be a list of 6 elements. mb14 correctly identified that but then corrected only the first case of your function, the second case is also monadic but shouldn't be...</p>\n\n<pre><code>sub 5 = [1]\nsub x = x : sub (x - 1)\n</code></pre>\n\n<p>is the simple code you should be using, you don't need any monad here...</p>\n"}], "owner": {"reputation": 35, "user_id": 4215710, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d912a7b0b839f486293ab2befba28ac4?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan", "link": "https://stackoverflow.com/users/4215710/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 28120467, "answer_count": 2, "score": 0, "last_activity_date": 1422125472, "creation_date": 1422053119, "question_id": 28119969, "link": "https://stackoverflow.com/questions/28119969/haskell-length-of-list-returning-the-value-1", "title": "Haskell, Length of list returning the value 1", "body": "<p>I'm working with some code and there seems to be an issue which I can't figure out. </p>\n\n<p>So I've got a method which decrements an input Int by 1 until it hits 5. (I know if i enter less than 1 it would cause an error but i will fix that later)</p>\n\n<p>I have a second function which calls a takes a List as a parameter which calls this function and returns the list of numbers, I want to call length on this list and populate a separate list (I'm not the best at explaining, i'll show with code examples below)</p>\n\n<pre><code>sub 5 = return [1]\nsub x =\n    do \n        xs &lt;- sub (x - 1)\n        return (x:xs)       \n\n\nf xs = [ length (sub x) | x&lt;-xs ]\n</code></pre>\n\n<p>If I call sub 10 on it's own it gives the output [10,9,8,7,6,1], however if I call length on this, it gives the output [1].</p>\n\n<p>In my head i thought the output would be 6, as it has 6 elements in.</p>\n\n<p>Does anyone have any idea why this is happening and/or a way to fix it?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1422045032, "post_id": 28118063, "comment_id": 44610448, "body": "I can&#39;t find a typeclass <code>Fold</code> in Hoogle."}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 2, "creation_date": 1422046530, "post_id": 28118063, "comment_id": 44611222, "body": "@SebastianRedl It&#39;s in <a href=\"http://hackage.haskell.org/package/foldl\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/foldl</a>, I believe"}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1422050008, "post_id": 28118063, "comment_id": 44612891, "body": "At a glance, <code>overMaps :: Foldable f =&gt; Fold a b -&gt; Fold (f a) (f b)</code> almost looks promising. Unfortunately I think <code>foldrWithKey</code> is the sticking point as it&#39;s not part of the <code>Foldable</code> class"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1422055266, "post_id": 28118063, "comment_id": 44614867, "body": "Perhaps not entirely germane to your question, but <code>fromMaybe begin $ M.lookup ...</code> can be implemented with <code>M.findWithDefault</code>"}, {"owner": {"reputation": 2087, "user_id": 103377, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b4bc128655739e58e2a52b1c4b37ff41?s=128&d=identicon&r=PG", "display_name": "Ben Ford", "link": "https://stackoverflow.com/users/103377/ben-ford"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1422088605, "post_id": 28118063, "comment_id": 44621056, "body": "@cdk Yes this is what I was getting at, I wonder if I could use one of the Indexed* things in Lens?"}], "answers": [{"tags": [], "owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "is_accepted": false, "score": 4, "last_activity_date": 1422125635, "last_edit_date": 1422125635, "creation_date": 1422108433, "answer_id": 28126319, "question_id": 28118063, "link": "https://stackoverflow.com/questions/28118063/how-can-i-make-this-fold-more-generic/28126319#28126319", "title": "How can I make this fold more generic", "body": "<p>Mainly for my own understanding (and that of my beloved <a href=\"http://en.wikipedia.org/wiki/Rubber_duck_debugging\" rel=\"nofollow\">rubber duck</a>): </p>\n\n<p>Suppose I have a Fold <code>sumLengths</code> that adds the lengths of strings (so <code>fold sumLengths [\"a\",\"bbb\"]</code> yields 4)</p>\n\n<p>I want <code>overMaps sumLengths</code> to be a Fold that takes say a French and a Dutch dictionary, and makes a new dictionary <code>D</code> such that\n<code>lookup D \"bread\"</code> is 9 (<code>length(\"pain\") + length(\"brood\")</code>) </p>\n\n<p>The problem of course is that some words may not occur in all dictionaries: <code>lookup D \"sex\"</code> is <code>length(\"sexe\")</code> as we Dutch are very prudish :-)\nSo we need the <code>begin</code> value of our fold not only at the beginning of our fold, but possibly at any moment.</p>\n\n<p>This means it won't do to just lift the <code>step</code> function to <code>Map k</code> (in that case we could use any instance of <code>Applicative</code> instead of our\n <code>Map</code>, see below), we have to take our <code>begin</code> value all along the way.</p>\n\n<p>This \"<code>lift</code> plus default value\" is the member <code>fuseWith</code> of a new class <code>Fusable</code> below. It is the  <code>step'</code> in your original code, but (slightly) generalised so that we also have an <code>overF sumLengths</code> for lists of lists, for example. </p>\n\n<pre><code>import Data.Map as M hiding (map)\nimport qualified Control.Foldl       as CF\nimport Control.Foldl (Fold(..))\nimport Control.Applicative\nimport Data.Foldable as F\nimport Data.Maybe\n\n--- the Fusable class:\nclass Functor f =&gt; Fusable f where\n  fuseWith :: x -&gt; (x -&gt; a -&gt; x) -&gt; f x -&gt; f a -&gt; f x \n  emptyf   :: f a \n\n--- Map k is a Fusable (whenever k has an ordering)\ninstance (Ord k) =&gt; Fusable (Map k) where\n   fuseWith x f xmap amap = M.foldrWithKey insert xmap amap where    \n      insert k el xmap = M.insert k (f (fromMaybe x $ M.lookup k xmap) el) xmap \n   emptyf = M.empty\n\n--- Lists are Fusable\ninstance Fusable [] where\n  fuseWith  = zipWithDefault where\n    zipWithDefault dx f [] ys = zipWith f (repeat dx) ys\n    zipWithDefault dx f xs [] = xs\n    zipWithDefault dx f (x:xs) (y:ys) = (f x y) : zipWithDefault dx f xs ys\n  emptyf = []\n\n--- The generalised overMaps:\noverF :: (Fusable f) =&gt; Fold a b  -&gt; Fold (f a) (f b)\noverF (Fold step begin done) = Fold (fuseWith begin step) emptyf (fmap done)\n\n--- some tests\ntestlist = [(1,4),(3,99),(7,999)]\ntestlist2 = [(1,15),(2,88)]\n\ntest  = CF.fold (overF CF.sum)  $ map fromList [testlist, testlist2] \n-- fromList [(1,19),(2,88),(3,99),(7,999)]\ntest2 = CF.fold (overF $ CF.premap snd CF.sum) [testlist, testlist2] \n-- [19,187,999]\n</code></pre>\n\n<p>If we don't worry about taking the <code>begin</code> value along, we can use any <code>Applicative</code> (<code>Map k</code> is not <code>Applicative</code>!)</p>\n\n<pre><code>overA :: (Applicative f) =&gt; Fold a b -&gt; Fold (f a) (f b)\noverA (Fold step begin done) = Fold (liftA2 step) (pure begin) (fmap done)\n</code></pre>\n\n<p>It certainly looks a lot like <code>overF</code>. But it gives different results: when folding over a list of lists, as soon as a list comes along that is too short, the result is truncated</p>\n\n<pre><code>test3 = CF.fold (overA $ CF.premap snd CF.sum) $  map ZipList [testlist, testlist2] \n-- ZipList [19,187]  -- *where* is my third element :-(\n</code></pre>\n"}], "owner": {"reputation": 2087, "user_id": 103377, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b4bc128655739e58e2a52b1c4b37ff41?s=128&d=identicon&r=PG", "display_name": "Ben Ford", "link": "https://stackoverflow.com/users/103377/ben-ford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 3, "answer_count": 1, "score": 5, "last_activity_date": 1422197723, "creation_date": 1422044321, "last_edit_date": 1422197723, "question_id": 28118063, "link": "https://stackoverflow.com/questions/28118063/how-can-i-make-this-fold-more-generic", "title": "How can I make this fold more generic", "body": "<p>I've written this function:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\nmodule Hierarchy where\n\nimport           Control.Applicative\nimport qualified Control.Foldl       as CF\nimport           Control.Foldl (Fold(..))\nimport           Control.Lens hiding (Fold)\nimport qualified Data.Foldable       as F\nimport qualified Data.Map.Lazy       as M\nimport           Data.Monoid         (Monoid (..), Sum (Sum))\nimport           Data.Profunctor\nimport           Data.Set (Set)\nimport           Data.Maybe\nimport           Data.Text           (Text)\n\noverMaps :: (Ord k) =&gt; Fold a b -&gt; Fold (M.Map k a) (M.Map k b)\noverMaps (Fold step begin done) = Fold step' M.empty (fmap done)   \n  where\n  step' acc m = M.foldrWithKey insert acc m\n  insert k el acc = M.insert k (step (fromMaybe begin $ M.lookup k acc) el) acc\n</code></pre>\n\n<p>I feel like I'm missing some fundamental abstraction that could make this more general, and more succinct.</p>\n\n<p>Can anyone give me some pointers as to how I could use any modern Haskellisms here to make this better?</p>\n\n<p><strong>edit</strong> The code is here <a href=\"https://github.com/boothead/hierarchy/blob/master/src/Hierarchy.hs\" rel=\"nofollow\">https://github.com/boothead/hierarchy/blob/master/src/Hierarchy.hs</a></p>\n\n<p>and I've included the imports</p>\n\n<p><strong>edit</strong> Perhaps I can use ifoldr to get closer to @cdk's idea?</p>\n\n<p><strong>edit</strong></p>\n\n<p>Here's the closest I've got.</p>\n\n<pre><code>--overFoldable :: (Ord k) =&gt; Fold a b -&gt; Fold (M.Map k a) (M.Map k b)\noverFoldable :: (Ord i, At (f i a), FoldableWithIndex i (f i), Monoid (f i x))\n             =&gt; Fold a b -&gt; Fold (f i a) (f i b)\noverFoldable (Fold step begin done) = Fold step' mempty (fmap done)\n  where\n  step' acc m = Lens.ifoldr insert acc m\n  insert k el acc = Lens.at k %~ return . flip step el . fromMaybe begin $ acc\n</code></pre>\n\n<p>Here the first (commented) type signature works. Now the problem lies in the existential <code>x</code> in the type signature of <code>Fold :: (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b</code> I can't figure out what to put in the <code>begin</code> position of my new fold. It needs to be of Type <code>f i x</code> but I don't know how to tell Haskell how to take <code>x</code> to be the same type as <code>begin</code>.</p>\n"}, {"tags": ["haskell", "persistent"], "answers": [{"tags": [], "owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "is_accepted": true, "score": 2, "last_activity_date": 1422063021, "last_edit_date": 1422063021, "creation_date": 1422055104, "answer_id": 28120301, "question_id": 28117994, "link": "https://stackoverflow.com/questions/28117994/haskell-persistent-is-possible-to-select-all-rows-by-field-that-contains-specif/28120301#28120301", "title": "Haskell Persistent: Is possible to select all rows by field that contains specified value", "body": "\n\n<p>No since list-like columns are not part of SQL. </p>\n\n<p>Practically, your <code>tags</code> column is defined as <code>\"tags\" VARCHAR NOT NULL</code> in SQLite.</p>\n\n<p>If you want to run any kind of non-trivial queries on your <code>Post</code> I would strongly recommend, as you said, to redesign your schema.</p>\n\n<p>Removing <code>tags</code> from <code>Post</code> and adding the following table should allow you to get all posts of a specific tag.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>TagPost\n    tagId TagId\n    postId PostId\n    UniqueTagPost tagId postId\n</code></pre>\n\n<p></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; tagPosts &lt;- selectList [TagPostTagId ==. yourTagId] []\n</code></pre>\n\n<p>You might also want to take a look at <a href=\"http://hackage.haskell.org/package/esqueleto\" rel=\"nofollow\">Esqueleto</a>, it will allow you to write type safe joins (stuff that <code>persistent</code> does not provide by default since it must stay compatible with MongoDB).</p>\n"}], "owner": {"reputation": 1362, "user_id": 1349525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/LXJ8Y.jpg?s=128&g=1", "display_name": "Dark_Daiver", "link": "https://stackoverflow.com/users/1349525/dark-daiver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 28120301, "answer_count": 1, "score": 1, "last_activity_date": 1422063021, "creation_date": 1422044033, "question_id": 28117994, "link": "https://stackoverflow.com/questions/28117994/haskell-persistent-is-possible-to-select-all-rows-by-field-that-contains-specif", "title": "Haskell Persistent: Is possible to select all rows by field that contains specified value", "body": "<p>I have following Persistent model</p>\n\n<pre><code>Tag\n    name String\n    description String\n    UniqueName name\n\nPost\n    caption String\n    text    String\n    created UTCTime\n    tags    [TagId]\n    deriving Show\n</code></pre>\n\n<p>Is possible to select all posts that contains specified <code>TagId</code> in field <code>tags</code>? Or i need to create new model to handle many-to-many relationship?</p>\n\n<p>PS Sorry for my poor English</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1422041587, "post_id": 28117137, "comment_id": 44608822, "body": "<code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a</code>. Because <code>Float</code> is not an instance of the <code>Integral</code> type class, you can&#39;t use the <code>^</code> operator to raise a number to a power whose value is of type <code>Float</code>."}, {"owner": {"reputation": 43, "user_id": 4488006, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rRb3nus8oQc/AAAAAAAAAAI/AAAAAAAAAz4/1nHDlguAFAo/photo.jpg?sz=128", "display_name": "Jorge Devoto", "link": "https://stackoverflow.com/users/4488006/jorge-devoto"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1422276211, "post_id": 28117137, "comment_id": 44671810, "body": "Thanks for the answer!"}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 6, "last_activity_date": 1422041780, "creation_date": 1422041780, "answer_id": 28117424, "question_id": 28117137, "link": "https://stackoverflow.com/questions/28117137/powers-in-haskell/28117424#28117424", "title": "Powers in Haskell", "body": "<p><code>(**)</code> can be used to take powers of Float exponents....</p>\n\n<p><code>(^)</code> is only for integral exponents.</p>\n\n<pre><code>2 ^ 2.1 --fails\n2 ** 2.1 --works\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4488006, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rRb3nus8oQc/AAAAAAAAAAI/AAAAAAAAAz4/1nHDlguAFAo/photo.jpg?sz=128", "display_name": "Jorge Devoto", "link": "https://stackoverflow.com/users/4488006/jorge-devoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 848, "favorite_count": 1, "accepted_answer_id": 28117424, "answer_count": 1, "score": 1, "last_activity_date": 1422041780, "creation_date": 1422040717, "question_id": 28117137, "link": "https://stackoverflow.com/questions/28117137/powers-in-haskell", "title": "Powers in Haskell", "body": "<p>I was trying to implement the following function in Haskell</p>\n\n<pre><code>p :: Float -&gt; Int -&gt; Float\np x 0 = 1\np x n = x^(p x (n-1))\n</code></pre>\n\n<p>I get:</p>\n\n<p>No instance for (Integral (Float -> Int -> Float)) arising from a use of `fromIntegral'</p>\n\n<p>I am new to Haskell.</p>\n"}, {"tags": ["haskell", "haskell-platform", "centos7"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1422040735, "post_id": 28116773, "comment_id": 44608401, "body": "How about <code>yum install ghc-zlib-devel-0.5.3.1</code>?  It appears centos has a broken packaging and fails to install their build of the haskell zlib bindings.  FYI, I haven&#39;t tested this but just ran a quick <code>yum whatprovides *&#47;libHSzlib*</code>"}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1422211945, "post_id": 28116773, "comment_id": 44651785, "body": "I tried <code>yum install ghc-zlib-devel-0.5.4.1</code> (I assume you meant 0.5.*4*.1), but no change."}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1422213280, "post_id": 28116773, "comment_id": 44652286, "body": "Please see additional edits to the question."}], "answers": [{"tags": [], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "is_accepted": true, "score": 1, "last_activity_date": 1422271037, "creation_date": 1422271037, "answer_id": 28149076, "question_id": 28116773, "link": "https://stackoverflow.com/questions/28116773/cabal-error-while-loading-shared-libraries-libhszlib-0-5-4-1-ghc7-6-3-so/28149076#28149076", "title": "cabal: error while loading shared libraries: libHSzlib-0.5.4.1-ghc7.6.3.so", "body": "<p>Here's how I solved the problem:</p>\n\n<p>First, I installed ghc manually.</p>\n\n<pre><code>wget https://www.haskell.org/ghc/dist/7.8.4/ghc-7.8.4-i386-unknown-linux-deb7.tar.xz\ntar xvf ghc-7.8.4-i386-unknown-linux-deb7.tar.xz \ncd ghc-7.8.4\nsudo mkdir /usr/local/ghc-7.8.4\n./configure --prefix=/usr/local/ghc-7.8.4\n</code></pre>\n\n<p><strong>NOTE:</strong> Even though the version I installed was made on a Debian 7 \"wheezey\" system and supposedly only requires <code>libgmp.so.10</code>, I got error messages about <code>libgmp.so.3</code>. I worked around that by doing the following, which I know is a <strong>bad thing to do</strong>:</p>\n\n<pre><code>sudo ln -s /usr/lib64/libgmp.so.10 /usr/lib64/libgmp.so.3\n</code></pre>\n\n<p>Next, I <em>tried</em> installing the Haskell Platform manually, using the command:</p>\n\n<pre><code>./platform.sh /home/amy/ghc-7.8.3-x86_64-unknown-linux-deb7.tar.xz\n</code></pre>\n\n<p>but I got the now familiar error messages about <code>libHSzlib-0.5.4.1-ghc7.6.3.so</code>.</p>\n\n<p>So I manually installed cabal.</p>\n\n<pre><code>git clone https://github.com/haskell/cabal.git\ncd cabal/Cabal\nghc -threaded --make Setup\n./Setup configure\n./Setup build\nsudo ./Setup install\ncd ../cabal-install\n./bootstrap.sh\n</code></pre>\n"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 910, "favorite_count": 1, "accepted_answer_id": 28149076, "answer_count": 1, "score": 3, "last_activity_date": 1422271037, "creation_date": 1422039180, "last_edit_date": 1422213240, "question_id": 28116773, "link": "https://stackoverflow.com/questions/28116773/cabal-error-while-loading-shared-libraries-libhszlib-0-5-4-1-ghc7-6-3-so", "title": "cabal: error while loading shared libraries: libHSzlib-0.5.4.1-ghc7.6.3.so", "body": "<p>I've done a fresh install of the Haskell platform on CentOS 7, like so:</p>\n\n<pre><code>[amy@wombat115 ~]$ sudo yum install haskell-platform\nLoaded plugins: fastestmirror, product-id, subscription-manager\nThis system is not registered with Subscription Management. You can use subscription-manager to register.\nLoading mirror speeds from cached hostfile\n * base: ftp.sunet.se\n * epel: ftp.lysator.liu.se\n * extras: ftp.sunet.se\n * updates: ftp.sunet.se\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package haskell-platform.x86_64 0:2013.2.0.0-36.el7 will be installed\n--&gt; Processing Dependency: ghc-haskell-platform-devel = 2013.2.0.0-36.el7 for package: haskell-platform-2013.2.0.0-36.el7.x86_64\n--&gt; Processing Dependency: cabal-install = 1.16.0.2 for package: haskell-platform-2013.2.0.0-36.el7.x86_64\n--&gt; Running transaction check\n---&gt; Package cabal-install.x86_64 0:1.16.0.2-32.el7 will be installed\n---&gt; Package ghc-haskell-platform-devel.x86_64 0:2013.2.0.0-36.el7 will be installed\n--&gt; Processing Dependency: ghc = 7.6.3 for package: ghc-haskell-platform-devel-2013.2.0.0-36.el7.x86_64\n--&gt; Running transaction check\n---&gt; Package ghc.x86_64 0:7.6.3-18.3.el7 will be installed\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n=====================================================================================================================================\n Package                                     Arch                    Version                             Repository             Size\n=====================================================================================================================================\nInstalling:\n haskell-platform                            x86_64                  2013.2.0.0-36.el7                   epel                   12 k\nInstalling for dependencies:\n cabal-install                               x86_64                  1.16.0.2-32.el7                     epel                  452 k\n ghc                                         x86_64                  7.6.3-18.3.el7                      epel                   35 k\n ghc-haskell-platform-devel                  x86_64                  2013.2.0.0-36.el7                   epel                   15 k\n\nTransaction Summary\n=====================================================================================================================================\nInstall  1 Package (+3 Dependent packages)\n\nTotal download size: 514 k\nInstalled size: 2.9 M\nIs this ok [y/d/N]: y\nDownloading packages:\n(1/4): haskell-platform-2013.2.0.0-36.el7.x86_64.rpm                                                          |  12 kB  00:00:00     \n(2/4): ghc-haskell-platform-devel-2013.2.0.0-36.el7.x86_64.rpm                                                |  15 kB  00:00:00     \n(3/4): ghc-7.6.3-18.3.el7.x86_64.rpm                                                                          |  35 kB  00:00:00     \n(4/4): cabal-install-1.16.0.2-32.el7.x86_64.rpm                                                               | 452 kB  00:00:01     \n-------------------------------------------------------------------------------------------------------------------------------------\nTotal                                                                                                461 kB/s | 514 kB  00:00:01     \nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : ghc-7.6.3-18.3.el7.x86_64                                                                                         1/4 \n  Installing : ghc-haskell-platform-devel-2013.2.0.0-36.el7.x86_64                                                               2/4 \n/var/tmp/rpm-tmp.5ERaqJ: line 1: /usr/bin/ghc-pkg: No such file or directory\n  Installing : cabal-install-1.16.0.2-32.el7.x86_64                                                                              3/4 \n  Installing : haskell-platform-2013.2.0.0-36.el7.x86_64                                                                         4/4 \n  Verifying  : cabal-install-1.16.0.2-32.el7.x86_64                                                                              1/4 \n  Verifying  : ghc-haskell-platform-devel-2013.2.0.0-36.el7.x86_64                                                               2/4 \n  Verifying  : ghc-7.6.3-18.3.el7.x86_64                                                                                         3/4 \n  Verifying  : haskell-platform-2013.2.0.0-36.el7.x86_64                                                                         4/4 \n\nInstalled:\n  haskell-platform.x86_64 0:2013.2.0.0-36.el7                                                                                        \n\nDependency Installed:\n  cabal-install.x86_64 0:1.16.0.2-32.el7    ghc.x86_64 0:7.6.3-18.3.el7    ghc-haskell-platform-devel.x86_64 0:2013.2.0.0-36.el7   \n\nComplete!\n</code></pre>\n\n<p>But I get the following error:</p>\n\n<pre><code>[amy@wombat115 ~]$ cabal update\ncabal: error while loading shared libraries: libHSzlib-0.5.4.1-ghc7.6.3.so: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>I have tried the following, to no effect:</p>\n\n<pre><code>sudo yum reinstall ghc-zlib-devel\nsudo yum reinstall zlib-devel\nsudo yum reinstall ghc-ghc-devel\n</code></pre>\n\n<hr>\n\n<p>EDIT: I have also tried the following:</p>\n\n<pre><code>sudo yum reinstall ghc-zlib-devel-0.5.4.1\nsudo yum reinstall ghc-zlib-devel-0.5.4.1-26.el7\nsudo yum reinstall cabal-install\nsudo yum reinstall ghc-Cabal\n</code></pre>\n\n<hr>\n\n<p>EDIT: If <code>yum whatprovides libHSzlib*ghc*</code> is to be believed, <code>ghc-zlib-devel</code> installs <code>libHSzlib-0.5.4.1-ghc7.6.3.so</code>. However, the only file <code>find / -name 'libHSzlib*.so' returns is</code>libHSzlib-0.5.4.1-ghc7.8.3.so` (note the <em>8</em> vs. <em>6</em>).</p>\n"}, {"tags": ["haskell", "module", "encapsulation", "ghci", "value-constructor"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1422038340, "post_id": 28116009, "comment_id": 44607141, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/27548049/why-can-ghci-see-non-exported-types-and-constructors-how-can-i-fix-it\">Why can ghci see non-exported types and constructors? How can I fix it?</a>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422038791, "post_id": 28116009, "comment_id": 44607394, "body": "@dfeuer Sorry, I wasn&#39;t aware of the question you link to."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1422036605, "post_id": 28116058, "comment_id": 44606258, "body": "Ah yes! Thanks; I wasn&#39;t aware of that. It&#39;s not the first time GHCi plays tricks on me. Please add a reference to the documentation about GHCi ignoring scoping rules by default, and I&#39;ll accept your answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1422038364, "post_id": 28116058, "comment_id": 44607158, "body": "We really should try to pick one canonical question for this issue. It comes up a <i>lot</i>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 14, "last_activity_date": 1422036829, "last_edit_date": 1422036829, "creation_date": 1422036451, "answer_id": 28116058, "question_id": 28116009, "link": "https://stackoverflow.com/questions/28116009/why-am-i-able-to-use-my-value-constructor-even-though-i-dont-export-it/28116058#28116058", "title": "Why am I able to use my value constructor even though I don&#39;t export it?", "body": "<p>You are doing nothing wrong. It's just that, for convenience, ghci ignores scoping rules on modules it loads.</p>\n\n<p>If you want to see what would normally be available, you can</p>\n\n<pre><code>:m -Queue\n:m +Queue\n</code></pre>\n\n<p>You can later return to the \"everything is available\" mode with</p>\n\n<pre><code>:m *Queue\n</code></pre>\n\n<p>See also <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#ghci-scope\">What's really in scope at the prompt?</a> in the official documentation.</p>\n"}], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 2, "accepted_answer_id": 28116058, "answer_count": 1, "score": 8, "last_activity_date": 1422037233, "creation_date": 1422036296, "last_edit_date": 1422037233, "question_id": 28116009, "link": "https://stackoverflow.com/questions/28116009/why-am-i-able-to-use-my-value-constructor-even-though-i-dont-export-it", "title": "Why am I able to use my value constructor even though I don&#39;t export it?", "body": "<p>For practice, I'm implementing a queue data type in a module called \"Queue\". My data type is also called \"Queue\", as is its only value constructor:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Queue (Queue, enq, emptyQueue) where\n\ndata Queue a = Queue {\n  inbox  :: [a],\n  outbox :: [a]\n} deriving (Eq, Show)\n\nemptyQueue :: Queue a\nemptyQueue = Queue [] []\n\nenq :: a -&gt; Queue a -&gt; Queue a\nenq x (Queue inb out) = Queue (x:inb) out\n\n-- other function definitions (irrelevant here)...\n</code></pre>\n\n<p>As far as I understand, because I wrote <code>Queue</code>, not <code>Queue(..)</code> or <code>Queue(Queue)</code> in the export statement, I don't expect the value constructor of my data type to be exported by the module. This is exactly what I want, for encapsulation purposes: users should not be able to use the value constructor directly; only <code>emptyQueue</code>, <code>enq</code>, and the other functions in my interface.</p>\n\n<p>However (and the solution to my problem may be obvious to seasoned Haskellers), if I load my module in GHCi, I'm able to use the value constructor directly.</p>\n\n<pre><code>$ ghci Queue.hs\nGHCi, version 7.8.4: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n[1 of 1] Compiling Queue            ( Queue.hs, interpreted )\nOk, modules loaded: Queue.\n\n\u03bb&gt; Queue [1] [2] \nQueue {inbox = [1], outbox = [2]}\n</code></pre>\n\n<p>As stated above, this is undesirable. What am I doing wrong?</p>\n"}, {"tags": ["haskell", "utf-8", "cabal", "purescript"], "answers": [{"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422021119, "post_id": 28111390, "comment_id": 44596418, "body": "Just my luck! I will file an issue at the PureScript page."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1422021290, "post_id": 28111390, "comment_id": 44596511, "body": "Actually it looks like they have already <a href=\"https://github.com/purescript/purescript/pull/826\" rel=\"nofollow noreferrer\">committed some changes to fix this</a>. Not sure what the best install policy will be until the package is updated. Looks like I picked a bad day to test out PureScript..."}, {"owner": {"reputation": 4039, "user_id": 1341956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbed6f201f9a0e735e5660d118c6662d?s=128&d=identicon&r=PG", "display_name": "Phil Freeman", "link": "https://stackoverflow.com/users/1341956/phil-freeman"}, "edited": false, "score": 5, "creation_date": 1422036673, "post_id": 28111390, "comment_id": 44606305, "body": "I just merged this into master, and made a release on Hackage and GitHub, so you should be good now."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 9, "last_activity_date": 1422021371, "last_edit_date": 1422021371, "creation_date": 1422021047, "answer_id": 28111390, "question_id": 28110769, "link": "https://stackoverflow.com/questions/28110769/system-io-utf8-not-found-installing-purescript/28111390#28111390", "title": "System.IO.UTF8 not found (installing PureScript)", "body": "<p>Looks like <code>utf-string</code> was updated <em>today</em> (Jan 23) to <a href=\"http://hackage.haskell.org/package/utf8-string-1\">version <code>1</code></a> which doesn't have <code>System.IO.UTF8</code> module anymore. That one is present in previous <a href=\"http://hackage.haskell.org/package/utf8-string-0.3.8\">version <code>0.3.8</code> of <code>utf-string</code></a>.</p>\n\n<p>And the <code>purescript</code> doesn't specify the <a href=\"https://github.com/purescript/purescript/blob/b0d5551f5837101dded528dfa371c9f3e5f70455/purescript.cabal#L35\">upper bound for <code>utf-string</code></a>.</p>\n\n<hr>\n\n<p><em>EDIT</em> I made <a href=\"https://github.com/purescript/purescript/pull/827\">a PR</a> to workaround the <a href=\"https://github.com/purescript/purescript/issues/825\">issue</a>.\nThere is <a href=\"https://github.com/purescript/purescript/pull/826\">more proper fix WIP</a> too.</p>\n"}], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 892, "favorite_count": 0, "accepted_answer_id": 28111390, "answer_count": 1, "score": 3, "last_activity_date": 1422021371, "creation_date": 1422018897, "last_edit_date": 1422019716, "question_id": 28110769, "link": "https://stackoverflow.com/questions/28110769/system-io-utf8-not-found-installing-purescript", "title": "System.IO.UTF8 not found (installing PureScript)", "body": "<p>I'm trying to install PureScript on Ubuntu 14.04. I have the latest version of Haskell-Platform and have run <code>cabal update</code>. During <code>cabal install purescript</code> I get an error saying that the module <code>System.IO.UTF8</code> is not found. Googling reveals that <a href=\"https://github.com/ghc/packages-utf8-string/blob/master/utf8-string.cabal\" rel=\"nofollow\">this is part of <code>utf8-string</code> and should be one of the exposed modules</a> when that package is installed.</p>\n\n<p>However, when I install it, no such package is available:</p>\n\n\n\n<pre><code>ely@eschaton:~$ cabal update\nDownloading the latest package list from hackage.haskell.org\nely@eschaton:~$ cabal --reinstall install utf8-string\nResolving dependencies...\nIn order, the following will be installed:\nutf8-string-1 (reinstall)\nWarning: Note that reinstalls are always dangerous. Continuing anyway...\nConfiguring utf8-string-1...\nBuilding utf8-string-1...\nPreprocessing library utf8-string-1...\n[1 of 5] Compiling Codec.Binary.UTF8.String ( Codec/Binary/UTF8/String.hs, dist/build/Codec/Binary/UTF8/String.o )\n[2 of 5] Compiling Codec.Binary.UTF8.Generic ( Codec/Binary/UTF8/Generic.hs, dist/build/Codec/Binary/UTF8/Generic.o )\n[3 of 5] Compiling Data.String.UTF8 ( Data/String/UTF8.hs, dist/build/Data/String/UTF8.o )\n[4 of 5] Compiling Data.ByteString.UTF8 ( Data/ByteString/UTF8.hs, dist/build/Data/ByteString/UTF8.o )\n[5 of 5] Compiling Data.ByteString.Lazy.UTF8 ( Data/ByteString/Lazy/UTF8.hs, dist/build/Data/ByteString/Lazy/UTF8.o )\nIn-place registering utf8-string-1...\nInstalling library in /home/ely/.cabal/lib/utf8-string-1/ghc-7.6.3\nRegistering utf8-string-1...\nInstalled utf8-string-1\nely@eschaton:~$ ghci\nGHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; import System.IO.UTF8\n\n&lt;no location info&gt;:\n    Could not find module `System.IO.UTF8'\n    It is not a module in the current program, or in any known package.\n</code></pre>\n\n<p>You can see that only 5 of the stated proposed libraries are compiled.</p>\n\n<p>The <a href=\"https://github.com/purescript/purescript/blob/master/hierarchy/Main.hs#L34\" rel=\"nofollow\">PureScript source definitely makes use</a> of <code>System.IO.UTF8</code>.</p>\n\n<p>But <code>System.IO.UTF8</code> looks like a pretty old package that has not undergone changes in a long time (2+ years), so it's unlikely that this was a significant change in a recent version. To boot, PureScript is very new, and so would surely be based on newer versions of utf8-string if they were available.</p>\n\n<p>So the question is: why isn't PureScript able to install this dependency on its own ... and why does the <code>cabal</code> installation of <code>utf8-string</code> fail to expose the <code>System.IO.UTF8</code> module as it suggests it should.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1422017175, "post_id": 28110152, "comment_id": 44594229, "body": "It&#39;s going fine until step 7. <code>([]:first_threes)</code> is not even a well-type expression. <code>my_take 3(3:first_threes)</code> reduces simply to <code>3 : my_take 2 (first_threes)</code>. To continue evaluating <code>my_take</code> you have to evaluate <code>threes</code> like you did in step 2."}, {"owner": {"reputation": 27, "user_id": 4275883, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/XJMWh.jpg?s=128&g=1", "display_name": "caz", "link": "https://stackoverflow.com/users/4275883/caz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422017326, "post_id": 28110152, "comment_id": 44594318, "body": "Thankyou @user2407038 for pointing me in the correct direction. x"}, {"owner": {"reputation": 27, "user_id": 4275883, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/XJMWh.jpg?s=128&g=1", "display_name": "caz", "link": "https://stackoverflow.com/users/4275883/caz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422017745, "post_id": 28110152, "comment_id": 44594536, "body": "<code>1.\tmy_sum (my_take 5 first_threes) =      2.\tmy_sum (my_take 5 (1:2:3:first_threes)) =     3.\tmy_sum (1:(my_take 4 (2:3:first_threes))) =     4.\t1 + my_sum (my_take 4 (2:3:first_threes))=     5.\t1 + my_sum (2:(my_take 3 (3:first_threes)))=     6.\t1 + 2 + my_sum (my_take 3(3:first_threes))=     7.\t1 + 2 + my_sum (3: (my_take 2(first_threes)))=</code> So like this the it adds 1+2 +(the sum of 1+2) + the bracketed 3, then stops. Great stuff."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422019979, "post_id": 28110152, "comment_id": 44595753, "body": "It certainly doesn&#39;t stop, because you can still reduce it - <code>threes = 1:2:3:threes</code>. The final evaluation should be a single number. Strictly speaking you can&#39;t reduce the <code>1 + 2</code> because the expression is actually <code>1 + (2 + (3 + ...)))</code>."}], "owner": {"reputation": 27, "user_id": 4275883, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/XJMWh.jpg?s=128&g=1", "display_name": "caz", "link": "https://stackoverflow.com/users/4275883/caz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1422016759, "creation_date": 1422016759, "question_id": 28110152, "link": "https://stackoverflow.com/questions/28110152/evaluating-what-the-haskell-compiler-is-doing", "title": "evaluating what the haskell compiler is doing", "body": "<p>I have these functions:</p>\n\n<pre><code>first_threes :: [Int]                     -- first three numbers repeated\nfirst_threes = 1:2:3:first_threes         -- th.1\n\ntake :: Int -&gt; [a] -&gt; [a]                 -- take\ntake 0 _ = []                             -- t.1\ntake n (x:xs) = x : (take (n - 1) xs)     -- t.2\n\nsum :: [Int] -&gt; Int                       -- summation of an Int list\nsum [] = 0                                -- s.1\nsum (x:xs) = x + (sum xs)                 -- s.2\n</code></pre>\n\n<p>And I have to evaluate what is going on under the \"bonnet\" of the compiler in each step. So far I have this:</p>\n\n<pre><code>1.  my_sum (my_take 5 first_threes) =\n2.  my_sum (my_take 5 (1:2:3:first_threes)) =\n3.  my_sum (1:(my_take 4 (2:3:first_threes))) =\n4.  1 + my_sum (my_take 4 (2:3:first_threes))=\n5.  1 + my_sum (2:(my_take 3 (3:first_threes)))=\n6.  1 + 2 + my_sum (my_take 3(3:first_threes))=\n7.  1 + 2 + my_sum (3: (my_take 2([]:first_threes)))=\n8.  1 + 2 + 3 + my_sum( my_take 1([]:first_threes))=\n9.  1 + 2 + 3 + my_sum( my_take []([]:first_threes))=\n</code></pre>\n\n<p>Is this correct? I need to know as then I can evaluate what is going on in each step, but can't do this until I know I have done each step of what the compiler's doing correctly. Any hit would be really appreciated. Thanks x</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 105769, "user_id": 1267329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f943c14b945cadc0ee0afa6ef70d2103?s=128&d=identicon&r=PG", "display_name": "Simeon Visser", "link": "https://stackoverflow.com/users/1267329/simeon-visser"}, "edited": false, "score": 0, "creation_date": 1422006238, "post_id": 28106953, "comment_id": 44588273, "body": "If I remember correctly, any function can be an operator as long as it&#39;s placed in between the operands."}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "reply_to_user": {"reputation": 105769, "user_id": 1267329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f943c14b945cadc0ee0afa6ef70d2103?s=128&d=identicon&r=PG", "display_name": "Simeon Visser", "link": "https://stackoverflow.com/users/1267329/simeon-visser"}, "edited": false, "score": 0, "creation_date": 1422006396, "post_id": 28106953, "comment_id": 44588374, "body": "I remember about the <code>123 &#39;func&#39; 456</code> variant. But this is infix form only (in my opinion). This case the <code>func</code> is not <i>opereator</i>."}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1422006825, "post_id": 28106953, "comment_id": 44588637, "body": "<i>The second and third variants are not operators</i> - thank you."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1422007009, "post_id": 28106953, "comment_id": 44588733, "body": "There is no problem in applying a function with more than two arguments infix. Consider <code>((+) `foldr` 0) [1..10]</code> which uses <code>foldr</code> as an operator."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1422013018, "post_id": 28106953, "comment_id": 44591998, "body": "@kosmikus That&#39;s true! Thanks for that. I&#39;ll delete my earlier comment."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1422006824, "creation_date": 1422006824, "answer_id": 28107154, "question_id": 28106953, "link": "https://stackoverflow.com/questions/28106953/what-is-the-operator-word-definition/28107154#28107154", "title": "What is the `Operator` word definition?", "body": "<p>According to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-240003.2\" rel=\"nofollow\">Haskell Report</a>,</p>\n\n<blockquote>\n  <p>an operator symbol can be converted to an ordinary identifier by enclosing it in parentheses.</p>\n</blockquote>\n\n<p>So this <code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:)</code> is an ordinary identifier.</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 3, "last_activity_date": 1422110095, "creation_date": 1422110095, "answer_id": 28126601, "question_id": 28106953, "link": "https://stackoverflow.com/questions/28106953/what-is-the-operator-word-definition/28126601#28126601", "title": "What is the `Operator` word definition?", "body": "<p>Ok, because there's so much confusion, I've decided to give yet another answer.</p>\n\n<p>Here's the quote from the Haskell 2010 report:</p>\n\n<blockquote>\n  <p>Haskell provides special syntax to support infix notation. An operator is a function that can be applied using infix syntax (Section 3.4), or partially applied using a section (Section 3.5).</p>\n  \n  <p>An operator is either an operator symbol, such as <code>+</code> or <code>$$</code>, or is an ordinary identifier enclosed in grave accents (backquotes), such as <code>`op`</code>. For example, instead of writing the prefix application <code>op x y</code>, one can write the infix application <code>x `op` y</code>. If no fixity declaration is given for <code>`op`</code> then it defaults to highest precedence and left associativity (see Section 4.4.2).</p>\n  \n  <p>Dually, an operator symbol can be converted to an ordinary identifier by enclosing it in parentheses. For example, <code>(+) x y</code> is equivalent to <code>x + y</code>, and <code>foldr (\u22c6) 1 xs</code> is equivalent to <code>foldr (\\x y -&gt; x\u22c6y) 1 xs</code>.</p>\n</blockquote>\n\n<p>So this defines two notions, an \"operator symbol\" and an \"operator\". An \"operator symbol\" is any symbolic identifier. An \"operator\" is any function that can be applied using infix syntax.</p>\n\n<p>So now let's look at your examples, one by one:</p>\n\n<h3>First example</h3>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int -&gt; Int\na !#$%&amp;*+./&lt;=&gt;?@\\^|-~: b = a * b\n</code></pre>\n\n<p>The identifier <code>!#$%&amp;*+./&lt;=&gt;?@\\^|-~:</code> is an operator symbol. If used in infix\nposition, such as on the left hand side of this definition, it's used as an\noperator.</p>\n\n<p>You give two examples of its use:</p>\n\n<pre><code>\u03bb: 10 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 20\n200\n\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 40 20\n800\n</code></pre>\n\n<p>In the first, we use it as an operator. In the second, we don't.</p>\n\n<h3>Second example</h3>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int\n(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) a = a * a\n</code></pre>\n\n<p>It's the same name, so it's still an operator symbol. The definition uses the\nparenthesized form, so it's not used as an operator here.</p>\n\n<p>Neither in your examples:</p>\n\n<pre><code>\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 3 5 6\n14\n\u03bb: (3 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 5) 6\n14\n</code></pre>\n\n<p>Both use prefix syntax. It's <em>syntactically</em> possible to use this as an operator, but it'll necessarily yield a type error.</p>\n\n<h3>Third exampe</h3>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int -&gt; Int -&gt; Int\n(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) a b c = a + b + c\n</code></pre>\n\n<p>Again, it's the same name, so it's still an operator symbol. It's not used as an operator in the definition, because it is prefix.</p>\n\n<p>Your use cases also use prefix syntax:</p>\n\n<pre><code>\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 3 5 6\n14\n\u03bb: (3 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 5) 6\n14\n</code></pre>\n\n<p>But this one <em>can</em> easily be used in infix position, i.e., as an operator:</p>\n\n<pre><code>\u03bb: (3 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 5) 6\n14\n</code></pre>\n\n<h3>Yet another example</h3>\n\n<p>Consider the following definition:</p>\n\n<pre><code>($$$) :: a -&gt; a\n($$$) x = x\n</code></pre>\n\n<p>Here, <code>$$$</code> is also an operator symbol. The definition does not use it as an operator, but in prefix notation. However, it also <em>can</em> be used in infix position, e.g. in</p>\n\n<pre><code>\u03bb: negate $$$ 3\n-3\n</code></pre>\n\n<h3>Concluding remark</h3>\n\n<p>Informally, people will probably talk about functions and operators in non-consistent ways in Haskell because there's really little difference. All are just functions. Being able to use things in infix notation is just syntactic sugar. So the important thing for programming in Haskell is to know the syntactic rules, such as that you can enclose identifiers in backquotes or surround symbols with parentheses. It's less important to know the exact definition of \"operator\". That's just a name.</p>\n"}], "owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 2, "accepted_answer_id": 28126601, "answer_count": 2, "score": 2, "last_activity_date": 1422110095, "creation_date": 1422006125, "question_id": 28106953, "link": "https://stackoverflow.com/questions/28106953/what-is-the-operator-word-definition", "title": "What is the `Operator` word definition?", "body": "<p>I learn Haskell. What definition for the <code>operator</code> word in Haskell? I can't find clear definition.</p>\n\n<p>I think it is <em>something like that</em> (my own understanding):</p>\n\n<blockquote>\n  <p><em>Operator</em> is a <em>function</em> with the name, containing the <code>ascSymbol</code> symbols only, not starting with the <code>:</code> symbol and has <em>two</em> parameters\n  only.</p>\n</blockquote>\n\n<p>From Haskell 2010 the group of <code>ascSymbol</code> contains of:</p>\n\n<blockquote>\n  <p>&#33; # $ % &amp; * + . / &lt; = > ? @ \\ \u02c6 | - \u02dc :</p>\n</blockquote>\n\n<p>But I am not sure I am right... For example, this is the operator <em>in my opinion</em>:</p>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int -&gt; Int\na !#$%&amp;*+./&lt;=&gt;?@\\^|-~: b = a * b\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u03bb: 10 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 20\n200\n\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 40 20\n800\n</code></pre>\n\n<p>But what about this(?):</p>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int\n(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) a = a * a\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 5\n25\n</code></pre>\n\n<p>Or what about this(?):</p>\n\n<pre><code>(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) :: Int -&gt; Int -&gt; Int -&gt; Int\n(!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) a b c = a + b + c\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u03bb: (!#$%&amp;*+./&lt;=&gt;?@\\^|-~:) 3 5 6\n14\n\u03bb: (3 !#$%&amp;*+./&lt;=&gt;?@\\^|-~: 5) 6\n14\n</code></pre>\n\n<p>Are the second and third variants the <em>operators</em> too?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1422005544, "post_id": 28106666, "comment_id": 44587905, "body": "I too am having trouble wrapping my head around this one. My guess is that <code>foldr</code> is building and returning a function, and <code>Nothing</code> is then the input to that function..."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1422008044, "post_id": 28106666, "comment_id": 44589321, "body": "@MathematicalOrchid Sounds right. The type signature of <code>f</code> helps: <code>f :: Eq a =&gt; a -&gt; (Maybe a -&gt; [a]) -&gt; (Maybe a -&gt; [a])</code>."}], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 6, "last_activity_date": 1422006055, "creation_date": 1422006055, "answer_id": 28106923, "question_id": 28106666, "link": "https://stackoverflow.com/questions/28106666/haskell-99-questions-8-cant-understand-foldr/28106923#28106923", "title": "Haskell 99 questions #8: Can&#39;t understand foldr", "body": "<p>You say</p>\n\n<blockquote>\n  <p><code>foldr</code> takes three parameters</p>\n</blockquote>\n\n<p>This is misleading. The type of <code>foldr</code> is</p>\n\n<pre><code>(a -&gt; r -&gt; r) -&gt; r -&gt; [a] -&gt; r\n</code></pre>\n\n<p>where <code>r</code> is a type variable that can be instantiated by any type, including a function type. This is what is happening here, and the hint is indeed given by the fact that the second argument passed to <code>foldr</code> (which should match <code>r</code>) is <code>const []</code>.</p>\n\n<p>The type at that <code>foldr</code> is used here is the following:</p>\n\n<pre><code>foldr :: Eq a =&gt; (a -&gt; (Maybe a -&gt; [a]) -&gt; Maybe a -&gt; [a]) -&gt; (Maybe a -&gt; [a]) -&gt; [a] -&gt; Maybe a -&gt; [a]\nfoldr ::         (a -&gt; r                -&gt; r             ) -&gt; r                -&gt; [a] -&gt; r\n</code></pre>\n\n<p>Once you know that <code>r</code> is instantiated to <code>Maybe a -&gt; [a]</code>, it becomes clear that <code>f</code> effectively takes three arguments here, and <code>foldr</code> takes four.</p>\n\n<p>A much simpler example of the same phenomenon is this:</p>\n\n<pre><code>id id 2\n</code></pre>\n\n<p>Here, <code>id</code> appears to have two arguments. The outer <code>id</code> is used at a function type, the inner <code>id</code> is used with an <code>Integer</code> argument.</p>\n"}, {"comments": [{"owner": {"reputation": 7769, "user_id": 94148, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/3f389086dd4cfc8ec5920d82b47a4abc?s=128&d=identicon&r=PG", "display_name": "aleung", "link": "https://stackoverflow.com/users/94148/aleung"}, "edited": false, "score": 0, "creation_date": 1422009133, "post_id": 28107423, "comment_id": 44589941, "body": "Very clear explanation. In the last intuitive solution, shall it be <code>compress s = fst $ foldr f ([], Nothing) s</code>?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 7769, "user_id": 94148, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/3f389086dd4cfc8ec5920d82b47a4abc?s=128&d=identicon&r=PG", "display_name": "aleung", "link": "https://stackoverflow.com/users/94148/aleung"}, "edited": false, "score": 0, "creation_date": 1422009660, "post_id": 28107423, "comment_id": 44590231, "body": "@aleung Yes, it should. Edited."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 5, "last_activity_date": 1422009670, "last_edit_date": 1422009670, "creation_date": 1422007654, "answer_id": 28107423, "question_id": 28106666, "link": "https://stackoverflow.com/questions/28106666/haskell-99-questions-8-cant-understand-foldr/28107423#28107423", "title": "Haskell 99 questions #8: Can&#39;t understand foldr", "body": "<p>As Jubobs points out, <code>f</code> has the signature <code>f :: Eq a =&gt; a -&gt; (Maybe a -&gt; [a]) -&gt; (Maybe a -&gt; [a])</code> In the context of <code>foldr</code>'s signature, that means <code>a</code> is <code>a</code>, and <code>b</code> is <code>(Maybe a -&gt; [a])</code>. So the <code>foldr</code> indeed builds a complicated function.</p>\n\n<p>Let's look at the list <code>\"aab\"</code>, a very simple input. The fold expands to</p>\n\n<pre><code>(f 'a' (f 'a' (f 'b' (const []))))\n</code></pre>\n\n<p>Passing <code>Nothing</code> to that construct, you can start expanding it. The outermost call then has</p>\n\n<pre><code>x = 'a'\nr = &lt;the inner stuff&gt;\na@(Just q) fails to match Nothing\n_ matches Nothing\n</code></pre>\n\n<p>so its result is <code>'a' : r (Just 'a')</code>. Substituting <code>r</code> we get:</p>\n\n<pre><code>'a' : f 'a' (f 'b' (const [])) (Just 'a')\n</code></pre>\n\n<p>The new outermost call to <code>f</code> then has</p>\n\n<pre><code>x = 'a'\nr = (f 'b' (const []))\na@(Just q) matches Just 'a'\nguard 'a' == 'a' is true\n</code></pre>\n\n<p>So the <code>r a</code> branch is taken, i.e. it just forwards to the next in chain. The result of the function is <code>r (Just 'a')</code>, and the result of the entire expression is currently <code>'a' : r (Just 'a')</code>. Substitute <code>r</code> again:</p>\n\n<pre><code>'a' : f 'b' (const []) (Just 'a')\n</code></pre>\n\n<p>The new parameters to <code>f</code>:</p>\n\n<pre><code>x = 'b'\nr = const []\na@(Just q) matches Just 'a'\nguard 'b' == 'a' is false\n_ matches Just 'a'\n</code></pre>\n\n<p>We take the second option again, because the guard failed. The guard basically says, \"if the previous character (<code>q</code>, <code>a</code> is <code>Nothing</code> if there was no previous character) is the same as the current (<code>x</code>), don't put it in the output, otherwise do\".</p>\n\n<p>So the function result is <code>'b' : const [] (Just 'b')</code>, and the full expression result as we currently see it is <code>'a' : 'b' : const [] (Just 'b')</code>.</p>\n\n<p>The <code>const</code> function ignores its second argument and returns the first. It looks like this:</p>\n\n<pre><code>const :: a -&gt; b -&gt; a\nconst x _ = x\n</code></pre>\n\n<p>In the call in our expression, the arguments match like this:</p>\n\n<pre><code>x = []\n_ = Just 'b'\n</code></pre>\n\n<p>The result therefore is <code>[]</code>. The entire expression is now <code>'a' : 'b' : []</code>, or in string syntax, <code>\"ab\"</code>. The duplicate <code>'a'</code> has been removed.</p>\n\n<p>You can play this game on paper for a longer expression if you want.</p>\n\n<p>The solution basically uses <code>foldr</code> to build a function that uses continuation passing style so it can carry state along. It's a funky technique. A more intuitive way of carrying state through a fold would be to make the fold result a tuple of the actual accumulator and the state you want to carry, then extract the proper result at the end. For your problem, this could look like this:</p>\n\n<pre><code>compress s = fst $ foldr f ([], Nothing) s\n  where\n    f cur (acc, (Just prev)) | cur == prev = (acc, (Just prev))\n    f cur (acc, _) = (cur : acc, Just cur)\n</code></pre>\n\n<p>This should work just as well. Note, however, that this <strong>reverses</strong> the order the state is carried, i.e. it walks through the string backwards. I'm not sure what the performance or laziness of one vs the other is. I think the CPS solution is more lazy, but I am not sure.</p>\n"}], "owner": {"reputation": 7769, "user_id": 94148, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/3f389086dd4cfc8ec5920d82b47a4abc?s=128&d=identicon&r=PG", "display_name": "aleung", "link": "https://stackoverflow.com/users/94148/aleung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 28107423, "answer_count": 2, "score": 3, "last_activity_date": 1422009670, "creation_date": 1422005138, "question_id": 28106666, "link": "https://stackoverflow.com/questions/28106666/haskell-99-questions-8-cant-understand-foldr", "title": "Haskell 99 questions #8: Can&#39;t understand foldr", "body": "<p>I'm doing exercise of Haskell <a href=\"https://www.haskell.org/haskellwiki/99_questions/1_to_10\" rel=\"nofollow\">99 questions</a>. </p>\n\n<blockquote>\n  <h1>Problem 8</h1>\n  \n  <p>Eliminate consecutive duplicates of list elements.</p>\n  \n  <p>If a list contains repeated elements they should be replaced with a\n  single copy of the element. The order of the elements should not be\n  changed.</p>\n  \n  <p>Example in Haskell:</p>\n\n<pre><code> &gt; compress \"aaaabccaadeeee\" \n\n \"abcade\"\n</code></pre>\n</blockquote>\n\n<p>I can't understand this solution:</p>\n\n<pre><code>compress xs = foldr f (const []) xs Nothing\n  where\n    f x r a@(Just q) | x == q = r a\n    f x r _ = x : r (Just x)\n</code></pre>\n\n<p><code>foldr</code> takes three parameters. The first parameter is a function <code>(a -&gt; b -&gt; b)</code>. The second is initial accumulator and the third is a list.</p>\n\n<p>Is <code>(const [])</code> the second parameter passed to <code>foldr</code>?</p>\n\n<p>The function <code>f :: Eq a =&gt; a -&gt; (Maybe a -&gt; [a]) -&gt; Maybe a -&gt; [a]</code> takes three parameters, doesn't match what's expected by <code>foldr</code>. What values are passed in?</p>\n\n<p>The last <code>Nothing</code> is for what?</p>\n"}, {"tags": ["javascript", "haskell", "ghc", "ghcjs"], "comments": [{"owner": {"reputation": 31483, "user_id": 502381, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/74b99e687909be449e0130a50950eac7?s=128&d=identicon&r=PG&f=1", "display_name": "JJJ", "link": "https://stackoverflow.com/users/502381/jjj"}, "edited": false, "score": 1, "creation_date": 1422003876, "post_id": 28106229, "comment_id": 44587040, "body": "Are you sure the Haskell compiler doesn&#39;t optimize the code to just print the end result? In any case we probably need to see the generated code to find out why it&#39;s faster."}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 9, "creation_date": 1422006170, "post_id": 28106229, "comment_id": 44588238, "body": "Provide the output .js from ghcjs please. That is how to answer the question."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1422006818, "post_id": 28106229, "comment_id": 44588631, "body": "<a href=\"https://gist.github.com/viclib/3023b1c44daf7f33ede4\" rel=\"nofollow noreferrer\">This</a> is the output js. <a href=\"https://gist.github.com/viclib/9108f02fb1655cdc0787\" rel=\"nofollow noreferrer\">This</a> too, except it prints the whole array after printing the sum in order to make sure it was filled."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1422024980, "post_id": 28106229, "comment_id": 44598791, "body": "unroll the JavaScript loops to speed it up."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1422038499, "post_id": 28106229, "comment_id": 44607229, "body": "@karakfa: Does that actually help? I tried unrolling to a few different lengths (ie 2, 4 and 16 additions per iteration), and it just made it a bit slower. Maybe I did something wrong? <a href=\"http://lpaste.net/119079\" rel=\"nofollow noreferrer\">Here&#39;s</a> the most unrolled version I tried."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1422289076, "post_id": 28106229, "comment_id": 44679643, "body": "@TikhonJelvis loop unrolling usually helps (not just for JS).  See this <a href=\"http://jsperf.com/loop-unrolling\" rel=\"nofollow noreferrer\">jsperf.com/loop-unrolling</a> for performance tests of various approaches.  Sorry, I couldn&#39;t open your link from work."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1422045077, "post_id": 28118061, "comment_id": 44610469, "body": "Ah, I see - my mistake was assuming <code>sumAllP</code> computed the array before. Calling <code>computeP</code> makes it slower - albeit still by a small (4x) margin. But now I found something else unexpected: doubling the length makes the JavaScript program run out of memory, while the Haskell program (using computeP), compiled to JavaScript, doesn&#39;t. I&#39;m sure computeP is actually computing the array since it prints it, so... that is left as a mystery for me."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1422046023, "post_id": 28118061, "comment_id": 44610962, "body": "It&#39;s not a matter of when the array is evaluated. <code>arr</code> is not physically stored as an array regardless of how much or how little you evaluate it."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1422046423, "post_id": 28118061, "comment_id": 44611163, "body": "If you want a physical array, you can use one of the other storage formats like <code>U</code> (instead of <code>D</code>)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1422048323, "post_id": 28118061, "comment_id": 44612126, "body": "Yes, <code>computeP</code> produces an <code>U</code> array."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1422044315, "creation_date": 1422044315, "answer_id": 28118061, "question_id": 28106229, "link": "https://stackoverflow.com/questions/28106229/how-can-this-haskell-program-compiled-to-javascript-be-faster-than-javascript/28118061#28118061", "title": "How can this Haskell program, compiled to JavaScript, be faster than JavaScript itself?", "body": "<p><code>Array D DIM1 Float</code> is a <a href=\"http://hackage.haskell.org/package/repa-3.2.3.3/docs/Data-Array-Repa-Repr-Delayed.html\" rel=\"nofollow\">delayed array</a>. It is just represented as the function <code>const 1</code> plus the bounds of the array. There is no array of 64 million Floats stored anywhere.</p>\n\n<p>The JavaScript program actually creates an array of 64 million doubles, which uses 512 MB of memory. The costs to read and write such a large array are non-negligible (as is the cost to allocate it; note the substantial system time).</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1422044315, "creation_date": 1422003605, "question_id": 28106229, "link": "https://stackoverflow.com/questions/28106229/how-can-this-haskell-program-compiled-to-javascript-be-faster-than-javascript", "title": "How can this Haskell program, compiled to JavaScript, be faster than JavaScript itself?", "body": "<p>I always believed GHCJS, for obvious reasons, generated very slow JavaScript programs, compared to manually written and optimized code. When experimenting with it, though, I noticed it was not as bad as I expected. I decided to run a series of small benchmarks to get a grasp on the true performance, and this one in particular surprised me. The program simply fills an array with \"1\"'s and add them up.</p>\n\n<p>Haskell:</p>\n\n<pre><code>import Data.Array.Repa\nlen  = 1024*1024*64\narr  = fromFunction (Z :. len) (const 1) :: Array D DIM1 Float\nmain = sumAllP arr &gt;&gt;= print\n</code></pre>\n\n<p>JavaScript:</p>\n\n<pre><code>var len = 1024*1024*64\nvar arr = [];\nvar sum = 0;\nfor (var i=0; i&lt;len; ++i)\n    arr[i] = 1;\nfor (var i=0; i&lt;len; ++i)\n    sum += arr[i];\nconsole.log(sum);\n</code></pre>\n\n<p>And a crude benchmark:</p>\n\n<pre><code>apple1$ ghcjs -O2 bench_fill.hs -funfolding-use-threshold10000 -funfolding-keeness-factor1000 -o bench_fill.js; time node bench_fill.js/all.js\nLinking bench_fill.js (Main)\n6.7108864e7\n\nreal    0m1.543s\nuser    0m1.512s\nsys 0m0.033s\n\napple1$ time node benchfill.js\n67108864\n\nreal    0m1.764s\nuser    0m1.173s\nsys 0m0.583s\n</code></pre>\n\n<p>How can the GHCJS run faster than a slim, clean native for-loop? That shouldn't be possible considering the amount of boxings the generated code should be exposed to.</p>\n"}, {"tags": ["haskell", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1421996059, "post_id": 28104381, "comment_id": 44583741, "body": "Don&#39;t you want to do something like check if a &lt; x or if a &gt; x and recurse down the left tree or right tree based on those checks?"}, {"owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "edited": false, "score": 0, "creation_date": 1421996345, "post_id": 28104381, "comment_id": 44583834, "body": "What do you mean by successor and predecessor?"}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1422001306, "post_id": 28104381, "comment_id": 44585881, "body": "Give examples, what should it return for which input? Is the <code>LookupTree</code> contrained, e.g. left subtree should be smaller than the right? (Don&#39;t just answer <i>yes</i>, <i>smaller</i> is vague.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1422003565, "post_id": 28104381, "comment_id": 44586872, "body": "These are binary <i>search</i> trees, I guess? Otherwise, you need to fold over every node."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430972198, "post_id": 28104381, "comment_id": 48296221, "body": "@SiXa are you stitll interested in this? The answer should be no big deal once you react to the points asked in the comments here - if not we should close the question"}], "answers": [{"tags": [], "owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "is_accepted": false, "score": 1, "last_activity_date": 1508447377, "creation_date": 1508447377, "answer_id": 46838936, "question_id": 28104381, "link": "https://stackoverflow.com/questions/28104381/precessor-and-successor-in-binary-tree/46838936#46838936", "title": "Precessor and successor in Binary Tree", "body": "<p>If you are talking about the inorder predecessor or successor of a node in a BST, then I am presenting the solution below. I don't understand what you mean by the smallest predecessor of a node because the smallest predecessor of a node is just the smallest element in the BST which is extremely easy to find.</p>\n\n<p>So what I am demonstrating below is given a Node finding the inorder predecessor or the largest predecessor:</p>\n\n<p>The signature which you give will not work because we need to encode the parent information:</p>\n\n<p>Hence the tree will look like this:</p>\n\n<pre><code>type Parent = BstP\ntype LChild = BstP\ntype RChild = BstP\n\ndata BstP = None | Node1 Key Parent LChild RChild deriving Show\n</code></pre>\n\n<p>And the code to find the inorder predecessor is given below:</p>\n\n<pre><code>type Key = Int\n\npredecessor :: BstP -&gt; Key\npredecessor  None              = undefined\npredecessor (Node1 a p None _) = findPredAncestor a p\npredecessor (Node1 a _ l _)    = treeMaximumP l\n\ntreeMaximumP :: BstP -&gt; Key\ntreeMaximumP  None               = undefined\ntreeMaximumP (Node1 a _ _ None ) = a\ntreeMaximumP (Node1 _ _ _ r)     = treeMaximumP r\n\nfindPredAncestor :: Key -&gt; BstP -&gt; Key\nfindPredAncestor k (Node1 a p l r)\n  | (keyP r) == k = a\n  | otherwise = findPredAncestor a p\n\nkeyP :: BstP -&gt; Key\nkeyP  None           = undefined\nkeyP (Node1 a _ _ _) = a\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 4341931, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c747f3d4b34a84bdff7ea05fc357e712?s=128&d=identicon&r=PG&f=1", "display_name": "SiXa", "link": "https://stackoverflow.com/users/4341931/sixa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "closed_date": 1517642914, "answer_count": 1, "score": 0, "last_activity_date": 1517568768, "creation_date": 1421995417, "last_edit_date": 1517568768, "question_id": 28104381, "link": "https://stackoverflow.com/questions/28104381/precessor-and-successor-in-binary-tree", "closed_reason": "Needs details or clarity", "title": "Precessor and successor in Binary Tree", "body": "<p>I wanted to implement 2 codes, one for the biggest successor of x and one for the smallest predecessor of x in a binary tree.</p>\n\n<pre><code>data LookupTree a = Blatt  | Knoten a (LookupTree a) (LookupTree a)\nbiggestSucc :: Ord a =&gt; a -&gt; LookupTree a -&gt; Int\nbiggestSucc x Blatt = error \"Am Knoten\"\nbiggestSucc x (Knoten a l r)\n    |a == x = max l r\n    |a /= x = biggestSucc x _\n\nsmallestPre :: Ord a =&gt; a -&gt; LookupTree a -&gt; Int\nsmallestPre x Blatt = error \"Am Knoten\"\nsmallestPre x (Knoten a l r)\n    |a == x = \n    |a /= x = smallestPre x _\n</code></pre>\n\n<p>The problem is the <code>max</code> and <code>min</code> function and the <code>smallestPre</code>/<code>biggestSucc x _</code> thing. But how else can I tell him to go on in both directions of the node? Thanks!</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457851573, "creation_date": 1457851573, "answer_id": 35967404, "question_id": 28103156, "link": "https://stackoverflow.com/questions/28103156/access-cabals-exposed-modules-from-test-suite-via-distribution-package/35967404#35967404", "title": "access cabal&#39;s &quot;exposed-modules&quot; from test suite via Distribution package", "body": "<p>Using <code>Distribution.PackageDescription.Parse</code> you can call <code>readPackageDescription</code> to get your package's description, and then from <code>condLibrary</code> extract the <code>exposedModules</code> section.</p>\n"}], "owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1457851573, "creation_date": 1421988077, "question_id": 28103156, "link": "https://stackoverflow.com/questions/28103156/access-cabals-exposed-modules-from-test-suite-via-distribution-package", "title": "access cabal&#39;s &quot;exposed-modules&quot; from test suite via Distribution package", "body": "<p>given <code>example.cabal</code>:</p>\n\n<pre><code>exposed-modules:\n A.B\n A.B.C\n</code></pre>\n\n<p>can I import a <code>exposedModules</code> from <code>Distribution.Something</code> where:</p>\n\n<pre><code>&gt;&gt;&gt; exposedModules &gt;&gt;= print\n[\"A.B\",\"A.B.C\"]\n</code></pre>\n\n<p>the use case is <code>doctest</code>, which takes a list of modules/files, non-recursively. I could:</p>\n\n<pre><code>main = do\n exposedModules &gt;&gt;= doctest\n</code></pre>\n\n<p>I checked its reverse dependencies (<a href=\"http://packdeps.haskellers.com/reverse/doctest\" rel=\"nofollow\">http://packdeps.haskellers.com/reverse/doctest</a>), and it looks like lens does it manually (<a href=\"https://hackage.haskell.org/package/lens-4.7/src/tests/doctests.hsc\" rel=\"nofollow\">https://hackage.haskell.org/package/lens-4.7/src/tests/doctests.hsc</a>).</p>\n\n<p>and hoogling for <code>exposedModules</code>, I can't see how to get the \"current\" package's <code>Library</code> (<a href=\"https://www.haskell.org/hoogle/?hoogle=%2Bcabal+exposedModules\" rel=\"nofollow\">https://www.haskell.org/hoogle/?hoogle=%2Bcabal+exposedModules</a>).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1421987924, "post_id": 28103118, "comment_id": 44581364, "body": "<code>Rand StdGen Int</code> is a concrete type."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1421988116, "post_id": 28103118, "comment_id": 44581401, "body": "Thanks, user5402. Could you please consider my question about what a <code>Rand StdGen Int</code> is? Or, perhaps you could show me an implementation, please?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1421988300, "post_id": 28103118, "comment_id": 44581445, "body": "I&#39;ve edited slightly your question - the <code>Source</code> is just a hyperlink which displays the source code for the definition of StdGen."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422016888, "post_id": 28103118, "comment_id": 44594073, "body": "<code>Rand StdGen</code> is a <code>Monad</code>, and you haven&#39;t specified what <code>f</code> should <i>do</i>, so the simplest implementation is something like <code>const (return 0)</code>."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1422065245, "post_id": 28103118, "comment_id": 44617225, "body": "@user2407038 - why did you add the <code>const</code>? I was able to simply do: <code>let x = return 0 :: Rand StdGen Int</code>"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1421989359, "last_edit_date": 1421989359, "creation_date": 1421988558, "answer_id": 28103223, "question_id": 28103118, "link": "https://stackoverflow.com/questions/28103118/building-a-rand-stdgen-int/28103223#28103223", "title": "Building a Rand StdGen Int", "body": "<p>You need to follow the rabbit hole all the way down. You have</p>\n\n<pre><code>newtype Rand g a = Rand (RandT g Identity a)\n</code></pre>\n\n<p>so to build a <code>Rand StdGen Int</code> you need a <code>RandT StdGen Identity Int</code>. And then (leaving out some noise):</p>\n\n<pre><code>newtype RandT g m a = RandT (StateT g m a)\n</code></pre>\n\n<p>so for <em>that</em>, you need a <code>StateT StdGen Identity Int</code>. And then</p>\n\n<pre><code>newtype StateT s m a = StateT {runStateT :: s -&gt; m (a, s)}\n</code></pre>\n\n<p>so what you need is <code>StdGen -&gt; Identity (Int, StdGen)</code>. Now because</p>\n\n<pre><code>newtype Identity a = Identity {runIdentity :: a}\n</code></pre>\n\n<p>that is essentially the same as <code>StdGen -&gt; (Int, StdGen)</code>.</p>\n\n<p>So <code>Rand StdGen Int</code> is essentially a several levels deep <code>newtype</code> wrapping around a function that takes a <code>StdGen</code>, and produces an <code>Int</code> result and a new <code>StdGen</code>.</p>\n\n<p>However, you cannot use this directly to construct your <code>f</code>, because <code>Control.Monad.Random</code> <em>doesn't export</em> the newtype constructors, so this representation is hidden to users of the library. Instead you need to use the API functions which it <em>does</em> provide. One possibility:</p>\n\n<pre><code>f :: Int -&gt; Rand StdGen Int\nf n = getRandomR (0,n)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1421990004, "post_id": 28103272, "comment_id": 44581863, "body": "<b>edit</b>: I originally asked about constructing a new <code>Rand StdGen</code> directly, but then recalled what @&#216;rjan had written: <code>However, you cannot use this directly to construct your f, because Control.Monad.Random doesn&#39;t export the newtype constructors</code> in this below answer."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1422065035, "post_id": 28103272, "comment_id": 44617188, "body": "Interesting. How does <code>getRandom</code> return a random number <b>without</b> a generator?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1422081497, "post_id": 28103272, "comment_id": 44619817, "body": "<code>getRandom</code> can&#39;t produce a random value by itself - you need to &quot;run&quot; it with an evalRand* or runRand* function, and if you look at the signatures of those functions you see that you need to either supply a generator or, in the evalRandIO, a generator will be created for you."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1421989658, "last_edit_date": 1421989658, "creation_date": 1421988884, "answer_id": 28103272, "question_id": 28103118, "link": "https://stackoverflow.com/questions/28103118/building-a-rand-stdgen-int/28103272#28103272", "title": "Building a Rand StdGen Int", "body": "<p>Let's say <code>m</code> is a value of type <code>Rand StdGen Int</code>. Then some things we can do with it are:</p>\n\n<pre><code>-- use it to generate a random Int\nevalRandIO m &gt;&gt;= print   -- generate a random Int and print it\n\n-- create a generator for a pair of random Ints\ntwoRandInts :: Rand StdGen (Int,Int)\ntwoRandInts = do a &lt;- m; b &lt;- m; return (a,b)\n</code></pre>\n\n<p>You can think of it as a (monadic) procedure which creates a random Int using a <code>StdGen</code> seed. Note that <code>m</code> by itself is just the procedure. To \"run\" the procedure you need to use a function like <code>evalRandIO</code>.</p>\n\n<p>To answer your question about what a function like <code>f</code> would look like, consider this (taken from the Example section of the MonadRandom docs) <a href=\"http://hackage.haskell.org/package/MonadRandom-0.3.0.1/docs/Control-Monad-Random.html#g:2\" rel=\"nofollow\">(link)</a>:</p>\n\n<pre><code>-- produce a random number between 1 and n\nf :: Int -&gt; Rand StdGen Int\nf n = getRandomR (1,n)\n</code></pre>\n\n<p>Another example:</p>\n\n<pre><code>-- produce a random multiple of n\ng :: Int -&gt; Rand StdGen Int\ng n = fmap (*n) getRandom\n</code></pre>\n\n<p>To create <code>Rand g a</code> values, use the <code>getRandom*</code> methods defined in Control.Monad.Random.Class.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1421989658, "creation_date": 1421987726, "last_edit_date": 1495540850, "question_id": 28103118, "link": "https://stackoverflow.com/questions/28103118/building-a-rand-stdgen-int", "title": "Building a Rand StdGen Int", "body": "<p>I'm trying to understand what the following type signature means.</p>\n\n<p><code>f :: Int -&gt; Rand StdGen Int</code></p>\n\n<p>So <code>Rand</code> is a <code>newtype</code>, says the <a href=\"http://hackage.haskell.org/package/MonadRandom-0.1.3/docs/src/Control-Monad-Random.html\" rel=\"nofollow noreferrer\">source</a>.</p>\n\n<pre><code>-- | A basic random monad.\nnewtype Rand g a = Rand (RandT g Identity a)\n    deriving (Functor, Monad, MonadRandom, MonadSplit g)\n</code></pre>\n\n<p>I don't know what the right-hand side involves, but let me continue.</p>\n\n<p>Its kind is:</p>\n\n<pre><code>ghci&gt; :k Rand\nRand :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>I believe that <code>StdGen</code> is an instance of <code>RandomGen</code>,  which is a type class.</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/random-1.0.0.3/docs/System-Random.html#t:RandomGen\" rel=\"nofollow noreferrer\">docs</a> note:</p>\n\n<pre><code>data StdGen\n\nThe StdGen instance of RandomGen has a genRange of at least 30 bits.\n</code></pre>\n\n<p><strong>EDIT</strong>:\nPer <a href=\"https://stackoverflow.com/users/866915/user5402\">@user5402</a>'s comment, <code>Rand StdGen Int</code> is a concrete type.</p>\n\n<pre><code>ghci&gt; :k Rand StdGen Int\nRand StdGen Int :: *\n</code></pre>\n\n<p>However, I'm not sure what it means to make a <code>Rand StdGen Int</code>. </p>\n\n<p>Please provide an implementation of the above function, <code>f</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1421985306, "post_id": 28102588, "comment_id": 44580739, "body": "See <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/constraint-kind.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/&hellip;</a> for more info."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 7, "last_activity_date": 1421985738, "last_edit_date": 1421985738, "creation_date": 1421985122, "answer_id": 28102737, "question_id": 28102588, "link": "https://stackoverflow.com/questions/28102588/understanding-kind-of-random/28102737#28102737", "title": "Understanding `Kind` of `Random`", "body": "<p>There are a handful of kinds in Haskell.  A concrete type has kind <code>*</code>, this means that it is fully applied, so types like <code>Int</code>, <code>[String]</code>, <code>IO (Maybe Int)</code>.  Then there are kinds that take the form <code>* -&gt; k</code>, where <code>k</code> is a kind variable.  These are just like functions in Haskell that take 1 or more arguments, except <code>*</code> <em>has</em> to be a concrete type, it isn't variable.  Examples would be</p>\n\n<pre><code>&gt; :kind Maybe\nMaybe :: * -&gt; *\n&gt; :kind Either\nEither :: * -&gt; * -&gt; *\n&gt; data Foo a b c d e = Foo\n&gt; :kind Foo\nFoo :: * -&gt; * -&gt; * -&gt; * -&gt; * -&gt; *\n</code></pre>\n\n<p>Then there is the kind <code>Constraint</code>, which is constructed with one or more<sup>1</sup> other kinds:</p>\n\n<pre><code>&gt; :kind Num\nNum :: * -&gt; Constraint\n&gt; :kind Show\nShow :: * -&gt; Constraint\n&gt; import Control.Monad.State\n&gt; :kind MonadState\nMonadState :: * -&gt; (* -&gt; *) -&gt; Constriant\n</code></pre>\n\n<p>The last one is a bit more complex, but think of it like a higher order function, where <code>(* -&gt; *)</code> means that the second argument must be a type constructor that has one type argument left.</p>\n\n<p><code>Random</code> is just a simple typeclass, so it takes a fully applied type and produces a <code>Constraint</code>.</p>\n\n<p>There is also the primitive kind <code>#</code>, values of types that are primitive and baked in to GHC, they even require a language extension just to parse their names:</p>\n\n<pre><code>&gt; import GHC.Prim\n&gt; :set -XMagicHash\n&gt; :i Int#\ndata Int#\n&gt; :k Int#\nInt# :: #\n</code></pre>\n\n<p>Most Haskell programmers won't ever need to use these, but they're available if you need to do low level programming for the GHC API.</p>\n\n<p>With a couple extensions, you can even make kinds yourself</p>\n\n<pre><code>&gt; :set -XDataKinds\n&gt; :set -XKindSignatures\n&gt; :set -XGADTs\n&gt; -- Multiline input in GHCi\n&gt; :set +m\n&gt; data FlagType = Flag1 | Flag2 deriving (Show)\n&gt; data Foo :: FlagType -&gt; * -&gt; *\n|     F1 :: Int -&gt; Foo 'Flag1 Int\n|     F2 :: String -&gt; Foo 'Flag2 String\n|\n&gt; :t F1 1\nF1 1 :: Foo 'Flag1 Int\n&gt; :t F2 \"foo\"\nF2 \"foo\" :: Foo 'Flag2 String\n</code></pre>\n\n<p>Kinds give us a form of type level programming, there are lots of tricks that can be done with them to build nice APIs.</p>\n\n<p><sup>1.</sup> <a href=\"https://ocharles.org.uk/blog/posts/2014-12-10-nullary-type-classes.html\" rel=\"nofollow\">Not necessarily true</a></p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 28102737, "answer_count": 1, "score": 2, "last_activity_date": 1421985738, "creation_date": 1421983991, "question_id": 28102588, "link": "https://stackoverflow.com/questions/28102588/understanding-kind-of-random", "title": "Understanding `Kind` of `Random`", "body": "<p><code>Maybe</code>, which I understand to be a <code>type constructor</code>, has kind <code>* -&gt; *</code>. As I understand, it needs a type in order to produce a type.</p>\n\n<pre><code>ghci&gt; :k Maybe\nMaybe :: * -&gt; *\nghci&gt; :k Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p>However, what does the following output mean?</p>\n\n<pre><code>ghci&gt; :k Random\nRandom :: * -&gt; Constraint\n</code></pre>\n"}, {"tags": ["haskell", "binary-tree", "list-comprehension", "catalan"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1421970387, "last_edit_date": 1495542258, "creation_date": 1421970387, "answer_id": 28100721, "question_id": 28100650, "link": "https://stackoverflow.com/questions/28100650/generate-all-possible-trees/28100721#28100721", "title": "Generate All Possible Trees", "body": "<p>The list comprehension</p>\n\n<pre><code>[ (x,y) | x&lt;-[1..] , y&lt;-[1..] ]\n</code></pre>\n\n<p>starts by considering <code>x=1</code> and building all the pairs <code>(1,y)</code> for all the possible <code>y</code>s. Then follows with <code>x=2</code> and all the <code>(2,y)</code> pairs. and so on.</p>\n\n<p>However, there are infinitely many <code>(1,y)</code> pairs, so <code>x=2</code> will only be considered after an infinite amount of time -- that is, not at all.</p>\n\n<p>Your code suffers from the same problem. </p>\n\n<p>To see a possible solution, you can refer to <a href=\"https://stackoverflow.com/questions/23515191/how-to-enumerate-a-recursive-datatype-in-haskell/23517557#23517557\">this related question</a> exploiting the Omega monad to achieve a fair scheduling among all the cases.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1421970577, "creation_date": 1421970577, "answer_id": 28100759, "question_id": 28100650, "link": "https://stackoverflow.com/questions/28100650/generate-all-possible-trees/28100759#28100759", "title": "Generate All Possible Trees", "body": "<p>One way is to keep track of the size of the tree (i.e. the number of <code>Node</code> constructors used.)</p>\n\n<p>Suppose you had a function like this which returned the trees using exactly <em>n</em> Node constructors:</p>\n\n<pre><code>treesOfSize :: Int -&gt; [FormTree]\n</code></pre>\n\n<p>Then <code>allTrees</code> could be defined as:</p>\n\n<pre><code>allTrees = concatMap treesOfSize [0..]\n</code></pre>\n\n<p>The definition of <code>treesOfSize</code> can be recursively defined which I'll let you figure out:</p>\n\n<pre><code>treesOfSize 0 = [Empty]\ntreesOfSize n = [ Node t1 t2 | ... ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1421975524, "creation_date": 1421975524, "answer_id": 28101516, "question_id": 28100650, "link": "https://stackoverflow.com/questions/28100650/generate-all-possible-trees/28101516#28101516", "title": "Generate All Possible Trees", "body": "<p>Here's a nice trick, reminiscent of the standard Fibonacci numbers trick. We'll build a lazy list; each member of the list will be a list of all trees with a given number of nodes. There's just one tree with no nodes, <code>Empty</code>, and that will serve as our base case. To build all the trees with <code>n</code> nodes, we'll assume we already know how to build trees with <code>0</code>, <code>1</code>, <code>2</code>, ..., <code>n-1</code> nodes. Then we'll just non-deterministically choose a pairing of those that sums to <code>n-1</code> and stuck a <code>Node</code> on top.</p>\n\n<p>In code:</p>\n\n<pre><code>import Control.Monad\nimport Data.List\n\nsizes :: [[FormTree]]\nsizes = [Empty] : (map go . drop 1 . inits) sizes where\n    go smaller = do\n      (ls, rs) &lt;- zip smaller (reverse smaller)\n      liftM2 Node ls rs\n</code></pre>\n\n<p>Then we can simply define <code>allPossibleTrees = concat sizes</code> if that's wanted. The first few entries:</p>\n\n<pre><code>*Main&gt; mapM_ print (take 4 sizes)\n[Empty]\n[Node Empty Empty]\n[Node Empty (Node Empty Empty),Node (Node Empty Empty) Empty]\n[Node Empty (Node Empty (Node Empty Empty)),Node Empty (Node (Node Empty Empty) Empty),Node (Node Empty Empty) (Node Empty Empty),Node (Node Empty (Node Empty Empty)) Empty,Node (Node (Node Empty Empty) Empty) Empty]\n</code></pre>\n\n<p>We can do a quick sanity check:</p>\n\n<pre><code>*Main&gt; take 10 (map length sizes)\n[1,1,2,5,14,42,132,429,1430,4862]\n</code></pre>\n\n<p>...which is indeed the first ten <a href=\"http://oeis.org/A000108\">Catalan numbers</a>, so we probably got it right!</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1422858636, "post_id": 28124897, "comment_id": 44899629, "body": "Yeah, but that eleventh one... <code>take 11 . map size $ allPossibleTrees = [0,1,2,2,3,3,3,3,4,4,3]</code>. Whoops!"}], "tags": [], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "is_accepted": false, "score": 1, "last_activity_date": 1422098141, "creation_date": 1422098141, "answer_id": 28124897, "question_id": 28100650, "link": "https://stackoverflow.com/questions/28100650/generate-all-possible-trees/28124897#28124897", "title": "Generate All Possible Trees", "body": "<p><code>control-monad-omega</code> library seems to do the trick with your original code:</p>\n\n<pre><code>{-# LANGUAGE MonadComprehensions #-}\n\nimport Control.Monad.Omega\n\ndata Empty = Empty | Node Empty Empty deriving Show\n\nallPossibleTrees :: [Empty]\nallPossibleTrees = Empty : \n    runOmega [Node x y | x &lt;- each allPossibleTrees, y &lt;- each allPossibleTrees]\n</code></pre>\n\n<p>First 10 trees look good to me:</p>\n\n<pre><code>*Main&gt; mapM_ print $ take 10 allPossibleTrees \nEmpty\nNode Empty Empty\nNode Empty (Node Empty Empty)\nNode (Node Empty Empty) Empty\nNode Empty (Node Empty (Node Empty Empty))\nNode (Node Empty Empty) (Node Empty Empty)\nNode (Node Empty (Node Empty Empty)) Empty\nNode Empty (Node (Node Empty Empty) Empty)\nNode (Node Empty Empty) (Node Empty (Node Empty Empty))\nNode (Node Empty (Node Empty Empty)) (Node Empty Empty)\n</code></pre>\n"}], "owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1450, "favorite_count": 2, "accepted_answer_id": 28101516, "answer_count": 4, "score": 2, "last_activity_date": 1485953725, "creation_date": 1421969846, "last_edit_date": 1485953725, "question_id": 28100650, "link": "https://stackoverflow.com/questions/28100650/generate-all-possible-trees", "title": "Generate All Possible Trees", "body": "<p>Given the following data type definition:</p>\n\n<pre><code>data FormTree = Empty | Node FormTree FormTree deriving Show\n</code></pre>\n\n<p>I want to write a function which generates an infinite list containing all possible trees sorted after length e.g. the amount of nodes.</p>\n\n<p>The following code almost does what I need but it only descends the tree on the right side by inserting additional nodes every time but I need it to alternate between both sides.</p>\n\n<pre><code>allPossibleTrees :: [FormTree]\nallPossibleTrees = Empty : [Node x y | x &lt;- recursive, y &lt;- recursive]\n    where recursive = allPossibleTrees\n</code></pre>\n\n<p>Executing</p>\n\n<pre><code>take 5 allPossibleTrees\n</code></pre>\n\n<p>gives:</p>\n\n<pre><code>[Empty,Node Empty Empty,Node Empty (Node Empty Empty),Node Empty (Node Empty (Nodes Empty Empty)),Node Empty (Node Empty (Node Empty (Node Empty Empty)))]\n</code></pre>\n\n<p>but it should be something like:</p>\n\n<pre><code>[Empty,Node Empty Empty,Node (Node Empty Empty) Empty,Node Empty (Node Empty Empty),Node (Node Empty Empty) (Node Empty Empty)]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "is_accepted": true, "score": 7, "last_activity_date": 1422010152, "last_edit_date": 1495539810, "creation_date": 1421968610, "answer_id": 28100438, "question_id": 28100135, "link": "https://stackoverflow.com/questions/28100135/compare-fixed-sized-vectors/28100438#28100438", "title": "Compare fixed sized vectors", "body": "<p><code>ghc</code> cannot (not yet?) deduce the type equality <code>n ~ n'</code> from <code>(n+1) ~ (n'+1)</code>\nwhile it has no trouble with deducing it from <code>S n ~ S n'</code> See e.g. <a href=\"https://stackoverflow.com/questions/24734704/append-for-type-level-numbered-lists-with-typelits?rq=1\">Append for type-level numbered lists with TypeLits</a> for an explanation, and a possible way out (i.e. to have both Peano-style naturals and still be able to use literals like<code>5</code>)</p>\n\n<p>But, if you change your definition of <code>Nvector</code> into</p>\n\n<pre><code>data NVector (n :: Nat) a where\n    Nil :: NVector 0 a\n    Cons :: a -&gt; NVector (n -1) a -&gt; NVector n a\n</code></pre>\n\n<p>it will have to deduce <code>n-1 ~ n'-1</code> from <code>n ~ n'</code>, a much easier deduction! This compiles, and still yields a correct type for e.g. <code>Cons () Nil</code>:</p>\n\n<pre><code>*Main&gt; :t Cons () Nil\nCons () Nil :: NVector 1 ()\n</code></pre>\n\n<p>Note that this is pretty useless, as we still cannot define </p>\n\n<pre><code>append :: NVector n a -&gt; NVector m a -&gt; NVector (n + m) a -- won't work\n</code></pre>\n\n<p>The Oct. '14 <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Status/Oct14\" rel=\"nofollow noreferrer\">status report</a> for <code>ghc</code> says:</p>\n\n<blockquote>\n  <p>Iavor Diatchki is working on utilizing an off-the-shelf SMT solver in GHC's constraint solver. Currently, the main focus for this is improved support for reasoning with type-level natural numbers [...]</p>\n</blockquote>\n\n<p>so your example might well work OK with ghc 7.10 or 7.12!</p>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 28100438, "answer_count": 1, "score": 3, "last_activity_date": 1422010152, "creation_date": 1421967159, "question_id": 28100135, "link": "https://stackoverflow.com/questions/28100135/compare-fixed-sized-vectors", "title": "Compare fixed sized vectors", "body": "<p>I'm trying to write a fixed size vector like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, KindSignatures, TypeOperators #-}\nimport GHC.TypeLits\n\ndata NVector (n :: Nat) a where\n    Nil :: NVector 0 a\n    Cons :: a -&gt; NVector n a -&gt; NVector (n + 1) a\n\ninstance Eq a =&gt; Eq (NVector n a) where\n    Nil == Nil = True\n    (Cons x xs) == (Cons y ys) = x == y &amp;&amp; xs == ys\n</code></pre>\n\n<p>but it fails to compile with this message:</p>\n\n<pre><code> Could not deduce (n2 ~ n1)\nfrom the context (Eq a)\n  bound by the instance declaration at prog.hs:8:10-33\nor from (n ~ (n1 + 1))\n  bound by a pattern with constructor\n             Cons :: forall a (n :: Nat). a -&gt; NVector n a -&gt; NVector (n + 1) a,\n           in an equation for `=='\n  at prog.hs:10:6-14\nor from (n ~ (n2 + 1))\n  bound by a pattern with constructor\n             Cons :: forall a (n :: Nat). a -&gt; NVector n a -&gt; NVector (n + 1) a,\n           in an equation for `=='\n  at prog.hs:10:21-29\n</code></pre>\n\n<p>but if I introduce type-level naturals manually, it compiles successfully </p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, KindSignatures, TypeOperators, TypeFamilies #-}\ndata Nat = Z | S Nat\n\ninfixl 6 :+\n\ntype family   (n :: Nat) :+ (m :: Nat) :: Nat\ntype instance Z     :+ m = m\ntype instance (S n) :+ m = S (n :+ m) \n\ndata NVector (n :: Nat) a where\n    Nil :: NVector Z a\n    Cons :: a -&gt; NVector n a -&gt; NVector (S n) a\n\ninstance (Eq a) =&gt; Eq (NVector n a) where\n    Nil == Nil = True\n    (Cons x xs) == (Cons y ys) = x == y &amp;&amp; xs == ys\n</code></pre>\n\n<p>ghc version 7.8.3</p>\n"}, {"tags": ["haskell", "memory-management", "ghc", "ffi"], "comments": [{"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1421982695, "post_id": 28098870, "comment_id": 44580134, "body": "<code>CString</code> is just an alias for a naked pointer. Haskell will not manage its memory for you.  You can construct a <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-ForeignPtr.html\" rel=\"nofollow noreferrer\">ForeignPtr</a> if you like, but it requires some care.  Any time you use the pointer, it must be contained entirely within a <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-ForeignPtr.html#v:withForeignPtr\" rel=\"nofollow noreferrer\"><code>withForeignPtr</code></a> call."}, {"owner": {"reputation": 27437, "user_id": 370541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3fdae66f7cfe0c334742f54bab1f69?s=128&d=identicon&r=PG", "display_name": "John L", "link": "https://stackoverflow.com/users/370541/john-l"}, "edited": false, "score": 0, "creation_date": 1422036685, "post_id": 28098870, "comment_id": 44606317, "body": "If the string isn&#39;t too large (and doesn&#39;t mutate), you might be better off copying it so that one copy is owned by the foreign side and the other copy is owned by the Haskell runtime.  Otherwise, you may want to think of the foreign side handing ownership of the string to Haskell, i.e. the foreign side doesn&#39;t retain any references to the memory, and if it needs to do anything it calls back into Haskell to do so."}], "answers": [{"comments": [{"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1421983075, "post_id": 28100142, "comment_id": 44580229, "body": "One could also use <code>pokeArray</code> with a foreign-allocated buffer to be on the safe side."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 1, "creation_date": 1423690996, "post_id": 28100142, "comment_id": 45255814, "body": "&quot;Haskell&#39;s <code>free</code> is exactly the equivalent to C&#39;s <code>free</code>&quot; - That might be true, but care is in order. See <a href=\"http://blog.haskell-exists.com/yuras/posts/malloc-free-and-ffi.html\" rel=\"nofollow noreferrer\">blog.haskell-exists.com/yuras/posts/malloc-free-and-ffi.html</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1421967191, "creation_date": 1421967191, "answer_id": 28100142, "question_id": 28098870, "link": "https://stackoverflow.com/questions/28098870/whats-the-proper-way-to-manage-allocated-memory-in-the-foreign-language/28100142#28100142", "title": "What&#39;s the proper way to manage allocated memory in the foreign language?", "body": "<p>You do have to deallocate the string: as you say, there's no way Haskell's GC can know if that's still needed in the foreign side.</p>\n\n<p>Haskell's <code>free</code> is exactly equivalent to C's <code>free</code>. You can call either, from the side you prefer.</p>\n\n<pre><code>free :: Ptr a -&gt; IO ()\nfree  = _free\n\nforeign import ccall unsafe \"stdlib.h free\"    _free    :: Ptr a -&gt; IO ()\n</code></pre>\n\n<p>I didn't check if this is mandated by the Haskell report + FFI Addendum, but I'd guess so.</p>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1421967191, "creation_date": 1421961502, "last_edit_date": 1421961843, "question_id": 28098870, "link": "https://stackoverflow.com/questions/28098870/whats-the-proper-way-to-manage-allocated-memory-in-the-foreign-language", "title": "What&#39;s the proper way to manage allocated memory in the foreign language?", "body": "<p>My case is pretty simple: I have a C++ application and a Haskell library, and I just need to export from Haskell a function that would return a C string.</p>\n\n<p>The issue is that the C string is originally a <code>String</code>, and to get a C string out of it I need to allocate storage which will have to be explicitly deallocated (Haskell's <code>free</code> or <code>finalizerFree</code>, as the documentation for <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Foreign-C-String.html#v:newCString\"><code>newCString</code></a> says).</p>\n\n<p>What's a good way to handle that? Specifically I've got a few considerations:</p>\n\n<p>Ideally I'd like to somehow let the Haskell runtime GC handle that, but I'm not sure how it could possibly know when and when not the memory is still needed by the foreign side. Is it possible?</p>\n\n<p>If not, can I just call C's <code>free</code> or is the <code>CString</code> storage maintained by the Haskell runtime? if not I suppose I'll have to export Haskell's <code>free</code> as-well and call it from the foreign side, correct?</p>\n"}]