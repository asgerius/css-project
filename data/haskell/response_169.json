[{"tags": ["templates", "haskell", "factory-pattern"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1522882563, "post_id": 49661648, "comment_id": 86333156, "body": "Every function has arity 1 in Haskell..."}, {"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522882617, "post_id": 49661648, "comment_id": 86333178, "body": "sure, but you can work with tuples to simulate fixed arities."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522882624, "post_id": 49661648, "comment_id": 86333183, "body": "And to answer your question, it is possible to have functions where the &quot;arity&quot; (although that is definitely not the good word) depends on the <i>type</i> of the parameter, but <i>not</i> the value."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522882674, "post_id": 49661648, "comment_id": 86333203, "body": "no, you can use <i>lists</i> for that. But tuples have a fixed type at <i>compile</i> time."}, {"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522882881, "post_id": 49661648, "comment_id": 86333283, "body": "you mean like <code>x1:x2:x3:[]</code> to enforce 3 arguments via a list of length 3? How would you parametrise that pattern on <code>k</code> (the second parameter of <code>pr</code>)?"}], "answers": [{"tags": [], "owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "is_accepted": true, "score": 5, "last_activity_date": 1522885281, "creation_date": 1522885281, "answer_id": 49662018, "question_id": 49661648, "link": "https://stackoverflow.com/questions/49661648/functions-with-parametrised-arity/49662018#49662018", "title": "Functions with parametrised arity", "body": "<p>What you want is a sized vector. It is like a list but in addition to the type of its elements, it is also parametrised by type level natural numbers.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/sized-vector-1.4.3.1/docs/Data-Vector-Sized.html\" rel=\"noreferrer\">sized-vector</a> package on Hackage is what you need. As it happens, the function you're trying to implement is the <code>last</code> function in this library.</p>\n\n<p>Note that every time you call <code>last</code> you will have to prove the compiler that its argument vector is of size at least 1. You can do this by constructing the vector in the source code (for example, the compiler will understand <code>1 :- 2 :- Nil</code> is of size 2) or if the vector is obtained at runtime perhaps by conversion from a list, you'll have to write a function that either gives a run time error if it has no elements or constructs a vector of size at least one i.e. have the type level size <code>S n</code> for some <code>n</code>.</p>\n\n<p>If you're not familiar with dependently typed programming (a paradigm that includes this and much much more) I suggest you look through some tutorials first.  For example, <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"noreferrer\">this post</a> is a good example that includes how to implement vectors from scratch and write functions for them.</p>\n\n<p>A word of caution, learning and using dependently typed programming is exciting, addictive, but also time consuming. So if you want to focus on the task at hand, you might like to live with runtime checks for now. </p>\n"}], "owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 49662018, "answer_count": 1, "score": 0, "last_activity_date": 1522885281, "creation_date": 1522882478, "question_id": 49661648, "link": "https://stackoverflow.com/questions/49661648/functions-with-parametrised-arity", "title": "Functions with parametrised arity", "body": "<p>Is it possible to write functions that returns functions whose signature depends on the arguments to the builder function?</p>\n\n<p>Specifically I am refining an implementation of primitive recursion I wrote. I want to have factory like functions that for numeric parameters generate a function that works on tuples or lists of the length equal to the arguments passed for the numeric parameters. Currently I am handling cases like <code>pr 1 2 [0,5,13]</code>, which is an invalid statement from the perspective of primitive recursion, at runtime through <code>Either</code>:</p>\n\n<pre><code>pr :: (Show a) =&gt; Int -&gt; Int -&gt; [a] -&gt; Either String a\npr i k args\n  | 1 &lt;= i &amp;&amp; i &lt;= k &amp;&amp; length args == k = Right $ args!!(i-1)\n  | i &lt;= 0 = Left \"first argument of pr needs to be greater or equal to 1\"\n  | k &lt; i = Left \"first argument of pr needs to be lesser or equal to the second argument\"\n  | length args /= k = Left $ \"pr expected \"++(show k)++\" arguments, got \"++(show $ length args)++\": pr \"++(concat[show i, \" \", show k, \" \", show args])\n</code></pre>\n\n<p>But I would like to somehow catch that case at compile time, as from the perspective of the formal system I want to implement with this, this is a compile time error -- passing more arguments to a function than its domain specifies.</p>\n\n<p>Is this somehow possible and if not what would be the correct approach to get compile time errors for what should be invalid statements. </p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522876104, "post_id": 49660430, "comment_id": 86330484, "body": "If you work with an accumulator, like you do here, yes you have to reverse the result."}], "answers": [{"comments": [{"owner": {"reputation": 1746, "user_id": 1083697, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38016b5caf736ce69755c8abcf2d2cdf?s=128&d=identicon&r=PG", "display_name": "andrybak", "link": "https://stackoverflow.com/users/1083697/andrybak"}, "edited": false, "score": 0, "creation_date": 1522877920, "post_id": 49660518, "comment_id": 86331364, "body": "<code>manF [x] = [x]</code> -- wouldn&#39;t this mean that the last  element is added regardless of whether it is on an odd position in the list or not?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1746, "user_id": 1083697, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38016b5caf736ce69755c8abcf2d2cdf?s=128&d=identicon&r=PG", "display_name": "andrybak", "link": "https://stackoverflow.com/users/1083697/andrybak"}, "edited": false, "score": 1, "creation_date": 1522877997, "post_id": 49660518, "comment_id": 86331392, "body": "@andrybak: well since we make hops of two, it will not add the last element. For example if we process <code>manF [1,4]</code>, it will result in <code>1 : manF []</code>. In case we process a singleton list, like <code>[1]</code>, it will indeed result in <code>[1]</code>. but that is logically, since that is the <i>first</i> element (hence an odd index)."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522909313, "post_id": 49660518, "comment_id": 86340573, "body": "I do not understand the case for singleton list.Should i write in the matching  x=[x] or x=x ?I mean do you have to mach both e.g 5 -&gt; [5] and  [5] -&gt;[5] ?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522909524, "post_id": 49660518, "comment_id": 86340669, "body": "When you pattern match with multiple &quot;future elements&quot; doesn&#39;t this mean that the list gets evaluated by chunks? Lets say (x:y:z:t) = ... Doesn&#39;t this mean that we pull 4 values from the list at every evaluation?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1522911304, "post_id": 49660518, "comment_id": 86341575, "body": "@BercoviciAdrian: the pattern of a singleton list is <code>(x:[])</code>, or if we use syntactical sugar, we use <code>[x]</code> in the head. <code>x</code> would mean we match the list, regardless of its value."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522911350, "post_id": 49660518, "comment_id": 86341600, "body": "Understood ! Thank you !"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1522911374, "post_id": 49660518, "comment_id": 86341615, "body": "@Bercovici Adrian: yes, we pull vour variables in that case (or three in the pattern matching in this answer) but the point is here that we <i>never</i> do duplicated work, since we make hops of two. We pull three values, but we use the first one, ignore the second, and recurse on the third one. As a result the number of recursion steps is lower, whereas the matching (that we have to do anyway), is still the same globally."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522912193, "post_id": 49660518, "comment_id": 86342108, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/168271/discussion-between-bercovici-adrian-and-willem-van-onsem\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1522925989, "last_edit_date": 1522925989, "creation_date": 1522876345, "answer_id": 49660518, "question_id": 49660430, "link": "https://stackoverflow.com/questions/49660430/alternative-to-maybe-for-appending-null-to-list/49660518#49660518", "title": "Alternative to maybe for appending null to list", "body": "<blockquote>\n  <p>But i would have to reverse this result at the end.</p>\n</blockquote>\n\n<p>If you work with an <em>accumulator</em>, the way you do here, yes you have to reverse the result. This also results in a problem in case you are processing an \"infinite list\", since in that case the recursion will never terminate, and you thus get stuck into an infinite loop (until you run out of memory).</p>\n\n<blockquote>\n  <p>So if i move the if clause on the left side of the cons operator what can i return instead of null?</p>\n</blockquote>\n\n<p>There is not really something like <code>null</code> (well there is <code>undefined</code>, but we would add that value to the head), nor will <code>Nothing</code> do the trick, since that is a <em>data constructor</em> for the <code>Maybe</code> type. You can use the empty list in case you want to terminate the sequence, but you can not fill in some \"empty\" in the head.</p>\n\n<p>But in fact you do not need an inner method, nor do you need to coun the indices. You can use <em>pattern</em> matching for this:</p>\n\n<pre><code>manF :: [a] -&gt; [a]\nmanF (x:_:xs) = x : manF xs\nmanF [x] = [x]\nmanF [] = []\n</code></pre>\n\n<p>Note that here the pattern is <code>(x:_:xs)</code> which is a compact form of <code>(x:(_:xs))</code>, so here we thus match a \"cons\" with <code>x</code> as head, and the tail should be a \"cons\" as well with as head <code>_</code> (a value we do not care about), and as tail <code>xs</code>. By doing so, we developed a means to make hops of two when iterating over the list.</p>\n\n<p>The other clauses are base cases: for a singleton list we return that singleton list, and for the empty list, we return the empty list. We can merge the last two into one clause like:</p>\n\n<pre><code>manF :: [a] -&gt; [a]\nmanF (x:_:xs) = x : manF xs\nmanF l = l\n</code></pre>\n\n<p>Note that due to lazyness, if we process an \"infinite list\", the algorithm will not get stuck into an infinite loop (of course given the generator of the source list does not go into an infinite loop), and we can thus use this to process \"streams\".</p>\n\n<p>Another advantage is that our integer can never run into overflow (although for even-odd checks that would not make a difference, for a slightly different function, like for instance yield every <em>third</em> element, this could result in problems).</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1522877042, "creation_date": 1522877042, "answer_id": 49660693, "question_id": 49660430, "link": "https://stackoverflow.com/questions/49660430/alternative-to-maybe-for-appending-null-to-list/49660693#49660693", "title": "Alternative to maybe for appending null to list", "body": "<p>Try mutual recursion. The standard demonstration of this is implementing <code>odd</code> and <code>even</code> in terms of each other:</p>\n\n<pre><code>odd, even :: Int -&gt; Bool\nodd 0 = False\nodd n = not (even (n - 1))\neven 0 = True\neven n = not (odd (n - 1))\n</code></pre>\n\n<p>For <code>manF</code>, you might write</p>\n\n<pre><code>manF :: [Int] -&gt; [Int]\nmanF = go_odd  where \n    go_odd [] = []\n    go_odd (x:xs)  = x : go_even xs\n    go_even [] = []\n    go_even (x:xs) = go_odd xs\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 49660518, "answer_count": 2, "score": 2, "last_activity_date": 1522925989, "creation_date": 1522875956, "last_edit_date": 1522876805, "question_id": 49660430, "link": "https://stackoverflow.com/questions/49660430/alternative-to-maybe-for-appending-null-to-list", "title": "Alternative to maybe for appending null to list", "body": "<p>I am trying to extract from a list only elements at odd positions.I know there are specific methods in Data.List but i am new and am trying to learn by reinventing the wheel.</p>\n\n<p>So far i have tried this approach where i am branching the inner method</p>\n\n<pre><code>manF::[Int]-&gt;[Int]\nmanF []=[]\nmanF ls=go ls [] 0 where \n        go [] nl _ = nl\n        go (x:xs) rez cnt=if cnt `mod`2 ==0 then go xs (x:rez) (cnt+1) else go xs rez (cnt+1)\n</code></pre>\n\n<p>But i would have to reverse this result at the end.</p>\n\n<p>Is there anything more atomic then using maybe for dealing with null's</p>\n\n<p>So if i move the <strong>if clause</strong> on the left side of the <code>cons</code> operator what can i return instead of null? I have tried Nothing,[] with no sucess.</p>\n\n<pre><code>manF::[Int]-&gt;[Int]\nmanF []=[]\nmanF ls=go ls [] 0 where \n        go [] nl _ = nl\n        go (x:xs) rez cnt=if cnt `mod`2 ==0 then x else *(something?!)* : go xs rez (cnt+1)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522871113, "post_id": 49654613, "comment_id": 86327753, "body": "Hint: <code>gameState_CurrentPlayer</code> is a <code>Lens&#39; GameState Int</code>, but <code>ix</code>&#39;s argument should be an <code>Int</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522871501, "post_id": 49654613, "comment_id": 86327988, "body": "Oh, and <code>ix</code> returns a <code>Traversal</code> but <code>playerState_Cash</code> should be a <code>Lens</code>."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522874662, "post_id": 49654613, "comment_id": 86329716, "body": "@BenjaminHodgson so how should I compose a Traversal and Lens?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522874901, "post_id": 49654613, "comment_id": 86329869, "body": "You can compose a <code>Traversal</code> and a <code>Lens</code>, but the result is just a <code>Traversal</code>."}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1522857739, "creation_date": 1522854793, "last_edit_date": 1522857739, "question_id": 49654613, "link": "https://stackoverflow.com/questions/49654613/classy-lens-in-game-programming-for-state-management-mtl-style", "title": "Classy lens in game programming for state management (mtl style)", "body": "<p>In my game, I use a global <code>GameState</code>, which contains a list of <code>PlayerState</code>. The number of players is dynamic.</p>\n\n<pre><code>data PlayerState = PlayerState {\n  _playerState_Id   :: Int,\n  _playerState_Cash :: Int\n                               }\ndata GameState = GameState {\n  _gameState_CurrentPlayer :: Int,\n  _gameState_PlayerStates  :: [PlayerState]\n                           }\n\nmakeClassy ''PlayerState\nmakeClassy ''GameState\n\ninstance HasPlayerState GameState where\n  playerState_Id = gameState_PlayerStates . ix 0 . Id\n  playerState_cash = gameState_PlayerStates . ix 0 . cash\n</code></pre>\n\n<p>My goal is to update those fields in a <code>StateT</code> monad, with a function that looks like this:</p>\n\n<pre><code>update :: (MonadIO m,\n           MonadState s m,\n           HasPlayerState s,\n           HasGameState s) =&gt; m ()\n</code></pre>\n\n<p>The problem is in the instance definition of <code>HasPlayerState</code>. I can only select a single element in the list. How to manage this nested state with list elements?</p>\n\n<p><strong>Edit:</strong>\nI realize that I could use the Currentplayer field as an index. But now I seem to have a problem with <code>ix</code></p>\n\n<pre><code>data PlayerState = PlayerState {\n  _playerState_Cash :: Int\n                               }\ndata GameState = GameState {\n  _gameState_CurrentPlayer :: Int,\n  _gameState_PlayerStates  :: [PlayerState]\n                           }\n\nmakeClassy ''PlayerState\nmakeClassy ''GameState\n\ninstance HasPlayerState GameState where\n  playerState = gameState_PlayerStates\n  playerState_Cash = playerState . ix gameState_CurrentPlayer . playerState_Cash\n</code></pre>\n\n<p>With error:</p>\n\n<pre><code> \u2022 Could not deduce (Applicative f) arising from a use of \u2018ix\u2019\n      from the context: Functor f\n        bound by the type signature for:\n                   playerState :: Lens' GameState PlayerState\n</code></pre>\n"}, {"tags": ["performance", "haskell", "optimization", "n-queens"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522849795, "post_id": 49652730, "comment_id": 86313914, "body": "Can you share the Java version? Usually it is very hard to completely implement the very same program in two programming languages (especially in case two languages have different paradigmas)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522850460, "post_id": 49652730, "comment_id": 86314502, "body": "Can not reproduce. Here (GHC 8.4.1) I get 40s without optimization, 2.7s with -O3."}, {"owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522850778, "post_id": 49652730, "comment_id": 86314744, "body": "You are right, sorry my bad there must be an error in my stack setup. Nevermind, why is the performance so low compared with the java version?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1522855424, "post_id": 49652730, "comment_id": 86318436, "body": "General comment: turning on <code>-Wall</code> and fixing issues (and observing DRY in general) often results in better performance, as well as better code (<code>map (fn x) ... where fn max x = ...</code> is quite confusing for instance, and I wondered if you&#39;d made an implementation error)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1522855787, "post_id": 49652730, "comment_id": 86318702, "body": "Looking at core, I suspect the main issue is that your lists haven&#39;t fused away (you can look for <code>[]</code>, <code>:</code> in the core dump). I wonder if you can rewrite <code>recur</code> and <code>getPossibleDepth</code> in some way so as to be a &quot;good producer&quot;. If not you might try rewriting without using lists but instead an accumulator (though I&#39;m not suggesting that&#39;s a satisfying answer)"}], "answers": [{"comments": [{"owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522914575, "post_id": 49656407, "comment_id": 86343616, "body": "On my machine with <code>-O2</code> i get 2.8s which is twice as fast as my code - thanks for that - but the java solution runs in 1.75s."}, {"owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "reply_to_user": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522934395, "post_id": 49656407, "comment_id": 86357394, "body": "Hm, I just ran the Java code on my machine - seems that the Java is faster on my machine as well, but by a much smaller factor. The Java runs about 50-75 more milliseconds to run, always hitting between 825 and 850."}, {"owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "reply_to_user": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522934589, "post_id": 49656407, "comment_id": 86357554, "body": "But, having a factor of 3x speed on the Haskell implementation on my machine versus yours. I have two questions. 1) Which version of GHC are you running, and 2) What are the specs of your machine?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1522935518, "post_id": 49656407, "comment_id": 86358295, "body": "In addition to your suggestions: <code>-fflvm</code> makes the code run an extra 32% faster on my machine."}, {"owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522936734, "post_id": 49656407, "comment_id": 86359200, "body": "Running on windows with ghc 8.4.1 on an i5 650 with 3.2GHz. Will try llvm when installed"}, {"owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522937122, "post_id": 49656407, "comment_id": 86359511, "body": "With llvm it runs in 1.8 seconds on my machine what is comparable to java. I only do not really understand why it is so hard to write performant haskell whereas in java everything runs fast by default. Logic in Haskell is so beautiful but this is a pita"}, {"owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "reply_to_user": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522938339, "post_id": 49656407, "comment_id": 86360462, "body": "@devsteff, do you have a link explaining the algorithm you&#39;re using? Also, the optimisations we&#39;ve made thus far aren&#39;t very difficult or advanced. The only one I say that would be a bit of a stretch is resorting to the LLVM backend."}, {"owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "edited": false, "score": 0, "creation_date": 1522938824, "post_id": 49656407, "comment_id": 86360837, "body": "@chessai Seems to be mostly the same: <a href=\"https://jgpettibone.github.io/bitwise-n-queens/\" rel=\"nofollow noreferrer\">Click</a>"}, {"owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "edited": false, "score": 2, "creation_date": 1522939196, "post_id": 49656407, "comment_id": 86361095, "body": "One thing to consider that may affect how you perceive Haskell optimisations - lazy-by-default languages like Haskell can perform worse when doing dense numerical computations - which is why using strictness and making sure things get unboxed is really important. Also, I will read through the algorithm and see if there&#39;s something I can pick out."}], "tags": [], "owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "is_accepted": false, "score": 4, "last_activity_date": 1522931725, "last_edit_date": 1522931725, "creation_date": 1522860701, "answer_id": 49656407, "question_id": 49652730, "link": "https://stackoverflow.com/questions/49652730/optimizing-n-queens-in-haskell/49656407#49656407", "title": "Optimizing n-queens in Haskell", "body": "<p>Assuming your algorithm is correct (I haven't verified this), I was able to get consistently 900ms (faster than the Java implementation!). <code>-O2</code> and <code>-O3</code> were both comparable on my machine.</p>\n\n<p>Notable changes: (EDIT: Most important change: switch from <code>List</code> to <code>Vector</code>) Switched to GHC 8.4.1, used strictness liberally, <code>BitState</code> is now a strict 3-tuple\nUsing <code>Vector</code>s is important to achieve better speed - in my opinion you can't achieve comparable speed with just linked lists, even with fusion. The Unboxed Vector is important because you know the Vector will always be of <code>Word64</code>s or <code>Int</code>s.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmodule Main (main) where\n\nimport Data.Bits ((.&amp;.), (.|.), shiftR, shift)\nimport Data.Vector.Unboxed (Vector)\nimport qualified Data.Vector.Unboxed as Vector\nimport Data.Word (Word64)\nimport Prelude hiding (max, sum)\nimport System.CPUTime (getCPUTime)\n\n--\n-- The Damenproblem.\n-- Wiki: https://de.wikipedia.org/wiki/Damenproblem\nmain :: IO ()\nmain = do\n  start &lt;- getCPUTime\n  print $ dame 14\n  end &lt;- getCPUTime\n  print $ \"Needed \" ++ (show ((fromIntegral (end - start)) / (10^12))) ++ \" Seconds\"\n\ndata BitState = BitState !Word64 !Word64 !Word64\n\nbmap :: (Word64 -&gt; Word64) -&gt; BitState -&gt; BitState\nbmap f (BitState x y z) = BitState (f x) (f y) (f z)\n{-# INLINE bmap #-}\n\nbfold :: (Word64 -&gt; Word64 -&gt; Word64) -&gt; BitState -&gt; Word64\nbfold f (BitState x y z) = x `f` y `f` z \n{-# INLINE bfold #-}\n\nsingleton :: Word64 -&gt; BitState\nsingleton !x = BitState x x x\n{-# INLINE singleton #-}\n\ndame :: Int -&gt; Int\ndame !x = sumWith fn row\n  where\n    fn !x' = recur (x - 2) $ nextState $ singleton x'\n    getPossible !depth !stateVal !state !bit\n      | (bit .&amp;. stateVal) &gt; 0 = 0\n      | depth == 0 = 1\n      | otherwise = recur (depth - 1) (nextState (addBitToState bit state))\n    recur !depth !state = sumWith (getPossible depth (getStateVal state) state) row\n    !row = Vector.iterateN x moveLeft 1\n\nsumWith :: (Vector.Unbox a, Vector.Unbox b, Num b) =&gt; (a -&gt; b) -&gt; Vector a -&gt; b\nsumWith f as = Vector.sum $ Vector.map f as\n{-# INLINE sumWith #-}\n\ngetStateVal :: BitState -&gt; Word64\ngetStateVal !b = bfold (.|.) b\n\naddBitToState :: Word64 -&gt; BitState -&gt; BitState\naddBitToState !l !b = bmap (.|. l) b\n\nnextState :: BitState -&gt; BitState\nnextState !(BitState l r c) = BitState (moveLeft l) (moveRight r) c\n\nmoveRight :: Word64 -&gt; Word64\nmoveRight !x = shiftR x 1\n{-# INLINE moveRight #-}\n\nmoveLeft :: Word64 -&gt; Word64\nmoveLeft !x = shift x 1\n{-# INLINE moveLeft #-}\n</code></pre>\n\n<p>I checked the core with <code>ghc dame.hs -O2 -fforce-recomp -ddump-simpl -dsuppress-all</code>, and it looked pretty good (i.e. everything unboxed, loops looked good). I was concerned that the partial application of <code>getPossible</code> might be a problem, but it turned out to not be. I feel like if I understood the algorithm better it might be possible to write in a better/more efficient way, however I'm not too concerned - this still manages to beat the Java implementation.</p>\n"}], "owner": {"reputation": 96, "user_id": 6840749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dee7709a4632a48997050398268dfd30?s=128&d=identicon&r=PG&f=1", "display_name": "devsteff", "link": "https://stackoverflow.com/users/6840749/devsteff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1522936690, "creation_date": 1522849656, "last_edit_date": 1522936690, "question_id": 49652730, "link": "https://stackoverflow.com/questions/49652730/optimizing-n-queens-in-haskell", "title": "Optimizing n-queens in Haskell", "body": "<p>This code: </p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\n\nmodule Main where\n\nimport Data.Bits\nimport Data.Word\nimport Control.Monad\nimport System.CPUTime\nimport Data.List\n\n-- The Damenproblem.\n-- Wiki: https://de.wikipedia.org/wiki/Damenproblem\nmain :: IO ()\nmain = do\n  start &lt;- getCPUTime\n  print $ dame 14\n  end &lt;- getCPUTime\n  print $ \"Needed \" ++ (show ((fromIntegral (end - start)) / (10^12))) ++ \" Seconds\"\n\ntype BitState = (Word64, Word64, Word64)\n\ndame :: Int -&gt; Int\ndame max = foldl' (+) 0 $ map fn row\n  where fn x = recur (max - 2) $ nextState (x, x, x)\n        recur !depth !state = foldl' (+) 0 $ flip map row $ getPossible depth (getStateVal state) state\n        getPossible depth !stateVal state bit\n          | (bit .&amp;. stateVal) &gt; 0 = 0\n          | depth == 0 = 1\n          | otherwise = recur (depth - 1) (nextState (addBitToState bit state))\n        row = take max $ iterate moveLeft 1\n\ngetStateVal :: BitState -&gt; Word64\ngetStateVal (l, r, c) = l .|. r .|. c\n\naddBitToState :: Word64 -&gt; BitState -&gt; BitState\naddBitToState l (ol, or, oc) = (ol .|. l, or .|. l, oc .|. l)\n\nnextState :: BitState -&gt; BitState\nnextState (l, r, c) = (moveLeft l, moveRight r, c)\n\nmoveRight :: Word64 -&gt; Word64\nmoveRight x = shiftR x 1\n\nmoveLeft :: Word64 -&gt; Word64\nmoveLeft x = shift x 1\n</code></pre>\n\n<p>needs about 60 seconds to execute. If i enable compiler optimisation with <code>-O2</code>, it takes about 7 seconds. <code>-O1</code> is faster and takes about 5 seconds.\nTested a java version of this code, with for-loops in place of mapped lists, it takes about 1s (!). Been trying my hardest to optimize yet none of the tips i found online helped more than half a second. Please help</p>\n\n<p>Edit: Java version:</p>\n\n<pre><code>public class Queens{\n    static int getQueens(){\n        int res = 0;\n        for (int i = 0; i &lt; N; i++) {\n            int pos = 1 &lt;&lt; i;\n            res += run(pos &lt;&lt; 1, pos &gt;&gt; 1, pos, N - 2);\n        }\n        return res;\n    }\n\n    static int run(long diagR, long diagL, long mid, int depth) {\n        long valid = mid | diagL | diagR;\n        int resBuffer = 0;\n\n        for (int i = 0; i &lt; N; i++) {\n            int pos = 1 &lt;&lt; i;\n            if ((valid &amp; pos) &gt; 0) {\n                continue;\n            }\n            if (depth == 0) {\n                resBuffer++;\n                continue;\n            }\n            long n_mid = mid | pos;\n            long n_diagL = (diagL &gt;&gt; 1) | (pos &gt;&gt; 1);\n            long n_diagR = (diagR &lt;&lt; 1) | (pos &lt;&lt; 1);\n\n            resBuffer += run(n_diagR, n_diagL, n_mid, depth - 1);\n        }\n        return resBuffer;\n    }\n}\n</code></pre>\n\n<p>Edit: Running on windows with ghc 8.4.1 on an i5 650 with 3.2GHz.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522847563, "post_id": 49650289, "comment_id": 86312095, "body": "Minor clarification: I get a different error when I try <code>fmap ($ 3) (4+)</code> in GHCi (&quot;Non type-variable argument in the constraint [...]&quot;). Are you using GHC 7.10 or later (cf. <a href=\"https://stackoverflow.com/q/31503707/2751851\">this question</a> and the P.S. to the accepted answer)? If so, could you please double-check what the error message is?"}, {"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522854760, "post_id": 49650289, "comment_id": 86317958, "body": "Thank you @duplode for clarification question. I am using ghc 8.0.2. I am getting now same error as you wrote. I will update description. Maybe I copied wrong error from previous experiments with getting this right."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1522957805, "post_id": 49650289, "comment_id": 86372578, "body": "Both work as you want in my GHCi. The only difference is the second argument which must be a list, not a tuple. <code>map ($ 3) [(4 + )]</code> and <code>fmap ($ 3) [(4 + )]</code>  You can have a wrapper function to make a tuple into a partial function in a list if desired."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1522843051, "post_id": 49650387, "comment_id": 86308814, "body": "This has nothing to do with <code>Monad</code>s, but with <code>Functor</code>s."}, {"owner": {"reputation": 5765, "user_id": 341499, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/39cad3119923abe9ac6eeb7b5e3dfb6b?s=128&d=identicon&r=PG&f=1", "display_name": "Vinz", "link": "https://stackoverflow.com/users/341499/vinz"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522843141, "post_id": 49650387, "comment_id": 86308875, "body": "Does it makes sense to replace &#39;monad&#39; with &#39;functor&#39; in my answer or would it be nonsense ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522844001, "post_id": 49650387, "comment_id": 86309465, "body": "well you write &quot;wrapped [correctly] inside a monad&quot;, but a monad is not a constructor, you can not really <i>wrap</i> something in a Monad I think. Here the idea is that <code>(4 +)</code> is a functor (since <code>(-&gt;) a</code> is a functor), but that does not work nicely with <code>$ 3</code>."}, {"owner": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 2, "creation_date": 1522846399, "post_id": 49650387, "comment_id": 86311251, "body": "To be fair a monad is just a monoid in the category of endofunctors, meaning it&#39;s an endofunctor together with some extra structure. So if it makes sense to talk about&quot;wrapping something in a functor,&quot; it makes an equal amount of sense to talk about &quot;wrapping something in a monad,&quot; although I don&#39;t love either piece of terminology. That said <code>fmap</code> is for arbitrary endofunctors, not just monads, so it&#39;s a better thing to use here."}], "tags": [], "owner": {"reputation": 5765, "user_id": 341499, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/39cad3119923abe9ac6eeb7b5e3dfb6b?s=128&d=identicon&r=PG&f=1", "display_name": "Vinz", "link": "https://stackoverflow.com/users/341499/vinz"}, "is_accepted": false, "score": 2, "last_activity_date": 1522846807, "last_edit_date": 1522846807, "creation_date": 1522843003, "answer_id": 49650387, "question_id": 49650289, "link": "https://stackoverflow.com/questions/49650289/map-param-to-function-fmap-3-4/49650387#49650387", "title": "Map param to function - fmap ($ 3) (4+)", "body": "<p>I would say the main issue is that your <code>(4 +)</code> is not wrapped correctly inside a functor. If you inspect the type of <code>fmap</code> you'll get:</p>\n\n<pre><code>Prelude&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>In your first example, all the functions were wrapped in a list. Here if you change your <code>(4 +)</code> into <code>[ (4 +) ]</code>, it will work.</p>\n\n<p>As for the explanation about functor, you'll probably find more documentation online (or in the comment section :D Thanks for the feedback)</p>\n"}, {"comments": [{"owner": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 0, "creation_date": 1522846722, "post_id": 49651416, "comment_id": 86311479, "body": "My initial reaction to the question was &quot;You can&#39;t do that!  Wait... you <i>should</i> be able to do that, because the identity functor is still a functor... Hmm...&quot;  Do you know if there&#39;s a reason Haskell can&#39;t automatically interpolate identity functors where they&#39;re semantically required?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 2, "creation_date": 1522847461, "post_id": 49651416, "comment_id": 86312005, "body": "@DanielMcLaury how would you know when they are semantically required? You&#39;d need a classification between \u201cfunctor-y values\u201d and \u201cplain-ish values\u201d. But in Haskell, types are ab initio black boxes \u2013 a polymorphic function has no way to investigate whether the type it works with has any extra structure. What you can do is require that a type must be functor-wrapped, but to typecheck that the compiler must be able to clearly separate it to something of the form <code>f a</code>. For instance <code>Int</code> is not of this form, but there&#39;s actually no way to prove that from within the language."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 0, "creation_date": 1522847629, "post_id": 49651416, "comment_id": 86312155, "body": "...mind though: you <i>can</i> write, for example, <code>7 :: Identity Int</code>, because <code>Identity Int</code> has a <code>Num</code> instance and can thus be instantiated directly with number literals."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 0, "creation_date": 1522852858, "post_id": 49651416, "comment_id": 86316493, "body": "@DanielMcLaury Also, on a slightly pedantic note, <code>Identity</code> isn&#39;t the only way to trivially make a functorial value out of anything. There is also, at least, <code>Const</code>."}, {"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522855267, "post_id": 49651416, "comment_id": 86318331, "body": "Thank you @leftaroundabout, I didn&#39;t know <code>($3)  (4+)</code> works :)  Could you please elaborate how (4+) is not a functor ? Aren&#39;t functions functors ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522855949, "post_id": 49651416, "comment_id": 86318835, "body": "@\u0160ef\u010d&#237;kov&#225;Jana yes, functions <i>are</i> functors, in the sense that there is <code>instance Functor ((-&gt;) a)</code>. But this instance unfortunately makes it hard to see which mapping is a functor-map and which is just a plain function; IMO it would be better if that instance didn&#39;t exist. (There&#39;s a more explicit name for the function functor which avoids the confusion: <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Reader.html\" rel=\"nofollow noreferrer\">Reader</a>.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522856268, "post_id": 49651416, "comment_id": 86319100, "body": "Also, technical nitpicking: <code>(4+)</code> is not a functor and neither is <code>[1,2,3]</code>, those are just <i>container values</i>. The actual functor is the <i>function type constructor</i>, or the <i>list type constructor</i>."}, {"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522857617, "post_id": 49651416, "comment_id": 86320034, "body": "Thank you for note, I didn&#39;t met so far &#39;container&#39; values term, is this name for instances such as (4+), [1,2,3] ?I am also not sure what is &#39;plain&#39; function. With my limited knowledge, I don&#39;t see any difference between functions (4+) and ($3). Why we suddenly use Identity ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522858161, "post_id": 49651416, "comment_id": 86320362, "body": "The main difference between the functions <code>(4+)</code> and <code>($3)</code> is in the type: the former is just a simple <code>Int -&gt; Int</code> endofunction, whereas <code>($3)</code> is a <i>higher-order function</i> of type <code>(Int -&gt; Int) -&gt; Int</code>. \u2014 \u201cWhy we suddenly use Identity\u201d \u2013 well, we <i>don&#39;t</i>, normally; as I explained, you would usually just <i>apply</i> the function without ever considering any functors. Function application is just juxtaposition in Haskell, thus <code>($3) (4+)</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1522845995, "creation_date": 1522845995, "answer_id": 49651416, "question_id": 49650289, "link": "https://stackoverflow.com/questions/49650289/map-param-to-function-fmap-3-4/49651416#49651416", "title": "Map param to function - fmap ($ 3) (4+)", "body": "<p>You need <code>map</code> in the first example because you have a whole <em>container</em> full of functions, and <em>each</em> of them you want to apply to the number. In that example, you could indeed also replace <code>map</code> with <code>fmap</code>, which does work on any container (on any <em>functor</em>).</p>\n\n<pre><code>Prelude&gt; fmap ($ 3) [(4+), (10*), (^2), sqrt]    -- list functor\n[7.0,30.0,9.0,1.7320508075688772]\nPrelude&gt; fmap ($ 3) (Just (4+))                  -- `Maybe` functor\nJust 7\nPrelude&gt; fmap ($ 3) (do y&lt;-readLn; return (y+))  -- `IO` functor\n&gt; 100\n103\n</code></pre>\n\n<p>However, <code>(4+)</code> by itself is not a function wrapped in any functor, it's just a function by itself. So, you don't really need any <code>fmap</code>:</p>\n\n<pre><code>Prelude&gt; ($ 3) (4+)\n7\n</code></pre>\n\n<p>Of course you could simplify that even further to <code>4+3</code>...</p>\n\n<p>If for some reason you do need to use <code>fmap</code> regardless<sup>\u2020</sup>, you'd need it to operate in the <em>identity functor</em>:</p>\n\n<pre><code>Prelude&gt; :m +Data.Functor.Identity\nPrelude Data.Functor.Identity&gt; fmap ($ 3) (Identity (4+))\nIdentity 7\n</code></pre>\n\n<p>The identity functor is a very boring container that just <em>always contains exactly one element</em>.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>That's not unrealistic BTW: in Haskell we like to keep code as generic as possible. You may have a function that is able to work with arbitrary functors (more typically, arbitrary <em>monads</em>, which are special functors) but may want to use it in the trivial context of <em>just one element contained</em>. Or, you may want to stack different monad functionalities as <em>monad transformers</em>; then you'll generally start with <code>Identity</code> as the \u201cvanilla monad\u201d.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522858673, "post_id": 49653396, "comment_id": 86320648, "body": "Thank you @duplode, I can&#39;t parse understanding from this error for now. The problematic step is <code>fmap ($ 3) (4+) :: (Num (a -&gt; b), Num a) =&gt; (a -&gt; b) -&gt; b</code>. I would expect that it return <code>a</code> and not <code>(a-&gt;b)-&gt;b</code>. Do you have any suggestion what I could study to understand better this type of evaluation ?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522865269, "post_id": 49653396, "comment_id": 86324393, "body": "@\u0160ef\u010d&#237;kov&#225;Jana As leftaroundabout explains in his answer, the type would be <code>Num a =&gt; a</code>, as you expected, if <code>fmap</code> wasn&#39;t there. In this case, <code>fmap</code> leads <code>($ 3)</code> to be applied to the <i>result</i> of <code>(4+)</code>, and not to <code>(4+)</code> itself. On &quot;Do you have any suggestion what I could study to understand better this type of evaluation ?&quot;, there are a few questions here that illustrate the procedure rather well. I&#39;ll come back with a link shortly."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 0, "creation_date": 1522867221, "post_id": 49653396, "comment_id": 86325502, "body": "@\u0160ef\u010d&#237;kov&#225;Jana <a href=\"https://stackoverflow.com/q/43428053/2751851\">Here is a decent, if a little contrived, example</a> of doing it in a systematic way. It is basically a matter of starting &quot;from the outside&quot; (in your case, from the type of <code>fmap</code>) and working your way &quot;inside&quot; by substituting the types."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1522851364, "creation_date": 1522851364, "answer_id": 49653396, "question_id": 49650289, "link": "https://stackoverflow.com/questions/49650289/map-param-to-function-fmap-3-4/49653396#49653396", "title": "Map param to function - fmap ($ 3) (4+)", "body": "<p><code>fmap</code> applies a function to values found in some functorial value. In <code>fmap ($ 3) [(4+), (10*), (^2), sqrt]</code>, the list is the functorial value, and the function <code>($ 3)</code> is applied to its elements. As for <code>fmap ($ 3) (4+)</code>, <a href=\"https://stackoverflow.com/a/49651416/2751851\">leftaroundabout correctly points out</a> that:</p>\n\n<blockquote>\n  <p>However, <code>(4+)</code> by itself is not a function wrapped in any functor, it's just a function by itself.</p>\n</blockquote>\n\n<p>In this case, there is a complementary way to look at it. <code>(4+)</code> is a functorial value; however, the functor isn't the one you need. Functions are functors, and, for the purposes of <code>fmap</code>, the values \"found in them\" are the results of the function:</p>\n\n<pre><code>GHCi&gt; :set -XTypeApplications\nGHCi&gt; :t fmap @((-&gt;) _)\nfmap @((-&gt;) _) :: (a -&gt; b) -&gt; (w -&gt; a) -&gt; w -&gt; b\n</code></pre>\n\n<p><code>fmap</code> for functions applies a function to the results of another function, which amounts to function composition. So this...</p>\n\n<pre><code>GHCi&gt; fmap (4*) (2+) 1\n12\n</code></pre>\n\n<p>... is the same as:</p>\n\n<pre><code>GHCi&gt; ((4*) . (2+)) 1\n12\n</code></pre>\n\n<p>In your case, we have:</p>\n\n<pre><code>GHCi&gt; :t (4+)\n(4+) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>So <code>fmap f (4+)</code> will apply <code>f</code> to the <code>Num a =&gt; a</code> result of <code>(4+)</code>. The type of <code>($ 3)</code>, though, is:</p>\n\n<pre><code>GHCi&gt; :t ($ 3)\n($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>And so <code>fmap ($ 3)</code> will expect a functorial value with functions to be possibly found in it:</p>\n\n<pre><code>GHCi&gt; :t fmap ($ 3)\nfmap ($ 3) :: (Num a, Functor f) =&gt; f (a -&gt; b) -&gt; f b\n</code></pre>\n\n<p>Putting it all together, we get:</p>\n\n<pre><code>GHCi&gt; :t fmap ($ 3) (4+)\nfmap ($ 3) (4+) :: (Num (a -&gt; b), Num a) =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>The type error this will lead to has to do with the <code>Num (a -&gt; b)</code> constraint. If there are functions to be found in <code>(4+)</code>, then <code>4</code> itself must be a function. As <code>4</code> is a numeric literal, its type must be also an instance of <code>Num</code>. However, there is no <code>Num</code> instance for functions. Trying <code>fmap ($ 3) (4+)</code> leads to an error which mentions <code>Num (a -&gt; b)</code>. That should suggest something is off:</p>\n\n<pre><code>GHCi&gt; fmap ($ 3) (4+)\n\n&lt;interactive&gt;:33:1: error:\n    * Non type-variable argument in the constraint: Num (a -&gt; b)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall a b. (Num (a -&gt; b), Num a) =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>The \"Non-type variable argument\" complaint, though, is a bit of a distraction, induced by numeric literals being polymorphic. We can get a more straightforward error either by enabling <code>FlexibleContexts</code> and then trying to use <code>fmap ($ 3) (4+)</code> (which will lead to <code>Num a =&gt; a</code> being specialised to <code>Integer</code> thanks to the defaulting rules)...</p>\n\n<pre><code>GHCi&gt; :set -XFlexibleContexts\nGHCi&gt; fmap ($ 3) (4+) (2*)\n\n&lt;interactive&gt;:39:1: error:\n    * No instance for (Num (Integer -&gt; Integer))\n        arising from a use of `it'\n        (maybe you haven't applied a function to enough arguments?)\n    * In the first argument of `print', namely `it'\n      In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>... or by specialising the numeric type through a type annotation:</p>\n\n<pre><code>GHCi&gt; fmap ($ 3) ((4 :: Integer)+)\n\n&lt;interactive&gt;:42:13: error:\n    * Couldn't match type `Integer' with `Integer -&gt; b'\n      Expected type: Integer -&gt; Integer -&gt; b\n        Actual type: Integer -&gt; Integer\n    * In the second argument of `fmap', namely `((4 :: Integer) +)'\n      In the expression: fmap ($ 3) ((4 :: Integer) +)\n      In an equation for `it': it = fmap ($ 3) ((4 :: Integer) +)\n    * Relevant bindings include\n        it :: Integer -&gt; b (bound at &lt;interactive&gt;:42:1)\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1522854909, "creation_date": 1522842670, "last_edit_date": 1522854909, "question_id": 49650289, "link": "https://stackoverflow.com/questions/49650289/map-param-to-function-fmap-3-4", "title": "Map param to function - fmap ($ 3) (4+)", "body": "<p>Reading <a href=\"http://learnyouahaskell.com/higher-order-functions#function-application\" rel=\"nofollow noreferrer\">Function application with $</a> in Learn You Haskell book I found example of applying $ to list of functions.</p>\n\n<pre><code>map ($ 3) [(4+), (10*), (^2), sqrt]\n</code></pre>\n\n<p>I wanted try similar thing and reduce example to applying to one function</p>\n\n<pre><code>fmap ($ 3) (4+) \n</code></pre>\n\n<p>But I am getting errors which I don't understand </p>\n\n<pre><code>\u2022 Non type-variable argument in the constraint: Num (a -&gt; b)\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    it :: forall a b. (Num (a -&gt; b), Num a) =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>Could you help me understand why it works in the first case but it doesn't in the second? How can I achieve desired effect?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522843947, "post_id": 49650185, "comment_id": 86309429, "body": "I suspect it&#39;s similar to the phantom parameter in <code>ST</code> \u2013 it prevents you from using pointers in a context where the data doesn&#39;t exist."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1522845700, "post_id": 49650185, "comment_id": 86310720, "body": "@leftaroundabout Doesn&#39;t look like phantom type parameter since there&#39;s a field with type <code>a</code> in <code>Done</code> constructor."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522875798, "post_id": 49650185, "comment_id": 86330331, "body": "@leftaroundabout Can you expand on that functionality with <code>ST</code> or do you maybe have a reference?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522876516, "post_id": 49650185, "comment_id": 86330669, "body": "@sjakobi the <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Control-Monad-ST-Lazy-Safe.html#t:ST\" rel=\"nofollow noreferrer\"><code>ST</code> monad</a> has an extra <code>s</code> parameter that&#39;s not actually used for anything. The type system ensures this parameter is \u201csynchronised\u201d along any given mutable computation. For actually getting any result out of such a computation, you need to use <code>runST</code>, whose Rank-2 type prevents you from fixing the <code>s</code> to anything particular. So if you smuggle out a reference to e.g. a mutable array out of such a computation, there is you can do with it elsewhere, because the <code>s</code> type doesn&#39;t match."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1522871970, "post_id": 49652375, "comment_id": 86328297, "body": "Do you happen to know what <code>bytestring</code>&#39;s compat policy is like for <code>Internal</code> modules? I know that eg <code>attoparsec</code> actually does rummage around in <code>bytestring</code>&#39;s internals (<a href=\"https://github.com/bos/attoparsec/blob/master/Data/Attoparsec/ByteString/Buffer.hs#L57\" rel=\"nofollow noreferrer\">example</a>), so, like it or not, changing internal APIs might break downstream dependencies. I imagine the <code>bytestring</code> maintainers might be willing to accept such a PR with a major rev bump..."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1522874551, "post_id": 49652375, "comment_id": 86329666, "body": "Thanks for your investigation, @daniel-wagner! I&#39;ve noticed that Simon Meier&#39;s <a href=\"http://lambda-view.blogspot.de/2010/11/on-design-of-efficient-builder-monoid.html\" rel=\"nofollow noreferrer\">original design</a> doesn&#39;t have the type arguments, but I&#39;m still wondering why they were added."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1522875999, "post_id": 49652375, "comment_id": 86330429, "body": "@sjakobi I suspect it was put there as a &quot;Just In Case&quot;: just in case somebody wanted to compute some interesting, potentially structured value <i>about</i> the <code>ByteString</code> as they were building it. Then it turned out not to be the case that people wanted to do that -- at least, not in the code we have today in the library. Whether there&#39;s somebody out there relying on that capability is a question we may never be able to reasonably answer in the negative."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1522876182, "post_id": 49652375, "comment_id": 86330520, "body": "@Shersh Perhaps. Somebody interested in turning it into a PR would probably want to be more careful about ripping out only what wasn&#39;t possible any more without the extra type parameter. I went for the changes that were easiest to throw together and verify type-checked rather than the minimal change -- and I&#39;m not super interested in doing the work that&#39;s likely needed to take the patch from &quot;proof of concept&quot; to &quot;acceptable to the bytestring maintainers&quot;. Of course, if you care about this, you&#39;re welcome to do that yourself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522876709, "post_id": 49652375, "comment_id": 86330763, "body": "Well, as I already commented, the purpose of this parameter might actually just be to <i>prevent</i> some (incorrect) code from compiling, not to do anything for correct code."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522877019, "post_id": 49652375, "comment_id": 86330935, "body": "@leftaroundabout It is insufficiently polymorphic to serve that role. (I verified this mentally as I was refactoring.)"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1523017601, "post_id": 49652375, "comment_id": 86397702, "body": "@Shersh: I have created <a href=\"https://github.com/haskell/bytestring/issues/154\" rel=\"nofollow noreferrer\">github.com/haskell/bytestring/issues/154</a> for now."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1522849180, "last_edit_date": 1522849180, "creation_date": 1522848693, "answer_id": 49652375, "question_id": 49650185, "link": "https://stackoverflow.com/questions/49650185/what-is-the-type-parameter-in-the-bytestring-builder-internals-for/49652375#49652375", "title": "What is the type parameter in the bytestring builder internals for?", "body": "<p>It is not needed. As proof, I have <a href=\"https://github.com/dmwit/bytestring/tree/0c5bec644c098c7a9cb445279c5039d591a54638\" rel=\"noreferrer\">created a fork</a> which does not change any of the public APIs -- only the API of modules named <code>Internal</code> -- but removes this type argument.</p>\n"}, {"tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": false, "score": 0, "last_activity_date": 1551133553, "creation_date": 1551133553, "answer_id": 54875649, "question_id": 49650185, "link": "https://stackoverflow.com/questions/49650185/what-is-the-type-parameter-in-the-bytestring-builder-internals-for/54875649#54875649", "title": "What is the type parameter in the bytestring builder internals for?", "body": "<p>Simon Meier, the author of this <code>Builder</code> design, <a href=\"https://github.com/haskell/bytestring/issues/154#issuecomment-466828601\" rel=\"nofollow noreferrer\">has responded</a> to my question on the <code>bytestring</code> issue tracker:</p>\n\n<blockquote>\n  <p>The type parameter was there to support the <code>Put</code> monad (a <code>Writer</code> spezialized to fill a buffer during the computation of its value).</p>\n</blockquote>\n\n<p><a href=\"https://github.com/haskell/bytestring/blob/715094d380e4d76e734f55c71e739a9d38901ee8/Data/ByteString/Builder/Internal.hs#L456\" rel=\"nofollow noreferrer\"><code>Put</code></a> is defined as</p>\n\n<pre><code>newtype Put a = Put { unPut :: forall r. (a -&gt; BuildStep r) -&gt; BuildStep r }\n</code></pre>\n\n<p>and exported from <code>Data.ByteString.Builder.Internal</code> which is hidden in the current <code>bytestring</code> release.</p>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1551133553, "creation_date": 1522842365, "question_id": 49650185, "link": "https://stackoverflow.com/questions/49650185/what-is-the-type-parameter-in-the-bytestring-builder-internals-for", "title": "What is the type parameter in the bytestring builder internals for?", "body": "<p>The core datatypes of <code>Data.ByteString.Builder</code> are</p>\n\n<pre><code>newtype Builder = Builder (forall r. BuildStep r -&gt; BuildStep r)\n\ntype BuildStep a = BufferRange -&gt; IO (BuildSignal a)\n\ndata BuildSignal a =\n    Done {-# UNPACK #-} !(Ptr Word8) a\n  | BufferFull\n      {-# UNPACK #-} !Int \n      {-# UNPACK #-} !(Ptr Word8)\n                     (BuildStep a)\n  | InsertChunk\n      {-# UNPACK #-} !(Ptr Word8)\n                     S.ByteString\n                     (BuildStep a)\n</code></pre>\n\n<p>What purpose does the type parameter (<code>r</code> or <code>a</code>) serve?</p>\n"}, {"tags": ["haskell", "functional-programming", "associative"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1522835966, "post_id": 49647924, "comment_id": 86304145, "body": "You may be right that the terminology is a bit strange, but in practice it&#39;s clear enough: we always refer to <i>the side where the virtual parentheses are</i>."}, {"owner": {"reputation": 486, "user_id": 3649572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdeca9634e7f8c2b5f3dc529bb6d5aa?s=128&d=identicon&r=PG&f=1", "display_name": "white_wolf", "link": "https://stackoverflow.com/users/3649572/white-wolf"}, "edited": false, "score": 0, "creation_date": 1522836442, "post_id": 49647924, "comment_id": 86304479, "body": "They should mean the same thing although I&#39;ve never seen this expression used. It&#39;s either left or right associative. Function application is left associative: x y z v = (((x y) z) v). You cannot say apply associates to the right though."}, {"owner": {"reputation": 473, "user_id": 6515530, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/HmvF7.jpg?s=128&g=1", "display_name": "Data", "link": "https://stackoverflow.com/users/6515530/data"}, "edited": false, "score": 0, "creation_date": 1522836610, "post_id": 49647924, "comment_id": 86304605, "body": "So whether we say it associates &quot;to&quot; or &quot;from&quot; the left, it is just simply &quot;left associative&quot;, even though they imply opposite directions of association?"}, {"owner": {"reputation": 486, "user_id": 3649572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdeca9634e7f8c2b5f3dc529bb6d5aa?s=128&d=identicon&r=PG&f=1", "display_name": "white_wolf", "link": "https://stackoverflow.com/users/3649572/white-wolf"}, "edited": false, "score": 0, "creation_date": 1522836904, "post_id": 49647924, "comment_id": 86304796, "body": "Then it becomes a word game. Left and right associativity are perfectly understood as they are about grouping operators and I think using the opposition direction and the &quot;to&quot; is confusing."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1522840267, "post_id": 49647924, "comment_id": 86306975, "body": "I read &quot;associates <i>from</i> the right&quot; as &quot;subexpressions coming from the right&quot;, and &quot;associates <i>to</i> the right&quot; as &quot;subexpressions going off to the right&quot; which both mean the same thing"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1522848729, "post_id": 49647924, "comment_id": 86313066, "body": "<a href=\"https://stackoverflow.com/a/45276894/3234959\">Precedence and evaluation order are distinct notions.</a>"}, {"owner": {"reputation": 26383, "user_id": 180247, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/ade0b0ec5fe1605809cac9f495e6d893?s=128&d=identicon&r=PG", "display_name": "Steve314", "link": "https://stackoverflow.com/users/180247/steve314"}, "edited": false, "score": 0, "creation_date": 1522850260, "post_id": 49647924, "comment_id": 86314350, "body": "If I can throw in my own unchecked terminology rationalisations - I always thought &quot;left associative&quot; and &quot;right associative&quot; were a bit close to &quot;associative&quot; - all relate to expressions with the brackets missing but the latter means bracketing doesn&#39;t matter, kind-of opposite to specifying where those brackets must go, yet general English grammar (unreliably) suggests &quot;left associative&quot; might be a special case of &quot;associative&quot;. So &quot;associates to/from the left/right&quot; (which admittedly I find confusing) is, I&#39;ve long assumed, probably a deliberate attempt to avoid &quot;left/right associative&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 26383, "user_id": 180247, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/ade0b0ec5fe1605809cac9f495e6d893?s=128&d=identicon&r=PG", "display_name": "Steve314", "link": "https://stackoverflow.com/users/180247/steve314"}, "edited": false, "score": 2, "creation_date": 1522892151, "post_id": 49647924, "comment_id": 86335698, "body": "@Steve314 That, on its own, is a good topic for a question. I would put it like this: &quot;left associative&quot; and &quot;right associative&quot; are <i>syntactic</i> concepts: they just mean <code>a @ b @ c</code> should be read as <code>(a @ b) @ c</code> or as <code>a @ (b @ c)</code> respectively. &quot;Associative&quot;, however, is not a matter of mere syntax: it means <code>(a @ b) @ c = a @ (b @ c)</code>, which is truly a property of whatever <code>@</code> represents. We might perhaps say that being associative implies being both left and right associative, but that would be confusing, and mix up notions that work at different levels."}], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 13, "last_activity_date": 1522839148, "creation_date": 1522839148, "answer_id": 49649159, "question_id": 49647924, "link": "https://stackoverflow.com/questions/49647924/is-associates-to-the-right-equivalent-to-being-left-or-right-associative/49649159#49649159", "title": "Is &quot;associates to the right&quot; equivalent to being left or right associative?", "body": "<p>You just need to stop thinking about evaluation order.</p>\n\n<p>Bracketing is actually about expression structure, that is, which of\nthese we mean when we say <code>mult x y</code>, not about how we may later decide to evaluate it.</p>\n\n<pre><code>      $           $\n     / \\         / \\\n    $   y     mult  $\n   / \\             / \\\nmult  x           x   y\n</code></pre>\n\n<p>Yes, we were taught in school that brackets are about the order you do\nthings in.  That's because we learned it in the context of arithmetic\noperators.  Since these are all strict, there's less freedom to decide\nhow to evaluate a given expression and the bracketing mostly determines\nan order.  Plus we probably never thought much about expressions as\nabstract things distinct from the way they are written down.</p>\n\n<p>In the more general context of Haskell we can't conflate parsing and\nevaluation.  When we say something \"associates left\" or \"to the left\"\nwe're only talking about how it's parsed.  It tells you that the <code>x</code>\nbelongs in a subexpression with the <code>mult</code> on its left and not with\nthe <code>y</code> on its right.</p>\n\n<p>(I haven't seen anyone use the phrase \"associates from\" and it doesn't\nreally make sense unless maybe you read it as \"associates away from\".)</p>\n"}], "owner": {"reputation": 473, "user_id": 6515530, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/HmvF7.jpg?s=128&g=1", "display_name": "Data", "link": "https://stackoverflow.com/users/6515530/data"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 2, "accepted_answer_id": 49649159, "answer_count": 1, "score": 3, "last_activity_date": 1522839148, "creation_date": 1522835407, "question_id": 49647924, "link": "https://stackoverflow.com/questions/49647924/is-associates-to-the-right-equivalent-to-being-left-or-right-associative", "title": "Is &quot;associates to the right&quot; equivalent to being left or right associative?", "body": "<p>If I say an operation is left-associative, is that equivalent to saying it \"associates from the left\" and \"associates to the right\"?</p>\n\n<p>My confusion comes from an example in my functional programming Haskell textbook.\nIt states:</p>\n\n<p>Function application associates to the left. e.g. <code>mult x y z</code> means <code>((mult x)y)z</code>. i.e. <code>mult</code> takes an integer <code>x</code>, returns a function <code>mult x</code>, which takes an integer <code>y</code>, and returns a function <code>mult x y</code>, which takes an integer <code>z</code> and returns the result of <code>x*y*z</code>.</p>\n\n<p>But if I say it \"associates to the left\", I think of it being right-associative, i.e. evaluation starts from the right and to the left. However, since evaluation of <code>mult</code> starts <em>from</em> the left and <em>to</em> the right, is this left-associative? Should the author have said function application \"associates to the right\"? Or am I missing something and the author is correct?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1522833648, "post_id": 49647062, "comment_id": 86302501, "body": "Do not use <code>!!</code>, it is computationally very expensive :( (and an anti-pattern as well, not only because of it inefficiency, but since the index can be any integer, it thus can go out of range)."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1522833728, "post_id": 49647062, "comment_id": 86302551, "body": "Avoid <code>!!</code> if possible. Wouldn&#39;t <code>unzip $ filter (p . snd) (zip [0 ..] list)</code> (where <code>p = (&gt; 2)</code>) do?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522833744, "post_id": 49647062, "comment_id": 86302562, "body": "Furthermore I find the modelling of two lists (one with indices, and one with elements), rather weird, since this type no longer guarantees that the two lists have the same length."}, {"owner": {"reputation": 486, "user_id": 3649572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdeca9634e7f8c2b5f3dc529bb6d5aa?s=128&d=identicon&r=PG&f=1", "display_name": "white_wolf", "link": "https://stackoverflow.com/users/3649572/white-wolf"}, "edited": false, "score": 0, "creation_date": 1522833844, "post_id": 49647062, "comment_id": 86302631, "body": "pairing a list with their indices is <code>zip xs [0..]</code> which you can then filter."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1522940625, "post_id": 49647062, "comment_id": 86362253, "body": "If your predicates are alike <code>&gt;2</code>, <code>&gt;3</code>, etc. then <code>n_ind n l =  [n..length l - 1]</code> then <code>[ ind!!i | i &lt;- n_ind 3 ind]</code> Use the <code>n_ind</code> function or create a list."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1522942194, "post_id": 49647062, "comment_id": 86363483, "body": "If you want to avoid <code>!!</code> the least then <code>tails ind !! 3</code> will get your limited list."}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 7, "last_activity_date": 1522833629, "creation_date": 1522833629, "answer_id": 49647242, "question_id": 49647062, "link": "https://stackoverflow.com/questions/49647062/finding-elements-and-their-indices-in-a-list/49647242#49647242", "title": "Finding elements and their indices in a list", "body": "<p>You can make it more efficient \u2013 avoid the <code>!!</code> access \u2013 by filtering a list of (index, element) tuples.</p>\n\n<pre><code>let (indices, elems) = unzip [(i, x) | (i, x) &lt;- zip [0..] list, x &gt; 2]\n</code></pre>\n\n<p>Split into an appropriate function:</p>\n\n<pre><code>findItems :: (a -&gt; Bool) -&gt; [a] -&gt; [(Int, a)]\nfindItems predicate = filter (predicate . snd) . zip [0..]\n</code></pre>\n\n\n\n<pre><code>let (indices, elems) = unzip $ findItems (&gt;2) list\n</code></pre>\n\n<p>There might be a more straightforward way, and I\u2019ll be happy to find out about it :)</p>\n"}, {"tags": [], "owner": {"reputation": 1096, "user_id": 5021447, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-gwPYP717ZyU/AAAAAAAAAAI/AAAAAAAAAP8/WoyhftM4PuU/photo.jpg?sz=128", "display_name": "Jordan Mackie", "link": "https://stackoverflow.com/users/5021447/jordan-mackie"}, "is_accepted": false, "score": 3, "last_activity_date": 1522834146, "creation_date": 1522834146, "answer_id": 49647427, "question_id": 49647062, "link": "https://stackoverflow.com/questions/49647062/finding-elements-and-their-indices-in-a-list/49647427#49647427", "title": "Finding elements and their indices in a list", "body": "<pre><code>(indices, elems) = unzip [ item | item &lt;- zip [0..] ls, (snd item) &gt; 2 ]\n</code></pre>\n\n<p>Not sure that it's any more efficient, but it gets it done in \"one shot\". </p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1522835517, "creation_date": 1522835517, "answer_id": 49647965, "question_id": 49647062, "link": "https://stackoverflow.com/questions/49647062/finding-elements-and-their-indices-in-a-list/49647965#49647965", "title": "Finding elements and their indices in a list", "body": "<p>I think <a href=\"https://stackoverflow.com/a/49647242/745903\">Ry's suggestion</a> is just fine. For a more direct, and in particular more generic one, you could use <a href=\"http://hackage.haskell.org/package/lens-4.15.4\" rel=\"noreferrer\"><code>lens</code> tooling</a>:</p>\n\n<pre><code>Prelude&gt; import Control.Lens as L\nPrelude L&gt; import Control.Arrow as A\nPrelude L A&gt; ifoldr (\\i x -&gt; if x&gt;2 then (i:)***(x:) else id) ([],[]) [3,2,4,1,9]\n([0,2,4],[3,4,9])\n</code></pre>\n\n<p>This can immediately be used also on arrays (where the index extraction is much more useful)</p>\n\n<pre><code>Prelude L A&gt; import qualified Data.Vector as V\nPrelude L A V&gt; ifoldr (\\i x -&gt; if x&gt;2 then (i:)***(x:) else id) ([],[]) $ V.fromList [3,2,4,1,9]\n([0,2,4],[3,4,9])\n</code></pre>\n\n<p>...even on unboxed ones, though these aren't <code>Foldable</code>:</p>\n\n<pre><code>Prelude L A V&gt; import qualified Data.Vector.Unboxed as VU\nPrelude L A V VU&gt; import Data.Vector.Generic.Lens as V\nifoldrOf vectorTraverse (\\i x -&gt; if x&gt;2 then (i:)***(x:) else id) ([],[]) $ VU.fromList [3,2,4,1,9]\n([0,2,4],[3.0,4.0,9.0])\n</code></pre>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 49647242, "answer_count": 3, "score": 2, "last_activity_date": 1522835517, "creation_date": 1522833044, "question_id": 49647062, "link": "https://stackoverflow.com/questions/49647062/finding-elements-and-their-indices-in-a-list", "title": "Finding elements and their indices in a list", "body": "<p>I need to have both the elements of a list satisfying a predicate <em>and</em> the indices of these elements. I can achieve this as follows:</p>\n\n<pre><code>import           Data.List (findIndices)\n\nlist :: [Int]\nlist = [3,2,4,1,9]\n\nindices = findIndices (&gt;2) list\nelems = [list!!i | i &lt;- indices]\n-- same as: elems = filter (&gt;2) list\n</code></pre>\n\n<p>Isn't there a package providing a function giving both the elements and their indices in \"one shot\" ? I'm surprised I don't find this function somewhere. Otherwise, how to do such a function, improving my above code ? I don't believe this code is optimal since it somehow accesses twice to the elements of the list. I took a quick look at the source code of <code>findIndices</code> but I don't understand it yet. </p>\n"}, {"tags": ["haskell", "user-defined-types"], "comments": [{"owner": {"reputation": 2885, "user_id": 2462437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83d2b5873df1156f07a07814e3721d02?s=128&d=identicon&r=PG", "display_name": "Daniel McLaury", "link": "https://stackoverflow.com/users/2462437/daniel-mclaury"}, "edited": false, "score": 3, "creation_date": 1522810575, "post_id": 49641652, "comment_id": 86291625, "body": "Note that this is a &quot;range,&quot; not a &quot;list comprehension.&quot;  A list comprehension is an expression like <code>[ f(x) | x &lt;- myList ]</code>."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 2, "creation_date": 1522810699, "post_id": 49641652, "comment_id": 86291652, "body": "It&#39;s not a list comprehension, it&#39;s an <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.10\" rel=\"nofollow noreferrer\">arithmetic sequence</a>.  Apart from that, good question +1"}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 2, "creation_date": 1522810978, "post_id": 49641652, "comment_id": 86291705, "body": "Is this GHC specific?  Did you try other Haskell compilers?  This seems like a parsing oddity."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 1, "creation_date": 1522850599, "post_id": 49641652, "comment_id": 86314625, "body": "@HenriMenke It is not GHC-specific -- this is correct behavior according to the spec -- but nobody can deny that it is indeed a parsing oddity. To be honest, I&#39;m a bit surprised this is the first time it&#39;s come up here on SO."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522850677, "post_id": 49641652, "comment_id": 86314677, "body": "...aha, it isn&#39;t the first time. =)"}], "answers": [{"comments": [{"owner": {"reputation": 2105, "user_id": 8718773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34213fbac0a5b09b9ff8abe458e6b87a?s=128&d=identicon&r=PG&f=1", "display_name": "Giacomo Alzetta", "link": "https://stackoverflow.com/users/8718773/giacomo-alzetta"}, "edited": false, "score": 1, "creation_date": 1522825889, "post_id": 49642259, "comment_id": 86297611, "body": "Am I mistaken or they wanted to get rid of this parsing oddity in Haskell 2010? (i.e. disallowing <code>X..</code> to mean variable <code>.</code> of module <code>X</code>, but forcing you to write <code>X.(.)</code> to mean that, which would get rid of this lexical issue)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 23, "last_activity_date": 1522812866, "last_edit_date": 1522812866, "creation_date": 1522812307, "answer_id": 49642259, "question_id": 49641652, "link": "https://stackoverflow.com/questions/49641652/haskell-why-is-extra-space-needed-in-arithmetic-sequence-for-user-defined-enum/49642259#49642259", "title": "Haskell: Why is extra space needed in arithmetic sequence for user defined enum?", "body": "<p>The problem is that, according to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\" rel=\"noreferrer\">Haskell's lexical rules</a>, <code>modid.varsym</code> is a reference to a variable in a module. A <code>modid</code> is a sequence of 1 or more capitalized identifiers separated by dots and a <code>varsym</code> is a symbolic name. <code>Club</code> is a valid <code>modid</code> and <code>.</code> is a valid <code>varsym</code> (note that there's even an operator in the Prelude with that name and that can be accessed as <code>Prelude..</code>). So <code>X..</code> is seen as the qualified name of a variable named <code>.</code> in the module <code>X</code>.</p>\n\n<p>So <code>Club..Diamond</code> is tokenized as \"qualified variable name, constructor name\", not \"constructor name, dotdot, constructor name\"<sup>1</sup>. And when it tries to resolve the qualified variable name, it fails because there isn't an actually a module named <code>Club</code>.</p>\n\n<p>The problem doesn't occur with <code>[1..5]</code> because <code>1</code> is not a valid module name, nor is there another way that <code>1..</code> or <code>1.</code> form a valid token. Note that, unlike some languages, <code>1.</code> is not allowed as a shorter way to write <code>1.0</code>. If it were, you'd run into a similar problem because <code>1..5</code> would now be tokenized as \"number, dot, number\". But it's not, so the problem does not occur.</p>\n\n<hr>\n\n<p><sup>1</sup> \"Qualified variable name\" wins out over \"constructor name, dotdot\" because of the maximum munch rule, which says that when there are multiple possibilities to match a token, take the one that matches the longest substring from the current position.</p>\n"}], "owner": {"reputation": 273, "user_id": 7299644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/219916893d193f2204ac06b14cca0b01?s=128&d=identicon&r=PG&f=1", "display_name": "MicMac", "link": "https://stackoverflow.com/users/7299644/micmac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "closed_date": 1522850705, "accepted_answer_id": 49642259, "answer_count": 1, "score": 19, "last_activity_date": 1522824736, "creation_date": 1522807689, "last_edit_date": 1522824736, "question_id": 49641652, "link": "https://stackoverflow.com/questions/49641652/haskell-why-is-extra-space-needed-in-arithmetic-sequence-for-user-defined-enum", "closed_reason": "Duplicate", "title": "Haskell: Why is extra space needed in arithmetic sequence for user defined enum?", "body": "<p>So for any built-in types in Haskell, I can construct an arithmetic sequence, like this one (for <code>Int</code> or <code>Integer</code>, etc.)</p>\n\n<pre><code>[1..5]\n</code></pre>\n\n<p>But if I define an enum type like:</p>\n\n<pre><code>data Suit = Club | Diamond | Heart | Spade deriving (Show, Enum) \n</code></pre>\n\n<p>when I create an arithmetic sequence, I have to include space before an enum instance and the dot dot e.g.</p>\n\n<pre><code>[Club .. Diamond]\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1522822546, "post_id": 49640938, "comment_id": 86295620, "body": "The haskell boolean operators are short-circuiting anyway; they&#39;re lazy!"}, {"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1522937252, "post_id": 49640938, "comment_id": 86359618, "body": "That&#39;s true, <code>.&amp;&amp;</code> there is short-circuiting operation for Maybe Bool. I will update description."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1522948486, "post_id": 49640938, "comment_id": 86367324, "body": "<code>a .&amp;&amp; b = (&amp;&amp;) &lt;$&gt; a &lt;*&gt; b</code>. This short-circuits for both <code>Nothing</code> and the acual <code>Bool</code>. Do you know about <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Control-Applicative.html#t:Applicative\" rel=\"nofollow noreferrer\"><code>Applicative</code></a>?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1587155037, "post_id": 49640938, "comment_id": 108408388, "body": "You may wish to have a look at either <a href=\"https://hackage.haskell.org/package/shortcircuit-0.1/docs/Control-Shortcircuit.html\" rel=\"nofollow noreferrer\">Control.Shortcircuit</a> or <a href=\"https://hackage.haskell.org/package/selective-0.4.1/docs/Control-Selective.html\" rel=\"nofollow noreferrer\">Control.Selective</a>."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 1, "creation_date": 1522859096, "post_id": 49641030, "comment_id": 86320911, "body": "Thank you @amalloy, applying <code>($ inputs)</code> was challenging."}, {"owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "edited": false, "score": 0, "creation_date": 1523635083, "post_id": 49641030, "comment_id": 86657050, "body": "I showed below how you can use this approach but get short-circuiting."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 6, "last_activity_date": 1522802514, "creation_date": 1522802514, "answer_id": 49641030, "question_id": 49640938, "link": "https://stackoverflow.com/questions/49640938/how-to-write-short-circuit-conjunction-of-multiple-boolean-conditions-over-same/49641030#49641030", "title": "How to write short circuit conjunction of multiple boolean conditions over same parameters?", "body": "<p>The <code>Maybe a</code> types are just a distraction - they might as well be <code>a</code>, since all we want to do with them is call cond<em>n</em> on them.</p>\n\n<p>So, we have a list:</p>\n\n<pre><code>conditions :: [a -&gt; b -&gt; Maybe Bool]\n</code></pre>\n\n<p>and a tuple:</p>\n\n<pre><code>inputs :: (a, b)\n</code></pre>\n\n<p>Since the only thing we can do with the conditions in that list is call them with <code>inputs</code> as an argument, we might as well do that first:</p>\n\n<pre><code>results :: [Maybe Bool]\nresults = map (($ inputs) . uncurry) conditions\n</code></pre>\n\n<p>and would like to find an f, such that</p>\n\n<pre><code>f results :: Maybe Bool\n</code></pre>\n\n<p>meaning</p>\n\n<pre><code>f :: [Maybe Bool] -&gt; Maybe Bool\n</code></pre>\n\n<p>There are some interesting functions with that type signature, for example</p>\n\n<pre><code>f = fmap and . sequenceA\n</code></pre>\n\n<p>but this may be a little bit less short-circuity than you'd like: if one of the conditions returns <code>Just False</code>, we will still evaluate the remainder to see if any of them yield <code>Nothing</code>. This may or may not be what you wanted; to do something that short-circuits on <code>Just False</code> as well as on <code>Nothing</code>, I don't see any approach more clever than writing a recursive function that consumes the list.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 9125440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f51c164abdd132a04e38276a2b1d48?s=128&d=identicon&r=PG&f=1", "display_name": "chessai", "link": "https://stackoverflow.com/users/9125440/chessai"}, "is_accepted": false, "score": 2, "last_activity_date": 1522899200, "last_edit_date": 1522899200, "creation_date": 1522894215, "answer_id": 49663087, "question_id": 49640938, "link": "https://stackoverflow.com/questions/49640938/how-to-write-short-circuit-conjunction-of-multiple-boolean-conditions-over-same/49663087#49663087", "title": "How to write short circuit conjunction of multiple boolean conditions over same parameters?", "body": "<p>You can get a similar solution to above, but with short-circuiting across the foldable structure, i.e. not having to consume the whole list.</p>\n\n<pre><code>(??) :: b -&gt; b -&gt; Bool -&gt; b\na ?? b = \\x -&gt; if x then a else b\n\nandM :: (Monad m) =&gt; m Bool -&gt; m Bool -&gt; m Bool\nandM a b = a &gt;&gt;= \\x -&gt; (b ?? pure x) x\n\nshortCircuitOnFalse :: (Foldable t, Monad m) =&gt; t (m Bool) -&gt; m Bool\nshortCircuitOnFalse = foldr andM (pure True)\n</code></pre>\n\n<p>So if you have a list (which is Foldable) of functions resembling conditions;</p>\n\n<pre><code>conditions :: [a -&gt; b -&gt; Maybe Bool]\n</code></pre>\n\n<p>and a tuple of inputs to those functions;</p>\n\n<pre><code>inputs :: (a, b)\n</code></pre>\n\n<p>then you can take the same approach as above:</p>\n\n<pre><code>results :: [Maybe Bool]\nresults = map (($ inputs) . uncurry) conditions\n\nwhatYouWant :: Maybe Bool\nwhatYouWant = shortCircuitOnFalse results\n</code></pre>\n\n<p>and a generalised version of <code>whatYouWant</code>:</p>\n\n<pre><code>gWhatYouWant\n  :: (Foldable t, Functor t, Monad m)\n  =&gt; t (a -&gt; b -&gt; m Bool) -- ^ conditions\n  -&gt; (a, b) -- ^ inputs\n  -&gt; m Bool\ngWhatYouWant cs is = shortCircuitOnFalse $ fmap (($ is) . uncurry) cs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "is_accepted": false, "score": 0, "last_activity_date": 1526012646, "last_edit_date": 1526012646, "creation_date": 1526011285, "answer_id": 50284803, "question_id": 49640938, "link": "https://stackoverflow.com/questions/49640938/how-to-write-short-circuit-conjunction-of-multiple-boolean-conditions-over-same/50284803#50284803", "title": "How to write short circuit conjunction of multiple boolean conditions over same parameters?", "body": "<p><code>guard</code> is useful for short-circuiting behavior. </p>\n\n<pre><code>module Main where\n\nimport Control.Monad\nimport Debug.Trace\n\ncond1 :: Maybe Bool\ncond1 = Just True\n\ncond2 :: Maybe Bool\ncond2 = Just False\n\ncond3 :: Maybe Bool\ncond3 = Just True\n\n-- | traceShow added to show the short-circuiting behavior\nshortCircuit :: Maybe Bool\nshortCircuit = foldl1 ((&gt;&gt;) . (guard =&lt;&lt;)) [ traceShow \"1\" cond1\n                                           , traceShow \"2\" cond2\n                                           , traceShow \"3\" cond3\n                                           ]\n-- \u03bb&gt; shortCircuit                                                                                                                                               \n-- \"1\"                                                                                                                                                           \n-- \"2\"                                                                                                                                                           \n-- Nothing \n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1526012646, "creation_date": 1522801641, "last_edit_date": 1522937374, "question_id": 49640938, "link": "https://stackoverflow.com/questions/49640938/how-to-write-short-circuit-conjunction-of-multiple-boolean-conditions-over-same", "title": "How to write short circuit conjunction of multiple boolean conditions over same parameters?", "body": "<p>How can I re-write conjunction of conditions (with early termination) over same parameters? </p>\n\n<p>Let say I have 3 conditions </p>\n\n<pre><code>cond1 :: Maybe a -&gt; Maybe a -&gt; Maybe Bool\ncond2 :: Maybe a -&gt; Maybe a -&gt; Maybe Bool\ncond3 :: Maybe a -&gt; Maybe a -&gt; Maybe Bool\n</code></pre>\n\n<p>and</p>\n\n<pre><code>result = cond1 x y .&amp;&amp; cond2 x y .&amp;&amp; cond3 x y\n</code></pre>\n\n<p>where <code>.&amp;&amp;</code> is short-circuiting operations for Maybe Bool</p>\n\n<pre><code>(.&amp;&amp;):: Maybe Bool -&gt; Maybe Bool -&gt; Maybe Bool\nfa .&amp;&amp; fb = do a &lt;- fa; if a then fb else return False\n</code></pre>\n\n<p>I am looking for re-write of <code>result</code> such that it takes the list of those conditions <code>[cond1, cond2, cond3]</code> and consecutively apply it to tuple <code>(x,y)</code> with early termination or any other elegant suggestion.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "rsa"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1522824157, "post_id": 49640734, "comment_id": 86296506, "body": "When you say &quot;create the ... key from a ... string&quot; you are basically saying you want to decode a value.  How much Haskell do you know?  You can decode the base64 to a bytestring using packages like <code>base64-bytestring</code>, decode the bytestring via <code>binary</code> or <code>cereal</code>, and construct your key using one of cryptonite&#39;s constructors such as <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/Crypto-PubKey-RSA.html#t:PrivateKey\" rel=\"nofollow noreferrer\">PrivateKey</a>.  Why do you have to do so much yourself? Because, so far as you&#39;ve said, you don&#39;t have a standard encoding. PEM decoding exists if that&#39;s your format."}, {"owner": {"reputation": 31, "user_id": 9367426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962bc4ac1cce7cba2ced4ec0d061bec5?s=128&d=identicon&r=PG&f=1", "display_name": "blue robot", "link": "https://stackoverflow.com/users/9367426/blue-robot"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522853318, "post_id": 49640734, "comment_id": 86316869, "body": "I&#39;m very new to haskell. The base64Encoded string representation of a certificate (public or private) is what i was referring to. I think what i&#39;m looking for is a way to create the X509 cert (from Data.X509) from the cert&#39;s base64Encoded string and then i can access the Public and Private key from there. The Data.X509 has ecodeSignedCertificate that will take in a ByteString but it keeps failing with &quot;StreamConstructionWrongSize&quot; error. I&#39;m still searching for the right way to do to this. I updated my question to include the code snippet. Perhaps, you guys can help me spot the problem. Thx"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 9367426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962bc4ac1cce7cba2ced4ec0d061bec5?s=128&d=identicon&r=PG&f=1", "display_name": "blue robot", "link": "https://stackoverflow.com/users/9367426/blue-robot"}, "is_accepted": true, "score": 2, "last_activity_date": 1522873807, "creation_date": 1522873807, "answer_id": 49659889, "question_id": 49640734, "link": "https://stackoverflow.com/questions/49640734/create-a-public-private-key-from-a-pem-base64encode-string-in-haskell/49659889#49659889", "title": "Create a Public/Private Key from a PEM Base64Encode string in Haskell", "body": "<p>Updated: I found the solution to my question. Hope this helps other who has the same problem</p>\n\n<pre><code>           {-# LANGUAGE OverloadedStrings #-}\n\n            module Main where\n\n            import Data.String.Conversions (cs)\n            import Crypto.Hash (hash, SHA256(..), Digest)\n            import qualified Data.ByteString  as BS (ByteString, readFile)\n            import Data.Text.Encoding (encodeUtf8)\n            import qualified Data.Text.IO as TIO\n            import System.IO (hFlush, stdout)\n            import Data.ByteArray.Encoding (convertToBase, Base (Base64))\n            import Data.List (head)\n            import Data.Text (Text(..))\n            ----- Read file import\n            import Data.Monoid ((&lt;&gt;))\n            import Control.Applicative\n            import Data.ASN1.Types \n            import Data.ASN1.BinaryEncoding\n            import Data.ASN1.Encoding\n            import Data.Maybe\n            import qualified Data.X509 as X509\n            import           Data.X509.Memory (pemToKey)\n            import Data.PEM (pemParseLBS, pemParseBS, pemWriteBS, pemContent, pemName, PEM)\n            import qualified Data.ByteString.Lazy as L\n\n\n            -------------------------\n\n\n            main :: IO ()\n            main = do \n            --pems  &lt;- readPEMs \"./certs/test.pem\" -- read from file\n            let cert1 = \"-----BEGIN CERTIFICATE-----\\n\" ++ \"MIIFXjCCBEagAwIBAgIIKPOmOJqfnTIwDQYJKoZIhvcNAQELBQAwgbQxCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRMwEQYDVQQHEwpTY290dHNkYWxlMRowGAYDVQQKExFHb0RhZGR5LmNvbSwgSW5jLjEtMCsGA1UECxMkaHR0cDovL2NlcnRzLmdvZGFkZHkuY29tL3JlcG9zaXRvcnkvMTMwMQYDVQQDEypHbyBEYWRkeSBTZWN1cmUgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IC0gRzIwHhcNMTYwMjA5MjE1NzM5WhcNMTkwMzA3MjIzNTUxWjBrMQswCQYDVQQGEwJVUzENMAsGA1UECBMEVXRhaDEVMBMGA1UEBxMMU291dGggSm9yZGFuMRcwFQYDVQQKEw5BbGxlZ2lhbmNlIEluYzEdMBsGA1UEAwwUKi5hbGxlZ2lhbmNldGVjaC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDHWaH6ziZnWy3Uy/wmM7zbHqrg/AmdsWk54x6wpe7+B2USbTbZg56rGjEL/I1Pe/PtcbM8uiPq1TshMxwePqWFCqKfJrj6/RS9/gKpWOwfh+Z2Qk78L3DQH97njDLJAYBf68MX0eKhM0PGBo+1BqKfAb9C3hEltROuABPEBO7GMFecZaDtZ6lDkYBidRs7nOqQnU91X8ly376U0dAEnTghVmDSh5v8yKvMm0AhOd8S7EulfXEg+cj6Y996pM56bDbv2H7NZNv7QD38FY2IQWTWT46z0riF/D93ilVF62cvNXtUwj2kx581Z/e4eB7+Q3cLFFG1KGLgnvDKIguuxK5LAgMBAAGjggG6MIIBtjAMBgNVHRMBAf8EAjAAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAOBgNVHQ8BAf8EBAMCBaAwNQYDVR0fBC4wLDAqoCigJoYkaHR0cDovL2NybC5nb2RhZGR5LmNvbS9nZGlnMnMyLTIuY3JsMFMGA1UdIARMMEowSAYLYIZIAYb9bQEHFwIwOTA3BggrBgEFBQcCARYraHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5LzB2BggrBgEFBQcBAQRqMGgwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmdvZGFkZHkuY29tLzBABggrBgEFBQcwAoY0aHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5L2dkaWcyLmNydDAfBgNVHSMEGDAWgBRAwr0njsw0gzCiM9f7bLPwtCyAzjAzBgNVHREELDAqghQqLmFsbGVnaWFuY2V0ZWNoLmNvbYISYWxsZWdpYW5jZXRlY2guY29tMB0GA1UdDgQWBBSFAVaoKHe4qj41Axk07GZrLVx38zANBgkqhkiG9w0BAQsFAAOCAQEApsEOT1kL51QIQbpQjkamjQ1y+HoEMXd7npM1YMfaLxL+v4b6qShMamtNUWac+aJ5ul8849UBhPj3nNfLz6PJtdFmztKOHs58Th8lz6ksSDt1z/GRi3/EcWR7beBuDD2AKFGnckcSkCls+lOBSh/BxAIKPdlD3wzUEpqLuD1scucRfcjwt6X0K3otthMJ9PZ9tJQMSOLnUFKLvG+ZFlnkY+K3pmKWsk2ZMrua2m9wvqVXq4ZgEKQ6xr91HYkPCjfLt14ExnL3vNdXS0DR7LtjJDyXJeFkT0Ev81W9c5dk7gzbwg+EM4UYxW6qz+7WyHvV+uLNnHNmwm1b17tVfYvu3w==\" ++ \"\\n-----END CERTIFICATE-----\"\n            pems &lt;- readPEM cert1\n            let certx = X509.decodeSignedObject $ pemContent $ head pems \n            case certx of \n                Left st1 -&gt; putStrLn $ \"Error reading cert: \" ++ st1 \n                Right scrt1 -&gt; do \n                let crt1 = X509.getCertificate scrt1 \n                print crt1\n\n            readPEM :: String -&gt; IO [PEM]\n            readPEM content = --do\n                return $ either error id $ pemParseBS $ cs content \n\n            readPEMs :: FilePath -&gt; IO [PEM]\n            readPEMs filepath = do\n                content &lt;- BS.readFile filepath\n                return $ either error id $ pemParseBS content\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9367426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962bc4ac1cce7cba2ced4ec0d061bec5?s=128&d=identicon&r=PG&f=1", "display_name": "blue robot", "link": "https://stackoverflow.com/users/9367426/blue-robot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 49659889, "answer_count": 1, "score": 1, "last_activity_date": 1522941674, "creation_date": 1522799923, "last_edit_date": 1522941674, "question_id": 49640734, "link": "https://stackoverflow.com/questions/49640734/create-a-public-private-key-from-a-pem-base64encode-string-in-haskell", "title": "Create a Public/Private Key from a PEM Base64Encode string in Haskell", "body": "<p>I'm trying to use RSA from cryptonite package to handle encryption and try to create an X509 cert (Data.X509) from a pem encoded cert base64Encoded string so i can access the Public and Private Key. However, i kept getting a \"StreamConstructionWrongSize\" error. I think i'm missing something here when reading the base64Encoded string in. I included the snippet of the codes. Perhaps, someone can spot the mistake. I'd really appreciate any help. </p>\n\n<pre><code>    import Data.String.Conversions (cs)\n    import Crypto.Hash (hash, SHA256(..), Digest)\n    import Data.ByteString (ByteString)\n    import Data.Text.Encoding (encodeUtf8)\n    import qualified Data.Text.IO as TIO\n    import System.IO (hFlush, stdout)\n    import Data.ByteArray.Encoding (convertToBase, Base (Base64))\n    import Data.X509 \n\n    main :: IO ()\n    main = do \n      let certBS = encodeUtf8 \"MIIFXjCCBEagAwIBAgIIKPOmOJqfnTIwDQYJKoZIhvcNAQELBQAwgbQxCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRMwEQYDVQQHEwpTY290dHNkYWxlMRowGAYDVQQKExFHb0RhZGR5LmNvbSwgSW5jLjEtMCsGA1UECxMkaHR0cDovL2NlcnRzLmdvZGFkZHkuY29tL3JlcG9zaXRvcnkvMTMwMQYDVQQDEypHbyBEYWRkeSBTZWN1cmUgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IC0gRzIwHhcNMTYwMjA5MjE1NzM5WhcNMTkwMzA3MjIzNTUxWjBrMQswCQYDVQQGEwJVUzENMAsGA1UECBMEVXRhaDEVMBMGA1UEBxMMU291dGggSm9yZGFuMRcwFQYDVQQKEw5BbGxlZ2lhbmNlIEluYzEdMBsGA1UEAwwUKi5hbGxlZ2lhbmNldGVjaC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDHWaH6ziZnWy3Uy/wmM7zbHqrg/AmdsWk54x6wpe7+B2USbTbZg56rGjEL/I1Pe/PtcbM8uiPq1TshMxwePqWFCqKfJrj6/RS9/gKpWOwfh+Z2Qk78L3DQH97njDLJAYBf68MX0eKhM0PGBo+1BqKfAb9C3hEltROuABPEBO7GMFecZaDtZ6lDkYBidRs7nOqQnU91X8ly376U0dAEnTghVmDSh5v8yKvMm0AhOd8S7EulfXEg+cj6Y996pM56bDbv2H7NZNv7QD38FY2IQWTWT46z0riF/D93ilVF62cvNXtUwj2kx581Z/e4eB7+Q3cLFFG1KGLgnvDKIguuxK5LAgMBAAGjggG6MIIBtjAMBgNVHRMBAf8EAjAAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAOBgNVHQ8BAf8EBAMCBaAwNQYDVR0fBC4wLDAqoCigJoYkaHR0cDovL2NybC5nb2RhZGR5LmNvbS9nZGlnMnMyLTIuY3JsMFMGA1UdIARMMEowSAYLYIZIAYb9bQEHFwIwOTA3BggrBgEFBQcCARYraHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5LzB2BggrBgEFBQcBAQRqMGgwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmdvZGFkZHkuY29tLzBABggrBgEFBQcwAoY0aHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5L2dkaWcyLmNydDAfBgNVHSMEGDAWgBRAwr0njsw0gzCiM9f7bLPwtCyAzjAzBgNVHREELDAqghQqLmFsbGVnaWFuY2V0ZWNoLmNvbYISYWxsZWdpYW5jZXRlY2guY29tMB0GA1UdDgQWBBSFAVaoKHe4qj41Axk07GZrLVx38zANBgkqhkiG9w0BAQsFAAOCAQEApsEOT1kL51QIQbpQjkamjQ1y+HoEMXd7npM1YMfaLxL+v4b6qShMamtNUWac+aJ5ul8849UBhPj3nNfLz6PJtdFmztKOHs58Th8lz6ksSDt1z/GRi3/EcWR7beBuDD2AKFGnckcSkCls+lOBSh/BxAIKPdlD3wzUEpqLuD1scucRfcjwt6X0K3otthMJ9PZ9tJQMSOLnUFKLvG+ZFlnkY+K3pmKWsk2ZMrua2m9wvqVXq4ZgEKQ6xr91HYkPCjfLt14ExnL3vNdXS0DR7LtjJDyXJeFkT0Ev81W9c5dk7gzbwg+EM4UYxW6qz+7WyHvV+uLNnHNmwm1b17tVfYvu3w==\"\n          cert = decodeSignedCertificate certBS\n      case cert of \n          Left st -&gt; putStrLn $ \"Error reading cert: \" ++ st \n          Right scrt -&gt; do \n            let crt = getCertificate scrt \n            putStrLn $ show crt   \n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "overloading", "typeclass"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1522800032, "post_id": 49640396, "comment_id": 86289194, "body": "It turns out <code>ExtendedDefaultRules</code> work. I thought it was a GHCi-only thing for some reason."}], "answers": [{"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1522800126, "post_id": 49640623, "comment_id": 86289215, "body": "Compiler plugins would be another way of solving this, but I don&#39;t know anything about writing one."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1522832606, "post_id": 49640623, "comment_id": 86301803, "body": "Thanks for your answer! Great suggestions :+1: I have experience with writing ghc plugins. And this is not really a thing a person want to do... Solution with <code>-XExtendedDefaultRules</code> looks already quite good to me!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1522799992, "last_edit_date": 1522799992, "creation_date": 1522799069, "answer_id": 49640623, "question_id": 49640396, "link": "https://stackoverflow.com/questions/49640396/type-class-polymorphism-with-overloaded-numeric-and-string-literals/49640623#49640623", "title": "Type class polymorphism with overloaded numeric and string literals", "body": "<p>Use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#extension-ExtendedDefaultRules\" rel=\"nofollow noreferrer\"><code>ExtendedDefaultRules</code></a>. (It is enabled by default in GHCi, and the pragma enables it in GHC.)</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ExtendedDefaultRules #-}\n{-# LANGUAGE OverloadedStrings #-}\n\ndefault (Int, String)\n\nclass Value a where\n  toValue :: a -&gt; String\n\ninstance Value Int where\n  toValue = show\n\ninstance Value String where\n  toValue = id\n\nmain = do\n  print (toValue 3)    -- would otherwise be ambiguous\n  print (toValue \"x\")\n</code></pre>\n\n<hr>\n\n<h3>Old answer</h3>\n\n<p>If I understand correctly, the goal here is to keep the syntax uniform while properly specializing literals. One way is to use Template Haskell, so <code>foo</code> might look like</p>\n\n<pre><code>foo = [$(toValue [|True|]), $(toValue [|3|])]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>foo = [ [toValue| True |], [toValue| 3 |] ]  \n</code></pre>\n\n<p>The latter is less dollar-noisy, but implementing a custom quote requires an expression parser and <em>template-haskell</em> doesn't provide one.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 49640623, "answer_count": 1, "score": 2, "last_activity_date": 1522799992, "creation_date": 1522797228, "question_id": 49640396, "link": "https://stackoverflow.com/questions/49640396/type-class-polymorphism-with-overloaded-numeric-and-string-literals", "title": "Type class polymorphism with overloaded numeric and string literals", "body": "<p>I'm trying to write some EDSL for assigning values to keys. So I have the following data type for value:</p>\n\n<pre><code>data Value = B Bool | I Int\n</code></pre>\n\n<p>I want to have unified way to convert different values to objects of type <code>Value</code>. So I've created the following type class:</p>\n\n<pre><code>class    ToValue a    where toValue :: a -&gt; Value\ninstance ToValue Bool where toValue = B\ninstance ToValue Int  where toValue = I\n</code></pre>\n\n<p>Unfortunately, this code doesn't compile:</p>\n\n<pre><code>foo :: [Value]\nfoo = [toValue True, toValue 3]\n</code></pre>\n\n<p>I understand the reason why. But this makes me sad. I don't really understand how to solve this problem... And things become more difficult if I have <code>-XOverloadedStrings</code> enabled and I want to add <code>T Text</code> constructor to my <code>Value</code> type.</p>\n\n<p>My final goal is to have ability to write something like this:</p>\n\n<pre><code>foo :: [(Text, Value)]\nfoo = [ \"key1\" !!! True\n      , \"key2\" !!! 42\n      , \"key3\" !!! \"foo\"\n      , \"key4\" !!! [5, 7, 10]\n      ]\n</code></pre>\n\n<p>I understand that I can always wrap manually every value into corresponding constuctor but I'd prefer to avoid that (since in my real life constructors are longer than one letter and code doesn't really decrease in noise with constructors).</p>\n\n<p>What can I do to achieve the closest possible implementation? I would like to avoid unsafe <code>Num</code> instance for <code>Value</code> if possible...</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1522791280, "post_id": 49639455, "comment_id": 86286621, "body": "Use <code>zipWith</code>..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522893397, "post_id": 49639455, "comment_id": 86335954, "body": "Arguably, there is an easy way to do it <i>because</i> there aren&#39;t traditional loops."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 3, "creation_date": 1522822458, "post_id": 49639526, "comment_id": 86295575, "body": "If the lists have a length mismatch <code>zipwith (+)</code> will handle it fine by truncating the longer list but the recursive implementation will error as it isn&#39;t checking for that case."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522893531, "post_id": 49639526, "comment_id": 86335980, "body": "The fix would be to replace the single base case with two base cases <code>foo [] _ = []</code> and <code>foo _ [] = []</code>, but at that point you have pretty much just reimplemented <code>zipWith (=)</code>."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 3, "last_activity_date": 1522791569, "creation_date": 1522791569, "answer_id": 49639526, "question_id": 49639455, "link": "https://stackoverflow.com/questions/49639455/merge-list-haskell/49639526#49639526", "title": "Merge list haskell", "body": "<p>Haskell doesn't have traditional loops, but it does have recursion:</p>\n\n<pre><code>foo :: [Integer] -&gt; [Integer] -&gt; [Integer]\nfoo [] [] = []\nfoo (x:xs) (y:ys) = x+y : foo xs ys\n</code></pre>\n\n<p>Or, as suggested by Willem Van Onsem, you can just use the function <code>zipWith</code>:</p>\n\n<pre><code>foo = zipWith (+)\n</code></pre>\n\n<p>Note that if you don't specify the exact type of <code>foo</code>, it will be infered as</p>\n\n<pre><code>foo :: (Num a) =&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 104, "user_id": 4782303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZ0OM.jpg?s=128&g=1", "display_name": "Prototype", "link": "https://stackoverflow.com/users/4782303/prototype"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 49639526, "answer_count": 1, "score": 0, "last_activity_date": 1522791569, "creation_date": 1522791242, "last_edit_date": 1522791271, "question_id": 49639455, "link": "https://stackoverflow.com/questions/49639455/merge-list-haskell", "title": "Merge list haskell", "body": "<p>I have two lists for example:\n<code>[1,2,3,4,5]</code> and <code>[1,2,3,4,5]</code> and I want to merge them to <code>[2,4,6,8,10]</code>.\nIs there an easy way to do this in haskell since there aint traditional loops?\nAssume that both lists will be same size</p>\n"}, {"tags": ["haskell", "package", "pthreads", "ghci"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522783684, "post_id": 49637459, "comment_id": 86283193, "body": "I don&#39;t know. Just to say that personally, I use the <a href=\"http://cmder.net/\" rel=\"nofollow noreferrer\">CMDER</a> terminal, and it is great."}], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1525945977, "post_id": 49716970, "comment_id": 87557528, "body": "Ah, I also recently installed Lilypond and now I get these errors. Let&#39;s see what we can do about that."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7535800"}, "is_accepted": false, "score": 3, "last_activity_date": 1523183866, "creation_date": 1523183866, "answer_id": 49716970, "question_id": 49637459, "link": "https://stackoverflow.com/questions/49637459/ghci-on-windows-10-error-user-specified-o-so-dll-could-not-be-loaded-adddll/49716970#49716970", "title": "ghci on Windows 10 error: user specified .o/.so/.DLL could not be loaded (addDLL: pthread", "body": "<p>I can't post in comments so I'll provide what I found here. Feel free to delete my \"answer\" if this doesn't follow any stackoverflow guideline.</p>\n\n<p>I ran into the same error with a fresh install of the full 64bit Haskell Plateform on Windows 10.</p>\n\n<p>I tried messing around with the pthread.dll submitted by another project (Lilypond to be exact). I added it to one of the additional directories added by Stack when ghci is run through <code>stack ghci</code>.</p>\n\n<p>Ghci can find it but can't load it. So the problem isn't about ghci failing to find any stuff related to pthread.</p>\n\n<p>Here is the output for reference:</p>\n\n<pre><code>$ stack ghci\nThe following GHC options are incompatible with GHCi and have not been passed to it: -threaded\nGHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\n&lt;command line&gt;: user specified .o/.so/.DLL could not be loaded (addDLL: C:\\Users\\Alice\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-201505)\nWhilst trying to load:  (dynamic) C:\\Users\\{user}\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin\\pthread.dll\nAdditional directories searched:   C:\\Users\\{user}\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin\n   C:\\Users\\{user}\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib\n</code></pre>\n\n<p>I don't have any further information yet. However I hope what I provided can help.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 12694256, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAKEUtnsuWWs9XW0J250b-y89lDnwNtzDAnPeaEjw=k-s128", "display_name": "Simon Humphreys", "link": "https://stackoverflow.com/users/12694256/simon-humphreys"}, "is_accepted": false, "score": 1, "last_activity_date": 1578769050, "creation_date": 1578769050, "answer_id": 59697634, "question_id": 49637459, "link": "https://stackoverflow.com/questions/49637459/ghci-on-windows-10-error-user-specified-o-so-dll-could-not-be-loaded-adddll/59697634#59697634", "title": "ghci on Windows 10 error: user specified .o/.so/.DLL could not be loaded (addDLL: pthread", "body": "<p>This page illuminates: <a href=\"http://euterpea.com/troubleshooting/\" rel=\"nofollow noreferrer\">http://euterpea.com/troubleshooting/</a></p>\n\n<p>\"Trying to start GHCi, WinGHCI, or running GHC fails with errors related to pthread.dll, such as: user specified .o/.so/.DLL could not be loaded (addDLL: pthread or dependencies not loaded. (Win32 error 193))</p>\n\n<p>If you have Lilypond installed, this is unfortunately a known incompatibility with recent versions of Haskell Platform right now. There are only three ways to solve it for now:</p>\n\n<p>Option 1: Remove Lilypond\u2019s bin folder from your PATH environment variable. If you have a user path and a system path, you must remove Lilypond-related entries from BOTH, not just the user\u2019s path. You may need to reboot for GHCi to work again. You should still be able to run the GUI for Lilypond by making a desktop shortcuts directly to Lilypad.exe. If using from command line, calling the executables with the full path to the containing folder. Unless you used a custom installation location, the Lilypad, lilypond, midi2ly, and other programs that come with Lilypond will be located in this folder: C:\\Program Files (x86)\\LilyPond\\usr\\bin</p>\n\n<p>Option 2: Use Haskell Platform 8.0.2a (core or full).</p>\n\n<p>Option 3: Uninstall Lilypond. This is only recommended if it\u2019s an old installation and you don\u2019t plan on using it anymore. Otherwise, try option 1 first.\"</p>\n\n<p>HTH</p>\n"}], "owner": {"reputation": 91, "user_id": 6845640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6552058ade3854a6e0142cba989385c?s=128&d=identicon&r=PG&f=1", "display_name": "John O&#39;D", "link": "https://stackoverflow.com/users/6845640/john-od"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 907, "favorite_count": 0, "answer_count": 2, "score": 8, "last_activity_date": 1578769050, "creation_date": 1522782441, "question_id": 49637459, "link": "https://stackoverflow.com/questions/49637459/ghci-on-windows-10-error-user-specified-o-so-dll-could-not-be-loaded-adddll", "title": "ghci on Windows 10 error: user specified .o/.so/.DLL could not be loaded (addDLL: pthread", "body": "<p>I've installed Haskell Platform version 8.2.2 (Full, 64 bit) on Windows 10.  ghc works, and also WinGHCi.  There are several problems:\n-- Running ghci in cygwin gives this error:</p>\n\n<p>GHCi, version 8.2.2: <a href=\"http://www.haskell.org/ghc/\" rel=\"noreferrer\">http://www.haskell.org/ghc/</a>  :? for help\n: user specified .o/.so/.DLL could not be loaded (addDLL: pthread or dependencies not loaded. (Win32 error 193)) Whilst trying to load:  (dynamic) pthread Additional directories searched: (none)</p>\n\n<p>-- Running ghci in PowerShell just causes PowerShell to freeze\n-- Installing packages with cabal produces a similar error message\n-- ghc-pkg check produces a large number of warnings, including many that refer to ghc-8.0.1, which is the most recent version of ghc that works on my computer\nGHC_PACKAGE_PATH is not set.  I can't find anything in my configuration that refers to ghc-8.0.1.  (The cabal.config file contains the definitions given in the Haskell Platform download page.)</p>\n\n<p>What is the cause and the cure for the error message \": user specified .o/.so/.DLL could not be loaded (addDLL: pthread or dependencies not loaded. (Win32 error 193))?</p>\n"}, {"tags": ["haskell", "cabal", "haddock"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1522775034, "post_id": 49635081, "comment_id": 86278438, "body": "Did you include the two dashes that you wrote here? That&#39;s comment syntax in the config file, so your addition was probably gleefully ignored. You want <code>documentation: True</code> <i>without</i> the two dashes."}, {"owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522902911, "post_id": 49635081, "comment_id": 86338206, "body": "Yes the -- are there and I see that mistake"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522916901, "post_id": 49635081, "comment_id": 86345055, "body": "Please, at 4.9k rep you should know to format a SO question better than that, shouldn&#39;t you?"}], "answers": [{"comments": [{"owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "edited": false, "score": 0, "creation_date": 1522903556, "post_id": 49635458, "comment_id": 86338362, "body": "This  has helped me at least a bit now I&#39;m at falling to generate the doc. But anyway thank I learned something..."}, {"owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "edited": false, "score": 0, "creation_date": 1522908186, "post_id": 49635458, "comment_id": 86340048, "body": "Now I tried my luck with your suggestion:  cabal unpack gtk3"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1522774681, "creation_date": 1522774681, "answer_id": 49635458, "question_id": 49635081, "link": "https://stackoverflow.com/questions/49635081/how-to-generate-haddock-docs-with-cabal/49635458#49635458", "title": "How to generate Haddock docs with Cabal?", "body": "<p>I believe you are looking for <code>cabal haddock</code> or if you are using the new commands, <code>cabal new-haddock</code>.  Observe:</p>\n\n<pre><code>% cabal unpack gps\nUnpacking to gps-1.2/\n% cd gps-1.2\n% cabal --help | grep document\n  upload           Uploads source packages or documentation to Hackage.\n  haddock          Generate Haddock HTML documentation.\n  new-haddock      Build Haddock documentation\n% cabal haddock\nResolving dependencies...\nConfiguring gps-1.2...\nPreprocessing library for gps-1.2..\nRunning Haddock on library for gps-1.2..\n... snip ...\nDocumentation created: dist/doc/html/gps/index.html\ncabal haddock  3.42s user 1.00s system 92% cpu 4.784 total\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1523453664, "post_id": 49684107, "comment_id": 86568134, "body": "Why does installing the documentation globally seem better to you than installing it to your home directory? Are you really planning to share these docs with other users on the same machine? (That is by far the less common situation, and more dangerous as it requires root powers, and these two things together motivate the default to install locally.)"}, {"owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1523612619, "post_id": 49684107, "comment_id": 86642132, "body": "I think it&#39;s good if anyone could see the docs, but in the end I can live with the local installed stuff, because I&#39;m the only programmmer interested in it... What am I supposed to use if I would haver more progarmmers, why do everyone have to install the Haskell development tools for himself?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1523618609, "post_id": 49684107, "comment_id": 86645864, "body": "If you plan to share packages with other developers, then it can make sense to install the package and the documentation globally. But one must exercise some care; cabal hell is very real, and both the symptoms and the cure are exacerbated by global installs."}], "tags": [], "owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "is_accepted": false, "score": 0, "last_activity_date": 1522980054, "creation_date": 1522980054, "answer_id": 49684107, "question_id": 49635081, "link": "https://stackoverflow.com/questions/49635081/how-to-generate-haddock-docs-with-cabal/49684107#49684107", "title": "How to generate Haddock docs with Cabal?", "body": "<p>Well it took me some time and some posts here pointed me into the right direction. </p>\n\n<p>At first, my fault. I did replace False with True under documentation but did not uncomment the line, so the default took place that is not to generate docs (can't see this as a good default - YMMV)</p>\n\n<p>Then cabal does work locally normally, there is a flag --global to change that or you can change int in ~/.cabal/config</p>\n\n<p>Now what happens with the documentation is the following. The doc are generated in the home directory but they all the docs are linked into the new genarated index.html file. So you get the docs from the global install and from the local install.</p>\n\n<p>Now I'm still not getting a few things. I' do not know why cabal ist not supposed to be uses globally for installing all the fille into a global location. </p>\n\n<p>And yes I stumbled upon stack, sandboxes and the new-xxxx (commands) I still have no idea what to make out of them.... But that's another question I guess. </p>\n"}], "owner": {"reputation": 5718, "user_id": 15068, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2aa13cefa67afd0c908bf3b58a5aa8?s=128&d=identicon&r=PG&f=1", "display_name": "Friedrich", "link": "https://stackoverflow.com/users/15068/friedrich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1596553028, "creation_date": 1522773440, "last_edit_date": 1596553028, "question_id": 49635081, "link": "https://stackoverflow.com/questions/49635081/how-to-generate-haddock-docs-with-cabal", "title": "How to generate Haddock docs with Cabal?", "body": "<p>I'm lost. I do not get how I generate docs locally with cabal. What I want is cabal install gtk3 which does generate the documenation also. Or well if that does not work how to I generate the docs locally? </p>\n\n<p>I've put that into my .config file from cabal:\n-- documentation: True</p>\n\n<p>But do not good end, no docs to be found </p>\n\n<p>I guess it's simple thing I simply do no see....</p>\n\n<p>Ok with the help of some comments I got a bit further. Anyway cabal just does a local install for me as user and it gives me a warning that global is not recommended. Here I found <a href=\"https://wiki.haskell.org/Cabal-Install\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Cabal-Install</a></p>\n\n<p>what I'm supposed to to for global installation and the like, but if I'm not using it I get warnings about that global should not be used and even with documentation set do documentation: True I do not get an update for the haskell Platform docs. </p>\n\n<p>So I'm not supposed to use cabal for a global installation of files? </p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1522768313, "post_id": 49632868, "comment_id": 86274298, "body": "Use the parameter: <code>items p = sepBy p (char &#39;,&#39;)</code>"}, {"owner": {"reputation": 341, "user_id": 9194266, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/755e310581ee39e1dadbcbcc2c8e78aa?s=128&d=identicon&r=PG&f=1", "display_name": "barskyn", "link": "https://stackoverflow.com/users/9194266/barskyn"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1522768467, "post_id": 49632868, "comment_id": 86274401, "body": "I want it to be the symbol &quot;,&quot;, not the char, but when I try to make the adjustment it doesn&#39;t work"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1522768593, "post_id": 49632868, "comment_id": 86274490, "body": "Please include in your question a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> along with the error message."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 1, "last_activity_date": 1522783049, "last_edit_date": 1522783049, "creation_date": 1522781519, "answer_id": 49637216, "question_id": 49632868, "link": "https://stackoverflow.com/questions/49632868/parsec-sepby-haskell/49637216#49637216", "title": "Parsec sepBy Haskell", "body": "<p>I'm not sure what you want and I don't know what is <code>Parser</code>.</p>\n\n<p>Starting from such a string:</p>\n\n<pre><code>thestring = \"(\\\"age\\\",5),(\\\"age\\\",6),(\\\"age\\\",7)\"\n</code></pre>\n\n<p>I would firstly remove the outer commas with a regular expression method:</p>\n\n<pre><code>import Text.Regex\nrgx = mkRegex \"\\\\),\\\\(\"\nthestring' = subRegex rgx thestring \")(\"\n</code></pre>\n\n<p>This gives:</p>\n\n<pre><code>&gt;&gt;&gt; thestring'\n\"(\\\"age\\\",5)(\\\"age\\\",6)(\\\"age\\\",7)\"\n</code></pre>\n\n<p>Then I would split:</p>\n\n<pre><code>import Data.List.Split\nthelist = split (startsWith \"(\") thestring'\n</code></pre>\n\n<p>which gives:</p>\n\n<pre><code>&gt;&gt;&gt; thelist\n[\"(\\\"age\\\",5)\",\"(\\\"age\\\",6)\",\"(\\\"age\\\",7)\"]\n</code></pre>\n\n<p>This is what you want, if I correctly understood. </p>\n\n<p>That's probably not the best way. Since all the elements of the final list have form <code>(\"age\", X)</code> you could extract all numbers (I don't know but it should not be difficult) and then it would be easy to get the final list. Maybe better. </p>\n\n<p>Apologies if this has nothing to do with your question.</p>\n\n<h2>Edit</h2>\n\n<p>JFF (\"just for fun\"), another way:</p>\n\n<pre><code>import Data.Char (isDigit)\nimport Data.List.Split\nthestring = \"(\\\"age\\\",15),(\\\"age\\\",6),(\\\"age\\\",7)\"\nages = (split . dropBlanks . dropDelims . whenElt) (not . isDigit) thestring\nmap (\\age -&gt; \"(age,\" ++ age ++ \")\") ages\n-- result: [\"(age,15)\",\"(age,6)\",\"(age,7)\"]\n</code></pre>\n\n<p>Or rather:</p>\n\n<pre><code>&gt;&gt;&gt; map (\\age -&gt; (\"age\",age)) ages\n[(\"age\",\"15\"),(\"age\",\"6\"),(\"age\",\"7\")]\n</code></pre>\n\n<p>Or if you want integers:</p>\n\n<pre><code>&gt;&gt;&gt; map (\\age -&gt; (\"age\", read age :: Int)) ages\n[(\"age\",15),(\"age\",6),(\"age\",7)]\n</code></pre>\n\n<p>Or if you want age1, age2, ...:</p>\n\n<pre><code>import Data.List.Index\nimap (\\i age -&gt; (\"age\" ++ show (i+1), read age :: Int)) ages\n-- result: [(\"age1\",15),(\"age2\",6),(\"age3\",7)]\n</code></pre>\n"}], "owner": {"reputation": 341, "user_id": 9194266, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/755e310581ee39e1dadbcbcc2c8e78aa?s=128&d=identicon&r=PG&f=1", "display_name": "barskyn", "link": "https://stackoverflow.com/users/9194266/barskyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522783049, "creation_date": 1522766411, "last_edit_date": 1522768183, "question_id": 49632868, "link": "https://stackoverflow.com/questions/49632868/parsec-sepby-haskell", "title": "Parsec sepBy Haskell", "body": "<p>I wrote a function and it complies, but I'm not sure if it works the way I intend it to or how to call it in the terminal. Essentially, I want to take a string, like (\"age\",5),(\"age\",6) and make it into a list of tuples [(\"age1\",5)...]. I am trying to write a function separate the commas and either I am just not sure how to call it in the terminal or I did it wrong. </p>\n\n<pre><code>items :: Parser (String,Integer) -&gt; Parser [(String,Integer)]\nitems p =  do { p &lt;- sepBy strToTup (char \",\");\n                return p }\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1758, "user_id": 8724882, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d88f8198fb4ae68267aced911e3533f9?s=128&d=identicon&r=PG&f=1", "display_name": "sandwood", "link": "https://stackoverflow.com/users/8724882/sandwood"}, "edited": false, "score": 1, "creation_date": 1522767293, "post_id": 49632431, "comment_id": 86273523, "body": "Thanks !  Indeed I think what confused me is the possibility of doing a round trip with a Maybe : fromJust $ Just &quot;Foobar&quot;   which works smoothly.  But you pointed me that the data type is &quot;SqlValue&quot; not &quot;SqlValue a&quot;.  Obviously this has the benefit of being able to put in a list heteregenous SqlValue types. ( [Just 5, Just &quot;Foobar]  being impossible)."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 1, "last_activity_date": 1522765759, "last_edit_date": 1522765759, "creation_date": 1522765216, "answer_id": 49632431, "question_id": 49631208, "link": "https://stackoverflow.com/questions/49631208/usage-of-tosql-database-hdbc/49632431#49632431", "title": "usage of toSql (database.HDBC)", "body": "<p>You just need to add a type annotation to get typechecking to succeed:</p>\n\n<pre><code>\u03bb&gt; fromSql $ toSql \"foobar\" :: String\n\"foobar\"\n</code></pre>\n\n<p>If you're using this with more contextual code, you might be able to skip the annotation if it can be inferred, eg:</p>\n\n<pre><code>\u03bb&gt; putStrLn $ fromSql $ toSql \"foobar\"\nfoobar\n</code></pre>\n\n<p>As <code>putStrLn</code> has type <code>String -&gt; IO ()</code>, the type is inferred automatically for you.</p>\n\n<hr>\n\n<p>To try to give some intuition as to why this is needed:</p>\n\n<p>The type of <code>toSql</code> is:</p>\n\n<pre><code>toSql :: Convertible a SqlValue =&gt; a -&gt; SqlValue\n</code></pre>\n\n<p>Note that the result type (<code>SqlValue</code>) doesn't have any parameters about what type it contains - it's just a black box that could be a string, number etc. Given this, and looking at the type of <code>fromSql</code>:</p>\n\n<pre><code>fromSql :: Convertible SqlValue a =&gt; SqlValue -&gt; a\n</code></pre>\n\n<p>...we can see that it takes this black box and has to return a value of a specific type from it. It can't restrict this type to be say <code>String</code> or <code>Int</code> as it has to be able to return different types depending on what's inside the black box, and the black box itself doesn't reveal any information about what's inside it at compile-time so it can't leverage that.</p>\n\n<p>The only possible return type it can have, then, is some <code>a</code> (obeying the constraint <code>Convertible SqlValue a</code>), so you have to add the type constraint to force it to typecheck.</p>\n"}], "owner": {"reputation": 1758, "user_id": 8724882, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d88f8198fb4ae68267aced911e3533f9?s=128&d=identicon&r=PG&f=1", "display_name": "sandwood", "link": "https://stackoverflow.com/users/8724882/sandwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 49632431, "answer_count": 1, "score": 0, "last_activity_date": 1522765759, "creation_date": 1522761736, "question_id": 49631208, "link": "https://stackoverflow.com/questions/49631208/usage-of-tosql-database-hdbc", "title": "usage of toSql (database.HDBC)", "body": "<p>I do not understand how to use fromSql from database.HDBC.</p>\n\n<pre><code>*Main&gt; toSql \"foobar\"\nSqlString \"foobar\"\n</code></pre>\n\n<p>Until here, I feel confortable, I have something of type SqlString </p>\n\n<p>Now, trying some round-trip : </p>\n\n<pre><code>*Main&gt; fromSql $ toSql \"foobar\"\n\n&lt;interactive&gt;:4:1: error:\n    * Non type-variable argument\n        in the constraint: Data.Convertible.Base.Convertible SqlValue a\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall a. Data.Convertible.Base.Convertible SqlValue a =&gt; a\n</code></pre>\n\n<p>Ok, I put the FlexibleContexts on according to this thread <a href=\"https://stackoverflow.com/questions/21375556/haskell-use-xflexiblecontexts-to-permit-this\">Haskell : Use -XFlexibleContexts to permit this?</a></p>\n\n<pre><code>*Main&gt; :set -XFlexibleContexts\n*Main&gt; fromSql $ toSql \"foobar\"\n\n&lt;interactive&gt;:8:1: error:\n    * No instance for (Data.Convertible.Base.Convertible SqlValue ())\n        arising from a use of `it'\n    * In the first argument of `print', namely `it'\n      In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Still KO, I understand here that whatever type the round trip create, this stuff is not a valid argument for the print.</p>\n\n<p>I am checking the type : </p>\n\n<pre><code>*Main&gt; res = fromSql $ toSql \"foobar\"\n*Main&gt; :t res\nres :: Data.Convertible.Base.Convertible SqlValue a =&gt; a\n</code></pre>\n\n<p>And here I am lost... I would expect to have something like  [char] or String. </p>\n"}, {"tags": ["haskell", "lifting"], "comments": [{"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1522754416, "post_id": 49628762, "comment_id": 86264271, "body": "If you wonder what am I doing, I am converting csv records into haskell record of about 23 fields, and instance declaration of <code>FromRecord</code> looks like in the question, where <code>myFunc</code> is constructor and <code>someFunctionName</code> is <code>unsafeIndex</code>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1522755269, "post_id": 49628762, "comment_id": 86264759, "body": "Are all of the arguments of the same type?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1522755399, "post_id": 49628762, "comment_id": 86264850, "body": "I seriously doubt it&#39;s a good idea to represent such a big CSV by a monolithic Haskell record. Why do you do this?"}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1522755680, "post_id": 49628762, "comment_id": 86265024, "body": "In this case types of functions are the same. I shall edit question.  This data is impossible to split in reasonable way"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 1, "creation_date": 1522756971, "post_id": 49628762, "comment_id": 86265851, "body": "You could define <code>liftM23</code>, but I doubt this will be &quot;nicer&quot; than a long chain of <code>&lt;*&gt;</code>s. In fact, I&#39;d probably find that the nicest for a lot less arguments than 23; they chain nicely across lines whereas e.g. <code>liftM2</code> is neat because the arguments fit totally on one line. Have you considered designing your Haskell records in such a way that they only contain partitions of the CSV-file that are relevant to certain applications? Generally, if your functions have 23 arguments, they&#39;re doing too much."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1522762781, "creation_date": 1522762781, "answer_id": 49631612, "question_id": 49628762, "link": "https://stackoverflow.com/questions/49628762/lifting-generalization/49631612#49631612", "title": "Lifting - generalization", "body": "<h1>Lift constructors</h1>\n\n<p>Using type classes we can define a generalized version of <code>liftA</code>/<code>ap</code>. The tricky part is to infer when to stop lifting and return the result. Here we use the fact that constructors are curried functions with as many arguments as they have fields, and the result type is not a function.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Text.Read\n\n-- apF\n--   :: Applicative f\n--   =&gt; (i -&gt; f a)\n--   -&gt; (a -&gt; a -&gt; ... -&gt;   x)   -- constructor type\n--   -&gt; (i -&gt; i -&gt; ... -&gt; f x)   -- lifted function\nclass Applicative f =&gt; ApF f i a s t where\n  apF :: (i -&gt; f a) -&gt; f s -&gt; t\n\n-- Recursive case\n-- s ~ (a -&gt; ...)\n-- t ~ (i -&gt; ...)\ninstance (a ~ a', t ~ (i -&gt; t'), ApF f i a s' t') =&gt; ApF f i a (a' -&gt; s') t where\n  apF parseArg fconstr i = apF parseArg (fconstr &lt;*&gt; parseArg i)\n\n-- Base case\n-- s ~   x  -- x assumed not to be a function type (not (y -&gt; z) for any y and z)\n-- t ~ f x\ninstance {-# OVERLAPPABLE #-} (t ~ f x, Applicative f) =&gt; ApF f i a x t where\n  apF _ fconstr = fconstr\n\nliftF :: ApF f i a s t =&gt; (i -&gt; f a) -&gt; s -&gt; t\nliftF parseArg constr = apF parseArg (pure constr)\n\nmain = do\n  let lookup :: Int -&gt; Maybe Integer\n      lookup i =\n        case drop i [2,3,5,7,11,13] of\n          [] -&gt; Nothing\n          a : _ -&gt; Just a\n  print $ liftF lookup (,,) 0 2 5\n</code></pre>\n\n<h1>Higher-kinded records and generics</h1>\n\n<ul>\n<li><a href=\"http://reasonablypolymorphic.com//blog/higher-kinded-data\" rel=\"nofollow noreferrer\">Blog post on representing records as higher-kinded data</a></li>\n<li><a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop documentation</a></li>\n<li><a href=\"https://gist.github.com/Lysxia/8fc397cf55c436e69d2390df1301cea7\" rel=\"nofollow noreferrer\">Gist of this answer</a></li>\n</ul>\n\n<p>Another solution is to first parameterize records by a type function wrapping every field, so that we can put things of various other related types. Those allow us to produce and consume actual records by traversing those derived structures using Haskell Generics.</p>\n\n<pre><code>data UserF f = User\n  { name :: f @@ String\n  , age :: f @@ Int\n  } deriving G.Generic\n\ntype User = UserF Id\n</code></pre>\n\n<p>Type functions are defined using the type family <code>(@@)</code> (<code>HKD</code> in the blog post linked above). The ones relevant to this answer are the identity and constant functions.</p>\n\n<pre><code>type family s @@ x\ntype instance Id   @@ x = x\ntype instance Cn a @@ x = a\n\ndata Id\ndata Cn (a :: *)\n</code></pre>\n\n<p>For example, we can gather the indices used to parse CSV, in a <code>UserF (Cn Int)</code>:</p>\n\n<pre><code>userIxes = User { name = 0, age = 2 } :: UserF (Cn Int)\n</code></pre>\n\n<p>Given such a parameterized record type (<code>p = UserF</code>), and a record of indices (<code>ixes :: p (Cn Int)</code>), we can parse a CSV record (<code>r :: [String]</code>) with <code>parseRec</code> below. Here using <a href=\"https://hackage.haskell.org/package/generics-sop-0.3.2.0/docs/Generics-SOP.html\" rel=\"nofollow noreferrer\"><em>generics-sop</em></a>.</p>\n\n<pre><code>parseRec :: _\n         =&gt; p (Cn Int) -&gt; [String] -&gt; Maybe (p Id)\nparseRec ixes r =\n  fmap to .\n  hsequence .\n  htrans (Proxy :: Proxy ParseFrom) (\\(I i) -&gt; read (r !! i)) .\n  from $\n  ixes\n</code></pre>\n\n<p>Let us break down the code bottom-up. <em>generics-sop</em> provides combinators to transform records in a uniform way that is like using lists. It is best to follow a proper tutorial to understand the underlying details, but for the sake of demonstration, we will imagine that the middle of the pipeline between <code>from</code> and <code>to</code> is actually transforming lists, using a dynamic type <code>Field</code> to type heterogeneous lists.</p>\n\n<ul>\n<li><p><code>from</code> turns a record into its heterogeneous list of fields, but since they're all <code>Int</code> the list is really homogeneous for now <code>from :: p (Cn Int) -&gt; [Int]</code>.</p></li>\n<li><p>Here using <code>(!!)</code> and <code>read</code>, we get and parse each field using the given index <code>i</code>. <code>htrans Proxy</code> is basically <code>map</code>: <code>(Int -&gt; Maybe Field) -&gt; [Int] -&gt; [Maybe Field]</code>.</p></li>\n<li><p><code>hsequence</code> is basically <code>sequence :: [Maybe Field] -&gt; Maybe [Field]</code>. </p></li>\n<li><p><code>to</code> turns a list of fields into a record with compatible field types, <code>[Field] -&gt; p Id</code>.</p></li>\n</ul>\n\n<p>The final step is effortless:</p>\n\n<pre><code>parseUser :: Record -&gt; Maybe User\nparseUser = parseRec $ User { name = 0, age = 2 }\n</code></pre>\n"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 49631612, "answer_count": 1, "score": 2, "last_activity_date": 1522762781, "creation_date": 1522754313, "last_edit_date": 1522755805, "question_id": 49628762, "link": "https://stackoverflow.com/questions/49628762/lifting-generalization", "title": "Lifting - generalization", "body": "<p>I need to use heavy function lifting, eg.</p>\n\n<pre><code>k = myFunc\n  &lt;$&gt; someFunctionName 1\n  &lt;*&gt; someFunctionName 2\n  &lt;*&gt; someFunctionName 3\n  &lt;*&gt; someFunctionName 4\n  &lt;*&gt; someFunctionName 5\n  &lt;*&gt; someFunctionName 6\n  &lt;*&gt; someFunctionName 8\n  &lt;*&gt; someFunctionName 9\n  -- ...\n</code></pre>\n\n<p>Which is not provided for bigger functions (about 20 arguments) by Prelude. Is there smart way to do such a lift without explicitly chaining those <code>ap</code>s? I am looking for something like</p>\n\n<pre><code>k = magic (map someFunctionName [1,2,3,4,5,6,8,9]) myFunc \n</code></pre>\n\n<p>I may be hard to guess the type of <code>magic</code> as it depends on number of arguments of lifted function. It is of course not possible to use <code>map</code> on list here (or is it?), I put it only as a viewpoint.</p>\n\n<p>I think I am looking for something that could be nicely solved by dependent types, which are not included in Haskell, but maybe there is some tricky way to workaround it (TemplateHaskell?)</p>\n\n<p>Do you have any ideas how to make it more elegant and flexible?</p>\n\n<p><strong>edit:</strong> In my case types of chained functions are all the same.  </p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 7576, "user_id": 480398, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3468d23f15a9f631136b508b967b0fbe?s=128&d=identicon&r=PG", "display_name": "hvr", "link": "https://stackoverflow.com/users/480398/hvr"}, "edited": false, "score": 0, "creation_date": 1522756030, "post_id": 49627839, "comment_id": 86265244, "body": "Being involved with their development, I can only speak on behalf of Cabal and GHC regarding the officially supported configurations: For GHC 8.0, you should use at least <code>cabal-install-1.24</code>; for GHC 8.2, you should use at least <code>cabal-install-2.0</code>; for GHC 8.4 you need at least <code>cabal-install-2.2</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1522825366, "post_id": 49631541, "comment_id": 86297275, "body": "thank you for your information. it seems that the issue is only one of bening error messages, which can be ignored. I had the impression, that the issue was fixed in <code>stack 1.6.5</code> but it seems not. I wait for the next version... - @steshaw recommends  &quot;install cabal-install 1.24.0.2 using stack --resolver lts-9 install cabal-install&quot; in &lt;<a href=\"https://github.com/commercialhaskell/stack/issues/3453\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/3453</a>&gt;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1522888652, "post_id": 49631541, "comment_id": 86334911, "body": "@user855443 &quot;it seems that the issue is only one of bening error messages&quot; -- That&#39;s good to hear. Do you mean the command you run to get the first warning message (the one which says &quot;The following lines from cabal-install output could not be parsed&quot;) succeeds? (By the way, it would be useful to know how to reproduce the issue you describe.)"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 1, "creation_date": 1522918904, "post_id": 49631541, "comment_id": 86346390, "body": "It happended only once (when I upgraded to LTS 11.2 and never since. I did not <i>see</i> any negative effects. If it happens again, I will document."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1523093095, "post_id": 49631541, "comment_id": 86424959, "body": "I am working on a different computer and here the messages seems to occur consistently when I run <code>stack solver</code>. what information would be useful information for you?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1523193411, "post_id": 49631541, "comment_id": 86449290, "body": "@user855443 Adding the <code>stack.yaml</code> and <code>package.yaml</code> (and/or the .cabal file) files for your package would help. Ideally, it would be good to have a minimal example that can be used to reproduce the issue."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1523211974, "post_id": 49631541, "comment_id": 86455604, "body": "i will try to produce a miniaml example next week (the real case is somewhat large) - but only next weekend (during the week i work on another computer)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1522762548, "creation_date": 1522762548, "answer_id": 49631541, "question_id": 49627839, "link": "https://stackoverflow.com/questions/49627839/stack-1-6-5-not-working-with-cabal-2-0-0-1/49631541#49631541", "title": "stack 1.6.5 not working with cabal 2.0.0.1", "body": "<p>Stack issues <a href=\"https://github.com/commercialhaskell/stack/issues/3453\" rel=\"nofollow noreferrer\">#3453</a> and <a href=\"https://github.com/commercialhaskell/stack/issues/3799\" rel=\"nofollow noreferrer\">#3799</a> suggest this is a known bug in Stack. Until a fix for it lands, a makeshift workaround <a href=\"https://github.com/commercialhaskell/stack/issues/3453#issuecomment-376247809\" rel=\"nofollow noreferrer\">suggested in a comment to #3453</a> is using <code>stack --resolver lts-9 install cabal-install</code> to install <em>cabal-install</em> 1.24.0.2 (the executable, not the library).</p>\n\n<p>Caveats:</p>\n\n<ul>\n<li><p>The workaround assumes the local installation path Stack uses (cf. what <code>stack path --local-bin</code> tells you) has priority over the path of the globally installed <em>cabal-install</em> in hour <code>PATH</code> environment variable, or if you don't have a globally installed <em>cabal-install</em> to begin with (e.g. if you aren't using the Haskell Platform).</p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/49627839/stack-1-6-5-not-working-with-cabal-2-0-0-1#comment86265244_49627839\">As hvr points out</a>, this is not officially supported as far as Cabal and GHC are concerned, and you might run into further issues if features from newer <em>cabal-install</em> versions ever turn out to be necessary while using the solver via Stack.</p></li>\n<li><p>If you ever need or want to have an up-to-date <em>cabal-install</em>, just use <code>stack install cabal-install</code> -- which will do it with the resolver you are using elsewhere. (If you have a globally installed <em>cabal-install</em> and want to go back to using it, you can simply delete the Stack-installed one from the location indicated by <code>stack path --local-bin</code>.)</p></li>\n</ul>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1522762548, "creation_date": 1522751458, "question_id": 49627839, "link": "https://stackoverflow.com/questions/49627839/stack-1-6-5-not-working-with-cabal-2-0-0-1", "title": "stack 1.6.5 not working with cabal 2.0.0.1", "body": "<p>I have stack 1.6.5 but see the error described in <a href=\"https://stackoverflow.com/questions/45815830/cabal-2-0-required-when-using-a-nightly-snapshot-with-stack\">Cabal 2.0 required when using a nightly snapshot with stack</a>. I understand that the problem was solved in stack v 1.5.1, but I see it in 1.6.5:</p>\n\n<pre><code>Using resolver: lts-11.2\n\nWarning: Installed version of cabal-install (2.0.0.1) is newer than stack has been tested with.  If you run into difficulties, consider downgrading.\n\nUsing compiler: ghc-8.2.2\nAsking cabal to calculate a build plan...\nTrying with packages from lts-11.2 and 3 external packages as hard constraints...\nThe following lines from cabal-install output could not be parsed: \nabstract-par-0.3.3 (via: monad-par-0.3.4.8 monad-par-extras-0.3.3) (new\npackage)\nbase-compat-0.9.3 (via: criterion-1.3.0.0 criterion-1.3.0.0 aeson-pretty-0.8.5\n\naeson-1.2.4.0 quickcheck-instances-0.3.18) (new package)\n</code></pre>\n\n<p>stack upgrade gives:</p>\n\n<pre><code>frank@oporto:~/Workspace8/LitTextWork/LitText$ stack upgrade\nCurrent Stack version: 1.6.5, available download version: 1.6.5\nSkipping binary upgrade, you are already running the most recent version\n</code></pre>\n\n<p>I assume that the output is harmless, but should be bypassed in this version? How would I downgrad the cabal? What is the last cabal version recommended?</p>\n"}, {"tags": ["parsing", "haskell", "applicative", "state-monad", "alternative-functor"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1522746672, "post_id": 49626131, "comment_id": 86259436, "body": "I don&#39;t think there&#39;s anything ready-made for that. You could, however, observe how <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/src/Text.Parsec.Prim.html#try\" rel=\"nofollow noreferrer\">Parsec solves this particular problem</a> (scroll up for explanation). IIRC the main reason it even exists there is because it&#39;s a potentially costly operation involving backtracking a lot of data."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1522749126, "post_id": 49626131, "comment_id": 86261029, "body": "Monadic parsers in Haskell are typically either non-deterministic like <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Text-ParserCombinators-ReadP.html\" rel=\"nofollow noreferrer\">ReadP</a> (using the list monad to capture all possible parse states and eliminate them as they fail) or backtracking like <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a> (using explicit <code>try</code>s in front of sub-parsers that may consume and fail), as Bartek Banachewicz points out. The most efficient alternative is to model your parser after an LL(1) grammar when possible."}], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "is_accepted": true, "score": 0, "last_activity_date": 1522778329, "creation_date": 1522778329, "answer_id": 49636420, "question_id": 49626131, "link": "https://stackoverflow.com/questions/49626131/haskell-using-state-with-alternative/49636420#49636420", "title": "Haskell - Using State with Alternative", "body": "<p>Following the advice from the comments, I remodeled my parser to take advantage of the fact that my grammar is LL(1). Doing this meant I had no need for <code>Alternative</code>.</p>\n\n<p>This is the final version of the <code>charList</code> function (with <code>isToken</code> using <code>consumeToken</code>):</p>\n\n<pre><code>charList :: Parser CharList\ncharList = do\n    tok &lt;- peekToken\n    case tok of Character _ -&gt; return CharListCharacter &lt;*&gt; isToken (Character \"&lt;char&gt;\") &lt;*&gt; charList\n                Space _     -&gt; return CharListSpace &lt;*&gt; isToken (Space \" \") &lt;*&gt; charList\n                _           -&gt; return EmptyCharList\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 49636420, "answer_count": 1, "score": 3, "last_activity_date": 1613970149, "creation_date": 1522746280, "last_edit_date": 1613970149, "question_id": 49626131, "link": "https://stackoverflow.com/questions/49626131/haskell-using-state-with-alternative", "title": "Haskell - Using State with Alternative", "body": "<p>I have a datatype that looks like the following:</p>\n\n<pre><code>type Parser a = ExceptT ParseError (State [Token]) a\n</code></pre>\n\n<p>As well as state manipulation functions:</p>\n\n<pre><code>consumeToken :: Parser Token\nconsumeToken = do\n    toks &lt;- lift get\n    if null toks \n        then throwE OutOfTokensError\n        else \n            do\n                lift $ put (tail toks)\n                return $ head toks\n\npeekToken :: Parser Token\npeekToken = do\n    toks &lt;- lift get\n    if null toks \n        then throwE OutOfTokensError\n        else \n            do\n                return $ head toks\n</code></pre>\n\n<p>I'm trying to use these functions to help validate production rules in a grammar:</p>\n\n<pre><code>charList :: Parser CharList\ncharList =\n    (return CharListCharacter &lt;*&gt; isToken (Character \"&lt;char&gt;\") &lt;*&gt; charList)\n    &lt;|&gt; (return CharListSpace &lt;*&gt; isToken (Space \" \") &lt;*&gt; charList)\n    &lt;|&gt; (return EmptyCharList)\n</code></pre>\n\n<p>It seems that <code>isToken</code> needs to consume the current token (using <code>consumeToken</code>) so that the recursive calls to <code>charList</code> then deal with the following token. However, doing so means that the alternative cases will not start from the same token as the first case.</p>\n\n<p>Is there a standard way to deal with this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1522747677, "post_id": 49624960, "comment_id": 86260067, "body": "Note: \u201cInputs: <code>Int -&gt; [Int]</code>, Outputs: <code>[[Int]]</code>\u201d suggests the function is supposed to have signature <code>(Int -&gt; [Int]) -&gt; [[Int]]</code>, which is very different from <code>Int -&gt; [Int] -&gt; [[Int]]</code>. The latter is actually parsed as <code>Int -&gt; ([Int] -&gt; [[Int]])</code>, which <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">uncurries</a> to <code>(Int, [Int]) -&gt; [[Int]]</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522756020, "post_id": 49624960, "comment_id": 86265235, "body": "Yes but since i defined no external method i just placed the initial parameters and the final result."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522756110, "post_id": 49624960, "comment_id": 86265293, "body": "But <i>did you</i>? The initial parameters have types <code>Int</code> and <code>[Int]</code>. None of them has the function type <code>Int -&gt; [Int]</code>. This kind of distinction is important."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522756630, "post_id": 49624960, "comment_id": 86265623, "body": "Well i do not have to specifiy the type of a function defined inside a where clause or a let am i right?It&#39;s an auxiliary method."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522757007, "post_id": 49624960, "comment_id": 86265880, "body": "No, you don&#39;t need to specify local types, but you should always have a clear idea what type you want."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522770363, "post_id": 49624960, "comment_id": 86275695, "body": "You should omit types when you are very confident about what they are, they would not provide any significant code documentation, and you think you could easily write them -- but it would be a waste of time/effort. Instead, when the type is not very clear, even in a <code>where</code> clause, I would recommend to write explicit type annotations. Usually, an approach such as &quot;I don&#39;t understand this, so I&#39;ll omit it, and hope for the best&quot; is not very successful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1572812934, "post_id": 49624960, "comment_id": 103667949, "body": "@chi, following that advice often requires <code>ScopedTypeVariables</code> in polymorphic functions."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 4, "last_activity_date": 1522743309, "creation_date": 1522743309, "answer_id": 49625294, "question_id": 49624960, "link": "https://stackoverflow.com/questions/49624960/how-is-map-implemented-internally/49625294#49625294", "title": "How is map implemented internally?", "body": "<p>There are two issues, that prevent your code from compiling:</p>\n\n<ol>\n<li><p><code>null</code> function has the type <code>[a0] -&gt; Bool</code>, but you're applying it\n    on an element of a list, hence you're expecting it to be <code>Int -&gt; Bool</code></p></li>\n<li><p>The result <code>f x</code> shouldn't be pushed into the tail of the input, it\nshould be pushed into the result of recursive call of the function:\n<code>f x: (mymap f xs)</code> instead of <code>f x: xs</code></p></li>\n</ol>\n\n<p>As a result the following code should work:</p>\n\n<pre><code>mymap :: (Int -&gt; [Int]) -&gt; [Int]-&gt; [[Int]]\nmymap f (x:xs) = if null xs then [] else f x : (mymap f xs)\n</code></pre>\n\n<p>By the way, the Standard Library provides much readable (and also polymorphic) <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/src/GHC.Base.html#map\" rel=\"nofollow noreferrer\">implementation</a> using pattern-matching:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap _ []     = []\nmap f (x:xs) = f x : map f xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522746582, "post_id": 49626094, "comment_id": 86259382, "body": "I thought that you can implement map without cons-ing on the list.I thought you could somehow replace all elements of a list with something else."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1522747055, "post_id": 49626094, "comment_id": 86259681, "body": "No, under the hood <code>map</code> definitely needs to deconstruct its input using the <code>:</code> pattern constructor and reconstruct its result using the <code>:</code> value constructor (operator). Once you have enough useful higher-order functions like <code>map</code> and <code>replicate</code>, you can leverage them to avoid writing <b>explicit</b> cons-ing, but they still occur under the hood."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522747236, "post_id": 49626094, "comment_id": 86259795, "body": "This was the holy-grail explanation i was looking for :D Thank you sir.I thought you can just   [(insert here),(insert here),(insert here)]"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522748670, "post_id": 49626094, "comment_id": 86260694, "body": "You can only do so for lists of a fixed length."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1522758922, "post_id": 49626094, "comment_id": 86267230, "body": "@BercoviciAdrian Even <code>[foo, bar, baz]</code> is just a pretty syntax for calls to <code>:</code>; specifically, <code>foo:bar:baz:[]</code>."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 3, "last_activity_date": 1522747340, "last_edit_date": 1522747340, "creation_date": 1522746150, "answer_id": 49626094, "question_id": 49624960, "link": "https://stackoverflow.com/questions/49624960/how-is-map-implemented-internally/49626094#49626094", "title": "How is map implemented internally?", "body": "<blockquote>\n  <p>custom map that receives a replication factor and a target list</p>\n</blockquote>\n\n<p>It is a little unclear to me what you're asking for.</p>\n\n<p>Does <code>mymap</code> receive the replication factor, or does <code>f</code>?</p>\n\n<blockquote>\n  <p>E.g.: <code>2 [1,2]    -----&gt; [[1,1],[2,2]]</code></p>\n</blockquote>\n\n<p>If you want <code>mymap 2 [1,2]</code> to give <code>[[1,1],[2,2]]</code>, then:</p>\n\n<pre><code>mymap :: Int -&gt; [a] -&gt; [[a]]\nmymap = map . replicate\n</code></pre>\n\n<p>However,</p>\n\n<blockquote>\n<pre><code>mymap :: (Int -&gt; [Int]) -&gt; [Int] -&gt; [[Int]]\n</code></pre>\n</blockquote>\n\n<p>How is this function any different from the built-in <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> with <code>a</code> as <code>Int</code> and <code>b</code> as <code>[Int]</code>? Here, <code>mymap</code> does not have any <code>Int</code> argument itself, so you must mean that <code>f</code>'s argument is the replication factor; but if <code>f 2 3 == [3,3]</code>, then <code>f</code> <em>is</em> <code>replicate</code> and you can use the solution above.</p>\n\n<p>You can write this using your own recursive definitions, if you like:</p>\n\n<pre><code>mymap :: Int -&gt; [a] -&gt; [[a]]\nmymap _ [] = []\nmymap n (x:xs) = myreplicate n x : mymap n xs\n\nmyreplicate :: Int -&gt; a -&gt; [a]\nmyreplicate 0 _ = []\nmyreplicate n x = x : myreplicate (n-1) x\n</code></pre>\n\n<p>Or you can use list comprehension instead of a <code>map</code>:</p>\n\n<pre><code>mymap :: Int -&gt; [a] -&gt; [[a]]\nmymap n xs = [ replicate n x | x &lt;- xs ]\n</code></pre>\n\n<p>I'd probably call <code>mymap</code> for <code>replicateMany</code> or something like that.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1427, "favorite_count": 0, "accepted_answer_id": 49626094, "answer_count": 2, "score": 1, "last_activity_date": 1572744842, "creation_date": 1522742049, "last_edit_date": 1522746796, "question_id": 49624960, "link": "https://stackoverflow.com/questions/49624960/how-is-map-implemented-internally", "title": "How is map implemented internally?", "body": "<p>Ok so i want to implement my custom map that receives a replication factor and a target list.</p>\n\n<p>Inputs:  <code>Int -&gt; [Int]</code><br>\nOutput: <code>[[Int]]</code><br>\nE.g.:  <code>2 [1,2]    -----&gt; [[1,1],[2,2]]</code><br></p>\n\n<p><code>f [1,2,3]</code> -> map -> <code>[f(1),f(2),f(3)]</code></p>\n\n<p>What is supposed to happen with f(1) when map goes to the next element of the list?How should  i replace 1 with f(1) ? </p>\n\n<p>P.S: This was my initial solution but it does replicate the initial list,not every element.</p>\n\n<pre><code>replicate::Int-&gt;[Int]-&gt;[[Int]]\nreplicate 1 x=x\nreplicate factor (x:xs)= go factor [] (x:xs) where\n                         go factor ls (x:xs) =go factor (repl factor x):ls xs \n                         repl 1 nr=nr\n                         repl times nr=nr:repl (times-1) nr\n</code></pre>\n"}, {"tags": ["haskell", "profiling", "ghc"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1522738921, "post_id": 49623481, "comment_id": 86255071, "body": "I believe there is a GHC API for runtime information, look at the ekg package for a server that exposes this. I do not know if debug capabilities are exposed as well - the only experience debugging haskell code I have is using GHCi. Although I have to say I usually do not need elaborate debugging, Debug.Trace and referential transparency are sufficient."}], "answers": [{"comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1522760306, "post_id": 49628328, "comment_id": 86268251, "body": "Well, I do not need debugging, it just happens that in the JVM the interface for retrieving the debugging and profiling are conflated (somehow, IIRC). Thanks, I am aware of ekg but did not investigate that feature."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1522752948, "creation_date": 1522752948, "answer_id": 49628328, "question_id": 49623481, "link": "https://stackoverflow.com/questions/49623481/is-there-a-way-to-get-ghc-profiling-information-exposed-through-a-server-socket/49628328#49628328", "title": "Is there a way to get GHC profiling information exposed through a server socket?", "body": "<p>Well, first of all, note that the JVM is a <em>virtual machine</em> interpreting Java bytecodes, whereas GHC compiles to native machine code.</p>\n\n<p>Having said that, I'm not sure you can do much for <em>debugging</em>, but I think you can do something about <em>profiling</em>.</p>\n\n<p>There's Threadscrope, of course, but it seems to only support post mortem analysis. I was <em>sure</em> I read somewhere that GHC's new event log system can be used for realtime analysis... but I can't find any details.</p>\n\n<p>The best result I can find is the <code>ekg</code> package. It appears to use GHC's internal statistics gathering system and expose this over HTTP. Look it up on Hackage.</p>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 49628328, "answer_count": 1, "score": 1, "last_activity_date": 1522752948, "creation_date": 1522736507, "question_id": 49623481, "link": "https://stackoverflow.com/questions/49623481/is-there-a-way-to-get-ghc-profiling-information-exposed-through-a-server-socket", "title": "Is there a way to get GHC profiling information exposed through a server socket?", "body": "<p>It is commonplace in the JVM world to use remote debugging capabilities of the JVM to get runntime tracing and profiling information: The JVM exposes a port to which a client can connect and be fed information from the runtime. </p>\n\n<p>Is there a way to accomplish this in recent GHC?</p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 2, "creation_date": 1522738492, "post_id": 49623416, "comment_id": 86254844, "body": "<code>p [x] = putStr x</code> is wrong. <code>x</code> is a char, not string. <code>putStr x ++ p xs</code> is wrong, you can&#39;t add 2 <code>IO()</code>. Use <code>putChar x &gt;&gt; p xs</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1522739028, "post_id": 49623416, "comment_id": 86255145, "body": "Also you are missing the case of empty lists"}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1522760135, "post_id": 49624776, "comment_id": 86268113, "body": "That <code>do</code> notation would desugar with <code>(&gt;&gt;)</code>, not bind."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 3, "last_activity_date": 1522771013, "last_edit_date": 1522771013, "creation_date": 1522741337, "answer_id": 49624776, "question_id": 49623416, "link": "https://stackoverflow.com/questions/49623416/putstr-inside-io-function/49624776#49624776", "title": "putStr inside IO () function", "body": "<p>Your first problem is with typing</p>\n\n<pre><code>p [x] = putStr x\n{- putStr :: String -&gt; IO ()\n   x      :: Char, not a String\n-}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>q (x:xs) = putStr x ++ p xs\n{- (++)     :: [a] -&gt; [a] -&gt; [a]\n   putStr x :: IO (), not a list of anything.\n-}\n</code></pre>\n\n<hr>\n\n<p>Let's look at <code>q</code> first, since it follows from <code>p</code>. You're breaking it down into characters, so you should use <code>putChar</code> rather than <code>putStr</code></p>\n\n<p>Also we're looking at sequencing actions, so we should either use <code>(&gt;&gt;)</code> or <code>(&gt;&gt;=)</code> depending on whether or not you need the result. In this case the result is a value of the unit type (<code>()</code>) which is a useless result and safe to ignore.</p>\n\n<pre><code>q :: String -&gt; IO ()\nq (x:xs) = putChar x &gt;&gt; p xs\n{- or using `do` notation:\n     q (x:xs) = do\n       putChar x\n       p xs\n-}\n</code></pre>\n\n<p><code>p</code> can be changed likewise to use <code>putChar</code> rather than <code>putStr</code></p>\n\n<pre><code>p :: String -&gt; IO ()\np [x] = putChar x\np xs  = q xs\n</code></pre>\n\n<p>though be aware that you haven't matched an empty list on either <code>p</code> or <code>q</code>.</p>\n\n<hr>\n\n<p>About this time you should notice that substituting <code>putChar</code> for <code>putStr</code> just so you can break strings down to Chars is kind of backward thinking. <code>p = putStr</code> and you're done. However, if you're committed to this backward thinking:</p>\n\n<pre><code>import Control.Monad (foldM_, mapM_)\n\np = foldM_ (\\_ x -&gt; putChar x) ()\n-- or\np = foldM_ ((putChar .) . flip const) ()\n-- or\np = mapM_ putChar\n</code></pre>\n"}], "owner": {"reputation": 1278, "user_id": 1374078, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a96abe3865e9d233197150b1ae83743a?s=128&d=identicon&r=PG", "display_name": "phoxd", "link": "https://stackoverflow.com/users/1374078/phoxd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 49624776, "answer_count": 1, "score": 0, "last_activity_date": 1522771013, "creation_date": 1522736140, "question_id": 49623416, "link": "https://stackoverflow.com/questions/49623416/putstr-inside-io-function", "title": "putStr inside IO () function", "body": "<p>How to call IO () function inside another IO () function? I want to print to standard output then call function to do the same.</p>\n\n<p>For example,</p>\n\n<pre><code>p :: String -&gt; IO ()\np [x] = putStr x\np xs = q xs\n\nq :: String -&gt; IO ()\nq (x:xs) = putStr x ++ p xs\n</code></pre>\n"}, {"tags": ["haskell", "telnet"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1522733557, "post_id": 49622821, "comment_id": 86252662, "body": "Are you running the server in ghci?"}, {"owner": {"reputation": 1484, "user_id": 5736950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3034310faf5b872a334bf2cc55dbc71a?s=128&d=identicon&r=PG&f=1", "display_name": "Himanshu Bansal", "link": "https://stackoverflow.com/users/5736950/himanshu-bansal"}, "edited": false, "score": 0, "creation_date": 1522733719, "post_id": 49622821, "comment_id": 86252733, "body": "i have no idea about haskell but.. maybe you are running command with &#39;$&#39; .. have you tried without &#39;$&#39; sign?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1522746229, "post_id": 49622821, "comment_id": 86259205, "body": "Are you entering <code>$ telnet localhost 4242</code> in a Haskell source file or GHCi? You\u2019re supposed to run the program <code>telnet</code> <i>outside</i> of Haskell, in a terminal/command-line. <code>$</code> is a placeholder for the command prompt, so you\u2019d just enter <code>telnet localhost 4242</code>. (This also assumes you have a telnet client installed on your machine and it\u2019s available in your <code>PATH</code>.)"}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1522750160, "post_id": 49622821, "comment_id": 86261733, "body": "As a small correction, <code>telnet</code> should probably not be used (<code>nc</code> is probably better), since <code>telnet</code> is not just sending your text. It can also send Telnet control codes, and your server won&#39;t know how to handle them."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 1, "last_activity_date": 1522747252, "creation_date": 1522747252, "answer_id": 49626452, "question_id": 49622821, "link": "https://stackoverflow.com/questions/49622821/haskell-chat-server/49626452#49626452", "title": "Haskell chat server", "body": "<p>The last line that tells you to test your code uses a common convention for shell scripts - the command is preceded with <code>$</code>, which is a default prompt character in a lot of places.</p>\n\n<p><code>telnet</code> is a system command which you should run directly from your OS shell, and not from the GHCi interpreter. And you're not supposed to include the <code>$</code> in the command itself.</p>\n"}], "owner": {"reputation": 19, "user_id": 9589242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab0b82853c3e3b5796df19717f01da54?s=128&d=identicon&r=PG&f=1", "display_name": "user9589242", "link": "https://stackoverflow.com/users/9589242/user9589242"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1522804239, "creation_date": 1522733218, "last_edit_date": 1522804239, "question_id": 49622821, "link": "https://stackoverflow.com/questions/49622821/haskell-chat-server", "title": "Haskell chat server", "body": "<p>I am trying to use the chat server code from wiki  <br>\n<a href=\"https://wiki.haskell.org/Implement_a_chat_server\" rel=\"nofollow noreferrer\" title=\"Implement a chat server - HaskellWiki\">Implement a chat server - HaskellWiki</a><br>\nto connect to telenet with \n<code>$ telnet localhost 4242</code>\n as explained at the bottom of the site but I'm getting an error </p>\n\n<pre><code> &lt;interactive&gt;:1:1: error:\n     parse error on input `$' Perhaps you intended to use TemplateHaskell\n</code></pre>\n\n<p>please let me know exactly what I'm doing wrong if you understand the error \nThank You</p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "answers": [{"comments": [{"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1522714452, "post_id": 49620413, "comment_id": 86247791, "body": "From the discussion on IRC, what do you think of using unexpected: <a href=\"https://hackage.haskell.org/package/parsers-0.12.8/docs/Text-Parser-Combinators.html#v:unexpected\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/parsers-0.12.8/docs/&hellip;</a> ?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1522713986, "creation_date": 1522713986, "answer_id": 49620413, "question_id": 49620356, "link": "https://stackoverflow.com/questions/49620356/avoiding-usage-of-fail-in-parsers-from-parsers-library/49620413#49620413", "title": "Avoiding usage of fail in parsers from Parsers library", "body": "<p>As the documentation tells you, a new <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Control-Monad-Fail.html\" rel=\"noreferrer\"><code>MonadFail</code></a> class is being introduced to fulfill that role.</p>\n\n<p>But, for stuff like parsers, the sensible choice is usually <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Control-Applicative.html#v:empty\" rel=\"noreferrer\"><code>empty</code></a>, which has been around for much longer.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1522765855, "creation_date": 1522765855, "answer_id": 49632639, "question_id": 49620356, "link": "https://stackoverflow.com/questions/49620356/avoiding-usage-of-fail-in-parsers-from-parsers-library/49632639#49632639", "title": "Avoiding usage of fail in parsers from Parsers library", "body": "<p>Parsec:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/src/Text.Parsec.Prim.html#unexpected\" rel=\"nofollow noreferrer\"><code>unexpected</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/src/Text.Parsec.Prim.html#parserFail\" rel=\"nofollow noreferrer\"><code>fail</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/src/Text.Parsec.Prim.html#parserZero\" rel=\"nofollow noreferrer\"><code>empty</code></a></li>\n</ul>\n\n<p>Trifecta:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/trifecta-1.7.1.1/docs/src/Text-Trifecta-Parser.html#line-201\" rel=\"nofollow noreferrer\"><code>unexpected</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/trifecta-1.7.1.1/docs/src/Text-Trifecta-Parser.html#line-178\" rel=\"nofollow noreferrer\"><code>fail</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/trifecta-1.7.1.1/docs/src/Text-Trifecta-Parser.html#line-119\" rel=\"nofollow noreferrer\"><code>empty</code></a></li>\n</ul>\n\n<p>The only difference is the error message they produce.</p>\n\n<ul>\n<li><p>Use <code>unexpected</code> on an unexpected token. <code>unexpected \"token\"</code> will result in an error message like <code>\"unexpected: 'token'\"</code>.</p></li>\n<li><p>Annotate parsers with the high-level constructs they represent using <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec.html#v:-60--63--62-\" rel=\"nofollow noreferrer\"><code>(&lt;?&gt;)</code></a>.</p>\n\n<blockquote>\n  <p>This is normally used at the end of a set alternatives where we want to return an error message in terms of a higher level construct rather than returning all possible characters.</p>\n</blockquote>\n\n<pre><code>parseExpr = ... &lt;?&gt; \"expression\"\nparseId = ... &lt;?&gt; \"identifier\"\nparseTy = ... &lt;?&gt; \"type\"\n</code></pre></li>\n<li><p><code>empty</code> doesn't produce any error message. It can still be useful to backtrack and let another branch succeed or take care of reporting a meaningful error.</p></li>\n<li><p>Use <code>fail</code> for other kinds of errors, libraries can't assume much about what goes into it so they'll probably treat its argument as a raw message.</p></li>\n</ul>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 49620413, "answer_count": 2, "score": 2, "last_activity_date": 1522765855, "creation_date": 1522713507, "question_id": 49620356, "link": "https://stackoverflow.com/questions/49620356/avoiding-usage-of-fail-in-parsers-from-parsers-library", "title": "Avoiding usage of fail in parsers from Parsers library", "body": "<p>From what I was told using <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Prelude.html#v:fail\" rel=\"nofollow noreferrer\">fail</a> is not recommended and it will later be removed.</p>\n\n<p>What should be properly used instead of fail in the following <a href=\"https://hackage.haskell.org/package/parsers\" rel=\"nofollow noreferrer\">Parsers/Trifecta</a> example?</p>\n\n<pre><code>parserNaturalNoLeadZero :: Parser Integer\nparserNaturalNoLeadZero = do\n  digits &lt;- some digit\n  if length digits &gt; 1 &amp;&amp; head digits == '0'\n    then fail \"Leading Zeros\"\n    else return $ read digits\n</code></pre>\n"}, {"tags": ["haskell", "type-families", "higher-kinded-types"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1522704400, "post_id": 49618667, "comment_id": 86245138, "body": "<code>instance (ToJSON (HKD f Int), ToJSON (HKD f String)) =&gt; ToJSON (Person f)</code>, no? (Requires <code>-XUndecidableInstances</code> of course, but those aren&#39;t too bad.)"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522704897, "post_id": 49618667, "comment_id": 86245323, "body": "@leftaroundabout This should be an answer :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1522705153, "post_id": 49618667, "comment_id": 86245414, "body": "<code>instance ToJSON (Person f)</code> would imply <code>ToJSON (Person [])</code> which would involve the type <code>HKD [] Int</code> which has no JSON serializer (arguably, this type should not exists -- but it does!). Hence, you can not define <code>instance ToJSON (Person f)</code> without any context."}, {"owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522705251, "post_id": 49618667, "comment_id": 86245454, "body": "@leftaroundabout Thanks for the idea! That does compile, but the solution doesn&#39;t scale when the data type in question contains a large number of fields."}, {"owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522705311, "post_id": 49618667, "comment_id": 86245478, "body": "@chi Note that <code>HKD</code> only supports <code>Identity</code> and <code>Maybe</code> as defined in this question. I do not believe that <code>HKD [] Int</code> is valid here (though it is in the original blog post)."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1522714933, "post_id": 49618667, "comment_id": 86247912, "body": "@MatthewPiziak It&#39;s perfectly valid. It&#39;s just <i>stuck</i>. <code>HKD Identity a</code> is not stuck and will reduce to <code>a</code>. <code>HKD [] a</code> is stuck (but valid) and simply doesn&#39;t reduce. You can even compute with it if you try hard enough, I think. Same for <code>Person []</code>. <a href=\"https://gelisam.blogspot.com/2017/11/computing-with-impossible-types.html\" rel=\"nofollow noreferrer\">See also</a>"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1522730464, "post_id": 49620701, "comment_id": 86251556, "body": "Oooh <code>QuantifiedConstraints</code> is being implemented, fun.  Thanks."}, {"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "edited": false, "score": 0, "creation_date": 1522772472, "post_id": 49620701, "comment_id": 86276965, "body": "Is there any way to refactor out <code>gcoerce @_ @(Person (Tc (Apply f)))</code> from the <code>ToJSON</code> instance to DRY up the code a bit? In other words, everything stays the same except <code>Person</code> so can it be replaced with some <code>t</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1522774437, "post_id": 49620701, "comment_id": 86278063, "body": "We can write <code>wrap :: (...) =&gt; p f -&gt; p (Tc (Apply f)) ; wrap = gcoerce</code> which should be sufficiently specialized to allow <code>toJSON = genericToJSON defaultOptions . wrap</code> without extra annotations."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 7, "last_activity_date": 1522725730, "last_edit_date": 1522725730, "creation_date": 1522716743, "answer_id": 49620701, "question_id": 49618667, "link": "https://stackoverflow.com/questions/49618667/deriving-instances-for-higher-kinded-data/49620701#49620701", "title": "Deriving instances for higher-kinded data", "body": "<p>The type family <code>HKD</code> needs to be applied to a known <code>Identity</code> or <code>Maybe</code> to reduce. Otherwise, <code>HKD f Int</code> with an unknown <code>f</code> is just stuck, and we cannot resolve <code>HKD f a</code> constraints for all field types <code>a</code>, except by listing them in the context, for example <code>(ToJSON (HKD f Int), ToJSON (HKD f String))</code>,  which is one possible solution but doesn't scale well to large numbers of fields.</p>\n\n<h1>Solution 1: Derive the context</h1>\n\n<p>The main problem is the tediousness of writing and maintaining the list of field constraints, this is solved by noting that it is really a function of the record type, and that we can define it in Haskell using GHC Generics.</p>\n\n<pre><code>type GToJSONFields a = GFields' ToJSON (Rep a)\n\n-- Every field satisfies constraint c\ntype family GFields' (c :: * -&gt; Constraint) (f :: * -&gt; *) :: Constraint\ntype instance GFields' c (M1 i d f) = GFields' c f\ntype instance GFields' c (f :+: g) = (GFields' c f, GFields' c g)\ntype instance GFields' c (f :*: g) = (GFields' c f, GFields' c g)\ntype instance GFields' c U1 = ()\ntype instance GFields' c (K1 i a) = c a\n\ninstance (GToJSONFields (Person f)) =&gt; ToJSON (Person f) where\n  toJSON = genericToJSON defaultOptions\n</code></pre>\n\n<p>However this instance is nonmodular and inefficient, because it still exposes the internal structure of the record (its field types), and constraints for every single field must be re-solved every time <code>ToJSON (Person f)</code> is used.</p>\n\n<p><a href=\"https://gist.github.com/Lysxia/67f8eca8b21d3cdb873b08ded24fdbfe\" rel=\"noreferrer\">Gist of solution 1</a></p>\n\n<h1>Solution 2: Generalize the context</h1>\n\n<p>What we really want to write as an instance is this</p>\n\n<pre><code>instance (forall a. ToJSON a =&gt; ToJSON (HKD f a)) =&gt; ToJSON (Person f) where\n  -- ...\n</code></pre>\n\n<p>which uses a quantified constraint, a new feature currently being implemented in GHC; hopefully the syntax is self-descriptive. But since it is not released yet, what can we do in the meantime?</p>\n\n<p>A quantified constraint is currently encodable using a type class.</p>\n\n<pre><code>class ToJSON_HKD f where\n  toJSON_HKD :: ToJSON a =&gt; f a -&gt; Value  -- AllowAmbiguousTypes, or wrap this in a newtype (which we will define next anyway)\n\ninstance ToJSON_HKD Identity where\n  toJSON_HKD = toJSON\n\ninstance ToJSON_HKD Maybe where\n  toJSON_HKD = toJSON\n</code></pre>\n\n<p>But <code>genericToJSON</code> would use <code>ToJSON</code> on the fields, not <code>ToJSON_HKD</code>. We can will wrap the fields in a <code>newtype</code> that dispatches <code>ToJSON</code> constraints with a <code>ToJSON_HKD</code> constraint.</p>\n\n<pre><code>newtype Apply f a = Apply (HKD f a)\n\ninstance ToJSON_HKD f =&gt; ToJSON (Apply f a) where\n  toJSON (Apply x) = toJSON_HKD @f @a x\n</code></pre>\n\n<p>The fields of <code>Person</code> can only be wrapped in <code>HKD Identity</code> or <code>HKD Maybe</code>. We should add one more case for <code>HKD</code>. In fact, let's make it open, and refactor the case for type constructors. We write <code>HKD (Tc Maybe) a</code> instead of <code>HKD Maybe a</code>; this is longer, but the <code>Tc</code> tag can be reused for any other type constructor, e.g., <code>HKD (Tc (Apply f)) a</code>.</p>\n\n<pre><code>-- Redefining HKD\ntype family HKD f a\ntype instance HKD Identity a = a\ntype instance HKD (Tc f) a = f a\n\ndata Tc (f :: * -&gt; *)  -- Type-level tag for type constructors\n</code></pre>\n\n<p><em>aeson</em> has a <code>ToJSON1</code> type class whose role is quite similar to <code>ToJSON_HKD</code>, as an encoding of <code>forall a. ToJSON a =&gt; ToJSON (f a)</code>. Serendipitously, <code>Tc</code> is just the right type to connect those classes.</p>\n\n<pre><code>instance ToJSON1 f =&gt; ToJSON_HKD (Tc f) where\n  toJSON1_HKD = toJSON1\n</code></pre>\n\n<p>The next step is the wrapper itself.</p>\n\n<pre><code>wrapApply :: Person f -&gt; Person (Tc (Apply f))\nwrapApply = gcoerce\n</code></pre>\n\n<p>All we are doing is wrapping the fields in a <code>newtype</code> (from <code>HKD f a</code> to <code>HKD (Tc (Apply f)) a</code>, which is equal to <code>Apply f a</code> and representationally equivalent to <code>HKD f a</code>). So this is really a coercion. Unfortunately, <code>coerce</code> will not typecheck here, as <code>Person f</code> has a nominal type parameter (because it uses <code>HKD</code>, which matches on the <em>name</em> <code>f</code> to reduce). However, <code>Person</code> is a <code>Generic</code> type, and the generic representations of the input and expected output of <code>wrapApply</code> are in fact coercible. This gives rise to the following \"generic coercion\", which makes <code>wrapApply</code> superfluous:</p>\n\n<pre><code>gcoerce :: forall a b\n        .  (Generic a, Generic b, Coercible (Rep a ()) (Rep b ()))\n        =&gt; a -&gt; b\ngcoerce = to . (coerce :: Rep a () -&gt; Rep b ()) . from\n</code></pre>\n\n<p>We conclude: wrap the fields in <code>Apply</code>, and use <code>genericToJSON</code>.</p>\n\n<pre><code>instance ToJSON_HKD f =&gt; ToJSON (Person f) where\n  toJSON = genericToJSON defaultOptions . gcoerce @_ @(Person (Tc (Apply f)))\n</code></pre>\n\n<p><a href=\"https://gist.github.com/Lysxia/791164a92b279222acc212f39f5e8d26\" rel=\"noreferrer\">Gist of solution 2</a>.</p>\n\n<p>Note about the gist: <code>HKD</code> got renamed to <code>(@@)</code>, a name borrowed from <a href=\"https://hackage.haskell.org/package/singletons-2.4.1/docs/Data-Singletons.html#t:-64--64-\" rel=\"noreferrer\"><em>singletons</em></a>, and <code>HKD Identity a</code> is rewritten as <code>HKD Id a</code>, making an explicit distinction between the type constructor <code>Identity</code>, and the defunctionalized symbol <code>Id</code> for the identity function. It looks neater to me.</p>\n\n<h1>Solution 3: Without type families</h1>\n\n<p>The HKD blog post combines two ideas:</p>\n\n<ol>\n<li><p>Parameterizing records over a type constructor <code>f</code> (also called <a href=\"https://www.benjamin.pizza/posts/2017-12-15-functor-functors.html\" rel=\"noreferrer\">\"functor functor pattern\"</a>);</p></li>\n<li><p>Generalizing <code>f</code> to be a type function, which is possible, even though Haskell doesn't have first-class functions at the type-level, thanks to <a href=\"https://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/\" rel=\"noreferrer\">the technique of <em>defunctionalization</em></a>.</p></li>\n</ol>\n\n<p>The main goal of the second idea is to be able to reuse the record <code>Person</code> with unwrapped fields. That seems like quite a cosmetic concern for the amount of complexity type families introduce.</p>\n\n<p>Looking closer, it could be argued that there is really not that much extra complexity. Is it worth it in the end? I don't have a good answer yet.</p>\n\n<p>Just for reference, here's the result of applying the techniques above to a simpler record without the <code>HKD</code> type family.</p>\n\n<pre><code>data Person f = Person\n  { name :: f String\n  , age :: f Int\n  }\n</code></pre>\n\n<p>We can remove two definitions: <code>ToJSON_HKD</code> (<code>ToJSON1</code> suffices), and <code>gcoerce</code> (<code>coerce</code> suffices). We replace <code>Apply</code> with this other newtype connecting <code>ToJSON</code> and <code>ToJSON1</code>:</p>\n\n<pre><code>newtype Apply' f a = Apply' (f a)  -- no HKD\n\ninstance (ToJSON1 f, ToJSON a) =&gt; ToJSON (Apply' f a) where\n  toJSON (Apply' x) = toJSON1 x\n</code></pre>\n\n<p>And we derive <code>ToJSON</code> as follows:</p>\n\n<pre><code>instance ToJSON1 f =&gt; ToJSON (Person f) where\n  toJSON = genericToJSON defaultOptions . coerce @_ @(Person (Apply' f))\n</code></pre>\n\n<hr>\n\n<h1>Caveat: Special field types</h1>\n\n<p><em>aeson</em> has an option to make <code>Maybe</code> fields optional, so they are allowed to be missing in the corresponding JSON object. Well, that option doesn't work with the methods described above. It only affects the fields are known to be <code>Maybe</code> in the definition of the instance, so that fails for solutions 2 and 3 because of the newtypes around all fields.</p>\n\n<p>Furthermore, for solution 1, this</p>\n\n<pre><code>instance {-# OVERLAPPING #-} ToJSON (Person Maybe) where\n  toJSON = genericToJSON defaultOptions{omitNothingFields=True}\n</code></pre>\n\n<p>would behave differently from specializing this other instance <em>after the fact</em> to <code>Person Maybe</code>:</p>\n\n<pre><code>instance ... =&gt; ToJSON (Person f) where\n  toJSON = genericToJSON defaultOptions{omitNothingFields=True}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 4793220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac8eb0c69bfb2f2748855c0b30414404?s=128&d=identicon&r=PG", "display_name": "Sandy Maguire", "link": "https://stackoverflow.com/users/4793220/sandy-maguire"}, "is_accepted": false, "score": 3, "last_activity_date": 1522719985, "creation_date": 1522719985, "answer_id": 49621044, "question_id": 49618667, "link": "https://stackoverflow.com/questions/49618667/deriving-instances-for-higher-kinded-data/49621044#49621044", "title": "Deriving instances for higher-kinded data", "body": "<p>author of the blog post here. Probably the easiest solution here is to just monomorphize your <code>f</code> parameter:</p>\n\n<pre><code>instance ToJSON (Person Identity) where\n  toJSON = genericToJSON defaultOptions\n\ninstance ToJSON (Person Maybe) where\n  toJSON = genericToJSON defaultOptions\n</code></pre>\n\n<p>It's kind of ugly, but certainly shippable. I'm in the lab currently trying to figure out better general solutions to this problem, and will let you know if I come up with anything.</p>\n"}], "owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 6, "answer_count": 2, "score": 7, "last_activity_date": 1522725730, "creation_date": 1522702539, "question_id": 49618667, "link": "https://stackoverflow.com/questions/49618667/deriving-instances-for-higher-kinded-data", "title": "Deriving instances for higher-kinded data", "body": "<p>This question is based on the higher-kinded-data pattern, described in <a href=\"http://reasonablypolymorphic.com//blog/higher-kinded-data\" rel=\"noreferrer\">this Reasonably Polymorphic blog post</a>.</p>\n\n<p>In the following block of code, I define a type family <code>HKD</code> and a data type <code>Person</code>, where the fields may be either <code>Maybe</code> or <code>Identity</code>.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TypeFamilies  #-}\n\nimport           Data.Aeson\n\n-- \"Higher Kinded Data\" (http://reasonablypolymorphic.com//blog/higher-kinded-data)\ntype family HKD f a where\n    HKD Identity a = a\n    HKD Maybe a = Maybe a\n\ndata Person f = Person\n  { pName :: HKD f String\n  , pAge  :: HKD f Int\n  } deriving (Generic)\n</code></pre>\n\n<p>I then attempt to derive a <code>ToJSON</code> instance for this type. </p>\n\n<pre><code>-- Already provided in imports:\n-- instance ToJSON String\n-- instance ToJSON Int\n-- instance ToJSON a =&gt; ToJSON (Maybe a)\n\ninstance ToJSON (Person f) where\n  toJSON = genericToJSON defaultOptions\n</code></pre>\n\n<p>Unfortunately I get the following error:</p>\n\n<blockquote>\n  <p>No instance for <code>(ToJSON (HKD f Int))</code> arising from a use of <code>genericToJSON</code>.</p>\n</blockquote>\n\n<p>Given that I already have <code>ToJSON Int</code> and <code>ToJSON (Maybe Int)</code>, shouldn't GHC be able to derive an instance <code>ToJSON (HKD f Int)</code>? My understanding is that type families act like type aliases with respect to instances. If that's the case, then I cannot define my own instances for it, but it should receive instances from its definions, in this case <code>Int</code> and <code>Maybe Int</code>. Unfortunately the error seems to contradict that.</p>\n\n<p>How can I define a <code>ToJSON</code> instance for my type?</p>\n"}, {"tags": ["arrays", "haskell", "functional-programming", "copy"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1522701826, "post_id": 49618460, "comment_id": 86244074, "body": "Sounds like you just need to <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><code>mapM_</code></a> an insertion action over your list <code>b</code>."}, {"owner": {"reputation": 151, "user_id": 3452637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9bde41ba3ee00b0230e661ccad4ee0d1?s=128&d=identicon&r=PG&f=1", "display_name": "gibarsin", "link": "https://stackoverflow.com/users/3452637/gibarsin"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1522702204, "post_id": 49618460, "comment_id": 86244237, "body": "Could you be more specific please? I&#39;m having a hard time trying to understand how to apply it, using an index."}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 3452637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9bde41ba3ee00b0230e661ccad4ee0d1?s=128&d=identicon&r=PG&f=1", "display_name": "gibarsin", "link": "https://stackoverflow.com/users/3452637/gibarsin"}, "edited": false, "score": 0, "creation_date": 1522702559, "post_id": 49618594, "comment_id": 86244387, "body": "You are my hero."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1522702201, "creation_date": 1522702201, "answer_id": 49618594, "question_id": 49618460, "link": "https://stackoverflow.com/questions/49618460/in-haskell-how-to-copy-immutable-array-into-a-mutable-array-from-a-specific-ind/49618594#49618594", "title": "In Haskell, how to copy immutable array into a mutable array from a specific index", "body": "<p>You can use <code>zipWithM_</code>:</p>\n\n<pre><code>copyAtPositionI mut imm i = zipWithM_ (writeArray mut) [i..] imm\n</code></pre>\n\n<p>If you didn't have it, you could implement it in a pretty straightforward way:</p>\n\n<pre><code>zipWithM_ f (x:xs) (y:ys) = f x y &gt;&gt; zipWithM_ f xs ys\nzipWithM_ f _ _ = return ()\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 3452637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9bde41ba3ee00b0230e661ccad4ee0d1?s=128&d=identicon&r=PG&f=1", "display_name": "gibarsin", "link": "https://stackoverflow.com/users/3452637/gibarsin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 1, "accepted_answer_id": 49618594, "answer_count": 1, "score": 1, "last_activity_date": 1522702201, "creation_date": 1522701559, "question_id": 49618460, "link": "https://stackoverflow.com/questions/49618460/in-haskell-how-to-copy-immutable-array-into-a-mutable-array-from-a-specific-ind", "title": "In Haskell, how to copy immutable array into a mutable array from a specific index", "body": "<p>I have two arrays of the following types:</p>\n\n<pre><code>a :: IOArray Word16 Word16\nb :: [Word16]\n</code></pre>\n\n<p>and I want a function <strong>copyAtPositionI</strong> that copies all the elements of array <strong>b</strong> into array <strong>a</strong> beginning at the ith index of array <strong>a</strong>. It can be assumed that the index will not be such that it attempts to copy elements out of the bounds of the array <strong>a</strong>.</p>\n\n<p>The function should be of the following type:</p>\n\n<pre><code>copyAtPositionI :: IOArray Word16 Word16 -&gt; [Word16] -&gt; Word16 -&gt; IO ()\n</code></pre>\n\n<p>For example (this is not Haskell),</p>\n\n<pre><code>a = [1, 2, 3, 4, 5, 6, 7, 8, 9]\nb = [10, 11, 12, 13]\n</code></pre>\n\n<p><strong>copyAtPositionI a b 3</strong> should result in <strong>a</strong> being equal to <strong>[1, 2, 3, 10, 11, 12, 13, 8, 9]</strong></p>\n\n<p>I did not find any functions in the Data.Array.IO package that does exactly what I want. I only found the function <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-MArray.html#v:writeArray\" rel=\"nofollow noreferrer\">writeArray</a> in the <strong>Data.Array.MArray</strong> package but I do not know how to execute the function for every element in the array <strong>b</strong>.</p>\n"}, {"tags": ["list", "haskell", "integer"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1522700386, "post_id": 49618128, "comment_id": 86243448, "body": "It is not entirely clear how you will map <code>[([Integer], [Integer])]</code> to <code>[(Integer, Integer)]</code>. The 2-tuple can contain two lists with different size... So concatenating is not a straightforward conversion."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1522700972, "post_id": 49618128, "comment_id": 86243702, "body": "There are lots of ways to implement a function with this type signature. You&#39;re going to have to provide some sample inputs with the intended output for each. (This isn&#39;t like, for example, <code>fmap :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> that only has one possible implementation that obeys the functor laws.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522701766, "post_id": 49618128, "comment_id": 86244047, "body": "Perhaps you are looking for <code>alterList = fmap (bimap f f)</code>, where <code>f</code> is some function of type <code>[Integer] -&gt; Integer</code>. <code>bimap</code> (from <code>Data.Bifunctor</code>) would apply <code>f</code> to each list in a tuple, and <code>fmap</code> would apply <code>bimap f f</code> to each tuple in the output list."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522702109, "post_id": 49618128, "comment_id": 86244186, "body": "Assuming you want <code>[(1,3),(2,4),(4,6),(4,7),(5,8)]</code> when the input is <code>[([1,2],[3,4]), ([4,4,5],[6,7,8])]</code> then the function you&#39;re looking for is <code>alterList = concatMap (\\(l1,l2) -&gt; zip l1 l2)</code>. But well, we cannot guess what you want, as said in the above comments."}, {"owner": {"reputation": 104, "user_id": 4782303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZ0OM.jpg?s=128&g=1", "display_name": "Prototype", "link": "https://stackoverflow.com/users/4782303/prototype"}, "edited": false, "score": 0, "creation_date": 1522702955, "post_id": 49618128, "comment_id": 86244540, "body": "I have two list like [([1,2,3,4],[5,6,7,8])] and want it like [(1,5)(2,6)(3,7)(4,8)]"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522703327, "post_id": 49618128, "comment_id": 86244684, "body": "<code>[([1,2,3,4],[5,6,7,8])] </code> is <i>one</i> list. It contains the unique element <code>([1,2,3,4],[5,6,7,8])</code>, which is a pair of two lists. The brackets (<code>[]</code>) are useless if you only have a pair of two lists. Not clear yet..."}, {"owner": {"reputation": 104, "user_id": 4782303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZ0OM.jpg?s=128&g=1", "display_name": "Prototype", "link": "https://stackoverflow.com/users/4782303/prototype"}, "edited": false, "score": 0, "creation_date": 1522703552, "post_id": 49618128, "comment_id": 86244787, "body": "Ouf, my bad, those outher brackets should not be there, ([1,2,3,4],[5,6,7,8]) is more correct"}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 4, "last_activity_date": 1522704194, "last_edit_date": 1522704194, "creation_date": 1522703813, "answer_id": 49618949, "question_id": 49618128, "link": "https://stackoverflow.com/questions/49618128/convert-list-haskell/49618949#49618949", "title": "Convert list haskell", "body": "<p>So after you've corrected your post, I think you want</p>\n\n<pre><code>alterList :: ([Integer],[Integer]) -&gt; [(Integer,Integer)]\nalterList (l1, l2) = zip l1 l2\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>&gt;&gt;&gt; alterList ([1,2,3,4],[5,6,7,9])\n[(1,5),(2,6),(3,7),(4,9)]\n</code></pre>\n\n<p>This is equivalent to</p>\n\n<pre><code>alterList' :: ([Integer],[Integer]) -&gt; [(Integer,Integer)]\nalterList' = uncurry zip\n</code></pre>\n\n<p>Note that this function works even if the two lists have not the same size: in this case it acts as if the longest list were truncated to the length of the shortest one.</p>\n"}], "owner": {"reputation": 104, "user_id": 4782303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZ0OM.jpg?s=128&g=1", "display_name": "Prototype", "link": "https://stackoverflow.com/users/4782303/prototype"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 49618949, "answer_count": 1, "score": 0, "last_activity_date": 1522704194, "creation_date": 1522699896, "last_edit_date": 1522703457, "question_id": 49618128, "link": "https://stackoverflow.com/questions/49618128/convert-list-haskell", "title": "Convert list haskell", "body": "<p>I have this list ([Integer],[Integer])\nwhich I want to convert into [(Integer,Integer)].</p>\n\n<p>From which ive read I should use high order functions like map.</p>\n\n<pre><code>alterList :: ([Integer],[Integer]) -&gt; [(Integer,Integer)]\nalterList a = map(\\a -&gt; .....?)\n</code></pre>\n\n<p>Any guidelines? Both list is of same size</p>\n\n<p>Like I have two lists ([1,2,3,4],[5,6,7,9]) wich i want to convert to [(1,5),(2,6),(3,7),(4,8)]</p>\n"}, {"tags": ["haskell", "autocomplete"], "answers": [{"comments": [{"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1522779649, "post_id": 49618513, "comment_id": 86281055, "body": "If I replace <code>return . searchFunc</code> with <code>return . (\\str -&gt; do _data &lt;- get; searchFunc _data str)</code>, I get <code>No instance for (MonadState MyDataState [])       arising from a use of \u2018get\u2019     In a stmt of a &#39;do&#39; block: _data &lt;- get</code> and don&#39;t know how to fix it."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1522788769, "post_id": 49618513, "comment_id": 86285548, "body": "Remove the leading <code>return .</code>. I amended my post to show what the code should look like."}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1522867764, "post_id": 49618513, "comment_id": 86325842, "body": "The error I get if I do as you described is following: <code>Couldn&#39;t match type \u2018[]\u2019 with \u2018StateT MyDataState IO\u2019     Expected type: CompletionFunc (StateT MyDataState IO)       Actual type: CompletionFunc []     In the \u2018complete\u2019 field of a record;  Couldn&#39;t match type \u2018Completion\u2019 with \u2018[Completion]\u2019     Expected type: [[Completion]]       Actual type: [Completion]     In a stmt of a &#39;do&#39; block: searchFunc _data str</code>"}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1522873498, "post_id": 49618513, "comment_id": 86329123, "body": "Here is my code in online IDE that you can tweak and run: <a href=\"https://ideone.com/Zr4pK1\" rel=\"nofollow noreferrer\">ideone.com/Zr4pK1</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1522875135, "post_id": 49618513, "comment_id": 86329990, "body": "Oh sorry, <code>completeWord</code> expects an argument of type <code>(String -&gt; m [Completion])</code>, so the result of <code>searchFunc</code> needs to be <code>return</code>-ed: <code>return (searchFunc _data str)</code>."}, {"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1523701190, "post_id": 49618513, "comment_id": 86675833, "body": "I have a similar question in a separate thread: <a href=\"https://stackoverflow.com/questions/49823709/command-line-autocompletion-based-on-context\" title=\"command line autocompletion based on context\">stackoverflow.com/questions/49823709/&hellip;</a> maybe you could help on that too, I would be grateful if you could take a look."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1522875145, "last_edit_date": 1522875145, "creation_date": 1522701797, "answer_id": 49618513, "question_id": 49617675, "link": "https://stackoverflow.com/questions/49617675/extending-the-list-of-static-autocompletion-commands-with-dynamic-values/49618513#49618513", "title": "Extending the list of static autocompletion commands with dynamic values", "body": "<p>In the <code>Settings</code> record, the field <code>complete</code> has type <code>CompletionFunc (StateT MyDataState IO)</code>, implying that we have access to the state for autocompletion.</p>\n\n<p>Currently the definition of <code>mySettings</code> uses</p>\n\n<pre><code>complete = completeWord Nothing \" \\t\" $ return . searchFunc\n</code></pre>\n\n<p>This <code>return</code> wraps a pure function, which thus ignores the stateful context. We can replace that with a computation accessing the state:</p>\n\n<pre><code>complete = completeWord Nothing \" \\t\" $ \\str -&gt; do\n  _data &lt;- get\n  return (searchFunc _data str)\n</code></pre>\n\n<p>also changing the type of <code>searchFunc</code> for example to:</p>\n\n<pre><code>searchFunc :: MyDataState -&gt; String -&gt; [Completion]\n</code></pre>\n"}], "owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 49618513, "answer_count": 1, "score": 1, "last_activity_date": 1522875145, "creation_date": 1522697850, "question_id": 49617675, "link": "https://stackoverflow.com/questions/49617675/extending-the-list-of-static-autocompletion-commands-with-dynamic-values", "title": "Extending the list of static autocompletion commands with dynamic values", "body": "<p>I have following program in Haskell that takes input from command line and modifies state of <code>mydata</code> variable: </p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses, UndecidableInstances #-}\n\nimport Text.Regex.PCRE\nimport System.Console.Haskeline\nimport System.IO\nimport System.IO.Unsafe\nimport Control.Monad.State.Strict\nimport qualified Data.ByteString.Char8 as B\nimport Data.Maybe\nimport Data.List \nimport qualified Data.Map as M\n\ndata MyDataState = MyDataState {\n  mydata :: [Int],\n  showEven :: Bool\n} deriving (Show)\n\nmyfile :: FilePath\nmyfile = \"data.txt\"\n\ndefaultFlagValue :: Bool\ndefaultFlagValue = False\n\nsaveDataToFile :: [Int] -&gt; IO ()\nsaveDataToFile _data = withFile myfile WriteMode $ \\h -&gt; hPutStr h (unwords $ map show _data)\n\n{-# NOINLINE loadDataFromFile #-} \nloadDataFromFile :: [Int]\nloadDataFromFile = map read . words $ B.unpack $ unsafePerformIO $ B.readFile myfile\n\nwordList = [\":help\", \":q\", \":commands\", \":show\", \":save\", \":edit\", \":new\", \":toggleShowEven\"]\n\nsearchFunc :: String -&gt; [Completion]\nsearchFunc str = map simpleCompletion $ filter (str `isPrefixOf`) (wordList)\n\nmySettings :: Settings (StateT MyDataState IO)\nmySettings = Settings { historyFile = Just \"myhist\"\n                      , complete = completeWord Nothing \" \\t\" $ return . searchFunc\n                      , autoAddHistory = True\n                      }\n\nhelp :: InputT (StateT MyDataState IO) ()\nhelp = liftIO $ mapM_ putStrLn\n       [ \"\"\n       , \":help     - this help\"\n       , \":q        - quit\"\n       , \":commands - list available commands\"\n       , \"\"\n       ]\n\ncommands :: InputT (StateT MyDataState IO) ()\ncommands = liftIO $ mapM_ putStrLn\n       [ \"\"\n       , \":show           - display data\"\n       , \":save           - save results to file\"\n       , \":edit           - edit data\"\n       , \":new            - generate new element \"\n       , \":toggleShowEven - toggle display of even elements\"\n       , \"\"\n       ]\n\ntoggleFlag :: InputT (StateT MyDataState IO) ()\ntoggleFlag = do\n  MyDataState mydata flag &lt;- get\n  put $ MyDataState mydata (not flag)\n\ninstance MonadState s m =&gt; MonadState s (InputT m) where\n    get = lift get\n    put = lift . put\n    state = lift . state\n\nparseInput :: String -&gt; InputT (StateT MyDataState IO) () \nparseInput inp\n  | inp =~ \"^\\\\:q\"        = return ()\n\n  | inp =~ \"^\\\\:he\"       = help &gt;&gt; mainLoop\n\n  | inp =~ \"^\\\\:commands\" = commands &gt;&gt; mainLoop\n\n  | inp =~ \"^\\\\:toggleShowEven\" = toggleFlag &gt;&gt; mainLoop\n\n  | inp =~ \"^\\\\:show\" = do\n      MyDataState mydata showEven &lt;- get\n      liftIO $ putStrLn $ unwords $ if showEven \n        then map show mydata\n        else map show $ filter odd mydata\n      mainLoop \n\n  | inp =~ \"^\\\\:save\" = do\n      MyDataState mydata _ &lt;- get \n      liftIO $ saveDataToFile mydata\n      mainLoop\n\n  | inp =~ \"^\\\\:load\" = do\n      put (MyDataState loadDataFromFile defaultFlagValue)\n      mainLoop\n\n  | inp =~ \"^\\\\:new\" = do\n      MyDataState mydata showEven &lt;- get                     -- reads the state\n      inputData &lt;- getInputLine \"\\tEnter data: \"\n      case inputData of \n        Nothing -&gt; put ( MyDataState [0] showEven )\n        Just inputD -&gt; \n          put $ if null mydata \n            then MyDataState [read inputD] showEven\n            else MyDataState (mydata ++ [read inputD]) showEven -- updates the state\n      mainLoop\n\n  | inp =~ \":\" = do\n    outputStrLn $ \"\\nNo command \\\"\" ++ inp ++ \"\\\"\\n\"\n    mainLoop\n\n  | otherwise = handleInput inp\n\nhandleInput :: String -&gt; InputT (StateT MyDataState IO) ()\nhandleInput inp = mainLoop\n\nmainLoop :: InputT (StateT MyDataState IO ) ()\nmainLoop = do\n  inp &lt;- getInputLine \"% \"\n  maybe (return ()) parseInput inp\n\ngreet :: IO ()\ngreet = mapM_ putStrLn\n        [ \"\"\n        , \"          MyProgram\"\n        , \"==============================\"\n        , \"For help type \\\":help\\\"\"\n        , \"\"\n        ]\n\nmain :: IO ((), MyDataState)\nmain = do \n    greet \n    runStateT (runInputT mySettings mainLoop) MyDataState {mydata = [] , showEven = defaultFlagValue}\n</code></pre>\n\n<p>Example of interaction with the program above:</p>\n\n<pre><code>*Main&gt; main\n\n          MyProgram\n==============================\nFor help type \":help\"\n\n% :commands \n\n:show           - display data\n:save           - save results to file\n:edit           - edit data\n:new            - generate new element \n:toggleShowEven - toggle display of even elements\n\n% :show\n\n% :new\n    Enter data: 1\n% :new \n    Enter data: 2\n% :new \n    Enter data: 3\n% :show\n1 3\n% :toggleShowEven \n% :show\n1 2 3\n% \n</code></pre>\n\n<p>As you might have noticed, this program is using command line autocompletion for typical commands such as <code>:show</code>, <code>:edit</code>, <code>:new</code>, etc.</p>\n\n<p>My question is following. Is it possible to extend the list of commands available for autocompletion (<code>wordsList</code> variable) with the values from <code>MyDataState</code>? For example, if <code>mydata</code> contains values <code>1, 2, 3</code>, I want it to be shown together with commands available for autocompletion - when typing <kbd>:</kbd><kbd>Tab</kbd>, I would get the following list of commands instead of just statically defined via <code>wordsList</code>: <strong><code>:help</code></strong>, <strong><code>:q</code></strong>, <strong><code>:commands</code></strong>, <strong><code>:show</code></strong>, <strong><code>:save</code></strong>, <strong><code>:edit</code></strong>, <strong><code>:new</code></strong>, <strong><code>:toggleShowEven</code></strong>, <strong><code>:1</code></strong>, <strong><code>:2</code></strong>, <strong><code>:3</code></strong>. How do I need to extend <code>searchFunc</code> definition to include values defined in <code>MyDataState</code>? Is it possible at all? </p>\n"}, {"tags": ["haskell", "record"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522696655, "post_id": 49617328, "comment_id": 86241676, "body": "<code>let ts = something ts</code> will always generate an infinite loop in Haskell."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522697046, "post_id": 49617328, "comment_id": 86241873, "body": "One point of the record update syntax is that you don&#39;t to pattern match (which you would need to get and preserve the old values of the <i>other</i> fields); <code>updateKa val p = p { setP = val}</code> would be sufficient."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522697324, "post_id": 49617328, "comment_id": 86242016, "body": "You probably just want <code>anotherFunction ls ts a = updateKa (...) ts</code>. You never actually update a value in Haskell; you just create a <i>new</i> value based on an old one and return it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522697398, "post_id": 49617328, "comment_id": 86242052, "body": "The <code>do</code> syntax is definitely wrong, since you aren&#39;t actually using a monad."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522697459, "post_id": 49617328, "comment_id": 86242084, "body": "Turning on warnings points out the shadowed variable, hinting at a potential issue. Strongly recommended."}], "owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1522697391, "answer_count": 0, "score": 0, "last_activity_date": 1522696522, "creation_date": 1522696398, "last_edit_date": 1522696522, "question_id": 49617328, "link": "https://stackoverflow.com/questions/49617328/infinite-loop-while-updating-record", "closed_reason": "Duplicate", "title": "Infinite loop while updating record", "body": "<p>While running following code, I receive <code>file: &lt;&lt;loop&gt;&gt;</code> error.</p>\n\n<p>My simplified code:</p>\n\n<pre><code>data KAutomat = KA\n    { states :: Set.Set String\n    , start :: KState\n    , final :: Set.Set String\n    , trans :: [Transition]\n    , setW :: Set.Set (Set.Set String)\n    , setP :: Set.Set (Set.Set String)\n    } deriving (Eq,Show)\n\nupdateKa val p@(KA _ _ _ _ _ s) = p { setP = val}\n\nanotherFunction ls ts a = do\n    let valu = replaceNth (...etc...)\n    let ts = updateKa (Set.fromList $ (map Set.fromList $ valu)) ts\n</code></pre>\n\n<p>And I got no idead what's wrong. Can someone help? I was trying debugging and it loops on the <code>updateKa val...</code> line.</p>\n"}, {"tags": ["haskell", "coalesce"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1522692443, "post_id": 49616294, "comment_id": 86239594, "body": "How are you receiving the values? Are they in a list you need to unpack or <code>Maybe String</code> values?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1522692833, "post_id": 49616294, "comment_id": 86239807, "body": "This question isn&#39;t clear, but you might be looking for the <code>Maybe</code> monad. <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\">The LYAH chapter</a> might help you."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522692843, "post_id": 49616294, "comment_id": 86239810, "body": "I am reading from a text file.It should be [String]"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1522694004, "post_id": 49616294, "comment_id": 86240350, "body": "Haskell doesn&#39;t have null references, so what exactly do you mean by &#39;null&#39;. An empty list? Is that the only thing you wish to handle? How about  file names that are proper strings, but where the file doesn&#39;t exist?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522694437, "post_id": 49616294, "comment_id": 86240550, "body": "By null i meant empty string ."}], "answers": [{"comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1522693844, "post_id": 49616655, "comment_id": 86240269, "body": "There&#39;s also <code>fromMaybe :: a -&gt; Maybe a -&gt; a</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1522693875, "post_id": 49616655, "comment_id": 86240282, "body": "Thanks; that&#39;s the one that was rattling around in the back of my mind."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1522696509, "last_edit_date": 1522696509, "creation_date": 1522693607, "answer_id": 49616655, "question_id": 49616294, "link": "https://stackoverflow.com/questions/49616294/coalesce-operator-alternative-in-haskell/49616655#49616655", "title": "Coalesce operator alternative in Haskell", "body": "<h1>Use the <code>Maybe</code> type constructor</h1>\n\n<p>First, encode your \"null\" strings correctly using <code>Maybe</code>. Then, use the <code>maybe</code> function to return your default values if an argument is <code>Nothing</code>.</p>\n\n<pre><code>func :: Maybe String -&gt; Maybe String -&gt; IO String\nfunc inFile outFile = do\n   text &lt;- readFile $ maybe defaultIn id inFile\n   writeFile (maybe defaultOut id outFile) text\n   return text\n</code></pre>\n\n<h2>Using <code>Data.Maybe</code></h2>\n\n<p>If you don't mind an extra import, you can use <code>fromMaybe d = maybe d id</code>.</p>\n\n<pre><code>import Data.Maybe\n\nfunc :: Maybe String -&gt; Maybe String -&gt; IO String\nfunc inFile outFile = do\n   text &lt;- readFile $ fromMaybe defaultIn inFile\n   writeFile (fromMaybe defaultOut outFile) text\n   return text\n</code></pre>\n\n<h2>Defining <code>??</code> yourself</h2>\n\n<p>Either way, you can define your own coalescing operator from either function:</p>\n\n<pre><code>?? :: Maybe String -&gt; String -&gt; String\n(??) = flip fromMaybe\n-- a ?? b = fromMaybe b a\n-- a ?? b = maybe b id a\n</code></pre>\n\n<p>and write</p>\n\n<pre><code>func inFile outFile = do\n    text &lt;- readFile (inFile ?? defaultIn)\n    writeFile (outFile ?? defaultOut) text\n    return text\n</code></pre>\n\n<h2>Using <code>Maybe</code></h2>\n\n<p>Your four types of calls would look like this, assuming you aren't already\ngetting the values from a function that returns a <code>Maybe String</code> value.</p>\n\n<pre><code>func Nothing Nothing\nfunc (Just \"input.txt\") Nothing\nfunc Nothing (Just \"output.txt\")\nfunc (Just \"input.txt\") (Just \"output.txt\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 1, "last_activity_date": 1522694719, "creation_date": 1522694719, "answer_id": 49616916, "question_id": 49616294, "link": "https://stackoverflow.com/questions/49616294/coalesce-operator-alternative-in-haskell/49616916#49616916", "title": "Coalesce operator alternative in Haskell", "body": "<p>If you have a value that may or may not be provided, you should definitely encode this safely and flexibly with Maybe.</p>\n\n<p>However, if you really want to replace an empty string or any other magic value, you can easily use <code>if..then..else</code> as an expression:</p>\n\n<pre><code>func :: String -&gt; IO ()\nfunc input = do \n  text &lt;- readFile (if input == \"\" then defaultIn else input) \n  putStrLn text\n</code></pre>\n\n<p>and of course, once you do switch to Maybe and find yourself with a plain string, you can use the same to call it:</p>\n\n<pre><code>func :: Maybe String -&gt; IO ()\nfunc input = do\n  text &lt;- readFile $ fromMaybe \"default.txt\" input \n  putStrLn text\n\nmain = do\n  putStrLn \"Enter filename or blank for default:\"\n  file &lt;- getLine\n  func (if file == \"\" then Nothing else Just file)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1524228632, "post_id": 49822752, "comment_id": 86900054, "body": "Thank you for your thoroughly answer sir."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1523642384, "creation_date": 1523642384, "answer_id": 49822752, "question_id": 49616294, "link": "https://stackoverflow.com/questions/49616294/coalesce-operator-alternative-in-haskell/49822752#49822752", "title": "Coalesce operator alternative in Haskell", "body": "<p>The other answers already here are more practical than what follows, but if you're interested in a more conceptual view of things, then read on.</p>\n\n<p>First, Haskell doesn't have null references, but if you want to model missing values, you can use <code>Maybe</code>. If, for example, you want to treat the empty string as a missing value, you can write a conversion function like this:</p>\n\n<pre><code>maybeFromNull :: Foldable t =&gt; t a -&gt; Maybe (t a)\nmaybeFromNull xs = if null xs then Nothing else Just xs\n</code></pre>\n\n<p>You use it like this:</p>\n\n<pre><code>*Q49616294&gt; maybeFromNull \"foo\"\nJust \"foo\"\n*Q49616294&gt; maybeFromNull \"\"\nNothing\n</code></pre>\n\n<p>The reason that this is interesting when the talk falls on null coalescing operators in Haskell is that <a href=\"http://blog.ploeh.dk/2018/04/03/maybe-monoids\" rel=\"nofollow noreferrer\">there's a monoid over Maybe that corresponds to that</a>. It's called <code>First</code>, and it returns the leftmost non-<code>Nothing</code> value from a series of candidates.</p>\n\n<p>For reasons that may be clearer later, I'll use the one from <code>Data.Semigroup</code>, so</p>\n\n<pre><code>import Data.Semigroup\n</code></pre>\n\n<p>In order to get the <code>Monoid</code> behaviour over <code>Maybe</code>, you need to wrap the <code>First</code> value in an <code>Option</code>; e.g.:</p>\n\n<pre><code>*Q49616294&gt; (Option $ Just $ First 42) &lt;&gt; (Option $ Just $ First 1337)\nOption {getOption = Just (First {getFirst = 42})}\n</code></pre>\n\n<p>Granted, that's quite a long-winded way to select the left-most value, but highlights that null coalesce is 'just' a monoid:</p>\n\n<pre><code>*Q49616294&gt; (Option $ Just $ First 42) &lt;&gt; (Option Nothing)\nOption {getOption = Just (First {getFirst = 42})}\n*Q49616294&gt; (Option Nothing) &lt;&gt; (Option $ Just $ First 1337)\nOption {getOption = Just (First {getFirst = 1337})}\n</code></pre>\n\n<p>Since that's too verbose for practical use, you could decide to write a custom operator that repackages <code>Maybe</code> values as <code>Option First</code> values, applies the <code>&lt;&gt;</code> operations, and then unwraps the result from <code>Option First</code> back to <code>Maybe</code>:</p>\n\n<pre><code>(&lt;?&gt;) :: Maybe a -&gt; Maybe a -&gt; Maybe a\nmx &lt;?&gt; my =\n  let ofx = Option $ sequenceA $ First mx\n      ofy = Option $ sequenceA $ First my\n      leftmost = ofx &lt;&gt; ofy\n  in getFirst $ sequenceA $ getOption $ leftmost\n</code></pre>\n\n<p>While you could write this operator as one big expression, I chose to use the <code>let...in</code> syntax to 'show my work'.</p>\n\n<p>One problem remains, though:</p>\n\n<pre><code>*Q49616294&gt; Just 42 &lt;?&gt; Just 1337\nJust 42\n*Q49616294&gt; Nothing &lt;?&gt; Nothing\nNothing\n</code></pre>\n\n<p>While the operation returns a <code>Just</code> value as long as at least one of the arguments is a <code>Just</code> value, it <em>can</em> return <code>Nothing</code>.</p>\n\n<p>How do you apply a fallback value so that you're guaranteed to get a value in all cases?</p>\n\n<p>You can take advantage of <code>Option</code> being <code>Foldable</code>, and then still fold over <code>&lt;&gt;</code> - only this time, a different <code>Monoid</code> instance is in use:</p>\n\n<pre><code>(&lt;!&gt;) :: Maybe a -&gt; a -&gt; a\nmx &lt;!&gt; y =\n  let ofx = Option $ sequenceA $ First mx\n      fy  = First y\n  in getFirst $ foldr (&lt;&gt;) fy ofx\n</code></pre>\n\n<p>This operator folds over <code>ofx</code>, using <code>fy</code> as an initial value. Here, <code>&lt;&gt;</code> belongs to the <code>First</code> <code>Semigroup</code>, which unconditionally returns the leftmost value. There's no <code>Option</code> involved here, since <code>foldr</code> peels that layer away. Since we're folding from the right, though, the initial value <code>fy</code> will always be ignored if <code>ofx</code> contains a value.</p>\n\n<pre><code>*Q49616294&gt; Just 42 &lt;!&gt; 1337\n42\n*Q49616294&gt; Nothing &lt;!&gt; 1337\n1337\n</code></pre>\n\n<p>You can now write the desired function as follows:</p>\n\n<pre><code>copyFile :: String -&gt; String -&gt; IO String\ncopyFile input output = do\n  text &lt;- readFile $ (maybeFromNull input) &lt;!&gt; defaultInPath\n  writeFile (maybeFromNull output &lt;!&gt; defaultOutPath) text\n  return text \n</code></pre>\n\n<p>It turns out that in this case, you don't even need <code>&lt;?&gt;</code>, but in other situations, you could use this operator to chain as many potential values as you'd like:</p>\n\n<pre><code>*Q49616294&gt; Just 42 &lt;?&gt; Nothing &lt;?&gt; Just 1337 &lt;!&gt; 123\n42\n*Q49616294&gt; Nothing &lt;?&gt; Nothing &lt;?&gt; Just 1337 &lt;!&gt; 123\n1337\n*Q49616294&gt; Nothing &lt;?&gt; Nothing &lt;?&gt; Nothing &lt;!&gt; 123\n123\n</code></pre>\n\n<p>Not only is this way of implementing null coalescing behaviour needlessly complicated, I wouldn't be surprised if it doesn't perform well to add spite to injury.</p>\n\n<p>It does, however, illustrate the power and expressivity of Haskell's built-in abstractions.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 0, "accepted_answer_id": 49616655, "answer_count": 3, "score": 1, "last_activity_date": 1523642384, "creation_date": 1522692093, "last_edit_date": 1522692859, "question_id": 49616294, "link": "https://stackoverflow.com/questions/49616294/coalesce-operator-alternative-in-haskell", "title": "Coalesce operator alternative in Haskell", "body": "<p>I am receiving 2 string path's as an argument: <code>input</code> and <code>output</code> and i want to read the file from <code>input</code> path and write it to the <code>output</code> path.\nI want to treat all 4 scenarios regarding input / output paths.When one of them is null i want to give it a default value.Is there anything like a coalesce operator?I do not want to rewrite the do clause for all scenarios:</p>\n\n<p>Scenarios</p>\n\n<pre><code> func   null _  -&gt; {do clause}\n        _ null  -&gt; {do clause}\n        _  _   -&gt;  {do clause}\n        x  y   -&gt;  {do clause}\n\nlet defaultInPath=\"inPath.txt\"\n    defaultOutPath=\"outPath.txt\"\n</code></pre>\n\n<p>What i want to achieve -do clause:</p>\n\n<pre><code>  do \n    text&lt;-readFile input??defaultIn\n    writeFile  output??defaultOut text\n    return text \n</code></pre>\n\n<p>P.S I am new to Haskell and i am really trying to get a grasp of it.</p>\n"}, {"tags": ["c", "haskell", "opengl", "ffi"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522685433, "post_id": 49614566, "comment_id": 86235850, "body": "Isn&#39;t this more a C question, rather than Haskell?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522685559, "post_id": 49614566, "comment_id": 86235919, "body": "@leftaroundabout I don&#39;t know actually. When I remove the Haskell lines starting by <code>free</code>, something changes: I only get &quot;segmentation fault&quot; as error. There&#39;s no <code>malloc</code> and no <code>free</code> in the C code, as far as I remember."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522685670, "post_id": 49614566, "comment_id": 86235991, "body": "Ah, so did you forget a word in the sentence \u201cwhich I use in my code\u201d?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522685730, "post_id": 49614566, "comment_id": 86236021, "body": "There&#39;s a <code>free</code> function in Haskell. Anyway I will add the <code>C</code> tag, you&#39;re right."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522685884, "post_id": 49614566, "comment_id": 86236102, "body": "I&#39;m always falling over when something works on Windows but not on Linux...."}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522686491, "post_id": 49614566, "comment_id": 86236368, "body": "This is a message from <code>libc.so</code>. It&#39;s related to memory corruption. If the code worked in other machine, I suspect from some 32-64 bits mismatch library or option."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522689418, "post_id": 49614566, "comment_id": 86237914, "body": "This needs an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522689578, "post_id": 49614566, "comment_id": 86237993, "body": "Yeah. FWIW, I can reproduce the problem by running the linked code, so <i>Complete</i> \u2713 <i>Verifyable</i> \u2713, but <i>Minimal</i> \u2717."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522690486, "post_id": 49614566, "comment_id": 86238456, "body": "@DanielWagner You could clone the repo. I don&#39;t see how I could minimize the code. There are only two modules generating some graphics."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522690634, "post_id": 49614566, "comment_id": 86238528, "body": "@leftaroundabout Thanks for having tested the package."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522693650, "post_id": 49614566, "comment_id": 86240169, "body": "@St&#233;phaneLaurent 1. SO rules ask you to put the code on-site. Off-site code dumps are not allowed. 2. Are you really prepared to claim that the shortest possible program which causes an &quot;invalid next size&quot; error for the same reason this one does has over 500 lines each of Haskell and C? I bet you can get it down to just 20 lines including FFI/hsc2hs stuff. It&#39;s not each individual answerer&#39;s responsibility to reproduce the work of this minimization; that is wasted duplicate effort. The question asker is required to do it once and for all. (And you may even solve the problem in the process.)"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522695313, "post_id": 49614566, "comment_id": 86241023, "body": "@DanielWagner Indeed. I&#39;ve just &quot;solved&quot; the problem by replacing a <code>malloc</code> with <code>mallocBytes (100000 * (sizeOf (undefined :: CTriangle))</code>. The problem is that 100000 is arbitrary, I don&#39;t know the size in advance. But now I have a better idea of the problem and I could ask a better question. Before that I was too lost for being more precise, sorry. I posted a CVE but not a &quot;M&quot;CVE. I know it&#39;s not the better appropriate way to get help but that could be enough in case if someone has encountered a similar error message."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1522707016, "post_id": 49614566, "comment_id": 86245983, "body": "@leftaroundabout The package should work now. Just in case you want to try it again. Cheers."}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "closed_date": 1522729662, "answer_count": 0, "score": 2, "last_activity_date": 1522692278, "creation_date": 1522684958, "last_edit_date": 1522692278, "question_id": 49614566, "link": "https://stackoverflow.com/questions/49614566/cannot-use-haskell-opengl-on-linux", "closed_reason": "Not suitable for this site", "title": "Cannot use Haskell OpenGL on Linux", "body": "<h3>Edit:</h3>\n\n<p>My package <a href=\"https://github.com/stla/opengl-examples\" rel=\"nofollow noreferrer\">opengl-examples</a> works very well, so this is an issue with the FFI.</p>\n\n<hr>\n\n<p>I wanted to try <a href=\"https://github.com/stla/opengl-implicit\" rel=\"nofollow noreferrer\">my opengl-implicit package</a> on another computer, namely a PC with Linux Ubuntu. The package correctly compiles. However when I run a graphics (from GHCi or from an executable) I get a list of errors (see below). The list of errors starts with </p>\n\n<pre><code>Error in `.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat': free(): invalid next size (fast): 0x00000000025bad90\n</code></pre>\n\n<p>Any idea what's happening ? Does that mean it is an error caused by the <code>free</code> function (which I use in my Haskell code) ?</p>\n\n<pre><code>:~/Work/Haskell/opengl-implicit$ .stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat\n*** Goursat surface ***\n    To quit, press q.\n    Scene rotation:\n        e, r, t, y, u, i\n    Zoom: l, m\n    Increase/decrease parameters:\n        f, v, g, b, h, n\n\n*** Error in `.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat': free(): invalid next size (fast): 0x00000000025bad90 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f58d144b7e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f58d145437a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f58d145853c]\n.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat[0x40c168]\n======= Memory map: ========\n00400000-00c22000 r-xp 00000000 08:09 13250380                           /home/stla/Work/Haskell/opengl-implicit/.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat\n00c23000-00c43000 r--p 00822000 08:09 13250380                           /home/stla/Work/Haskell/opengl-implicit/.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat\n00c43000-00ce9000 rw-p 00842000 08:09 13250380                           /home/stla/Work/Haskell/opengl-implicit/.stack-work/install/x86_64-linux/lts-11.2/8.2.2/bin/goursat\n00ce9000-00ced000 rw-p 00000000 00:00 0 \n02275000-025dd000 rw-p 00000000 00:00 0                                  [heap]\n4200000000-4200200000 rw-p 00000000 00:00 0 \n4200200000-14200100000 ---p 00000000 00:00 0 \n7f58c4000000-7f58c4021000 rw-p 00000000 00:00 0 \n7f58c4021000-7f58c8000000 ---p 00000000 00:00 0 \n7f58cb5ad000-7f58cc95e000 rw-p 00000000 00:00 0 \n7f58cc95e000-7f58cc995000 r-xp 00000000 08:09 21242336                   /usr/lib/x86_64-linux-gnu/libtxc_dxtn_s2tc.so.0.0.0\n7f58cc995000-7f58ccb94000 ---p 00037000 08:09 21242336                   /usr/lib/x86_64-linux-gnu/libtxc_dxtn_s2tc.so.0.0.0\n7f58ccb94000-7f58ccb95000 r--p 00036000 08:09 21242336                   /usr/lib/x86_64-linux-gnu/libtxc_dxtn_s2tc.so.0.0.0\n7f58ccb95000-7f58ccb96000 rw-p 00037000 08:09 21242336                   /usr/lib/x86_64-linux-gnu/libtxc_dxtn_s2tc.so.0.0.0\n7f58ccb96000-7f58ccb9e000 r-xp 00000000 08:09 21234764                   /usr/lib/x86_64-linux-gnu/libpciaccess.so.0.11.1\n7f58ccb9e000-7f58ccd9e000 ---p 00008000 08:09 21234764                   /usr/lib/x86_64-linux-gnu/libpciaccess.so.0.11.1\n7f58ccd9e000-7f58ccd9f000 r--p 00008000 08:09 21234764                   /usr/lib/x86_64-linux-gnu/libpciaccess.so.0.11.1\n7f58ccd9f000-7f58ccda0000 rw-p 00009000 08:09 21234764                   /usr/lib/x86_64-linux-gnu/libpciaccess.so.0.11.1\n7f58ccda0000-7f58ccdab000 r-xp 00000000 08:09 21237495                   /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1\n7f58ccdab000-7f58ccfaa000 ---p 0000b000 08:09 21237495                   /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1\n7f58ccfaa000-7f58ccfab000 r--p 0000a000 08:09 21237495                   /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1\n7f58ccfab000-7f58ccfac000 rw-p 0000b000 08:09 21237495                   /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1\n7f58ccfac000-7f58ccfb3000 r-xp 00000000 08:09 21239163                   /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0\n7f58ccfb3000-7f58cd1b2000 ---p 00007000 08:09 21239163                   /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0\n7f58cd1b2000-7f58cd1b3000 r--p 00006000 08:09 21239163                   /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0\n7f58cd1b3000-7f58cd1b4000 rw-p 00007000 08:09 21239163                   /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0\n7f58cd1b4000-7f58cd1d6000 r-xp 00000000 08:09 21235062                   /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0\n7f58cd1d6000-7f58cd3d6000 ---p 00022000 08:09 21235062                   /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0\n7f58cd3d6000-7f58cd3d7000 r--p 00022000 08:09 21235062                   /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0\n7f58cd3d7000-7f58cd3d8000 rw-p 00023000 08:09 21235062                   /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0\n7f58cd3d8000-7f58cd3f1000 r-xp 00000000 08:09 9201712                    /lib/x86_64-linux-gnu/libz.so.1.2.8\n7f58cd3f1000-7f58cd5f0000 ---p 00019000 08:09 9201712                    /lib/x86_64-linux-gnu/libz.so.1.2.8\n7f58cd5f0000-7f58cd5f1000 r--p 00018000 08:09 9201712                    /lib/x86_64-linux-gnu/libz.so.1.2.8\n7f58cd5f1000-7f58cd5f2000 rw-p 00019000 08:09 9201712                    /lib/x86_64-linux-gnu/libz.so.1.2.8\n7f58cd5f2000-7f58cde20000 r-xp 00000000 08:09 21630454                   /usr/lib/x86_64-linux-gnu/dri/i965_dri.so\n7f58cde20000-7f58ce01f000 ---p 0082e000 08:09 21630454                   /usr/lib/x86_64-linux-gnu/dri/i965_dri.so\n7f58ce01f000-7f58ce06f000 r--p 0082d000 08:09 21630454                   /usr/lib/x86_64-linux-gnu/dri/i965_dri.so\n7f58ce06f000-7f58ce078000 rw-p 0087d000 08:09 21630454                   /usr/lib/x86_64-linux-gnu/dri/i965_dri.so\n7f58ce078000-7f58ce0df000 rw-p 00000000 00:00 0 \n7f58ce0df000-7f58ce0ee000 r-xp 00000000 08:09 21236496                   /usr/lib/x86_64-linux-gnu/libXi.so.6.1.0\n7f58ce0ee000-7f58ce2ed000 ---p 0000f000 08:09 21236496                   /usr/lib/x86_64-linux-gnu/libXi.so.6.1.0\n7f58ce2ed000-7f58ce2ee000 r--p 0000e000 08:09 21236496                   /usr/lib/x86_64-linux-gnu/libXi.so.6.1.0\n7f58ce2ee000-7f58ce2ef000 rw-p 0000f000 08:09 21236496                   /usr/lib/x86_64-linux-gnu/libXi.so.6.1.0\n7f58ce2ef000-7f58ce32f000 r-xp 00000000 08:09 21234507                   /usr/lib/x86_64-linux-gnu/libglut.so.3.9.0\n7f58ce32f000-7f58ce52e000 ---p 00040000 08:09 21234507                   /usr/lib/x86_64-linux-gnu/libglut.so.3.9.0\n7f58ce52e000-7f58ce532000 r--p 0003f000 08:09 21234507                   /usr/lib/x86_64-linux-gnu/libglut.so.3.9.0\n7f58ce532000-7f58ce537000 rw-p 00043000 08:09 21234507                   /usr/lib/x86_64-linux-gnu/libglut.so.3.9.0\n7f58ce537000-7f58ce814000 r--p 00000000 08:09 21238100                   /usr/lib/locale/locale-archive\n7f58ce814000-7f58ce819000 r-xp 00000000 08:09 21240658                   /usr/lib/x86_64-linux-gnu/libXdmcp.so.6.0.0\n7f58ce819000-7f58cea18000 ---p 00005000 08:09 21240658                   /usr/lib/x86_64-linux-gnu/libXdmcp.so.6.0.0\n7f58cea18000-7f58cea19000 r--p 00004000 08:09 21240658                   /usr/lib/x86_64-linux-gnu/libXdmcp.so.6.0.0\n7f58cea19000-7f58cea1a000 rw-p 00005000 08:09 21240658                   /usr/lib/x86_64-linux-gnu/libXdmcp.so.6.0.0\n7f58cea1a000-7f58cea1c000 r-xp 00000000 08:09 21241388                   /usr/lib/x86_64-linux-gnu/libXau.so.6.0.0\n7f58cea1c000-7f58cec1c000 ---p 00002000 08:09 21241388                   /usr/lib/x86_64-linux-gnu/libXau.so.6.0.0\n7f58cec1c000-7f58cec1d000 r--p 00002000 08:09 21241388                   /usr/lib/x86_64-linux-gnu/libXau.so.6.0.0\n7f58cec1d000-7f58cec1e000 rw-p 00003000 08:09 21241388                   /usr/lib/x86_64-linux-gnu/libXau.so.6.0.0\n7f58cec1e000-7f58cec36000 r-xp 00000000 08:09 9199541                    /lib/x86_64-linux-gnu/libpthread-2.23.so\n7f58cec36000-7f58cee35000 ---p 00018000 08:09 9199541                    /lib/x86_64-linux-gnu/libpthread-2.23.so\n7f58cee35000-7f58cee36000 r--p 00017000 08:09 9199541                    /lib/x86_64-linux-gnu/libpthread-2.23.so\n7f58cee36000-7f58cee37000 rw-p 00018000 08:09 9199541                    /lib/x86_64-linux-gnu/libpthread-2.23.so\n7f58cee37000-7f58cee3b000 rw-p 00000000 00:00 0 \n7f58cee3b000-7f58cee4b000 r-xp 00000000 08:09 21237738                   /usr/lib/x86_64-linux-gnu/libdrm.so.2.4.0\n7f58cee4b000-7f58cf04a000 ---p 00010000 08:09 21237738                   /usr/lib/x86_64-linux-gnu/libdrm.so.2.4.0\n7f58cf04a000-7f58cf04b000 r--p 0000f000 08:09 21237738                   /usr/lib/x86_64-linux-gnu/libdrm.so.2.4.0\n7f58cf04b000-7f58cf04c000 rw-p 00010000 08:09 21237738                   /usr/lib/x86_64-linux-gnu/libdrm.so.2.4.0\n7f58cf04c000-7f58cf051000 r-xp 00000000 08:09 21243182                   /usr/lib/x86_64-linux-gnu/libXxf86vm.so.1.0.0\n7f58cf051000-7f58cf250000 ---p 00005000 08:09 21243182                   /usr/lib/x86_64-linux-gnu/libXxf86vm.so.1.0.0\n7f58cf250000-7f58cf251000 r--p 00004000 08:09 21243182                   /usr/lib/x86_64-linux-gnu/libXxf86vm.so.1.0.0\n7f58cf251000-7f58cf252000 rw-p 00005000 08:09 21243182                   /usr/lib/x86_64-linux-gnu/libXxf86vm.so.1.0.0\n7f58cf252000-7f58cf273000 r-xp 00000000 08:09 21234504                   /usr/lib/x86_64-linux-gnu/libxcb.so.1.1.0\n7f58cf273000-7f58cf472000 ---p 00021000 08:09 21234504                   /usr/lib/x86_64-linux-gnu/libxcb.so.1.1.0\n7f58cf472000-7f58cf473000 r--p 00020000 08:09 21234504                   /usr/lib/x86_64-linux-gnu/libxcb.so.1.1.0\n7f58cf473000-7f58cf474000 rw-p 00021000 08:09 21234504                   /usr/lib/x86_64-linux-gnu/libxcb.so.1.1.0\n7f58cf474000-7f58cf478000 r-xp 00000000 08:09 21243176                   /usr/lib/x86_64-linux-gnu/libxcb-dri2.so.0.0.0\n7f58cf478000-7f58cf677000 ---p 00004000 08:09 21243176                   /usr/lib/x86_64-linux-gnu/libxcb-dri2.so.0.0.0\n7f58cf677000-7f58cf678000 r--p 00003000 08:09 21243176                   /usr/lib/x86_64-linux-gnu/libxcb-dri2.so.0.0.0\n7f58cf678000-7f58cf679000 rw-p 00004000 08:09 21243176                   /usr/lib/x86_64-linux-gnu/libxcb-dri2.so.0.0.0\n7f58cf679000-7f58cf690000 r-xp 00000000 08:09 21243179                   /usr/lib/x86_64-linux-gnu/libxcb-glx.so.0.0.0\n7f58cf690000-7f58cf88f000 ---p 00017000 08:09 21243179                   /usr/lib/x86_64-linux-gnu/libxcb-glx.so.0.0.0\n7f58cf88f000-7f58cf891000 r--p 00016000 08:09 21243179                   /usr/lib/x86_64-linux-gnu/libxcb-glx.so.0.0.0\n7f58cf891000-7f58cf892000 rw-p 00018000 08:09 21243179                   /usr/lib/x86_64-linux-gnu/libxcb-glx.so.0.0.0\n7f58cf892000-7f58cf9c7000 r-xp 00000000 08:09 21240474                   /usr/lib/x86_64-linux-gnu/libX11.so.6.3.0\n7f58cf9c7000-7f58cfbc7000 ---p 00135000 08:09 21240474                   /usr/lib/x86_64-linux-gnu/libX11.so.6.3.0\n7f58cfbc7000-7f58cfbc8000 r--p 00135000 08:09 21240474                   /usr/lib/x86_64-linux-gnu/libX11.so.6.3.0\n7f58cfbc8000-7f58cfbcc000 rw-p 00136000 08:09 21240474                   /usr/lib/x86_64-linux-gnu/libX11.so.6.3.0\n7f58cfbcc000-7f58cfbcd000 r-xp 00000000 08:09 21243150                   /usr/lib/x86_64-linux-gnu/libX11-xcb.so.1.0.0\n7f58cfbcd000-7f58cfdcc000 ---p 00001000 08:09 21243150                   /usr/lib/x86_64-linux-gnu/libX11-xcb.so.1.0.0\n7f58cfdcc000-7f58cfdcd000 r--p 00000000 08:09 21243150                   /usr/lib/x86_64-linux-gnu/libX11-xcb.so.1.0.0\n7f58cfdcd000-7f58cfdce000 rw-p 00001000 08:09 21243150                   /usr/lib/x86_64-linux-gnu/libX11-xcb.so.1.0.0\n7f58cfdce000-7f58cfdd3000 r-xp 00000000 08:09 21236450                   /usr/lib/x86_64-linux-gnu/libXfixes.so.3.1.0\n7f58cfdd3000-7f58cffd2000 ---p 00005000 08:09 21236450                   /usr/lib/x86_64-linux-gnu/libXfixes.so.3.1.0\n7f58cffd2000-7f58cffd3000 r--p 00004000 08:09 21236450                   /usr/lib/x86_64-linux-gnu/libXfixes.so.3.1.0\n7f58cffd3000-7f58cffd4000 rw-p 00005000 08:09 21236450                   /usr/lib/x86_64-linux-gnu/libXfixes.so.3.1.0\n7f58cffd4000-7f58cffd6000 r-xp 00000000 08:09 21244691                   /usr/lib/x86_64-linux-gnu/libXdamage.so.1.1.0\n7f58cffd6000-7f58d01d5000 ---p 00002000 08:09 21244691                   /usr/lib/x86_64-linux-gnu/libXdamage.so.1.1.0\n7f58d01d5000-7f58d01d6000 r--p 00001000 08:09 21244691                   /usr/lib/x86_64-linux-gnu/libXdamage.so.1.1.0\n7f58d01d6000-7f58d01d7000 rw-p 00002000 08:09 21244691                   /usr/lib/x86_64-linux-gnu/libXdamage.so.1.1.0\n7f58d01d7000-7f58d01e8000 r-xp 00000000 08:09 21234448                   /usr/lib/x86_64-linux-gnu/libXext.so.6.4.0\n7f58d01e8000-7f58d03e7000 ---p 00011000 08:09 21234448                   /usr/lib/x86_64-linux-gnu/libXext.so.6.4.0\n7f58d03e7000-7f58d03e8000 r--p 00010000 08:09 21234448                   /usr/lib/x86_64-linux-gnu/libXext.so.6.4.0\n7f58d03e8000-7f58d03e9000 rw-p 00011000 08:09 21234448                   /usr/lib/x86_64-linux-gnu/libXext.so.6.4.0\n7f58d03e9000-7f58d0414000 r-xp 00000000 08:09 21242729                   /usr/lib/x86_64-linux-gnu/libglapi.so.0.0.0\n7f58d0414000-7f58d0613000 ---p 0002b000 08:09 21242729                   /usr/lib/x86_64-linux-gnu/libglapi.so.0.0.0\n7f58d0613000-7f58d0617000 r--p 0002a000 08:09 21242729                   /usr/lib/x86_64-linux-gnu/libglapi.so.0.0.0\n7f58d0617000-7f58d0618000 rw-p 0002e000 08:09 21242729                   /usr/lib/x86_64-linux-gnu/libglapi.so.0.0.0\n7f58d0618000-7f58d0619000 rw-p 00000000 00:00 0 \n7f58d0619000-7f58d061a000 r-xp 00000000 08:09 21243172                   /usr/lib/x86_64-linux-gnu/libxshmfence.so.1.0.0\n7f58d061a000-7f58d081a000 ---p 00001000 08:09 21243172                   /usr/lib/x86_64-linux-gnu/libxshmfence.so.1.0.0\n7f58d081a000-7f58d081b000 r--p 00001000 08:09 21243172                   /usr/lib/x86_64-linux-gnu/libxshmfence.so.1.0.0\n7f58d081b000-7f58d081c000 rw-p 00002000 08:09 21243172                   /usr/lib/x86_64-linux-gnu/libxshmfence.so.1.0.0\n7f58d081c000-7f58d0821000 r-xp 00000000 08:09 21243166                   /usr/lib/x86_64-linux-gnu/libxcb-sync.so.1.0.0\n7f58d0821000-7f58d0a21000 ---p 00005000 08:09 21243166                   /usr/lib/x86_64-linux-gnu/libxcb-sync.so.1.0.0\n7f58d0a21000-7f58d0a22000 r--p 00005000 08:09 21243166                   /usr/lib/x86_64-linux-gnu/libxcb-sync.so.1.0.0\n7f58d0a22000-7f58d0a23000 rw-p 00006000 08:09 21243166                   /usr/lib/x86_64-linux-gnu/libxcb-sync.so.1.0.0\n7f58d0a23000-7f58d0a25000 r-xp 00000000 08:09 21243169                   /usr/lib/x86_64-linux-gnu/libxcb-present.so.0.0.0\n7f58d0a25000-7f58d0c24000 ---p 00002000 08:09 21243169                   /usr/lib/x86_64-linux-gnu/libxcb-present.so.0.0.0\n7f58d0c24000-7f58d0c25000 r--p 00001000 08:09 21243169                   /usr/lib/x86_64-linux-gnu/libxcb-present.so.0.0.0\n7f58d0c25000-7f58d0c26000 rw-p 00002000 08:09 21243169                   /usr/lib/x86_64-linux-gnu/libxcb-present.so.0.0.0\n7f58d0c26000-7f58d0c28000 r-xp 00000000 08:09 21243154                   /usr/lib/x86_64-linux-gnu/libxcb-dri3.so.0.0.0\n7f58d0c28000-7f58d0e27000 ---p 00002000 08:09 21243154                   /usr/lib/x86_64-linux-gnu/libxcb-dri3.so.0.0.0\n7f58d0e27000-7f58d0e28000 r--p 00001000 08:09 21243154                   /usr/lib/x86_64-linux-gnu/libxcb-dri3.so.0.0.0\n7f58d0e28000-7f58d0e29000 rw-p 00002000 08:09 21243154                   /usr/lib/x86_64-linux-gnu/libxcb-dri3.so.0.0.0\n7f58d0e29000-7f58d0e4f000 r-xp 00000000 08:09 9175378                    /lib/x86_64-linux-gnu/libexpat.so.1.6.0\n7f58d0e4f000-7f58d104f000 ---p 00026000 08:09 9175378                    /lib/x86_64-linux-gnu/libexpat.so.1.6.0\n7f58d104f000-7f58d1051000 r--p 00026000 08:09 9175378                    /lib/x86_64-linux-gnu/libexpat.so.1.6.0\n7f58d1051000-7f58d1052000 rw-p 00028000 08:09 9175378                    /lib/x86_64-linux-gnu/libexpat.so.1.6.0\n7f58d1052000-7f58d11c4000 r-xp 00000000 08:09 21236799                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21\n7f58d11c4000-7f58d13c4000 ---p 00172000 08:09 21236799                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21\n7f58d13c4000-7f58d13ce000 r--p 00172000 08:09 21236799                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21\n7f58d13ce000-7f58d13d0000 rw-p 0017c000 08:09 21236799                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21\n7f58d13d0000-7f58d13d4000 rw-p 00000000 00:00 0 \n7f58d13d4000-7f58d1594000 r-xp 00000000 08:09 9199553                    /lib/x86_64-linux-gnu/libc-2.23.so\n7f58d1594000-7f58d1794000 ---p 001c0000 08:09 9199553                    /lib/x86_64-linux-gnu/libc-2.23.so\n7f58d1794000-7f58d1798000 r--p 001c0000 08:09 9199553                    /lib/x86_64-linux-gnu/libc-2.23.so\n7f58d1798000-7f58d179a000 rw-p 001c4000 08:09 9199553                    /lib/x86_64-linux-gnu/libc-2.23.so\n7f58d179a000-7f58d179e000 rw-p 00000000 00:00 0 \n7f58d179e000-7f58d17b4000 r-xp 00000000 08:09 9175104                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f58d17b4000-7f58d19b3000 ---p 00016000 08:09 9175104                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f58d19b3000-7f58d19b4000 rw-p 00015000 08:09 9175104                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f58d19b4000-7f58d1a33000 r-xp 00000000 08:09 21235792                   /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.0\n7f58d1a33000-7f58d1c32000 ---p 0007f000 08:09 21235792                   /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.0\n7f58d1c32000-7f58d1c33000 r--p 0007e000 08:09 21235792                   /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.0\n7f58d1c33000-7f58d1c34000 rw-p 0007f000 08:09 21235792                   /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.0\n7f58d1c34000-7f58d1c37000 r-xp 00000000 08:09 9199555                    /lib/x86_64-linux-gnu/libdl-2.23.so\n7f58d1c37000-7f58d1e36000 ---p 00003000 08:09 9199555                    /lib/x86_64-linux-gnu/libdl-2.23.so\n7f58d1e36000-7f58d1e37000 r--p 00002000 08:09 9199555                    /lib/x86_64-linux-gnu/libdl-2.23.so\n7f58d1e37000-7f58d1e38000 rw-p 00003000 08:09 9199555                    /lib/x86_64-linux-gnu/libdl-2.23.so\n7f58d1e38000-7f58d1e3a000 r-xp 00000000 08:09 9199560                    /lib/x86_64-linux-gnu/libutil-2.23.so\n7f58d1e3a000-7f58d2039000 ---p 00002000 08:09 9199560                    /lib/x86_64-linux-gnu/libutil-2.23.so\n7f58d2039000-7f58d203a000 r--p 00001000 08:09 9199560                    /lib/x86_64-linux-gnu/libutil-2.23.so\n7f58d203a000-7f58d203b000 rw-p 00002000 08:09 9199560                    /lib/x86_64-linux-gnu/libutil-2.23.so\n7f58d203b000-7f58d2042000 r-xp 00000000 08:09 9199571                    /lib/x86_64-linux-gnu/librt-2.23.so\n7f58d2042000-7f58d2241000 ---p 00007000 08:09 9199571                    /lib/x86_64-linux-gnu/librt-2.23.so\n7f58d2241000-7f58d2242000 r--p 00006000 08:09 9199571                    /lib/x86_64-linux-gnu/librt-2.23.so\n7f58d2242000-7f58d2243000 rw-p 00007000 08:09 9199571                    /lib/x86_64-linux-gnu/librt-2.23.so\n7f58d2243000-7f58d22b1000 r-xp 00000000 08:09 21627169                   /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1.2.0\n7f58d22b1000-7f58d24b1000 ---p 0006e000 08:09 21627169                   /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1.2.0\n7f58d24b1000-7f58d24b4000 r--p 0006e000 08:09 21627169                   /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1.2.0\n7f58d24b4000-7f58d24b5000 rw-p 00071000 08:09 21627169                   /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1.2.0\n7f58d24b5000-7f58d24b6000 rw-p 00000000 00:00 0 \n7f58d24b6000-7f58d2523000 r-xp 00000000 08:09 21243193                   /usr/lib/x86_64-linux-gnu/libGLU.so.1.3.1\n7f58d2523000-7f58d2723000 ---p 0006d000 08:09 21243193                   /usr/lib/x86_64-linux-gnu/libGLU.so.1.3.1\n7f58d2723000-7f58d2724000 r--p 0006d000 08:09 21243193                   /usr/lib/x86_64-linux-gnu/libGLU.so.1.3.1\n7f58d2724000-7f58d2725000 rw-p 0006e000 08:09 21243193                   /usr/lib/x86_64-linux-gnu/libGLU.so.1.3.1\n7f58d2725000-7f58d282d000 r-xp 00000000 08:09 9176988                    /lib/x86_64-linux-gnu/libm-2.23.so\n7f58d282d000-7f58d2a2c000 ---p 00108000 08:09 9176988                    /lib/x86_64-linux-gnu/libm-2.23.so\n7f58d2a2c000-7f58d2a2d000 r--p 00107000 08:09 9176988                    /lib/x86_64-linux-gnu/libm-2.23.so\n7f58d2a2d000-7f58d2a2e000 rw-p 00108000 08:09 9176988                    /lib/x86_64-linux-gnu/libm-2.23.so\n7f58d2a2e000-7f58d2a54000 r-xp 00000000 08:09 9194210                    /lib/x86_64-linux-gnu/ld-2.23.so\n7f58d2c08000-7f58d2c09000 rw-p 00000000 00:00 0 \n7f58d2c09000-7f58d2c11000 rw-s 00000000 00:05 63933                      /drm mm object (deleted)\n7f58d2c11000-7f58d2c21000 rw-p 00000000 00:00 0 \n7f58d2c21000-7f58d2c22000 rwxp 00000000 00:00 0 \n7f58d2c22000-7f58d2c23000 rw-s 00000000 00:05 65766                      /drm mm object (deleted)\n7f58d2c23000-7f58d2c2b000 rw-s 00000000 00:05 65763                      /drm mm object (deleted)\n7f58d2c2b000-7f58d2c53000 rw-p 00000000 00:00 0 \n7f58d2c53000-7f58d2c54000 r--p 00025000 08:09 9194210                    /lib/x86_64-linux-gnu/ld-2.23.so\n7f58d2c54000-7f58d2c55000 rw-p 00026000 08:09 9194210                    /lib/x86_64-linux-gnu/ld-2.23.so\n7f58d2c55000-7f58d2c56000 rw-p 00000000 00:00 0 \n7ffc9a6f7000-7ffc9a719000 rw-p 00000000 00:00 0                          [stack]\n7ffc9a74f000-7ffc9a752000 r--p 00000000 00:00 0                          [vvar]\n7ffc9a752000-7ffc9a754000 r-xp 00000000 00:00 0                          [vdso]\nffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]\nAbandon (core dumped)\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monadfix"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522683346, "post_id": 49613641, "comment_id": 86234795, "body": "Clarification: by &quot;in the same way as above&quot;, I suppose you mean &quot;fails if the function ever evaluates to <code>Nothing</code>&quot;?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1522683574, "post_id": 49613641, "comment_id": 86234922, "body": "Can you give a concrete function which causes the existing <code>MaybeT</code> implementation of <code>mfix</code> to throw its error, witnessing the partiality? I tried, and returning <code>Nothing</code> simply wasn&#39;t enough; e.g. <code>mfix (\\x -&gt; MaybeT [Nothing]) :: MaybeT [] ()</code> works just fine. On the other hand, it is easy to observe your implementation being partial; e.g. <code>mfix&#39; (\\x -&gt; MaybeT [Nothing]) :: MaybeT [] ()</code> (the exact same call, but with <code>mfix&#39;</code> instead of <code>mfix</code>) never returns."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1522684000, "post_id": 49613641, "comment_id": 86235150, "body": "Yes. I have a theory: the argument of <code>mfix :: Maybe a -&gt; m (Maybe a)</code> can only be one of 2 kinds of functions: it can either pattern  match over the argument in which case <code>mfix</code> evaluates to bottom, or it is a constant function in which case we <code>mfix</code> just evaluates to the value. The implementation I present above wraps the function in a pattern match, thereby making <code>mfix</code> always a bottom."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1522690789, "post_id": 49615472, "comment_id": 86238617, "body": "Nice! Thanks a lot"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1522688722, "creation_date": 1522688722, "answer_id": 49615472, "question_id": 49613641, "link": "https://stackoverflow.com/questions/49613641/why-is-mfix-not-total-in-maybet/49615472#49615472", "title": "Why is `mfix` not total in `MaybeT`", "body": "<p>I think the issue is just that the <code>error</code> message is misleading. Let's just focus on <code>MonadFix Maybe</code>. The argument to <code>mfix</code> can be one of four things.</p>\n\n<ol>\n<li><p>It can be strict in the input: <code>f _|_ = _|_</code> or \"<code>f</code> needs to evaluate its input to decide whether it will return <code>Nothing</code> or <code>Just</code>\"</p>\n\n<pre><code>\\x -&gt; if x then Nothing else Just True\n\\x -&gt; x `seq` Nothing\n\\x -&gt; x `seq` Just x\n</code></pre></li>\n<li><p>It can be <code>const Nothing</code>.</p></li>\n<li><p>It can be <code>Just . f</code> where <code>f</code> is not strict.</p>\n\n<pre><code>Just . (1:)\n</code></pre></li>\n<li><p>It can be <code>Just . f</code> where <code>f</code> is strict.</p>\n\n<pre><code>Just\n</code></pre></li>\n</ol>\n\n<p>If the function is strict, then the whole thing blows up in an infinite loop (just like <code>fix</code>), and the error isn't seen because we don't know whether we would have had a <code>Nothing</code> or a <code>Just</code>. If it is <code>const Nothing</code>, the function never actually tries to evaluate the <code>error</code> and nothing happens. If it is <code>Just . f</code> and <code>f</code> is not strict, then it's just <code>Just $ fix f</code> (as per the laws: <code>mfix $ return . f = return $ fix f</code>). And, if <code>f</code> is strict, we get <code>Just _|_</code> (again, per the laws). Notice that we never see the <code>error</code> triggered.</p>\n\n<p>Similar reasoning works for <code>MonadFix (MaybeT m)</code>. I think this time it's better just with an example:</p>\n\n<pre><code>runMaybeT $ mfix $ \\x -&gt; MaybeT $\n             (x `seq` Nothing) :\n             Nothing           :\n             (Just (1:x))      :\n             (Just x)          :\n             (x `seq` [])\n</code></pre>\n\n<p>Each of the four cases I listed above are in that list. The first element of the result is an infinite loop. The second is <code>Nothing</code>. The third is <code>repeat 1</code>, and the fourth is <code>Just</code> an infinite loop. Trying to access the \"elements\" beyond that triggers another infinite loop, this time caused by <code>[]</code>'s <code>MonadFix</code> and not <code>MaybeT</code>'s. Again, I don't believe it's possible to trigger the <code>error</code>, because the function would have to force the argument after already deciding that the result was <code>Nothing</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522735597, "post_id": 49618340, "comment_id": 86253534, "body": "While you&#39;re here.... Would you care to check that the <code>MonadFix Tree</code> instance in the latest version of <code>containers</code> is valid? I waved my hands a bit and added it without a proper proof."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522770124, "post_id": 49618340, "comment_id": 86275544, "body": "@dfeuer That definition looks good to me! While I haven&#39;t carried out the proof, I&#39;m also confident it is also the unique such operator. It would be a nice exercise to show uniqueness using a similar argument to the one given for the list monad in Proposition 4.3.3 of <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">leventerkok.github.io/papers/erkok-thesis.pdf</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522858323, "post_id": 49618340, "comment_id": 86320450, "body": "thanks! I&#39;m confident that it&#39;s unique up to laziness details. However, there may be some wiggle room in the laziness."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522858802, "post_id": 49618340, "comment_id": 86320735, "body": "One can imagine using a lazier version of <code>(!!)</code> as you walk through the children. Is that what you&#39;re referring to as the laziness details? I doubt it&#39;d make any difference though, since the spine of the list is well defined at that point."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522943371, "post_id": 49618340, "comment_id": 86364238, "body": "For lists, the next cons is calculated from the current element. In a tree, perhaps the next cons in a forest could be calculated from the left instead of from above. I don&#39;t know if it makes any difference; I don&#39;t have much intuition about <code>MonadFix</code>. I also find it hard to imagine a situation where the instances for lists, trees, etc., would be useful."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1522947419, "post_id": 49618340, "comment_id": 86366695, "body": "Once you compute <code>f undefined</code>, you will know exactly what the shape of that forest is at the top-level, i.e., exactly how many elements it has or if it&#39;s terminating etc. by monotonicity. So, it doesn&#39;t matter at all. I do, however, agree that the tree/list/rose-tree etc. instances are unlikely to be useful. All examples I&#39;ve seen for such esoteric cases are more or less artificial. The only example I know that is &quot;useful&quot; is that for Fudgets, which is a kind of a &quot;tree&quot; and models a term-semantics for basic IO; discussed in Section 4.8 of the thesis."}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 2, "last_activity_date": 1522768063, "last_edit_date": 1522768063, "creation_date": 1522700922, "answer_id": 49618340, "question_id": 49613641, "link": "https://stackoverflow.com/questions/49613641/why-is-mfix-not-total-in-maybet/49618340#49618340", "title": "Why is `mfix` not total in `MaybeT`", "body": "<p>The definition of <code>bomb</code> is indeed very confusing in the quoted library definition, though the function itself is correctly implemented. By monotonicity, any function <code>f</code> that satisfies <code>f undefined = Nothing</code> has to equal <code>const Nothing</code>. Thus, the fixed-point computation will simply produce the correct answer of <code>Nothing</code> wrapped up in the transformer stack.</p>\n\n<p>For details, see section 4.9 of <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">this work</a>, though the original definition omits the constructors for clarity and the name <code>ErrT</code> is used instead of <code>MaybeT</code>. (MTL didn't exist back in those days!) The definition there is given as follows:</p>\n\n<pre><code>mfixErrM :: (\u03b1 \u2192 ErrT m \u03b1) \u2192 ErrT m \u03b1\nmfixErrM f = mfixM (f \u00b7 unErr)\n     where unErr (Ok a) = a\n</code></pre>\n\n<p>There's also a proof in appendix <a href=\"http://leventerkok.github.io/papers/erkok-thesis.pdf\" rel=\"nofollow noreferrer\">B.7</a> to show that this is a valid value-recursion operator for <code>ErrT m</code> whenever the underlying <code>mfixM</code> is a valid value-recursion operator for <code>m</code>.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "accepted_answer_id": 49615472, "answer_count": 2, "score": 1, "last_activity_date": 1522768063, "creation_date": 1522681198, "question_id": 49613641, "link": "https://stackoverflow.com/questions/49613641/why-is-mfix-not-total-in-maybet", "title": "Why is `mfix` not total in `MaybeT`", "body": "<p>The <a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/src/Control.Monad.Trans.Maybe.html#line-186\" rel=\"nofollow noreferrer\">transformers implementation</a> of <code>MonadFix</code> for <code>MaybeT</code> fails if the function ever evaluates to <code>Nothing</code>. Why is <code>Nothing</code> not propagating over <code>mfix</code>?</p>\n\n<pre><code>mfix' :: MonadFix m =&gt; (a -&gt; MaybeT m a) -&gt; MaybeT m a\nmfix' f = MaybeT $ mfix $ \\case\n  Nothing -&gt; return Nothing\n  Just x -&gt; runMaybeT $ f x\n</code></pre>\n\n<p>There must be a good reason that I do not see because <code>ListT</code> does not implement <code>MonadFix</code> at all, and <code>Maybe</code> implements it <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/src/Control.Monad.Fix.html#line-66\" rel=\"nofollow noreferrer\">in the same way</a> as above.</p>\n"}, {"tags": ["haskell", "opengl"], "comments": [{"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522683588, "post_id": 49613461, "comment_id": 86234933, "body": "I don&#39;t know haskell, but <a href=\"http://hackage.haskell.org/package/GLUT-2.7.0.13/docs/Graphics-UI-GLUT-Window.html#v:postRedisplay\" rel=\"nofollow noreferrer\">postRedisplay</a> seems to me what you need for &quot;forcing&quot; a redrawn."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522684240, "post_id": 49613461, "comment_id": 86235287, "body": "So I should include it in the <code>KeyboardCallback</code> ? I&#39;ll try later. I&#39;m currently installing my package on a better computer to check whether the performance is better."}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522685370, "post_id": 49613461, "comment_id": 86235819, "body": "Yes, in all callbacks (keyboard, mouse, window resize, etc) that imply a window redraw. Don&#39;t do it in <code>idleCallback</code>, you may get an endless loop."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522686312, "post_id": 49613461, "comment_id": 86236288, "body": "@Ripi2 Yes you&#39;re right, this works in the <code>KeyBoardCallBack</code>. Thanks."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522687064, "post_id": 49613461, "comment_id": 86236661, "body": "@Ripi2 And that strongly improves the slowness problem (but this is still slow nevertheless). Do you want to write an answer?"}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1522687300, "post_id": 49613461, "comment_id": 86236761, "body": "As I said, I don&#39;t know Haskell. But you can write the answer, showing some useful code, and accept it."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1522687789, "creation_date": 1522687789, "answer_id": 49615261, "question_id": 49613461, "link": "https://stackoverflow.com/questions/49613461/controlling-the-idlecallback-in-haskell-opengl-or-triggering-the-displaycall/49615261#49615261", "title": "Controlling the &quot;IdleCallback&quot; in Haskell OpenGL (or triggering the &quot;DisplayCallback&quot;)", "body": "<p>Thanks to @Ripi2, I've found the solution. It's indeed better to do </p>\n\n<pre><code>idleCallback $= Nothing\n</code></pre>\n\n<p>in the <code>main</code> file, and then to trigger the <code>DisplayCallback</code> in the <code>KeyboardCallback</code>, with the help of <code>postRedisplay</code>. More precisely, I've replaced</p>\n\n<pre><code>keyboard :: IORef GLfloat -&gt; IORef GLfloat -&gt; IORef GLfloat -- rotations\n         -&gt; IORef Double -&gt; IORef Double -- parameters a and b\n         -&gt; IORef Double -- isolevel\n         -&gt; IORef Double -- zoom\n         -&gt; KeyboardCallback\nkeyboard rot1 rot2 rot3 a b l zoom c _ = \n  case c of\n    'e' -&gt; rot1 $~! subtract 2\n    'r' -&gt; rot1 $~! (+ 2)\n    .......\n    'q' -&gt; leaveMainLoop\n    _   -&gt; return ()\n</code></pre>\n\n<p>with</p>\n\n<pre><code>keyboard :: IORef GLfloat -&gt; IORef GLfloat -&gt; IORef GLfloat -- rotations\n         -&gt; IORef Double -&gt; IORef Double -- parameters a and b\n         -&gt; IORef Double -- isolevel\n         -&gt; IORef Double -- zoom\n         -&gt; KeyboardCallback\nkeyboard rot1 rot2 rot3 a b l zoom c _ = do\n  case c of\n    'e' -&gt; rot1 $~! subtract 2\n    'r' -&gt; rot1 $~! (+ 2)\n    .......\n    'q' -&gt; leaveMainLoop\n    _   -&gt; return ()\n  postRedisplay Nothing\n</code></pre>\n\n<p>This improves the slowness problem as expected (but it's still slow however).</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 49615261, "answer_count": 1, "score": 1, "last_activity_date": 1522687789, "creation_date": 1522680497, "last_edit_date": 1522681384, "question_id": 49613461, "link": "https://stackoverflow.com/questions/49613461/controlling-the-idlecallback-in-haskell-opengl-or-triggering-the-displaycall", "title": "Controlling the &quot;IdleCallback&quot; in Haskell OpenGL (or triggering the &quot;DisplayCallback&quot;)", "body": "<p>I have done a package to draw implicit surfaces with OpenGL in Haskell. It is available in <a href=\"https://github.com/stla/opengl-implicit\" rel=\"nofollow noreferrer\">my github repo</a>. But it is extremely slow and that's why I have a dozen of questions about my practice of Haskell OpenGL. Here is a first one.</p>\n\n<p>I always define this <code>idleCallback</code>:</p>\n\n<pre><code>idle :: IdleCallback\nidle = postRedisplay Nothing\n</code></pre>\n\n<p>and in the <code>main</code> file I include it with:</p>\n\n<pre><code>  idleCallback $= Just idle\n</code></pre>\n\n<p>Then, when I do that, I have noticed the following thing. If I include for example</p>\n\n<pre><code>putStrLn \"hello\"\n</code></pre>\n\n<p>in the <code>DisplayCallback</code>, then, when I run the program, <code>hello</code> is repeatedly printed in the terminal window at a phenomenal speed. This means the <code>DisplayCallback</code> is \"scanned\" each time <code>hello</code> is printed. So if my <code>DisplayCallBack</code> generates e.g. a myriad of triangles to be displayed, I'm afraid this repeated \"scanning\" should cause an issue. No ?</p>\n\n<p>And this is due to the <code>IdleCallback</code>. Indeed, I have tried</p>\n\n<pre><code>  idleCallback $= Nothing\n</code></pre>\n\n<p>Then the graphics is displayed as expected and:</p>\n\n<ol>\n<li><code>hello</code> does not repeatedly appear anymore on the terminal window</li>\n<li>the \"actions\" I defined in <code>KeyboardCallback</code> (such as rotation of the graphic) do not work anymore except if - see 3</li>\n<li>but, if I press a key generating such an action, while it has no direct effect, its effect correctly occurs <em>after I press the left mouse button</em>, and <code>hello</code> appears on the screen; thus it seems that the left mouse button triggers the \"redisplay\" of the graphic (the <code>DisplayCallback</code>).</li>\n</ol>\n\n<p>Therefore I'm wondering: isn't it preferable to always do <code>idleCallback $= Nothing</code> and then to do something (but <strong>what/how</strong>, that's my question) that triggers the \"redisplay\" when one presses a key introduced in the <code>KeyboardCallback</code> ?</p>\n\n<p>I don't think that would overcome my slowness problem but anyway this is one of the questions I'm wondering about. Hope the question is clear...</p>\n\n<p>To sum up, the <code>DisplayCallback</code> is always updated even if it doesn't need to be updated, when one does <code>idleCallback $= Just idle</code>. I'm looking for something which updates the <code>DisplayCallback</code> only when needed, i.e. when and only when we press a key introduced in the <code>KeyboardCallback</code> or another such callback (<code>MouseCallback</code>, etc). </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1522674210, "post_id": 49611620, "comment_id": 86230187, "body": "A little note, don&#39;t use tryhaskell.org, it&#39;s very limited. A better online REPL is avaiable at <a href=\"https://www.repl.it/languages/haskell\" rel=\"nofollow noreferrer\">repl.it</a>, and elsewhere."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1522677592, "post_id": 49611620, "comment_id": 86231924, "body": "the type errors privide location information, and more info which would help to understand the issue without reproducing it"}], "answers": [{"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 5, "creation_date": 1522680956, "post_id": 49611655, "comment_id": 86233626, "body": "Going along with that, what I&#39;ve started recommending (for people who have a sufficiently new version of <code>ghc</code>) is to simply never use <code>return</code>, and when you actually do need a monadic unit, use <code>pure</code>, which does the same thing without the unfortunate naming implications."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 12, "last_activity_date": 1522676102, "last_edit_date": 1522676102, "creation_date": 1522673460, "answer_id": 49611655, "question_id": 49611620, "link": "https://stackoverflow.com/questions/49611620/haskell-couldnt-match-type-char-with-char/49611655#49611655", "title": "Haskell - Couldn&#39;t match type `[Char]&#39; with `Char&#39;", "body": "<p>One of the unfortunate things in the design of the <code>Monad</code> typeclass, is that they introduced a <em>function</em> called <code>return</code>. But although in many imperative programming languages <code>return</code> is a keyword to return content, in Haskell <code>return</code> has a totally different meaning, it does <em>not</em> really return something.</p>\n\n<p>You can solve the problem by dropping the <code>return</code>:</p>\n\n<pre><code>splitStringOnDelimeter :: String -&gt; Char -&gt; [String]\nsplitStringOnDelimeter \"\" delimeter = <b>[\"\"]</b>\nsplitStringOnDelimeter string delimeter =\n    let split = splitStringOnDelimeter (tail string) delimeter <b>in</b>\n    if head string == delimeter\n    then <b>([\"\"] ++ split)</b>\n    else <b>( [( [(head string)] ++ (head split) )] ++ (tail split))</b></code></pre>\n\n<p>The <code>return :: Monad m =&gt; a -&gt; m a</code> is used to wrap a value (of type <code>a</code>) in a monad. Since here your signature hints about a list, Haskell will assume that you look for the list monad. So that means that you <code>return</code> would wrap <code>[\"\"]</code> into another list, so implicitly with <code>return [\"\"]</code> you would have written (in this context), <code>[[\"\"]]</code>, and this of course does <em>not</em> match with <code>[String]</code>.</p>\n\n<p>The same goes for <code>do</code>, again you them make a monadic function, but here your function has not much to do with monads.</p>\n\n<p>Note that the name <code>return</code> is not <em>per se</em> bad, but since nearly all imperative languages attach an (almost) equivalent meaning to it, most people assume that it works the same way in functional languages, but it does not.</p>\n\n<p>Mind that you use functions like <code>head</code>, <code>tail</code>, etc. These are usually seen as anti-patterns: you can use pattern matching instead. We can rewrite this to:</p>\n\n<pre><code>splitStringOnDelimeter :: String -&gt; Char -&gt; [String]\nsplitStringOnDelimeter \"\" delimeter = [\"\"]\nsplitStringOnDelimeter (h:t) delimeter | h == delimeter = \"\" : split\n                                       | otherwise = (h : sh) : st\n    where split@(sh:st) = splitStringOnDelimeter t delimeter</code></pre>\n\n<p>By using pattern matching, we know for sure that the <code>string</code> has a head <code>h</code> and a tail <code>t</code>, and we can directly use these into the expression. This makes the expression shorter as well as more readable. Although <code>if</code>-<code>then</code>-<code>else</code> clauses are not per se anti-patterns, personally I think guards are syntactically more clean. We thus use a <code>where</code> clause here where we call <code>splitStringOnDelimter t delimeter</code>, and we pattern match this with <code>split</code> (as well as with <code>(sh:st)</code>. We know that this will always match, since both the basecase and the inductive case always produce a list with at least one element. This again allows use to write a neat expression where we can use <code>sh</code> and <code>st</code> directly, instead of calling <code>head</code> and <code>tail</code>.</p>\n\n<p>If I test this function locally, I got:</p>\n\n<pre><code>Prelude&gt; splitStringOnDelimeter \"foo!bar!!qux\" '!'\n[\"foo\",\"bar\",\"\",\"qux\"]\n</code></pre>\n\n<p>As <em>take-away message</em>, I think you better avoid using <code>return</code>, and <code>do</code>, unless you know what this function and keyword (<code>do</code> is a keyword) really mean. In the context of functional programming these have a different meaning.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 4956000, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a58e7c6cf4b4a3756deffa6711867adc?s=128&d=identicon&r=PG&f=1", "display_name": "fsestini", "link": "https://stackoverflow.com/users/4956000/fsestini"}, "is_accepted": false, "score": 0, "last_activity_date": 1522715560, "creation_date": 1522715560, "answer_id": 49620595, "question_id": 49611620, "link": "https://stackoverflow.com/questions/49611620/haskell-couldnt-match-type-char-with-char/49620595#49620595", "title": "Haskell - Couldn&#39;t match type `[Char]&#39; with `Char&#39;", "body": "<p><code>return</code> has type <code>forall m a. Monad m =&gt; a -&gt; m a</code>. \nThe output type of the function <code>splitStringOnDelimiter</code> is <code>[String]</code>, so if you try to write some output value using <code>return</code>, the compiler will infer that you want to provide some <code>m a</code>, thus instantiating <code>m</code> to <code>[]</code> (which is indeed an instance of the Monad typeclass), and <code>a</code> to <code>String</code>. It follows that the compiler will now expect some <code>String</code> to be used as argument of <code>return</code>. This expectation is violated in, for example, <code>return ([\"\"] ++ split)</code>, because here the argument of <code>return</code>, namely <code>[\"\"] ++ split</code> has type <code>[String]</code> rather than <code>String</code>.</p>\n\n<p><code>do</code> is used as a convenient notation for monadic code, so you should rely on it only if you are interested in using the monadic operations of the output type. In this case, you really just want to manipulate lists using pure functions.</p>\n\n<p>I'll add my 2 cents and suggest a solution. I used a <code>foldr</code>, that is a simple instance of a <a href=\"http://blog.sumtypeofway.com/an-introduction-to-recursion-schemes/\" rel=\"nofollow noreferrer\">recursion scheme</a>. Recursion schemes like <code>foldr</code> capture common patterns of computation; they make recursive definitions clear, easy to reason about, and <em>total</em> by construction.</p>\n\n<p>I also took advantage of the fact that the output list is always <em>non-empty</em>, so I wrote it in the type. By being more precise about my intentions, I now know that <code>split</code>, the result of the recursive call, is a <code>NonEmpty String</code>, so I can use the <em>total</em> functions <code>head</code> and <code>tail</code> (from <code>Data.List.NonEmpty</code>), because a non-empty list has <em>always</em> a head and a tail.</p>\n\n<pre><code>import Data.List.NonEmpty as NE (NonEmpty(..), (&lt;|), head, tail)\n\nsplitStringOnDelimeter :: String -&gt; Char -&gt; NonEmpty String\nsplitStringOnDelimeter string delimiter = foldr f (pure \"\") string\n  where f h split = if h == delimiter \n                      then (\"\" &lt;| split) \n                      else (h : NE.head split) :| NE.tail split\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 6063754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6180e616f692ef645944c08fd4089e?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Smith", "link": "https://stackoverflow.com/users/6063754/elliot-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 49611655, "answer_count": 2, "score": 4, "last_activity_date": 1522715560, "creation_date": 1522673303, "last_edit_date": 1522674220, "question_id": 49611620, "link": "https://stackoverflow.com/questions/49611620/haskell-couldnt-match-type-char-with-char", "title": "Haskell - Couldn&#39;t match type `[Char]&#39; with `Char&#39;", "body": "<p>I currently have the following code in Haskell</p>\n\n<pre><code>splitStringOnDelimeter :: String -&gt; Char -&gt; [String]\n\nsplitStringOnDelimeter \"\" delimeter = return [\"\"]\n\nsplitStringOnDelimeter string delimeter = do\n    let split = splitStringOnDelimeter (tail string) delimeter\n    if head string == delimeter\n    then return ([\"\"] ++ split)\n    else return ( [( [(head string)] ++ (head split) )] ++ (tail split))\n</code></pre>\n\n<p>If I run it in a Haskell terminal (i.e. <a href=\"https://www.tryhaskell.org\" rel=\"nofollow noreferrer\">https://www.tryhaskell.org</a>) with values for the return statement such as <code>( [( [(head \"ZZZZ\")] ++ (head [\"first\", \"second\", \"third\"]) )] ++ (tail [\"first\", \"second\", \"third\"]))</code> or <code>[\"\"] ++ [\"first\", \"second\", \"third\"]</code> or <code>[\"\"]</code> then I receive the correct types from the terminal which is different to my local stack compiler. Furthermore, if I also change the top return statement to <code>return \"\"</code> then it doesn't complain about that statement which I'm pretty sure is incorrect.</p>\n\n<p>My local compiler works fine with the rest of my Haskell codebase which is why I think it might be something wrong with my code...</p>\n"}, {"tags": ["haskell", "github", "haskell-stack"], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1522668161, "creation_date": 1522667317, "last_edit_date": 1522668161, "question_id": 49610110, "link": "https://stackoverflow.com/questions/49610110/it-it-possible-to-store-stacks-custom-snaphot-in-a-private-github-repository", "title": "It it possible to store stack&#39;s custom snaphot in a private github repository?", "body": "<p>Currenly I use</p>\n\n<pre><code>- resolver: https://raw.githubusercontent.com/blah-blah/stack-snapshot/10/snapshot.yaml\n</code></pre>\n\n<p>where <code>blah-blah</code> is a public repo. But once I make it private, it becomes something like</p>\n\n<pre><code>- resolver: https://raw.githubusercontent.com/blah-blah/stack-snapshot/10/snapshot.yaml?token=AJ_tHmg3nl_bW6LdG9DSgzIIKs0zqKICks2by0i4wA%3D%3D\n</code></pre>\n\n<p>I.e. there is an additional token. <code>stack</code> doesn't like this and doesn't pick up the snapshot.</p>\n\n<p>Is there a way to make such a github link for a private repo that <code>stack</code> understands it and picks up the custom snapshot?</p>\n"}, {"tags": ["haskell", "visual-studio-code", "vscode-tasks"], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1522686917, "post_id": 49609720, "comment_id": 86236592, "body": "thank you for your information, which might be part of my question. When I look at the serttings in the tab you indicate, I do not find the build commands. Where are they hidden? I have the impression, that the tasks are not stored in the workspace or user settings?"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1522665662, "creation_date": 1522665662, "answer_id": 49609720, "question_id": 49608714, "link": "https://stackoverflow.com/questions/49608714/tasks-for-stack-in-vs-code/49609720#49609720", "title": "tasks for stack in VS code", "body": "<p>I'm not sure if this is the problem you run into, but Visual Studio Code gives you the ability to edit settings per work-space/project in addition to overall settings:</p>\n\n<p><a href=\"https://i.stack.imgur.com/acHSs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/acHSs.png\" alt=\"Visual Studio Code User Settings and Workspace Settings tabs\"></a></p>\n\n<p>Make sure that you're editing the <em>USER SETTINGS</em> tab instead of the <em>WORKSPACE SETTINGS</em> tab, if you want the settings to all projects.</p>\n\n<p>Apologies if this is a trivial answer, and the problem is something completely different.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1545916396, "creation_date": 1522661483, "last_edit_date": 1545916396, "question_id": 49608714, "link": "https://stackoverflow.com/questions/49608714/tasks-for-stack-in-vs-code", "title": "tasks for stack in VS code", "body": "<p>I am new to VS code (1.21.1) with HIE 0.1.0.0 - installed using stack. I have been able to define a task for testing: </p>\n\n<pre><code>{\n    // See https://go.microsoft.com/fwlink/?LinkId=733558\n    // for the documentation about the tasks.json format\n    \"version\": \"2.0.0\",\n    \"tasks\": [\n        {\n            \"label\": \"test\",\n            \"type\": \"shell\",\n            \"command\": \"stack build --test\",\n            \"group\": {\n                \"kind\": \"build\",\n                \"isDefault\": true\n            }\n        }\n    ]\n} \n</code></pre>\n\n<p>I checked the documentation mentioned but did not understand much. \nThis task works only on the project I specified it for; how to make it usable for any project I happen to have open in the editor? How to further automate the selection of tasks?</p>\n\n<p>I assume that there is somewhere a collection of tasks to run stack with HIE - could somebody point me to it?</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522680466, "post_id": 49607322, "comment_id": 86233366, "body": "Not a conduit expert, but your mention of <code>Chan</code> makes me wonder what you think of the alternate type signature <code>ConduitT i o m r -&gt; ConduitT i ([i], o) (StateT [i] m) r</code>. Might be easier to implement."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1522686990, "post_id": 49607322, "comment_id": 86236620, "body": "What should happen when no <code>o</code> is produced for an <code>i</code>, or when multiple <code>o</code>s are produced for an <code>i</code>?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1522693307, "post_id": 49607322, "comment_id": 86240023, "body": "@danidiaz If <code>i</code>s are &#39;skipped&#39; then they could probably arbitrarily show up in the output list of the next <code>o</code> that does pop out.  &quot;multiple <code>o</code>s are produced for an <code>i</code>&quot; would probably arbitrarily associate the single <code>i</code> with the first <code>o</code> that saw it, and the others would be passed along with empty lists."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522694428, "post_id": 49607322, "comment_id": 86240546, "body": "@DanielWagner thanks for the tip!  That ended up working actually!  I added an <code>iterM (\\x -&gt; modify (x:))</code> to the chain after the <code>i</code> producer, and then can <code>state (,[])</code> to flush and grab all of the items in the part where I test the <code>o</code>s.  This will probably work for now, unless there is a more &quot;native&quot; way that comes up here :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522694784, "post_id": 49607322, "comment_id": 86240736, "body": "@JustinL. You should write up a few details in the &quot;Your Answer&quot; box below! (Don&#39;t worry; though it may seem a bit weird, answering your own question is considered exemplary behavior on StackOverflow.)"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1522657603, "creation_date": 1522655214, "last_edit_date": 1522657603, "question_id": 49607322, "link": "https://stackoverflow.com/questions/49607322/side-channel-pass-through-combinator-for-haskell-conduit", "title": "Side-channel pass-through combinator for haskell conduit?", "body": "<p>Is there any combinator:</p>\n\n<pre><code>ConduitT i o m r -&gt; CondiutT i ([i], o) m r\n</code></pre>\n\n<p>That passes through the inputs to be consumed downstream?</p>\n\n<p>If not, is there any way to create this in a clean way using the combinators available in the core package?</p>\n\n<p>The \"actual problem\" I have -- I am composing/mapping these with a \"test\" function to test the original <code>ConduitT i o m r</code>, to check that each resulting <code>o</code> makes sense with the <code>i</code>s that it saw.  I'd be either mapping a <code>([i],o) -&gt; Bool</code> function, or composing it with some <code>ConduitT ([i], o) Bool m r</code> which outputs a <code>Bool</code> for every <code>([i], o)</code> received, with some potential monadic effects.  It might be that there is a better way to do all of this!  One way I have thought of is to use a Chan/TChan if m is IO, but I might not necessarily be doing this in IO.</p>\n\n<p>I've tried simply composing/mapping the <code>o</code> results of the <code>ConduitT i o</code>, but I don't have any access to the <code>i</code>s that it consumed, so I'm a bit stuck; this pass-through operator is one what I thought of that might help.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1522652785, "post_id": 49606591, "comment_id": 86220220, "body": "You can\u2019t.  Unless you use FunctionalDependencies."}, {"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522653830, "post_id": 49606591, "comment_id": 86220611, "body": "@augustss Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "edited": false, "score": 0, "creation_date": 1522653817, "post_id": 49606878, "comment_id": 86220607, "body": "Thank you! That&#39;s what I want."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1522653129, "creation_date": 1522653129, "answer_id": 49606878, "question_id": 49606591, "link": "https://stackoverflow.com/questions/49606591/haskell-how-can-i-set-polymorphic-types-of-arguments-and-return-types/49606878#49606878", "title": "Haskell: How can I set polymorphic types of arguments and return types", "body": "<p>Change the type of <code>poly</code>? Right now nothing keeps you (or some random library) from adding e.g. a <code>Poly Double Int</code> instance, which is why the type of <code>3</code> in <code>poly 3</code> is ambiguous.</p>\n\n<p>You could do</p>\n\n<pre><code>instance Poly a where\n    poly :: a -&gt; a\n</code></pre>\n\n<p>That would nail down the type of <code>poly 3 :: Int</code>, but it would make <code>poly</code> less general.</p>\n\n<p>You could enable <code>FunctionalDependencies</code> and do</p>\n\n<pre><code>instance Poly a b | b -&gt; a where\n    poly :: a -&gt; b\n</code></pre>\n\n<p>Then <code>poly 3 :: Int</code> would be OK, because <code>b</code> is declared as uniquely determining <code>a</code>.</p>\n\n<p>You could also enable <code>TypeFamilies</code> and use an associated type:</p>\n\n<pre><code>class Poly b where\n    type Arg b :: *\n    poly :: Arg b -&gt; b\n\ninstance Poly Int where\n    type Arg Int = Int\n    poly x = x\n</code></pre>\n\n<p>Again, this lets ghc derive the argument type from the result type, so <code>poly 3 :: Int</code> typechecks.</p>\n"}], "owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 49606878, "answer_count": 1, "score": 2, "last_activity_date": 1522653129, "creation_date": 1522651657, "question_id": 49606591, "link": "https://stackoverflow.com/questions/49606591/haskell-how-can-i-set-polymorphic-types-of-arguments-and-return-types", "title": "Haskell: How can I set polymorphic types of arguments and return types", "body": "<p>I want to define a set of functions in polymorphic type of arguments and return types, just as below.</p>\n\n<pre><code>class Poly a b where\n  poly :: a -&gt; b\n\ninstance Poly Int Int where\n  poly :: Int -&gt; Int\n  poly a = a\n</code></pre>\n\n<p>When I test it in ghci, using <code>poly 3 :: Int</code> and then it gives me errors:</p>\n\n<pre><code>*Poly&gt; poly 3 :: Int\n\n&lt;interactive&gt;:486:1: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018poly\u2019\n      prevents the constraint \u2018(Poly a0 Int)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instance exist:\n        instance Poly Int Int\n          -- Defined at OneFunctionManyArguments.hs:10:10\n    \u2022 In the expression: poly 3 :: Int\n      In an equation for \u2018it\u2019: it = poly 3 :: Int\n\n&lt;interactive&gt;:486:6: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from the literal \u20183\u2019\n      prevents the constraint \u2018(Num a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Num Integer -- Defined in \u2018GHC.Num\u2019\n        instance Num Double -- Defined in \u2018GHC.Float\u2019\n        instance Num Float -- Defined in \u2018GHC.Float\u2019\n        ...plus two others\n        ...plus 46 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018poly\u2019, namely \u20183\u2019\n      In the expression: poly 3 :: Int\n      In an equation for \u2018it\u2019: it = poly 3 :: Int\n</code></pre>\n\n<p>When I use <code>poly (3 :: Int) :: Int</code>, it returns me the right value <code>3</code>...\nI would like to know how to get rid of the tedious <code>:: Int</code> declaration?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": false, "score": 7, "last_activity_date": 1522650844, "creation_date": 1522650844, "answer_id": 49606411, "question_id": 49606011, "link": "https://stackoverflow.com/questions/49606011/how-is-this-expression-evaluated/49606411#49606411", "title": "How is this expression evaluated?", "body": "<p>It\u2019s impossible to say how it\u2019s evaluated unless you specify how the result of <code>splitLines</code> is going to be used.  Lazy evaluation does as little as possible. E.g., if you test the result with <code>null</code> then <code>break</code> is never called.  If you take the head and use that, <code>break</code> is called, but the <code>case</code> is never evaluated. And so on. </p>\n"}, {"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522651274, "post_id": 49606427, "comment_id": 86219667, "body": "No. You don\u2019t need to evaluate <code>pre</code> and <code>suf</code> to do the cons.  That would be wrong.  You won\u2019t even call <code>break</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1522651362, "post_id": 49606427, "comment_id": 86219700, "body": "So the let clause can be evaluated whenever it is needed?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522651454, "post_id": 49606427, "comment_id": 86219725, "body": "@augustss Assuming you&#39;re in GHCi and evaluate <code>splitLines &quot;foo\\nbar&quot;</code>, would you still say that <code>break</code> isn&#39;t called?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1522651506, "post_id": 49606427, "comment_id": 86219756, "body": "Yes, it can and will be evaluated when needed.  The pattern matching in <code>let</code> and <code>where</code> is a bit subtle; it doesn\u2019t happen until one of the variables in the pattern is needed."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522651739, "post_id": 49606427, "comment_id": 86219839, "body": "If you evaluate that expression in ghci, of course <code>break</code> is called.  The top level uses <code>print</code> which will fully evaluate. But if you type <code>null $ splitLines \u201ca\\nb\u201d</code> then <code>break</code> is not called.  It all depends on how you use the result of <code>splitLines</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522652005, "post_id": 49606427, "comment_id": 86219948, "body": "@augustss I understand that, which is also why I wrote in my answer that Haskell is lazily evaluated. Based on the question, it seemed to me, however, that it would be more helpful to lead with how typical evaluation would proceed."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1522652093, "post_id": 49606427, "comment_id": 86219987, "body": "@BercoviciAdrian The <code>let</code>-bound symbols are also lazily evaluated expressions, so they&#39;re evaluated when they&#39;re needed."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1522652270, "post_id": 49606427, "comment_id": 86220057, "body": "But the typical evaluation does not proceed as you explained.  Not unless you\u2019ve compiled a very special purpose version for a strict context."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1522652398, "post_id": 49606427, "comment_id": 86220096, "body": "Assuming we have done the top level pattern match, and determined that it is a cons, the function will return at once with a cons of two thunks.  The caller might then evaluate these thunks if they are needed."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1522652706, "post_id": 49606427, "comment_id": 86220196, "body": "You can trust me on this, I\u2019m one of the two people who invented compiled graph reduction, which is what ghc uses (back around 1981-1982). :)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1522653581, "post_id": 49606427, "comment_id": 86220530, "body": "@augustss I <i>do</i> trust you on that, and I upvoted your answer. What I tried to do with my answer was to explain things in terms that a Haskell beginner would find useful. Whether or not I succeeded in that, I&#39;ll let the community decide."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1522656896, "post_id": 49606427, "comment_id": 86221878, "body": "I&#39;d say the exception to &quot;all Haskell functions are defined using a single expression&quot; is <code>where</code>, not <code>do</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1522650899, "creation_date": 1522650899, "answer_id": 49606427, "question_id": 49606011, "link": "https://stackoverflow.com/questions/49606011/how-is-this-expression-evaluated/49606427#49606427", "title": "How is this expression evaluated?", "body": "<p>In principle, all Haskell functions are defined using <em>a single expression</em> (at least, if you ignore <code>do</code> syntax). Contrary to statement-based languages like the C family, a function is just an expression.</p>\n\n<p>Sometimes, though, it can enhance readability if you can break up a function definition in two or more sub-steps. Haskell's <code>let...in</code> syntax enables you to do that.</p>\n\n<p><code>let</code> lets you define one or more names that you can then reference in the <code>in</code> expression. You can define as many names as you want in the <code>let</code> part, but the <code>in</code> part must still be a single expression.</p>\n\n<p>Another option is to use <code>where</code>. You can rewrite the <code>splitLines</code> function using <code>where</code> syntax instead:</p>\n\n<pre><code>splitLines [] = []\nsplitLines cs =\n  pre : case suf of\n          ('\\r':'\\n':rest) -&gt; splitLines rest \n          ('\\r':rest)      -&gt; splitLines rest\n          ('\\n':rest)      -&gt; splitLines rest\n          _            -&gt; []\n  where (pre, suf) = break isLineTerminator cs\n\nisLineTerminator c = c == '\\r' || c == '\\n'\n</code></pre>\n\n<p>In both cases, the expression of <code>splitLines</code> <em>conses</em> <code>pre</code> unto the expression starting with <code>case suf of</code>.</p>\n\n<p>In order to be able to do that, it'll first have to evaluate <code>pre</code> and <code>suf</code>, which are both defined by the expression <code>break isLineTerminator cs</code>. So, in order to evaluate <code>pre</code> and <code>suf</code>, the overall function evaluates <code>break isLineTerminator cs</code>.</p>\n\n<p>It now knows what <code>pre</code> and <code>suf</code> is, so it can evaluate the rest of the <code>case</code> expression and cons the result of that with <code>pre</code>.</p>\n\n<p>Notice that <code>splitLines</code> is recursive, so this'll keep on happening until <code>splitLines</code> hits the base case <code>[]</code>.</p>\n\n<p>Recall that Haskell is lazily evaluated, so all of this only happens just-in-time, when a result is required.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 49606427, "answer_count": 2, "score": 1, "last_activity_date": 1522650899, "creation_date": 1522648511, "last_edit_date": 1522649977, "question_id": 49606011, "link": "https://stackoverflow.com/questions/49606011/how-is-this-expression-evaluated", "title": "How is this expression evaluated?", "body": "<p>I am reading Real World Haskell and i can not understand when is the result of the <code>break</code>  method evaluated.\nIf it starts with the <code>pre:case suf of</code> clause then it has to go in the let clause fetch the tuple that  <code>break</code> method generates  and then treat the case expression?\nOr how does it do it?</p>\n\n<pre><code>splitLines [] = []\nsplitLines cs = \n  let (pre, suf) = break isLineTerminator cs\n  in pre : case suf of\n            ('\\r':'\\n':rest) -&gt; splitLines rest \n            ('\\r':rest)      -&gt; splitLines rest\n            ('\\n':rest)      -&gt; splitLines rest\n            _            -&gt; []\n\nisLineTerminator c = c == '\\r' || c == '\\n'\n</code></pre>\n\n<p>Is it : </p>\n\n<ul>\n<li><p>1.Goes into <code>pre:case suf of</code> </p></li>\n<li><p>2.Goes to let clause determines what <code>pre</code> and <code>suf</code> are</p></li>\n<li><p>3.glues up <code>pre</code> and <code>suf</code> and then treats the case expression?</p></li>\n</ul>\n\n<p>Or what is the order for constructing the case expression?</p>\n"}, {"tags": ["windows", "haskell", "exception"], "comments": [{"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1522646277, "post_id": 49605606, "comment_id": 86218146, "body": "Does <code>test.txt</code> exist?  If yes, what are the contents."}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1522647702, "post_id": 49605606, "comment_id": 86218549, "body": "Yes, text.txt exists. I&#39;m currently on mobile, so I will update it later.  I assume the exception itself is raised due to code page mismatch. Default code page on Japanese machine is Shift-JIS while the file is encoded in UTF8. But I expect the exception should be caught anyway."}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1522651846, "post_id": 49605606, "comment_id": 86219876, "body": "The issue is solved so I will not upload the file."}], "answers": [{"tags": [], "owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "is_accepted": true, "score": 5, "last_activity_date": 1522647608, "creation_date": 1522647608, "answer_id": 49605869, "question_id": 49605606, "link": "https://stackoverflow.com/questions/49605606/haskell-exception-can-not-be-caught-on-windows/49605869#49605869", "title": "Haskell exception can not be caught on Windows", "body": "<p>Since <code>readFile</code> returns a lazy <code>String</code>, it won't evaluate the file content until it is used, in this case, when ghci prints it. You can catch it by forcing to evaluate its content.</p>\n\n<pre><code>import Control.Exception\nimport Control.DeepSeq\n(readFile \"test.txt\" &gt;&gt;= evaluate . force) `catch` (const $ return \"exception caught!\" :: SomeException -&gt; IO String)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "edited": false, "score": 1, "creation_date": 1522649658, "post_id": 49606043, "comment_id": 86219110, "body": "I understand the cause! Thank you for answering the question in detail."}], "tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": false, "score": 4, "last_activity_date": 1522649074, "last_edit_date": 1522649074, "creation_date": 1522648697, "answer_id": 49606043, "question_id": 49605606, "link": "https://stackoverflow.com/questions/49605606/haskell-exception-can-not-be-caught-on-windows/49606043#49606043", "title": "Haskell exception can not be caught on Windows", "body": "<p>This problem is caused by lazy IO and Windows' default locale encoding.</p>\n\n<p>Contrary to your assumption, the file is actually read <strong>after</strong> <code>readFile \"test.txt\"</code>catch<code>(const $ return \"exception caught!\" :: SomeException -&gt; IO String)</code>.<br>\nBy lazy IO, the content of file is read only <strong>when the result value is actually evaulated</strong>.\nAnd the exception you met is caused only when reading the content (explain below).</p>\n\n<p>Evaluating forcibly the file make the <code>catch</code> function do catch:</p>\n\n<pre><code>&gt; (print . length =&lt;&lt; readFile \"test.txt\") `catch` (const $ putStrLn \"Exception caught\" :: SomeException -&gt; IO ())\nException caught\n</code></pre>\n\n<p>In this example, the file is actually read when applying <code>length</code> function, then caught by the <code>catch</code> function.</p>\n\n<p>In addition, the exception is caused because some (perhaps the first) character of <code>test.txt</code> is incompatible with the default character encoding of the handle,\nwhich is CP932 in Japanese Windows.</p>\n\n<p>Try inserting some ASCII characters before the invalid Japanese characters,\nthen you'd find the exception is really thrown when printing (actually evaluating the content of <code>test.txt</code>):</p>\n\n<pre><code>$ cat .\\test.txt\nabc\u4ecb\n$ stack exec ghci\n&gt; import Control.Exception\n&gt; readFile \"test.txt\" `catch` (const $ return \"exception caught!\" :: SomeException -&gt; IO String)\n\"abc\\33673*** Exception: test.txt: hGetContents: invalid argument (invalid byte sequence)\n</code></pre>\n\n<p>If you can read Japanese, see the first section of <a href=\"https://haskell.jp/blog/posts/2017/windows-gotchas.html\" rel=\"nofollow noreferrer\">https://haskell.jp/blog/posts/2017/windows-gotchas.html</a>, written by me! :)</p>\n"}], "owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 49605869, "answer_count": 2, "score": 2, "last_activity_date": 1522649074, "creation_date": 1522645691, "question_id": 49605606, "link": "https://stackoverflow.com/questions/49605606/haskell-exception-can-not-be-caught-on-windows", "title": "Haskell exception can not be caught on Windows", "body": "<p>When I typed following on ghci, the exception is raised:</p>\n\n<pre><code>Prelude&gt; import Control.Exception\nPrelude Control.Exception&gt; readFile \"test.txt\" `catch` (const $ return \"exception caught!\" :: SomeException -&gt; IO String)\n\"*** Exception: test.txt: hGetContents: invalid argument (invalid byte sequence)\n</code></pre>\n\n<p>I do not understand why the exception is not caught. I run the above with <code>stack ghci</code> command on Windows 7. \n(\"test.txt\" file contains some random Japanese Letters encoded in UTF8, but I expect exception should be caught anyway)</p>\n\n<p>Can someone explain why?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1522627873, "post_id": 49603718, "comment_id": 86214804, "body": "I cannot reproduce, probably I don&#39;t understand the question.  This one works fine <code>findNumL $ Branch &quot;root&quot; (leaf &quot;left&quot;) (leaf &quot;right&quot;)</code> and so does this <code>findNumL $ leaf &quot;root&quot;</code>"}, {"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1522628007, "post_id": 49603718, "comment_id": 86214822, "body": "@HenriMenke My apologies. I mean in the function definition, if I try <code>findNumL (leaf x) = 1</code> in the second line of the function definition, the code will not compile."}], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522629065, "post_id": 49603894, "comment_id": 86215000, "body": "does this still keep <code>Leaf</code> as a function <code>a-&gt;Tree</code>?"}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522629145, "post_id": 49603894, "comment_id": 86215008, "body": "@AndresMejia No, but you don&#39;t need it anymore.  You can just use <code>Leaf &quot;x&quot;</code> instead of <code>leaf &quot;x&quot;</code>."}, {"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522629155, "post_id": 49603894, "comment_id": 86215012, "body": "I&#39;m also still getting an error: &quot;data constructor not in scope&quot;"}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522629191, "post_id": 49603894, "comment_id": 86215021, "body": "@AndresMejia Does this happen with the exact example I showed on ideone? <a href=\"https://ideone.com/YAlxEq\" rel=\"nofollow noreferrer\">ideone.com/YAlxEq</a>"}, {"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522629333, "post_id": 49603894, "comment_id": 86215041, "body": "yes, I just copy pasted and loaded it, I got the same error."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522630808, "post_id": 49603894, "comment_id": 86215281, "body": "@AndresMejia What&#39;s your version of GHC?  I have a relatively ancient version from 2015 (7.10.3) and for me it works."}, {"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522631035, "post_id": 49603894, "comment_id": 86215317, "body": "winGHCI that came with Haskell platform 8.2.2 for windows. Hm, that is indeed strange."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522631465, "post_id": 49603894, "comment_id": 86215395, "body": "@AndresMejia I downloaded Haskell Platform 8.2.2 for Linux quickly and I don&#39;t have any problem.  Here is my command line log <a href=\"https://hastebin.com/raw/udezasohep\" rel=\"nofollow noreferrer\">hastebin.com/raw/udezasohep</a>"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 2, "creation_date": 1522657385, "post_id": 49603894, "comment_id": 86222096, "body": "@AndresMejia if you are using GHCI interactively rather than compiling with GHC you may need to <code>:set -XPatternSynonyms</code>"}], "tags": [], "owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "is_accepted": true, "score": 2, "last_activity_date": 1522628764, "creation_date": 1522628764, "answer_id": 49603894, "question_id": 49603718, "link": "https://stackoverflow.com/questions/49603718/pattern-matching-with-functions-in-haskell/49603894#49603894", "title": "pattern matching with functions in Haskell", "body": "<p>You can use the language extension <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PatternSynonyms\" rel=\"nofollow noreferrer\"><code>PatternSynonyms</code></a></p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\ndata Tree a = Empty  | Branch a (Tree a) (Tree a) deriving (Show, Eq)\npattern Leaf a = Branch a Empty Empty\n\nfindNumL:: Tree a-&gt;Integer\nfindNumL (Empty) = 0\nfindNumL (Leaf x) = 1\nfindNumL (Branch x left right) = (findNumL left) + (findNumL right)\n</code></pre>\n\n<p><a href=\"https://ideone.com/YAlxEq\" rel=\"nofollow noreferrer\">Live example</a></p>\n"}], "owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 49603894, "answer_count": 1, "score": 1, "last_activity_date": 1522628764, "creation_date": 1522626496, "question_id": 49603718, "link": "https://stackoverflow.com/questions/49603718/pattern-matching-with-functions-in-haskell", "title": "pattern matching with functions in Haskell", "body": "<p>I've noticed the following peculiarity in Haskell:</p>\n\n<pre><code> data Tree a = Empty  | Branch a (Tree a) (Tree a) deriving (Show, Eq)\n\nleaf:: a-&gt;Tree a\nleaf x = Branch x Empty Empty\n\n\nfindNumL:: Tree a-&gt;Integer\nfindNumL (Empty) = 0\nfindNumL (Branch x Empty Empty) = 1\nfindNumL (Branch x left right) = (findNumL left) + (findNumL right)\n</code></pre>\n\n<p>This is code will run perfectly fine, and it will return the number of leaves in a binary tree. However, if one tries to call the function <code>leaf x</code> instead of <code>Branch x Empty Empty</code>, the pattern recognition breaks down, making the definition of <code>leaf x</code> much less useful than it could be. Is there a way to circumvent this issue and use the <code>leaf</code> in pattern matching?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522654968, "post_id": 49603403, "comment_id": 86221063, "body": "You should always start writing a function from its intended type. In that way, GHC will produce better error messages."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522659676, "post_id": 49603403, "comment_id": 86223080, "body": "I don&#39;t understand the desired output. In your example, the 4-th sublist has been deleted (instead of the 2-th, as one could think), and the order of the sublists has been perturbed in a way I cannot figure out."}], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 2, "last_activity_date": 1522625613, "creation_date": 1522625613, "answer_id": 49603623, "question_id": 49603403, "link": "https://stackoverflow.com/questions/49603403/replace-n-th-item-in-list-of-lists/49603623#49603623", "title": "Replace n-th item in list of lists", "body": "<p>Your code is almost correct, you need to concatenate <code>newVal</code> with the rest of the list so it type-checks. You can also use pattern matching instead of guards. </p>\n\n<pre><code>replaceNth 0 newVal (x:xs) = newVal ++ xs \nreplaceNth n newVal (x:xs) = x : replaceNth (n-1) newVal xs\n</code></pre>\n\n<p>To complete this function, you need to provide a case for the empty list (if applies)</p>\n"}], "owner": {"reputation": 395, "user_id": 4678574, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/dd53f2aecfab73b707f9a1314c12c413?s=128&d=identicon&r=PG&f=1", "display_name": "DRINK", "link": "https://stackoverflow.com/users/4678574/drink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 49603623, "answer_count": 1, "score": 2, "last_activity_date": 1522625613, "creation_date": 1522623618, "question_id": 49603403, "link": "https://stackoverflow.com/questions/49603403/replace-n-th-item-in-list-of-lists", "title": "Replace n-th item in list of lists", "body": "<p>I work on simple function to replace n-th item in list of lists by list of lists.</p>\n\n<p>Input: <code>replaceNth 2 [[\"0\",\"1\"],[\"8\",\"8\"]] [[\"2\",\"3\"],[\"1\",\"2\"],[\"3\",\"4\"],[\"9\",\"12\"]]</code></p>\n\n<p>Expected output: <code>[[\"2\",\"3\"],[\"1\",\"2\"],[\"0\",\"1\"],[\"8\",\"8\"],[\"9\",\"12\"]]</code></p>\n\n<p>Currently I got following code which doesn't work correctly.</p>\n\n<pre><code>replaceNth n newVal (x:xs)\n    | n == 0 = newVal:[xs]\n    | otherwise = [x]++replaceNth (n-1) newVal xs\n</code></pre>\n\n<p>Could you help me to fix the function?</p>\n"}, {"tags": ["haskell", "nginx", "https", "servant"], "answers": [{"tags": [], "owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "is_accepted": false, "score": 3, "last_activity_date": 1522630174, "creation_date": 1522630174, "answer_id": 49604027, "question_id": 49603140, "link": "https://stackoverflow.com/questions/49603140/running-haskell-servant-over-https-with-nginx/49604027#49604027", "title": "Running Haskell servant over https with nginx", "body": "<p>This was because of my \"/api\" prefix in the nginx config. The request got sent to Servant as \"/api/registrations\" but should have been \"/registrations\". Misconfiguration in nginx, nothing to do with Servant and https.</p>\n"}], "owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1522630174, "creation_date": 1522621105, "question_id": 49603140, "link": "https://stackoverflow.com/questions/49603140/running-haskell-servant-over-https-with-nginx", "title": "Running Haskell servant over https with nginx", "body": "<p>I'm trying to figure how I can properly run Servant API endpoint over https with nginx. </p>\n\n<p>So to go through what I've done. So I thought I would probably need to setup Servant so it would communicate over https. So I added this to my code</p>\n\n<pre><code>  Development -&gt; run port $ logStdoutDev $ corsWithContentType $ app cfg\n  Production  -&gt; runTLS (tlsSettings \"./certs/fullchain1.pem\" \"./certs/privkey1.pem\")\n                        (setPort port defaultSettings)\n                        (corsWithContentType $ app cfg)\n</code></pre>\n\n<p>So the Production clause here is what runs on my production server. I then have this in nginx</p>\n\n<pre><code>upstream api_server {\n    server 127.0.0.1:8081;\n}\n\n\nlocation /api {\n    proxy_set_header Host $host;\n    proxy_pass http://api_server;\n}\n\nlisten 443 ssl; # managed by Certbot\nssl_certificate /etc/letsencrypt/live/xxx/fullchain.pem; # managed by Certbot\nssl_certificate_key /etc/letsencrypt/live/xxx/privkey.pem; # managed by Certbot\ninclude /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\nssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n</code></pre>\n\n<p>With this setup I perform an ajax request from the page (which is properly running over https). However when I do this I get a response from the Servant server</p>\n\n<pre><code>InsecureConnectionDenied\n</code></pre>\n\n<p>As if my ajax request is insecure. It was my belief that if I'm making an ajax request form a page with https that request is secure.</p>\n\n<p>If I skip all of this and just run Servant without TLS I get a 405 Method Not Allowed when trying to post. I know this is connected to the https because when I perform a request straight to the IP:PORT of the api it works. What could be the issue here?</p>\n"}, {"tags": ["haskell", "distributed-computing", "cloud-haskell"], "answers": [{"tags": [], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "is_accepted": true, "score": 2, "last_activity_date": 1522618887, "creation_date": 1522618887, "answer_id": 49602898, "question_id": 49602897, "link": "https://stackoverflow.com/questions/49602897/empty-node-list-in-simple-distributed-haskell-cloud-haskell-example/49602898#49602898", "title": "Empty node list in simple Distributed Haskell / Cloud Haskell example", "body": "<p>It turns out that the slaves were binding to IPv6 localhost instead of IPv4:</p>\n\n<pre><code>\u0373 ss -nlp '( sport = 8080 or dport = 8080 )'\nNetid             State               Recv-Q              Send-Q                            Local Address:Port                           Peer Address:Port              \ntcp               LISTEN              0                   128                                       [::1]:8080                                   [::]:* \n</code></pre>\n\n<p>Telling them to bind to <code>127.0.0.1</code> in place of <code>localhost</code> does the trick.</p>\n"}, {"tags": [], "owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "is_accepted": false, "score": 0, "last_activity_date": 1574619354, "creation_date": 1574619354, "answer_id": 59020891, "question_id": 49602897, "link": "https://stackoverflow.com/questions/49602897/empty-node-list-in-simple-distributed-haskell-cloud-haskell-example/59020891#59020891", "title": "Empty node list in simple Distributed Haskell / Cloud Haskell example", "body": "<p>Try giving actual IP of your machine instead of localhost. It worked on my machine. </p>\n\n<pre><code>\u279c  ~ ./minimal-example slave 192.168.1.104 8082 &amp;\n[1] 710\n\u279c  ~ ./minimal-example slave 192.168.1.104 8081 &amp;\n[2] 715\n\u279c  ~ ./minimal-example slave 192.168.1.104 8083 &amp;\n[3] 720\n\u279c  ~ ./minimal-example master 192.168.1.104 8084 &amp;\n[4] 725\n\u279c  ~ Slaves: [nid://192.168.1.104:8081:0,nid://192.168.1.104:8082:0,nid://192.168.1.104:8083:0]\n</code></pre>\n"}], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 49602898, "answer_count": 2, "score": 1, "last_activity_date": 1574619354, "creation_date": 1522618887, "question_id": 49602897, "link": "https://stackoverflow.com/questions/49602897/empty-node-list-in-simple-distributed-haskell-cloud-haskell-example", "title": "Empty node list in simple Distributed Haskell / Cloud Haskell example", "body": "<p>I am trying to follow <a href=\"https://hackage.haskell.org/package/distributed-process-simplelocalnet-0.2.3.3/docs/Control-Distributed-Process-Backend-SimpleLocalnet.html\" rel=\"nofollow noreferrer\">the simple example in the official docs</a>, but when I run:</p>\n\n<pre><code>./example slave localhost 8080 &amp;\n./example slave localhost 8081 &amp;\n./example slave localhost 8082 &amp;\n./example slave localhost 8083 &amp;\n./example master localhost 8084\n</code></pre>\n\n<p>What I expected:</p>\n\n<pre><code>Slaves: [nid://localhost:8083:0,nid://localhost:8082:0,nid://localhost:8081:0,nid://localhost:8080:0]\n</code></pre>\n\n<p>What I see:</p>\n\n<pre><code>Slaves: []\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 0, "creation_date": 1522611171, "post_id": 49601295, "comment_id": 86210980, "body": "This is just S combinator from SKI basis of combinators logic."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1522618123, "post_id": 49601295, "comment_id": 86212787, "body": "<code>-XInstanceSigs</code> could help you. You can check full type from this slide on my presentation: <a href=\"https://slides.com/fp-ctd/lecture-6#/16\" rel=\"nofollow noreferrer\">slides.com/fp-ctd/lecture-6#/16</a>"}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": false, "score": 6, "last_activity_date": 1522607470, "creation_date": 1522607470, "answer_id": 49601314, "question_id": 49601295, "link": "https://stackoverflow.com/questions/49601295/how-does-the-applicative-instance-for-a-work/49601314#49601314", "title": "How does the Applicative instance for ((-&gt;) a) work?", "body": "<p><code>f &lt;*&gt; g</code> is a function. Defining</p>\n\n<pre><code>(&lt;*&gt;) f g x = f x (g x)\n</code></pre>\n\n<p>is the same as defining</p>\n\n<pre><code>(&lt;*&gt;) f g = \\x -&gt; f x (g x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1522665794, "post_id": 49601386, "comment_id": 86225865, "body": "Hey Willem, sorry to hijack your answer, but I&#39;m wondering whether you would be interested in <a href=\"https://codereview.stackexchange.com/questions/tagged/haskell?sort=unanswered\">reviewing Haskell Code on CR</a>. We have around 70 unanswered (read: unreviewed) questions at the moment and could use some diversity, since I currently review around 50% of new Haskell questions (and I consider myself at most intermediate). Another opinion would be highly welcome from time to time."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1522611013, "last_edit_date": 1522611013, "creation_date": 1522607864, "answer_id": 49601386, "question_id": 49601295, "link": "https://stackoverflow.com/questions/49601295/how-does-the-applicative-instance-for-a-work/49601386#49601386", "title": "How does the Applicative instance for ((-&gt;) a) work?", "body": "<p>You can trade variables in the head of a function with variables in a lambda expression in the body.</p>\n\n<p>For example:</p>\n\n<pre><code>f a b c d e = ...\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>f a b c d = \\e -&gt; ...\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f a b c = \\d e -&gt; ...\nf a b = \\c d e -&gt; ...\nf a = \\b c d e -&gt; ...\nf = \\a b c d e -&gt; ...\n</code></pre>\n\n<p>(all of the above). Since <code>(&lt;*&gt;)</code> has type:</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (b -&gt; c) -&gt; f b -&gt; f c\n</code></pre>\n\n<p>this means that if we take <code>f ~ (-&gt;) a</code>, then it means that:</p>\n\n<pre><code>(&lt;*&gt;) :: (-&gt;) a (b -&gt; c) -&gt; (-&gt;) a b -&gt; (-&gt;) a c  -- f ~ (-&gt;) a\n</code></pre>\n\n<p>or more convenient syntax:</p>\n\n<pre><code>(&lt;*&gt;) :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\n</code></pre>\n\n<p>or equivalent:</p>\n\n<pre><code>(&lt;*&gt;) :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>Here thus <code>(&lt;*&gt;)</code> is a function that takes three parameters: <code>f :: a -&gt; b -&gt; c</code>, <code>g :: a -&gt; b</code>, and <code>x :: a</code>.</p>\n"}], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 49601386, "answer_count": 2, "score": 2, "last_activity_date": 1522611013, "creation_date": 1522607352, "question_id": 49601295, "link": "https://stackoverflow.com/questions/49601295/how-does-the-applicative-instance-for-a-work", "title": "How does the Applicative instance for ((-&gt;) a) work?", "body": "<p>Given in <code>GHC.Base</code>:</p>\n\n<pre><code>instance Applicative ((-&gt;) a) where\n    pure = const\n    (&lt;*&gt;) f g x = f x (g x)\n    liftA2 q f g x = q (f x) (g x)\n</code></pre>\n\n<p>How can there be a definition of <code>(&lt;*&gt;)</code> with three arguments? I thought it only took two. How should I parse this?</p>\n"}, {"tags": ["haskell", "rdf"], "comments": [{"owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 2, "creation_date": 1522701559, "post_id": 49600974, "comment_id": 86255372, "body": "This is being tracked as a tracked bug on GitHub in the <a href=\"https://github.com/robstewart57/rdf4h\" rel=\"nofollow noreferrer\">rdf4h</a> library: <a href=\"https://github.com/robstewart57/rdf4h/issues/48\" rel=\"nofollow noreferrer\">github.com/robstewart57/rdf4h/issues/48</a>"}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 0, "creation_date": 1522767053, "post_id": 49600974, "comment_id": 86273338, "body": "I&#39;ll close this, since it&#39;s tracked as a bug."}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 0, "creation_date": 1522767106, "post_id": 49600974, "comment_id": 86273382, "body": "Actually, nevermind, I don&#39;t know how to close a question for that reason."}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1522701559, "creation_date": 1522605173, "question_id": 49600974, "link": "https://stackoverflow.com/questions/49600974/in-rdf4h-haskell-how-can-i-get-missing-triples", "title": "In RDF4H (Haskell), how can I get missing triples?", "body": "<p>I'm trying to parse RDF/XML files using the Haskell library RDF4H. I can parse a file using functions like these: </p>\n\n<pre><code>parseRDFXML :: String -&gt; IO (Either ParseFailure (RDF TList))\nparseRDFXML = parseFile (XmlParser Nothing Nothing)\n\nparseRDFXML' :: String -&gt; IO (Either ParseFailure (RDF AdjHashMap))\nparseRDFXML' = parseFile (XmlParser Nothing Nothing)\n</code></pre>\n\n<p>and then inspect the resulting contents using <code>ghci</code>: </p>\n\n<pre><code>parsed &lt;- parseRDFXML \"testRDF.xml\" \nresult = fromEither parsed\nresult\n</code></pre>\n\n<p>and it will print the triples that it's parsed. However, certain fields appear to be missing. I don't see the <code>dcterms:subject</code> field, for instance, or the <code>dcterms:language</code> field. </p>\n\n<p>Am I doing something wrong? </p>\n\n<p>For reference, here's an example of the type of RDF data I'm trying to parse: </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;rdf:RDF xml:base=\"http://www.gutenberg.org/\"\n  xmlns:dcam=\"http://purl.org/dc/dcam/\"\n  xmlns:dcterms=\"http://purl.org/dc/terms/\"\n  xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n  xmlns:cc=\"http://web.resource.org/cc/\"\n  xmlns:rdfs=\"http://www.w3.org/2000/01/rdf-schema#\"\n  xmlns:pgterms=\"http://www.gutenberg.org/2009/pgterms/\"\n&gt;\n  &lt;pgterms:ebook rdf:about=\"ebooks/15233\"&gt;\n    &lt;dcterms:language&gt;\n      &lt;rdf:Description rdf:nodeID=\"N30b5232d06364953b02811ebc0debbb9\"&gt;\n        &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/RFC4646\"&gt;en&lt;/rdf:value&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/dcterms:language&gt;\n    &lt;dcterms:subject&gt;\n      &lt;rdf:Description rdf:nodeID=\"N83c641d289c446b685ac37fd15845219\"&gt;\n        &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/LCC\"/&gt;\n        &lt;rdf:value&gt;DA&lt;/rdf:value&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/dcterms:subject&gt;\n    &lt;dcterms:type&gt;\n      &lt;rdf:Description rdf:nodeID=\"N23dc05dbba734cf28488df2f004510ea\"&gt;\n        &lt;rdf:value&gt;Text&lt;/rdf:value&gt;\n        &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/DCMIType\"/&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/dcterms:type&gt;\n    &lt;dcterms:subject&gt;\n      &lt;rdf:Description rdf:nodeID=\"N2b00277514604edc806f20cd6a653ba6\"&gt;\n        &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/LCSH\"/&gt;\n        &lt;rdf:value&gt;Nelson, Horatio Nelson, Viscount, 1758-1805 -- Death and burial&lt;/rdf:value&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/dcterms:subject&gt;\n    &lt;dcterms:subject&gt;\n      &lt;rdf:Description rdf:nodeID=\"N6d259d12d18c483db348bc0a0b45374a\"&gt;\n        &lt;rdf:value&gt;Admirals -- Great Britain -- Biography&lt;/rdf:value&gt;\n        &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/LCSH\"/&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/dcterms:subject&gt;\n    &lt;dcterms:publisher&gt;Project Gutenberg&lt;/dcterms:publisher&gt;\n    &lt;dcterms:issued rdf:datatype=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2005-03-02&lt;/dcterms:issued&gt;\n    &lt;dcterms:hasFormat&gt;\n      &lt;pgterms:file rdf:about=\"http://www.gutenberg.org/files/15233/15233-8.txt\"&gt;\n        &lt;dcterms:isFormatOf rdf:resource=\"ebooks/15233\"/&gt;\n        &lt;dcterms:modified rdf:datatype=\"http://www.w3.org/2001/XMLSchema#dateTime\"&gt;2013-03-16T14:52:48&lt;/dcterms:modified&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"Nd5c53a6431ee4a81a124a068af6cc9cc\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;text/plain; charset=iso-8859-1&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n        &lt;dcterms:extent rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;115988&lt;/dcterms:extent&gt;\n      &lt;/pgterms:file&gt;\n    &lt;/dcterms:hasFormat&gt;\n    &lt;dcterms:rights&gt;Public domain in the USA.&lt;/dcterms:rights&gt;\n    &lt;dcterms:creator&gt;\n      &lt;pgterms:agent rdf:about=\"2009/agents/5934\"&gt;\n        &lt;pgterms:name&gt;Beatty, William&lt;/pgterms:name&gt;\n        &lt;pgterms:deathdate rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;1842&lt;/pgterms:deathdate&gt;\n        &lt;pgterms:birthdate rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;1773&lt;/pgterms:birthdate&gt;\n        &lt;pgterms:webpage rdf:resource=\"http://en.wikipedia.org/wiki/William_Beatty_(surgeon)\"/&gt;\n      &lt;/pgterms:agent&gt;\n    &lt;/dcterms:creator&gt;\n    &lt;pgterms:bookshelf&gt;\n      &lt;rdf:Description rdf:nodeID=\"N8d8ab517be5d4d24a574a79c302445fc\"&gt;\n        &lt;dcam:memberOf rdf:resource=\"2009/pgterms/Bookshelf\"/&gt;\n        &lt;rdf:value&gt;Napoleonic(Bookshelf)&lt;/rdf:value&gt;\n      &lt;/rdf:Description&gt;\n    &lt;/pgterms:bookshelf&gt;\n    &lt;dcterms:hasFormat&gt;\n      &lt;pgterms:file rdf:about=\"http://www.gutenberg.org/files/15233/15233.zip\"&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"N0e16578584f8435998fb74335e273497\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;text/plain; charset=us-ascii&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n        &lt;dcterms:modified rdf:datatype=\"http://www.w3.org/2001/XMLSchema#dateTime\"&gt;2013-03-16T14:55:02&lt;/dcterms:modified&gt;\n        &lt;dcterms:extent rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;42991&lt;/dcterms:extent&gt;\n        &lt;dcterms:isFormatOf rdf:resource=\"ebooks/15233\"/&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"Nef4e065fb0b14e2e9d2f7ff919015e27\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;application/zip&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n      &lt;/pgterms:file&gt;\n    &lt;/dcterms:hasFormat&gt;\n    &lt;dcterms:hasFormat&gt;\n      &lt;pgterms:file rdf:about=\"http://www.gutenberg.org/ebooks/15233.txt.utf-8\"&gt;\n        &lt;dcterms:isFormatOf rdf:resource=\"ebooks/15233\"/&gt;\n        &lt;dcterms:extent rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;115955&lt;/dcterms:extent&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"N00d1a7671ac647abad35d2ee8cdc7b6c\"&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;text/plain&lt;/rdf:value&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n        &lt;dcterms:modified rdf:datatype=\"http://www.w3.org/2001/XMLSchema#dateTime\"&gt;2017-03-08T03:35:35.071213&lt;/dcterms:modified&gt;\n      &lt;/pgterms:file&gt;\n    &lt;/dcterms:hasFormat&gt;\n    &lt;dcterms:hasFormat&gt;\n      &lt;pgterms:file rdf:about=\"http://www.gutenberg.org/files/15233/15233-h.zip\"&gt;\n        &lt;dcterms:extent rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;414933&lt;/dcterms:extent&gt;\n        &lt;dcterms:isFormatOf rdf:resource=\"ebooks/15233\"/&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"N639c8cfe3790493fbd031ccb3cef1290\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;text/html; charset=iso-8859-1&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n        &lt;dcterms:modified rdf:datatype=\"http://www.w3.org/2001/XMLSchema#dateTime\"&gt;2013-03-16T14:54:03&lt;/dcterms:modified&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"N3d06273dd12f4c14b4b2c406185c19f2\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;application/zip&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n      &lt;/pgterms:file&gt;\n    &lt;/dcterms:hasFormat&gt;\n    &lt;pgterms:downloads rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;24&lt;/pgterms:downloads&gt;\n    &lt;dcterms:title&gt;Authentic Narrative of the Death of Lord Nelson&lt;/dcterms:title&gt;\n    &lt;dcterms:hasFormat&gt;\n      &lt;pgterms:file rdf:about=\"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\"&gt;\n        &lt;dcterms:modified rdf:datatype=\"http://www.w3.org/2001/XMLSchema#dateTime\"&gt;2013-03-16T14:52:30&lt;/dcterms:modified&gt;\n        &lt;dcterms:isFormatOf rdf:resource=\"ebooks/15233\"/&gt;\n        &lt;dcterms:format&gt;\n          &lt;rdf:Description rdf:nodeID=\"N1640a362e5804551a11f14ad2afcbba6\"&gt;\n            &lt;dcam:memberOf rdf:resource=\"http://purl.org/dc/terms/IMT\"/&gt;\n            &lt;rdf:value rdf:datatype=\"http://purl.org/dc/terms/IMT\"&gt;text/html; charset=iso-8859-1&lt;/rdf:value&gt;\n          &lt;/rdf:Description&gt;\n        &lt;/dcterms:format&gt;\n        &lt;dcterms:extent rdf:datatype=\"http://www.w3.org/2001/XMLSchema#integer\"&gt;133225&lt;/dcterms:extent&gt;\n      &lt;/pgterms:file&gt;\n    &lt;/dcterms:hasFormat&gt;\n  &lt;/pgterms:ebook&gt;\n  &lt;cc:Work rdf:about=\"\"&gt;\n    &lt;cc:license rdf:resource=\"https://creativecommons.org/publicdomain/zero/1.0/\"/&gt;\n    &lt;rdfs:comment&gt;Archives containing the RDF files for *all* our books can be downloaded at\n            http://www.gutenberg.org/wiki/Gutenberg:Feeds#The_Complete_Project_Gutenberg_Catalog&lt;/rdfs:comment&gt;\n  &lt;/cc:Work&gt;\n  &lt;rdf:Description rdf:about=\"http://en.wikipedia.org/wiki/William_Beatty_(surgeon)\"&gt;\n    &lt;dcterms:description&gt;Wikipedia&lt;/dcterms:description&gt;\n  &lt;/rdf:Description&gt;\n&lt;/rdf:RDF&gt;\n</code></pre>\n\n<p>and here's what it parses: </p>\n\n<pre><code>Triple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.images\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.images\") (UNode \"dcterms:extent\") (LNode (TypedL \"983557\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.images\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-08T03:35:37.901165\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.images\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.txt\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.txt\") (UNode \"dcterms:extent\") (LNode (TypedL \"115997\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.txt\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:52:45\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.txt\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/\") (UNode \"rdf:type\") (UNode \"cc:Work\")\nTriple (UNode \"http://www.gutenberg.org/\") (UNode \"rdfs:comment\") (LNode (PlainL \"Archives containing the RDF files for *all* our books can be downloaded at\\n            http://www.guten\nberg.org/wiki/Gutenberg:Feeds#The_Complete_Project_Gutenberg_Catalog\"))\nTriple (UNode \"http://www.gutenberg.org/\") (UNode \"cc:license\") (UNode \"https://creativecommons.org/publicdomain/zero/1.0/\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.noimages\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.noimages\") (UNode \"dcterms:extent\") (LNode (TypedL \"232677\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.noimages\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-08T03:35:38.567127\" \"http://www.w3.org/2001/XMLSchema#dateTime\")\n)\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.noimages\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://en.wikipedia.org/wiki/William_Beatty_(surgeon)\") (UNode \"dcterms:description\") (LNode (PlainL \"Wikipedia\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.noimages\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.noimages\") (UNode \"dcterms:extent\") (LNode (TypedL \"50633\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.noimages\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-08T03:35:36.364187\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.noimages\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.txt\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.txt\") (UNode \"dcterms:extent\") (LNode (TypedL \"115988\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.txt\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:52:48\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.txt\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:creator\") (UNode \"http://www.gutenberg.org/2009/agents/5934\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"pgterms:downloads\") (LNode (TypedL \"24\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"rdf:type\") (UNode \"pgterms:ebook\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:rights\") (LNode (PlainL \"Public domain in the USA.\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:issued\") (LNode (TypedL \"2005-03-02\" \"http://www.w3.org/2001/XMLSchema#date\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:title\") (LNode (PlainL \"Authentic Narrative of the Death of Lord Nelson\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:license\") (UNode \"license\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:publisher\") (LNode (PlainL \"Project Gutenberg\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.images\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233.txt\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.kindle.noimages\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.epub.noimages\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233-8.txt\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233.zip\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.epub.images\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.rdf\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233-h.zip\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/files/15233/15233-8.zip\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233\") (UNode \"dcterms:hasFormat\") (UNode \"http://www.gutenberg.org/ebooks/15233.txt.utf-8\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\") (UNode \"dcterms:extent\") (LNode (TypedL \"133225\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:52:30\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h/15233-h.htm\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.zip\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.zip\") (UNode \"dcterms:extent\") (LNode (TypedL \"42991\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.zip\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:55:02\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233.zip\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.images\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.images\") (UNode \"dcterms:extent\") (LNode (TypedL \"418975\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.images\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-08T03:35:36.010256\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.epub.images\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.rdf\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.rdf\") (UNode \"dcterms:extent\") (LNode (TypedL \"13704\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.rdf\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-16T05:39:06.392075\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.rdf\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h.zip\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h.zip\") (UNode \"dcterms:extent\") (LNode (TypedL \"414933\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h.zip\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:54:03\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-h.zip\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.zip\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.zip\") (UNode \"dcterms:extent\") (LNode (TypedL \"42996\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.zip\") (UNode \"dcterms:modified\") (LNode (TypedL \"2013-03-16T14:54:55\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/files/15233/15233-8.zip\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\nTriple (UNode \"http://www.gutenberg.org/2009/agents/5934\") (UNode \"rdf:type\") (UNode \"pgterms:agent\")\nTriple (UNode \"http://www.gutenberg.org/2009/agents/5934\") (UNode \"pgterms:deathdate\") (LNode (TypedL \"1842\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/2009/agents/5934\") (UNode \"pgterms:name\") (LNode (PlainL \"Beatty, William\"))\nTriple (UNode \"http://www.gutenberg.org/2009/agents/5934\") (UNode \"pgterms:webpage\") (UNode \"http://en.wikipedia.org/wiki/William_Beatty_(surgeon)\")\nTriple (UNode \"http://www.gutenberg.org/2009/agents/5934\") (UNode \"pgterms:birthdate\") (LNode (TypedL \"1773\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.txt.utf-8\") (UNode \"rdf:type\") (UNode \"pgterms:file\")\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.txt.utf-8\") (UNode \"dcterms:extent\") (LNode (TypedL \"115955\" \"http://www.w3.org/2001/XMLSchema#integer\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.txt.utf-8\") (UNode \"dcterms:modified\") (LNode (TypedL \"2017-03-08T03:35:35.071213\" \"http://www.w3.org/2001/XMLSchema#dateTime\"))\nTriple (UNode \"http://www.gutenberg.org/ebooks/15233.txt.utf-8\") (UNode \"dcterms:isFormatOf\") (UNode \"ebooks/15233\")\n</code></pre>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522603290, "post_id": 49600647, "comment_id": 86208401, "body": "I think you make code way to complex here. You probably better use <code>where</code> clauses, guards, etc. to make the synax cleaner in the first place."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1522603332, "post_id": 49600647, "comment_id": 86208417, "body": "It is probably also useful to first specify what your function aims to do?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522603584, "post_id": 49600647, "comment_id": 86208503, "body": "The compiler furthermore says that the last two lines are actually duplicates, and thus that there is no reason to write both. So you can delete one of the two."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522603617, "post_id": 49600647, "comment_id": 86208521, "body": "@WillemVanOnsem Yeah you&#39;re certainly right. Though I&#39;m pretty new into Haskell so i probably don&#39;t have the best practises yet. Ad 2, I&#39;m pretty sure I described it well. What&#39;s not clear?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522603690, "post_id": 49600647, "comment_id": 86208549, "body": "well you write <i>how</i> the predicate does something, but it would probably make it easier to spot a problem, given you first specify what the function is aiming to calculate. In words what problem the function should solve."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522604301, "post_id": 49600647, "comment_id": 86208763, "body": "@WillemVanOnsem I edited the question to make it clear. By the way I deleted one of the lines you said - no effect. It says warning for the other one I left there."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522604868, "post_id": 49600647, "comment_id": 86208945, "body": "so if I understand it correctly, you each time want to calculate the difference? Since if the intersection is empty, then you simply never remove elements from the list (so regardless whether there is an element that intersects), you calculate the difference."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522605639, "post_id": 49600647, "comment_id": 86209212, "body": "@WillemVanOnsem Pseudocode would look like this: <code>for each set Y in mnozP for which a \u2229 Y is nonempty and a \\ X is nonempty do:...</code>. So if the intersection is empty, I do nothing. If the difference is empty, I do nothing too. You can see this condition in code, in my opinion it&#39;s pretty obvious."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522607367, "post_id": 49600647, "comment_id": 86209797, "body": "And what do you do if both are non-empty?"}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522608009, "post_id": 49600647, "comment_id": 86210030, "body": "@WillemVanOnsem That is not a subject of this question. Firstly I need to have that list of lists which I get by testing every subset (sublist) of mnozP to the condition. If the condition for actual subset (lets call is <code>P</code>) of mnozP match, I realize intersection and difference of <code>P</code> and <code>a</code>, insert these two created sets (lists) into final list. And this list of lists is my goal."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522610630, "post_id": 49600647, "comment_id": 86210829, "body": "So for every element in <code>mnozP</code> that satisfies the two conditions, you want two elements in the output?"}, {"owner": {"reputation": 395, "user_id": 4678574, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/dd53f2aecfab73b707f9a1314c12c413?s=128&d=identicon&r=PG&f=1", "display_name": "DRINK", "link": "https://stackoverflow.com/users/4678574/drink"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522623721, "post_id": 49600647, "comment_id": 86214075, "body": "@WillemVanOnsem I guess that&#39;s what OP wants."}], "answers": [{"tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": true, "score": 2, "last_activity_date": 1522833622, "creation_date": 1522833622, "answer_id": 49647239, "question_id": 49600647, "link": "https://stackoverflow.com/questions/49600647/list-to-lists-of-lists-in-recursive-calling/49647239#49647239", "title": "List to lists of lists in recursive calling", "body": "<p>The function you're looking for is the list constructor. In your inductive case, you have</p>\n\n<pre><code>(((intersect ( Set.toList $ head $ Set.toList $ mnozP) (a)) ++ (( Set.toList $ head $ Set.toList $ mnozP) \\\\ (a))) ++ findY ( Set.fromList $ tail $ Set.toList $ mnozP) (a))\n</code></pre>\n\n<p>which is just</p>\n\n<pre><code>as ++ bs ++ cs\n</code></pre>\n\n<p>where <code>cs</code> is the result of the recursive call. If <code>findY</code> returns a list of lists, so must the whole expression. By the induction hypothesis, <code>cs</code> is a list of lists. In other words, the expression to the left in <code>exp ++ cs</code> (i.e. <code>as ++ bs</code>) must be a list of lists too. But it's not! <code>intersect</code> and <code>\\\\</code> return flat lists, which you concatenate together, getting a new flat list.</p>\n\n<p>To fix that problem you just need to wrap your left expression in a list</p>\n\n<pre><code>[as ++ bs] ++ cs\n</code></pre>\n\n<p>or use the list constructor</p>\n\n<pre><code>(as ++ bs) : cs\n</code></pre>\n\n<hr>\n\n<p>If there's anything else you could get from this, it is that you could have found that out by yourself had the code been written in a more idiomatic way. I'll try to walk you through how I \"unpacked\" your code. </p>\n\n<p>First, I added a type signature that matched your description.</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>Interestingly, this change alone would have pointed out the expression in the inductive case was not right.</p>\n\n<p>Then, I got rid of the <code>Set &lt;-&gt; []</code> conversions. You can either ask for your input to be sets, or just plain lists and make sure there are no duplicates. I went with the latter approach:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY mnozP a = \nif null(mnozP)==False\n    then (\n        if (((null(intersect (head mnozP) (a))==False) &amp;&amp; (null(( head mnozP) \\\\ (a))==False)))\n            then (((intersect ( head mnozP) (a)) ++ (( head mnozP) \\\\ (a))) ++ findY ( tail mnozP) (a))\n            else findY ( tail mnozP) (a)\n        )\n    else []\nfindY _ a = []\nfindY _ _ = []\n</code></pre>\n\n<p>It's already getting clearer. There's loads of <code>()</code> you can get rid of too. In Haskell, function application is just the space character. So instead of writing <code>f(x)</code>, like you would in many languages, you write <code>f x</code> and surround with parentheses only to disambiguate expressions:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY mnozP a = \nif (null mnozP) == False\n    then\n        if (null (intersect (head mnozP) a) == False) &amp;&amp; (null (head mnozP \\\\ a) == False)\n            then (intersect (head mnozP) a) ++ (head mnozP \\\\ a) ++ findY (tail mnozP) a\n            else findY (tail mnozP) a\n    else []\nfindY _ a = []\nfindY _ _ = []\n</code></pre>\n\n<p>Next, notice the many repetitions of <code>head</code> and <code>tail</code>. You could bind these to variables with a <code>let</code> expression, but there's a better way. Haskell allows you to pattern match on the arguments in order to choose what branch should be evaluated depending on the input. Here, we only need to know if the list has a head and a tail, which happens to be exactly how you pattern match a non-empty list:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY (xs : xss) a = \n    if (null (intersect xs a) == False) &amp;&amp; (null (xs \\\\ a) == False)\n        then (intersect xs a) ++ (xs \\\\ a) ++ findY xss a\n        else findY xss a\nfindY _ _ = []\n</code></pre>\n\n<p>See how doing this allowed me to get rid of the first <code>if</code> statement? (I also removed the extra pattern match). There is still some redundancy, let's get rid of it:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY (xs : xss) a =\n  let as = intersect xs a\n      bs = xs \\\\ a\n  in\n    if (null as == False) &amp;&amp; (null bs == False)\n        then as ++ bs ++ findY xss a\n        else findY xss a\nfindY _ _ = []\n</code></pre>\n\n<p>At that point, the issue stands out. </p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY (xs : xss) a =\n  let as = intersect xs a\n      bs = xs \\\\ a\n  in\n    if (null as == False) &amp;&amp; (null bs == False)\n        then (as ++ bs) : findY xss a\n        else findY xss a\nfindY _ _ = []\n</code></pre>\n\n<p>Now it is a matter of style, but I personally find using pattern matching is more elegant than if statements most of the time. Not so much here though:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY (xs : xss) a =\n  let as = intersect xs a\n      bs = xs \\\\ a\n  in case (as, bs) of\n    ((_ : _), (_ : _)) -&gt; (as ++ bs) : findY xss a\n    _                  -&gt; findY xss a\nfindY _ _ = []\n</code></pre>\n\n<p>but in Haskell 2010, you can use pattern guards, a more powerful version of pattern matching. It makes your code that much clearer:</p>\n\n<pre><code>findY :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nfindY (xs : xss) a \n  | as@(_ : _) &lt;- intersect xs a\n  , bs@(_ : _) &lt;- xs \\\\ a = (as ++ bs) : findY xss a\n  | otherwise             = findY xss a\nfindY _ _ = []\n</code></pre>\n\n<p>Finally, the shape of your program is classic structural recursion. It is usually what you would use <code>foldr</code> for.</p>\n\n<pre><code>findY :: Eq a =&gt; [a] -&gt; [[a]] -&gt; [[a]]\nfindY a = foldr build []\n  where \n    build xs yss\n      | as@(_ : _) &lt;- intersect xs a\n      , bs@(_ : _) &lt;- xs \\\\ a = (as ++ bs) : yss\n      | otherwise             = yss\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 49647239, "answer_count": 1, "score": 2, "last_activity_date": 1522833622, "creation_date": 1522603219, "last_edit_date": 1522605983, "question_id": 49600647, "link": "https://stackoverflow.com/questions/49600647/list-to-lists-of-lists-in-recursive-calling", "title": "List to lists of lists in recursive calling", "body": "<p>Here is my code: </p>\n\n<pre><code>findY mnozP a = \n    if null(Set.toList $ mnozP)==False\n        then (\n            if (((null(intersect ( Set.toList $ head $ Set.toList $ mnozP) (a))==False) &amp;&amp; (null(( Set.toList $ head $ Set.toList $ mnozP) \\\\ (a))==False)))\n                then (((intersect ( Set.toList $ head $ Set.toList $ mnozP) (a)) ++ (( Set.toList $ head $ Set.toList $ mnozP) \\\\ (a))) ++ findY ( Set.fromList $ tail $ Set.toList $ mnozP) (a))\n                else findY ( Set.fromList $ tail $ Set.toList $ mnozP) (a)\n            )\n        else []\nfindY _ a = []\nfindY _ _ = []\n</code></pre>\n\n<p>This function checks whether is list <code>mnozP</code> empty, if it isn't, it takes first item and checks whether its intersection with list <code>a</code> is empty <code>and</code> its difference is not empty. In case condition is true, realizes these two operations and call it recursively again for the tail of list <code>b</code>.\nI actually got 2 questions:</p>\n\n<ol>\n<li>Let's assume following lists: <code>a = [\"3\",\"4\"]</code> and <code>mnozP = [[\"1\",\"6\"],[\"2\",\"4\",\"3\",\"5\"]]</code>. The output is <code>[\"3\",\"4\",\"2\",\"5\"]</code>. <em>Is there any function which can split this list into list of lists according to every single iterations?</em> Expected output should look like <code>[[\"3\",\"4\"],[\"2\",\"5\"]]</code>.</li>\n<li><p>While compiling GHCi says following:</p>\n\n<pre><code>Warning:\nPattern match(es) are overlapped\nIn an equation for `findY':\n    findY _ a = ...\n    findY _ _ = ...\n</code></pre>\n\n<p>I'm not sure what's wrong with my patterns. I try to cover all the possible cases which can happen. <em>Any ideas whats wrong?</em></p></li>\n</ol>\n\n<p>EDIT: <em>(short summary:)</em> The function findY should return a list of lists. Every inner list is related to one concrete iteration of recursion (in case conditions is true).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522603016, "post_id": 49600508, "comment_id": 86208308, "body": "You import <code>_String</code>, but never use it, so, you can probably drop it. I think you are following an outdated manual, since <code>_String</code> does not seem to be part of the <code>Data.Aeson.Lens</code> module (anymore)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1522603419, "post_id": 49600508, "comment_id": 86208444, "body": "You&#39;re probably using the <a href=\"https://hackage.haskell.org/package/aeson-lens-0.5.0.0/docs/Data-Aeson-Lens.html\" rel=\"nofollow noreferrer\"><code>aeson-lens</code> package</a> instead of the <a href=\"https://hackage.haskell.org/package/lens-aeson-1.0.2/docs/Data-Aeson-Lens.html\" rel=\"nofollow noreferrer\"><code>lens-aeson</code> package</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1522674723, "post_id": 49600508, "comment_id": 86230464, "body": "Hayoo (or Stackage Hoogle) can help clarifying situations like this. Here is a <a href=\"https://hayoo.fh-wedel.de/?query=_String\" rel=\"nofollow noreferrer\">Hayoo query</a> that shows the <code>_String</code> you are looking for belongs to the <i>lens-aeson</i> package, as @4castle points out."}], "answers": [{"tags": [], "owner": {"reputation": 422, "user_id": 9999127, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eV5CwYL1VJ8/AAAAAAAAAAI/AAAAAAAAAHs/Pc0AuvECtA0/photo.jpg?sz=128", "display_name": "Stanley Fernandes", "link": "https://stackoverflow.com/users/9999127/stanley-fernandes"}, "is_accepted": false, "score": 2, "last_activity_date": 1565680891, "creation_date": 1565680891, "answer_id": 57472934, "question_id": 49600508, "link": "https://stackoverflow.com/questions/49600508/facing-error-for-importing-string-from-data-aeson-lens/57472934#57472934", "title": "Facing error for importing _String from Data.Aeson.Lens", "body": "<p>You need to use lens-aeson package for <code>_String</code> </p>\n\n<p><a href=\"https://hackage.haskell.org/package/lens-aeson-1.0.2/docs/Data-Aeson-Lens.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/lens-aeson-1.0.2/docs/Data-Aeson-Lens.html</a></p>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1565680891, "creation_date": 1522602253, "question_id": 49600508, "link": "https://stackoverflow.com/questions/49600508/facing-error-for-importing-string-from-data-aeson-lens", "title": "Facing error for importing _String from Data.Aeson.Lens", "body": "<pre><code>import Data.Aeson.Lens (_String,key)\npostRetweet1 tweetId = do\n    tweetId &gt;&gt;= \\tweetId1 -&gt; (CM.foldM (\\arr tid -&gt;  ((try (postWith authenticate (retweetUrl++tid++\".json\") (DB.pack \"ABC\")) ):: IO (Either SomeException (Response BL.ByteString)) ) &gt;&gt;= \n         \\sc -&gt;\n                case sc of\n                    Right val -&gt;   if (val ^. responseStatus ^. statusCode)==200\n                                        then pure (arr++[val ^. responseBody . key \"text\" . _String ])  \n                                    else pure (arr)     \n\n\n                Left x -&gt; pure (arr) ) [] tweetId1 )\n</code></pre>\n\n<p>this is the error im getting </p>\n\n<pre><code>Module \u2018Data.Aeson.Lens\u2019 does not export \u2018_String\u2019\n</code></pre>\n\n<p>i had referred this <a href=\"http://www.serpentine.com/wreq/tutorial.html\" rel=\"nofollow noreferrer\">http://www.serpentine.com/wreq/tutorial.html</a></p>\n"}, {"tags": ["haskell", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1522598809, "creation_date": 1522598809, "answer_id": 49599970, "question_id": 49599411, "link": "https://stackoverflow.com/questions/49599411/in-persistent-haskell-how-can-i-insert-a-record-only-if-it-doesnt-already-ex/49599970#49599970", "title": "In Persistent (Haskell), how can I insert a record only if it doesn&#39;t already exist?", "body": "<p>You just need to perform both actions you mentioned yourself:</p>\n\n<pre><code>authorIds &lt;- forM authors $ \\a -&gt; do\n    res &lt;- insertUnique a\n    case res of\n        Just key -&gt; return key\n        _ -&gt; fromJust &lt;$&gt; getBy (authorGutId a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 0, "last_activity_date": 1522599708, "last_edit_date": 1522599708, "creation_date": 1522599163, "answer_id": 49600028, "question_id": 49599411, "link": "https://stackoverflow.com/questions/49599411/in-persistent-haskell-how-can-i-insert-a-record-only-if-it-doesnt-already-ex/49600028#49600028", "title": "In Persistent (Haskell), how can I insert a record only if it doesn&#39;t already exist?", "body": "<p>How about</p>\n\n<pre><code>authorIds &lt;- mapM (fmap (either entityKey id) . insertBy) authors\n\ninsertBy :: _ =&gt; -- some constraints\n            record -&gt; -- given some record, try to insert it\n            _ ( -- in some monad\n               Either (Entity record) (Key record)\n               -- if found: Left existing\n               -- otherwise: Right newKey\n              )\nData.Either.either :: (l -&gt; o) -&gt; (r -&gt; o) -&gt; Either l r -&gt; o\n-- eliminator for Either\n-- purpose and implementation completely determined by type\n</code></pre>\n\n<p>We use <code>insertBy</code> to try to insert the record. <code>fmap</code> drills underneath the monad, and <code>either entityKey id</code> extracts the <code>Key</code>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 1, "accepted_answer_id": 49599970, "answer_count": 2, "score": 2, "last_activity_date": 1526838242, "creation_date": 1522595114, "last_edit_date": 1526838242, "question_id": 49599411, "link": "https://stackoverflow.com/questions/49599411/in-persistent-haskell-how-can-i-insert-a-record-only-if-it-doesnt-already-ex", "title": "In Persistent (Haskell), how can I insert a record only if it doesn&#39;t already exist?", "body": "<p>I'm a Haskell beginner, so apologies in advance!</p>\n\n<p>I've been following <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">the Persistent tutorial here</a>. </p>\n\n<p>I have a data model with a uniqueness constraint: </p>\n\n<pre><code>Book\n    gutId Int\n    UniqueGutId gutId\n    ...\n    author [AuthorId]\n    ... \nAuthor\n    gutId Int\n    UniqueAuthorGutId gutId\n    ...\n</code></pre>\n\n<p>And when I go to <code>insert</code> a record using this: </p>\n\n<pre><code>  runSqlite \"test.db\" $ do\n    runMigration migrateAll\n\n    -- FIXME: This won't work if there's an author that's already in the database.\n    authorIds &lt;- mapM insert authors\n</code></pre>\n\n<p>It won't work if the record is already in the database. (It'll just return an exception.) I can do this instead: </p>\n\n<pre><code>authorIds &lt;- mapM insertUnique authors\n</code></pre>\n\n<p>But the problem is, I need to use <code>authorIds</code> to update <code>Book</code> records later. So I'm just wondering if anyone knows of an easy way to insert a record if it doesn't exist, and return the new key, or get the record key if it already exists, so that I have an array of keys either way. <a href=\"https://github.com/JonathanReeve/corpus-db/blob/f3f051ce2a76d803f05fd8d99e1d6989ca9d3206/src/Main.hs\" rel=\"nofollow noreferrer\">The full code at this point is up here.</a></p>\n"}, {"tags": ["haskell", "tuples", "functor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522585131, "post_id": 49597874, "comment_id": 86203089, "body": "Because a tuple has type <code>(a, b, c)</code> (can be generalized), so if you would make it an instance of <code>Functor</code>, you can only map a <i>single</i> element."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522585197, "post_id": 49597874, "comment_id": 86203109, "body": "A question, to help delimiting the scope of the answers: which result did you expect to get from <code>fmap (+3) (10,11,12,13,14)</code>, and does that look like what you get from <code>fmap (+3) (10,11)</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1522585204, "post_id": 49597874, "comment_id": 86203113, "body": "A 2-tuple is by the way an instance of <code>Functor</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1522587891, "post_id": 49598238, "comment_id": 86203851, "body": "&quot;Because of their types, tuples are generally not <code>Functor</code> instances&quot; -- I wouldn&#39;t put it like that. While not everyone agrees on this, I&#39;m firmly in the camp that finds the <code>Functor</code> instance for pairs perfectly reasonable. Instances for larger tuples targeting the last component would be just as reasonable; the base libraries don&#39;t provide them merely because, in practice, they are needed far less often than the pair one (and, accordingly, there have been suggestions to add the missing instances for the sake of consistency)."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522593923, "post_id": 49598238, "comment_id": 86205565, "body": "@duplode Indeed, but I do belong to the camp that find the <code>Functor</code> instance for <code>(,)</code> unintuitive. I do understand why it&#39;s there, but I find it implicit and arbitrary. Again, I understand that the reason the translation is applied to the second element is due to partial application, but I find that this is an implementation detail of the language, rather than a proper abstraction. To be clear, I find your comment valuable, and have also upvoted your answer, so it&#39;s not my intent to escalate the discussion at all, but I did want to make my position more explicit."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522596505, "post_id": 49598238, "comment_id": 86206360, "body": "[1/2] That&#39;s fine. I acknowledge that is a rather controversial topic, and my answer was partly aimed at making the controversy explicit :) On &quot;I find it implicit&quot;, I agree that it is often to be better to use <code>second</code> instead of <code>fmap @((,) _)</code> when writing concrete code. From a practical point of view, a better motivation for the <code>Functor</code> instance is its usefulness in abstract, functor-oriented code (think <i>lens</i> or <i>recursion-schemes</i>)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522596521, "post_id": 49598238, "comment_id": 86206367, "body": "[2/2] On a related note, I find it nice that <code>fmap (+3) (Compose [(1,4),(2,0)])</code> -- or, to mention an even more vilified instance, <code>sum (Compose [(1,4),(2,0)])</code> -- do what we&#39;d expect for a dictionary (that happens to have been implemented as an association list)."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1522587103, "creation_date": 1522587103, "answer_id": 49598238, "question_id": 49597874, "link": "https://stackoverflow.com/questions/49597874/why-fmap-doesnt-work-for-a-tuple/49598238#49598238", "title": "Why fmap doesn&#39;t work for a tuple?", "body": "<p>A tuple is a grouping of a specific number of values of (potentially) <strong>different types</strong>. Even if you consider the expression <code>(10,11,12,13,14)</code>, each element may have a different type:</p>\n\n<pre><code>Prelude&gt; :t (10,11,12,13,14)\n(10,11,12,13,14)\n  :: (Num t, Num t1, Num t2, Num t3, Num t4) =&gt; (t4, t3, t2, t1, t)\n</code></pre>\n\n<p>For instance, the expression <code>10</code> may be an <code>Int</code>, while <code>11</code> may be a <code>Word</code>, and so on.</p>\n\n<p>In general, you could also have written a five-tuple like <code>(\"foo\", 42, True, \"bar\", 11)</code>, which has this type:</p>\n\n<pre><code>Prelude&gt; :t (\"foo\", 42, True, \"bar\", 11)\n(\"foo\", 42, True, \"bar\", 11)\n  :: (Num t, Num t1) =&gt; ([Char], t1, Bool, [Char], t)\n</code></pre>\n\n<p>The first element is a <code>[Char]</code> value (i.e. a <code>String</code>), the next element is some number, the third element is a <code>Bool</code>, and so on.</p>\n\n<p>You can't apply the function <code>+3</code> to all of those elements. Even if you think it'd be meaningful for strings (which it isn't, IMO), I hope you agree that you can't add <code>3</code> to <code>True</code>.</p>\n\n<p>Because of their types, tuples are generally not <code>Functor</code> instances, and therefore, you can't use <code>fmap</code> with them.</p>\n\n<hr>\n\n<p>As Willem Van Onsem points out in the comments, a two-tuple <em>is</em> a <code>Functor</code>, but it may not behave in the way you expect. The <a href=\"https://youtu.be/87re_yIQMDw\" rel=\"nofollow noreferrer\">Haskell <em>pair</em> is a bit funky</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 8, "last_activity_date": 1522631605, "last_edit_date": 1522631605, "creation_date": 1522591734, "answer_id": 49598890, "question_id": 49597874, "link": "https://stackoverflow.com/questions/49597874/why-fmap-doesnt-work-for-a-tuple/49598890#49598890", "title": "Why fmap doesn&#39;t work for a tuple?", "body": "<blockquote>\n  <p>Why fmap doesn't work for a [5-]tuple?</p>\n</blockquote>\n\n<p>Because no one has added the 5-tuple <code>Functor</code> instance to <em>base</em> yet. If you have a look at <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Data-Functor.html#t:Functor\" rel=\"nofollow noreferrer\">the list of <code>Functor</code> instances provided by <em>base</em></a>, you will find <code>Functor ((,) a)</code>, the instance for pairs, but not the instances for larger tuples, including <code>Functor ((,,,,) a b c d)</code>, which is what you'd need here.</p>\n\n<p>The follow up question would of course be: Why has no one added the 5-tuple <code>Functor</code> instance to <em>base</em> yet? One reason has to do with necessity (or the lack thereof): in practice, pairs show up much more often than larger tuples, and as tuples get larger it becomes harder and harder to justify using them instead of a non-anonymous type suited to one's use case. That being so, the demand for <code>Functor</code> instances for larger tuples isn't all that big.</p>\n\n<p>Though you didn't mention which behaviour you expected for <code>Functor ((,,,,) a b c d)</code>, it is worth noting that <code>fmap</code> for pairs acts only on the second component, and instances for larger tuples would analogously only deal with the last component.</p>\n\n<pre><code>GHCi&gt; fmap not (False, True)\n(False,False)\n</code></pre>\n\n<p>Two reasons for that are:</p>\n\n<ol>\n<li><p>The types of the components can be different, and so there is no way e.g. <code>fmap not (\"foobar\", True)</code> could possibly change both components.</p></li>\n<li><p>There is no way to flip type constructors when writing instances, and so e.g. there can't be a <code>Functor</code> instance for pairs that acts on the first component (unless you use <a href=\"https://hackage.haskell.org/package/bifunctors-5/docs/Data-Bifunctor-Flip.html\" rel=\"nofollow noreferrer\">a newtype wrapper</a>, but that is besides the point).</p></li>\n</ol>\n\n<p>While this behaviour might seem surprising, it is entirely reasonable if you think of a pair with type <code>(a, b)</code> as a <code>b</code> value with an annotation (tag, label, extra stuff -- however you like to call it) of type <code>a</code> attached to it. In the cases you'd rather think of it as a pair of two values that can be independently modified, you can resort to the <code>Bifunctor</code> class:</p>\n\n<pre><code>GHCi&gt; import Data.Bifunctor\nGHCi&gt; first reverse (\"foobar\", True)\n(\"raboof\",True)\nGHCi&gt; second not (\"foobar\", True)\n(\"foobar\",False)\nGHCi&gt; bimap reverse not (\"foobar\", True)\n(\"raboof\",False)\n</code></pre>\n\n<p>(<em>base</em> doesn't provide <code>Trifunctor</code>, <code>Tetrafunctor</code>, and so forth due to lack of need, as discussed at the beginning.)</p>\n\n<p>It is just as reasonable to regard larger tuples in the same manner when it comes to giving them <code>Functor</code> instances; and in fact those instances arguably should exist for the sake of consistency. However, some people do strongly dislike the instance for pairs, which has led <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2017-January/126026.html\" rel=\"nofollow noreferrer\">proposals to add the instances for other tuples</a> to stall.</p>\n\n<p>P.S.: It is perhaps worth mentioning that one of the (many) use cases of the <em>lens</em> library is using things that aren't <code>Functor</code>s as functors. That give us a convenient way to see what <code>Functor</code> and (if that were a thing) <code>Pentafunctor</code> instances would do with a 5-tuple:</p>\n\n<pre><code>GHCi&gt; import Control.Lens\nGHCi&gt; over _5 (+3) (10,11,12,13,14)\n(10,11,12,13,17)\nGHCi&gt; over _4 (+3) (10,11,12,13,14)\n(10,11,12,16,14)\nGHCi&gt; over _3 (+3) (10,11,12,13,14)\n(10,11,15,13,14)\nGHCi&gt; over _2 (+3) (10,11,12,13,14)\n(10,14,12,13,14)\nGHCi&gt; over _1 (+3) (10,11,12,13,14)\n(13,11,12,13,14)\n</code></pre>\n\n<p>There are even ways to map over all components...</p>\n\n<pre><code>GHCi&gt; over both (+3) (13,14)\n(16,17)\nGHCi&gt; over each (+3) (10,11,12,13,14)\n(13,14,15,16,17)\n</code></pre>\n\n<p>... though, unsurprisingly, they demand all components to have the same type:</p>\n\n<pre><code>GHCi&gt; over each (+3) (True,11,12,13,14)\n\n&lt;interactive&gt;:9:12: error:\n    * No instance for (Num Bool) arising from a use of `+'\n    * In the second argument of `over', namely `(+ 3)'\n      In the expression: over each (+ 3) (True, 11, 12, 13, 14)\n      In an equation for `it':\n          it = over each (+ 3) (True, 11, 12, 13, 14)\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; :set -XPartialTypeSignatures\nGHCi&gt; :set -fno-warn-partial-type-signatures\nGHCi&gt; :t \\f -&gt; over each f :: (_,_,_,_,_) -&gt; _\n\\f -&gt; over each f :: (_,_,_,_,_) -&gt; _\n  :: (w -&gt; b5) -&gt; (w, w, w, w, w) -&gt; (b5, b5, b5, b5, b5)\n</code></pre>\n"}], "owner": {"reputation": 1033, "user_id": 2056878, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/IZFw8.jpg?s=128&g=1", "display_name": "devio", "link": "https://stackoverflow.com/users/2056878/devio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "accepted_answer_id": 49598890, "answer_count": 2, "score": 2, "last_activity_date": 1522631605, "creation_date": 1522584404, "last_edit_date": 1522585625, "question_id": 49597874, "link": "https://stackoverflow.com/questions/49597874/why-fmap-doesnt-work-for-a-tuple", "title": "Why fmap doesn&#39;t work for a tuple?", "body": "<p>In the below, I tried to use <code>fmap</code> on a tuple, but this didn't work, although it worked for a list and <code>Just 4</code>:</p>\n\n<pre><code>Prelude&gt; fmap (+3) (Just 4)\nJust 7\nPrelude&gt; fmap (+3) [1,2,3,4]\n[4,5,6,7]\nPrelude&gt; fmap (+3) (10,11,12,13,14)\n\n&lt;interactive&gt;:38:1: error:\n    * Non type-variable argument\n        in the constraint: Functor ((,,,,) a b1 c d)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall a b1 c d b2.\n              (Num d, Num c, Num b1, Num a, Num b2, Functor ((,,,,) a b1 c d)) =&gt;\n              (a, b1, c, d, b2)\nPrelude&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1522558807, "post_id": 49594682, "comment_id": 86197218, "body": "What should hapoen if your value is <code>ConsString String</code>? It&#39;s of the same type <code>T</code>. How do you propose to multiply it?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522559032, "post_id": 49594682, "comment_id": 86197259, "body": "Terminology nitpicking: &quot;how does one then multiply an object <code>T</code>?&quot; -- just call it &quot;a value <code>T</code>&quot;: it is simpler and, arguably, more accurate."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1522578158, "post_id": 49594682, "comment_id": 86201301, "body": "I don\u2019t think this is what you want for this case, but a good package to be aware of is <a href=\"https://hackage.haskell.org/package/mono-traversable\" rel=\"nofollow noreferrer\">mono-traversable</a>, which provides classes for \u201ccontainers\u201d of a fixed element type (e.g. <code>Text</code> is a container of <code>Char</code>). For example, you only ever wanted to map over the <code>ConsInt</code> constructor, you would add <code>type instance Element T = Int</code> and make an instance of <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.8.1/docs/Data-MonoTraversable.html#t:MonoFunctor\" rel=\"nofollow noreferrer\"><code>MonoFunctor</code></a> with <code>omap f (ConsInt x) = ConsInt (f x); omap _ x = x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 686, "user_id": 8116864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OM0Rh.jpg?s=128&g=1", "display_name": "vasilyrud", "link": "https://stackoverflow.com/users/8116864/vasilyrud"}, "edited": false, "score": 0, "creation_date": 1522560652, "post_id": 49594968, "comment_id": 86197473, "body": "I had some of my terminology mixed up. Thanks for clarifying that a type constructor is an instance of <code>Functor</code>. I will look further into Functor instances. Also, perhaps I was expecting <code>mapConsInt</code> to be a built-in map function for all new data types (like a field lookup function when using record syntax). Using <code>mapConsInt (*2) (ConsInt 200)</code> does look much nicer than a lambda function though, even with the extra definition."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 686, "user_id": 8116864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OM0Rh.jpg?s=128&g=1", "display_name": "vasilyrud", "link": "https://stackoverflow.com/users/8116864/vasilyrud"}, "edited": false, "score": 2, "creation_date": 1522579062, "post_id": 49594968, "comment_id": 86201514, "body": "@vasilyrud: If you\u2019re going to be implementing many of these convenience functions like <code>mapConsInt</code>, they can all be expressed with a generic \u201cfold\u201d function: <code>foldT :: (Int -&gt; r) -&gt; (String -&gt; r) -&gt; (Char -&gt; r) -&gt; T -&gt; r; foldT i s c t = case t of { ConsInt x -&gt; i x; ConsString x -&gt; s x; ConsChar x -&gt; c x }</code>. This is akin to <code>maybe :: r -&gt; (a -&gt; r) -&gt; Maybe a -&gt; r</code> or <code>either :: (a -&gt; r) -&gt; (b -&gt; r) -&gt; Either a b -&gt; r</code>. With this, you can easily derive other functions like <code>mapT i s c = foldT (ConsInt . i) (ConsString . s) (ConsChar . c)</code> and <code>mapConsInt f = mapT f id id</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1522560175, "last_edit_date": 1522560175, "creation_date": 1522558931, "answer_id": 49594968, "question_id": 49594682, "link": "https://stackoverflow.com/questions/49594682/how-to-multiply-custom-datatype-objects-inline/49594968#49594968", "title": "How to multiply custom datatype objects inline?", "body": "<blockquote>\n  <p>Doing <code>fmap (*2) (ConsInt 200)</code> doesn't work, however. (I'm guessing because <code>T</code> is not a <em>type constructor</em> but a <em>data type</em>)</p>\n</blockquote>\n\n<p>This is part of the reason. <code>fmap (*2) (Just 200)</code> works because <code>Maybe</code> is a type constructor which is an instance of <code>Functor</code>:</p>\n\n<pre><code>GHCi&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nGHCi&gt; :set -XTypeApplications\nGHCi&gt; :t fmap @Maybe\nfmap @Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n</code></pre>\n\n<p><code>Functor</code>s have to be type constructors, which take a type and produce another type (that is, they have to have kind <code>* -&gt; *</code>):</p>\n\n<pre><code>GHCi&gt; :k Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>That is so because, to put it roughly, <code>fmap</code> should be able to change the type argument to the type constructor to anything else -- note how <code>a</code> and <code>b</code> in <code>fmap</code>'s type signature are completely arbitrary. If you have...</p>\n\n<pre><code>data T\n    = ConsInt Int\n    | ConsString String\n    | ConsChar Char\n</code></pre>\n\n<p>... then a <code>T</code> value cannot possibly contain anything other than an <code>Int</code>, a <code>String</code> or a <code>Char</code>, and so that requirement for it to be a <code>Functor</code> cannot be satisfied. If you really wanted to insist on making it a <code>Functor</code>, one course of action would be poking a hole where <code>Int</code> is:</p>\n\n<pre><code>-- You can actually write a Functor instance for this:\ndata T a\n    = ConsStuff a\n    | ConsString String\n    | ConsChar Char\n</code></pre>\n\n<p>Though that can be an useful refactoring in other circumstances, I'm pretty sure you won't want to do that here.</p>\n\n<blockquote>\n  <p>How, then, does one multiply a <code>T</code> object inline, without having to define a function by hand [...] or how does one use a simpler anonymous function than [...]</p>\n</blockquote>\n\n<p>Note that if you were to give <code>T</code> a <code>Functor</code> instance, the implementation of <code>fmap</code> would be about as complicated as the function you are pondering about here. (I'm disregarding the fact that, thanks to the <code>DeriveFunctor</code> extension, you never actually have to write a <code>Functor</code> instance, but that's kind of besides the point.) For the sake of comparison, this is what <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/src/GHC.Base.html#line-812\" rel=\"nofollow noreferrer\">the <code>Functor</code> instance for <code>Maybe</code></a> looks like:</p>\n\n<pre><code>instance  Functor Maybe  where\n    fmap _ Nothing       = Nothing\n    fmap f (Just a)      = Just (f a)\n</code></pre>\n\n<p>If you want something more general than <code>mult2 :: T -&gt; T</code>, you can define <code>mapConsInt :: (Int -&gt; Int) -&gt; T -&gt; T</code> instead. By the way, note that your definitions of <code>mult2</code> don't handle the <code>ConsString</code> and <code>ConsChar</code> cases, and neglecting that is almost always a bad idea. The obvious way of fixing that would be by adding do-nothing cases for the other constructors (just like is done in <code>fmap</code> for <code>Maybe</code>); depending on what you want to do, though, you might prefer making your function return a <code>Maybe T</code> instead of a <code>T</code> (in that case, note that a name started with \"map\" wouldn't be as appropriate as before).</p>\n\n<p>P.S.: A properly implemented <code>mapConsInt :: (Int -&gt; Int) -&gt; T -&gt; T</code> is very much like an <code>fmap</code>, except that it is restricted to a specific function type. In fact, it isn't actually wrong to say that we are dealing with a functor here, as long as we have it clear that it is a functor that isn't a <code>Functor</code>. (It isn't a <code>Functor</code> for the reasons discussed above, i.e. because it  can only map <code>Int -&gt; Int</code> functions.) For some considerations about how to handle such situations (as well as pointers to things you might want to know about at some point), see <a href=\"https://stackoverflow.com/q/40345838/2751851\"><em>What is the idiomatic way to build functions over newtypes (\"wrapped types\") in Haskell?</em></a> and <a href=\"https://stackoverflow.com/q/49050558/2751851\"><em>Haskell: Functor instance for newtype</em></a> (the fact that both questions happen to mention newtypes isn't essential).</p>\n"}], "owner": {"reputation": 686, "user_id": 8116864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OM0Rh.jpg?s=128&g=1", "display_name": "vasilyrud", "link": "https://stackoverflow.com/users/8116864/vasilyrud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 49594968, "answer_count": 1, "score": 2, "last_activity_date": 1522560175, "creation_date": 1522555444, "last_edit_date": 1522559158, "question_id": 49594682, "link": "https://stackoverflow.com/questions/49594682/how-to-multiply-custom-datatype-objects-inline", "title": "How to multiply custom datatype objects inline?", "body": "<p>To create the datatype-based heterogeneous list described <a href=\"https://wiki.haskell.org/Heterogenous_collections\" rel=\"nofollow noreferrer\">in this Haskell Wiki page</a>, one can define  a datatype <code>T</code> as:</p>\n\n<pre><code>data T = ConsInt    Int\n       | ConsString String\n       | ConsChar   Char\n</code></pre>\n\n<p>And then create an object using:</p>\n\n<pre><code>ConsInt 200\n</code></pre>\n\n<p>How does one then multiply an object <code>T</code>? If we use the type constructor <code>Maybe</code> as in:</p>\n\n<pre><code>Just 200\n</code></pre>\n\n<p>We can use <code>fmap (*2) (Just 200)</code> to multiply it by 2 and output a <code>Just 400</code>. </p>\n\n<p>Doing <code>fmap (*2) (ConsInt 200)</code> doesn't work, however. (I'm guessing because <code>T</code> is not a <em>type constructor</em> but a <em>data type</em>)</p>\n\n<p>How, then, does one multiply a <code>T</code> object inline, without having to define a function by hand:</p>\n\n<pre><code>mult2 :: T -&gt; T\nmult2 (ConsInt r) = ConsInt ((*2) r)\n</code></pre>\n\n<p>Or how does one use a simpler anonymous function than this:</p>\n\n<pre><code>(\\(ConsInt r) -&gt; ConsInt ((*2) r)) (ConsInt 200)\n</code></pre>\n\n<p><a href=\"http://rextester.com/VOMWE95595\" rel=\"nofollow noreferrer\">Runnable example</a></p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1522549196, "post_id": 49594201, "comment_id": 86195872, "body": "If you&#39;re using same name for different variables, something is wrong..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522573180, "post_id": 49594201, "comment_id": 86200071, "body": "I&#39;d move the recursive calls under the <code>then</code> branch, so that you only make them when needed."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1522551010, "post_id": 49594261, "comment_id": 86196134, "body": "<i>But</i> random generators support <code>split</code> which does allow you to create a lazy random &quot;monad&quot; (the monad laws will not hold exactly, but if all you care about is the distribution of values then they do)"}, {"owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1522616653, "post_id": 49594261, "comment_id": 86212377, "body": "@luqui is this <a href=\"http://hackage.haskell.org/package/MonadRandom-0.5.1/docs/Control-Monad-Random-Lazy.html\" rel=\"nofollow noreferrer\">Control.Monad.Random.Lazy</a> ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "edited": false, "score": 0, "creation_date": 1522620644, "post_id": 49594261, "comment_id": 86213436, "body": "@Timoth&#233;eJourde No, that module still appears to keep the data dependence on seeds in its <code>Monad</code>&#39;s <code>(&gt;&gt;=)</code> implementation."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1522549918, "creation_date": 1522549918, "answer_id": 49594261, "question_id": 49594201, "link": "https://stackoverflow.com/questions/49594201/infinite-recursion-with-the-rand-monad/49594261#49594261", "title": "Infinite recursion with the Rand monad", "body": "<p>Unfortunately, no, laziness can't help you here: the random seed being threaded through the computation adds a data dependency that negates any possible laziness.</p>\n\n<p>Specifically: you check whether <code>r1</code>, computed from a call to <code>getRandom</code>, is <code>True</code>. To know that, one must discover which seed to use when calling <code>getRandom</code>; and to know which seed to use, one must first do the modifications to the seed that are demanded by the recursive calls to <code>randomTree''</code>. Since the recursive calls never bottom out in a base case, they just chew up more and more RAM until your computer chokes. Bummer!</p>\n"}], "owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 49594261, "answer_count": 1, "score": 0, "last_activity_date": 1522549918, "creation_date": 1522549074, "question_id": 49594201, "link": "https://stackoverflow.com/questions/49594201/infinite-recursion-with-the-rand-monad", "title": "Infinite recursion with the Rand monad", "body": "<p>I have this working program:</p>\n\n<pre><code>import Control.Monad.Random\n\ndata Tree = Node Tree Tree Tree Tree\n          | Leaf Bool\n          deriving (Show)\n\nrandomTree' :: (RandomGen a) =&gt; Int -&gt; Rand a Tree\nrandomTree' 0 = do\n  r &lt;- getRandom\n  return $ Leaf r\n\nrandomTree' depth = do\n  let d = depth-1\n  a &lt;- randomTree' d\n  b &lt;- randomTree' d\n  c &lt;- randomTree' d\n  d &lt;- randomTree' d\n  r &lt;- getRandom\n  if r\n    then return $ Node a b c d\n    else randomTree' 0\n\nrandomTree1 :: Int -&gt; Tree\nrandomTree1 seed = evalRand (randomTree' 4) (mkStdGen seed)\n\nmain = print $ randomTree1 1\n</code></pre>\n\n<p>But I don't fully understand why this other version fails and fills up all my RAM (with thunks ?):</p>\n\n<pre><code>randomTree'' :: (RandomGen a) =&gt; Int -&gt; Rand a Tree\nrandomTree'' depth = do\n  let d = depth-1\n  a &lt;- randomTree'' d\n  b &lt;- randomTree'' d\n  c &lt;- randomTree'' d\n  d &lt;- randomTree'' d\n\n  r1 &lt;- getRandom\n  r2 &lt;- getRandom\n  if depth &gt; 0 &amp;&amp; r1\n    then return $ Node a b c d\n    else return $ Leaf r2\n</code></pre>\n\n<p>Thanks to laziness, shouldn't <code>a</code> <code>b</code> <code>c</code> and <code>d</code> be evaluated only if needed ?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 4, "creation_date": 1522548318, "post_id": 49594102, "comment_id": 86195734, "body": "This is probably slower than passing around the list in a pure context... This stack is a list, plus one indirection for the <code>STRef</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1522548609, "post_id": 49594102, "comment_id": 86195779, "body": "<code>stackDemo = reverse . map (*2)</code> would be faster"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1522549056, "post_id": 49594102, "comment_id": 86195846, "body": "@4castle Used this example for demonstration purpose."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1522549209, "post_id": 49594102, "comment_id": 86195875, "body": "@Li-yaoXia But is it fast in the ST Monad context?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1522572661, "post_id": 49594102, "comment_id": 86199954, "body": "If you have only one stack ref, and no other refs around, using <code>ST</code> is overkill -- use a <code>State [Int]</code> monad instead. If you need <code>ST</code> for other refs, then it might be a reasonable choice. It should be roughly as efficient as passing/returning a <code>[Int]</code> in non-monadic code."}], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1522547630, "creation_date": 1522547630, "question_id": 49594102, "link": "https://stackoverflow.com/questions/49594102/proper-implementation-of-stack-like-structure-in-st-monad", "title": "Proper implementation of stack-like structure in ST Monad", "body": "<p>What would be a good (in particular fast) implementation of a stack in an ST Monad like I am used to from imperative languages? I came up with this but I am unsure if there wouldn't be a better or faster solution.</p>\n\n<pre><code>import Control.Monad.ST\nimport Data.STRef\nimport Control.Monad\n\n\nstackDemo :: [Int] -&gt; [Int]\nstackDemo ls = runST $ do\n    stack &lt;- newSTRef []\n\n    forM_ ls $ \\i -&gt; do\n        temp &lt;- readSTRef stack\n        let x = 2 * i\n        writeSTRef stack (x : temp)     -- push element on stack\n\n    readSTRef stack                     -- read out stack and return it  \n</code></pre>\n\n<p>Calling it gives</p>\n\n<pre><code>*Main&gt; stackDemo [1 .. 10]\n[20,18,16,14,12,10,8,6,4,2]\n</code></pre>\n\n<p>At the end I just want a function keeping referential transparency and use a fast stack at some place in its code.</p>\n"}, {"tags": ["haskell", "polymorphism", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1522542398, "post_id": 49593692, "comment_id": 86194959, "body": "You probably want to make <code>b</code> functionally dependent on <code>a</code>, i.e. <code>{-# LANGUAGE FunctionalDependencies #-}</code> <code>class HasValue a b | a -&gt; b</code>. Or, IMO a bit preferrable, make the field type instead an associated type family:  <code>{-# LANGUAGE FunctionalDependencies #-}</code> <code>class HasValue a where {type ValueField a :: *; value :: Lens&#39; a (ValueField a)}</code>"}], "tags": [], "owner": {"reputation": 213, "user_id": 9186026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e56a5c3402d9d1acc9c670307d3ca662?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Wittmond", "link": "https://stackoverflow.com/users/9186026/alexander-wittmond"}, "is_accepted": false, "score": 4, "last_activity_date": 1522542235, "creation_date": 1522542235, "answer_id": 49593692, "question_id": 49593619, "link": "https://stackoverflow.com/questions/49593619/polymorphic-lens-without-template-haskell/49593692#49593692", "title": "Polymorphic lens without template haskell", "body": "<p>Haskell does not support overloading functions the way a language like Java or C++ does.  To do what you want you need to use a typeclass like so.</p>\n\n<pre><code>class HasValue a b where\n    value :: Lens' a b \n\ndata A = A {_valueA:: Int}\ndata B = B {_valueB:: Int}\ndata C = C {_valueC:: String}\n\ninstance HasValue A Int where\n   value = lens _valueA (\\i x -&gt; i{_valueA=x})\n\ninstance HasValue B Int where\n   value = lens _valueB (\\i x -&gt; i{_valueB=x})\n\ninstance HasValue C String where\n   value = lens _valueC (\\i x -&gt; i{_valueC=x}\n</code></pre>\n\n<p>You'll need to enable multiparameter typeclasses to do this.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 9, "last_activity_date": 1522547839, "creation_date": 1522547839, "answer_id": 49594115, "question_id": 49593619, "link": "https://stackoverflow.com/questions/49593619/polymorphic-lens-without-template-haskell/49594115#49594115", "title": "Polymorphic lens without template haskell", "body": "<p>Lenses can be derived without TH by <a href=\"https://hackage.haskell.org/package/generic-lens\" rel=\"noreferrer\"><em>generic-lens</em></a>. You can specialize the generic <code>field</code> lens to a specific field and give it a name as follows.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeApplications #-}\n\nimport GHC.Generics (Generic)\nimport Control.Lens (Lens, (^.))\nimport Data.Generics.Product (HasField(field))\n\ndata A = A { _value :: Int } deriving Generic\ndata B = B { _value :: Int } deriving Generic\ndata C = C { _value :: String } deriving Generic\n\nvalue :: HasField \"_value\" s t a b =&gt; Lens s t a b\nvalue = field @\"_value\"\n\nmain :: IO ()\nmain = print (A 0 ^. value, B 0 ^. value, C \"0\" ^. value)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1526145015, "creation_date": 1526145015, "answer_id": 50308782, "question_id": 49593619, "link": "https://stackoverflow.com/questions/49593619/polymorphic-lens-without-template-haskell/50308782#50308782", "title": "Polymorphic lens without template haskell", "body": "<p>If you want to avoid <code>DuplicateRecordFields</code>, another option is to define everything in its own module, though this will require qualified imports for them to be imported into the same module.</p>\n\n<pre><code>module Sample.A where\nimport Control.Lens\ndata A = A {_value:: Int}\nvalue = lens _value (\\i x -&gt; i{_value=x})\n\nmodule Sample.B where\nimport Control.Lens\ndata B = B {_value:: Int}\nvalue = lens _value (\\i x -&gt; i{_value=x})\n\nmodule Sample.C where\nimport Control.Lens\ndata C = C {_value:: String}\nvalue = lens _value (\\i x -&gt; i{_value=x})\n\nmodule Main where\nimport qualified Sample.A as A\nimport qualified Sample.B as B\nimport qualified Sample.C as C\n\nmain :: IO ()\nmain = print (A.A 0 ^. A.value, B.B 0 ^. B.value, C.C \"0\" ^. C.value)\n</code></pre>\n"}], "owner": {"reputation": 5502, "user_id": 350127, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c46a4215e49e00007cd622b75df75f91?s=128&d=identicon&r=PG", "display_name": "yilmazhuseyin", "link": "https://stackoverflow.com/users/350127/yilmazhuseyin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1526145015, "creation_date": 1522541216, "question_id": 49593619, "link": "https://stackoverflow.com/questions/49593619/polymorphic-lens-without-template-haskell", "title": "Polymorphic lens without template haskell", "body": "<p>I am trying to create a polymorphic lens decleration (without template haskell) for multiple types.</p>\n\n<pre><code>module Sample where\nimport Control.Lens\ndata A = A {_value:: Int}\ndata B = B {_value:: Int}\ndata C = C {_value:: String}\nvalue = lens _value (\\i x -&gt; i{_value=x}) -- &lt;&lt;&lt; ERROR\n</code></pre>\n\n<p>But I get following error:</p>\n\n<pre><code>Ambiguous occurrence \u2018_value\u2019\nIt could refer to either the field \u2018_value\u2019,\n                         defined at library/Sample.hs:5:13\n                      or the field \u2018_value\u2019, defined at \nlibrary/Sample.hs:4:13\n                      or the field \u2018_value\u2019, defined at \nlibrary/Sample.hs:3:13\n  |\n6 | value = lens _value (\\i x -&gt; i{_value=x}) -- &lt;&lt;&lt; ERROR\n  |              ^^^^^^\n</code></pre>\n\n<p>So, goal is to have <code>value</code> lens to work on all three types A, B and C. Is there a way to achieve that?\nThanks.</p>\n"}, {"tags": ["haskell", "exception", "constructor", "record"], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1522540466, "post_id": 49593556, "comment_id": 86194635, "body": "Is there any reason not to fold the third guard into the second in the second solution?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1522540529, "post_id": 49593556, "comment_id": 86194644, "body": "@HTNW No, not at all! Good suggestion; I&#39;ll improve the answer with it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1522540505, "last_edit_date": 1522540505, "creation_date": 1522540395, "answer_id": 49593556, "question_id": 49593404, "link": "https://stackoverflow.com/questions/49593404/types-and-typeclasses-in-haskell-missing-field-in-record-construction/49593556#49593556", "title": "Types and Typeclasses in Haskell: Missing field in record construction", "body": "<p>Rather than checking whether your <code>thing</code> is equal to a specific <code>Car</code>, which is what <code>(==)</code> is for, you seem to want to check whether it's <em>any</em> kind of <code>Car</code>. So:</p>\n\n<pre><code>isCar (C Car{}) = True\nisCar _ = False\n\nfindCar things =\n    [ (x, y)\n    | (y, row) &lt;- enumerate things\n    , (x, thing) &lt;- enumerate row\n    , isCar thing\n    ]\n</code></pre>\n\n<p>(I've removed the unnecessary and potentially confusing <code>do</code> from <code>findCar</code>.)</p>\n\n<p>Alternately, you could use the behavior of failed pattern matches in list comprehensions:</p>\n\n<pre><code>findCar things =\n    [ (x, y)\n    | (y, row) &lt;- enumerate things\n    , (x, C Car{}) &lt;- enumerate row\n    ]\n</code></pre>\n\n<p>This is a well-known trick, but a bit subtle and possibly confusing in a quick read of the code (since the match looks partial, but isn't), so it may be worth avoiding in a codebase shared between many programmers.</p>\n"}], "owner": {"reputation": 61, "user_id": 8858324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/498fc908267983c2e6dfa042ba6dc1d8?s=128&d=identicon&r=PG&f=1", "display_name": "oldboy123", "link": "https://stackoverflow.com/users/8858324/oldboy123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 49593556, "answer_count": 1, "score": 1, "last_activity_date": 1522540505, "creation_date": 1522538674, "question_id": 49593404, "link": "https://stackoverflow.com/questions/49593404/types-and-typeclasses-in-haskell-missing-field-in-record-construction", "title": "Types and Typeclasses in Haskell: Missing field in record construction", "body": "<p>I have three datatypes:</p>\n\n<pre><code>data Person = Person { firstName :: String  \n                     , lastName :: String  \n                     , age :: Int  \n                     , height :: Float  \n                     , phoneNumber :: String  \n                     , flavor :: String  \n                     } deriving (Eq,Show, Read) \n\ndata Car = Car {company :: String, model :: String, year :: Int} deriving (Eq,Show,Read)  \n\ndata Things = C Car | P Person deriving (Eq,Show,Read) \n</code></pre>\n\n<p>And I want to find the Car's coordinates in a [[Things]].</p>\n\n<p>I tried: </p>\n\n<pre><code>enumerate = zip [0..]\n\nfindCar :: [[Things]] -&gt; [(Int, Int)]\nfindCar things = do\n        [(x, y)\n          | (y, row) &lt;- enumerate things\n          , (x, thing) &lt;- enumerate row\n          , thing == C (Car { })]\n</code></pre>\n\n<p>But I got an Exception: 'Missing field in record construction company'.</p>\n\n<p>How can I find coordinates of Car in a [[Things]] in a proper way?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522535324, "post_id": 49591947, "comment_id": 86193668, "body": "This may be out of ignorance, but I cannot see how this answers my question."}, {"owner": {"reputation": 303, "user_id": 9557757, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dNmFv.png?s=128&g=1", "display_name": "Scarabyte", "link": "https://stackoverflow.com/users/9557757/scarabyte"}, "reply_to_user": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522561013, "post_id": 49591947, "comment_id": 86197530, "body": "Instead of changing the types from <code>Integer</code> to <code>Fractiona</code>l, <code>Rational</code>, <code>Float</code> or whatever, I suggest to do it with <code>Integer</code> and <code>div</code>, changing the formula itself."}], "tags": [], "owner": {"reputation": 303, "user_id": 9557757, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dNmFv.png?s=128&g=1", "display_name": "Scarabyte", "link": "https://stackoverflow.com/users/9557757/scarabyte"}, "is_accepted": false, "score": 0, "last_activity_date": 1522527023, "creation_date": 1522527023, "answer_id": 49591947, "question_id": 49591643, "link": "https://stackoverflow.com/questions/49591643/rewriting-euler-totient-function-in-haskell/49591947#49591947", "title": "rewriting euler-totient function in haskell", "body": "<p>So, your <code>totientRevisited n = n * (1 - 1/p_1) * (1 - 1/p2) * .. * (1 - 1/p_k)</code></p>\n\n<p>Instead of multiplying expressions in parentheses first, why don't you do it like this:</p>\n\n<pre><code>x_0 = n\nx_1 = x_0 * (1 - 1/p_1) = x_0 - x_0/p_1 = x_0 - x_0 `div` p_1\nx_2 = x_1 * (1 - 1/p_2) = x_1 - x_1/p_2 = x_1 - x_1 `div` p_2\nx_3 = ...\n</code></pre>\n\n<p>And so on. This is <strong>integer</strong> arithmetic, and it can easily be written on Haskell.</p>\n"}, {"comments": [{"owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "edited": false, "score": 0, "creation_date": 1522598511, "post_id": 49593317, "comment_id": 86206882, "body": "Thank you. Very clear, and also justified the presence of $ in Haskell :)"}], "tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": true, "score": 3, "last_activity_date": 1522598774, "last_edit_date": 1522598774, "creation_date": 1522537880, "answer_id": 49593317, "question_id": 49591643, "link": "https://stackoverflow.com/questions/49591643/rewriting-euler-totient-function-in-haskell/49593317#49593317", "title": "rewriting euler-totient function in haskell", "body": "<p>There are two reasons why:</p>\n\n<pre><code>totientRevisited n = n * product  map (\\x-&gt;1-1/x) (primeFactors n)\n</code></pre>\n\n<p>doesn't work. </p>\n\n<p>First, <code>product</code> expects one argument (a <code>(Num a, Foldable t) =&gt; t a</code>) and you give it three (<code>map</code>, <code>(\\x-&gt;1-1/x)</code> and <code>(primeFactors n)</code>). That's the typical use case for <code>$</code>. You lack parentheses around the product too. Let's write this:</p>\n\n<pre><code>totientRevisited n = n * (product $ map (\\x-&gt;1-1/x) (primeFactors n))\n</code></pre>\n\n<p>Second, you have an issue with numeric types. You are dividing <code>1</code> by an Integer. Yet <code>/</code> takes two Fractionals:</p>\n\n<pre><code>Prelude&gt; :t (/)\n(/) :: Fractional a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>You have to convert <code>x</code> to a Fractional. Use the <code>fromIntegral</code> function:</p>\n\n<pre><code>totientRevisited n = (fromIntegral n) * (product $ map (\\x-&gt;1-1/(fromIntegral x)) (primeFactors n))\n</code></pre>\n\n<p>You have to use <code>fromIntegral n</code> because <code>(*)</code> takes two Nums of the same type:</p>\n\n<pre><code>Prelude&gt; :t (*)\n(*) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Now it runs, but it returns an Fractional. </p>\n\n<p>Just take the <code>round</code> of the result to get an Integer (again, note the <code>$</code>) and you are done:</p>\n\n<pre><code>totientRevisited n = round $ (fromIntegral n) * (product $ map (\\x-&gt;1-1/(fromIntegral x)) (primeFactors n))\n</code></pre>\n\n<p><strong>EDIT</strong> Precision: I wrote that \"<code>product</code> expects one argument (a <code>(Num a, Foldable t) =&gt; t a</code>) and you give it three (<code>map</code>, <code>(\\x-&gt;1-1/x)</code> and <code>(primeFactors n)</code>)\". That's technically not true: you can't give three arguments to a function, because a function in Haskell always takes <em>one</em> argument and might return another function that will take another argument... That's what \"curryfication\" means. Thus, you gave to <code>product</code> the argument <code>map</code>, yet it expects a foldable, hence the error. </p>\n"}], "owner": {"reputation": 221, "user_id": 6442349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZrZB.jpg?s=128&g=1", "display_name": "Andres Mejia", "link": "https://stackoverflow.com/users/6442349/andres-mejia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 49593317, "answer_count": 2, "score": 3, "last_activity_date": 1522598774, "creation_date": 1522524882, "last_edit_date": 1522525001, "question_id": 49591643, "link": "https://stackoverflow.com/questions/49591643/rewriting-euler-totient-function-in-haskell", "title": "rewriting euler-totient function in haskell", "body": "<p>If I wanted to write the totient function, one way (assuming that we have a <code>primeFactors</code> function, that returns a list including multiplicity.) is the following:</p>\n\n<pre><code>totient:: Integer-&gt;Integer\ntotient m = product [(p - 1)  | p &lt;- primeFactors m]\n</code></pre>\n\n<p>which would be fine, but there is another way to do this, by taking the product over (1-1/p) and just multiplying the product by n. However, there is a \"type\" problem here, since 1-1/p is never an integer, so something like</p>\n\n<pre><code>totientRevisited n =n* product  map (\\x-&gt;1-1/x) (primeFactors n)\n</code></pre>\n\n<p>will not run in Haskell as written.</p>\n\n<p>My question is whether or not there is a simple way to pass to a new type in between the function. I suspect some way of currying, but I've been unable to work it out.</p>\n"}, {"tags": ["c", "arrays", "haskell", "ffi"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522527787, "post_id": 49591517, "comment_id": 86191716, "body": "Since the array contains a fixed number of elements, the most faithful Haskell translation would be <code>data CTRIANGLE = CTRIANGLE { _one :: XYZ, _two :: XYZ, _three :: XYZ }</code>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522528954, "post_id": 49591517, "comment_id": 86192007, "body": "The code in my update works !!!!! I will post an answer."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 2, "last_activity_date": 1522530106, "last_edit_date": 1522530106, "creation_date": 1522529288, "answer_id": 49592263, "question_id": 49591517, "link": "https://stackoverflow.com/questions/49591517/passing-static-array-between-c-and-haskell-with-hsc2hs/49592263#49592263", "title": "Passing static array between C and Haskell with hsc2hs", "body": "<p>The code I gave in the update works :)</p>\n\n<p>In <code>marchingcubes.hsc</code>:</p>\n\n<pre><code>data CTRIANGLE = CTRIANGLE {\n  __p :: [CXYZ]\n} deriving Show\n\ninstance Storable CTRIANGLE where\n  sizeOf    __ = #{size TRIANGLE}\n  alignment __ = #{alignment TRIANGLE}\n  peek ptr = do\n    p' &lt;- peekArray 3 $ #{ptr TRIANGLE, p} ptr\n    return CTRIANGLE { __p = p' }\n  poke ptr (CTRIANGLE r1) = do\n    pokeArray (#{ptr TRIANGLE, p} ptr) r1\n\nforeign import ccall unsafe \"testTriangle\" c_testTriangle\n  :: CDouble -&gt; CDouble -&gt; CDouble \n  -&gt; IO (Ptr CTRIANGLE)\n</code></pre>\n\n<p>Now let's check. I do a file <code>marchingcubes.c</code>:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include \"marchingcubes.h\"\n\nTRIANGLE* testTriangle(double a, double b, double c){\n  XYZ xyz;\n  xyz.x = a;\n  xyz.y = b;\n  xyz.z = c;\n  TRIANGLE *tri = malloc(sizeof(TRIANGLE));\n  tri[0].p[0] = xyz;\n  tri[0].p[1] = xyz;\n  tri[0].p[2] = xyz;\n  return tri;\n}\n</code></pre>\n\n<p>And I do a module:</p>\n\n<pre><code>module Lib\n  where\nimport           CTypes\nimport           Foreign\n\nsomeFunc :: IO CTRIANGLE\nsomeFunc = do\n    ptr &lt;- c_testTriangle 1 2 3\n    peek ptr\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>Prelude Lib&gt; someFunc\nCTRIANGLE {__p = [CXYZ {__x = 1.0, __y = 2.0, __z = 3.0},CXYZ {__x = 1.0, __y = 2.0, __z = 3.0},CXYZ {__x = 1.0, __y = 2.0, __z = 3.0}]}\n</code></pre>\n\n<p>This is the desired result :)</p>\n\n<p>And don't forget</p>\n\n<pre><code>  include-dirs:        C\n  C-sources:           C/marchingcubes.c\n</code></pre>\n\n<p>in the <code>cabal</code> file.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 49592263, "answer_count": 1, "score": 2, "last_activity_date": 1522530106, "creation_date": 1522524111, "last_edit_date": 1522527185, "question_id": 49591517, "link": "https://stackoverflow.com/questions/49591517/passing-static-array-between-c-and-haskell-with-hsc2hs", "title": "Passing static array between C and Haskell with hsc2hs", "body": "<p>Here is a simple <code>h</code> file:</p>\n\n<pre><code>/* file marchingcubes.h */\ntypedef struct {\n   double x,y,z;\n} XYZ;\n</code></pre>\n\n<p>To define the analogous type in Haskell, I'm using <code>hsc2hs</code>. I write this file <code>CTypes.hsc</code>:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule CTypes \n  where\nimport           Foreign\nimport           Foreign.C.Types\n\n#include \"marchingcubes.h\"\n\ndata CXYZ = CXYZ {\n    __x :: CDouble\n  , __y :: CDouble\n  , __z :: CDouble\n}\n\ninstance Storable CXYZ where\n    sizeOf    __ = #{size XYZ}\n    alignment __ = #{alignment XYZ}\n    peek ptr = do\n      x' &lt;- #{peek XYZ, x} ptr\n      y' &lt;- #{peek XYZ, y} ptr\n      z' &lt;- #{peek XYZ, z} ptr\n      return CXYZ { __x = x'\n                  , __y = y'\n                  , __z = z' }\n    poke ptr (CXYZ r1 r2 r3)\n      = do\n          #{poke XYZ, x} ptr r1\n          #{poke XYZ, y} ptr r2\n          #{poke XYZ, z} ptr r3\n</code></pre>\n\n<p>No problem with and after the conversion to <code>hs</code> using <code>hsc2hs</code>. </p>\n\n<p>Now I have another struct, containing a static array:</p>\n\n<pre><code>typedef struct {\n   XYZ p[3];\n} TRIANGLE;\n</code></pre>\n\n<p>How do I define the analogous type in Haskell in a <code>hsc</code> file ? Can I have something like:</p>\n\n<pre><code>data CTRIANGLE = CTRIANGLE {\n  __p :: [CXYZ]\n}\n</code></pre>\n\n<p>? How would I define the <code>Storable</code> instance ? I've found a couple of questions of SO about arrays and the FFI but nothing allowing me to solve this question.</p>\n\n<h1>UPDATE</h1>\n\n<p>I've done:</p>\n\n<pre><code>data CTRIANGLE = CTRIANGLE {\n  __p :: [CXYZ]\n}\n\ninstance Storable CTRIANGLE where\n  sizeOf    __ = #{size TRIANGLE}\n  alignment __ = #{alignment TRIANGLE}\n  peek ptr = do\n    p' &lt;- peekArray 3 $ #{ptr TRIANGLE, p} ptr\n    return CTRIANGLE { __p = p' }\n  poke ptr (CXY r1) = do\n    pokeArray (#{ptr TRIANGLE, p} ptr) r1\n</code></pre>\n\n<p>And <code>hsc2hs</code> generates:</p>\n\n<pre><code>instance Storable CTRIANGLE where\n  sizeOf    __ = (72)\n{-# LINE 37 \"CTypes.hsc\" #-}\n  alignment __ = 8\n{-# LINE 38 \"CTypes.hsc\" #-}\n  peek ptr = do\n    p' &lt;- peekArray 3 $ (\\hsc_ptr -&gt; hsc_ptr `plusPtr` 0) ptr\n{-# LINE 40 \"CTypes.hsc\" #-}\n    return CTRIANGLE { __p = p' }\n  poke ptr (CXY r1) = do\n    pokeArray ((\\hsc_ptr -&gt; hsc_ptr `plusPtr` 0) ptr) r1\n{-# LINE 43 \"CTypes.hsc\" #-}\n</code></pre>\n\n<p>Now I have to test to see whether this works.</p>\n"}, {"tags": ["user-interface", "haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522523062, "post_id": 49591347, "comment_id": 86190500, "body": "This sounds like a misdiagnosis but without any code we can&#39;t help.  I suggest you make a MCVE."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522529533, "post_id": 49591347, "comment_id": 86192140, "body": "You say, &quot;other than putting in a bunch of <code>seq</code>, how does one deal with this issue?&quot;. Have you verified that putting in a bunch of <code>seq</code> does, in fact, deal with this issue?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1522598145, "post_id": 49591347, "comment_id": 86206789, "body": "I can&#39;t write a full answer right now; in any case, the main issue here is that you aren&#39;t actually running the <code>IO</code> actions that add the buttons to the frame. You probably want to use <code>traverse</code> on the list, instead of <code>map</code> and <code>return</code>."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1522981172, "creation_date": 1522981172, "answer_id": 49684275, "question_id": 49591347, "link": "https://stackoverflow.com/questions/49591347/trouble-with-haskell-gui-programming-and-lazy-evaluation/49684275#49684275", "title": "Trouble with Haskell GUI programming and lazy evaluation", "body": "<blockquote>\n  <p>This doesn't work out that well, usually never resulting in the widget getting displayed due to lazy evaluation discarding the widget before it gets a chance to be put on the screen.</p>\n</blockquote>\n\n<p>As Thomas M. DuBuisson suggests, that is a misdiagnosis: the issue here doesn't have to do with lazy evaluation (and in any case lazy evaluation wouldn't discard a value you actually tried to use). Let's have a look at the line at which you'd supposedly add the buttons to the panel:</p>\n\n<pre><code>d &lt;- return $ map (\\(x,y_m) -&gt;\n    y_m &gt;&gt;= (\\y -&gt; set ff [ color := white, layout := minsize (sz 300 300) $ widget y ]))\n    $ Map.toList pps\n</code></pre>\n\n<p>The type of <code>Map.toList pps</code> is <code>[((Int, Int), IO (Button ())]</code>. Your use of <code>map</code> changes it into <code>[IO ()]</code> (cf. <a href=\"https://hackage.haskell.org/package/wx-0.92.3.0/docs/Graphics-UI-WX-Attributes.html#v:set\" rel=\"nofollow noreferrer\">the type of <code>set</code></a>), a <em>list of <code>IO</code> actions</em>. In effect, you are setting up the actions that add the buttons, but you never actually run them. To do that, you want <code>traverse_</code> from <code>Data.Foldable</code> instead of <code>map</code>:</p>\n\n<pre><code>traverse_ (\\(x,y_m) -&gt;\n    y_m &gt;&gt;= (\\y -&gt; set ff [ color := white, layout := minsize (sz 300 300) $ widget y ]))\n    $ Map.toList pps\n</code></pre>\n\n<p>(For more on <code>traverse_</code> and its cousin <code>traverse</code>, see <a href=\"https://stackoverflow.com/a/7460846/2751851\">this answer</a>, as well as the other answers to the parent question.)</p>\n\n<p>Note that, unless I'm badly misreading the WX-specific code, <em>this still won't do what you want</em>. As each <code>IO</code> action you generate for a list element resets the layout of the frame, you'll  end up with only the last button in the frame. To get a sensible layout, you'll have to actually use the coordinate values, as well as the WX layout combinators to set up a single layout with all buttons. Cf. <a href=\"https://hackage.haskell.org/package/wx-0.92.3.0/docs/Graphics-UI-WX-Layout.html#v:layout\" rel=\"nofollow noreferrer\">the <code>Graphics.UI.WX.Layout</code> documentation</a>.</p>\n\n<p>On a final note, code like this in a do-block...</p>\n\n<pre><code>bar &lt;- return foo\n</code></pre>\n\n<p>... is always redundant: it can be replaced by:</p>\n\n<pre><code>let bar = foo\n</code></pre>\n\n<p>In your case, doing that would have made it much more obvious that you weren't actually running the actions.</p>\n\n<p>(Your uses of <code>Map.fromList</code> and <code>Map.toList</code> are also redundant, but I guess you already suspected that.)</p>\n"}], "owner": {"reputation": 71, "user_id": 3072719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/LESKH.jpg?s=128&g=1", "display_name": "AlterionX", "link": "https://stackoverflow.com/users/3072719/alterionx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 49684275, "answer_count": 1, "score": 0, "last_activity_date": 1522981172, "creation_date": 1522522851, "last_edit_date": 1522526919, "question_id": 49591347, "link": "https://stackoverflow.com/questions/49591347/trouble-with-haskell-gui-programming-and-lazy-evaluation", "title": "Trouble with Haskell GUI programming and lazy evaluation", "body": "<p>In an attempt to use Haskell for a graphical application, I've had a lot of  trouble getting the GUI to evaluate in an eager fashion.</p>\n\n<p>For example, I sometimes attempt to create widgets somewhere in the program, package it and send it to other components of my program.</p>\n\n<p>This doesn't work out that well, usually never resulting in the widget getting displayed due to lazy evaluation discarding the widget before it gets a chance to be put on the screen.</p>\n\n<p>So I wanted to know, other than putting in a bunch of <code>seq</code> and other variations to encourage eager evaluation, can/how does one deal with this issue?</p>\n\n<p>I've searched for an answer, but couldn't really find anything related to this line of questioning.</p>\n\n<p>EDIT: sample code</p>\n\n<p>The code below produced an empty window.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n    -- allows recursive do notation\n    -- mdo\n    --  ...\n\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport qualified Data.Map.Strict as Map\nimport qualified Data.List       as List\nimport System.Random\n\nimport Graphics.UI.WX hiding (Event)\nimport Graphics.UI.WXCore as WXCore\nimport Reactive.Banana\nimport Reactive.Banana.WX\n\nboardWidth, boardHeight :: Int\nboardWidth  = 41\nboardHeight = 81\n\nmain :: IO ()\nmain = start tetris\n\ntetris = do\n    ff &lt;- frame [text      := \"Tetris\"\n                ,bgcolor   := white\n                ,resizeable:= False]\n\n    p &lt;- panel ff []\n    set ff [ layout := minsize (sz 100 100) $ widget p]\n\n    pps &lt;- return $ Map.fromList $ map (\\l@(x,y) -&gt; (l, button p []))\n                    [(x,y) | x &lt;- [1..(boardWidth  `div` 2)], y &lt;- [1..(boardHeight `div` 2)]]\n\n    -- p &lt;- pps Map.! (1,2)\n\n    d &lt;- return $ map (\\(x,y_m) -&gt; y_m &gt;&gt;= (\\y -&gt; set ff [ color := white, layout := minsize (sz 300 300) $ widget y ])) $ Map.toList pps\n\n    -- let networkDescription :: Moment IO ()\n    return ff\n</code></pre>\n\n<p>The line <code>p &lt;- pps Map.! (1,2)</code> results in the tile at 1, 2 to display without the proper size.</p>\n"}, {"tags": ["haskell", "set"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522519675, "post_id": 49590795, "comment_id": 86189442, "body": "The fact that the set has sets in it is irrelevant. But you should probably use <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Set.html#v:minView\" rel=\"nofollow noreferrer\"><code>minView</code></a> instead of the partial  <code>deleteFindMin</code>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522519713, "post_id": 49590795, "comment_id": 86189455, "body": "Well <code>deleteFindMin</code> will give you one set and the rest. Be wary of what \u201cfirst set\u201d means as the typeclass provided ordering won\u2019t necessarily give you the order you want."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522519913, "post_id": 49590795, "comment_id": 86189512, "body": "But maybe what you really want is to fold."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522520231, "post_id": 49590795, "comment_id": 86189603, "body": "@DanRobertson I don&#39;t actually care about order...I need to have pair - (firstSet, &quot;othersSet&quot;) as described above."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522520351, "post_id": 49590795, "comment_id": 86189636, "body": "So why doesn\u2019t <code>deleteFindMin</code> or <code>minView</code> work?"}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522520656, "post_id": 49590795, "comment_id": 86189717, "body": "@Dan I just edited the question."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522520751, "post_id": 49590795, "comment_id": 86189751, "body": "Ok but that says your extracting one set from a set of sets and giving that to something that wants a list."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522522332, "post_id": 49590795, "comment_id": 86190281, "body": "@Dan I added more of my code. Hope it&#39;s enough, in case it isn&#39;t, just tell me."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522522838, "post_id": 49590795, "comment_id": 86190439, "body": "<code>fromCtoA</code> probably wants a String as it\u2019s first argument but you pass a set of strings. One thing you could try is adding types before your functions and then the compiler can tell you if you\u2019ve done something wrong. E.g <code>firstFor :: (Set.Set String, Set.Set (Set.Set String)) -&gt; [???] -&gt; KAutomat</code>. You should make sure that the types make sense for what the function does. Note that in <code>firstFor</code> you match a list as <code>(c:cs)</code> and then ask whether <code>not (null (c:cs))</code> but this will always hold: If the list is null then you\u2019ll get a match failure trying to split it into <code>c</code> and <code>cs</code>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522522866, "post_id": 49590795, "comment_id": 86190448, "body": "You also don\u2019t need (and so shouldn\u2019t use) <code>do</code>."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522524057, "post_id": 49590795, "comment_id": 86190772, "body": "@Dan May I know what&#39;s wrong with using <code>do</code> blocks?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522524264, "post_id": 49590795, "comment_id": 86190817, "body": "When someone used to Haskell sees <code>do</code>, they think \u201cwhat monad is this in and what is going to happen?\u201d But in your case you aren\u2019t really in a monad and so there is confusion in trying to work out why you are claiming to be (by writing <code>do</code>) and so it is harder to work out what your code is actually doing. In this case however the use or not of <code>do</code> appears to have relatively little impact on the codes readability."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522527260, "post_id": 49590795, "comment_id": 86191558, "body": "I would find that <code>do</code> confusing for sure, for the reasons @DanRobertson described. You can&#39;t actually do anything nontrivial in that <code>do</code> block without a type error."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522528824, "post_id": 49590795, "comment_id": 86191972, "body": "You must present an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>; your current attempt does not meet this standard because it is not complete (many identifiers are not in scope), not verifiable (it does not parse, let alone get far enough in type checking to get your error), and probably not minimal (I doubt such a complicated <code>KAutomat</code> is needed to produce your error). Furthermore, you should include the <i>complete</i> error in the question, not just an excerpt."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1522529237, "creation_date": 1522529237, "answer_id": 49592258, "question_id": 49590795, "link": "https://stackoverflow.com/questions/49590795/whats-an-alternative-for-deletefindmin-for-set-of-sets/49592258#49592258", "title": "Whats an alternative for deleteFindMin for set of sets?", "body": "<p>I can highlight one conflict in the code for you, though with the information given it's probably not possible to say what the right fix is. (I've left a comment on your question describing the effort I would expect you to put in that would make it possible to give more concrete help.)</p>\n\n<p>Here is the conflict. You write</p>\n\n<pre><code>fromCtoA (a:as) c ts = ts\n</code></pre>\n\n<p>from which, since <code>a:as</code> can only be a list, we conclude that <code>fromCtoA</code> must take a list as its first argument. You also write:</p>\n\n<pre><code>reduce ... = ... firstFor (Set.deleteFindMin (setW ts)) ...\nfirstFor (a,w) ... = ... fromCtoA a ...\n</code></pre>\n\n<p>Since <code>setW</code> returns a <code>Set (Set String)</code>, the <code>deleteFindMin</code> call will return a <code>(Set String, Set (Set String))</code>, and so <code>a</code> will be a <code>Set String</code>, from which we conclude that <code>fromCtoA</code> must accept a <code>Set String</code> as its first argument. This is not compatible with our previous conclusion that <code>fromCtoA</code> can only accept lists.</p>\n"}], "owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522529237, "creation_date": 1522519221, "last_edit_date": 1522522281, "question_id": 49590795, "link": "https://stackoverflow.com/questions/49590795/whats-an-alternative-for-deletefindmin-for-set-of-sets", "title": "Whats an alternative for deleteFindMin for set of sets?", "body": "<p>What's the equivalent function of <code>Data.Set.deleteFindMin</code> for usage on set of sets?\nI created following type: </p>\n\n<blockquote>\n  <p>type SofSes = Set.Set (Set.Set String)</p>\n</blockquote>\n\n<p>All I need is to pick first set and return it like:</p>\n\n<blockquote>\n  <p>{{firstSet},{secondSet},...,{n-thSet}} -> ({firstSet},{{secondSet},...,{n-thSet}})</p>\n</blockquote>\n\n<p><code>deleteFindMin</code>'s error message: </p>\n\n<pre><code>Couldn't match type `Set.Set String' with `[t0]'\n    Expected type: Set.Set [t0]\n      Actual type: Set.Set (Set.Set String)\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>reduce ts   \n    | (Set.null (setW ts))==False = do                                   \n        reduce (firstFor (Set.deleteFindMin (setW ts)) (getAlphabet ts)                                              \n    | otherwise = ts\n\n\nfirstFor (a,w) (c:cs) ts                                                                   \n    | null(c:cs)==False = do \n        secondFor (fromCtoA a c ts) ts                                            \n    | otherwise =  ts\n\nfromCtoA (a:as) c ts = ts  --function that is not finished yet (TODO)    \n\ndata KAutomat = KA\n    { states :: Set.Set String\n    , start :: KState\n    , final :: Set.Set String\n    , trans :: [Transition]\n    , setW :: Set.Set (Set.Set String)\n    , setP :: Set.Set (Set.Set String)\n    } deriving (Eq)\n</code></pre>\n\n<p>Variable <code>ts</code> is of type KAutomat.</p>\n"}, {"tags": ["haskell", "pattern-matching", "codeworld"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1522523267, "creation_date": 1522523267, "answer_id": 49591408, "question_id": 49590571, "link": "https://stackoverflow.com/questions/49590571/how-to-create-a-function-that-graphs-objects-in-haskell-in-haskell/49591408#49591408", "title": "How to create a function that graphs objects in haskell in Haskell", "body": "<pre><code>graphicToPic (s c p) = ...\n</code></pre>\n\n<p>This is nonsense.  You should use the constructor to destruct the value:</p>\n\n<pre><code>graphicToPic (Graphic s c p) = ...\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 9573782, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_PLDg0WL0G4/AAAAAAAAAAI/AAAAAAAABVM/rkO3KRgRlEs/photo.jpg?sz=128", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/9573782/mikhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1522880316, "creation_date": 1522517617, "last_edit_date": 1522880316, "question_id": 49590571, "link": "https://stackoverflow.com/questions/49590571/how-to-create-a-function-that-graphs-objects-in-haskell-in-haskell", "title": "How to create a function that graphs objects in haskell in Haskell", "body": "<p>How to Format\n\u25ba put returns between paragraphs</p>\n\n<p>\u25ba for linebreak add 2 spaces at end</p>\n\n<p>\u25ba <em>italic</em> or <strong>bold</strong></p>\n\n<p>\u25ba indent code by 4 spaces</p>\n"}, {"tags": ["haskell", "recursion", "types", "functional-programming", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "edited": false, "score": 0, "creation_date": 1522521451, "post_id": 49590677, "comment_id": 86189960, "body": "I&#39;ve implemented it and it&#39;s simplifying somewhat but not entirely. For instance, <code>eval (Add (Const 10.0) (Add (Add (Const 4.0) (Var &#39;y&#39;)) (Var &#39;x&#39;)))</code> only gives <code>Add (Const 10.0) (Add (Add (Const 4.0) (Var &#39;y&#39;)) (Var &#39;x&#39;))</code>"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "edited": false, "score": 0, "creation_date": 1522527977, "post_id": 49590677, "comment_id": 86191765, "body": "@JackBuckley That&#39;s more complicated. One way to achieve that would be to turn a sequence of additions into a list and than replace all constants with a single one. Note that this simplification (unlike what we did so far) is operator specific. For, say, the power operator <code>2^(3^x)</code> would already be the most simple form and could not be simplified any further. The only reason that we can simplify <code>2+(3+x)</code> to <code>5+x</code> is that we know that addition is an associative operation."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "edited": false, "score": 0, "creation_date": 1522528375, "post_id": 49590677, "comment_id": 86191867, "body": "@JackBuckley Also note that there are many more optimizations that one could apply (<code>1*x == x+0 == x</code>, <code>0*x = 0</code>, <code>2*x + 3*x == 5*x</code> etc.). It&#39;s just a matter of how many rules about the operators you can think of and how much time you want to spend implementing them."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1522518394, "creation_date": 1522518394, "answer_id": 49590677, "question_id": 49590435, "link": "https://stackoverflow.com/questions/49590435/haskell-how-to-define-my-custom-math-data-type-recursively-stop-infinite-recur/49590677#49590677", "title": "Haskell: How to define my custom math data type recursively (stop infinite recursion)", "body": "<p>Your problem is that you don't treat expressions that are already simplified any differently than those that aren't. You keep calling <code>eval</code> until both operands are constants and if that never happens, you never terminate. The most simple problematic input would be <code>Add (Var \"x\") (Const 5)</code>. Such an input should end the recursion and just return itself. But instead it will keep calling <code>eval</code> on the same input:</p>\n\n<pre><code>  eval (Add (Var \"x\") (Const 5))\n= eval (Add (Var \"x\") (eval (Const 5)))\n= eval (Add (Var \"x\") (Const 5))\n= eval (Add (Var \"x\") (eval (Const 5)))\n= ... ad infinitum\n</code></pre>\n\n<p>In general the way to avoid this kind of problem in the first place, i.e. to make it obvious when you're missing a base case, is to structure your function in such a way that all recursive cases of your function call itself only with sub-expressions of the argument expression.</p>\n\n<p>In this case that could be achieved by evaluating the operands first and then constant-folding the result without another recursive call. That would look like this:</p>\n\n<pre><code>eval (Add a b) =\n  case (eval a, eval b) of\n    (Const x, Const y) =&gt; Const (x+y)\n    (x, y) =&gt; Add x y\n</code></pre>\n\n<p>Here the only recursive calls are <code>eval a</code> and <code>eval b</code> where <code>a</code> and <code>b</code> are subexpressions of the original expression. This guarantees termination because if all cases follow this rule, you'll eventually reach expressions that have no subexpressions, meaning the recursion must terminate.</p>\n"}], "owner": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522518394, "creation_date": 1522516824, "question_id": 49590435, "link": "https://stackoverflow.com/questions/49590435/haskell-how-to-define-my-custom-math-data-type-recursively-stop-infinite-recur", "title": "Haskell: How to define my custom math data type recursively (stop infinite recursion)", "body": "<p>I'm defining a custom data type to help me with my calculus for a project. I have defined this data type as follows:</p>\n\n<pre><code>data Math a =       \n            Add (Math a) (Math a)\n        |   Mult (Math a) (Math a)\n        |   Cos (Math a)\n        |   Sin (Math a)\n        |   Log (Math a)\n        |   Exp (Math a)\n        |   Const a\n        |   Var Char\n\n    deriving Show\n</code></pre>\n\n<p>I am creating a function called <code>eval</code> that partially evaluates a mathematical expression for me. This is what I have:</p>\n\n<pre><code>eval (Const a) = (Const a)\neval (Var a) = (Var a)\n\neval (Add (Const a) (Const b)) = eval (Const (a+b))\neval (Add (Var a) b) = eval (Add (Var a) (eval b))\neval (Add a (Var b)) = eval (Add (eval a) (Var b))\neval (Add a b) = eval (Add (eval a) (eval b))\n\neval (Mult (Const a) (Const b)) = (Const (a*b))\neval (Mult a (Var b)) = (Mult (eval a) (Var b))\neval (Mult (Var a) b) = (Mult (Var a) (eval b))\neval (Mult a b) = eval (Mult (eval a) (eval b))\n\neval (Cos (Const a)) = (Const (cos(a)))\neval (Cos (Var a)) = (Cos (Var a))\neval (Cos a) = eval (Cos (eval a))\n\neval (Sin (Const a)) = (Const (sin(a)))\neval (Sin (Var a)) = (Sin (Var a))\neval (Sin a) = eval (Sin (eval a))\n\neval (Log (Const a)) = (Const (log(a)))\neval (Log (Var a)) = (Log (Var a))\neval (Log a) = eval (Log (eval a))\n\neval (Exp (Const a)) = (Const (exp(a)))\neval (Exp (Var a)) = (Exp (Var a))\n</code></pre>\n\n<p>This works fine for the most part. For instance, <code>eval (Mult ((Const 4)) (Add (Cos (Const (0))) (Log (Const 1))))</code> results in <code>(Const 4.0)</code></p>\n\n<p>My problem arises whenever I have a variable added with two constants:\n<code>eval (Add (Const 4) (Add (Const 4) (Var 'x')))</code> gives me infinite recursion. I have determined that the issue is because I call <code>eval</code> on <code>eval (Add a b) = eval (Add (eval a) (eval b))</code>. If I make this line, <code>eval (Add a b) = (Add (eval a) (eval b))</code>, I stop the infinite recursion, but I am no longer simplifying my answers: <code>Add (Const 4.0) (Add (Const 4.0) (Var 'x'))</code> results in the exact same <code>Add (Const 4.0) (Add (Const 4.0) (Var 'x'))</code>. How do I get something like <code>Add (Const 8.0) (Var 'x')</code> instead?</p>\n\n<p>Any help would be much appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1522513777, "post_id": 49589815, "comment_id": 86187671, "body": "What should be if the input stream hasn&#39;t <code>&quot;A&quot;</code> or has something else?"}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1522513999, "post_id": 49589815, "comment_id": 86187743, "body": "Well, given the definition of <code>Letter</code>, I would expect that <code>readBS &quot;A&quot;</code> returns <code>Just A</code> and <code>readBS &quot;X&quot;</code> returns <code>Nothing</code>. I would like to avoid writing unnecessary code and it sems to me that this kind of simple deserialization could be supported somehow elegantly in Haskell."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1522514238, "post_id": 49589815, "comment_id": 86187831, "body": "What text encoding do you expect (<code>ByteString</code> is just &quot;list&quot; of bytes)?"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1522514336, "post_id": 49589815, "comment_id": 86187868, "body": "If you&#39;re flexible about the format of the bytestring you take (eg. not necessarily a string representing &quot;A&quot;), then just use a serialisation library like <a href=\"https://hackage.haskell.org/package/cereal\" rel=\"nofollow noreferrer\">cereal</a> (either using its automatically generated <code>get</code>/<code>put</code> functions or writing your own)."}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "edited": false, "score": 0, "creation_date": 1522514444, "post_id": 49589815, "comment_id": 86187904, "body": "Actually, I&#39;m working on a simple HTTP server in which I use Wai+Warp only. I get a <code>ByteString</code> out of a <a href=\"https://hackage.haskell.org/package/http-types-0.12.1/docs/Network-HTTP-Types-URI.html#t:Query\" rel=\"nofollow noreferrer\">Query</a>, so I suppose that&#39;s a UTF8-encoded ByteString."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1522514621, "post_id": 49589815, "comment_id": 86187960, "body": "@hvth If you&#39;re expecting string data in UTF8, you should use <a href=\"https://hackage.haskell.org/package/http-types-0.12.1/docs/Network-HTTP-Types-URI.html#t:QueryText\" rel=\"nofollow noreferrer\"><code>QueryText</code></a>."}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1522514920, "post_id": 49589815, "comment_id": 86188044, "body": "Ah, cool! Thanks, @hnefatl, I&#39;ll switch. However my predicament still persists :)"}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1522516295, "post_id": 49589815, "comment_id": 86188439, "body": "Maybe is a MonadPlus, so the Readable would work for you"}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1522602691, "post_id": 49589815, "comment_id": 86208199, "body": "@max630 I expanded my question a bit to explain why I&#39;m having trouble with treating the MonadPlus as a Maybe. It has to do with these two types I don&#39;t understand: <code>m0</code> and <code>a0</code>."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1522607355, "post_id": 49589815, "comment_id": 86209790, "body": "probably your getParam has already one Maybe, and another comes from fromBS, so the letter&#39;s type would be <code>Maybe (Maybe Letter)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "edited": false, "score": 0, "creation_date": 1522602479, "post_id": 49590305, "comment_id": 86208103, "body": "This is totally pragmatic, but seeing as I have 5-6 of such ADTs and some of them have up to seven constructors, I&#39;d like to avoid writing this kind of code for each of them."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1522515862, "creation_date": 1522515862, "answer_id": 49590305, "question_id": 49589815, "link": "https://stackoverflow.com/questions/49589815/reading-an-adt-from-a-bytestring/49590305#49590305", "title": "Reading an ADT from a ByteString", "body": "<p>Typed not tested:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.ByteString.Char8 as BC\n-- ^^ Replace if you want an encoding besides ASCii\n\ndata T = A | B | C deriving (Eq,Ord,Show)\n\nf :: ByteString -&gt; Maybe T\nf x | x == \"A\" = Just A\n    | x == \"B\" = Just B\n    | x == \"C\" = Just C\n    | otherwise = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "edited": false, "score": 0, "creation_date": 1522602592, "post_id": 49590417, "comment_id": 86208154, "body": "This is nice! Since I saw that Wai/Warp expect one to work with <code>ByteString</code>s I totally ignored the fact that I could just transform them into plain <code>String</code>s."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1522516682, "creation_date": 1522516682, "answer_id": 49590417, "question_id": 49589815, "link": "https://stackoverflow.com/questions/49589815/reading-an-adt-from-a-bytestring/49590417#49590417", "title": "Reading an ADT from a ByteString", "body": "<p>The general approach is to derive a <code>Read</code> instance which provides deserialization from a <code>String</code>:</p>\n\n<pre><code>data Letter = A | B | C deriving (Read)\n</code></pre>\n\n<p>via <code>read</code>, <code>reads</code>, <code>readMaybe</code> and other variations defined in <code>Text.Read</code>, and then use a conversion function (such as <code>Data.ByteString.Char8.unpack</code>, if the byte string is ASCII or Latin-1) to convert from the bytestring to a string.</p>\n\n<p>The details of what you're trying to do are a little fuzzy.  (For example, if the bytestring is \"ABC\", do you want to parse the \"A\" and save the \"BC\" for later, or should that yield <code>Nothing</code>.)  However, the following may get you started:</p>\n\n<pre><code>import Text.Read\nimport qualified Data.ByteString.Char8 as C\n\ndata Letter = A | B | C deriving (Show, Read)\n\nreadLetter :: C.ByteString -&gt; Maybe Letter\nreadLetter = readMaybe . C.unpack\n</code></pre>\n\n<p>Testing it in GHCi:</p>\n\n<pre><code>&gt; :set -XOverloadedStrings\n&gt; readLetter \"A\"\nJust A\n&gt; readLetter \"B\"\nJust B\n&gt; readLetter \"X\"\nNothing\n&gt; readLetter \"ABC\"\nNothing\n&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "edited": false, "score": 0, "creation_date": 1522602753, "post_id": 49590744, "comment_id": 86208221, "body": "I expanded my question a bit to explain why I&#39;m having trouble with treating the MonadPlus as a Maybe."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 2, "last_activity_date": 1522518845, "creation_date": 1522518845, "answer_id": 49590744, "question_id": 49589815, "link": "https://stackoverflow.com/questions/49589815/reading-an-adt-from-a-bytestring/49590744#49590744", "title": "Reading an ADT from a ByteString", "body": "<blockquote>\n  <p>it returns a MonadPlus (that I'm not very familiar with)</p>\n</blockquote>\n\n<p><code>Maybe</code> has a <code>MonadPlus</code> instance, so you could just use that. </p>\n"}], "owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 49590417, "answer_count": 3, "score": 1, "last_activity_date": 1522602422, "creation_date": 1522512608, "last_edit_date": 1522602422, "question_id": 49589815, "link": "https://stackoverflow.com/questions/49589815/reading-an-adt-from-a-bytestring", "title": "Reading an ADT from a ByteString", "body": "<p>Let's say we have a data type like</p>\n\n<pre><code>data Letter = A | B | C\n</code></pre>\n\n<p>and we get a <code>ByteString</code> input that contains \"A\".\nHow do we easily transform that <code>ByteString</code> into a <code>Letter</code> type?</p>\n\n<p>P.S. I found the <a href=\"https://hackage.haskell.org/package/readable\" rel=\"nofollow noreferrer\" title=\"Readable\">Readable</a> library that does this, however it returns a <code>MonadPlus</code> (that I'm not very familiar with) instead of a <code>Maybe Letter</code> that I would expect.</p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>Here is the simple HTTP app I'm working on for context. I can't seem to be able to get a <code>Maybe Letter</code> with this.</p>\n\n<pre><code>import Network.Wai\nimport Network.HTTP.Types\nimport Network.Wai.Handler.Warp (run)\n\napp :: Application\napp request respond = let letter :: Maybe Letter\n                          letter = fmap fromBS $ getParam request \"letter\"\n                      respond $ responseLBS status200\n                                            [(\"Content-Type\", \"text/plain\")]\n                                            \"hello\"\n\ngetParam request name = join (lookup name (queryString request))\n</code></pre>\n\n<p>The compiler complains about a type error and I can't figure out how to capture these two types <code>m0</code> and <code>a0</code>, not even if I write something like <code>let letter :: Maybe (Letter, ByteString)</code> in line 7 instead. </p>\n\n<pre><code>\u2022 Couldn't match type \u2018m0 a0\u2019 with \u2018Letter\u2019\n  Expected type: Maybe Letter\n  Actual type: Maybe (m0 a0)\n</code></pre>\n"}, {"tags": ["haskell", "typechecking"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1522499719, "post_id": 49587756, "comment_id": 86183229, "body": "It seems to me you are confusing the representation in memory and the type. The representation can be the same, but the type is different."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1522503489, "last_edit_date": 1522503489, "creation_date": 1522500423, "answer_id": 49587895, "question_id": 49587756, "link": "https://stackoverflow.com/questions/49587756/typecheck-fails-for-apparently-equal-instance-definition/49587895#49587895", "title": "Typecheck fails for apparently equal instance definition", "body": "<p>It might become clearer if we give the constructor a different name, so as to distinguish type-level and value-level:</p>\n\n<pre><code>newtype Constant a b = ConstVal { getConstVal :: a }\n  deriving (Eq, Show)\n\ninstance Functor (Constant a) where\n  fmap _ (ConstVal x) = ConstVal x\n</code></pre>\n\n<p>Now, <em>why can you not write <code>fmap _ x = x</code></em>?</p>\n\n<p><code>ConstVal</code> is a <em>polymorphic constructor</em>:</p>\n\n<pre><code>ConstVal :: a -&gt; Constant a b\n</code></pre>\n\n<p>...i.e.</p>\n\n<pre><code>ConstVal :: \u2200 a b . a -&gt; Constant a b\n</code></pre>\n\n<p>Though that universal quantifier is optional in Haskell, it is actually important. <code>ConstVal</code> has basically two additional, type-level arguments. In other words, this is not just <em>one constructor</em> but a whole family of constructors, like</p>\n\n<pre><code>ConstValBoolBool :: Bool -&gt; Constant Bool Bool\nConstValBoolInt  :: Bool -&gt; Constant Bool Int\nConstValBoolChar :: Bool -&gt; Constant Bool Char\n...\nConstValCharBool :: Char -&gt; Constant Char Bool\nConstValCharInt  :: Char -&gt; Constant Char Int\nConstValCharChar :: Char -&gt; Constant Char Char\n...\n...\n</code></pre>\n\n<p>All of these actually share the same value-level name <code>ConstVal</code>, but to the type system they are all distinct. Explicitly written out, you'd have for instance</p>\n\n<pre><code>fmapBoolStringInt :: (String -&gt; Int) -&gt; Constant Bool String -&gt; Constant Bool Int\nfmapBoolStringInt _ (ConstValBoolString x) = ConstValBoolInt x\n</code></pre>\n\n<p>Here it's clear that the values on both sides are not actually the same, and hence can not be reduced to <code>fmapBoolStringInt _ x = x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 2, "last_activity_date": 1522504020, "last_edit_date": 1522504020, "creation_date": 1522500583, "answer_id": 49587924, "question_id": 49587756, "link": "https://stackoverflow.com/questions/49587756/typecheck-fails-for-apparently-equal-instance-definition/49587924#49587924", "title": "Typecheck fails for apparently equal instance definition", "body": "<p>In the <code>instance Functor (Constant a)</code> <code>fmap</code> has type:</p>\n\n<pre><code>fmap :: (b -&gt; c) -&gt; Constant a b -&gt; Constant a c\n</code></pre>\n\n<p>In the expression <code>fmap _ x = x</code>, the variable <code>x</code> must has different types which isn't possible:</p>\n\n<pre><code>fmap _ (x :: Constant a b) = (x :: Constant a c)\n</code></pre>\n\n<p>That typechecker says you.</p>\n\n<p>You could use <code>unsafeCoerce</code>, like this:</p>\n\n<pre><code>fmap _ x = unsafeCoerce x\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fmap _ = unsafeCoerce\n</code></pre>\n\n<p>but this isn't idiomatic way, because even that you know that at this moment the applying of <code>unsafeCoerce</code> is safe, you can not guarantee it (in general case) some time later.</p>\n\n<p>However, there is the safe version of <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\"><code>coerce</code></a> since <code>base-4.7.0.0</code> (what <a href=\"https://stackoverflow.com/users/450128/ben\">@Ben</a> wrote in the him answer).</p>\n\n<p>Also, we can expect that the compiler can optimize the first definition like the second.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522528023, "post_id": 49588146, "comment_id": 86191773, "body": "It&#39;ll be a no-op either way."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522545245, "post_id": 49588146, "comment_id": 86195343, "body": "@dfeuer Yes of course, not sure why I was thinking it wouldn&#39;t be."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1522545209, "last_edit_date": 1522545209, "creation_date": 1522501996, "answer_id": 49588146, "question_id": 49587756, "link": "https://stackoverflow.com/questions/49587756/typecheck-fails-for-apparently-equal-instance-definition/49588146#49588146", "title": "Typecheck fails for apparently equal instance definition", "body": "<pre><code>fmap :: (a -&gt; b) -&gt; Constant t a -&gt; Constant t b\nfmap _ (Constant x) = Constant x\n</code></pre>\n\n<p>Here you deconstruct a value of type <code>Constant t a</code> to get a a value <code>x</code> of type <code>t</code>, then wrap it up in a <code>Constant</code> constructor to make a value of type <code>Constant t b</code> so you can return it.</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Constant t a -&gt; Constant t b\nfmap _ x = x\n</code></pre>\n\n<p>Here you receive a value of type <code>Constant t a</code> and return it as a value of type <code>Constant t b</code>. That doesn't work.</p>\n\n<p>We can imagine that it <em>could</em> work. Since the second type parameter of <code>Constant</code> is a phantom parameter, the in-memory representation of those two types are the same, so an in-memory reference to one type could be passed as an in-memory reference to the other type, and everything would work fine.</p>\n\n<p>The GHC runtime actually does this in fact - the <code>x :: t</code>, <code>Constant x :: Constant t a</code>, and the <code>Constant x :: Constant t b</code> will at runtime all be references to the same chunk of memory, and no work is done by this function at all.</p>\n\n<p>But that's a low-level optimisation; semantically they're still different types, and Haskell does not allow a value of one type to be used as a value of a different type.</p>\n\n<p>What you <em>can</em> do, since <code>Constant</code> is a <code>newtype</code>, is use <code>coerce</code> (see <a href=\"https://hackage.haskell.org/package/base/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base/docs/Data-Coerce.html</a>) to explicitly convert. That avoids you having to explicitly pattern match and reconstruct. The conversion will be a no-op at runtime (due to the in memory representation being the same). So:</p>\n\n<pre><code>fmap _ x = coerce x\n</code></pre>\n\n<p>Or even:</p>\n\n<pre><code>fmap _ = coerce\n</code></pre>\n"}], "owner": {"reputation": 547, "user_id": 3607984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GngdF.jpg?s=128&g=1", "display_name": "Timo Denk", "link": "https://stackoverflow.com/users/3607984/timo-denk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 49587895, "answer_count": 3, "score": 3, "last_activity_date": 1522545209, "creation_date": 1522499496, "question_id": 49587756, "link": "https://stackoverflow.com/questions/49587756/typecheck-fails-for-apparently-equal-instance-definition", "title": "Typecheck fails for apparently equal instance definition", "body": "<p>Given the following type definition</p>\n\n<pre><code>newtype Constant a b = Constant { getConstant :: a }\n  deriving (Eq, Show)\n</code></pre>\n\n<p>this <code>Functor</code> <code>instance</code> definition is valid</p>\n\n<pre><code>instance Functor (Constant a) where\n  fmap _ (Constant x) = Constant x\n</code></pre>\n\n<p>whereas the apparently equivalent <code>instance</code> definition </p>\n\n<pre><code>instance Functor (Constant a) where\n  fmap _ x = x\n</code></pre>\n\n<p>fails with the typecheck error (excerpt)</p>\n\n<pre><code>Expected type: Constant a b\n  Actual type: Constant a a1\n</code></pre>\n\n<p>using GHC version 8.0.2.</p>\n\n<p>The question is, why these two (apparently equivalent) <code>instance</code> definitions behave differently in terms of typechecking.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "comonad"], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 2, "creation_date": 1572954153, "post_id": 49587688, "comment_id": 103714980, "body": "These three be derived with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-DerivingVia\" rel=\"nofollow noreferrer\"><code>-XDerivingVia</code></a> (<a href=\"https://gist.github.com/Icelandjack/3ad9b3b13552a1913f5c720d84f1fd35\" rel=\"nofollow noreferrer\">gist</a>) via <code>StateT s IO</code>, <code>Compose IO (State s)</code>, <code>Compose (State s) IO</code> respectively, the instances derivable via those <i>via types</i> can be listed with the brand-new <a href=\"https://ghc.gitlab.haskell.org/ghc/doc/users_guide/ghci.html#ghci-cmd-:instances%20%E2%9F%A8type%E2%9F%A9\" rel=\"nofollow noreferrer\"><code>:instances</code></a> ghci command"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1522499000, "creation_date": 1522499000, "answer_id": 49587688, "question_id": 49587122, "link": "https://stackoverflow.com/questions/49587122/type-variable-location-in-transformers/49587688#49587688", "title": "Type Variable Location in Transformers", "body": "<p>I think the difference can be easily understood when <code>m ~ IO</code>:</p>\n\n<pre><code>s -&gt; IO (a, s)\n</code></pre>\n\n<p>is the type of an action which can read the current state <code>s</code>, perform IO depending on that (e.g. printing the current state, reading a line from the user), and then produce both the new state <code>s</code>, and a return value <code>a</code>.</p>\n\n<p>Instead:</p>\n\n<pre><code>IO (s -&gt; (a, s))\n</code></pre>\n\n<p>is the type of an action which immediately performs IO, without knowing the current state. After all the IO is over, it returns a pure function mapping the old state into a new state and a return value.</p>\n\n<p>This is similar to the previous type, since the new state and return value can depend both on the previous state and the IO. However, the IO can not depend on the current state: e.g., printing the current state is disallowed.</p>\n\n<p>Instead,</p>\n\n<pre><code>s -&gt; (IO a,  s)\n</code></pre>\n\n<p>is the type of an action which reads the current state <code>s</code>, and then performs IO depending on that (e.g. printing the current state, reading a line from the user), and then produce a return value <code>a</code>. Depdnding on the current state, bot not on the IO, a new state is produced. This type is effectively isomorphic to a pair of functions <code>(s -&gt; IO a, s -&gt; s)</code>.</p>\n\n<p>Here, the IO can read a line from the user, and produce a return value <code>a</code> depending on that, but the new state can not depend on that line.</p>\n\n<p>Since the first variant is more general, we want that as our state transformer.</p>\n\n<p>I don't think there's a \"general rule\" for deciding where to put <code>m</code>: it depends on what we want to achieve.</p>\n"}], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 1, "accepted_answer_id": 49587688, "answer_count": 1, "score": 1, "last_activity_date": 1522499000, "creation_date": 1522495065, "question_id": 49587122, "link": "https://stackoverflow.com/questions/49587122/type-variable-location-in-transformers", "title": "Type Variable Location in Transformers", "body": "<p>Consider the <code>State</code> type - or at least a simplified version:</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a, s) }\n</code></pre>\n\n<p>Now, let's say we want to derive the <code>StateT</code> monad transformer. <code>transformers</code> defines it as follows:</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: s -&gt; m (a, s) }\n</code></pre>\n\n<p>Here, the <code>m</code> has been placed on the right of the function arrow, but outside the tuple. However, if we didn't know the correct answer, we might instead put <code>m</code> somewhere else:</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: m (s -&gt; (  a,  s)) }\nnewtype StateT s m a = StateT { runStateT ::    s -&gt; (m a,  s)  }\n</code></pre>\n\n<p>Obviously the version in <code>transformers</code> is correct, but why? More generally, how does one know where to put the type variable for the 'inner' monad when defining a monad transformer? Generalising even more, is there a similar rule for <a href=\"https://www.stackage.org/haddock/lts-11.2/comonad-5.0.3/Control-Comonad-Trans-Class.html\" rel=\"nofollow noreferrer\">comonad transformers</a>?</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522490283, "post_id": 49586426, "comment_id": 86180769, "body": "<code>100 &#47; (fromIntegral . length)  [1..10]</code> works as well. Why do you expect the <code>.</code> to work?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522491213, "post_id": 49586426, "comment_id": 86180998, "body": "FYI <a href=\"https://stackoverflow.com/questions/940382/what-is-the-difference-between-dot-and-dollar-sign\" title=\"what is the difference between dot and dollar sign\">stackoverflow.com/questions/940382/&hellip;</a> (possible duplicate?)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522501867, "post_id": 49586426, "comment_id": 86183883, "body": "@St&#233;phaneLaurent Definitely a duplicate, though I must say I&#39;m a tiny bit tempted to cheekily invert the direction of the duplicate -- closing against duplicate targets with lots and lots of answers feels a little... inconclusive."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522502810, "post_id": 49586426, "comment_id": 86184182, "body": "@duplode I think it&#39;s not important to close (who cares? ;-)). But it&#39;s nice to link the duplicate. This question is more specific to a particular example. The &quot;duplicate&quot; addresses the more general question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1522503636, "post_id": 49586426, "comment_id": 86184430, "body": "@St&#233;phaneLaurent I like duplicate closing because I see it as a happy outcome. When it goes right, it saves the time of both answerers (who don&#39;t have to actually write) and askers (who don&#39;t have to wait for an answer to be written), highlights good answers to the target question and avoids unnecessary duplication of content, all of that while actually helping the asker. That said, you have a point in that the specific example with the type error adds an extra nuance to this question. I have addressed it by adding a second duplicate target."}], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1522491254, "creation_date": 1522491254, "answer_id": 49586630, "question_id": 49586426, "link": "https://stackoverflow.com/questions/49586426/function-application-in-haskell-and-the-difference-between-and/49586630#49586630", "title": "Function application in Haskell and the difference between (), . and $", "body": "<p><code>(.)</code> is a function <em>composition</em> operator not function <em>application</em>. <code>(.)</code> is defined with precedence level 9 and function application is even higher. Therefore in your second example <code>length [1..10]</code> is evaluated first to <code>10</code> of type <code>Int</code>:</p>\n\n<pre><code>fromIntegral . length [1..10]\n</code></pre>\n\n<p>is reduced to:</p>\n\n<pre><code>fromIntegral . 10\n</code></pre>\n\n<p>But <code>(.)</code> has the type <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. I.e. the <code>Int</code> and the <code>(a -&gt; b)</code> do not match.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1522493406, "last_edit_date": 1522493406, "creation_date": 1522492429, "answer_id": 49586788, "question_id": 49586426, "link": "https://stackoverflow.com/questions/49586426/function-application-in-haskell-and-the-difference-between-and/49586788#49586788", "title": "Function application in Haskell and the difference between (), . and $", "body": "<p>Only one of these is actually built-in function application syntax: the one you call <code>()</code>. (Note that it doesn't actually require any parentheses though, just juxtaposition.) All Haskell expressions ultimately boil down to this syntax; infix-operator style is just syntactic sugar for it. The examples you've tried desugar thus:</p>\n\n<pre><code>\u3016\ud835\udc1a\u3017: 100 / fromIntegral( length [1..10] )\n      \u2261 (/) 100 (fromIntegral (length [1..10]))\n\u3016\ud835\udc1b\u3017: 100 / fromIntegral . length [1..10]\n      \u2261 (/) 100 ((.) fromIntegral (length [1..10]))\n\u3016\ud835\udc1c\u3017: 100 / fromIntegral $ length [1..10]\n      \u2261 ($) ((/) 100 fromIntegral) (length [1..10])\n</code></pre>\n\n<p>The reason they desugar so differently is <em>infix precedence rules</em>: every infix operator comes with a fixity declaration. The ones relevant here:</p>\n\n<pre><code>Prelude> :i .\n(.) :: (b -> c) -> (a -> b) -> a -> c   -- Defined in \u2018GHC.Base\u2019\n<b>infixr 9 .</b>\nPrelude> :i $\n($) ::\n  forall (r :: GHC.Types.RuntimeRep) a (b :: TYPE r).\n  (a -> b) -> a -> b\n    -- Defined in \u2018GHC.Base\u2019\n<b>infixr 0 $</b>\nPrelude> :i /\nclass Num a => Fractional a where\n  (/) :: a -> a -> a\n  ...\n    -- Defined in \u2018GHC.Real\u2019\n<b>infixl 7 /</b>\n</code></pre>\n\n<p>What this tells us is: <code>.</code> binds more tightly than <code>/</code>, which binds more tightly than <code>$</code>. So, for example <code>w . x / y $ z</code> is parsed as <code>((w . x) / y) $ z</code>, which is sugar for</p>\n\n<pre><code>         ($) ((/) ((.) w x) y) z\n</code></pre>\n\n<p>(Function application itself \u2013 the one you called <code>()</code> \u2013 <em>always binds more tighly than any infix operator</em>).</p>\n\n<p>Ok, the diet expressions above look confusing, so let's go back to a sugared form again but still with explicit parenthesis-grouping:</p>\n\n<pre><code>\u3016\ud835\udc1a\u3017  \u2261 100 / (fromIntegral (length [1..10]))\n\u3016\ud835\udc1b\u3017  \u2261 100 / (fromIntegral . (length [1..10]))\n\u3016\ud835\udc1c\u3017  \u2261 (100 / fromIntegral) $ (length [1..10])\n</code></pre>\n\n<p>It should be immediately clear that \u3016\ud835\udc1c\u3017 can't be right, regardless of what the operators actually do: you're trying to divide a number by a function, that doesn't make sense! The low precedence of the <code>$</code> operator is specifically intended to <em>separate</em> expressions \u2013 basically whenever you see this operator, you can just imagine that each of the operands has parentheses around it.</p>\n\n<p>\u3016\ud835\udc1b\u3017 looks sensible enough parsing-wise, however it does not make sense type-wise: <code>.</code> is not a function application operator but a function <em>composition</em> operator. I.e. both of its operands should be functions, but <code>(length [1..10])</code> is already the <em>result</em> of applying a function to its (only) argument, so you're trying to compose a function with a number.</p>\n\n<p>You could actually write this expression using the composition operator, but you'd have to compose the functions <em>before</em> applying either of them to an argument (and only apply the argument to the composition-chain):</p>\n\n<pre><code>\u3016\ud835\udc1b\u2032\u3017: 100 / (fromIntegral . length) [1..10]\n       \u2261 100 / (\\x -&gt; fromIntegral (length x)) [1..10]\n       \u2261 100 / fromIntegral (length [1..10])\n       \u2261 \u3016\ud835\udc1a\u3017\n</code></pre>\n\n<p>Now as for <code>$</code>, that is actually a function application operator, so you can use it too. Just, you need to make proper use of its low fixity, and make sure it does not interfere with the higher-precedence <code>/</code> operator:</p>\n\n<pre><code>\u3016\ud835\udc1c\u2032\u3017: 100 / (fromIntegral $ length [1..10])\n        \u2261 100 / ((fromIntegral) (length [1..10]))\n        \u2261 100 / fromIntegral (length [1..10])\n        \u2261 \u3016\ud835\udc1a\u3017\n</code></pre>\n"}], "owner": {"reputation": 1033, "user_id": 2056878, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/IZFw8.jpg?s=128&g=1", "display_name": "devio", "link": "https://stackoverflow.com/users/2056878/devio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "closed_date": 1522501900, "accepted_answer_id": 49586788, "answer_count": 2, "score": 0, "last_activity_date": 1522503660, "creation_date": 1522489809, "last_edit_date": 1522499644, "question_id": 49586426, "link": "https://stackoverflow.com/questions/49586426/function-application-in-haskell-and-the-difference-between-and", "closed_reason": "Duplicate", "title": "Function application in Haskell and the difference between (), . and $", "body": "<p>There are different ways of function application in Haskell, but it seems that each has its specificities. I'm trying to understand the differences between <code>$</code>, <code>.</code> and <code>()</code>:</p>\n\n<pre><code>Prelude&gt; 100 / fromIntegral( length [1..10] )\n10.0\nPrelude&gt; 100 / fromIntegral . length  [1..10]\n\n&lt;interactive&gt;:193:22: error:\n    * Couldn't match expected type `a -&gt; Integer'\n                  with actual type `Int'\n    * Possible cause: `length' is applied to too many arguments\n      In the second argument of `(.)', namely `length [1 .. 10]'\n      In the second argument of `(/)', namely\n        `fromIntegral . length [1 .. 10]'\n      In the expression: 100 / fromIntegral . length [1 .. 10]\n    * Relevant bindings include\n        it :: a -&gt; c (bound at &lt;interactive&gt;:193:1)\nPrelude&gt; 100 / fromIntegral $ length [1..10]\n\n&lt;interactive&gt;:194:1: error:\n    * Non type-variable argument\n        in the constraint: Fractional (Int -&gt; b)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall b. (Num b, Fractional (Int -&gt; b)) =&gt; b\nPrelude&gt;\n</code></pre>\n\n<p>Why is the behaviour different in this case, and only parentheses <code>()</code> work?</p>\n"}, {"tags": ["haskell", "haskell-lens", "comonad", "representable"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522493968, "post_id": 49585295, "comment_id": 86181659, "body": "I think there are two separate questions here: &quot;can I use lenses to work with a <code>Comonad</code>&#39;s focus?&quot; and &quot;can I use indexed optics to work with <code>Representable</code> functors?&quot; I&#39;ve answered the first one below, but you should extract the second one into another question."}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1522509419, "post_id": 49586925, "comment_id": 86186205, "body": "This is helpful, but the O(n) is a concern I&#39;m concerned about; I can do much better using the underlying Vectors (from the other question) and composing <code>ix</code> lenses; thanks though this is interesting!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1522510729, "post_id": 49586925, "comment_id": 86186636, "body": "&quot;I can do much better using the underlying Vectors&quot; - well, when you edit an element of an immutable vector you have to copy the whole thing, so you get O(1) <code>extract</code> at the expense of a <code>write</code> which is O(n) in the size of the vector. That&#39;s why I suggested batching up edits and only building a new <code>w</code> every so often, that way you amortise out the costs and get O(1) for both read and write."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1522527896, "post_id": 49586925, "comment_id": 86191752, "body": "@dfeuer The <code>write (const (extract w)) w = w</code> law says that <code>write</code> targets no more than one <code>a</code> in a <code>w a</code> (namely the one that <code>extract</code> targets). I came up with this based on the get-then-set <code>Lens</code> law."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1522527955, "post_id": 49586925, "comment_id": 86191762, "body": "Good question, though. You should undelete your comment!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1522622601, "last_edit_date": 1522622601, "creation_date": 1522493623, "answer_id": 49586925, "question_id": 49585295, "link": "https://stackoverflow.com/questions/49585295/lenses-over-comonads-or-representable/49586925#49586925", "title": "Lenses over Comonads or Representable", "body": "<p><code>Comonad</code> doesn't give you any way to write back to the comonad's focus, so you can't write a general <code>Lens</code> for <code>extract</code>. But <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Getter.html#v:to\" rel=\"nofollow noreferrer\">it is very easy to turn any old function into a <code>Getter</code></a>:</p>\n\n<pre><code>extracted :: Comonad w =&gt; Getter (w a) a\nextracted = to extract\n</code></pre>\n\n<p>Of course many comonads <em>do</em> allow you to write into the focus - <code>Store</code>, as you mentioned, but also (including but not limited to) <code>Env</code>, <code>Traced</code> and <code>Identity</code>.</p>\n\n<pre><code>-- I suspect some of these laws are redundant:\n--   write id = id\n--   write f . write g = write (f . g)\n--   extract . write f = f . extract\n--   duplicate . write f = write (write f) . duplicate\n--   write (const (extract w)) w = w\nclass Comonad w =&gt; ComonadWritable w where\n    write :: (a -&gt; a) -&gt; w a -&gt; w a\n\ninstance ComonadWritable Identity where\n    write f (Identity x) = Identity (f x)\n\n-- law-abiding \"up to Eq\"\ninstance (Eq s, ComonadWritable w) =&gt; ComonadWritable (StoreT s w) where\n    write f (StoreT w s) = StoreT (write g w) s\n        where\n            g k s'\n                | s' == s = f (k s')\n                | otherwise = k s'\n\n-- law-abiding \"up to Eq\"\ninstance (Eq m, Monoid m, ComonadWritable w) =&gt; ComonadWritable (TracedT m w) where\n    write f (TracedT w) = TracedT (write g w)\n        where\n            g k m\n                | m == mempty = f (k m)\n                | otherwise = k m\n\ninstance ComonadWritable w =&gt; ComonadWritable (EnvT e w) where\n    write f (EnvT e w) = EnvT e (write f w)\n</code></pre>\n\n<p>Given <code>ComonadWritable</code> it's easy to construct a <code>Lens</code> for a comonad's focus.</p>\n\n<pre><code>focus :: ComonadWritable w =&gt; Lens' (w a) a\nfocus = lens extract (\\w x -&gt; write (const x) w)\n</code></pre>\n\n<p>One note on efficiency: <code>StoreT</code> and <code>TracedT</code>'s <code>write</code> implementations build a chain of functions with equality checks on the way down, so <code>extract</code> is O(n) in the number of <code>write</code> calls. Since you mentioned you're using a <code>Representable</code> comonad <code>w</code>, you could implement some clever strategy of batching up edits and reifying them into an actual <code>w</code> every so often. Or you could store edits in a <code>Map</code> (strengthening the <code>Eq</code> constraint to <code>Ord</code>) and delegate to the underlying <code>w</code> when it turns out an element hasn't been edited. I'll leave that part to you.</p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 3, "accepted_answer_id": 49586925, "answer_count": 1, "score": 5, "last_activity_date": 1522622601, "creation_date": 1522480790, "last_edit_date": 1522509453, "question_id": 49585295, "link": "https://stackoverflow.com/questions/49585295/lenses-over-comonads-or-representable", "title": "Lenses over Comonads or Representable", "body": "<p>Here's a more specific variant of this question: <a href=\"https://stackoverflow.com/questions/49585262/mutate-only-focus-of-store-comonad\">Mutate only focus of Store Comonad?</a>, for the benefit of not asking more than one question at once.</p>\n\n<p>Are there any lenses compatible with <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">Control.Lens</a> which allow me to interact with the focus of a comonad (the value from <code>extract</code>) or with the index/value of the Store Comonad (<code>pos</code>)?</p>\n\n<p>It seems like lenses may be of some use here, but I have been unable to find anything which fits; any help would be appreciated, thanks!</p>\n"}, {"tags": ["haskell", "comonad", "representable"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522485116, "post_id": 49585262, "comment_id": 86179553, "body": "Could <code>fmap</code> be the function that you&#39;re looking for?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522491862, "post_id": 49585262, "comment_id": 86181154, "body": "@MarkSeemann <code>fmap</code> isn&#39;t quite right, because it alters every value in the functor. The questioneer is looking to alter only the one at the comonad&#39;s focus, zipper-style."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1522494146, "post_id": 49585262, "comment_id": 86181707, "body": "I&#39;m fairly sure I&#39;ve addressed this in <a href=\"https://stackoverflow.com/questions/49585295/lenses-over-comonads-or-representable/49586925#49586925\">my answer</a> to <a href=\"https://stackoverflow.com/questions/49585295/lenses-over-comonads-or-representable\">your other question</a>, so I&#39;m going to close this one as a dupe. Please let me know if you think I&#39;m wrong about that though."}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 1, "closed_date": 1522494154, "answer_count": 0, "score": 1, "last_activity_date": 1522480545, "creation_date": 1522480545, "question_id": 49585262, "link": "https://stackoverflow.com/questions/49585262/mutate-only-focus-of-store-comonad", "closed_reason": "Duplicate", "title": "Mutate only focus of Store Comonad?", "body": "<p>I'm using <a href=\"http://hackage.haskell.org/package/adjunctions-4.4/docs/Control-Comonad-Representable-Store.html\" rel=\"nofollow noreferrer\">Control.Comonad.Representable.Store</a> to represent a grid object for a game; the grid is: <code>type Grid = Store (Compose Vector Vector) a</code>; where Vector has a representable instance indexed by <code>Int</code>.</p>\n\n<p>This allows me to use comonadic <code>extend</code> and <code>experiment</code> for grid squares to interact with their neighbours, and for me to use the focus of the Store monad (indicated by <code>pos</code>) as a cursor into the grid.</p>\n\n<p>What I'm looking for is a reasonable way to set the value at the focus of the store, or to use the <code>Representable</code> instance of <code>Compose Vector Vector</code> to set/mutate values at a given index. So far as I can tell, using the tools in <code>Comonad</code> and <code>Representable</code> I can only get values out of the structure, I can't find any function like: <code>over :: ComonadStore s w =&gt; (a -&gt; a) -&gt; w a -&gt; w a</code> or even <code>Representable f =&gt; set :: f a -&gt; Rep f -&gt; a -&gt; f a</code>.</p>\n\n<p>Sure, I can index into the vectors, adjust the value, then set it back at its index; or even use <code>tabulate</code> to rebuild the structure but with the adjustments made, but those sound inefficient and inelegent. It seems like some combination of these typeclasses would be able to do this for me; or if there's some other constraint/typeclass that I'm missing which could help out here.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 1, "last_activity_date": 1522480962, "creation_date": 1522480962, "answer_id": 49585314, "question_id": 49585158, "link": "https://stackoverflow.com/questions/49585158/how-to-handle-exception-in-haskell/49585314#49585314", "title": "How to handle exception in haskell", "body": "<p>Implement exception handling with <code>try/catch</code> and/or build a type that can hold the possibility of an error, e.g. <code>IO (Either Error Result)</code>.</p>\n\n<p>See: <a href=\"https://wiki.haskell.org/Handling_errors_in_Haskell\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Handling_errors_in_Haskell</a></p>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1522488057, "creation_date": 1522479735, "last_edit_date": 1522488057, "question_id": 49585158, "link": "https://stackoverflow.com/questions/49585158/how-to-handle-exception-in-haskell", "title": "How to handle exception in haskell", "body": "<pre><code>postRetweet :: IO [TweetIdStr] -&gt; IO [Status]\npostRetweet tweetId = do\n    let response1 = tweetId &gt;&gt;= \\tweetId1 -&gt; mapM (\\tid -&gt; (postWith authenticate (retweetUrl++tid++\".json\") (DB.pack \"ABC\"))  ) tweetId1\n    response1 &gt;&gt;= \\rid -&gt; (mapM (\\x -&gt; pure (x^. responseStatus) ) rid)\n</code></pre>\n\n<p>the above code is to retweet a tweet based on the tweetId<br>\ni get an exception if retweeting of a single tweet fails. how to handle that?</p>\n\n<p>using try i did it</p>\n\n<pre><code>postRetweet :: IO [TweetIdStr] -&gt; IO [Status]\npostRetweet tweetId = do\n    tweetId &gt;&gt;= \\tweetId1 -&gt; (CM.foldM (\\arr tid -&gt;  ((try (postWith authenticate (retweetUrl++tid++\".json\") (DB.pack \"ABC\")) ):: IO (Either SomeException (Response BL.ByteString)) ) &gt;&gt;= \n         \\sc -&gt;\n                case sc of\n                    Right val -&gt;   if (val ^. responseStatus ^. statusCode)==200\n                                        then pure (arr++[val ^. responseStatus])  \n                                    else pure (arr)              \n                    Left x -&gt; pure (arr) ) [] tweetId1 )\n</code></pre>\n"}, {"tags": ["haskell", "monads", "option-type"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1522488142, "post_id": 49585096, "comment_id": 86180276, "body": "<code>Optional</code> is just a single instance of <code>Monad</code>. There are many others."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522493176, "post_id": 49585096, "comment_id": 86181460, "body": "Note that in C one doesn\u2019t have <code>option</code> or monads or exceptions however there is still error handling"}], "answers": [{"comments": [{"owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "edited": false, "score": 0, "creation_date": 1522480714, "post_id": 49585184, "comment_id": 86178465, "body": "Sir, I&#39;m trying to understand how Lists are monads. That means a List can be empty(which is not of type int) or it may have at-least one integer. Can you please share any helpful resource that can compare the haskell Ideas to some object oriented programming."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "edited": false, "score": 0, "creation_date": 1522480994, "post_id": 49585184, "comment_id": 86178534, "body": "@PKChem Funny you should ask: <a href=\"http://blog.ploeh.dk/2017/10/04/from-design-patterns-to-category-theory\" rel=\"nofollow noreferrer\">blog.ploeh.dk/2017/10/04/&hellip;</a> This, however, doesn&#39;t cover monads yet, but I&#39;d be surprised if ultimately it doesn&#39;t get there."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522497306, "post_id": 49585184, "comment_id": 86182583, "body": "For most purposes, a function that returns an <code>Either</code> value looks an awful lot like a function that can raise type-checked exceptions."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1522479936, "creation_date": 1522479936, "answer_id": 49585184, "question_id": 49585096, "link": "https://stackoverflow.com/questions/49585096/is-monad-just-a-functional-way-of-error-handling/49585184#49585184", "title": "Is Monad just a functional way of Error handling?", "body": "<p>Monads aren't 'just a functional way of error handling', so you are, indeed, wrong.</p>\n\n<p>It would be pointless to turn this answer into a monad tutorial, so I'm not  going to try. It takes some time to understand what a monad is, and the best advice I can give is to keep working with the concept until it clicks. Eventually it will.</p>\n\n<p>The type described in the OP looks equivalent (<em>isomorphic</em>) to Haskell's more standard <code>Maybe</code> type, which is indeed a monad. In a pinch, it can be used for error handling, but more often you'd use another monad called <code>Either</code> (or types isomorphic to it), since it's better suited for that task.</p>\n\n<p>A monad, though, can be many other things. Lists are monads, as are functions themselves (via the <em>Reader</em> monad). Trees are monads as well. These have nothing to do with error handling.</p>\n\n<p>When it comes to exceptions in Haskell, I take the view that it's a legacy feature. I'd never design my Haskell code around exceptions, since exceptions aren't visible via the type system. When a function may fail to return a result, I'd let it return a <code>Maybe</code>, an <code>Either</code>, or another type isomorphic to that. This will, indeed, force the caller to handle not only the happy path, but also any failures that may occur.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1522487434, "creation_date": 1522487434, "answer_id": 49586139, "question_id": 49585096, "link": "https://stackoverflow.com/questions/49585096/is-monad-just-a-functional-way-of-error-handling/49586139#49586139", "title": "Is Monad just a functional way of Error handling?", "body": "<p><code>Monad</code> is just an interface (in Haskell terms, typeclass) that a type can implement, along with a contract specifying some restrictions on how the interface should behave.</p>\n\n<p>It's not that different from how a C# type <code>T</code> can implement, say, the <code>IComparable&lt;T&gt;</code> interface. However, the <code>Monad</code> interface is quite abstract and the functions can do surprisingly different things for different types (but always respecting the same laws, and the same \"flavor\" of composition).</p>\n\n<p>Instead of seeing <code>Monad</code> as a functional way of error handling, it's better to go the other way: inventing a type like <code>Optional</code> that represents errors / absence of values, and start devising useful functions on that type. For example, a function that produces an \"inhabited\" <code>Optional</code> from an existing value, a function that composes two <code>Optional</code>-returning functions to minimize repetitive code, a function that changes the value inside the <code>Optional</code> if it exists, and so on. All of them functions that can be useful on their own.  </p>\n\n<p><em>After</em> we have the type and and a bevy of useful functions, we might ask ourselves:</p>\n\n<ul>\n<li><p>Does the type itself fit the requirements for <code>Monad</code>? It must have a type parameter, for example.</p></li>\n<li><p>Do <em>some</em> (not necessarily all) of the useful functions we have discovered for the type fit the <code>Monad</code> interface? Not only they must fit the signatures, they must fit the contract.</p></li>\n</ul>\n\n<p>In the affirmative case, good news! We can define a <code>Monad</code> instance for the type, and now we are able to use a whole lot of <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Control-Monad.html#g:4\" rel=\"noreferrer\">monad-generic functions</a> for free!</p>\n\n<p>But even if the <code>Monad</code> typeclass doesn't exist in our language, we can keep in mind that the type and some of the functions defined on it behave like a <code>Monad</code>. From the <a href=\"https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/CompletableFuture.html#thenCompose-java.util.function.Function-\" rel=\"noreferrer\">documentation</a> of the <code>thenCompose</code> method of the <code>CompletableFuture</code> Java class:</p>\n\n<blockquote>\n  <p>This method is analogous to Optional.flatMap and Stream.flatMap.</p>\n</blockquote>\n\n<p>This allows us to \"transfer intuitions\" between seemingly unrelated classes, even if we can't write monad-generic code because the shared interface doesn't exist.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1522532777, "last_edit_date": 1522532777, "creation_date": 1522519465, "answer_id": 49590821, "question_id": 49585096, "link": "https://stackoverflow.com/questions/49585096/is-monad-just-a-functional-way-of-error-handling/49590821#49590821", "title": "Is Monad just a functional way of Error handling?", "body": "<blockquote>\n  <p>Is Monad just a functional way of Error handling?</p>\n</blockquote>\n\n<p>No it is not. The most prominent use for monads is handling side-effecting computations in Haskell. They can also be used for error handling, but the reason they are called \"monads\" and not \"error handlers\" is that they provide a common abstraction around several seemingly different things. For instance, in Haskell, <code>join</code> is a synonym for <code>concat</code> and <code>=&lt;&lt;</code> is an infix synonym for <code>concatMap</code>.</p>\n\n<blockquote>\n  <p>Monads are like a bridge between Pure Functional Programming and Impure code (that results in side effects).</p>\n</blockquote>\n\n<p>This is a subtle point. In a lazy language such as Haskell, <em>side effects</em> refer to computations which may indeed be pure, such as FFI calls that require memory to be freed upon completion. Monads provide a way to track (and perform) side effects. \"Pure\" simply means \"function returns the same value when called with the same value\".</p>\n"}], "owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1522532777, "creation_date": 1522479135, "last_edit_date": 1522480149, "question_id": 49585096, "link": "https://stackoverflow.com/questions/49585096/is-monad-just-a-functional-way-of-error-handling", "title": "Is Monad just a functional way of Error handling?", "body": "<p>I am reading <b>\"Programming in Haskell\"</b> book and trying to correlate ideas of haskell to my knowledge in C#. Please correct me if I am wrong.</p>\n\n<p>I feel like monads enforces the programmer to write code which can handle exceptions. So we will explicitly mention the error handling in the type system like </p>\n\n<pre><code>Optional(Int) functionName(Int a, Int b)\n</code></pre>\n\n<p>The return type is Optional(Int) but not an Int, So who so ever uses the library that has this kind of return types will understand that error handling is happening and the result will be like None(explains Something went wrong) and Some(explains we got some result).</p>\n\n<p>Any code can result to Happy Path(where we get some results) and Sad Path(where errors occurs). Making this paths explicitly in Type system is what monad is. That's my understanding of it. Please correct me.</p>\n\n<p>Monads are like a bridge between Pure Functional Programming and Impure code (that results in side effects).</p>\n\n<hr>\n\n<p>Apart from this I want to make sure my understanding on Exception handling (VS) Option Types.</p>\n\n<p>Exception Handling tries to do the operations without having a deeper look on to the inputs. Exception Handling's are Heavy since the Call stack has to unwind till it get to the Catch || Rescue || Handling Code. </p>\n\n<p>And the Functional way of dealing things is check the inputs before doing the operations and return the <b>\"None\"</b> as result if the inputs does't match the required criteria. Option types are light weight of handling errors.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522477740, "post_id": 49584419, "comment_id": 86177819, "body": "What&#39;s <code>Graphic</code>?"}, {"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522478277, "post_id": 49584419, "comment_id": 86177945, "body": "Sorry pasting error, thought it was in there. Just edited it."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522479379, "post_id": 49584419, "comment_id": 86178157, "body": "What happens when you try your attempt?"}, {"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522480136, "post_id": 49584419, "comment_id": 86178350, "body": "Well, My attempt doesnt have variables on the left hand side of the &#39;=&#39; so it wouldnt work. In the (Polygon) part, I think there should be some points, but the points need to be in a list, and im not to sure how I would go about doing that. I need to define the list first on the left hand side i think."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1522480281, "post_id": 49584419, "comment_id": 86178377, "body": "From the data constructor of <code>Graphic</code>, it looks like you have to supply exactly one <code>Point</code>. How do you plan to reduce a list of <code>Point</code> values to a single <code>Point</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "is_accepted": true, "score": 0, "last_activity_date": 1522595933, "creation_date": 1522595933, "answer_id": 49599535, "question_id": 49584419, "link": "https://stackoverflow.com/questions/49584419/putting-multiple-points-in-a-list-creating-a-polygon/49599535#49599535", "title": "Putting multiple points in a list? - Creating a polygon", "body": "<p>My main doubt here is which point should be the one that is used for the <code>Graphic</code> and also how <code>Point</code> is defined. By looking at some other questions I'm going to guess that <code>Point</code> is <code>(Int, Int)</code>.</p>\n\n<p>In this solution I'm using <code>(0, 0)</code> as the third value that is received by the <code>Graphic</code> constructor:</p>\n\n<pre><code>getPolygonGraphic :: [Point] -&gt; ColourName -&gt; Graphic\ngetPolygonGraphic ps c = Graphic (Polygon ps) c (0, 0)\n</code></pre>\n\n<p>And here I'm using the first <code>Point</code> on the array:</p>\n\n<pre><code>getPolygonGraphic :: [Point] -&gt; ColourName -&gt; Graphic\ngetPolygonGraphic (p:ps) c = Graphic (Polygon (p:ps)) c p\n</code></pre>\n\n<p>Just change that value to whichever the coursework said you should use.</p>\n"}], "owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 49599535, "answer_count": 1, "score": -2, "last_activity_date": 1522595933, "creation_date": 1522472498, "last_edit_date": 1522478248, "question_id": 49584419, "link": "https://stackoverflow.com/questions/49584419/putting-multiple-points-in-a-list-creating-a-polygon", "title": "Putting multiple points in a list? - Creating a polygon", "body": "<p>So, I'm seeking some help with how I would go about this. This is the function.</p>\n\n<pre><code>getPolygonGraphic :: [Point] -&gt; ColourName -&gt; Graphic\ngetPolygonGraphic = ??\n</code></pre>\n\n<p>Polygon is defined by:</p>\n\n<pre><code>data Shape = Rectangle Side Side\n       | Ellipse   Side Side\n       | Polygon   [Point]\n       | Line      Point Point\nderiving (Show)\n</code></pre>\n\n<p>Also, 'Side' = Double</p>\n\n<p>ColourName is defined by:</p>\n\n<pre><code>data ColourName\n= Magenta\n| Black\n| Green\n| Yellow\n| Orange\n| Cyan\nderiving (Show)\n</code></pre>\n\n<p>Graphic is:</p>\n\n<pre><code>data Graphic =\nGraphic Shape\n        ColourName\n        Point\nderiving (Show)\n</code></pre>\n\n<p>My attempt for the right side of the '=' was to have:</p>\n\n<pre><code>getPolygonGraphic :: [Point] -&gt; ColourName -&gt; Graphic\ngetPolygonGraphic = Graphic(Polygon) colourType ()\n</code></pre>\n\n<p>However, I havent added any points as im not sure how to do so with lists. Any help would be appreciated.</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1522467014, "post_id": 49583718, "comment_id": 86175952, "body": "You can represent a stack with a list \u2013 push is <code>x : xs</code> as an expression and pop is the same thing as a pattern."}], "answers": [{"comments": [{"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "edited": false, "score": 0, "creation_date": 1522501044, "post_id": 49587604, "comment_id": 86183589, "body": "Thanks Igor for the detailed explanation. I think, the answer I posted is similar to what you explained above. Can you please comment on how is code written in &quot;production&quot; Haskell? Your answer seems more readable and better performing?  Thanks."}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "edited": false, "score": 0, "creation_date": 1522520473, "post_id": 49587604, "comment_id": 86189663, "body": "@user3169543 To be honest, I&#39;m not familiar with &quot;production&quot; Haskell, since I&#39;ve never written commercial software in it. But moving a piece of logic into separate functions with descriptive names sometimes can be helpful for readability, I think (but forgive my xs and ys)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522597047, "post_id": 49587604, "comment_id": 86206519, "body": "Formatting nitpicking: &lt;!-- language: lang-haskell --&gt; <a href=\"https://meta.stackoverflow.com/q/267272/2751851\">doesn&#39;t actually add Haskell highlighting</a>."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 2, "last_activity_date": 1522648891, "last_edit_date": 1522648891, "creation_date": 1522498402, "answer_id": 49587604, "question_id": 49583718, "link": "https://stackoverflow.com/questions/49583718/haskell-stock-span-algorithm/49587604#49587604", "title": "Haskell: stock span algorithm", "body": "<p>The link that you've provided contains a solution which uses stack data structure. The examples in every language mutate the stack, use the arrays with indexes and access the elements of the array by index. All these operations are not very common in Haskell.</p>\n\n<p>Let's consider the following solution:</p>\n\n<pre><code>type Quote = Int\ntype Quotes = [Quote]\ntype Span = [Int]\n\nstockSpanWithStack :: Quotes -&gt; Span\nstockSpanWithStack quotes = calculateSpan quotesWithIndexes []\n  where\n    quotesWithIndexes = zip quotes [0..]\n    calculateSpan [] _ = []\n    calculateSpan ((x, index):xs) stack =\n      let\n        newStack = dropWhile (\\(y, _) -&gt; y &lt;= x) stack\n        stockValue [] = index + 1\n        stockValue ((_, x):_) = index - x\n      in\n        (stockValue newStack) : (calculateSpan xs ((x, index):newStack))\n</code></pre>\n\n<p>And let's compare it with the Python solution:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code># Calculate span values for rest of the elements\nfor i in range(1, n):\n\n    # Pop elements from stack whlie stack is not\n    # empty and top of stack is smaller than price[i]\n    while( len(st) &gt; 0 and price[st[0]] &lt;= price[i]):\n        st.pop()\n\n    # If stack becomes empty, then price[i] is greater\n    # than all elements on left of it, i.e. price[0],\n    # price[1], ..price[i-1]. Else the price[i]  is\n    # greater than elements after top of stack\n    S[i] = i+1 if len(st) &lt;= 0 else (i - st[0])\n\n    # Push this element to stack\n    st.append(i)\n</code></pre>\n\n<p>For the stack solution, we need elements with indexes. It can be imitated like this:</p>\n\n<pre><code>quotesWithIndexes = zip quotes [0..]\n</code></pre>\n\n<p>The list of quotes is iterated recursively and instead of modifying a stack in every loop iteration, we can call the function with a modified value:</p>\n\n<pre><code>calculateSpan ((x, index):xs) stack =\n</code></pre>\n\n<p>The following line in Python (popping of elements of the stack, which are smaller than the current value):</p>\n\n<pre><code>while( len(st) &gt; 0 and price[st[0]] &lt;= price[i]):\n    st.pop()\n</code></pre>\n\n<p>Can be rewritten in Haskell as:</p>\n\n<pre><code>newStack = dropWhile (\\(y, _) -&gt; y &lt;= x) stack\n</code></pre>\n\n<p>And calculation of a stock value:</p>\n\n<pre><code>S[i] = i+1 if len(st) &lt;= 0 else (i - st[0])\n</code></pre>\n\n<p>Can be interpreted as:</p>\n\n<pre><code>stockValue [] = index + 1\nstockValue ((_, x):_) = index - x\n</code></pre>\n\n<p>Below it was said, that it's not a common thing to modify the state of the variables, like <code>S[i] = ...</code> or <code>st.append(i)</code>. But we can recursively call the function with new stack value and prepend the current result to it:</p>\n\n<pre><code>(stockValue newStack) : (calculateSpan xs ((x, index):newStack))\n</code></pre>\n\n<p>Technically, we push at the beginning of the list and drop the first elements of the list, because it's idiomatic and more performant way of working with lists in Haskell.</p>\n"}, {"comments": [{"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "edited": false, "score": 0, "creation_date": 1522502891, "post_id": 49587922, "comment_id": 86184203, "body": "had to use BangPatterns extension ONLY because when stepping through the code in GHCI <code>:trace</code> the index was not getting evaluated. No other reason."}], "tags": [], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "is_accepted": false, "score": 0, "last_activity_date": 1522501665, "last_edit_date": 1522501665, "creation_date": 1522500557, "answer_id": 49587922, "question_id": 49583718, "link": "https://stackoverflow.com/questions/49583718/haskell-stock-span-algorithm/49587922#49587922", "title": "Haskell: stock span algorithm", "body": "<p>I've come up with the following, however I'm not sure if its \"idiomatic\". I think this is similar to @Igor's answer. Please comment.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nstockSpanLinear :: Quotes -&gt; Span\nstockSpanLinear = reverse.snd.(foldl func ([],[]))\n\n\ntype Stack = [(Quote, Int)]\n\nfunc ::  (Stack, Span)-&gt; Quote -&gt; (Stack, Span)\nfunc ([], []) q             = ([(q, 1)], [1])\nfunc p@((_, !i):pis, span) q = go p q (i+1)\n   where\n       go :: (Stack, Span) -&gt; Quote -&gt; Int -&gt; (Stack, Span)\n       go (stack,span) q index = let ys = dropWhile (\\(p, _) -&gt; p &lt;= q) stack\n                          in case ys of\n                               []      -&gt; ((q, index):ys, index+1:span)\n                               (_,i):_ -&gt; ((q, index):ys, index-i:span)\n</code></pre>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 49587604, "answer_count": 2, "score": 3, "last_activity_date": 1522648891, "creation_date": 1522464306, "last_edit_date": 1522498456, "question_id": 49583718, "link": "https://stackoverflow.com/questions/49583718/haskell-stock-span-algorithm", "title": "Haskell: stock span algorithm", "body": "<p>I'm trying to implement the \"<a href=\"https://www.geeksforgeeks.org/the-stock-span-problem/\" rel=\"nofollow noreferrer\">stock span problem</a>\" in Haskell. This is the solution I've come up with. Would like to see if there is any other idiomatic way to do this. this is  O(n^2) algorithm (?) and using a stack, we can make it a O(n). Any pointers to the other higher order functions that can be used is appreciated.  </p>\n\n<pre><code>import Data.List (inits)\n\ntype Quote = Int\ntype Quotes = [Quote]\ntype Span = [Int]\n\nstockSpanQuad :: Quotes -&gt; Span\n    stockSpanQuad [] = []\n    stockSpanQuad xs = map spanQ (map splitfunc  (tail $ inits xs))\n      where\n          spanQ (qs, q) = 1 + (length $ takeWhile (\\a -&gt; a &lt;= q) (reverse qs))\n          splitfunc xs = (init xs, last xs)\n</code></pre>\n"}, {"tags": ["haskell", "codeworld"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1522465806, "post_id": 49583558, "comment_id": 86175760, "body": "[1/2] (1) In your questions, please (a) Read them after posting, to see if any obvious mistakes have slipped through while you were writing it; (b) Paste code and error messages exactly as they are, rather than typing them by memory (I see at least three inconsistencies between your code and what you have told us the problem is); (c) Format error messages as code (unlike in the next-to-last line here); (d) Don&#39;t format regular text as code (unlike in your last line here). A good start would be <a href=\"https://stackoverflow.com/posts/49583558/edit\">edit</a>ing this question to fix those problems."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1522465828, "post_id": 49583558, "comment_id": 86175764, "body": "[2/2] (2) The [haskell-stack] and [template-haskell] tags shouldn&#39;t have been used here. You would have known it if you had read the tag descriptions, or paid attention to the fact that the same tags had been removed from an earlier question of yours. (3) &quot;What can I do to fix this error&quot; -- this appears to be covered by <a href=\"https://stackoverflow.com/q/8435575\">stackoverflow.com/q/8435575</a> , and presumably several other questions here you might have found by searching. (4) &quot;how to define polygon ?&quot; -- I have no idea; there isn&#39;t enough context in your question.Too begin with, how do you know that you have to define it?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1522493691, "post_id": 49583558, "comment_id": 86181595, "body": "Without knowing how you intend to make a <code>Picture</code>, you probably mean something like this: <code>shapeToPicture (Polygon xs) = let path = makePath xs in strokePath xs</code>"}], "owner": {"reputation": 9, "user_id": 9546967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826c1d83ac04e533a376551172abf6c7?s=128&d=identicon&r=PG&f=1", "display_name": "studyer", "link": "https://stackoverflow.com/users/9546967/studyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 357, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1522478267, "creation_date": 1522462352, "last_edit_date": 1522478267, "question_id": 49583558, "link": "https://stackoverflow.com/questions/49583558/how-to-define-polygon-in-haskell", "title": "how to define polygon in haskell", "body": "<p>I am trying to convert shape</p>\n\n<pre><code>data shape = Polygon [Point]\n</code></pre>\n\n<p>to Picture form,and I've tried this..</p>\n\n<pre><code>shapeToPicture :: shape -&gt; Picture\nshapeToPicture  (Polygon _xxxxxxx_ ) = polygon \n</code></pre>\n\n<p>I faced a problem here\nwhat should I write in <em>xxxxxx</em> if I want to input any number of vertices of a polygon when I run this function.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1522447820, "post_id": 49582021, "comment_id": 86172193, "body": "The last example is just a list of tuples. Couldn&#39;t you just create a function that takes a list of tuples and <code>map</code>s <code>Person</code> over the list?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1522447862, "post_id": 49582021, "comment_id": 86172202, "body": "@Carcigenicate: no, it is not, here you apply <code>27</code> to <code>&quot;Alice&quot;</code>, and this will fail."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1522447889, "post_id": 49582021, "comment_id": 86172207, "body": "You can use <code>map (uncurry Person) [(&quot;Alice&quot;, 27), (&quot;Bob&quot;, 23), ...]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1522449336, "post_id": 49582021, "comment_id": 86172624, "body": "You are not specifying the type <code>Person</code>; you are specifying the value constructor <code>Person</code>, and it can&#39;t be eliminated because there is no a priori reason to believe that is the only way to make a <code>Person</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": true, "score": 7, "last_activity_date": 1522448058, "creation_date": 1522448058, "answer_id": 49582083, "question_id": 49582021, "link": "https://stackoverflow.com/questions/49582021/what-is-the-shortest-way-to-instantiate-a-list-in-haskell/49582083#49582083", "title": "What is the shortest way to instantiate a list in Haskell?", "body": "<p><code>Person</code>, as a constructor for data value, is itself a (binary) function. You may build this list from a list of tuples:</p>\n\n<pre><code>people = map (uncurry Person) [(\"Alice\", 27), (\"Bob\", 42)]\n</code></pre>\n\n<p>or you can build it from a list of names and list of ages:</p>\n\n<pre><code>people = zipWith Person [\"Alice\", \"Bob\"] [27, 42]\n</code></pre>\n\n<p>... or from plenty of other options.</p>\n"}, {"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 1, "last_activity_date": 1522449852, "creation_date": 1522449852, "answer_id": 49582365, "question_id": 49582021, "link": "https://stackoverflow.com/questions/49582021/what-is-the-shortest-way-to-instantiate-a-list-in-haskell/49582365#49582365", "title": "What is the shortest way to instantiate a list in Haskell?", "body": "<p>One doesn\u2019t tend to need to represent large amounts of literal data much in Haskell so we may be glad that the language does not optimise for their representation. Here are some options:</p>\n\n<pre><code>people = (\n  let p = Person in\n  [p \"Alice\"   27,\n   p \"Bob\"     23,\n   p \"Mallory\" 26]\n)\n</code></pre>\n\n<p>Or with some basic parsing</p>\n\n<pre><code>people = (\n  let p x = p' (words x)\n      p' [name, age] = person name (read age) in\n  map p $ lines \"Alice 27\\nBob 23\\n Mallory 26\"\n)\n</code></pre>\n\n<p>Or just do it however you like then do <code>show people</code> and by default that will be in Haskell syntax so just put it somewhere at the bottom of a source file and forget about it.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1522450980, "last_edit_date": 1522450980, "creation_date": 1522450598, "answer_id": 49582460, "question_id": 49582021, "link": "https://stackoverflow.com/questions/49582021/what-is-the-shortest-way-to-instantiate-a-list-in-haskell/49582460#49582460", "title": "What is the shortest way to instantiate a list in Haskell?", "body": "<p>Joke answer:</p>\n\n<pre><code>instance Enum Person where\n    toEnum i = Person (show i) i\n    fromEnum (Person _ i) = i\n\npersonList :: [Person]\npersonList = [toEnum 0..]\n</code></pre>\n\n<p>Still a joke answer:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.String\n\ninstance IsString Person where\n        fromString ps =\n           let (name,read . drop 1 -&gt; age) = break (==':') ps\n           in Person name age\n\npersonList :: [Person]\npersonList = [\"Me:30\"\n             ,\"Them:55\"\n             ]\n</code></pre>\n\n<p>Twisted joke answer:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances#-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.String\n\ninstance IsString (Int -&gt; Person) where\n        fromString = Person\n\ndata Person = Person { name :: String\n                     , age  :: Int\n                     } deriving (Show)\n\n($$) :: (Int -&gt; Person) -&gt; Int -&gt; Person\n($$) = ($)\n\npersons :: [Person]\npersons = [\"Me\" $$ 30, \"Them\" $$ 55]\n</code></pre>\n\n<p>The commented answer:</p>\n\n<pre><code>personList = map (uncurry Person) [(\"Me\",30), (\"Them\", 55)]\n</code></pre>\n\n<p>The bad answer:</p>\n\n<pre><code>personList = zipWith Person [\"Me\", \"Them\"] [30,55]\n</code></pre>\n"}], "owner": {"reputation": 686, "user_id": 8116864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OM0Rh.jpg?s=128&g=1", "display_name": "vasilyrud", "link": "https://stackoverflow.com/users/8116864/vasilyrud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 49582083, "answer_count": 3, "score": 2, "last_activity_date": 1522450980, "creation_date": 1522447607, "question_id": 49582021, "link": "https://stackoverflow.com/questions/49582021/what-is-the-shortest-way-to-instantiate-a-list-in-haskell", "title": "What is the shortest way to instantiate a list in Haskell?", "body": "<p>Say I have a data type <code>Person</code> defined as follows, using record syntax:</p>\n\n<pre><code>data Person = Person { name :: String\n                     , age  :: Int\n                     } deriving (Show)\n</code></pre>\n\n<p>And I instantiate a list of <code>Person</code>s using:</p>\n\n<pre><code>people = [Person {name=\"Alice\",   age=27},\n          Person {name=\"Bob\",     age=23},\n          Person {name=\"Mallory\", age=26}]\n</code></pre>\n\n<p>I then realize that defining many elements of the list at a time would be bulky, since the words <code>name</code> and <code>age</code> are repeated. I thus reduce the code to:</p>\n\n<pre><code>people = [(Person \"Alice\"   27),\n          (Person \"Bob\"     23),\n          (Person \"Mallory\" 26)]\n</code></pre>\n\n<p>Since lists in Haskell are homogenous anyway, how can I avoid specifying the type <code>Person</code> in every element of the list? For example, doing something along the lines of the following code (which doesn't compile):</p>\n\n<pre><code>Person people = [(\"Alice\"   27),\n                 (\"Bob\"     23),\n                 (\"Mallory\" 26)]\n</code></pre>\n\n<p><a href=\"http://rextester.com/WSJVS90299\" rel=\"nofollow noreferrer\">Link to runnable example</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1522429827, "post_id": 49578471, "comment_id": 86164565, "body": "You should use <code>mapM</code> instead of <code>mapM_</code> the underscore means that you do not care about the result."}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522430036, "post_id": 49578471, "comment_id": 86164666, "body": "Cool, thanks, that did it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1522430075, "post_id": 49578471, "comment_id": 86164682, "body": "To elaborate, <code>mapM_</code> discards the result, replacing it with <code>()</code>. It&#39;s useful in certain contexts but not here, of course."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1522446045, "last_edit_date": 1522446045, "creation_date": 1522429999, "answer_id": 49578537, "question_id": 49578471, "link": "https://stackoverflow.com/questions/49578471/how-can-i-run-multiple-haskell-io-actions-and-store-the-results/49578537#49578537", "title": "How can I run multiple Haskell IO actions and store the results?", "body": "<p>You are quite close: you need <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Prelude.html#v:mapM\" rel=\"nofollow noreferrer\"><strong><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)</code></strong></a> instead of <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><strong><code>mapM_ :: (Foldable t, Monad m) =&gt; (a -&gt; m b) -&gt; t a -&gt; m ()</code></strong></a></p>\n\n<p>Like the name and the signature already suggest, both functions take a monadic function and a traversable (let us for now assume that that is a list) of <code>a</code>s, and it applies the monadic function to all elements and returns a monadic function that contains a traversable (list) of the results.</p>\n\n<p>So if you write:</p>\n\n<p><Pre><code>    resultIds &lt;- <b>mapM</b> insert myItemList</code></pre></p>\n\n<p>The difference between <code>mapM</code> and <code>mapM_</code> is that in the case of <code>mapM_</code> (like the signature already suggests), you are not interested in the outcome, and thus it is not calculated. A reason for this could possibly be that the list is very long (and generated <em>by-need</em>), and thus the list of identifiers would never fit in memory.</p>\n\n<p>then <code>resultIds</code> will contain a list of identifiers.</p>\n\n<p>The explanation about the <code>mapM</code> (and <code>mapM_</code>) function is a bit an oversimplification, but I think that it is usually better to first get more comfortable about monads, than getting details about monadic functions completely right.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 49578537, "answer_count": 1, "score": 1, "last_activity_date": 1522446045, "creation_date": 1522429708, "question_id": 49578471, "link": "https://stackoverflow.com/questions/49578471/how-can-i-run-multiple-haskell-io-actions-and-store-the-results", "title": "How can I run multiple Haskell IO actions and store the results?", "body": "<p>I'm a Haskell beginner, so sorry in advance for the newbie question. I only have a very superficial understanding of monads. </p>\n\n<p>I'm using the function <code>insert</code> from the module Persistent. (I've been following <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">the tutorial here</a>.) It inserts something in a database, and returns the ID. I can use it like this: </p>\n\n<pre><code>resultId &lt;- insert myItem\n</code></pre>\n\n<p>That works fine for a single item. I can print out the resultId like this: </p>\n\n<pre><code>liftIO $ print resultId\n</code></pre>\n\n<p>But what if my <code>myItem</code> is actually a list of arbitrary length? I want to map <code>insert</code> over this list, which I can seem to do with: </p>\n\n<pre><code>resultIds &lt;- mapM_ insert myItemList\n</code></pre>\n\n<p>but then if I try to print out the values: </p>\n\n<pre><code>liftIO $ print resultIds\n</code></pre>\n\n<p>I just get <code>()</code>. What am I doing wrong? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1522427929, "post_id": 49577871, "comment_id": 86163662, "body": "I don&#39;t understand your problem.  I see the <code>myFunction ((DataA m):rest) = ...</code>  is obviously broken because <code>DataA</code> is not a constructor of <code>M</code> and should instead be <code>myFunction (A (DataA val) : rest) = ...</code> or something similar to that (like your second line).  Is that what you&#39;re wanting?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1522433278, "post_id": 49577871, "comment_id": 86166184, "body": "Perhaps you should consider using <code>data M = A { mInt :: Int } | B { mInt :: Int } | C</code> and avoid the additional <code>DataA, DataB</code> types, which cause values to be wrapped inside two constructors (?)"}, {"owner": {"reputation": 840, "user_id": 2049320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8367c9e4d4186b75066ba6a80b145656?s=128&d=identicon&r=PG&f=1", "display_name": "Sweeney Todd", "link": "https://stackoverflow.com/users/2049320/sweeney-todd"}, "edited": false, "score": 0, "creation_date": 1522433679, "post_id": 49577871, "comment_id": 86166351, "body": "Thanks for the suggestion but this was just a simplified version of my code, I need those additional types =)"}], "answers": [{"comments": [{"owner": {"reputation": 840, "user_id": 2049320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8367c9e4d4186b75066ba6a80b145656?s=128&d=identicon&r=PG&f=1", "display_name": "Sweeney Todd", "link": "https://stackoverflow.com/users/2049320/sweeney-todd"}, "edited": false, "score": 0, "creation_date": 1522428325, "post_id": 49578089, "comment_id": 86163841, "body": "Ah thanks, I didn&#39;t understand what A and B exactly stand for. Now it makes sense thinking of them as constructors"}, {"owner": {"reputation": 840, "user_id": 2049320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8367c9e4d4186b75066ba6a80b145656?s=128&d=identicon&r=PG&f=1", "display_name": "Sweeney Todd", "link": "https://stackoverflow.com/users/2049320/sweeney-todd"}, "edited": false, "score": 0, "creation_date": 1522428825, "post_id": 49578089, "comment_id": 86164089, "body": "Is there a way to omit <code>a</code> from line <code>A (DataA a) -&gt; a</code> ? My actual data type(<code>DataA</code>) have more than 1 field, but I won&#39;t be using them on the RHS of that line."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 840, "user_id": 2049320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8367c9e4d4186b75066ba6a80b145656?s=128&d=identicon&r=PG&f=1", "display_name": "Sweeney Todd", "link": "https://stackoverflow.com/users/2049320/sweeney-todd"}, "edited": false, "score": 1, "creation_date": 1522428991, "post_id": 49578089, "comment_id": 86164175, "body": "Sure, with record syntax: <code>A (DataA {}) -&gt; someValue</code>"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1522428071, "creation_date": 1522428071, "answer_id": 49578089, "question_id": 49577871, "link": "https://stackoverflow.com/questions/49577871/pattern-matching-the-data-type-of-the-first-element-in-a-list/49578089#49578089", "title": "Pattern matching the data type of the first element in a list", "body": "<p>The answer is just \"more pattern matching\".  I think you are getting confused between the constructors for one type and another.</p>\n\n<p>The <code>M</code> type has three constructors, <code>A</code>, <code>B</code>, and <code>C</code>. You should match one of these to obtain the field (if any) before trying to pattern match on your <code>Data{A,B}</code> constructors.</p>\n\n<pre><code>data M = A DataA | B DataB | C deriving (Eq, Show)\ndata DataA = DataA {aInt::Int} deriving (Eq, Show)\ndata DataB = DataB {bInt::Int} deriving (Eq, Show)\n\nmyFunction :: [M] -&gt; Int\nmyFunction [] = 0\nmyFunction (m:rest) = \n    case m of\n       A (DataA a) -&gt; a\n       B (DataB b) -&gt; b\n       C -&gt; myFunction rest\n</code></pre>\n"}], "owner": {"reputation": 840, "user_id": 2049320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8367c9e4d4186b75066ba6a80b145656?s=128&d=identicon&r=PG&f=1", "display_name": "Sweeney Todd", "link": "https://stackoverflow.com/users/2049320/sweeney-todd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 49578089, "answer_count": 1, "score": 0, "last_activity_date": 1522430473, "creation_date": 1522427115, "last_edit_date": 1522430473, "question_id": 49577871, "link": "https://stackoverflow.com/questions/49577871/pattern-matching-the-data-type-of-the-first-element-in-a-list", "title": "Pattern matching the data type of the first element in a list", "body": "<p>I'm trying to do the following here</p>\n\n<pre><code>data M = A DataA | B DataB | C deriving (Eq, Show)\ndata DataA = DataA {aInt::Int} deriving (Eq, Show)\ndata DataB = DataB {bInt::Int} deriving (Eq, Show)\n\nmyFunction :: [M] -&gt; Int\nmyFunction [] = 0\nmyFunction (m:rest) = \n    -- if m is A doSomething1\n    -- if m is B doSomething2\n    -- if m is C doSomething3\n</code></pre>\n\n<p>I can match the type of C, but not the other two.</p>\n\n<p>I have tried things like</p>\n\n<pre><code>myFunction ((DataA m):rest) = doSomething1\nmyFunction ((A m):rest) = doSomething1\nmyFunction ((m::DataA):rest) = doSomething1\nmyFunction ((m::A):rest) = doSomething1\nmyFunction (m:rest) = case m of A -&gt; doSomething1\n                                B -&gt; doSomething2 --etc\n</code></pre>\n\n<p>with no luck. What's the best way to achive this in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1522417086, "post_id": 49575515, "comment_id": 86158359, "body": "In my opinion error messages should be formatted as <a href=\"https://meta.stackoverflow.com/questions/251361/how-do-i-format-my-code-blocks\">text</a>. Also <a href=\"https://meta.stackexchange.com/questions/2950/should-hi-thanks-taglines-and-salutations-be-removed-from-posts\">no &quot;Thanks&quot;</a>."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1522417386, "post_id": 49575515, "comment_id": 86158516, "body": "Consider indenting your code properly..."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 2, "creation_date": 1522417468, "post_id": 49575515, "comment_id": 86158561, "body": "Also, <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> please. You neither defined <code>Side</code> nor <code>Graphic</code>. If the definition is unrelated, make it extremely simple (just an <code>Int</code> or something), but don&#39;t omit it."}], "answers": [{"tags": [], "owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "is_accepted": true, "score": 3, "last_activity_date": 1522418249, "creation_date": 1522418249, "answer_id": 49575821, "question_id": 49575515, "link": "https://stackoverflow.com/questions/49575515/generating-a-graphic-for-lines/49575821#49575821", "title": "Generating a graphic for lines", "body": "<p>Although you didn't post an MCVE, and I can only guess the cause,</p>\n\n<pre><code>(Graphic (Line(a b) colourType (0,0)))\n</code></pre>\n\n<p>That appears to be wrong. You probably want</p>\n\n<pre><code>(Graphic (Line a b) colourType (0,0))\n</code></pre>\n\n<hr>\n\n<p>Explanation: Just like functions, data constructors in Haskell are curried. So</p>\n\n<pre><code>Line a b\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>((Line a) b)\n</code></pre>\n\n<p>and is completely different from</p>\n\n<pre><code>Line (a b)\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 49575821, "answer_count": 1, "score": 0, "last_activity_date": 1522418747, "creation_date": 1522416975, "last_edit_date": 1522418747, "question_id": 49575515, "link": "https://stackoverflow.com/questions/49575515/generating-a-graphic-for-lines", "title": "Generating a graphic for lines", "body": "<p>Here is my attempt:</p>\n\n<pre><code>getLineGraphic :: Point -&gt; Point -&gt; ColourName -&gt; Graphic\ngetLineGraphic a b colourType = (Graphic (Line(a b) colourType (0,0)))\n</code></pre>\n\n<p><code>Shape</code> is defined by</p>\n\n<pre><code>data Shape = Rectangle Side Side\n       | Ellipse   Side Side\n       | Polygon   [Point]\n       | Line      Point Point\nderiving (Show)\n</code></pre>\n\n<p>and <code>ColourName</code> is</p>\n\n<pre><code>data ColourName\n= Magenta\n| Black\n| Green\n| Yellow\n| Orange\n| Cyan\nderiving (Show)\n</code></pre>\n\n<p>Here is the error I get:</p>\n\n<pre><code>src\\View.hs:54:34: error:\n    * Couldn't match expected type `Graphic'\n                  with actual type `ColourName -&gt; Point -&gt; Graphic'\n    * Probable cause: `Graphic' is applied to too few arguments\n      In the expression: (Graphic (Line (a b) colourType (0, 0)))\n      In an equation for `getLineGraphic':\n          getLineGraphic a b colourType\n            = (Graphic (Line (a b) colourType (0, 0)))\n   |\n54 | getLineGraphic a b colourType = (Graphic (Line(a b) colourType (0,0)))\n</code></pre>\n\n<p>At the top is my attempt. Not sure where I went wrong? The translation has to be <code>(0,0)</code> for this part, so that's why that's there. Not sure why I get this error? Any help would be appreciated! Thanks.</p>\n"}, {"tags": ["haskell", "gtk", "haskell-stack"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522415850, "post_id": 49575071, "comment_id": 86157695, "body": "gi-gtk isn&#39;t on Stackage. Perhaps your different machines are choosing a different version from Hackage, or whatever source you are using for gi-gtk."}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522416424, "post_id": 49575071, "comment_id": 86158004, "body": "Isn&#39;t? <a href=\"https://www.stackage.org/package/gi-gtk\" rel=\"nofollow noreferrer\">stackage.org/package/gi-gtk</a>"}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522416680, "post_id": 49575071, "comment_id": 86158150, "body": "Now I&#39;ve found that in gi-gtk v3.0.18 the signature of <code>buttonSetImage</code> was changed. But <code>stack list-dependencies</code> returns <code>gi-gtk 3.0.17</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1522417700, "post_id": 49575071, "comment_id": 86158670, "body": "Do the GTK versions differ between these systems?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522418796, "post_id": 49575071, "comment_id": 86159214, "body": "@AdamG\u0142owacki Okay, I was imprecise: it is on Stackage, but is not in LTS-9.2."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522419735, "post_id": 49575071, "comment_id": 86159669, "body": "@AdamG\u0142owacki According to the Stackage page you linked to, the latest LTS with <i>gi-gtk</i> is 9.21, and the version of the package in it is 9.21."}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522421166, "post_id": 49575071, "comment_id": 86160398, "body": "@DanielWagner if I understand it correctly, LTS-9.2 does contain gi-gtk v3.0.17: <a href=\"https://www.stackage.org/package/gi-gtk/snapshots\" rel=\"nofollow noreferrer\">stackage.org/package/gi-gtk/snapshots</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1522421956, "post_id": 49575071, "comment_id": 86160876, "body": "@AdamG\u0142owacki Ah, seems you&#39;re right and I misinterpreted <a href=\"https://www.stackage.org/lts-9.2/hoogle?q=gi-gtk\" rel=\"nofollow noreferrer\">this search result</a>. The big &quot;Hoogle&quot; title at the top should have tipped me off that the search had not done what I thought it had."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522451894, "post_id": 49575071, "comment_id": 86173334, "body": "(In my previous comment, &quot;and the version of the package in it is 9.21&quot; should have been &quot;and the version of the package in it is 3.0.18&quot;.)"}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522528863, "post_id": 49575071, "comment_id": 86191979, "body": "@duplode Ok but what&#39;s the point?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522549725, "post_id": 49575071, "comment_id": 86195940, "body": "@AdamG\u0142owacki The point was that there seemed to be some confusion about the involved versions of LTS and <i>gi-gtk</i>. That&#39;s moot now, as it turned out the cause of your problem was elsewhere."}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "is_accepted": true, "score": 2, "last_activity_date": 1522531290, "creation_date": 1522531290, "answer_id": 49592530, "question_id": 49575071, "link": "https://stackoverflow.com/questions/49575071/why-compiling-gtk-gi-gtk-application-with-haskell-stack-is-not-reproducible/49592530#49592530", "title": "Why compiling GTK (gi-gtk) application with haskell/stack is not reproducible?", "body": "<p>Ok, now I can see that (contrary to what I had thought before) Haskell-GTK bindings <strong>are</strong> generated on my computer, during building <code>gi-gtk</code> package. Indeed in GTK v3.18 there was nothing like <code>gtk_popover_popdown</code>, that's why Haskell function <code>popoverPopdown</code> was not generated at all. And I guess that it's similar with <code>gtk_button_set_image</code>.</p>\n\n<p>Now I need to remember that this Stackage/Hackage package is <em>of a different kind</em>. I must track the precise version of GTK I am building my application with and not rely on <code>stack</code> in this matter.</p>\n"}], "owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 49592530, "answer_count": 1, "score": 1, "last_activity_date": 1522531290, "creation_date": 1522415298, "last_edit_date": 1522422246, "question_id": 49575071, "link": "https://stackoverflow.com/questions/49575071/why-compiling-gtk-gi-gtk-application-with-haskell-stack-is-not-reproducible", "title": "Why compiling GTK (gi-gtk) application with haskell/stack is not reproducible?", "body": "<p>I have created an app that uses GTK via gi-gtk in Haskell, dependencies managed with stack (lts-9.2). I compiled it successfully on Fedora 26. Then I have successfully executed the binary on other Linux distributions as well.</p>\n\n<p>After a while I wanted to compile the same application on other system (elementary OS). I cloned the repository, called <code>stack setup</code> in the project directory and then <code>stack build</code>. It complained about some missing dependencies so I installed them and finally, I got an error from GHC about my own code:</p>\n\n<pre><code>Not in scope: 'GTK.popoverPopdown'\nPerhaps you meant one of these:\n  'GTK.popoverModal' (imported from GI.Gtk)\n  'GTK.popoverPosition' (imported from GI.Gtk)\nModule 'GI.Gtk' does not export 'popoverPopdown'.\n</code></pre>\n\n<p>Why? As I look at the documentation (<a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.17/docs/GI-Gtk-Objects-Popover.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/gi-gtk-3.0.17/docs/GI-Gtk-Objects-Popover.html</a>) there is <code>popoverPopdown</code> but nothing like <code>popoverModal</code> or <code>popoverPosition</code>.</p>\n\n<p>Then I switched to another machine with another Linux distribution (Ubuntu Studio) and got the same error. Finally I took a machine with Fedora 27, did the same and got another error (also inside my app code):</p>\n\n<pre><code>Couldn't match expected type 'Maybe b1'\n            with actual type 'GTK.Image'\nIn the second argument of 'GTK.buttonSetImage', namely 'icon'\nIn a stmt of a 'do' block: btn `GTK.buttonSetImage` icon\n</code></pre>\n\n<p>Again the documentation (<a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.17/docs/GI-Gtk-Objects-Button.html#g:26\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/gi-gtk-3.0.17/docs/GI-Gtk-Objects-Button.html#g:26</a>) claims something different than GHC. Could somebody explain to me what's going on?</p>\n\n<p>Answering to one of the comments:\nBelow are what GTK versions are installed in the mentioned systems. Nonetheless GHC complains about Haskell code and I thought all the Haskell code is downloaded from Stackage. Are any dependencies generated locally on my system during <code>stack build</code>?</p>\n\n<ul>\n<li>Ubuntu Studio 16.04 LTS: libgtk2.0-0 v2.24.30, libgtk-3-0 v3.18.9</li>\n<li>elementary OS: libgtk2.0-0 v2.24.30, libgtk-3-0 v3.18.9</li>\n<li>Fedora 26: gtk2 v2.24.31, gtk3 v3.22.21</li>\n<li>Fedora 27: gtk2 v2.24.32, gtk3 v3.22.26</li>\n</ul>\n"}, {"tags": ["haskell", "typeclass", "type-declaration"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522414798, "post_id": 49574905, "comment_id": 86157193, "body": "Did you test this solution?"}, {"owner": {"reputation": 75, "user_id": 9574860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2f8ec589be12565420508eff78f72c8?s=128&d=identicon&r=PG&f=1", "display_name": "Frawstcrabs", "link": "https://stackoverflow.com/users/9574860/frawstcrabs"}, "edited": false, "score": 0, "creation_date": 1522415008, "post_id": 49574905, "comment_id": 86157278, "body": "I just tried the fixed code but I&#39;m still getting a similar error."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1522415652, "post_id": 49574905, "comment_id": 86157602, "body": "<code>length</code> returns an <code>Int</code>. I think you haven&#39;t learned your lesson about testing yet. ;-)"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1522415840, "post_id": 49574905, "comment_id": 86157692, "body": "Oh my... &gt;_&gt;;;;"}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 2, "last_activity_date": 1522415801, "last_edit_date": 1522415801, "creation_date": 1522414708, "answer_id": 49574905, "question_id": 49574826, "link": "https://stackoverflow.com/questions/49574826/how-do-i-use-typeclasses-in-haskell-functions/49574905#49574905", "title": "How do I use typeclasses in Haskell functions?", "body": "<p>The problem is from here:</p>\n\n<pre><code>avg l = ((foldr (+) 0 l) `div` (listlen l))\n</code></pre>\n\n<p><code>div</code> is defined over <code>Integral</code>s, not just <code>Num</code>s. Also, <code>div</code> floors the result. Normal division is <code>(/)</code>, which is defined over <code>Fractional</code>s.</p>\n\n<p>Also (more directly) from here:</p>\n\n<pre><code>listlen :: [a] -&gt; Int\nlistlen [] = 0\nlistlen (x:xs) = 1 + listlen xs\n</code></pre>\n\n<p><code>listlen</code> returns <code>Int</code>, which makes <code>div</code> have type of <code>Int -&gt; Int -&gt; Int</code>.</p>\n\n<p>This should work:</p>\n\n<pre><code>listlen :: (Num n) =&gt; [a] -&gt; n\nlistlen [] = 0\nlistlen (x:xs) = 1 + listlen xs\n\navg :: (Fractional a) =&gt; [a] -&gt; a\navg [] = error \"Cannot average list of length 0\"\navg l = foldr (+) 0 l / listlen l\n</code></pre>\n\n<p>Or, with some functions from <code>Prelude</code>:</p>\n\n<pre><code>avg :: (Fractional a) =&gt; [a] -&gt; a\navg [] = error \"Cannot average list of length 0\"\navg l = sum l / fromIntegral (length l)\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 9574860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2f8ec589be12565420508eff78f72c8?s=128&d=identicon&r=PG&f=1", "display_name": "Frawstcrabs", "link": "https://stackoverflow.com/users/9574860/frawstcrabs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 49574905, "answer_count": 1, "score": 1, "last_activity_date": 1522415801, "creation_date": 1522414318, "question_id": 49574826, "link": "https://stackoverflow.com/questions/49574826/how-do-i-use-typeclasses-in-haskell-functions", "title": "How do I use typeclasses in Haskell functions?", "body": "<p>I'm currently trying to teach myself Haskell with Learn You A Haskell, and so to test myself I'm trying to write a function that takes a list of numbers and returns the average value.</p>\n\n<pre><code>listlen :: [a] -&gt; Int\nlistlen [] = 0\nlistlen (x:xs) = 1 + listlen xs\n\navg :: (Num a) =&gt; [a] -&gt; a\navg [] = error \"Cannot average list of length 0\"\navg l = ((foldr (+) 0 l) `div` (listlen l))\n\nmain = putStrLn (show (avg [1,2,3,4,5]))\n</code></pre>\n\n<p>However, when I run this code, I get this error message:</p>\n\n<pre><code>test.hs:7:10: error:\n    \u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018Int\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          avg :: forall a. Num a =&gt; [Int] -&gt; a\n        at test.hs:5:8\n    \u2022 In the expression: ((foldr (+) 0 l) `div` (listlen l))\n          In an equation for \u2018avg\u2019:\n          avg l = ((foldr (+) 0 l) `div` (listlen l))\n    \u2022 Relevant bindings include\n        avg :: [Int] -&gt; a (bound at test.hs:6:1)\n</code></pre>\n\n<p>I've been tinkering with the signature and the only way I can get it to work is to make the types into actual types, e.g. <code>avg :: [Int] -&gt; Int</code>. I would greatly appreciate any advice.</p>\n"}, {"tags": ["haskell", "liquid-haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522421575, "post_id": 49574108, "comment_id": 86160658, "body": "Have you made a bug report on github? The devs are amazingly responsive."}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522434745, "post_id": 49574108, "comment_id": 86166849, "body": "No not yet.  But if you think it is one then that gives me more confidence that it is one, and not just a silly mistake on my part."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1522435421, "post_id": 49574108, "comment_id": 86167149, "body": "Yes, I think this is a bug.  I&#39;ve (albeit long ago) ran into trivial bugs in the totality checker so I don&#39;t have an illusion that the tool is perfect or heavily tested - the team is just too small and there really isn&#39;t a &quot;Liquid Haskell community&quot; to help."}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 0, "score": 9, "last_activity_date": 1522414323, "creation_date": 1522411463, "last_edit_date": 1522414323, "question_id": 49574108, "link": "https://stackoverflow.com/questions/49574108/liquid-haskell-says-server-is-safe-when-it-isnt", "title": "Liquid haskell says server is safe when it isn&#39;t", "body": "<p>I have a server in Haskell that responds to Json inputs. The problem is that there are cases where the server will crash because of a partial function, but Liquid Haskell says it is safe.</p>\n\n<p>Here's a minimal working example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Main where\n\nimport qualified Web.Scotty as Scot\nimport GHC.Generics (Generic)\nimport qualified Data.Aeson as Json\nimport Data.Text.Internal.Lazy (Text)\n\nmain :: IO ()\nmain =\n  Scot.scotty 3000 $\n    Scot.get \"/:queryJson\" $ do\n      rawRequest &lt;- Scot.param \"queryJson\"\n      case Json.decode rawRequest of\n        Nothing -&gt; Scot.text \"Could not decode input.\"\n        Just input -&gt; Scot.text $ makeOutput (dim1 input)\n\n{-@ type Dim = { x : Int | x &gt;= 0 &amp;&amp; x &lt;= 1 } @-}\n\n{-@ makeOutput :: Dim -&gt; Text @-}\nmakeOutput :: Int -&gt; Text\nmakeOutput dim =\n  case dim of\n    0 -&gt; \"a\"\n    1 -&gt; \"b\"\n    _ -&gt; error \"Liquid haskell should stop this happening.\"\n\n{-@ dim1 :: Input -&gt; Dim @-}\ndata Input = Input\n  { dim1 :: Int\n  } deriving (Generic)\n\ninstance Json.FromJSON Input\n</code></pre>\n\n<p>Liquid Haskell says that this is safe, but I can crash it by visiting <a href=\"http://localhost:3000/\" rel=\"noreferrer\">http://localhost:3000/</a>{\"dim1\":2}.  </p>\n\n<p>What I would like is for Liquid Haskell to tell me that the annotation for the 'dim1' function is not valid, because it can't be sure that the input will be 0 or 1.</p>\n\n<p>Edit:</p>\n\n<p>I have found that if I manually make an access function for dim1 in Input, like:</p>\n\n<pre><code>{-@ dim1get :: Input -&gt; Dim @-}\ndim1get :: Input -&gt; Int\ndim1get (Input x) = x\n</code></pre>\n\n<p>and use that instead of the 'dim1' function, then I get the required warning from Liquid Haskell that the code is unsafe.</p>\n"}, {"tags": ["list", "haskell", "iteration"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 4, "creation_date": 1522408595, "post_id": 49573354, "comment_id": 86154103, "body": "Your question is unclear - if you &#39;return each element&#39; of a list you will get the original list back. Do you want to process the elements in some way?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1522408606, "post_id": 49573354, "comment_id": 86154112, "body": "There&#39;s several problems with what you&#39;re trying to do here, but once you&#39;ve fixed those... this just becomes a function that takes a list and returns the same list again."}, {"owner": {"reputation": 705, "user_id": 4853434, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/99eb56b75f44e239b4803e241bccc249?s=128&d=identicon&r=PG&f=1", "display_name": "simplesystems", "link": "https://stackoverflow.com/users/4853434/simplesystems"}, "edited": false, "score": 0, "creation_date": 1522409553, "post_id": 49573354, "comment_id": 86154521, "body": "I added an example to the Question"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1522409600, "post_id": 49573354, "comment_id": 86154541, "body": "@simplesystems What are you imagining the &quot;space&quot; to be in your example? Do you want to print each element of the list with a space between them? In Haskell, printing is a more involved task than you might expect, and is very different from just &quot;returning&quot;."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1522409602, "post_id": 49573354, "comment_id": 86154545, "body": "Do you want to print the list?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1522409928, "post_id": 49573354, "comment_id": 86154689, "body": "What do you mean by &quot;return&quot;? Specifically, what does it mean to &quot;return&quot; something, but then execute more code in the function?"}, {"owner": {"reputation": 705, "user_id": 4853434, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/99eb56b75f44e239b4803e241bccc249?s=128&d=identicon&r=PG&f=1", "display_name": "simplesystems", "link": "https://stackoverflow.com/users/4853434/simplesystems"}, "edited": false, "score": 0, "creation_date": 1522409965, "post_id": 49573354, "comment_id": 86154704, "body": "Space could be a new line or just a space. Sorry I am really struggling with Haskell, coming from Java."}, {"owner": {"reputation": 705, "user_id": 4853434, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/99eb56b75f44e239b4803e241bccc249?s=128&d=identicon&r=PG&f=1", "display_name": "simplesystems", "link": "https://stackoverflow.com/users/4853434/simplesystems"}, "edited": false, "score": 0, "creation_date": 1522410099, "post_id": 49573354, "comment_id": 86154780, "body": "What I want is just par example a for loop in Java, where I can do something with each element in the list, like printing, sum, multiply, delete, just accessing those elements"}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 3, "creation_date": 1522410285, "post_id": 49573354, "comment_id": 86154877, "body": "First of all, you need to stop thinking in loops. Next, You can do all of those things with lists themselves."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1522410315, "post_id": 49573354, "comment_id": 86154895, "body": "A good starting point would probably be the <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow noreferrer\">Learn you a Haskell chapter on lists</a>. It has examples of simple list operations, and later chapters have plenty of more interesting functions operating on lists."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522410325, "post_id": 49573354, "comment_id": 86154900, "body": "@simplesystems: but in functional programming, you do not think in terms of loops, but in terms of functions. Furthermore all data is <i>immutable</i>: you can not change a list, nor its elements, nor the fields of these elements."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522411107, "post_id": 49573354, "comment_id": 86155304, "body": "This looks like my question here: <a href=\"https://stackoverflow.com/questions/49398374/extract-numbers-as-strings-from-list-of-numbers\" title=\"extract numbers as strings from list of numbers\">stackoverflow.com/questions/49398374/&hellip;</a>"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1522519368, "post_id": 49573354, "comment_id": 86189350, "body": "Recursion is best used when necessary, otherwise iteration is best. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . init $ concat [ show d ++ &quot; &quot; | d &lt;- [1..5]] &gt; &gt; &gt; &gt; &gt; &quot;1 2 3 4 5&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1522411267, "creation_date": 1522411267, "answer_id": 49574062, "question_id": 49573354, "link": "https://stackoverflow.com/questions/49573354/haskell-just-iterate-through-list/49574062#49574062", "title": "Haskell Just iterate through list", "body": "<blockquote>\n  <p>What I want is just par example a for loop in Java, where I can do something with each element in the list, like printing, sum, multiply, delete, just accessing those elements</p>\n</blockquote>\n\n<p>Well, you can't \"delete\" anything in Haskell, and you can't modify bindings. What you can do is e.g. sum the elements:</p>\n\n<pre><code>sumList [] = 0\nsumList (x : xs) = x + sumList xs\n</code></pre>\n\n<p>Or multiply the elements:</p>\n\n<pre><code>productList [] = 1\nproductList (x : xs) = x * productList xs\n</code></pre>\n\n<p>At this point you may realize that you've repeated yourself quite a bit, which is annoying. You can extract the common parts and turn the differences into parameters:</p>\n\n<pre><code>iterateList f z [] = z\niterateList f z (x : xs) = x `f` iterateList f z xs\n\nsumList     = iterateList (+) 0\nproductList = iterateList (*) 1\n</code></pre>\n\n<p>Here <code>z</code> represents the \"base value\" to be returned for an empty input list, and <code>f</code> is the \"combine\" function that tells it how to deal with the element and the rest of the list.</p>\n\n<p>Printing is a bit more complex because you have to know how <code>IO</code> works first (in particular, you should know about <code>&gt;&gt;</code> and <code>return</code>), but it can still be done:</p>\n\n<pre><code>doNothing           = return ()\nprintAndThen x rest = print x &gt;&gt; rest\n\nprintList = iterateList printAndThen doNothing \n</code></pre>\n\n<p>... or using values directly instead of binding them to names first:</p>\n\n<pre><code>printList = iterateList (\\x rest -&gt; print x &gt;&gt; rest) (return ())\n</code></pre>\n\n<p>Finally you would realize that you've just reinvented <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr</code></a>. :-)</p>\n"}], "owner": {"reputation": 705, "user_id": 4853434, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/99eb56b75f44e239b4803e241bccc249?s=128&d=identicon&r=PG&f=1", "display_name": "simplesystems", "link": "https://stackoverflow.com/users/4853434/simplesystems"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4235, "favorite_count": 0, "accepted_answer_id": 49574062, "answer_count": 1, "score": 0, "last_activity_date": 1522411267, "creation_date": 1522408432, "last_edit_date": 1522409523, "question_id": 49573354, "link": "https://stackoverflow.com/questions/49573354/haskell-just-iterate-through-list", "title": "Haskell Just iterate through list", "body": "<p>I try simply to iterate through a list and return each element.</p>\n\n<pre><code>iterateList [] =  error \"empty list\"\niterateList [a] = a\niterateList (x:xs) = x iterateList xs\n</code></pre>\n\n<p>On the third line I try to return the first element and then recursively invoke <code>iterateList</code> on the tail of the List.</p>\n\n<p>But that's not working. Any idea why?</p>\n\n<p>Example:\ninput: iterateList [1,2,3,4,5]\noutput: 1 2 3 4 5</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "edited": false, "score": 0, "creation_date": 1522408253, "post_id": 49573166, "comment_id": 86153975, "body": "Where abouts exactly? And I should have stated that  <code>shapeToPic (Line a b) = polyline [a, b]</code> works fine. Its just the rectangle code."}], "tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 1, "last_activity_date": 1522407613, "creation_date": 1522407613, "answer_id": 49573166, "question_id": 49573075, "link": "https://stackoverflow.com/questions/49573075/couldnt-match-integer-with-double-creating-a-rectangle/49573166#49573166", "title": "Couldnt Match Integer With Double? - Creating a Rectangle", "body": "<p>Maybe you made a typo and confused dot with comma?</p>\n\n<pre><code>let x = (1.1) :: Double -- type checks\nlet x = (1,1) :: Double -- same error\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "edited": false, "score": 0, "creation_date": 1522408789, "post_id": 49573322, "comment_id": 86154182, "body": "My bad! Thanks for your reply! Side is defined by this: <code>type Side = Double</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "edited": false, "score": 0, "creation_date": 1522410017, "post_id": 49573322, "comment_id": 86154726, "body": "@goat So I guessed right, a rectangle is a pair of side lengths, not a pair of points, according to your definition of shape."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1522408288, "creation_date": 1522408288, "answer_id": 49573322, "question_id": 49573075, "link": "https://stackoverflow.com/questions/49573075/couldnt-match-integer-with-double-creating-a-rectangle/49573322#49573322", "title": "Couldnt Match Integer With Double? - Creating a Rectangle", "body": "<p>It looks as if <code>Side</code> is defined as a <code>Double</code>, and not as a pair. So, <code>Rectangle 13.45 12.32</code> would be OK, while <code>Rectangle (x1,y1) (x2,y2)</code> does not.</p>\n\n<p>Apparently, a \"rectangle\" shape only contains width and height, but not the \"origin point\". This is weird, since lines and polygons, instead, do contain a origin point in the <code>Shape</code> type. This looks as a potential design inconsistency.</p>\n\n<p>You should provide a definition for <code>Side</code> in your question, otherwise we can only speculate.</p>\n"}], "owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1522408288, "creation_date": 1522407182, "question_id": 49573075, "link": "https://stackoverflow.com/questions/49573075/couldnt-match-integer-with-double-creating-a-rectangle", "title": "Couldnt Match Integer With Double? - Creating a Rectangle", "body": "<pre><code>shapeToPic :: Shape -&gt; Picture\nshapeToPic (Line a b) = polyline [a, b]\nshapeToPic (Rectangle a b) = rectangle a b\n</code></pre>\n\n<p>Shape is defined by</p>\n\n<pre><code>data Shape = Rectangle Side Side\n       | Ellipse   Side Side\n       | Polygon   [Point]\n       | Line      Point Point\n deriving (Show)\n</code></pre>\n\n<p>Error I get:</p>\n\n<blockquote>\n  <p><code>&lt;interactive&gt;:55:41: error:\n      * Couldn't match type</code>(Integer, Integer)' with <code>Double'\n        Expected type: Side\n          Actual type: (Integer, Integer)\n      * In the second argument of</code>Rectangle', namely <code>(5, 7)'\n        In the first argument of</code>shapeToPic', namely\n          <code>(Rectangle (3, 3) (5, 7))'\n        In the first argument of</code>drawingOf', namely\n          `(shapeToPic (Rectangle (3, 3) (5, 7)))'</p>\n</blockquote>\n\n<p>Kind of new to Haskell, I understand I need to put a 'Side' type as a rectangle needs 2 points, however, not sure what the problem is. I have 2 points? Any help with solving this would be greatly appreciated!</p>\n"}, {"tags": ["haskell", "associative-array", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1522377032, "post_id": 49566065, "comment_id": 86143691, "body": "I was going to mention Kmett&#39;s <a href=\"https://hackage.haskell.org/package/keys\" rel=\"nofollow noreferrer\"><i>keys</i> package</a> in a separate answer, but then I noticed that its description says &quot;In practice this package is largely subsumed by the <i>lens</i> package, but it is maintained for now as it has much simpler dependencies&quot;."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 10, "last_activity_date": 1522363236, "creation_date": 1522363236, "answer_id": 49566065, "question_id": 49565868, "link": "https://stackoverflow.com/questions/49565868/does-there-exist-a-generic-associative-array-or-dictionary-typeclass-in-hask/49566065#49566065", "title": "Does there exist a generic &quot;associative array&quot; or &quot;dictionary&quot; typeclass in Haskell for which both Data.Map and Data.HashMap can be made instances?", "body": "<p>In <em>lens</em>, the following classes generalize containers like <code>HashMap</code> and <code>Map</code>: <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-At.html\" rel=\"noreferrer\"><code>At</code></a>, <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Indexed.html#t:FunctorWithIndex\" rel=\"noreferrer\"><code>FunctorWithIndex</code></a>, <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Indexed.html#t:FoldableWithIndex\" rel=\"noreferrer\"><code>FoldableWithIndex</code></a>, <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Indexed.html#t:TraversableWithIndex\" rel=\"noreferrer\"><code>TraversableWithIndex</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5774, "user_id": 105137, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/253329f6f7506a5299db1cb608d8defd?s=128&d=identicon&r=PG", "display_name": "kostmo", "link": "https://stackoverflow.com/users/105137/kostmo"}, "is_accepted": false, "score": 0, "last_activity_date": 1535347199, "creation_date": 1535347199, "answer_id": 52032934, "question_id": 49565868, "link": "https://stackoverflow.com/questions/49565868/does-there-exist-a-generic-associative-array-or-dictionary-typeclass-in-hask/52032934#52032934", "title": "Does there exist a generic &quot;associative array&quot; or &quot;dictionary&quot; typeclass in Haskell for which both Data.Map and Data.HashMap can be made instances?", "body": "<p>I just came across this blog post \"<a href=\"https://kowainik.github.io/posts/2018-08-19-picnic-put-containers-into-a-backpack\" rel=\"nofollow noreferrer\">Picnic: put containers into a Backpack</a>\" that is an experimental approach to present a unified interface for containers.</p>\n\n<p>The approach using Backpack is summarized by the author as:</p>\n\n<blockquote>\n  <p>First, you write the types of the desired methods \u2014 signatures. And then you implement these signatures for the different data types.</p>\n</blockquote>\n\n<p>The blog post fills in the details.</p>\n"}], "owner": {"reputation": 5774, "user_id": 105137, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/253329f6f7506a5299db1cb608d8defd?s=128&d=identicon&r=PG", "display_name": "kostmo", "link": "https://stackoverflow.com/users/105137/kostmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1535347199, "creation_date": 1522362109, "last_edit_date": 1522999941, "question_id": 49565868, "link": "https://stackoverflow.com/questions/49565868/does-there-exist-a-generic-associative-array-or-dictionary-typeclass-in-hask", "title": "Does there exist a generic &quot;associative array&quot; or &quot;dictionary&quot; typeclass in Haskell for which both Data.Map and Data.HashMap can be made instances?", "body": "<p>I would like to design an API that accepts as input a dictionary structure such that all keys are guaranteed unique.  However, I don't want to impose any particular dictionary implementation on the user.</p>\n\n<p>For example, the user should be able to supply either a <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.9.0/docs/Data-HashMap-Strict.html#t:HashMap\" rel=\"nofollow noreferrer\"><code>HashMap</code></a> (from <code>unordered-containers</code>) or <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Strict.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a> (from <code>containers</code>) as input.</p>\n\n<p>Is this possible, or even a good idea?</p>\n"}, {"tags": ["haskell", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1522357271, "post_id": 49564714, "comment_id": 86138140, "body": "<code>pointfree.io</code> is a fun toy, nothing else. It&#39;s shouldn&#39;t in any way be expected to give <i>good</i> suggestions, it only hints what&#39;s possible."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1522360771, "post_id": 49564714, "comment_id": 86139615, "body": "I&#39;m surprised it chose <code>(&#39;X&#39; ==)</code> rather than <code>(== &#39;X&#39;)</code>. Obviously this transposition is &quot;safe&quot; because <code>(==)</code> is supposed to be symmetrical, but why wouldn&#39;t it just choose an exact transformation?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 6, "creation_date": 1522370886, "post_id": 49564714, "comment_id": 86142316, "body": "@amalloy I can&#39;t answer why that tool does it, but it is something I pay attention to myself when writing partial applications. As a rule of thumb, applying earlier arguments first is better, because carefully written functions may share more computation when given their first arguments than when dropped under a lambda. e.g. imagine if <code>(==)</code> first compared some expensive statistic about each argument, then continued with some other comparisons; then <code>map (foo==) bar</code> could be significantly more efficient than <code>map (==foo) bar</code> because the former computed <code>foo</code>&#39;s statistic just once."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522376691, "post_id": 49565120, "comment_id": 86143618, "body": "This answer is entirely correct. It is perhaps worth noting that the Wikipedia explanation is rather odd: &quot;there was very little demand for such a separation&quot; sounds like an euphemism, as the separation served no purpose whatsoever."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522442551, "post_id": 49565120, "comment_id": 86170277, "body": "@duplode, I think the explanation sounds wrong because <code>Applicative</code> was always (to the best of my knowledge) a subclass of <code>Functor</code>. It certainly was by <code>base-4.0.0.0</code>, back in 2009."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522451049, "post_id": 49565120, "comment_id": 86173114, "body": "@dfeuer Oh wow, that&#39;s flat out wrong indeed. (I hadn&#39;t actually realised that page was also talking about <code>Functor</code>, due to a combination of late night posting and expecting to see the usual remarks about the AMP.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522452750, "post_id": 49565120, "comment_id": 86173563, "body": "@duplode, after checking through all the ancient documentation to verify that <code>Applicative</code> has been a subclass of <code>Functor</code> since its introduction in <code>base-4.0.0.0</code>, I edited Wikipedia to remove the very definite error. I think someone saw that the <code>Applicative</code> class stretched out in the original paper lacked a <code>Functor</code> superclass and got confused."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1522456338, "post_id": 49565120, "comment_id": 86174325, "body": "@dfeuer This conversation has reminded me that the <i>first</i> paragraph of that article <a href=\"https://stackoverflow.com/q/42043385/2751851\">has also been recognised as nonsense for quite a while</a>. I have made a quick attempt at making it, if nothing else, correct."}], "tags": [], "owner": {"reputation": 303, "user_id": 9557757, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dNmFv.png?s=128&g=1", "display_name": "Scarabyte", "link": "https://stackoverflow.com/users/9557757/scarabyte"}, "is_accepted": true, "score": 8, "last_activity_date": 1522455024, "last_edit_date": 1522455024, "creation_date": 1522357957, "answer_id": 49565120, "question_id": 49564714, "link": "https://stackoverflow.com/questions/49564714/why-did-pointfree-io-choose-liftm2-instead-of-lifta2/49565120#49565120", "title": "Why did pointfree.io choose liftM2 instead of liftA2?", "body": "<p>The fact is that <code>Control.Monad</code> is much older than <code>Control.Applicative</code>.</p>\n\n<p>Monads were already in Haskell 98, while the paper about applicative functors was introduced in 2007. The package in Hackage exists since 2005.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Applicative_functor#Relationship_to_monads\" rel=\"nofollow noreferrer\">Wikipedia</a>:</p>\n\n<blockquote>\n  <p>Due to historical accident, applicative functors were not implemented as a superclass of Monad, but as a separate type class. It turned out that, in practice, there was very little demand for such a separation, so in 2014, it was proposed to make Applicative retroactively a superclass of Monad.</p>\n</blockquote>\n\n<p>So <code>liftM{N}</code> are still valid.</p>\n"}], "owner": {"reputation": 1473, "user_id": 57954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nMH6G.png?s=128&g=1", "display_name": "Jeff Pratt", "link": "https://stackoverflow.com/users/57954/jeff-pratt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "accepted_answer_id": 49565120, "answer_count": 1, "score": 2, "last_activity_date": 1522455024, "creation_date": 1522356183, "question_id": 49564714, "link": "https://stackoverflow.com/questions/49564714/why-did-pointfree-io-choose-liftm2-instead-of-lifta2", "title": "Why did pointfree.io choose liftM2 instead of liftA2?", "body": "<p>I was recently writing a solution for the <a href=\"http://exercism.io/exercises/haskell/isbn-verifier/readme\" rel=\"nofollow noreferrer\">ISBN Verifier</a> exercise at <a href=\"http://exercism.io\" rel=\"nofollow noreferrer\">Exercism</a>, and when I ran this function through <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a>:</p>\n\n<pre><code>\\c -&gt; isDigit c || c == 'X'\n</code></pre>\n\n<p>I got back:</p>\n\n<pre><code>liftM2 (||) isDigit ('X' ==)\n</code></pre>\n\n<p>Why did pointfree.io choose <code>liftM2</code> from <code>Control.Monad</code> instead of <code>liftA2</code> from <code>Control.Applicative</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1522359967, "last_edit_date": 1522359967, "creation_date": 1522359358, "answer_id": 49565395, "question_id": 49564311, "link": "https://stackoverflow.com/questions/49564311/ghc-type-error-doesnt-make-sense-to-me/49565395#49565395", "title": "GHC type error doesn&#39;t make sense to me", "body": "<p>Consider these two facts:</p>\n\n<p>Fact 1: whoever calls <code>Impure</code> gets to choose the type of <code>x</code> in its type:</p>\n\n<pre><code>Impure ::  Union r x -&gt; (x -&gt; Eff r a) -&gt; Eff r a\n</code></pre>\n\n<p>Note that such <code>x</code> does not end up in <code>Eff r a</code>, making the type an \"existential\" one.</p>\n\n<p>Fact 2: whoever calls <code>createInterpreter</code> gets to choose the value of <code>x</code> in its type</p>\n\n<pre><code>createInterpreter :: (a -&gt; Eff r b)\n                  -&gt; (f x -&gt; (x -&gt; Eff (f ': r) a) -&gt; Eff (f ': r) a)\n                  -&gt; (Eff r b -&gt; Eff r b) \n                  -&gt; Eff (f ': r) a -&gt; Eff r b\n</code></pre>\n\n<p>Note that this choice is <em>independent</em> from the first choice!</p>\n\n<p>So, both these facts imply that when we call</p>\n\n<pre><code>createInterpreter handlePure runContinuation applyEffect (Impure f k)\n</code></pre>\n\n<p>we can pass a <code>runContinuation</code> function for a type <code>x</code> and pass <code>Impure</code> using a distinct type <code>x</code> (say, <code>x1</code>). Since you are trying to mix these types, the compiler complains that they do not have to be the same.</p>\n\n<p>You might want the following type instead</p>\n\n<pre><code>createInterpreter :: (a -&gt; Eff r b)\n                  -&gt; (forall x. f x -&gt; (x -&gt; Eff (f ': r) a) -&gt; Eff (f ': r) a)\n                  -&gt; (Eff r b -&gt; Eff r b) \n                  -&gt; Eff (f ': r) a -&gt; Eff r b\n</code></pre>\n\n<p>This will force you later on to pass a <em>polymorphic</em> <code>runContinuation</code> function, which works on any choice of <code>x</code> which might be found \"inside\" <code>Impure</code>.</p>\n\n<hr>\n\n<p>Your example is quite complex, but to understand the issue you can also consider this similar case:</p>\n\n<pre><code>data SomeList where\n   SL :: [x] -&gt; SomeList\n\nsumIntList :: [Int] -&gt; Int\nsumIntList = sum\n\nworkWithSL :: ([x] -&gt; Int) -&gt; SomeList -&gt; Int\nworkWithSL f (SL list) = f list\n\ntest :: Int\ntest = workWithSL sumIntList (SL [True, False])\n</code></pre>\n\n<p>Here, we choose <code>x = Bool</code> when calling <code>SL</code>, but we choose <code>x = Int</code> when calling <code>workWithSL</code> (since we pass <code>sumIntList</code>). There is nothing wrong with such calls, since the types perfectly check out. The real issue is inside <code>workWithSL</code> which can not apply <code>f</code> to <code>list</code>, since the <code>list</code> may be of type <code>[x1]</code> instead of <code>[x]</code>.</p>\n"}], "owner": {"reputation": 103, "user_id": 5106670, "user_type": "registered", "profile_image": "https://graph.facebook.com/1614753835408701/picture?type=large", "display_name": "Kadhem Ouerghi", "link": "https://stackoverflow.com/users/5106670/kadhem-ouerghi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 49565395, "answer_count": 1, "score": 1, "last_activity_date": 1522359967, "creation_date": 1522354463, "question_id": 49564311, "link": "https://stackoverflow.com/questions/49564311/ghc-type-error-doesnt-make-sense-to-me", "title": "GHC type error doesn&#39;t make sense to me", "body": "<p>so i was playing around with Extensible effects trying to reimplement some of the fundamental types and functions when i got this type error :</p>\n\n<pre><code>home/kadhem/projects/Haskell/stackWorkingAgain/app/Implementation_error.hs:24:96: error:\n    * Couldn't match type `x1' with `x'\n      `x1' is a rigid type variable bound by\n        a pattern with constructor:\n          Impure :: forall (r :: [* -&gt; *]) a x.\n                    Union r x -&gt; (x -&gt; Eff r a) -&gt; Eff r a,\n        in an equation for `createInterpreter'\n        at /home/kadhem/projects/Haskell/stackWorkingAgain/app/Implementation_error.hs:22:59-68\n      `x' is a rigid type variable bound by\n        the type signature for:\n          createInterpreter :: forall a (r :: [* -&gt; *]) b (f :: * -&gt; *) x.\n                               (a -&gt; Eff r b)\n                               -&gt; (f x -&gt; (x -&gt; Eff (f : r) a) -&gt; Eff (f : r) a)\n                               -&gt; (Eff r b -&gt; Eff r b)\n                               -&gt; Eff (f : r) a\n                               -&gt; Eff r b\n        at /home/kadhem/projects/Haskell/stackWorkingAgain/app/Implementation_error.hs:(15,1)-(18,47)\n      Expected type: f x\n        Actual type: f x1\n    * In the first argument of `runContinuation', namely\n        `f_is_theTarget'\n</code></pre>\n\n<p>i don't understand how is x1 bound by the constructor Impure.</p>\n\n<p>here is the full code :</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GADTSyntax #-}\n{-# LANGUAGE  DataKinds #-}\n{-# LANGUAGE  FlexibleContexts #-}\n{-# LANGUAGE TypeOperators #-}\n\n\nmodule Implemntation where\n\nimport Data.OpenUnion (Union , decomp)\n\n\ndata Eff r a where \n   Pure :: a -&gt; Eff r a\n   Impure ::  Union r x -&gt; (x -&gt; Eff r a) -&gt; Eff r a\n\ncreateInterpreter :: (a -&gt; Eff r b)\n                  -&gt; (f x -&gt; (x -&gt; Eff (f ': r) a) -&gt; Eff (f ': r) a)\n                  -&gt; (Eff r b -&gt; Eff r b) \n                  -&gt; Eff (f ': r) a -&gt; Eff r b\n\n\ncreateInterpreter handlePure runContinuation applyEffect (Pure a) = \n      handlePure a\ncreateInterpreter handlePure runContinuation applyEffect (Impure f k) \n      = case decomp f of\nRight f_is_theTarget\n     -&gt; applyEffect $ createInterpreter handlePure runContinuation \n           applyEffect (runContinuation f_is_theTarget k)\nLeft f_is_notTheTarget\n     -&gt; Impure f_is_notTheTarget $ createInterpreter handlePure \n           runContinuation applyEffect  . k \n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1522353859, "post_id": 49564137, "comment_id": 86136457, "body": "<code>ifM</code> is indeed a very popular idea that exists in a number of &quot;general-purpose&quot; libraries, <a href=\"https://www.stackage.org/lts-11.2/hoogle?q=ifM\" rel=\"nofollow noreferrer\">check out Stackage</a>."}, {"owner": {"reputation": 1870, "user_id": 4837112, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/da93bd05b13630b7642656d7dd34918f?s=128&d=identicon&r=PG&f=1", "display_name": "danielspaniol", "link": "https://stackoverflow.com/users/4837112/danielspaniol"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1522354611, "post_id": 49564137, "comment_id": 86136842, "body": "If I understand correctly these are non standard libraries?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1522355063, "post_id": 49564137, "comment_id": 86137076, "body": "Unlike .NET or Java or other similar ecosystems, most Haskell libraries are &quot;non-standard&quot;. The only &quot;standard&quot; one would probably be Prelude. To some degree of approximation, one could consider Stack to be the Haskell &quot;standard&quot;, and in that sense all those libraries are, in fact, &quot;standard&quot;, since they&#39;re included in the Stack snapshot."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1522355117, "post_id": 49564137, "comment_id": 86137096, "body": "@danielspaniol By standard do you mean the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellpa2.html#x20-192000II\" rel=\"nofollow noreferrer\">libraries of the Haskell 2010 Report</a>? It is <i>really</i> small. In fact <code>Arbitrary</code> is not there..."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1522355165, "post_id": 49564137, "comment_id": 86137127, "body": "By arbitrary do you mean random?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 3, "creation_date": 1522355213, "post_id": 49564137, "comment_id": 86137157, "body": "@ThomasCook No, he means <a href=\"https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Arbitrary.html\" rel=\"nofollow noreferrer\"><code>Arbitrary</code></a> from the <i>non-standard</i> QuickCheck I believe."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1522373985, "post_id": 49564137, "comment_id": 86143019, "body": "@FyodorSoikin (1) &quot;Unlike .NET or Java or other similar ecosystems, most Haskell libraries are &#39;non-standard&#39;&quot; -- Indeed; standard versus non-standard libs isn&#39;t really relevant in Haskell practice. (2) &quot;To some degree of approximation, one could consider Stack to be the Haskell &#39;standard&#39;, and in that sense all those libraries are, in fact, &#39;standard&#39;&quot; -- Even with the caveats, I feel this is too much of a stretch. Stackage is, by design, too large and uncohesive to be seen in that way; also, the adoption of it (and Stack) isn&#39;t sufficiently close to universal."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1522444066, "post_id": 49564137, "comment_id": 86170878, "body": "The <code>array</code> library is also standard, but many people use <code>vector</code> or <code>primitive</code> for their array needs instead."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 6, "last_activity_date": 1522355717, "creation_date": 1522355717, "answer_id": 49564588, "question_id": 49564137, "link": "https://stackoverflow.com/questions/49564137/monadic-if-else/49564588#49564588", "title": "Monadic if else", "body": "<p>My general solution to the \"use once binding\" is <code>-XLambdaCase</code>:</p>\n\n<pre><code>instance (Arbitrary a) =&gt; Arbitrary (BinaryTree a)\n  arbitrary = arbitrary &gt;&gt;= \\case\n    True  -&gt; return Nil\n    False -&gt; generateNonEmptyTree\n</code></pre>\n\n<p>Alternately, you could use something like</p>\n\n<pre><code>bool :: a -&gt; a -&gt; Bool -&gt; a\nbool f _ False = f\nbool _ t True = t\n</code></pre>\n\n<p>(<code>Bool</code>'s equivalent to <code>either</code> or <code>foldr</code>)</p>\n\n<pre><code>instance (Arbitrary a) =&gt; Arbitrary (BinaryTree a)\n  arbitrary = bool generateNonEmptyTree (return Nil) =&lt;&lt; arbitrary\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1522372409, "creation_date": 1522372409, "answer_id": 49567164, "question_id": 49564137, "link": "https://stackoverflow.com/questions/49564137/monadic-if-else/49567164#49567164", "title": "Monadic if else", "body": "<p>For QuickCheck in particular, I'd use <code>oneof</code>:</p>\n\n<pre><code>arbitrary = oneof [return Nil, generateNonEmptyTree]\n</code></pre>\n\n<p>It does essentially what you propose in your question (generate a one-off value, then use it immediately):</p>\n\n<pre><code>oneof :: [Gen a] -&gt; Gen a\noneof [] = error \"QuickCheck.oneof used with empty list\"\noneof gs = choose (0,length gs - 1) &gt;&gt;= (gs !!)\n</code></pre>\n\n<p>But since it's a library function, this means you don't have to <em>see</em> the one-off values in your own code.</p>\n"}], "owner": {"reputation": 1870, "user_id": 4837112, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/da93bd05b13630b7642656d7dd34918f?s=128&d=identicon&r=PG&f=1", "display_name": "danielspaniol", "link": "https://stackoverflow.com/users/4837112/danielspaniol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 49567164, "answer_count": 2, "score": 2, "last_activity_date": 1522372409, "creation_date": 1522353649, "question_id": 49564137, "link": "https://stackoverflow.com/questions/49564137/monadic-if-else", "title": "Monadic if else", "body": "<p>I am new to Haskell and want to generate an <code>Arbitrary</code> tree. <br>\nSo my first idea is to create an arbitary bool, if it is true then return an empty tree and else create a non-empty one:</p>\n\n<pre><code>instance (Arbitrary a) =&gt; Arbitrary (BinaryTree a)\n  arbitrary = do\n    createNonEmpty &lt;- arbitrary\n    if createNonEmpty \n      then return Nil\n      else generateNonEmptyTree\n</code></pre>\n\n<p>But this pattern of creating the bool and use it just for that if seems a bit odd and it feels like there should be a more idiomatic way. <br>\nIs there already some kind of \"monadic if\" in the standard library that I could use like</p>\n\n<pre><code>arbitrary = ifM arbitrary (return Nil) (generateNonEmptyTree)\n</code></pre>\n\n<p>Or what else is the most idiomatic way to solve this?</p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "edited": false, "score": 1, "creation_date": 1522354745, "post_id": 49564239, "comment_id": 86136909, "body": "What if you have a sum type of product types? I suppose each product type could be a record but then you have partial accessors which will throw a runtime error if used on the wrong product type.  e.x. <code>data Foo = Bar { x :: String } | Baz { y :: String}</code> <code>x $ Baz &quot;foo&quot;</code>  will not throw any compile time warnings/errors but will result in a runtime error. This makes a strong case for not using records when you have a sum of products."}], "tags": [], "owner": {"reputation": 41, "user_id": 9571776, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FesSKFmssWI/AAAAAAAAAAI/AAAAAAAAAPY/cUNEphtI5Zw/photo.jpg?sz=128", "display_name": "Oleg Nykolyn", "link": "https://stackoverflow.com/users/9571776/oleg-nykolyn"}, "is_accepted": false, "score": 2, "last_activity_date": 1522354116, "creation_date": 1522354116, "answer_id": 49564239, "question_id": 49563081, "link": "https://stackoverflow.com/questions/49563081/use-aesons-generictojson-to-encode-a-product-type-to-an-object-rather-than-a/49564239#49564239", "title": "Use Aeson&#39;s `genericToJSON` to encode a product type to an object, rather than a list", "body": "<p>Desired result can be achieved using record syntax.\nIn this case Aeson will encode value as an object.\nHowever, two sets of options are needed in this case, one for <code>FooBar</code> and other for <code>Foo</code> and <code>Bar</code>:</p>\n\n<pre><code>data Foo = FooBar { bar:: Bar, baz :: Baz} deriving Generic\n\ndata Bar = Bar Integer deriving Generic\n\nnewtype Baz = Baz Integer deriving Generic\ninstance ToJSON Foo where\n  toJSON = genericToJSON options\n\ninstance ToJSON Bar where\n  toJSON = genericToJSON option_nested\n\ninstance ToJSON Baz where\n  toJSON = genericToJSON option_nested\n\noptions :: Options\noptions = defaultOptions { tagSingleConstructors = True,\n                           sumEncoding = ObjectWithSingleField,\n                           fieldLabelModifier = \\s -&gt; (toUpper . head) s : (tail s)  }\noption_nested :: Options\noption_nested = defaultOptions { sumEncoding = UntaggedValue }\n</code></pre>\n\n<p>Result: <code>{\"FooBar\":{\"Baz\":2,\"Bar\":4}}\"</code></p>\n"}], "owner": {"reputation": 3185, "user_id": 114887, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b0c7e3c2d9ff81adf7470e066e4a705?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Piziak", "link": "https://stackoverflow.com/users/114887/matthew-piziak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1522354116, "creation_date": 1522349152, "question_id": 49563081, "link": "https://stackoverflow.com/questions/49563081/use-aesons-generictojson-to-encode-a-product-type-to-an-object-rather-than-a", "title": "Use Aeson&#39;s `genericToJSON` to encode a product type to an object, rather than a list", "body": "<p>In the following code, <code>encoded</code> is equal to <code>{\"FooBar\":[{\"Bar\":4},{\"Baz\":2}]}</code>.</p>\n\n<p>The desired encoding is <code>{\"FooBar\":{\"Bar\":4,\"Baz\":2}}</code>. </p>\n\n<pre><code>import           Data.Aeson\nimport           Data.Aeson.Types\n\ndata Foo = FooBar Bar Baz deriving Generic\n\nnewtype Bar = Bar Integer deriving Generic\n\nnewtype Baz = Baz Integer deriving Generic\n\ninstance ToJSON Foo where\n  toJSON = genericToJSON options\n\ninstance ToJSON Bar where\n  toJSON = genericToJSON options\n\ninstance ToJSON Baz where\n  toJSON = genericToJSON options\n\noptions :: Options\noptions = defaultOptions { tagSingleConstructors = True, \n                           sumEncoding = ObjectWithSingleField }\n\nfoo :: Foo\nfoo = FooBar (Bar 4) (Baz 2)\n\nencoded = encode foo\n</code></pre>\n\n<p>That is to say, I would like constructors of product types to be keys, and their components to be objects. I have been able to get pretty close with <code>tagSingleConstructors = True</code> and <code>sumEncoding = ObjectWithSingleField</code>, but Aeson puts <code>Bar</code> and <code>Baz</code> into a list rather that an object.</p>\n\n<p>None of the other modifiers in <code>Options</code> seem to be relevant, but I may be missing something. Is the desired encoding possible with <code>genericToJSON</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1522347630, "post_id": 49562602, "comment_id": 86133452, "body": "If your app works in <code>WINDOWS</code> subsystem, then you are out of luck."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1522348204, "post_id": 49562602, "comment_id": 86133757, "body": "Are you running your program from a command prompt window / terminal window / console window (or whatever that is called on windows)?"}, {"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1522349386, "post_id": 49562602, "comment_id": 86134349, "body": "I&#39;m using Visual Studio Code v1.21.1. And I have a workaround: I simply add unit tests that test for the values of interest, which for now are &#39;show&#39; strings, and I test against an empty string -- and the test result shows me the actual."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522379246, "post_id": 49562602, "comment_id": 86144079, "body": "If your issue is specifically with Visual Studio Code (plus, I presume, one of the Haskell plugins for it), please <a href=\"https://stackoverflow.com/posts/49562602/edit\">edit</a> your question and its title to make that clear."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1522402309, "creation_date": 1522402309, "answer_id": 49571897, "question_id": 49562602, "link": "https://stackoverflow.com/questions/49562602/haskell-where-to-find-debug-trace-output-on-windows10/49571897#49571897", "title": "Haskell: Where to find debug trace output on Windows10", "body": "<p>As far as I can tell, <em>console</em> in Windows means the <em>standard output stream</em>. You can easily see trance output if you're running GHCi in the Windows Command Prompt, as this session demonstrates:</p>\n\n<pre><code>C:\\Users\\mark&gt;stack ghci\n\nConfiguring GHCi with the following packages:\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from C:\\Users\\mark\\AppData\\Local\\Temp\\ghci7560\\ghci-script\nPrelude&gt; :m +Debug.Trace\nPrelude Debug.Trace&gt; foo x = trace \"foo\" x\nPrelude Debug.Trace&gt; foo 42\nfoo\n42\n</code></pre>\n\n<p>Here, I'm using <a href=\"https://docs.haskellstack.org\" rel=\"nofollow noreferrer\">Stack</a> to run Haskell, but IIRC, you can use the Haskell Platform for Windows in the same way.</p>\n"}], "owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 198, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1522402326, "creation_date": 1522347043, "last_edit_date": 1522402326, "question_id": 49562602, "link": "https://stackoverflow.com/questions/49562602/haskell-where-to-find-debug-trace-output-on-windows10", "title": "Haskell: Where to find debug trace output on Windows10", "body": "<p>I am using <code>trace</code> for debugging on Windows 10, and the terminal states that <code>Logs printed to console</code>, but I have no idea where to find this output. </p>\n"}, {"tags": ["sql-server", "haskell", "odbc", "freetds", "hdbc"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 0, "last_activity_date": 1522380441, "creation_date": 1522380441, "answer_id": 49567983, "question_id": 49562081, "link": "https://stackoverflow.com/questions/49562081/sequencing-queries-for-ms-sql-with-hdbc-odbc/49567983#49567983", "title": "Sequencing queries for MS SQL with HDBC-ODBC", "body": "<blockquote>\n  <p>With both the ODBC and FreeTDS drivers this query fails after processing a nondeterministic number of dates.</p>\n</blockquote>\n\n<p>This issue appears to have been reported as <a href=\"https://github.com/hdbc/hdbc-odbc/issues/28\" rel=\"nofollow noreferrer\">GitHub issue #28 for HDBC-OBCD</a>. The workaround proposed there is to prepend <code>DSN=</code> to the connection string.</p>\n\n<blockquote>\n  <p>It also never prints any of the output sizes (10 expected) to stdout. </p>\n</blockquote>\n\n<p>The type of <code>putStrLn . show . length &lt;$&gt; DB.quickQuery' conn q []</code> is <code>IO (IO ())</code>.<a href=\"https://stackoverflow.com/q/42404258/2751851\"> You are creating an <code>IO</code> computation that prints the length, but you aren't actually having it executed</a>. To fix that, replace <code>(&lt;$&gt;)</code> with <code>(&gt;&gt;=)</code>, or something equivalent to it:</p>\n\n<pre><code>    DB.quickQuery' conn q [] &gt;&gt;= putStrLn . show . length \n</code></pre>\n\n\n\n<pre><code>    putStrLn . show . length =&lt;&lt; DB.quickQuery' conn q []\n</code></pre>\n\n\n\n<pre><code>    rows &lt;- DB.quickQuery' conn q []\n    putStrLn . show . length $ rows\n</code></pre>\n\n<p>P.S.: <code>putStrLn . show</code> can be more conveniently written as <code>print</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 3904646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cj6nU.png?s=128&g=1", "display_name": "bkc", "link": "https://stackoverflow.com/users/3904646/bkc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 170, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1522380639, "creation_date": 1522344861, "last_edit_date": 1522380639, "question_id": 49562081, "link": "https://stackoverflow.com/questions/49562081/sequencing-queries-for-ms-sql-with-hdbc-odbc", "title": "Sequencing queries for MS SQL with HDBC-ODBC", "body": "<p>What is the proper way to use a single connection and run multiple queries when connecting to MS SQL server from Haskell?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Database.HDBC as DB\nimport qualified Database.HDBC.ODBC as DB\nimport Data.Time.Calendar (fromGregorian)\nimport Control.Monad (forM_)\n\ntestQueries :: String -&gt; IO ()\ntestQueries connectionString =\n  do\n    conn &lt;- DB.connectODBC connectionString\n    forM_ [startDate..endDate] $ \\date -&gt; do\n      putStrLn $ \"processing date: \" ++ show date\n      putStrLn . show . length &lt;$&gt; DB.quickQuery' conn q []\n    DB.disconnect conn\n  where\n    q :: String\n    q =\n      \"SELECT TOP 10 * FROM INFORMATION_SCHEMA.COLUMNS\"\n    startDate =\n      fromGregorian 2016 9 14\n    endDate =\n      fromGregorian 2016 11 29\n</code></pre>\n\n<p>With both the ODBC and FreeTDS drivers this query fails after processing a nondeterministic number of dates. It also never prints any of the output sizes (10 expected) to stdout. Sample output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>processing date: 2016-09-14\nprocessing date: 2016-09-15\nprocessing date: 2016-09-16\nprocessing date: 2016-09-17\nprocessing date: 2016-09-18\nprocessing date: 2016-09-19\nprocessing date: 2016-09-20\nprocessing date: 2016-09-21\nprocessing date: 2016-09-22\nprocessing date: 2016-09-23\nprocessing date: 2016-09-24\nprocessing date: 2016-09-25\nprocessing date: 2016-09-26\nprocessing date: 2016-09-27\nprocessing date: 2016-09-28\nexe: Prelude.chr: bad argument: 5832776\n</code></pre>\n\n<p>Is this usage pattern incorrect?</p>\n\n<h1>System info:</h1>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 17.10\nRelease:    17.10\nCodename:   artful\n$ cat /etc/odbcinst.ini \n[ODBC Driver 17 for SQL Server]\nDescription=Microsoft ODBC Driver 17 for SQL Server\nDriver=/opt/microsoft/msodbcsql17/lib64/libmsodbcsql-17.0.so.1.1\nUsageCount=1\n\n[FreeTDS]\nDescription = FreeTDS\nDriver = /usr/lib/x86_64-linux-gnu/odbc/libtdsodbc.so\nSetup = /usr/lib/x86_64-linux-gnu/odbc/libtdsS.so\nUsageCount = 1\n</code></pre>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1522344355, "post_id": 49561881, "comment_id": 86131819, "body": "I think two days ago there was somebody that asked more or less the very same question."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1522345423, "post_id": 49561881, "comment_id": 86132384, "body": "The &quot;best&quot; way is to use one of the packages that provide memoization.  Consider MemoTrie and monad-memo.  If you want to role your own it can be fun and instructive to do with a State monad.  If you want your algorithm to perform better then consider ditching the use of <code>(!!)</code> which is itself O(N) and incurred multiple times - use a vector or array if you must perform random access."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522346388, "post_id": 49561881, "comment_id": 86132853, "body": "@WillemVanOnsem please see my edit"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522346498, "post_id": 49561881, "comment_id": 86132901, "body": "@ThomasM.DuBuisson is there no easier way to roll your own. The other examples on stack overflow seem to involve really complicated solutions to something that seems to be me should be easy... if you know how :)"}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522352495, "post_id": 49563696, "comment_id": 86135820, "body": "Thank you for this. &quot;easier than what?&quot;, well I meant as easy as the 50 or so character amendments in my python code. The memoization of that code took very little effort. I was hoping that the haskell version would not involve having to melt my brain :). however, What you have post is very helpful and it is exactly what I am looking for in terms of learning. Thanks again"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522353455, "post_id": 49563696, "comment_id": 86136284, "body": "@matthias Ah I see. I added sort of a translation of your Python code so you can read that and compare."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522354442, "post_id": 49563696, "comment_id": 86136735, "body": "amazing, thank you very much for your help!"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522355075, "post_id": 49563696, "comment_id": 86137082, "body": "in the <code>memoTrie</code> version should <code>v = V.toList xs</code> be <code>v = V.FromList xs</code> also, your <code>goPythonVersion</code> doesn&#39;t seem t work?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522359949, "post_id": 49563696, "comment_id": 86139286, "body": "The <code>goPythonVersion</code> ran - did you mean the wrong result? You are adding the last two values in the <code>else</code> case and I forgot/discarded the <code>r1</code> value (edited).  Warnings via <code>-Wall</code> catch these simple mistakes and I should have used them.  Yes, <code>fromList</code> (lower case f) is what I meant with the other example."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522360498, "post_id": 49563696, "comment_id": 86139512, "body": "I had fixed the last part of the python version. I meant there is no improvement in speed with the memoization (in fact it might be worst) whereas your state examples are instant with massive lists."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 1, "creation_date": 1522415709, "post_id": 49563696, "comment_id": 86157630, "body": "Oh, lol. That&#39;s because I never insert the result into the map. What was I thinking yesterday!  There&#39;s no match to the python <code>m[k]=val</code>. Will edit in a little while."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1522419942, "last_edit_date": 1522419942, "creation_date": 1522351708, "answer_id": 49563696, "question_id": 49561881, "link": "https://stackoverflow.com/questions/49561881/haskell-memoization-of-recursion/49563696#49563696", "title": "Haskell: memoization of recursion", "body": "<blockquote>\n  <p>is there no easier way to roll your own [memoization?]</p>\n</blockquote>\n\n<p>Easier than what? A state monad is really easy and if you are used to thinking imperatively then it should also be intuitive.</p>\n\n<p>The full, inlined, version that uses a vector instead of the list is:</p>\n\n<pre><code>{-# LANGUAGE MultiWayIf #-}\nimport Control.Monad.Trans.State as S\nimport Data.Vector as V\nimport Data.Map.Strict as M\n\ngoGood :: [Int] -&gt; Int -&gt; Int -&gt; Int\ngoGood xs t0 i0 =\n    let v = V.fromList xs\n    in evalState (explicitMemo v t0 i0) mempty\n where\n explicitMemo :: Vector Int -&gt; Int -&gt; Int -&gt; State (Map (Int,Int) Int) Int\n explicitMemo v t i = do\n    m &lt;- M.lookup (t,i) &lt;$&gt; get\n    case m of\n        Nothing -&gt;\n         do res &lt;- if | t == 0          -&gt; pure 1\n                      | t &lt; 0           -&gt; pure 0\n                      | i &lt; 0           -&gt; pure 0\n                      | t &lt; (v V.! i)   -&gt; explicitMemo v t (i-1)\n                      | otherwise       -&gt; (+) &lt;$&gt; explicitMemo v (t - (v V.! i)) (i-1) &lt;*&gt; explicitMemo v t\n (i-1)\n            S.modify (M.insert (t,i) res)\n            pure res\n        Just r  -&gt; pure r\n</code></pre>\n\n<p>That is, we look up in a map if we've already computed the result. If so, return the result. If not, compute and store the result before returning it.</p>\n\n<p>We can clean this up a lot with just a couple helper functions:</p>\n\n<pre><code>prettyMemo :: Vector Int -&gt; Int -&gt; Int -&gt; State (Map (Int,Int) Int) Int\nprettyMemo v t i = cachedReturn =&lt;&lt; cachedEval (\n            if | t == 0          -&gt; pure 1\n               | t &lt; 0           -&gt; pure 0\n               | i &lt; 0           -&gt; pure 0\n               | t &lt; (v V.! i)   -&gt; prettyMemo v t (i-1)\n               | otherwise       -&gt;\n                   (+) &lt;$&gt; prettyMemo v (t - (v V.! i)) (i-1)\n                       &lt;*&gt; prettyMemo v t (i-1)\n            )\n where\n key = (t,i)\n -- Lookup value in cache and return it\n cachedReturn res = S.modify (M.insert key res) &gt;&gt; pure res\n\n -- Use cached value or run the operation\n cachedEval oper = maybe oper pure =&lt;&lt; (M.lookup key &lt;$&gt; get)\n</code></pre>\n\n<p>Now our map lookup and map update are in some simple (to the experienced Haskell developer) helper functions that wrap the entire computation.  A small difference here is we update the map regardless of if the computation was cached at some minor computational cost.</p>\n\n<p>We can make this even cleaner by dropping the monad (see the linked related questions).  There is a popular package (MemoTrie) that handles the guts for you:</p>\n\n<pre><code>memoTrieVersion :: [Int] -&gt; Int -&gt; Int -&gt; Int\nmemoTrieVersion xs = go\n where\n v = V.fromList xs\n go t i | t == 0 = 1\n        | t &lt; 0  = 0\n        | i &lt; 0  = 0\n        | t &lt; v V.! i = memo2 go t (i-1)\n        | otherwise   = memo2 go (t - (v V.! i)) (i-1) + memo2 go t (i-1)\n</code></pre>\n\n<p>If you like the monadic style you could always use the <code>monad-memo</code> package.</p>\n\n<p>EDIT: A mostly-direct translation of your Python code to Haskell shows an important difference is the immutability of the variables.  In your <code>otherwise</code> (or <code>else</code>) case you use <code>go</code> twice and implicitly one invocation will update the cache (<code>m</code>) that the second call uses, thus saving computation in a memoizing manner.  In Haskell if you're avoiding monads and lazy evaluation to recursively define a vector (which can be quite powerful) then the simplest solution left is to explicitly pass your map (dictionary) around:</p>\n\n<pre><code>import Data.Vector as V\nimport Data.Map as M\n\ngoWrapped :: Vector Int -&gt; Int -&gt; Int -&gt; Int\ngoWrapped xxs t i = fst $ goPythonVersion xxs t i mempty\n\ngoPythonVersion :: Vector Int -&gt; Int -&gt; Int -&gt; Map (Int,Int) Int -&gt; (Int,Map (Int,Int) Int)\ngoPythonVersion xxs t i m =\n  let k = (t,i)\n  in case M.lookup k m of -- if  k in m:\n    Just r -&gt; (r,m)       --     return m[k]\n    Nothing -&gt;\n      let (res,m') | t == 0 = (1,m)\n                   | t  &lt; 0 = (0,m)\n                   | i  &lt; 0 = (0,m)\n                   | t  &lt; xxs V.! i = goPythonVersion xxs t (i-1) m\n                   | otherwise  =\n                      let (r1,m1) = goPythonVersion xxs (t - (xxs V.! i)) (i-1) m\n                          (r2,m2) = goPythonVersion xxs t (i-1) m1\n                      in (r1 + r2, m2)\n      in (res, M.insert k res m')\n</code></pre>\n\n<p>And while this version is a decent translation of the Python I'd rather see a more idiomatic solution such as the below.  Notice we bind a variable to the resulting computation (named \"computed\" for the Int and the updated map) but thanks to lazy evaluation not much work is done unless the cache doesn't yield a result.</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n{-# LANGUAGE TupleSections #-}\ngoMoreIdiomatic:: Vector Int -&gt; Int -&gt; Int -&gt; Map (Int,Int) Int -&gt; (Int,Map (Int,Int) Int)\ngoMoreIdiomatic xxs t i m =\n  let cached = M.lookup (t,i) m\n      ~(comp, M.insert (t,i) comp -&gt; m')\n        | t == 0 = (1,m)\n        | t  &lt; 0 = (0,m)\n        | i  &lt; 0 = (0,m)\n        | t  &lt; xxs V.! i = goPythonVersion xxs t (i-1) m\n        | otherwise  =\n           let (r1,m1) = goPythonVersion xxs (t - (xxs V.! i)) (i-1) m\n               (r2,m2) = goPythonVersion xxs t (i-1) m1\n           in (r1 + r2, m2)\n    in maybe (comp,m') (,m) cached\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "closed_date": 1522375774, "accepted_answer_id": 49563696, "answer_count": 1, "score": 0, "last_activity_date": 1522419942, "creation_date": 1522344107, "last_edit_date": 1522346364, "question_id": 49561881, "link": "https://stackoverflow.com/questions/49561881/haskell-memoization-of-recursion", "closed_reason": "Duplicate", "title": "Haskell: memoization of recursion", "body": "<p>if I have the following function:</p>\n\n<pre><code>go xxs t i\n  | t == 0         = 1\n  | t &lt; 0          = 0\n  | i &lt; 0          = 0\n  | t &lt; (xxs !! i) = go xxs t (i-1)\n  | otherwise      = go xxs (t - (xxs !! i)) (i-1) + go xxs t (i-1)\n</code></pre>\n\n<p>what is the best way to memoize the results? I can't seem to get my head how to store a dynamic set of tuples and update and return the value at the same time.</p>\n\n<p>The equivalent of what I am trying to do in python would be:</p>\n\n<pre><code>def go(xxs, t , i, m):\n  k = (t,i)\n  if  k in m:      # check if value for this pair is already in dictionary \n      return m[k]\n  if t == 0:\n      return 1\n  elif t &lt; 0:\n      return 0\n  elif i &lt; 0:\n      return 0\n  elif t &lt; xxs[i]:\n      val = go(xxs, t, i-1,m)  \n  else:\n      val = (go(xxs, total - xxs[i]), i-1,m) + go(xxs, t, i-1,m)\n  m[k] = val  # store the new value in dictionary before returning it\n  return val\n</code></pre>\n\n<p>EDIT: I think this is somewhat different to <a href=\"https://stackoverflow.com/questions/3208258\">this answer</a>. The function in question there has a linear progression and you can index the results with a list <code>[1..]</code>. In this case, my Keys <code>(t,i)</code> are not necessarily in order or incremental. for example I could end up with an set of keys that are</p>\n\n<p><code>[(9,1),(8,2),(7,4),(6,4),(5,5),(4,6),(3,6),(2,7),(1,8),(0,10)]</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "edited": false, "score": 0, "creation_date": 1522348853, "post_id": 49562245, "comment_id": 86134080, "body": "I plan to work with the value of the <code>ts</code> variable in function <code>firstFor</code> and then return it and save it into <code>tsko</code>. Thats why I can&#39;t use <code>let</code> in the way you suggest."}, {"owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "edited": false, "score": 0, "creation_date": 1522349265, "post_id": 49562245, "comment_id": 86134291, "body": "Well, what I actually try to do is to simulate <code>while</code> cycle with the condition at the begin. I test if the set (setW ts) is empty, if it is not, I take the first item from it and pass it altogether with <code>ts</code> to function &#39;firstFor&#39;. And again, again..until set (setW ts) is empty."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1522345529, "creation_date": 1522345529, "answer_id": 49562245, "question_id": 49561594, "link": "https://stackoverflow.com/questions/49561594/couldnt-match-expected-type-m0/49562245#49562245", "title": "Couldn&#39;t match expected type `m0 ...&#39;", "body": "<p>Accoring to your own code</p>\n\n<pre><code>reduce ts \n| (Set.null (setW ts))==False = do\n    tsko &lt;- firstFor (take 1 $ Set.toList $ setW ts) ts\n    ...    \nfirstFor x ts = ts\n</code></pre>\n\n<p>we see that <code>firstFor</code> is simply returning the second argument, so the above actually means</p>\n\n<pre><code>reduce ts \n| (Set.null (setW ts))==False = do\n    tsko &lt;- ts\n    ...\n</code></pre>\n\n<p>To extract <code>tsko</code> from the monadic value <code>ts</code>, we need <code>ts</code> to have a monadic type, and <code>KAutomat</code> is not monadic.</p>\n\n<p>What are you trying to achieve? What is the intended type of <code>reduce</code>?</p>\n\n<p>You might need <code>let tsko = ts</code> instead, or maybe you need to remove all your <code>do</code>s since you are not dealing with any monad, and replacing them with <code>let ... in ...</code> or something similar.</p>\n\n<p>It is very hard to tell from your question. I'd recommend you do not write any code for a function until you have written an explicit type signature for it, e.g.</p>\n\n<pre><code>reduce :: KAutomat -&gt; ....\n\nfirstFor :: ... -&gt; ... -&gt; ...\n</code></pre>\n\n<p>Doing this would usually help GHC to produce better type error messages.</p>\n"}], "owner": {"reputation": 105, "user_id": 7303261, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b07fab98b11443b2c665093dd729a3c7?s=128&d=identicon&r=PG&f=1", "display_name": "user7303261", "link": "https://stackoverflow.com/users/7303261/user7303261"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523970886, "creation_date": 1522343101, "last_edit_date": 1522349360, "question_id": 49561594, "link": "https://stackoverflow.com/questions/49561594/couldnt-match-expected-type-m0", "title": "Couldn&#39;t match expected type `m0 ...&#39;", "body": "<p>Dealing with following error:</p>\n\n<pre><code>Couldn't match expected type `m0 KAutomat'\n            with actual type `KAutomat'\nIn the second argument of `firstFor', namely `ts'\nIn a stmt of a 'do' block:\n  tsko &lt;- firstFor (take 1 $ Set.toList $ setW ts) ts\nIn the expression:\n  do { tsko &lt;- firstFor (take 1 $ Set.toList $ setW ts) ts;\n       reduce tsko }\n</code></pre>\n\n<p>Here is snippet of my code:</p>\n\n<pre><code>reduce ts \n| (Set.null (setW ts))==False = do\n    tsko &lt;- firstFor (take 1 $ Set.toList $ setW ts) ts\n    reduce tsko\n| otherwise = return ts\n\nfirstFor x ts = ts\n</code></pre>\n\n<p><code>ts</code> is of type KAutomat. I believe you don't bigger amount of code. If you do, just tell me.</p>\n\n<p>I've read something about <code>m0</code> stuff and I already know it has something to do with Monads. Though don't know how to fix this. Could you help me? </p>\n\n<p>What I actually try to do is to simulate <code>while</code> cycle with the condition at the begin. I test if the set <code>(setW ts)</code> is empty, if it is not, I take the first item from it and pass it altogether with ts to function <code>firstFor</code>. And again - until set <code>(setW ts)</code> is empty.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1522340642, "post_id": 49560736, "comment_id": 86129726, "body": "What do you mean by &quot;when one field is updated&quot; ? How do you envisage to update one field ?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1522340781, "post_id": 49560736, "comment_id": 86129793, "body": "Typically, you would just have a function <code>numberOfSides :: Shape -&gt; Int</code> or <code>numberOfSides :: MyRecord -&gt; Int</code> rather than storing it explicitly."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522340987, "post_id": 49560736, "comment_id": 86129909, "body": "@St&#233;phaneLaurent, something like in OO, when obj.numberOfSides += 1, the other field could be programatically updated too in case I have to manually update all related fields."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1522341349, "post_id": 49560736, "comment_id": 86130133, "body": "But why is there a related field?  Why not just have a function that operates over the <code>Shape</code> or <code>[Player]</code> and returns the ground truth instead of some cached value?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1522341532, "post_id": 49560736, "comment_id": 86130283, "body": "@osager And in an OO language, you would have a method to update both values simultaneously, rather than expecting a simple assignment to <code>obj.shape</code> to change <code>obj.numberOfSides</code> as well. It&#39;s the same in Haskell: whatever function <code>updateShape :: Shape -&gt; MyRecord -&gt; MyRecord</code> you write would update both the <code>shape</code> and <code>numberOfSides</code> fields in the result."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522341725, "post_id": 49560736, "comment_id": 86130398, "body": "@chepner I just find this error prone. Because quite a number of other &#39;variables&#39; depend on one particular field and I could miss updating some of them. So I&#39;m thinking whether we can leverage the type system, somehow."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1522341809, "post_id": 49560736, "comment_id": 86130450, "body": "If you miss updating them, it&#39;s a compile error. Haskell&#39;s type system is nice like that. Those sorts of things won&#39;t slip through the cracks like they might in another language."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1522341831, "post_id": 49560736, "comment_id": 86130460, "body": "Yes, it is error prone, which is why you write a function that creates <code>MyRecord</code> correctly rather than relying on record syntax like <code>some_value { shape=Rectangle}</code> to magically update <code>numberOfSides</code> for you. Whatever syntax you would write to link them would be just as verbose and error prone as writing a proper update function in the first place."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1522341955, "post_id": 49560736, "comment_id": 86130528, "body": "@chepner Suddently I realized why Haskell is called functional programming: You always create these little functions for your stuff."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 3, "creation_date": 1522341961, "post_id": 49560736, "comment_id": 86130533, "body": "If <code>MyRecord</code> is intended to be a black-box, like an object in OO, then you shouldn&#39;t be exporting its constructor and should be writing a function to do it anyway. This is akin to the factory pattern in OO, and should be used whenever you want to have &quot;private&quot; data in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 2, "last_activity_date": 1522341767, "creation_date": 1522341767, "answer_id": 49561222, "question_id": 49560736, "link": "https://stackoverflow.com/questions/49560736/haskell-record-field-dependency/49561222#49561222", "title": "Haskell Record Field Dependency", "body": "<p>In Haskell, unlike in OO languages, you can't modify a field in place. So the usual approach, which is what I think you're thinking of, of having an explicit \"setter\" doesn't make sense in Haskell. The easiest thing, and this is well in line with the <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"nofollow noreferrer\">DRY principle</a> (which is very relevant in functional languages as well as OO languages), is to only store one of the fields and have the other be an accessor, as mentioned in a comment.</p>\n\n<pre><code>-- deriving (...) clauses and other boilerplate omitted for brevity\n\ndata Shape = Triangle | Quad | Pentagon | Other\n\ndata MyRecord = MyRecord Int\n\nnumSides :: Shape -&gt; Int\nnumSides Triangle = 3\nnumSides Quad = 4\nnumSides Pentagon = 5\nnumSides Other = 0\n\nshape :: Int -&gt; Shape\nshape 3 = Triangle\nshape 4 = Quad\nshape 5 = Pentagon\nshape _ = Other\n\nmakeMyRecord :: Shape -&gt; MyRecord\nmakeMyRecord = MyRecord . numSides\n\nnumberOfSides :: MyRecord -&gt; Int\nnumberOfSides (MyRecord x) = x\n\nshapeOf :: MyRecord -&gt; Shape\nshapeOf = shape . numberOfSides\n</code></pre>\n\n<p>Now, <code>Shape</code> can be <code>Enum</code> and <code>Bounded</code>, if you haven't done that already. From there, <code>shape</code> and <code>numSides</code> can be shortened in terms of the automatically generated <code>Enum</code> instance. If you want to be able to construct <code>MyRecord</code> from <code>Int</code>, you can either export the data constructor or define another <code>makeMyRecord'</code> to do it. And now, since we're using the DRY principle, you can just let users update the field freely and the other \"field\" will magically be updated.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1522520027, "last_edit_date": 1592644375, "creation_date": 1522520027, "answer_id": 49590908, "question_id": 49560736, "link": "https://stackoverflow.com/questions/49560736/haskell-record-field-dependency/49590908#49590908", "title": "Haskell Record Field Dependency", "body": "<blockquote>\n<p>My question is: Those two fields are related. Is there a &quot;trigger&quot; mechanism to update the other when one field is updated? and if the two fields are in conflict then report a type error?</p>\n<p>PS: Is this somehow related to GADT and dependant types?</p>\n</blockquote>\n<p>This is related to dependent types, but not GADTs. Since this is Haskell, I would suggest simply storing the number of sides in the record and then writing a function <code>numTypes :: Int -&gt; Shape</code>.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 49561222, "answer_count": 2, "score": 5, "last_activity_date": 1522520027, "creation_date": 1522340171, "last_edit_date": 1522342210, "question_id": 49560736, "link": "https://stackoverflow.com/questions/49560736/haskell-record-field-dependency", "title": "Haskell Record Field Dependency", "body": "<pre><code>data MyRecord = MyRecord {\n  numberOfSides :: Int,\n  shape :: Shape\n}\n</code></pre>\n\n<p><code>Shape</code> can be Triangle, Quadrilateral etc. depending on <code>numberOfSides</code>.</p>\n\n<p>My question is: Those two fields are related. Is there a \"trigger\" mechanism to update the other when one field is updated? and if the two fields are in conflict then report a type error?</p>\n\n<p>Another related scenario:</p>\n\n<pre><code>data MyRecord = MyRecord {\n  players      :: [Player],\n  numOfPlayers :: Int\n}\n</code></pre>\n\n<p>I want to somehow automatically calculate <code>numberOfPlayers</code> based on the size of <code>players</code>.</p>\n\n<p>PS: Is this somehow related to <strong>GADT</strong> and <strong>dependant types</strong>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1523634642, "post_id": 49559327, "comment_id": 86656769, "body": "I really like countSets1. That said, I get a count of 22 with <code>nub</code> in <code>length $ filter ((==16).sum) . nub $ subsequences [2,4,6,10,1,4,5,6,7,8]</code> and 24 without <code>nub</code>. One repeat is [2,6,1,7] and [2,1,6,7]. I think 22. <code>subsequences</code> and <code>nub</code> are imported from Data.List. <code>nub</code> is a <i>&quot;set&quot;</i> operations function. I like."}], "answers": [{"comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1522337166, "post_id": 49559716, "comment_id": 86127528, "body": "I think need to add <code>go _ 0 = 1</code> in the beginning."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522337248, "post_id": 49559716, "comment_id": 86127582, "body": "solution 2 is me trying to copy solution 3. The logic is that if the list is empty then there can&#39;t be any sub lists that add up to the number. It&#39;s the same as the <code>i &lt; 0</code> check in the the third. If i is less than 0 the third one."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1522337462, "post_id": 49559716, "comment_id": 86127713, "body": "@freestyle yes that fixes the problem.  I thought I covered that case in the <code>| t == 0 = 1</code> part but I guess the order of checks is different in the two solutions I originally wrote..."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1522336852, "creation_date": 1522336852, "answer_id": 49559716, "question_id": 49559327, "link": "https://stackoverflow.com/questions/49559327/haskell-find-subsets-of-list-that-add-up-to-given-number/49559716#49559716", "title": "Haskell: find subsets of list that add up to given number", "body": "<p>I'm not sure about your logic, but in your second solution I think you need</p>\n\n<pre><code>go [] 0 = 1\n</code></pre>\n\n<p>otherwise, your code causes <code>go [] 0 = 0</code> which feels wrong.</p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522337800, "post_id": 49559755, "comment_id": 86127917, "body": "is <code>sublists</code> not O(N&#178;)? I don&#39;t see how this is better than my <code>countSets1</code>. Also, I am trying to work towards a solution that can use memoization."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1522338039, "post_id": 49559755, "comment_id": 86128064, "body": "@matthias I don&#39;t know. I never claimed it is better. It&#39;s just a simple solution thanks to <code>sublists</code>."}], "tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 0, "last_activity_date": 1522337588, "last_edit_date": 1522337588, "creation_date": 1522336957, "answer_id": 49559755, "question_id": 49559327, "link": "https://stackoverflow.com/questions/49559327/haskell-find-subsets-of-list-that-add-up-to-given-number/49559755#49559755", "title": "Haskell: find subsets of list that add up to given number", "body": "<p>I don't treat your error so I don't expect you accept my answer. I only provide a solution:</p>\n\n<pre><code>import           Math.Combinat.Sets (sublists)\n\ngetSublists :: [Int] -&gt; Int -&gt; [[Int]]\ngetSublists list total = filter (\\x -&gt; sum x == total) (sublists list)\n\ncountSublists :: [Int] -&gt; Int -&gt; Int\ncountSublists list total = length $ getSublists list total\n</code></pre>\n\n<p>The module <code>Math.Combinat.Sets</code> is from the <code>combinat</code> package.</p>\n\n<pre><code>&gt;&gt;&gt; countSublists [2,4,6,10,1,4,5,6,7,8] 16\n24\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": false, "score": 0, "last_activity_date": 1522578245, "last_edit_date": 1522578245, "creation_date": 1522481931, "answer_id": 49585458, "question_id": 49559327, "link": "https://stackoverflow.com/questions/49559327/haskell-find-subsets-of-list-that-add-up-to-given-number/49585458#49585458", "title": "Haskell: find subsets of list that add up to given number", "body": "<p>This problem looks similar to <a href=\"https://books.google.co.uk/books?id=ZQJnYoAmw6gC&amp;pg=PA33&amp;lpg=PA33&amp;dq=making+a+century+richard+bird&amp;source=bl&amp;ots=7B8AvHTyvD&amp;sig=7kEEMYGI4t-ZyZCLZ-kgGJMdqDA&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwjihuzx95XaAhWCXMAKHfbJDJ0Q6AEILjAB#v=onepage&amp;q=making%20a%20century%20richard%20bird&amp;f=false\" rel=\"nofollow noreferrer\">a pearl written by Richard Bird</a> on how many sums and products can make 100. I'll use it as a template here. First, the specification:</p>\n\n<pre><code>subseqn :: (Num a, Eq a) =&gt; a -&gt; [a] -&gt; Int\nsubseqn n = length . filter ((== n) . sum) . subseqs\n</code></pre>\n\n<p>where</p>\n\n<pre><code>subseqs = foldr prefix [[]]\nprefix x xss = map (x:) xss ++ xss\n</code></pre>\n\n<p>Observe that a lot of work may be wasted in <code>subseqs</code>. Intuitively, we can discard candidates as soon as they exceed n, i.e. use the weaker predicate <code>(&lt;= n)</code> somewhere. Trivially, filtering on it before filtering on the stronger one does not change the outcome. Then you can derive</p>\n\n<pre><code>filter ((== n) . sum) . subseqs\n= {- insert weaker predicate -}\nfilter ((== n) . sum) . filter ((&lt;= n) . sum) . subseqs\n= {- definition of subseqs -}\nfilter ((== n) . sum) . filter ((&lt;= n) . sum) . foldr prefix [[]]\n= {- fusion law of foldr -}\nfilter ((== n) . sum) . foldr prefix' [[]]\n</code></pre>\n\n<p>The fusion law states that <code>f . foldr g a = foldr h b</code> iff</p>\n\n<ul>\n<li>f is strict</li>\n<li>f a = b</li>\n<li>f (g x y) = h x (f y)</li>\n</ul>\n\n<p>Here, a = b = <code>[[]]</code>, f is <code>filter ((&lt;= n) . sum)</code> and g is <code>prefix</code>.  You can derive h (i.e. <code>prefix'</code>) by observing that the predicate can be applied <em>before</em> prefixing:</p>\n\n<pre><code>filter ((&lt;= n) . sum) (prefix x xss) = \n  filter ((&lt;= n) . sum) (prefix x (filter ((&lt;= n) . sum) xss))\n</code></pre>\n\n<p>which is exactly the third condition; then h is <code>filter ((&lt;= n) . sum) . prefix</code>.</p>\n\n<p>Another observation is that <code>sum</code> is computed too many times. To get around that, we can modify our definition of <code>subseqn</code> so that each candidate carries its own sum. Let's use</p>\n\n<pre><code>(&amp;&amp;&amp;) :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; a -&gt; (b, c)\n(&amp;&amp;&amp;) f g x = (f x, g x)\n</code></pre>\n\n<p>and derive</p>\n\n<pre><code>filter ((== n) . sum) . subseqs\n= {- use &amp;&amp;&amp; -}\nfilter ((== n) . snd) . map (id &amp;&amp;&amp; sum) . subseqs\n= {- definition of subseqs -}\nfilter ((== n) . snd) . map (id &amp;&amp;&amp; sum) . foldr prefix' [[]]\n= {- fusion law of foldr -}\nfilter ((== n) . snd) . foldr prefix'' [[]]\n</code></pre>\n\n<p>I won't go through the whole derivation of <code>prefix''</code>, it is quite long. The gist is that you can avoid using <code>sum</code> at all by working on pairs, so that the sum is computed iteratively. Initially the sum is 0 for the empty list and all we have to do is add the new candidate to it.</p>\n\n<p>We update our base case from <code>[[]]</code> to <code>[([], 0)]</code> and get:</p>\n\n<pre><code>prefix'' x = filter ((&lt;= n) . snd) . uncurry zip . (prefix x *** add x) . unzip\n</code></pre>\n\n<p>where</p>\n\n<pre><code>(***) :: (a -&gt; a') -&gt; (b -&gt; b') -&gt; (a, b) -&gt; (a', b')\n(***) f g (x, y) = (f x, g y)\nadd :: Num a =&gt; a -&gt; [a] -&gt; [a]\nadd x xs = map (x+) xs ++ xs\n</code></pre>\n\n<p>Here is the final version:</p>\n\n<pre><code>subseqn :: (Num a, Ord a) =&gt; a -&gt; [a] -&gt; Int\nsubseqn n = length . filter ((== n) . snd) . foldr expand [([], 0)]\n  where\n  expand x = filter ((&lt;= n) . snd) . uncurry zip . (prefix x *** add x) . unzip\n  prefix x xss = map (x:) xss ++ xss\n  add x xs = map (x+) xs ++ xs\n</code></pre>\n\n<p>(<code>***</code> and <code>&amp;&amp;&amp;</code> are from Control.Arrow)</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 291, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1522578245, "creation_date": 1522335595, "last_edit_date": 1522337595, "question_id": 49559327, "link": "https://stackoverflow.com/questions/49559327/haskell-find-subsets-of-list-that-add-up-to-given-number", "title": "Haskell: find subsets of list that add up to given number", "body": "<p>I am working through some examples and trying to implement a function that counts how many subsets of a list add up to a given number.</p>\n\n<p>In trying to rewrite some implementations in python to Haskell :</p>\n\n<pre><code>test1 :: [Int]\ntest1 = [2,4,6,10,1,4,5,6,7,8]\n\ncountSets1 total input = length [n | n &lt;- subsets $ sort input, sum n == total]\n  where\n    subsets []  = [[]]\n    subsets (x:xs) = map (x:) (subsets xs) ++ subsets xs\n\n\ncountSets2 total input = go (reverse . sort $ input) total\n  where\n    go [] _ = 0\n    go (x:xs) t\n      | t == 0 = 1\n      | t &lt; 0  = 0\n      | t &lt; x  = go xs t\n      | otherwise  = go xs (t - x) + go xs t\n\n\ncountSets3 total input = go (sort input) total (length input - 1)\n  where\n  go xxs t i\n    | t == 0         = 1\n    | t &lt; 0          = 0\n    | i &lt; 0          = 0\n    | t &lt; (xxs !! i) = go xxs t (i-1)\n    | otherwise      = go xxs (t - (xxs !! i)) (i-1) + go xxs t (i-1)\n</code></pre>\n\n<p>I can't figure out why <code>countSets2</code> does not return the same result as <code>countSets3</code> (a copy of the python version)</p>\n\n<pre><code>\u03bb: countSets1 16 test1\n24\n\u03bb: countSets2 16 test1\n13\n\u03bb: countSets3 16 test1\n24\n</code></pre>\n\n<p>EDIT:\n@freestyle pointed out that the order of my conditions was different in the two solutions:</p>\n\n<pre><code>countSets2 total input = go (sortBy (flip compare) input) total\n  where\n    go _  0 = 1\n    go [] _ = 0\n    go (x:xs) t\n      | t &lt; 0  = 0\n      | t &lt; x  = go xs t\n      | otherwise  = go xs (t - x) + go xs t\n</code></pre>\n\n<p>fixes the problem.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1522384822, "post_id": 49558511, "comment_id": 86145129, "body": "Prisms with <code>s = t</code> and <code>a = b</code> can be used as a <code>Review</code> and an arbitrary prism can be used a <code>Setter</code>, so a <code>Prism&#39; s a = Prism s s a a</code> is probably what you&#39;re looking for?"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1522486662, "post_id": 49558511, "comment_id": 86179928, "body": "@theindigamer If it was a <code>Prism</code> then it would allow to fetch items from an <code>IO</code>"}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1522501992, "post_id": 49558511, "comment_id": 86183921, "body": "You&#39;re looking for a weaker alternative, which precisely supports just <code>pure</code> and <code>fmap</code>?"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1522357179, "creation_date": 1522333190, "question_id": 49558511, "link": "https://stackoverflow.com/questions/49558511/lens-optic-for-applicatives-that-can-do-pure-and-fmap", "title": "Lens: Optic for Applicatives that can do pure and fmap?", "body": "<p>Is there an optic that can do this for any <code>Applicative</code>:</p>\n\n<pre><code>-- Can be used as a Review to return into IO\n(theOptic # 5) &gt;&gt;= print\n\n-- Can be used as a Setter to modify items in a list\n[2, 3] &amp; theOptic .~ 6\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code> hierarchy</a> doesn't show anything that is both a <code>Review</code> and a <code>Setter</code>, so I guess it probably doesn't currently exist in lens. Is it possible to create it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1522328734, "post_id": 49556843, "comment_id": 86121178, "body": "What did you try yourself? What did not work?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1522329971, "post_id": 49556843, "comment_id": 86122079, "body": "I make that mistake way more than I should admit..."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 6844501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0c994f13e5a8bed74317307d4f012a4?s=128&d=identicon&r=PG&f=1", "display_name": "Sawyer", "link": "https://stackoverflow.com/users/6844501/sawyer"}, "edited": false, "score": 0, "creation_date": 1522329712, "post_id": 49556939, "comment_id": 86121911, "body": "what if the type of input is [String], like [&quot;hello&quot;,&quot;hi&quot;,&quot;lol&quot;], how to select all different lists?"}, {"owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "reply_to_user": {"reputation": 15, "user_id": 6844501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0c994f13e5a8bed74317307d4f012a4?s=128&d=identicon&r=PG&f=1", "display_name": "Sawyer", "link": "https://stackoverflow.com/users/6844501/sawyer"}, "edited": false, "score": 3, "creation_date": 1522330427, "post_id": 49556939, "comment_id": 86122427, "body": "Did you try it yourself?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 15, "user_id": 6844501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0c994f13e5a8bed74317307d4f012a4?s=128&d=identicon&r=PG&f=1", "display_name": "Sawyer", "link": "https://stackoverflow.com/users/6844501/sawyer"}, "edited": false, "score": 0, "creation_date": 1522331246, "post_id": 49556939, "comment_id": 86123090, "body": "@Sawyer <code>x+y&lt;4</code> makes no sense for strings. To select <b>all</b> combinations, use the function <code>choose</code> as in my answer."}], "tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 2, "last_activity_date": 1522328942, "creation_date": 1522328942, "answer_id": 49556939, "question_id": 49556843, "link": "https://stackoverflow.com/questions/49556843/how-to-list-all-different-2-element-list-in-a-list-in-haskell/49556939#49556939", "title": "How to list all different 2-element list in a list in haskell?", "body": "<p>Use a list comprehension:</p>\n\n<pre><code>input = [1,2,3]\noutput = [ [x,y] | x &lt;- input, y &lt;- input, x &lt; y, x + y &lt; 4]\n\n-- [[1,2]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 1, "last_activity_date": 1522331147, "creation_date": 1522331147, "answer_id": 49557748, "question_id": 49556843, "link": "https://stackoverflow.com/questions/49556843/how-to-list-all-different-2-element-list-in-a-list-in-haskell/49557748#49557748", "title": "How to list all different 2-element list in a list in haskell?", "body": "<p>Here is a function which works for different types:</p>\n\n<pre><code>import           Math.Combinat.Sets (choose)\n\nselect :: Int -&gt; ([a] -&gt; Bool) -&gt; [a] -&gt; [[a]]\nselect k filtering list = filter filtering (choose k list)\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>&gt;&gt;&gt; select 2 (\\x -&gt; sum x &lt; 5) [1,2,3]\n[[1,2],[1,3]]\n&gt;&gt;&gt; select 2 (not . elem \"hello\") [\"hello\", \"how\", \"are\", \"you\"]\n[[\"how\",\"are\"],[\"how\",\"you\"],[\"are\",\"you\"]]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 6844501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0c994f13e5a8bed74317307d4f012a4?s=128&d=identicon&r=PG&f=1", "display_name": "Sawyer", "link": "https://stackoverflow.com/users/6844501/sawyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1522331147, "creation_date": 1522328674, "last_edit_date": 1522328728, "question_id": 49556843, "link": "https://stackoverflow.com/questions/49556843/how-to-list-all-different-2-element-list-in-a-list-in-haskell", "title": "How to list all different 2-element list in a list in haskell?", "body": "<p>For example, I have <code>[1,2,3]</code>, I want to get <code>[[1,2],[1,3],[2,3]]</code>. Besides, in the list, <code>[1,2]</code> and <code>[2,1]</code> are assumed as same so just leave one in the result, and I also want to add a condition, like 'sum of the elements in sub-list is smaller than 4', then the result should be [[1,2]].</p>\n\n<p>Any one knows how to solve this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1522328042, "post_id": 49555481, "comment_id": 86120667, "body": "I can reproduce your error if I type <code>ghc -- make helloworld</code> (note the extra space after the <code>--</code>) instead of <code>ghc --make helloworld</code> (which is how it should be written)."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522338633, "post_id": 49555481, "comment_id": 86128438, "body": "I get `target &#39;helloworld&#39; is not a module name or a source file, if I write that in."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522356035, "post_id": 49555481, "comment_id": 86137559, "body": "What is the name of the file with your code? I suspect it is <code>helloworld.hs</code>, rather than <code>helloworld</code>."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522357325, "post_id": 49555481, "comment_id": 86138172, "body": "Yes, it is <code>helloworld.hs</code>"}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522738415, "post_id": 49569139, "comment_id": 86254808, "body": "It works on my computer - what happens when you try it?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522796138, "post_id": 49569139, "comment_id": 86288145, "body": "@bradm I receive this message: <code>&lt;no location info&gt;: error : can&#39;t find file: helloworld.hs</code>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522800351, "post_id": 49569139, "comment_id": 86289272, "body": "I get that message when I run ghc in a directory which does not contain <code>helloworld.hs</code>. Have you misspelt the name?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522824943, "post_id": 49569139, "comment_id": 86297008, "body": "@bradm no: the file is <code>helloworld.hs</code>"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522880897, "post_id": 49569139, "comment_id": 86332535, "body": "@bradm I haven&#39;t misspelt it"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": -1, "last_activity_date": 1522389255, "creation_date": 1522389255, "answer_id": 49569139, "question_id": 49555481, "link": "https://stackoverflow.com/questions/49555481/compiling-simple-programs-on-haskell-on-windows-using-the-command-line/49569139#49569139", "title": "Compiling simple programs on Haskell on Windows using the command line", "body": "<p>Yes, it is possible to use Windows to compile Haskell programs. In fact, I use Windows for all my Haskell programming! To compile a Haskell program, use <code>ghc --make &lt;program&gt;</code>; for instance, here it would be <code>ghc --make helloworld.hs</code>. Note that there is no space between <code>--</code> and <code>make</code>; including this space gives the error you describe. After running this command, an executable <code>helloworld.exe</code> file is produced.</p>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 272, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1522389255, "creation_date": 1522324814, "last_edit_date": 1522327985, "question_id": 49555481, "link": "https://stackoverflow.com/questions/49555481/compiling-simple-programs-on-haskell-on-windows-using-the-command-line", "title": "Compiling simple programs on Haskell on Windows using the command line", "body": "<p>This is a follow-up to this question, which is about whether it is possible to compile simple programs on Haskell in Windows, without recourse to Cygwin: <a href=\"https://stackoverflow.com/questions/49554792/compiling-haskell-programs-in-windows-is-it-possible-without-downloading-someth/49555201#49555201\">Compiling Haskell programs in Windows: is it possible without downloading something such as Cygwin?</a></p>\n\n<p>For background, I asked this question, since if there were some other way of compiling the program it would be very useful to know, since I am on a university computer and cannot download things like Cygwin without permission. (and even with permission it might not be possible, depending on what Cygwin requires)</p>\n\n<p>Someone responded to my question, suggesting I open the command line and put <code>ghc --make helloworld</code> and hit Enter. However, when I put in <code>ghc --make helloworld</code> and hit Enter this comes up: </p>\n\n<pre><code>ghc: unrecognised flag: -- \ndid you mean one of: \n-D  \n-F \n-H \nUsage: For basic infomration, try the '--help' option\n</code></pre>\n\n<p>The person answering the question suggested I made another question, asking why I received the above message. How can I deal with this problem?</p>\n"}, {"tags": ["haskell", "cygwin"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522324688, "post_id": 49554792, "comment_id": 86118142, "body": "I strongly recommend you to install <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">the Haskell platform</a>. It includes everything needed, and has no dependency. In particular it includes <code>stack</code>, an unavoidable tool for Haskell IMHO."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522324806, "post_id": 49554792, "comment_id": 86118239, "body": "This is going to sound crazy, but how do I determine whether it has been downloaded onto the computer? The university technicians did it (We are not allowed to download things on university computers)"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522324980, "post_id": 49554792, "comment_id": 86118371, "body": "However you say you have downloaded GHCi. So I don&#39;t understand what you say. You mean GHCi has been downloaded by the technicians ?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522325547, "post_id": 49554792, "comment_id": 86118769, "body": "Yes, it was not downloaded by me (It cannot be downloaded by me, but only by them). I&#39;ve been using winGHCi and GHC for a few weeks, and never needed to go to the command line."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522325689, "post_id": 49554792, "comment_id": 86118871, "body": "Ok, so maybe they have installed <code>stack</code> as well. Type <code>stack --version</code> in a terminal to check."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522325853, "post_id": 49554792, "comment_id": 86118982, "body": "I typed <code>stack --version</code> into the command line of the Windows computer and I received <code>&#39;stack&#39; is not recognized as an internal or external command, operable program or batch file.</code> So is this proof that the technicians didn&#39;t download the whole Haskell Platform? I didn&#39;t even know you could download just winGHCi and GHCi"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522326152, "post_id": 49554792, "comment_id": 86119208, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/167813/discussion-between-user65526-and-stephane-laurent\">continue this discussion in chat</a>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1522326154, "post_id": 49554792, "comment_id": 86119211, "body": "Yes, <code>stack</code> is included in the Haskell platform so they have not downloaded it <i>or</i> they choosed not to install <code>stack</code> during the installation (it&#39;s  optional). Sad. Note that you can install Haskell platform in &quot;portable mode&quot;, so you can put it on a USB key I think."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1522326660, "post_id": 49554792, "comment_id": 86119618, "body": "As stack was mentioned, I&#39;d say it alone is enough. It can download needd stuff itself, and, by my opinion it is the preferable way to use it."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522326727, "post_id": 49554792, "comment_id": 86119682, "body": "Unfortunately, I&#39;m going to be stackless until the technicians come back after the Easter holiday!"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522326796, "post_id": 49554792, "comment_id": 86119731, "body": "St&#233;phane Laurent suggested downloading the whole Haskell Platform onto a windows computer, and then putting it on a USB and using Haskell in this way. Perhaps this might solve my problem"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1522327180, "post_id": 49554792, "comment_id": 86120048, "body": "You don&#39;t really need Haskell platform while learning the basics. GHC and GHCi are enough."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522327296, "post_id": 49554792, "comment_id": 86120131, "body": "Ok, so would you suggest that in the chapter on I/O actions in the book &quot;Lear you a Haskell for a great good&quot;, I just ignore all the bits that require compiling, and keep going on? When will it be really necessary to be able to compile haskell files, in the way I currently can&#39;t?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1522327886, "post_id": 49554792, "comment_id": 86120551, "body": "Sorry for insisting on this point, but do you <i>literally</i> mean you aren&#39;t allowed to <i>download</i> files (which sounds a bit extreme -- aren&#39;t you allowed to, say, download a PDF file from the internet), or is the restriction that you can&#39;t <i>install</i> software?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1522332162, "post_id": 49554792, "comment_id": 86123894, "body": "You can do everything from ghci and ignore compiling (except perhaps in some advanced cases well beyond the LYAH book). But it isn&#39;t clear why you want to. If you have tried to compile something and got an error, just ask about it."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522338807, "post_id": 49554792, "comment_id": 86128563, "body": "ad duplode&#39;s comment: I am allowed to download pdfs, but not install things like the Haskell Platform. To do that I require an administrator account and password."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522338877, "post_id": 49554792, "comment_id": 86128606, "body": "ad n.m&#39;s comment: compiling is used in chapter 8. the first simple example is discussed there: <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">learnyouahaskell.com/input-and-output</a>"}], "answers": [{"comments": [{"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522324124, "post_id": 49555201, "comment_id": 86117763, "body": "When I put in <code>ghc --make helloworld</code> and hit Enter this comes up:   <code>ghc: unrecognised flag: -- did you mean one of: -D  -F -H Usage: For basic infomration, try the &#39;--help&#39; option</code>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 1, "creation_date": 1522324310, "post_id": 49555201, "comment_id": 86117892, "body": "@user65526 That&#39;s a different question :) You may have more luck adding a new question, because off the top of my head, I don&#39;t know the answer to that."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1522323880, "creation_date": 1522323880, "answer_id": 49555201, "question_id": 49554792, "link": "https://stackoverflow.com/questions/49554792/compiling-haskell-programs-in-windows-is-it-possible-without-downloading-someth/49555201#49555201", "title": "Compiling Haskell programs in Windows: is it possible without downloading something such as Cygwin?", "body": "<p>In many Unix and Linux shells (at least in Bash with which I'm most familiar) the default prompt is <code>$</code>. That's what the shell displays.</p>\n\n<p>On Windows, when you open a Command Prompt, you'll typically see something like this instead:</p>\n\n<pre><code>C:\\Users\\mark&gt;\n</code></pre>\n\n<p>(That's my prompt.)</p>\n\n<p>While instructions often include the <code>$</code> prompt in order to indicate that the code is something that you're expected to enter at a command prompt, you're not expected to type the <code>$</code>. Just type <code>ghc --make helloworld</code> and hit <em>Enter</em>.</p>\n\n<p>Also, you're not expected to do this from within GHCi, but from the command line. <code>ghc</code> is a command-line executable (an <code>.exe</code>), just like e.g. <code>git</code>. It has to be in your <code>path</code>, though, or otherwise, you'll have to type the full path the executable every time you want to run it.</p>\n"}, {"comments": [{"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522325705, "post_id": 49555699, "comment_id": 86118877, "body": "How can I determine whether the whole Haskell Platform has been downloaded onto the computer (I did not download it, the technicians at my university did)?"}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522326445, "post_id": 49555699, "comment_id": 86119438, "body": "sorry, I don&#39;t know. I would say if you have not downloaded it from <a href=\"https://www.haskell.org/platform/#windows\" rel=\"nofollow noreferrer\">haskell.org/platform/#windows</a>  and installed then probably you don&#39;t have it."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522326562, "post_id": 49555699, "comment_id": 86119529, "body": "I discovered I don&#39;t have <code>stack</code>, by entering <code>stack --version</code> into the command line, which resulted in <code>&#39;stack&#39; is not recognized as an internal or external command, operable program or batch file.</code>. So the technicians of my university who installed winGHCi and GHCi on the computer did not install the full Haskell Platform."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522326825, "post_id": 49555699, "comment_id": 86119752, "body": "it is a must for production use, but as I said for learning ghci should be enough"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1522339018, "post_id": 49555699, "comment_id": 86128695, "body": "I chose the strategy of just <code>:l helloworld</code> and forgetting about trying to compile as suggested in the book. I&#39;m hoping it won&#39;t matter for the purposes of getting through the next chapter or so."}], "tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": false, "score": 1, "last_activity_date": 1522326954, "last_edit_date": 1522326954, "creation_date": 1522325456, "answer_id": 49555699, "question_id": 49554792, "link": "https://stackoverflow.com/questions/49554792/compiling-haskell-programs-in-windows-is-it-possible-without-downloading-someth/49555699#49555699", "title": "Compiling Haskell programs in Windows: is it possible without downloading something such as Cygwin?", "body": "<p>You have downloaded ghc<strong>i</strong>, which is interpreter. It is, by my opinion, totally enough to learn with it (it can <code>:load</code> sources as well), but you need to run a bit other commands. I don't know if your installation include compiler, I would not assume anything about it.</p>\n\n<p>btw, you are typing command inside the interpreter already, the error message is specific for that</p>\n\n<p>ps: to do same as \"ghc --make\" from the interpreter, run:</p>\n\n<pre><code>:load &lt;file&gt;\n</code></pre>\n\n<p>Yes, it will recurse to depenzecies automatically. You could use :help to learn other commands</p>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1522327397, "creation_date": 1522322459, "last_edit_date": 1592644375, "question_id": 49554792, "link": "https://stackoverflow.com/questions/49554792/compiling-haskell-programs-in-windows-is-it-possible-without-downloading-someth", "title": "Compiling Haskell programs in Windows: is it possible without downloading something such as Cygwin?", "body": "<p>I am reading &quot;Learn you a Haskell for great good&quot;, and have reached the chapter on I/O actions. I am using Windows, and have downloaded GHCi and WinGHCi.</p>\n<p>I'm trying to compile a simple program and have saved a file on emacs as <code>helloworld.hs</code> with <code>main = putStrLn &quot;hello, world&quot;</code> in it.</p>\n<p>The book says</p>\n<blockquote>\n<p>Open your terminal, navigate to the directory where <code>helloworld.hs</code> is located, and enter the following:</p>\n<pre><code>$ ghc --make helloworld\n</code></pre>\n</blockquote>\n<p>However, if I enter <code>$ ghc --make helloworld</code> onto GHCi and WinGHCi I receive errors such as the one below, perhaps because I need to enter <code>$ ghc --make helloworld</code> elsewhere:</p>\n<pre><code>&lt;interactive&gt;:7:1: error:\n    parse error on input \u2018$\u2019\n    Perhaps you intended to use TemplateHaskell\n</code></pre>\n<p>In fact, in the online edition of the book (here: <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/input-and-output</a>), the author remarks that:</p>\n<blockquote>\n<p>For the purposes of this chapter, I'm going to assume you're using a unix-y environment for learning Haskell. If you're in Windows, I'd suggest you download Cygwin, which is a Linux-like environment for Windows, A.K.A. just what you need.</p>\n</blockquote>\n<p><em><strong>Question 1</strong></em>: Is it necessary for me to download Cygwin, or some other such thing, in order to be able to compile the program by entering <code>$ ghc --make helloworld</code>?</p>\n<p>I ask this, since if there were some other way of compiling the program it would be very useful to know, since I am on a university computer and cannot download things like Cygwin without permission. (and even with permission it might not be possible, depending on what Cygwin requires)</p>\n<p><em><strong>Question 2</strong></em>: Given that only the technicians of my university are away for Easter, and only they can download things on this computer, how can I proceed with the chapter in I/O actions? Is it possible just to continue, but ignore the sections involving compiling programs?</p>\n"}, {"tags": ["windows", "haskell", "visual-studio-code", "haskell-stack", "haskero"], "answers": [{"comments": [{"owner": {"reputation": 900, "user_id": 2056222, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jJ1AL.png?s=128&g=1", "display_name": "python_kaa", "link": "https://stackoverflow.com/users/2056222/python-kaa"}, "edited": false, "score": 0, "creation_date": 1522320414, "post_id": 49553675, "comment_id": 86115288, "body": "Thanks, works for me too! Not sure about last part - <code>Haskero</code> highlighting an error on <code>import</code>. Should I do install turtle somehow or is it pure <code>Haskero</code> issue not working correctly in this case?"}, {"owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "reply_to_user": {"reputation": 900, "user_id": 2056222, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jJ1AL.png?s=128&g=1", "display_name": "python_kaa", "link": "https://stackoverflow.com/users/2056222/python-kaa"}, "edited": false, "score": 0, "creation_date": 1522321250, "post_id": 49553675, "comment_id": 86115851, "body": "I&#39;m not sure if stack scripts are supported in various IDEs. In intero (Emacs) I also get a red curly. If you want proper IDE support you might want to use a proper stack / cabal project."}], "tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": true, "score": 3, "last_activity_date": 1522319083, "creation_date": 1522319083, "answer_id": 49553675, "question_id": 49553241, "link": "https://stackoverflow.com/questions/49553241/file-name-does-not-match-module-name/49553675#49553675", "title": "File name does not match module name", "body": "<p>Apparently you need to give the script a different name as the module name in which the code runs, will automatically be derived from it and now it will conflict with the imported <code>Turtle</code> module. Renaming it to <code>turtlescript.hs</code> and then</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-11.2 script --package turtle\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle\n\nmain :: IO ()\nmain = echo \"Hello!\"\n</code></pre>\n\n<p>worked for me.</p>\n"}], "owner": {"reputation": 900, "user_id": 2056222, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jJ1AL.png?s=128&g=1", "display_name": "python_kaa", "link": "https://stackoverflow.com/users/2056222/python-kaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "accepted_answer_id": 49553675, "answer_count": 1, "score": 1, "last_activity_date": 1522319083, "creation_date": 1522317818, "question_id": 49553241, "link": "https://stackoverflow.com/questions/49553241/file-name-does-not-match-module-name", "title": "File name does not match module name", "body": "<p>Newbie playing with <a href=\"https://haskell-lang.org/tutorial/stack-script\" rel=\"nofollow noreferrer\">haskell stack scripting</a> and <a href=\"https://hackage.haskell.org/package/turtle-1.5.7/docs/Turtle-Tutorial.html\" rel=\"nofollow noreferrer\">turtle</a>. </p>\n\n<ul>\n<li>Created a folder <code>stack-scripts</code>. Thought if it looks good, then I'll create some haskell utils for me to replace bash scripts.</li>\n<li><p>Created a file named <code>turtle.hs</code> with following text:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>#!/usr/bin/env stack\n-- stack --resolver lts-11.2 script\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Turtle\n\nmain = echo \"Hello!\"\n</code></pre></li>\n<li><p>made the <code>chmod +x turtle.hs</code> and tried to execute it. </p></li>\n<li><p>Got the following error message:</p>\n\n<pre><code>turtle.hs:1:1: error:\n    File name does not match module name:\n    Saw: `Main'\n    Expected: `Turtle'\n  |\n1 | #!/usr/bin/env stack\n  | ^\n</code></pre></li>\n</ul>\n\n<p>It does what it should if I rename <code>turtle.hs</code> to <code>turtle.sh</code>. But then I have no syntax highlighting for haskell.</p>\n\n<p>Also it works if I rename it to <code>something-other.hs</code>. But then Haskero (VSCode) complains about <code>import Turtle</code> line: <code>Couldn't guess that module name. Does it exist?</code></p>\n\n<p>What I'm missing here? Running in git bash on Windows.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1522309315, "post_id": 49550507, "comment_id": 86108173, "body": "I do not really get what this has to do with lenses, you can define a function that tests if all the statusses are black."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1522320178, "last_edit_date": 1522320178, "creation_date": 1522318182, "answer_id": 49553366, "question_id": 49550507, "link": "https://stackoverflow.com/questions/49550507/haskell-lens-how-to-elegantly-test-list-item/49553366#49553366", "title": "Haskell Lens: How to elegantly test list item", "body": "<p>The module <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Fold</code></a> has many combinators for testing targets of lenses/folds/traversals: <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html#v:has\" rel=\"nofollow noreferrer\"><code>has</code></a> (useful for checking that a prism matches), <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html#v:anyOf\" rel=\"nofollow noreferrer\"><code>anyOf</code></a>, <code>noneOf</code>, <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html#v:allOf\" rel=\"nofollow noreferrer\"><code>allOf</code></a>...</p>\n\n<p>In your example (assuming we have also <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-TH.html#v:makePrisms\" rel=\"nofollow noreferrer\">generated the prisms</a> for <code>CardStatus</code>) we could do something like:</p>\n\n<pre><code>endGame :: Game -&gt; Bool\nendGame = anyOf (players.folded) (allOf (cards.folded.status) (has _Back))\n</code></pre>\n\n<p>Also, to find <em>which</em> players have winning hands, we could use <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html#v:filtered\" rel=\"nofollow noreferrer\"><code>filtered</code></a>:</p>\n\n<pre><code>winners :: Fold Game Player\nwinners = players.folded.filtered (allOf (cards.folded.status) (has _Back))\n</code></pre>\n\n<p>These functions are analogous to typical list functions, but can be applied directly to folds, so they don't yank you out as much of the lensy world. For example, we could go on composing <code>winners</code> with another <code>Fold</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1522322495, "post_id": 49553490, "comment_id": 86116715, "body": "Thanks for showing the thought process. You&#39;ve just shown me a bunch of new stuff to learn."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1522319291, "last_edit_date": 1522319291, "creation_date": 1522318561, "answer_id": 49553490, "question_id": 49550507, "link": "https://stackoverflow.com/questions/49550507/haskell-lens-how-to-elegantly-test-list-item/49553490#49553490", "title": "Haskell Lens: How to elegantly test list item", "body": "<p>So you want an optic that tells you if all cards are <code>Back</code>. Morally</p>\n\n<pre><code>allBack :: Getter Player Bool\n</code></pre>\n\n<p>This would clearly be something of the form</p>\n\n<pre><code>allBack = cards . _\n</code></pre>\n\n<p>...don't even go any further, ask GHC if that makes any sense at all:</p>\n\n<pre><code>$ ghc wtmpf-file11136.hs\nwtmpf-file11136.hs:26:19: error:\n    \u2022 Found hole: _ :: (Bool -&gt; f Bool) -&gt; [Card] -&gt; f [Card]\n</code></pre>\n\n<p>ok, sounds sensible enough. That signature looks suspiciously of good old</p>\n\n<pre><code><a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Data-Traversable.html#v:traverse\" rel=\"nofollow noreferrer\">traverse</a> :: (a -> f b) -> [a] -> f [b]</code></pre>\n\n<p>...which is indeed pretty much the archetype of the whole Van Laarhoven lens formalism, and very often useful when building actual lens composition chains. Clearly, we still need to focus in more, but first this:</p>\n\n<pre><code>allBack = cards . traverse . _\n</code></pre>\n\n<p>giving</p>\n\n<pre><code>wtmpf-file11136.hs:26:19: error:\n    \u2022 Could not deduce (Applicative f) arising from a use of \u2018traverse\u2019\n       ...\n\nwtmpf-file11136.hs:26:30: error:\n    \u2022 Found hole: _ :: (Bool -&gt; f Bool) -&gt; Card -&gt; f Card\n</code></pre>\n\n<p>Ok, the problem here is that a <code>Getter</code> is supposed to immediately focus in on a single element. But actually, we first need to go over multiple elements to condense (<em>fold</em>) to a single <code>Bool</code>. That means we need to change the signature from <code>Getter</code> to <code>Fold</code> (which under the hood provides the <code>Applicative</code> constraint):</p>\n\n<pre><code>allBack :: Fold Player Bool\nallBack = cards . traverse . _\n</code></pre>\n\n<pre><code>    \u2022 Found hole: _ :: (Bool -> f Bool) -> Card -> f Card\n        ...\n    \u2022 No instance for (Monoid Bool) arising from a use of \u2018allBack\u2019</code></pre>\n\n<p>Ok, that makes sense \u2013 we specified that we want to somehow reduce over the list, but there is more than one way to reduce bools over a list. In our case, we want them <em>all to be true</em>, i.e. we need to switch from <code>Bool</code> to the <a href=\"http://hackage.haskell.org/package/base-4.11.0.0/docs/Data-Monoid.html#t:All\" rel=\"nofollow noreferrer\"><code>All</code> monoid</a>:</p>\n\n<pre><code>import Data.Monoid (All(..))\n\nallBack :: Fold Player All\nallBack = cards . traverse . _\n</code></pre>\n\n<pre><code>wtmpf-file11136.hs:26:30: error:\n    \u2022 Found hole: _ :: (All -> f All) -> Card -> f Card\n</code></pre>\n\n<p>Ok, that looks good. Now we need to specify <em>what property of a card</em> we want to check. Well, something about its status:</p>\n\n<pre><code>allBack = cards . traverse . status . _\n</code></pre>\n\n<pre><code>    \u2022 Found hole: _ :: (All -> f All) -> CardStatus -> f CardStatus</code></pre>\n\n<p>At this point we now need a decision, i.e. we need to toss in a <em>prism</em>. One might think it's the <code>_Back</code> prism, but actually that represents the \u201cboring\u201d case. The case where we want to trigger a failure is <code>_Face</code>:</p>\n\n<pre><code>allBack = cards . traverse . status . _Face . _\n</code></pre>\n\n<pre><code>    \u2022 Found hole: _ :: (All -> f All) -> () -> f ()</code></pre>\n\n<p>Here, all that remains to be done is announcing that this <code>_Face</code> is a failure case:</p>\n\n<pre><code>allBack = cards . traverse . status . _Face . like (All False)\n</code></pre>\n\n<p>That works, though as Willem Van Onsem commented going purely lens is not really optimal here. Just writing this as a <em>function</em> is more sensible, <a href=\"https://stackoverflow.com/a/49553366/745903\">danidiaz' suggestion</a> strikes a good balance.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 2, "accepted_answer_id": 49553366, "answer_count": 2, "score": 1, "last_activity_date": 1522320178, "creation_date": 1522309203, "last_edit_date": 1522318765, "question_id": 49550507, "link": "https://stackoverflow.com/questions/49550507/haskell-lens-how-to-elegantly-test-list-item", "title": "Haskell Lens: How to elegantly test list item", "body": "<pre><code>data Game = Game {\n _players :: [Player]\n}\n\ndata Player = Player {\n _cards :: [Card]\n}\n\ndata Card = Card {\n _status :: CardStatus\n}\n\ndata CardStatus = Face | Back\n</code></pre>\n\n<p>Then I <code>makeLenses</code> on the above data types.</p>\n\n<p>The game quit condition is that all the cards in a player's hand are Back.\nSo in my Game StateT monad, I access all the CardStatus and test them. Since I am new to Lens I'm wondering what's the elegant way to write this.\nA little bit lost in the forest of Lens operators.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 2, "creation_date": 1522290759, "post_id": 49547008, "comment_id": 86101612, "body": "You want <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:cycle\" rel=\"nofollow noreferrer\"><code>cycle</code></a> instead of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:repeat\" rel=\"nofollow noreferrer\"><code>repeat</code></a>."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1522290938, "post_id": 49547008, "comment_id": 86101650, "body": "You can pattern match on the tuple <code>[ f a | (f, a) &lt;- zip (cycle [f1, f2]) [1..4]  ]</code> or use <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/Data-List.html#v:zipWith\" rel=\"nofollow noreferrer\"><code>zipWith ($)</code></a>: <code>zipWith ($) (cycle [f1,f1]) [1..4]</code>"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1522291158, "post_id": 49547008, "comment_id": 86101714, "body": "<code>zipWith ($)</code> = <code>zipWith id</code>. What this is describing is the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"nofollow noreferrer\"><code>Applicative</code> operator <code>(&lt;*&gt;)</code></a> for <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>ZipList</code></a>: <code>ZipList (cycle [f1, f2]) &lt;*&gt; ZipList [1..4]</code>"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1522292764, "post_id": 49547008, "comment_id": 86102101, "body": "Just realized, the problem was not with (snd p) (fst p), but with missing conact.:  [ (snd p) (fst p)  | p &lt;- zip [1,2,3,4] (concat(repeat [f1, f2])) ]."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1522291148, "creation_date": 1522291148, "answer_id": 49547151, "question_id": 49547008, "link": "https://stackoverflow.com/questions/49547008/haskell-invoke-function-from-a-pair/49547151#49547151", "title": "Haskell - Invoke function from a pair", "body": "<p>You want to use <code>cycle</code> and <code>zipWith</code>:</p>\n\n<pre><code>zipWith id (cycle [f1, f2]) [1..4]\n</code></pre>\n\n<p><code>cycle</code> makes a finite list infinite by, well, <code>cycle</code>ing it:</p>\n\n<pre><code>cycle [f1, f2] = [f1, f2, f1, f2, f1, f2, f1, f2, ...]\n-- it is equivalent to (but is not implemented by)\ncycle = concat . repeat\n-- repeat :: a -&gt; [a]; repeats a single element forever\n-- concat :: [[a]] -&gt; [a]; concatenates all the lists together\n-- concat . repeat :: [a] -&gt; [a]; concatenates infinitely many copies of the input\n-- this forms a (inefficient) cycle\n</code></pre>\n\n<p><code>zipWith id</code> takes a list of functions and a list of arguments and applies them pairwise:</p>\n\n<pre><code>zipWith id [f1, f2, f1, f2, ...]\n           [1 , 2 , 3 , 4 ]\n  = [id f1 1, id f2 2, id f1 3, id f2 4]\n  = [f1 1, f2 2, f1 3, f2 4]\n</code></pre>\n\n<p>Note that <code>($) = id</code> (just a more restricted type), so you can also write <code>zipWith ($)</code>.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "closed_date": 1522291494, "accepted_answer_id": 49547151, "answer_count": 1, "score": 1, "last_activity_date": 1522294449, "creation_date": 1522290001, "last_edit_date": 1522294449, "question_id": 49547008, "link": "https://stackoverflow.com/questions/49547008/haskell-invoke-function-from-a-pair", "closed_reason": "Duplicate", "title": "Haskell - Invoke function from a pair", "body": "<p>If f1 and f2 are two functions, I want to be able to invoke f1 and f2 alternatively on a list. I came up with following:</p>\n\n<pre><code>[ ((snd p) (fst p))  | p &lt;- zip [1,2,3,4] (repeat [f1, f2])]\n</code></pre>\n\n<p>The above does not work:</p>\n\n<pre><code>Couldn't match expected type \u2018Integer -&gt; t\u2019\n                  with actual type \u2018[Integer -&gt; Integer]\u2019\n    \u2022 The function \u2018snd\u2019 is applied to two arguments,\n</code></pre>\n\n<p>How do I apply function which is evaluated as second of the pair?</p>\n\n<p>Update:\nApplying the function was right, as pointed out in the answers and comments. The problem was with: <code>zip [1,2,3,4] (repeat [f1, f2])</code></p>\n"}]