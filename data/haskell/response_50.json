[{"tags": ["string", "haskell", "io"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1450910002, "post_id": 34443144, "comment_id": 56631331, "body": "Why are you trying to overwrite <code>singlewords</code>? Remember: <b>Haskell does not allow mutable variables</b>."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1450994467, "post_id": 34443144, "comment_id": 56658513, "body": "That was not my tention. When i wrote like that the scope of the variables are like in Java or C++ like declaring an int and initializing it in a loop for example. But appearently that is not the case with Haskell."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 0, "creation_date": 1452695926, "post_id": 34443144, "comment_id": 57283678, "body": "Please <a href=\"https://github.com/nh2/haskell-ordnub#dont-use-nub\" rel=\"nofollow noreferrer\">don&#39;t use <code>nub</code></a>."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1452760068, "post_id": 34443144, "comment_id": 57313468, "body": "i know its like a nightmare :)"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450904141, "post_id": 34443490, "comment_id": 56628856, "body": "That was very lightning for me, thank you so much. But may i ask how can i see the output for this from the command line? How will i see all the words without duplicates?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450904956, "post_id": 34443490, "comment_id": 56629222, "body": "Oh of course! Awesome! Let me ask one last thing. Do you think the nub in here works correctly? Is my implementation doing the right thing? What are your comments? I would be very happy to hear. Thank you!"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450905256, "post_id": 34443490, "comment_id": 56629335, "body": "I do not know exactly what you are trying to do. If you&#39;re trying to remove all occurrences but the first of all words it does the job (it is probably not the most efficient in time and memory consumption)."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450905404, "post_id": 34443490, "comment_id": 56629393, "body": "Yes that is my aim and yes it is like taking forever. Do you have any other suggestion for faster processing?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 1, "creation_date": 1450905759, "post_id": 34443490, "comment_id": 56629524, "body": "If the files has many words <code>nub</code> is very slow (O(n^2)) and the whole file is kept in memory. The fast way to do this might be reading the file as a stream of words and storing only the first occurrence of a word. That is much more advanced Haskell but possible libraries are <a href=\"https://hackage.haskell.org/package/pipes-4.1.7/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">Pipes</a> or <a href=\"https://www.fpcomplete.com/user/snoyberg/library-documentation/conduit-overview\" rel=\"nofollow noreferrer\">Conduit</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451164066, "post_id": 34443490, "comment_id": 56692056, "body": "How can i get the length in this case? I try print . length . singlewords but getting an error. Can you please help me?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451166227, "post_id": 34443490, "comment_id": 56692620, "body": "<code>.</code> is function composition, you want <code>print (length singlewords)</code>."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 7, "last_activity_date": 1450904376, "last_edit_date": 1450904376, "creation_date": 1450903729, "answer_id": 34443490, "question_id": 34443144, "link": "https://stackoverflow.com/questions/34443144/remove-duplicates-in-a-text-file-in-haskell/34443490#34443490", "title": "remove duplicates in a text file in haskell", "body": "<p>Your code fixed:</p>\n\n<pre><code>import Data.List\n\nmain = do\n    -- let singlewords = [] -- this line removed\n    content &lt;- readFile \"/tmp/foo.txt\"\n    let singlewords = words content -- added the let keyword\n    return (nub singlewords) -- added call to return\n</code></pre>\n\n<p>On the first line you write <code>let singlewords = []</code> and then later try to assign a new value to <code>singlewords</code>. This is not how we do it in Haskell, there is no need to \"declare\" or \"define\" names before we use them.</p>\n\n<p>In Haskell we separate effectful computations (<code>IO</code> is one type of effectful computations) from pure computations. We bind results of effectful computations using</p>\n\n<pre><code>name &lt;- computation\n</code></pre>\n\n<p>and we bind results of pure computations using </p>\n\n<pre><code>let name = computation\n</code></pre>\n\n<p>when in a <code>do</code>-block.</p>\n\n<p>The last line in a <code>do</code>-block is what the whole block will compute, and must therefore be an effectful computation. In you example you want to return the result of a pure computation and must therefore lift the result to an effectful one, we do that using <code>return</code>.</p>\n\n<hr>\n\n<p>To see your single words you want to output them to the console, there are a couple of functions to do so: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#g:27\">https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#g:27</a>. </p>\n\n<p>The simplest would be to output the list <code>singlewords</code> using <code>print</code>:</p>\n\n<pre><code>main = do\n    content &lt;- readFile \"/tmp/foo.txt\"\n    let singlewords = nub (words content)\n    print singlewords\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 34443490, "answer_count": 1, "score": 3, "last_activity_date": 1450904376, "creation_date": 1450902199, "question_id": 34443144, "link": "https://stackoverflow.com/questions/34443144/remove-duplicates-in-a-text-file-in-haskell", "title": "remove duplicates in a text file in haskell", "body": "<p>I am trying to <strong>remove the duplicates from a text file</strong> and i tried a code like following;</p>\n\n<pre><code>import Data.List\nmain = do  \n    let singlewords = []\n    handle &lt;- readFile \"/tmp/foo.txt\" \n    singlewords = words handle\n    nub singlewords\n</code></pre>\n\n<p>It gives an error of course since i am very new to haskell and i've been making some exercises but still i think i have some more time to get used to that. I would really be very appreciated for your help. </p>\n"}, {"tags": ["shell", "haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1450895996, "post_id": 34441663, "comment_id": 56625090, "body": "You might like to look into Oleg&#39;s <a href=\"http://okmij.org/ftp/continuations/zipper.html#zipper-fs\" rel=\"nofollow noreferrer\">zipperfs</a>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1450900009, "post_id": 34441663, "comment_id": 56627015, "body": "You may want to use codereview.stackexchange.com for these sort of questions"}, {"owner": {"reputation": 2051, "user_id": 3626537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1499840559/picture?type=large", "display_name": "Phrancis", "link": "https://stackoverflow.com/users/3626537/phrancis"}, "edited": false, "score": 0, "creation_date": 1450901754, "post_id": 34441663, "comment_id": 56627811, "body": "It sounds like the author of this question is asking about ways to make the code do something different, which would be off-topic for Code Review. See <a href=\"http://meta.codereview.stackexchange.com/a/5778/42632\">A guide to Code Review for Stack Overflow users</a> for more details about what is on-topic for Code Review."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1450904473, "post_id": 34441663, "comment_id": 56628989, "body": "This is the sort of broad question that isn&#39;t a good fit for StackOverflow. Apart from the Code Review site, you might also get better results and more discussion if you post this to the <a href=\"http://haskell.reddit.com\" rel=\"nofollow noreferrer\">Haskell subreddit</a> or the @haskell-cafe mailing list."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1450909225, "post_id": 34441663, "comment_id": 56631033, "body": "I don&#39;t think this is a code review question, I think it is more along the lines of &quot;how do I model this in Haskell?&quot;. One commonly used approach is define a <a href=\"https://wiki.haskell.org/Embedded_domain_specific_language\" rel=\"nofollow noreferrer\">DSL</a> often in the form of some Monad. Here you can use something like <code>StateT DirState (EitherT String IO)</code>."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1450973840, "post_id": 34441663, "comment_id": 56652475, "body": "I&#39;m sorry, Filip, that is a braindead &quot;on hold&quot; reason (you didn&#39;t ask anyone to recommend a book, tool, software library, tutorial, or off-site resource!), and actually your question on-topic, &quot;how do I model a changing directory structure in Haskell&quot;? The easiest way is, just use one big <code>Map Path FSEntry</code> with <code>data FSEntry = Dir | File ByteString</code> or so, and let the <code>Data.Map</code> crew optimize for you. If you don&#39;t like that, by all means use a zipper or some other trie with fingers into it. <a href=\"http://erikdemaine.org/papers/ConfluentTries_SWAT2008/paper.pdf\" rel=\"nofollow noreferrer\">(Overkill here.)</a>"}, {"owner": {"reputation": 7044, "user_id": 667820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wl7er.png?s=128&g=1", "display_name": "Henk Langeveld", "link": "https://stackoverflow.com/users/667820/henk-langeveld"}, "edited": false, "score": 0, "creation_date": 1454442476, "post_id": 34441663, "comment_id": 58043309, "body": "I wonder if the [shell] tag is appropriate - after all, this is a question about Haskell."}], "owner": {"reputation": 2379, "user_id": 5045375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17ed0af705e0449fe49b74d8814a8ce2?s=128&d=identicon&r=PG", "display_name": "Filip Allberg", "link": "https://stackoverflow.com/users/5045375/filip-allberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "closed_date": 1472065331, "answer_count": 0, "score": 7, "last_activity_date": 1454441396, "creation_date": 1450895375, "last_edit_date": 1454441396, "question_id": 34441663, "link": "https://stackoverflow.com/questions/34441663/design-help-modelling-a-shell-experience-in-haskell", "closed_reason": "Opinion-based", "title": "Design help: Modelling a shell experience in Haskell", "body": "<p>I am trying to make a virtual shell experience using Haskell. What I mean by this is that I mean to create a program, that when executed from a terminal window, drops you into an environment that allows you to execute a subset of familiar commands (for instance, <code>cd</code> and <code>mkdir</code>) among others.</p>\n\n<p>The filesystem will be entirely virtual, as in it does not touch anything on disk.</p>\n\n<p>My initial sketch (below) feels clunky, so much in fact that composing an MWE was a drag, I am very unaccustomed to representing datastructures functionally and would like to get some pointers on how to turn this experience around. Any reference programs with available source code would be helpful as would any tips or lines of thinking.</p>\n\n<p>I have written the following</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Map as Map\nimport qualified Data.Either as Either\n\ntype Name = String\ntype Content = String\ntype Error = String\n\ndata DiskEntry = File Name Content\n               | Directory {name :: Name\n                 , entries :: Map.Map String DiskEntry\n                 } deriving (Show)\n\n\n-- | The 'mkdir' function creates a new directory inside the given\n-- directory.  Attempts to create a 'DiskEntry' with the name 'name'\n-- inside the given 'directory'. If an entry with that name already\n-- exists an error is returned. If such an entry does not exist\n-- then it is added to the destination 'DiskEntry' and is returned\n-- as part of a tuple, where the left entry is the old (modified) 'DiskEntry'\n-- and the right entry is the newly created 'DiskEntry'.\nmkdir :: Name -&gt; DiskEntry -&gt; Either Error (DiskEntry, DiskEntry)\nmkdir entryName destination = do\n  if Map.member entryName $ entries destination then do\n    Left $ \"mkdir: cannot create directory '\" ++ entryName ++ \"': File exists\"\n    else do let\n              newDirectory = Directory entryName Map.empty    \n              d = addToEntries entryName newDirectory destination\n              in Right (d, newDirectory)\n\naddToEntries :: Name -&gt; DiskEntry -&gt; DiskEntry -&gt; DiskEntry\naddToEntries newEntryName newEntry destination = do\n  let\n    updatedEntries = Map.insert newEntryName newEntry (entries destination)\n    d = Directory (name destination) updatedEntries\n    in d\n\nls :: DiskEntry -&gt; [DiskEntry]\nls currentDirectory = map snd $ Map.toList $ entries currentDirectory\n\nroot :: DiskEntry\nroot = Directory \"/\" Map.empty\n\nmain :: IO ()\nmain = do\n  -- Pretend that we have several \"Either Error (DiskEntry, DiskEntry)\"\n  -- We know that we have Right values, so get the first result from\n  -- that and extract the first element in the tuple which is the\n  -- newly modified \"root\" directory.\n  let old = fst $ Either.rights [mkdir \"bin\" root] !! 0\n\n  putStrLn \"Connected. Take this shell, and may it serve you well.\"\n  putStrLn \"I will not you create anything yet, but there is a\"\n  putStrLn \"directory, \\\"/\\\" which you are currently in.\"\n  putStrLn \"The `ls` command should let you see what else is there\"\n  putStrLn \"I will do that for you now\"\n\n  putStrLn $ show $ ls old\n</code></pre>\n\n<p>which outputs to the following</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u279c  ls-adventures git:(master) \u2717 ghci main.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( main.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; :main\nConnected. Take this shell, and may it serve you well.\nI will not you create anything yet, but there is a\ndirectory, \"/\" which you are currently in.\nThe `ls` command should let you see what else is there\nI will do that for you now\n[Directory {name = \"bin\", entries = fromList []}]\n</code></pre>\n\n<p>I am very malcontent with the means for updating directories, I would much more prefer that my function was capable of updating in place the referenced destination directory. Is this possible through something like the State Monad? Oh, and I assume the code looks horrendous, as in non-idiomatic Haskell?</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1450890981, "post_id": 34440566, "comment_id": 56622520, "body": "did you look at the <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">Haskell Wiki on Memoization</a> yet? - Aside from this it would probably help to see your function (or at least the signature) - also if you only need the second parameter internally you should hide it - for example by wrapping it inside one with only the first parameter"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450893127, "post_id": 34440566, "comment_id": 56623696, "body": "This <a href=\"https://hackage.haskell.org/package/memoize-0.7/docs/Data-Function-Memoize.html\" rel=\"nofollow noreferrer\">package</a> would probably interest you. This library gives you the function <code>memoFix :: Memoizable a =&gt; ((a -&gt; v) -&gt; a -&gt; v) -&gt; a -&gt; v</code> which will memoize a function of a single arguement written in open recursive form. Note that it doesn&#39;t care about its return type at all, i.e. <code>v</code> can be a function itself."}, {"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "edited": false, "score": 0, "creation_date": 1450893324, "post_id": 34440566, "comment_id": 56623803, "body": "But that function it returns will be evaluated each time a parameter is passed to it again, will it not?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 0, "creation_date": 1450893704, "post_id": 34440566, "comment_id": 56623993, "body": "If the second argument is not used or determined from the first why not make the function take 1 argument (perhaps wrap the 2 argument function) and use any of the memo-techniques linked above."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450893888, "post_id": 34440566, "comment_id": 56624083, "body": "@ManuelEberl If you have a function <code>go :: (Int -&gt; Char -&gt; String) -&gt; Int -&gt; Char -&gt; String</code> for example, then your desired function is <code>memoFix go :: Int -&gt; Char -&gt; String</code>, this function will be evaluated at most once for each <code>Int</code> parameter but will potentially re-evaluated for the <code>Char</code> parameter. You could also have <code>memoFix2 go :: Int -&gt; Char -&gt; Bool</code> which memoizes both parameters."}, {"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "edited": false, "score": 0, "creation_date": 1450899673, "post_id": 34440566, "comment_id": 56626861, "body": "I updated my question to address these comments."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450908997, "post_id": 34440566, "comment_id": 56630935, "body": "I don&#39;t see what the invariant inside your function has to do with memoization, the compiler and runtime know nothing about your invariant. If the list needs to memoized as well, use <code>memoFix2</code> or simply curry the function. Can you include the function you are trying to memoize? Maybe that will make things easier."}, {"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "edited": false, "score": 0, "creation_date": 1450960386, "post_id": 34440566, "comment_id": 56647148, "body": "All right, I added some code."}], "answers": [{"comments": [{"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "edited": false, "score": 0, "creation_date": 1450984187, "post_id": 34456760, "comment_id": 56655810, "body": "Thanks for your reply. Of course I don&#39;t need the index parameter, but if I use the list directly, I have to do list comparison with every map lookup instead of just integer comparison. I don&#39;t know a lot about memoisation, but this looks quite complicated, and I wonder if doing things this explicitly has drawbacks \u2013 does the use of explicit mutable state make parallelisation impossible?"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 2, "last_activity_date": 1450982693, "creation_date": 1450982693, "answer_id": 34456760, "question_id": 34440566, "link": "https://stackoverflow.com/questions/34440566/memoisation-with-auxiliary-parameter-in-haskell/34456760#34456760", "title": "Memoisation with auxiliary parameter in Haskell", "body": "<p>Your function is unnecessarily complicated. You don't need the index <code>m</code> at all:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: [(Int, Int)] -&gt; Int -&gt; Int\nfoo []         _ = 0\nfoo _          0 = 0\nfoo ((w,v):xs) n\n    | w &gt; n      = foo xs n\n    | otherwise  = foo xs n `max` foo xs (n - w) + v\n</code></pre>\n\n<p>Now if you want to memoize <code>foo</code> then both the arguments must be considered (as it should be).</p>\n\n<p>We'll use the <a href=\"https://www.cs.utexas.edu/users/wcook/Drafts/2009/sblp09-memo-mixins.pdf\" rel=\"nofollow\">monadic memoization mixin</a> method to memoize <code>foo</code>:</p>\n\n<ol>\n<li><p>First, we create an uncurried version of <code>foo</code> (because we want to memoize both arguments):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo' :: ([(Int, Int)], Int) -&gt; Int\nfoo' ([],       _) = 0\nfoo' (_,        0) = 0\nfoo' ((w,v):xs, n)\n    | w &gt; n       = foo' (xs, n)\n    | otherwise   = foo' (xs, n) `max` foo' (xs, n - w) + v\n</code></pre></li>\n<li><p>Next, we monadify the function <code>foo'</code> (because we want to thread a memo table in the function):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo' :: Monad m =&gt; ([(Int, Int)], Int) -&gt; m Int\nfoo' ([],       _) = return 0\nfoo' (_,        0) = return 0\nfoo' ((w,v):xs, n)\n    | w &gt; n        = foo' (xs, n)\n    | otherwise    = do\n        a &lt;- foo' (xs, n)\n        b &lt;- foo' (xs, n - w)\n        return (a `max` b + v)\n</code></pre></li>\n<li><p>Then, we open the self-reference in <code>foo'</code> (because we want to call the memoized function):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Endo a = a -&gt; a\n\nfoo' :: Monad m =&gt; Endo (([(Int, Int)], Int) -&gt; Int)\nfoo' _    ([],       _) = return 0\nfoo' _    (_,        0) = return 0\nfoo' self ((w,v):xs, n)\n    | w &gt; n             = foo' (xs, n)\n    | otherwise         = do\n        a &lt;- self (xs, n)\n        b &lt;- self (xs, n - w)\n        return (a `max` b + v)\n</code></pre></li>\n<li><p>We'll use the following memoization mixin to memoize our function <code>foo'</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Dict a b m = (a -&gt; m (Maybe b), a -&gt; b -&gt; m ())\n\nmemo :: Monad m =&gt; Dict a b m -&gt; Endo (a -&gt; m b)\nmemo (check, store) super a = do\n    b &lt;- check a\n    case b of\n        Just b  -&gt; return b\n        Nothing -&gt; do\n            b &lt;- super a\n            store a b\n            return b\n</code></pre></li>\n<li><p>Our dictionary (memo table) will use the <code>State</code> monad and a <code>Map</code> data structure:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Prelude hiding (lookup)\nimport Control.Monad.State\nimport Data.Map.Strict\n\nmapDict :: Ord a =&gt; Dict a b (State (Map a b))\nmapDict = (check, store) where\n    check a   = gets (lookup a)\n    store a b = modify (insert a b)\n</code></pre></li>\n<li><p>Finally, we combine everything to create a memoized function <code>memoFoo</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Function (fix)\n\ntype MapMemoized a b = a -&gt; State (Map a b) b\n\nmemoFoo :: MapMemoized ([(Int, Int)], Int) Int\nmemoFoo = fix (memo mapDict . foo')\n</code></pre></li>\n<li><p>We can recover the original function <code>foo</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: [(Int, Int)] -&gt; Int -&gt; Int\nfoo xs n = evalState (memoFoo (xs, n)) empty\n</code></pre></li>\n</ol>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1450982693, "creation_date": 1450890490, "last_edit_date": 1450960240, "question_id": 34440566, "link": "https://stackoverflow.com/questions/34440566/memoisation-with-auxiliary-parameter-in-haskell", "title": "Memoisation with auxiliary parameter in Haskell", "body": "<p>I have a recursive function <code>f</code> that takes two parameters <code>x</code> and <code>y</code>. The function is uniquely determined by the first parameter; the second one merely makes things easier.</p>\n\n<p>I now want to memoise that function w.r.t. it's first parameter while ignoring the second one. (I.e. <code>f</code> is evaluated at most one for every value of <code>x</code>)</p>\n\n<p>What is the easiest way to do that? At the moment, I simply define an array containing all values recursively, but that is a somewhat ad-hoc solution. I would prefer some kind of memoisation combinator that I can just throw at my function.</p>\n\n<p>EDIT: to clarify, the function <code>f</code> takes a pair of integers and a list. The first integer is some parameter value, the second one denotes the index of an element in some global list <code>xs</code> to consume.</p>\n\n<p>To avoid indexing the list, I pass the partially consumed list to <code>f</code> as well, but obviously, the invariant is that if the first parameter is <code>(m, n)</code>, the second one will always be <code>drop n xs</code>, so the result is uniquely determined by the first parameter.</p>\n\n<p>Just using a memoisation combinator on the partially applied function will not work, since that will leave an unevaluated thunk <code>\\xs -&gt; \u2026</code> lying around. I could probably wrap the two parameters in a datatype whose <code>Eq</code> instance ignores the second value (and similarly for other instances), but that seems like a very ad-hoc solution. Is there not an easier way?</p>\n\n<p>EDIT2: The concrete function I want to memoise:</p>\n\n<pre><code>g :: [(Int, Int)] -&gt; Int -&gt; Int\ng xs n = f 0 n\n  where f :: Int -&gt; Int -&gt; Int\n        f _ 0 = 0\n        f m n\n            | m == length xs  = 0\n            | w &gt; n           = f (m + 1) n\n            | otherwise       = maximum [f (m + 1) n, v + f (m + 1) (n - w)]\n          where (w, v) = xs !! m\n</code></pre>\n\n<p>To avoid the expensive indexing operation, I instead pass the partially-consumed list to <code>f</code> as well:</p>\n\n<pre><code>g' :: [(Int, Int)] -&gt; Int -&gt; Int\ng' xs n = f xs 0 n\n  where f :: [(Int, Int)] -&gt; Int -&gt; Int -&gt; Int\n        f []           _ _ = 0\n        f _            _ 0 = 0\n        f ((w,v) : xs) m n\n            | w &gt; n           = f xs (m + 1) n\n            | otherwise       = maximum [f xs (m + 1) n, v + f xs (m + 1) (n - w)]\n</code></pre>\n\n<p>Memoisation of <code>f</code> w.r.t. the list parameter is, of course, unnecessary, since the list does not (morally) influence the result. I would therefore like the memoisation to simply ignore the list parameter.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1450888012, "post_id": 34439800, "comment_id": 56620735, "body": "1. Always add the error you encounter. 2. You cannot map <code>(x:)</code> onto <code>[(Int, [Int])]</code>, since <code>(Int, [Int])</code> is not a list. 3. If you only use <code>xs</code> in the recursive call, you would always forget the start of the list. 4. Try to be more verbose. Write a function that, for a given index, splits the indexed value and the rest. Use this together with <code>zipWith [0..]</code> for a first prototype."}], "answers": [{"comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 1, "creation_date": 1450891912, "post_id": 34440572, "comment_id": 56623030, "body": "nice but this has quadratic complexity because of take/drop on each iteration"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 1, "creation_date": 1450925950, "post_id": 34440572, "comment_id": 56635399, "body": "@maxtaldykin, that actually can&#39;t be avoided. The &quot;pre-hole&quot; parts of the result lists can&#39;t share any structure with each other."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450938649, "post_id": 34440572, "comment_id": 56638490, "body": "However, using <code>splitAt</code> should give better constant factors."}], "tags": [], "owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "is_accepted": false, "score": 1, "last_activity_date": 1450890508, "creation_date": 1450890508, "answer_id": 34440572, "question_id": 34439800, "link": "https://stackoverflow.com/questions/34439800/create-sort-of-splitfunction-haskell/34440572#34440572", "title": "Create sort of splitfunction haskell", "body": "<p>This is possible with a list comprehension. Using <code>zip</code> you can create a tuple with an index and each element, then you can consturct a new tuple with your element and the original list minus the element at that index</p>\n\n<pre><code>splitter :: [a] -&gt; [(a, [a])]\nsplitter xs = [(x, removeN n xs) | (n, x) &lt;- zip [0..] xs]\n</code></pre>\n\n<p>That's using a function to remove the nth element</p>\n\n<pre><code>removeN :: Int -&gt; [a] -&gt; [a]\nremoveN n xs = take n xs ++ drop (n + 1) xs\n</code></pre>\n\n<p>example</p>\n\n<pre><code>*Main&gt; splitter [1..4]\n[(1,[2,3,4]),(2,[1,3,4]),(3,[1,2,4]),(4,[1,2,3])]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": true, "score": 1, "last_activity_date": 1450949424, "last_edit_date": 1450949424, "creation_date": 1450891723, "answer_id": 34440842, "question_id": 34439800, "link": "https://stackoverflow.com/questions/34439800/create-sort-of-splitfunction-haskell/34440842#34440842", "title": "Create sort of splitfunction haskell", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:inits\" rel=\"nofollow\">inits</a> and <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:tails\" rel=\"nofollow\">tails</a> from Data.List:</p>\n\n<pre><code>{-# LANGUAGE ParallelListComp #-}\nsplit xs = [(x, pre ++ post) | pre &lt;- inits xs | x:post &lt;- tails xs]\n</code></pre>\n\n<p>or, if you don't like <code>ParallelListComp</code>:</p>\n\n<pre><code>split xs = [(x, pre ++ post) | (pre, x:post) &lt;- zip (inits xs) (tails xs)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 2, "last_activity_date": 1450893751, "last_edit_date": 1495542705, "creation_date": 1450893751, "answer_id": 34441299, "question_id": 34439800, "link": "https://stackoverflow.com/questions/34439800/create-sort-of-splitfunction-haskell/34441299#34441299", "title": "Create sort of splitfunction haskell", "body": "<p><a href=\"https://stackoverflow.com/a/12872133/828361\">My answer to an older question</a> goes via an answer to this one.</p>\n\n<p>I call this operation <code>picks</code> because it tells you all the ways to pick one out of a list (seen as a bag).</p>\n\n<pre><code>picks :: [x] -&gt; [(x, [x])]\npicks [] = []\npicks (x : xs) = (x, xs) : [(y, x : ys) | (y, ys) &lt;- picks xs]\n</code></pre>\n\n<p>It's standard issue zipper-wrangling kit, about which I've written at great length in other answers, such as the one linked above, and <a href=\"https://stackoverflow.com/a/25572148/828361\">this one, for the works</a>.</p>\n"}], "owner": {"reputation": 35, "user_id": 4374600, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002205602620/picture?type=large", "display_name": "Arnout Verhaar", "link": "https://stackoverflow.com/users/4374600/arnout-verhaar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 34440842, "answer_count": 3, "score": 1, "last_activity_date": 1450949424, "creation_date": 1450887592, "question_id": 34439800, "link": "https://stackoverflow.com/questions/34439800/create-sort-of-splitfunction-haskell", "title": "Create sort of splitfunction haskell", "body": "<p>I want to split a list on 1 element and take the rest of the list in the second of the tuple and return that.</p>\n\n<p>like this:\n*> split [1,2,3,2]\ngives\n[(1,[2,3,2]),(2,[1,3,2]),(3,[1,2,2]),(2,[1,2,3])]</p>\n\n<p>I tried some code like this but it keeps giving me errors. Can someone help me out with this?</p>\n\n<pre><code>split :: [Int] -&gt; [(Int,[Int])]\nsplit [] = []\nsplit (x:xs) = (map (x:) (map snd (split xs))) ++ [(x,[])] \n</code></pre>\n\n<p>Thx!</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450884912, "post_id": 34438797, "comment_id": 56618741, "body": "You pretty much said exactly why it&#39;s happening: &quot;the <code>num2</code> in the pattern match is not the same as the one in the arguments&quot;."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1538776047, "post_id": 34438797, "comment_id": 92277025, "body": "Related: <a href=\"https://stackoverflow.com/questions/9336385/why-do-these-pattern-matches-overlap\" title=\"why do these pattern matches overlap\">stackoverflow.com/questions/9336385/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450889753, "post_id": 34438982, "comment_id": 56621811, "body": "What do you mean &quot;has nothing to do with the top-level value <code>otherwise</code>&quot;? <code>otherwise</code> <i>is</i> a top-level value defined in <code>Prelude</code>. You can hide it: <code>import Prelude hiding (otherwise)</code>. Or have I misunderstood you?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450907311, "post_id": 34438982, "comment_id": 56630224, "body": "@user3237465 In a pattern match, <code>otherwise</code> isn&#39;t referring to the value <code>True</code>. How could it? You can&#39;t match num2, a number, with <code>True</code>. Rather, it acts similarly to the <code>otherwise</code> defined to be <code>True</code>, in that it matches anything: because it is a pattern that never fails to match. Instead of <code>otherwise</code> you could equally write <code>_</code> or <code>batman</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1450907910, "post_id": 34438982, "comment_id": 56630492, "body": "@amalloy, ah, I overlooked that <code>otherwise</code> in the question."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1450884880, "creation_date": 1450884880, "answer_id": 34438982, "question_id": 34438797, "link": "https://stackoverflow.com/questions/34438797/pattern-matching-with-integer-in-haskell-gives-wrong-result/34438982#34438982", "title": "Pattern matching with integer in haskell gives wrong result", "body": "<p><code>num2</code> is a pattern that matches any value. Always. It has nothing to do with an existing variable <code>num2</code> that is in scope. (In the right-hand side of the case alternative, here <code>\"foo\"</code>, the value matched will be bound to the name <code>num2</code>, shadowing the existing name <code>num2</code>. But that's not relevant here since you don't use <code>num2</code> anyways.)</p>\n\n<p>Imagine if all your <code>map f (x : xs) = f x : map f xs</code> pattern matches changed meaning just because someone defined a top-level variable called <code>x</code>!</p>\n\n<p>Similarly, <code>otherwise</code> is a pattern that matches everything, and has nothing to do with the top-level value <code>otherwise</code>. <code>otherwise</code> is supposed to be used in guards like <code>| otherwise = ...</code>; its definition is <code>otherwise = True</code>.</p>\n\n<p>In this case, the easiest way to fix your program is just</p>\n\n<pre><code>test num1 num2 = if num1 == num2 then \"foo\" else \"bar\"\n</code></pre>\n"}], "owner": {"reputation": 1601, "user_id": 1617063, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zaLum.png?s=128&g=1", "display_name": "sayantankhan", "link": "https://stackoverflow.com/users/1617063/sayantankhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1450884880, "creation_date": 1450884259, "question_id": 34438797, "link": "https://stackoverflow.com/questions/34438797/pattern-matching-with-integer-in-haskell-gives-wrong-result", "title": "Pattern matching with integer in haskell gives wrong result", "body": "<p>I noticed that trying to perform pattern matching in haskell with the arguments doesn't quite always work. Here's an example:</p>\n\n<pre><code>test :: Integer -&gt; Integer -&gt; String\ntest num1 num2 = case num1 of\n                    num2 -&gt; \"foo\"\n                    otherwise -&gt; \"bar\"\n</code></pre>\n\n<p>When I load this in the interpreter, it warns me of overlapping pattern matches. Further more, <code>test a b</code> for any two integers <code>a</code> and <code>b</code> returns <code>\"foo\"</code>, regardless of whether they're equal or not. It appears that the <code>num2</code> in the pattern match is not the same as the one in the arguments.</p>\n\n<p>I want to know why exactly this is happening. I'd really appreciate any insight into the situation.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450970770, "post_id": 34438778, "comment_id": 56651359, "body": "Another option is to use a <code>WrappedLens</code>, which will maintain the polymorphism and avoid any possible need to convert the <code>ALens</code> to a <code>Lens</code>, which will cost you a bit. Or do that by hand by making <code>Register</code> a rank 2 newtype."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1450884201, "creation_date": 1450884201, "answer_id": 34438778, "question_id": 34438522, "link": "https://stackoverflow.com/questions/34438522/workaround-to-return-a-lens-from-a-monadic-action/34438778#34438778", "title": "Workaround to return a lens from a monadic action", "body": "<p>The solution that worked for me was to use <a href=\"http://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Lens.html#t:ALens\" rel=\"nofollow\"><code>ALens</code></a> rather than <code>Lens</code>, as</p>\n\n<blockquote>\n  <p>This type can also be used when you need to store a Lens in a container, since it is rank-1. </p>\n</blockquote>\n\n<p>Then I just replaced my <code>Lens</code> operators <code>^.</code> and <code>%~</code> with their <code>ALens</code> equivalents, <code>^#</code> and <code>#%~</code>.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1450884201, "creation_date": 1450883311, "question_id": 34438522, "link": "https://stackoverflow.com/questions/34438522/workaround-to-return-a-lens-from-a-monadic-action", "title": "Workaround to return a lens from a monadic action", "body": "<p>Ran into this issue when playing with <a href=\"http://adventofcode.com/day/23\" rel=\"nofollow\">today's advent of code problem</a>.</p>\n\n<p>Say I have:</p>\n\n<pre><code>data Cache = Cache { _a :: Int, _b :: Int }\nmakeLenses ''Cache\n\ntype Register = Lens' Cache Int\n</code></pre>\n\n<p>Using Parsec, I can parse the character 'a' as <code>a :: Register</code> and the character 'b' as <code>b :: Register</code>.</p>\n\n<pre><code>register = a &lt;$ char 'a' &lt;|&gt; b &lt;$ char 'b'\n</code></pre>\n\n<p>which, alone, compiles just fine.</p>\n\n<p>The trouble is when I give <code>register</code> the explicit type <code>Stream s m Char =&gt; ParsecT s u m Register</code>, ghc complains that it wants to give it the type <code>(Functor f, Stream s m Char) =&gt; ParsecT s u m ((Int -&gt; f Int) -&gt; Cache -&gt; f Cache)</code>.</p>\n\n<p>I think I understand its reasoning - it wants to float the typeclass constraints out as a far as possible; this is just slightly inconvenient to me for purposes of documenting <code>register</code>.</p>\n\n<p>Is there a standard workaround for situations like this?</p>\n"}, {"tags": ["haskell", "encoding", "pandoc"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1450886980, "post_id": 34437461, "comment_id": 56620075, "body": "I guess you&#39;ve solved the problem already. I was going to ask: What encoding is <code>test.tex</code>? And what value do you get for <code>getLocaleEncoding</code> (<a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-IO-Encoding.html#v:getLocaleEncoding\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.1.0/docs/&hellip;</a>)? I suspect one or the other isn&#39;t UTF-8."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1450955756, "post_id": 34437461, "comment_id": 56645344, "body": "see <a href=\"http://stackoverflow.com/a/5288816/214446\">this SO answer</a> about how GHC does character encoding... basically it seems to use the default system encoding."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1450955821, "post_id": 34437461, "comment_id": 56645373, "body": "btw, feel free to post your solution as an answer..."}], "owner": {"reputation": 4337, "user_id": 649727, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1cb3b3d7e0ccce5f039c37f9bd85de11?s=128&d=identicon&r=PG", "display_name": "phynfo", "link": "https://stackoverflow.com/users/649727/phynfo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1452793751, "creation_date": 1450879706, "last_edit_date": 1452793751, "question_id": 34437461, "link": "https://stackoverflow.com/questions/34437461/problems-with-character-encoding-using-haskells-text-pandoc", "title": "Problems with Character Encoding Using Haskells Text.Pandoc", "body": "<p>I want to parse a LaTeX-File using Pandoc and output the text, like this: </p>\n\n<pre><code>import qualified Text.Pandoc as P\nimport Text.Pandoc.Error (handleError)\n\ntex2Str = do \n           file &lt;- readFile \"test.tex\"\n           let p = handleError $ P.readLaTeX P.def file\n           writeFile \"A.txt\" $  P.writePlain P.def p\n           writeFile \"B.txt\" $  file\n</code></pre>\n\n<p>While the encoding in file B.txt seems to be \"right\" (i.e. uft-8), the encoding in file A.txt is not correct.</p>\n\n<p>Here the respective extracts of the files:</p>\n\n<p>A.txt:\n<code>\n...\nDer _Crawler_ l\u00c3\u00a4uft hierbei \u00c3\u00bcber die Dokumentenbasis\n...\n</code></p>\n\n<p>B.txt: \n<code>\n...\n\\usepackage[utf8]{inputenc}\n...\nDer \\emph{Crawler} l\u00e4uft hierbei \u00fcber die Dokumentenbasis\n...\n</code></p>\n\n<p>Anyone knows how to fix this? Why does Pandoc use the wrong encoding (I thought, it uses utf-8 by default)?</p>\n\n<p><strong>Update</strong>:</p>\n\n<p>I got a (partial) solution: Using the <code>readFile</code> and <code>writeFile</code>-Functions from <code>Text.Pandoc.UTF8</code> seems to fix some of the problems, i.e.</p>\n\n<pre><code>import qualified Text.Pandoc as P\nimport Text.Pandoc.Error (handleError)\nimport qualified Text.Pandoc.UTF8 as UTF (readFile, writeFile)\n\ntex2Str = do \n            file &lt;- UTF.readFile \"test.tex\"\n            let p = handleError $ P.readLaTeX P.def file\n            UTF.writeFile \"A.txt\" $  P.writePlain P.def p\n            UTF.writeFile \"B.txt\" $  file\n</code></pre>\n\n<p>However, I still didnt get the clue what the actual problem was, since both <code>Prelude.readFile</code> and <code>Prelude.writeFile</code> seem to work uft8-aware... </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450877298, "post_id": 34436126, "comment_id": 56614273, "body": "<code>| elem a x = moveNow x a s</code> but what about xs? How can you drop it? Perhaps try giving your functions explicit type signatures."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1450882914, "post_id": 34436126, "comment_id": 56617571, "body": "what is the use of this condition <code>x==&#39; &#39;</code> ?"}, {"owner": {"reputation": 23, "user_id": 5711221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80badedb8566aeaf37825a2287860ed3?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5711221/john-smith"}, "edited": false, "score": 0, "creation_date": 1451168590, "post_id": 34436126, "comment_id": 56693270, "body": "use for condition <code>x==&#39; &#39;</code> is to check whether x is a space character or not"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5711221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80badedb8566aeaf37825a2287860ed3?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5711221/john-smith"}, "edited": false, "score": 0, "creation_date": 1451168823, "post_id": 34436907, "comment_id": 56693338, "body": "Replacing with <code>| elem a x = moveNow x a s : xs</code> is what I was after. Thanks!"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2512323"}, "is_accepted": true, "score": 1, "last_activity_date": 1450877763, "creation_date": 1450877763, "answer_id": 34436907, "question_id": 34436126, "link": "https://stackoverflow.com/questions/34436126/haskell-trying-to-mutate-string-in-string/34436907#34436907", "title": "Haskell trying to mutate string in [String]", "body": "<p>Direct solution to the error is to replace the line</p>\n\n<pre><code>| elem a x = moveNow x a s\n</code></pre>\n\n<p>With</p>\n\n<pre><code>| elem a x = moveNow x a s : movex xs a s\n</code></pre>\n\n<p>Or, probably</p>\n\n<pre><code>| elem a x = moveNow x a s : xs\n</code></pre>\n\n<p>Depending on what you want to do after the first match: continue looking for certain character, or leave other strings untouched.</p>\n\n<p>Your <code>moveNow</code> function has return type <code>String</code>, or <code>[Char]</code>, while <code>movex</code> has <code>[String]</code>, or <code>[[Char]]</code>, that's why compiler complains.</p>\n\n<p>To avoid such problems(or fix them easier) consider writing explicit type signatures, like so:</p>\n\n<pre><code>movex :: [String]-&gt;String-&gt;String-&gt;[String]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5711221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80badedb8566aeaf37825a2287860ed3?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5711221/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 2, "accepted_answer_id": 34436907, "answer_count": 1, "score": 2, "last_activity_date": 1450878345, "creation_date": 1450875049, "question_id": 34436126, "link": "https://stackoverflow.com/questions/34436126/haskell-trying-to-mutate-string-in-string", "title": "Haskell trying to mutate string in [String]", "body": "<pre><code>movex [] a s = []    \nmovex (x:xs) a s\n| elem a x = moveNow x a s\n| otherwise = x : (movex xs a s)\nwhere\n  moveNow x a s\n    | s == 'l' = moveNow2 x a\n    where\n        moveNow2 [] _ = []\n        moveNow2 (x:y:xs) a\n          | x == ' ' &amp;&amp; y == a = a : x : moveNow2 (y:xs) a\n          | otherwise = x : moveNow2 (y:xs) a\n</code></pre>\n\n<p>&lt;- This is what I got right now</p>\n\n<p>I am trying to make a function that iterates through [string], finds the right string and then mutates it.</p>\n\n<p>given input </p>\n\n<pre><code>func [\"abc\", \"dfg\"] f l -- move f in this list 1 space left --\n</code></pre>\n\n<p>expected output</p>\n\n<pre><code>[\"abc\", \"fdg\"]\n</code></pre>\n\n<p>Right now I am stuck at movex function that gives me error </p>\n\n<pre><code>Couldn't match expected type `Char' with actual type `[Char]'\nIn the first argument of `(:)', namely `x'\nIn the expression: x : (movex xs a s)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1450872575, "post_id": 34435321, "comment_id": 56611554, "body": "So you&#39;re trying the total number of occurrences of the character in all strings? Or the amount of strings in which the character occurs at least once?"}, {"owner": {"reputation": 151, "user_id": 5460243, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fb851e54f92c2e481868a7160f8731ea?s=128&d=identicon&r=PG&f=1", "display_name": "Fiedberg Nichenko", "link": "https://stackoverflow.com/users/5460243/fiedberg-nichenko"}, "reply_to_user": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1450872648, "post_id": 34435321, "comment_id": 56611602, "body": "Amount of strings in which the character occurs at least once"}, {"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1450872671, "post_id": 34435321, "comment_id": 56611612, "body": "Alright give me a sec"}], "answers": [{"comments": [{"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "edited": false, "score": 1, "creation_date": 1450872986, "post_id": 34435502, "comment_id": 56611805, "body": "The function takes a list of <code>String</code>s, not a single <code>String</code>."}, {"owner": {"reputation": 7683, "user_id": 876937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6bc562fd4d7d98d1a2688ea44e196968?s=128&d=identicon&r=PG", "display_name": "Xophmeister", "link": "https://stackoverflow.com/users/876937/xophmeister"}, "reply_to_user": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "edited": false, "score": 0, "creation_date": 1450873063, "post_id": 34435502, "comment_id": 56611838, "body": "@Kapol I didn&#39;t spot that! In which case, ignore what I said about <code>elem</code>: that&#39;s what should be used!"}, {"owner": {"reputation": 151, "user_id": 5460243, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fb851e54f92c2e481868a7160f8731ea?s=128&d=identicon&r=PG&f=1", "display_name": "Fiedberg Nichenko", "link": "https://stackoverflow.com/users/5460243/fiedberg-nichenko"}, "edited": false, "score": 0, "creation_date": 1450873063, "post_id": 34435502, "comment_id": 56611839, "body": "Yep .. just noticed it myself :D"}, {"owner": {"reputation": 7683, "user_id": 876937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6bc562fd4d7d98d1a2688ea44e196968?s=128&d=identicon&r=PG", "display_name": "Xophmeister", "link": "https://stackoverflow.com/users/876937/xophmeister"}, "edited": false, "score": 0, "creation_date": 1450873457, "post_id": 34435502, "comment_id": 56612084, "body": "Fixed and added a simplification"}], "tags": [], "owner": {"reputation": 7683, "user_id": 876937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6bc562fd4d7d98d1a2688ea44e196968?s=128&d=identicon&r=PG", "display_name": "Xophmeister", "link": "https://stackoverflow.com/users/876937/xophmeister"}, "is_accepted": false, "score": 1, "last_activity_date": 1450873364, "last_edit_date": 1450873364, "creation_date": 1450872917, "answer_id": 34435502, "question_id": 34435321, "link": "https://stackoverflow.com/questions/34435321/iterate-and-count-string-haskell/34435502#34435502", "title": "Iterate and count [String] Haskell", "body": "<p>You've got the right idea. <code>elem</code> is a predicate that answers whether a list contains an element. Given that a <code>String</code> is a list of <code>char</code>, it would probably be better to just match on equality. Something like this:</p>\n\n<pre><code>count :: String -&gt; Char -&gt; Int\ncount \"\" _ = 0\ncount (x:xs) v\n  | x == v    = 1 + count xs v\n  | otherwise = count xs v\n</code></pre>\n\n<p>Your <code>count</code> function takes two arguments. In your example code, you're missing the second (the character you're searching for); hence the error.</p>\n\n<hr>\n\n<p><strong>EDIT</strong> The signature is <code>count :: [String] -&gt; Char -&gt; Int</code>; my mistake. In which case, you <em>should</em> use <code>elem</code> and it can be simplified to something like:</p>\n\n<pre><code>count :: [String] -&gt; Char -&gt; Int\ncount [] _ = 0\ncount (x:xs) v = c + count xs v\n                 where c = if elem v x then 1 else 0\n</code></pre>\n\n<p>...you always do the <code>count xs v</code> recursive call, so you don't really need the guard.</p>\n"}, {"tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 1, "last_activity_date": 1450873321, "last_edit_date": 1450873321, "creation_date": 1450872923, "answer_id": 34435505, "question_id": 34435321, "link": "https://stackoverflow.com/questions/34435321/iterate-and-count-string-haskell/34435505#34435505", "title": "Iterate and count [String] Haskell", "body": "<p><code>count</code> takes two arguments (a list and a character), but you are invoking it with only one (<code>xs</code>) in each guard. You should change your function to:</p>\n\n<pre><code>count [] _ = 0\ncount (x:xs) v\n | elem v x  = 1 + count xs v\n | otherwise = count xs v\n</code></pre>\n\n<p>Notice that I removed adding zero, because it's redundant and doesn't really make the code more readable.</p>\n"}, {"tags": [], "owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "is_accepted": false, "score": 0, "last_activity_date": 1450873319, "creation_date": 1450873319, "answer_id": 34435622, "question_id": 34435321, "link": "https://stackoverflow.com/questions/34435321/iterate-and-count-string-haskell/34435622#34435622", "title": "Iterate and count [String] Haskell", "body": "<p>I would recommend defining the desired signature for count, so you'll get better errors, and a good feeling for the type system (since you're learning haskell)</p>\n\n<pre><code>count :: [String] -&gt; Char -&gt; Int\n</code></pre>\n\n<p>To make your code work these are in my mind the changes you'd need to make (untested)</p>\n\n<pre><code>count [] _ = 0\ncount (x:xs) v\n | elem v x = 1 + count xs v\n | otherwise = count xs v\n</code></pre>\n\n<p>You could also use built in functions like haskell to make your code a little more readable (less guards and lines), though I think it would make it a little worse performance wise.</p>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 1, "last_activity_date": 1450873597, "creation_date": 1450873597, "answer_id": 34435705, "question_id": 34435321, "link": "https://stackoverflow.com/questions/34435321/iterate-and-count-string-haskell/34435705#34435705", "title": "Iterate and count [String] Haskell", "body": "<p>Just for show a folding solution:</p>\n\n<pre><code>count :: String -&gt; Char -&gt; Int\ncount x c = foldr (\\x y -&gt; y+1 if x == c else y) s 0\n</code></pre>\n\n<p>foldr pick each element and perform the desired operation taking the result as the input for the next item, so in this case, we are initializing it to 0, and adding 1 for each element that is equal to the char passed to te function.</p>\n"}], "owner": {"reputation": 151, "user_id": 5460243, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fb851e54f92c2e481868a7160f8731ea?s=128&d=identicon&r=PG&f=1", "display_name": "Fiedberg Nichenko", "link": "https://stackoverflow.com/users/5460243/fiedberg-nichenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1696, "favorite_count": 0, "accepted_answer_id": 34435505, "answer_count": 4, "score": 0, "last_activity_date": 1450873597, "creation_date": 1450872309, "last_edit_date": 1450872714, "question_id": 34435321, "link": "https://stackoverflow.com/questions/34435321/iterate-and-count-string-haskell", "title": "Iterate and count [String] Haskell", "body": "<p>I am trying to learn Haskell.\nCurrently I am making a function that should take a [String] and 'char' and return in how many strings this char presents.</p>\n\n<pre><code>count [] _ = 0\ncount (x:xs) v\n | elem v x = 1 + count xs\n | otherwise = 0 + count xs\n</code></pre>\n\n<p>How is it done correctly?</p>\n\n<p><strong>!EDIT</strong></p>\n\n<p>I get this error ::</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a ~ a1 -&gt; a\n  Relevant bindings include\n  v :: a1 (bound at prog.hs:7:14)\n  xs :: [t a1] (bound at prog.hs:7:10)\n  x :: t a1 (bound at prog.hs:7:8)\n  count :: [t a1] -&gt; a1 -&gt; a (bound at prog.hs:6:1)\nIn the second argument of `(+)', namely `count xs'\nIn the expression: 1 + count xs\n</code></pre>\n"}, {"tags": ["haskell", "type-inference", "typeclass", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450875025, "post_id": 34435749, "comment_id": 56613018, "body": "I would&#39;ve thought that if it says <code>Scalar (a, a)</code> and <code>Vector (a, a)</code> that the only possible type available is <code>a</code>. So if <code>a</code> is an Int, every other instance of <code>a</code> must <i>also</i> be Int"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450879679, "post_id": 34435749, "comment_id": 56615713, "body": "I think you&#39;re just assuming that your <code>Vector (a, a)</code> instance will be selected. The point is there&#39;s nothing that forces it to be selected and, in fact, you could add a second, non-overlapping instance that would also type check if used in <code>res</code>. GHC never &quot;just assumes&quot; an instance will be selected just because it has the instance available, it needs to find the instance using the logic outlined in the second half of my answer."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450880170, "post_id": 34435749, "comment_id": 56615988, "body": "but if it&#39;s the only available instance, how then does it not necessarily select that one? Isn&#39;t it kinda like having a square-shaped hole and a square that can&#39;t go in because it might be a circle?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 1, "creation_date": 1450884342, "post_id": 34435749, "comment_id": 56618375, "body": "Since type classes are open (anyone can define additional instances anywhere), the compiler never assumes that it has full information about what instances exist. So, the <code>Vector (a, a)</code> might not be the only available instance that would fit. In practical terms, this means the compiler won&#39;t let you write programs that can become ambiguous if you (or modules that you import) define additional, non-overlapping instances."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450884580, "post_id": 34435749, "comment_id": 56618514, "body": "Your analogy is poorly constructed. It&#39;s not the piece, but rather the hole whose shape is unknown, or flexible. We don&#39;t want to commit to putting the square-shaped piece in today because we might get a different piece that would fit equally well in the mail tomorrow."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1450873757, "creation_date": 1450873757, "answer_id": 34435749, "question_id": 34435306, "link": "https://stackoverflow.com/questions/34435306/couldnt-match-expected-type-with-actual-type-the-type-variables-are-ambiguous/34435749#34435749", "title": "Couldn&#39;t match expected type with actual type. The type variables are ambiguous", "body": "<p>In</p>\n\n<pre><code>res :: Int\nres = (2, 3) `vdot` (5, 5)\n</code></pre>\n\n<p>nothing forces <code>2</code> and <code>3</code> to be <code>Int</code>, or even to be the same type as each other. So, the <code>Vector (a, a)</code> instance might not apply. For all GHC knows you could intend to write another instance <code>Vector (Float, Double)</code> with <code>type Scalar (Float, Double) = Int</code> and a totally different implementation of <code>vdot</code>, and <code>res</code> would still type check. Hence the types of <code>2</code> and <code>3</code> are ambiguous, as GHC told you.</p>\n\n<p>It sounds like you really want to say: a pair <code>(a, b)</code> can <em>only</em> be an instance of <code>Vector</code> when <code>b</code> is the same type as <code>a</code> (and then use the instance you wrote). You can express that in GHC as follows:</p>\n\n<pre><code>instance (a ~ b, Num a) =&gt; Vector (a, b) where\n  type Scalar (a,b) = a\n  (a, b) `vplus` (c, d) = (a + c, b + d)\n  (a, b) `vmult` m = (a * m, b * m)\n  (a, b) `vdot`  (c, d) = a * c + b * d\n</code></pre>\n\n<p><code>a ~ b</code> is an equality constraint that asserts that the two types <code>a</code> and <code>b</code> are the same.</p>\n\n<p>Now your example <code>res</code> can work correctly:</p>\n\n<pre><code>*Main&gt; (2, 3) `vdot` (5, 5) :: Int\n25\n</code></pre>\n\n<p>Here is the reasoning that means that the types are no longer ambiguous.</p>\n\n<ul>\n<li><p><code>vdot</code> has type <code>Vector v =&gt; v -&gt; v -&gt; Scalar v</code>. So for <code>res</code> to type check, we need to find the <code>v</code> such that <code>(2, 3) :: v</code>, <code>(5, 5) :: v</code>, and <code>Scalar v ~ Int</code>.</p></li>\n<li><p>But <code>(2, 3)</code> has a type of the form <code>(a, b)</code> and there is an instance whose head is of the form <code>Vector (a, b)</code>. So, we must use that instance. (In your original program, we cannot make this step because there is no sufficiently general instance.)</p></li>\n<li><p>The associated type definition of that instance tells us that <code>Scalar (a, b) ~ a</code>. But we know <code>Scalar (a, b)</code> was supposed to be <code>Int</code>, so we must have <code>a ~ Int</code>.</p></li>\n<li><p>The constraints of that instance tell us <code>a ~ b</code> and that there should be an instance <code>Num a</code>. So, we must have <code>b ~ Int</code> too (and indeed <code>Num Int</code> holds).</p></li>\n<li><p>So, we concluded that <code>2 :: Int</code> and <code>3 :: Int</code>, and since <code>(5, 5) :: v</code> also, we have <code>5 :: Int</code> and <code>5 :: Int</code> too.</p></li>\n<li><p>Now we've determined which type class to use for every overloaded name in our expression (<code>2</code>, <code>3</code>, <code>5</code>, <code>5</code> and <code>vdot</code>), so there is no ambiguity and we can finally evaluate the expression.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1450877769, "creation_date": 1450877769, "answer_id": 34436908, "question_id": 34435306, "link": "https://stackoverflow.com/questions/34435306/couldnt-match-expected-type-with-actual-type-the-type-variables-are-ambiguous/34436908#34436908", "title": "Couldn&#39;t match expected type with actual type. The type variables are ambiguous", "body": "<p>Let's simplify the matter:</p>\n\n<pre><code>class Vector v where\n  type Scalar v :: *\n  vdot  :: v -&gt; v -&gt; Scalar v\n  ...    \ninstance Num a =&gt; Vector (a, a) where\n  type Scalar (a,a) = a\n  ...\nres :: Int\nres = (2, 3) `vdot` (5, 5)\n</code></pre>\n\n<p>Now, we have</p>\n\n<pre><code>vdot :: v     -&gt; v  -&gt; Scalar v\nvdot    (2,3) (5,5)\n</code></pre>\n\n<p>so the double application must have this type</p>\n\n<pre><code>(2,3) :: v\n(5,5) :: v\nres = vdot (2,3) (5,5) :: Scalar v\n</code></pre>\n\n<p>Expanding the type of the pairs:</p>\n\n<pre><code>(2,3) :: (a1, a2) ~ v     for some a1, a2 in class Num\n(5,5) :: (b1, b2) ~ v     for some b1, b2 in class Num\nres = vdot (2,3) (5,5) :: Scalar v\n</code></pre>\n\n<p>By transitivity, <code>(a1, a2) ~ (b1, b2)</code>, hence <code>a1 ~ b1</code> and <code>a2 ~ b2</code>.</p>\n\n<pre><code>(2,3) :: (a1, a2)         for some a1, a2 in class Num\n(5,5) :: (a1, a2)\nres = vdot (2,3) (5,5) :: Scalar (a1, a2)\n</code></pre>\n\n<p>We also know from the annotation that</p>\n\n<pre><code>res :: Int\n</code></pre>\n\n<p>hence</p>\n\n<pre><code>Scalar (a1, a2) ~ Int\n</code></pre>\n\n<p>But from this there's no way to know what are <code>a1, a2</code>. After all, one might use custom types for that:</p>\n\n<pre><code>data A1 = ...\ndata A2 = ...\ninstance Num A1 where ...\ninstance Num A2 where ...\ninstance Vector (A1, A2) where\n   type Scalar (A1, A2) = Int  -- !!!!\n</code></pre>\n\n<p>Note the last <code>Int</code>. This causes both</p>\n\n<pre><code>type Scalar (Int, Int) = Int\ntype Scalar (A1 , A2 ) = Int\n</code></pre>\n\n<p>making it impossible to choose the types of <code>a1, a2</code>. This is usually referred by the sentence \"<em>type families do not have to be injective</em>\".</p>\n\n<p>Also note that the absence of the <code>instance Vector (A1, A2)</code> in your code does not help. GHC must compile your code expecting such instance to be declared later on, possibly in other modules (the \"open world\" assumption). This is pretty much required to allow for separate compilation.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1238, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1450877769, "creation_date": 1450872263, "question_id": 34435306, "link": "https://stackoverflow.com/questions/34435306/couldnt-match-expected-type-with-actual-type-the-type-variables-are-ambiguous", "title": "Couldn&#39;t match expected type with actual type. The type variables are ambiguous", "body": "<p>Trying to create a <code>Vector</code> typeclass that works on tuples I've run into some problems</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Vector v where\n  type Scalar v :: *\n  vplus :: v -&gt; v -&gt; v\n  vmult :: v -&gt; Scalar v -&gt; v\n  vdot  :: v -&gt; v -&gt; Scalar v\n\ninstance Num a =&gt; Vector (a, a) where\n  type Scalar (a,a) = a\n  (a, b) `vplus` (c, d) = (a + c, b + d)\n  (a, b) `vmult` m = (a * m, b * m)\n  (a, b) `vdot`  (c, d) = a * c + b * d\n</code></pre>\n\n<p>The problem is that I need explicit type declarations for GHC to not get confused. This is of course a minor inconvenience, except <code>vdot</code> doesn't seem to want to work at all.</p>\n\n<pre><code>res :: Int\nres = (2, 3) `vdot` (5, 5)\n-- error: Couldn't match expected type 'Int' with actual type 'Scalar (t0, t1)'\n--        The type variables 't0', 't1' are ambiguous\n</code></pre>\n\n<p>This error does go away if I do this:</p>\n\n<pre><code>res :: Int\nres = ((2, 3) :: (Int, Int)) `vdot` (5, 5)\n</code></pre>\n\n<p>But now we've reached the realm of verbose code so extreme it just isn't practical anymore. Haskell's supposed to be beautiful and concise; not explicit type hell</p>\n\n<p>I would have assumed GHC was capable of resolving <code>type Scalar (a, a) = a</code> on its own, but the error persists even if I remove the instance declaration completely. It even complains when <code>Vector (Int, Int)</code> is the only instance available.</p>\n\n<p>So what's going on here? And is there a way to get this to work beautifully?</p>\n"}, {"tags": ["haskell", "predicate", "fold", "monoids"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1450877980, "post_id": 34435217, "comment_id": 56614660, "body": "Sounds like <code>findIndex p . toList</code>."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457151357, "creation_date": 1457151357, "answer_id": 35809927, "question_id": 34435217, "link": "https://stackoverflow.com/questions/34435217/generic-approach-to-finding-index-of-element/35809927#35809927", "title": "Generic approach to finding index of element", "body": "<p>Zeta's comment is right. You can just call <code>toList</code> and then find the element in that. But supposing we didn't want to do this, how could we do it using monoids?</p>\n\n<p>Here's one approach</p>\n\n<pre><code>data FirstTrue = FT Int Bool deriving Show\n\ninstance Monoid FirstTrue where\n   mempty = FT 0 False\n   FT n b `mappend` ~(FT n1 b1)\n      | b = FT n True\n      | b1 = FT (n + n1) True\n      | otherwise = FT (n + n1) False\n\nfindIndex p t = let (FT i b) = foldMap (\\x -&gt; FT 1 (p x)) t\n                in if b then Just i else Nothing\n</code></pre>\n\n<p>I don't think that you can do it in this generality and build it just out of <code>Foldable</code> and existing <code>Monoid</code> instances, as the types of compositions we have don't let you \"cross over\" the logic from the two conjoined monoid types (here the <code>Count</code> monoid and the <code>Any</code> monoid).</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457151357, "creation_date": 1450871947, "last_edit_date": 1457149735, "question_id": 34435217, "link": "https://stackoverflow.com/questions/34435217/generic-approach-to-finding-index-of-element", "title": "Generic approach to finding index of element", "body": "<p>There have been some major changes in base library, so I'm wondering whether today idiomatic solution would involve <code>fmap</code>, <code>Maybe</code>, <code>Monoid</code>, <code>First</code>, <code>Foldable</code> and maybe other classes.</p>\n\n<p>I figured I would need to <code>fold</code> a complex structure of a <code>Monoid</code> with <code>zip [1..]</code>, <code>First</code>, <code>a -&gt; Bool</code> and <code>Maybe</code>, but couldn't find obvious way to compose these things together.</p>\n\n<p>Also, I suspect most of this code is in libraries. I'm just not sure whether (or how many) <code>newtype</code> wrappers would I need to compose classes to get a structure I need.</p>\n"}, {"tags": ["haskell", "garbage-collection"], "comments": [{"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1450869022, "post_id": 34433757, "comment_id": 56609431, "body": "Couldn&#39;t it be that it only stores the O(n) nodes it is currently checking? I.e. if it processed a leaf, it forgets it and replaces it by the next leaf.  Also, Haskell is known for it&#39;s laziness, meaning that it will not evaluate anything it does not currently need."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1450869791, "post_id": 34433757, "comment_id": 56609908, "body": "<i>&quot;We have to wait until the left half the tree is processed&quot;</i>. Use that argument recursively, and you&#39;ll notice a pattern."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450870762, "post_id": 34433757, "comment_id": 56610492, "body": "I somehow assumed that having a top-level binding like <code>treeOne</code> above would prevent any garbage collection. Maybe GHC is optimizing more than I thought."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1450881591, "post_id": 34435432, "comment_id": 56616783, "body": "This is also a very good answer but I can only accept one. All three were great thank you and they&#39;ve all got an upvote (and deserve more).."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 4, "last_activity_date": 1450872676, "creation_date": 1450872676, "answer_id": 34435432, "question_id": 34433757, "link": "https://stackoverflow.com/questions/34433757/how-the-haskell-garbage-collector-efficiently-collects-trees/34435432#34435432", "title": "How the Haskell garbage collector efficiently collects trees", "body": "<p>Actually you don't hold on to the root while you descend the left subtree.</p>\n\n<pre><code>go n (Tree _ l r) = go (n - 1) l . go (n - 1) r\n</code></pre>\n\n<p>So the root is turned two thunks, composed together. One holds a reference to the left subtree, the other holds a reference to the right subtree. The root node itself is now garbage.</p>\n\n<p>The left and right subtrees themselves <em>are just thunks</em>, because the tree is produces lazily, so they aren't consuming much space yet.</p>\n\n<p>We're only evaluating <code>go n (Tree _ l r)</code> because we're evaluating <code>depthNTree n t</code>, which is <code>go n t []</code>. So we're immediately forcing the two composed <code>go</code> calls we just turned the root into:</p>\n\n<pre><code>(go (n - 1) l . go (n - 1) r) []\n= (go (n - 1) l) ((go (n - 1) r) [])\n</code></pre>\n\n<p>And because this is lazily evaluated, we do the <em>outermost</em> call first, leaving <code>((go (n - 1) r) [])</code> as a thunk (and so not generating any more of <code>r</code>).</p>\n\n<p>Recursing into <code>go</code> will force <code>l</code>, so we do generate more of that. But then we do the same thing again one level down; again that tree node becomes garbage immediately, we generate two thunks holding the left and right sub sub trees, and then we force only the left one.</p>\n\n<p>After <code>n</code> calls we'll be evaluating <code>go 0 (Tree x _ _) = (x:)</code>. We've generated <code>n</code> pairs of thunks, and forced the <code>n</code> left ones, leaving the right ones in memory; because the right sub-trees are unevaluated thunks they're constant space each, and there are only <code>n</code> of them, so only <code>O(n)</code> space total. And all the tree nodes leading to this path are now unreferenced.</p>\n\n<p>We actually have the outermost list constructor (and the first element of the list). Forcing more of the list will explore those right sub-tree thunks further down the composition chain being built up, but there will never be more than <code>n</code> of them.</p>\n\n<hr>\n\n<p>Technically you have bound a reference to <code>tree 1</code> in the globally scoped <code>treeOne</code>, so actually you could retain a reference to every node you ever produce, so you're relying on GHC noticing that <code>treeOne</code> is only ever used once and shouldn't be retained.</p>\n"}, {"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1450881587, "post_id": 34435492, "comment_id": 56616780, "body": "This is also a very good answer but I can only accept one. All three were great thank you and they&#39;ve all got an upvote (and deserve more).."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1450872865, "creation_date": 1450872865, "answer_id": 34435492, "question_id": 34433757, "link": "https://stackoverflow.com/questions/34433757/how-the-haskell-garbage-collector-efficiently-collects-trees/34435492#34435492", "title": "How the Haskell garbage collector efficiently collects trees", "body": "<p>Let's rewrite the recursive case of <code>go</code> as</p>\n\n<pre><code>go n t = case t of\n           Tree _ l r -&gt; go (n - 1) l . go (n - 1) r\n</code></pre>\n\n<p>In the right-hand side of the case alternative, the original tree <code>t</code> is no longer live. Only <code>l</code> and <code>r</code> are live. So, if we recurse into <code>l</code> first, say, there is nothing keeping the left-hand side of the tree live except <code>l</code> itself; <code>r</code> exactly keeps the right-hand side of the tree alive.</p>\n\n<p>At any point in the recursion, the live nodes are exactly the roots of the subtrees cut off by the path from the original root of the tree to the node currently being inspected which have not already been processed. There are at most the length of said path of these subtrees, so the space usage is O(n).</p>\n\n<p>The key is that the original tree <code>t</code> becomes dead before we recurse. If you write the (denotationally equivalent, but bad style for a number of reasons)</p>\n\n<pre><code>leftChild (Tree _ l r) = l\nrightChild (Tree _ l r) = r\n\ngo n t = go (n - 1) (leftChild t) . go (n - 1) (rightChild t)\n</code></pre>\n\n<p>now when recursing into <code>go (n - 1) (leftChild t)</code>, there is still a live reference to <code>t</code> in the unevaluated expression <code>rightChild t</code>. Hence the space usage is now exponential.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1450874678, "last_edit_date": 1450874678, "creation_date": 1450873326, "answer_id": 34435625, "question_id": 34433757, "link": "https://stackoverflow.com/questions/34433757/how-the-haskell-garbage-collector-efficiently-collects-trees/34435625#34435625", "title": "How the Haskell garbage collector efficiently collects trees", "body": "<p>I wrote a little manual evaluation of a tree to depth 2. I hope it can illustrate why tree nodes can be garbage collected along the way.</p>\n\n<p>Suppose we start with a tree like this:</p>\n\n<pre><code>tree =\n  Tree\n    (Tree _          -- l\n       (Tree a _ _)    -- ll\n       (Tree b _ _))   -- lr\n    (Tree _          -- r\n       (Tree c _ _)    -- rl\n       (Tree d _ _))   -- rr\n</code></pre>\n\n<p>Now call <code>depthNTree 2 tree</code>:</p>\n\n<pre><code>go 2 tree []\ngo 2 (Tree _ l r) []            \ngo 1 l (go 1 r [])\ngo 1 (Tree _ ll lr) (go 1 r [])\ngo 0 ll (go 0 lr (go 1 r []))\ngo 0 (Tree a _ _) (go 0 lr (go 1 r []))\na : go 0 lr (go 1 r [])                   -- gc can collect ll\na : go 0 (Tree b _ _) (go 1 r [])\na : b : go 1 r []                         -- gc can collect lr and thus l\na : b : go 1 (Tree _ rl rr) []\na : b : go 0 rl (go 0 rr [])\na : b : go 0 (Tree c _ _) (go 0 rr [])\na : b : c : go 0 rr []                    -- gc can collect rl\na : b : c : go 0 (Tree d _ _) []\na : b : c : d : []                        -- gc can collect rr and thus r and tree\n</code></pre>\n\n<p>Note that since <code>treeOne</code> is a static value, there has to be some extra machinery behind the scenes to allow garbage collection of it. Fortunately GHC <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/GC/CAFs\" rel=\"nofollow\">supports GC</a> of static values. </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 34435625, "answer_count": 3, "score": 5, "last_activity_date": 1450874678, "creation_date": 1450867052, "last_edit_date": 1495542656, "question_id": 34433757, "link": "https://stackoverflow.com/questions/34433757/how-the-haskell-garbage-collector-efficiently-collects-trees", "title": "How the Haskell garbage collector efficiently collects trees", "body": "<p>This code from the answer to this <a href=\"https://stackoverflow.com/questions/34430622/reducing-space-usage-of-depth-first-tree-traversal/34432102#34432102\">question</a> copied below quite nicely takes only <code>O(n)</code> space to do a depth first traversal of a tree of depth <code>n</code> which contains <code>O(2^n)</code> nodes. This is very good, the garbage collector seems to be doing a good job of cleaning up the already processed tree.</p>\n\n<p>But my question I have is, how? Unlike a list, where once we process the first element we can completely forget it, we can't scrap the root node after processing the first leaf node. We have to wait until the left half the tree is processed (because eventually we'll have to traverse down the right from the root). Also, as the root node points to the nodes below it, and so on, all the way down to the leaves, which would seem to imply that we wouldn't be able to collect any of the first half of a tree until we start on the second half (as all those nodes will still have references to them starting from the still live root node). This fortunately is not the case, but could someone explain how?</p>\n\n<pre><code>import Data.List (foldl')\n\ndata Tree = Tree Int Tree Tree\n\ntree n = Tree n (tree (2 * n)) (tree (2 * n + 1))\ntreeOne = tree 1\n\ndepthNTree n t = go n t [] where\n  go 0 (Tree x _ _) = (x:)\n  go n (Tree _ l r) = go (n - 1) l . go (n - 1) r\n\nmain = do\n  x &lt;- getLine\n  print . foldl' (+) 0 . filter (\\x -&gt; x `rem` 5 == 0) $ depthNTree (read x) treeOne\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "ghc-mod"], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1450869935, "creation_date": 1450864957, "last_edit_date": 1450869935, "question_id": 34433055, "link": "https://stackoverflow.com/questions/34433055/get-the-full-type-signature-using-ghc-mod-m-x-ghc-show-type", "title": "Get the full type signature using ghc-mod (M-x ghc-show-type)", "body": "<p>Consider <code>Foo.hs</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Foo where\n\nfoo :: Num t =&gt; t\nfoo = 3\n</code></pre>\n\n<p>running <code>ghc-mod -type</code> on it like this only gives me the type <code>t</code> for the signature of <code>foo</code>, even though the declaration already has the full type signature attached to it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ghc-mod type src/Foo.hs 4 1\n4 1 4 8 \"t\"\n</code></pre>\n\n<p>This becomes highly limiting when wanting to use <code>ghc-mod</code> for adding a type to a declaration without one.</p>\n\n<p>Is there a way to get the full type from <code>ghc-mod</code>?</p>\n\n<p>Alternatively, what are the tools one can use in place of <code>ghc-mod</code> to achieve this? Can these tools be used alongside with <code>ghc-mod</code>, (for example in Emacs)?</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> <code>stack-ide</code> too reports the type to be just <code>t</code> not the full <code>Num t =&gt; t</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[nil] -&gt; {\"tag\":\"RequestGetExpTypes\",\"contents\":{\"spanFilePath\":\"src\\/Foo.hs\",\"spanFromLine\":4,\"spanFromColumn\":1,\"spanToLine\":4,\"spanToColumn\":4}}\n &lt;- {\"tag\":\"ResponseGetExpTypes\",\"contents\":[[\"t\",{\"spanFromLine\":4,\"spanFilePath\":\"src/Foo.hs\",\"spanToColumn\":4,\"spanFromColumn\":1,\"spanToLine\":4}]]}\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 5710386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ceba3a224b85ddd3b00282b41a2da396?s=128&d=identicon&r=PG&f=1", "display_name": "SuspiciousPineapple", "link": "https://stackoverflow.com/users/5710386/suspiciouspineapple"}, "edited": false, "score": 0, "creation_date": 1450867541, "post_id": 34432078, "comment_id": 56608523, "body": "So I get that g is of type (b -&gt; a -&gt; b) but then how do I infer the type of g . g x?"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 95, "user_id": 5710386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ceba3a224b85ddd3b00282b41a2da396?s=128&d=identicon&r=PG&f=1", "display_name": "SuspiciousPineapple", "link": "https://stackoverflow.com/users/5710386/suspiciouspineapple"}, "edited": false, "score": 0, "creation_date": 1450885677, "post_id": 34432078, "comment_id": 56619267, "body": "@SendMeMemes check out the signature of composition operator <code>(y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z</code> and match it with the types of its arguments: <code>g</code> and <code>g x</code>."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 11, "last_activity_date": 1450861766, "creation_date": 1450861766, "answer_id": 34432078, "question_id": 34431886, "link": "https://stackoverflow.com/questions/34431886/type-of-f-g-x-g-g-x/34432078#34432078", "title": "Type of f g x = g . g x", "body": "<p>Note that function application has the highest priority; operators come later.</p>\n\n<p>So, the term <code>g . g x</code> first applies <code>g</code> to <code>x</code>, and then composes the result and <code>g</code> itself. If <code>x</code> has type <code>b</code>, <code>g</code> must have type <code>b -&gt; c</code>. Since we compose <code>g</code> with <code>g x</code> (the latter of type <code>c</code>), <code>c</code> must be a function type returning <code>b</code>, so <code>c = a -&gt; b</code>. Now, the type of <code>g</code> is <code>b -&gt; a -&gt; b</code> and the type of <code>g . g x</code> is <code>a -&gt; (a -&gt; b)</code>; the type of <code>f</code> happens to be <code>(b -&gt; a -&gt; b) -&gt; b -&gt; a -&gt; a -&gt; b</code>.</p>\n\n<p>If you wanted something like <code>(a -&gt; a) -&gt; a -&gt; a</code> instead, you could try one of this</p>\n\n<pre><code>f g x = g (g x)\nf g x = (g . g) x\nf g x = g . g $ x\nf g = g . g\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2138, "user_id": 2794292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e3e4f141c783c6562d345d77f685417?s=128&d=identicon&r=PG&f=1", "display_name": "concept3d", "link": "https://stackoverflow.com/users/2794292/concept3d"}, "is_accepted": false, "score": 2, "last_activity_date": 1450862239, "creation_date": 1450862239, "answer_id": 34432211, "question_id": 34431886, "link": "https://stackoverflow.com/questions/34431886/type-of-f-g-x-g-g-x/34432211#34432211", "title": "Type of f g x = g . g x", "body": "<p>The idea is about understanding the <code>(.)</code> operator, it has a type of</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>It takes two functions each with <em>one</em> parameter and compose them, after applying <code>g x</code> the compiler assumed <code>g</code> is actually <code>g :: a -&gt; b -&gt; c</code> in order to satisfy the signature of <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> which takes two functions with one argument. Otherwise the code won't compile. </p>\n\n<p>And finally if you want the signature <code>f :: (t -&gt; t) -&gt; t -&gt; t</code> you need something like this:</p>\n\n<pre><code>\u03bb&gt; let applyTwice g = g.g\n\u03bb&gt; :t applyTwice\napplyTwice :: (a -&gt; a) -&gt; a -&gt; a\n\u03bb&gt; applyTwice (*2) 3\n12\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 5710386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ceba3a224b85ddd3b00282b41a2da396?s=128&d=identicon&r=PG&f=1", "display_name": "SuspiciousPineapple", "link": "https://stackoverflow.com/users/5710386/suspiciouspineapple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 34432078, "answer_count": 2, "score": 6, "last_activity_date": 1450862239, "creation_date": 1450861020, "question_id": 34431886, "link": "https://stackoverflow.com/questions/34431886/type-of-f-g-x-g-g-x", "title": "Type of f g x = g . g x", "body": "<p>It is not clear to me why the function defined as</p>\n\n<pre><code>f g x = g . g x\n</code></pre>\n\n<p>has the type</p>\n\n<pre><code>f :: (b -&gt; a -&gt; b) -&gt; b -&gt; a -&gt; a -&gt; b\n</code></pre>\n\n<p>I would have thought it would be of type</p>\n\n<pre><code>f :: (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>Can anyone explain to me how the expression is broken down? Thanks!</p>\n"}, {"tags": ["haskell", "functional-programming", "arrows"], "comments": [{"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 6, "creation_date": 1450861427, "post_id": 34431291, "comment_id": 56604897, "body": "Here&#39;s a working link to the cited paper: <a href=\"http://www.csee.ogi.edu/~krstics/psfiles/hyperfunctions.pdf\" rel=\"nofollow noreferrer\">csee.ogi.edu/~krstics/psfiles/hyperfunctions.pdf</a> from here <a href=\"http://www.csee.ogi.edu/~krstics/\" rel=\"nofollow noreferrer\">csee.ogi.edu/~krstics</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 5, "creation_date": 1450862078, "post_id": 34431291, "comment_id": 56605241, "body": "Plus <a href=\"http://arxiv.org/pdf/1309.5135.pdf\" rel=\"nofollow noreferrer\">another one</a> in Haskell context."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 11, "creation_date": 1450864196, "post_id": 34431905, "comment_id": 56606449, "body": "&quot;innitely&quot; adv. - The result of copy&amp;pasting the word &quot;infinitely&quot; from a PDF which used a ligature to represent &quot;fi&quot;, when the copy machinery did not know how to translate it back into characters. ;-)"}, {"owner": {"reputation": 4418, "user_id": 1103705, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fa36ad5f4b3bda5f6975bd21773f032c?s=128&d=identicon&r=PG", "display_name": "enobayram", "link": "https://stackoverflow.com/users/1103705/enobayram"}, "edited": false, "score": 0, "creation_date": 1588147270, "post_id": 34431905, "comment_id": 108784759, "body": "&quot;I could find something here&quot; Now that link is dead too :( the internet is a dying place."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 7, "last_activity_date": 1450864707, "last_edit_date": 1450864707, "creation_date": 1450861082, "answer_id": 34431905, "question_id": 34431291, "link": "https://stackoverflow.com/questions/34431291/what-are-hyperfunctions-in-the-context-of-computer-science/34431905#34431905", "title": "What are hyperfunctions in the context of computer science?", "body": "<p>I could find something here: <a href=\"http://www.citeulike.org/user/Benja/author/Launchbury:J\">http://www.citeulike.org/user/Benja/author/Launchbury:J</a> </p>\n\n<blockquote>\n  <p>Abstract<br>\n  Hyperfunctions from <code>A</code> to <code>B</code> are elements of the infinitely\n  nested function type </p>\n\n<pre><code>[A; B] = (((...) -&gt; A) -&gt; B) -&gt; A) -&gt; B: ...\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 4, "answer_count": 1, "score": 20, "last_activity_date": 1450864707, "creation_date": 1450858377, "question_id": 34431291, "link": "https://stackoverflow.com/questions/34431291/what-are-hyperfunctions-in-the-context-of-computer-science", "title": "What are hyperfunctions in the context of computer science?", "body": "<p>In <a href=\"https://www.haskell.org/arrows/\" rel=\"noreferrer\">Arrows: A General Interface to Computation</a> I found this brief remark on hyperfunctions:</p>\n\n<blockquote>\n  <p>The weird datatype</p>\n\n<pre><code>newtype Hyper b c = H (Hyper c b -&gt; c)\n</code></pre>\n  \n  <p>can be shown to be an arrow [KLP01].</p>\n</blockquote>\n\n<p>but the link to the paper is broken.</p>\n\n<p>There is also <a href=\"https://hackage.haskell.org/package/hyperfunctions-0/docs/Control-Monad-Hyper.html\" rel=\"noreferrer\">hyperfunctions</a> package on Hackage.</p>\n\n<p>Neither provides any explanation of what they are and what are their properties.</p>\n\n<p>So what are hyperfunctions, how are they useful and what are their properties?</p>\n\n<hr>\n\n<p><sup>Apparently the same name is used for something completely different <a href=\"https://en.wikipedia.org/wiki/Hyperfunction\" rel=\"noreferrer\">in the context of holomorphic functions</a></sup></p>\n\n<p><sup>As I know almost nothing about the concept, I just guessed the tags from my current references coming from Haskell/FP, feel free to correct them.</sup></p>\n"}, {"tags": ["haskell", "garbage-collection"], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1450867135, "post_id": 34432102, "comment_id": 56608282, "body": "Thank you for this great answer. I&#39;ve also asked a follow up question on how the garbage collector actually achieves what you have: <a href=\"http://stackoverflow.com/questions/34433757/how-the-haskell-garbage-collector-works\" title=\"how the haskell garbage collector works\">stackoverflow.com/questions/34433757/&hellip;</a>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1505847935, "post_id": 34432102, "comment_id": 79577941, "body": "I fielded some questions about this answer in IRC today, and I think one part of it is a bit misleading. The problem with the original code isn&#39;t that an accumulator exists at all, it&#39;s that the accumulator works from back-to-front, which is the inherently non-productive part. I think this clarification is worthwhile to make."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1505855622, "post_id": 34432102, "comment_id": 79581589, "body": "@Carl I don&#39;t think accumulated results can ever be productive. Maybe we use the terminology differently. Even if we mix accumulators with guarded recursion (e. g. as in <code>enumFrom</code>), productivity comes solely from guardedness, never from accumulation."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1506033951, "post_id": 34432102, "comment_id": 79668472, "body": "I had to take a while to think it through thoroughly. But I&#39;m sure my analysis is reasonable now. Your last version uses an accumulator. Eta-expand the definition of <code>go</code>and you&#39;ll see where it was hiding. We could argue about the definition of &quot;accumulator&quot; a bit, especially in the context of non-strict evaluation, but that last argument would definitely be an accumulator in a strict language. I think it remains one in a non-strict language. I accept that my definition isn&#39;t ever going to be universal, but I think it has merit."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1506064933, "post_id": 34432102, "comment_id": 79677687, "body": "@Carl yeah, I think now that my word choice does not precisely address the OP. Edited."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1506064843, "last_edit_date": 1506064843, "creation_date": 1450861876, "answer_id": 34432102, "question_id": 34430622, "link": "https://stackoverflow.com/questions/34430622/reducing-space-usage-of-depth-first-tree-traversal/34432102#34432102", "title": "Reducing space usage of depth first tree traversal", "body": "<p>Your <code>depthNTree</code> uses <code>2^n</code> space because you keep the left subtree around through <code>t1</code> while you're traversing the right subtree. The recursive call on the right subtree should contain no reference to the left, as a necessary condition for incrementally garbage collected traversals.</p>\n\n<p>The naive version works acceptably in this example:</p>\n\n<pre><code>depthNTree n t = go n t where\n  go 0 (Tree x _ _) = [x]\n  go n (Tree _ l r) = go (n - 1) l ++ go (n - 1) r\n</code></pre>\n\n<p>Now <code>main</code> with input 24 uses 2 MB space, while the original version used 1820 MB. The optimal solution here is similar as above, except it uses difference lists:</p>\n\n<pre><code>depthNTree n t = go n t [] where\n  go 0 (Tree x _ _) = (x:)\n  go n (Tree _ l r) = go (n - 1) l . go (n - 1) r\n</code></pre>\n\n<p>This isn't much faster than the plain list version in many cases, because with tree-depths around 20-30 the left nesting of <code>++</code> isn't very costly. The difference becomes more pronounced if we use large tree depths:</p>\n\n<pre><code>print $ sum $ take 10 $ depthNTree 1000000 treeOne\n</code></pre>\n\n<p>On my computer, this runs in 0.25 secs with difference lists and 1.6 secs with lists. </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 34432102, "answer_count": 1, "score": 3, "last_activity_date": 1506064843, "creation_date": 1450855384, "question_id": 34430622, "link": "https://stackoverflow.com/questions/34430622/reducing-space-usage-of-depth-first-tree-traversal", "title": "Reducing space usage of depth first tree traversal", "body": "<p>In Haskell, one can do filters, sums, etc on infinite lists in constant space, because Haskell only produces list nodes when needed, and garbage collects ones it's finished with.</p>\n\n<p>I'd like this to work with infinite trees.</p>\n\n<p>Below is a rather silly program that generates a infinite binary tree with nodes representing the natural numbers.</p>\n\n<p>I've then written a function that does a depth first traversal of this tree, spitting out the nodes at a particular level.</p>\n\n<p>Then I've done a quick sum on the nodes divisable by 5.</p>\n\n<p>In theory, this algorithm could be implemented in <code>O(n)</code> space for an <code>n</code> depth tree of <code>O(2^n)</code> nodes. Just generate the tree on the fly, removing the nodes you've already completed processing.</p>\n\n<p>Haskell does generate the tree on the fly, but doesn't garbage collect the nodes it seems.</p>\n\n<p>Below is the code, I'd like to see code with a similar effect but that doesn't require <code>O(2^n)</code> space.</p>\n\n<pre><code>import Data.List (foldl')\n\ndata Tree = Tree Int Tree Tree\n\ntree n = Tree n (tree (2 * n)) (tree (2 * n + 1))\ntreeOne = tree 1\n\ndepthNTree n x = go n x id [] where\n  go :: Int -&gt; Tree -&gt; ([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]\n  go 0 (Tree x _ _) acc rest = acc (x:rest)\n  go n (Tree _ left right) acc rest = t2 rest where \n    t1 = go (n - 1) left acc\n    t2 = go (n - 1) right t1\n\nmain = do\n  x &lt;- getLine\n  print . foldl' (+) 0 . filter (\\x -&gt; x `rem` 5 == 0) $ depthNTree (read x) treeOne\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450864905, "post_id": 34426601, "comment_id": 56606853, "body": "Somehow, I was expecting <code>\\s-&gt;s{fooId=4::Int}</code> to be of type <code>Foo Int -&gt; Foo Int</code>, when it actually is of the more general type <code>Foo a -&gt; Foo Int</code>. I wonder how often this &quot;feature&quot; is exploited in actual code -- right now I can only spot where it prevents type inference, like in the code above."}], "answers": [{"comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1450873624, "post_id": 34428488, "comment_id": 56612180, "body": "Oh. I guess I did miss the fact that one can define a Default instance specialized to a given type with different values, although a Default instance for <code>Foo a</code> is already defined. Makes sense. Good point, thanks :)"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1450844504, "last_edit_date": 1450844504, "creation_date": 1450843694, "answer_id": 34428488, "question_id": 34426601, "link": "https://stackoverflow.com/questions/34426601/ambiguous-def-with-record-update-syntax/34428488#34428488", "title": "ambiguous def with record update syntax", "body": "<p>It seems you've gotten to the root of the problem. All that's left after that is aesthetics.</p>\n\n<p>I can understand the bias against another global binding. How about a local one?</p>\n\n<pre><code>fooList :: [Foo Int]\nfooList = let def = Data.Default.Class.def :: Foo Int in\n  [ def { fooId = 0, fooName = \"one\" }\n  , def { fooId = 1 }\n  , def { fooId = 2, fooName = \"three\", fooCount = 42 }\n  ...\n  ]\n</code></pre>\n\n<p>You can make that a little less awkward if you're willing to forgo <code>def</code> as the record name:</p>\n\n<pre><code>fooList :: [Foo Int]\nfooList = let d = def :: Foo Int in\n  [ d { fooId = 0, fooName = \"one\" }\n  , d { fooId = 1 }\n  , d { fooId = 2, fooName = \"three\", fooCount = 42 }\n  ...\n  ]\n</code></pre>\n\n<p>As for this</p>\n\n<blockquote>\n  <p>Does it even matter how GHC infers the type for def in this case? </p>\n</blockquote>\n\n<p>Sure it does! Suppose someone also defines this in another file:</p>\n\n<pre><code> data MyCustomDataType = Mwahahaha -- note, has no `Default` instance\n instance Default (Foo MyCustomDataType) where\n   def = Foo\n     { fooId = Mwahahaha\n     , fooName = \"bar\"\n     , fooCount = 3\n     }\n</code></pre>\n\n<p>And links it against your already-compiled code. Type class instances are global (the \"open world\" assumption), so their instance is available to your code.</p>\n\n<p>So now, when given <code>def :: Foo a</code> for some <code>a</code>, there's two possibilities:</p>\n\n<ul>\n<li><code>Default a</code>, which implies <code>fooName def == \"foo\"</code>.</li>\n<li><code>a ~ MyCustomDataType</code>, which implies <code>fooName def == \"bar\"</code>.</li>\n</ul>\n\n<p>This is an ambiguity it can't resolve.</p>\n\n<p>If you want to close the world - prevent an ambiguity like this from being introduced, you have to tell ghc <em>how</em>.</p>\n"}], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 34428488, "answer_count": 1, "score": 2, "last_activity_date": 1450844504, "creation_date": 1450829350, "question_id": 34426601, "link": "https://stackoverflow.com/questions/34426601/ambiguous-def-with-record-update-syntax", "title": "ambiguous def with record update syntax", "body": "<p>Example:</p>\n\n<pre><code>data Foo a\n   = Foo { fooId :: a\n         , fooName :: String\n         , fooCount :: Int\n         }\n\ninstance Default a =&gt; Default (Foo a) where\n  def = Foo\n    { fooId = def\n    , fooName = \"foo\"\n    , fooCount = 0\n    }\n\n-- this is ok\nx :: Foo Int\nx = def { fooName = \"good\" }\n\n-- error, type of def is ambiguous (a could be anything with a Default instance)\ny :: Foo Int\ny = def { fooId = 2 }\n\n-- ok again\nz :: Foo Int\nz = (def :: Foo Int) { fooId = 2 }\n</code></pre>\n\n<p>I think I understand why it's ambigouous. That is not the question. Imagine:</p>\n\n<pre><code>fooList :: [Foo Int]\nfooList =\n  [ (def :: Foo Int) { fooId = 0, fooName = \"one\" }\n  , (def :: Foo Int) { fooId = 1 }\n  , (def :: Foo Int) { fooId = 2, fooName = \"three\", fooCount = 42 }\n  ...\n  ]\n</code></pre>\n\n<p>Instead I would like to write:</p>\n\n<pre><code>fooList :: [Foo Int]\nfooList =\n  [ def { fooId = 0, fooName = \"one\" }\n  , def { fooId = 1 }\n  , def { fooId = 2, fooName = \"three\", fooCount = 42 }\n  ...\n  ]\n</code></pre>\n\n<p>Does it even matter how GHC infers the type for def in this case? Could be <code>Foo (Maybe SomethingReallyCrazy)</code> for all I care. I am overwriting it right then and there into <code>Foo Int</code> (or it has to be that to begin with).</p>\n\n<p>I guess defining:</p>\n\n<pre><code>defFoo :: Foo Int\ndefFoo = def\n</code></pre>\n\n<p>would be a workaround, but... it's ugly. Is there a nicer way to do it? Some language extension I'm missing?</p>\n"}, {"tags": ["scala", "haskell", "clojure"], "comments": [{"owner": {"reputation": 87536, "user_id": 90801, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6acc4764438b6f3e80e9645ec8259353?s=128&d=identicon&r=PG", "display_name": "Arthur Ulfeldt", "link": "https://stackoverflow.com/users/90801/arthur-ulfeldt"}, "edited": false, "score": 0, "creation_date": 1450912345, "post_id": 34426278, "comment_id": 56632131, "body": "&lt; joke &gt; does the EFF monad protect your other monads online rights? &lt; /joke &gt; I&#39;m assuming you want an answer beyond them both being touring complete languages and therefore the same actions are possible on both languages? Mind if I change the title to &quot;How to write the Emm monad in Clojure?&quot;"}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 87536, "user_id": 90801, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6acc4764438b6f3e80e9645ec8259353?s=128&d=identicon&r=PG", "display_name": "Arthur Ulfeldt", "link": "https://stackoverflow.com/users/90801/arthur-ulfeldt"}, "edited": false, "score": 0, "creation_date": 1450917726, "post_id": 34426278, "comment_id": 56633639, "body": "Thanks Arthur - if you think that would be helpful. I would argue that it is unnecessary because the other times monad in clojure questions have been asked it was in this format - so changing the title should be unnecessary and would make it inconsistent, but I&#39;ll defer to your judgement. The question about whether it is possible has to do with the nature of types in different languages. Please change away if you think it best."}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1475293643, "creation_date": 1450827456, "last_edit_date": 1495542792, "question_id": 34426278, "link": "https://stackoverflow.com/questions/34426278/is-it-possible-to-do-the-emm-monad-in-clojure", "title": "Is it possible to do the Emm Monad in Clojure?", "body": "<p>We've seen the <a href=\"https://stackoverflow.com/questions/20171057/is-it-possible-to-do-the-free-monad-in-clojure\">Free Monad</a>, <a href=\"https://stackoverflow.com/questions/21550510/is-it-possible-to-do-the-reader-monad-from-haskell-in-clojure\">The Reader Monad</a> and the <a href=\"https://stackoverflow.com/questions/21826665/is-it-possible-to-do-the-io-monad-from-haskell-in-clojure\">IO Monad</a> in Clojure. </p>\n\n<p>We've seen the <a href=\"http://okmij.org/ftp/Haskell/extensible/\" rel=\"nofollow noreferrer\">Eff Monad</a> - which is a better Monad transformer in Haskell.</p>\n\n<p>We've also seen <a href=\"http://www.clojure.net/2012/03/05/Transformers/\" rel=\"nofollow noreferrer\">Monad Transformers</a>, and the <a href=\"http://www.clojure.net/assets/LiveFree.pdf\" rel=\"nofollow noreferrer\">free Monad transformer</a> <a href=\"http://www.clojure.net/2014/05/07/Free-Transformers/\" rel=\"nofollow noreferrer\">in Clojure</a>. </p>\n\n<p><a href=\"https://www.linkedin.com/in/djspiewak\" rel=\"nofollow noreferrer\">Daniel Spiewak</a> has sought to improve on the Eff Monad, with <a href=\"https://github.com/djspiewak/emm\" rel=\"nofollow noreferrer\">the Emm Monad in Scala</a>. It looks like this: </p>\n\n<pre><code>def readName: Task[String] = ???\ndef log(msg: String): Task[Unit] = ???\n\ntype E = Task |: Option |: Base\n\nval effect: Emm[E, String] = for {\n  first &lt;- readName.liftM[E]\n  last &lt;- readName.liftM[E]\n\n  name &lt;- (if ((first.length * last.length) &lt; 20) Some(s\"$first $last\") else None).liftM[E]\n\n  _ &lt;- log(s\"successfully read in $name\").liftM[E]\n} yield name\n</code></pre>\n\n<p>My question is: <strong>Is it possible to do the Eff Monad in Clojure?</strong></p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450827817, "post_id": 34426060, "comment_id": 56594106, "body": "Do you mean <code>reprX :: Sing X -&gt; String</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450828251, "post_id": 34426060, "comment_id": 56594229, "body": "is <code>reprX :: HasRepr t =&gt; Sing (&#39;Names t) -&gt; String; reprX (SNames sTy) = repr sTy</code> good for your case?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450846205, "post_id": 34426060, "comment_id": 56598633, "body": "It&#39;s not. I can&#39;t in general expose the type which needs the constraint I don&#39;t think. I need the parameter to <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/Api.hs#L88\" rel=\"nofollow noreferrer\"><code>Cors</code></a> to have a constraint <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/Cors.hs#L24\" rel=\"nofollow noreferrer\"><code>CorsPolicy</code></a> so that I can use it in <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/SServer.hs#L38\" rel=\"nofollow noreferrer\"><code>server</code></a> down on <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/SServer.hs#L100\" rel=\"nofollow noreferrer\">this line</a>."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450846268, "post_id": 34426060, "comment_id": 56598659, "body": "It&#39;s perhaps possible for me to analyze the entire <code>api</code> type to find the proper/needed constraints\u2014I&#39;m tempted to do this\u2014but it seems really inelegant."}], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1450826285, "creation_date": 1450826285, "question_id": 34426060, "link": "https://stackoverflow.com/questions/34426060/singletons-capturing-dictionaries", "title": "Singletons capturing dictionaries", "body": "<p>What is the best way to capture a typeclass constraint in a singleton?</p>\n\n<p>For instance, let's say that I have the types, kinds, and classes</p>\n\n<pre><code>singletons\n  [d|\n    data Names star = Names star\n  |]\n\nclass HasRepr a where\n  repr :: proxy a -&gt; String\n</code></pre>\n\n<p>where I'd like to be able to construct types like</p>\n\n<pre><code>type X = 'Names Int\n</code></pre>\n\n<p>retrieve their singletons</p>\n\n<pre><code>singX :: Sing X\nsingX = sing\n</code></pre>\n\n<p>and then destruct it into its representation</p>\n\n<pre><code>reprX :: String\nreprX (SNames sTy) = repr sTy\n</code></pre>\n\n<p>but if I generalize this it fails with an error like</p>\n\n<pre><code>Could not deduce (HasRepr n2) arising from a use of \u2018repr\u2019\nfrom the context ...\n</code></pre>\n\n<p>Is there a way to make this work?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450817111, "post_id": 34423748, "comment_id": 56589917, "body": "<code>TraversalR</code> doesn&#39;t seem good. With <code>Traversal</code>, you can do stateful traversal and e. g. replace each <code>a</code> with the index of their position. With <code>(a -&gt; b) -&gt; s -&gt; t</code>, that&#39;s not possible."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450817510, "post_id": 34423748, "comment_id": 56590085, "body": "Oh OK - I hadn&#39;t realised.  What should TraversalR look like then, do you think?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450817855, "post_id": 34423748, "comment_id": 56590226, "body": "<code>overR :: [b] -&gt; s -&gt; t</code> would make <code>TraversalR</code> quite similar to <a href=\"https://hackage.haskell.org/package/uniplate-1.6.12/docs/Data-Generics-Uniplate-Operations.html#t:Biplate\" rel=\"nofollow noreferrer\"><code>biplate</code></a>, so that might worth a try."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450818198, "post_id": 34423748, "comment_id": 56590392, "body": "I&#39;m not sure though."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450818541, "post_id": 34423748, "comment_id": 56590532, "body": "I may be wrong, but don&#39;t think that has solved my problem with defining magic above - how do I get the new values into the foci?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450826437, "post_id": 34423748, "comment_id": 56593639, "body": "<a href=\"https://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Traversal.html#g:4\" rel=\"nofollow noreferrer\"><code>unsafePartsOf</code></a> in <code>lens</code> can do that. The implementation could be hard to understand, but if you know that <code>newtype Bazaar a b t = Bazaar (forall f. Applicative f =&gt; (a -&gt; f b) -&gt; f t)</code> and its <code>Applicative</code> instance can be used to solve this, you&#39;re on the right track."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450867984, "post_id": 34423748, "comment_id": 56608779, "body": "@Andr&#225;sKov&#225;cs I&#39;m stumped.  I&#39;m guessing that I need to make a clever choice of Applicative to feed to the traversal, but Bazaar doesn&#39;t seem to be it: the best I can do is  <code>runBazaar $ tr (\\a -&gt; Bazaar ($ a)) s :: forall f. Applicative f =&gt; (a -&gt; f b) -&gt; f t</code>.  But then I&#39;m back where I started, surely?"}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450874603, "post_id": 34423748, "comment_id": 56612753, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/98810/discussion-between-rhubarbandc-and-andras-kovacs\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "is_accepted": true, "score": 2, "last_activity_date": 1450884153, "creation_date": 1450884153, "answer_id": 34438765, "question_id": 34423748, "link": "https://stackoverflow.com/questions/34423748/control-lens-traversal-isomorphism-to-tolistof-and-over/34438765#34438765", "title": "Control.Lens: Traversal isomorphism to toListOf and over", "body": "<p>After a discussion with Andr\u00e1s Kov\u00e1cs, I have found a nice simple answer: we need the State monad, which is an applicative functor.  Here is the whole isomorphism:</p>\n\n<pre><code>type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; (s -&gt; f t)\n\ndata TraversalR s t a b = TraversalR {\n  toListOfR :: s -&gt; [a],\n  setListR  :: [b] -&gt; s -&gt; t\n}\n\nnewtype CL a b = CL { getCL :: [a] }  -- ConstantList\n\ninstance Functor (CL a) where \n  fmap _ (CL xs) = CL xs\n\ninstance Applicative (CL a) where\n  pure _ = CL []\n  (CL xs) &lt;*&gt; (CL ys) = CL (xs ++ ys)\n\ncollectBs :: State [b] b\ncollectBs = state $ \\xs -&gt; case xs of []     -&gt; error \"Too few bs\"\n                                      (y:ys) -&gt; (y,ys)\n\ntravToTravR :: Traversal s t a b -&gt; TraversalR s t a b\ntravToTravR tr = TraversalR {\n  toListOfR = getCL . tr (CL . pure),\n  setListR = \\bs s -&gt; evalState (tr (const collectBs) s) bs\n}\n\ntravRToTrav :: TraversalR s t a b -&gt; Traversal s t a b\ntravRToTrav trR a2fb s = (`setL` s) &lt;$&gt; f_bs\n   where as = toListOfR trR s\n         f_bs = sequenceA . map a2fb $ as\n         setL = setListR trR\n</code></pre>\n"}], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 2, "accepted_answer_id": 34438765, "answer_count": 1, "score": 5, "last_activity_date": 1450884153, "creation_date": 1450815154, "last_edit_date": 1450821605, "question_id": 34423748, "link": "https://stackoverflow.com/questions/34423748/control-lens-traversal-isomorphism-to-tolistof-and-over", "title": "Control.Lens: Traversal isomorphism to toListOf and over", "body": "<p>I watched Simon Peyton Jones' talk about Control.Lens, and he showed that Lens and LensR as defined here are isomorphic:</p>\n\n<pre><code>type Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n\ndata LensR s t a b = LensR { \n    viewR :: s -&gt; a,\n    setR  :: b -&gt; s -&gt; t\n}\n</code></pre>\n\n<p>I'm trying to do the same with Traversal:</p>\n\n<pre><code>type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n\ndata TraversalR s t a b = TraversalR {\n    toListOfR :: s -&gt; [a],\n    overR :: (a -&gt; b) -&gt; s -&gt; t\n}\n\nnewtype CL a b = CL { getCL :: [a] }  -- ConstantList\n\ninstance Functor (CL a) where\n  fmap _ (CL xs) = CL xs\n\ninstance Applicative (CL a) where\n  pure _ = CL []\n  (CL xs) &lt;*&gt; (CL ys) = CL (xs ++ ys)\n\n\ntravToTravR :: Traversal s t a b -&gt; TraversalR s t a b\ntravToTravR tr = TraversalR {\n    toListOfR = getCL . tr (CL . pure),\n    overR = \\f -&gt; runIdentity . tr (Identity . f)\n}\n</code></pre>\n\n<p>But I'm stuck with travRToTrav.  This is the best I can come up with:</p>\n\n<pre><code>travRToTrav :: TraversalR s t a b -&gt; Traversal s t a b\ntravRToTrav trR a2fb s = (\\bs-&gt; overR trR magic s) &lt;$&gt; f_bs\n  where as = toListOfR trR s\n        f_bs = sequenceA . map a2fb $ as\n        magic = undefined\n</code></pre>\n\n<p>Here, magic :: a -> b, but I can't make a general function (a -> b).  Instead, I can cheat, by making a partial function: I know what the function should return for any value of type a that is in traversable.  So I could make an association list from as and bs, and then a partial function from this.</p>\n\n<p>Does this work?  If so, please tell me there's a better way!</p>\n\n<p>Or have I picked the wrong form for TraversableR, and there is actually no isomorphism?</p>\n\n<p>Thanks for any advice.</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>So thanks to Andr\u00e1s Kov\u00e1cs I now think that TraversalR should look like this:</p>\n\n<pre><code>data TraversalR s t a b = TraversalR {\n  toListOfR :: s -&gt; [a],\n  setListR  :: [b] -&gt; s -&gt; t\n}\n</code></pre>\n\n<p>Then travRToTrav is very similar to lensRToLens:</p>\n\n<pre><code>travRToTrav :: TraversalR s t a b -&gt; Traversal s t a b\ntravRToTrav trR a2fb s = (`setL` s) &lt;$&gt; f_bs\n   where as = toListOfR trR s\n         f_bs = sequenceA . map a2fb $ as\n         setL = setListR trR\n</code></pre>\n\n<p>But then, how to define setListR in travToTravR?  Basically, how do indexed traversals work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1450814873, "post_id": 34423444, "comment_id": 56588897, "body": "btw: you are talking about lists here - array are quite different beasts in Haskell ;)"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1450814906, "post_id": 34423444, "comment_id": 56588909, "body": "Pretty sure you meant something like <code>isaprefix (a !! (n - 1)) (b !! (n - 1))</code> as the syntax <code>a[n-1]</code> does not have any meaning in Haskell. (More accurately it is a function being applied to a one-element list of some element of the <code>Num</code> typeclass.)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1450815078, "post_id": 34423444, "comment_id": 56588979, "body": "CR gave you the answer - but you can find it yourself if you look for <a href=\"https://www.haskell.org/hoogle/?hoogle=prefix\" rel=\"nofollow noreferrer\"><code>prefix</code> on Hoogle</a> you&#39;ll find <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:isPrefixOf\" rel=\"nofollow noreferrer\">this</a> and a click on <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Data.OldList.html#isPrefixOf\" rel=\"nofollow noreferrer\">source code</a> reveals the same implementation ;)"}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1450827648, "post_id": 34423444, "comment_id": 56594046, "body": "@CRDrost That&#39;s not what he meant either. He meant that in the if check, but the body of the if statement doesn&#39;t really make any sense. It doesn&#39;t type check for multiple reasons. I can&#39;t even come up with a simple way of correcting it."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1450827741, "post_id": 34423444, "comment_id": 56594082, "body": "Maybe just <code>isaprefix a b (n-1)</code> and then you call it with <code>isaprefix a b (length a - 1)</code> or something. But then if <code>n == 0</code>, you should return <code>a !! 0 == b !! 0</code> instead of True."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 8, "last_activity_date": 1450814679, "creation_date": 1450814679, "answer_id": 34423643, "question_id": 34423444, "link": "https://stackoverflow.com/questions/34423444/creating-a-simple-array-in-haskell/34423643#34423643", "title": "Creating a simple array in Haskell", "body": "<p>Yes, there is. You use pattern matching:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- type signature can be slightly more general: any list of equatables.\nisaprefix :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool\n\n-- first are the two \"boring\" cases.\n-- we define that empty lists are prefixes of everything.\nisaprefix [] _ = True\n\n-- then: we also define that you can't be the prefix of an empty list.\nisaprefix _ [] = False\n\n-- those 2 are technically in conflict, so you need to know that the empty list is defined,\n-- by the order of those definitions, to be a prefix of the empty list.  This supports the\n-- general property that `isprefixof x x == True` for all `x`.\n\n-- ok, now here's the more interesting pattern: both lists are nonempty. We need them to\n-- match on their first elements and also for the rest of the first list to prefix the \n-- rest of the second list.\nisaprefix (a:as) (b:bs)\n    | a == b     = isaprefix as bs\n    | otherwise  = False\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5708610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34cc4e63ff007ff07b8da91c49e10742?s=128&d=identicon&r=PG&f=1", "display_name": "beld", "link": "https://stackoverflow.com/users/5708610/beld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 34423643, "answer_count": 1, "score": 1, "last_activity_date": 1450815065, "creation_date": 1450813907, "question_id": 34423444, "link": "https://stackoverflow.com/questions/34423444/creating-a-simple-array-in-haskell", "title": "Creating a simple array in Haskell", "body": "<p>I'm a newbie regarding Haskell (and Java for that matter) and I tried to find a solution to my probably very simple problem. I need to create two arrays where it checks if the first array is a prefix of the second one, for example [5,6,7] [5,6,7,6,2] would give me the boolean true.\nThis is what I tried, however I have no idea how to declare an array. n should be the highest slot number of array a and it counts down. As soon as one slot of a doesn't equal b it should return False. Is there another way to implement it without the n variable? </p>\n\n<pre><code>isaprefix :: [Int] -&gt; [Int] -&gt; Int -&gt; Bool\nisaprefix a b n = if n==0\n            then True\n            else\n                if a[n] == b [n]\n                then isaprefix ((a[n-1]) (b[n-1]))\n                else False\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450815073, "post_id": 34423279, "comment_id": 56588976, "body": "After you fix your function up, you might like to think about how you could build this out of existing functions and without explicit recursion. (Spoilers: base64 decode <code>cm90YXRlTGVmdCA9IHJldmVyc2UgLiB0cmFuc3Bvc2UK</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 2, "last_activity_date": 1450814322, "creation_date": 1450814322, "answer_id": 34423544, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell/34423544#34423544", "title": "Rotate a matrix in Haskell", "body": "<p>Your list won't be empty but a list of empty lists, you can do the following to pattern match based on the first sublist (assuming Mat ensures data structure consistency)</p>\n\n<pre><code>rl [] = []\nrl ([]:_) = []\nrl m = map last m : (rl (map init m))\n\nrl mat\n[[3,5,6],[2,4,0],[1,0,0]]\n</code></pre>\n\n<p>You're missing the second case.</p>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 5497286, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/843873882983b83fad45d4763304d471?s=128&d=identicon&r=PG&f=1", "display_name": "dfridman1", "link": "https://stackoverflow.com/users/5497286/dfridman1"}, "is_accepted": false, "score": 0, "last_activity_date": 1450814326, "creation_date": 1450814326, "answer_id": 34423546, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell/34423546#34423546", "title": "Rotate a matrix in Haskell", "body": "<pre><code>rotateLeft []     = []\nrotateLeft ([]:_) = []\nrotateLeft (h:t)  = (map last (h:t)):(rotateLeft (map init (h:t)))\n</code></pre>\n\n<p>The first pattern is for the case when the head of the list of lists is longer than other elements.</p>\n\n<p>You got the second pattern wrong: if we have a proper matrix (ie elements are of the same length), then the base case is a list of empty lists. However, you wrote [[]], which is only true if the initial list consists of a single list.</p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1450814331, "creation_date": 1450814331, "answer_id": 34423547, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell/34423547#34423547", "title": "Rotate a matrix in Haskell", "body": "<p>The problem is that your pattern isn't matching. Stepping through what your code does, we start with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; let x = [[1,2,3],[0,4,5],[0,0,6]]\nPrelude&gt; :m +Data.List\nPrelude Data.List&gt; map last x\n[3,5,6]\nPrelude Data.List&gt; let y = map init x\nPrelude Data.List&gt; y\n[[1,2],[0,4],[0,0]]\nPrelude Data.List&gt; map last y\n[2,4,0]\nPrelude Data.List&gt; let z = map init y\nPrelude Data.List&gt; z\n[[1],[0],[0]]\nPrelude Data.List&gt; map last z\n[1,0,0]\nPrelude Data.List&gt; map init z\n[[],[],[]]\n</code></pre>\n\n<p>So the basic problem is that your base case you're matching on is not <code>[[],[],[]]</code> but is instead <code>[[]]</code>, so that pattern doesn't match.</p>\n\n<p>You now have more or less three options: you can (a) try to terminate when the first empty list is seen; this is written in Haskell as <code>any null</code>, using the <code>any</code> function and the <code>null</code> function, both defined in the Prelude; or (b) you can hardcode that this only works for 3x3 matrices, and just match against <code>[[],[],[]]</code>, or (c) you can try to terminate when all lists are empty (<code>all null</code>), in which case you can either skip elements that don't exist or wrap everything in the <code>Maybe x</code> datatype, so that missing elements are represented by <code>Nothing</code> while present elements are represented by <code>Just x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 8, "last_activity_date": 1450829847, "creation_date": 1450829847, "answer_id": 34426668, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell/34426668#34426668", "title": "Rotate a matrix in Haskell", "body": "<p>I'm an old man in a hurry. I'd do it like this (importing <code>Data.List</code>)</p>\n\n<pre><code>rotl :: [[x]] -&gt; [[x]]\nrotl = transpose . map reverse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 1178663, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/aee59e011d5f1e561052f8516125a286?s=128&d=identicon&r=PG", "display_name": "okdewit", "link": "https://stackoverflow.com/users/1178663/okdewit"}, "is_accepted": false, "score": 4, "last_activity_date": 1474070342, "creation_date": 1474070342, "answer_id": 39541558, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell/39541558#39541558", "title": "Rotate a matrix in Haskell", "body": "<p>I think the simplest solution would be:</p>\n\n<pre><code>import Data.List\n\nrotateLeft :: [[a]] -&gt; [[a]]\nrotateLeft = reverse . transpose\n\nrotateRight :: [[a]] -&gt; [[a]]\nrotateRight = transpose . reverse\n</code></pre>\n\n<p>Data.List is a standard module.</p>\n\n<p>transpose slices rows into columns, which is almost like rotating, but leaves the columns in the wrong order, so we just reverse them.</p>\n"}], "owner": {"reputation": 73, "user_id": 5147485, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a851f836656a6c5db4c694fadb5ac100?s=128&d=identicon&r=PG&f=1", "display_name": "paulo_ferreira", "link": "https://stackoverflow.com/users/5147485/paulo-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2768, "favorite_count": 2, "accepted_answer_id": 34423544, "answer_count": 5, "score": 4, "last_activity_date": 1474070342, "creation_date": 1450813239, "last_edit_date": 1450814931, "question_id": 34423279, "link": "https://stackoverflow.com/questions/34423279/rotate-a-matrix-in-haskell", "title": "Rotate a matrix in Haskell", "body": "<p>I have this type Mat <code>a = [[a]]</code> to represent a matrix in haskell.\nI have to write a function which rotate a matrix, for e.g <code>[[1,2,3],[0,4,5]</code>,<code>[0,0,6]]</code> will become <code>[[3,5,6],[2,4,0],[1,0,0]]</code> so I made this:</p>\n\n<pre><code>rotateLeft :: Mat a-&gt;Mat a\nrotateLeft [[]] = []\nrotateLeft (h:t) = (map last (h:t)):(rotateLeft (map init (h:t)))\n</code></pre>\n\n<p>but the output is </p>\n\n<pre><code>[[3,5,6],[2,4,0],[1,0,0],[*** Exception: Prelude.last: empty list\n</code></pre>\n\n<p>I don't know what to put in the base case to avoid this exception. \nApreciate any help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 4, "creation_date": 1450810042, "post_id": 34422461, "comment_id": 56586445, "body": "What exactly do you have trouble understanding? This is very basic Haskell code, if you can&#39;t understand it, you might want to start by reading a Haskell tutorial."}, {"owner": {"reputation": 283, "user_id": 2723238, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7d3387dfb0d1396362f6ae94289b7749?s=128&d=identicon&r=PG&f=1", "display_name": "Frank  D.", "link": "https://stackoverflow.com/users/2723238/frank-d"}, "reply_to_user": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1450821785, "post_id": 34422461, "comment_id": 56591895, "body": "Thank  you  @Vincent. i got it now ...i failed to  understandd the recursive part of it intuitively"}], "answers": [{"comments": [{"owner": {"reputation": 283, "user_id": 2723238, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7d3387dfb0d1396362f6ae94289b7749?s=128&d=identicon&r=PG&f=1", "display_name": "Frank  D.", "link": "https://stackoverflow.com/users/2723238/frank-d"}, "edited": false, "score": 0, "creation_date": 1450821515, "post_id": 34422527, "comment_id": 56591784, "body": "Thank you @Rizier123.I think i failed to  understand the recursive part of it.So from what i  understood is if the  list is  [2,3,4] that means  it  will  take  1+1+1+0=3."}], "tags": [], "owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "is_accepted": true, "score": 6, "last_activity_date": 1450810099, "creation_date": 1450810099, "answer_id": 34422527, "question_id": 34422461, "link": "https://stackoverflow.com/questions/34422461/intuitively-how-does-haskell-find-the-length-of-a-list-without-using-a-standard/34422527#34422527", "title": "Intuitively, how does Haskell find the length of a list without using a standard length function?", "body": "<pre><code>1| listnumber :: [Int] -&gt; Int \n2| listnumber [] = 0\n3| listnumber (x:xs) =1 + listnumber xs\n</code></pre>\n\n<p>The first line pretty much says, that the function takes a list with Int's as argument and returns an Int.</p>\n\n<p>The second line is the edge case, means if you call the function with an empty list it will return 0.</p>\n\n<p>The 3rd line uses pattern matching to chop off the first element(<code>x</code>) of a list and the rest(<code>xs</code>). Now you just add 1 for the element <code>x</code> and call the function again(recursion) with the rest of the list, which will go on until it hits the edge case, an empty list.</p>\n"}], "owner": {"reputation": 283, "user_id": 2723238, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7d3387dfb0d1396362f6ae94289b7749?s=128&d=identicon&r=PG&f=1", "display_name": "Frank  D.", "link": "https://stackoverflow.com/users/2723238/frank-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3947, "favorite_count": 0, "accepted_answer_id": 34422527, "answer_count": 1, "score": 1, "last_activity_date": 1550649063, "creation_date": 1450809868, "last_edit_date": 1550649063, "question_id": 34422461, "link": "https://stackoverflow.com/questions/34422461/intuitively-how-does-haskell-find-the-length-of-a-list-without-using-a-standard", "title": "Intuitively, how does Haskell find the length of a list without using a standard length function?", "body": "<p>I just started learning Haskell and was trying to write a program which computes the number of elements in a list. I found this code online:</p>\n\n<pre><code>listnumber :: [Int] -&gt; Int \nlistnumber [] = 0\nlistnumber (x:xs) =1 + listnumber xs\n</code></pre>\n\n<p>After loading in GHCi the program returns the length of the list as expected. But how does this code work intuitively?</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "edited": false, "score": 0, "creation_date": 1538130407, "post_id": 34421040, "comment_id": 92045378, "body": "I got this from your answer:      size :: Rose a -&gt; Int     size (_ :&gt; bs) = 1 + sum [size v | v &lt;- bs]       leaves :: Rose a -&gt; Int     leaves (_ :&gt; []) = 0     leaves (_ :&gt; bs) = sum [1 + leaves v | v &lt;- bs]  would this be correct?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 175, "user_id": 8843385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c36b066e6fbd3997a82d7ea39d665603?s=128&d=identicon&r=PG&f=1", "display_name": "ramon abacherli", "link": "https://stackoverflow.com/users/8843385/ramon-abacherli"}, "edited": false, "score": 0, "creation_date": 1538192502, "post_id": 34421040, "comment_id": 92067758, "body": "@ramonabacherli, your <code>size</code> function looks right, but your <code>leaves</code> function looks quite wrong in both cases."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1450838672, "last_edit_date": 1450838672, "creation_date": 1450804140, "answer_id": 34421040, "question_id": 34420791, "link": "https://stackoverflow.com/questions/34420791/rose-tree-in-haskell-finding-the-leaves/34421040#34421040", "title": "Rose Tree in Haskell -- Finding the Leaves", "body": "<pre><code>size (_ :&gt; ts) = ? + sum ?\n\nleaves (_ :&gt; []) = ?\nleaves (_ :&gt; ts) = sum ?\n</code></pre>\n\n<p>You will need to use recursion to fill in the blanks, and a common higher-order function.</p>\n"}], "owner": {"reputation": 491, "user_id": 2952838, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/65b2e944774c39cc1f3daf743257bd13?s=128&d=identicon&r=PG&f=1", "display_name": "larry77", "link": "https://stackoverflow.com/users/2952838/larry77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1800, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1450838672, "creation_date": 1450803257, "last_edit_date": 1450805378, "question_id": 34420791, "link": "https://stackoverflow.com/questions/34420791/rose-tree-in-haskell-finding-the-leaves", "title": "Rose Tree in Haskell -- Finding the Leaves", "body": "<p>Please consider the following definition of a rose tree in Haskell</p>\n\n<pre><code>data Rose a = a :&gt; [Rose a]\n        deriving (Eq, Show)\n\nroot (a :&gt; rs) = a\n\nchildren (a :&gt; rs) = rs\n</code></pre>\n\n<p>together with the implementation of the functions to get the root and the children of a rose tree.\nThe bit where I am still struggling is how to implement the functions</p>\n\n<pre><code>size :: Rose a -&gt; Int\nleaves :: Rose a -&gt; Int\n</code></pre>\n\n<p>that count the number of nodes in a rose tree, respectively the number\nof leaves (nodes without any children).\nCan anybody help?</p>\n"}, {"tags": ["haskell", "monads", "catamorphism"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450795572, "post_id": 34418213, "comment_id": 56577826, "body": "You write <code>_ &lt;- fo1 fileName</code> (so you use <code>fo1</code> as a function of type <code>FilePath -&gt; IO x</code> for some x) then you write  <code>length fo1</code> (so you use it as a value of type <code>[x]</code> for some <code>x</code>) so obviously this won&#39;t compile. I don&#39;t know which use is the correct one. What is this function trying to do? I also have never heard the term &quot;partial monadic function&quot;."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450796352, "post_id": 34418213, "comment_id": 56578366, "body": "Also, <code>type FoldInt IO (X -&gt; IO ()) = Int -&gt; IO (X -&gt; IO ())</code>, it is doubtful that this is what you wanted. I think you wanted <code>Int -&gt; X -&gt; IO ()</code>. To get that with your current representation, use the reader monad in place of a function: <code>write :: Fold (ReaderT FilePath IO) X Y Z</code>"}, {"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450796500, "post_id": 34418213, "comment_id": 56578456, "body": "Because it&#39;s a simplified example it&#39;s a bit hard to put it in words, but bascially I would like <code>write</code> to write all the ints into the file (x+y).csv, where x is the length of the first orders and y the length of the second orders."}, {"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450796566, "post_id": 34418213, "comment_id": 56578504, "body": "But in a more general case: I would like to turn foldInt/foldOrder into partial functions to add &#39;extra&#39; information when walking over the data structure."}, {"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450797143, "post_id": 34418213, "comment_id": 56578877, "body": "@user2407038 I changed the example, you were right in your first comment. That is not the case in my actual problem though, just in the small example I made. Is it more clear now what I mean?"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1450804428, "last_edit_date": 1450804428, "creation_date": 1450803267, "answer_id": 34420792, "question_id": 34418213, "link": "https://stackoverflow.com/questions/34418213/creating-a-fold-catamorphism-over-adt-with-partial-monadic-functions/34420792#34420792", "title": "Creating a fold / catamorphism over ADT with partial monadic functions", "body": "<p>If you want to write to some specific file, then that file should just be a parameter to the <code>write</code> function, i.e. <code>write :: FilePath -&gt; Fold IO a b c</code>. But as I understand, you want to compute the file path from the actual data. In this case, the filepath depends on the <em>size</em> of the data, so this is what you need to compute. You also need to compute a <em>continuation</em> of type <code>FilePath -&gt; IO ()</code> - you have the latter, but you are missing the former. </p>\n\n<pre><code>write :: Fold IO () (Int, FilePath -&gt; IO ()) (FilePath -&gt; IO ())\nwrite = (fos, fo, fi) where \n\n fos :: (Int, FilePath -&gt; IO ()) -&gt; (Int, FilePath -&gt; IO ()) -&gt; IO () \n fos (sz1, fo1) (sz2, fo2) = do \n   let fp = show (sz1 + sz2) ++ \".txt\" \n   sequence_ [fo1 fp, fo2 fp] \n\n fo :: [ FilePath -&gt; IO () ] -&gt; IO (Int, FilePath -&gt; IO ())\n fo fis = return (length fis, \\fp -&gt; mapM_ ($ fp) fis)\n\n fi :: Int -&gt; IO (FilePath -&gt; IO ())\n fi int = return $ \\fp -&gt; appendFile fp (show int)\n</code></pre>\n\n<p>As you can see, the principle is quite simple. If you need to compute two things at once, just compute two things at once! Sizes are simply added while functions of type <code>FilePath -&gt; IO ()</code> are simply lifted pointwise and then sequenced. </p>\n\n<p>And a test (in ghci): </p>\n\n<pre><code>&gt;:! cat 4.txt\ncat: 4.txt: No such file or directory\n&gt;foldOrders write  (Orders [1,2] [3,4])\n&gt;:! cat 4.txt\n1234&gt;foldOrders write  (Orders [1,2] [3,4])\n&gt;:! cat 4.txt\n12341234&gt;\n</code></pre>\n"}], "owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561101513, "creation_date": 1450794824, "last_edit_date": 1561101513, "question_id": 34418213, "link": "https://stackoverflow.com/questions/34418213/creating-a-fold-catamorphism-over-adt-with-partial-monadic-functions", "title": "Creating a fold / catamorphism over ADT with partial monadic functions", "body": "<p><em>I'm a bit unsure as what the actual name is for what I am trying, creating a fold or <a href=\"https://en.wikipedia.org/wiki/Catamorphism\" rel=\"nofollow\">catamorphism</a> seems the be the name for it.</em></p>\n\n<p>I've got the following data structures with a fold:</p>\n\n<pre><code>type Order = [Int]\ndata Orders = Orders FilePath Order Order\n\ntype FoldOrders m o os = FilePath -&gt; o -&gt; o -&gt; m os\ntype FoldOrder m o i = [i] -&gt; m o\ntype FoldInt m i = Int -&gt; m i\n\ntype Fold m os o i = (FoldOrders m o os, FoldOrder m o i, FoldInt m i)\n\nfoldOrders :: (Monad m) =&gt; Fold m os o i -&gt; Orders -&gt; m os\nfoldOrders (fos, fo, fi) (Orders orders1 orders2) = do o1 &lt;- foldOrder orders1\n                                                       o2 &lt;- foldOrder orders2\n                                                       fos o1 o2\n    where foldOrder order = do o &lt;- mapM foldInt order\n                               fo o\n          foldInt int     = fi int\n</code></pre>\n\n<p>This fold works fine with for example this 'implementation':</p>\n\n<pre><code>simpleWrite :: Fold IO () () ()\nsimpleWrite = (fos, fo, fi)\nwhere fos _ _ = return ()\n      fo  _   = return ()\n      fi  i   = putStrLn $ show i\n</code></pre>\n\n<p>Using this command</p>\n\n<pre><code>foldOrders simpleWrite (Orders [1,2] [3,4])\n</code></pre>\n\n<p>it prints out <code>1 2 3 4</code> like you would expect.</p>\n\n<p><strong>So far so good, but..</strong></p>\n\n<p>When I want to 'push' down some information (a filepath in this case) while walking over the datastructure like so:</p>\n\n<pre><code>write :: Fold IO a b c\nwrite = (fos, fo, fi)\n     where fos path fo1 fo2 = do _ &lt;- fo1 path\n                                 _ &lt;- fo2 path\n                                 return ()\n           fo fis path = do ios &lt;- mapM (\\x -&gt; x path) fis\n                            return ()           \n           fi int path = appendFile path $ show int\n</code></pre>\n\n<p>I can't get it to compile. It gives back this error:</p>\n\n<pre><code>Couldn't match type `FilePath -&gt; IO ()' with `IO c'\nExpected type: FoldInt IO c\n  Actual type: Int -&gt; FilePath -&gt; IO ()\nIn the expression: fi\n</code></pre>\n\n<p>It seems like you cannot return a partial monadic function like this, but why is that? And how can I get this to work?</p>\n"}, {"tags": ["haskell", "encoding", "utf-8"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 5, "last_activity_date": 1450793490, "creation_date": 1450793490, "answer_id": 34417762, "question_id": 34417462, "link": "https://stackoverflow.com/questions/34417462/what-is-the-proper-way-to-marshall-utf-8-encoded-string-to-haskell-text-and-back/34417762#34417762", "title": "What is the proper way to marshall utf-8 encoded string to Haskell text and back?", "body": "<p>Try using <code>ByteString</code> as an intermediary type, rather than <code>String</code>, as that will allow you to use <code>Data.Text.Encoding</code> to manually decode and encode the strings.</p>\n\n<pre><code>module Main where\n\nimport Data.ByteString\nimport Data.Text\nimport Data.Text.Encoding\nimport Foreign.C.String\nimport Foreign.Marshal.Alloc\n\ndecode :: CString -&gt; IO Text\ndecode cstr = do\n  bytestr &lt;- packCString cstr\n  return (decodeUtf8 bytestr)\n\nencode :: Text -&gt; (CString -&gt; IO a) -&gt; IO a\nencode text cont =\n  useAsCString (encodeUtf8 text) cont\n</code></pre>\n\n<p>Woo, import party.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "accepted_answer_id": 34417762, "answer_count": 1, "score": 1, "last_activity_date": 1450793490, "creation_date": 1450792454, "question_id": 34417462, "link": "https://stackoverflow.com/questions/34417462/what-is-the-proper-way-to-marshall-utf-8-encoded-string-to-haskell-text-and-back", "title": "What is the proper way to marshall utf-8 encoded string to Haskell text and back?", "body": "<p>I have C string that is guaranteed to be UTF-8 encoded. With simple strings I would do it like this (assuming that we can use <code>pack</code> and <code>unpack</code>):</p>\n\n<pre><code>result &lt;- peekCString cstr\nfree cstr -- \u2190 not really important here\nreturn (T.pack result)\n</code></pre>\n\n<p>And to use string:</p>\n\n<pre><code>withCString (T.unpack str) $ \\cstr -&gt;\n  use_string cstr\n</code></pre>\n\n<p>Problem with these functions is that</p>\n\n<blockquote>\n  <p>they will use an encoding determined by the current locale</p>\n</blockquote>\n\n<p>\u2026but I know that it always should be UTF-8, if current locale specifies different encoding, I'll get wrong results.</p>\n\n<p>So, how should I approach the marshalling to and from <code>Text</code>?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450798135, "post_id": 34417248, "comment_id": 56579514, "body": "I get an &quot;illegal family declaration&quot; if I do the <code>type Scalar v :: *</code> in the class"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450798456, "post_id": 34417248, "comment_id": 56579731, "body": "also doing like they did in vector-space doesn&#39;t actually remove the error at all.. even after enabling type families"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450807131, "post_id": 34417248, "comment_id": 56584968, "body": "@ElectricCoffee: yes it does. (My original post did introduce <i>another</i> error, admittedly, as I had copied the <code>realToFrac</code> from the other solution which is obviously wrong here.)"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450809235, "post_id": 34417248, "comment_id": 56586036, "body": "I seem to be getting a few errors when I try to do <code>vplus (1, 2) (3, 4)</code> saying &quot;No instance for (Vector (t0, t1)) arising from use of &#39;vplus&#39;&quot;, and &quot;No instance for (Num t1) arising from literal &#39;2&#39;&quot;. What&#39;s going on here?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450825538, "post_id": 34417248, "comment_id": 56593334, "body": "I&#39;ve expanded my question"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450867394, "post_id": 34417248, "comment_id": 56608436, "body": "I daresay that expansion doesn&#39;t belong here, please ask a new question. Anyway, the problem is not so bad. In your example, it&#39;s sufficient to write <code>(2::Int, 3::Int) `vdot` (5, 5)</code>. The compiler <i>will</i> need a precise hint as to the type of one of the vectors, but in real code, that&#39;s generally a no-brainer because you&#39;re only dealing with variables that GHC can somehow trace to a top-level function type signature."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1450872284, "post_id": 34417248, "comment_id": 56611391, "body": "made it a <a href=\"http://stackoverflow.com/questions/34435306/couldnt-match-expected-type-with-actual-type-the-type-variables-are-ambiguous\">new question</a>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1450806796, "last_edit_date": 1450806796, "creation_date": 1450791733, "answer_id": 34417248, "question_id": 34417076, "link": "https://stackoverflow.com/questions/34417076/illegal-instance-declaraion-when-using-tuples/34417248#34417248", "title": "Illegal instance declaraion when using tuples", "body": "<p><code>a</code> in you <code>(a,a)</code> instance will be one arbitrary <code>Num</code> instance. The <code>a</code> in <code>vmult :: Num a =&gt; v -&gt; a -&gt; v</code> knows nothing about this, i.e. this may be any <em>other</em> <code>Num</code> instance.</p>\n\n<p>To make the class work you need to either</p>\n\n<ul>\n<li><p>ensure that the number types can be converted into each other. For instance,</p>\n\n<pre><code>class Vector v where\n  vplus :: v -&gt; v -&gt; v\n  vmult :: RealFrac a =&gt; v -&gt; a -&gt; v\n\ninstance RealFrac a =&gt; Vector (a, a) where\n  (a, b) `vplus` (c, d) = (a + c, b + d)\n  (a, b) `vmult` m' = (a * m, b * m)\n    where m = realToFrac m'\n</code></pre></li>\n<li><p>make sure the scalar multiplicators are actually the same type as the vector components. This is how the <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow\">vector-space</a> library does it. For your code, it would take on the form</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Vector v where\n  type Scalar v :: *\n  vplus :: v -&gt; v -&gt; v\n  vmult :: v -&gt; Scalar v -&gt; v\n\ninstance Num a =&gt; Vector (a, a) where\n  type Scalar (a,a) = a\n  (a, b) `vplus` (c, d) = (a + c, b + d)\n  (a, b) `vmult` m = (a * m, b * m)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 34417248, "answer_count": 1, "score": 3, "last_activity_date": 1450872055, "creation_date": 1450791188, "last_edit_date": 1450872055, "question_id": 34417076, "link": "https://stackoverflow.com/questions/34417076/illegal-instance-declaraion-when-using-tuples", "title": "Illegal instance declaraion when using tuples", "body": "<p>Messing around in Haskell getting to know type classes more intimately, but I've hit a bit of a roadblock. For whatever reason I'm not allowed to make an instance of my <code>Vector</code> class. I'm being told that it's an illegal instance declaration because I don't have distinct type variables? What's going on here?</p>\n\n<pre><code>class Vector v where\n  vplus :: v -&gt; v -&gt; v\n  vmult :: Num a =&gt; v -&gt; a -&gt; v\n\ninstance Num a =&gt; Vector (a, a) where\n  (a, b) `vplus` (c, d) = (a + c, b + d)\n  (a, b) `vmult` m = (a * m, b * m)\n</code></pre>\n"}, {"tags": ["xml", "haskell", "hxt", "io-monad"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1450794233, "last_edit_date": 1450794233, "creation_date": 1450793732, "answer_id": 34417842, "question_id": 34416966, "link": "https://stackoverflow.com/questions/34416966/parse-other-xml-files-whilst-parsing-tree-with-hxt/34417842#34417842", "title": "Parse other XML files whilst parsing tree with HXT", "body": "<p>The HXT combinators are polymorphic, and there is a type <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Control-Arrow-IOListArrow.html#t:IOLA\" rel=\"nofollow\"><code>IOLA</code></a> which implements all the XML parsing-relevant typeclasses, in addition to <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.15/docs/Control-Arrow-ArrowIO.html#t:ArrowIO\" rel=\"nofollow\"><code>ArrowIO</code></a> which makes it possible to do <code>IO</code> mid-arrow.</p>\n\n<p>For example, if you want to do fully recursive parsing of the files, you can do something as simple as</p>\n\n<pre><code>parseDoc docName = runX $ parseXML fileName &gt;&gt;&gt; getWindow\n  where\n    fileName = docName ++ \".xml\"\n\ngetWindow = atTag \"Window\" &gt;&gt;&gt; proc x -&gt; do\n    libraryItemName &lt;- getAttrValue \"libraryItemName\" -&lt; x\n    name &lt;- getAttrValue \"name\" -&lt; x\n    children &lt;- arrIO parseDoc -&lt; libraryItemName\n    returnA -&lt; initUiWindow { wndName = name, wndNameLib = libraryItemName, wndChildren = children}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 1056350, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e771754034e77080eea435ede7810cd?s=128&d=identicon&r=PG", "display_name": "Iggy M", "link": "https://stackoverflow.com/users/1056350/iggy-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 34417842, "answer_count": 1, "score": 0, "last_activity_date": 1450794233, "creation_date": 1450790819, "last_edit_date": 1450793769, "question_id": 34416966, "link": "https://stackoverflow.com/questions/34416966/parse-other-xml-files-whilst-parsing-tree-with-hxt", "title": "Parse other XML files whilst parsing tree with HXT", "body": "<p>I am parsing XML files that describe User Interface for a game and try to learn HXT at the same time.\nI can successfully parse a single XML file. But could not figure what would be the best way to open and parse other XML files whilst inside <code>getWindow</code> function.</p>\n\n<p>Each XML consists of number of <code>Window</code>s. Each <code>Window</code> has <code>name</code> and <code>libraryName</code>. The latter being the name of the XML file that describes the window.\nFor instance, the root looks like this:</p>\n\n<pre><code>&lt;!-- DOMDocument.xml --&gt;\n&lt;elements&gt;\n    &lt;Window libraryItemName=\"window_home\" name=\"window_home\"&gt;\n    &lt;!-- data here  --&gt;\n    &lt;/Window&gt;\n    &lt;Window libraryItemName=\"window_battle\" name=\"window_battle\"&gt;\n    &lt;!-- data here  --&gt;\n    &lt;/Window&gt;\n&lt;/elements&gt;\n</code></pre>\n\n<p>And then there is a separate XML file for each window. E.g. \"window_home\":</p>\n\n<pre><code>&lt;!-- window_home.xml --&gt;\n&lt;elements&gt;\n    &lt;Window libraryItemName=\"panel_tabs\" name=\"panel_tabs\" selected=\"true\"&gt;\n    &lt;!-- data here  --&gt;\n    &lt;/Window&gt;\n    &lt;Window libraryItemName=\"home_powerup_menu\" name=\"home_powerup_menu\" selected=\"true\"&gt;\n    &lt;!-- data here  --&gt;\n    &lt;/Window&gt;\n    &lt;Window libraryItemName=\"panel_name\" name=\"panel_name\" selected=\"true\"&gt;\n    &lt;!-- data here  --&gt;\n    &lt;/Window&gt;\n&lt;/elements&gt;\n</code></pre>\n\n<p>I parse root <code>DOMDocument.xml</code> with this code:</p>\n\n<pre><code>{-# LANGUAGE Arrows, NoMonomorphismRestriction #-}\nimport Text.XML.HXT.Core\n\nparseXML = readDocument [ withValidate no\n                        , withRemoveWS yes  -- throw away formating WS\n                        ] \n\natTag tag = deep (isElem &gt;&gt;&gt; hasName tag)\n\ndata UiWindow = UiWindow {\n    wndName :: String,\n    wndNameLib :: String,\n    wndChildren :: [UiWindow]\n    } deriving (Show)\n\ninitUiWindow = UiWindow {\n    wndName = \"empty\",\n    wndNameLib = \"\",\n    wndChildren = []\n    }\n\n\ngetWindow = atTag \"Window\" &gt;&gt;&gt; \n  proc x -&gt; do\n    _libraryItemName &lt;- getAttrValue \"libraryItemName\" -&lt; x\n    _name &lt;- getAttrValue \"name\" -&lt; x\n    -- TODO: Open _libraryItemName XML file and parse windows in it\n    returnA -&lt; initUiWindow { wndName = _name, wndNameLib = _libraryItemName}\n\ndocumentName = \"DOMDocument.xml\"        \n\nparseRoot = parseXML documentName\n--runX (parseRoot &gt;&gt;&gt; getWindow )\n</code></pre>\n\n<p>Since the <code>getWindow</code> function is not wrapped inside <code>IO</code> what would be the best way to achieve a desired behaviour?</p>\n"}, {"tags": ["haskell", "instance", "phantom-types"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1450788579, "post_id": 34416126, "comment_id": 56573497, "body": "Could it be that the feature you are looking for is <code>TypeFamilies</code> - I&#39;ll take this as an excuse to link my favourite haskell blogpost <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/type-families-and-pokemon\" rel=\"nofollow noreferrer\">fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-wee&zwnj;&#8203;k/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1450790385, "creation_date": 1450790385, "answer_id": 34416854, "question_id": 34416126, "link": "https://stackoverflow.com/questions/34416126/using-an-instance-pattern-in-a-function-definition/34416854#34416854", "title": "Using an instance pattern in a function definition", "body": "<p>No, because Haskell keeps type-level variables and value-level variables strictly apart. Are you sure you want to handle physical <em>units</em> on the type level? Physical <em>dimensions</em>, that sure makes sense (check out e.g. the <a href=\"http://hackage.haskell.org/package/units\" rel=\"nofollow\">units</a> package), but why do you need different types for different-unit lengths, seeing as they're clearly equivalent anyway? Alright, this might make sense to avoidly costy implicit unit conversions, but why do you define an operator which does do more-or-less implicit unit conversion then?</p>\n\n<p>At any rate, you can't make the result type <code>c</code> dependent of the (value-level) <code>if</code> statement. Basically you need to write out a type-level <code>case</code>/pattern match; the most straightforward way to do that is with multiple instances:</p>\n\n<pre><code>instance  Num n =&gt; OperAdd (Length Metre n) (Length Metre n) (Length Metre val) where\n  (&lt;+&gt;) (Length  la) (Length  lb) = Length (la+lb)\ninstance  Num n =&gt; OperAdd (Length Metre n) (Length KiloMetre n) (Length Metre n) where\n  (&lt;+&gt;) (Length  la) (Length lb') = Length (la+lb*1000)\ninstance  Num n =&gt; OperAdd (Length Metre n) (Length Metre n) (Length KiloMetre n) where\n  (&lt;+&gt;) (Length  la) (Length  lb) = Length $ (la+lb)/1000\n...\n</code></pre>\n\n<p>A more generic solution that would look more similar to your original idea might be possible with <a href=\"http://hackage.haskell.org/package/singletons\" rel=\"nofollow\">singletons</a>.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 1, "accepted_answer_id": 34416854, "answer_count": 1, "score": 1, "last_activity_date": 1450790385, "creation_date": 1450787953, "question_id": 34416126, "link": "https://stackoverflow.com/questions/34416126/using-an-instance-pattern-in-a-function-definition", "title": "Using an instance pattern in a function definition", "body": "<p>I would like to create an operator for using \"phantom typed\" units : </p>\n\n<pre><code>newtype Length (a::UnitLength) b = Length b deriving (Eq)\ndata UnitLength = Meter\n            | KiloMeter\n            | Miles\n             deriving (Eq,Show)\n\nclass OperAdd a b c  where\n  (&lt;+&gt;) :: a -&gt; b -&gt; c\n\ninstance  Num val =&gt; OperAdd (Length a val) (Length b val) (Length c val) where\n  (&lt;+&gt;) (Length  la) (Length  lb) =  if a == b \n                                      then Length (la+lb) \n                                      else ...\n</code></pre>\n\n<p>To avoid repeating instance declaration for each units, I would like to use the types <code>a</code> <code>b</code> and <code>c</code> in the instance declaration to make automatic unit conversion.</p>\n\n<p><strong>Is it possible to use <code>a</code> <code>b</code> and <code>c</code> in my operator definition ?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 2, "creation_date": 1450785720, "post_id": 34415487, "comment_id": 56571817, "body": "The opposite of: <code>==</code> :)"}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 7, "creation_date": 1450786754, "post_id": 34415487, "comment_id": 56572403, "body": "Next time use: <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "reply_to_user": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 1, "creation_date": 1450787137, "post_id": 34415487, "comment_id": 56572627, "body": "@Rizier123 which gives me <code>(&#47;=) :: a -&gt; a -&gt; Bool infix 4</code> which is not very helpful as a beginner...."}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "reply_to_user": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "edited": false, "score": 1, "creation_date": 1450787452, "post_id": 34415487, "comment_id": 56572808, "body": "@mhutter Have you clicked on the link?"}, {"owner": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "reply_to_user": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 1, "creation_date": 1450787605, "post_id": 34415487, "comment_id": 56572898, "body": "@Rizier123 Yes! Ah, now I see. I didn&#39;t see the description above because the browser tab froze so I assumed I was at the top of the page. My bad :)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1450788129, "post_id": 34415487, "comment_id": 56573209, "body": "&quot;but then it shouldn&#39;t be True.&quot; It <i>isn&#39;t</i> True."}], "answers": [{"comments": [{"owner": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 0, "creation_date": 1450785927, "post_id": 34415536, "comment_id": 56571935, "body": "It is an equal signed crossed out i.e not equal."}, {"owner": {"reputation": 327, "user_id": 10855198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FcPCa.jpg?s=128&g=1", "display_name": "Bobbbay", "link": "https://stackoverflow.com/users/10855198/bobbbay"}, "edited": false, "score": 4, "creation_date": 1578349984, "post_id": 34415536, "comment_id": 105403066, "body": "So the Haskell equivalent of !="}], "tags": [], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "is_accepted": true, "score": 35, "last_activity_date": 1520081719, "last_edit_date": 1520081719, "creation_date": 1450785823, "answer_id": 34415536, "question_id": 34415487, "link": "https://stackoverflow.com/questions/34415487/what-does-the-operator-in-haskell-mean/34415536#34415536", "title": "What does the /= operator in Haskell mean?", "body": "<p>It means not equal. So <code>5 /= 5</code> is <em>false</em> as <code>5 == 5</code> is <em>true</em>.</p>\n\n<p><code>x /= y = not (x == y)</code></p>\n\n<p>As suggested, it recalls the mathematical symbol \"\u2260\" (/=) opposite to \"=\" (==).</p>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1450790939, "post_id": 34415547, "comment_id": 56574883, "body": "Incidentally, the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\"><code>Data.Monoid</code></a> module also exports a <code>&lt;&gt;</code> operator, which doesn&#39;t mean &quot;not equal&quot;, but is a synonym of <code>mappend</code>."}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1450791328, "post_id": 34415547, "comment_id": 56575110, "body": "Right. Looking at the type we can see it does something completely different: <code>(&lt;&gt;) :: Monoid m =&gt; m -&gt; m -&gt; m</code>"}, {"owner": {"reputation": 45645, "user_id": 1056563, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/bc888aa658ab0e0d2a4d305ad7f69123?s=128&d=identicon&r=PG", "display_name": "StephenBoesch", "link": "https://stackoverflow.com/users/1056563/stephenboesch"}, "edited": false, "score": 0, "creation_date": 1486268743, "post_id": 34415547, "comment_id": 71269722, "body": "super noobie here: how to <i>read</i> the output of <code>:t</code>  i see <code>a</code> three times ;)"}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 2, "creation_date": 1486369813, "post_id": 34415547, "comment_id": 71298163, "body": "&quot;where type <code>a</code> can be tested for equality, operator <code>&#47;=</code> takes two arguments of that type and returns a boolean.&quot;"}], "tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 4, "last_activity_date": 1450785868, "creation_date": 1450785868, "answer_id": 34415547, "question_id": 34415487, "link": "https://stackoverflow.com/questions/34415487/what-does-the-operator-in-haskell-mean/34415547#34415547", "title": "What does the /= operator in Haskell mean?", "body": "<p>It's the \"not equal to\" operator.</p>\n\n<p>Various languages use for example <code>!=</code>,<code>&lt;&gt;</code>, etc... and Haskell uses <code>/=</code> ;)</p>\n\n<p>Using <code>:t</code> can tell you the type:</p>\n\n<pre><code>&gt; :t (/=)\n(/=) :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 15, "last_activity_date": 1450785875, "creation_date": 1450785875, "answer_id": 34415550, "question_id": 34415487, "link": "https://stackoverflow.com/questions/34415487/what-does-the-operator-in-haskell-mean/34415550#34415550", "title": "What does the /= operator in Haskell mean?", "body": "<p>The <code>==</code> operator means \"is equal\".</p>\n\n<p>The <code>/=</code> operator means \"is <em>not</em> equal\".</p>\n\n<p>It's supposed to be reminiscent of the mathematical \"\u2260\" symbol (i.e., an equals sign with a diagonal line through it).</p>\n"}], "owner": {"reputation": 7574, "user_id": 236106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/46ea107d3eb130cdea38bece3f7d3c26?s=128&d=identicon&r=PG", "display_name": "Bunny Rabbit", "link": "https://stackoverflow.com/users/236106/bunny-rabbit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34883, "favorite_count": 7, "accepted_answer_id": 34415536, "answer_count": 3, "score": 23, "last_activity_date": 1520101331, "creation_date": 1450785647, "last_edit_date": 1520101331, "question_id": 34415487, "link": "https://stackoverflow.com/questions/34415487/what-does-the-operator-in-haskell-mean", "title": "What does the /= operator in Haskell mean?", "body": "<p>I am reading <a href=\"http://learnyouahaskell.com\" rel=\"noreferrer\">Learn You a Haskell</a>, which contains <code>5 /= 5</code>. I am not so sure what this means. Does the first expression mean <code>5 / 5 = 5</code>? But, then, it shouldn't be <code>True</code>.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-dev", "cabal-sandbox"], "answers": [{"tags": [], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "is_accepted": false, "score": 1, "last_activity_date": 1450887248, "creation_date": 1450887248, "answer_id": 34439688, "question_id": 34414269, "link": "https://stackoverflow.com/questions/34414269/cabal-post-build-hook-inside-a-sandbox/34439688#34439688", "title": "Cabal: Post Build Hook inside a Sandbox", "body": "<p>This question was asked on Cabal's bug tracker: <a href=\"https://github.com/haskell/cabal/issues/2978\" rel=\"nofollow\">https://github.com/haskell/cabal/issues/2978</a></p>\n\n<p>If indeed this is the behavior you are seeing, try upgrading your Cabal.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1450887248, "creation_date": 1450781836, "question_id": 34414269, "link": "https://stackoverflow.com/questions/34414269/cabal-post-build-hook-inside-a-sandbox", "title": "Cabal: Post Build Hook inside a Sandbox", "body": "<p>I am creating a simple post-build-hook for Cabal. The problem comes when I try to work in a sandbox. My hook is expecting the compiled code under:</p>\n\n<p><code>dist/something</code></p>\n\n<p>but when the build happens inside a sandbox the path becomes:</p>\n\n<p><code>dist/dist-sandbox-xxxxxxxx/something</code></p>\n\n<p>How can I pass or let know to my hook the current used <code>dist-sandbox</code> path?</p>\n"}, {"tags": ["haskell", "login", "functional-programming", "type-theory", "curry-howard"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1450759369, "post_id": 34408057, "comment_id": 56558721, "body": "The &quot;type system&quot; (i.e., types with their proof semantics given by the CH isomorphism) can be described by several mathematical structures, for example a <a href=\"https://en.wikipedia.org/wiki/Cartesian_closed_category\" rel=\"nofollow noreferrer\">Cartesian closed category</a> or a <a href=\"https://en.wikipedia.org/wiki/Distributive_lattice\" rel=\"nofollow noreferrer\">distributive lattice</a>. In this case you are taking the preorder formed by <code>(Type, -&gt;)</code>, ie, for all types <code>x,y</code> we say that <code>x</code> is less than or equal <code>y</code> iff there exists a function of type <code>x -&gt; y</code>. You also use that <code>,</code> corresponds to logical and (this comes from the lattice structure)."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 7, "creation_date": 1450766982, "post_id": 34409277, "comment_id": 56561204, "body": "&quot;if you squint out to a categorical blur these things will start to look vaguely similar&quot;... this is said with some amount of flippancy but it is basically the whole point of category theory."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1450763530, "creation_date": 1450763530, "answer_id": 34409277, "question_id": 34408057, "link": "https://stackoverflow.com/questions/34408057/curry-howard-correspondence-and-equality/34409277#34409277", "title": "Curry Howard correspondence and equality", "body": "<p>Every pre-ordered set forms a category. Let <code>(S, \u00ab)</code> be a pre-ordered set. Define a category <code>C</code> whose objects are the elements of <code>S</code> and with <code>Hom(a, b)</code> inhabited by <code>(a, b)</code> if <code>a \u00ab b</code> and uninhabited otherwise. Define composition the only way you possibly can. The category laws follow immediately from the transitivity and reflexivity of the pre-order.</p>\n\n<p>A lattice, in particular, will form a category admitting finite products and coproducts. A bounded lattice will form one with initial and final objects.</p>\n\n<p>Types and functions in a sufficiently well-behaved functional language also form a category with finite products and coproducts, and initial and final objects. So if you squint out to a categorical blur, these things will start to look vaguely similar.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1450797920, "last_edit_date": 1450797920, "creation_date": 1450773749, "answer_id": 34411656, "question_id": 34408057, "link": "https://stackoverflow.com/questions/34408057/curry-howard-correspondence-and-equality/34411656#34411656", "title": "Curry Howard correspondence and equality", "body": "<p>(This is more a comment than an answer, but I need more space.)</p>\n\n<p>The type <code>a -&gt; b</code> corresponds to <code>a &lt;= b</code>. This is useful, e.g., to speak about fixed points at the type level, which are needed to properly define recursive types (lists, trees, ...).</p>\n\n<p>Recall how recursion is solved, without categories. In domain theory, given a function <code>f :: a -&gt; a</code> we look for a least <code>x</code> satisfying <code>f x = x</code> (least fixed point). This turns out to also be the least <code>x</code> satisfying <code>f x &lt;= x</code> (least prefixed point). We then get the induction principle</p>\n\n<pre><code>f y &lt;= y  ==&gt; fix f &lt;= y\n</code></pre>\n\n<p>which basically states that, if we have any prefixed point <code>y</code>, then the least (pre)fixed point <code>fix f</code> must be less than <code>y</code> -- indeed, it is the least!</p>\n\n<p>Now, let's sprinkle some category powder over that. Implication becomes a <code>-&gt;</code> arrow, and <code>&lt;=</code> also becomes <code>-&gt;</code>. We get</p>\n\n<pre><code>(f y -&gt; y) -&gt; fix f -&gt; y\n</code></pre>\n\n<p>Looks familiar, where did I see that...? Ah!</p>\n\n<pre><code>newtype Fix f = Fix { unFix :: f (Fix f) }\ncata :: Functor f =&gt; (f y -&gt; y) -&gt; Fix f -&gt; y\ncata g = g . fmap (cata g) . unFix\n</code></pre>\n\n<p>Hence, the <code>cata</code> general eliminator/catamorphism is just a category-empowered version of the good old induction principle.</p>\n\n<p>Note how domain points <code>y</code> are now object in our category (i.e. types). Also, functions <code>f</code> must be applicable to <code>y</code>, so these are not morphisms in our category (which would be function <em>values</em> <code>:: A -&gt; B</code>, from some type to some type), but correspond to functors int the category of types (mapping types to types <code>:: * -&gt; *</code>).</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 2, "accepted_answer_id": 34409277, "answer_count": 2, "score": 2, "last_activity_date": 1450797920, "creation_date": 1450755430, "question_id": 34408057, "link": "https://stackoverflow.com/questions/34408057/curry-howard-correspondence-and-equality", "title": "Curry Howard correspondence and equality", "body": "<p>A while ago I read that the function type <code>a -&gt; b</code> corresponds to the relation <code>a \u2264 b</code>, or is it <code>a \u2265 b</code>? This makes sense to me because two types are isomorphic if we have a bijection between them (i.e. <code>(a \u2248 b) \u2261 (a -&gt; b, b -&gt; a)</code>). Similarly, <code>(a = b) \u2261 (a \u2264 b) \u2227 (a \u2265 b)</code>.</p>\n\n<p>I know that this is not the Curry-Howard-Lambek correspondence (i.e. the correspondence between type theory, logic and category theory). It's the correspondence between type theory and something else. I want to know learn more about this correspondence. Could somebody point me in the right direction?</p>\n\n<p>I know that this doesn't seem like a programming question but it is related to programming and I'm hoping that some functional programmer knows more about it and can point me in the right direction.</p>\n"}, {"tags": ["javascript", "haskell", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1451242802, "post_id": 34435530, "comment_id": 56709488, "body": "Cool! A bit too late for me, though - I ended up figuring I could just pass a ByteString&#39;s Ptr directly to JavaScript on the FFI. I then used the lib Spool to convert from unboxed vectors to bytestrings without copying."}, {"owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1457888812, "post_id": 34435530, "comment_id": 59600505, "body": "@Viclib, could you explain how you did that? I&#39;m currently trying to figure out how to get a typed array from a bytestring and I&#39;m having trouble."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1457975483, "post_id": 34435530, "comment_id": 59640126, "body": "I explained. You have a Haskell ByteString, right? Send it to a JavaScript function (anything you write using the FFI) as an argument. Use <code>console.log</code> on it. You&#39;ll see the data is all there as different buffer types, you can just chose one."}, {"owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1457988223, "post_id": 34435530, "comment_id": 59647922, "body": "@Viclib Is there an instance of <code>(IsJSVal ByteString)</code> somewhere that I need to be importing? You can&#39;t call <code>jsval</code> on <code>ByteString</code> without it."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1457990366, "post_id": 34435530, "comment_id": 59649143, "body": "... I really don&#39;t remember... <a href=\"http://lpaste.net/154691\" rel=\"nofollow noreferrer\">this</a> is the relevant code I wrote, though. I&#39;ve looked at it, seems like like you just need to convert the ByteString to a CString with <code>B.useAsCString</code>...."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1450873002, "creation_date": 1450873002, "answer_id": 34435530, "question_id": 34406652, "link": "https://stackoverflow.com/questions/34406652/how-do-you-convert-from-an-unboxed-vector-to-a-js-typedarray-on-ghcjs/34435530#34435530", "title": "How do you convert from an Unboxed Vector to a JS TypedArray on GHCJS?", "body": "<p>I was able to solve this up to marshalling to an <code>Int32Array</code> instead of an <code>Uint32Array</code>; probably someone who has actually known GHCJS for more than the one hour I've put into this will be able to expand on this so that you get your <code>Uint32Array</code> (or you can just make a hacked-up version of <code>GHCJS.Buffer</code> that supports a <code>getUint32Array</code> operation).</p>\n\n<p>The idea is to get the <code>ByteArray</code> underlying the <code>Vector</code> representation, and then <code>slice</code> it so that only the relevant portion remains:</p>\n\n<pre><code>import Data.Vector.Unboxed as V\nimport Data.Word\n\nimport qualified Data.Vector.Unboxed.Base as B\nimport qualified Data.Vector.Primitive as P\nimport GHCJS.Types\nimport qualified GHCJS.Buffer as Buffer\nimport JavaScript.TypedArray (Int32Array)\n\n-- TODO: generalize this to all types that support unboxed vectors...\ntoI32Array :: Vector Word32 -&gt; Int32Array\ntoI32Array (B.V_Word32 (P.Vector offset len bs)) =\n    js_slice offset (offset + len) $ Buffer.getInt32Array (Buffer.fromByteArray bs)\n\n\nforeign import javascript unsafe \"$3.slice($1, $2)\" js_slice :: Int -&gt; Int -&gt; Int32Array -&gt; Int32Array\n-- should be\n-- foreign import javascript unsafe \"$3.slice($1, $2)\" js_slice :: Int -&gt; Int -&gt; SomeTypedArray a m -&gt; SomeTypedArray a m\n-- but alas, JavaScript.TypedArray.Internal.Type is a hidden module\n</code></pre>\n\n<p>Here's some example code using it:</p>\n\n<pre><code>v :: Vector Word32\nv = V.fromList [1, 2, 3]\n\nforeign import javascript unsafe \"console.debug($1);\" js_debug :: JSVal -&gt; IO ()\n\nmain = do\n    let v' = toI32Array v\n    js_debug $ jsval v'\n</code></pre>\n\n<p>If you look at the console in a browser, you can check that <code>jsval v'</code> does indeed have type <code>Int32Array</code>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 1, "accepted_answer_id": 34435530, "answer_count": 1, "score": 4, "last_activity_date": 1450877999, "creation_date": 1450744044, "last_edit_date": 1450877999, "question_id": 34406652, "link": "https://stackoverflow.com/questions/34406652/how-do-you-convert-from-an-unboxed-vector-to-a-js-typedarray-on-ghcjs", "title": "How do you convert from an Unboxed Vector to a JS TypedArray on GHCJS?", "body": "<p>I have an element of type <code>Data.Vector.Unboxed.Vector Word32</code>. I want to convert that to a native JS <code>TypedArray</code> (an <code>Uint32Array</code>, specifically). I'm aware of <code>toJsArray</code> and <code>toJsValListOf</code>, but both functions deal with lists, not vectors, and are inefficient. How can I convert an unboxed <code>Vector</code> directly to a JS <code>TypedArray</code>?</p>\n"}, {"tags": ["algorithm", "performance", "haskell", "benchmarking"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450753714, "post_id": 34406541, "comment_id": 56557407, "body": "Why don&#39;t you remove the redundant <code>Empty</code> constructor as suggested in your previous question? It&#39;s annoying."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450753999, "post_id": 34406541, "comment_id": 56557471, "body": "@chi suggested that it had some value, as it was necessary to represent an empty tree.  I&#39;m just trying to cover all the bases."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450757266, "post_id": 34406541, "comment_id": 56558217, "body": "Unless you have a particular reason for wanting redundancy (and I don&#39;t think that <i>particular</i> redundancy has any value), the thing to do is <code>data Tree a = Node a [Tree a]</code> (which you can import from <code>Data.Tree</code>) and then either <code>data Tree&#39; a = Empty | NonEmpty (Tree a)</code> or <code>newtype Tree&#39; a = Tree&#39; (Maybe (Tree a))</code>, or possibly even <code>type Tree&#39; a = Maybe (Tree a)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450808631, "post_id": 34406541, "comment_id": 56585707, "body": "My advice: using <code>Data.Tree</code>, you probably can&#39;t do much better than <code>sumTree = foldl&#39; (+) 0 . flatten</code>. You can improve that a bit, though, by manually fusing the operations."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450824886, "post_id": 34406541, "comment_id": 56593104, "body": "I updated my answer with an example"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1450982392, "post_id": 34406541, "comment_id": 56655306, "body": "user3237465 and I had an <a href=\"http://stackoverflow.com/questions/34406541/efficient-folding-of-a-sum-tree/34407525?noredirect=1#comment56612575_34407525\">optimization battle</a>. In cases of code sharing, Church encoding seems more efficient, although it&#39;s sort of indeterminate otherwise. Just something to consider."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450825575, "post_id": 34406595, "comment_id": 56593353, "body": "Since you&#39;ve done everything, could you also provide the output? In my version there should be <code>foldl&#39; (+) 0</code> instead of <code>sum</code> \u2014 this should improve performance."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1450984711, "post_id": 34406595, "comment_id": 56655974, "body": "Don&#39;t forget my <a href=\"http://lpaste.net/147760\" rel=\"nofollow noreferrer\">code too</a> (me and user3237465 had an optimization battle in the comment section of my answer)."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1450826598, "last_edit_date": 1450826598, "creation_date": 1450743626, "answer_id": 34406595, "question_id": 34406541, "link": "https://stackoverflow.com/questions/34406541/efficient-folding-of-a-sum-tree/34406595#34406595", "title": "Efficient Folding Of A Sum Tree", "body": "<p>Although so.com is no site for recommendations I advise you to take a look at criterion <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow\">https://hackage.haskell.org/package/criterion</a></p>\n\n<p>I'll maybe give some example of it's usage tomorrow</p>\n\n<p>If you really want to dive deep in that matter you can analyze the generated llvm assembler by adding the compiler option <code>--ddump-llvm</code> though that is a rather advanced topic only included for the sake of completeness. </p>\n\n<h2>Update - How to use <code>criterion</code> in this case</h2>\n\n<p>First of all I will explain this using the haskell stack tool, all of the code can be found at <a href=\"https://github.com/epsilonhalbe/critExample\" rel=\"nofollow\">github/epsilonhalbe</a></p>\n\n<p>First of all we create a project and split each of the relevant definitions in a separate module (otherwise we would need <code>data Tree</code>, <code>data Tree'</code> and <code>data Tree''</code>). See <code>Chi.hs</code> as an example:</p>\n\n<pre><code>module Chi where\n\ndata Tree a = Empty | Node a [Tree a] deriving (Eq, Show)\n\naddNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n xs) = n + sum (map addNums xs)\n\nmyInts :: Tree Int\nmyInts =\n    Node 1 [\n           Node 2 [\n             Node 4 [Empty], Node 5 [Empty]\n           ],\n           Node 3 [\n             Node 6 [Empty], Node 7 [Empty], Node 8 [Empty]\n           ]\n        ]\n\nmyDouble :: Tree Double\nmyDouble =\n    Node 1 [\n           Node 2 [\n             Node 4 [Empty], Node 5 [Empty]\n           ],\n           Node 3 [\n             Node 6 [Empty], Node 7 [Empty], Node 8 [Empty]\n           ]\n        ]\n</code></pre>\n\n<p>Note: that for <code>User3237465.hs</code> we need a Language Pragma</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\nmodule User3237465 where\n\ndata Tree a = Empty | Node a [Tree a] deriving (Eq, Show, Foldable)\n\naddNums :: Num a =&gt; Tree a -&gt; a\naddNums = sum\n\nmyInts ..\nmyDouble ..\n</code></pre>\n\n<p>We build a Folder/File structure like the following ( this we get with <code>stack new critExample</code> and a bit of copying/renaming/deleting)</p>\n\n<pre><code>../haskell/critExample/\n\u25be src/\n    Chi.hs\n    Sibi.hs\n    User3237465.hs\n\u25be bench/\n    Benchmarks.hs\n  critExample.cabal\n  LICENSE\n  Setup.hs\n  stack.yaml\n</code></pre>\n\n<p>the contents of <code>critExample.cabal</code> also needs some adjustment, </p>\n\n<pre><code>name:                critExample\n[... non-important stuff ...]\n\nlibrary\n  hs-source-dirs:      src\n  -- don't forget to adjust the exposed modules\n  exposed-modules:     Chi\n                 ,     Sibi\n                 ,     User3237465\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n  default-language:    Haskell2010\n\n-- and add the following benchmark part\nbenchmark addNums\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      bench\n  main-is:             Benchmarks.hs\n  build-depends:       base\n                     , critExample\n                     , criterion\n  default-language:    Haskell2010\n  [...]\n</code></pre>\n\n<p>then we can begin to write our benchmarks</p>\n\n<p><code>Benchmarks.hs</code></p>\n\n<pre><code>module Main where\n\nimport Criterion\nimport Criterion.Main\n\nimport qualified Chi\nimport qualified Sibi\nimport qualified User3237465\n\n\nmain :: IO ()\nmain = defaultMain [\n    bgroup \"myInts\" [ bench \"Sibi\"        $ whnf Sibi.addNums Sibi.myInts\n                    , bench \"Chi\"         $ whnf Chi.addNums Chi.myInts\n                    , bench \"User3237465\" $ whnf User3237465.addNums User3237465.myInts\n                    ],\n\n    bgroup \"myDouble\" [ bench \"Sibi\"        $ whnf Sibi.addNums Sibi.myDouble\n                      , bench \"Chi\"         $ whnf Chi.addNums Chi.myDouble\n                      , bench \"User3237465\" $ whnf User3237465.addNums User3237465.myDouble ]\n    ]\n</code></pre>\n\n<p>Note that <code>whnf</code> only evaluates to <em>weak head normal form</em>, i.e. to the first constructor it sees - for a list this would be after the first element when it sees the <code>(:)</code> operator for tuples it wouldn't evaluate a thing, but for <code>Int</code> or <code>Double</code> it fully evaluates stuff. If you need 'deep' evaluation use <code>nf</code> instead of <code>whnf</code> - if you are not sure what is needed, try both <code>whnf</code> is usually unreasonably fast (like nanoseconds for ultra-long lists - as it only checks the head of that list).</p>\n\n<p>You can build the project with <code>stack build</code> and then invoke the benchmarks with <code>stack bench</code> (triggers all available benchmarks) or <code>stack bench critExample:addNums</code> (useful if you have more than one benchmark suites and only want to run a specific one), usage is always <code>projectname:name of benchmarks given in cabal-file</code>.</p>\n\n<p>If you want fancy html output (- and believe me you want it, because bryan o'sullivan put a lot of effort in it to make it sexy) you'll have to:</p>\n\n<p><code>./.stack-work/dist/x86_64-linux/Cabal-1.22.4.0/build/addNums/addNums --output index.html</code></p>\n\n<p>of course this path might vary if you do not use a linux operating system.</p>\n\n<h2>Update2</h2>\n\n<p>The results of the benchmarks - I don't know how representative they are - I ran them in a virtualized linux!</p>\n\n<pre><code>Running 1 benchmarks...\nBenchmark addNums: RUNNING...\nbenchmarking myInts/Sibi\ntime                 616.7 ns   (614.1 ns .. 619.2 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 619.1 ns   (615.4 ns .. 626.8 ns)\nstd dev              17.09 ns   (9.625 ns .. 31.62 ns)\nvariance introduced by outliers: 38% (moderately inflated)\n\nbenchmarking myInts/Chi\ntime                 582.6 ns   (576.5 ns .. 592.1 ns)\n                     0.998 R\u00b2   (0.996 R\u00b2 .. 1.000 R\u00b2)\nmean                 586.2 ns   (581.5 ns .. 595.5 ns)\nstd dev              21.14 ns   (11.56 ns .. 33.61 ns)\nvariance introduced by outliers: 52% (severely inflated)\n\nbenchmarking myInts/User3237465\ntime                 606.5 ns   (604.9 ns .. 608.2 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 607.0 ns   (605.5 ns .. 609.2 ns)\nstd dev              5.915 ns   (3.992 ns .. 9.798 ns)\n\nbenchmarking myInts/User3237465 -- folding variant see comments\ntime                 371.0 ns   (370.2 ns .. 371.7 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 372.5 ns   (370.8 ns .. 375.0 ns)\nstd dev              6.824 ns   (4.076 ns .. 11.19 ns)\nvariance introduced by outliers: 22% (moderately inflated)\n\nbenchmarking myDouble/Sibi\ntime                 678.9 ns   (642.3 ns .. 743.8 ns)\n                     0.978 R\u00b2   (0.958 R\u00b2 .. 1.000 R\u00b2)\nmean                 649.9 ns   (641.1 ns .. 681.6 ns)\nstd dev              50.99 ns   (12.60 ns .. 105.0 ns)\nvariance introduced by outliers: 84% (severely inflated)\n\nbenchmarking myDouble/Chi\ntime                 643.3 ns   (617.4 ns .. 673.6 ns)\n                     0.987 R\u00b2   (0.979 R\u00b2 .. 0.996 R\u00b2)\nmean                 640.6 ns   (626.7 ns .. 665.6 ns)\nstd dev              58.35 ns   (40.63 ns .. 87.82 ns)\nvariance introduced by outliers: 88% (severely inflated)\n\nbenchmarking myDouble/User3237465\ntime                 630.4 ns   (622.9 ns .. 638.5 ns)\n                     0.997 R\u00b2   (0.994 R\u00b2 .. 0.999 R\u00b2)\nmean                 637.8 ns   (625.4 ns .. 659.8 ns)\nstd dev              53.15 ns   (33.46 ns .. 78.36 ns)\nvariance introduced by outliers: 85% (severely inflated)\n\nbenchmarking myDouble/User3237465 -- folding variant see comments\ntime                 398.1 ns   (380.7 ns .. 422.0 ns)\n                     0.988 R\u00b2   (0.980 R\u00b2 .. 0.996 R\u00b2)\nmean                 400.6 ns   (389.1 ns .. 428.6 ns)\nstd dev              55.83 ns   (28.94 ns .. 103.6 ns)\nvariance introduced by outliers: 94% (severely inflated)\n\nBenchmark addNums: FINISH\nCompleted all 2 actions.\n</code></pre>\n\n<p>As noted in the comments - another variant using <code>import Data.Foldable (foldl')</code> and <code>addNums' = foldl' (+) 0</code> is significantly faster (thanks @User3237465!!)</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1450764713, "post_id": 34407525, "comment_id": 56560390, "body": "<a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow noreferrer\">Right folding is not efficient for summing integers</a>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450777745, "post_id": 34407525, "comment_id": 56566596, "body": "@user3237465 Those are regular integers. I&#39;m talking about Church Encoded structures."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450780763, "post_id": 34407525, "comment_id": 56568645, "body": "Church-encoded structures represent right folds. I guess with the current <a href=\"http://www.joachim-breitner.de/publications/CallArity-TFP.pdf\" rel=\"nofollow noreferrer\">call arity</a> analysis <code>foldl&#39;</code> in terms of <code>foldr</code> perform optimally for Church-encoded lists as well as for usual, but call arity doesn&#39;t always work well for trees as described in the paper. So, what&#39;s you definition of <code>sum</code>? And with all fancy optimizations GHC performs, dealing with Church-encoded data looks like a premature optimization, useless in most cases."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450832352, "post_id": 34407525, "comment_id": 56595301, "body": "@user3237465 For the first <code>Tree</code>, <code>sumtree (Tree func) = func 0 (\\a ls -&gt; a + sum ls)</code>. Notice that neither <code>Tree</code> nor <code>sumtree</code> use recursion. Although it resembles a right fold, there is no <code>foldr</code> to speak of. <code>Tree</code> is just a function and <code>sum</code> is just function application. Since there is no recursion, GHC can optimize it a lot. See <a href=\"http://okmij.org/ftp/tagless-final/course/Boehm-Berarducci.html\" rel=\"nofollow noreferrer\">okmij.org/ftp/tagless-final/course/Boehm-Berarducci.html</a> and <a href=\"https://www.reddit.com/r/haskell/comments/3urjm3/a_series_about_optimization/cxhzz7n\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3urjm3/&hellip;</a> ."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450832624, "post_id": 34407525, "comment_id": 56595362, "body": "@user3237465 Indeed, if you look at GHC&#39;s list code, most of its optimizations are just ways of <i>eliminating recursion</i>.  See <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-Exts.html#v:build\" rel=\"nofollow noreferrer\">build</a> and augment (which are closely related to Church Lists). GHC converts everything to them because they are easier to optimize."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450857217, "post_id": 34407525, "comment_id": 56602992, "body": "Compile <a href=\"http://lpaste.net/147700\" rel=\"nofollow noreferrer\">this</a> with <code>-O2</code> and observe a huge memory leak. Then try <a href=\"http://lpaste.net/147701\" rel=\"nofollow noreferrer\">this</a>. The former is 3 times slower than the latter. Yes, Church-encoded data is just a function, but that doesn&#39;t mean it&#39;s efficient."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450871926, "post_id": 34407525, "comment_id": 56611194, "body": "@user3237465 My example uses no recursion."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450874292, "post_id": 34407525, "comment_id": 56612575, "body": "<code>sumtree</code> is not recursive, but to construct a <code>Tree</code> you&#39;ll need either to write everything by hand, which is impossible for big trees, or use recursion (but the presense of recursion is irrelevant anyway). Again, Church-encoded datas are non-tail-recursive functions, which are inefficient for certain tasks like summing integers. <a href=\"http://lpaste.net/147708\" rel=\"nofollow noreferrer\">Here</a> is a code which runs in 9s on my slow machine, can you beat this using Church-encoded trees?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450927720, "post_id": 34407525, "comment_id": 56635733, "body": "@user3237465 <a href=\"http://lpaste.net/147760\" rel=\"nofollow noreferrer\">This</a> runs an order of magnitude faster, <i>with yours using <code>-O2</code> and mine using <code>runghc</code></i>. (With both using <code>-O2</code>, mine runs three orders of magnitude faster.) Also, I constructed the tree neither by hand nor by recursion (and no foldr either). (GHC optimizations work best with lists (since it can optimize lists into Church List like structures), but not user defined types.)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450928239, "post_id": 34407525, "comment_id": 56635842, "body": "@user3237465 (I could probably double its speed, since I have certain duplicated code that could be put into a <code>let</code> block.)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450960016, "post_id": 34407525, "comment_id": 56647010, "body": "OK, I posed the challenge wrongly: one additional rule is &quot;no sharing&quot;. My code is about summing integers from an arbitrary tree, yours is about bottom-up dynamic programming. And that&#39;s why you&#39;re able to generate a tree without recursion: because you can build the tree bottom-up, which is rarely a case (but even in this case <code>twentyfive</code> is written &quot;by hand&quot;). Can you generate a big tree in which all numbers are distinct and compute their sum? (I wrote a <a href=\"http://lpaste.net/147776\" rel=\"nofollow noreferrer\">version</a>, but it leaks for some reason). Please, say if this conversation is annoying."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450974639, "post_id": 34407525, "comment_id": 56652732, "body": "@user3237465 Oh no, this conversation is fun. When I translate your code to church version, yours is slightly faster (<a href=\"http://lpaste.net/147776\" rel=\"nofollow noreferrer\">code</a>). Yet, if I optimize it, mine is about twice as fast (<a href=\"http://lpaste.net/147787\" rel=\"nofollow noreferrer\">code</a>). (Notice that the optimization I used for the second piece of code is only possible to church like structures.) Church Structures really kick in though when it comes to fusion and monads, which is why libraries like attoparsec use them. (Any other ideas for fold challenges?)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450974660, "post_id": 34407525, "comment_id": 56652742, "body": "(Of course, there are operations for which Church structures are bad. See <a href=\"http://stackoverflow.com/questions/32288370/more-efficient-tail-of-church-encoded-list\" title=\"more efficient tail of church encoded list\">stackoverflow.com/questions/32288370/&hellip;</a>. I was only thinking about folding though.)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450977052, "post_id": 34407525, "comment_id": 56653671, "body": "<a href=\"http://lpaste.net/147791\" rel=\"nofollow noreferrer\">Here</a> is an improved version of my code. It acts basically as yours. It looks like your code uses that <code>foldl</code>-in-terms-of-<code>foldr</code> technique I was talking about. And then you turn <code>foldl</code> into <code>foldl&#39;</code> using <code>BangPatterns</code>. No more challenges, that&#39;s the only thing I wanted to say: you have to make your right-fold-like thing left-fold-like to sum integers."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450978269, "post_id": 34407525, "comment_id": 56654035, "body": "@user3237465 I changed it back to right fold (whatever that means) and tweaked it a little, and now it is faster again (<a href=\"http://lpaste.net/147796\" rel=\"nofollow noreferrer\">lpaste.net/147796</a>)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450980686, "post_id": 34407525, "comment_id": 56654754, "body": "That&#39;s because of <code>Tree Int</code> which results in integer overflow. Change it to <code>Tree Integer</code> and you&#39;ll get the same performance as before. So at each step you clone the whole tree, shift all elements and make a new root. That&#39;s a &quot;right fold&quot;, perhaps I have something to learn."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450981014, "post_id": 34407525, "comment_id": 56654882, "body": "Also, both our versions allocate a great amount of memory. Probably it&#39;s the case that they both are just inefficient."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1450982286, "post_id": 34407525, "comment_id": 56655281, "body": "@user3237465 (<a href=\"http://lpaste.net/147799\" rel=\"nofollow noreferrer\">Here</a> is a way to improve it, but I&#39;m not sure if it counts. XD)"}], "tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 1, "last_activity_date": 1450982475, "last_edit_date": 1450982475, "creation_date": 1450750881, "answer_id": 34407525, "question_id": 34406541, "link": "https://stackoverflow.com/questions/34406541/efficient-folding-of-a-sum-tree/34407525#34407525", "title": "Efficient Folding Of A Sum Tree", "body": "<p>Actually, to increase efficiency, change your type. For folding purposes, you can't beat a Church Like Encoding. Might I recommend:</p>\n\n<pre><code>newtype Tree a = Tree {fold :: forall r. r -&gt; (a -&gt; [r] -&gt; r) -&gt; r}\n</code></pre>\n\n<p>Or even:</p>\n\n<pre><code>newtype Tree a = Tree {fold :: forall r. r -&gt; (a -&gt; ChurchList r -&gt; r) -&gt; r}\n</code></pre>\n\n<p>Or best yet:</p>\n\n<pre><code>newtype Tree a = Tree {fold :: forall tree list. tree -&gt; (a -&gt; list -&gt; tree) -&gt; list -&gt; (tree -&gt; list -&gt; list) -&gt; tree}\n</code></pre>\n\n<p>Church Encoding is more efficient because you do not have to traverse anything.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1450982475, "creation_date": 1450743247, "last_edit_date": 1495535301, "question_id": 34406541, "link": "https://stackoverflow.com/questions/34406541/efficient-folding-of-a-sum-tree", "title": "Efficient Folding Of A Sum Tree", "body": "<p>In this <a href=\"https://stackoverflow.com/questions/34378220/summing-an-integer-tree-haskell/\">earlier question</a>, I asked how to write a function that sums a non-binary integer tree, and several answers arose.</p>\n\n<p>@Sibi said:</p>\n\n<pre><code>data Tree a = Empty | Node a [Tree a] deriving (Eq, Show)\n\naddNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n []) = n\naddNums (Node n (x:xs)) = n + (addNums x) + addNums (Node 0 xs)\n</code></pre>\n\n<p>@user3237465 said:</p>\n\n<pre><code>data Tree a = Empty | Node a [Tree a] deriving (Eq, Show, Foldable)\n\nmyNums :: (Num a) =&gt; Tree a\nmyNums = ...\n\nmain = print $ sum myNums\n</code></pre>\n\n<p>and @chi said:</p>\n\n<pre><code>addNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n xs) = n + sum (map addNums xs)\n</code></pre>\n\n<p>How does one go about finding the most efficient solution?  Is there a native benchmarking tool in Haskell?  </p>\n"}, {"tags": ["haskell", "instance"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1450742268, "post_id": 34406372, "comment_id": 56554580, "body": "i am not sure if this is correct, but can you try <code>oneof [liftM FL arbitrary]</code> ?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1450742852, "post_id": 34406372, "comment_id": 56554759, "body": "I would&#39;ve expected just <code>liftM FL arbitrary</code> to work, without any need for <code>oneof</code>?"}, {"owner": {"reputation": 41, "user_id": 5609937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e45b59279056903ea3b256421f842267?s=128&d=identicon&r=PG&f=1", "display_name": "Luxzero", "link": "https://stackoverflow.com/users/5609937/luxzero"}, "edited": false, "score": 0, "creation_date": 1450743193, "post_id": 34406372, "comment_id": 56554850, "body": "I got this &#39;Not in scope: data constructor FL&#39;"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450765031, "post_id": 34406372, "comment_id": 56560487, "body": "You need to export it from the module defining it and import it in the module defining the instance."}, {"owner": {"reputation": 41, "user_id": 5609937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e45b59279056903ea3b256421f842267?s=128&d=identicon&r=PG&f=1", "display_name": "Luxzero", "link": "https://stackoverflow.com/users/5609937/luxzero"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450789698, "post_id": 34406372, "comment_id": 56574198, "body": "Isn&#39;t a &#39;import FavoriteList&#39; enough? @AlexeyRomanov"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450790153, "post_id": 34406372, "comment_id": 56574461, "body": "No. You need to import <code>FL</code> as well. <code>import FavoriteList(FL)</code> or <code>import FavoriteList(..)</code> (and same for export)."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 3, "last_activity_date": 1450749946, "last_edit_date": 1495539987, "creation_date": 1450743214, "answer_id": 34406539, "question_id": 34406372, "link": "https://stackoverflow.com/questions/34406372/instancing-arbitrary/34406539#34406539", "title": "Instancing arbitrary", "body": "<p>You're attempting to use the type-level term <code>FavoriteList</code> at the value-level. <code>FL</code> is the value-level term that constructs a value of type <code>FavoriteList a</code> for whatever <code>a</code> you choose. <code>FL &lt;$&gt; arbitrary</code> should be sufficient, or equivalently <code>fmap FL arbitrary</code> or <code>liftM FL arbitrary</code>. For a more thorough explanation of Haskell's type- and value-level languages, see <a href=\"https://stackoverflow.com/a/16893900/2225384\">this excellent answer by Conor McBride</a>.</p>\n"}], "owner": {"reputation": 41, "user_id": 5609937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e45b59279056903ea3b256421f842267?s=128&d=identicon&r=PG&f=1", "display_name": "Luxzero", "link": "https://stackoverflow.com/users/5609937/luxzero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 34406539, "answer_count": 1, "score": 0, "last_activity_date": 1450749946, "creation_date": 1450742138, "question_id": 34406372, "link": "https://stackoverflow.com/questions/34406372/instancing-arbitrary", "title": "Instancing arbitrary", "body": "<p>I'm having trouble writing an instance of Arbitrary for my data type. Which is the following:</p>\n\n<pre><code>    data FavoriteList a = FL [(a, Bool)] deriving Eq\n</code></pre>\n\n<p>This is what I have:</p>\n\n<pre><code>    instance Arbitrary a =&gt; Arbitrary(FavoriteList a) where\n       arbitrary = oneof [liftM FavoriteList arbitrary]\n</code></pre>\n\n<p>But I'm getting the following error:</p>\n\n<pre><code>    Not in scope: data constructor 'FavoriteList'\n</code></pre>\n\n<p>I'm probably not understanding something about types and constructors I think...Can someone help me out?</p>\n"}, {"tags": ["haskell", "abstraction"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1450743283, "post_id": 34406241, "comment_id": 56554879, "body": "Is your question how to define <code>return</code> and <code>&gt;&gt;=</code> for <code>Concurrent</code> as you&#39;ve defined it above?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1450743356, "post_id": 34406241, "comment_id": 56554895, "body": "Also, slight typo - I think you mean, <code>data Concurrent a = Concurrent (ContinuationPseudoMonad a)</code>, as <code>data Concurrent a = Concurrent ContinuationPseudoMonad a</code> is an error."}, {"owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1450743810, "post_id": 34406241, "comment_id": 56555015, "body": "I corrected accordingly to your statement. The thing is I don&#39;t succeed to grasp what a `Continuation a -&gt; Action&#39; is. A name for this abstraction would be great."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1450800699, "post_id": 34406241, "comment_id": 56581242, "body": "I think the only word is &#39;monad without its <code>newtype</code> wrapper&#39; (incidentally, <code>newtype</code> is better than <code>data</code> for <code>Concurrent</code> since it doesn&#39;t add an extra layer at runtime to represent the <code>Concurrent</code> constructor) or &#39;continuation-passing-style function&#39;."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1451423413, "post_id": 34406241, "comment_id": 56779428, "body": "I do admire your desire for descriptive names at every level"}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1450746591, "creation_date": 1450746591, "answer_id": 34406985, "question_id": 34406241, "link": "https://stackoverflow.com/questions/34406241/continuation-abstraction/34406985#34406985", "title": "Continuation abstraction", "body": "<p>You seem to be reaching for some vocabulary, which is a hard question to phrase. Let's break down what you have into steps, and see if that helps.</p>\n\n<pre><code>data Action = Atom (IO Action)\n            | Fork Action Action\n            | Stop\n</code></pre>\n\n<p><code>Action</code> is an <em>algebraic data type</em> with three <em>constructors</em>. It is a <em>corecursive</em> data type as it is defined in terms of itself.</p>\n\n<pre><code>type Continuation a = a -&gt; Action\n</code></pre>\n\n<p><code>Continuation a</code> is a <em>type alias</em> for the <em>function type</em> <code>a -&gt; Action</code>. It is an example of a <code>contravariant functor</code>, since we could define a function</p>\n\n<pre><code>contramap :: (a -&gt; b) -&gt; Continuation b -&gt; Continuation a\ncontramap aToB bToAction = aToAction \n  where aToAction = \\a -&gt; bToAction (aToB a)\n</code></pre>\n\n<p>Note the reversal - <code>contramap</code> takes a function <code>a -&gt; b</code> and creates a function <code>Continuation b -&gt; Continuation a</code>.</p>\n\n<pre><code>type ContinuationPseudoMonad a = Continuation a -&gt; Action\n</code></pre>\n\n<p><code>ContinuationPseudoMonad a</code> is another type alias for a function type, but since <code>Continuation a</code> is also a function type, <code>ContinuationPseudoMonad a</code> is a type of <em>higher-order function</em>, since it takes a function as an argument.</p>\n\n<p><code>ContinuationPseudoMonad a</code> is also a <em>functor</em>, but it's a <em>covariant functor</em>, as we could define a function</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; ContinuationPseudoMonad a -&gt; ContinuationPseudoMonad b\nfmap aToB aToActionToAction = bToActionToAction\n  where bToActionToAction = \\bToAction -&gt; aToActionToAction (\\a -&gt; bToAction (aToB a))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 2, "last_activity_date": 1450796887, "creation_date": 1450796887, "answer_id": 34418786, "question_id": 34406241, "link": "https://stackoverflow.com/questions/34406241/continuation-abstraction/34418786#34418786", "title": "Continuation abstraction", "body": "<p>It is evident <code>Concurrent a</code> is the same as <code>Cont Action a</code> where <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Cont.html#t:Cont\" rel=\"nofollow\"><code>Cont</code></a> is the continuation monad. Here's a simple explanation for continuations:</p>\n\n<ol>\n<li>Consider the function <code>f :: a -&gt; b</code> for some arbitrary types <code>a</code> and <code>b</code>. We want to convert this function into continuation passing style. How do we do so?</li>\n<li>Let's say we have a continuation <code>k :: b -&gt; r</code> which takes the return value of <code>f</code> as an input and itself returns a value of an arbitrary type <code>r</code>. Following this, we can convert <code>f</code> to CPS.</li>\n<li>Let <code>g :: a -&gt; (b -&gt; r) -&gt; r</code> be the CPS version function of <code>f</code>. Note that it takes an additional argument (i.e. the continuation <code>k</code>) and returns the result of <code>k</code> applied to its output <code>b</code>.</li>\n</ol>\n\n<p>Let's take a practical example where <code>f</code> is the predicate function <code>odd :: Int -&gt; Bool</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>odd :: Int -&gt; Bool\nodd n = n `mod` 2 == 1\n</code></pre>\n\n<p>Here's the same function written in continuation passing style:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>odd' :: Int -&gt; (Bool -&gt; r) -&gt; r\nodd' n k = k (n `mod` 2 == 1)\n</code></pre>\n\n<p>The <code>(Bool -&gt; r) -&gt; r</code> part can be abstracted out as the continuation monad:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Cont r a = Cont { runCont :: (a -&gt; r) -&gt; r }\n\nodd' :: Int -&gt; Cont r Bool\nodd' n = return (n `mod` 2 == 1)\n\ninstance Monad (Cont r) where\n    return a = Cont (\\k -&gt; k a)\n    m  &gt;&gt;= f = Cont (\\k -&gt; runCont m (\\a -&gt; runCont (f a) k))\n</code></pre>\n\n<p>Notice that the type of the continuation <code>k</code> is <code>Bool -&gt; r</code> for some arbitrary type <code>r</code>. Hence, the continuation <code>k</code> could be any function which takes a <code>Bool</code> as an argument. For example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>cont :: Bool -&gt; IO ()\ncont = print\n\nmain :: IO ()\nmain = odd' 21 cont\n</code></pre>\n\n<p>However, in the case of <code>Concurrent</code> this <code>r</code> is not arbitrary. It has been specialized to <code>Action</code>. In fact, we can define <code>Concurrent</code> as a type synonym for <code>Cont Action</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Concurrent = Cont Action\n</code></pre>\n\n<p>Now, we don't need to implement the <code>Monad</code> instance for <code>Concurrent</code> because it's the same as the <code>Monad</code> instance for <code>Cont r</code> as defined above.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runConcurrent :: Concurrent a -&gt; ContinuationPseudoMonad a\nrunConcurrent (Concurrent g) = g\n\ninstance Monad Concurrent where\n    return a = Concurrent (\\k -&gt; k a)\n    m  &gt;&gt;= f = Concurrent (\\k -&gt; runConcurrent m (\\a -&gt; runConcurrent (f a) k))\n</code></pre>\n\n<p>Note that nowhere in the definition of <code>instance Monad Concurrent</code> have we made use of <code>Action</code>. That's because <code>Concurrent = Cont Action</code> and the monad instance of <code>Cont r</code> uses <code>r</code> transparently.</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 34418786, "answer_count": 2, "score": 0, "last_activity_date": 1451421774, "creation_date": 1450741367, "last_edit_date": 1451421774, "question_id": 34406241, "link": "https://stackoverflow.com/questions/34406241/continuation-abstraction", "title": "Continuation abstraction", "body": "<p>In a general exercise about concurrency based on this <a href=\"http://www.diku.dk/hjemmesider/ansatte/jespera/downloads/jfp99-monad.ps\" rel=\"nofollow\">article</a>.  </p>\n\n<p>We have:</p>\n\n<pre><code>-- a is the result type on which after we continue\ntype Continuation a = a-&gt; Action\n\ntype ContinuationPseudoMonad a = Continuation a -&gt; Action\n-- pseudoMonad because it will need Concurrent wrapper Monad:\n-- so as to define bind operation and return operation on it\n\ndata Concurrent a = Concurrent (ContinuationPseudoMonad a)\n</code></pre>\n\n<p>so <code>Concurrent a</code> is a monad we have to implement with its two mandatory laws, return and bind.</p>\n\n<p>Unfortunatly, I find no adequate words for defining more precisely the ContinuationPseudoMonad thing... and if I lack words, I lack abstraction in my mind.</p>\n\n<p>How would you call it ? </p>\n\n<p>Is there a word meaning <code>Continuation a -&gt; Action</code> instead of my awkward meaningless <code>ContinuationPseudoMonad</code> ?</p>\n\n<p>Action being:</p>\n\n<pre><code>data Action = Atom (IO Action)\n            | Fork Action Action\n            | Stop\n</code></pre>\n"}, {"tags": ["haskell", "graph-theory", "graph-algorithm"], "answers": [{"comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1450745129, "post_id": 34406509, "comment_id": 56555374, "body": "Lovely! The one problem I currently see is that <code>last</code> fails when <code>seed</code> is empty."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1450745756, "post_id": 34406509, "comment_id": 56555543, "body": "Good point. I have edited to add <code>seed</code> in front of the list generated by the <code>unfoldr</code>."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1450745734, "last_edit_date": 1450745734, "creation_date": 1450743009, "answer_id": 34406509, "question_id": 34406069, "link": "https://stackoverflow.com/questions/34406069/given-a-starting-set-of-nodes-and-a-successors-function-node-set-node-find/34406509#34406509", "title": "Given a starting set of nodes and a successors function (node -&gt; Set node), find all the reachable nodes of a graph", "body": "<p>You haven't included test cases so I haven't run this solution on any examples: some bugs are probably lying here and there. But something like this ought to work:</p>\n\n<ul>\n<li><p>Write a function <code>step</code> which, given a set of visited nodes and set of nodes on the frontier of the explored subgraph, takes one step in all directions on that frontier. The result being a new set of visited nodes and a new frontier.</p></li>\n<li><p>use <code>unfoldr</code> to repeatedly apply this function thus getting a list of the (growing) sets of visited nodes. The closure is simply the <code>last</code> element of that list.</p></li>\n</ul>\n\n<p>Which is what the following code does:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Reachability where\n\nimport Control.Monad (guard)\nimport Data.List (unfoldr)\nimport Data.Set (Set, union, empty, (\\\\))\nimport qualified Data.Set as Set\n\nreachable' :: forall node. Ord node =&gt; Set node -&gt; (node -&gt; Set node) -&gt; Set node\nreachable' seed next = last $ seed : unfoldr step (seed, empty) where\n\n  step :: (Set node, Set node) -&gt; Maybe (Set node, (Set node, Set node))\n  step (seed, visited) = guard (not $ null seed) &gt;&gt;\n    let successors = foldr (union . next) empty seed\n        newVisited = visited `union` seed\n        newSeed    = successors \\\\ newVisited\n    in return (newVisited, (newSeed, newVisited))\n</code></pre>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1450745734, "creation_date": 1450740303, "question_id": 34406069, "link": "https://stackoverflow.com/questions/34406069/given-a-starting-set-of-nodes-and-a-successors-function-node-set-node-find", "title": "Given a starting set of nodes and a successors function (node -&gt; Set node), find all the reachable nodes of a graph", "body": "<p>I currently have the following implementation, but I'm wondering whether there's a solution that's either faster or doesn't use explicit recursion:</p>\n\n<pre><code>import Data.Set (Set)\nimport qualified Data.Set as Set\n\nreachable :: Ord node =&gt; Set node -&gt; (node -&gt; Set node) -&gt; Set node\nreachable startingNodes successors =\n    go startingNodes Set.empty\n  where\n    go todo checked =\n        case Set.minView todo of\n            Nothing -&gt; checked\n            Just (node, todo') -&gt;\n                let new = successors node Set.\\\\ checked\n                    todo'' = todo' `Set.union` new\n                    checked' = Set.insert node checked\n                in go todo'' checked'\n</code></pre>\n"}, {"tags": ["haskell", "phantom-types"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450744387, "post_id": 34405952, "comment_id": 56555174, "body": "The simplest way to do any computation with types is with type classes. What function in particular would you want to write?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450751070, "post_id": 34406712, "comment_id": 56556821, "body": "The fact that <code>SUnitLength</code> is a GADT, and therefore closed, seems a bit awkward. Further, I don&#39;t see why you&#39;d want to pattern match on the unit. Would something like a data family be more appropriate?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450778475, "post_id": 34406712, "comment_id": 56567039, "body": "<code>UnitLength</code> was already closed so it was impossible to use <code>Length</code> with anything but the three provided units."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450803711, "post_id": 34406712, "comment_id": 56583146, "body": "Well yes, but couldn&#39;t that be swapped out for <code>*</code> or something?"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 5, "last_activity_date": 1450744510, "creation_date": 1450744510, "answer_id": 34406712, "question_id": 34405952, "link": "https://stackoverflow.com/questions/34405952/retrieve-hidden-type-of-a-phantom-type/34406712#34406712", "title": "Retrieve hidden type of a phantom type", "body": "<p>If you want a runtime representation of the phantom type you have used, you have to use what we call a singleton. It has precisely one constructor for each ones of the constructors in <code>UnitLength</code> and their types say precisely which constructor we are considering:</p>\n\n<pre><code>data SUnitLength (a :: UnitLength) where\n  SMeter     :: SUnitLength Meter\n  SKiloMeter :: SUnitLength KiloMeter\n  SMiles     :: SUnitLength Miles\n</code></pre>\n\n<p>Now that you have this you can for instance write a display function picking the right unit abbreviation depending on the phantom parameter:</p>\n\n<pre><code>display :: Show b =&gt; SUnitLength a -&gt; Length a b -&gt; String\ndisplay sa l = show (payload l) ++\n  case sa of\n    SKiloMeter -&gt; \"km\"\n    _          -&gt; \"m\"\n</code></pre>\n\n<p>Now, that does not really match your demand: the parameter <code>a</code> is available in the type <code>Length a b</code> but we somehow still have to manufacture the witness by hand. That's annoying. One way to avoid this issue is to define a type class doing that work for us. <code>CUnitLength a</code> tells us that provided a value of type <code>Length a b</code>, we can get a witness <code>SUnitLength a</code> of the shape <code>a</code> has.</p>\n\n<pre><code>class CUnitLength (a :: UnitLength) where\n  getUnit :: Length a b -&gt; SUnitLength a\n</code></pre>\n\n<p>It is easy for us to write instances of <code>CUnitLength</code> for the various <code>UnitLength</code> constructors: <code>getUnit</code> can even ignore its argument!</p>\n\n<pre><code>instance CUnitLength Meter where\n  getUnit _ = SMeter\n\ninstance CUnitLength KiloMeter where\n  getUnit _ = SKiloMeter\n\ninstance CUnitLength Miles where\n  getUnit _ = SMiles\n</code></pre>\n\n<p>So why bother with <code>getUnit</code>'s argument? Well if we remove it, <code>getUnit</code> needs to somehow magically guess which <code>a</code> it is suppose to describe. Sometimes it's possible to infer that \u0300<code>a</code> based on the expected type at the call site but sometimes it's not. Having the <code>Length a b</code> argument guarantees that all calls will be unambiguous. We can always recover a simpler <code>getUnit'</code> anyway:</p>\n\n<pre><code>getUnit' :: CUnitLength a =&gt; SUnitLength a\ngetUnit' = getUnit (undefined :: Length a ())\n</code></pre>\n\n<p>Which leads us to the last definition <code>display'</code> which has the same role as <code>display</code> but does not require the extra argument:</p>\n\n<pre><code>display' :: (CUnitLength a, Show b) =&gt; Length a b -&gt; String\ndisplay' = display getUnit'\n</code></pre>\n\n<p>I have put everything (including the LANGUAGE extensions, and the definition of <code>payload</code> to extract a <code>b</code> from <code>Length a b</code>) in a <a href=\"https://gist.github.com/gallais/b08d7ba495ea2e91968c\" rel=\"noreferrer\">self-contained gist</a> in case you want to play with the code.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "accepted_answer_id": 34406712, "answer_count": 1, "score": 0, "last_activity_date": 1450744510, "creation_date": 1450739585, "question_id": 34405952, "link": "https://stackoverflow.com/questions/34405952/retrieve-hidden-type-of-a-phantom-type", "title": "Retrieve hidden type of a phantom type", "body": "<p>I declared a a phantom type like this with Haskell.</p>\n\n<pre><code>newtype Length (a::UnitLength) b = Length b deriving (Eq,Show)\ndata UnitLength = Meter\n                | KiloMeter\n                | Miles\n                deriving (Eq,Show)\n</code></pre>\n\n<p>Now, I would like to write some functions to use this type. But I didn't happened to see and use the hidden type.</p>\n\n<p><strong>Is it possible to retrieve the hidden type <code>a</code> of the phantom type <code>Length</code> to perform test, pattern matching, .... ?</strong></p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1450730113, "creation_date": 1450730113, "answer_id": 34403905, "question_id": 34403139, "link": "https://stackoverflow.com/questions/34403139/exceptt-resourcet-vs-resourcet-exceptt/34403905#34403905", "title": "&#39;ExceptT ResourceT&#39; vs &#39;ResourceT ExceptT&#39;", "body": "<p>In this example, there is no real difference between both orders. The reason being: unlike many transformers including <code>ExceptT</code>, the resource transformer does <em>not</em> &ldquo;inject&rdquo; its own doings into the base monad you apply it to, but rather start off the entire action with passing in the release references. </p>\n\n<p>If you write out the types (I'll refer to <code>MaybeT</code> instead of <code>ExceptT</code> for the sake of simplicity; they're obviously equivalent for the purpose of this question) then you have basically</p>\n\n<pre><code>type MaybeResourceT m a = MaybeT (IORef RelMap -&gt; m a)\n                        = IORef RelMap -&gt; m (Maybe a)\ntype ResourceMaybeT m a = ResourceT (m (Maybe a))\n                        = IORef RelMap -&gt; m (Maybe a)\n</code></pre>\n\n<p>i.e. actually equivalent types. I suppose you could also show that for the operations.</p>\n"}], "owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 34403905, "answer_count": 1, "score": 5, "last_activity_date": 1450730113, "creation_date": 1450726762, "question_id": 34403139, "link": "https://stackoverflow.com/questions/34403139/exceptt-resourcet-vs-resourcet-exceptt", "title": "&#39;ExceptT ResourceT&#39; vs &#39;ResourceT ExceptT&#39;", "body": "<p>Real World Haskell states that <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\">\"Transformer stacking order is important\"</a>. However, I can't seem to figure out if there's a difference between <code>ExceptT (ResourceT m) a</code> and <code>ResourceT (ExceptT m) a</code>. Will they interfere with each other?</p>\n"}, {"tags": ["javascript", "html", "haskell", "canvas", "reflex"], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1450726148, "creation_date": 1450726148, "question_id": 34402969, "link": "https://stackoverflow.com/questions/34402969/how-do-you-create-a-dynamic-canvas-from-an-image-in-haskells-reflex-lib", "title": "How do you create a dynamic canvas from an image in Haskell&#39;s Reflex lib?", "body": "<p>I am representing an image as:</p>\n\n<pre><code>data Image = Image { size :: V2 Int, buffer :: UVector.Vector Word32 }\n</code></pre>\n\n<p>That is, a row-major unboxed array of RGBA Word32 pixels. That format is the same used by JavaScript's Canvas's ImageData. You could blit such a vector into a JS's canvas with something like:</p>\n\n<pre><code>function blit(canvas, img){\n    var ctx = canvas.getContext(\"2d\");\n    ctx.putImageData(new ImageData(img.buffer, img.size.x, img.size.y), 0, 0);\n};\n</code></pre>\n\n<p>What I want is to have a widget on Haskell that calls this \"blit\" function on the cames every other frame using a <code>Dynamic Image</code>. How is that possible?</p>\n"}, {"tags": ["haskell", "hamlet"], "owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1450722687, "creation_date": 1450722687, "question_id": 34402152, "link": "https://stackoverflow.com/questions/34402152/hamlet-quasiquoter-haskell-allowed-syntax-in-if-elseif-else-expressions", "title": "Hamlet quasiquoter (Haskell): Allowed syntax in if-elseif-else expressions", "body": "<p>The Hamlet quasiquoter allows if-then-else syntax like</p>\n\n<pre><code>  [hamlet|\n   $if 3 &lt; 4\n     Three is less than 4.\n   $elseif \"a\" == \"b\"\n     'a' equals 'b'.\n   $else\n     Nothing worked out.\n  |]\n</code></pre>\n\n<p>However, I find that if I replace the test <code>\"a\" == \"b\"</code> with <code>'a' == 'b'</code> I get an error complaining that 'a' is an illegal variable name.</p>\n\n<p>So what syntax is and is not allowed in an <code>$if</code> or <code>$elseif</code> test? I have not been able to find this documented anywhere.</p>\n"}, {"tags": ["string", "haskell", "io", "unique-index"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1450721248, "post_id": 34401549, "comment_id": 56544928, "body": "quibble: words creates a <i>list</i> not an array. Also, you might want to look at <a href=\"https://www.haskell.org/hoogle/?hoogle=nub\" rel=\"nofollow noreferrer\"><code>nub</code></a> or <a href=\"https://www.haskell.org/hoogle/?hoogle=Data.Set.fromList\" rel=\"nofollow noreferrer\"><code>Data.Set.fromList</code></a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450721570, "post_id": 34401549, "comment_id": 56545078, "body": "Well it behaves like one :) i don&#39;t want to miss duplicates of one word. I wonder if there are, how can i delete them and leave the unique ones alone?"}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1450721765, "post_id": 34401549, "comment_id": 56545180, "body": "You can look at the two reference @rampion provided and the one I provided: <a href=\"http://stackoverflow.com/questions/3098391/unique-elements-in-a-haskell-list#3098417\" title=\"unique elements in a haskell list%233098417\">stackoverflow.com/questions/3098391/&hellip;</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450721904, "post_id": 34401549, "comment_id": 56545262, "body": "Ohh i double searched but couldn&#39;t see the duplicate question. So sorry. Thanks for help guys!"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1450722545, "post_id": 34401549, "comment_id": 56545586, "body": "Here&#39;s how they differ: a list in haskell has takes 1 step to prepend a new element, but <code>n</code> steps to access the <code>n</code>&#39;th element. An array can access it&#39;s <code>n</code>&#39;th element in a single step, but prepending an element can take a number of steps equal to the size of the array."}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1450722270, "answer_count": 0, "score": 0, "last_activity_date": 1563081049, "creation_date": 1450720113, "last_edit_date": 1563081049, "question_id": 34401549, "link": "https://stackoverflow.com/questions/34401549/words-without-reccurence-in-haskell", "closed_reason": "Duplicate", "title": "Words without reccurence in haskell", "body": "<p>I wonder one thing in haskell while i was working around lists of strings. For example when i try to something like;</p>\n\n<pre><code>words \"hello world\"\n</code></pre>\n\n<p>It sends the words into an array and whenever i want to get an element i use \"!!\" notation as normal. \nGiven us a text, how can we find the words such that they have no other from itself? For example in \"hello world\" case both \"hello\" and \"world\" are unique words but if i write \"hello hello world\" in this case only the world is unique. How can i implement such code? Will using words still be useful? Is there a default method for that reason? </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1450740919, "creation_date": 1450740919, "answer_id": 34406178, "question_id": 34401504, "link": "https://stackoverflow.com/questions/34401504/can-you-have-different-compilers-and-resolvers-on-stack/34406178#34406178", "title": "Can you have different compilers and resolvers on Stack?", "body": "<p>I think you have to either </p>\n\n<ul>\n<li><p>use two different files, say <code>ghc.yaml</code> and <code>ghcjs.yaml</code>, you can then use <code>stack --stack-yaml ghc.yaml</code> or <code>stack --stack-yaml ghcjs.yaml</code> to use those</p>\n\n<ul>\n<li>you can set the compiler <code>ghc</code> or <code>ghcjs</code> by setting the <code>resolver</code> (see <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration.html#resolver\" rel=\"nofollow\">haskellstack.org/config#resolver</a>)</li>\n<li>or there is a compiler option (see <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration.html#compiler\" rel=\"nofollow\">haskellstack.org/config#compiler</a>)</li>\n</ul></li>\n<li><p>or directly use the commandline option <code>--compiler</code></p></li>\n</ul>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 34406178, "answer_count": 1, "score": 2, "last_activity_date": 1450740919, "creation_date": 1450719901, "question_id": 34401504, "link": "https://stackoverflow.com/questions/34401504/can-you-have-different-compilers-and-resolvers-on-stack", "title": "Can you have different compilers and resolvers on Stack?", "body": "<p>I have a Stack project that can build both GHCJS and GHC binaries. How can I specify on <code>stack.yaml</code> that builds should use both compilers?</p>\n"}, {"tags": ["haskell", "emacs", "quickcheck", "haskell-mode"], "comments": [{"owner": {"reputation": 568, "user_id": 1867082, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/582ce4225fd51413e5758c795263759b?s=128&d=identicon&r=PG&f=1", "display_name": "Gracjan Polak", "link": "https://stackoverflow.com/users/1867082/gracjan-polak"}, "edited": false, "score": 1, "creation_date": 1454872921, "post_id": 34400820, "comment_id": 58228255, "body": "Is this the same issue as described in <a href=\"https://github.com/haskell/haskell-mode/issues/51\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-mode/issues/51</a> ?"}, {"owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "reply_to_user": {"reputation": 568, "user_id": 1867082, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/582ce4225fd51413e5758c795263759b?s=128&d=identicon&r=PG&f=1", "display_name": "Gracjan Polak", "link": "https://stackoverflow.com/users/1867082/gracjan-polak"}, "edited": false, "score": 0, "creation_date": 1454940752, "post_id": 34400820, "comment_id": 58254806, "body": "Yes, it seems to be. Thanks for the link."}], "owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1450776208, "creation_date": 1450717295, "last_edit_date": 1450776208, "question_id": 34400820, "link": "https://stackoverflow.com/questions/34400820/quickcheck-together-with-haskell-mode-in-emacs-h", "title": "QuickCheck together with haskell-mode in emacs, ^H", "body": "<p>When using QuickCheck together with haskell-mode in emacs, the output starts with (continuing up to the default of 100 tests):</p>\n\n<pre><code>(0 tests)^H^H^H^H^H^H^H^H^H         ^H^H^H^H^H^H^H^H^H(1 test)\n</code></pre>\n\n<p>where ^H (Control H) is the UNIX terminal representation of backspace. Now I found <a href=\"http://www.emacswiki.org/emacs/BackspaceKey\" rel=\"nofollow\">some solutions for handling ^H in emacs</a>, but I do not quite see how that helps me.</p>\n\n<p>I've tried toggling <code>normal-erasure-is-backspace-mode</code>, but that has not worked, besides disabling my backspace key.  I wonder whether the right solution does not lie with QuickCheck or haskell-mode instead.  I've also tried fiddling with the terminal option that determines how the terminal encodes backspace and delete, but that has not made any difference.</p>\n\n<p>A minimal quickCheck example:</p>\n\n<pre><code>import Test.QuickCheck\n\nprop :: Int -&gt; Bool\nprop x = True\n\nmain = quickCheck prop\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450741172, "post_id": 34400624, "comment_id": 56554225, "body": "maybe this is what you are looking for: <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration.html#ghc-options\" rel=\"nofollow noreferrer\">ghc-options</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 1, "last_activity_date": 1458267539, "creation_date": 1458267539, "answer_id": 36075015, "question_id": 34400624, "link": "https://stackoverflow.com/questions/34400624/how-do-you-disable-all-optimizations-on-stack-for-development-purposes/36075015#36075015", "title": "How do you disable all optimizations on stack for development purposes?", "body": "<p>Yeah, as epsilonhalbe points out, <code>--ghc-options -O0</code> or similar in the stack.yaml</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 36075015, "answer_count": 1, "score": 1, "last_activity_date": 1458267539, "creation_date": 1450716662, "question_id": 34400624, "link": "https://stackoverflow.com/questions/34400624/how-do-you-disable-all-optimizations-on-stack-for-development-purposes", "title": "How do you disable all optimizations on stack for development purposes?", "body": "<p>Build times, using Stack, are often too high - sometimes, taking hours to build a project - for development purposes. How do you disable <strong>all</strong> optimizations on Stack during development, only re-enabling them for production builds?</p>\n"}, {"tags": ["haskell", "build", "dependencies", "haskell-stack"], "comments": [{"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1458269096, "post_id": 34400539, "comment_id": 59796195, "body": "Is this condition permanent?  It should recover from this issue and try again.  What version of stack are you using?"}], "answers": [{"tags": [], "owner": {"reputation": 1518, "user_id": 802500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54cb6e5f1e23129af9e91ea9b31eaace?s=128&d=identicon&r=PG", "display_name": "Justin Blank", "link": "https://stackoverflow.com/users/802500/justin-blank"}, "is_accepted": true, "score": 0, "last_activity_date": 1458319798, "creation_date": 1458319798, "answer_id": 36089953, "question_id": 34400539, "link": "https://stackoverflow.com/questions/34400539/haskell-stack-is-giving-download-expectation-failure/36089953#36089953", "title": "Haskell-stack is giving &quot;Download expectation failure&quot;", "body": "<p>It turns out that this was a bug in stack, where a corrupted download would fail to be properly redownloaded. It's been fixed in the latest builds. </p>\n"}], "owner": {"reputation": 1518, "user_id": 802500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54cb6e5f1e23129af9e91ea9b31eaace?s=128&d=identicon&r=PG", "display_name": "Justin Blank", "link": "https://stackoverflow.com/users/802500/justin-blank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 36089953, "answer_count": 1, "score": 1, "last_activity_date": 1458319798, "creation_date": 1450716381, "last_edit_date": 1450716795, "question_id": 34400539, "link": "https://stackoverflow.com/questions/34400539/haskell-stack-is-giving-download-expectation-failure", "title": "Haskell-stack is giving &quot;Download expectation failure&quot;", "body": "<p>I'm trying to use stack to build a project, and I'm receiving 'Download expectation failure' when running 'stack build'. </p>\n\n<pre><code>C:\\Users\\T60\\Dropbox\\notebooks-stack&gt;stack build\nSetting codepage to UTF-8 (65001) to ensure correct output from GHC\nDownload expectation failure: content hash (SHA512)\nExpected: aa1178f08ad3364c504ee790dac9b0774b7461fa7ea0a8f2c3ad82943d109602debcf4\na8a83090815fef487ceac40019f8b5594ab0043f36e019d69bc5f76853 (ByteString)\nActual:   91f514e1731ef3c2063ff5ab6156242755b2b2b462d4a1f40f150d96cf714f7b7b5b19\nc7705e5129bbb9876216ca86ff52e49cd7604d83e4b4150172c9bda228\nFor: https://s3.amazonaws.com:443/hackage.fpcomplete.com/package/SHA-1.6.4.2.tar\n.gz\nPr\n</code></pre>\n\n<p>The relevant portion of my cabal file is:</p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                       , bytestring\n                       , sqlite-simple\n                       , time\n                       , SHA\n</code></pre>\n\n<p>I've traced the error message to the <code>show</code> instance of <code>VerifiedDownloadException</code> in Verified.hs in the stack source code, but for what this actually means (something dumb in my cabal file, bad package on stackage, internal error in stack...) I have no idea. </p>\n\n<p>I'm running Windows 7 32-bit. </p>\n"}, {"tags": ["haskell", "dependent-type", "data-kinds", "singleton-type"], "answers": [{"comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1450718749, "post_id": 34400975, "comment_id": 56543650, "body": "Huh, I thought I tried this in the past and it broke down. I&#39;ll try following your code example closely, now. Thanks!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450730175, "post_id": 34400975, "comment_id": 56549483, "body": "@dfeuer <code>class (...) =&gt; Uncurry c &#39;(x, y)</code> is simply not a valid class declaration.. and <code>instance (c (Fst x) (Snd x)) =&gt; Uncurry c x</code> is perfectly valid and the code works just the same.. the other version is just less characters to type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450731299, "post_id": 34400975, "comment_id": 56550087, "body": "Oh, right, silly me. So the obvious way, I suppose, is <code>class (c p q, x ~ &#39;(p, q)) =&gt; Uncurry c x</code>. Is that problematic?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450731699, "post_id": 34400975, "comment_id": 56550295, "body": "No because that also isn&#39;t a valid class declaration, all the variables in the left hand side must appear in the right hand side."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450731754, "post_id": 34400975, "comment_id": 56550320, "body": "Buh. I&#39;m failing today. Thanks."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 6, "last_activity_date": 1450717873, "creation_date": 1450717873, "answer_id": 34400975, "question_id": 34400391, "link": "https://stackoverflow.com/questions/34400391/singletons-in-heterogenous-lists/34400975#34400975", "title": "Singletons in Heterogenous Lists", "body": "<p>I think this is a sound approach, it's just that .. sometimes you need to help the type system out a bit.</p>\n\n<p>Firstly, the way you write the <code>All</code> predicate matters a lot (if it reduces at the proper times) and I don't know which <code>All</code> you are using.</p>\n\n<p>Also, you are using <code>symbolVal</code> on the name but there is no proof that it is a <code>KnownSymbol</code> - you must add this proof somewhere. The only obvious place, to me, is on the type class:</p>\n\n<pre><code>class KnownSymbol name =&gt; Analyze name ty where\n  analyze :: Proxy name -&gt; ty -&gt; Int\n</code></pre>\n\n<p>Here is the <code>All</code> predicate:</p>\n\n<pre><code>type family All (c :: k -&gt; Constraint) (xs :: [k]) :: Constraint where \n  All c '[] = () \n  All c (x ': xs) = (c x, All c xs) \n</code></pre>\n\n<p>Note that this line</p>\n\n<pre><code>analyzeRec :: All Analyze rs =&gt; Rec rs -&gt; [(String, Int)]\n</code></pre>\n\n<p>does not type check (it is not well kinded). Each element of <code>rs</code> is a tuple. We could write <code>All' :: (k0 -&gt; k1 -&gt; Constraint) -&gt; [(k0,k1)] -&gt; Constraint</code> directly much in the same way as <code>All'</code>. But it is funner to write a type class <code>Uncurry</code>:</p>\n\n<pre><code>type family Fst (x :: (k0, k1)) :: k0 where \n  Fst '(x,y) = x \n\ntype family Snd (x :: (k0, k1)) :: k1 where \n  Snd '(x,y) = y \n\nclass (c (Fst x) (Snd x)) =&gt; Uncurry (c :: k0 -&gt; k1 -&gt; Constraint) (x :: (k0, k1)) where \ninstance (c x y) =&gt; Uncurry c '(x, y)\n</code></pre>\n\n<p>If this <code>Uncurry</code> looks exceedingly complicated, it is again because it is important for <code>Uncurry c '(x,y)</code> to reduce to <code>c x y</code> at the right time, so it is written in a way that forces (or rather allows) the typechecker to reduce this constraint whenever it sees it. Now the function is</p>\n\n<pre><code>analyzeRec :: All (Uncurry Analyze) rs =&gt; Rec rs -&gt; [(String, Int)]\nanalyzeRec r = \n  case r of\n    Nil -&gt; []\n    (Cons hd tl) -&gt; let s = recName r in (symbolVal s, analyze s hd) : analyzeRec tl\n\n-- Helper\nrecName :: Rec ('(name,ty)':rs) -&gt; Proxy name \nrecName _ = Proxy \n</code></pre>\n\n<p>This doesn't use anything from <code>singletons</code> nor does it need it.</p>\n\n<hr>\n\n<p>Complete working code</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, ConstraintKinds, UndecidableInstances, TypeOperators #-}\n{-# LANGUAGE DataKinds, GADTs, MultiParamTypeClasses, TypeFamilies, FlexibleInstances, FlexibleContexts #-} \n\nimport Data.Proxy \nimport GHC.TypeLits \nimport GHC.Prim (Constraint)\n\ndata Rec rs where\n  Nil :: Rec '[]\n  Cons :: ty -&gt; Rec rs -&gt; Rec ( '(name, ty) ': rs )\n\nclass KnownSymbol name =&gt; Analyze name ty where\n  analyze :: Proxy name -&gt; ty -&gt; Int\n\ntype family All (c :: k -&gt; Constraint) (xs :: [k]) :: Constraint where \n  All c '[] = () \n  All c (x ': xs) = (c x, All c xs) \n\ntype family Fst (x :: (k0, k1)) :: k0 where \n  Fst '(x,y) = x \n\ntype family Snd (x :: (k0, k1)) :: k1 where \n  Snd '(x,y) = y \n\nclass (c (Fst x) (Snd x)) =&gt; Uncurry (c :: k0 -&gt; k1 -&gt; Constraint) (x :: (k0, k1)) where \ninstance (c x y) =&gt; Uncurry c '(x, y)\n\nrecName :: Rec ('(name,ty)':rs) -&gt; Proxy name \nrecName _ = Proxy \n\nanalyzeRec :: All (Uncurry Analyze) rs =&gt; Rec rs -&gt; [(String, Int)]\nanalyzeRec r = \n  case r of\n    Nil -&gt; []\n    (Cons hd tl) -&gt; let s = recName r in (symbolVal s, analyze s hd) : analyzeRec tl\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1450738755, "post_id": 34404741, "comment_id": 56553355, "body": "Awesome! I had just figured out something like <code>AllC</code> and had been stuck on understanding the function symbols. I think I can make this work. I feel like going the full cMap route is too far at the moment, but it&#39;s close to feasible!"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1450740388, "post_id": 34404741, "comment_id": 56553962, "body": "Feel free to ask about <code>TyFun</code>-s. They do involve a lot of syntactic noise, and it&#39;s likely worth an exposition. Also, you could look at <a href=\"https://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/\" rel=\"nofollow noreferrer\">this</a>, if you haven&#39;t read it already."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1450741246, "post_id": 34404741, "comment_id": 56554260, "body": "I skimmed that post a while back but I think now I have the background to better understand it, thanks again for the reference!"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1450741323, "post_id": 34404741, "comment_id": 56554288, "body": "Here are some attempts to wedge this into my code: <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/Query.hs\" rel=\"nofollow noreferrer\">github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/&hellip;</a> <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/MediaType.hs\" rel=\"nofollow noreferrer\">github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/&hellip;</a> and <a href=\"https://github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/Header.hs\" rel=\"nofollow noreferrer\">github.com/tel/serv/blob/feat-singletons/src/Serv/Internal/&hellip;</a>&zwnj;&#8203;. I&#39;ll want to get confident with these techniques before diving into <code>Server.hs</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1450781020, "last_edit_date": 1450781020, "creation_date": 1450733810, "answer_id": 34404741, "question_id": 34400391, "link": "https://stackoverflow.com/questions/34400391/singletons-in-heterogenous-lists/34404741#34404741", "title": "Singletons in Heterogenous Lists", "body": "<p>I'll try to present here an \"idiomatic\" <code>singletons</code> solution (if such a thing even exists). Preliminaries:</p>\n\n<pre><code>{-# LANGUAGE\n  RankNTypes, DataKinds, PolyKinds, ConstraintKinds, GADTs,\n  TypeOperators, MultiParamTypeClasses, TypeFamilies, ScopedTypeVariables #-}\n\nimport Data.Singletons.Prelude\nimport Data.Proxy\nimport GHC.Exts (Constraint) \n\n-- SingI constraint here for simplicity's sake\nclass SingI name =&gt; Analyze (name :: Symbol) ty where\n  analyze :: Proxy name -&gt; ty -&gt; Int\n\ndata Rec rs where\n  Nil :: Rec '[]\n  Cons :: ty -&gt; Rec rs -&gt; Rec ( '(name, ty) ': rs )\n\nrecName :: Rec ('(name, t) ': rs) -&gt; Proxy name\nrecName _ = Proxy\n</code></pre>\n\n<p>We need an <code>All c rs</code> constraint, but we give it a spin and make <code>c</code> a <code>TyFun</code> instead a plain <code>a -&gt; Constraint</code> constructor:</p>\n\n<pre><code>type family AllC (c :: TyFun a Constraint -&gt; *) (rs :: [a]) :: Constraint where\n  AllC c '[]       = ()\n  AllC c (x ': xs) = (c @@ x, AllC c xs)\n</code></pre>\n\n<p><code>TyFun</code> lets us abstract over type constructors <strong>and</strong> type families and gives us partial application. It gives us almost first-class type-level functions with a somewhat ugly syntax. Note though that we necessarily lose constructor injectivity. <code>@@</code> is the operator for applying <code>TyFun</code>-s. <code>TyFun a b -&gt; *</code> means that <code>a</code> is the input and <code>b</code> is the output, and the trailing <code>-&gt; *</code> is just an artifact of the encoding. With GHC 8.0 we'll be able to just do</p>\n\n<pre><code>type a ~&gt; b = TyFun a b -&gt; *\n</code></pre>\n\n<p>And use <code>a ~&gt; b</code> thereafter. </p>\n\n<p>We can implement now a general \"classy\" mapping over <code>Rec</code>:</p>\n\n<pre><code>cMapRec ::\n  forall c rs r.\n  AllC c rs =&gt; Proxy c -&gt; (forall name t. (c @@ '(name, t)) =&gt; Proxy name -&gt; t -&gt; r) -&gt; Rec rs -&gt; [r]\ncMapRec p f Nil           = []\ncMapRec p f r@(Cons x xs) = f (recName r) x : cMapRec p f xs\n</code></pre>\n\n<p>Note that above <code>c</code> has kind <code>TyFun (a, *) Constraint -&gt; *</code>.</p>\n\n<p>And then implement <code>analyzeRec</code>:</p>\n\n<pre><code>analyzeRec :: \n  forall c rs. (c ~ UncurrySym1 (TyCon2 Analyze)) \n  =&gt; AllC c rs =&gt; Rec rs -&gt; [(String, Int)]\nanalyzeRec = cMapRec (Proxy :: Proxy c) (\\p t -&gt; (fromSing $ singByProxy p, analyze p t))\n</code></pre>\n\n<p>First, <code>c ~ UncurrySym1 (TyCon2 Analyze)</code> is just a type-level <code>let</code> binding that lets me use <code>c</code> in <code>Proxy c</code> as a shorthand. (If I really wanted to use all the dirty tricks, I would add <code>{-# LANGUAGE PartialTypeSignatures #-}</code> and write <code>Proxy :: _ c</code>). </p>\n\n<p><code>UncurrySym1 (TyCon2 Analyze)</code> does the same thing that <code>uncurry Analyze</code> would do if Haskell had full support for type level functions. The obvious advantage here is that we can write out the type of <code>analyzeRec</code> on the fly without extra top-level type families or classes, and also use <code>AllC</code> far more generally. </p>\n\n<hr>\n\n<p>As a bonus, let's remove the <code>SingI</code> constraint from <code>Analyze</code>, and try to implement <code>analyzeRec</code>. </p>\n\n<pre><code>class Analyze (name :: Symbol) ty where\n  analyze :: Proxy name -&gt; ty -&gt; Int\n</code></pre>\n\n<p>Now we have to require an additional constraint that expresses that all the <code>name</code>-s in our <code>Rec</code> are <code>SingI</code>. We can use two <code>cMapRec</code>-s, and zip the results:</p>\n\n<pre><code>analyzeRec ::\n  forall analyze names rs.  \n  (analyze ~ UncurrySym1 (TyCon2 Analyze),\n   names   ~ (TyCon1 SingI :.$$$ FstSym0),\n   AllC analyze rs,\n   AllC names rs)\n  =&gt; Rec rs -&gt; [(String, Int)]\nanalyzeRec rc = zip\n  (cMapRec (Proxy :: Proxy names)   (\\p _ -&gt; fromSing $ singByProxy p) rc)\n  (cMapRec (Proxy :: Proxy analyze) (\\p t -&gt; analyze p t) rc)\n</code></pre>\n\n<p>Here <code>TyCon1 SingI :.$$$ FstSym0</code> can be translated as <code>SingI . fst</code>.</p>\n\n<p>This is still roughly within the level of abstraction that can be readily expressed with <code>TyFun</code>-s. The main limitation, of course, is the lack of lambdas. Ideally we wouldn't have to use <code>zip</code>, instead we would use <code>AllC (\\(name, t) -&gt; (SingI name, Analyze name t))</code>, and use a single <code>cMapRec</code>. With <code>singletons</code>, if we can't wing it anymore with point-free type-level programming, we have to introduce a new pointful type family. </p>\n\n<p>Amusingly, GHC 8.0 will be strong enough so that we can implement type-level lambdas from scratch, although it will be probably ugly as hell. For example, <code>\\p -&gt; (SingI (fst p), uncurry Analyze p)</code> could look something like this:</p>\n\n<pre><code>Eval (\n  Lam \"p\" $\n    PairL :@@\n      (LCon1 SingI :@@ (FstL :@@ Var \"p\")) :@@    \n      (UncurryL :@@ LCon2 Analyze :@@ Var \"p\"))\n</code></pre>\n\n<p>where all the <code>L</code> postfixes denote the lambda term embeddings of ordinary <code>TyFun</code>-s (yet another collection of shorthands to be generated by TH...). </p>\n\n<p>I have a <a href=\"https://gist.github.com/AndrasKovacs/c7d385aa117929503feb\" rel=\"nofollow\">prototype</a>, although it only works with the even uglier de Bruijn variables yet, because of a GHC bug. It also features <code>Fix</code> and explicit laziness on the type level. </p>\n"}], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 34404741, "answer_count": 2, "score": 9, "last_activity_date": 1450781020, "creation_date": 1450715894, "question_id": 34400391, "link": "https://stackoverflow.com/questions/34400391/singletons-in-heterogenous-lists", "title": "Singletons in Heterogenous Lists", "body": "<p>I'd like to write a function which analyzes a heterogenous list. For sake of argument, let's have the following</p>\n\n<pre><code>data Rec rs where\n  Nil :: Rec '[]\n  Cons :: ty -&gt; Rec rs -&gt; Rec ( '(name, ty) ': rs )\n\nclass Analyze name ty where\n  analyze :: Proxy name -&gt; ty -&gt; Int\n</code></pre>\n\n<p>The ultimate goal would be to write something like the following</p>\n\n<pre><code>class AnalyzeRec rs where\n  analyzeRec :: Rec rs -&gt; [(String, Int)]\n\ninstance AnalyzeRec '[] where\n  analyzeRec Nil = []\n\ninstance (Analyze name ty, AnalyzeRec rs) =&gt; \n           AnalyzeRec ( '(name, ty) ': rs ) \n  where\n    analyzeRec (Cons hd tl) = \n      let proxy = Proxy :: Proxy name\n      in (symbolVal proxy, analyze proxy hd) : analyzeRec tl\n</code></pre>\n\n<p>The salient bits being that <code>analyzeRec</code> uses knowledge of constraints instantiated at each type and value in the <code>Rec</code>. This class-based mechanism works, but is clunky and verbose in the case where you have to do this over and over (and I do).</p>\n\n<p>So, I'd like to instead replace this with a <a href=\"https://hackage.haskell.org/package/singletons\"><code>singletons</code></a>-based mechanism. I'd like to write instead a function like</p>\n\n<pre><code>-- no type class!\nanalyzeRec :: All Analyze rs =&gt; Rec rs -&gt; [(String, Int)]\nanalyzeRec rec = \n  case rec of\n    Nil -&gt; []\n    Cons hd tl -&gt; withSing $ \\s -&gt; \n      (symbolVal s, analyze s hd) : analyzeRec tl\n</code></pre>\n\n<p>but this clearly falls flat in at least a few dimensions.</p>\n\n<p>What is the \"right\" way to write such a function over heterogenous lists using the Singletons technique? Is there a better way to approach this problem? What should I expect in solving this sort of thing?</p>\n\n<p>(For reference, this is for an experimental Servant clone called Serv. The relevant files are <a href=\"https://github.com/tel/serv/blob/feat-singletons-header-special/src/Serv/Internal/Header/Serialization.hs\"><code>Serv.Internal.Header.Serialization</code></a> and <a href=\"https://github.com/tel/serv/blob/feat-singletons-header-special/src/Serv/Internal/Header.hs\"><code>Serv.Internal.Header</code></a> as background. I'd like to write a function which takes in a heterogenous list of tagged header values and then <code>headerEncode</code> them into a list of actual <code>(ByteString, ByteString)</code> pairs.)</p>\n"}, {"tags": ["haskell", "cabal-sandbox"], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1450725519, "post_id": 34399232, "comment_id": 56547153, "body": "I have already tried it and it didn&#39;t work (forgot to write it the question). If you use a hardcoded string inside the newOAuth it will work."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1450712061, "creation_date": 1450712061, "answer_id": 34399232, "question_id": 34399087, "link": "https://stackoverflow.com/questions/34399087/haskell-bytestring-issue-when-i-use-getargs/34399232#34399232", "title": "Haskell: ByteString issue when I use getArgs", "body": "<p>The fields <code>oauthConsumerKey</code> and <code>oauthConsumerSecret</code> are supposed to contain <code>ByteString</code>s and not <code>String</code>s which is what <code>getArgs</code> returns. You need to use <a href=\"https://hackage.haskell.org/package/bytestring-0.10.4.0/docs/Data-ByteString-Char8.html#v:pack\" rel=\"nofollow\">pack</a> to convert your <code>newOauthConsumer*</code> values.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1450731611, "creation_date": 1450711542, "last_edit_date": 1450731611, "question_id": 34399087, "link": "https://stackoverflow.com/questions/34399087/haskell-bytestring-issue-when-i-use-getargs", "title": "Haskell: ByteString issue when I use getArgs", "body": "<p>I am working inside a sandbox with ghc 7.10.3 and I have this simple code:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  args &lt;- getArgs\n  case args of\n    [ newOauthConsumerKey, newOauthConsumerSecret ] -&gt; do\n      let appOauth = newOAuth { oauthServerName       = \"api.twitter.com\"\n                              , oauthConsumerKey    = newOauthConsumerKey\n                              , oauthConsumerSecret = newOauthConsumerSecret\n                              }\n  ... \n</code></pre>\n\n<p>when I compile it with these dependencies in my cabal file:</p>\n\n<pre><code>base\n, authenticate-oauth\n, http-conduit\n, aeson\n, text\n</code></pre>\n\n<p>I keep on get (after cleaning and rebuilding the sandbox) the following errors:</p>\n\n<pre><code>src/Test/Main.hs:60:55:\n    Couldn't match type \u2018[Char]\u2019\n                   with \u2018bytestring-0.10.6.0:Data.ByteString.Internal.ByteString\u2019\n    Expected type: bytestring-0.10.6.0:Data.ByteString.Internal.ByteString\n      Actual type: String\n    In the \u2018oauthConsumerKey\u2019 field of a record\n    In the expression:\n      newOAuth\n        {oauthServerName = \"api.twitter.com\",\n         oauthConsumerKey = newOauthConsumerKey,\n         oauthConsumerSecret = newOauthConsumerSecret}\n\nsrc/Test/Main.hs:61:55:\n    Couldn't match type \u2018[Char]\u2019\n                   with \u2018bytestring-0.10.6.0:Data.ByteString.Internal.ByteString\u2019\n    Expected type: bytestring-0.10.6.0:Data.ByteString.Internal.ByteString\n      Actual type: String\n    In the \u2018oauthConsumerSecret\u2019 field of a record\n    In the expression:\n      newOAuth\n        {oauthServerName = \"api.twitter.com\",\n         oauthConsumerKey = newOauthConsumerKey,\n         oauthConsumerSecret = newOauthConsumerSecret}\n</code></pre>\n\n<p>I have already googled and checked different similar answers but I cannot make it work. Any idea?</p>\n\n<p><strong>Solution</strong></p>\n\n<p>The problem was due to the fact that in the code there was an import for <code>import Data.Text</code> that includes a <code>pack</code> which is different from the <code>pack</code> required for <code>Data.ByteString.Char8</code>. Once I have included it, it worked.</p>\n"}, {"tags": ["haskell", "types", "type-systems"], "comments": [{"owner": {"reputation": 2138, "user_id": 2794292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e3e4f141c783c6562d345d77f685417?s=128&d=identicon&r=PG&f=1", "display_name": "concept3d", "link": "https://stackoverflow.com/users/2794292/concept3d"}, "edited": false, "score": 0, "creation_date": 1450709809, "post_id": 34398326, "comment_id": 56538113, "body": "What are the inferred types when you remove the types? How do they compare with the provided types ? This is a speculation but I think one of the inferred or provided types were not generic enough and hence rendered incompatible. Also adding the inferred types could help answering the question."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 2138, "user_id": 2794292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e3e4f141c783c6562d345d77f685417?s=128&d=identicon&r=PG&f=1", "display_name": "concept3d", "link": "https://stackoverflow.com/users/2794292/concept3d"}, "edited": false, "score": 2, "creation_date": 1450710084, "post_id": 34398326, "comment_id": 56538275, "body": "I&#39;ve included the inferred types on the question now, although I can not understand them as there are spiders."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1450711213, "post_id": 34398326, "comment_id": 56539057, "body": "monomorphism restriction"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1450711573, "post_id": 34398326, "comment_id": 56539301, "body": "Does removing <code>app</code>&#39;s type annotation really cause an error? Monomorphic things can call polymorphic things, but not vice versa."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1450719981, "post_id": 34401422, "comment_id": 56544268, "body": "Thanks. At this point I think if I should just disable the monomorphism restriction by default."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1450719995, "last_edit_date": 1450719995, "creation_date": 1450719609, "answer_id": 34401422, "question_id": 34398326, "link": "https://stackoverflow.com/questions/34398326/two-functions-compile-with-type-annotations-remove-one-annotation-doesnt-com/34401422#34401422", "title": "Two functions compile with type annotations. Remove one annotation - doesn&#39;t compile. Remove two - compiles again. Why?", "body": "<p>This is due to to the monomorphism restriction. When the compiler is typechecking a top-level binding without a type annotation, it will not assign a polymorphic type if that type has a constraint and the function has no syntactic argument, which is the case for <em>both</em> of your functions. </p>\n\n<p>However, if you include <em>neither</em> type signature, it still doesn't compile. In your case, you gave it some extra information (the <code>foo = [app, _]</code> part) and for some reason it chose to pick a monomorphic type - I don't know what changed about your environment but that isn't standard behaviour. </p>\n\n<p>Here is a simple file distilling the issue you are having:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, KindSignatures, MultiParamTypeClasses, FunctionalDependencies #-}\n\nmodule Test where \n\nimport Prelude hiding (div)\n\nclass MonadWidget t (m :: * -&gt; *) | m -&gt; t \n\ndiv :: forall t m a . MonadWidget t m =&gt; m a -&gt; m a\ndiv = (undefined :: forall t m a . MonadWidget t m =&gt; m a -&gt; m a)\n\napp :: forall t m . MonadWidget t m =&gt; m ()\napp = (div (undefined :: forall t m . MonadWidget t m =&gt; m ())\n        :: forall t m . MonadWidget t m =&gt; m () )\n</code></pre>\n\n<p>If you comment out either type signature, or both, you will be met with an error.\nHowever, comment out any top-level type signature, but run this with <code>ghc -XNoMonomorphismRestriction Test.hs</code> and it will compile successfully in every configuration. <a href=\"https://ideone.com/GBAcVs\" rel=\"nofollow\">Here</a> <a href=\"https://ideone.com/iE8Hn2\" rel=\"nofollow\">are</a> <a href=\"https://ideone.com/jlciqw\" rel=\"nofollow\">a</a> <a href=\"https://ideone.com/PJu2YY\" rel=\"nofollow\">few</a> <a href=\"https://ideone.com/TksLHm\" rel=\"nofollow\">tests</a>. </p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1450720542, "post_id": 34401620, "comment_id": 56544546, "body": "<code>Adding {-# LANGUAGE NoMonomorphismRestriction #-} pragma fixes this and allows to add type signatures incrementally.</code> - Is this always true?"}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1450720776, "post_id": 34401620, "comment_id": 56544674, "body": "Yes, if error is caused by monomorphism restriction. On the downside, disabling MR by default can lead to reduced sharing, but this quite rare situation."}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1450721003, "post_id": 34401620, "comment_id": 56544802, "body": "<a href=\"http://lambda.jstolarek.com/2012/05/towards-understanding-haskells-monomorphism-restriction/\" rel=\"nofollow noreferrer\">Here</a> is explanation of how MR affects sharing."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1450721089, "post_id": 34401620, "comment_id": 56544836, "body": "&quot;but most likely will not stumble upon it in practice&quot; yet I can&#39;t count on my fingers how many hours I&#39;ve lost due to something which ended up being MR&#39;s blame... thanks for the link."}], "tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 1, "last_activity_date": 1450720423, "creation_date": 1450720423, "answer_id": 34401620, "question_id": 34398326, "link": "https://stackoverflow.com/questions/34398326/two-functions-compile-with-type-annotations-remove-one-annotation-doesnt-com/34401620#34401620", "title": "Two functions compile with type annotations. Remove one annotation - doesn&#39;t compile. Remove two - compiles again. Why?", "body": "<p>As Reid Barton noted in comments, this is due to <a href=\"https://wiki.haskell.org/Monomorphism_Restriction\" rel=\"nofollow\">The Dreaded Monomorphism Restriction</a>.</p>\n\n<p>Here is simplified example:</p>\n\n<pre><code>foo :: Monad m =&gt; m a -&gt; m a\nfoo = (&gt;&gt;= return)\n\nbar :: Monad m =&gt; m ()\nbar = foo (return ())\n</code></pre>\n\n<p>When monomorphism restriction enabled and <code>foo</code>'s type signature commented:</p>\n\n<ul>\n<li>GHC tries to assign monomorphic type to to <code>foo</code> and fails because there is no default <code>Monad</code> instance:</li>\n</ul>\n\n<blockquote>\n  <p>No instance for (Monad m0) arising from a use of \u2018>>=\u2019<br>\n     The type variable \u2018m0\u2019 is ambiguous</p>\n</blockquote>\n\n<ul>\n<li>using <code>foo</code> at <code>bar</code> leads to another error which I cannot explain</li>\n</ul>\n\n<blockquote>\n  <p>Couldn't match type \u2018m0\u2019 with \u2018m\u2019<br>\n       because type variable \u2018m\u2019 would escape its scope</p>\n</blockquote>\n\n<p>Adding <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> pragma fixes this and allows to add type signatures incrementally.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 34401422, "answer_count": 2, "score": 7, "last_activity_date": 1450720423, "creation_date": 1450709127, "last_edit_date": 1450710024, "question_id": 34398326, "link": "https://stackoverflow.com/questions/34398326/two-functions-compile-with-type-annotations-remove-one-annotation-doesnt-com", "title": "Two functions compile with type annotations. Remove one annotation - doesn&#39;t compile. Remove two - compiles again. Why?", "body": "<p>Mind this Reflex program:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, RecursiveDo #-}\n\nimport Control.Applicative\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Prelude hiding (div)\nimport Reflex.Dom\nimport qualified Data.Map as M\n\nclickMe :: MonadWidget t m =&gt; m (Event t ())\nclickMe = do\n    rec (e,_) &lt;- elAttr' \"button\" M.empty (display c)\n        c :: Dynamic t Int &lt;- count (domEvent Click e)\n    return $ domEvent Click e\n\ndiv :: forall t m a . MonadWidget t m =&gt; m a -&gt; m a\ndiv = elAttr \"div\" (\"style\" =: \"border : 1px solid black\")\n\napp :: forall t m . MonadWidget t m =&gt; m ()\napp = div $ do\n    aClicks &lt;- clickMe\n    bClicks &lt;- clickMe\n    a &lt;- count aClicks\n    b &lt;- count bClicks\n    l &lt;- combineDyn (\\a b -&gt; replicate (a-b) ()) a b\n    simpleList l (const clickMe)\n    return ()\n\nmain = mainWidget app\n</code></pre>\n\n<p>If you remove the type annotation from either <code>div</code> or <code>app</code>, the program won't compile with a huge, scary type error. <strong>If you remove both, it will compile again.</strong> From a programmer's perspective, this gives a terrible user experience when someone is trying to incrementally annotate an unannotated program. It makes no sense that adding a correct type annotation to an unannotated term causes a compiler error, and it leads the programmer to think he got the type wrong.</p>\n\n<p><a href=\"http://lpaste.net/147579\" rel=\"nofollow\">This is the error you get by removing <code>div</code>'s annotation.</a></p>\n\n<p><a href=\"http://lpaste.net/147580\" rel=\"nofollow\">Those are the inferred types.</a></p>\n\n<p>Why this happens?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 5, "creation_date": 1450710001, "post_id": 34398239, "comment_id": 56538223, "body": "Note &quot;also&quot;: if join couldn&#39;t be defined in terms of bind, it would <i>have</i> to be a member of <code>Monad</code> (or wouldn&#39;t be defined for all monads), and it isn&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 6, "last_activity_date": 1450709093, "creation_date": 1450709093, "answer_id": 34398310, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/34398310#34398310", "title": "With monads, can join be defined in terms of bind?", "body": "<p>Yes it's fairly simple:</p>\n\n<pre><code>join m = m &gt;&gt;= id\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 13, "last_activity_date": 1450709162, "creation_date": 1450709162, "answer_id": 34398340, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/34398340#34398340", "title": "With monads, can join be defined in terms of bind?", "body": "<p>It is possible:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\njoin m = (m &gt;&gt;= id)\n</code></pre>\n\n<p>Note the tricky instantiation of <code>&gt;&gt;=</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: m b -&gt; (b -&gt; m c) -&gt; m c\n-- choosing b ~ m a , c ~ a\n(&gt;&gt;=) :: m (m a) -&gt; (m a -&gt; m a) -&gt; m a\n</code></pre>\n\n<p>so we can correctly choose <code>id</code> for the second argument.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 4, "last_activity_date": 1450736904, "creation_date": 1450736904, "answer_id": 34405412, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/34405412#34405412", "title": "With monads, can join be defined in terms of bind?", "body": "<p>Bind (<code>&gt;&gt;=</code>) does in fact \"remove a layer\":</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Intuitively it \"gets some <code>a</code>s out of the <code>m a</code>\", and feeds then to the <code>a -&gt; m b</code> function, and then produces a single <code>m b</code> from the results.</p>\n\n<p>People usually say that it requires the function argument to wrap up its output again in <code>m</code>, but that's not actually the case. It requires the function's output to <em>be</em> something wrapped up in <code>m</code>, but it doesn't matter where the wrapping came from.</p>\n\n<p>In the case of implementing <code>join</code> we're starting from something \"double-wrapped\": <code>m (m a)</code>. We can plug that into the signature for bind and immediately figure out the type of function we could use when binding a \"double-wrapped\" value:</p>\n\n<pre><code>m (m a) -&gt; (m a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Now the function used with bind here is going to receive a value that's <em>already</em> wrapped in <code>m</code>. So we don't have to \"re-wrap\" anything; if we return it unmodified it'll already be the right type for the output. Effectively that's \"removed one layer of wrapping\" - and this works for any layer but the last one.</p>\n\n<p>So that tells us we just have to bind with <code>id</code>:</p>\n\n<pre><code>join = (&gt;&gt;= id)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 9599504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6421852b763357b4918007aa2849c269?s=128&d=identicon&r=PG&f=1", "display_name": "N. Prindle", "link": "https://stackoverflow.com/users/9599504/n-prindle"}, "is_accepted": false, "score": 6, "last_activity_date": 1578920049, "last_edit_date": 1578920049, "creation_date": 1522884460, "answer_id": 49661916, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/49661916#49661916", "title": "With monads, can join be defined in terms of bind?", "body": "<p>Although the question has already been sufficiently answered, I thought it was worth noting the following for any Haskell newcomers.</p>\n\n<p>One of the first things you see when learning about monads in Haskell is the definition for lists:  </p>\n\n<pre><code>instance Monad [] where\n    return x  =  [x]\n    xs &gt;&gt;= f  =  concatMap f xs\n</code></pre>\n\n<p>Here, we see that the functionality of <em>bind</em> for lists is equivalent to <code>concatMap</code>, just with the arguments flipped around. This makes sense when inspecting the types:</p>\n\n<pre><code>concatMap ::            (a -&gt;  [b]) -&gt;  [a] -&gt;  [b]\nbind      :: Monad m =&gt; (a -&gt; m b ) -&gt; m a  -&gt; m b        -- (&gt;&gt;=) flips the arguments\n</code></pre>\n\n<p>It also makes intuitive sense that the definition of <code>join</code> for lists is equivalent to<br>\n<code>concat :: [[a]] -&gt; [a]</code>.</p>\n\n<p>The names of the functions may make it a little obvious, but <code>concat</code> can be recovered from <code>concatMap</code> by keeping the internal lists as they are, in order to cancel out the \"map\" part of <code>concatMap</code>:</p>\n\n<pre><code>concatMap       id xs      \n  = concat (map id xs)\n  = concat (    id xs)\n  = concat         xs      -- or simply 'concat = concatMap id'\n</code></pre>\n\n<p>The same property holds true for monads in general:</p>\n\n<pre><code>join x  =  x &gt;&gt;= id        -- or 'join = bind id'\n</code></pre>\n\n<p>This really comes from the fact that</p>\n\n<pre><code>bind f m  =  join (fmap f m)\n</code></pre>\n\n<p>so that</p>\n\n<pre><code>bind id m  =  join (fmap id m)           -- bind id  =  join . fmap id\n           =  join (     id m)           --          =  join .      id\n           =  join          m            --          =  join\n</code></pre>\n\n<p>because all monads are Functors first, and by Functor laws <code>fmap id === id</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1616474134, "post_id": 66755559, "comment_id": 118006814, "body": "How is that a simplification? Point-free is not always simpler or better."}, {"owner": {"reputation": 61, "user_id": 6342481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/439684f108f4b556e5ae922869354749?s=128&d=identicon&r=PG&f=1", "display_name": "subttle", "link": "https://stackoverflow.com/users/6342481/subttle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1616570301, "post_id": 66755559, "comment_id": 118040416, "body": "I definitely agree that point-free is most certainly not <i>necessarily</i> &quot;simpler&quot; nor &quot;better&quot;, but in this case I would argue that the \u03b7-reduction makes the final answer simpler. For example, from the link in my answer, one could argue:   <code>sum = foldr (+) 0</code>  is &quot;simpler&quot; and &quot;better&quot; than, <code>sum&#39; xs = foldr (+) 0 xs</code>   Because <code>sum</code> emphasizes the essence of what is occurring in the function&#39;s definition by omitting the superfluous. I realize &quot;simpler&quot; could be interpreted subjectively, so I can see why you&#39;d ask but I feel justified in my answer."}, {"owner": {"reputation": 61, "user_id": 6342481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/439684f108f4b556e5ae922869354749?s=128&d=identicon&r=PG&f=1", "display_name": "subttle", "link": "https://stackoverflow.com/users/6342481/subttle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1616571488, "post_id": 66755559, "comment_id": 118040882, "body": "Additionally (I ran out of character space), a lot of people learn to use monads in Haskell by starting with the <code>concatMap</code> example for lists (as was even done in one of the answers here), and it so happens that <code>concatMap</code> has it&#39;s arguments in the same order as <code>(=&lt;&lt;)</code>, so one may use that intuition that <code>concatMap id</code> is &quot;better&quot; than a version which does the same thing but changes the definition by adding a <code>flip</code> and names things unnecessarily. On a side note, I just want to say &quot;hello&quot; @dfeuer, I&#39;m so grateful for all the work you do in Haskell, thank you for your question :)"}], "tags": [], "owner": {"reputation": 61, "user_id": 6342481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/439684f108f4b556e5ae922869354749?s=128&d=identicon&r=PG&f=1", "display_name": "subttle", "link": "https://stackoverflow.com/users/6342481/subttle"}, "is_accepted": false, "score": 0, "last_activity_date": 1616458781, "creation_date": 1616458781, "answer_id": 66755559, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/66755559#66755559", "title": "With monads, can join be defined in terms of bind?", "body": "<blockquote>\n<p>Can join be defined in terms of bind?</p>\n</blockquote>\n<p>TL;DR answer: Yes.</p>\n<pre><code>join \u2237 (Monad m) \u21d2 m (m a) \u2192 m a\njoin = (=&lt;&lt;) id\n</code></pre>\n<p>The longer answer:\nTo add some subtleties that have yet to be mentioned I'll provide a new answer, starting by expanding upon <a href=\"https://stackoverflow.com/users/152602/lee\">Lee</a>'s <a href=\"https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind/34398310#34398310\">answer</a>, because it is worth noting that their answer can be simplified. Starting with the original:</p>\n<pre><code>join \u2237 (Monad m) \u21d2 m (m a) \u2192 m a\njoin m = m &gt;&gt;= id\n</code></pre>\n<p>One can look for an <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\">Eta conversion</a> (\u03b7-conversion) opportunity to make the function definition <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">point-free</a>. To do this we want to first rewrite our function definition without the infix <code>&gt;&gt;=</code> (as would likely be done if we were calling <code>&gt;&gt;=</code> by the name <code>bind</code> in the first place).</p>\n<pre><code>join m = (&gt;&gt;=) m id\n</code></pre>\n<p>Now observe that if we use the <code>flip</code> function, recalling:</p>\n<pre><code>-- defined in Data.Function\n-- for a function of two arguments, swap their order\nflip \u2237 (a \u2192 b \u2192 c) \u2192 b \u2192 a \u2192 c\nflip f b a = f a b\n</code></pre>\n<p>One may now use <code>flip</code> to put the <code>m</code> in position for an \u03b7-reduction:</p>\n<pre><code>join m = (flip (&gt;&gt;=)) id m\n</code></pre>\n<p>Applying the \u03b7-reduction:</p>\n<pre><code>join = (flip (&gt;&gt;=)) id\n</code></pre>\n<p>Noticing now that <code>flip (&gt;&gt;=)</code> can be replaced with <code>(=&lt;&lt;)</code> (defined in <code>Control.Monad</code>):</p>\n<pre><code>join = (=&lt;&lt;) id\n</code></pre>\n<p>Finally we can see shorter, point-free definition:</p>\n<pre><code>join \u2237 (Monad m) \u21d2 m (m a) \u2192 m a\njoin = (=&lt;&lt;) id\n</code></pre>\n<p>Where <code>(=&lt;&lt;)</code> has type:</p>\n<pre><code>(=&lt;&lt;) \u2237 \u2200 (m \u2237 * -&gt; *) a b. (Monad m) \u21d2 (a \u2192 m b) \u2192 m a \u2192 m b\n</code></pre>\n<p>which in the process gets instantiated to:</p>\n<pre><code>(=&lt;&lt;) \u2237 (m a \u2192 m a) \u2192 m (m a) \u2192 m a\n</code></pre>\n<p>Additionally, one may also notice that if we put the code above back into infix form, the <code>flip</code> becomes implicit, and we get the same final <a href=\"https://stackoverflow.com/a/34405412/6342481\">answer</a> as <a href=\"https://stackoverflow.com/users/450128/ben\">Ben</a> does:</p>\n<pre><code>join = (&gt;&gt;= id)\n</code></pre>\n"}], "owner": {"reputation": 2073, "user_id": 3496273, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0a40ff2f35bae1a27e3603c20102f4d?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/3496273/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1224, "favorite_count": 1, "accepted_answer_id": 34398340, "answer_count": 5, "score": 11, "last_activity_date": 1616458781, "creation_date": 1450708875, "last_edit_date": 1495540326, "question_id": 34398239, "link": "https://stackoverflow.com/questions/34398239/with-monads-can-join-be-defined-in-terms-of-bind", "title": "With monads, can join be defined in terms of bind?", "body": "<p>In Haskell, monads are defined in terms of the functions return and bind, where return has type <code>a -&gt; m a</code> and bind has type <code>m a -&gt; (a -&gt; m b) -&gt; m b</code>. It's been pointed out before that <a href=\"https://stackoverflow.com/questions/11234632/monads-with-join-instead-of-bind\">monads can also be defined in terms of return and join</a>, where join is a function with type <code>m (m a) -&gt; m a</code>. Bind can be defined in terms of join, but is the reverse possible? Can join be defined in terms of bind?</p>\n\n<p>Without join, I have no idea what I'd do if I ever somehow got ahold of a \"twice wrapped\" monadic value, <code>m (m a)</code> - none of the functor or monad operations \"remove any layers\", so to speak. If this isn't possible, why do Haskell and many other monad implementations define them in terms of bind? It seems strictly less useful than a join-based definition.</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"comments": [{"owner": {"reputation": 397, "user_id": 2555560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/100000044259680/picture?type=large", "display_name": "Tilman Zuckmantel", "link": "https://stackoverflow.com/users/2555560/tilman-zuckmantel"}, "edited": false, "score": 0, "creation_date": 1451394511, "post_id": 34398468, "comment_id": 56764173, "body": "Thank you very much we have found a solution now!"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 1, "last_activity_date": 1450709586, "creation_date": 1450709586, "answer_id": 34398468, "question_id": 34397954, "link": "https://stackoverflow.com/questions/34397954/having-trouble-with-matching-type-in-haskell-generatetrees/34398468#34398468", "title": "Having trouble with matching type in Haskell (generateTrees)", "body": "<p>You may want to split this operation into two smaller ones:</p>\n\n<p>A generic <code>unfold</code> function first which, given a seed of type <code>s</code> and a function computing one layer of tree generates a whole tree by repeatedly calling itself on the next generation of seeds. This definition would have type:</p>\n\n<pre><code>unfold :: (s -&gt; (v, [(e,s)])) -&gt; s -&gt; Tree v e\nunfold next seed = _fillThisIn\n</code></pre>\n\n<p>You can then use this function to define your <code>generateGameTree</code>. The intuition behind using <code>unfold</code> is that the <code>seed</code> of type <code>s</code> represents the state of the game and the function <code>next</code> computes the possible new states after one move (together with the <code>v</code> and <code>e</code> \"outputs\").</p>\n"}, {"tags": [], "owner": {"reputation": 397, "user_id": 2555560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/100000044259680/picture?type=large", "display_name": "Tilman Zuckmantel", "link": "https://stackoverflow.com/users/2555560/tilman-zuckmantel"}, "is_accepted": false, "score": 0, "last_activity_date": 1451394553, "creation_date": 1451394553, "answer_id": 34511783, "question_id": 34397954, "link": "https://stackoverflow.com/questions/34397954/having-trouble-with-matching-type-in-haskell-generatetrees/34511783#34511783", "title": "Having trouble with matching type in Haskell (generateTrees)", "body": "<p>To whom it may interest:</p>\n\n<p>This works now without compiler error:</p>\n\n<p>generateGameTree g p = Node (g,p) [ ((fst x),generateGameTree (snd x) (nextPlayer p))  | x &lt;- (findPossibleMoves p g) ]</p>\n"}], "owner": {"reputation": 397, "user_id": 2555560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/100000044259680/picture?type=large", "display_name": "Tilman Zuckmantel", "link": "https://stackoverflow.com/users/2555560/tilman-zuckmantel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 34398468, "answer_count": 2, "score": 1, "last_activity_date": 1451394553, "creation_date": 1450708002, "question_id": 34397954, "link": "https://stackoverflow.com/questions/34397954/having-trouble-with-matching-type-in-haskell-generatetrees", "title": "Having trouble with matching type in Haskell (generateTrees)", "body": "<p>i am sitting with two guys on a haskell project and we have quite a bit of trouble with the following code:</p>\n\n<p>I try to give you all the necessary information:</p>\n\n<p>From the module Types.hs:</p>\n\n<pre><code>class Game g s | g -&gt; s where\n  findPossibleMoves :: Player -&gt; g -&gt; [(s,g)]\n  identifyWinner :: g -&gt; Player -&gt; Maybe Player \n\ndata Player = Player1 | Player2 deriving (Eq,Ord)\n</code></pre>\n\n<p>and here is the code we want to implement:</p>\n\n<pre><code>generateGameTree :: Game g s =&gt; g -&gt; Player -&gt; Tree (g,Player) s\ngenerateGameTree g p = ([ Node ((snd x),p) [] | x &lt;- (findPossibleMoves p g )])\n</code></pre>\n\n<p>So we try to get this thing compiled but it wont work . It might be important to know how a tree looks like so thats the definition:</p>\n\n<pre><code>data Tree v e  = Node v [(e,Tree v e)] deriving (Show,Eq,Ord)\n</code></pre>\n\n<p>We allready know, that the returntype of the function and our returntype doesn't match, but there must be another mistake in this.</p>\n\n<p>We would appreciate any help , thanks in advance</p>\n"}, {"tags": ["haskell", "functor", "category-theory"], "comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1450701210, "post_id": 34395766, "comment_id": 56532740, "body": "Just to clarify: Do you want an application of a functor over a product or a product of functors?"}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1450702392, "post_id": 34395766, "comment_id": 56533508, "body": "Product of functors."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1450706401, "post_id": 34397435, "comment_id": 56535914, "body": "This representation is what we ended up using (instead of the free applicative construction) to implement <a href=\"http://gergo.erdi.hu/blog/2012-12-01-static_analysis_with_applicatives/\" rel=\"nofollow noreferrer\">these ideas</a>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 9, "last_activity_date": 1537493092, "last_edit_date": 1537493092, "creation_date": 1450706353, "answer_id": 34397435, "question_id": 34395766, "link": "https://stackoverflow.com/questions/34395766/the-useful-application-of-functors-product-and-coproduct/34397435#34397435", "title": "The useful application of Functor&#39;s Product and Coproduct", "body": "<p>A <code>Product</code> of a <code>Const</code> and a <code>Reader</code> can be used to easily implement  two-stage evaluation. For example, suppose you need to use some monadic effect between the two phases, but you want to make sure that your client code cannot do that (because you want to finely control how and when it happens):</p>\n\n<pre><code>type TwoPhase c r = Product (Const c) (Reader r)\n\nrun :: (Monad m, Monoid c) =&gt; (c -&gt; m r) -&gt; TwoPhase c r a -&gt; m a\nrun prepare (Pair (Const deps, phase2)) = do\n  r &lt;- prepare deps\n  return $ runReader phase2 r\n</code></pre>\n\n<p>Note that this of course only permits an <code>Applicative</code> interface for your API, not a monadic one; but that's what you usually want anyway in a situation like this.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1450711250, "post_id": 34398831, "comment_id": 56539085, "body": "The same applies to <a href=\"http://okmij.org/ftp/Haskell/extensible/more.pdf\" rel=\"nofollow noreferrer\">Extensible effects</a>."}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": false, "score": 3, "last_activity_date": 1450710706, "creation_date": 1450710706, "answer_id": 34398831, "question_id": 34395766, "link": "https://stackoverflow.com/questions/34395766/the-useful-application-of-functors-product-and-coproduct/34398831#34398831", "title": "The useful application of Functor&#39;s Product and Coproduct", "body": "<p>A possible application of coproduct functor is used in <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=3D15F38DB60AA7B1623A86B780E3D982?doi=10.1.1.101.4131&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow\">Data types a la carte</a>. The idea is to use coproducts to combine <em>one level up</em> data type constructors.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 5, "accepted_answer_id": 34397435, "answer_count": 2, "score": 7, "last_activity_date": 1537493092, "creation_date": 1450701086, "last_edit_date": 1450706893, "question_id": 34395766, "link": "https://stackoverflow.com/questions/34395766/the-useful-application-of-functors-product-and-coproduct", "title": "The useful application of Functor&#39;s Product and Coproduct", "body": "<p>Could you show a simple code example which would display the useful application of <code>Data.Functor</code>'s <code>Product</code> and <code>Coproduct</code>?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450696922, "post_id": 34393713, "comment_id": 56530173, "body": "As stated, it is unsolvable for the reason you mention: typeclasses are open. You could instead try to use functional dependencies or type families, if those make your own goal possible."}, {"owner": {"reputation": 123, "user_id": 4385153, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EMFaalZS9Rg/AAAAAAAAAAI/AAAAAAAAAFE/ENKQkp5KoQE/photo.jpg?sz=128", "display_name": "phi16", "link": "https://stackoverflow.com/users/4385153/phi16"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450699132, "post_id": 34393713, "comment_id": 56531514, "body": "that&#39;s right, and I tried some different style of this code, but any try didn&#39;t success...I&#39;m wondering this can be solved using closed type families, but I don&#39;t know how to do."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1457404592, "post_id": 34393713, "comment_id": 59381157, "body": "Closed type families are not enough, you need injective type families as well, which are coming Real Soon Now (tm)."}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 4385153, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EMFaalZS9Rg/AAAAAAAAAAI/AAAAAAAAAFE/ENKQkp5KoQE/photo.jpg?sz=128", "display_name": "phi16", "link": "https://stackoverflow.com/users/4385153/phi16"}, "edited": false, "score": 0, "creation_date": 1451269601, "post_id": 34431547, "comment_id": 56715895, "body": "Sorry, in my case, there&#39;s like a <code>instance App Double b</code>... I reconsidered this problem and concluded my problem cannot be solved, so I decided to write type explicitly. Thanks."}], "tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 2, "last_activity_date": 1450859619, "creation_date": 1450859619, "answer_id": 34431547, "question_id": 34393713, "link": "https://stackoverflow.com/questions/34393713/type-class-difficult-inference/34431547#34431547", "title": "type-class difficult inference", "body": "<p>It is not very clear what problem you are trying to solve with this code, but as @chi stated, you can try FunDeps</p>\n\n<pre><code>  {-# LANGUAGE FunctionalDependencies, FlexibleInstances #-}\n\n  class Lit a\n  instance Lit Int\n  instance Lit Float\n\n  class App a b | b -&gt; a\n  instance App Float b\n\n  f :: (Lit a, App a b) =&gt; a -&gt; Maybe b\n  f x = Nothing\n</code></pre>\n\n<p>or TypeFamilies</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Lit a\ninstance Lit Int\ninstance Lit Float\n\nclass App res where\n  type Arg res\n\ninstance App res where\n  type Arg res = Float\n\nf :: App b =&gt; Arg b -&gt; Maybe b\nf x = Nothing\n</code></pre>\n\n<p>Using FunDeps in this example is more concise, but in my experience TypeFamilies + GADTs solutions are more straightforward and manageable for type-level programming.</p>\n"}], "owner": {"reputation": 123, "user_id": 4385153, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EMFaalZS9Rg/AAAAAAAAAAI/AAAAAAAAAFE/ENKQkp5KoQE/photo.jpg?sz=128", "display_name": "phi16", "link": "https://stackoverflow.com/users/4385153/phi16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1450859619, "creation_date": 1450694309, "last_edit_date": 1450695986, "question_id": 34393713, "link": "https://stackoverflow.com/questions/34393713/type-class-difficult-inference", "title": "type-class difficult inference", "body": "<p>I want to make following type inferable :</p>\n\n<pre><code>class Lit a\ninstance Lit Int\ninstance Lit Float\n\nclass App a b\ninstance App Float b\n\nf :: (Lit a, App a b) =&gt; a -&gt; b -- a should be Float\n</code></pre>\n\n<p>I know this sample cannot be inferred <code>a</code> to <code>Float</code> because type class be not closed, at least.</p>\n\n<p>What should I do to achieve the purpose?</p>\n\n<p>Additionally, the thing I want to do is constructing Typed EDSL using TH and Haskell Type Checker. for example if the variable (Int or Float) \"p\" are multiplied by Float, I want to infer \"p\" to Float. So the solution to this is also welcomed.</p>\n"}, {"tags": ["haskell", "try-catch", "maybe"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450668158, "post_id": 34387424, "comment_id": 56518202, "body": "This assignment is a silly assignment. Really. Intentionally throwing exceptions in pure code is a bad idea in almost all cases."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1450692110, "post_id": 34387424, "comment_id": 56527220, "body": "Maybe it is not intentional? Maybe it just models something that is given and has its own good reasons to throw exception?"}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1450664572, "post_id": 34387583, "comment_id": 56517505, "body": "But then the resulting computation is impure (<code>IO</code> monad)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 3, "creation_date": 1450667312, "post_id": 34387583, "comment_id": 56518032, "body": "@immibis Catching an exception must be in in IO anyways... so you don&#39;t really lose anything."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 6, "last_activity_date": 1450658896, "creation_date": 1450658896, "answer_id": 34387583, "question_id": 34387424, "link": "https://stackoverflow.com/questions/34387424/haskell-return-nothing-in-case-of-exception/34387583#34387583", "title": "Haskell: Return Nothing in case of exception", "body": "<p>You can use <code>evaluate</code> for catching exceptions while executing pure computations:</p>\n\n<pre><code>mySafeHead :: [a] -&gt; IO (Maybe a)\nmySafeHead xs = mySafeHead' xs `catch` handler\n    where  \n        mySafeHead' :: [a] -&gt; IO (Maybe a)\n        mySafeHead' ls = do\n            x &lt;- evaluate $ myHead ls\n            return $ Just x\n        handler :: EmptyListException -&gt; IO (Maybe a)\n        handler ex = return Nothing\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/b30c74b39dc59be2\"><kbd>Live demo</kbd></a></p>\n"}, {"comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1450717153, "post_id": 34387641, "comment_id": 56542790, "body": "Weird, <a href=\"http://coliru.stacked-crooked.com/a/bb745837390c831b\" rel=\"nofollow noreferrer\">I cannot reproduce</a> your initial output."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1450717947, "post_id": 34387641, "comment_id": 56543212, "body": "Angry Shoe: never used that site before, so not sure why it&#39;s working different than on my machine (maybe it doesn&#39;t flush STDOUT when it exits with an error?), but <a href=\"http://coliru.stacked-crooked.com/a/33d41f9ac659b08e\" rel=\"nofollow noreferrer\">you can see the <code>Just</code> constructor</a> with a little pattern matching."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 7, "last_activity_date": 1450659580, "creation_date": 1450659580, "answer_id": 34387641, "question_id": 34387424, "link": "https://stackoverflow.com/questions/34387424/haskell-return-nothing-in-case-of-exception/34387641#34387641", "title": "Haskell: Return Nothing in case of exception", "body": "<p>So when I run your code, this is what I see</p>\n\n<pre><code>\u03bb mySafeHead []\nJust *** Exception: EmptyListException\n</code></pre>\n\n<p>I understand why you'd describe this as \"it returns the Exception wrapped in \"Just\".\", but that's not actually what's going on.</p>\n\n<p>Haskell is non-strict, so it postpones computation until a value is demanded.</p>\n\n<p>In <code>mySafeHead</code> the value of <code>myHead xs</code> is not examined, so it isn't evaluated. Instead, the computation for that value is left as a <em>thunk</em>, which is wrapped in <code>Just</code> and returned.</p>\n\n<p>Then, in <code>ghci</code>, that thunk is finally forced when trying to print the value, and an exception is raised. Since we're now well outside the scope of the <code>catch</code> statement, it doesn't apply, and the exception makes it all the way to the terminal, where it interrupts the printing of the output.</p>\n\n<p>The easy way to fix this is to use <code>seq</code> to force evaluation of <code>myHead xs</code> before exiting the <code>catch</code> statement:</p>\n\n<pre><code>mySafeHead' :: [a] -&gt; IO (Maybe a)                             \nmySafeHead' xs = (let x = myHead xs in x `seq` return (Just x))\n                `catch`                                        \n                (\\(_::EmptyListException) -&gt; return Nothing)   \n</code></pre>\n\n<p><code>seq</code> takes two arguments - it returns the second, but only after forcing the first to Weak Head Normal Form (WHNF), that is, after finding out what the outermost constructor is. This forces <code>x</code> sufficiently for the <code>EmptyListException</code> to be raised, so <code>catch</code> can do its thing:</p>\n\n<pre><code>\u03bb mySafeHead' []\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": false, "score": 0, "last_activity_date": 1450848570, "last_edit_date": 1450848570, "creation_date": 1450780182, "answer_id": 34413675, "question_id": 34387424, "link": "https://stackoverflow.com/questions/34387424/haskell-return-nothing-in-case-of-exception/34413675#34413675", "title": "Haskell: Return Nothing in case of exception", "body": "<p>If all you want is to get the head of a list as <code>Just a</code> when the\nlist is non-empty, otherwise <code>Nothing</code>, the sensible approach is\nnot to use exceptions at all (whether explicitly thrown by you, or\nthrown as a result of calling <code>head :: [a] -&gt; a</code> on an empty list).  Instead, define a <em>total function</em>:</p>\n\n<pre><code>mySafeHead :: [a] -&gt; Maybe a\nmySafeHead [] = Nothing\nmySafeHead (a:_) = Just a\n</code></pre>\n\n<p>Alternatively, use <a href=\"http://hackage.haskell.org/package/safe-0.3.9/docs/Safe.html#v:headMay\" rel=\"nofollow\"><code>headMay</code></a> from the <em>safe</em> package.</p>\n\n<p>The existence of non-total functions in the <code>Prelude</code> such as <code>head</code> and <code>tail</code> is an historical mistake.  Hopefully one day they will be deprecated and, eventually, removed.</p>\n"}], "owner": {"reputation": 672, "user_id": 1232934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5e0537c771370c3359541be86c19bb9?s=128&d=identicon&r=PG", "display_name": "nvrandow", "link": "https://stackoverflow.com/users/1232934/nvrandow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 1, "accepted_answer_id": 34387641, "answer_count": 3, "score": 1, "last_activity_date": 1450848570, "creation_date": 1450657110, "last_edit_date": 1450666794, "question_id": 34387424, "link": "https://stackoverflow.com/questions/34387424/haskell-return-nothing-in-case-of-exception", "title": "Haskell: Return Nothing in case of exception", "body": "<pre><code>{-# LANGUAGE DeriveDataTypeable, ScopedTypeVariables #-}\n\nimport Data.Typeable\nimport Control.Exception\n\ndata EmptyListException = EmptyListException\n    deriving (Show, Typeable)\ninstance Exception EmptyListException\n\nmyHead :: [a] -&gt; a\nmyHead []    = throw EmptyListException\nmyHead (x:_) = x\n\nmySafeHead :: [a] -&gt; IO (Maybe a)\nmySafeHead xs = (return (Just (myHead xs)))\n                `catch`\n                (\\(ex::EmptyListException) -&gt; return Nothing)\n</code></pre>\n\n<p>I want to return the first element of xs if there is one.\nOtherwise I want to return \"Nothing\", but it returns the Exception wrapped in \"Just\".\nWhy is that?\nP.S.: I have to use <code>myHead</code> in <code>mySaveHead</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1450664223, "post_id": 34386639, "comment_id": 56517447, "body": "Comments that have those <code>#</code> in between like that are pragmas. They have an effect. And there are more than <code>LANGUAGE</code> (e.g. <code>SPECIALIZE</code>, <code>INLINE</code>, <code>MINIMAL</code>, and so on). Look <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\">here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1450658800, "post_id": 34386675, "comment_id": 56516383, "body": "It might be worth noting that <code>LANGUAGE</code> pragmas are intended to be semi-portable. This is not currently very relevant, but it was when Hugs, NHC, etc., were alive."}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": true, "score": 6, "last_activity_date": 1450653311, "last_edit_date": 1450653311, "creation_date": 1450651259, "answer_id": 34386675, "question_id": 34386639, "link": "https://stackoverflow.com/questions/34386639/what-is-the-purpose-of-the-language-keyword-in-haskell/34386675#34386675", "title": "What is the purpose of the LANGUAGE keyword in Haskell?", "body": "<p>The purpose is to enable language extensions. It's a compiler pragma. The GHC compiler supports a lot of language extensions. The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/\">GHC manual</a> provides explanation of each extension and examples.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5640007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 34386675, "answer_count": 1, "score": 3, "last_activity_date": 1450653311, "creation_date": 1450651033, "question_id": 34386639, "link": "https://stackoverflow.com/questions/34386639/what-is-the-purpose-of-the-language-keyword-in-haskell", "title": "What is the purpose of the LANGUAGE keyword in Haskell?", "body": "<p>I saw a Haskell source code, and at the beginning of the source file, it included several things like:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE DeriveFoldable #-}\n</code></pre>\n\n<p>I know that comments in Haskell stat with <code>{-</code> and end with <code>-}</code>, but this is clearly something else. What's the purpose of this? It seems pretty similar like <code>include</code> statements or macros in C.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 0, "last_activity_date": 1450647706, "creation_date": 1450647706, "answer_id": 34386179, "question_id": 34386146, "link": "https://stackoverflow.com/questions/34386146/copyfile-from-two-lists-in-haskell/34386179#34386179", "title": "copyFile from two lists in Haskell", "body": "<p><code>copyFile</code> is a monadic action so you cannot use <code>zipWith</code> on it, here is what you can do:</p>\n\n<pre><code>mapM_ (uncurry copyFile) $ zip list1 list2\n</code></pre>\n\n<p>note <code>mapM_</code>'s type signature:</p>\n\n<pre><code>\u03bb&gt; :t mapM_\nmapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1450677366, "post_id": 34387066, "comment_id": 56520631, "body": "<code>Control.Monad</code> also offers <code>zipWithM</code> and <code>zipWithM_</code>."}], "tags": [], "owner": {"reputation": 445, "user_id": 2102854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeSJn.png?s=128&g=1", "display_name": "jpvillaisaza", "link": "https://stackoverflow.com/users/2102854/jpvillaisaza"}, "is_accepted": false, "score": 6, "last_activity_date": 1450708981, "last_edit_date": 1450708981, "creation_date": 1450653987, "answer_id": 34387066, "question_id": 34386146, "link": "https://stackoverflow.com/questions/34386146/copyfile-from-two-lists-in-haskell/34387066#34387066", "title": "copyFile from two lists in Haskell", "body": "<p>Since</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c] \n</code></pre>\n\n<p>and</p>\n\n<pre><code>System.Directory.copyFile :: FilePath -&gt; FilePath -&gt; IO ()\n</code></pre>\n\n<p>if you <code>zip</code> with <code>copyFile</code>, you get:</p>\n\n<pre><code>zipWith copyFile :: [FilePath] -&gt; [FilePath] -&gt; [IO ()]\n</code></pre>\n\n<p>that is, given two lists of file paths, you get a list of actions in which each action copies a file. You can evaluate such list of actions using <code>sequence_</code>:</p>\n\n<pre><code>sequence_ :: (Foldable t, Monad m) =&gt; t (m a) -&gt; m ()\n</code></pre>\n\n<p>(in this case, <code>sequence_ :: [IO ()] -&gt; IO ()</code>).</p>\n\n<p>Thus, something like</p>\n\n<pre><code>sequence_ (zipWith copyFile [\"foo\", \"bar\"] [\"new_foo\", \"new_bar\"])\n</code></pre>\n\n<p>would work for you.</p>\n\n<p>EDIT: Even better, as suggested by Daniel Wagner, use <code>Control.Monad.zipWithM_</code> (<code>zipWithM_ copyFile [...] [...]</code>).</p>\n"}], "owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1450708981, "creation_date": 1450647450, "question_id": 34386146, "link": "https://stackoverflow.com/questions/34386146/copyfile-from-two-lists-in-haskell", "title": "copyFile from two lists in Haskell", "body": "<p>I'm new to Haskell.</p>\n\n<p>My objective is to copy files from one directory to other directory.</p>\n\n<p>So far what I have:</p>\n\n<p>I have two lists contain full path file names</p>\n\n<pre><code>list1 = [\"file1\", \"file2\" ...]\nlist2 = [\"new name1\", \"new name2\"...]\n</code></pre>\n\n<p>I want to use </p>\n\n<pre><code>copyFile::FilePath-&gt;FilePath-&gt;IO()\n</code></pre>\n\n<p>to copy files from list1 to list2</p>\n\n<p>Note: list2 contains all new full path file names</p>\n\n<p>I know </p>\n\n<pre><code>zipWith(a-&gt;b-&gt;c)-&gt;[a]-&gt;[b]-&gt;[c]\n</code></pre>\n\n<p>and I try to </p>\n\n<pre><code>zipWith(copyFile) list1 list2\n</code></pre>\n\n<p>but it doesn't work.</p>\n\n<p>Any suggestion would be appreciated</p>\n"}, {"tags": ["haskell", "monads", "free-monad", "monadplus"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450674035, "post_id": 34384954, "comment_id": 56519679, "body": "It seems to me that the implementation depends not on the type of the function but on its semantics. &quot;But I don&#39;t understand if this was derived using some process&quot; I think the &#39;process&#39; here is simply modelling your domain properly. For example, I think that the encoding of <code>finally</code> would be more obvious if you first try to encode the &quot;most general&quot; exception functions (<code>throw</code>, <code>catch</code>?). The type of <code>finally</code> is the same as <code>&lt;*</code>.. so you theoretically there is no reason a function of this type can&#39;t be encoded (maybe just not directly..)."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451137015, "post_id": 34384954, "comment_id": 56684888, "body": "@user2407038 I understand what you mean. But I&#39;m interested in the approach &quot;mechanically encode the whole interface and let the interpreter worry about the implementation details&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1450694043, "creation_date": 1450694043, "answer_id": 34393636, "question_id": 34384954, "link": "https://stackoverflow.com/questions/34384954/how-to-encode-actions-that-take-monadic-arguments-with-free-or-freer-monads/34393636#34393636", "title": "How to encode actions that take monadic arguments with free (or freer) monads?", "body": "<p>I'll answer only about the <code>Freer</code> monad part. Recall the definition:</p>\n\n<pre><code>data Freer f b where\n    Pure :: b -&gt; Freer f b\n    Roll :: f a -&gt; (a -&gt; Freer f b) -&gt; Freer f b\n</code></pre>\n\n<p>Now with</p>\n\n<pre><code>data NonDetEff a where\n  MZero :: NonDetEff a\n  MPlus :: NonDetEff Bool\n</code></pre>\n\n<p>we can define</p>\n\n<pre><code>type NonDetComp = Freer NonDetEff\n</code></pre>\n\n<p>When <code>Roll</code> is applied to <code>MPlus</code>, <code>a</code> is unified with <code>Bool</code> and the type of the second argument is <code>Bool -&gt; NonDetEff b</code> which is basically a tuple:</p>\n\n<pre><code>tuplify :: (Bool -&gt; a) -&gt; (a, a)\ntuplify f = (f True, f False)\n\nuntuplify :: (a, a) -&gt; (Bool -&gt; a)\nuntuplify (x, y) True  = x\nuntuplify (x, y) False = y\n</code></pre>\n\n<p>As an example:</p>\n\n<pre><code>ex :: NonDetComp Int\nex = Roll MPlus $ Pure . untuplify (1, 2)\n</code></pre>\n\n<p>So we can define a <code>MonadPlus</code> instance for non-deterministic computations</p>\n\n<pre><code>instance MonadPlus NonDetComp where\n    mzero       = Roll MZero Pure\n    a `mplus` b = Roll MPlus $ untuplify (a, b)\n</code></pre>\n\n<p>and run them</p>\n\n<pre><code>run :: NonDetComp a -&gt; [a]\nrun (Pure x)       = [x]\nrun (Roll MZero f) = []\nrun (Roll MPlus f) = let (a, b) = tuplify f in run a ++ run b\n</code></pre>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 3, "answer_count": 1, "score": 9, "last_activity_date": 1613887205, "creation_date": 1450639830, "last_edit_date": 1613887205, "question_id": 34384954, "link": "https://stackoverflow.com/questions/34384954/how-to-encode-actions-that-take-monadic-arguments-with-free-or-freer-monads", "title": "How to encode actions that take monadic arguments with free (or freer) monads?", "body": "<p>Most monadic functions take pure arguments and return a monadic value. But there are a few that need also monadic arguments, for example:</p>\n\n<pre><code>mplus :: (MonadPlus m) =&gt; m a -&gt; m a -&gt; m a\n\nfinally :: IO a -&gt; IO b -&gt; IO a\n\nforkIO :: m () -&gt; m ThreadId\n\n-- | From Control.Monad.Parallel\nforkExec :: m a -&gt; m (m a)\n</code></pre>\n\n<p>Each of them seems to bring up a different problem and I can't get a grasp of a generic way how to <strong>encode such actions using free monads.</strong></p>\n\n<ul>\n<li><p>In both <code>finally</code> and <code>forkIO</code> the problem is that the monadic argument is of a different type than the result. But for <em>free</em> one would need them to be of the same type, as <code>IO a</code> gets replaced by the type variable of the encoding type, like <code>data MyFunctor x = Finally x x x</code>, which would only encode <code>IO a -&gt; IO a -&gt; IO a</code>.</p>\n\n<p>In <a href=\"http://www.haskellforall.com/2013/06/from-zero-to-cooperative-threads-in-33.html\" rel=\"nofollow noreferrer\">From zero to cooperative threads in 33 lines of Haskell code</a> the author uses <code>Fork  next next</code> to fist implement</p>\n\n<pre><code>cFork :: (Monad m) =&gt; Thread m Bool\ncFork = liftF (Fork False True)\n</code></pre>\n\n<p>and then uses it to implement</p>\n\n<pre><code>fork :: (Monad m) =&gt; Thread m a -&gt; Thread m ()\n</code></pre>\n\n<p>where the input and output have different types.\nBut I don't understand if this was derived using some process or just an ad-hoc idea that works for this particular purpose.</p></li>\n<li><p><code>mplus</code> is in particular confusing: a naive encoding as</p>\n\n<pre><code>data F b = MZero | MPlus b b\n</code></pre>\n\n<p>distributes over <code>&gt;&gt;=</code> and a <a href=\"https://stackoverflow.com/a/20376794/1333025\">suggested better implementation</a> is more complicated. And also a native implementation of a free <code>MonadPlus</code> <a href=\"https://stackoverflow.com/q/32185389/1333025\">was removed from <em>free</em></a>.</p>\n\n<p>In <a href=\"https://hackage.haskell.org/package/freer-0.2.2.2/docs/Control-Monad-Freer.html#t:NonDetEff\" rel=\"nofollow noreferrer\">freer</a> it's implemented by adding</p>\n\n<pre><code>data NonDetEff a where\n  MZero :: NonDetEff a\n  MPlus :: NonDetEff Bool\n</code></pre>\n\n<p>Why is <code>MPlus</code> <code>NonDetEff Bool</code> instead of <code>NonDetEff a a</code>? And is there a way how to make it work with <code>Free</code>, where we need the data type to be a functor, other than using the <a href=\"https://stackoverflow.com/a/17184834/1333025\">CoYoneda functor</a>?</p></li>\n<li>For <code>forkExec</code> I have no idea how to proceed at all.</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1450632503, "post_id": 34383691, "comment_id": 56508869, "body": "String is indeed not a class. What are you trying to express with <code>(String b) =&gt; [String] -&gt; b</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450632586, "post_id": 34383691, "comment_id": 56508897, "body": "Bear in mind that in <code>a:&#39;+&#39;:b:t</code> both a and b are single characters, so you will have some difficulties in calculating 10+12."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450633176, "post_id": 34383691, "comment_id": 56509090, "body": "@n.m. ... that will not be an issues as it&#39;s not <code>&#39;+&#39;</code> but <code>&quot;+&quot;</code>  ;)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1450633409, "post_id": 34383691, "comment_id": 56509163, "body": "@Carsten Indeed. Didn&#39;t see it clearly on the phone."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 5, "last_activity_date": 1450633083, "last_edit_date": 1450633083, "creation_date": 1450632736, "answer_id": 34383791, "question_id": 34383691, "link": "https://stackoverflow.com/questions/34383691/type-of-function-in-haskell/34383791#34383791", "title": "type of function in Haskell", "body": "<p>The compiler error is because of the <code>(String b) =&gt; ...</code> part in the first line which would indicate that <code>String</code> is a constraint on <code>b</code> - I don't think you wanted to express this here.</p>\n\n<p>If I get you right you want a list of <code>String</code> and evaluate that to <code>Float</code> right?</p>\n\n<p>In this case this should work as you expect it:</p>\n\n<pre><code>cc :: [String] -&gt; Float\ncc (a:\"*\":b:t) = cc (c:t)\n  where c = show (read a * read b)\ncc (a:\"/\":b:t) = cc (c1:t)\n  where c1 = show (read a / read b)\ncc (a:\"-\":t) = read a - cc t\ncc (a:\"+\":t) = read a + cc t\ncc (a:[])    = read a\ncc []        = 0\n</code></pre>\n\n<p>As you can see I removed quite some of your <code>read</code>/<code>show</code> pairs as they are not needed anymore and simplified the signature quite a bit (there are already comments to that)</p>\n\n<p>Here is an example:</p>\n\n<pre><code>\u03bb&gt; cc [\"5\",\"+\",\"6\",\"*\",\"7\"]\n47.0\n</code></pre>\n\n<p>which seems to work ;)</p>\n\n<hr>\n\n<p>PS: also note that you miss some cases like <code>cc [\"10\",\"10\"]</code> in your patterns - maybe you should add an catch-all like:</p>\n\n<pre><code>cc _         = error \"uh - what?\"\n</code></pre>\n\n<p>to the end to get something like:</p>\n\n<pre><code>\u03bb&gt; cc [\"10\",\"12\"]\n*** Exception: uh - what?\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5700935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cf9abcd60cd3f6420fdf916cc7ff3fb?s=128&d=identicon&r=PG&f=1", "display_name": "vln1981", "link": "https://stackoverflow.com/users/5700935/vln1981"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "closed_date": 1450638660, "answer_count": 1, "score": 0, "last_activity_date": 1450633083, "creation_date": 1450632085, "question_id": 34383691, "link": "https://stackoverflow.com/questions/34383691/type-of-function-in-haskell", "closed_reason": "Duplicate", "title": "type of function in Haskell", "body": "<p>Problem with types in Haskell.\nI try to move from Prolog to Haskel.\nI have to calculate arithmetic expression from string representation. I have wrote recursive algorithm on Haskel, which match to Prolog program. Cause Haskel require that all elements in list must be of one type, it is impossible to mix operations signs with numbers, as in Prolog, so I use [String] type to represent arithmetic expression. For executing calculations, have to transform symbolic representation of numbers to Integer type, but result type inferred as float. Result of every operation must be inversely transformed to string, because it is type of string elements.\nHaskell compiler (HUGS 98) hold off my program.\nWhat is my error?</p>\n\n<pre><code>cc           :: (String b) =&gt; [String] -&gt; b\ncc (a:\"*\":b:t) = cc(c:t)\nwhere c=show(read a * read b)\ncc (a:\"/\":b:t) = cc(c1:t)\nwhere c1=show(read a / read b)\ncc (a:\"-\":t) = show(read a - read(cc t))\ncc (a:\"+\":t) = show(read a + read (cc t))\ncc (a:[])    = a\ncc []    = 0\n</code></pre>\n\n<p>ERROR file:.\\e3.hs:18 - Undefined class \"String\"</p>\n"}, {"tags": ["haskell", "stdout"], "comments": [{"owner": {"reputation": 1049, "user_id": 1587418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f71f8acb7a3af01ec2bd418cd2f899?s=128&d=identicon&r=PG", "display_name": "NonNumeric", "link": "https://stackoverflow.com/users/1587418/nonnumeric"}, "edited": false, "score": 2, "creation_date": 1450632246, "post_id": 34383529, "comment_id": 56508798, "body": "You can <a href=\"https://en.wikipedia.org/wiki/Strace\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Strace</a> your program and see for yourself."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1049, "user_id": 1587418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f71f8acb7a3af01ec2bd418cd2f899?s=128&d=identicon&r=PG", "display_name": "NonNumeric", "link": "https://stackoverflow.com/users/1587418/nonnumeric"}, "edited": false, "score": 0, "creation_date": 1450639176, "post_id": 34383529, "comment_id": 56510957, "body": "@NonNumeric Note <code>strace</code> can help detecting OS threads, but not Haskell (green) threads. In general, many Haskell threads run in a single OS thread."}, {"owner": {"reputation": 1049, "user_id": 1587418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f71f8acb7a3af01ec2bd418cd2f899?s=128&d=identicon&r=PG", "display_name": "NonNumeric", "link": "https://stackoverflow.com/users/1587418/nonnumeric"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450640409, "post_id": 34383529, "comment_id": 56511365, "body": "@chi Yes, <code>strace</code> sees system calls only and won&#39;t catch runtime internal workings, be it its forkIO threads or something else, but it will answer the OP&#39;s question of whether a sub-process is started or not."}], "owner": {"reputation": 3481, "user_id": 579026, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5c7809d1535594cbd33bbcf3fed23c7c?s=128&d=identicon&r=PG", "display_name": "ren", "link": "https://stackoverflow.com/users/579026/ren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1450631207, "creation_date": 1450631207, "question_id": 34383529, "link": "https://stackoverflow.com/questions/34383529/haskell-std-output-stream-problems", "title": "haskell std output stream problems", "body": "<p>Consider this haskell code </p>\n\n<pre><code>import GHC\nimport GhcMonad\n\nmain = runGhc (Just \"/usr/lib/ghc\") $ do\n\n  flags &lt;- getSessionDynFlags\n  setSessionDynFlags flags\n  imps &lt;- mapM parseImportDecl [\"import Prelude\"]\n  setContext (map IIDecl imps)\n\n  runStmt \"putStrLn \\\"1\\\"\" RunToCompletion\n  liftIO $ putStrLn \"2\"\n</code></pre>\n\n<p>Which is compiled with <code>ghc -o a.out source_file.hs -package ghc</code></p>\n\n<p>If run from terminal it outputs </p>\n\n<pre><code>1\n2\n</code></pre>\n\n<p>However if started as subprocess which stdout and stderr are redirected to main process - only <code>2</code> is captured from stdout. The question is what does <code>runStmt \"putStrLn \\\"1\\\"\" RunToCompletion</code> do? Does it start new thread/process? Which stream does it write to then?</p>\n"}, {"tags": ["opencv", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450621328, "post_id": 34380719, "comment_id": 56505223, "body": "Did you find and try the potential solution to this precise problem on the <a href=\"https://github.com/aleator/CV/wiki/BuildProblems\" rel=\"nofollow noreferrer\">github page</a> of the <code>cv</code> package? There is also <a href=\"https://github.com/aleator/CV/issues/52\" rel=\"nofollow noreferrer\">this</a> issue which appears to indicate this issue has been fixed in recent versions, which don&#39;t appear to be on hackage. But even the newest versions seem outdated."}, {"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450622789, "post_id": 34380719, "comment_id": 56505671, "body": "Yeah i&#39;ve tried this. But it didn&#39;t worked. same error."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450623061, "post_id": 34380719, "comment_id": 56505753, "body": "In this case I think this is just a bug with the library. Your choices are to revert to an old version of OpenCV and hope that fixes it, contact the library maintainer and hope they fix it, or try to fix these errors manually, maybe removing some bogus lines in this file will help."}, {"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450623323, "post_id": 34380719, "comment_id": 56505839, "body": "But I&#39;m not skilled nought to fix it by my own. Could you help please?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450624325, "post_id": 34380719, "comment_id": 56506134, "body": "I cannot because I don&#39;t even have a machine on which I can install OpenCV to then try to hack on the <code>cv</code> package."}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "edited": false, "score": 0, "creation_date": 1474634229, "post_id": 34380719, "comment_id": 66623490, "body": "You can try this one: <a href=\"https://github.com/LumiGuide/haskell-opencv\" rel=\"nofollow noreferrer\">Haskell binding to OpenCV-3.1</a> it works nicely. The problem is it is OpenCV3.1. You can check an example here: <a href=\"http://stackoverflow.com/questions/39505855/calling-a-c-opencv-function-from-haskell/39515797#39515797\" title=\"calling a c opencv function from haskell\">stackoverflow.com/questions/39505855/&hellip;</a>"}], "owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1450612489, "creation_date": 1450612489, "question_id": 34380719, "link": "https://stackoverflow.com/questions/34380719/build-opencv-binding-in-haskell-for-opencv-2-4", "title": "Build OpenCV binding in Haskell for OpenCV 2.4", "body": "<p>I tried to install <code>cv</code> library via cabal (<code>cabal install cv</code>).\nBut it brings me up an error:</p>\n\n<pre><code>Configuring CV-0.3.7...\nBuilding CV-0.3.7...\nPreprocessing library CV-0.3.7...\nc2hs: C header contains errors:\n\ndist/build/CV/Video.chs.h:22: (column 39) [ERROR]  &gt;&gt;&gt; Unknown identifier!\n  Cannot find a definition for `CV_CAP_PROP_WHITE_BALANCE_BLUE_U' in the header file.\n\ncabal: Error: some packages failed to install:\nCV-0.3.7 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I have read that it's problem is, that my install <code>opencv</code> is newer than the haskell-library needs it.</p>\n\n<p>My <code>opencv</code>:</p>\n\n<pre><code>local/opencv 2.4.12.2-2\n    Open Source Computer Vision Library\n</code></pre>\n\n<p>So how can I fix this error now? Thanks for your help!</p>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1450613029, "post_id": 34380697, "comment_id": 56502935, "body": "Hello Stackoverflow.com is a community site where people, put in time and effort to help each other. Please show some effort on your side and tell us what you have tried and or what problem you specifically cannot solve."}, {"owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450619551, "post_id": 34380697, "comment_id": 56504646, "body": "I&#39;m so sorry that I haven&#39;t answered any question now. I&#39;m just a freshman of stackoverflow and I will help ohters in the future."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1450620453, "post_id": 34380697, "comment_id": 56504964, "body": "it&#39;s no problem that you did not answer any question yet - the problem is that you did not show anything besides a quick question right here - so maybe you should add what you did try or what exactly you are missing to help you out"}, {"owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "edited": false, "score": 0, "creation_date": 1450627611, "post_id": 34380697, "comment_id": 56507189, "body": "I have found a function in Data.Matrix called elementwise to apply on the element of the two matrix element by element. So I just want to know whether there is such function in Data.Array.CArray. And I have search the document but don&#39;t get any valid information."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 6, "last_activity_date": 1450645420, "last_edit_date": 1450645420, "creation_date": 1450629017, "answer_id": 34383145, "question_id": 34380697, "link": "https://stackoverflow.com/questions/34380697/how-to-apply-element-wise-multiplication-to-two-carrays-in-haskell/34383145#34383145", "title": "How to apply element-wise multiplication to two CArrays in haskell?", "body": "<p>While I am not familiar with <code>CArray</code> at all, just looking at the function types in <a href=\"https://hackage.haskell.org/package/carray-0.1.6.1/docs/Data-Array-CArray.html\" rel=\"nofollow\">https://hackage.haskell.org/package/carray-0.1.6.1/docs/Data-Array-CArray.html</a> is enough to see the answer: <code>liftArray2 (*) arr1 arr2</code> (assuming <code>arr1</code> and <code>arr2</code> have the same index and value type).</p>\n"}], "owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1450645420, "creation_date": 1450612363, "last_edit_date": 1450612897, "question_id": 34380697, "link": "https://stackoverflow.com/questions/34380697/how-to-apply-element-wise-multiplication-to-two-carrays-in-haskell", "title": "How to apply element-wise multiplication to two CArrays in haskell?", "body": "<p>Like I got a <code>CArray</code> <code>[1,2,3]</code> and a <code>CArray</code> <code>[6,7,8]</code>, I want to multiply element by element and get <code>[6, 14, 24]</code>. Could you give me a demo. Thank you.</p>\n"}, {"tags": ["haskell", "truthtable"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450609664, "post_id": 34378469, "comment_id": 56502114, "body": "I really like how the range of answers showcases the wide range how verbose/terse the same piece of code can be written in Haskell. You can also see the evolution from verbose to terse."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1450607806, "post_id": 34378649, "comment_id": 56501651, "body": "<code>x == True</code> is equivalent to <code>x</code> and <code>x == False</code> is equivalen to <code>not x</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1450626752, "post_id": 34378649, "comment_id": 56506907, "body": "@gallais Ah yes, that would be much nicer!"}, {"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450645527, "post_id": 34378649, "comment_id": 56512932, "body": "can you specify this without even the Haskell built in operators, without &amp;&amp; || ?please"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 1, "creation_date": 1450647626, "post_id": 34378649, "comment_id": 56513562, "body": "@abdulazizalmass: <code>&amp;&amp;</code> and <code>||</code> (like all infix operators in Haskell) are not built-ins, but mere functions defined in the standard library. <b>Edit</b> actually it seems they <i>are</i> built-in in GHC. But they <i>could</i> just as well be library functions."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1450648617, "post_id": 34378649, "comment_id": 56513835, "body": "@leftaroundabout I would still not say that they are built-ins since they are defined in a library package named <code>base</code> which is shipped with GHC."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1450653096, "post_id": 34378649, "comment_id": 56515031, "body": "@Sibi: I thought so, too. But, though of course <code>base</code> does <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:-38--38-\" rel=\"nofollow noreferrer\">export</a> the boolean functions, their definition seems to come straight from <code>GHC.Prim</code>."}, {"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450709529, "post_id": 34378649, "comment_id": 56537920, "body": "I am testing this now"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1450594197, "creation_date": 1450594197, "answer_id": 34378649, "question_id": 34378469, "link": "https://stackoverflow.com/questions/34378469/how-to-define-exclusive-disjunction-with-guards-using-haskell/34378649#34378649", "title": "How to define exclusive disjunction with Guards Using Haskell", "body": "<p>You are making syntax errors. If you really want to use guards, you can do something like this:</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction x y \n    | x == True &amp;&amp; y == True = False\n    | x == True &amp;&amp; y == False = True \n    | x == False &amp;&amp; y == True = True\n    | x == False &amp;&amp; y == False = False\n</code></pre>\n\n<p>But this can be more simply achieved by <code>case</code> expressions:</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction x y = case (x,y) of\n                             (True, True) -&gt; False\n                             (True, False) -&gt; True\n                             (False, True) -&gt; True\n                             (False, False) -&gt; False\n</code></pre>\n\n<p>Or even more simply using the inbuilt <code>disjunction</code> operator:</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction x y = case (x,y) of\n                             (True, True) -&gt; False\n                             otherwise -&gt; x || y\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450708901, "post_id": 34379147, "comment_id": 56537463, "body": "yours is answering it but I need the guards to answer the question"}, {"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450708917, "post_id": 34379147, "comment_id": 56537478, "body": "&#39;exclusiveDisjunction2 :: Bool -&gt; Bool -&gt; Bool exclusiveDisjunction2 x y     |True True = False     |True False = True      |False True = True      |False False = False&#39;"}], "tags": [], "owner": {"reputation": 1235, "user_id": 3086454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7fe13e8bdaaf213c71c5413ea1f17819?s=128&d=identicon&r=PG&f=1", "display_name": "d12frosted", "link": "https://stackoverflow.com/users/3086454/d12frosted"}, "is_accepted": false, "score": 6, "last_activity_date": 1450599673, "creation_date": 1450599673, "answer_id": 34379147, "question_id": 34378469, "link": "https://stackoverflow.com/questions/34378469/how-to-define-exclusive-disjunction-with-guards-using-haskell/34379147#34379147", "title": "How to define exclusive disjunction with Guards Using Haskell", "body": "<p>As @sibi mentioned, you are making syntax errors. But what you are doing is achieved by pattern matching.</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction True True = False\nexclusiveDisjunction True False = True \nexclusiveDisjunction False True = True \nexclusiveDisjunction False False = False\n</code></pre>\n\n<p>This can be simplified into</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction True True = False\nexclusiveDisjunction True False = True \nexclusiveDisjunction _ a = a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450622064, "post_id": 34379568, "comment_id": 56505446, "body": "Clearer? Really? What about <code>exclusiveDisjunction = foldr1 (.) . flip drop [not,not] . fromEnum</code>?"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450624126, "post_id": 34379568, "comment_id": 56506075, "body": "@user2407038 This is pretty much a matter of opinion, that&#39;s why I said &quot;from my point of view&quot;. You are free to disagree."}, {"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450708652, "post_id": 34379568, "comment_id": 56537291, "body": "is not a logical operator?"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450709663, "post_id": 34379568, "comment_id": 56538007, "body": "@abdulazizalmass It is a function from Data.Bool <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:not\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.1.0/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": false, "score": 6, "last_activity_date": 1450603522, "creation_date": 1450603522, "answer_id": 34379568, "question_id": 34378469, "link": "https://stackoverflow.com/questions/34378469/how-to-define-exclusive-disjunction-with-guards-using-haskell/34379568#34379568", "title": "How to define exclusive disjunction with Guards Using Haskell", "body": "<p>There already are good answers, but I wish to show how to implement this in a clearer way, from my point of view.</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction True = not\nexclusiveDisjunction False = id\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450645433, "post_id": 34380090, "comment_id": 56512902, "body": "Thank you for your help and time"}, {"owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "edited": false, "score": 0, "creation_date": 1450708411, "post_id": 34380090, "comment_id": 56537160, "body": "it does the thing but /= is a built in haskell logical operator."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1450607837, "creation_date": 1450607837, "answer_id": 34380090, "question_id": 34378469, "link": "https://stackoverflow.com/questions/34378469/how-to-define-exclusive-disjunction-with-guards-using-haskell/34380090#34380090", "title": "How to define exclusive disjunction with Guards Using Haskell", "body": "<p>The shortest.</p>\n\n<pre><code>exclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction = (/=)\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 4875249, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-uJ5YLlAytds/AAAAAAAAAAI/AAAAAAAAAxE/i2fbX99fbRw/photo.jpg?sz=128", "display_name": "abdulazizalmass", "link": "https://stackoverflow.com/users/4875249/abdulazizalmass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "accepted_answer_id": 34378649, "answer_count": 4, "score": -2, "last_activity_date": 1450709163, "creation_date": 1450592058, "last_edit_date": 1450709163, "question_id": 34378469, "link": "https://stackoverflow.com/questions/34378469/how-to-define-exclusive-disjunction-with-guards-using-haskell", "title": "How to define exclusive disjunction with Guards Using Haskell", "body": "<blockquote>\n  <p>this code is to define the exclusive disjunction truth table in haskell</p>\n</blockquote>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Truth_table#Logical_disjunction_.28OR.29\" rel=\"nofollow\">Click here for more info on exclusive disjunction, XOR</a>\nCode:</p>\n\n<pre><code>-- truth table concept of logical XOR\nexclusiveDisjunction :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction = x y\n    |True True &lt;- False\n    |True False &lt;- True \n    |False True &lt;- True \n    |False False &lt;- False\n    |otherwise = x y\n</code></pre>\n\n<p>Results: </p>\n\n<pre><code> Ex6^.hs:31:5:\n        parse error on input \u2018|\u2019\n    Failed, modules loaded: none.\n</code></pre>\n\n<p>how to set guards with two boolean values given the xor truth table in haskell syntax ? </p>\n\n<p>Thank you \nPlease specify your answer without using haskell built in operators, meaning do not use &amp;&amp; ||.</p>\n\n<p>why can't this just be done? </p>\n\n<pre><code>exclusiveDisjunction2 :: Bool -&gt; Bool -&gt; Bool\nexclusiveDisjunction2 x y\n    |True True = False\n    |True False = True \n    |False True = True \n    |False False = False\n</code></pre>\n\n<p>this is the result after running </p>\n\n<pre><code>   Couldn't match expected type \u2018Bool -&gt; Bool\u2019 with actual type \u2018Bool\u2019\n    The function \u2018False\u2019 is applied to one argument,\n    but its type \u2018Bool\u2019 has none\n    In the expression: False False\n    In a stmt of a pattern guard for\n                   an equation for \u2018exclusiveDisjunction2\u2019:\n      False False\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "tree"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450590027, "post_id": 34378220, "comment_id": 56498142, "body": "<code>(addNum x) + (addNum xs)</code>. Can&#39;t work. <code>x</code> and <code>xs</code> are of different types here."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450590361, "post_id": 34378220, "comment_id": 56498189, "body": "This doesn&#39;t work either though: <code>addNums (Node n (x:xs)) = n + (addNums x) + foldl1 (\\ acc t -&gt; acc + addNums t) xs</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450590457, "post_id": 34378220, "comment_id": 56498206, "body": "<code>addNums (Node n xs) = foldl (\\a -&gt; (+) a . addNums) n xs</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1450591033, "post_id": 34378220, "comment_id": 56498289, "body": "Also note that your tree has redundant representation. <code>Node 1 []</code> and <code>Node 1 [Empty]</code> and <code>Node 1 [Empty,Empty,Empty]</code> all represent the same tree. Perhaps you want to change that, or at least handle the <code>[]</code> case."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1450591629, "post_id": 34378220, "comment_id": 56498375, "body": "Oh wow, you&#39;re right.  I don&#39;t even need <code>Empty</code> as a constructor at all."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450602319, "post_id": 34378220, "comment_id": 56500386, "body": "@MarkKaravan Note that if you remove <code>Empty</code>, every tree has to include at least one element <code>n</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1450591280, "post_id": 34378363, "comment_id": 56498323, "body": "It took me a minute to understand why you needed that <code>[]</code> pattern (since any <code>[Tree a]</code> has to contain at least an <code>Empty</code>, but now I see you are evaluating it against your own <code>Node 0</code>.  This seems awkward; is there a best practice for this kind of tree?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 2, "creation_date": 1450591848, "post_id": 34378363, "comment_id": 56498410, "body": "@MarkKaravan Even then you have to check for <code>[]</code> case or else your pattern match will be non exhaustive. You can abstract the entire thing using <code>foldl</code> as user2407038 has demonstrated."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1450590399, "creation_date": 1450590399, "answer_id": 34378363, "question_id": 34378220, "link": "https://stackoverflow.com/questions/34378220/summing-an-integer-tree-haskell/34378363#34378363", "title": "Summing an Integer Tree (Haskell)", "body": "<p>The problem is in the last two lines of your <code>addNums</code> definition. You have to check for the empty base case, not when the list contains a single element with <code>Empty</code> inside it. Something like this should work:</p>\n\n<pre><code>addNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n []) = n\naddNums (Node n (x:xs)) = n + (addNums x) + addNums (Node 0 xs)\n</code></pre>\n\n<p>Note that for an empty list you are just returning <code>n</code>. And when the list has more than one elements, you recursively sum it untill it reaches the bae case (i.e the list becomes empty).</p>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; addNums myNums\n36\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1450602161, "creation_date": 1450602161, "answer_id": 34379415, "question_id": 34378220, "link": "https://stackoverflow.com/questions/34378220/summing-an-integer-tree-haskell/34379415#34379415", "title": "Summing an Integer Tree (Haskell)", "body": "<p>A possible solution:</p>\n\n<pre><code>addNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n xs) = n + sum (map addNums xs)\n</code></pre>\n\n<p>In the recursive case, we have a list of trees <code>xs</code>. We can use <code>addNums</code> on each of those trees, obtaining a list of numbers. Then, we simply sum them up, and add the root <code>n</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 1, "creation_date": 1450733526, "post_id": 34379494, "comment_id": 56551138, "body": "@Mark Karavan, <a href=\"http://osa1.net/posts/2015-11-13-data-repr-1.html\" rel=\"nofollow noreferrer\">yes</a>, as well as in the other answers, it leaks. You can use <code>fasterSum = foldl&#39; (+) 0</code> (<code>foldl&#39;</code> comes with <code>Foldable</code> as well), but I wouldn&#39;t be suprised if it leaks too. You can open another question about efficient summing of numbers in a tree."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 5, "last_activity_date": 1450602820, "creation_date": 1450602820, "answer_id": 34379494, "question_id": 34378220, "link": "https://stackoverflow.com/questions/34378220/summing-an-integer-tree-haskell/34379494#34379494", "title": "Summing an Integer Tree (Haskell)", "body": "<p>Just derive <code>Foldable</code> and use the existing <code>sum</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\ndata Tree a = Empty | Node a [Tree a] deriving (Eq, Show, Foldable)\n\nmyNums :: (Num a) =&gt; Tree a\nmyNums = ...\n\nmain = print $ sum myNums\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1538, "favorite_count": 0, "accepted_answer_id": 34378363, "answer_count": 3, "score": 4, "last_activity_date": 1450602820, "creation_date": 1450588643, "last_edit_date": 1450592038, "question_id": 34378220, "link": "https://stackoverflow.com/questions/34378220/summing-an-integer-tree-haskell", "title": "Summing an Integer Tree (Haskell)", "body": "<p>I'm trying to make a function that sums up the values of a non-binary integer tree.</p>\n\n<pre><code>-- datastructures.hs    \ndata Tree a = Empty | Node a [Tree a] deriving (Eq, Show)\n\nmyNums :: (Num a) =&gt; Tree a\nmyNums = Node 1 [ \n           Node 2 [ \n             Node 4 [Empty], Node 5 [Empty]\n           ], \n           Node 3 [\n             Node 6 [Empty], Node 7 [Empty], Node 8 [Empty] \n           ]\n        ]\n\naddNums :: (Num a) =&gt; Tree a -&gt; a\naddNums Empty = 0\naddNums (Node n [Empty]) = n\naddNums (Node n (x:xs)) = n + (addNums x) + (addNums xs)\n</code></pre>\n\n<p>Ideally, I would like <code>addNums myNums</code> to be <code>36</code>, but this produces an error:</p>\n\n<pre><code>datastructures.hs:20:54:\n    Couldn't match expected type \u2018Tree a\u2019 with actual type \u2018[Tree a]\u2019\n    Relevant bindings include\n      xs :: [Tree a] (bound at datastructures.hs:20:20)\n      x :: Tree a (bound at datastructures.hs:20:18)\n      n :: a (bound at datastructures.hs:20:15)\n      addNums :: Tree a -&gt; a (bound at datastructures.hs:18:1)\n    In the first argument of \u2018addNums\u2019, namely \u2018xs\u2019\n    In the second argument of \u2018(+)\u2019, namely \u2018(addNums xs)\u2019\n</code></pre>\n\n<p>How do I counter this, and what are the best practices?</p>\n\n<p>EDIT: Best practices seem to omit <code>Empty</code> altogether!  I forgot that <code>[]</code> is a valid instance of type <code>[Tree a]</code>.  So the best way to implement this is:</p>\n\n<pre><code>data Tree a = Node a [Tree a] deriving (Eq, Show)\n\naddNums :: (Num a) =&gt; Tree a -&gt; a\naddNums (Node n []) = n\naddNums (Node n (x:xs)) = n + (addNums x) + addNums (Node 0 xs)\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1450547654, "post_id": 34373538, "comment_id": 56489123, "body": "The type of <code>*</code> for example is <code>Num a =&gt; a -&gt; a -&gt; a</code> - you are correct that it accepts any instance of <code>Num</code>, however, it only accepts one type at a time, and returns the same type. The expression <code>x * y * z</code> has type <code>Int</code>, or it is not well typed, because you declared <code>x</code> to have type <code>Int</code>. However, you are returning a float. Simply put another <code>fromIntegral $ x * y * z</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450548225, "post_id": 34373538, "comment_id": 56489310, "body": "you also need to <code>round</code> the <code>z</code> equation, then you can set the result type to <code>Int</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 0, "last_activity_date": 1450647187, "creation_date": 1450647187, "answer_id": 34386104, "question_id": 34373538, "link": "https://stackoverflow.com/questions/34373538/expecting-types-not-the-same-as-type-definitions/34386104#34386104", "title": "Expecting types not the same as type definitions", "body": "<p>Here is one way to fix the typing issue:</p>\n\n<pre><code>solvePyth :: Int -&gt; Int -&gt; Float\nsolvePyth x' y'\n  | valid = x * y * z\n  | otherwise = if y' &lt; x' then solvePyth x' (y' + 1) else solvePyth (x' + 1) 1\n  where z = sqrt (x^2 + y^2)\n        (x, y) = (fromIntegral x', fromIntegral y')\n        valid = (x^2 + y^2 == z^2) &amp;&amp; (x + y + z == 1000)\n</code></pre>\n\n<p><code>(*)</code> and <code>(^)</code> will work on arguments that are installed into <code>Num</code> class in general, but what is important is that the type have to be the same. Here is the type definition for <code>(*)</code>:</p>\n\n<pre><code>\u03bb&gt; :t (*)\n(*) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>but notice that <code>a</code> has to be the same type, so if you partially apply <code>Int</code> to it:</p>\n\n<pre><code>\u03bb&gt; :t (* (4 :: Int))\n(* (4 :: Int)) :: Int -&gt; Int\n</code></pre>\n\n<p>it expects the second argument and output to be an <code>Int</code> as well.</p>\n\n<p>On the other hand type of <code>(^)</code>:</p>\n\n<pre><code>\u03bb&gt; :t (^)\n(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>works on two arguments of possibly different types, so if we partially apply an <code>Int</code> it will produce an <code>Int</code>, but the second argument can still be an arbitrary <code>Integral</code>:</p>\n\n<pre><code>\u03bb&gt; :t ((4 :: Int) ^)\n((4 :: Int) ^) :: Integral b =&gt; b -&gt; Int\n</code></pre>\n\n<p>Basically whenever you see <code>a -&gt; a -&gt; a</code>, it means that the type variable <code>a</code> eventually has to be of the same type, thats why you cannot mix <code>Int</code> and <code>Float</code> with <code>(*)</code>, despite that they are both installed into <code>Num</code>.</p>\n"}], "owner": {"reputation": 137, "user_id": 5486662, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/isNIe.jpg?s=128&g=1", "display_name": "GuitarGuy365", "link": "https://stackoverflow.com/users/5486662/guitarguy365"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 34386104, "answer_count": 1, "score": 1, "last_activity_date": 1450647187, "creation_date": 1450546621, "question_id": 34373538, "link": "https://stackoverflow.com/questions/34373538/expecting-types-not-the-same-as-type-definitions", "title": "Expecting types not the same as type definitions", "body": "<p>I'm attempting to do problem 9 of Project Euler right now, but Haskell won't stop yelling at me about types not matching up. The thing is, ghci is telling me it is expecting types different than those given in the function type definitions. </p>\n\n<p>Here is the code: </p>\n\n<pre><code>solvePyth :: Int -&gt; Int -&gt; Float\nsolvePyth x y\n    |valid = x * y * z\n    |otherwise = if y &lt; x then solvePyth x (y + 1) else solvePyth (x + 1) 1\n    where z = sqrt $ fromIntegral $ x^2 + y^2\n          valid = (x^2 + y^2 == z^2) &amp;&amp; (x + y + z == 1000)\n</code></pre>\n\n<p>and here are the errors I am getting: </p>\n\n<pre><code>Prelude&gt; :l debug\n[1 of 1] Compiling Main             ( debug.hs, interpreted )\n\ndebug.hs:3:14:\n    Couldn't match expected type `Float' with actual type `Int'\n    In the first argument of `(*)', namely `x'\n    In the first argument of `(*)', namely `x * y'\n\ndebug.hs:3:18:\n    Couldn't match expected type `Float' with actual type `Int'\n    In the second argument of `(*)', namely `y'\n    In the first argument of `(*)', namely `x * y'\n\ndebug.hs:6:33:\n    Couldn't match expected type `Int' with actual type `Float'\n    In the first argument of `(^)', namely `z'\n    In the second argument of `(==)', namely `z ^ 2'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What I don't understand is why <code>(*)</code> and <code>(^)</code> are expecting Floats and Ints, when checking their typing in ghci with <code>:t</code> shows their arguements only need to be considered Nums.</p>\n"}, {"tags": ["haskell", "interface", "polymorphism", "typeclass"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450547968, "post_id": 34373085, "comment_id": 56489234, "body": "When you expect that each type has a unique implementation, or you want to label implementations by their type in particular, or you simply need the convenience of implicit instance resolution, use type classes. Otherwise, use records. But this is just my opinion... I think at least part 1 is very opinion based (some people are die-hard advocates of one over the other in almost every situation...)."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450549821, "post_id": 34373085, "comment_id": 56489825, "body": "You may find this useful: <a href=\"https://stackoverflow.com/questions/17100036/should-i-use-typeclasses-or-not\" title=\"should i use typeclasses or not\">stackoverflow.com/questions/17100036/&hellip;</a>"}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1450551507, "post_id": 34373085, "comment_id": 56490330, "body": "Type classes aren&#39;t for separate interface from specification. They&#39;re for introduce context dependent overloaded symbols. A problem with type-class as modules is that all instances are visible in a scope in which the type class is visible."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450709882, "post_id": 34373085, "comment_id": 56538155, "body": "@user2407038 your advice follows what Gabriel says in the link provided by the next comment.  Thanks."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450709931, "post_id": 34373085, "comment_id": 56538178, "body": "@Sibi - thanks for the link.  Gabriel always has good advice."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1450709991, "post_id": 34373085, "comment_id": 56538217, "body": "@RodrigoRibeiro : true, but many people use them that way, as shown in my <code>System.Random</code> example."}], "answers": [{"comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1450598794, "post_id": 34377036, "comment_id": 56499592, "body": "I personally find the typeclass example much easier to follow than the other one. I don&#39;t understand why many people advise against them."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450716255, "post_id": 34377036, "comment_id": 56542272, "body": "As for the record approach (as with <code>doFoo&#39;</code>) you can enable <code>RecordWildCards</code> and write <code>doFoo&#39; CanFoo&#39;{..} a = do { ... ; return (foo a) }</code>. This makes the function syntactically much nicer, and this even works if the record fields are infix binary functions (ie <code>data Num a = Num { (+) :: a -&gt; a -&gt; a }</code>)"}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 3, "last_activity_date": 1450598658, "last_edit_date": 1450598658, "creation_date": 1450573510, "answer_id": 34377036, "question_id": 34373085, "link": "https://stackoverflow.com/questions/34373085/haskell-how-to-separate-interface-from-implementation/34377036#34377036", "title": "Haskell: how to separate interface from implementation", "body": "\n\n<p>The answer to question 1 is quite simple: the two options are equivalent \u2014 type classes can be \"desugared\" to just data types. The idea has been described, and argued in favor of, in <a href=\"http://www.haskellforall.com/2012/05/scrap-your-type-classes.html\" rel=\"nofollow\">http://www.haskellforall.com/2012/05/scrap-your-type-classes.html</a>.</p>\n\n<hr>\n\n<p>The answer to question 2 is that these two are the only ways to separate interface from implementation. The reasoning would be something like this:</p>\n\n<ol>\n<li>ultimately the goal is to pass around functions somehow \u2014 this is because there is no other way in Haskell to implement anything whatsoever than as functions, so in order to pass around implementations, you need to pass around functions (note that specifications are just types)</li>\n<li>you can either pass around a single function or several functions</li>\n<li>to pass around a single function, you just pass that function around, or that function wrapped in something to mimick type classes (i.e. to give your interface a name (e.g. <code>CanFoo</code>) in addition to just the type signature (<code>a -&gt; Foo</code>)</li>\n<li>to pass around multiple functions, you just pass them around inside a tuple or a record (like our <code>CanFoo</code> but with more fields); note that a record is just a named tuple type with named fields, in this context.</li>\n</ol>\n\n<p>\u2014 Whether to pass around functions explicitly or implicitly (with type classes), is, as already demonstrated, one and the same thing conceptually <sup>[1]</sup>. </p>\n\n<hr>\n\n<p>Here's a simple demonstration of how the 2 methods are equivalent:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Foo = Foo\n\n-- using type classes\nclass CanFoo a where\n  foo :: a -&gt; Foo\n\ndoFoo :: CanFoo a =&gt; a -&gt; IO Foo\ndoFoo a = do\n  putStrLn \"hello\"\n  return $ foo a\n\ninstance CanFoo Int where\n  foo _ = Foo\n\nmain = doFoo 3\n\n-- using explicit instance passing\ndata CanFoo' a = CanFoo' { foo :: a -&gt; Foo }\n\ndoFoo' :: CanFoo' a -&gt; a -&gt; IO Foo\ndoFoo' cf a = do\n  putStrLn \"hello\"\n  return $ (foo cf) a\n\nintCanFoo = CanFoo { foo = \\_ -&gt; Foo }\n\nmain' = doFoo' intCanFoo 3\n</code></pre>\n\n<p>As you can see, if you use records, your \"instances\" aren't looked up automatically anymore and instead you need to pass them explicitly to the functions that need them.</p>\n\n<p>Note also that in the trivial case, the record method can be reduced to just passing around functions because passing around <code>CanFoo { foo = \\_ -&gt; Foo }</code> is really the same as passing around the wrapped function <code>\\_ -&gt; Foo</code> itself.</p>\n\n<hr>\n\n<p>[1]</p>\n\n<p>In fact, in Scala, this conceptual equivalence becomes obvious as a type class in Scala is encoded in terms of a type (e.g. <code>trait CanFoo[T]</code>), a number of values of that type, and function parameters of that type that are marked to be <code>implicit</code>, which will cause Scala to look up values of type <code>CanFoo[Int]</code> at the call site.</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>// data Foo = Foo\ncase object Foo\n\n// data CanFoo t = CanFoo { foo :: t -&gt; Foo }\ntrait CanFoo[T] { def foo(x : T): Foo }\nobject CanFoo {\n  // intCanFoo = CanFoo { foo = \\_ -&gt; Foo }\n  implicit val intCanFoo = new CanFoo[Int] { def foo(_: Int) = Foo }\n}\n\nobject MyApp {\n  // doFoo :: CanFoo Int -&gt; Int -&gt; IO ()\n  def doFoo(someInt: Int)(implicit ev : CanFoo[Int]] = {\n    println(\"hello\")\n    ev.foo(someInt)\n  }\n\n  def main(args : List[String]) = {\n    doFoo(3)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 4, "accepted_answer_id": 34377036, "answer_count": 1, "score": 8, "last_activity_date": 1450598658, "creation_date": 1450543880, "last_edit_date": 1450574539, "question_id": 34373085, "link": "https://stackoverflow.com/questions/34373085/haskell-how-to-separate-interface-from-implementation", "title": "Haskell: how to separate interface from implementation", "body": "<p>I know of two ways to separate the specification of an interface from an implementation of that interface in Haskell:</p>\n\n<ol>\n<li><p>type classes, e.g.:</p>\n\n<ul>\n<li>interface: <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow\"><code>RandomGen</code></a></li>\n<li>impl: <code>StdGen</code></li>\n</ul></li>\n<li><p>records, e.g.:</p>\n\n<ul>\n<li>interface: <a href=\"https://hackage.haskell.org/package/network-transport-0.4.2.0/docs/Network-Transport.html\" rel=\"nofollow\"><code>Network.Transport</code></a></li>\n<li>impl: <a href=\"https://hackage.haskell.org/package/network-transport-tcp-0.4.2/docs/Network-Transport-TCP.html\" rel=\"nofollow\"><code>Network.Transport.TCP</code></a></li>\n</ul></li>\n</ol>\n\n<p>QUESTION 1: when is it appropriate to use one or the other?</p>\n\n<p>QUESTION 2: what other ways are there to separate interface/impl in Haskell?</p>\n"}, {"tags": ["linux", "ubuntu", "haskell"], "comments": [{"owner": {"reputation": 18731, "user_id": 1220269, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/KVjUY.jpg?s=128&g=1", "display_name": "Nathaniel Waisbrot", "link": "https://stackoverflow.com/users/1220269/nathaniel-waisbrot"}, "edited": false, "score": 2, "creation_date": 1450538485, "post_id": 34372253, "comment_id": 56486216, "body": "<code>vi</code>, <code>emacs</code>, <code>nano</code>, <code>cat</code> with redirection, etc."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450539220, "post_id": 34372253, "comment_id": 56486459, "body": "<a href=\"https://xkcd.com/378/\" rel=\"nofollow noreferrer\"><code>cat</code>? Real programmers programmers use butterflies!</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5698458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab2977bf026af4962f85e034ece84c2a?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/5698458/chris"}, "edited": false, "score": 0, "creation_date": 1450542344, "post_id": 34372442, "comment_id": 56487435, "body": "Great thanks, yes I have only used an IDE before which has made me realise just how clueless I am without them."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1450541808, "last_edit_date": 1450541808, "creation_date": 1450539547, "answer_id": 34372442, "question_id": 34372253, "link": "https://stackoverflow.com/questions/34372253/haskell-in-ubuntu/34372442#34372442", "title": "Haskell in Ubuntu", "body": "<p>I think you're jumping a few steps ahead if you don't know source code is a text file and can be edited with your favorite editor. This might be a side effect of learning programming only with and within an IDE.</p>\n\n<p><a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program\" rel=\"nofollow\">https://wiki.haskell.org/How_to_write_a_Haskell_program</a></p>\n"}], "owner": {"reputation": 1, "user_id": 5698458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab2977bf026af4962f85e034ece84c2a?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/5698458/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "closed_date": 1450557195, "answer_count": 1, "score": -1, "last_activity_date": 1450541808, "creation_date": 1450538347, "question_id": 34372253, "link": "https://stackoverflow.com/questions/34372253/haskell-in-ubuntu", "closed_reason": "Needs more focus", "title": "Haskell in Ubuntu", "body": "<p>I am new to linux and have spent ages trying to get Haskell to work. I have given up on Eclipses module because for some reason it lagged incredible amounts. I have finally got GHCi working but can't find anywhere how I can save and load modules into the prelude. Like, I understand how to load them with :load \"filename\" but how do I make a .hs file?? </p>\n\n<p>Any help would be most appreciated.</p>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450539041, "post_id": 34372221, "comment_id": 56486404, "body": "<code>CArray</code> is an instance of <a href=\"https://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array-IArray.html#t:IArray\" rel=\"nofollow noreferrer\"><code>Data.Array.IArray.IArray</code></a>, meaning you can use the <code>array</code>, <code>accumArray</code>, <code>listArray</code> functions as you would to create any other instance of <code>IArray</code>."}, {"owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450589954, "post_id": 34372221, "comment_id": 56498131, "body": "Could you please give a demo like constructing a two-dimension array? And point out which parameter indicates its dimension. Thank you."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450590223, "post_id": 34372221, "comment_id": 56498166, "body": "<code>listArray ((dim1_lower_bound, dim2_lower_bound), (dim1_upper_bound, dim2_upper_bound)) [0..]</code>"}, {"owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450597209, "post_id": 34372221, "comment_id": 56499308, "body": "I use your method and have solved my problem. Thank you for your help."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1450621395, "post_id": 34372221, "comment_id": 56505253, "body": "@ZhangjieCao, Could you please post your answer on how to use the <code>dft</code> function? The function has type <code>(Math.FFT.Base.FFTWReal r, Data.Ix.Shapable.Shapable i, Ix i) =&gt; Data.Array.CArray.Base.CArray i (Complex r) -&gt; Data.Array.CArray.Base.CArray i (Complex r)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1450668886, "creation_date": 1450668886, "answer_id": 34388590, "question_id": 34372221, "link": "https://stackoverflow.com/questions/34372221/how-to-use-defn-in-math-fft-in-haskell-how-to-construct-a-multi-dimensional-car/34388590#34388590", "title": "How to use defN in Math.FFT in Haskell? How to construct a multi-dimensional CArray?", "body": "<p>The construction functions are generic over the choice of <code>IArray</code> representation, and are available in <a href=\"https://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array-IArray.html\" rel=\"nofollow\"><code>Data.Array.IArray</code></a>:</p>\n\n<pre><code>import Data.Array.CArray\nimport qualified Data.Array.IArray as Arr\n\n-- | A 10x10 2-dimensional array stored row by row in a list -- your \"fundamental data structure like []\"\nrowByRow :: [Double]\nrowByRow = [0..100]\n\n-- | A 10x10 d-dimensional CArray. The coordinates start at 0.\ncarray :: CArray (Int, Int) Double\ncarray = Arr.listArray ((0, 0), (9, 9)) rowByRow\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5698210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dbc129440e16cea9dd694f780fc2c71?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangjie Cao", "link": "https://stackoverflow.com/users/5698210/zhangjie-cao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1450668886, "creation_date": 1450538161, "last_edit_date": 1450668301, "question_id": 34372221, "link": "https://stackoverflow.com/questions/34372221/how-to-use-defn-in-math-fft-in-haskell-how-to-construct-a-multi-dimensional-car", "title": "How to use defN in Math.FFT in Haskell? How to construct a multi-dimensional CArray?", "body": "<p>I need to DFT a image and the <code>dft</code> function accepts <code>CArray</code> as its parameter. But I don't know how to construct a multi-dimensional <code>CArray</code>. Could someone help me and give a demo about how to construct a multi-dimensional <code>CArray</code> from some fundamental data structure like <code>[]</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450507501, "post_id": 34366364, "comment_id": 56478192, "body": "Challenge: implement your algorithm as <code>initLast = fromJust . foldr go Nothing where go ....</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1450533401, "post_id": 34366364, "comment_id": 56484721, "body": "if <i>&quot;similar to <code>uncons</code>&quot;</i> then surely it should be <code>unsnoc :: [a] -&gt; Maybe ([a], a)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450491367, "post_id": 34366502, "comment_id": 56475523, "body": "&quot;but 67MB for initLast and only 6MB for initLast&#39;&quot; really? They both run in the same time and space on my machine... which makes sense to me, because I would think they should be equivalent due to laziness."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450492118, "post_id": 34366502, "comment_id": 56475644, "body": "@user2407038 Really. They are not equivalent because the former makes two passes over the data (hence must hold the entire input list in memory during the first pass), while the latter makes only one. Perhaps you are not compiling with optimizations or something...?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450492967, "post_id": 34366502, "comment_id": 56475751, "body": "Nevermind.. I was testing like in the OP, only taking the second element. I see it was simply optimizing away the code which computed <code>init</code>, and I guess the tuple in <code>initLast&#39;</code> was optimized away too... when consuming the entire result the discrepancy appears."}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 1, "creation_date": 1450505840, "post_id": 34366502, "comment_id": 56477846, "body": "somewhat off topic.. Since init and last are independent and xs is immutable.. can not compiler optimize it to only one pass on list ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 1, "creation_date": 1450506066, "post_id": 34366502, "comment_id": 56477899, "body": "@AshishNegi Depends what you mean by &quot;can&quot;. If you mean &quot;is the compiler allowed to according to the spec&quot;, yes, definitely. If you mean &quot;is GHC smart enough to notice this&quot;, no, empirically not. If you mean &quot;could one in principle design a compiler smart enough to notice this&quot;, well, I guess, but <a href=\"http://c2.com/cgi/wiki?SufficientlySmartCompiler\" rel=\"nofollow noreferrer\">hoping for a sufficiently smart compiler is probably a mistake</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450506830, "post_id": 34366502, "comment_id": 56478057, "body": "@DanielWagner I&#39;m pretty sure this sort of loop fusion is supported by some compilers and/or libraries. There has certainly been work on similar things in Haskell, but it&#39;s a bit over my head."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1450490683, "creation_date": 1450490683, "answer_id": 34366502, "question_id": 34366364, "link": "https://stackoverflow.com/questions/34366364/most-efficient-way-to-write-init-last-in-haskell/34366502#34366502", "title": "Most efficient way to write (init, last) in Haskell", "body": "<p>As usual: compile if you're going to do performance tests. The compiled version uses about the same time for both, but 67MB for <code>initLast</code> and only 6MB for <code>initLast'</code>.</p>\n"}], "owner": {"reputation": 1004, "user_id": 1873550, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3b3947b42647b7f52bfc1d19067e61c2?s=128&d=identicon&r=PG", "display_name": "hoogamaphone", "link": "https://stackoverflow.com/users/1873550/hoogamaphone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1450490683, "creation_date": 1450489094, "question_id": 34366364, "link": "https://stackoverflow.com/questions/34366364/most-efficient-way-to-write-init-last-in-haskell", "title": "Most efficient way to write (init, last) in Haskell", "body": "<p>I am new to Haskell, so as an exercise, I wanted to implement a function that was similar to <code>uncons</code> that returns both the <code>init</code> and <code>last</code> elements in a list. The easy way to write this function is </p>\n\n<pre><code>initLast :: [a] -&gt; ([a], a)\ninitLast xs = (init xs, last xs)\n</code></pre>\n\n<p>I'm new to writing haskell programs, but this seems inefficient to me, as it will have to iterate through the list twice. I came up with another function that I thought might be better for not iterating through the list multiple times:</p>\n\n<pre><code>initLast' :: [a] -&gt; ([a], a)\ninitLast' [x] = ([], x)\ninitLast' (x:xs) = let (xs', y) = initLast' xs\n                   in (x:xs', y)\n</code></pre>\n\n<p>But it turns out that when I run these in ghci, I see that the second version is twice as slow, and uses approximately 3 times the memory!</p>\n\n<pre><code>ghci&gt; :set +s\nghci&gt; snd (initLast [1..1000000])\n1000000\n(0.28 secs, 122242144 bytes)\nghci&gt; snd (initLast' [1..1000000])\n1000000\n(0.71 secs, 434147544 bytes)\n</code></pre>\n\n<h2>The Questions:</h2>\n\n<ol>\n<li>Why is the second version less efficient? </li>\n<li>Is there a more efficient way to implement <code>initLast</code>?</li>\n</ol>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1450486814, "post_id": 34365410, "comment_id": 56474784, "body": "<code>Haskell2010</code> does not imply <code>MultiParamTypeClasses</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1450487645, "post_id": 34365410, "comment_id": 56474918, "body": "@ReidBarton can you elaborate? (see my edit). Maybe I&#39;m mistaken."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450487728, "post_id": 34365410, "comment_id": 56474928, "body": "Your example demonstrates that <code>class Foo a b</code> is <i>not</i> accepted without strictly enabling <code>MultiParamTypeClasses</code>, even when <code>Haskell2010</code> is enabled (which is the default for ghci)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450487757, "post_id": 34365410, "comment_id": 56474940, "body": "Sorry I&#39;m just tired, and was being stupid! (unedited)"}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1450485876, "post_id": 34365555, "comment_id": 56474610, "body": "Thanks, but I don&#39;t think that answers the question. I updated my question to perhaps be more clear."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450487633, "post_id": 34365555, "comment_id": 56474916, "body": "@jberryman As another commentor noted, Haskell2010 does not imply MultiParamTypeClasses. <code>echo &quot;class C a b&quot; &gt; test.hs &amp;&amp; ghc -XHaskell2010 test.hs</code> results in an error."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450487862, "post_id": 34365555, "comment_id": 56474956, "body": "Ugh sorry I wasn&#39;t reading what I was myself typing. nevermind"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 7, "last_activity_date": 1450481904, "creation_date": 1450481904, "answer_id": 34365555, "question_id": 34365410, "link": "https://stackoverflow.com/questions/34365410/which-langugage-extensions-are-implied-by-haskell2010-in-ghc/34365555#34365555", "title": "Which langugage extensions are implied by Haskell2010 in ghc?", "body": "<p>From the very last section of the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch12.html#x19-19100012.3\">Haskell 2010 report</a>, I believe this is what you are looking for (emphasis mine):</p>\n\n<blockquote>\n  <p>Haskell 2010 implementations that support the LANGUAGE pragma are\n  required to support</p>\n\n<pre><code>{-# LANGUAGE Haskell2010 #-}\n</code></pre>\n  \n  <p>Those implementations are also encouraged to support the following\n  named language features:</p>\n\n<pre><code>PatternGuards, NoNPlusKPatterns, RelaxedPolyRec,  \nEmptyDataDecls, ForeignFunctionInterface\n</code></pre>\n  \n  <p><strong>These are the named language extensions supported by some pre-Haskell</strong>\n  <strong>2010 implementations, that have been integrated into this report.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 34365555, "answer_count": 1, "score": 5, "last_activity_date": 1450487594, "creation_date": 1450480906, "last_edit_date": 1450487594, "question_id": 34365410, "link": "https://stackoverflow.com/questions/34365410/which-langugage-extensions-are-implied-by-haskell2010-in-ghc", "title": "Which langugage extensions are implied by Haskell2010 in ghc?", "body": "<p>I don't know why I'm having trouble finding the docs for this, but which extensions are implied by:</p>\n\n<pre><code>{-# LANGUAGE Haskell2010 #-}\n</code></pre>\n\n<p>I'm mostly just concerned with how ghc handles this, but I assume this is part of the standard.</p>\n"}, {"tags": ["haskell", "type-inference", "ghci"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 5, "creation_date": 1450476647, "post_id": 34364662, "comment_id": 56471901, "body": "Import <code>Socket</code> from <code>Network.Socket</code> (or just <code>Network</code>) and use that. GHCi shows fully qualified names for names that aren&#39;t imported in the current session. Here we can know that <code>Network.Socket.Types.Socket</code> isn&#39;t imported, since we don&#39;t have such a qualified import anywhere."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450477401, "post_id": 34364662, "comment_id": 56472149, "body": "@Andr&#225;sKov&#225;cs  I&#39;ve made the following changes:  <code>import Network.Socket (close, Socket(..))</code>  <code>processRequest :: Socket -&gt; [Char] -&gt; IO ()</code>  <code>tinyserver.hs:28:23:     Couldn&#39;t match expected type \u2018GHC.IO.Handle.Types.Handle\u2019                 with actual type \u2018Socket\u2019</code>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450480292, "post_id": 34364662, "comment_id": 56473103, "body": "You can again see that <code>Handle</code> is not imported. <code>import System.IO</code> does it. You will probably have an easier time here if you just import whole modules without specifying names. It&#39;s not hard to find definitions with Hoogle/GHCi/haskell-mode anyway."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450480402, "post_id": 34364662, "comment_id": 56473128, "body": "There is a mismatch between <code>Socket</code> and <code>Handle</code>. Your <code>processRequest</code> is operating on a <code>Handle</code> but most <code>Network.Socket</code> work with the <code>Socket</code> type. You can use the <code>Network.connectTo</code> function to get a <code>Handle</code> directly or convert any old <code>Socket</code> to a <code>Handle</code> with <code>Network.Socket.socketToHandle</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450484950, "post_id": 34364662, "comment_id": 56474393, "body": "I note that your function is named <code>processRequest</code>, but your ghci query asks about <code>processRequests</code> -- note the plural!"}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450489760, "post_id": 34364662, "comment_id": 56475266, "body": "Thanks @DanielWagner, that cleared some things up.  My code had both functions, which made this confusing."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450490256, "post_id": 34364662, "comment_id": 56475351, "body": "@Andr&#225;sKov&#225;cs <code>import System.IO</code> did it; <code>Handle</code> is now a type.  I added <code>Handle(..)</code> to the import list to be explicit.  If you want to answer I&#39;ll mark it as correct."}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1450489636, "creation_date": 1450476404, "last_edit_date": 1450489636, "question_id": 34364662, "link": "https://stackoverflow.com/questions/34364662/finding-type-signatures-in-haskell", "title": "Finding type signatures in Haskell", "body": "<p>I'm playing with <a href=\"http://www.friendlyvirus.org/miguelnegrao/2014/03/09/making-a-tiny-web-server-in-haskell/\" rel=\"nofollow\">a small server in Haskell</a>.  As an exercise, I am manually adding type signatures.</p>\n\n<pre><code>import System.Posix (installHandler, sigPIPE, getFileStatus, fileSize, Handler(..))\nimport Network (listenOn, accept, PortID(..))\nimport qualified Data.ByteString.Lazy as B\nimport Data.Binary\nimport Network.Socket (close)\nimport Control.Monad (forever, replicateM_)\nimport System.Environment (getArgs)\nimport System.IO (hGetContents, hPutStr, hSetBinaryMode, withFile, hClose, IOMode(..))\n\n...\n\n--here's what I want to add a type signature to\nprocessRequest h = do\n    s &lt;- hGetContents h\n    let req = takeWhile (/= \"\\r\") $ lines s \n    mapM_ (\\x -&gt; putStrLn $ \"&gt; \"++x) req\n    return $ words (head req) !! 1\n</code></pre>\n\n<p>Well there should be an easy way to figure this out, let's see what GHCI's type inference says:</p>\n\n<pre><code>Prelude&gt; :l tinyserver.hs \n[1 of 1] Compiling Main             ( tinyserver.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; :info processRequest\nprocessRequest :: GHC.IO.Handle.Types.Handle -&gt; IO String\n    -- Defined at tinyserver.hs:26:1\n</code></pre>\n\n<p>Man that's a big type.  Ok, let's add it:</p>\n\n<pre><code>processRequest :: GHC.IO.Handle.Types.Handle -&gt; [Char] -&gt; IO ()\nprocessRequest h = do\n   ...\n</code></pre>\n\n<p>That should do it.  Is GHCI cool with this?</p>\n\n<pre><code>*Main&gt; :l tinyserver.hs \n[1 of 1] Compiling Main             ( tinyserver.hs, interpreted )\ntinyserver.hs:26:19:\n    Not in scope:\n      type constructor or class \u2018GHC.IO.Handle.Types.Handle\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Yuck.  Maybe the name is too long.  Let's try all the child types:</p>\n\n<pre><code>processRequest :: IO.Handle.Types.Handle -&gt; [Char] -&gt; IO ()\nprocessRequest :: Handle.Types.Handle -&gt; [Char] -&gt; IO ()\nprocessRequest :: Types.Handle -&gt; [Char] -&gt; IO ()\nprocessRequest :: Handle -&gt; [Char] -&gt; IO ()\n</code></pre>\n\n<p>No, they all give me the same result.</p>\n\n<p>What is the right way to find these types?  GHCI?  Hoogle?  Something else?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1450472853, "post_id": 34363731, "comment_id": 56470377, "body": "Why not just use a map with an if statement in there? <code>map (\\x -&gt; if 4 &lt;= x &amp;&amp; x &lt;= 100 then 2 * x else x)</code>?  Lenses are a sledgehammer for a very small nail here."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1450485216, "creation_date": 1450485216, "answer_id": 34365983, "question_id": 34363731, "link": "https://stackoverflow.com/questions/34363731/setter-lens-to-act-on-a-range-of-a-list-in-haskell/34365983#34365983", "title": "Setter lens to act on a range of a list in haskell", "body": "<pre><code>&gt; :m + Control.Lens Data.Ix\n&gt; (traverse . filtered (inRange (4, 7)) *~ 2) [1..10]\n[1,2,3,8,10,12,14,8,9,10]\n</code></pre>\n\n<p>Note that this is probably violating the lens laws, and so may have unexpected behavior in larger code contexts -- one is supposed to be careful that the property passed to <code>filtered</code> is not violated by the updates performed!</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 34365983, "answer_count": 1, "score": 1, "last_activity_date": 1450485216, "creation_date": 1450471683, "question_id": 34363731, "link": "https://stackoverflow.com/questions/34363731/setter-lens-to-act-on-a-range-of-a-list-in-haskell", "title": "Setter lens to act on a range of a list in haskell", "body": "<p>Given an array eg <code>[1..]</code> is there a way with lenses to double all the numbers in the range <code>[4,100]</code> so it becomes</p>\n\n<pre><code>1,2,3,8,10,12,14,16,...,200,101,102...\n</code></pre>\n\n<p>I am not very fluent with lenses but I feel like getters are the right tool for this.</p>\n"}, {"tags": ["haskell", "ffmpeg", "gloss", "juicy-pixels"], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 0, "last_activity_date": 1450471098, "creation_date": 1450471098, "answer_id": 34363587, "question_id": 34362319, "link": "https://stackoverflow.com/questions/34362319/how-to-find-mp4-metadata-with-ffmpeg-light-in-haskell/34363587#34363587", "title": "How to find mp4 metadata with ffmpeg-light in haskell?", "body": "<p>(a) I <em>think</em> <code>void cleanup</code> is redundant and just <code>cleanup</code> works, but I like you am not 100% sure what that <code>IO ()</code> value does precisely.</p>\n\n<p>I don't see a direct way to read FPS, but <code>imageReaderTime</code> produces timestamps in seconds, which would give you a good indicator. To propagate the timestamp you'll need to modify:</p>\n\n<pre><code>nextFrame :: IO (Maybe (Image PixelRGB8, Double)) -&gt; IO (Double, Picture)\nnextFrame getFrame = fmap fromImageRGB8 . swap . fromJust &lt;$&gt; getFrame\n</code></pre>\n\n<p>Then you would say:</p>\n\n<pre><code>stampedFrames &lt;- replicateM frameCount $ nextFrame getFrame\nlet (tstamps, frames) = unzip stampedFrames\nlet approx_fps = fromIntegral (length tstamps) / (maximum tstamps - minimum tstamps)\n</code></pre>\n\n<p>Finally you can pass <code>approx_fps</code> as a parameter to <code>frameAt</code>, which will have to use <code>Double</code> rather than <code>Float</code> or else some type-coercing function.</p>\n\n<p>However, for what you're doing, what might be better is to have something like:</p>\n\n<pre><code>frameAt :: [(Double, Picture)] -&gt; Double -&gt; Picture\nframeAt list time = snd . head . dropWhile ((&lt; time) . fst) $ list\n</code></pre>\n\n<p>This takes the list, drops all elements whose first element (timestamp) is less than the requested time, and then returns the second element (picture) of the first pair that occurs after that. <strong>No FPS guessing is needed.</strong></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5696316"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 34363587, "answer_count": 1, "score": 6, "last_activity_date": 1450691963, "creation_date": 1450465447, "last_edit_date": 1450691963, "question_id": 34362319, "link": "https://stackoverflow.com/questions/34362319/how-to-find-mp4-metadata-with-ffmpeg-light-in-haskell", "title": "How to find mp4 metadata with ffmpeg-light in haskell?", "body": "<p>I'm using ffmpeg-light, JuicyPixels and gloss to display a video with Haskell. I want to find the metadata of videos I'm playing automatically, but I have not yet found a way to do so. </p>\n\n<p>I would like to access metadata like the resolution and the framerate of the video. </p>\n\n<p>Can you help me?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I have tried your solution @CRDrost, but the video is now playing at 2x normal speed. I assume the function imageReaderTime is giving the wrong timestamps. </p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p>The abnormal playing speed is a bug in the ffmpeg-light library. I've opened an <a href=\"https://github.com/acowley/ffmpeg-light/issues/17\" rel=\"nofollow\">issue</a> at the github repository.</p>\n\n<p>My updated code:</p>\n\n<pre><code>import Graphics.Gloss\nimport Codec.FFmpeg\nimport Codec.FFmpeg.Juicy\nimport Codec.Picture\nimport Control.Applicative\nimport Data.Maybe\nimport Graphics.Gloss.Juicy\nimport Control.Monad\n-- import System.IO.Unsafe (unsafePerformIO)-- for debugging purposes\n\nresolution :: (Int,Int)\nresolution = (640, 360)\n\nframeCount :: Int\nframeCount = 100\n\nmain :: IO ()\nmain = do\n    initFFmpeg\n    (getFrame, cleanup) &lt;- imageReaderTime \"big_buck_bunny.mp4\"\n    frames &lt;- replicateM frameCount $ nextFrame getFrame\n    cleanup\n    animate (InWindow \"Nice Window\" resolution (10,10)) white (frameAt frames)\n\nnextFrame :: IO (Maybe (Image PixelRGB8, Double)) -&gt; IO (Picture, Float)\nnextFrame getFrame = mapSnd realToFrac . mapFst fromImageRGB8 . fromJust &lt;$&gt; getFrame\n\nframeAt :: [(Picture, Float)] -&gt; Float -&gt; Picture\nframeAt list time = fst . head . dropWhile ((&lt; time) . snd) $ list\n\nmapFst :: (a -&gt; c) -&gt; (a, b) -&gt; (c, b)\nmapFst f (a, b) = (f a, b) -- applies f to first element of a 2-tuple\n\nmapSnd :: (b -&gt; c) -&gt; (a, b) -&gt; (a, c)\nmapSnd f (a, b) = (a, f b) -- applies f to the second element of a 2-tuple\n</code></pre>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1450463684, "post_id": 34361831, "comment_id": 56465942, "body": "Chapter 11 of Real World Haskell: <a href=\"http://book.realworldhaskell.org/read/testing-and-quality-assurance.html\" rel=\"nofollow noreferrer\">Testing and quality assurance</a>."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 5, "last_activity_date": 1450464810, "last_edit_date": 1450464810, "creation_date": 1450464081, "answer_id": 34362030, "question_id": 34361831, "link": "https://stackoverflow.com/questions/34361831/verifying-foldl-implementation-in-terms-of-foldr/34362030#34362030", "title": "Verifying foldl implementation in terms of foldr", "body": "<p>here is a simple test: <code>foldl (flip (:)) []</code> should be <code>reverse</code>... </p>\n\n<p>if you want to test <code>foldr</code> vs <code>foldl</code> you probably should not use commutative operations ;) </p>\n\n<p>here is some proof straight from GHCi:</p>\n\n<pre><code>\u03bb&gt; foldl (flip (:)) [] [1..5]\n[5,4,3,2,1]\n\u03bb&gt; foldl4 (flip (:)) [] [1..5]\n[1,2,3,4,5]\n</code></pre>\n\n<hr>\n\n<p>and as <code>flip (+) = (+)</code> you can guess straight from your definition:</p>\n\n<pre><code>foldl4 (+) y xs\n{ def }\n= foldr (flip (+)) y xs\n{ flip (+) = (+) }\n= foldr (+) y xs\n</code></pre>\n\n<hr>\n\n<p>if you want some <em>hint</em> of how to do <code>foldl</code> with <code>foldr</code>: you should use functions for the <em>accumulator/state/b</em> part of <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code> - think of <em>continuation passing</em> and try to replace the <code>:</code> in </p>\n\n<pre><code>x : (y : (z : [])\n</code></pre>\n\n<p>with some smart function to get </p>\n\n<pre><code>((b `f` x) `f` y) `f` z\n</code></pre>\n\n<p>remember you want to mimick</p>\n\n<pre><code>foldl f b [x,y,z] = ((b `f` x) `f` y) `f` z\n</code></pre>\n\n<p>with <code>foldr</code> which basically replaces <code>:</code> with it's first parameter and <code>[]</code> with it's second if you pass <code>[x,y,z]</code> as the 3rd:</p>\n\n<pre><code>foldr f' b' [x,y,z] = x `f'` (y `f'` (z `f'` b'))\n</code></pre>\n\n<p>and you now want to shift the parens</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450474121, "post_id": 34362219, "comment_id": 56470889, "body": "On any lists, I believe. You can get <code>foldl</code> from <code>foldr</code> in various ways; you just can&#39;t get a <code>foldr</code> that works for infinite lists from <code>foldl</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1450488249, "post_id": 34362219, "comment_id": 56475024, "body": "I am having trouble discerning your meaning between semantic and syntactic here.  <code>flip f x y</code> is just another syntax for <code>f y x</code>, but I don&#39;t know what <code>flip f</code> is syntax for."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1450464975, "creation_date": 1450464975, "answer_id": 34362219, "question_id": 34361831, "link": "https://stackoverflow.com/questions/34361831/verifying-foldl-implementation-in-terms-of-foldr/34362219#34362219", "title": "Verifying foldl implementation in terms of foldr", "body": "<p>Those two are <strong>not</strong> the same. <code>foldl</code> and <code>foldr</code> do <strong>semantically</strong> different things, but <code>flip</code> only induces a <strong>syntactic</strong> difference, so <code>foldr . flip</code> cannot ever ever be <code>foldl</code>.</p>\n\n<p>Something that <em>is</em> <code>foldl</code> for example (on finite lists) is </p>\n\n<pre><code>foldl5 = (.) (. reverse) . foldr . flip\n</code></pre>\n\n<p>That first part might look confusing, but it basically applies <code>reverse</code> to the third argument rather than the first. </p>\n"}], "owner": {"reputation": 51, "user_id": 5647834, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8f1682c67b6bb6f529ae2a9a2579157?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5647834/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1450464975, "creation_date": 1450463289, "question_id": 34361831, "link": "https://stackoverflow.com/questions/34361831/verifying-foldl-implementation-in-terms-of-foldr", "title": "Verifying foldl implementation in terms of foldr", "body": "<p>I want to verify following implementation of foldl in terms foldr is correct:</p>\n\n<pre><code>foldl4 = foldr . flip\n</code></pre>\n\n<p>I used following tests in HUGS:</p>\n\n<pre><code>foldl4 (+) 3 []\n\nfoldl4 (+) 3 [1,2,3]\n</code></pre>\n\n<p>They worked.</p>\n\n<p>Please suggest any more tests I could do.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 3, "creation_date": 1450464400, "post_id": 34361612, "comment_id": 56466273, "body": "&quot;can I convert an IO Int into an Int?&quot; no.  You&#39;re expressing a nondeterministic operation; it&#39;s going to have to be in <code>IO</code> or in a randomness monad."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1450464436, "post_id": 34361612, "comment_id": 56466295, "body": "As far as the distribution goes, you&#39;re going to have to pick an exact mathematical distribution for what you mean by &quot;element A has a higher chance of being selected.&quot;"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450465018, "post_id": 34361612, "comment_id": 56466568, "body": "If you want to assign probabilities to each element based solely on their <i>position</i> in the <code>Map</code>, and not their <i>values</i>, then you will need to use <code>findIndex :: Ord k =&gt; k -&gt; Map k a -&gt; Int</code> or convert the <code>Map</code> to an ordered container first, like a list."}], "answers": [{"comments": [{"owner": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "edited": false, "score": 0, "creation_date": 1450493527, "post_id": 34363181, "comment_id": 56475822, "body": "This is incredible, it works! Apparently I need to go to the books and really learn what a monad is."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1450493537, "last_edit_date": 1450493537, "creation_date": 1450469293, "answer_id": 34363181, "question_id": 34361612, "link": "https://stackoverflow.com/questions/34361612/select-random-element-from-map-with-non-uniform-distribution/34363181#34363181", "title": "Select random element from Map, with non-uniform distribution", "body": "<p>If you want to select elements of the <code>Map</code> based on their position in the <code>Map</code>, it will be easier to first convert to a list, because a <code>Map</code> is an unordered container.</p>\n\n<pre><code>import qualified Data.Map as M \nimport Control.Monad.Random (fromList, MonadRandom) \n\nsampleAscending :: (MonadRandom m, Ord k) =&gt; M.Map k a -&gt; m a \nsampleAscending m = fromList $ zip (map snd $ M.toAscList m) [l,l-1..]\n  where l = fromIntegral $ M.size m\n</code></pre>\n\n<p>Since you didn't specify <em>which</em> distribution, I just picked something simple (<code>[l,l-1..]</code>). The <code>fromList</code> function has type <code>MonadRandom m =&gt; [(a, Rational)] -&gt; m a</code>. The first element of the tuple in the input list in the candidate element, and the second element of the tuple is the probability of that item occuring. The <code>MonadRandom</code> interface takes care of the rest for you!</p>\n\n<p>To convince you this indeed works, here is a little test function:</p>\n\n<pre><code>import Control.Monad \nimport Text.Printf \n\ntestSample :: (Eq a, Show a) =&gt; [a] -&gt; IO () \ntestSample strIn = do \n  let m0 = M.fromList $ zip [1..] strIn \n      len = 10000 :: Float \n  str &lt;- replicateM (round len) (sampleAscending m0) \n  forM_ strIn $ \\c -&gt; \n    printf \"%s occured with probability %f\\n\"\n      (show c) ((fromIntegral.length.filter(==c)$ str)/len)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>&gt;testSample \"abc\"\n'a' occured with probability 0.5044\n'b' occured with probability 0.3281\n'c' occured with probability 0.1675\n\n&gt;testSample \"abcdefg\"\n'a' occured with probability 0.2473\n'b' occured with probability 0.2192\n'c' occured with probability 0.1814\n'd' occured with probability 0.1339\n'e' occured with probability 0.1112\n'f' occured with probability 0.0687\n'g' occured with probability 0.0383\n</code></pre>\n"}], "owner": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 34363181, "answer_count": 1, "score": 0, "last_activity_date": 1450493537, "creation_date": 1450462357, "question_id": 34361612, "link": "https://stackoverflow.com/questions/34361612/select-random-element-from-map-with-non-uniform-distribution", "title": "Select random element from Map, with non-uniform distribution", "body": "<p>I have a map <code>m</code> (using <code>import Data.Map</code>), and I want to select two elements from it randomly. So far I have tried this in GHCI (which doesn't work):</p>\n\n<pre><code>&gt; :module System.Random\n&gt; -- define my map in \"m\", not important here\n&gt; let myrand a = getStdRandom $ randomR (0, a - 1)\n&gt; elemAt (myrand (size m)) m\n</code></pre>\n\n<p>I get an error: <code>Couldn't match expected type 'Int' with actual type 'IO Int'</code>.</p>\n\n<p>So, first question, how can I make this work (can I convert an <code>IO Int</code> into an <code>Int</code>?)? Eventually I want a function to extract two different values from the map.</p>\n\n<p>And, second question, how can I make elements with \"lesser keys\" be more likely to be selected? Right now, if my code worked, it would just select an element with a uniform distribution. I want a simple way of saying \"element A, with key lower than element B, has a higher chance of being selected\". I have no idea how to proceed here, I tried looking at <a href=\"https://hackage.haskell.org/package/random-fu-0.2.6.2/docs/Data-Random-Distribution.html\" rel=\"nofollow\">some documentation</a>, but I have no idea how to make that work (or if it's even useful to me).</p>\n"}, {"tags": ["haskell", "code-duplication"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450459904, "post_id": 34360866, "comment_id": 56463843, "body": "If you need randomness, then an abstraction like <a href=\"https://hackage.haskell.org/package/MonadRandom-0.4.1/docs/Control-Monad-Random.html\" rel=\"nofollow noreferrer\">MonadRandom</a> will be useful. If you need to &quot;mutate&quot; something, then an abstraction like <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html\" rel=\"nofollow noreferrer\">MonadState</a> will also be useful. You should include some code which solves your problem, which you believe, in particular, suffers from code duplication."}, {"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450460137, "post_id": 34360866, "comment_id": 56463969, "body": "@user2407038 Sure the randomness comes from some monad. I don&#39;t really need state however. Returning a new solution would be fine for me. But thanks for the tips!"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 1, "creation_date": 1450460557, "post_id": 34360866, "comment_id": 56464187, "body": "Have you also looked at <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">Lens</a> ? It can be very handy when dealing with complex structures"}, {"owner": {"reputation": 21445, "user_id": 812818, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/bffad8ee5a559e7b747a839a1ed35416?s=128&d=identicon&r=PG", "display_name": "Daniel Lyons", "link": "https://stackoverflow.com/users/812818/daniel-lyons"}, "edited": false, "score": 1, "creation_date": 1450461655, "post_id": 34360866, "comment_id": 56464769, "body": "Not sure if it helps or not, but I did write <a href=\"https://en.wikipedia.org/wiki/Weasel_program\" rel=\"nofollow noreferrer\">&quot;the weasel program&quot;</a> in Haskell last year and had to address some of these same issues. <a href=\"https://bitbucket.org/fusiongyro/weasel\" rel=\"nofollow noreferrer\">My code is here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "edited": false, "score": 0, "creation_date": 1450545247, "post_id": 34361286, "comment_id": 56488345, "body": "Maybe I was overthinking it, but this solution will work nicely. Thanks!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1450461417, "last_edit_date": 1450461417, "creation_date": 1450461078, "answer_id": 34361286, "question_id": 34360866, "link": "https://stackoverflow.com/questions/34360866/similar-functions-operating-on-the-same-datastructure/34361286#34361286", "title": "Similar functions operating on the same datastructure", "body": "<h1>Concept: higher order functions</h1>\n\n<p>A higher order function is a function that takes as input another function. Without realizing, you have probably used several higher order functions already (like <code>map</code> and <code>foldl</code>).</p>\n\n<p>Simply use a <em>higher order</em> function, something with signature:</p>\n\n<pre><code>mutateGeneric :: (Trip -&gt; IO Trip) -&gt; Solution -&gt; IO Solution\n</code></pre>\n\n<p>so here the first argument is a function to mutate a trip, and your <code>mutateGeneric</code> function itself generates random numbers, performs a modification based on the function, and then returns the solution. If you do not perform <code>IO</code> (for instance because random numbers are generate otherwise), you can simply use:</p>\n\n<pre><code>mutateGeneric :: (Trip -&gt; Trip) -&gt; Solution -&gt; Solution\n</code></pre>\n\n<h1>Example</h1>\n\n<p>Say you first generate an <code>int</code> between <code>0</code> and <code>4</code> (inclusive) to determine the day, next you mutate both trips of that day, and finally you return the mutated solution.</p>\n\n<p>First we are going to define some utility methods:</p>\n\n<pre><code>getDay :: Int -&gt; Solution -&gt; DaySolution\ngetDay 0 = monday\ngetDay 1 = tuesday\ngetDay 2 = wednesday\ngetDay 3 = thursday\ngetDay 4 = friday\n\nsetDay :: Int -&gt; Solution -&gt; DaySolution -&gt; Solution\nsetDay 0 s d = s { monday = d }\nsetDay 1 s d = s { tuesday = d }\nsetDay 2 s d = s { wednesday = d }\nsetDay 3 s d = s { thursday = d }\nsetDay 4 s d = s { friday = d }\n</code></pre>\n\n<p>Then mutation looks like:</p>\n\n<pre><code>mutateGeneric modifier solution = do\n    di &lt;- randomIO :: IO Int\n    tam &lt;- modifier ta\n    tbm &lt;- modifier tb\n    return $ setDay day solution (tam,tbm)\n        where day = mod day 5\n              (ta,tb) = getDay day solution\n</code></pre>\n\n<p>and now a modifier could for instance swap the first with the second <code>Trips</code> item:</p>\n\n<pre><code>swapModifier :: Trips -&gt; IO Trips\nswapModifier (a:b:s) = return (b:a:s)\nswapModifier x = return x\n</code></pre>\n\n<p>Then finally you can say that your modification heurstic is:</p>\n\n<pre><code>heuristic1 :: Solution -&gt; IO Solution\nheuristic1 = mutateGeneric swapModifier\n</code></pre>\n\n<p>The point is that you can simply construct another modifier like <code>swapModifier</code> and combine it with <code>mutateGeneric</code>. Of course the example above is rather simple. Furthermore perhaps you need to update scores and penalties. This you can do in the <code>mutateGeneric</code> function.</p>\n"}], "owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 34361286, "answer_count": 1, "score": 0, "last_activity_date": 1450461417, "creation_date": 1450459494, "last_edit_date": 1450460749, "question_id": 34360866, "link": "https://stackoverflow.com/questions/34360866/similar-functions-operating-on-the-same-datastructure", "title": "Similar functions operating on the same datastructure", "body": "<p>I've got a data type of the following form:</p>\n\n<pre><code>type Orders                 = [Int]\ndata Score                  = Score Cost Penalty Penalty\ntype Trip                   = (Int, Cost, Orders)\ntype Trips                  = [Trip]\ntype DaySolution            = (Trips, Trips)\ndata Solution               = Solution { score         :: Score,\n                                         skippedOrders :: Orders,\n                                         monday        :: DaySolution,\n                                         tuesday       :: DaySolution,\n                                         wednesday     :: DaySolution,\n                                         thursday      :: DaySolution,\n                                         friday        :: DaySolution\n                              } deriving(Show)\n</code></pre>\n\n<p>My 'main' datatype is solution. Now I want to implement some genetic/evolutionary algorithm.</p>\n\n<p>This means I have to mutate <code>Solution</code>. Most of my mutations will need to operate on individual <code>trip</code>'s. </p>\n\n<p>For example, reverse the elements of a <code>trip</code>. Or Swap the trips of monday with tuesday. Or even swap the monday trips of solution 1 with the monday trips of solution 2.</p>\n\n<p>For most mutations I need the following steps:</p>\n\n<ol>\n<li>I need randomness to determine what <code>Trip</code>(s) to mutate.</li>\n<li>Mutate the <code>Trips</code></li>\n<li>Return the updated solution</li>\n</ol>\n\n<p>Obviously (2.) would be unique for each mutation function. But (1.) and (3.) are quite similar.</p>\n\n<p>What is a good way of implementing this without having to duplicate steps 1 (and 3) for each mutation function?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "edited": false, "score": 0, "creation_date": 1450459407, "post_id": 34360819, "comment_id": 56463552, "body": "by the way,&#39;Stat&#39; is a type which is a tuple of the form : (String,Int)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450459411, "post_id": 34360819, "comment_id": 56463555, "body": "&quot;I get an error&quot; - what error? The code seem fine to me as well. Maybe include a minimum working example (including imports, type defintions, etc)."}, {"owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450459550, "post_id": 34360819, "comment_id": 56463634, "body": "it&#39;s a parse error on input&#39;:&#39;"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1450459770, "post_id": 34360819, "comment_id": 56463768, "body": "what you have is working here so the error is probably somewhere else in your file - btw: it seems as if you only want <code>tupleToList = map snd</code> anyway"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450459825, "post_id": 34360819, "comment_id": 56463801, "body": "@HassanAli There is no parse error in the code you posted. Again, please include a minimum working example."}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 1, "creation_date": 1450462641, "post_id": 34360819, "comment_id": 56465361, "body": "I second the use of <code>map snd </code>. Your version doesn&#39;t handle empty list so it&#39;ll error out eventually."}, {"owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "edited": false, "score": 0, "creation_date": 1450462848, "post_id": 34360819, "comment_id": 56465477, "body": "so how do i rewrite the function ? :/"}], "answers": [{"tags": [], "owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "is_accepted": false, "score": 1, "last_activity_date": 1450493020, "last_edit_date": 1450493020, "creation_date": 1450492718, "answer_id": 34366683, "question_id": 34360819, "link": "https://stackoverflow.com/questions/34360819/haskell-issue-with-tuples/34366683#34366683", "title": "Haskell issue with tuples", "body": "<p>As others said there doesn't seem to be any error in what you wrote (other than what I noticed: you don't handle the case of an empty list.)</p>\n\n<p>You asked in the comments how to rewrite it.</p>\n\n<p>The simplest way is to do what Carsten said</p>\n\n<pre><code>tupleToList = map snd\n</code></pre>\n\n<p>If for some reason you wanted to build on your own version.</p>\n\n<pre><code>tupleToList :: [Stat] -&gt; [Int]\ntupleToList [] = []\ntupleToList ((a,b):xs) =  b : tupleToList xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 0, "last_activity_date": 1450705386, "creation_date": 1450705386, "answer_id": 34397136, "question_id": 34360819, "link": "https://stackoverflow.com/questions/34360819/haskell-issue-with-tuples/34397136#34397136", "title": "Haskell issue with tuples", "body": "<p>You can do this extremely simply like this:</p>\n\n<pre><code>tupleToList = map snd\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>&gt; tupleToList [(1,\"a\"),(2,\"b\"),(3,\"c\")]\n[\"a\",\"b\",\"c\"]\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1450705386, "creation_date": 1450459329, "question_id": 34360819, "link": "https://stackoverflow.com/questions/34360819/haskell-issue-with-tuples", "title": "Haskell issue with tuples", "body": "<p>I made a function in Haskell where I have a list of tuples, and want to extract only the second value of each tuple and return a list of the second values of the tuples.. I wrote this function but i get a weird error..</p>\n\n<pre><code>   --converts a list of tuples to single list\ntupleToList :: [Stat] -&gt; [Int]\ntupleToList ((a,b):xs) =  b : tupleToList xs\n</code></pre>\n\n<p>I get an error on the ':' after(a,b) in the second line. Any ideas what might be causing the problem? The function itself doesn't appear wrong to me but I'm new to Haskell so maybe there's something I'm not following right.</p>\n"}, {"tags": ["macos", "haskell", "gcc", "osx-yosemite", "configure"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450455408, "post_id": 34359320, "comment_id": 56461230, "body": "There is very little information here, have you identified which portion of the &quot;C compiler&quot; is failing and how? What are the contents of &quot;config.log&quot;? Have you run any of these commands with <code>-v3</code>? Have you possibly got multiple versions of gcc or something on your path? With basically 0 information to go on, this seems the most likely explanation to me."}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1450457430, "post_id": 34359320, "comment_id": 56462462, "body": "Just because you have Xcode 7.2 installed it doesn&#39;t mean that you have also installed the command line tools. Try <code>xcode-select --install</code> at a terminal prompt."}, {"owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "edited": false, "score": 0, "creation_date": 1450457526, "post_id": 34359320, "comment_id": 56462507, "body": "user2407038 I&#39;ve added some extra info as you suggested. I did have another version of gcc installed via homebrew, an I suspected as you did. But I uninstalled homebrew gcc and did a quick <code>brew list</code> to check I got them all, but still no luck."}, {"owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "reply_to_user": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1450457577, "post_id": 34359320, "comment_id": 56462537, "body": "@PaulR That command outputs: <code>xcode-select: error: command line tools are already installed, use &quot;Software Update&quot; to install updates</code>"}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1450457653, "post_id": 34359320, "comment_id": 56462579, "body": "Double check that your PATH is OK - do a <code>which gcc</code> to see what it returns."}, {"owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "edited": false, "score": 0, "creation_date": 1450458094, "post_id": 34359320, "comment_id": 56462832, "body": "<code>which gcc</code> gives me <code>&#47;usr&#47;local&#47;bin&#47;gcc</code>. Should it perhaps be pointing to <code>&#47;usr&#47;bin&#47;gcc</code>?"}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1450510674, "post_id": 34359320, "comment_id": 56478862, "body": "Yes it sounds like you didn&#39;t uninstall your homebrew gcc properly - it&#39;s probably a dangling symbolic link - get rid of it and try again."}, {"owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "edited": false, "score": 1, "creation_date": 1450609274, "post_id": 34359320, "comment_id": 56502010, "body": "Pointed it at the correct version and it now works. Thanks for your help!"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "is_accepted": false, "score": 1, "last_activity_date": 1450609209, "creation_date": 1450609209, "answer_id": 34380269, "question_id": 34359320, "link": "https://stackoverflow.com/questions/34359320/os-x-yosemite-configure-checking-whether-the-c-compiler-works-no/34380269#34380269", "title": "OS X Yosemite Configure: checking whether the C compiler works... no", "body": "<p>Turns out to that despite removing all Homebrew versions of gcc I still had another version installed at <code>/usr/local/bin/gcc</code> which was overriding the apple default. </p>\n"}], "owner": {"reputation": 11, "user_id": 5694407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6prSw7j-pwY/AAAAAAAAAAI/AAAAAAAAABE/Wz_dtLKTTy8/photo.jpg?sz=128", "display_name": "Samuel Jackson", "link": "https://stackoverflow.com/users/5694407/samuel-jackson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1669, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1450609209, "creation_date": 1450453865, "last_edit_date": 1450457322, "question_id": 34359320, "link": "https://stackoverflow.com/questions/34359320/os-x-yosemite-configure-checking-whether-the-c-compiler-works-no", "title": "OS X Yosemite Configure: checking whether the C compiler works... no", "body": "<p>I've been trying to install a Haskell library with cabal install but I encounter a problem where configure fails. Example output is as follows:</p>\n\n<pre><code>~ \u276f cabal install MissingH\nResolving dependencies...\nConfiguring old-time-1.1.0.3...\nConfiguring network-2.6.2.1...\nFailed to install old-time-1.1.0.3\nBuild log ( /Users/samuel/.cabal/logs/old-time-1.1.0.3.log ):\nConfiguring old-time-1.1.0.3...\nconfigure: WARNING: unrecognized options: --with-compiler, --with-gcc\nchecking for gcc... gcc\nchecking whether the C compiler works... no\nconfigure: error: in `/private/var/folders/11/b322xxjj7nn_46hvcr095m140000gn/T/cabal-tmp-11323/old-time-1.1.0.3':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\nFailed to install network-2.6.2.1\nBuild log ( /Users/samuel/.cabal/logs/network-2.6.2.1.log ):\nConfiguring network-2.6.2.1...\nconfigure: WARNING: unrecognized options: --with-compiler, --with-gcc\nchecking build system type... x86_64-apple-darwin14.5.0\nchecking host system type... x86_64-apple-darwin14.5.0\nchecking for gcc... gcc\nchecking whether the C compiler works... no\nconfigure: error: in `/private/var/folders/11/b322xxjj7nn_46hvcr095m140000gn/T/cabal-tmp-11322/network-2.6.2.1':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Error: some packages failed to install:\nMissingH-1.3.0.1 depends on network-2.6.2.1 which failed to install.\nhslogger-1.2.9 depends on network-2.6.2.1 which failed to install.\nnetwork-2.6.2.1 failed during the configure step. The exception was:\nExitFailure 77\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>Googling the problem (and searching this site) shows that the most common fix appears to be to update the Xcode command line tools. I tried that and I'm now on Xcode 7.2 and there's no pending updates, but I still get the same problem. Some answers said to make sure to accept the updated license after installation, which I have also done. I also tried installing gcc using homebrew and tried changing the <code>CC</code> path variable and using the <code>--with-gcc</code> option for cabal. All with no luck. I've run out of ideas.</p>\n\n<h2>Update</h2>\n\n<p>Additional info requested by user2407038: Cabal install seems to clean up after itself, but here's the <code>config.log</code> file for trying to build just one dependancies (old-time) of the command shown above. Seems to be missing <code>-lgcc_ext.10.4</code> which a quick google suggests in an Xcode update thing?</p>\n\n<pre><code>This file contains any messages produced by compilers while\nrunning configure, to aid debugging if configure makes a mistake.\n\nIt was created by Haskell old-time package configure 1.0, which was\ngenerated by GNU Autoconf 2.69.  Invocation command line was\n\n  $ ./configure --with-compiler=ghc --prefix=/Users/samuel/.cabal --with-gcc=/usr/local/bin/gcc\n\n## --------- ##\n## Platform. ##\n## --------- ##\n\nhostname = jackel.lan\nuname -m = x86_64\nuname -r = 14.5.0\nuname -s = Darwin\nuname -v = Darwin Kernel Version 14.5.0: Tue Sep  1 21:23:09 PDT 2015; root:xnu-2782.50.1~1/RELEASE_X86_64\n\n/usr/bin/uname -p = i386\n/bin/uname -X     = unknown\n\n/bin/arch              = unknown\n/usr/bin/arch -k       = unknown\n/usr/convex/getsysinfo = unknown\n/usr/bin/hostinfo      = Mach kernel version:\n     Darwin Kernel Version 14.5.0: Tue Sep  1 21:23:09 PDT 2015; root:xnu-2782.50.1~1/RELEASE_X86_64\nKernel configured for up to 4 processors.\n2 processors are physically available.\n4 processors are logically available.\nProcessor type: x86_64h (Intel x86-64h Haswell)\nProcessors active: 0 1 2 3\nPrimary memory available: 8.00 gigabytes\nDefault processor set: 224 tasks, 1045 threads, 4 processors\nLoad average: 1.80, Mach factor: 2.18\n/bin/machine           = unknown\n/usr/bin/oslevel       = unknown\n/bin/universe          = unknown\n\nPATH: /Users/samuel/.rvm/gems/ruby-2.1.1/bin\nPATH: /Users/samuel/.rvm/gems/ruby-2.1.1@global/bin\nPATH: /Users/samuel/.rvm/rubies/ruby-2.1.1/bin\nPATH: /usr/local/bin\nPATH: /usr/bin\nPATH: /bin\nPATH: /usr/sbin\nPATH: /sbin\nPATH: /usr/local/bin\nPATH: /usr/bin\nPATH: /bin\nPATH: /usr/sbin\nPATH: /sbin\nPATH: /opt/X11/bin\nPATH: /usr/texbin\nPATH: /Users/samuel/.rvm/bin\nPATH: /Users/samuel/scripts\n\n\n## ----------- ##\n## Core tests. ##\n## ----------- ##\n\nconfigure:2256: checking for gcc\nconfigure:2272: found /usr/local/bin/gcc\nconfigure:2283: result: gcc\nconfigure:2512: checking for C compiler version\nconfigure:2521: gcc --version &gt;&amp;5\ngcc (GCC) 4.9.0 20140309 (experimental)\nCopyright (C) 2014 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\ngcc: warning: couldn't understand kern.osversion '14.5.0\nconfigure:2532: $? = 0\nconfigure:2521: gcc -v &gt;&amp;5\ngcc: warning: couldn't understand kern.osversion '14.5.0\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/local/libexec/gcc/x86_64-apple-darwin13.1.0/4.9.0/lto-wrapper\nTarget: x86_64-apple-darwin13.1.0\nConfigured with: ../gcc-4.9-20140309/configure --enable-languages=fortran,c++\nThread model: posix\ngcc version 4.9.0 20140309 (experimental) (GCC) \nconfigure:2532: $? = 0\nconfigure:2521: gcc -V &gt;&amp;5\ngcc: warning: couldn't understand kern.osversion '14.5.0\ngcc: error: unrecognized command line option '-V'\ngcc: fatal error: no input files\ncompilation terminated.\nconfigure:2532: $? = 1\nconfigure:2521: gcc -qversion &gt;&amp;5\ngcc: warning: couldn't understand kern.osversion '14.5.0\ngcc: error: unrecognized command line option '-qversion'\ngcc: fatal error: no input files\ncompilation terminated.\nconfigure:2532: $? = 1\nconfigure:2552: checking whether the C compiler works\nconfigure:2574: gcc    conftest.c  &gt;&amp;5\ngcc: warning: couldn't understand kern.osversion '14.5.0\nld: library not found for -lgcc_ext.10.4\ncollect2: error: ld returned 1 exit status\nconfigure:2578: $? = 1\nconfigure:2616: result: no\nconfigure: failed program was:\n| /* confdefs.h */\n| #define PACKAGE_NAME \"Haskell old-time package\"\n| #define PACKAGE_TARNAME \"old-time\"\n| #define PACKAGE_VERSION \"1.0\"\n| #define PACKAGE_STRING \"Haskell old-time package 1.0\"\n| #define PACKAGE_BUGREPORT \"libraries@haskell.org\"\n| #define PACKAGE_URL \"\"\n| /* end confdefs.h.  */\n| \n| int\n| main ()\n| {\n| \n|   ;\n|   return 0;\n| }\nconfigure:2621: error: in `/Users/samuel/old-time-1.1.0.3':\nconfigure:2623: error: C compiler cannot create executables\nSee `config.log' for more details\n\n## ---------------- ##\n## Cache variables. ##\n## ---------------- ##\n\nac_cv_env_CC_set=\nac_cv_env_CC_value=\nac_cv_env_CFLAGS_set=set\nac_cv_env_CFLAGS_value=\nac_cv_env_CPPFLAGS_set=\nac_cv_env_CPPFLAGS_value=\nac_cv_env_CPP_set=\nac_cv_env_CPP_value=\nac_cv_env_LDFLAGS_set=\nac_cv_env_LDFLAGS_value=\nac_cv_env_LIBS_set=\nac_cv_env_LIBS_value=\nac_cv_env_build_alias_set=\nac_cv_env_build_alias_value=\nac_cv_env_host_alias_set=\nac_cv_env_host_alias_value=\nac_cv_env_target_alias_set=\nac_cv_env_target_alias_value=\nac_cv_prog_ac_ct_CC=gcc\n\n## ----------------- ##\n## Output variables. ##\n## ----------------- ##\n\nCC='gcc'\nCFLAGS=''\nCPP=''\nCPPFLAGS=''\nDEFS=''\nECHO_C='\\c'\nECHO_N=''\nECHO_T=''\nEGREP=''\nEXEEXT=''\nGREP=''\nLDFLAGS=''\nLIBOBJS=''\nLIBS=''\nLTLIBOBJS=''\nOBJEXT=''\nPACKAGE_BUGREPORT='libraries@haskell.org'\nPACKAGE_NAME='Haskell old-time package'\nPACKAGE_STRING='Haskell old-time package 1.0'\nPACKAGE_TARNAME='old-time'\nPACKAGE_URL=''\nPACKAGE_VERSION='1.0'\nPATH_SEPARATOR=':'\nSHELL='/bin/sh'\nac_ct_CC='gcc'\nbindir='${exec_prefix}/bin'\nbuild_alias=''\ndatadir='${datarootdir}'\ndatarootdir='${prefix}/share'\ndocdir='${datarootdir}/doc/${PACKAGE_TARNAME}'\ndvidir='${docdir}'\nexec_prefix='NONE'\nhost_alias=''\nhtmldir='${docdir}'\nincludedir='${prefix}/include'\ninfodir='${datarootdir}/info'\nlibdir='${exec_prefix}/lib'\nlibexecdir='${exec_prefix}/libexec'\nlocaledir='${datarootdir}/locale'\nlocalstatedir='${prefix}/var'\nmandir='${datarootdir}/man'\noldincludedir='/usr/include'\npdfdir='${docdir}'\nprefix='/Users/samuel/.cabal'\nprogram_transform_name='s,x,x,'\npsdir='${docdir}'\nsbindir='${exec_prefix}/sbin'\nsharedstatedir='${prefix}/com'\nsysconfdir='${prefix}/etc'\ntarget_alias=''\n\n## ----------- ##\n## confdefs.h. ##\n## ----------- ##\n\n/* confdefs.h */\n#define PACKAGE_NAME \"Haskell old-time package\"\n#define PACKAGE_TARNAME \"old-time\"\n#define PACKAGE_VERSION \"1.0\"\n#define PACKAGE_STRING \"Haskell old-time package 1.0\"\n#define PACKAGE_BUGREPORT \"libraries@haskell.org\"\n#define PACKAGE_URL \"\"\n\nconfigure: exit 77\n</code></pre>\n\n<p>The output for <code>cabal install MissingH -v3</code> is too long to fit in the body of the question, but I posted it <a href=\"https://gist.github.com/samueljackson92/26c4f1d5a32a617267ea\" rel=\"nofollow\">here</a> </p>\n"}, {"tags": ["haskell", "parsec", "parser-combinators"], "comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1450447346, "post_id": 34356668, "comment_id": 56456130, "body": "You could write <a href=\"http://stackoverflow.com/a/12169088/235908\">your own choice operator</a>."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1450447973, "post_id": 34356668, "comment_id": 56456518, "body": "I don&#39;t think it is that easy. Just using <code>&lt;|&gt;</code> doesn&#39;t work as this is exactly what <code>choice</code> is doing. I would need to inspect Char by Char and eliminate impossible choices on each step. I asked because it seems to be a common problem. Strange if there weren&#39;t a standard solution."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1450448061, "post_id": 34356668, "comment_id": 56456581, "body": "Ah, it seems the difference and the cause of your problem is <code>try</code>."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1450449865, "post_id": 34356668, "comment_id": 56457732, "body": "Yes, it&#39;s doing the backtracking I mentioned in the initial post. It&#39;s needed for <code>choice</code> and also when going through the individual parsers with <code>&lt;|&gt;</code>. Without it the failed parsers will consume input."}], "answers": [{"comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1450456575, "post_id": 34358623, "comment_id": 56461940, "body": "Same version. And you are correct: this works. My example was bad. I edited the question, it&#39;s using different strings now. I don&#39;t know why the first example did work, maybe because all the strings were of the same length."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1450463582, "post_id": 34358623, "comment_id": 56465900, "body": "@sn&#248;reven added another section that may help."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1450712308, "post_id": 34358623, "comment_id": 56539830, "body": "Thank you very much for your detailed analysis of the problem. I filed a bug and referenced your answer here."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1450463564, "last_edit_date": 1450463564, "creation_date": 1450451532, "answer_id": 34358623, "question_id": 34356668, "link": "https://stackoverflow.com/questions/34356668/parsec-string-choice-parser-with-useful-error-messages/34358623#34358623", "title": "parsec: string choice parser with useful error messages", "body": "<h1>Old answer for old nonworking example</h1>\n\n<p>Which version of <code>parsec</code> do you have installed? 3.1.9 does this for me:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; :m + Text.Parsec Text.Parsec.String\nPrelude Text.Parsec Text.Parsec.String&gt; :set prompt Main&gt;\nMain&gt; let parser = choice (map (try . string) [\"foo\", \"fob\", \"bar\"]) :: GenParser Char st String\nMain&gt; runParser parser () \"Hey\" \"fo \"\nLeft \"Hey\" (line 1, column 1):\nunexpected \" \"\nexpecting \"foo\", \"fob\" or \"bar\"\nMain&gt; runParser parser () \"Hey\" \"fo\"\nLeft \"Hey\" (line 1, column 1):\nunexpected end of input\nexpecting \"foo\", \"fob\" or \"bar\"\n</code></pre>\n\n<p>The added <code>&lt;?&gt; error_message</code> doesn't change anything except that it changes that last line to <code>expecting expected one of ['foo', 'fob', 'bar']</code>.</p>\n\n<h1>How to extract more errors out of Parsec</h1>\n\n<p>So this is one of those cases where you shouldn't trust the error message to be exhaustive about the information that is available in the system. Let me give a funky <code>Show</code> instance for <code>Text.Parsec.Error:Message</code> (which is basically what it would be if it were <code>deriving (Show)</code>) so that you can see what's coming out of Parsec:</p>\n\n<pre><code>Main&gt; :m + Text.Parsec.Error\nMain&gt; instance Show Message where show m = ([\"SysUnExpect\", \"UnExpect\", \"Expect\", \"Message\"] !! fromEnum m) ++ ' ' : show (messageString m)\nMain&gt; case runParser parser () \"\" \"ta\" of Left pe -&gt; errorMessages pe\n[SysUnExpect \"\\\"t\\\"\",SysUnExpect \"\",SysUnExpect \"\",Expect \"\\\"head\\\"\",Expect \"\\\"tail\\\"\",Expect \"\\\"tales\\\"\"]\n</code></pre>\n\n<p>You can see that <strong>secretly</strong> <code>choice</code> is dumping all of its information into a bunch of parallel messages, and storing \"unexpected end-of-file\" as <code>SysUnExpect \"\"</code>. The <code>show</code> instance for <code>ParseError</code> apparently grabs the first <code>SysUnExpect</code> but all of the <code>Expect</code> messages and dumps them for you to see.</p>\n\n<p>The exact function which does this at present is <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/src/Text-Parsec-Error.html#showErrorMessages\" rel=\"nofollow\">Text.Parsec.Error:showErrorMessages</a>. The error messages are expected to be in order and are broken into 4 chunks based on the constructor; the <code>SysUnExpect</code> chunk is sent through a special display function which hides the text completely if there are bona-fide <code>UnExpect</code> elements or else shows only the first <code>SysUnExpect</code> message:</p>\n\n<pre><code>  showSysUnExpect | not (null unExpect) ||\n                    null sysUnExpect = \"\"\n                  | null firstMsg    = msgUnExpected ++ \" \" ++ msgEndOfInput\n                  | otherwise        = msgUnExpected ++ \" \" ++ firstMsg\n</code></pre>\n\n<p>It may be worth rewriting this or sending a bug upstream, as this is kinda weird behavior, and the data structures don't quite suit them. First, your problem in a nutshell is: it seems like each <code>Message</code> should have a <code>SourcePos</code>, not each ParseError. </p>\n\n<p>So, there is an earlier step, <code>mergeErrors</code>, which prefers ParseErrors with later <code>SourcePos</code>-es. This doesn't fire because messages don't have a <code>SourcePos</code>, which means that all of the errors from <code>choice</code> start at the beginning of the string rather than at the maximal point matched. You can see this for example in how this doesn't get stuck on parsing <code>\"tai\"</code>:</p>\n\n<pre><code>let parser = try (string \"head\") &lt;|&gt; choice (map (try . (string \"ta\" &gt;&gt;) . string) [\"il\", \"les\"]) :: GenParser Char st Strinh\n</code></pre>\n\n<p>Second, apart from that, probably we should bind together messages that go together (so the default message is <code>unexpected 't', expected \"heads\" | unexpected end-of-file, expected 'tails' | unexpected end-of-file, expected 'tales'</code> unless you override it with <code>&lt;?&gt;</code>). Third, probably the ParseError constructor should be exported; fourth, the enumerated type in <code>Message</code> is really ugly and might be better put into <code>ParseError {systemUnexpected :: [Message], userUnexpected :: [Message], expected :: [Message], other :: [Message]}</code> or something, even in its present incarnation. (For example, the current <code>Show</code> for <code>ParseError</code> will break subtly if the messages aren't in a certain order.)</p>\n\n<p>In the meantime I would recommend writing your own <code>show</code> variant for <code>ParseError</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1501520694, "last_edit_date": 1501520694, "creation_date": 1450490109, "answer_id": 34366452, "question_id": 34356668, "link": "https://stackoverflow.com/questions/34356668/parsec-string-choice-parser-with-useful-error-messages/34366452#34366452", "title": "parsec: string choice parser with useful error messages", "body": "<p>It's not hard to cook up a function which does this correctly. We'll just rip one character off at a time, using <code>Data.Map</code> to find the shared suffixes:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Applicative\nimport Data.Map hiding (empty)\nimport Text.Parsec hiding ((&lt;|&gt;))\nimport Text.Parsec.Char\n\n-- accept the empty string if that's a choice\npossiblyEmpty :: Stream s m Char =&gt; [String] -&gt; ParsecT s u m String\npossiblyEmpty ss | \"\" `elem` ss = pure \"\"\n                 | otherwise    = empty\n\nchooseFrom :: Stream s m Char =&gt; [String] -&gt; ParsecT s u m String\nchooseFrom ss\n     =  foldWithKey (\\h ts parser -&gt; liftA2 (:) (char h) (chooseFrom ts) &lt;|&gt; parser)\n                    empty\n                    (fromListWith (++) [(h, [t]) | h:t &lt;- ss])\n    &lt;|&gt; possiblyEmpty ss\n</code></pre>\n\n<p>We can verify in ghci that it succesfully matches <code>\"tail\"</code> and <code>\"tales\"</code>, and that it asks for <code>i</code> or <code>l</code> after a failed parse starting with <code>ta</code>:</p>\n\n<pre><code>*Main&gt; parse (chooseFrom [\"head\", \"tail\", \"tales\"]) \"\" \"tail\"\nRight \"tail\"\n*Main&gt; parse (chooseFrom [\"head\", \"tail\", \"tales\"]) \"\" \"tales\"\nRight \"tales\"\n*Main&gt; parse (chooseFrom [\"head\", \"tail\", \"tales\"]) \"\" \"tafoo\"\nLeft (line 1, column 3):\nunexpected \"f\"\nexpecting \"i\" or \"l\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1450795739, "post_id": 34401271, "comment_id": 56577928, "body": "Interesting, wasn&#39;t aware there is another parser library. Problem: your documentation links to non-existing tutorials (link on page links to itself). I&#39;m new to Haskell and would have liked to see some example usage (with type signatures and everything)."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 2, "creation_date": 1450800691, "post_id": 34401271, "comment_id": 56581238, "body": "@sn&#248;reven, there is menu at the bottom. Sorry, I will have to move it, since it&#39;s not very obvious. Here is the direct link: <a href=\"https://mrkkrp.github.io/megaparsec/tutorials.html\" rel=\"nofollow noreferrer\">mrkkrp.github.io/megaparsec/tutorials.html</a>."}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 2, "last_activity_date": 1450720024, "last_edit_date": 1450720024, "creation_date": 1450719023, "answer_id": 34401271, "question_id": 34356668, "link": "https://stackoverflow.com/questions/34356668/parsec-string-choice-parser-with-useful-error-messages/34401271#34401271", "title": "parsec: string choice parser with useful error messages", "body": "<p>Here's what I've got with Parsec:</p>\n\n<pre><code>\u03bb&gt; let parser = choice $ fmap (try . string) [\"head\", \"tail\", \"tales\"]\n\u03bb&gt; parseTest parser \"ta\"\nparse error at (line 1, column 1):\nunexpected \"t\"\nexpecting \"head\", \"tail\" or \"tales\"\n</code></pre>\n\n<p>If you care to try modern version of Parsec \u2014\n<a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow\">Megaparsec</a>, you will end\nup with:</p>\n\n<pre><code>\u03bb&gt; let parser = choice $ fmap (try . string) [\"head\", \"tail\", \"tales\"]\n\u03bb&gt; parseTest parser \"ta\"\n1:1:\nunexpected \"ta\" or 't'\nexpecting \"head\", \"tail\", or \"tales\"\n</code></pre>\n\n<p>What's going on here? First, when we parse ordered collection of characters,\nlike with <code>string</code>, we display incorrect input completely. This is much\nbetter in our opinion because:</p>\n\n<pre><code>\u03bb&gt; parseTest (string \"when\" &lt;* eof) \"well\"\n1:1:\nunexpected \"we\"\nexpecting \"when\"\n</code></pre>\n\n<p>We're pointing to beginning of the word and we show the whole thing that is\nnot correct (up to first mismatching character) and the whole thing we\nexpect. This is more readable in my opinion. Only parsers built on <code>tokens</code>\nwork this way (that is, when we're trying to match fixed string,\ncase-insensitive variant is available).</p>\n\n<p>Then, what about <code>unexpected \"ta\" or 't'</code>, why do we get <code>'t'</code> part? This is\nalso absolutely correct, because with your collection of alternatives, the\nfirst letter <code>'t'</code> can be also unexpected by itself because you have\nan alternative that doesn't start with <code>'t'</code>. Let's see another example:</p>\n\n<pre><code>\u03bb&gt; let parser = choice $ fmap (try . string) [\"tall\", \"tail\", \"tales\"]\n\u03bb&gt; parseTest parser \"ta\"\n1:1:\nunexpected \"ta\"\nexpecting \"tail\", \"tales\", or \"tall\"\n</code></pre>\n\n<p>Or how about:</p>\n\n<pre><code>\u03bb&gt; parseTest (try (string \"lexer\") &lt;|&gt; string \"lexical\") \"lex\"\n1:1:\nunexpected \"lex\"\nexpecting \"lexer\" or \"lexical\"\n</code></pre>\n\n<p>Parsec:</p>\n\n<pre><code>\u03bb&gt; parseTest (try (string \"lexer\") &lt;|&gt; string \"lexical\") \"lex\"\nparse error at (line 1, column 1):\nunexpected end of input\nexpecting \"lexical\"\n</code></pre>\n\n<p>Why take pains to make it work when it can \u201cjust work\u201d?</p>\n\n<p>There are many other great things about Megaparsec, if you're interested,\nyou can learn more about it\n<a href=\"https://github.com/mrkkrp/megaparsec\" rel=\"nofollow\">here</a>. It's hard to compete with\nParsec, but we have written our own tutorials and our docs are very good.</p>\n"}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 1, "accepted_answer_id": 34366452, "answer_count": 3, "score": 3, "last_activity_date": 1501520694, "creation_date": 1450444790, "last_edit_date": 1450456466, "question_id": 34356668, "link": "https://stackoverflow.com/questions/34356668/parsec-string-choice-parser-with-useful-error-messages", "title": "parsec: string choice parser with useful error messages", "body": "<p>Let's have following parser:</p>\n\n<pre><code>parser :: GenParser Char st String\nparser = choice (fmap (try . string) [\"head\", \"tail\", \"tales\"]\n                    &lt;?&gt; \"expected one of ['head', 'tail', 'tales']\")\n</code></pre>\n\n<p>When we parse the malformed input \"ta\" it will return the defined error but because of backtracking it will also talk about <code>unexpected \"t\"</code> at first position instead of <code>unexpected \" \"</code> at position 3.</p>\n\n<p>Is there an easy (or built-in) way of matching one of multiple expected strings that produces good error messages? I am talking about showing the correct position and in this case something like <code>expected \"tail\" or \"tales\"</code> instead of our hard-coded error message.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 1, "creation_date": 1450441512, "post_id": 34355635, "comment_id": 56452650, "body": "Are you sure this is the real code? Can&#39;t reproduce your problem."}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "reply_to_user": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 0, "creation_date": 1450441640, "post_id": 34355635, "comment_id": 56452726, "body": "Yes, I am watching a tutorial and I am using the same code. When he executes his code, it is working but I couldn&#39;t."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1450441747, "post_id": 34355635, "comment_id": 56452807, "body": "This is clearly not the code you&#39;re executing right now. There&#39;s several typos on this that would lead to a failure before it even got to the morePrime part. Actually copy&amp;paste the code you&#39;re writing instead of retyping it here."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450442201, "post_id": 34355635, "comment_id": 56453070, "body": "Are you typing this in <code>ghci</code> ? If yes, then you have to put <code>let</code> before <code>primeNumbers</code>. Like this: <code>let primeNumbers = [3,5,7,11]</code>. And similarly for <code>morePrimes</code>."}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450442424, "post_id": 34355635, "comment_id": 56453191, "body": "@Sibi OP would get a different error if he would typed in <code>primeNumbers = [3,5,7,11]</code> in the console itself"}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450442443, "post_id": 34355635, "comment_id": 56453206, "body": "Yes I am using ghci. I put let before them. But still I see  &quot;not in scope morePrime&quot; error."}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 0, "creation_date": 1450442478, "post_id": 34355635, "comment_id": 56453226, "body": "Show and tell us your <b>real</b> and <b>full</b> code and if it is saved in a file or what exactly you do."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450442703, "post_id": 34355635, "comment_id": 56453354, "body": "You are doing something else wrong then. This code works perfectly: <a href=\"https://ideone.com/xZBSgq\" rel=\"nofollow noreferrer\">ideone.com/xZBSgq</a>"}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450443028, "post_id": 34355635, "comment_id": 56453514, "body": "I shared my codes as an answer. Can you look it please?"}, {"owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "edited": false, "score": 0, "creation_date": 1450444512, "post_id": 34355635, "comment_id": 56454441, "body": "Just to confirm, when you do <code>:r</code> you&#39;re getting the message <code>Ok, modules loaded: Main.</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450455553, "post_id": 34355635, "comment_id": 56461305, "body": "In case it is not abundantly obvious, this code has no obvious error. If you would like help fixing your error, you must include the input/ouput on your console which causes this error <i>verbatim</i>. Otherwise, &quot;it isn&#39;t working&quot; doesn&#39;t help anyone fix your problem."}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450469572, "post_id": 34355635, "comment_id": 56468794, "body": "I solved my problem. Thanks to all !"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450486307, "post_id": 34355635, "comment_id": 56474692, "body": "@coderbst It is considered polite to write an answer detailing how to fix your problem if you discover what is wrong -- yes, even when it&#39;s your own question."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450441804, "post_id": 34355672, "comment_id": 56452840, "body": "Now I fixed it, but still not working"}, {"owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "reply_to_user": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450441982, "post_id": 34355672, "comment_id": 56452948, "body": "Silly question - are you running the code in ghci? if so, are you sure have you loaded it correctly? (with :load &lt;filename&gt;)"}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1450442169, "post_id": 34355672, "comment_id": 56453054, "body": ":l filename.hs :r  mainPrime  I used this codes."}], "tags": [], "owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "is_accepted": true, "score": 2, "last_activity_date": 1450580229, "last_edit_date": 1450580229, "creation_date": 1450441549, "answer_id": 34355672, "question_id": 34355635, "link": "https://stackoverflow.com/questions/34355635/i-cannot-execute-my-haskell-code/34355672#34355672", "title": "I cannot execute my Haskell code", "body": "<p>You have a couple of typos in your imports. I think you mean:</p>\n\n<pre><code>import Data.List\nimport System.IO\n\nprimeNumbers = [3,5,7,11]\nmorePrime = primeNumbers ++ [13,17,19]\n</code></pre>\n\n<p>i.e. <code>Data.list</code> should be <code>Data.List</code> and <code>Syste.IO</code> should be <code>System.IO</code>.</p>\n"}], "owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "closed_date": 1450567120, "accepted_answer_id": 34355672, "answer_count": 1, "score": -9, "last_activity_date": 1450580229, "creation_date": 1450441389, "last_edit_date": 1450444912, "question_id": 34355635, "link": "https://stackoverflow.com/questions/34355635/i-cannot-execute-my-haskell-code", "closed_reason": "Not suitable for this site", "title": "I cannot execute my Haskell code", "body": "<p>I want to execute my Haskell code but I have an error message that \"not in scope morePrime\"</p>\n\n<pre><code>import Data.List\nimport System.IO\nprimeNumbers = [3,5,7,11]\nmorePrime = primeNumbers ++ [13,17,19]\n</code></pre>\n\n<p>On console</p>\n\n<pre><code>Prelude&gt;:l deneme.hs\nMain&gt;:r\nMain&gt;morePrime\n</code></pre>\n\n<p>I am actually doing them.</p>\n\n<p><strong>Note:</strong> I am using 7.10.3 ghci</p>\n"}, {"tags": ["haskell", "casting", "monads", "higher-order-functions", "algebraic-data-types"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450433862, "post_id": 34352287, "comment_id": 56447992, "body": "It&#39;s not too clear what you are worrying about. You are saying you have a monad. Can you show the instance definition?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450455035, "post_id": 34352287, "comment_id": 56460987, "body": "&quot;It is my understanding that a is a rigid type variable, e.g. a type variable that will be coerced to some type by the compiler.&quot; I&#39;m not sure what this means, types are not coerced by the compiler to other types unless you ask for it explicitly. Or perhaps you mean something else by &quot;coerced&quot; and &quot;rigid&quot;. Rigidity and flexibility and concepts related to typechecking, but these concepts seem to completely unrelated to the question. It seems like you simply have a type error somewhere... you should include a minimum working example."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1450463951, "last_edit_date": 1450463951, "creation_date": 1450454024, "answer_id": 34359365, "question_id": 34352287, "link": "https://stackoverflow.com/questions/34352287/how-do-rigid-type-variables-work-in-the-context-of-monads/34359365#34359365", "title": "How do rigid type variables work in the context of Monads?", "body": "<blockquote>\n  <p>Say I have a Monad <code>data Concurrent a = Concurrent ((a -&gt; Action) -&gt; Action)</code> and a type <code>Action</code> which allows various possible <code>IO Actions</code>.</p>\n</blockquote>\n\n<p>I'm going to assume that you put \"IO Actions\" in backticks for no reason. I do not know if you have a solid model of what's going on in your head, but since Haskell is a pure language the meaning of <code>IO x</code> is \"a program which, when run, produces an <code>x</code>\" (in other words the Haskell solution to functional I/O is to engage in metaprogramming rather than other programming.) So it sounds like in practice <code>Action</code> is going to be something like a type synonym for <code>IO ()</code> or something.</p>\n\n<p>A Hoogle search for <code>(a -&gt; IO x) -&gt; IO x</code> reveals that this is the output type of <code>withMVar m</code> and related to the <code>fixIO</code> type too. In other words: your <code>Concurrent</code> is all about wrapping up some value of type <code>a</code> and holding it for later.</p>\n\n<p>We can see this most explicitly if we define <code>data C b a = C ((a -&gt; b) -&gt; b)</code> so that your <code>Concurrent</code> is actually just the special case <code>C Action</code>. The trick here is that this function type <code>forall b. (a -&gt; b) -&gt; b</code> is actually the Church encoding of the <code>Identity</code> monad <code>newtype Identity a = Identity {runIdentity :: a}</code>. In turn we can say the more general monad is:</p>\n\n<pre><code>instance Monad (C b) where\n    return x = C ($ x)\n    (C w_wx) &gt;&gt;= my_x = my_x (w_wx id)\n</code></pre>\n\n<p>So what you've written for <code>Concurrent</code> is essentially a special case of the identity monad. </p>\n\n<blockquote>\n  <p>so <code>:t stringToAction</code> fulfills the contract of (a -> Action) however :t stringToAction \"7\" has type <code>(String -&gt; Action) -&gt; String -&gt; Action</code></p>\n</blockquote>\n\n<p>False. <code>stringToAction \"7\"</code> has type <code>Action</code> as it results from a function of type <code>String -&gt; Action</code> applied to a value of type <code>String</code>.</p>\n\n<blockquote>\n  <p>Do I have to write a helper function of type <code>(a -&gt; Action) -&gt; a -&gt; Action</code></p>\n</blockquote>\n\n<p>What you wrote has a name, it is the function called <code>id</code> or more specifically its type specialization <code>($)</code>. Furthermore this type above does not have the type that you want to shove into your <code>data Concurrent a = Concurrent ((a -&gt; Action) -&gt; Action)</code> constructor. Instead you want something like <code>($ \"myString\") :: (String -&gt; Action) -&gt; Action</code> to embed that string into your identity monad.</p>\n\n<blockquote>\n  <p>how does Concurrent 7 know how to convert 7 to an Action? Do I have to interrogate the type of <code>a</code> in my <code>&gt;&gt;=</code> definition and branch? How would I even do that?</p>\n</blockquote>\n\n<p>It doesn't. Your <code>Concurrent</code> monad is actually just the <code>Identity</code> monad and the process of converting a value like <code>7</code> to an <code>Action</code> is done by the <code>Int -&gt; Action</code> function that you pass in to the argument. (For that matter, if you write <code>Concurrent 7</code> you will get a nasty error from GHC saying \"I didn't know that the type <code>(a -&gt; Action) -&gt; Action</code> is an element of the <code>Num</code> typeclass, what the heck is going on?!\"</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1450463951, "creation_date": 1450430842, "last_edit_date": 1450431382, "question_id": 34352287, "link": "https://stackoverflow.com/questions/34352287/how-do-rigid-type-variables-work-in-the-context-of-monads", "title": "How do rigid type variables work in the context of Monads?", "body": "<p>Say I have a Monad <code>data Concurrent a = Concurrent ((a -&gt; Action) -&gt; Action)</code> and a type <code>Action</code> which allows various possible <code>IO Actions</code>.</p>\n\n<p>Say I wanted to write a function <code>action :: Concurrent a -&gt; Action</code>, effectively writing a custom unwrap. A first step might be something like writing a function <code>action2 :: ((a -&gt; Action) -&gt; Action) -&gt; Action</code></p>\n\n<p>I have a handful of questions:\nIt is my understanding that <code>a</code> is a rigid type variable, e.g. a type variable that will be coerced to some type by the compiler.</p>\n\n<p>So that makes <code>((a -&gt; Action) -&gt; Action)</code> a function (lets call it f1), which accepts a function of type <code>(a -&gt; Action)</code>, and returns an Action, for <em>some arbitrary type a</em>, and <code>((a -&gt; Action) -&gt; Action) -&gt; Action</code>, a function that accepts the above function f1, runs it, and returns the result.</p>\n\n<p>Assuming the above is correct my questions really are:</p>\n\n<p>How does this make sense in the context of a Monad? Say I have a function: </p>\n\n<pre><code>stringToAction :: (String -&gt; Action)\nstringToAction [] = Stop\nstringToAction x = Atom $ putStr x\n</code></pre>\n\n<p>so <code>:t stringToAction</code> fulfills the contract of (a -> Action)\nhowever :t stringToAction \"7\" has type <code>(String -&gt; Action) -&gt; String -&gt; Action</code></p>\n\n<p>Do I have to write a helper function of type <code>(a -&gt; Action) -&gt; a -&gt; Action</code> (e.g.)</p>\n\n<pre><code>higherOrderStringToAction :: (String -&gt; Action) -&gt; String -&gt; Action\nhigherOrderStringToAction f x = f x\n</code></pre>\n\n<p>And then call that on the passed function (a -> Action) ?</p>\n\n<pre><code>stringToActionHelper = higherOrderStringToAction stringToAction\n</code></pre>\n\n<p>Do I have to write a different set of such helper functions for every possible type of <code>a</code> that I wish to handle?</p>\n\n<p>And then, even more worryingly, do I have to handle all of those in my Monad Instance definition? e.g</p>\n\n<p>how does <code>Concurrent 7</code> know how to convert 7 to an Action? Do I have to interrogate the type of <code>a</code> in my <code>&gt;&gt;=</code> definition and branch? How would I even do that?</p>\n\n<p>Or am I (and this honestly seems likely) completely missing the point here and/or straight up thinking of this wrong?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450429059, "post_id": 34351035, "comment_id": 56445156, "body": "Is there any particular reason that you&#39;re using brackets and semicolons? Haskell&#39;s syntax is designed so that you don&#39;t need them and the idiomatic style is to not use them."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450429495, "post_id": 34351035, "comment_id": 56445408, "body": "Have you looked at the <a href=\"https://hackage.haskell.org/package/split\" rel=\"nofollow noreferrer\">split</a> library?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450430543, "post_id": 34351035, "comment_id": 56446022, "body": "Oh i don&#39;t know when i delete the semicolons and the brackets, the code is not working"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450431878, "post_id": 34351035, "comment_id": 56446863, "body": "You need to use <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">indentation</a>."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 0, "creation_date": 1450436734, "post_id": 34351035, "comment_id": 56449812, "body": "Maybe you should work through some introductory tutorials for Haskell? Haskell.org has a list of resources: <a href=\"https://www.haskell.org/documentation\" rel=\"nofollow noreferrer\">haskell.org/documentation</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450451515, "post_id": 34351035, "comment_id": 56458692, "body": "I know i am studying but i couldn&#39;t find the helper in any tutorial for this problem :/"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1450474206, "post_id": 34351035, "comment_id": 56470930, "body": "Programming is about finding solutions to problems using the tools that you have available. You shouldn&#39;t expect to find a tutorial for every problem. An introductory tutorial would teach you about the basic problem-solving tools and also about fundamental concepts\u2014like the syntax of the language\u2014which are requirements for progressing further in your studies."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450451415, "post_id": 34351930, "comment_id": 56458624, "body": "But what if the string is a paragraph? How will haskell get the correct answer in that case? Let&#39;s say between two empty lines there is a long paragraph in the file we are reading. What we should do in that case?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450456062, "post_id": 34351930, "comment_id": 56461645, "body": "The result according to this algorithm will be a list of lists of Strings, where each list in this list is a list of lines, i.e., a paragraph."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450469750, "post_id": 34351930, "comment_id": 56468896, "body": "as user2407038 explained - this algorithm returns a list of strings where each list element is just a paragraph, with empty lines stripped out, also if you look closely at my tmux config there are 2 empty lines in it!"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1450612624, "last_edit_date": 1450612624, "creation_date": 1450429471, "answer_id": 34351930, "question_id": 34351035, "link": "https://stackoverflow.com/questions/34351035/getting-text-between-two-empty-lines-in-haskell/34351930#34351930", "title": "Getting text between two empty lines in haskell", "body": "<p>The easiest way is to use the functions <code>lines</code>, <code>groupBy</code> and <code>filter</code></p>\n\n<ul>\n<li><code>lines</code> is used to split a <code>String</code> in a list of Strings (one line for each element)</li>\n<li><code>groupBy</code> groups then all lines that are non-empty - this should be the most difficult part you have to write a predicate that is true for two succeeding elements if they are non-empty: <code>groupBy (\\x y -&gt; ???)</code></li>\n<li>then <code>filter</code> out the elements of shape <code>[\"\"]</code></li>\n</ul>\n\n<p>here some example usage in ghci</p>\n\n<pre><code>\u03bb &gt; import Data.List\n\u03bb &gt; let groupify = ???\n\u03bb\u00a0&gt; l &lt;- readFile \"~/tmux.conf\"\n\u03bb &gt; map length $ groupify l\n[4,7,3,1,4,2,2,5,4,3,3,2,7,4,4,4,3,3,3,2]\n</code></pre>\n\n<p>you can check with the contents of my tmux config file at my <a href=\"https://github.com/epsilonhalbe/dotfiles/blob/master/_tmux.conf\" rel=\"nofollow\">github-repo</a></p>\n\n<h2>UPDATE</h2>\n\n<p>the solution for this problem would be </p>\n\n<blockquote class=\"spoiler\">\n  <p>    <code>groupify = filter (/= [\"\"]) . groupBy (\\x y -&gt; x /= \"\" &amp;&amp; y /= \"\") . lines</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": true, "score": 0, "last_activity_date": 1450471425, "creation_date": 1450471425, "answer_id": 34363665, "question_id": 34351035, "link": "https://stackoverflow.com/questions/34351035/getting-text-between-two-empty-lines-in-haskell/34363665#34363665", "title": "Getting text between two empty lines in haskell", "body": "<p>You can try pattern-matching, it literally says what it does:</p>\n\n<pre><code>betweenEmptyLines :: [String] -&gt; [String]\nbetweenEmptyLines [] = []\nbetweenEmptyLines (\"\":line:\"\":rest) = line:(betweenEmptyLines $ \"\":rest)\nbetweenEmptyLines (line:rest) = betweenEmptyLines rest\n</code></pre>\n\n<p>How it works:</p>\n\n<pre><code>&gt; betweenEmptyLines [\"foo\", \"\", \"the bar\", \"\", \"and\", \"also\", \"\", \"the baz\", \"\", \"but\", \"not\", \"rest\"]\n[\"the bar\",\"the baz\"]\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 1, "accepted_answer_id": 34363665, "answer_count": 2, "score": -2, "last_activity_date": 1450612624, "creation_date": 1450426021, "last_edit_date": 1495540749, "question_id": 34351035, "link": "https://stackoverflow.com/questions/34351035/getting-text-between-two-empty-lines-in-haskell", "title": "Getting text between two empty lines in haskell", "body": "<p>Hey i am back with another haskell question. I asked a question in <a href=\"https://stackoverflow.com/questions/34345442/empty-space-work-around-in-haskell/34345720#34345720\">here</a> and now i can get the empty lines perfectly, now i want to try to get the text between two specific empty lines in haskell.(For example i will get the text between the beginning and first empty line.) I can't think of any ways to do that in haskell because i can't understand the syntax and use it efficiently so i really need your help. My practice about doing some io stuff is like following;`</p>\n\n<pre><code>main=do{\nreadFile \"/tmp/foo.txt\" &gt;&gt;= print . length . filter (== '?');\nreadFile \"/tmp/foo.txt\" &gt;&gt;= print . length . words;\nreadFile \"/tmp/foo.txt\" &gt;&gt;= print . length . filter (== '.');\nreadFile \"/tmp/foo.txt\" &gt;&gt;= print . length . filter null . lines;\n}`\n</code></pre>\n\n<p>With this, i can count the number of sentences, number of question marks, number of empty lines and so on. Now i want to get the text between two empty lines. I would be very pleased if you help me with this last exercise of mine that i couldn't solve. Thanks from now! </p>\n"}, {"tags": ["haskell", "module", "libraries"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1450421916, "post_id": 34349853, "comment_id": 56441694, "body": "This may help you: <a href=\"https://stackoverflow.com/questions/18304714/seeing-typeclass-definition-in-ghci-for-a-specific-type\" title=\"seeing typeclass definition in ghci for a specific type\">stackoverflow.com/questions/18304714/&hellip;</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1450425313, "post_id": 34349853, "comment_id": 56443256, "body": "I&#39;m closing the question as duplicate then. Comment here if you have any objections or if something in that answer isn&#39;t clear."}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1450425334, "answer_count": 0, "score": 0, "last_activity_date": 1450420971, "creation_date": 1450420971, "question_id": 34349853, "link": "https://stackoverflow.com/questions/34349853/where-does-haskell-keep-its-libraries", "closed_reason": "Duplicate", "title": "Where does Haskell keep its libraries?", "body": "<p>Let's say I start off with</p>\n\n<pre><code>import Network \nimport qualified Data.ByteString.Lazy as B\nimport Data.Binary\n</code></pre>\n\n<p>I'm using GHC (version 7.6.3), and haven't strayed much from the default configuration.  Where can I find the function definitions for these three modules?  (I don't want to make a habit of consulting Hoogle when the code is on my computer)</p>\n"}, {"tags": ["haskell", "types", "import", "module"], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 8, "last_activity_date": 1450418192, "creation_date": 1450418192, "answer_id": 34349314, "question_id": 34349072, "link": "https://stackoverflow.com/questions/34349072/importing-a-data-type-in-haskell/34349314#34349314", "title": "Importing a data type in Haskell", "body": "<p>You have to import/export class and constructors:</p>\n\n<p>In your case, <code>PlaceHolder</code> is the class, and <code>Foo</code> and <code>Bar</code> are the constructors.</p>\n\n<p>Therefore, you should write:</p>\n\n<pre><code>-- datatype.hs\nmodule DataType (PlaceHolder (Foo, Bar, Baz)) where\n\n-- execution.hs\nimport DataType (PlaceHolder (Foo, Bar, Baz))\n</code></pre>\n\n<p>Or simpler:</p>\n\n<pre><code>-- datatype.hs\nmodule DataType (PlaceHolder (..)) where\n\n-- execution.hs\nimport DataType (PlaceHolder (..))\n</code></pre>\n\n<p>If you don\u2019t specify what you export:</p>\n\n<pre><code>-- datatype.hs\nmodule DataType where\n</code></pre>\n\n<p>Everything will be exported (classes, constructors, functions\u2026).</p>\n\n<p>If you don\u2019t specify what you import</p>\n\n<pre><code>-- execution.hs\nimport DataType\n</code></pre>\n\n<p>everything that <code>DataType</code> exports will be available.</p>\n\n<p>It\u2019s generally a good practice to specify imports and exports.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2452, "favorite_count": 1, "accepted_answer_id": 34349314, "answer_count": 1, "score": 2, "last_activity_date": 1450418192, "creation_date": 1450416652, "question_id": 34349072, "link": "https://stackoverflow.com/questions/34349072/importing-a-data-type-in-haskell", "title": "Importing a data type in Haskell", "body": "<p>I'm trying to import a data type from one file to another.</p>\n\n<p>Here's the module:</p>\n\n<pre><code>-- datatype.hs\nmodule DataType (Placeholder) where\n\ndata Placeholder a = Foo a | Bar | Baz deriving (Show)\n</code></pre>\n\n<p>Here's the file consuming the module</p>\n\n<pre><code>-- execution.hs\nimport DataType (Placeholder)\n\nmain = do\n    print Bar\n</code></pre>\n\n<p>When I run <code>runhaskell execution.hs</code> I get</p>\n\n<pre><code>execution.hs:4:10: Not in scope: data constructor \u2018Bar\u2019\n</code></pre>\n\n<p>There may be multiple problems with my code, so what is the best way to structure this so that I'm importing a specific data type from a module and able to view it?</p>\n"}, {"tags": ["list", "haskell", "interpreter"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1450395144, "post_id": 34346105, "comment_id": 56434059, "body": "You can use <code>List [Datum]</code> for homogeneous lists, even if it could in principle hold heterogeneous ones as well. If you instead want to <i>statically</i> guarantee that such list is homogeneous, you&#39;ll probably need GADTs and possibly existential types. If you are new to Haskell, perhaps it&#39;s better to finish your interpreter in the simpler no-static-guarantees way, first. If you feel adventurous, then you can try moving to fancier types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450395258, "post_id": 34346105, "comment_id": 56434097, "body": "Indeed, your current framework doesn&#39;t give you any opportunities to encode any type guarantees. If you add a <code>Function</code> constructor, you won&#39;t be able to make sure functions are applied to the right types either."}, {"owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450396003, "post_id": 34346105, "comment_id": 56434338, "body": "@chi I do want to provide static type guarantees, ideally without having to resort to language extensions. Is it possible at all?"}, {"owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450396013, "post_id": 34346105, "comment_id": 56434344, "body": "@dfeuer - why do you say that? So far, without lists, I have a system to provide static type guarantees. I can statically determine the possible return types of a function and the types each argument could be."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450396098, "post_id": 34346105, "comment_id": 56434368, "body": "@drowdemon, I don&#39;t understand. If you have a function <code>Int -&gt; Bool</code> and you have a <code>Datum</code> you want to apply it to, you will blow up if the <code>Datum</code> isn&#39;t a <code>DatInt</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450396169, "post_id": 34346105, "comment_id": 56434397, "body": "If you want to avoid language extensions, you can look into &quot;final encodings&quot;, which Oleg Kiselyov has <a href=\"http://okmij.org/ftp/tagless-final/course/\" rel=\"nofollow noreferrer\">written about extensively</a>. I&#39;ll warn you that they tend to be a bit mind-bending."}, {"owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450396228, "post_id": 34346105, "comment_id": 56434418, "body": "@dfeuer But I can determine whether the <code>Datum</code> is a <code>DatInt</code> statically at compile time, rather than having to run code, determine the type of the argument, and then error."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1450396425, "post_id": 34346105, "comment_id": 56434472, "body": "Ah, so these are the types of <i>expressions</i> in your language, which you wish to <i>typecheck</i> and then <i>compile</i>? That is reasonable. But in that case, you should surely follow @chi&#39;s advice and allow this datatype to represent ill-typed code, and (optionally) create a different, fancy, datatype to represent type-checked code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450396643, "post_id": 34346105, "comment_id": 56434550, "body": "If you want to avoid a fancy datatype, you can still mark things up, annotating the expression tree with type tags. So you&#39;d have something like <code>List Tag [Datum]</code>, which holds the <code>Datum</code> values along with a tag indicating what type each of them is <i>supposed</i> to have."}, {"owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450397705, "post_id": 34346105, "comment_id": 56434854, "body": "@dfeuer Thanks! Tagging them like that is probably what I&#39;ll do. I&#39;d accept that as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450400442, "post_id": 34346866, "comment_id": 56435622, "body": "To make this properly extensible, I think there needs to be two functions <code>checkType :: Type -&gt; Expr -&gt; Maybe ()</code> and <code>inferType :: Expr -&gt; Maybe Type</code>, so that <code>inferType (ListLit tag els) = mapM_ (checkType tag) els &gt;&gt; return (ListTag tag)</code> and <code>checkType (ListTag t) (ListLit t&#39; els) = guard (t == t&#39;) &gt;&gt; mapM_ (checkType t) els; checkType _ ListLit{} = Nothing</code>"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1450399491, "creation_date": 1450399491, "answer_id": 34346866, "question_id": 34346105, "link": "https://stackoverflow.com/questions/34346105/implementing-a-language-in-haskell-homogenous-lists/34346866#34346866", "title": "Implementing a language in Haskell: homogenous lists", "body": "<p>One useful notion (whether you're going for sexy types or not) is that of a type tag. The non-sexy version is a lot easier to deal with.</p>\n\n<pre><code>data Tag = IntTag\n         | DoubleTag\n         | BoolTag\n         | ListTag Tag\n   deriving (Eq, Show)\n</code></pre>\n\n<p>Now your types are represented by these various tags. An <code>Int</code> is represented by <code>IntTag</code>. A list of <code>Int</code> is represented by <code>ListTag IntTag</code>.</p>\n\n<p>Now you can represent type-annotated expressions something like this:</p>\n\n<pre><code>data Expr = IntLit Int\n          | DoubleLit Double\n          | BoolLit Bool\n          | ListLit Tag [Expr]\n\n-- Check that an expression is validly annotated\ntypeCheck :: Expr -&gt; Maybe Tag\ntypeCheck IntLit{} = Just IntTag\n...\ntypeCheck (ListLit tag els)\n  | all good els = Just (ListTag tag)\n  | otherwise = Nothing\n  where\n    good el = case typeCheck el of\n                Nothing -&gt; False\n                Just res = res == tag\n</code></pre>\n"}], "owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 34346866, "answer_count": 1, "score": 5, "last_activity_date": 1450399491, "creation_date": 1450394387, "question_id": 34346105, "link": "https://stackoverflow.com/questions/34346105/implementing-a-language-in-haskell-homogenous-lists", "title": "Implementing a language in Haskell: homogenous lists", "body": "<p>I'm trying to create an interpreter for a functional language in haskell (I'm new to the language). I'm creating what's probably a weird mix of minimalism and convenience - no abstract data types, but I want to provide the ability to make homogeneous lists. </p>\n\n<p>So my basic variables  are <code>data Datum = DatInt Int | DatDbl Double | DatBool Bool</code> and I've realized I'm not at all sure how to represent homogeneous lists. Adding a constructor <code>List Datum</code> or something of the sort would make a heterogeneous list, and making a separate list for each type, i.e. <code>ListInt [Int] | ListDbl [Double]</code> would preclude lists of lists. </p>\n\n<p>What would be the best way to go about representing a homogeneous list?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450392895, "post_id": 34345590, "comment_id": 56433228, "body": "you just need an immutable array, right? You can use Data.Array if you think the interface is easier, but I&#39;m not sure why <code>import qualified Data.Vector as V ; V.fromList myListOfFirst9k </code> wouldn&#39;t work for you"}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450393879, "post_id": 34345590, "comment_id": 56433606, "body": "Data.Sequence would probably be enough for me too. <code>V.fromList</code> appeared after the <code>import qualified Data.Vector.Unboxed as V</code> changed to <code>import qualifed Data.Vector.Unboxed.Mutable as V</code>, while the code still happened to use <code>V.fromList [1, 2, 3]</code> syntax."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450392353, "post_id": 34345683, "comment_id": 56432988, "body": "Do you mean <code>drop 1500 notfib</code> and <code>drop 9000 notfib</code>?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450392372, "post_id": 34345683, "comment_id": 56432995, "body": "@Andr&#225;sKov&#225;cs, no, I don&#39;t.  We want to refer to the values 9000 elements ago, not the elements 9000 elements forward."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "edited": false, "score": 0, "creation_date": 1450393643, "post_id": 34345683, "comment_id": 56433514, "body": "It&#39;s a PRNG actually. So holding a reference would be unfortunate, since the memory would grow while really old values are no longer being used."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1450393715, "post_id": 34345683, "comment_id": 56433537, "body": "Right.  As far as PRNGs go, this should be manageable, especially if you use a monad to encapsulate the randomness."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "edited": false, "score": 0, "creation_date": 1450394075, "post_id": 34345683, "comment_id": 56433666, "body": "@ulidtko I&#39;d probably just implement it as a typical state monad <code>newtype Random a = Random ([Int] -&gt; ([Int], a))</code>, the monad instance being the usual state monad, and then <code>getRandom :: Random Int</code> <code>getRandom = Random (\\ (r:rs) -&gt; (rs, r))</code>"}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": false, "score": 4, "last_activity_date": 1450392787, "last_edit_date": 1450392787, "creation_date": 1450392182, "answer_id": 34345683, "question_id": 34345590, "link": "https://stackoverflow.com/questions/34345590/computing-a-recurrence-relation-stream-with-several-kib-worth-of-look-back-in/34345683#34345683", "title": "Computing a recurrence relation &quot;stream&quot; with several KiB worth of look-back in Haskell?", "body": "<pre><code>notfib :: [Int]\nnotfib = {- first 9000 values -} ++ zipWith (\\a b -&gt; a - b `xor` 75) (drop (9000 - 1500) notfib) notfib\n</code></pre>\n\n<p>is the usual trick for this.</p>\n\n<p>That said, you probably don't want to hold on to a reference to <code>notfib</code> itself, as that will grow as large as the furthest value you've computed.  How to work around that depends on what you want to do with the sequence.</p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 3, "last_activity_date": 1450394088, "creation_date": 1450394088, "answer_id": 34346041, "question_id": 34345590, "link": "https://stackoverflow.com/questions/34345590/computing-a-recurrence-relation-stream-with-several-kib-worth-of-look-back-in/34346041#34346041", "title": "Computing a recurrence relation &quot;stream&quot; with several KiB worth of look-back in Haskell?", "body": "<p>Why care about operational semantics of your function? Just write it focusing on the denotational semantics, and let the magic of Haskell worry about performance:</p>\n\n<pre><code>notfibgo _notfib (i :: Integer)\n  | i &gt; 9000  = _notfib (i - 1500) - _notfib (i - 9000) `xor` 75\n  | otherwise = i \n</code></pre>\n\n<p>Note this function is almost exactly the same as your original, just written in open recursion style (the recursive call is replaced by a function which is simply given as a parameter to the function). Now we define two versions of your algorithm:</p>\n\n<pre><code>import Data.Function.Memoize (memoize)\n\nslow_notfib = let r = notfib_go r in r \nfast_notfib = let r = memoize (notfib_go r) in r \n</code></pre>\n\n<p>Perhaps neither version is obvious, in which case, for an excellent, detailed discussion of this topic, see <a href=\"http://conal.net/blog/posts/elegant-memoization-with-functional-memo-tries\" rel=\"nofollow\">here</a>. </p>\n\n<p>Finally, a simple function for testing:</p>\n\n<pre><code>main = do \n n:m:_ &lt;- getArgs \n let f = [slow_notfib,fast_notfib]!!read n \n print $ f (read m)\n</code></pre>\n\n<p>And some trial results:</p>\n\n<pre><code>Yuriy@Yuriy-PC ~/haskell\n$ time ./test.exe 0 110000\n698695701\n\nreal    0m3.111s\nuser    0m0.000s\nsys     0m0.000s\n\nYuriy@Yuriy-PC ~/haskell\n$ time ./test.exe 1 110000\n698695701\n\nreal    0m0.017s\nuser    0m0.000s\nsys     0m0.000s\n</code></pre>\n\n<p>More than 100x improvement for even moderately small values! </p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1450404974, "creation_date": 1450404974, "answer_id": 34347550, "question_id": 34345590, "link": "https://stackoverflow.com/questions/34345590/computing-a-recurrence-relation-stream-with-several-kib-worth-of-look-back-in/34347550#34347550", "title": "Computing a recurrence relation &quot;stream&quot; with several KiB worth of look-back in Haskell?", "body": "<p>Let's generalize.</p>\n\n<p>For some sequence <code>{ a_i | i &gt;= 0 }</code>, let's say we have <code>k</code> base cases <code>a_0 ... a_{k-1}</code> and a <code>k</code>-nary recurrence relation <code>f</code>  for all <code>a_n</code>, <code>n &gt;= k</code>:</p>\n\n<pre><code>a_n = f(a_{n-k}, a_{n-k+1}, ..., a_{n-2}, a_{n-1})\n</code></pre>\n\n<p>In haskell, we could write this sequence as a <em>corecursive</em> infinite list:</p>\n\n<pre><code>as = a_0 : \n     a_1 : \n     {- ... : -} \n     a_kMinus1 : \n     zipWithK f (drop 0 as) (drop 1 as) {- ... -} (drop (k-1) as)\n\nzipWithK f (a_nMinusK:as_nMinusK) {- ... -} (a_nMinus2:as_nMinus2) (a_nMinus1:as_nMinus1) = \n  f a_nMinusK {- ... -} a_nMinus2 a_nMinus1 : zipWithK f as_nMinusK as_nMinus2 {- ... -} as_nMinus1\nzipWithK f _ _ {- ... -} _ = []\n</code></pre>\n\n<p>For example, we can trot out fibonacci</p>\n\n<pre><code>fibs = 1 :\n       1 :\n       zipWith2 (+) (drop 0 fibs) (drop 1 fibs)\n\nzipWith2 f (a_nMinus2:as_nMinus2) (a_nMinus1:as_nMinus1) =\n  f a_nMinus2 a_nMinus1 : zipWith2 f as_nMinus2 as_nMinus1\nzipWith2 f _ _ = []\n</code></pre>\n\n<p>The nice thing about infinite lists is that they let us calculate arbitrarily\nmany elements of the sequence. Defining them via zips is nice because it only\nincurring constant overhead per element of the the sequence, since we avoid\nlists' expensive (O(n)) random access.</p>\n\n<p>That said, ai iifiiite list is still a list aid while processiig the first <code>i</code> elemeits ii your sequeice may oily cost ai overhead of O(<code>i</code>),\nit's still got bad raidom access - so accessiig just the <code>i</code>th elemeit ii the sequeice also has ai overhead of O(<code>i</code>).</p>\n\n<p>If you want to inprove the asynptotics for randon access of the first <code>n</code>\nelenents, you can do that by putting those elenents in a Vector.  Then when you\nwant to randomly access the <code>i</code>th sequence element, compare <code>i</code> with <code>n</code> - if\n<code>i</code> is less than <code>n</code>, just look it up in the vector (which is O(1)), otherwise\nfall back to looking it up in the rest of the sequence, which is O(i - n).</p>\n\n<pre><code>  import Data.Vector ((!), Vector)\n  import qualified Data.Vector as V\n\n  vectorize n as = lookupV n bv cs\n    where (bs, cs) = splitAt n as\n          bv = V.fromList bs\n\n  lookupV n av _ i | i &lt; n = av ! i\n  lookupV n _ as i = as !! (i - n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1450413122, "creation_date": 1450413122, "answer_id": 34348577, "question_id": 34345590, "link": "https://stackoverflow.com/questions/34345590/computing-a-recurrence-relation-stream-with-several-kib-worth-of-look-back-in/34348577#34348577", "title": "Computing a recurrence relation &quot;stream&quot; with several KiB worth of look-back in Haskell?", "body": "<p>So you seem to want this stuff to be garbage-collected and you don't want to cache a huge list. What you probably might like is a set of spine-strict queues:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- strict lists, strict queues.\ndata SL x = Nil | Cons x !(SL x)\ndata SQ x = SQ !(SL x) !(SL x)\n\nsl_from_list :: [x] -&gt; SL x\nsl_from_list = foldr Cons Nil\n\nsl_reverse :: SL x -&gt; SL x\nsl_reverse x = go Nil x where\n    go acc Nil = acc\n    go acc (Cons x rest) = go (Cons x acc) rest\n\nenqueue :: x -&gt; SQ x -&gt; SQ x\nenqueue x (SQ front back) = SQ front (Cons x back)\n\ndequeue :: SQ x -&gt; (x, SQ x)\ndequeue (SQ Nil back) = case sl_reverse back of Cons x xs -&gt; (x, SQ xs Nil)\ndequeue (SQ (Cons x f') b) = (x, SQ f' b)\n</code></pre>\n\n<p>With these your random number generator looks much more compact:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyRandGen x = MRG !(SQ x) !(SQ x)\n\nnext_rand (MRG a b) = (cv, MRG a'' b'') where\n    (av, a') = dequeue a\n    (bv, b') = dequeue b\n    cv = bv - av `xor` 75\n    a'' = enqueue bv a'\n    b'' = enqueue cv b'\n</code></pre>\n\n<p>Note that this delivers \"amortized\" O(1) performance for generating a new random number: yes, sometimes it creates an expensive reallocation of 9000 new cells in memory, but that happens only on 1/9000 calls to the function. Crucial to this guarantee is that you're not trying and retrying to generate the same random number from the same <code>MRG</code> object, since it might be in the state of \"about to reallocate lots of data!\" and bad stuff may be about to therefore happen. You can remove this \"worst case\" performance if you make these things non-strict: it turns out, as pointed out by Okasaki and others, that laziness is both necessary and sufficient to convert these amortized operations into persistent constant-time structures (you essentially do some of the above work of the reverse inside of a thunk).</p>\n\n<p>As for thinking clearly about what's going on: basically we have a \"three-fingered list.\" A <em>finger</em> into a list is when you store <code>([x], [x])</code> with the semantics that you can navigate in two different directions: <code>forwards (xs, y:ys) = (y:xs, ys)</code> or <code>backwards (x:xs, ys) = (xs, x:ys)</code>: in other words the two lists are joined at their \"heads\", with the <code>[]</code> of the first list being thought of as the very start of the overall list and the <code>[]</code> of the second list being thought of as the very end of the overall list.</p>\n\n<p>Here we have a finger into the beginning of the list (9000 elements in the past, no \"front\" list), a finger into the middle of the list (1500 elements in the past), and a finger into the end of the list (0 elements in the past, no \"back\" list). Because we know this queue structure we know how to efficiently connect the front of the middle-finger into the end of the beginning-finger (just reverse all of the elements into the other), if we didn't then we'd want to keep track of how many elements were in the different fingers and merely \"share some\", so that we could efficiently support moving each finger either way; but since I knew that the fingers were only moving one way, I just optimized for that.</p>\n"}], "owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "answer_count": 4, "score": 0, "last_activity_date": 1450413122, "creation_date": 1450391747, "question_id": 34345590, "link": "https://stackoverflow.com/questions/34345590/computing-a-recurrence-relation-stream-with-several-kib-worth-of-look-back-in", "title": "Computing a recurrence relation &quot;stream&quot; with several KiB worth of look-back in Haskell?", "body": "<p>So let's say I want to compute a sequence, <code>notfib</code>, defined recursively over its last <strong>9000</strong> values like so:</p>\n\n<pre><code>notfib i | i &gt; 9000  = notfib (i - 1500) - notfib (i - 9000) `xor` 75\n         | otherwise = {- an IV -} ...\n</code></pre>\n\n<p>9000 is compile-time constant; but the principal requirement is to have a <strong>generator</strong>, something that can keep producing values until the world ends. In constant memory, of course.</p>\n\n<p>Since it's clear that I need to keep last 9000 elements in memory somehow, I attempted implementing a ring buffer (which seems like... an excellent data structure for the job) on top of a mutable array. Now my code is littered with qualified imports <strike>hiding prelude</strike>, clumsy record un/packing, commented out <code>STUArray</code>'s, and I gave up on failing scope checks (<code>Not in scope: V.fromList</code>) because of how much interfaces <code>Data.Vector</code> has.</p>\n\n<p>I haven't written single <code>do</code> yet, but the code already stinks!</p>\n\n<p>May some purity help me? How would you solve this?</p>\n"}, {"tags": ["file", "haskell", "io"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1450392360, "post_id": 34345442, "comment_id": 56432993, "body": "Instead of <code>filter (==&#39;\\n&#39;)</code>, try <code>filter null . lines</code>."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450424041, "post_id": 34345442, "comment_id": 56442648, "body": "That worked perfectly thanks :)"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450424115, "post_id": 34345720, "comment_id": 56442679, "body": "I know i am working on it.This declaration is much better for me too thanks for help :)"}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 2, "last_activity_date": 1450393308, "last_edit_date": 1450393308, "creation_date": 1450392395, "answer_id": 34345720, "question_id": 34345442, "link": "https://stackoverflow.com/questions/34345442/empty-space-work-around-in-haskell/34345720#34345720", "title": "empty space work-around in haskell", "body": "<p>If you're new to Haskell there is no good reason to write as code as compact as your example snippet. I would put it like this</p>\n\n<pre><code>ex1 = do\n  contents &lt;- readFile \"Test.hs\"\n  let noLines = length (filter (== '\\n') contents)\n  print noLines\n</code></pre>\n\n<p>Which makes it slightly easier to see what's happening.</p>\n\n<p>The next step is to explore the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html\" rel=\"nofollow\">Prelude</a>: there is a function called <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:lines\" rel=\"nofollow\"><code>lines</code></a> that will split a clump of text into lines. So let's split into lines and remove the empty ones:</p>\n\n<pre><code>ex2 = do\n  contents &lt;- readFile \"Test.hs\"\n  let nonempty = filter (/= \"\") (lines contents)\n  print (length nonempty)\n</code></pre>\n\n<p>Here <code>nonempty</code> is a list of lines (<code>:: [String]</code>) that you can do further processing on.</p>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 34345720, "answer_count": 1, "score": 0, "last_activity_date": 1450393308, "creation_date": 1450391149, "last_edit_date": 1450391621, "question_id": 34345442, "link": "https://stackoverflow.com/questions/34345442/empty-space-work-around-in-haskell", "title": "empty space work-around in haskell", "body": "<p>I've been making little baby programs with haskell about i/o and some other stuff and i came out something interesting. I wonder that in a file, can we process empty lines? For example can we count the number of empty lines or can we retrieve data between two empty lines? If so how can we implement such a code fragment? I am really new with haskell and it is getting me very hard to understand the syntax of the language so i really need some help to learn it. I tried like ;</p>\n\n<pre><code>readFile \"/tmp/foo.txt\" &gt;&gt;= print . length . filter (== '\\n');\n</code></pre>\n\n<p>But this just counts every single line as expected. How can i eliminate non-empty lines and do some process with the rest as i want to?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 5, "creation_date": 1450385785, "post_id": 34344006, "comment_id": 56429709, "body": "You should post your approach."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1450386332, "post_id": 34344006, "comment_id": 56429970, "body": "This is almost correct, you are just lacking the -&gt; after \\x"}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1450386349, "post_id": 34344006, "comment_id": 56429985, "body": "You have syntax errors in your code. The first lambda expression is missing a <code>-&gt;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 1, "last_activity_date": 1450385914, "creation_date": 1450385914, "answer_id": 34344118, "question_id": 34344006, "link": "https://stackoverflow.com/questions/34344006/map-and-filter-haskell/34344118#34344118", "title": "Map and Filter, Haskell", "body": "<p>Break the problem into small steps.</p>\n\n<p>Step 1. Count the number of 1s in a list. Make a function <code>count1s :: [Int] -&gt; Int</code> using <code>length</code> and <code>filter</code>.</p>\n\n<p>Step 2. Use <code>map</code> to apply <code>count1s</code> to each list in the outer list. </p>\n"}, {"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": false, "score": 3, "last_activity_date": 1450385981, "creation_date": 1450385981, "answer_id": 34344134, "question_id": 34344006, "link": "https://stackoverflow.com/questions/34344006/map-and-filter-haskell/34344134#34344134", "title": "Map and Filter, Haskell", "body": "<p>First get the filter function:</p>\n\n<pre><code> ((==) 1)\n</code></pre>\n\n<p>This will filter all other elements than 1 from a list:</p>\n\n<pre><code> filter ((==) 1)\n</code></pre>\n\n<p>Then combine it with the length function through function composition:</p>\n\n<pre><code> (length . filter ((==) 1))\n</code></pre>\n\n<p>Finally, map the array of lists with that function and you're done!</p>\n\n<pre><code> map (length . filter ((==) 1))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1450387610, "creation_date": 1450387610, "answer_id": 34344540, "question_id": 34344006, "link": "https://stackoverflow.com/questions/34344006/map-and-filter-haskell/34344540#34344540", "title": "Map and Filter, Haskell", "body": "<p>You wrote:</p>\n\n<pre><code>let ones = map(\\x length (filter (\\z -&gt; z == 1)x) )a\n</code></pre>\n\n<p>Very good attempt, and almost correct! Let's paste it into GHCi, it spouts back:</p>\n\n<pre><code>&lt;interactive&gt;:9:35: Parse error in pattern: \\ z -&gt; z == 1\n</code></pre>\n\n<p>So what does this mean? This means that it thinks it's looking at a <em>pattern</em> and that it's failed to <em>read</em> it (parsing its text). If we just look at that thing, it's not a pattern! Why does it think it's looking at a pattern?</p>\n\n<p>Because of the earlier <code>\\x</code> which was not followed by a <code>-&gt;</code>. In the arguments of a function literal, you're allowed to pattern-match! You can write <code>\\(y:_) x -&gt; y + x</code> and that will be the same as <code>(+) . head</code>, taking the head of one list and adding it to the second number provided.</p>\n\n<p>Inserting it we get:</p>\n\n<pre><code>let ones = map(\\x -&gt; length (filter (\\z -&gt; z == 1)x) )a\n</code></pre>\n\n<p>Which gives a further error: </p>\n\n<pre><code>&lt;interactive&gt;:10:55: Not in scope: \u2018a\u2019\n</code></pre>\n\n<p>This is because I forgot to explicitly define <code>a</code>, so it's easy to fix:</p>\n\n<pre><code>let ones a = map(\\x -&gt; length (filter (\\z -&gt; z == 1)x) )a\n</code></pre>\n\n<p>Compiles, and then:</p>\n\n<pre><code>Prelude&gt; ones [[1,2,1,2,1,1,1],[1,2],[3,4],[3,2]]\n[5,1,0,0]\n</code></pre>\n\n<p>as desired. But we're not done yet, let's simplify!</p>\n\n<p>First off there is <code>\\z -&gt; z == 1</code> which is easier written using <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow\">operator sections</a> as <code>(1 ==)</code>. I would recommend always putting in that space so that it looks a little extra \"incomplete\".</p>\n\n<p>Then <code>\\x -&gt; length (filter (1 ==) x)</code> is a little wordy too, we can instead use the <a href=\"https://wiki.haskell.org/Function_composition\" rel=\"nofollow\">function composition operator</a> <code>.</code> to write this as <code>length . filter (1 ==)</code>. If you get confused about <em>precedence</em> here, remember that parentheses always happen first, then functions, then operators... so this is <code>(.) length (filter (1 ==))</code> if you really wrote it out.</p>\n\n<p>Once you have that, give it a name and a type signature in a source file!</p>\n\n<pre><code>countOnes :: (Eq a, Num a) =&gt; [a] -&gt; Int\ncountOnes = length . filter (1 ==)\n</code></pre>\n\n<p>Then I would write <code>map countOnes</code> wherever you're actually using this code.</p>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1450387610, "creation_date": 1450385557, "last_edit_date": 1450386163, "question_id": 34344006, "link": "https://stackoverflow.com/questions/34344006/map-and-filter-haskell", "title": "Map and Filter, Haskell", "body": "<p>Hi I was wondering how to use the <code>map</code> and <code>filter</code> function in haskell to get the amount of a number in the list, That was confusing sorry here's an example.</p>\n\n<pre><code>let a = [[1,2,1,2,1,1,1],[1,2],[3,4],[3,2]]\n</code></pre>\n\n<p>And I want use <code>map</code> to find out how many <code>1s</code> are in each sub-list so the outcome would be</p>\n\n<pre><code>[5,1,0,0]\n</code></pre>\n\n<p>Any idea how to do it, I'm guessing its easy and im just missing something, cheers, my approach is</p>\n\n<pre><code>let ones = map(\\x length (filter (\\z -&gt; z == 1)x) )a\n</code></pre>\n\n<p>but this is getting errors</p>\n"}, {"tags": ["haskell", "parsec", "parser-combinators"], "answers": [{"comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1450433333, "post_id": 34346694, "comment_id": 56447698, "body": "Great answer, thank you very much! I replaced the implementation of <code>sepBy1Try</code> with <code>liftM2 (:) p (many (try $ sep *&gt; p))</code> to make the <code>do</code> go away."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1450398178, "creation_date": 1450398178, "answer_id": 34346694, "question_id": 34342911, "link": "https://stackoverflow.com/questions/34342911/parsec-parse-nested-code-blocks/34346694#34346694", "title": "parsec: parse nested code blocks", "body": "<p>One thing I have noticed is that the <code>sepBy</code> combinators have somewhat unexpected behaviour, namely, that if the separator is began to be parsed, and that fails, the entire <code>sepBy</code> fails, instead of simple returning what was parsed so far. You can use the following variants, which differ by an additional <code>try</code> inside of <code>sepBy1Try</code>: </p>\n\n<pre><code>sepBy1Try :: (Stream s m t) =&gt; ParsecT s u m a -&gt; ParsecT s u m sep -&gt; ParsecT s u m [a]\nsepBy1Try p sep = do\n  x &lt;- p\n  xs &lt;- many (try $ sep *&gt; p)\n  return (x:xs)\n\nsepByTry p sep = sepBy1Try p sep &lt;|&gt; return []\n</code></pre>\n\n<p>Use these in place of <code>sepBy</code>: </p>\n\n<pre><code>block :: GenParser Char st Block\nblock = parseBlock 0\n    where\n        parseBlock lvl = do\n            count lvl tab\n            string \"keyword\"\n\n            otherStuff &lt;- many (noneOf \"\\r\\n\") \n            newline\n\n            -- Parse 'function calls'.\n            fs &lt;- sepBy1Try (blockFunc (lvl + 1)) emptyLines\n\n            -- Parse optional child blocks.\n            emptyLines\n            bs &lt;- sepByTry (try $ parseBlock (lvl + 1)) emptyLines\n\n            return Block { blockFuncCalls=fs\n                         , blockBlocks=bs\n                         , blockValues=words otherStuff\n                         }\n</code></pre>\n\n<p>I also modified your datatype to also capture some more information (just for demonstration purposes). Also, note yet another <code>try</code> in front of the recursive <code>parseBlock</code> - this is because this parses must fail without consuming input, when it sees for example one tab, but is expecting two, this <code>try</code> allows it to backtrack to the \"next level\". </p>\n\n<p>Finally, change the following:</p>\n\n<pre><code>emptyLines :: GenParser Char st ()\nemptyLines = many (try emptyLine) &gt;&gt; return ()\n</code></pre>\n\n<p>Same reasoning as sepBy here...</p>\n\n<hr>\n\n<p>A test with a simple pretty printer for clarity:</p>\n\n<pre><code>data Block = Block { blockValues :: [String]\n                   , blockFuncCalls :: [String]\n                   , blockBlocks    :: [Block]\n                   } deriving (Show, Eq) \n\npprBlock :: Block -&gt; String \npprBlock = unlines . go id where \n  go ii (Block vals funcs subblocks) = \n    let ii' = ii . ('\\t':) in \n    (ii $ unwords $ \"keyword\":vals) : \n    map (\\f -&gt; ii' $ \"function \" ++ f) funcs ++ \n    concatMap (go ii') subblocks\n\ntest0_run = either (error.show) (putStrLn.pprBlock) $ parse block \"\" $ test0\n\ntest0 = unlines $ \n  [ \"keyword some more values\"\n  , \"\\tfuncKeyw funcName1\"\n  , \"\\tfuncKeyw funcName2\"\n  , \"\\t\"\n  , \"\\tfuncKeyw funcName3\"\n  , \"\\t\"\n  , \"\\tkeyword some more values\"\n  , \"\\t\\tfuncKeyw funcName2\"\n  , \"\"\n  , \"\\tkeyword some more values\"\n  , \"\\t\\tfuncKeyw funcName4\"\n  ]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt;test0_run\nkeyword some more values\n        function funcName1\n        function funcName2\n        function funcName3\n        keyword some more values\n                function funcName2\n        keyword some more values\n                function funcName4\n\n&gt;putStrLn test0\nkeyword some more values\n        funcKeyw funcName1\n        funcKeyw funcName2\n\n        funcKeyw funcName3\n\n        keyword some more values\n                funcKeyw funcName2\n\n        keyword some more values\n                funcKeyw funcName4\n\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 34346694, "answer_count": 1, "score": 2, "last_activity_date": 1450398178, "creation_date": 1450381198, "question_id": 34342911, "link": "https://stackoverflow.com/questions/34342911/parsec-parse-nested-code-blocks", "title": "parsec: parse nested code blocks", "body": "<p>I want to parse following text:</p>\n\n<pre><code>keyword some more values\n        funcKeyw funcName1\n        funcKeyw funcName2\n\n        funcKeyw funcName3\n\n        keyword some more values\n                 funcKeyw funcName2\n\n        keyword some more values\n                 funcKeyw funcName4\n</code></pre>\n\n<p>Indentation is done by tabs. Each block is started by <code>keyword</code> and some additional values in the same line. Everything indented belongs to the same block. <strong>After</strong> all the function calls (that start with the <code>funcKeyw</code>  keyword) there can be child <code>keyword</code> blocks (separated by an \"empty\" line; \"empty\" means either nothing in it or whitespace characters).</p>\n\n<pre><code>type IndentLevel = Int\n\ndata Block = Block { blockFuncCalls :: [String]\n                   , blockBlocks    :: [Block]\n                   }\n\nblock :: GenParser Char st Block\nblock = parseBlock 0\n    where\n        parseBlock lvl = do\n            count lvl tab\n            string \"keyword\"\n            -- [...] Parse other stuff in that line.\n            newline\n\n            -- Parse 'function calls'.\n            fs &lt;- sepBy1 (blockFunc (lvl + 1)) emptyLines\n            -- Parse optional child blocks.\n            emptyLines\n            bs &lt;- sepBy (parseBlock (lvl + 1)) emptyLines\n\n            return Block { blockFuncCalls=fs\n                         , blockBlocks=bs\n                         }\n\nblockFunc :: IndentLevel -&gt; GenParser Char st String\nblockFunc lvl = do\n    count lvl tab\n    string \"funcKeyw\"\n    -- [...] Parse function name etc..\n    newline\n    return funcName -- Parsed func name.\n\nemptyLine :: GenParser Char st ()\nemptyLine = many (oneOf \"\\t \") &gt;&gt; newline &gt;&gt; return ()\n\nemptyLines :: GenParser Char st ()\nemptyLines = many emptyLine &gt;&gt; return ()\n</code></pre>\n\n<p>The problem is that the <code>blockFunc</code> parser does not stop parsing when the child block starts, but returns an error <code>unexpected 'keyword'</code>.</p>\n\n<p>How can I avoid that? I think I could use <code>try</code> or <code>choice</code> to choose the correct parser for each line, but I want to require the function calls to be before the child blocks.</p>\n"}, {"tags": ["haskell", "functional-programming", "pointfree"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1450380567, "post_id": 34342516, "comment_id": 56426803, "body": "are you allowed to do math-chenigans like ` let f x y = 1 - ceiling (fromIntegral (x-y) / fromIntegral y) :: Int`? (which is not exactly what you need ;))"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1450380867, "post_id": 34342516, "comment_id": 56426978, "body": "but <code>1 - ceiling (abs $ fromIntegral (x-y) &#47; fromIntegral (max x y)) :: Int</code> should do it if I did not miss some nasty border case somewhere - maybe you will want to reason about it or run some quickchecks ;) (well I missed some negatives so you&#39;ll have to but more <code>abs</code> in ... but the principle should be obvious ... the real solution is <i>trivial</i> and left for the reader <b>:D</b>)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1450393009, "post_id": 34342516, "comment_id": 56433285, "body": "In general you can replace an <code>if</code> statement with the function <code>bool :: Bool -&gt; a -&gt; a -&gt; a; bool False f _ = f; bool True _ t = t</code>, in which case you can always form a &quot;normal&quot; expression that can be made point free with the regular methods."}], "answers": [{"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1450380968, "post_id": 34342812, "comment_id": 56427059, "body": "Why not just use <code>fromEnum</code> instead of the <code>Foreign.Marshal</code> function?  It does the same thing and exists in <code>Prelude</code> already."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1450381110, "post_id": 34342812, "comment_id": 56427139, "body": "@bheklilr: Uh, didn&#39;t realize that <code>Bool</code> is an instance of <code>Enum</code> - you got my upvote for that already :-) <code>fromBool</code> just crossed my mind, I had seen it somewhere in the past\u2026"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 6, "last_activity_date": 1450381263, "last_edit_date": 1450381263, "creation_date": 1450380885, "answer_id": 34342812, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/34342812#34342812", "title": "make function with &#39;if&#39; point-free", "body": "<p>One trick would be to import one of the many <a href=\"https://wiki.haskell.org/If-then-else\" rel=\"noreferrer\"><code>if</code> functions</a>, e.g. <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html\" rel=\"noreferrer\"><code>Data.Bool.bool 1 0</code></a> (also found in <a href=\"http://hackage.haskell.org/package/bool-extras-0.4.0/docs/Data-Bool-Extras.html#v:bool\" rel=\"noreferrer\"><code>Data.Bool.Extras</code></a>).</p>\n\n<p>A more arcane trick would be to use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Foreign-Marshal-Utils.html#v:fromBool\" rel=\"noreferrer\"><code>Foreign.Marshal.Utils.fromBool</code></a>, which does exactly what you need here. Or the same thing, less arcane: <code>fromEnum</code> (thanks @bheklilr).</p>\n\n<p>But I think the simplest trick would be to simply avoid counting yourself, and just apply the standard <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:length\" rel=\"noreferrer\"><code>length</code></a> function after <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:filter\" rel=\"noreferrer\"><code>filter</code></a>ing for the number.</p>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450382076, "post_id": 34342815, "comment_id": 56427799, "body": "I think this conforms most to the described task."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450382782, "post_id": 34342815, "comment_id": 56428185, "body": "@Andr&#225;sKov&#225;cs the step-back approach... :) cf. <a href=\"http://stackoverflow.com/questions/34207933/print-adjacent-duplicates-of-a-list-scheme\">this recent Lisp entry</a> for some complicated equivalents of <code>map head . filter (not.null.drop 1) . group</code>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 8, "last_activity_date": 1450380889, "creation_date": 1450380889, "answer_id": 34342815, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/34342815#34342815", "title": "make function with &#39;if&#39; point-free", "body": "<p>why not</p>\n\n<pre><code>numocc x \n  = map (length . filter (== x))\n  = map ((length .) (filter (== x)) )\n  = map (((length .) . filter) (== x))\n  = map (((length .) . filter) ((==) x))\n  = map (((length .) . filter . (==)) x)\n  = (map . ((length .) . filter . (==))) x\n  = (map . (length .) . filter . (==)) x\n</code></pre>\n\n<p>and then the trivial eta-contraction.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 10, "last_activity_date": 1450387878, "last_edit_date": 1450387878, "creation_date": 1450380926, "answer_id": 34342825, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/34342825#34342825", "title": "make function with &#39;if&#39; point-free", "body": "<p>I would use the fact that you can easily convert a <code>Bool</code> to an <code>Int</code> using <code>fromEnum</code>:</p>\n\n<pre><code>addif x acc y = acc + fromEnum (x == y)\n</code></pre>\n\n<p>Now you can start applying the usual tricks to make it point-free</p>\n\n<pre><code>-- Go prefix and use $\naddif x acc y = (+) acc $ fromEnum $ (==) x y\n-- Swap $ for . when dropping the last argument\naddif x acc = (+) acc . fromEnum . (==) x\n</code></pre>\n\n<p>And so on.  I won't take away all the fun of making it point free, especially when there's tools to do it for you.</p>\n\n<p>Alternatively, you could write a function like</p>\n\n<pre><code>count x = sum . map (fromEnum . (==) x)\n</code></pre>\n\n<p>Which is almost point free, and there are tricks that get you closer, although they get pretty nasty quickly:</p>\n\n<pre><code>count = fmap fmap fmap sum map . fmap fmap fmap fromEnum (==)\n</code></pre>\n\n<p>Here I think it actually looks nicer to use <code>fmap</code> instead of <code>(.)</code>, although you could replace every <code>fmap</code> with <code>(.)</code> and it would be the exact same code.  Essentially, the <code>(fmap fmap fmap)</code> composes a single argument and a two argument function together, if you instead give it the name <code>.:</code> you could write this as</p>\n\n<pre><code>count = (sum .: map) . (fromEnum .: (==))\n</code></pre>\n\n<p>Broken down:</p>\n\n<pre><code>&gt; :t fmap fmap fmap sum map\nNum a =&gt; (a -&gt; b) -&gt; [a] -&gt; b\n</code></pre>\n\n<p>So it takes a function from <code>b</code> to a numeric <code>a</code>, a list of <code>b</code>s, and returns an <code>a</code>, not too bad.</p>\n\n<pre><code>&gt; :t fmap fmap fmap fromEnum (==)\nEq a =&gt; a -&gt; a -&gt; Int\n</code></pre>\n\n<p>And this type can be written as <code>Eq a =&gt; a -&gt; (a -&gt; Int)</code>, which is an important thing to note.  That makes this function's return type match the input to <code>fmap fmap fmap sum map</code> with <code>b ~ Int</code>, so we can compose them to get a function of type <code>Eq a =&gt; a -&gt; [a] -&gt; Int</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "is_accepted": false, "score": 1, "last_activity_date": 1450381669, "last_edit_date": 1450381669, "creation_date": 1450381306, "answer_id": 34342939, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/34342939#34342939", "title": "make function with &#39;if&#39; point-free", "body": "<p>Using the <code>Enum</code> instance for <code>Bool</code>, it is possible to build a pointfree replacement for if that can be used in more general cases:</p>\n\n<pre><code>chk :: Bool -&gt; (a,a) -&gt; a\nchk = ([snd,fst]!!) . fromEnum\n</code></pre>\n\n<p>Using <code>chk</code> we can define a different version of <code>addIf</code>:</p>\n\n<pre><code>addIf' :: Eq a =&gt; a -&gt; a -&gt; Int -&gt; Int\naddIf' = curry (flip chk ((+1),id) . uncurry (==))\n</code></pre>\n\n<p>Now we can simply replace <code>chk</code> in <code>addIf'</code>:</p>\n\n<pre><code>addIf :: Eq a =&gt; a -&gt; a -&gt; Int -&gt; Int\naddIf = curry (flip (([snd,fst]!!) . fromEnum) ((+1),id) . uncurry (==))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "is_accepted": false, "score": 0, "last_activity_date": 1509924845, "creation_date": 1509924845, "answer_id": 47127779, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/47127779#47127779", "title": "make function with &#39;if&#39; point-free", "body": "<p>I think you\u2019re looking for <code>Data.Bool</code>\u2019s <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Bool.html#v:bool\" rel=\"nofollow noreferrer\"><code>bool</code></a>, which exists since 4.7.0.0 (2014\u201304\u201308).</p>\n\n<pre><code>incif :: (Eq a, Enum counter) =&gt; a -&gt; a -&gt; counter -&gt; counter\nincif = ((bool id succ) .) . (==)\n</code></pre>\n\n<p>The additional <code>.</code> allows <code>==</code> to take two parameters, before passing the expression to <code>bool</code>.</p>\n\n<p>Since the order of parameters is different, you need to use <code>incif</code> like this:</p>\n\n<pre><code>(flip . incif)\n</code></pre>\n\n<p>(Integrating that <em>into</em> <code>incif</code> is left as an exercise to the reader. [Translation: It\u2019s not trivial, and I don\u2019t yet know how. ;])</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1521427113, "creation_date": 1521427113, "answer_id": 49355062, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free/49355062#49355062", "title": "make function with &#39;if&#39; point-free", "body": "<p>Remember that in Haskell list comprehensions, if conditionals can be used in the result clause or at the end. But, most importantly, guards without if can be used to filter results. I am using pairs from zip. The second of the pair is the list number. It stays constant while the elements of the list are being compared to the constant (k).\nYour result [1,2,0] does not include list numbers 1, 2 or 3 because it is obvious from the positions of the sums in the result list. The result here does not add the occurrences in each list but list them for each list.</p>\n\n<pre><code>nocc k ls = [ z | (y,z) &lt;- zip ls [1..length ls], x &lt;- y, k == x]\nnocc 1 [[1, 2], [2, 3, 2, 1, 1], [3]]\n</code></pre>\n\n<p>[1,2,2] -- read as [1,2,0] or 1 in list 1, 2 in list 2 and 0 in list 3</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4638556"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 799, "favorite_count": 2, "accepted_answer_id": 34342825, "answer_count": 6, "score": 13, "last_activity_date": 1521427113, "creation_date": 1450379837, "last_edit_date": 1450402025, "question_id": 34342516, "link": "https://stackoverflow.com/questions/34342516/make-function-with-if-point-free", "title": "make function with &#39;if&#39; point-free", "body": "<p>I have a task in Haskell (no, it's not my homework, I'm learning for exam).</p>\n\n<p>The task is:</p>\n\n<blockquote>\n  <p>Write point-free function <code>numocc</code> which counts occurrences of element in given lists. For example: <code>numocc 1 [[1, 2], [2, 3, 2, 1, 1], [3]]</code> = <code>[1, 2, 0]</code></p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>addif :: Eq a =&gt; a -&gt; Int -&gt; a -&gt; Int\naddif x acc y = if x == y then acc+1 else acc\n\ncount :: Eq a =&gt; a -&gt; [a] -&gt; Int\ncount = flip foldl 0 . addif\n\nnumocc :: Eq a =&gt; a -&gt; [[a]] -&gt; [Int]\nnumocc = map . count\n</code></pre>\n\n<p><code>numocc</code> and <code>count</code> are 'point-free', but they are using function <code>addif</code> which isn't.</p>\n\n<p>I have no idea how can I do the function <code>addif</code> point-free. Is there any way to do <code>if</code> statement point-free? Maybe there is a trick which use no <code>if</code>?</p>\n"}, {"tags": ["haskell", "binary", "hex", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450379880, "post_id": 34342435, "comment_id": 56426449, "body": "I really hope that extension gets in the next Haskell Report. It&#39;s obviously a good idea."}, {"owner": {"reputation": 2193, "user_id": 2856202, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AHuOz.png?s=128&g=1", "display_name": "eigenfield", "link": "https://stackoverflow.com/users/2856202/eigenfield"}, "edited": false, "score": 0, "creation_date": 1542210400, "post_id": 34342435, "comment_id": 93488678, "body": "To enable in <code>ghci</code>, add <code>:set -XBinaryLiterals</code> in your <code>~&#47;.ghci</code> config"}], "tags": [], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "is_accepted": true, "score": 6, "last_activity_date": 1450379541, "creation_date": 1450379541, "answer_id": 34342435, "question_id": 34342405, "link": "https://stackoverflow.com/questions/34342405/binary-numbers-with-haskell/34342435#34342435", "title": "Binary numbers with Haskell", "body": "<p>Yes, with the <code>{-# LANGUAGE BinaryLiterals #-}</code> extension, as <code>0b01101</code>. See <a href=\"https://www.reddit.com/r/haskell/comments/29b2jj/ghc_710_gains_xbinaryliterals_language_syntax/\">here</a> for some more details.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 0, "accepted_answer_id": 34342435, "answer_count": 1, "score": 4, "last_activity_date": 1450380695, "creation_date": 1450379390, "last_edit_date": 1450380695, "question_id": 34342405, "link": "https://stackoverflow.com/questions/34342405/binary-numbers-with-haskell", "title": "Binary numbers with Haskell", "body": "<p>I know it is possible with Haskell to pass values in octal with <code>0o777</code> and Hexadecimal with <code>0x1FF</code> but:</p>\n\n<p><strong>Is it possible to pass a value in binary with Haskell?</strong></p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450392768, "post_id": 34339367, "comment_id": 56433169, "body": "I&#39;m not sure I understand the question yet. What makes it hard to conditionally include a value? Can you give a short-ish example where your JSON includes &quot;too much&quot; and ideally also why you think it&#39;s hard to include less?"}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450401055, "post_id": 34339367, "comment_id": 56435766, "body": "@DanielWagner I made an edit, I hope it clears things up a little."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450410927, "post_id": 34339367, "comment_id": 56438092, "body": "Can&#39;t you just... sidestep the typeclass? I mean, you can write as many functions as you want of type <code>Foo -&gt; Value</code>, they don&#39;t <i>have</i> to be named <code>toJSON</code>."}], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 4, "last_activity_date": 1450405133, "creation_date": 1450405133, "answer_id": 34347579, "question_id": 34339367, "link": "https://stackoverflow.com/questions/34339367/conditionally-add-fields-to-json-output/34347579#34347579", "title": "Conditionally add fields to JSON output", "body": "<p>I don't think there's a general answer to whether you should use dynamic JSON or stick to fixed <code>ToJSON</code> instances, but you can easily mix the two and add extra fields to JSON values that are generated from your instances.</p>\n\n<p>From what you've written I guess you know Aeson represents an object as a <code>Map Text Value</code>? For arrays it uses <code>Vector Value</code>.</p>\n\n<p>So you can call <code>toJSON</code> on your <code>User</code> and on the list of <code>Posts</code> and just insert the post array as an additional entry in the map if you want it:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString.Lazy.Char8 as B\nimport Data.Aeson\nimport Data.Aeson.Types\nimport qualified Data.HashMap.Strict as M\n\ndata User = User { userID :: Integer, name :: String }\n\ndata Post = Post { content :: String, authorID :: Integer }\n\ninstance ToJSON User where\n    toJSON (User i n) = object [ \"id\" .= i, \"name\" .= n ]\n\ninstance ToJSON Post where\n    toJSON (Post c a) = object [ \"content\" .= c, \"author_id\" .= a ]\n\nbabs = User { userID = 5, name = \"babs\" }\n\nposts = [ Post { content = \"blah\", authorID = 5 } ]\n\nuserWithPosts = Object (M.insert \"posts\" v o)\n  where\n    Object o = toJSON babs\n    v        = toJSON posts\n\nmain = B.putStrLn (encode userWithPosts)\n</code></pre>\n\n<p>The <code>encode</code> call gives you the combined JSON:</p>\n\n<pre><code>*Main B&gt; main\n{\"name\":\"babs\",\"id\":5,\"posts\":[{\"author_id\":5,\"content\":\"blah\"}]}\n</code></pre>\n"}], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 34347579, "answer_count": 1, "score": 3, "last_activity_date": 1450405133, "creation_date": 1450369040, "last_edit_date": 1450401041, "question_id": 34339367, "link": "https://stackoverflow.com/questions/34339367/conditionally-add-fields-to-json-output", "title": "Conditionally add fields to JSON output", "body": "<p>I have a couple types, <code>User</code> and <code>Post</code>. A <code>Post</code> is created by a <code>User</code>.</p>\n\n<p>My database looks the same as my types, which are</p>\n\n<pre><code>data User = { userID :: Integer, name :: String }\ndata Post = { content :: String, authorID :: Integer } -- authorID is the userID\n</code></pre>\n\n<p>Assuming I have valid To/FromJSON instances based on those types, how would I go about conditionally including a value in the output of my JSON?</p>\n\n<p>As an example, I may want to look at a users \"profile\", which would include all <code>Post</code>s made by the <code>User</code>. Other times, I may want to search through the various <code>User</code>s in the system, so there is no point in returning the <code>Post</code>s that they have made.</p>\n\n<p>I have no problem retrieving the <code>Post</code>s for a given <code>User</code>, nor do I have an issue retrieving the <code>User</code> of a given <code>Post</code>. I just want to know the best way to conditionally add a key to my JSON.</p>\n\n<p>Someone mentioned to me that I should essentially add a field to <code>User</code> for <code>posts :: Maybe [Post]</code> and add an <code>author :: Maybe User</code> to my <code>Post</code> type. While this would work for rather small types, I feel that it would make certain types with a lot of relations quite large and potentially hard to maintain.</p>\n\n<p>I've also thought of using a <code>Map Text Data.Aeson.Value</code> to build / serialize my information, but you lose most (all?) type safety by doing something like that.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Based on the data types above, I have defined the following ToJSON instances.</p>\n\n<pre><code>instance ToJSON User where\n  toJSON (User i n) = object [ \"id\" .= i, \"name\" .= n ]\n\ninstance ToJSON Post where\n  toJSON (Post c a) = object [ \"content\" .= c, \"author_id\" .= a ]\n</code></pre>\n\n<p>This would give me \"simple\" json output, something like <code>User</code>:</p>\n\n<pre><code>{\n  \"id\": 4,\n  \"name\": \"User Name\"\n}\n</code></pre>\n\n<p><code>Post</code>:</p>\n\n<pre><code>{\n  \"content\": \"This is the content of my post\",\n  \"author_id\": 4\n}\n</code></pre>\n\n<p>These can be useful, especially when searching for items. This allows to only show a limited amount of information.</p>\n\n<p>I could do something along the lines of</p>\n\n<pre><code>instance ToJSON User where\n  toJSON (User i n) = object [ \"id\" .= i, \"name\" .= n, \"posts\" .= posts i ]\n</code></pre>\n\n<p>Which would give me the Users information, as well as all posts associated with that user, assuming a valid definition of <code>posts</code>.\nThis would give me JSON similar to</p>\n\n<pre><code>{\n  \"id\": 4,\n  \"name\": \"User Name\",\n  \"posts\": [\n    {\n      \"content\": \"This is some content\",\n      \"author_id\": 4\n    }\n  ]\n}\n</code></pre>\n\n<p>I do not understand how I would be able to dynamically set which fields I would like to send down to the client. Is it possible to define multiple instances of ToJSON and choose which instance I would like to use for a given request? Or should I just do what was suggested before and include a <code>posts</code> field in my <code>User</code> type that can hold a <code>Maybe [Post]</code>?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1450368104, "post_id": 34338818, "comment_id": 56419214, "body": "You could always provide an instance for a wrapping newtype."}, {"owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1450368371, "post_id": 34338818, "comment_id": 56419410, "body": "But then I&#39;d have to do that for every type which is both Enum and Bounded. What I want to say is &#39;all types which are both Enum and Bounded are also Cyclic, and in this way: ...&#39;."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1450368428, "post_id": 34338818, "comment_id": 56419451, "body": "@BartekBanachewicz I think that would qualify as the &quot;generally used approach&quot; - to clarify for the OP, maybe something like <code>newtype CyclicGroup a = CyclicGroup a; instance (Enum a, Bounded a, Eq a) =&gt; CyclicEnum (CyclicGroup a) where ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "edited": false, "score": 0, "creation_date": 1450368748, "post_id": 34339192, "comment_id": 56419702, "body": "Yes, you&#39;re absolutely right! I&#39;m an idiot! Thanks a bunch!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1450368852, "post_id": 34339192, "comment_id": 56419783, "body": "Note that if you want you can define a synonym called <code>CyclicEnum</code> for this constraint like so <code>type CyclicEnum a = (Enum a, Bounded a, Eq a)</code> simply for readability. Actually, if you&#39;re clever, you don&#39;t need the Eq, since Enum gives you an induced order, but that is besides the point."}, {"owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450368906, "post_id": 34339192, "comment_id": 56419828, "body": "@user2407038 How do I rewrite the definition of next and prev so that it doesn&#39;t need Eq?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "edited": false, "score": 1, "creation_date": 1450368980, "post_id": 34339192, "comment_id": 56419896, "body": "@JSQuareD: instead of <code>x==maxBound</code> you write <code>fromEnum x == fromEnum (maxBound :: a)</code>, but I wouldn&#39;t necessarily consider that a good idea."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1450369123, "post_id": 34339192, "comment_id": 56420026, "body": "@user2407038 right, though <code>type CyclicEnum = ...</code> requires <code>ConstraintKinds</code>. Now, that&#39;s also an extension which is completely fine in itself, but since it&#39;s still so new it&#39;s not quite as accepted yet. Many people still have GHC &lt; 7.4, alas..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450369337, "post_id": 34339192, "comment_id": 56420203, "body": "I guess there could be problems if the particular <code>Enum</code> was larger than <code>Int</code>? And if you really would like to avoid constraint kinds, you can write <code>class (Enum a, Bounded a, Eq a) =&gt; CyclicEnum a; instance (Enum a, Bounded a, Eq a) =&gt; CyclicEnum a</code> which only requires flexible instances which I think is a more established and commonly used extension, but at this point I am just splitting hairs.. although the 2nd version does have the distinct advantage of giving you an type class that you can partially apply, if such a thing interests you."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450369487, "post_id": 34339192, "comment_id": 56420332, "body": "@user2407038: this is already extensions overkill here, but I&#39;ll throw in <code>LiberalTypeSynonyms</code>, which allows partial application of <code>type</code> constraints under some circumstances!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450379230, "post_id": 34339192, "comment_id": 56426113, "body": "Edward Kmett takes the opposing view. He thinks <code>FlexibleInstances</code> can be trouble but doesn&#39;t fear <code>UndecidableInstances</code> at all. In this particular case, I don&#39;t think either is the least bit problematic."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450379647, "post_id": 34339192, "comment_id": 56426321, "body": "The trouble with using a synonym is that type synonyms, even with <code>LiberalTypeSynonyms</code>, are decidedly second-class. People using your synonym will be limited in possibly surprising ways."}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450385274, "post_id": 34339192, "comment_id": 56429464, "body": "@dfeuer I&#39;d be interested to read what the objections are to <code>FlexibleInstances</code>. I tried to google it but didn&#39;t get far because there are so many other mentions of it. Any pointers on where you might have read that?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 1, "creation_date": 1450387674, "post_id": 34339192, "comment_id": 56430666, "body": "@DougMcClean, I don&#39;t have references; he told me in person. The issue is that <code>FlexibleInstances</code> allows the creation of instances that can cause the instance resolution mechanism to get stuck. Unfortunately, I can&#39;t give you a really general example off the top of my head, but certainly I can say that using an equality constraint leads to much better instance resolution than (flexibly) doubling a type variable. The particular case of <code>instance ... =&gt; C a</code> reduces immediately to the constraints, so it should be just fine."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1450368593, "creation_date": 1450368593, "answer_id": 34339192, "question_id": 34338818, "link": "https://stackoverflow.com/questions/34338818/declare-a-subclass-with-a-complete-definition/34339192#34339192", "title": "Declare a subclass with a complete definition", "body": "<p>First off, there is nothing wrong at all with <code>FlexibleInstances</code> &ndash; it just disables a few restrictions of standard Haskell that are mostly there for historical reasons and perhaps for making compilers easier to write. But if you only use GHC &ndash; as almost everybody does &ndash; then there's no real reason not to use <code>FlexibleInstances</code>.</p>\n\n<p><code>UndecidableInstances</code> is more debatable, but there are some cases where it's definitely ok to use that too.</p>\n\n<p>However, in your example, I don't see the need to define any new type class at all! Why not just define, as free functions,</p>\n\n<pre><code>next, prev :: (Enum a, Bounded a, Eq a) =&gt; a -&gt; a\nnext x | x == maxBound = minBound\n       | otherwise     = succ x\nprev x | x == minBound = maxBound\n       | otherwise     = pred x\n</code></pre>\n\n<p>Well. Probably your intention was to also add other instances for <code>CyclicEnum</code>, apart from the generic one. But that's actually not possible! Even with <code>UndecidableInstances</code>. It needs <code>OverlappingInstances</code> (or rather, <code>Overlappable</code> pragmas), but overlapping instances are <em>really</em> not something you should use just because you can.</p>\n"}, {"comments": [{"owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "edited": false, "score": 0, "creation_date": 1450385766, "post_id": 34342995, "comment_id": 56429700, "body": "Wouldn&#39;t I then still have to define a bunch of instances?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "edited": false, "score": 0, "creation_date": 1450420546, "post_id": 34342995, "comment_id": 56441148, "body": "@JSQuareD Oops, you are right. This just allows you to make them empty."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1450381457, "creation_date": 1450381457, "answer_id": 34342995, "question_id": 34338818, "link": "https://stackoverflow.com/questions/34338818/declare-a-subclass-with-a-complete-definition/34342995#34342995", "title": "Declare a subclass with a complete definition", "body": "<p>You can also use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html\" rel=\"nofollow\">default signatures</a> to get what you asked for: a default implementation for equatable types only (though @leftaroundabout's answer may be better for this specific case).</p>\n\n<pre><code>class (Enum a, Bounded a) =&gt; CyclicEnum a where\n    next, prev :: a -&gt; a\n    default next, prev :: Eq a =&gt; a -&gt; a\n\n    next x | x == maxBound = minBound\n           | otherwise     = succ x\n\n    prev x | x == minBound = maxBound\n           | otherwise     = pred x\n</code></pre>\n"}], "owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 34339192, "answer_count": 2, "score": 3, "last_activity_date": 1450381457, "creation_date": 1450367650, "question_id": 34338818, "link": "https://stackoverflow.com/questions/34338818/declare-a-subclass-with-a-complete-definition", "title": "Declare a subclass with a complete definition", "body": "<p>I am trying to do the following:</p>\n\n<pre><code>-- enum which wraps arround\nclass (Enum a, Bounded a) =&gt; CyclicEnum a where\n    next, prev :: a -&gt; a\n\n-- for equatable types this is readily implemented\ninstance (Enum a, Bounded a, Eq a) =&gt; CyclicEnum a where\n    next x | x == maxBound = minBound\n           | otherwise     = succ x\n\n    prev x | x == minBound = maxBound\n           | otherwise     = pred x\n</code></pre>\n\n<p>But this doesn't compile unless I enable both FlexibleInstances and UndecidableInstances, which doesn't seem right. What is the proper way (i.e., the generally used approach, preferably without language extensions) to do something like this? Is there one?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 2, "creation_date": 1450366461, "post_id": 34337909, "comment_id": 56418013, "body": "<code>ErrorOr</code> is a <i>type constructor</i>; you can only pattern match on the <i>value constructors</i> (<code>Result</code>, <code>ParseError</code>, <code>TypeError</code>)."}, {"owner": {"reputation": 1, "user_id": 3880152, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d25f9a43239c0cb7b984d93cb6199c8c?s=128&d=identicon&r=PG&f=1", "display_name": "shura", "link": "https://stackoverflow.com/users/3880152/shura"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1450367002, "post_id": 34337909, "comment_id": 56418385, "body": "thank you! I just tried it...(updated the questions)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450368944, "post_id": 34337909, "comment_id": 56419867, "body": "Indent the definition of the function <code>==</code> - it is inside the <code>instance</code> declaration, so it must be placed inside. The compiler believes you are defining a new <code>==</code> function independant of the <code>Eq</code> class because you have not indented it. Although if you want ParseErrors to never be equal, your code is not doing that. Simply remove the <code>ParseError</code> case and it will fall through to the default <code>False</code>, giving you the behaviour you want."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450372620, "post_id": 34337909, "comment_id": 56422417, "body": "I think you want <code>False</code> to be the result when comparing <code>ParseError</code>s."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1450376427, "post_id": 34337909, "comment_id": 56424580, "body": "I suggest turning on <code>-Wall</code> while developing so you don&#39;t do weird stuff like that"}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1450474240, "creation_date": 1450474240, "answer_id": 34364227, "question_id": 34337909, "link": "https://stackoverflow.com/questions/34337909/simple-haskell-module/34364227#34364227", "title": "simple Haskell module", "body": "<p>Indentation is important in Haskell. It's how the compiler recognises where a block like an instance declaration ends.</p>\n\n<p>In your case it ends immediately after the <code>where</code>, because the next line is not indented any more than the instance declaration. You've written an empty declaration, which is technically valid Haskell (because some classes have default definitions for all their methods), and then written another function which just happens to be called <code>==</code> but has no relation to the <code>==</code> that's part of the <code>Eq</code> class (hence you have two <code>==</code> in scope, so you get the ambiguous occurrence error).</p>\n\n<p>You would get a warning about leaving the <code>Eq</code> instance empty, but the error might be hiding the warning.</p>\n\n<p>As an aside, having your error values never compare equal might not be the best idea. Equality relationships (which <code>Eq</code> is intended to represent) must be:</p>\n\n<ol>\n<li>reflexive - a thing is always equal to itself</li>\n<li>symmetric - if <code>a == b</code> then also <code>b == a</code></li>\n<li>transitive - if <code>a == b</code> and <code>b == c</code> then also <code>a == c</code></li>\n</ol>\n\n<p>Having <code>ParseError _ /= ParseError _</code> breaks reflexivity (<code>let e = ParseError \"not reflexive\" in e == e</code>).</p>\n\n<p>Library code that uses <code>Eq</code> generically usually assumes those three properties. An example would be comparison-based containers like <code>Map</code> and <code>Set</code> (although these need <code>Ord</code> as well); you would find these behave quite strangely on your <code>ErrorOr</code> values.</p>\n"}], "owner": {"reputation": 1, "user_id": 3880152, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d25f9a43239c0cb7b984d93cb6199c8c?s=128&d=identicon&r=PG&f=1", "display_name": "shura", "link": "https://stackoverflow.com/users/3880152/shura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1450474240, "creation_date": 1450365126, "last_edit_date": 1450461868, "question_id": 34337909, "link": "https://stackoverflow.com/questions/34337909/simple-haskell-module", "title": "simple Haskell module", "body": "<p>Im trying to create an instance declaration for <code>ErrorOr a</code> so that values of any <code>ErrorOr a</code> can be compared against another using the <code>(==)</code> operator. Errors are never equivalent, even if they are identical; only results can be equivalent, and they are equivalent only if they are equal with respect to their own definition of equality.</p>\n\n<pre><code>*&gt; ParseError \"Test.\" == ParseError \"Test.\"\nFalse\n*&gt; Result 123 == Result 123\nTrue\n</code></pre>\n\n<p>this is what was given:</p>\n\n<pre><code>module Error where\n\ndata ErrorOr a =\n    Result a\n  | ParseError String\n  | TypeError String\n  deriving Show\n\npromote :: ErrorOr a -&gt; ErrorOr b\npromote (ParseError s     ) = ParseError s\npromote (TypeError s      ) = TypeError s\n\ninstance Eq a =&gt; Eq (ErrorOr a) where\n-- This is what I tried. and it doesn't work;(\nResult x == Result y = x==y\nParseError q == ParseError w= q==w\nTypeError s1 == TypeError s2 = s1==s2\n_ == _ = False\n</code></pre>\n\n<p>Could somebody give a hint on how to do this?</p>\n\n<p>I get the following error</p>\n\n<pre><code>Error.hs:15:25:\n    Ambiguous occurrence \u2018==\u2019\n    It could refer to either \u2018Error.==\u2019, defined at Error.hs:15:10\n                          or \u2018Prelude.==\u2019,\n                             imported from \u2018Prelude\u2019 at Error.hs:1:8-12\n                             (and originally defined in \u2018GHC.Classes\u2019)\n</code></pre>\n"}, {"tags": ["haskell", "generic-programming", "agda", "dependent-type", "type-theory"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1450374372, "post_id": 34334773, "comment_id": 56423443, "body": "For me, containers is a lot about efficiency.  You need to be able to find an element fast."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1450376324, "post_id": 34334773, "comment_id": 56424523, "body": "@augustss, do you mean <a href=\"https://en.wikipedia.org/wiki/Container_%28abstract_data_type%29\" rel=\"nofollow noreferrer\">these</a> containers and not <a href=\"https://en.wikipedia.org/wiki/Container_%28type_theory%29\" rel=\"nofollow noreferrer\">these</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450416416, "post_id": 34346484, "comment_id": 56439591, "body": "Thank you for the answer. So, in short, containers are suitable for concise abstract definitions and they are an effecient reasoning tool. I&#39;m sorry if I offended you and your colleagues, I didn&#39;t want to."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450416432, "post_id": 34346484, "comment_id": 56439596, "body": "I said that <code>Freer</code> is an alternative to containers-armed <code>Free</code>, because we can convert not only from <code>Freer</code> to <code>Free</code>, but also <a href=\"https://github.com/effectfully/random-stuff/blob/master/IFreerIFree.agda#L66\" rel=\"nofollow noreferrer\">from <code>Free</code> to <code>Freer</code></a> and semantics of <code>Freer</code> and <code>Free</code> look very different: the left Kan extension trick looks like a rather unsophisticated programming technique (despite being a mathy thing) and <code>Free</code>s are truly mathy."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450418765, "post_id": 34346484, "comment_id": 56440371, "body": "For the polymorphic functions on containers example, can the <code>(toS, fromP)</code> representation be eased out of a black-box function with clever choices of <code>X</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450422944, "post_id": 34346484, "comment_id": 56442157, "body": "@pigworker: here it is, <i>sans</i> proof yet: <a href=\"https://gist.github.com/gergoerdi/a9da9e2304375a7816f1\" rel=\"nofollow noreferrer\">gist.github.com/gergoerdi/a9da9e2304375a7816f1</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450424404, "post_id": 34346484, "comment_id": 56442814, "body": "@pigworker: dang, I can&#39;t even prove <code>proj\u2081 (f (s , k)) \u2261 proj\u2081 (f (s , \u03bb x \u2192 x))</code>... how are these parametricity-exploiting proofs usually formalized in Agda?"}, {"owner": {"reputation": 11510, "user_id": 5852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba340386ad2afc76d4a9602410b4e449?s=128&d=identicon&r=PG", "display_name": "Sjoerd Visscher", "link": "https://stackoverflow.com/users/5852/sjoerd-visscher"}, "edited": false, "score": 0, "creation_date": 1450429289, "post_id": 34346484, "comment_id": 56445303, "body": "Did you mean <code>one : Desc -- could be Pi with A = Zero</code>?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 11510, "user_id": 5852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba340386ad2afc76d4a9602410b4e449?s=128&d=identicon&r=PG", "display_name": "Sjoerd Visscher", "link": "https://stackoverflow.com/users/5852/sjoerd-visscher"}, "edited": false, "score": 0, "creation_date": 1450436778, "post_id": 34346484, "comment_id": 56449829, "body": "@SjoerdVisscher aye, terminal mistake"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1450570827, "post_id": 34346484, "comment_id": 56495223, "body": "@Cactus, parametricity-exploiting theorems often aren&#39;t <i>provable</i> in Agda. Bernardy et al have done some significant work showing a parametricity axiom does not change the consistency strength of Agda. See <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.PapersUsingAgda\" rel=\"nofollow noreferrer\">this list of papers</a> on the Agda wiki."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 25, "last_activity_date": 1450436715, "last_edit_date": 1450436715, "creation_date": 1450396750, "answer_id": 34346484, "question_id": 34334773, "link": "https://stackoverflow.com/questions/34334773/why-do-we-need-containers/34346484#34346484", "title": "Why do we need containers?", "body": "<p>To my mind, the value of containers (as in container theory) is their <em>uniformity</em>. That uniformity gives considerable scope to use container representations as the basis for executable specifications, and perhaps even machine-assisted program derivation.</p>\n\n<h3>Containers: a theoretical tool, not a good run-time data representation strategy</h3>\n\n<p>I would <em>not</em> recommend fixpoints of (normalized) containers as a good general purpose way to implement recursive data structures. That is, it is helpful to know that a given functor has (up to iso) a presentation as a container, because it tells you that generic container functionality (which is easily implemented, once for all, thanks to the uniformity) can be instantiated to your particular functor, and what behaviour you should expect. But that's not to say that a container implementation will be efficient in any practical way. Indeed, I generally prefer first-order encodings (tags and tuples, rather than functions) of first-order data.</p>\n\n<p>To fix terminology, let us say that the type <code>Cont</code> of containers (on <code>Set</code>, but other categories are available) is given by a constructor <code>&lt;|</code> packing two fields, shapes and positions</p>\n\n<pre><code>S : Set\nP : S -&gt; Set\n</code></pre>\n\n<p>(This is the same signature of data which is used to determine a Sigma type, or a Pi type, or a W type, but that does not mean that containers are the same as any of these things, or that these things are the same as each other.)</p>\n\n<p>The interpretation of such a thing as a functor is given by</p>\n\n<pre><code>[_]C : Cont -&gt; Set -&gt; Set\n[ S &lt;| P ]C X = Sg S \\ s -&gt; P s -&gt; X  -- I'd prefer (s : S) * (P s -&gt; X)\nmapC : (C : Cont){X Y : Set} -&gt; (X -&gt; Y) -&gt; [ C ]C X -&gt; [ C ]C Y\nmapC (S &lt;| P) f (s , k) = (s , f o k)  -- o is composition\n</code></pre>\n\n<p>And we're already winning. That's <code>map</code> implemented once for all. What's more, the functor laws hold by computation alone. There is no need for recursion on the structure of types to construct the operation, or to prove the laws.</p>\n\n<h3>Descriptions are denormalized containers</h3>\n\n<p>Nobody is attempting to claim that, operationally, <code>Nat &lt;| Fin</code> gives an <em>efficient</em> implementation of lists, just that by making that identification we learn something useful about the structure of lists.</p>\n\n<p>Let me say something about <em>descriptions</em>. For the benefit of lazy readers, let me reconstruct them.</p>\n\n<pre><code>data Desc : Set1 where\n  var : Desc\n  sg pi  : (A : Set)(D : A -&gt; Desc) -&gt; Desc\n  one : Desc                    -- could be Pi with A = Zero\n  _*_ : Desc -&gt; Desc -&gt; Desc    -- could be Pi with A = Bool\n\ncon : Set -&gt; Desc   -- constant descriptions as singleton tuples\ncon A = sg A \\ _ -&gt; one\n\n_+_ : Desc -&gt; Desc -&gt; Desc   -- disjoint sums by pairing with a tag\nS + T = sg Two \\ { true -&gt; S ; false -&gt; T }\n</code></pre>\n\n<p>Values in <code>Desc</code> describe functors whose fixpoints give datatypes. Which functors do they describe?</p>\n\n<pre><code>[_]D : Desc -&gt; Set -&gt; Set\n[ var    ]D X = X\n[ sg A D ]D X = Sg A \\ a -&gt; [ D a ]D X\n[ pi A D ]D X = (a : A) -&gt; [ D a ]D X\n[ one    ]D X = One\n[ D * D' ]D X = Sg ([ D ]D X) \\ _ -&gt; [ D' ]D X\n\nmapD : (D : Desc){X Y : Set} -&gt; (X -&gt; Y) -&gt; [ D ]D X -&gt; [ D ]D Y\nmapD var      f x        = f x\nmapD (sg A D) f (a , d)  = (a , mapD (D a) f d)\nmapD (pi A D) f g        = \\ a -&gt; mapD (D a) f (g a)\nmapD one      f &lt;&gt;       = &lt;&gt;\nmapD (D * D') f (d , d') = (mapD D f d , mapD D' f d')\n</code></pre>\n\n<p>We inevitably have to work by recursion over descriptions, so it's harder work. The functor laws, too, do not come for free. We get a better representation of the data, operationally, because we don't need to resort to functional encodings when concrete tuples will do. But we have to work harder to write programs.</p>\n\n<p>Note that every container has a description:</p>\n\n<pre><code>sg S \\ s -&gt; pi (P s) \\ _ -&gt; var\n</code></pre>\n\n<p>But it's also true that every description has a <em>presentation</em> as an isomorphic container.</p>\n\n<pre><code>ShD  : Desc -&gt; Set\nShD D = [ D ]D One\n\nPosD : (D : Desc) -&gt; ShD D -&gt; Set\nPosD var      &lt;&gt;       = One\nPosD (sg A D) (a , d)  = PosD (D a) d\nPosD (pi A D) f        = Sg A \\ a -&gt; PosD (D a) (f a)\nPosD one      &lt;&gt;       = Zero\nPosD (D * D') (d , d') = PosD D d + PosD D' d'\n\nContD : Desc -&gt; Cont\nContD D = ShD D &lt;| PosD D\n</code></pre>\n\n<p>That's to say, containers are a normal form for descriptions. It's an exercise to show that <code>[ D ]D X</code> is naturally isomorphic to <code>[ ContD D ]C X</code>. That makes life easier, because to say what to do for descriptions, it's enough in principle to say what to do for their normal forms, containers. The above <code>mapD</code> operation could, in principle, be obtained by fusing the isomorphisms to the uniform definition of <code>mapC</code>.</p>\n\n<h3>Differential structure: containers show the way</h3>\n\n<p>Similarly, if we have a notion of equality, we can say what one-hole contexts are for containers <em>uniformly</em></p>\n\n<pre><code>_-[_] : (X : Set) -&gt; X -&gt; Set\nX -[ x ] = Sg X \\ x' -&gt; (x == x') -&gt; Zero\n\ndC : Cont -&gt; Cont\ndC (S &lt;| P) = (Sg S P) &lt;| (\\ { (s , p) -&gt; P s -[ p ] })\n</code></pre>\n\n<p>That is, the shape of a one-hole context in a container is the pair of the shape of the original container and the position of the hole; the positions are the original positions apart from that of the hole. That's the proof-relevant version of \"multiply by the index, decrement the index\" when differentiating power series.</p>\n\n<p>This uniform treatment gives us the specification from which we can derive the centuries-old program to compute the derivative of a polynomial.</p>\n\n<pre><code>dD : Desc -&gt; Desc\ndD var = one\ndD (sg A D) = sg A \\ a -&gt; dD (D a)\ndD (pi A D) = sg A \\ a -&gt; (pi (A -[ a ]) \\ { (a' , _) -&gt; D a' }) * dD (D a)\ndD one      = con Zero\ndD (D * D') = (dD D * D') + (D * dD D')\n</code></pre>\n\n<p>How can I check that my derivative operator for descriptions is correct? By checking it against the derivative of containers!</p>\n\n<p>Don't fall into the trap of thinking that just because a presentation of some idea is not operationally helpful that it cannot be conceptually helpful.</p>\n\n<h3>On \"Freer\" monads</h3>\n\n<p>One last thing. The <code>Freer</code> trick amounts to rearranging an arbitrary functor in a particular way (switching to Haskell)</p>\n\n<pre><code>data Obfuncscate f x where\n  (:&lt;) :: forall p. f p -&gt; (p -&gt; x) -&gt; Obfuncscate f x\n</code></pre>\n\n<p>but this is not an <em>alternative</em> to containers. This is a slight currying of a container presentation. If we had <em>strong</em> existentials and dependent types, we could write</p>\n\n<pre><code>data Obfuncscate f x where\n  (:&lt;) :: pi (s :: exists p. f p) -&gt; (fst s -&gt; x) -&gt; Obfuncscate f x\n</code></pre>\n\n<p>so that <code>(exists p. f p)</code> represents shapes (where you can choose your representation of positions, then mark each place with its position), and <code>fst</code> picks out the existential witness from a shape (the position representation you chose). It has the merit of being obviously strictly positive <em>exactly</em> because it's a container presentation.</p>\n\n<p>In Haskell, of course, you have to curry out the existential, which fortunately leaves a dependency only on the type projection. It's the weakness of the existential which justifies the equivalence of <code>Obfuncscate f</code> and <code>f</code>. If you try the same trick in a dependent type theory with strong existentials, the encoding loses its uniqueness because you can project and tell apart different choices of representation for positions. That is, I can represent <code>Just 3</code> by</p>\n\n<pre><code>Just () :&lt; const 3\n</code></pre>\n\n<p>or by</p>\n\n<pre><code>Just True :&lt; \\ b -&gt; if b then 3 else 5\n</code></pre>\n\n<p>and in Coq, say, these are provably distinct.</p>\n\n<h3>Challenge: characterizing polymorphic functions</h3>\n\n<p>Every polymorphic function between container types is given in a particular way. There's that uniformity working to clarify our understanding again.</p>\n\n<p>If you have some</p>\n\n<pre><code>f : {X : Set} -&gt; [ S &lt;| T ]C X -&gt; [ S' &lt;| T' ]C X\n</code></pre>\n\n<p>it is (extensionally) given by the following data, which make no mention of elements whatsoever:</p>\n\n<pre><code>toS    : S -&gt; S'\nfromP  : (s : S) -&gt; P' (toS s) -&gt; P s\n\nf (s , k) = (toS s , k o fromP s)\n</code></pre>\n\n<p>That is, the only way to define a polymorphic function between containers is to say how to translate input shapes to output shapes, then say how to fill output positions from input positions.</p>\n\n<p>For your preferred representation of strictly positive functors, give a similarly tight characterisation of the polymorphic functions which eliminates abstraction over the element type. (For descriptions, I would use exactly their reducability to containers.)</p>\n\n<h3>Challenge: capturing \"transposability\"</h3>\n\n<p>Given two functors, <code>f</code> and <code>g</code>, it is easy to say what their composition <code>f o g</code> is: <code>(f o g) x</code> wraps up things in <code>f (g x)</code>, giving us \"<code>f</code>-structures of <code>g</code>-structures\". But can you readily impose the extra condition that all of the <code>g</code> structures stored in the <code>f</code> structure have the same shape?</p>\n\n<p>Let's say that <code>f &gt;&lt; g</code> captures the <em>transposable</em> fragment of <code>f o g</code>, where all the <code>g</code> shapes are the same, so that we can just as well turn the thing into a <code>g</code>-structure of <code>f</code>-structures. E.g., while <code>[] o []</code> gives <em>ragged</em> lists of lists, <code>[] &gt;&lt; []</code> gives <em>rectangular</em> matrices; <code>[] &gt;&lt; Maybe</code> gives lists which are either all <code>Nothing</code> or all <code>Just</code>.</p>\n\n<p>Give <code>&gt;&lt;</code> for your preferred representation of strictly positive functors. For containers, it's this easy.</p>\n\n<pre><code>(S &lt;| P) &gt;&lt; (S' &lt;| P') = (S * S') &lt;| \\ { (s , s') -&gt; P s * P' s' }\n</code></pre>\n\n<h3>Conclusion</h3>\n\n<p>Containers, in their normalized Sigma-then-Pi form, are not intended to be an efficient machine representation of data. But the knowledge that a given functor, implemented however, has a presentation as a container helps us understand its structure and give it useful equipment. Many useful constructions can be given abstractly for containers, once for all, when they must be given case-by-case for other presentations. So, yes, it is a good idea to learn about containers, if only to grasp the rationale behind the more specific constructions you actually implement.</p>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 11, "accepted_answer_id": 34346484, "answer_count": 1, "score": 35, "last_activity_date": 1476604243, "creation_date": 1450355750, "last_edit_date": 1495539996, "question_id": 34334773, "link": "https://stackoverflow.com/questions/34334773/why-do-we-need-containers", "title": "Why do we need containers?", "body": "<p>(As an excuse: the title mimics the title of <a href=\"https://stackoverflow.com/questions/28139259/why-do-we-need-monads\">Why do we need monads?</a>)</p>\n\n<p>There are <a href=\"http://www.sciencedirect.com/science/article/pii/S0304397505003373\" rel=\"nofollow noreferrer\">containers</a> (and <a href=\"http://strictlypositive.org/indexed-containers.pdf\" rel=\"nofollow noreferrer\">indexed</a> ones) (and <a href=\"https://pigworker.wordpress.com/2015/06/06/hasochistic-containers-a-first-attempt/\" rel=\"nofollow noreferrer\">hasochistic</a> ones) and <a href=\"http://www.ioc.ee/~james/papers/levitation.pdf\" rel=\"nofollow noreferrer\">descriptions</a>. But containers are <a href=\"http://mazzo.li/epilogue/index.html%3Fp=324.html\" rel=\"nofollow noreferrer\">problematic</a> and to my very small experience it's harder to think in terms of containers than in terms of descriptions. The type of non-indexed containers is isomorphic to <code>\u03a3</code> \u2014 that's quite too unspecific. The shapes-and-positions description helps, but in</p>\n\n<pre><code>\u27e6_\u27e7\u1d9c : \u2200 {\u03b1 \u03b2 \u03b3} -&gt; Container \u03b1 \u03b2 -&gt; Set \u03b3 -&gt; Set (\u03b1 \u2294 \u03b2 \u2294 \u03b3)\n\u27e6 Sh \u25c3 Pos \u27e7\u1d9c A = \u2203 \u03bb sh -&gt; Pos sh -&gt; A\n\nK\u1d9c : \u2200 {\u03b1 \u03b2} -&gt; Set \u03b1 -&gt; Container \u03b1 \u03b2\nK\u1d9c A = A \u25c3 const (Lift \u22a5)\n</code></pre>\n\n<p>we are essentially using <code>\u03a3</code> rather than shapes and positions.</p>\n\n<p>The type of strictly-positive free monads over containers has a rather straightforward definition, but the type of <code>Freer</code> monads looks simpler to me (and in a sense <code>Freer</code> monads are even better than usual <code>Free</code> monads as described in the <a href=\"http://okmij.org/ftp/Haskell/extensible/more.pdf\" rel=\"nofollow noreferrer\">paper</a>).</p>\n\n<p>So what can we do with containers in a nicer way than with descriptions or something else?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1450354306, "post_id": 34334242, "comment_id": 56409744, "body": "It looks to me like <code>encodeUtf8</code> or similar should work. When you say it &quot;does not compile&quot;, what does it fail with exactly?"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1450354388, "post_id": 34334242, "comment_id": 56409787, "body": "added that compiler message now too"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1450354693, "post_id": 34334242, "comment_id": 56409997, "body": "Right. So <code>encodeUtf8</code> wants a lazy <code>Text</code>, but you have a strict <code>Text</code>. I think there&#39;s a conversion function somewhere... Yeah, try <code>Data.Text.Lazy.toStrict</code> or <code>fromStrict</code>."}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1450355348, "post_id": 34334242, "comment_id": 56410446, "body": "Yes! That fixed it. I think I thought that using the lazy library would ensure the conversion to lazy for me"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1450389044, "post_id": 34334242, "comment_id": 56431391, "body": "Turned out that the use of _String was affecting things while being unneeded anyway and then everything joined up now easily anyway"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1450362450, "creation_date": 1450362450, "answer_id": 34336997, "question_id": 34334242, "link": "https://stackoverflow.com/questions/34334242/lazy-bytestring-insanity/34336997#34336997", "title": "Lazy bytestring insanity", "body": "<p>To summarise: <code>encodeUtf8</code> is the right way to go. It seems the one you're using is from <code>Data.Text.Lazy.Encoding</code>, which requires a lazy <code>Text</code>. You can use <code>Data.Text.Lazy.fromStrict</code> to convert... Or you can look into <code>Data.Text.Encoding</code>, which works on strict <code>Text</code> (but then gives you a strict <code>ByteString</code>...)</p>\n"}], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "accepted_answer_id": 34336997, "answer_count": 1, "score": 1, "last_activity_date": 1450362450, "creation_date": 1450354100, "last_edit_date": 1450354366, "question_id": 34334242, "link": "https://stackoverflow.com/questions/34334242/lazy-bytestring-insanity", "title": "Lazy bytestring insanity", "body": "<p>I'm really struggling to square this circle.</p>\n\n<p>getPostContent uses Wreq to download a blog post and return it.</p>\n\n<pre><code>getPostContent url = do\n    let opts = defaults &amp; W.checkStatus .~ (Just $ \\_ _ _ -&gt; Nothing)\n\n    postResp &lt;- getWith opts $ baseUrl ++ url\n    if postResp ^. W.responseStatus . statusCode == 200\n        -- then return $ LEnc.encodeUtf8 $ postResp ^. W.responseBody . _String      -- :: Prism T Text\n        then return $ postResp ^. W.responseBody . _String\n        else return \"error downloading\"\n</code></pre>\n\n<p>This is consumed by parseLBS</p>\n\n<pre><code>do\n     page &lt;- getPostContent r -- :: IO String\n     let\n     -- parseLBS :: Data.ByteString.Lazy.Internal.ByteString -&gt; Text.XML.Document\n     cursor = fromDocument $ parseLBS page\n</code></pre>\n\n<p>As I understand it, getPostContent is providing <code>Data.Text.Text</code>, whereas I need <code>Data.ByteString.Lazy.Internal.ByteString</code> and I cannot work out how to convert them ( thought it should be <a href=\"http://hackage.haskell.org/package/text-1.2.1.3/docs/Data-Text-Lazy-Encoding.html#v:encodeUtf8\" rel=\"nofollow\">this</a>, see code snippet above, but it does not compile either).</p>\n\n<pre><code>   Couldn't match expected type \u2018Data.ByteString.Lazy.Internal.ByteString\u2019\n                with actual type \u2018T.Text\u2019\n    In the first argument of \u2018parseLBS\u2019, namely \u2018page\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018parseLBS page\u2019\n</code></pre>\n\n<p>Compilation message with encode uncommented</p>\n\n<pre><code>Couldn't match type \u2018TL.Text\u2019\n               with \u2018T.Text\u2019\nNB: \u2018TL.Text\u2019 is defined in \u2018Data.Text.Internal.Lazy\u2019\n    \u2018T.Text\u2019 is defined in \u2018Data.Text.Internal\u2019\nExpected type: (TL.Text -&gt; Const TL.Text TL.Text)\n               -&gt; Data.ByteString.Lazy.Internal.ByteString\n               -&gt; Const TL.Text Data.ByteString.Lazy.Internal.ByteString\n  Actual type: (T.Text -&gt; Const TL.Text T.Text)\n               -&gt; Data.ByteString.Lazy.Internal.ByteString\n               -&gt; Const TL.Text Data.ByteString.Lazy.Internal.ByteString\nIn the second argument of \u2018(.)\u2019, namely \u2018_String\u2019\nIn the second argument of \u2018(^.)\u2019, namely \u2018responseBody . _String\u2019\n</code></pre>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 2, "creation_date": 1450352217, "post_id": 34333432, "comment_id": 56408438, "body": "Please show your code, <code>intersect</code> should work fine for you"}], "answers": [{"comments": [{"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 1, "creation_date": 1450352583, "post_id": 34333563, "comment_id": 56408664, "body": "Filter would also work: <code>filter (`elem` list2) list1</code> :)"}, {"owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "edited": false, "score": 0, "creation_date": 1450353670, "post_id": 34333563, "comment_id": 56409387, "body": "In your answer <code>intersect</code> compares all elements of the tuple, but I think topic starter wants to find all intersections based on comparison of the first only element of tuple."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 4, "last_activity_date": 1450352037, "creation_date": 1450352037, "answer_id": 34333563, "question_id": 34333432, "link": "https://stackoverflow.com/questions/34333432/intersection-of-lists-of-tuples-haskell/34333563#34333563", "title": "Intersection of lists of tuples - Haskell", "body": "<p>Try with a list comprehension:</p>\n\n<pre><code>[x | x &lt;- list1, x `elem` list2]\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>Prelude&gt; let list1 = [(1,2), (2,3), (3,4)]\nPrelude&gt; let list2 = [(1,2), (2,3), (3,5)]\nPrelude&gt; [x | x &lt;- list1, x `elem` list2]\n[(1,2),(2,3)]\n</code></pre>\n\n<p>Anyway, <code>intersect</code> should work, it works for me:</p>\n\n<pre><code>Prelude&gt; import Data.List\nPrelude Data.List&gt; list1 `intersect` list2\n[(1,2),(2,3)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 348, "user_id": 310378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/36752538526b328cb5c451a19a257b0d?s=128&d=identicon&r=PG", "display_name": "kureta", "link": "https://stackoverflow.com/users/310378/kureta"}, "edited": false, "score": 0, "creation_date": 1477838079, "post_id": 34334020, "comment_id": 67915296, "body": "I guess this returns the matching tuple from the left list. Can we tell something like <code>intersectBy ((==) `on` fst)</code> and <code>select (min `on` snd)</code>?"}], "tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 2, "last_activity_date": 1450353400, "creation_date": 1450353400, "answer_id": 34334020, "question_id": 34333432, "link": "https://stackoverflow.com/questions/34333432/intersection-of-lists-of-tuples-haskell/34334020#34334020", "title": "Intersection of lists of tuples - Haskell", "body": "<p>You can use <code>Data.Function.on</code> function to supply function you need to the first (or second) element of the tuple: </p>\n\n<pre><code>import Data.Function (on)\nimport Data.List (intersectBy)\n\nintersectBy ((==) `on` fst) [(1,2), (2,3), (3,4)] [(1,2), (2,3), (3,5)]\n&gt; [(1,2),(2,3),(3,4)]\n</code></pre>\n"}], "owner": {"reputation": 130, "user_id": 5112919, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d11c7178696614975ee6140c61e9ebe6?s=128&d=identicon&r=PG&f=1", "display_name": "Nowandthen98", "link": "https://stackoverflow.com/users/5112919/nowandthen98"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 34333563, "answer_count": 2, "score": 1, "last_activity_date": 1450353400, "creation_date": 1450351612, "question_id": 34333432, "link": "https://stackoverflow.com/questions/34333432/intersection-of-lists-of-tuples-haskell", "title": "Intersection of lists of tuples - Haskell", "body": "<p>I have two lists of tuples both of the form [(a,b),..].</p>\n\n<p>I wish to compare them and get the common elements - but have tried using intersect, but this does not work. Is there a way of using map/filter to output the intersection as a new list of tuples?</p>\n"}, {"tags": ["haskell", "existential-type", "gadt"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1450357654, "post_id": 34327356, "comment_id": 56411884, "body": "<code>myRNG = Foo $ state random</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1450332036, "post_id": 34327502, "comment_id": 56396812, "body": "I think there is merit to hiding the choice of <code>g</code>, since it forces you to not do anything instance-specific with it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450332395, "post_id": 34327502, "comment_id": 56396931, "body": "@Cactus, what&#39;s that win you?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450332443, "post_id": 34327502, "comment_id": 56396944, "body": "Well, for one, you can&#39;t replace the state, from the inside, with a new random generator pulled out of thin air."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450332609, "post_id": 34327502, "comment_id": 56397005, "body": "@Cactus, no, you can&#39;t do <i>that</i>, but you can reuse old ones as long as you wish, which is just as bad! This does stop you from leaking the generators, but what&#39;s the point?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1450332761, "post_id": 34327502, "comment_id": 56397072, "body": "Depending on what you want, maybe you want to forbid generator reuse, which you can do by exposing only <code>state random</code> and a <code>Monad</code> instance (i.e. no <code>MonadState</code>). But maybe you want to allow generator reuse. It depends on the use case."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1450331454, "last_edit_date": 1495539896, "creation_date": 1450331454, "answer_id": 34327502, "question_id": 34327356, "link": "https://stackoverflow.com/questions/34327356/hiding-a-state-monads-s-type-parameter/34327502#34327502", "title": "Hiding a State monad&#39;s s type parameter", "body": "<p>The problem is pretty much as you describe. You will not be able to unify the existentially wrapped random seed with your initial random seed. The most obvious approach is to drop the existential quantification altogether, and just use this:</p>\n\n<pre><code>runRandomly :: RandomGen g =&gt; State g a -&gt; g -&gt; a\nrunRandomly (Foo m) g = evalState m g\n</code></pre>\n\n<p>I don't see any problem with the most obvious approach in this context. If you really want to hide the seed type from the transformer, <a href=\"https://stackoverflow.com/a/34327506/1477667\">Cactus's answer</a> shows how to do it correctly.</p>\n\n<p>In some other contexts, some similar existential wrappings can work by wrapping up the seed along with the transformer:</p>\n\n<pre><code>data Foo a where\n  Foo :: RandomGen s =&gt; State s a -&gt; s -&gt; Foo a\n</code></pre>\n\n<p>You can see an example of something similar in the <code>foldl</code> package.</p>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 6, "last_activity_date": 1450332063, "last_edit_date": 1450332063, "creation_date": 1450331483, "answer_id": 34327506, "question_id": 34327356, "link": "https://stackoverflow.com/questions/34327356/hiding-a-state-monads-s-type-parameter/34327506#34327506", "title": "Hiding a State monad&#39;s s type parameter", "body": "<p>Existential quantification in the type of the <code>Foo</code> constructor would mean that for every value of type <code>Foo</code>, there is some instance of <code>RandomGen</code> that it uses as its state. You want the opposite, though: you want that given any value <code>foo :: Foo</code>, and <strong>any</strong> instance <code>g</code> of <code>RandomGen</code>, you can use <code>g</code> as the state of the computation encapsulated by <code>foo</code>.</p>\n\n<p>So let's write that instead:</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\n\nimport Control.Monad.State\nimport System.Random\n\nnewtype Foo a = MkFoo{ unFoo :: forall g. (RandomGen g) =&gt; State g a }\n\nevalFoo :: RandomGen g =&gt; Foo a -&gt; g -&gt; a\nevalFoo = evalState . unFoo\n</code></pre>\n\n<p>This can be used as expected:</p>\n\n<pre><code>myRNG :: Foo Double\nmyRNG = MkFoo $ do\n    u &lt;- state random\n    return u\n</code></pre>\n\n<p>giving</p>\n\n<pre><code>*Main&gt; evalFoo myRNG (mkStdGen 123)\n0.43927189736460226\n</code></pre>\n\n<p>Yeah, not quite 0.78 ;)</p>\n"}], "owner": {"reputation": 517, "user_id": 400405, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c5526c6d8fbdd01a7dd23b384b972ded?s=128&d=identicon&r=PG", "display_name": "icz", "link": "https://stackoverflow.com/users/400405/icz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 34327506, "answer_count": 2, "score": 6, "last_activity_date": 1450332270, "creation_date": 1450330702, "last_edit_date": 1450332270, "question_id": 34327356, "link": "https://stackoverflow.com/questions/34327356/hiding-a-state-monads-s-type-parameter", "title": "Hiding a State monad&#39;s s type parameter", "body": "<p>I'm trying to hide the type parameter of a <code>State</code> monad in a new type, but I'm having a hard time unifying the existentially qualified <code>s</code> with the <code>g</code> to be provided for <code>evalFoo</code>. I've tried with <code>ExistentialQuantification</code>, <code>GADTs</code>, and <code>RankNTypes</code>, but have an admittedly very poor understanding of how these extensions work.</p>\n\n<p>How would the idiomatic Haskell way to accomplish this look?\nThanks!</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Control.Monad.State\nimport System.Random\n\ndata Foo a where\n  Foo :: RandomGen s =&gt; State s a -&gt; Foo a\n\nevalFoo :: RandomGen g =&gt; Foo a -&gt; g -&gt; a\nevalFoo (Foo m) g = evalState m g\n</code></pre>\n\n<p>The goal is to achieve something like this, but to able to supply any instance of <code>RandomGen</code>:</p>\n\n<pre><code>myRNG :: Foo Double\nmyRNG = Foo $ do\n  u &lt;- state random\n  return u\n\nPrelude&gt; evalFoo myRNG (mkStdGen 123)\n0.7804356004944119\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad", "io-monad"], "comments": [{"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 0, "creation_date": 1450329784, "post_id": 34327146, "comment_id": 56396052, "body": "I don&#39;t understand. What happens now?"}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 3, "creation_date": 1450330951, "post_id": 34327146, "comment_id": 56396407, "body": "@Michael: They\u2019ve written some code using monad transformers without the stack explicitly specified, and they\u2019re asking how to construct and run a stack of monad transformers to get the desired behavior."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1450331319, "post_id": 34327381, "comment_id": 56396553, "body": "great answer - you can shorten the last part a bit using <code>evalRandIO</code> as should  <code>evalRandIO $ evalStateT bar False</code> work as well"}], "tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 3, "last_activity_date": 1450331539, "last_edit_date": 1450331539, "creation_date": 1450330849, "answer_id": 34327381, "question_id": 34327146, "link": "https://stackoverflow.com/questions/34327146/run-this-monadic-computation-with-notion-of-state-and-randomness/34327381#34327381", "title": "Run this monadic computation with notion of state and randomness", "body": "<p>In short:</p>\n\n<pre><code>evalRandIO $ evalStateT bar False\n</code></pre>\n\n<p>Let\u2019s pick this apart. <code>bar</code> needs to be able to maintain a <code>Bool</code> as a state, and be able to get random values. We could nest it either way; here, I chose to layer the state atop the random, but you could do it the other way around.</p>\n\n<p><code>evalStateT</code> has this type signature:</p>\n\n<pre><code>evalStateT :: Monad m =&gt; StateT s m a -&gt; s -&gt; m a\n</code></pre>\n\n<p>In words, given something that needs a state layered atop some other monad, it implements that state part and gives you that action in terms of the underlying monad. The <code>eval</code> part of the name means that it will throw out the resulting state and give you just the value; there is also <code>execStateT</code> that gives you the resulting state and throws out the output, and <code>runStateT</code> that gives you a tuple of both. I should note that in any case, we have to give it an initial state. Your code doesn\u2019t use the initial state, so we could just as well have used <code>undefined</code>, but I used <code>False</code> for the heck of it.</p>\n\n<p>So now that we\u2019ve implemented the state bit, what do we have left?</p>\n\n<pre><code>ghci&gt; :t evalStateT bar False\nevalStateT bar False :: MonadRandom m =&gt; m Bool\n</code></pre>\n\n<p>It wants a monad that can give it random values. Well, we have one of those. <code>Rand</code> will do it. <code>Rand</code>, too, has <code>run</code>, <code>eval</code>, and <code>exec</code> variants, since it\u2019s actually a state monad too; it holds a value of some type of class <code>RandomGen</code> under the covers. Here, we <em>don\u2019t</em> want to discard the state at the end, and we <em>do</em> want to keep the result, too, so we use the <code>run</code> variant. Well, what do we have now?</p>\n\n<pre><code>ghci&gt; :t runRand (evalStateT bar False)\nrunRand (evalStateT bar False) :: RandomGen g =&gt; g -&gt; (Bool, g)\n</code></pre>\n\n<p>For comparison:</p>\n\n<pre><code>ghci&gt; :t random\nrandom :: (RandomGen g, Random a) =&gt; g -&gt; (a, g)\n</code></pre>\n\n<p>So now we have a plain function that takes a random-number generator state and spits out a pair with a result and a new state, just like <code>random</code> itself from <code>System.Random</code>. How can we use this? Well, digging through the <code>System.Random</code> module, <code>getStdRandom</code> looks useful:</p>\n\n<pre><code>getStdRandom :: (StdGen -&gt; (a, StdGen)) -&gt; IO a\n</code></pre>\n\n<p>It takes a function like the one we have and turns it into an <code>IO</code> action.  (This makes sense that it would be <code>IO</code>; it\u2019s taking some global state (namely, the standard random number generator) and updating it.)  What do we have after tacking that on?</p>\n\n<pre><code>ghci&gt; :t getStdRandom . runRand $ evalStateT bar False\ngetStdRandom . runRand $ evalStateT bar False :: IO Bool\n</code></pre>\n\n<p>Exactly what we expect: an <code>IO</code> that yields a <code>Bool</code>.  Run it a few times:</p>\n\n<pre><code>ghci&gt; let barIO = getStdRandom . runRand $ evalStateT bar False\nghci&gt; barIO\nTrue\nghci&gt; barIO\nTrue\nghci&gt; barIO\nFalse\n</code></pre>\n\n<p>Random enough for me.  However, <a href=\"https://stackoverflow.com/questions/34327146/run-this-monadic-computation-with-notion-of-state-and-randomness/34327381?noredirect=1#comment56396553_34327381\">as Carsten mentions in the comments</a>, there\u2019s a shorter way.  Since this is such a common use-case, the <code>Control.Monad.Random</code> module provides a shortcut, <code>evalRandIO</code>, which is essentially the <code>getStdRandom . runRand</code> we used above.  It\u2019s a simple replacement to end up with</p>\n\n<pre><code>evalRandIO $ evalStateT bar False\n</code></pre>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 34327381, "answer_count": 1, "score": 1, "last_activity_date": 1450331539, "creation_date": 1450329580, "question_id": 34327146, "link": "https://stackoverflow.com/questions/34327146/run-this-monadic-computation-with-notion-of-state-and-randomness", "title": "Run this monadic computation with notion of state and randomness", "body": "<p>I describe the following computation:</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Monad.Identity\nimport Control.Monad.Random.Class\n\n-- * fair coin\nfair :: MonadRandom m =&gt; m Bool\nfair = (\\p -&gt; p &lt;= 0.5) &lt;$&gt; getRandomR (0,1 :: Double)\n\n-- * how do i run this \nbar :: (MonadState Bool m, MonadRandom m) =&gt; m Bool\nbar = fair &gt;&gt;= \\b -&gt; put b &gt;&gt; return b\n</code></pre>\n\n<p>And I would like to know how to run <code>bar</code> so that in expectation, <code>bar</code> evaluates to <code>True</code> half of the time. </p>\n"}, {"tags": ["haskell", "agda"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1450324273, "post_id": 34326207, "comment_id": 56394551, "body": "Note that whatever you end up using for sections, you won&#39;t be able to use it with operators where the second argument&#39;s type depends on the first value."}], "answers": [{"comments": [{"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 0, "creation_date": 1450377086, "post_id": 34326523, "comment_id": 56424927, "body": "That&#39;s awesome! But I&#39;m not very techy-savvy, or in immediate need of the feature, so I think I&#39;ll have to wait for the released version."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 6, "last_activity_date": 1450345974, "last_edit_date": 1450345974, "creation_date": 1450325811, "answer_id": 34326523, "question_id": 34326207, "link": "https://stackoverflow.com/questions/34326207/haskell-sections-in-agda/34326523#34326523", "title": "Haskell Sections in Agda", "body": "<p>The development version of Agda (2.4.3) has sections:</p>\n\n<pre><code>open import Function\n\nok\u2081 : \u2200{a b}{A : Set a}{B : Set b} \u2192 A \u2192 (A \u2192 B) \u2192 B\nok\u2081 x = _$ x\n\nok\u2082 : \u2200{A : Set} \u2192 (\u2200{B : Set} \u2192 B) \u2192 (\u2200{B : Set} \u2192 B \u2192 A) \u2192 A\nok\u2082 {A} bs = _$ (bs {A})\n\nok\u2083 : \u2200{a b}{A : Set a}{B : Set b} \u2192 (A \u2192 B) \u2192 A \u2192 B\nok\u2083 f = f $_\n</code></pre>\n"}], "owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 34326523, "answer_count": 1, "score": 3, "last_activity_date": 1450345974, "creation_date": 1450323475, "question_id": 34326207, "link": "https://stackoverflow.com/questions/34326207/haskell-sections-in-agda", "title": "Haskell Sections in Agda", "body": "<p>In Haskell we can section a binary operation <code>\u2295</code> to obtain two functions\n<code>(x \u2295)</code> and <code>(\u2295 y)</code>. As far as I know, we can mimic the first section by writing <code>_\u2295_ x</code> but can we do so cleanly for the second section?</p>\n\n<p><strong>Example</strong>\nHere I define an already sectioned version of Agda library's <code>Function._$_</code> to perform the second section as mentioned above.\nHowever, it does not work in my desired case below and I do not know why.\nAny insight is welcome!</p>\n\n<pre><code>$ : \u2200 {a b} {A : Set a} {B : A \u2192 Set b} \u2192 (x : A) \u2192 ((y : A) \u2192 B y) \u2192 B x\n$ x = \u03bb f \u2192 f x\n\nsuccess-usage : \u2200{a b}{A : Set a}{B : Set b} \u2192 A \u2192 (A \u2192 B) \u2192 B\nsuccess-usage x = $ x\n\nfailed-usage : \u2200{A : Set} \u2192 (\u2200{B : Set} \u2192 B) \u2192 (\u2200{B : Set} \u2192 B \u2192 A) \u2192 A\nfailed-usage {A} bs = $ (bs {A})\n-- works : \u03bb {A} bs f \u2192 $ (bs {A}) f\n</code></pre>\n\n<p>Thank-you :-)</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450319409, "post_id": 34325294, "comment_id": 56393148, "body": "You say you are looking for &quot;multiple ways&quot; - how should these different methods differ? Should they print each element differently? One way is <code>mapM_ print people</code>, another is <code>sequence_ (map print people)</code>, does this count as two different ways?"}, {"owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450321184, "post_id": 34325294, "comment_id": 56393668, "body": "Yes, I&#39;m just interested in seeing different methods of printing data types within Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 0, "creation_date": 1450317369, "post_id": 34325365, "comment_id": 56392569, "body": "Would this mean I would have to get rid of my attributes within my data structure and just have it read data Person = Person String String Int?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "edited": false, "score": 2, "creation_date": 1450317443, "post_id": 34325365, "comment_id": 56392591, "body": "No, I mean if you define <code>Person</code> exactly as you do in your question, one of the things you get from that (&quot;for free&quot;) is the selector function <code>firstName</code>. You don&#39;t need to (in fact, you can&#39;t, because of the naming clash) define <code>firstName</code>, the function, yourself if you already have <code>firstName</code>, the field."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1450317137, "creation_date": 1450317137, "answer_id": 34325365, "question_id": 34325294, "link": "https://stackoverflow.com/questions/34325294/printing-data-types-haskell/34325365#34325365", "title": "Printing data types - Haskell", "body": "<p>If you create a record type like <code>Person</code>, you get the following field selectors:</p>\n\n<pre><code>firstName :: Person -&gt; String\nlastName :: Person -&gt; String\nage :: Person -&gt; Int\n</code></pre>\n\n<p>So you can <code>map firstName</code> over your list to turn your <code>[Person]</code> into a <code>[String]</code>. </p>\n\n<p>Printing the <code>firstName</code>s, then, is a mere <code>mapM_ (putStrLn . firstName) people</code>.</p>\n"}], "owner": {"reputation": 149, "user_id": 3685916, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2a7d6a2040840f1e85d29ac0b7a12054?s=128&d=identicon&r=PG&f=1", "display_name": "Genesis", "link": "https://stackoverflow.com/users/3685916/genesis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1450352757, "creation_date": 1450316542, "last_edit_date": 1450352757, "question_id": 34325294, "link": "https://stackoverflow.com/questions/34325294/printing-data-types-haskell", "title": "Printing data types - Haskell", "body": "<pre><code>data Person = Person { firstName :: String\n                     , lastName :: String\n                     , age :: Int\n                     } deriving (Show)\n\n\nbuffy = Person \"Buffy\" \"Summers\" 22\nburt = Person \"Burt\" \"Reynolds\" 23\ncloud = Person \"Cloud\" \"Strife\" 22\nrick = Person \"Rick\" \"Sanchez\" 21\n\npeople = [buffy,burt,cloud,rick]\n</code></pre>\n\n<p>I'm looking for multiple ways of printing the <code>firstName</code>s of each element within the <code>people</code> list. </p>\n\n<p>Printing these elements can be printed in forms such as:</p>\n\n<ul>\n<li><code>x1,x2,x3,...xn</code></li>\n<li><p><code>[x1,x2,x3,...xn]</code></p></li>\n<li><p>Multiple lines:</p>\n\n<pre><code>x1  \nx2   \nx3   \n...  \nxn\n</code></pre></li>\n</ul>\n"}]