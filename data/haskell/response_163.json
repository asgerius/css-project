[{"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28662, "user_id": 10311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ee697b9dc2411d50fb66a4f330ba4df?s=128&d=identicon&r=PG", "display_name": "porges", "link": "https://stackoverflow.com/users/10311/porges"}, "is_accepted": true, "score": 5, "last_activity_date": 1519255353, "creation_date": 1519255353, "answer_id": 48917175, "question_id": 48917165, "link": "https://stackoverflow.com/questions/48917165/haskell-prelude-undefined-error/48917175#48917175", "title": "Haskell &quot;Prelude.undefined&quot; Error", "body": "<p>This means you have used <code>undefined</code> in your file <code>fileName.hs</code> on line <code>35</code>. You will need to replace <code>undefined</code> with a real definition in order to run your code. </p>\n\n<p><code>undefined</code> is only used while you're sketching out definitions, and acts as a placeholder (that will always typecheck) until you have written your real code. If you try to evaluate it at runtime you will get an error, as you have found!</p>\n"}], "owner": {"reputation": 29, "user_id": 8767484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8539d2604413246a935c5f3c5f9b4725?s=128&d=identicon&r=PG&f=1", "display_name": "Trent Frowiss", "link": "https://stackoverflow.com/users/8767484/trent-frowiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2935, "favorite_count": 0, "accepted_answer_id": 48917175, "answer_count": 1, "score": 0, "last_activity_date": 1519255353, "creation_date": 1519255201, "question_id": 48917165, "link": "https://stackoverflow.com/questions/48917165/haskell-prelude-undefined-error", "title": "Haskell &quot;Prelude.undefined&quot; Error", "body": "<p>I am fairly new to Haskell and I keep getting the following error, and I can't to figure out what is wrong (or even what it is trying to tell me). Any help would be appreciated!</p>\n\n<p>*** Exception: Prelude.undefined\nCallStack (from HasCallStack):\n  error, called at libraries/base/GHC/Err.hs:79:14 in base:GHC.Err\n  undefined, called at fileName.hs:35:12 in main:Main</p>\n"}, {"tags": ["haskell", "recursion", "show"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1519248737, "post_id": 48915793, "comment_id": 84838088, "body": "<code>showList [1,2,3]</code> doesn&#39;t appear to be even well-typed (unless you&#39;re using <code>-XOverloadedLists</code>). Please always add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to questions about errors or unexpected output, so we actually know what you&#39;re doing."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1519252084, "post_id": 48915793, "comment_id": 84839618, "body": "<code>show</code> is not equivalent to <code>id</code> when given a string."}], "answers": [{"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 1, "last_activity_date": 1519254478, "creation_date": 1519254478, "answer_id": 48917047, "question_id": 48915793, "link": "https://stackoverflow.com/questions/48915793/recursively-calling-in-a-show-function/48917047#48917047", "title": "Recursively calling in a show function", "body": "<p>You are basically calling <code>show</code> two times: you don't need that, once you got a string that's all what is required to implement <code>show</code>. So instead of this:</p>\n\n<pre><code>Prelude&gt; show [1,2,3]\n\"[1,2,3]\"\n</code></pre>\n\n<p>you are getting:</p>\n\n<pre><code>Prelude&gt; show $ show [1,2,3]\n\"\\\"[1,2,3]\\\"\"\n</code></pre>\n\n<p>And that's because in order to print <code>\"</code> Haskell needs to escape those with <code>\\</code>. </p>\n\n<p>Let's go back to your definition, you are trying to define a function of type <code>MyList a -&gt; String</code>, so basically we'll need to call <code>show</code> only over the elements of type <code>a</code> (I'd assume <code>h</code> is of type <code>a</code>, and this type is an instance of <code>Show</code>):</p>\n\n<pre><code>showList :: (Show a) =&gt; MyList a -&gt; String\nshowList Nil = \"\"\nshowlist (MyList h t) =  showlist(t) ++ show(h : [])\n</code></pre>\n\n<p>I'm assuming your list type is something like:</p>\n\n<pre><code>data MyList a = Nil | MyList a (MyList a)\n</code></pre>\n\n<p>So you'll get (I don't know why you are reversing the list when showing):</p>\n\n<pre><code>Prelude&gt; showList (MyList 1 (MyList 2 Nil))\n\"[2][1]\"\n</code></pre>\n\n<p>If you want, you can improve a little bit your show function by using <code>,</code>:</p>\n\n<pre><code>showList :: (Show a) =&gt; MyList a -&gt; String\nshowList Nil = \"\"\nshowlist (MyList h t) =  show h ++ \",\" ++ showlist t\n</code></pre>\n\n<p>Hence, you'll get:</p>\n\n<pre><code>Prelude&gt; showList (MyList 1 (MyList 2 Nil))\n\"1,2,\"\n</code></pre>\n\n<p>I leave you as an exercise how to properly place <code>,</code>,<code>[</code> and <code>]</code> to print likewise:</p>\n\n<pre><code>\"[1,2]\"\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 5285349, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/c6e48d86c74fd1fca638a7ca513297de?s=128&d=identicon&r=PG&f=1", "display_name": "JamalCrawford..", "link": "https://stackoverflow.com/users/5285349/jamalcrawford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519254478, "creation_date": 1519248593, "last_edit_date": 1519248823, "question_id": 48915793, "link": "https://stackoverflow.com/questions/48915793/recursively-calling-in-a-show-function", "title": "Recursively calling in a show function", "body": "<p>I am taking in a data type MyList which has a tail with list and a head.  Need to turn it into a reversed string like the haskell data type list. </p>\n\n<pre><code>showList :: MyList a -&gt; String\nshowlist (MyList h t) =  show(showlist(t) ++ show( h : [] ))\n</code></pre>\n\n<p>I am getting out this craziness for showList [1,2,3]</p>\n\n<pre><code>\"\\\"[3][2]\\\"[1]\"\n</code></pre>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 2, "last_activity_date": 1519247997, "creation_date": 1519247997, "answer_id": 48915666, "question_id": 48915665, "link": "https://stackoverflow.com/questions/48915665/running-an-action-if-part-of-a-file-changes/48915666#48915666", "title": "Running an Action if part of a file changes", "body": "<p>Your <code>askOracle</code> approach is pretty close, but Shake needs to be able to\nidentify the \"output\" of the action, so it can give it a persistent name\nbetween runs, so other steps can depend on it, and use that persistent name to avoid recomputing. One way to do that is to make the action create a stamp file, e.g.:</p>\n\n<pre><code>\"packages.stamp\" *&gt; \\out -&gt; do\n    _ &lt;- askOracle $ ElmDependencies ()\n    cmd_ \"elm package install --yes\"\n    writeFile' out \"\"\nwant [\"packages.stamp\"]\n</code></pre>\n\n<p>Separately, an alternative to using <code>Oracle</code> is to have a file\n<code>elm-package-dependencies.json</code> which you generate from\n<code>elm-package.json</code>, write using <code>writeFileIfChanged</code> (which gives you <code>Eq</code> for files), and depend on that\nfile in <code>packages.stamp</code>. That way you get <code>Eq</code> on files, and can also\neasily debug it or delete the <code>-dependencies.json</code> file to force a rerun.</p>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 48915666, "answer_count": 1, "score": 2, "last_activity_date": 1519247997, "creation_date": 1519247997, "question_id": 48915665, "link": "https://stackoverflow.com/questions/48915665/running-an-action-if-part-of-a-file-changes", "title": "Running an Action if part of a file changes", "body": "<p>What is the recommended way of running some <code>Action</code> if part of a file changes?</p>\n\n<p>My use-case is given a file that I know exists (concretely <code>elm-package.json</code>), run a shell command (<code>elm package install --yes</code>) if part of the file changes (the <code>dependencies</code> field).</p>\n\n<p>It seems that the <code>Oracle</code> abstraction exposes comparing a value to the last (via <code>Eq</code>). So I tried a <code>newtype</code> like:</p>\n\n<pre><code>newtype ElmDependencies = ElmDependencies () deriving ...\ntype instance RuleResult ElmDependencies = String\n</code></pre>\n\n<p>But now, I get stuck actually using this function of type <code>ElmDependencies -&gt; Action String</code>, since the rule I want to write doesn't actually care what the returned String is, it simply wants to be called if the String changes.</p>\n\n<p>In other words,</p>\n\n<pre><code>action $ do\n    _ &lt;- askOracle (ElmDependencies ())\n    cmd_ \"elm package install --yes\"\n</code></pre>\n\n<p>at the top-level doesn't work; it will run the action every time.</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519231263, "post_id": 48911040, "comment_id": 84828396, "body": "One is the one imported from <code>my-model-0.0.0</code> and the other is one you apparently have defined locally?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1519231294, "post_id": 48911040, "comment_id": 84828416, "body": "When ghc prefixes a type with a package+version in the error message, it usually means you are depending on two different versions of the same package.  GHC allows that, but it&#39;s easy to mix them up.  Try to redo your dependencies such that you only depend on one version of <code>my-model</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 4, "creation_date": 1519231466, "post_id": 48911040, "comment_id": 84828546, "body": "Oh, since they&#39;re both listed as <code>my-model-0.0.0</code>, I&#39;m betting you made changes to the package without updating the version, recompiled it, and didn&#39;t recompile everything that depended on it.  This is a dangerous workflow. (ghc distinguishes packages by a package-id hash internally, so it can tell the packages apart.  It only displays version numbers, so you can&#39;t tell them apart. This is a problem.)"}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519231687, "post_id": 48911040, "comment_id": 84828699, "body": "i added some details about package versions"}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519232971, "post_id": 48911040, "comment_id": 84829609, "body": "I&#39;m getting the suspicion this is because 10.5 changes Cabal to version 2, which is resulting in more modules being built as part of the test suite which then clash with the library versions. Can&#39;t see it in any Cabal migration guide though"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1519235526, "post_id": 48911040, "comment_id": 84831104, "body": "Can you add the output of <code>stack exec -- ghc-pkg list</code>?"}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519241157, "post_id": 48911040, "comment_id": 84834053, "body": "i have made a repro <a href=\"https://github.com/dten/CouldntMatchTypeRepro\" rel=\"nofollow noreferrer\">github.com/dten/CouldntMatchTypeRepro</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1519258722, "post_id": 48911040, "comment_id": 84841763, "body": "@dten I&#39;ve tried to build your repo and I cannot reproduce this issue (it builds successfully). I tried ghc-8.2.1+lts-10.6, ghc-8.2.1+nightly-2017-07-31, ghc-8.2.2+lts-10.6, ghc-8.2.2+lts-10.5. Can you try to reproduce on another machine (or in a VM)?"}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519262871, "post_id": 48911040, "comment_id": 84842827, "body": "I can release on other machines and a vm. Did you <code>stack test</code>? The test code is not built otherwise, which is what fails."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "edited": false, "score": 0, "creation_date": 1519890014, "post_id": 48911040, "comment_id": 85094196, "body": "Seems like a bug in stack. That is similar to an error I got when using multiple versions of a package at once."}], "answers": [{"comments": [{"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519300218, "post_id": 48926445, "comment_id": 84859415, "body": "i think using 8.2.1 makes stack use cabal 2.0, but with 8.0.2 it was using cabal 1.24, and this is only occurring with Cabal 2.0 then?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519300414, "post_id": 48926445, "comment_id": 84859541, "body": "The issues I mentioned seem to affect pre-2.0 Cabal as well."}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519300951, "post_id": 48926445, "comment_id": 84859905, "body": "i meant 1.26 above: also this comment mentions it is allowed since 1.26 <a href=\"https://github.com/haskell/cabal/pull/3422/files#diff-684698b6af4c57398afaa2c1e4194338R283\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/pull/3422/&hellip;</a>"}, {"owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "edited": false, "score": 0, "creation_date": 1519979321, "post_id": 48926445, "comment_id": 85135572, "body": "It looks like stack used to work around the missing cabal feature but for some reason now doesn&#39;t. Ended up moving the tests to another package so no package level cycle"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1519299345, "creation_date": 1519299345, "answer_id": 48926445, "question_id": 48911040, "link": "https://stackoverflow.com/questions/48911040/where-to-start-with-couldnt-match-type-myid-with-myid/48926445#48926445", "title": "Where to start with &quot;Couldn&#39;t match type MyId with MyId&quot;", "body": "<p>That appears to be a bug in Cabal, or at least a missing feature. I don't know why it works with older resolvers. <a href=\"https://github.com/commercialhaskell/stack/issues/2800\" rel=\"nofollow noreferrer\">Issue 2800</a> on stack mentions this. See <a href=\"https://github.com/haskell/cabal/issues/1575\" rel=\"nofollow noreferrer\">issue 1575</a>, <a href=\"https://github.com/haskell/cabal/issues/4087\" rel=\"nofollow noreferrer\">issue 4087</a> on Cabal.</p>\n"}], "owner": {"reputation": 2304, "user_id": 645599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NQKcH.jpg?s=128&g=1", "display_name": "dten", "link": "https://stackoverflow.com/users/645599/dten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 48926445, "answer_count": 1, "score": 3, "last_activity_date": 1519299345, "creation_date": 1519231075, "last_edit_date": 1519244570, "question_id": 48911040, "link": "https://stackoverflow.com/questions/48911040/where-to-start-with-couldnt-match-type-myid-with-myid", "title": "Where to start with &quot;Couldn&#39;t match type MyId with MyId&quot;", "body": "<p>Edit: very small repro available <a href=\"https://github.com/dten/CouldntMatchTypeRepro\" rel=\"nofollow noreferrer\">https://github.com/dten/CouldntMatchTypeRepro</a></p>\n\n<p><code>stack test</code> worked fine on stack LTS-8.24 (ghc 8.0.2) and i tried to change to LTS-10.5 (ghc 8.2.2). It now fails type checking and the error message is less than helpful.</p>\n\n<p>The MyId types listed literally are the same type, declared in <code>my-model</code> <code>makeId</code> is in a <code>testing-help</code> package that references <code>my-model</code> and this code is in a <code>test</code> package that references both. </p>\n\n<p><em>Moving the function to the my-model package results in no error</em> (but I don't want to, and I have the problem with other types even in the same package (always a usage in the test package))\nI have read through migration info to 8.2 but nothing stood out.\nAny pointer in the correct direction is appreciated :) thanks</p>\n\n<pre><code>test\\Spec.hs:785:11: error:\n    * Couldn't match type `my-model-0.0.0:Types.Ids.MyId'\n                     with `MyId'\n      NB: `MyId'\n            is defined in `Types.Ids' in package `my-model-0.0.0'\n          `my-model-0.0.0:Types.Ids.MyId'\n            is defined in `Types.Ids' in package `my-model-0.0.0'\n      Expected type: UserId\n        Actual type: my-model-0.0.0:Types.Ids.MyId\n    * In the expression: makeId \"19186adb-26e5-4901-956c-f3ba11fc016d\"\n      In an equation for `userId':\n          userId = makeId \"19186adb-26e5-4901-956c-f3ba11fc016d\"\n    |\n785 | userId = makeId \"19186adb-26e5-4901-956c-f3ba11fc016d\"\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>edits: I have tried deleting <code>.stack-work</code> and even <code>~/stack-root</code></p>\n\n<p>the packages layout is as follows:</p>\n\n<pre><code>package: my-model\n  library\n  test-suite test\n     deps: my-model, testing-help\npackage: testing-help\n  library\n     deps: my-model\n</code></pre>\n\n<p>no version requirements are set (because it's stack LTS style) and all versions of my packages are 0.0.0</p>\n\n<p>edit2: they're all in 1 <code>stack.yaml</code></p>\n\n<p>edit3: sorry got package deps wrong</p>\n"}, {"tags": ["haskell", "gnupg"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1519244460, "post_id": 48908274, "comment_id": 84835891, "body": "If the package exposes an API with which you can cause a segfault then I&#39;d call that a bug and file an issue (separately, in addition to the other bug you discuss)."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519286677, "post_id": 48908274, "comment_id": 84851001, "body": "I opened an issue on github, hoping this is still active"}], "answers": [{"tags": [], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "is_accepted": false, "score": 0, "last_activity_date": 1519287954, "creation_date": 1519287954, "answer_id": 48922657, "question_id": 48908274, "link": "https://stackoverflow.com/questions/48908274/using-crypto-gpgme-to-check-signatures/48922657#48922657", "title": "Using Crypto Gpgme to check signatures", "body": "<p>Just figured out the problem, I had a setCurrentDirectory somewhere else in my code and the path got invalid. I'm guessing the Ctx must store the path to the gpghome, and using SetCurrentDirectory basically makes the Ctx invalid.</p>\n\n<p>There is still a bug with verifyPlain' causing a segfault, but I'll see about that on the github issue.</p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1519287954, "creation_date": 1519223016, "question_id": 48908274, "link": "https://stackoverflow.com/questions/48908274/using-crypto-gpgme-to-check-signatures", "title": "Using Crypto Gpgme to check signatures", "body": "<p>I'm trying to use Crypto.Gpgme to check pgp signatures.\nI have a couple of functions :</p>\n\n<pre><code>parseData signedData = do\n  res &lt;- liftIO $ verifyPlain' \"gpghome\" (DBL.toStrict signedData) \"\"\n  case res of\n    Left err -&gt; return $ Left $ errorString err\n    Right ((err, _, fg):xs, msg) -&gt; case errorString err of\n      \"Success\" -&gt; return $ Right (fg, msg)\n      _         -&gt; return $ Left $ errorString err\n\nparseRequest d = do\n  parsed &lt;- parseData d\n  case parsed of\n    Left err        -&gt; throw $ UnknownError err\n    Right (fg, msg) -&gt; return (fg, msg)\n</code></pre>\n\n<p>That way from Web.Scotty I can just use <code>(fg, msg) &lt;- parseRequest =&lt;&lt; body</code> to get the fingerprint of the signing key, and the signed message (I use the fingerprint for auth, and the message is the actual request).</p>\n\n<p>That code does not work, it segfaults.\nI've found something that does work :</p>\n\n<pre><code>parseData signedData ctx = do\n  res &lt;- verifyPlain ctx (DBL.toStrict signedData) \"\"\n  case res of\n    Left err -&gt; return $ Left $ errorString err\n    Right ((err, _, fg):xs, msg) -&gt; case errorString err of\n      \"Success\" -&gt; return $ Right (fg, msg)\n      _         -&gt; return $ Left $ errorString err\n\nparseRequest d = do\n  parsed &lt;- liftIO $ withCtx \"gpghome\" \"C\" OpenPGP $ parseData d\n  case parsed of\n    Left err        -&gt; throw $ UnknownError err\n    Right (fg, msg) -&gt; return (fg, msg)\n</code></pre>\n\n<p>So that's fine, I guess errorString accesses the Ctx for some reason, whatever.\nNow to my actual real problem, that code works only once. If I try to check the same query twice, the first one works fine, the second one gives UnknownError \"No public key\", so it looks like parseRequest gets a Left for no good reason.</p>\n\n<p>I'm guessing there's a bug in the library, and it must not free something correctly between requests or something. I tried allocating a ctx in my main, and using that one ctx everywhere, but same error.\nAny idea of what I'm doing wrong, if it's me, or how to fix that or work around it if it's the library ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1519218362, "post_id": 48906692, "comment_id": 84819034, "body": "Related: <a href=\"https://stackoverflow.com/questions/48884276/why-does-this-function-doesnt-work-if-i-use-xs-instead-of-xs/48884382#48884382\" title=\"why does this function doesnt work if i use xs instead of xs\">stackoverflow.com/questions/48884276/&hellip;</a> (sigh)"}, {"owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "edited": false, "score": 0, "creation_date": 1519282649, "post_id": 48906692, "comment_id": 84848914, "body": "bean :: [a] -&gt; Int -&gt; a bean a b = last $ take (b + 1) a"}], "owner": {"reputation": 11, "user_id": 7950278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a27f68b0b8c5f8ae206a00bf0eb2b5?s=128&d=identicon&r=PG&f=1", "display_name": "Bean_Nan", "link": "https://stackoverflow.com/users/7950278/bean-nan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "closed_date": 1519219690, "answer_count": 0, "score": 0, "last_activity_date": 1519218344, "creation_date": 1519218323, "last_edit_date": 1519218344, "question_id": 48906692, "link": "https://stackoverflow.com/questions/48906692/haskellnon-exhaustive-patterns-in-function-bean", "closed_reason": "Duplicate", "title": "Haskell:Non-exhaustive patterns in function bean", "body": "<p>I get non exhaustive patterns exception for the following code</p>\n\n<pre><code>bean :: [a] -&gt; Int -&gt; a\nbean [a] b = last $ take (b + 1) [a]\n</code></pre>\n\n<p>I don't understand what I am doing wrong here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519206933, "post_id": 48902820, "comment_id": 84810959, "body": "I can not reproduce it. The only problem I can see here is that you defined it as <code>Float -&gt; Float</code>, but later in your question, you specify it as <code>Int -&gt; Float</code>."}, {"owner": {"reputation": 31, "user_id": 9390184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16276855ee52808829c605e73d07f320?s=128&d=identicon&r=PG&f=1", "display_name": "Bob Simon", "link": "https://stackoverflow.com/users/9390184/bob-simon"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519207300, "post_id": 48902820, "comment_id": 84811268, "body": "English is not my first language so sorry if I&#39;m not clear. <code>farenheitToCelcius :: Float -&gt; Float</code> results in working code but <code>replacing it with </code>farenheitToCelcius :: Int -&gt; Float` does not. I don&#39;t however understand why it doesn&#39;t work."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1519207434, "post_id": 48902820, "comment_id": 84811363, "body": "I assume that the division <code>5&#47;9</code> is using the fractional division, which is not defined for <code>Int</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519207951, "post_id": 48902820, "comment_id": 84811737, "body": "Even if this wasn&#39;t a type error... it basically never makes sense to represent a physical quantity like temperature by an integer, why do you want that?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519208618, "post_id": 48902820, "comment_id": 84812263, "body": "@leftaroundabout It makes perfect sense to represent physical quantities by integers. Lots of sensors (maybe even most) work that way. The way it&#39;s used in this particular instance (just ignoring fractional parts) isn&#39;t a good way to handle this, but I&#39;m guessing OP just wanted to know why this is a type error."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519209174, "post_id": 48902820, "comment_id": 84812661, "body": "@Cubic no it doesn&#39;t make sense. Those sensors actually work with <i>fixed-precision real numbers</i>, i.e. floats with a fixed exponent, as it were. Yes, low-level languages may simply use an integer for this, but that&#39;s really unsafe \u2013 if you do any kind of computation, in particular involving sensors with different precision, you get utter garbage results. Quantifying everything to integer of some single conventional unit needlessly reduces the precision further. Floating-point largely avoids those problems, though one should still use wrappers to avoid unit mismatches. (Mars Climate Orbiter...)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519212849, "post_id": 48902820, "comment_id": 84815227, "body": "I&#39;m guessing @Cubic may have meant it in the sense that floating point numbers are countable and finite, even though in the real world everyone treats them as a representation of real numbers."}], "answers": [{"comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1519207817, "post_id": 48903165, "comment_id": 84811637, "body": "Why is <code>5&#47;9</code> not giving an error along the lines of &quot;not defined for int&quot;? I think your answer would benefit if you explain why the error is &quot;Couldn&#39;t match expected ...&quot; instead of &quot;No Instance For (Fractional Int) ...&quot;."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 2, "creation_date": 1519208471, "post_id": 48903165, "comment_id": 84812143, "body": "@MichaWiedenmann Because <code>5</code> and <code>9</code> are not integers; They&#39;re literals of type <code>Num a =&gt; a</code>, <code>5&#47;9</code> then becomes <code>Fractional a =&gt; a</code> without further restrictions, and since the whole expression is restricted to <code>Float</code> already because of the type signature the type checker has no problem restricting this to <code>Float</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1519227151, "post_id": 48903165, "comment_id": 84825397, "body": "@MichaWiedenmann <code>&#47;</code> in Haskell is a sort of overloaded operator which can work on float, double, complex, user-defined numeric types. It does not expect any specific type, but only requires that the two arguments have the same type <code>a</code>, and that <code>a</code> is of class <code>Fractional</code> (where <code>&#47;</code> is defined). Haskell has no notion of &quot;promotion&quot; in numeric types, and all the conversions much be done explicitly (this is both a curse and a bliss). Numeric literals like <code>5</code> have no fixed type, but are polymorphic and will adapt to any type the context requires (<code>5+x</code> will make <code>5</code> to have the type of <code>x</code>)"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 1, "last_activity_date": 1519207719, "creation_date": 1519207719, "answer_id": 48903165, "question_id": 48902820, "link": "https://stackoverflow.com/questions/48902820/my-haskell-type-signature-does-not-represent-the-function/48903165#48903165", "title": "My haskell type signature does not represent the function", "body": "<p>The problem here is that the numerical operations like <code>*</code>, <code>+</code> and <code>/</code> are defined for operations on the same number type only - i.e, if you have <code>x + y</code> then both <code>x</code> and <code>y</code> need to have the same type, and the result will be of the same type again. You can convert an integer-like type to any other number type using the <code>fromIntegral</code> function though, so if you want your function to be of type <code>Int -&gt; Float</code> you simply need to add it here:</p>\n\n<pre><code>farenheitToCelcius :: Int-&gt; Float\nfarenheitToCelcius farenheit = (5/9)*(fromIntegral farenheit-32)\n</code></pre>\n\n<p>Note also that the <code>/</code> operator is <em>not</em> defined for integers (for integer division you need to use the <code>div</code> function instead), so if you wanted this to be a function of type <code>Int -&gt; Int</code> there'd be some other things you'd need to do here.</p>\n"}], "owner": {"reputation": 31, "user_id": 9390184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16276855ee52808829c605e73d07f320?s=128&d=identicon&r=PG&f=1", "display_name": "Bob Simon", "link": "https://stackoverflow.com/users/9390184/bob-simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1519208053, "creation_date": 1519206782, "last_edit_date": 1519208053, "question_id": 48902820, "link": "https://stackoverflow.com/questions/48902820/my-haskell-type-signature-does-not-represent-the-function", "title": "My haskell type signature does not represent the function", "body": "<p>The following code runs but I am not sure why the type signature requires a float to be inupt. </p>\n\n<pre><code>farenheitToCelcius :: Float -&gt; Float\nfarenheitToCelcius farenheit = (5/9)*(farenheit-32)\n\nmain :: IO()\nmain = print (show (farenheitToCelcius 67))\n</code></pre>\n\n<p>The type signature to the following:</p>\n\n<pre><code>farenheitToCelcius :: Int-&gt; Float\nfarenheitToCelcius farenheit = (5/9)*(farenheit-32)\n\nmain :: IO()\nmain = print (show (farenheitToCelcius 67))\n</code></pre>\n\n<p>Results in this error?:</p>\n\n<pre><code>main.hs:2:32: error:\n    \u2022 Couldn't match expected type \u2018Float\u2019 with actual type \u2018Int\u2019\n    \u2022 In the expression: (5 / 9) * (farenheit - 32)\n      In an equation for \u2018farenheitToCelcius\u2019:\n          farenheitToCelcius farenheit = (5 / 9) * (farenheit - 32)\n&lt;interactive&gt;:3:1: error:\n    \u2022 Variable not in scope: main\n    \u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)\n</code></pre>\n\n<p>I am using repl.it.</p>\n"}, {"tags": ["haskell", "concatenation", "bytestring"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519206012, "post_id": 48902519, "comment_id": 84810235, "body": "You can use backticks, and thus work with <code>bs1 `append` bs2</code>"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 16, "last_activity_date": 1585257065, "last_edit_date": 1585257065, "creation_date": 1519206201, "answer_id": 48902628, "question_id": 48902519, "link": "https://stackoverflow.com/questions/48902519/is-there-an-append-operator-for-bytestring/48902628#48902628", "title": "Is there an append operator for ByteString?", "body": "<p>ByteString has a Semigroup instance, so it can be combined in the usual way that semigroups are combined, with <code>(&lt;&gt;)</code>. </p>\n\n<p>The same operator works for strings as well, because <code>String ~ [Char]</code>, and <code>[a]</code> has a Semigroup instance where <code>(&lt;&gt;) = (++)</code>.</p>\n\n<pre><code>Prelude Data.ByteString.Char8&gt; unpack $ pack \"abc\" &lt;&gt; pack \"def\"\n\"abcdef\"\n</code></pre>\n\n<p>Here I convert two Strings to ByteStrings, combine them as ByteStrings, and then convert back to String to demonstrate that it's worked.</p>\n"}, {"comments": [{"owner": {"reputation": 3329, "user_id": 2070111, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/WG0vD.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/2070111/nick"}, "edited": false, "score": 0, "creation_date": 1543086701, "post_id": 53461347, "comment_id": 93794382, "body": "Your answer may be a useful addition to the existing answers, but it would certainly benefit from a narrative explanation as well."}], "tags": [], "owner": {"reputation": 93, "user_id": 3428713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1792d3a0a722ec06e1783764a80554e?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail Baynov", "link": "https://stackoverflow.com/users/3428713/mikhail-baynov"}, "is_accepted": false, "score": 2, "last_activity_date": 1543085387, "creation_date": 1543085387, "answer_id": 53461347, "question_id": 48902519, "link": "https://stackoverflow.com/questions/48902519/is-there-an-append-operator-for-bytestring/53461347#53461347", "title": "Is there an append operator for ByteString?", "body": "<p>concat :: [ByteString] -> ByteString </p>\n\n<p>O(n) Concatenate a list of ByteStrings.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 814, "favorite_count": 2, "accepted_answer_id": 48902628, "answer_count": 2, "score": 9, "last_activity_date": 1585257065, "creation_date": 1519205907, "last_edit_date": 1520358573, "question_id": 48902519, "link": "https://stackoverflow.com/questions/48902519/is-there-an-append-operator-for-bytestring", "title": "Is there an append operator for ByteString?", "body": "<p>For String there is <code>++</code>, which has type</p>\n\n<pre><code>&gt; :t (++)\n(++) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Evidently it doesn't work on <code>ByteString</code> because it isn't a list. I see the <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString.html#v:append\" rel=\"noreferrer\"><code>append</code></a> function but is there an operator for it?</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519204783, "post_id": 48902049, "comment_id": 84809416, "body": "No it is more semantics. You write <code>(val + v) ++ add v left ++ add v right</code>, but how is <code>(val + v) ++ add v left ++ add v right</code> a <code>Maybe Tree</code>? Furthermore you should write <code>Maybe (Tree v)</code>, and <code>v</code> should be an instance of <code>Num</code> as well."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519205664, "post_id": 48902049, "comment_id": 84809986, "body": "Furthermore your question defines a function <code>add</code>, but the error is about <code>fmap1</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1519205876, "post_id": 48902049, "comment_id": 84810131, "body": "You&#39;re missing parentheses: <code>add :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe (Tree v)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "edited": false, "score": 0, "creation_date": 1519206943, "post_id": 48902547, "comment_id": 84810970, "body": "I tried your solution but when i pass the input I&#39;m getting the error &quot; * Non type-variable argument in the constraint: Num (a -&gt; a)    (Use FlexibleContexts to permit this)  * When checking the inferred type      it :: forall a. (Num (a -&gt; a), Num a) =&gt; Tree (a -&gt; a) &quot;"}, {"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "edited": false, "score": 0, "creation_date": 1519207227, "post_id": 48902547, "comment_id": 84811201, "body": "But in case I don&#39;t want to change the way I call the function then will I need to change only the function arguements?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "edited": false, "score": 0, "creation_date": 1519207649, "post_id": 48902547, "comment_id": 84811521, "body": "@Lucy: well as stated in the comments, you need to generalize the function a bit further (to <code>fmap1</code>), and that is left as an exercise."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1519207044, "last_edit_date": 1519207044, "creation_date": 1519205973, "answer_id": 48902547, "question_id": 48902049, "link": "https://stackoverflow.com/questions/48902049/increment-node-values-in-tree-haskell/48902547#48902547", "title": "Increment node values in Tree [Haskell]", "body": "<blockquote>\n  <p>I'm trying to implement it recursively but getting compilation error regarding input parameters.</p>\n</blockquote>\n\n<p>No the errors are already at compile time, so <code>add</code> is never compiled, hence it does not work.</p>\n\n<p>There are some problems with both syntax and semantics, as well as some weird design decisions.</p>\n\n<p>First of all, if you write <code>Maybe Tree v</code>, Haskell sees this as <code>(Maybe Tree) v</code>, which is - as far as I understand it - not the intended result, it should be <code>Maybe (Tree v)</code> since you wrap a <code>Tree v</code> into a <code>Maybe</code>.</p>\n\n<p>But using <code>Maybe (Tree v)</code> as result is already kind of weird: regardless what input treee you provide, we should always construct a <em>new</em> valid <code>Tree</code>. For an <code>Empty</code> we simply do not add any values, so <code>add 3 Empty == Empty</code>, but there are no scenarios where this could go wrong.</p>\n\n<p>You also ue <code>Ord v</code> as a type constraint, which is weird, since in the function, we never use a <code>==</code>, <code>/=</code>, <code>&lt;</code>, <code>&gt;</code>, etc. function. We use <code>+</code>, which means we should use the <code>Num v</code>, so now our signature is:</p>\n\n<pre><code>add :: Num v =&gt; v -&gt; Tree v -&gt; Tree v\n</code></pre>\n\n<p>We can implement two cases: one for <code>Empty</code> (that stays <code>Empty</code>), and one for <code>Node</code> (that updates the value, and performs two recursive calls), like:</p>\n\n<pre><code><b>add</b> :: Num v =&gt; v -&gt; Tree v -&gt; Tree v\n<b>add</b> _ Empty = Empty\n<b>add</b> v (Node x l r) = Node (v+x) (<b>add</b> v l) (<b>add</b> v r)</code></pre>\n\n<p>Your question suggests that you want to implement a <code>Functor</code>. Defining an <code>fmap</code> is quite similar to <code>add</code> here, but requires to generalize the first argument. I leave that as an exercise.</p>\n\n<p>If you call it with:</p>\n\n<pre><code>add (+1) (Node 3 (Node 1 Empty Empty) (Node 7 (Node 4 Empty Empty) Empty))\n</code></pre>\n\n<p>The first argument is <em>not</em> a number, but a function, so you should drop the <code>+</code> in that case:</p>\n\n<pre><code>add 1 (Node 3 (Node 1 Empty Empty) (Node 7 (Node 4 Empty Empty) Empty))\n</code></pre>\n\n<p>producing:</p>\n\n<pre><code>Prelude&gt; add 1 (Node 3 (Node 1 Empty Empty) (Node 7 (Node 4 Empty Empty) Empty))\nNode 4 (Node 2 Empty Empty) (Node 8 (Node 5 Empty Empty) Empty)\n</code></pre>\n"}], "owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519207044, "creation_date": 1519204606, "last_edit_date": 1519206857, "question_id": 48902049, "link": "https://stackoverflow.com/questions/48902049/increment-node-values-in-tree-haskell", "title": "Increment node values in Tree [Haskell]", "body": "<p>I'm trying to implement a haskell program which increments the value of all the nodes in a tree using functors. The input &amp; output of the functor function is a tree. I'm trying to implement it recursively but getting compilation error regarding input parameters.</p>\n\n<p><strong>Haskell Code..</strong></p>\n\n<pre><code>data Tree v = Empty | Node v (Tree v) (Tree v) deriving (Show)\n\nadd :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe Tree v\nadd _ Empty = Nothing\nadd v (Node val left right) = (val + v) ++ add v left ++ add v right\n</code></pre>\n\n<p><strong>Input</strong></p>\n\n<pre><code>add (+1) (Node 3 (Node 1 Empty Empty) (Node 7 (Node 4 Empty Empty) Empty))\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>  [1 of 1] Compiling Main             ( functor1.hs, interpreted )\n\n  functor1.hs:17:34: error:\n  * Expecting one fewer arguments to `Maybe Tree'\n   Expected kind `* -&gt; *', but `Maybe Tree' has kind `*'\n  * In the type signature:\n    add :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe Tree v\n       |\n 17    | add :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe Tree v\n       |                                  ^^^^^^^^^^^^\n\n  functor1.hs:17:40: error:\n  * Expecting one more argument to `Tree'\n    Expected a type, but `Tree' has kind `* -&gt; *'\n  * In the first argument of `Maybe', namely `Tree'\n   In the type signature:\n    add :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe Tree v\n   |\n17 | add :: Ord v =&gt; v -&gt; Tree v -&gt; Maybe Tree v\n   |                                        ^^^^\n Failed, no modules loaded.\n</code></pre>\n\n<p>Is there some mistake in the syntax? Please help</p>\n"}, {"tags": ["haskell", "agda", "category-theory"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1519203956, "post_id": 48901718, "comment_id": 84808897, "body": "It looks similar to an indexed monad, but not quite the same (?)"}, {"owner": {"reputation": 3214, "user_id": 559931, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b75be6c373229af33f769c0a7e79f8d3?s=128&d=identicon&r=PG", "display_name": "Anton Golov", "link": "https://stackoverflow.com/users/559931/anton-golov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1519204870, "post_id": 48901718, "comment_id": 84809471, "body": "Oh yes, good point, there is a connection there."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1519213833, "post_id": 48901718, "comment_id": 84815913, "body": "I&#39;d still call it a special case of an (<a href=\"https://bentnib.org/paramnotions-jfp.pdf\" rel=\"nofollow noreferrer\">Atkey-style</a>, not <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Kleisli.pdf\" rel=\"nofollow noreferrer\">McBride-style</a>) indexed monad, it just has some additional profunctor-ness in the indices. The indexed state monad, for example, fits this pattern. (Robert Atkey introduced these in the paper I linked, hence McBride&#39;s characteristically punning name for the &quot;at key&quot; type <code>:=</code>.)"}, {"owner": {"reputation": 3214, "user_id": 559931, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b75be6c373229af33f769c0a7e79f8d3?s=128&d=identicon&r=PG", "display_name": "Anton Golov", "link": "https://stackoverflow.com/users/559931/anton-golov"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1519310809, "post_id": 48901718, "comment_id": 84867082, "body": "@BenjaminHodgson Thanks, this is exactly what I was looking for!  If you post it as an answer I&#39;ll accept it.  (And Robert Atkey even anticipated a problem I think I&#39;ll run into with his tensor product requirement.)"}], "answers": [{"tags": [], "owner": {"reputation": 3214, "user_id": 559931, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b75be6c373229af33f769c0a7e79f8d3?s=128&d=identicon&r=PG", "display_name": "Anton Golov", "link": "https://stackoverflow.com/users/559931/anton-golov"}, "is_accepted": false, "score": 1, "last_activity_date": 1520240224, "creation_date": 1520240224, "answer_id": 49106623, "question_id": 48901718, "link": "https://stackoverflow.com/questions/48901718/name-for-a-type-constructor-that-is-both-a-category-and-a-monad/49106623#49106623", "title": "Name for a type constructor that is both a category and a monad?", "body": "<p>As pointed out in the comments, this is the notion of a Parametrised Monad introduced by Robert Atkey in his <a href=\"https://bentnib.org/paramnotions-jfp.pdf\" rel=\"nofollow noreferrer\">Parametrised Notions of Computation</a> paper.  This corresponds to the notion of a category enriched over a category of endofunctors in category theory.</p>\n\n<p>For a category <code>C</code> to be <a href=\"https://ncatlab.org/nlab/show/enriched+category#InMonoidCat\" rel=\"nofollow noreferrer\">enriched over a category <code>V</code> with monoidal structure <code>(I, x)</code></a> means that for every objects <code>X</code>, <code>Y</code> of <code>C</code>, the Hom-object <code>Hom(X, Y)</code> is an object of <code>V</code>, and there exist morphisms that give the identity and composition, <code>I -&gt; Hom(X, X)</code> and <code>Hom(Y, Z) x Hom(X, Y) -&gt; Hom(X, Z)</code>.  Certain idenity and associativity conditions must hold, corresponding to the usual requirements of identity and associativity for a category.</p>\n\n<p>A monad <code>M</code> on <code>C</code> can be seen as a one-object category enriched over endofunctors on <code>C</code>.  Since there is only one object <code>X</code>, there is also one Hom-object <code>Hom(X, X)</code>, which is <code>M</code>.  The return operation gives rise to an identity morphism, a natural transformation <code>I -&gt; M</code>, and the join operation gives rise to a composition morphism, a natural transformation <code>M x M -&gt; M</code>. The identity and associativity conditions then correspond exactly to those of a monad.  </p>\n\n<p>A parametrised monad <code>M</code> on <code>C</code> with parameters taken from some set <code>S</code> can be seen as a category with elements of <code>S</code> as objects, enriched over the endofunctors of <code>C</code>.  The Hom-object <code>Hom(X, Y)</code> is <code>M X Y</code> and the <code>return</code> and <code>join</code> operations described in the question again give rise to the families of morphisms required. </p>\n"}], "owner": {"reputation": 3214, "user_id": 559931, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b75be6c373229af33f769c0a7e79f8d3?s=128&d=identicon&r=PG", "display_name": "Anton Golov", "link": "https://stackoverflow.com/users/559931/anton-golov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 11, "last_activity_date": 1520240224, "creation_date": 1519203577, "last_edit_date": 1519208648, "question_id": 48901718, "link": "https://stackoverflow.com/questions/48901718/name-for-a-type-constructor-that-is-both-a-category-and-a-monad", "title": "Name for a type constructor that is both a category and a monad?", "body": "<p>Is there any standard name for a type constructor <code>F :: * -&gt; * -&gt; * -&gt; *</code> with operations</p>\n\n<pre><code>return :: x -&gt; F a a x\nbind :: F a b x -&gt; (x -&gt; F b c y) -&gt; F a c y\n</code></pre>\n\n<p>that is a contravariant functor in the first argument and a covariant functor in the second and third?  In particular, does this correspond to any kind construction in category theory?</p>\n\n<p>The operations give rise to a</p>\n\n<pre><code>join :: F a b (F b c x) -&gt; F a c x\n</code></pre>\n\n<p>operation that makes this seem like some kind of \"category in the category of endofunctors\", but I'm not sure how that could be formalised.</p>\n\n<p>EDIT: As chi points out, this is related to the indexed monad: given an indexed monad</p>\n\n<pre><code>F' : (* -&gt; *) -&gt; (* -&gt; *)\n</code></pre>\n\n<p>we can use the Atkey construction</p>\n\n<pre><code>data (:=) :: * -&gt; * -&gt; * -&gt; *\n    V :: x -&gt; (x := a) a\n</code></pre>\n\n<p>and then define</p>\n\n<pre><code>F a b x = F' (x := b) a\n</code></pre>\n\n<p>to get the kind of monad we want.  <a href=\"https://gist.github.com/jesyspa/e1351d13dbab66bad6bae663e7df6410\" rel=\"noreferrer\">I've done the construction in Agda to check.</a>  I'd still like to know whether this more limited structure is known, though.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1519195869, "post_id": 48899689, "comment_id": 84804701, "body": "Have you tried? Did it work? If it didn&#39;t, what went wrong?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6552967"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1519196887, "post_id": 48899689, "comment_id": 84805193, "body": "yep, doesn&#39;t work, cuz I cant just &#39;length n&#39;, as I understand - cond expected"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1519223119, "post_id": 48899689, "comment_id": 84822404, "body": "Can you give an example of the desired output? What do you mean by init? Haskell has an <code>init</code> function."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6552967"}, "is_accepted": false, "score": 1, "last_activity_date": 1519196766, "creation_date": 1519196766, "answer_id": 48899951, "question_id": 48899689, "link": "https://stackoverflow.com/questions/48899689/haskell-init-list-of-n-even-odd-numbers/48899951#48899951", "title": "Haskell init list of n even/odd numbers", "body": "<p>For now found solution, but I guess it's dirt and low speed</p>\n\n<pre><code>even_list n = takeWhile (&lt; n * 2) [x | x &lt;- [1..], even x]\nodd_list n = takeWhile (&lt;= n * 2) [x | x &lt;- [1..], odd x]\n</code></pre>\n\n<p>Is where anything easier?</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1519197350, "creation_date": 1519197350, "answer_id": 48900096, "question_id": 48899689, "link": "https://stackoverflow.com/questions/48899689/haskell-init-list-of-n-even-odd-numbers/48900096#48900096", "title": "Haskell init list of n even/odd numbers", "body": "<p>You can use list comprehensions with a step indicator to produce infinite lists with a certain step size, e.g. <code>[2,4..]</code> or <code>[1,3..]</code>.</p>\n\n<p>When you want a finite list instead of an infinite list, you can use <code>take</code>, so a first attempt could be something like this:</p>\n\n<pre><code>Prelude&gt; even_list n = take n [2,4..]\nPrelude&gt; even_list 15\n[2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]\n</code></pre>\n\n<p>If you want to go point-free and eliminate <code>n</code>, you can <code>flip</code> <code>take</code> so that instead of taking the length first, it takes it last:</p>\n\n<pre><code>Prelude&gt; :t flip take\nflip take :: [a] -&gt; Int -&gt; [a]\n</code></pre>\n\n<p>You can partially apply this with e.g. the odd numbers, to get this:</p>\n\n<pre><code>Prelude&gt; odd_list = flip take [1,3..]\nPrelude&gt; odd_list 12\n[1,3,5,7,9,11,13,15,17,19,21,23]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6552967"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1319, "favorite_count": 0, "accepted_answer_id": 48900096, "answer_count": 2, "score": 0, "last_activity_date": 1519197350, "creation_date": 1519195536, "question_id": 48899689, "link": "https://stackoverflow.com/questions/48899689/haskell-init-list-of-n-even-odd-numbers", "title": "Haskell init list of n even/odd numbers", "body": "<p>How can I init list of <code>n</code> <code>odd</code> or <code>even</code> elements, can I do something like so?</p>\n\n<pre><code>even_list :: Int -&gt; [Int]\neven_list n = [x | x &lt;- [1..], even x, length n]\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "edited": false, "score": 0, "creation_date": 1519200815, "post_id": 48899468, "comment_id": 84807191, "body": "So it looks to me like you&#39;re matching the parser used with the letters in the instruction statement so for lets say for the parseConjunction one it&#39;s parseAnd &lt;|&gt; parseNegation"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "edited": false, "score": 0, "creation_date": 1519224305, "post_id": 48899468, "comment_id": 84823351, "body": "Right, the grammar rules in the comments appear to use non-terminal symbols coded:  D=Disjunction, C=Conjunction, N=Negation (and &quot;A&quot; appears, too, which might stand for &quot;Atom&quot;).  These non-terminal symbols correspond directly to the functions <code>parseDisjunction</code>, <code>parseConjunction</code>, <code>parseNegation</code> that are intended to handle <b>all</b> rules for the corresponding non-terminal symbol. In contrast, <code>parseOr</code>, <code>parseAnd</code>, and <code>parseNot</code> are helper functions for specific rules needed by the  other parse functions."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1519194639, "creation_date": 1519194639, "answer_id": 48899468, "question_id": 48897757, "link": "https://stackoverflow.com/questions/48897757/haskell-custom-parser-terminology/48899468#48899468", "title": "Haskell custom parser terminology", "body": "<p>What you have here is a <a href=\"https://en.wikipedia.org/wiki/Recursive_descent_parser\" rel=\"nofollow noreferrer\">recursive descent parser</a> written in a monadic style, sometimes called a \"monadic parser\".  This a very common method for writing parsers in Haskell, and there are a number of very popular parser libraries (e.g., Parsec) that support writing parsers in this style.</p>\n\n<p>It looks like this one might have been hand-written for this assignment, so you probably have some boilerplate code that includes a <code>Parser</code> type with <code>Applicative</code>, <code>Monad</code>, and <code>Alternative</code> instances defined, plus the <code>eat</code> utility function you included in your question.  You probably also have a <code>parse</code> or <code>runParser</code> helper function that would be used to actually apply one of the parse functions (e.g., <code>parseDisjunction</code>) to a list of input tokens.</p>\n\n<p>On the one hand, the nuts and bolts of how these parsers work can be pretty complicated.  However, at a high level, you can quickly develop an intuitive understanding of how they behave.  In fact, it looks like your professor probably thought that just one example (<code>parseOr</code> with some comments) would be enough to explain it, though that might have been optimistic!</p>\n\n<p>If it's not clear to you, the way this parser is supposed to be used is that we assume that some human-readable representation of a Boolean expression, say the string:</p>\n\n<pre><code>\"A and B or C or not D\"\n</code></pre>\n\n<p>has already been processed into a list of \"tokens\":</p>\n\n<pre><code>ts = [T_ATOM \"A\", T_AND, T_ATOM \"B\", T_OR, T_ATOM \"C\", T_OR, T_NOT, T_ATOM \"D\"]\n</code></pre>\n\n<p>Note that I didn't see <code>T_ATOM</code> in your code, but I presume you have something like it in the definition of the token data type.</p>\n\n<p>The purpose of the parser functions, like <code>parseOr</code>, is to take this token list as input and produce an abstract syntax tree (AST) to represent it.  In this case, the AST will look like this:</p>\n\n<pre><code>OR (AND (ATOM \"A\") (ATOM \"B\")) (OR (ATOM \"C\") (NOT (ATOM \"D\")))\n</code></pre>\n\n<p>So when the comments say \"parse a conjunction AST and name it <code>p</code>\", they are referring to the fact that the statement:</p>\n\n<pre><code>p &lt;- parseConjunction\n</code></pre>\n\n<p>will take some tokens from the beginning of the list of input tokens and turn them into AST representation of a conjunction.  Specifically, if <code>parseOr</code> is applied to the token list <code>ts</code> above, this first statement <code>p &lt;- parseConjunction</code> will take the tokens:</p>\n\n<pre><code>T_ATOM \"A\", T_AND, T_ATOM \"B\"\n</code></pre>\n\n<p>from the beginning of the input list and parse them into the following AST which will be assigned to <code>p</code>:</p>\n\n<pre><code>(AND (ATOM \"A\") (ATOM \"B\"))\n</code></pre>\n\n<p>Now, the nice thing about writing parsers in this style is that you don't have to explicitly manipulate the token list.  Instead, you can write parsers in a very abstract manner that closely matches the formal rules of the grammar.  For example, the rule:</p>\n\n<pre><code>D -&gt; C | D\n</code></pre>\n\n<p>can be pretty directly translated into:</p>\n\n<pre><code>parseOr = do\n  p &lt;- parseConjuction  -- this parses the conjunction \"C\" on the RHS\n  eat T_OR              -- this parses the terminal symbol \"|\" \n  q &lt;- parseDisjunction -- this parses the disjunction \"D\" on the RHS\n  return (OR p q)       -- the produces the AST result of the parse\n                        -- which is the disjunction \"D\" on the LHS\n</code></pre>\n\n<p>while a choice between multiple grammar rules:</p>\n\n<pre><code>D -&gt; C | D\nD -&gt; C\n</code></pre>\n\n<p>can be translated into:</p>\n\n<pre><code>parseDisjunction =\n  parseOr                 -- try to parse \"C | D\" RHS\n  &lt;|&gt; parseConjunction    -- if that fails, try just the \"C\" RHS\n</code></pre>\n\n<p>Does that help?</p>\n"}], "owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 48899468, "answer_count": 1, "score": 0, "last_activity_date": 1519194639, "creation_date": 1519183841, "question_id": 48897757, "link": "https://stackoverflow.com/questions/48897757/haskell-custom-parser-terminology", "title": "Haskell custom parser terminology", "body": "<p>So I'm doing a homework assignment to fill in implementation for a few functions that work with a custom Haskell parser (this only works with boolean logic). I'm trying to understand what the code means or is supposed to do on a high level. Some of this (marked with \"(wrong?)\") was implemented by me but I think most of it is wrong as I don't really understand what is going on.</p>\n\n<p>What does it mean for Haskell to parse a <em>con/disjunction ast</em>? This should make something that looks like <code>p T_OR q</code> in parseOr right? How about parseNegation, parseNot, and parseParens? </p>\n\n<p>Sorry for the broad scope I just don't understand what these are supposed to be doing. This is all the relevant code so please give your <strong>best guess</strong> if you can't tell.</p>\n\n<pre><code>parseOr implements the single rule D --&gt; C | D. The definition says:\n\n  - parse a conjunction AST and name it \"p\"\n  - ensure that the next symbol in the stream is T_OR\n  - parse a disjunction AST and name it \"q\"\n  - return the AST \"AND p q\"\n\n&gt; parseOr = do\n&gt;   p &lt;- parseConjunction\n&gt;   eat T_OR\n&gt;   q &lt;- parseDisjunction\n&gt;   return (OR p q)\n\nparseDisjunction implements the CFG rules for the D nonterminal:\n\n  D --&gt; C | D\n  D --&gt; C\n\n&gt; parseDisjunction = parseOr &lt;|&gt; parseConjunction\n\nparseAnd implements the rule C --&gt; N &amp; C.\n\n&gt; parseAnd = do\n&gt;   p &lt;- parseNegation\n&gt;   eat T_AND\n&gt;   q &lt;- parseConjunction\n&gt;   return (AND p q)\n\nparseConjunction should implement the rules for the C nonterminal:\n\n  C --&gt; N &amp; C\n  C --&gt; N\n\nIt will probably look almost identical to parseDisjunction, but with different\nparsers being combined.\n\n(wrong?)\n&gt; parseConjunction = parseAnd &lt;|&gt; parseDisjunction \n\nparseNot should implement the rule N --&gt; !N.\n\n(wrong?)\n&gt; parseNot = do \n&gt;   p &lt;- parseNegation\n&gt;   eat T_NOT\n&gt;   return (NOT p)\n\nparseNegation should implement the rules for the N nonterminal:\n\n  N --&gt; !N\n  N --&gt; A\n\n(wrong?)\n&gt; parseNegation = parseNot &lt;|&gt; parseConjunction \n\nparseParens should implement the rule A --&gt; (D).\n\n(wrong?)\n&gt; parseParens = do \n&gt;   eat L_PAREN\n&gt;   p &lt;- parseParens\n&gt;   eat R_PAREN\n&gt;   return (p)\n</code></pre>\n\n<p>eat implementation</p>\n\n<pre><code>eat :: Eq t =&gt; t -&gt; Parser t ()\neat x = Parser $ \\ts -&gt;\n  case ts of\n    [] -&gt; Nothing\n    (t:ts)\n      | x == t -&gt; Just ((), ts)\n      | otherwise -&gt; Nothing\n</code></pre>\n"}, {"tags": ["haskell", "read-eval-print-loop", "ghci", "haskell-stack", "nixos"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1519167192, "post_id": 48895340, "comment_id": 84796825, "body": "I only use <code>stack ghci</code> and it definitely picks up the settings in my <code>~&#47;.ghci</code> file. Is there something non-standard about your set-up?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1519168047, "post_id": 48895340, "comment_id": 84797103, "body": "have you set your <code>~&#47;.ghci</code> file writable by just yourself? At least that&#39;s what my <code>stack ghci</code> complained about."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1519168475, "post_id": 48895340, "comment_id": 84797230, "body": "I haven&#39;t changed the ~/.ghci permissions. Does using NixOS count as non-standard about the set-up? :) Still, if I just run ghci instead it will pick the settings."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519168726, "post_id": 48895340, "comment_id": 84797303, "body": "(You should probably say what the permissions were before you didn&#39;t change them.)"}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1519169935, "post_id": 48895340, "comment_id": 84797678, "body": "<code>-rw-r--r--</code> and I am not getting any warning when running <code>stack ghci</code>. I&#39;ll update the question since it says it is using the settings but it is not applying them for some reason."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1519179150, "post_id": 48895340, "comment_id": 84799965, "body": "I believe this is a NixOS issue as my config from <code>~.ghci</code> is being picked up in a Debian based distro."}], "answers": [{"comments": [{"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1519237533, "post_id": 48906964, "comment_id": 84832182, "body": "I tried that and it has no effect. It doesn&#39;t even say it is being loaded. I think this might be a NixOS specific Stack bug."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 0, "last_activity_date": 1519218985, "creation_date": 1519218985, "answer_id": 48906964, "question_id": 48895340, "link": "https://stackoverflow.com/questions/48895340/configure-stack-ghci-prompt/48906964#48906964", "title": "Configure stack ghci prompt", "body": "<p>Try to put your config under:</p>\n\n<pre><code>~/.ghc/ghci.conf\n</code></pre>\n\n<p>Works for me on Ubuntu 16.04.</p>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1342, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1519237392, "creation_date": 1519166068, "last_edit_date": 1519237392, "question_id": 48895340, "link": "https://stackoverflow.com/questions/48895340/configure-stack-ghci-prompt", "title": "Configure stack ghci prompt", "body": "<p>Is it possible to configure <code>stack ghci</code> similar to the way <code>ghci</code> is configured via the <code>~/.ghci</code> file?</p>\n\n<p>Currently <code>stack ghci</code> does not pick up the settings in the <code>~/.ghci</code> file.</p>\n\n<p>I'm looking into setting the prompt to be a lambda instead of the loaded modules:</p>\n\n<pre><code>:set prompt \"\\ESC[33m\\STX\u03bb&gt; \\ESC[m\\STX\"\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<blockquote>\n  <p>[neo@nixos:~/HaskellLearning/IdeTest]$ stack ghci The following GHC\n  options are incompatible with GHCi and have not been passed to it:\n  -threaded Configuring GHCi with the following packages: IdeTest Using main module: 1. Package `IdeTest' component exe:IdeTest-exe with\n  main-is file: /home/neo/HaskellLearning/IdeTest/app/Main.hs GHCi,\n  version 8.2.2: <a href=\"http://www.haskell.org/ghc/\" rel=\"nofollow noreferrer\">http://www.haskell.org/ghc/</a>  :? for help Loaded GHCi\n  configuration from /home/neo/HaskellLearning/IdeTest/.ghci Loaded GHCi\n  configuration from /home/neo/.ghci [1 of 9] Compiling Ch13<br>\n  ( /home/neo/HaskellLearning/IdeTest/src/Ch13.hs, interpreted ) [2 of\n  9] Compiling Ch15             (\n  /home/neo/HaskellLearning/IdeTest/src/Ch15.hs, interpreted ) [3 of 9]\n  Compiling Ch17             (\n  /home/neo/HaskellLearning/IdeTest/src/Ch17.hs, interpreted ) ... Ok, 9\n  modules loaded. Loaded GHCi configuration from\n  /run/user/1000/ghci31082/ghci-script\n  *Main Ch13 Ch15 Ch17 Functor HelloError Lib Phone SemigroupAndMonoid></p>\n</blockquote>\n\n<p>None of the other 2 configurations mentioned does anything regarding changing the prompt.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519158487, "post_id": 48892763, "comment_id": 84792984, "body": "&quot;Haskell FFI doesn&#39;t support returning structs&quot;  Where did you learn this?"}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519158751, "post_id": 48892763, "comment_id": 84793111, "body": "@ThomasM.DuBuisson from <a href=\"https://wiki.haskell.org/Foreign_Function_Interface\" rel=\"nofollow noreferrer\">here</a>: Warning: GHC does not support passing structures as values yet."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1519159039, "post_id": 48892763, "comment_id": 84793247, "body": "What is your question?"}, {"owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "edited": false, "score": 0, "creation_date": 1519166935, "post_id": 48892763, "comment_id": 84796731, "body": "Sorry, added it. Knew I was forgetting something."}, {"owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519166982, "post_id": 48892763, "comment_id": 84796748, "body": "@ThomasM.DuBuisson <a href=\"https://ghc.haskell.org/trac/ghc/wiki/CStructures\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/CStructures</a> <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch8.html#x15-1560008.4.2\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1519167579, "post_id": 48892763, "comment_id": 84796943, "body": "Yes, thank you DavidKraeutmann and @YotamOhad, I had fogotten this restriction.  Most C code already passes pointers instead of values for structs which conveniently avoids this issue.  We&#39;re left with Daniel&#39;s request for clarification on what is being asked."}, {"owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "edited": false, "score": 0, "creation_date": 1519168219, "post_id": 48892763, "comment_id": 84797145, "body": "<code>How can I convert a Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant) into a C function pointer of type native_call_cb without defining a C wrapper for each function?</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1519168863, "post_id": 48892763, "comment_id": 84797352, "body": "@DavidKraeutmann If all your functions have the same type, why can you not reuse the wrapper? <code>foreign import ccall &quot;wrapper&quot; mkNativeCallCb :: (Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)) -&gt; IO (FunPtr (Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)))</code>. Now, <code>mkNativeCallCb</code> is the one function you need."}, {"owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "edited": false, "score": 0, "creation_date": 1519169749, "post_id": 48892763, "comment_id": 84797618, "body": "Because I need to dereference the pointer to GodotVariant"}], "owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 261, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519167258, "creation_date": 1519154711, "last_edit_date": 1519167258, "question_id": 48892763, "link": "https://stackoverflow.com/questions/48892763/returning-a-struct-from-a-haskell-ffi-callback", "title": "Returning a struct from a Haskell FFI callback", "body": "<p>I need to be able to call this function where <code>native_call_cb</code> is implemented by a Haskell function</p>\n\n<pre><code>typedef godot_variant (*native_call_cb)(void *, godot_array *);\nvoid GDAPI godot_register_native_call_type(const char *p_call_type, native_call_cb p_callback);\n</code></pre>\n\n<p>godot_variant is a struct</p>\n\n<pre><code>typedef struct {\n    uint8_t _dont_touch_that[GODOT_VARIANT_SIZE];\n} godot_variant;\n</code></pre>\n\n<p>Haskell FFI doesn't support returning structs, so the best i can do is</p>\n\n<pre><code>godot_variant* (*native_call_cb)(void *, godot_array *)\n</code></pre>\n\n<p>using</p>\n\n<pre><code>foreign import ccall \"wrapper\" (Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)) -&gt; IO (FunPtr (Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)))\n</code></pre>\n\n<p>How can I convert a <code>Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)</code> into a C function pointer of type <code>native_call_cb</code> without defining a C wrapper for each function?</p>\n\n<p>E: If I define a wrapper for each function, it's simple:</p>\n\n<pre><code>foreign export ccall my_func :: Ptr () -&gt; Ptr GodotArray -&gt; IO (Ptr GodotVariant)\nforeign import ccall \"&amp;my_func_wrapper\" :: FunPtr (Ptr () -&gt; Ptr GodotArray -&gt; IO Void) -- placeholder for struct\n</code></pre>\n\n<p>and a C wrapper</p>\n\n<pre><code>godot_variant my_func_wrapper(void* desc, godot_array* array) {\n    return *my_func(desc, array);\n}\n</code></pre>\n\n<p>That's cumbersome, though</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 9, "creation_date": 1519126143, "post_id": 48884276, "comment_id": 84772878, "body": "Well <code>[xs]</code> matches a list with <i>exactly</i> one element, and that element is then unified with <code>xs</code>. Somehow people ask this question every other day :("}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519130356, "post_id": 48884276, "comment_id": 84775527, "body": "In the future, please try to give your questions more specific titles. &quot;Haskell code doesn&#39;t work, why?&quot; says almost nothing about your problem."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519134500, "post_id": 48884276, "comment_id": 84778248, "body": "@WillemVanOnsem I agree, this error is way too frequent here on SO. We might need to write a &quot;reference&quot; question/answer, addressing the general issue, so that we can close all such questions as duplicates. We did that for the monomorphism restriction (after a bit of discussion on meta, IIRC)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1519144603, "post_id": 48884276, "comment_id": 84785192, "body": "I have a counter-question: why would you expect <code>[xs]</code> to mean the same thing as <code>xs</code>?"}, {"owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1519223739, "post_id": 48884276, "comment_id": 84822894, "body": "@DanielWagner I do not expect [xs] to mean same thing as xs, however as mentioned (comments in ans) below the primary confusion came as in Haskell when declaring types you use [] for list. That plus since I do not frequently use Haskell so as default wrote the code like that. As mentioned in the question I knew how to get the code working and understood partly what the compiler was complaining but still could not get the overall picture. Thanks for answers now I know a little bit more. Maybe adding this as a reference question answer is a good idea."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1523717886, "post_id": 48884276, "comment_id": 86680804, "body": "See also <a href=\"https://stackoverflow.com/q/49831324/2751851\"><i>Pattern matching expects round braces for non empty list and not square brackets</i></a> for extra discussion."}], "answers": [{"comments": [{"owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "edited": false, "score": 2, "creation_date": 1519131374, "post_id": 48884382, "comment_id": 84776166, "body": "I actually liked your comment more since that explained me the (or my) issue very clearly. Think probably this a typical beginner problem, partly due to the fact that in a function signature [a] would mean a list while the same ([a]) in code means a list containing a single value!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "edited": false, "score": 0, "creation_date": 1519136976, "post_id": 48884382, "comment_id": 84779876, "body": "@peeyushsingh Yeah, the &quot;<code>[]</code>-the-type vs <code>[]</code>-the-value&quot; pun can confuse beginners. You have to remember that types and values live in different worlds. When you define <code>data Foo = Foo</code>, the left-hand side defines a type named <code>Foo</code> and the right-hand side defines a value which coincidentally happens also to be named <code>Foo</code> (but in a different namespace). That&#39;s just the same as what&#39;s going on with <code>[]</code> and <code>[]</code>."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "edited": false, "score": 0, "creation_date": 1519195366, "post_id": 48884382, "comment_id": 84804472, "body": "@peeyushsingh: You can think of the type <code>[a]</code> as syntactic sugar for the normal prefix syntax <code>[] a</code>\u2014which you can use instead, just like other prefix type constructors such as <code>Maybe a</code>. It\u2019s just visually nicer to write <code>[[Int]]</code> than <code>[] ([] Int)</code>, for example."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 12, "last_activity_date": 1519131729, "last_edit_date": 1519131729, "creation_date": 1519126411, "answer_id": 48884382, "question_id": 48884276, "link": "https://stackoverflow.com/questions/48884276/why-doesnt-this-function-work-if-i-use-xs-instead-of-xs/48884382#48884382", "title": "Why doesn&#39;t this function work if I use &quot;[xs]&quot; instead of &quot;xs&quot;?", "body": "<p>Somehow a lot of people think that <code>[xs]</code> as pattern means that you <em>unify</em> a list with <code>xs</code>. But this is incorrect, since the function signature (either derived implicitly, or stated explicitly) already will prevent you to write code where you call the function with a non-list item.</p>\n\n<p>A list has <em>two</em> constructors:</p>\n\n<ul>\n<li>the empty list <code>[]</code>; and</li>\n<li>the \"cons\" <code>(h : t)</code> with <code>h</code> the <em>head</em> (first element), and <code>t</code> the <em>tail</em> (a list with the remaining elements).</li>\n</ul>\n\n<p>Haskell however introduces some syntactical sugar as well. For example <code>[1]</code> is short for <code>(1:[])</code>, and <code>[1, 4, 2]</code> for <code>(1:(4:(2:[])))</code>.</p>\n\n<p>So that means that if you write <code>[xs]</code>, behind the curtains you defined a pattern <code>(xs: [])</code> which thus means you match all lists with <em>exactly</em> one element, and that single <em>element</em> (not the entire list) is then <code>xs</code>.</p>\n\n<p>Anyway, the solution is to use:</p>\n\n<pre><code>split <b>xs</b> n = (take n <b>xs</b>, drop n <b>xs</b>)</code></pre>\n\n<p>Since both <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:take\" rel=\"noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:drop\" rel=\"noreferrer\"><strong><code>drop :: Int -&gt; [a] -&gt; [a]</code></strong></a> have in the signature that <code>xs</code> is supposed to be a list, Haskell will derive automatically that <code>n</code> is supposed to be an <code>Int</code>, and <code>xs</code> an <code>[a]</code>.</p>\n\n<p>Note that you can use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:splitAt\" rel=\"noreferrer\"><strong><code>splitAt :: Int -&gt; [a] -&gt; ([a], [a])</code></strong></a> as well. We can make the signature equivalent to the one you target with:</p>\n\n<pre><code>split = flip splitAt\n</code></pre>\n"}], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 48884382, "answer_count": 1, "score": 2, "last_activity_date": 1520919217, "creation_date": 1519126077, "last_edit_date": 1520919217, "question_id": 48884276, "link": "https://stackoverflow.com/questions/48884276/why-doesnt-this-function-work-if-i-use-xs-instead-of-xs", "title": "Why doesn&#39;t this function work if I use &quot;[xs]&quot; instead of &quot;xs&quot;?", "body": "<pre><code>split :: [a] -&gt; Int -&gt; ([a], [a])\nsplit [xs] n = \n    (take n [xs], drop n [xs])\n</code></pre>\n\n<p>The same code works if I give the variable as <code>xs</code> instead of <code>[xs]</code>, signatures are same in both cases. Using <code>[xs]</code> gives the error that pattern is non-exhaustive. I understand it's telling that the input I gave is not covered by my code, but not clear what is happening under the hood.</p>\n\n<p>Test input: <code>[1,2,3] 2</code>.</p>\n"}, {"tags": ["templates", "haskell", "constructor", "type-constructor", "value-constructor"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1519097578, "post_id": 48876986, "comment_id": 84758928, "body": "(1) If you have an use case that goes beyond the example code you posted, you likely want to tell us more about it. As it stands, there are lots of things that <i>might</i> do what you want, and it&#39;s hard to tell which relevant: a preexisting class, a class that you&#39;d define yourself, newtype juggling (<code>coerce</code>, <code>Control.Lens.Wrapped</code>, etc.), generics, etc. (2) &quot;only instances with the <code>Just</code> constructor&quot; -- Terminology nitpick: you mean &quot;values&quot;, rather than &quot;instances&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519097602, "post_id": 48876986, "comment_id": 84758939, "body": "(3) &quot;without making assumptions about the name of type constructors&quot; -- I&#39;d say that&#39;s more a <i>choice</i> than an assumption. If you cease from making it explicitly, you might end up needing other assumptions (e.g. &quot;there is a constructor that has the same name as the type&quot;, &quot;the constructor has the fields I expect it to have&quot;, &quot;there aren&#39;t other constructors, so I don&#39;t need to worry about handling them&quot;). (4) &quot;That will give me a syntax error for some reason&quot; -- the <code>f</code> from the signature is unrelated to the one of the definition. You might be mixing up type level things with value level ones."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1519111368, "post_id": 48876986, "comment_id": 84763559, "body": "That would be rather weird for several reasons: since (a) a type can have <i>multiple</i> constructors, and a constructor itself thus carries semantics, (b) some constructors have more parameters than others (c) it would also conflict with &quot;<i>make explicit with what needs to be explicit</i>&quot;."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1519117522, "post_id": 48876986, "comment_id": 84766789, "body": "If this were somehow possible, I think you need your own custom typeclass. Otherwise, what could the type of <code>g</code> be? The one you gave <code>(Applicative f) =&gt; f a -&gt; f a</code> is too general, since it allows <code>f ~ (-&gt;) b</code>, but <code>b -&gt; a</code> has no constructors. Hence, we need a stronger constraint. With a custom typeclass, one could just move everything in the instances, and avoid to match on <code>f x</code> which is not allowed."}, {"owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1519168350, "post_id": 48876986, "comment_id": 84797191, "body": "@chi What does <code>~</code> mean here?"}], "owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1519093663, "creation_date": 1519093663, "question_id": 48876986, "link": "https://stackoverflow.com/questions/48876986/define-function-independent-of-specific-value-constructor-templates", "title": "Define function independent of specific value constructor (templates?)", "body": "<p>Is it possible to write a function for generic types (in this case applicatives) without making assumptions about the name of type constructors?</p>\n\n<p>I can write the following:</p>\n\n<pre><code>f :: Maybe a -&gt; Maybe a\nf (Just a) = (Just a)\n</code></pre>\n\n<p>That one works on <code>Maybe</code>s and only instances with the <code>Just</code> constructor.</p>\n\n<p>But say I had different types that have a value constructor that had the same name as the type constructor:</p>\n\n<pre><code>data T a = T a\n\ninstance Functor T where\n  fmap f (T a) = T (f a)\n\ninstance Applicative T where\n  pure = T\n  (T f) &lt;*&gt;  (T something) = fmap f (T something)\n\n\n\n\ndata U a = U a\n\ninstance Functor U where\n  fmap f (U a) = U (f a)\n\ninstance Applicative U where\n  pure = U\n  (U f) &lt;*&gt;  (U something) = fmap f (U something)\n</code></pre>\n\n<p>In this case <code>T</code> and <code>U</code> are isomorphic, but maybe they also would have constructors that are special to either one in a real example... does not matter here.</p>\n\n<p>Now what if wanted a function that operates both on <code>T</code> and <code>U</code>... I could write the function two times, like so:</p>\n\n<pre><code>gt :: T a -&gt; T a\ngt (T x) =  T x\n\ngu :: U a -&gt; U a\ngu (U x) =  U x\n</code></pre>\n\n<p>Is there also a way to make a template for this function like this?</p>\n\n<pre><code>g :: (Applicative f) =&gt; f a -&gt; f a\ng (f x) = f x\n</code></pre>\n\n<p>That will give me a syntax error for some reason, even though it has the same structure as <code>gt</code> and <code>gu</code>.</p>\n\n<p>If there is no way to do that then why not?</p>\n"}, {"tags": ["haskell", "opaleye"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1519094606, "post_id": 48876632, "comment_id": 84758220, "body": "<code>printSql</code> <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/blob/master/Doc/Tutorial/TutorialBasic.lhs#L854\" rel=\"nofollow noreferrer\">is defined in the tutorial itself</a>, in terms of <a href=\"https://hackage.haskell.org/package/opaleye-0.6.0.0/docs/Opaleye-Sql.html#v:showSqlForPostgres\" rel=\"nofollow noreferrer\"><code>showSqlForPostgres</code></a>. Note that the tutorial uses explicit or qualified imports for everything; that being so, if the function came from Opaleye you&#39;d be able to discover that at once through the import list."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519106386, "post_id": 48876632, "comment_id": 84761473, "body": "@duplode that answers my question, thank you."}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519090240, "creation_date": 1519090240, "question_id": 48876632, "link": "https://stackoverflow.com/questions/48876632/how-to-view-the-sql-generated-by-an-opaleye-query", "title": "How to view the SQL generated by an Opaleye query?", "body": "<p>In the <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/blob/master/Doc/Tutorial/TutorialBasic.lhs\" rel=\"nofollow noreferrer\">Opaleye Tutorial</a>, line 88 lists the following example <code>ghci</code> command.</p>\n\n<pre><code>ghci&gt; printSql personQuery\n</code></pre>\n\n<p><code>personQuery</code> there is a predefined query, and it appears that <code>printSql</code> is a function which prints the SQL generated by it.</p>\n\n<p>Where is this <code>printSql</code> function defined? I have searched through all the modules of the <a href=\"https://hackage.haskell.org/package/opaleye\" rel=\"nofollow noreferrer\">opaleye package</a> and do not see it defined there.</p>\n\n<p><strong>How can I see the SQL generated by an opaleye query?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1519087350, "post_id": 48876279, "comment_id": 84756561, "body": "What is the type that you expect this function to have?  Although Haskell is very nice about inferring types for you, if you are nice to Haskell and tell it what type you are looking for, then the compiler sometimes offers helpful clues about what to do next."}, {"owner": {"reputation": 663, "user_id": 1131296, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6f0bcea014c1cf2db91a8d97c12a977c?s=128&d=identicon&r=PG&f=1", "display_name": "tech_enthusiast", "link": "https://stackoverflow.com/users/1131296/tech-enthusiast"}, "edited": false, "score": 0, "creation_date": 1519087472, "post_id": 48876279, "comment_id": 84756593, "body": "I believe you should go through tutorials and search some practical programs on search engine. Your question is too broad to answer."}, {"owner": {"reputation": 9, "user_id": 9383336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lord ken", "link": "https://stackoverflow.com/users/9383336/lord-ken"}, "edited": false, "score": 0, "creation_date": 1519087518, "post_id": 48876279, "comment_id": 84756603, "body": "i am handling a task that involves iteration and popping out of characters till the list is empty.i would like to know mostly how to iterate over a list character by character"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1519087561, "post_id": 48876279, "comment_id": 84756614, "body": "Do you expect the function to change the value of <code>name</code>?  Variable in Haskell are immutable so that is not possible."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519087657, "post_id": 48876279, "comment_id": 84756641, "body": "<code>answer (firstCharacter:remainingCharacters) = answer remainingCharacters ; answer [] = ()</code>.  This function will traverse the list, taking no actions and returning a unit value (that is, <code>( )</code>).  It seems unlikely this is what you desire, but if it helps then great."}, {"owner": {"reputation": 9, "user_id": 9383336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lord ken", "link": "https://stackoverflow.com/users/9383336/lord-ken"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519087809, "post_id": 48876279, "comment_id": 84756677, "body": "@ThomasM.DuBuisson. how would i then iterate through a list character by character"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1519090211, "post_id": 48876279, "comment_id": 84757296, "body": "I just showed you. Perhaps instead of the how, ask the why.  Your goal is probably not to iterate over a list but to produce a new list, or count the length, or sum the values, or something else. Consider discussing the goal in addition to your attempt to solve it which involves iteration."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1519139128, "post_id": 48876279, "comment_id": 84781435, "body": "@lordken You don&#39;t iterate through it, you recurse over it, processing one character at a time. (And you almost never write <code>length</code> - instead, you examine the structure of your input.)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1519151900, "creation_date": 1519151900, "answer_id": 48892104, "question_id": 48876279, "link": "https://stackoverflow.com/questions/48876279/program-to-iterate-through-a-string-in-haskell/48892104#48892104", "title": "Program to iterate through a string in haskell", "body": "<p>Here is working code that gets as close as possible to your non-working code:</p>\n\n<pre><code>answer [] = True\nanswer (_:name) = answer name\n</code></pre>\n\n<p>For example, in ghci:</p>\n\n<pre><code>&gt; answer \"people\"\nTrue\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1519204605, "last_edit_date": 1592644375, "creation_date": 1519162778, "answer_id": 48894660, "question_id": 48876279, "link": "https://stackoverflow.com/questions/48876279/program-to-iterate-through-a-string-in-haskell/48894660#48894660", "title": "Program to iterate through a string in haskell", "body": "<p>Your code is an attempted transliteration of an imperative one:</p>\n<pre><code>name = &quot;people&quot;\nanswer = \n    if length name == 0\n        then True\n    else\n     --(drop 1 name)    -- (*) NB\n       answer\n</code></pre>\n<p>but Haskell is a functional language. Here (NB) you tried to write two <em>statements</em> in a row, but discovered it is impossible to do so in Haskell's <strong><code>if</code></strong> <em>expression</em>. There's no <strong><code>begin</code></strong> as they have in Scheme, no <strong><code>progn</code></strong> as they have in Lisp. Nor <strong><code>{ }</code></strong> braces as they have in C++... oh, wait, there are!</p>\n<pre><code>answer =                -- its inferred type:  Monad m =&gt; StateT [a] m Bool\n  do { name &lt;- get                   -- &quot;get&quot; the current value as name\n     ; if length name == 0\n         then    (return True)       -- base case\n         else\n            do {  put (drop 1 name)  -- &quot;put&quot; back the changed value\n               ;  answer  }          -- and recurse \n     }\n</code></pre>\n<p>For the above to work, <code>import Control.Monad.Trans.State</code>. We use it as</p>\n<pre><code>~&gt; runStateT answer name\n(True,&quot;&quot;)\nit :: (Bool, [Char])\n</code></pre>\n<p><code>True</code> is our answer, <code>&quot;&quot;</code> is the final state of our <em>state</em>, the <code>name</code> that we passed in, which was getting its head characters &quot;popped off&quot; of it as requested, one by one, by the <code>drop 1</code> calls.</p>\n<ul>\n<li><p>(a digression:) &quot;Monad&quot; is just <em>something</em> that lets us use &quot;magic words&quot; \u2013 like <strong><code>get</code></strong>, <strong><code>put</code></strong> \u2013 peculiar to each specific type of &quot;Monad&quot;, like the &quot;state Monad&quot; here; so we can have our own special language to use, peculiar to each specific type of task at hand. A <em>domain-specific</em> language, if you will. Well, actually, it is exactly what Monads are (<em>embedded</em> DSLs, at that).</p>\n<p>If we were only using <strong><code>get</code></strong>, then we'd have a more restricted monad, a &quot;Reader&quot; one. Or if we'd only used <strong><code>put</code></strong>, we'd have a &quot;Writer&quot; (Haskell can't use the same magic words to name different actions of different Monads, so it uses <strong><code>ask</code></strong> and <strong><code>tell</code></strong> instead, but that's just details).</p>\n</li>\n</ul>\n<p>We could've written it also as</p>\n<pre><code>answer name =           -- its inferred type:  Monad m =&gt; [a] -&gt; m Bool\n    if length name == 0              -- examine the received value\n       then (return True)            -- base case\n    else\n       do { let x = drop 1 name      -- define the modified value\n          ; answer x }               -- and pass it into the recursion\n</code></pre>\n<p>but then here the Monad is not being used <em>at all</em>, except for <code>return</code>ing! We haven't used any magic words, except for <strong><code>return</code></strong> (which is a general word that <em>every</em> monad has). So it's just the same as</p>\n<pre><code>answer name =           -- its inferred type:   [a] -&gt; Bool\n    if length name == 0\n       then True\n    else\n       let x = drop 1 name \n       in answer x \n</code></pre>\n<p>because in functional programming the <em>returning</em> is implied \u2013 the last expression's value is what's &quot;returned&quot; from a function, i.e. it's what the function's value is, as a whole.</p>\n<p>For such a simple task, this last, functional code is what's preferred. The <strong><code>let</code></strong> <em>expression</em> allows us to define a new value, first, and use it, later.</p>\n<p>Re-measuring <code>length</code> over and over is of course an anti-pattern. In Haskell, there's <em>pattern-matching</em> to be used &quot;for greater good&quot; in such cases:</p>\n<pre><code>answer :: [a] -&gt; Bool\nanswer name =  \n    case name of\n       []    -&gt; True                 -- base case\n       (_:x) -&gt; answer x             -- recursive case\n</code></pre>\n<p>and <em>this</em> function we use just by calling it,</p>\n<pre><code>~&gt; answer name\nTrue\nit :: Bool\n</code></pre>\n<p>The explicit <code>case</code> expression is more conveniently written with <em>clause</em> syntax, that you find in <a href=\"https://stackoverflow.com/a/48892104/849891\">the other answer here</a>, by <a href=\"https://stackoverflow.com/users/791604/daniel-wagner\">Daniel Wagner</a>.</p>\n<p>Now ask your real question, the one which talks about <em>what</em> you want to achieve, not <em>how</em> you think you need to go about it. But do it as a separate post, please.</p>\n"}], "owner": {"reputation": 9, "user_id": 9383336, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lord ken", "link": "https://stackoverflow.com/users/9383336/lord-ken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 1, "answer_count": 2, "score": -4, "last_activity_date": 1519204605, "creation_date": 1519087156, "question_id": 48876279, "link": "https://stackoverflow.com/questions/48876279/program-to-iterate-through-a-string-in-haskell", "title": "Program to iterate through a string in haskell", "body": "<p>i would like to iterate through a string in haskell by poping out each character just like a stack\ntill no more characters are left . a simple line of code to guide me through this is my bad code</p>\n\n<pre><code>name = \"people\"\nanswer = \n    if length name == 0\n        then True\n    else\n     --(drop 1 name)\n       answer\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1519081973, "post_id": 48875334, "comment_id": 84755088, "body": "The error message is usually pretty explicit about the expected type and the actual type. The important detail is that the <code>&lt;-</code> syntax in a <code>do</code> block is not assignment. The type of the expression that&#39;s bound does not match the type of the pattern bound to it. (If they were the same, it&#39;d be redundant with <code>let</code> statements in a <code>do</code> block.)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1519082117, "post_id": 48875334, "comment_id": 84755141, "body": "can you try the following <code>case modul &lt;- parseModule &lt;$&gt; readFile &quot;foo.json&quot; of ..</code> - I think that one should work, because here you still execute the (IO) action of interacting with the filesystem and read in the file wheras the latter only looks at the action to be done. Think of it like checking the results of a recipe, e.g. is the cake good (<code>Right</code>) or bad (<code>Left</code>), and checking the recipe itself - which doesn&#39;t make sense - the recipe is neither good nor bad - only its result."}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1519082457, "post_id": 48875334, "comment_id": 84755228, "body": "Thanks, I added the error in the question. @epsilonhalbe looks like you&#39;re correct, the error has to do with weather <code>parseModule &lt;$&gt; readFile &quot;foo.json&quot;</code> is evaluated early or late. Can I use something like <code>seq</code> or is the binding to <code>modul</code> the only way to do it even inline?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1519082915, "post_id": 48875334, "comment_id": 84755352, "body": "@epsilonhalbe I have never seen <code>&lt;-</code> used inside a <code>case of</code>. GHCi 8.0 rejects it. Is that valid syntax in newer GHCs?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1519083553, "post_id": 48875334, "comment_id": 84755530, "body": "I&#39;ve seen this syntax in a codebase at work which was then using ghc 7.x so it must have been around for a while. I guess it not working is either because of ghci or the newer ghc. Maybe I should have added a disclaimer that i would NOT recommend using this syntax, though valid I think it is really confusing"}], "answers": [{"comments": [{"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1519084051, "post_id": 48875720, "comment_id": 84755678, "body": "Great answer, thank you! So I guess the <code>do</code> syntax: <code>do { x &lt;- expr(); f(x); }</code> is just syntactic sugar for something like this: <code>expr &gt;&gt;= f</code> ? Also, in both cases the expr() is evaluated and becomes bound to a result, instead of passing the thunk around?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 3, "creation_date": 1519084228, "post_id": 48875720, "comment_id": 84755730, "body": "@rausted Precisely correct on the sugar point. The details of the sugar are given <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">in the Report</a>. As for the comment about &quot;evaluated and becomes not a thunk&quot;: no, that comment is off-target. &quot;Evaluated&quot; (thunk-ness) and &quot;executed&quot; (the actual input/output has been done) are separate concepts; an action can be converted from a thunk to an evaluated thing without having been executed."}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519084828, "post_id": 48875720, "comment_id": 84755885, "body": "@DanielWagner I don&#39;t get it, how can a symbolic expression involving IO let&#39;s say, be evaluated without being executed? And does bind evaluate, execute or none of the above?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 1, "creation_date": 1519085165, "post_id": 48875720, "comment_id": 84755966, "body": "@rausted When something is <i>evaluated</i>, nothing really happens, except perhaps the processor getting warm from local constants being pre-calculated into normal form. Evaluation only ever happens once for any given Haskell value (when an already-evaluated value is used again it&#39;ll simply have everything in memory already). For IO actions, evaluation normally doesn&#39;t do anything at all \u2013 you basically just get the confirmation <i>yes, this is something that could be executed</i>. OTOH, execution is <i>specific</i> to IO actions, and is always accomplished through a monadic bind to <code>main</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1519085283, "post_id": 48875720, "comment_id": 84755993, "body": "...The bind itself does neither evaluate nor execute an IO action, but it allows the runtime to execute it as soon as the control flow arrives there."}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1519085799, "post_id": 48875720, "comment_id": 84756121, "body": "Alright I think I got it, thanks for the great answers!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 1, "creation_date": 1519086039, "post_id": 48875720, "comment_id": 84756191, "body": "@rausted I admit I don&#39;t know how to answer &quot;How can an IO action be evaluated without being executed?&quot;. You just... do it. Imagine this: I write down <code>if isPrime (1e1000+1) then putStrLn &quot;Hiya, rausted!&quot; else launchMissiles</code>. Evaluation is the process of deciding whether to warmly greet you or blow up the world; execution is then acting on that decision. As for bind, it does none of the above, it just is another way to construct an IO action. Evaluation and execution don&#39;t happen from within the language."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1519083286, "last_edit_date": 1519083286, "creation_date": 1519082957, "answer_id": 48875720, "question_id": 48875334, "link": "https://stackoverflow.com/questions/48875334/haskell-binding-to-variable-vs-inline-declaration/48875720#48875720", "title": "Haskell binding to variable Vs inline declaration", "body": "<p><code>parseModule &lt;$&gt; readFile \"foo.json\"</code> is not a value that you could pattern-match on. That value wouldn't be purely functional, because it depends on a real-world resource (the file).</p>\n\n<p>Instead, it is an <em>IO action</em> which is able to obtain the value when executed (it then takes a &ldquo;snapshot of the world state, frozen into a pure value&rdquo;).</p>\n\n<p>Really, there's only one way to execute IO actions: assign them to the name <code>main</code>, compile and run. That may sound crazy prohibitive &ndash; you can only have <em>one single action</em> in a program? &ndash; but actually it's not, because you can combine multiple actions (to be executed sequentially) into a single action and execute that. This <em>composing of actions</em> is accomplished through the concept of <em>monads</em>. In your case, you basically want to compose the action of type <code>IO (Either String Module)</code> with a function of type <code>Either String Module -&gt; IO ()</code>. That's what the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad-Instances.html#v:-62--62--61-\" rel=\"nofollow noreferrer\"><code>&gt;&gt;=</code> operator</a> is for.</p>\n\n<pre><code>main :: IO ()\nmain = parseModule &lt;$&gt; readFile \"foo.json\" &gt;&gt;= f\n where f modul = case modul of ...\n</code></pre>\n\n<p>...or in lambda-style,</p>\n\n<pre><code>main = parseModule &lt;$&gt; readFile \"foo.json\"\n      &gt;&gt;= \\modul -&gt; case modul of\n            Left s  -&gt; error s\n            Right m -&gt; what m `shouldBe` \"module\"\n</code></pre>\n\n<p>Because that kind of binding is needed so often, Haskell has the special <code>do</code> syntax for it, which you've already used in the first snippet. It is simply syntactic sugar for this <code>&gt;&gt;=</code> operator chain, but that monadic bind is essential.</p>\n"}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 48875720, "answer_count": 1, "score": 0, "last_activity_date": 1519083286, "creation_date": 1519080454, "last_edit_date": 1519082268, "question_id": 48875334, "link": "https://stackoverflow.com/questions/48875334/haskell-binding-to-variable-vs-inline-declaration", "title": "Haskell binding to variable Vs inline declaration", "body": "<p>I'm new to Haskell and I'm writing a compiler from JSON to some other format. I don't understand the difference between binding an expression to a variable versus passing it inline, here's two examples (inside a <code>do</code> block) which I expect to work the same, but instead the second one confuses the typechecker and fails:</p>\n\n<p>Works as expected</p>\n\n<pre><code>modul &lt;- parseModule &lt;$&gt; readFile \"foo.json\"\ncase (modul) of\n        (Left s) -&gt; error s\n        (Right m) -&gt; what (m :: Module) `shouldBe` \"module\"\n</code></pre>\n\n<p>Fails typechecking</p>\n\n<pre><code>case (parseModule &lt;$&gt; readFile \"foo.json\") of\n        (Left s) -&gt; error s\n        (Right m) -&gt; what (m :: Module) `shouldBe` \"module\"\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Either a0\u2019 with \u2018IO\u2019\n  Expected type: IO (Either String Module)\n    Actual type: Either a0 (Either String Module)\n</code></pre>\n"}, {"tags": ["haskell", "testing"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519077922, "post_id": 48874791, "comment_id": 84753659, "body": "This is not exactly what I meant. As the property should hold for any <code>xs</code>, I meant it to be arbitrary as well. This is not important to the spirit of the answer though, just a minor detail."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519079617, "post_id": 48874791, "comment_id": 84754288, "body": "I&#39;m confused as to what else you want to be arbitrary.  Do you understand how to write your property now or not?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519079773, "post_id": 48874791, "comment_id": 84754351, "body": "Let me fix the previous comment: read as &quot;I meant <code>xs</code> to be arbitrary as well&quot;. I do understand how to write my property, though I am a bit disappointed there is no clever combination of combinators to solve this in one line."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1519080127, "post_id": 48874791, "comment_id": 84754483, "body": "You can pretty much always code golf things into a one liner.  <code>mytest xs = flip isSubsequenceOf xs &lt;$&gt; sublistOf xs</code>, for example."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 2, "creation_date": 1519084015, "post_id": 48874791, "comment_id": 84755669, "body": "@Kindaro But <code>xs</code> <i>is</i> arbitrary. In particular, <code>quickCheck mytest</code> proceeds by calling <code>arbitrary</code> and passing its result as <code>xs</code> to <code>mytest</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519085064, "post_id": 48874791, "comment_id": 84755937, "body": "@DanielWagner Oh. This is revealing."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519085297, "post_id": 48874791, "comment_id": 84755995, "body": "Thank you @DanielWagner, I was thinking I must be densely missing the question."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1519077421, "creation_date": 1519077421, "answer_id": 48874791, "question_id": 48874428, "link": "https://stackoverflow.com/questions/48874428/how-do-i-write-a-quickcheck-property-that-arbitrarily-modifies-its-arbitrary-inp/48874791#48874791", "title": "How do I write a QuickCheck property that arbitrarily modifies its arbitrary input?", "body": "<blockquote>\n  <p>Do I have to spell out a full-blown monadic device of type Gen Result?</p>\n</blockquote>\n\n<p>What is a \"full-blown monadic device\"?  Yes, you should probably use the <code>Gen</code> monad but it isn't hard and there is a Testable instance for you to use:</p>\n\n<pre><code>mytest :: [Int] -&gt; Gen Bool\nmytest xs = do ys &lt;- sublistOf xs\n               pure $ ys `isSubsequenceOf` xs\n  where isSubsequenceOf _ _ = True\n</code></pre>\n\n<p>And the use:</p>\n\n<pre><code>*Main&gt; quickCheck mytest\n+++ OK, passed 100 tests.\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 48874791, "answer_count": 1, "score": 0, "last_activity_date": 1519078050, "creation_date": 1519075616, "last_edit_date": 1519078050, "question_id": 48874428, "link": "https://stackoverflow.com/questions/48874428/how-do-i-write-a-quickcheck-property-that-arbitrarily-modifies-its-arbitrary-inp", "title": "How do I write a QuickCheck property that arbitrarily modifies its arbitrary input?", "body": "<p>Suppose I want to verify <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:isSubsequenceOf\" rel=\"nofollow noreferrer\"><code>isSubsequenceOf</code></a>. I then need to generate some <code>xs</code>, and then generate <code>ys</code> out of them by <em>arbitrarily</em> adding or removing some elements. Then I could verify the property for all the pairs thus obtained. Using <a href=\"https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck.html#v:sublistOf\" rel=\"nofollow noreferrer\">sublistOf</a>, I would go like this:</p>\n\n<pre><code>\\xs -&gt; sublistOf xs `isSubsequenceOf` xs\n</code></pre>\n\n<p>\u2014 Except that this does not type check.</p>\n\n<p>Unfortunately I don't understand the design of the QuickCheck library overall, and even such seemingly trivial cases puzzle me a big deal. Do I have to spell out a full-blown monadic device of type <code>Gen Result</code>? It kind of defies the purpose of the abstraction.</p>\n"}, {"tags": ["list", "haskell", "recursion", "merge", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519152076, "post_id": 48874342, "comment_id": 84789733, "body": "9 comes before 8 in the input, but not in the output. Is this intentional? If so, by what logic is the order of the output chosen?"}], "answers": [{"tags": [], "owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "is_accepted": false, "score": 2, "last_activity_date": 1519093395, "last_edit_date": 1519093395, "creation_date": 1519076377, "answer_id": 48874575, "question_id": 48874342, "link": "https://stackoverflow.com/questions/48874342/merging-two-ordered-lists-of-numbers-into-one-with-recursion/48874575#48874575", "title": "merging two ordered lists of numbers into one with recursion", "body": "<p>what about</p>\n\n<pre><code>let { addlist (a:as) (b:bs) = if  a&lt;= b then  a : addlist as (b:bs) else  b : addlist (a:as) bs; \naddlist [] bs = bs; \naddlist as [] = as }\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>addlist (a:as) (b:bs) = if  a &lt;= b then  a : addlist as (b:bs) else  b : addlist (a:as) bs\naddlist [] bs = bs\naddlist as [] = as \n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9382576"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519116662, "creation_date": 1519075228, "last_edit_date": 1519116662, "question_id": 48874342, "link": "https://stackoverflow.com/questions/48874342/merging-two-ordered-lists-of-numbers-into-one-with-recursion", "title": "merging two ordered lists of numbers into one with recursion", "body": "<p>I am new to Haskell, recursion \nfor e.g. INPUT [1,3,4,5] [6,9,8,10]\nOUTPUT = [1,3,4,5,6,8,9,10]\nMy previous attempt was</p>\n\n<pre><code>&gt;let addlist [] [] = []\n\n&gt;let addlist (a:as) (b:bs) = (a+b) : addlist as bs\n&gt;let x = [1..5]\n&gt;let y = [6..10]\n&gt;addlist x y\n</code></pre>\n\n<p>But this adds the numbers in the list rather than merging them. </p>\n"}, {"tags": ["haskell", "parameterized-types"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1519070153, "post_id": 48873234, "comment_id": 84750384, "body": "You can do this with <code>Maybe</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1519070254, "post_id": 48873234, "comment_id": 84750438, "body": "@Code-Apprentice: but this will not factor out the <code>c</code> type parameter."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519070304, "post_id": 48873234, "comment_id": 84750458, "body": "@WillemVanOnsem, what about structural typing? What if I have a function that only cares about <code>company</code> and should accept both of these?"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1519071607, "post_id": 48873234, "comment_id": 84751012, "body": "I don&#39;t think it is possible &quot;by default&quot;. You can search for libraries with key words like &quot;extensible records&quot;, &quot;variant&quot; or &quot;row polymorphism&quot;"}, {"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1519071821, "post_id": 48873234, "comment_id": 84751091, "body": "@norbertpy Why do you want to do this? In other words, why do you need two different <code>Car</code> types?"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1519072611, "post_id": 48873234, "comment_id": 84751445, "body": "@EmmanuelRosa, because I have so many combinations of Cars and I don&#39;t want to define a new type for every single one of them. <code>CarWithoutYear</code>, <code>CarWithoutModel</code>, <code>CarWithoutYearAndModel</code> seems a little crazy, doesn&#39;t it? I&#39;m guessing either I don&#39;t understand type systems or this is how it should be? <a href=\"https://en.wikipedia.org/wiki/Combinatorial_explosion\" rel=\"nofollow noreferrer\">Combinatorial Explosion</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1519072904, "post_id": 48873234, "comment_id": 84751568, "body": "@norbertpy Your first <code>data Car a b c = ...</code> already captures all of those, via <code>Car a b ()</code>, <code>Car a () c</code>, and <code>Car a () ()</code>, respectively."}, {"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1519074342, "post_id": 48873234, "comment_id": 84752160, "body": "@norbertpy Well, the thing to consider is that each of those combinations is a use-case you&#39;re going to have to handle anyway. Defining each of the possibilities as types (or perhaps a single sum type with multiple constructors) is actually helpful because it makes them explicit. But you&#39;re right, it&#39;s quite the Combinatorial Explosion. I think it&#39;s worth thinking about what benefit you&#39;d get by making all the &quot;attributes&quot; optional."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 1, "creation_date": 1519074488, "post_id": 48873234, "comment_id": 84752237, "body": "@EmmanuelRosa, thanks. Yeah. But I&#39;m wondering why the same set of operation we can have on values cannot be done on types. Imagine I have two row types and I want to have a function that receives these two and return a new row type with their common properties. Then what?"}, {"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 1, "creation_date": 1519077662, "post_id": 48873234, "comment_id": 84753568, "body": "@norbertpy Sorry, but it&#39;s just not clear what you&#39;re trying to achieve. Perhaps you can show a working example in another programming language."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1519078303, "post_id": 48873234, "comment_id": 84753832, "body": "@EmmanuelRosa, never mind. You helped a lot :)"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1519239272, "post_id": 48873234, "comment_id": 84833103, "body": "Not an answer to your question, but depending of what you want to achieve, you could switch to OCaml which has great polymorphic variants. I guess it&#39;s also present in ReasonML. <a href=\"https://caml.inria.fr/pub/docs/manual-ocaml/lablexamples.html#sec46\" rel=\"nofollow noreferrer\">caml.inria.fr/pub/docs/manual-ocaml/lablexamples.html#sec46</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 1, "creation_date": 1519074211, "post_id": 48873849, "comment_id": 84752112, "body": "<code>Maybe</code> helps when I know what type I want. Just like a function that receives <code>values</code> and return <code>values</code>, I wanna have a type level function that receives <code>types</code> and returns different <code>types</code>.  Why is this so complicated?"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519074323, "post_id": 48873849, "comment_id": 84752155, "body": "Imagine I have two row types and I want to have a function that receives these two and return a new row type with their common properties. Then what?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 1, "creation_date": 1519080452, "post_id": 48873849, "comment_id": 84754618, "body": "@norbertpy well, type-level functions in haskell are called &quot;type families&quot;, so maybe that will help, and they can be used in combination with type classes. Or you may just be looking for type classes. It&#39;s still not clear to me what you&#39;re trying to achieve, sorry."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 3, "creation_date": 1519107357, "post_id": 48873849, "comment_id": 84761858, "body": "@norbertpy It looks like you are looking for row polymorphism, which Haskell does not support.  Every field belongs to exactly one record type, and every record type has a fixed set of fields.  There are various halfhearted simulations of it though. <a href=\"https://wiki.haskell.org/Extensible_record\" rel=\"nofollow noreferrer\">More info here</a>."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 7, "last_activity_date": 1519072848, "creation_date": 1519072848, "answer_id": 48873849, "question_id": 48873234, "link": "https://stackoverflow.com/questions/48873234/haskell-optional-type-parameter/48873849#48873849", "title": "Haskell optional type parameter", "body": "<p>Depending on what exactly you're asking, there are different approaches I'm familiar with. But first of all it's not clear to me that you want those types to be parameterized. i.e. I suspect what you really want is something like:</p>\n\n<pre><code>data Car = Car { company :: Company\n               , model :: String\n               , year :: Int  \n               }\n</code></pre>\n\n<p>In particular it seems unlikely that you would need separate representations for the <code>year</code>.  If that's the case, then the answer to your question (how to make the year optional is:</p>\n\n<pre><code>data Car = Car { company :: Company\n               , model :: String\n               , year :: Maybe Int -- N.B. Maybe  \n               }\n</code></pre>\n\n<p>If you're really asking about having a parameterized type which is optional then you can do something like this:</p>\n\n<pre><code>data Foo a = Foo Int Char a\n</code></pre>\n\n<p>Then you can use this as <code>Foo ()</code> when you wish to treat it as \"a Foo without the last parameter\". You can further make a newtype wrapper around it if you want.</p>\n\n<pre><code>newtype FooWithoutA = FooWithoutA (Foo ())\n</code></pre>\n\n<p>Since the unit type <code>()</code> has just a single value this indicates there's nothing of interest in that field.</p>\n\n<hr>\n\n<p>Aside: You also might be interested in reading <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"noreferrer\">http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/</a> which will give you a sense of why different ways of structuring your data are equivalent, among other insights.</p>\n"}], "owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 781, "favorite_count": 1, "accepted_answer_id": 48873849, "answer_count": 1, "score": 0, "last_activity_date": 1519072848, "creation_date": 1519069944, "question_id": 48873234, "link": "https://stackoverflow.com/questions/48873234/haskell-optional-type-parameter", "title": "Haskell optional type parameter", "body": "<p>In haskell, how do you define an optional type parameter:</p>\n\n<pre><code>data Car a b c = Car { company :: a\n                     , model :: b\n                     , year :: c  \n                     }\n-- I want to return this type if `c` is not provided\ndata Car a b = Car { company :: a  \n                   , model :: b\n                   }\n</code></pre>\n\n<p>In above, I wanna have have an optional type <code>c</code> and based on whether it's provided or not return a slightly different type. How do I do this? Am I doing this totally wrong?</p>\n"}, {"tags": ["http", "haskell", "elm", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 7, "last_activity_date": 1519068790, "creation_date": 1519068790, "answer_id": 48872989, "question_id": 48872325, "link": "https://stackoverflow.com/questions/48872325/elm-networkerror-on-get-request-but-console-says-its-fine/48872989#48872989", "title": "Elm NetworkError on get request, but console says it&#39;s fine", "body": "<p>I cannot say what your error is, but I get an error due to CORS:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Main.elm:1 Failed to load http://localhost:3000/:\nNo 'Access-Control-Allow-Origin' header is present on the requested resource.\nOrigin 'http://localhost:8000' is therefore not allowed access.\n</code></pre>\n\n<p>So I have adapted your <code>Main.{hs,elm}</code> to serve the file from the same server as the access is happening to:</p>\n\n<h2>Main.elm</h2>\n\n<pre><code>Refresh -&gt; (model, send DataRequest (getString \"/data\"))\n</code></pre>\n\n<h2>Main.hs</h2>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = scotty 3000 $ do\n  get \"/\" $ file \"../index.html\"\n  get \"/data\" $ text $ pack \"a\"\n</code></pre>\n\n<p>instead of using <code>elm-reactor</code> I run <code>elm-make src/Main.elm --output=index.html</code></p>\n"}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 48872989, "answer_count": 1, "score": 4, "last_activity_date": 1519068790, "creation_date": 1519065641, "question_id": 48872325, "link": "https://stackoverflow.com/questions/48872325/elm-networkerror-on-get-request-but-console-says-its-fine", "title": "Elm NetworkError on get request, but console says it&#39;s fine", "body": "<p>I'm building my first web app in Elm, and I have this problem that when I do a get request to a local server, Elm says it is 'NetworkError' even though the browser console says that it worked.</p>\n\n<p>I've made a minimal example as follows:</p>\n\n<p>The server is made with Haskell and <a href=\"https://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\">Scotty</a>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Web.Scotty\nimport Data.Text.Lazy (pack)\n\nmain :: IO ()\nmain = scotty 3000 $ get \"/\" $ text $ pack \"a\"\n</code></pre>\n\n<p>All it does is respond with the letter 'a' when you do a get request to localhost:3000. The Elm app just displays the response if there is one and the error if there is one and a button to do the get request with:</p>\n\n<pre><code>import Http exposing (getString, send, Error)\nimport Html exposing (Html, text, br, button, body, program)\nimport Html.Events exposing (onClick)\n\ntype Msg\n  = DataRequest (Result Error String)\n  | Refresh\n\ntype alias Model =\n  { response : String\n  , err : String\n  }\n\nmain : Program Never Model Msg\nmain = program\n  { init = init\n  , view = view\n  , update = update\n  , subscriptions = subscriptions\n  }\n\nsubscriptions : Model -&gt; Sub Msg\nsubscriptions _ = Sub.none\n\ninit : (Model, Cmd Msg)\ninit = ({ response = \"\", err = \"\"} , Cmd.none)\n\nupdate : Msg -&gt; Model -&gt; (Model, Cmd Msg)\nupdate msg model =\n  case msg of\n    DataRequest (Err err) -&gt; ({ model | err = toString err},     Cmd.none)\n    DataRequest (Ok response) -&gt; ({model | response = response}, Cmd.none)\n    Refresh -&gt; (model, send DataRequest (getString \"http://localhost:3000\"))\n\nview : Model -&gt; Html Msg\nview {response, err} =\n  body []\n    [ text &lt;| \"Response: \" ++ response\n    , br [] []\n    , text &lt;| \"Error: \" ++ err\n    , br [] []\n    , button [ onClick Refresh ] [ text \"Send request\" ]\n    ]\n</code></pre>\n\n<p>Here's a screenshot of the browser console when I do a get request. I don't really know much about this stuff, but it looks fine as far as I can see.\n<a href=\"https://i.stack.imgur.com/xwEAR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xwEAR.png\" alt=\"Screenshot of browser console\"></a></p>\n\n<p>What I want is for the 'Response' to show the letter 'a' after it, and the 'Error' to be blank.  Instead the 'Error' is 'NetworkError' and 'Response' is blank.</p>\n\n<p>I have put this minimal example in a Git repo in case anyone is kind enough to try it out and tell me what is wrong:</p>\n\n<p><a href=\"https://github.com/8n8/elmnetworkerror\" rel=\"nofollow noreferrer\">https://github.com/8n8/elmnetworkerror</a></p>\n\n<p>(I am aware that there is a very similar question at <a href=\"https://stackoverflow.com/questions/48818455/elm-http-request-returns-networkerror-for-successful-requests\">Elm http request returns NetworkError for successful requests</a> but there are no answers yet and I thought it would benefit from a complete minimal example.)</p>\n"}, {"tags": ["haskell", "dfa", "declarative"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519047264, "post_id": 48867033, "comment_id": 84737915, "body": "This is mostly just a copy of a problem statement, not a question. What part are you having trouble with? Ask a question about that."}, {"owner": {"reputation": 470, "user_id": 4815713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b92f538fcec16fee1bdbbae286291c95?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Georg Podlech", "link": "https://stackoverflow.com/users/4815713/paul-georg-podlech"}, "edited": false, "score": 1, "creation_date": 1519047357, "post_id": 48867033, "comment_id": 84737970, "body": "From your code it&#39;s obvious you are using an imperative approach, which will not help you in haskell. Do you have any resources on functional programming and haskell to help you understand the basics of FP?"}, {"owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519047719, "post_id": 48867033, "comment_id": 84738210, "body": "@Cubic how can i go about the findtransition function"}, {"owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "edited": false, "score": 0, "creation_date": 1519047830, "post_id": 48867033, "comment_id": 84738280, "body": "i need to compare the first state, the label passed with the elements in the list of transitions. i know how to do it in java but am struggling when trying to handle it with haskell"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1519047881, "post_id": 48867033, "comment_id": 84738320, "body": "@kennedykolute Do you understand what a DFA is and how it works? That&#39;d be the first place to start. Also, read a Haskell tutorial. You&#39;re right, your Java knowledge will not help you a whole lot with Haskell as it&#39;s a completely different paradigm. What you have right now isn&#39;t particularly close to actual Haskell code, it seems to be some kind of imperative pseudo code with a similar syntax to Haskell."}, {"owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "edited": false, "score": 0, "creation_date": 1519048216, "post_id": 48867033, "comment_id": 84738547, "body": "i understand what a DFA is. i have handled a particular problem before using java. I have gone through many tutorials , i have an idea but i keep on getting errors."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519049516, "post_id": 48867033, "comment_id": 84739413, "body": "<code>lst = []</code> and later <code>lst []</code>, what are you trying to do?"}, {"owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "edited": false, "score": 0, "creation_date": 1519050946, "post_id": 48867033, "comment_id": 84740216, "body": "Sorry that&#39;s an error wanted to mean an empty list . I&#39;ll update that"}, {"owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "edited": false, "score": 0, "creation_date": 1519053185, "post_id": 48867033, "comment_id": 84741604, "body": "can i get assistance on the findTransition function . that will really help me understand more"}, {"owner": {"reputation": 470, "user_id": 4815713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b92f538fcec16fee1bdbbae286291c95?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Georg Podlech", "link": "https://stackoverflow.com/users/4815713/paul-georg-podlech"}, "edited": false, "score": 0, "creation_date": 1519118019, "post_id": 48867033, "comment_id": 84767108, "body": "@kennedykolute You should start on a haskell tutorial, specifically about types and type signatures. Knowing what type signature a function should have will help you for the implementation. I suggest you check out <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/</a>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1519059699, "last_edit_date": 1519059699, "creation_date": 1519059055, "answer_id": 48870657, "question_id": 48867033, "link": "https://stackoverflow.com/questions/48867033/a-guide-to-the-right-path-on-accomplishing-the-haskell-commands/48870657#48870657", "title": "A guide to the right path on accomplishing the haskell commands", "body": "<p>Is this homework for a class that you're taking, or is this self-guided Haskell study?  If this is self-guided, I think you might be trying an exercise that's too hard for you at this stage. I would suggest taking a look at this answer:  <a href=\"https://stackoverflow.com/questions/1012573/getting-started-with-haskell/1016986#1016986\">Getting started with Haskell</a>.  Even though it's an old answer, it's been updated now and again, and most of the resources there are still useful.  The <a href=\"http://www.haskell.org\" rel=\"noreferrer\">http://www.haskell.org</a> website also has links to lots of resources for learning Haskell, in the \"Documentation\" section.</p>\n\n<p>If this is homework for a class you're taking, you might be in trouble.  You're making some pretty basic mistakes in your code (using <code>elem</code> where you need <code>`elem`</code>; trying to apply <code>last</code> to four arguments; using an uppercase identifier <code>DFA</code> as a variable name) which shows that you don't have the Haskell fundamentals nailed down yet.</p>\n\n<p>Perhaps you should talk to your professor and let him or her know that this assignment is beyond you.  Maybe you can get an extension, or maybe you can offer to turn in a Java solution for partial credit (assuming that this course isn't specifically a Haskell course).</p>\n\n<p>If you insist on forging ahead, here's a hint.  You're asking for help writing one of the hardest functions, <code>findTransition</code>, but you haven't even written the \"easy\" ones, like <code>allStates</code>, <code>firstState</code>, and so on.  (You've used the same names in your solution, but you've defined them as constants for a specific DFA instead of making them functions applied to a general DFA tuple, which is what the assignment requires).</p>\n\n<p>So, can you complete the following template by filling in the underscores, in order to answer parts 1 and 2(b)?</p>\n\n<pre><code>-- simple type synonyms to make things easier to read\ntype State = String\ntype Symbol = Char\n\n-- some more complicated type synonyms\ntype Transition = (State, Symbol, State)\ntype DFA = ( [State]        -- all states\n           , State          -- first state\n           , [State]        -- final states\n           , [Transition]   -- all transitions\n           )\n\nallStates :: DFA -&gt; [State]\nallStates _ = _\n\nfirstState :: DFA -&gt; State\nfirstState _ = _\n\nfinalStates :: DFA -&gt; [State]\nfinalStates _ = _\n\nallTransitions :: DFA -&gt; [Transition]\nallTransitions _ = _\n</code></pre>\n\n<p>Once you're able to do that, write the functions in part 2(c).  Once you've done <em>all</em> that, you might be ready to tackle <code>findTransition</code>.  At this point, you'll probably need to learn about the <code>find</code> or <code>filter</code> functions, or else you'll need to learn how to write recursive list functions.</p>\n"}], "owner": {"reputation": 21, "user_id": 7092143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de55b528225a31547bfa510f2d9bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "kennedy kolute", "link": "https://stackoverflow.com/users/7092143/kennedy-kolute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "accepted_answer_id": 48870657, "answer_count": 1, "score": 1, "last_activity_date": 1519059699, "creation_date": 1519046062, "last_edit_date": 1519057898, "question_id": 48867033, "link": "https://stackoverflow.com/questions/48867033/a-guide-to-the-right-path-on-accomplishing-the-haskell-commands", "title": "A guide to the right path on accomplishing the haskell commands", "body": "<p>I am totally newbie on haskell. My java know how just isnt helping me alot.</p>\n\n<p>i need any help or guide on finishing the code. I have tried most of the parts and also indicated comments on what i tend to achieve.</p>\n\n<p>A DFA has been defined as follows \n(<a href=\"https://i.stack.imgur.com/6Pac6.png\" rel=\"nofollow noreferrer\">original image of DFA definition</a>):</p>\n\n<pre><code>Q = {q1,q2,q3,q4,q5}\nqs = q1\nF = {q4}\ndelta = {\n  &lt;q1,0,q2&gt;,&lt;q1,1,q2&gt;,&lt;q1,.,q3&gt;,\n  &lt;q2,0,q2&gt;,&lt;q2,1,q2&gt;,&lt;q2,.,q4&gt;,\n  &lt;q3,0,q4&gt;,&lt;q3,1,q4&gt;,&lt;q3,.,q5&gt;,\n  &lt;q4,0,q4&gt;,&lt;q4,1,q4&gt;,&lt;q4,.,q5&gt;,\n  &lt;q5,0,q5&gt;,&lt;q5,1,q5&gt;,&lt;q5,.,q5&gt;\n  }\nSigma = {0,1,.}\n</code></pre>\n\n<p>task:</p>\n\n<ol>\n<li><p>Create a Haskell language program that can be used to execute any arbitrary\nDeterministic Finite Automaton corresponding to the FDA definition above. Represent\nthe DFA as a four-tuple</p>\n\n<p>a. represent each state with its name as a String</p>\n\n<p>b. represents all states as a list of states</p>\n\n<p>c. represent each transition as three tuple and the list of transitions as a\nlist.</p></li>\n<li><p>To assist you, implement the following functions in your solution:</p>\n\n<p>a. stateFactory \u2013 returns a DFA definition (i.e. a four tuple)</p>\n\n<p>b. allStates, firstState, finalStates, and allTransitions \u2013 take a DFA and return the\ncorresponding component of the DFA. For example, in the above DFA instance,\nallStates would return the list of states, q\u2081, q\u2082, q\u2083, q\u2084, and q\u2085.</p>\n\n<p>c. transFrom, transInput, and transTo \u2013 take a transition and return the corresponding component of the transition</p>\n\n<p>d. findTransition \u2013 takes a state, a label, and a list of transitions and returns a list\ncontaining the single transition matching the given state and character (note the transitions emanating from a state are uniquely determined by each character label</p>\n\n<p>e. findNextState \u2013 takes a DFA, a label, and a state and returns a state</p>\n\n<p>f. dfaAccept \u2013 takes a DFA and an input String and returns True if the DFA accepts the input and False otherwise (i.e. decompose the string one character at a time, don\u2019t\nmatch the entire string since your solution must work for any DFA). It is helpful to\nseparate this into two functions each with different sets of parameters (one for an\nempty list and one for a non-empty list). One function takes a current state and one\nsimply takes a DFA, whose state is assumed to be the initial state of the DFA.</p></li>\n</ol>\n\n<p>this is my code has lots of errors but am trying to fix them</p>\n\n<pre><code>allStates = [\"q1\",\"q2\",\"q3\",\"q4\",\"q5\"] -- iniitialize all states\nfirstState = \"q1\"\nfinalStates = \"q4\"\n\n--define all transitions as a tuple\n\nt1 = (\"q1\",'0',\"q2\")\nt2 = (\"q1\",'1',\"q2\")\nt3 = (\"q1\",'.',\"q3\")\n\n-- place all transitions in a list\nallTransitions = [t1,t2,t3]\n\nlst =[]\n\nstateFactory = (allStates, firstState, finalStates, allTransitions)\n\nfindTransition state label listOfTransition = \n    if (state , label , \"q1\") elem listOfTransition\n        then lst ++ [] -- if the tuple matches the one in transition add to list\n    else\n        lst -- no match dont add\n\n    if (state , label , \"q2\") elem listOfTransition\n        then lst ++ [] -- if the tuple matches the one in transition add to list\n    else\n        lst -- no match dont add\n\n    if (state , label , \"q3\") elem listOfTransition\n        then lst ++ [] -- if the tuple matches the one in transition add to list\n    else\n        lst -- no match dont add\n\nfindNextState DFA label state = \n    --get the transition and extract the last element which is the state\n    last findTransition state label allTransitions\n\ndfaAccept DFA inputString = \n    if inputString == null then False\n</code></pre>\n\n<p>expected Output</p>\n\n<pre><code>Prelude&gt; dfaAccept stateFactory \u201c\u201d\nFalse\nPrelude&gt; dfaAccept stateFactory \u201c1\u201d\nFalse\nPrelude&gt; dfaAccept stateFactory \u201c1.0\u201d\nTrue\nPrelude&gt; dfaAccept stateFactory \u201c11.11\u201d\nTrue\nPrelude&gt; dfaAccept stateFactory \u201c10.10.10\u201d\nFalse\n</code></pre>\n"}, {"tags": ["haskell", "process", "architecture", "functional-programming"], "comments": [{"owner": {"reputation": 603, "user_id": 9309570, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TDfkA.jpg?s=128&g=1", "display_name": "mpetruska", "link": "https://stackoverflow.com/users/9309570/mpetruska"}, "edited": false, "score": 0, "creation_date": 1519036709, "post_id": 48864089, "comment_id": 84731643, "body": "Is this a duplicate of <a href=\"https://stackoverflow.com/questions/48808147/dynamic-at-runtime-dll-package-substitution-preferably-in-haskell\">Dynamic (at runtime) *dll/package substitution? preferably in Haskell?</a>?"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "reply_to_user": {"reputation": 603, "user_id": 9309570, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TDfkA.jpg?s=128&g=1", "display_name": "mpetruska", "link": "https://stackoverflow.com/users/9309570/mpetruska"}, "edited": false, "score": 0, "creation_date": 1519036898, "post_id": 48864089, "comment_id": 84731766, "body": "@mpetruska nope, but both definitely related."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1519045951, "post_id": 48864089, "comment_id": 84737105, "body": "Is there a reason that stdout is not a suitable way for the child to send messages to the parent ishell?"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1519557551, "post_id": 48864089, "comment_id": 84950617, "body": "@DanRobertson, well, the problem is that I am not quite familiar with stdin/stdout things. I knew it exists before, but never tried it out yet. However, seems to be perfectly valid candidate."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1519048538, "creation_date": 1519048538, "answer_id": 48867756, "question_id": 48864089, "link": "https://stackoverflow.com/questions/48864089/parent-process-child-processes-unidirectional-communication-in-real-world-h/48867756#48867756", "title": "Parent process &lt;- child processes UNIdirectional communication in &quot;real-world&quot; Haskell?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/process-1.6.3.0/docs/System-Process.html\" rel=\"nofollow noreferrer\">process</a> package supports Linux and Windows and provides mechanisms for communicating with children processes via their stdin, stdout, stderr, and exit code.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/network-2.6.3.3/docs/Network-Socket.html\" rel=\"nofollow noreferrer\">network</a> package supports Linux and Windows and provides mechanisms for communicating with children processes via socket.</p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 48867756, "answer_count": 1, "score": 0, "last_activity_date": 1519048538, "creation_date": 1519036053, "question_id": 48864089, "link": "https://stackoverflow.com/questions/48864089/parent-process-child-processes-unidirectional-communication-in-real-world-h", "title": "Parent process &lt;- child processes UNIdirectional communication in &quot;real-world&quot; Haskell?", "body": "<p><strong>Goal</strong>:</p>\n\n<ol>\n<li><p>There is an <code>IShell</code> which is nothing but an ordinary console able\nto    consume somewhat command like <code>do param1=value1 --option</code>. \n       <code>IShell</code> should orchestrate whole execution. It <strong>does not</strong> run    commands, the only thing it does is starts appropriate\nprocess. </p></li>\n<li><p><strong>Any</strong> process started from the running <code>IShell</code> instance should be able to report back to it what's happening inside. So,\nsay, <code>IShell</code>    has started process <code>A</code> to do something\ncomplicated; process <code>A</code>    should be able to report both progress\nand result back to parent    <code>IShell</code>. In practice, it means, that\nthere should be a mechanism how    to, for example, print message\nfrom process <code>A</code> to appropriate    <code>IShell</code>.</p></li>\n<li>Finally, code should work both with Windows and Linux.</li>\n</ol>\n\n<hr>\n\n<p>I really like Haskell and I'd like to promote \"real-world\" Haskell usage. But I don't know existing libraries well, I haven't done yet any \"real-world\" Haskell app. </p>\n\n<p>Thus, questions: </p>\n\n<p>How can I establish <code>IShell &lt;- it's processes</code> communication? Is there a single library able to handle both Windows-specific and Linux-specific stuff?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1518997657, "post_id": 48857645, "comment_id": 84719181, "body": "Function names must begin with a lower-case letter, so you cannot name your function <code>Max</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519009207, "post_id": 48857645, "comment_id": 84721362, "body": "See also <a href=\"http://hackage.haskell.org/package/monoid-extras-0.4.2/docs/Data-Monoid-Inf.html#v:maximum\" rel=\"nofollow noreferrer\">maximum</a> from the delightful monoid-extras package."}], "answers": [{"tags": [], "owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "is_accepted": false, "score": 2, "last_activity_date": 1519005047, "last_edit_date": 1519005047, "creation_date": 1518997314, "answer_id": 48857821, "question_id": 48857645, "link": "https://stackoverflow.com/questions/48857645/get-max-number-from-list/48857821#48857821", "title": "Get Max Number from list", "body": "<p>Syntax isn't <em>that</em> important. What's more important is to understand\nwhy you would want to return a <code>Maybe Int</code> instead of an <code>Int</code> in the\nfirst place.</p>\n\n<p>The integers are a totally ordered set, but there is no <em>minimum</em>\n(an element that is less or equal to any other element). Therefore,\nif the return type were simply <code>Int</code>, one wouldn't know what to return for an empty list.\nConceptually, one would like to return something like a \"negative \ninfinity\", but this is not a proper integer.</p>\n\n<p>Instead, we can do the following. We define a new totally ordered set\n<code>Maybe Int</code>, where</p>\n\n<ul>\n<li><code>Just n</code> corresponds to ordinary integer <code>n</code></li>\n<li><code>Nothing</code> corresponds to the \"negative infinity\"</li>\n</ul>\n\n<p>When comparing <code>Just n</code> and <code>Just m</code>, we simply compare <code>n</code> and <code>m</code>.\nWhen comparing <code>Just n</code> with <code>Nothing</code>, <code>Just n</code> should always be\ngreater than <code>Nothing</code>. That is, the <code>Nothing</code> becomes an artificially added\n\"negative infinity\"-minimum element.</p>\n\n<p>Now, since the list datatype has two constructors (empty list and \na head element <code>cons</code>ed onto a tail), we need two cases: </p>\n\n<ul>\n<li>If the list is empty, return the artificial \"negative infinity\" element</li>\n<li>If the list is non-empty with head <code>x</code>, compare <code>Just x</code> to the maximum of the tail.</li>\n</ul>\n\n<p>When comparing, we have to distinguish between the cases that maximum of the tail\ncan be either <code>Nothing</code> or <code>Just m</code>.</p>\n\n<p>Putting it all together, we obtain something like this:</p>\n\n<pre><code>findMax :: [Int] -&gt; Maybe Int\nfindMax [] = Nothing\nfindMax (x:xs) = \n  case (findMax xs) of\n    Nothing -&gt; Just x\n    Just m -&gt; if x &gt; m then Just x else Just m\n\nmain = print $ show $ findMax [22, 23, 52, 21, 33, 71, 15, 18, 34]\n</code></pre>\n\n<p>Note that I renamed <code>Max</code> to <code>findMax</code>, because function names should start with lowercase letters.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519008812, "post_id": 48857880, "comment_id": 84721283, "body": "It would be cleaner to use <code>minBound</code> instead of <code>floor (-1&#47;0)</code>. You could also consider <code>| Just x &gt; myMax xs</code>, though this is perhaps a bit opaque and could easily hide a bug if one weren&#39;t careful to check that this did the right thing when <code>myMax xs</code> were <code>Nothing</code> -- and in particular <code>Just x &lt; myMin xs</code> wouldn&#39;t be right for an analogous <code>myMin</code> implementation. Also, because you are recomputing <code>myMax xs</code> in both branches of the guard, this implementation is exponential time in the worst case -- quite inefficient indeed! Use a <code>where</code> block to alleviate this."}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519012426, "post_id": 48857880, "comment_id": 84722027, "body": "@DanielWagner thank you very much for your helpful comments! My main mission was to align with what seemed the OP&#39;s intention code-wise. I didn&#39;t know about minBound, will look up, tx!"}, {"owner": {"reputation": 101, "user_id": 7451909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nOpNK.gif?s=128&g=1", "display_name": "Fox", "link": "https://stackoverflow.com/users/7451909/fox"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1519100509, "post_id": 48857880, "comment_id": 84759628, "body": "@DanielWagner <code>maybe True (x &gt;) (myMax xs)</code> has 1) no reliance on either <code>Bounded</code> or undefined math, 2) an explicit case for when <code>myMax xs</code> is <code>Nothing</code>, and 3) an analogous <code>myMin</code> implementation"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 101, "user_id": 7451909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nOpNK.gif?s=128&g=1", "display_name": "Fox", "link": "https://stackoverflow.com/users/7451909/fox"}, "edited": false, "score": 0, "creation_date": 1519132220, "post_id": 48857880, "comment_id": 84776758, "body": "@Fox Yes, that or similar is my preferred way, but it seems the person writing this answer was explicitly trying to avoid it for some reason (see property (5) in the answer above)."}], "tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 1, "last_activity_date": 1518998643, "last_edit_date": 1518998643, "creation_date": 1518997853, "answer_id": 48857880, "question_id": 48857645, "link": "https://stackoverflow.com/questions/48857645/get-max-number-from-list/48857880#48857880", "title": "Get Max Number from list", "body": "<p>There seem to be several issues to address in your code:</p>\n\n<p>(1) function names usually start with lowercase in Haskell</p>\n\n<p>(2) considering (1), we may not want to overwrite the <code>max</code> from Prelude</p>\n\n<p>(3) the first line matches something still in the list: <code>Max [_] = []</code> means if <code>_</code> is the largest, we'll get a wrong answer :)</p>\n\n<p>(4) the line in (3) is returning <code>[]</code>, which is  not a Maybe type. Return <code>Nothing</code> instead</p>\n\n<p>(5) we need a \"lowest\" number to match on. Andrey's answer offers a nice conceptual alternative. I've gone for the more dirty but quaint <code>-1/0</code> for a very low number.</p>\n\n<p>Hope this helps!</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Maybe\n\nmyMax :: [Int] -&gt; Maybe Int\nmyMax [] = Nothing\nmyMax (x:xs)\n    -- we need fromMaybe here because we can't `&gt;` with Nothing\n    | x &gt; fromMaybe (floor(-1/0)) (myMax xs) = Just x\n    | otherwise = myMax xs\n\nmain = print(myMax [1,2,78])\n</code></pre>\n"}], "owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2040, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1519005047, "creation_date": 1518995780, "question_id": 48857645, "link": "https://stackoverflow.com/questions/48857645/get-max-number-from-list", "title": "Get Max Number from list", "body": "<p>I'm trying to get the max number from a list using Maybe &amp; Just  and recursion. I have figured out the recursion part but not able to understand the correct syntax to use</p>\n\n<p><strong>Haskell Code</strong>..</p>\n\n<pre><code>Max :: [Int] -&gt; Maybe Int\nMax [_] = []\nMax (x:xs)\n    | x &gt; (Max xs) = Just x\n    | otherwise = Max xs\n</code></pre>\n\n<p><strong>Input</strong> </p>\n\n<pre><code>Max [1,2,78]\nMax [-99,-12,-37]\n</code></pre>\n\n<p><strong>Compilation Error message</strong></p>\n\n<pre><code>  *Main&gt; :l max.hs\n  [1 of 1] Compiling Main             ( max.hs, interpreted )\n\n  max.hs:2:14: error:\n* Couldn't match expected type `Maybe Int' with actual type `[a0]'\n* In the expression: []\n  In an equation for `Max': Max [_] = []\n |\n 2 | Max [_] = []\n |              ^^\n\n max.hs:4:16: error:\n* Couldn't match expected type `Int' with actual type `Maybe Int'\n* In the second argument of `(&gt;)', namely `(Max xs)'\n  In the expression: x &gt; (Max xs)\n  In a stmt of a pattern guard for\n                 an equation for `Max':\n    x &gt; (Max xs)\n |\n 4 |         | x &gt; (Max xs) = Just x\n |                ^^^^^^^^^\n Failed, no modules loaded.\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1518999339, "post_id": 48857586, "comment_id": 84719465, "body": "Please do not vandalise questions -- even if you happen to have posted them."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 9, "last_activity_date": 1518995971, "creation_date": 1518995971, "answer_id": 48857673, "question_id": 48857586, "link": "https://stackoverflow.com/questions/48857586/haskell-circular-definition-interrupt/48857673#48857673", "title": "Haskell circular definition interrupt", "body": "<p>Both of your definitions fit the pattern <code>result = foo : bar : result</code>. So what we end up with, in both cases, is a circular list that looks like this:</p>\n\n<pre><code>foo : bar : foo : bar : foo : bar : ...\n</code></pre>\n\n<p>In both cases <code>foo</code> is <code>1</code>, so it doesn't depend on anything else. But <code>bar</code> does.</p>\n\n<p>In <code>mgood</code> you define <code>bar</code> to be equal to the third element of the list, so <code>bar</code> is equal to <code>foo</code>, which is <code>1</code>. So both <code>foo</code> and <code>bar</code> are <code>1</code> and that's what you get: an infinite list of <code>1</code>s.</p>\n\n<p>In <code>mbad</code> you define <code>bar</code> to be equal to the <em>fourth</em> element. So <code>bar</code> is equal to itself. This infinitely recursive definition of <code>bar</code> leads to an infinite loop when trying to evaluate <code>bar</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 7413479, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1841815442698211/picture?type=large", "display_name": "Sebi Danila", "link": "https://stackoverflow.com/users/7413479/sebi-danila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518999282, "creation_date": 1518995258, "last_edit_date": 1518999282, "question_id": 48857586, "link": "https://stackoverflow.com/questions/48857586/haskell-circular-definition-interrupt", "title": "Haskell circular definition interrupt", "body": "<p>Hello everyone i came over a curious thing trying to learn circular definition in Haskell. We have these two cases:</p>\n\n<pre><code>module Main\nwhere    \n  mgood = 1:head (tail (tail mgood)):mgood\n\n  list = take 10 mgood\n\n  main = do\n\n       print list\n</code></pre>\n\n<p>For the code above i get this output [1,1,1,1,1,1,1,1,1,1] which i understand why but the proble is in this code:</p>\n\n<pre><code>module Main\nwhere\n  mbad = 1:head (tail (tail (tail mbad))):mbad\n\n  list = take 10 mbad\n\n  main = do\n\n       print list\n</code></pre>\n\n<p>Where i get this output [1, {Interrupted!}. Can someone explain me why this happens and what's the difference between the 2 cases?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 1, "last_activity_date": 1518993376, "creation_date": 1518993376, "answer_id": 48857348, "question_id": 48857228, "link": "https://stackoverflow.com/questions/48857228/improper-use-of-foldm-with-io-bool-for-arg-parsing/48857348#48857348", "title": "Improper use of foldM with IO [Bool] for arg parsing", "body": "<p>Not sure if it's the only error, but the result of your <code>foldM</code> call is already <code>IO Bool</code>; no need to <code>return</code> it. That only wraps it in another layer of monad.</p>\n"}, {"comments": [{"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1518994436, "post_id": 48857401, "comment_id": 84718508, "body": "Awesome answer, clears out a lot of things about fmap and Monads thank you! One small detail is, that even if my <code>main</code> returns <code>False</code> the return value of the called process is always 0. Is there anyway to make it return some error codes like -1 in the case of unsuccessful execution of my command line tool? I&#39;ve seen System.exit but I&#39;m looking something that matches the C int main behavior."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 1, "creation_date": 1518994789, "post_id": 48857401, "comment_id": 84718590, "body": "@rausted To set the return code, you have to explicitly call a termination function, as those in <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/System-Exit.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/System-Exit.h&zwnj;&#8203;tml</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 1, "creation_date": 1518996301, "post_id": 48857401, "comment_id": 84718938, "body": "@rausted I added an extra section addressing that."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1518995964, "last_edit_date": 1518995964, "creation_date": 1518993745, "answer_id": 48857401, "question_id": 48857228, "link": "https://stackoverflow.com/questions/48857228/improper-use-of-foldm-with-io-bool-for-arg-parsing/48857401#48857401", "title": "Improper use of foldM with IO [Bool] for arg parsing", "body": "<p>The type of <code>foldM</code> is:</p>\n\n<pre><code>GHCi&gt; :t foldM\nfoldM\n  :: (Monad m, Foldable t) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b\n</code></pre>\n\n<p>The binary function you give it should produce a monadic result in some monad <code>m</code> (in your case, <code>m</code> would be <code>IO</code>). <code>(&amp;&amp;)</code>, however, doesn't produce a monadic result. That means you don't need <code>foldM</code> here: a plain fold will do:</p>\n\n<pre><code>GHCi&gt; :t foldr (&amp;&amp;) True\nfoldr (&amp;&amp;) True :: Foldable t =&gt; t Bool -&gt; Bool\n</code></pre>\n\n<p>Incidentally, <code>foldr (&amp;&amp;) True</code> is available in the Prelude as <code>and</code>, so you can just use that instead. To apply <code>and</code> to your <code>[Bool]</code> list in <code>IO</code>, you can use <code>fmap</code>. The final line of your do-block then becomes:</p>\n\n<pre><code>fmap and $ mapM check args\n</code></pre>\n\n<p>Or, using <code>(&lt;$&gt;)</code>, which is the infix spelling of <code>fmap</code>:</p>\n\n<pre><code>and &lt;$&gt; mapM check args\n</code></pre>\n\n<p>(As Sebastian Redl points out, the <code>return</code> is unnecessary, as <code>and &lt;$&gt; mapM check args</code> is of type <code>IO Bool</code> already.)</p>\n\n<hr>\n\n<p>By the way, note that giving <code>main</code> the type <code>IO Bool</code> won't do what you expect -- the return value of <code>main</code> is discarded. To return an error exit code, you can use, for instance, <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/System-Exit.html\" rel=\"nofollow noreferrer\"><code>exitFailure</code></a>:</p>\n\n<pre><code>argsOK &lt;- and &lt;$&gt; mapM check args\nif not argsOK\n    then exitFailure\n    else return ()\n-- rest of your do-block\n</code></pre>\n\n<p>(<code>return ()</code> is merely a do-nothing placeholder here.)</p>\n\n<p>A nicer way of expressing that is using <code>when</code> from <code>Control.Monad</code>:</p>\n\n<pre><code>argsOK &lt;- and &lt;$&gt; mapM check args\nwhen (not argsOK) exitFailure\n-- rest of your do-block \n</code></pre>\n"}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 48857401, "answer_count": 2, "score": 1, "last_activity_date": 1518995964, "creation_date": 1518992351, "last_edit_date": 1518993149, "question_id": 48857228, "link": "https://stackoverflow.com/questions/48857228/improper-use-of-foldm-with-io-bool-for-arg-parsing", "title": "Improper use of foldM with IO [Bool] for arg parsing", "body": "<p>I'm new to Haskell, I'm trying to map a check function that checks if a file exists and looks like this:</p>\n\n<p><code>check :: FilePath -&gt; IO Bool</code></p>\n\n<p>To the argv from Main, like so:</p>\n\n<pre><code>main :: IO Bool\nmain = do {\n    args &lt;- getArgs;\n    return $ foldM (&amp;&amp;) True $ mapM check args;\n}\n</code></pre>\n\n<p>Basically the logic is, fold the array of IO [Bool] into a single IO Bool and return it. I'm using the Monadic versions of Map and Fold, since I'm carrying the IO monad around, but I'm getting a lot of errors from the typechecker, which I can't really decipher since placeholders are introduced that I know nothing about.</p>\n\n<pre><code>src/Main.hs:15:9: error:\n    \u2022 Couldn't match type \u2018m0 Bool\u2019 with \u2018Bool\u2019\n      Expected type: IO Bool\n        Actual type: IO (m0 Bool)\n    \u2022 In a stmt of a 'do' block:\n        return $ foldM (&amp;&amp;) True $ mapM check args\n      In the expression:\n        do args &lt;- getArgs\n           return $ foldM (&amp;&amp;) True $ mapM check args\n      In an equation for \u2018main\u2019:\n          main\n            = do args &lt;- getArgs\n                 return $ foldM (&amp;&amp;) True $ mapM check args\n   |\n15 |         return $ foldM (&amp;&amp;) True $ mapM check args;\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nsrc/Main.hs:15:24: error:\n    \u2022 Couldn't match type \u2018Bool\u2019 with \u2018m0 Bool\u2019\n      Expected type: Bool -&gt; Bool -&gt; m0 Bool\n        Actual type: Bool -&gt; Bool -&gt; Bool\n    \u2022 In the first argument of \u2018foldM\u2019, namely \u2018(&amp;&amp;)\u2019\n      In the expression: foldM (&amp;&amp;) True\n      In the second argument of \u2018($)\u2019, namely\n        \u2018foldM (&amp;&amp;) True $ mapM check args\u2019\n   |\n15 |         return $ foldM (&amp;&amp;) True $ mapM check args;\n   |                        ^^^^\n\nsrc/Main.hs:15:36: error:\n    \u2022 Couldn't match type \u2018[Bool]\u2019 with \u2018Bool\u2019\n      Expected type: IO Bool\n        Actual type: IO [Bool]\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018mapM check args\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018foldM (&amp;&amp;) True $ mapM check args\u2019\n      In a stmt of a 'do' block:\n        return $ foldM (&amp;&amp;) True $ mapM check args\n   |\n15 |         return $ foldM (&amp;&amp;) True $ mapM check args;\n   |\n</code></pre>\n\n<p>Any clues how to make the typechecker happy?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1518986103, "post_id": 48856212, "comment_id": 84716003, "body": "There are probably many ways to make this code marginally more efficient, including by compiling it with different options, adding type signatures, etc. etc., as well as algorithms that are more efficient w/r/t computational complexity. There are also much more efficient solutions that sacrifice some accuracy. You should clarify the question w/r/t what you mean by &quot;more efficient&quot;. Also your code doesn&#39;t seem to be formatted correctly."}, {"owner": {"reputation": 21, "user_id": 7413479, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1841815442698211/picture?type=large", "display_name": "Sebi Danila", "link": "https://stackoverflow.com/users/7413479/sebi-danila"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1518986515, "post_id": 48856212, "comment_id": 84716122, "body": "I am looking for time efficiency."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1519048347, "post_id": 48856212, "comment_id": 84738650, "body": "I&#39;ve tried to make it work with Int64 using a somewhat naive approach, it didn&#39;t work even for N=1000 because of overflows. Vaguely related: <a href=\"https://dl.acm.org/citation.cfm?id=151274\" rel=\"nofollow noreferrer\">An accurate computation of the hypergeometric distribution function</a> + some scattered bits information <a href=\"https://valelab4.ucsf.edu/svn/3rdpartypublic/boost/libs/math/doc/sf_and_dist/html/math_toolkit/dist/dist_ref/dists/hypergeometric_dist.html\" rel=\"nofollow noreferrer\">here</a>, maybe use that as an inspiration. There, they compute everything &quot;log primes&quot; first, and then use divide-and-conquer to multiply subresults avoiding overflow..."}], "answers": [{"comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 4, "creation_date": 1518988730, "post_id": 48856657, "comment_id": 84716897, "body": "that is called <b>Pochhammer function</b> or <b>rising factorial</b> function.  Sort and pick the largest two elements to reduce (x1+x2)!/(x1+x2+x3+x4)! for the largest gain."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1518989306, "last_edit_date": 1518989306, "creation_date": 1518988485, "answer_id": 48856657, "question_id": 48856212, "link": "https://stackoverflow.com/questions/48856212/efficient-implementation-of-fishers-exact-test-in-haskell/48856657#48856657", "title": "Efficient implementation of Fisher&#39;s Exact Test in Haskell", "body": "<p>You compute</p>\n\n<pre><code>factorial (a+b) `div` factorial a\n</code></pre>\n\n<p>several times, with varying values of <code>a</code> and <code>b</code>. This can be improved by only multiplying the numbers between <code>a</code> and <code>a+b</code>; this reduces the total number of multiplications and avoids doing the division entirely, so should help some.</p>\n\n<p>Depending on the scale, a tree-fold rather than a strict left-fold can improve the performance of doing lots of multiplications (because multiplying numbers of approximately the same magnitude is more efficient than multiplying one large and one small number). Something like this:</p>\n\n<pre><code>foldb' :: (a -&gt; a -&gt; a) -&gt; a -&gt; [a] -&gt; a\nfoldb' f z = go where\n    go [] = z\n    go [v] = v\n    go long = go (adjacent long)\n\n    adjacent (x:y:rest) = let !h = f x y in h : adjacent rest\n    adjacent short = short\n</code></pre>\n\n<p>You can then use <code>foldb' (*) 1</code> for computing products slightly more quickly than your explicit recursions.</p>\n\n<p>I think these two improvements will be pretty marginal, though. They're certainly not asymptotic improvements. (Update: in my tests, using a tree-fold is actually a pretty big win: <code>factorial 100000</code> takes 943ms with <code>foldl'</code>, 18ms with <code>foldb'</code>, a 50x speedup.)</p>\n"}], "owner": {"reputation": 21, "user_id": 7413479, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1841815442698211/picture?type=large", "display_name": "Sebi Danila", "link": "https://stackoverflow.com/users/7413479/sebi-danila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519007706, "creation_date": 1518985529, "last_edit_date": 1518986622, "question_id": 48856212, "link": "https://stackoverflow.com/questions/48856212/efficient-implementation-of-fishers-exact-test-in-haskell", "title": "Efficient implementation of Fisher&#39;s Exact Test in Haskell", "body": "<p>I am trying to implement <a href=\"https://en.wikipedia.org/wiki/Fisher%27s_exact_test\" rel=\"nofollow noreferrer\">Fisher's exact test</a> in Haskell, so given four natural numbers a, b, c, and d, I want to calculate the formula:</p>\n\n<p>p=((a+b)! * (a+c)! * (b+d)! * (c+d)!) / (a! * b! * c! * d! * (a+b+c+d)!)</p>\n\n<p>I have tried 3 implementations, but a need a more efficient one:</p>\n\n<p>Solution 1:</p>\n\n<pre><code>module Main where\n\nimport Data.Ratio\n\nfactori n = fact_acc n 1\n\nfact_acc 0 a = a\nfact_acc n a = fact_acc (n-1) $! (n*a)\n\na = 1\nb = 9\nc = 7\nd = 3\n\nn1 = (factori (a+b)) `div` (factori a)\nn2 = (factori (a+c)) `div` (factori c)\nn3 = (factori (b+d)) `div` (factori b)\nn4 = (factori (c+d)) `div` (factori d)\nnumer = n1 * n2 * n3 * n4\ndenom = factori (a+b+c+d)\np = (fromIntegral numer) / (fromIntegral denom)\n\nmain = do\n    print denom \n    print p\n</code></pre>\n\n<p>Solution 2 (sorry for the long lines):</p>\n\n<pre><code>module Main where\n\nfactori n = fact_acc n 1\nfact_acc 0 a = a\nfact_acc n a = fact_acc (n-1) $! (n*a)\n\nmul_from_to m n = mul_acc m n 1\nmul_acc m n a = if (m==n) then (n*a) else mul_acc (m+1) n $! (m*a)\n\ncompute_p a b c d\n     | ((a+b)&gt;(a+c) &amp;&amp; (a+b)&gt;(b+d) &amp;&amp; (a+b)&gt;(c+d) &amp;&amp; a&lt;b &amp;&amp; a&lt;c &amp;&amp; a&lt;d) = fromRational (fromIntegral ((mul_from_to (c+1) (a+c)) * (mul_from_to (b+1) (b+d)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori a) * (mul_from_to (a+b+1) (a+b+c+d))))\n     | ((a+b)&gt;(a+c) &amp;&amp; (a+b)&gt;(b+d) &amp;&amp; (a+b)&gt;(c+d) &amp;&amp; b&lt;c &amp;&amp; b&lt;d)        = fromRational (fromIntegral ((mul_from_to (a+1) (a+c)) * (mul_from_to (d+1) (b+d)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori b) * (mul_from_to (a+b+1) (a+b+c+d))))\n     | ((a+b)&gt;(a+c) &amp;&amp; (a+b)&gt;(b+d) &amp;&amp; (a+b)&gt;(c+d) &amp;&amp; c&lt;d)               = fromRational (fromIntegral ((mul_from_to (a+1) (a+c)) * (mul_from_to (b+1) (b+d)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori c) * (mul_from_to (a+b+1) (a+b+c+d))))\n     | ((a+b)&gt;(a+c) &amp;&amp; (a+b)&gt;(b+d) &amp;&amp; (a+b)&gt;(c+d))                      = fromRational (fromIntegral ((mul_from_to (a+1) (a+c)) * (mul_from_to (b+1) (b+d)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori d) * (mul_from_to (a+b+1) (a+b+c+d))))\n     | ((a+c)&gt;(b+d) &amp;&amp; (a+c)&gt;(c+d) &amp;&amp; a&lt;b &amp;&amp; a&lt;c &amp;&amp; a&lt;d)                = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (d+1) (b+d)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori a) * (mul_from_to (a+c+1) (a+b+c+d))))\n     | ((a+c)&gt;(b+d) &amp;&amp; (a+c)&gt;(c+d) &amp;&amp; b&lt;c &amp;&amp; b&lt;d)                       = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (d+1) (b+d)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori b) * (mul_from_to (a+c+1) (a+b+c+d))))\n     | ((a+c)&gt;(b+d) &amp;&amp; (a+c)&gt;(c+d) &amp;&amp; c&lt;d)                              = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (b+1) (b+d)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori c) * (mul_from_to (a+c+1) (a+b+c+d))))\n     | ((a+c)&gt;(b+d) &amp;&amp; (a+c)&gt;(c+d))                                     = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (b+1) (b+d)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori d) * (mul_from_to (a+c+1) (a+b+c+d))))\n     | ((b+d)&gt;(c+d) &amp;&amp; a&lt;b &amp;&amp; a&lt;c &amp;&amp; a&lt;d)                               = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (c+1) (a+c)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori a) * (mul_from_to (b+d+1) (a+b+c+d))))\n     | ((b+d)&gt;(c+d) &amp;&amp; b&lt;c &amp;&amp; b&lt;d)                                      = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (c+1) (a+c)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori b) * (mul_from_to (b+d+1) (a+b+c+d))))\n     | ((b+d)&gt;(c+d) &amp;&amp; c&lt;d)                                             = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (a+1) (a+c)) * (mul_from_to (d+1) (c+d))) / fromIntegral ((factori c) * (mul_from_to (b+d+1) (a+b+c+d))))\n     | ((b+d)&gt;(c+d))                                                    = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (a+1) (a+c)) * (mul_from_to (c+1) (c+d))) / fromIntegral ((factori d) * (mul_from_to (b+d+1) (a+b+c+d))))\n     | (a&lt;b &amp;&amp; a&lt;c &amp;&amp; a&lt;d)                                              = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (c+1) (a+c)) * (mul_from_to (d+1) (b+d))) / fromIntegral ((factori a) * (mul_from_to (c+d+1) (a+b+c+d))))\n     | (b&lt;c &amp;&amp; b&lt;d)                                                     = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (c+1) (a+c)) * (mul_from_to (d+1) (b+d))) / fromIntegral ((factori b) * (mul_from_to (c+d+1) (a+b+c+d))))\n     | (c&lt;d)                                                            = fromRational (fromIntegral ((mul_from_to (b+1) (a+b)) * (mul_from_to (a+1) (a+c)) * (mul_from_to (d+1) (b+d))) / fromIntegral ((factori c) * (mul_from_to (c+d+1) (a+b+c+d))))\n     | otherwise                                                        = fromRational (fromIntegral ((mul_from_to (a+1) (a+b)) * (mul_from_to (c+1) (a+c)) * (mul_from_to (b+1) (b+d))) / fromIntegral ((factori d) * (mul_from_to (c+d+1) (a+b+c+d))))\n\na = 50000\nb = 910\nc = 11\nd = 300\n\np = compute_p a b c d\n\nmain = do\n  print p\n</code></pre>\n\n<p>Solution 3:</p>\n\n<pre><code>module Main where\n\nimport Data.Ratio\n\nfactorial n = factorials !! pred n\nfactorials = scanl1 (\\acc x -&gt; acc * x) [1..maxim]\n\na = 1\nb = 9\nc = 7\nd = 3\n\nmaxim=a+b+c+d\n\nn1 = (factorial (a+b)) `div` (factorial a)\nn2 = (factorial (a+c)) `div` (factorial c)\nn3 = (factorial (b+d)) `div` (factorial b)\nn4 = (factorial (c+d)) `div` (factorial d)\n\nnumer = n1 * n2 * n3 * n4\ndenom = factorial (a+b+c+d)\n\np = (fromIntegral numer) / (fromIntegral denom)\n\nmain = do\n  print denom\n  print p\n</code></pre>\n"}, {"tags": ["haskell", "dependency-management", "haskell-stack"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1518983532, "post_id": 48855854, "comment_id": 84715237, "body": "You need the development version of the <code>libtinfo</code> library. If on Ubuntu, try <a href=\"https://stackoverflow.com/a/30199196/3234959\">stackoverflow.com/a/30199196/3234959</a>"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 9371011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ff8901c388adaa7ca9cef2545056072?s=128&d=identicon&r=PG", "display_name": "Josef Klotzner", "link": "https://stackoverflow.com/users/9371011/josef-klotzner"}, "is_accepted": true, "score": 5, "last_activity_date": 1521569352, "creation_date": 1521569352, "answer_id": 49391359, "question_id": 48855854, "link": "https://stackoverflow.com/questions/48855854/gcc-failed-in-phase-linker-cant-build-hint-package/49391359#49391359", "title": "`gcc&#39; failed in phase `Linker&#39;, can&#39;t build &#39;hint&#39; package", "body": "<p>You need to install lib for tinfo\non ubuntu for example with:</p>\n\n<pre><code>sudo apt install libtinfo-dev\n</code></pre>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1920, "favorite_count": 0, "accepted_answer_id": 49391359, "answer_count": 1, "score": 3, "last_activity_date": 1521569352, "creation_date": 1518983179, "question_id": 48855854, "link": "https://stackoverflow.com/questions/48855854/gcc-failed-in-phase-linker-cant-build-hint-package", "title": "`gcc&#39; failed in phase `Linker&#39;, can&#39;t build &#39;hint&#39; package", "body": "<p>So, my <code>package.yaml</code> includes <code>- hint</code> package.</p>\n\n<p>Then I try to <code>stack build</code> my project.\nLog:</p>\n\n<pre><code>Configuring hint-0.7.0...\nPreprocessing library for hint-0.7.0..\nBuilding library for hint-0.7.0..\n[ 1 of 18] Compiling Control.Monad.Ghc ( src/Control/Monad/Ghc.hs, .stack-wor$\n[ 2 of 18] Compiling Hint.CompatPlatform ( src/Hint/CompatPlatform.hs, .stack$\n[ 3 of 18] Compiling Hint.GHC         ( src/Hint/GHC.hs, .stack-work/dist/x86$\n[ 4 of 18] Compiling Hint.Extension   ( src/Hint/Extension.hs, .stack-work/di$\n[ 5 of 18] Compiling Hint.Base        ( src/Hint/Base.hs, .stack-work/dist/x8$\n[ 6 of 18] Compiling Hint.Conversions ( src/Hint/Conversions.hs, .stack-work/$\n[ 7 of 18] Compiling Hint.Annotations ( src/Hint/Annotations.hs, .stack-work/$\n[ 8 of 18] Compiling Hint.Parsers     ( src/Hint/Parsers.hs, .stack-work/dist$\n[ 9 of 18] Compiling Hint.Reflection  ( src/Hint/Reflection.hs, .stack-work/d$\n[10 of 18] Compiling Hint.Typecheck   ( src/Hint/Typecheck.hs, .stack-work/di$\n[11 of 18] Compiling Hint.Util        ( src/Hint/Util.hs, .stack-work/dist/x8$\n[12 of 18] Compiling Hint.Context     ( src/Hint/Context.hs, .stack-work/dist$\n[13 of 18] Compiling Hint.Eval        ( src/Hint/Eval.hs, .stack-work/dist/x8$\n[14 of 18] Compiling Hint.Configuration ( src/Hint/Configuration.hs, .stack-w$\n[15 of 18] Compiling Hint.InterpreterT ( src/Hint/InterpreterT.hs, .stack-wor$\n[16 of 18] Compiling Language.Haskell.Interpreter ( src/Language/Haskell/Inte$\n[17 of 18] Compiling Language.Haskell.Interpreter.Extension ( src/Language/Ha$\n[18 of 18] Compiling Language.Haskell.Interpreter.Unsafe ( src/Language/Haske$\n/usr/bin/ld.gold: error: cannot find -ltinfo\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>Stack version:</p>\n\n<pre><code>Version 1.6.3, Git revision b27e629b8c4ce369e3b8273f04db193b060000db (5454 commits) x86_64 hpack-0.20.0\n</code></pre>\n\n<p>Cabal-install version:</p>\n\n<pre><code>cabal-install version 2.0.0.1\ncompiled using version 2.0.1.1 of the Cabal library \n</code></pre>\n\n<p>Just point me to a right direction. I am totally new to the stack and Haskell.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1518976907, "post_id": 48854832, "comment_id": 84713072, "body": "The package name is, in fact, &quot;plugins&quot;, and you can find it in the page header there. I suggest you <a href=\"https://stackoverflow.com/posts/48854832/edit\">edit</a> the error(s) you got into the question (even though your latest edit does point to your actual issue)."}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 1, "last_activity_date": 1518977642, "creation_date": 1518977642, "answer_id": 48855016, "question_id": 48854832, "link": "https://stackoverflow.com/questions/48854832/where-can-i-find-correct-package-name-and-version-for-haskell/48855016#48855016", "title": "Where can I find correct package name and version for Haskell?", "body": "<blockquote>\n  <p>Say, I need System.Eval.Haskell. Or whatever else. How do I know which package I should specify in my package.yaml?</p>\n</blockquote>\n\n<p>There may be many packages which export a particular module, so you can't necessarily know which package to import from the module name. But generally it's obvious from a google search.</p>\n\n<p>As duplode mentions the package is named <code>plugins</code>, and as you found out stack uses the <code>&lt;package_name&gt;-&lt;version&gt;</code> format to specify a package name + version in the <code>stack.yaml</code>. Cabal uses a different format, which is more flexible (can specify fuzzy package version ranges, etc.). Since stack works on fixed snapshots of package versions, the <code>plugins-1.5.7</code> format is sufficient.</p>\n\n<p>When you write <code>plugins</code> in your <code>*.cabal</code> file, you're specifying something like \"any version of <code>plugins</code> but prefer the most recent\". But because your package repository is limited to a particular snapshot by <code>stack</code> what you're really doing is letting <code>stack</code> manage your dependencies.</p>\n"}, {"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1518978206, "post_id": 48855055, "comment_id": 84713532, "body": "Does stack suppose to guarantee that &quot;everything will work fine all together&quot;? I am pretty new to &quot;real-world&quot; Haskell projects and those dependency-management problems remarkably slows me down. Whenever I hardcode some package as extra-dep, I force stack to use that one and thus it might lead to a versioning issues, right?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1518979928, "post_id": 48855055, "comment_id": 84714154, "body": "@SerejaBogolubov [1/2] &quot;Whenever I hardcode some package as extra-dep, I force stack to use that one and thus it might lead to a versioning issues, right?&quot; -- Likely not. Assuming that your extra-dep has appropriate dependency version bounds (as it should be for a well-maintained non-Stackage package), Stack will quickly let you know if it is incompatible with the rest of the Stackage snapshot you are using. Also, the <code>stack solver</code> command will try to find a suitable version of the non-Stackage packages in <code>package.yaml</code> for you to add to the extra-deps."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 1, "creation_date": 1518980409, "post_id": 48855055, "comment_id": 84714299, "body": "@SerejaBogolubov [2/2] Two other points worth noting. Firstly, extra-deps, unlike snapshot packages, are installed per-project, in a segregated way, so any issues won&#39;t compromise the rest of your Haskell environment. Secondly, Stack pins the versions of all snapshot packages, and so it won&#39;t attempt to bring in incompatible versions of other packages that you didn&#39;t explicitly add to extra-deps. All in all, I would say extra-deps aren&#39;t really dangerous."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1518981514, "post_id": 48855055, "comment_id": 84714653, "body": "great to know, thanks a lot. you definitely showed me right way to go."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1518977880, "creation_date": 1518977880, "answer_id": 48855055, "question_id": 48854832, "link": "https://stackoverflow.com/questions/48854832/where-can-i-find-correct-package-name-and-version-for-haskell/48855055#48855055", "title": "Where can I find correct package name and version for Haskell?", "body": "<blockquote>\n  <p>Looks like there is somewhat quite unclear difference between extra-dependencies and \"regular\" dependencies in the configuration. Mentioning <code>plugins-1.5.7</code> as extra-dep indeed works. Am I doing some dependency mismanagement here, or that's green way to go?</p>\n</blockquote>\n\n<p>That's how it is supposed to be. The issue is that there are two major archives of Haskell packages: <em>Hackage</em>, which includes basically every package and every version ever, and <em>Stackage</em>, which is a large subset of Hackage bundled into snapshots of mutually compatible packages and versions. Stack defaults to drawing packages from Stackage, so if you want to use a package from Hackage that is not in Stackage you have to also add it to the <code>extra-deps</code> of <code>stack.yaml</code>. Whether a package is in Stackage can be found the <a href=\"https://hackage.haskell.org/package/plugins-1.5.7\" rel=\"nofollow noreferrer\">contents page of the package in the Hackage docs</a> (if it is on Stackage, there will be an entry for it in the \"Distributions\" field). Also relevant is <a href=\"https://www.stackage.org/lts-10.5\" rel=\"nofollow noreferrer\">Stackage Hoogle</a>, which lets you search for package names, modules and identifiers within a Stackage snapshot.</p>\n\n<p>P.S.: For more on the relationship between Hackage, Stackage and Stack, you might have a look at my answer to <a href=\"https://stackoverflow.com/a/42601219/2751851\"><em>What is the difference between Cabal and Stack?</em></a> (You may replace any mentions of \"the <code>.cabal</code> file\" there by \"<code>package.yaml</code>\", if that's what you are using.)</p>\n"}, {"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1518978630, "post_id": 48855060, "comment_id": 84713692, "body": "How dangerous extra-deps are? Does it mean that I hardcode my dependency and thus auto-resolution might fail at any point due to some internal incompatibilities?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1518979421, "post_id": 48855060, "comment_id": 84713980, "body": "@SerejaBogolubov More dangerous than not using them... I don&#39;t think one can answer it more precisely than that. It&#39;ll depend on the particular package, etc."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 5, "last_activity_date": 1518977993, "last_edit_date": 1518977993, "creation_date": 1518977927, "answer_id": 48855060, "question_id": 48854832, "link": "https://stackoverflow.com/questions/48854832/where-can-i-find-correct-package-name-and-version-for-haskell/48855060#48855060", "title": "Where can I find correct package name and version for Haskell?", "body": "<p>When you view module documentation on hackage, the package name is in the upper left corner:</p>\n\n<p><a href=\"https://i.stack.imgur.com/INm3g.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/INm3g.png\" alt=\"Package name highlighted\"></a></p>\n\n<p>In this case, it's indeed <em>plugins</em>, version 1.5.7.</p>\n\n<p>When you declare dependencies in your <code>.cabal</code> file, Stack will attempt to find a version that fits with the <a href=\"https://www.stackage.org\" rel=\"noreferrer\">Long-Term Support</a> (LTS) collection that you're targeting.</p>\n\n<p>Sometimes, you want to use a different version than the one available in the LTS collection (for example if you want a more recent one), in which case you can define the package, and its specific version, in <code>extra-dependencies.</code></p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 2, "accepted_answer_id": 48855055, "answer_count": 3, "score": 5, "last_activity_date": 1519740661, "creation_date": 1518976463, "last_edit_date": 1519740661, "question_id": 48854832, "link": "https://stackoverflow.com/questions/48854832/where-can-i-find-correct-package-name-and-version-for-haskell", "title": "Where can I find correct package name and version for Haskell?", "body": "<p>Say, I need <code>System.Eval.Haskell</code>. Or whatever else. How do I know which package I should specify in my <code>package.yaml</code>? When I go to the <a href=\"https://hackage.haskell.org/package/plugins-1.5.7/docs/System-Eval-Haskell.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/plugins-1.5.7/docs/System-Eval-Haskell.html</a>, I see no package name.</p>\n\n<p>P.S. \"plugins\" did not work for me. Thus, I assume it's something different. I hope so :)</p>\n\n<hr>\n\n<p>Looks like there is somewhat quite unclear difference between extra-dependencies and \"regular\" dependencies in the configuration. Mentioning <code>plugins-1.5.7</code> as extra-dep indeed works. Am I doing some dependency mismanagement here, or that's green way to go? </p>\n"}, {"tags": ["function", "haskell", "path", "binary-tree"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1518966962, "creation_date": 1518966962, "answer_id": 48853198, "question_id": 48852965, "link": "https://stackoverflow.com/questions/48852965/haskell-binary-tree-path-function/48853198#48853198", "title": "haskell binary tree path function", "body": "<p>Your <code>BTree</code> type is:</p>\n\n<pre><code>data BTree a = Leaf a | Node a (BTree a) (BTree a)\n</code></pre>\n\n<p>Note that, unlike a list, it is never empty: both the leaves and the nodes contain values of type <code>a</code>. That being so, if you have a case in <code>paths</code> that always produces empty lists, such as...</p>\n\n<pre><code>paths (Leaf a) = [[]]\n</code></pre>\n\n<p>... you are necessarily throwing values away. What you want instead is:</p>\n\n<pre><code>paths :: BTree a -&gt; [[a]] \npaths (Leaf a) = [[a]]\npaths (Node x left right) = map (x:) (paths left ++ paths right)\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518966995, "creation_date": 1518965424, "last_edit_date": 1518966995, "question_id": 48852965, "link": "https://stackoverflow.com/questions/48852965/haskell-binary-tree-path-function", "title": "haskell binary tree path function", "body": "<p>I am trying to define a function which will return the list of all\npaths through a given binary tree.\nI have the following functions defined already: </p>\n\n<pre><code>data BTree a = Leaf a | Node a (BTree a) (BTree a)\n     deriving (Show,Eq)\n\npaths :: BTree a -&gt; [[a]] \npaths (Leaf a) = [[]]\npaths (Node x left right) = map (x:) (paths left ++ paths right)\n</code></pre>\n\n<p>With this function I have the following results for example: \n<code>[[5,4],[5,4],[5,3],[5,3]]</code> . But I was supposed to have as a result the output <code>[[5,4,1],[5,4,2],[5,3,3],[5,3,4]]</code>. \nDo anyone know why i dont get the 3rd value?\nThank you</p>\n"}, {"tags": ["haskell", "set", "list-comprehension"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1518947238, "post_id": 48850285, "comment_id": 84704123, "body": "No, there&#39;s no such thing in Haskell, you need to implement it yourself."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518952791, "post_id": 48850930, "comment_id": 84705499, "body": "By chance you can explain what stops this monad instance from making its way to <code>base</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1518952858, "post_id": 48850930, "comment_id": 84705516, "body": "@Kindaro just did that... (BTW, there&#39;s no set type in <code>base</code>, if anything it would go in <code>containers</code>)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 15, "last_activity_date": 1518953358, "last_edit_date": 1518953358, "creation_date": 1518951858, "answer_id": 48850930, "question_id": 48850285, "link": "https://stackoverflow.com/questions/48850285/is-it-possible-to-have-a-set-comprehension-in-haskell/48850930#48850930", "title": "is it possible to have a set comprehension in haskell?", "body": "<p>Haskell can do this, but not quite out-of-the-box.</p>\n\n<p>The basic underpinning is that a list comprehension can also be written as a monadic binding chain, in the list monad:</p>\n\n<pre><code>Prelude&gt; [x+y | x&lt;-[1,2,3], y&lt;-[1,2,3]]\n[2,3,4,3,4,5,4,5,6]\nPrelude&gt; [1,2,3] &gt;&gt;= \\x -&gt; [1,2,3] &gt;&gt;= \\y -&gt; return (x+y)\n[2,3,4,3,4,5,4,5,6]\n</code></pre>\n\n<p>...or, with better readable <code>do</code>-syntax (which is syntactic sugar for monadic binding)</p>\n\n<pre><code>Prelude&gt; do x&lt;-[1,2,3]; y&lt;-[1,2,3]; return (x+y)\n[2,3,4,3,4,5,4,5,6]\n</code></pre>\n\n<p>In fact, there's a language extension that also turns all list comprehensions into syntactic sugar for such a monadic chain. Example in the tuple (aka writer) monad:</p>\n\n<pre><code>Prelude&gt; :set -XMonadComprehensions \nPrelude&gt; [x+y | x &lt;- (\"Hello\", 4), y &lt;- (\"World\", 5)] :: (String, Int)\n(\"HelloWorld\",9)\n</code></pre>\n\n<p>So really, all we need is a <em>set monad</em>. This is sensible enough, however <code>Data.Set.Set</code> is <em>not</em> a monad on <strong>Hask</strong> (the category of all Haskell types) but only only the subcategory that satisfies the <code>Ord</code> constraint (which is needed for lookup / to avoid duplicates). In the case of sets, there is however a hack that allows hiding that constraint from the actual monad instance; it's used in the <a href=\"http://hackage.haskell.org/package/set-monad-0.2.0.0/docs/Data-Set-Monad.html\" rel=\"noreferrer\"><code>set-monad</code> package</a>. Et voil\u00e0:</p>\n\n<pre><code>Prelude Data.Set.Monad&gt; [x+y | x&lt;-fromList[1,2,3], y&lt;-fromList[1,2,3]]\nfromList [2,3,4,5,6]\n</code></pre>\n\n<p>The hack that's needed for <code>instance Monad Set</code> comes at a price. It works like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs, RankNTypes #-}\nimport qualified Data.Set as DS\n\ndata Set r where\n  Prim :: (Ord r =&gt; DS.Set r) -&gt; Set r\n  Return :: a -&gt; Set a\n  Bind   :: Set a -&gt; (a -&gt; Set b) -&gt; Set b\n  ...\n</code></pre>\n\n<p>What this means is: a value of type <code>Data.Set.Monad.Set Int</code> does not really contain a concrete set of integers. Rather, it contains an <em>abstract syntax expression</em> for a computation that yields a set as the result. This isn't great for performance, in particular it means that values won't be shared. So don't use this for big sets.</p>\n\n<p>There's a better option: use it directly as a monad <em>in the proper category</em> (which only contains orderable types to begin with). This unfortunately requires even more language-bending, but it's possible; I've made an example <a href=\"https://github.com/leftaroundabout/constrained-categories/blob/master/examples/Set.hs\" rel=\"noreferrer\">in the <code>constrained-categories</code> library</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1518953558, "post_id": 48851065, "comment_id": 84705707, "body": "This doesn&#39;t even require using any <code>Set</code> type, you can as well use <code>map head . group . sort</code> for removing the duplicates in <i>O</i> (<i>n</i> &#183; log <i>n</i>). The problem is, if you have intermediate sets with lots of duplicates in a calculation, the size grows <i>exponentially</i>, so this is only ok if the sets are mostly disjoint anyway."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518954011, "post_id": 48851065, "comment_id": 84705821, "body": "@leftaroundabout I don&#39;t quite get it, why would the size grow exponentially and in what case?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518954799, "post_id": 48851065, "comment_id": 84706039, "body": "It&#39;s exponential in <i>n</i> in the scenario where you have <i>n</i> iterative computation steps, each outputting a set of size <i>k</i> including <i>O</i> (<i>k</i>) duplicates. In this case, if you calculate with intermediate lists instead, the second step will also give duplicates of each of the duplicates of the first step and so on."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518958043, "post_id": 48851065, "comment_id": 84707015, "body": "@leftaroundabout I see. So one would have to remove duplicates in intermediate lists too. In your code <code>fromList</code> is doing this."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518960433, "post_id": 48851065, "comment_id": 84707659, "body": "Well, more relevantly, the <code>&gt;&gt;=</code> of the set monad removes duplicates after each join."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 5, "last_activity_date": 1518952867, "creation_date": 1518952867, "answer_id": 48851065, "question_id": 48850285, "link": "https://stackoverflow.com/questions/48850285/is-it-possible-to-have-a-set-comprehension-in-haskell/48851065#48851065", "title": "is it possible to have a set comprehension in haskell?", "body": "<p>If your values can be put in <code>Data.Set.Set</code> (i.e. they are in class <code>Ord</code>) you can just apply <code>Data.Set.toList . Data.Set.fromList</code> to your list:</p>\n\n<pre><code>Prelude&gt; import Data.Set\nPrelude Data.Set&gt; Data.Set.toList . Data.Set.fromList $ [x+y | x&lt;-[1,2,3], y&lt;-[1,2,3]]\n[2,3,4,5,6]\n</code></pre>\n\n<p>The complexity of this would be <code>O(n log n)</code>.</p>\n\n<p>If the type obeys <code>(Eq a, Hashable a)</code>, you can use <code>Data.HashSet</code> in much the same way. The average complexity is <code>O(n)</code>.</p>\n\n<p>If all you have is <code>Eq</code>, you have to get by with something like <code>Data.List.nub</code>:</p>\n\n<pre><code>Prelude&gt; import Data.List\nPrelude Data.List&gt; nub [x+y | x&lt;-[1,2,3], y&lt;-[1,2,3]]\n[2,3,4,5,6]\n</code></pre>\n\n<p>but the complexity is inherently quadratic. </p>\n"}], "owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 48850930, "answer_count": 2, "score": 12, "last_activity_date": 1520027840, "creation_date": 1518947008, "last_edit_date": 1520027840, "question_id": 48850285, "link": "https://stackoverflow.com/questions/48850285/is-it-possible-to-have-a-set-comprehension-in-haskell", "title": "is it possible to have a set comprehension in haskell?", "body": "<p>In Haskell we have list generators, such as: </p>\n\n<pre><code>[x+y | x&lt;-[1,2,3], y&lt;-[1,2,3]]\n</code></pre>\n\n<p>with which we get </p>\n\n<pre><code>[2,3,4,3,4,5,4,5,6]\n</code></pre>\n\n<p>Is it possible to have a set generator which doesn't automatically add an element if it is already in the list? </p>\n\n<p>In our example we would obtain: </p>\n\n<pre><code>[2,3,4,5,6]\n</code></pre>\n\n<p>If so, how? If it is not already implemented, how would you implement it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518978641, "post_id": 48848571, "comment_id": 84713696, "body": "Could you share a link with your development results?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1518962979, "post_id": 48849568, "comment_id": 84708498, "body": "That&#39;s <a href=\"https://www.stackage.org/haddock/lts-10.5/kan-extensions-5.0.2/Data-Functor-Coyoneda.html\" rel=\"nofollow noreferrer\"><code>Coyoneda f a</code></a>. This is a very impressive trick to change the type role (for functors). I would have thought that this was impossible."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1518952397, "last_edit_date": 1518952397, "creation_date": 1518940373, "answer_id": 48849568, "question_id": 48848571, "link": "https://stackoverflow.com/questions/48848571/generalised-newtype-deriving-on-class-functions-with-functors/48849568#48849568", "title": "Generalised newtype deriving on class functions with Functors", "body": "<p>If <code>f</code> is a <code>Functor</code>, you can make a \"representational wrapper\" for it</p>\n\n<pre><code>data Rep f a where\n    Rep :: (b -&gt; a) -&gt; f b -&gt; Rep f a\n</code></pre>\n\n<p>which is isomorphic to <code>f</code> except that it is representational in <code>a</code>, by what is essentially existential quantification over any nominal variance <code>f</code> might have.  I think this construction happens to have some fancy category theory name but I don't remember what it is.  To get the <code>f a</code> back out of a <code>Rep f a</code>, you need to use <code>f</code>'s <code>Functor</code>hood.</p>\n\n<p>You can use this wrapper in your method, ensuring that your class varies representationally.</p>\n\n<pre><code>alterFRep :: (Functor f) \n          =&gt; (Maybe (Value t) -&gt; Rep f (Maybe (Value t))) -&gt; Key t -&gt; t -&gt; Rep f t\n</code></pre>\n\n<p>And then make the real \"method\" just a regular function in terms of it by using the isomorphism with <code>Rep f</code>.  You can also make a convenience method for instance authors:</p>\n\n<pre><code>toAlterFRep :: \n    (forall f t. (Functor f) =&gt; (Maybe (Value t) -&gt; f (Maybe (Value t))) -&gt; Key t -&gt; t -&gt; f t)\n -&gt; (forall f t. (Functor f) =&gt; (Maybe (Value t) -&gt; Rep f (Maybe (Value t))) -&gt; Key t -&gt; t -&gt; Rep f t)\n</code></pre>\n\n<p>so they don't have to worry about what the heck <code>Rep</code> is, they just implement <code>alterF</code> normally and use <code>toAlterFRep</code> on it.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 2, "accepted_answer_id": 48849568, "answer_count": 1, "score": 6, "last_activity_date": 1518952397, "creation_date": 1518929443, "question_id": 48848571, "link": "https://stackoverflow.com/questions/48848571/generalised-newtype-deriving-on-class-functions-with-functors", "title": "Generalised newtype deriving on class functions with Functors", "body": "<p>I'm developing a class representing key/value mappings, and I've got a function which is basically like <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Strict.html#v:alterF\" rel=\"noreferrer\"><code>alterF</code></a>:</p>\n\n<pre><code>class C t where\n  ...\n  alterF :: Functor f =&gt; \n    (Maybe (Value t) -&gt; f (Maybe (Value t))) -&gt; Key t -&gt; t -&gt; f t\n</code></pre>\n\n<p>Unfortunately, this breaks <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"noreferrer\"><code>GeneralisedNewtypeDeriving</code></a>. In some cases, this is reasonable, as <code>GeneralisedNewtypeDeriving</code> from what I understand essentially uses <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Coerce.html\" rel=\"noreferrer\">Coercible</a> and the function <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Coerce.html#v:coerce\" rel=\"noreferrer\"><code>coerce</code></a>. <code>Coercible</code> represents types which are representationally equal, i.e. they have the same representation at run time, so we can convert between them for free. For example, given:</p>\n\n<pre><code>newtype T a = T a\n</code></pre>\n\n<p>we have:</p>\n\n<pre><code>Coercible a (T a)\nCoercible (T a) a\n</code></pre>\n\n<p>but we don't have (in general):</p>\n\n<pre><code>Coercible (f a) (f (T a))\nCoercible (f (T a)) (f a)\n</code></pre>\n\n<p>For example, GADTs violate this representational equality. But there are lots of values of <code>f</code> that do work. For example:</p>\n\n<pre><code>Coercible (Maybe a) (Maybe (T a))\nCoercible (Maybe (T a)) (Maybe a)\nCoercible [a] [T a]\nCoercible [T a] [a]\nCoercible (Identity a) (Identity (T a))\nCoercible (Identity (T a)) (Identity a)\n</code></pre>\n\n<p>It also occurs to me that this instance could be written:</p>\n\n<pre><code>Functor f =&gt; Coercible (f a) (f (T a))\nFunctor f =&gt; Coercible (f (T a)) (f a)\n</code></pre>\n\n<p>Just using <code>fmap</code>. Unlike the usual <code>coerce</code>, this wouldn't be free at runtime, but it will work. </p>\n\n<p>So I've got a class with 10 functions, 9 of which work fine with <code>GeneralisedNewtypeDeriving</code>. There's just this final one which doesn't, which could be resolved mechanically using <code>fmap</code>. Do I have to write custom wrapping/unwrapping implementations for all my class functions, or is there a way to either require me to write the implementation for just the problem function or alternatively coax GHC into using <code>fmap</code> as part of it's <code>GeneralisedNewtypeDeriving</code>?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1518918994, "post_id": 48847492, "comment_id": 84699459, "body": "and that is exactly as it was given <a href=\"https://stackoverflow.com/a/10848902/849891\">in the Reasoned Schemer</a>! (only, in Scheme; without ever mentioning the &quot;M&quot; word). They even had <i>two</i> different &quot;binds&quot; there."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1518926259, "last_edit_date": 1518926259, "creation_date": 1518915946, "answer_id": 48847492, "question_id": 48847424, "link": "https://stackoverflow.com/questions/48847424/define-bind-without-join-for-the-list-monad-in-haskell/48847492#48847492", "title": "Define bind without join for the list monad in Haskell", "body": "<p>Sure. The actual definition in <code>GHC/Base.hs</code> is in terms of the equivalent list comprehension:</p>\n\n<pre><code>instance Monad []  where\n    xs &gt;&gt;= f             = [y | x &lt;- xs, y &lt;- f x]\n</code></pre>\n\n<p>Alternatively, you could try the following method of working it out from scratch from the type:</p>\n\n<pre><code>(&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]\n</code></pre>\n\n<p>We need to handle two cases:</p>\n\n<pre><code>[] &gt;&gt;= f = ???\n(x:xs) &gt;&gt;= f = ???\n</code></pre>\n\n<p>The first is easy.  We have no elements of type <code>a</code>, so we can't apply <code>f</code>.  The only thing we can do is return an empty list:</p>\n\n<pre><code>[] &gt;&gt;= f = []\n</code></pre>\n\n<p>For the second, <code>x</code> is a value of type <code>a</code>, so we can apply <code>f</code> giving us a value of <code>f x</code> of type <code>[b]</code>.  That's the beginning of our list, and we can concatenate it with the rest of the list generated by a recursive call:</p>\n\n<pre><code>(x:xs) &gt;&gt;= f = f x ++ (xs &gt;&gt;= f)\n</code></pre>\n"}], "owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 48847492, "answer_count": 1, "score": 1, "last_activity_date": 1518926259, "creation_date": 1518915281, "question_id": 48847424, "link": "https://stackoverflow.com/questions/48847424/define-bind-without-join-for-the-list-monad-in-haskell", "title": "Define bind without join for the list monad in Haskell", "body": "<p>I understand the definition of <code>&gt;&gt;=</code> in term of <code>join</code></p>\n\n<pre><code>xs &gt;&gt;= f = join (fmap f xs)\n</code></pre>\n\n<p>which also tells us that <code>fmap + join</code> yields <code>&gt;&gt;=</code></p>\n\n<p>I was wondering if for the <code>List</code> monad it's possible to define without <code>join</code>, as we do for example for <code>Maybe</code>:</p>\n\n<pre><code>&gt;&gt;= m f = case m of\n    Nothing -&gt; Nothing\n    Just x  -&gt; f x\n</code></pre>\n"}, {"tags": ["haskell", "automata", "nfa"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 3, "creation_date": 1518923532, "post_id": 48847167, "comment_id": 84700050, "body": "You seem like you roughly know what\u2019s going on so here\u2019s a sketch: use sets instead of lists, this way you avoid duplicates (and know if you\u2019ve added nothing new). Now do a standard breadth first pass over the graph following all epsilon transitions. Ie start with <code>known = {s}</code> and <code>edge = {s}</code> and each step you replace <code>edge</code> by <code>getClosure edge - known</code> (interpreted in the reasonable way) and simultaneously replace <code>known</code> by <code>union known (getClosure edge)</code>. Then keep going until <code>edge</code> is empty. <code>known</code> is then your epsilon-closure."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1518949179, "post_id": 48847167, "comment_id": 84704583, "body": "@DanRobertson I think you should write that up as an answer."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1519022085, "post_id": 48847167, "comment_id": 84724376, "body": "Here&#39;s a detailed exploration. <a href=\"https://stackoverflow.com/questions/28549336/is-there-way-to-represent-static-data-in-haskell-or-is-there-any-other-elegant\" title=\"is there way to represent static data in haskell or is there any other elegant\">stackoverflow.com/questions/28549336/&hellip;</a>"}], "owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 418, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1518913799, "creation_date": 1518912499, "last_edit_date": 1518913799, "question_id": 48847167, "link": "https://stackoverflow.com/questions/48847167/computing-the-%ce%b5-closure-of-nfa-in-haskell", "title": "computing the \u03b5-closure of NFA in haskell", "body": "<p>I am implementing a nondeterministic finite automaton in Haskell and I am trying to implement the function that calculates the epsilon closure. To this purpose the NFA is implemented as:</p>\n\n<pre><code>data Transaction = Transaction {\n     start_state :: Int, \n     symbol :: Maybe Char, \n     end_state :: Int\n} deriving Show\n\ndata Automaton = Automaton {\n     initial_state :: Int, \n     states :: Set.Set Int,\n     transactions :: [Transaction],\n     final_states :: Set.Set Int, \n     language :: Set.Set Char\n} deriving Show \n</code></pre>\n\n<p>while the closure: </p>\n\n<pre><code>--Perform the computations necessary to eclosure\ngetClosure :: [Transaction] -&gt;  [Int]\ngetClosure [] = []\ngetClosure [tr] = [end_state tr]\ngetClosure (tr:trs) = end_state tr : getClosure trs \n\n--Get the \u03b5-closure of a given state \neclosure :: Automaton -&gt; Int -&gt; [Int]\neclosure a s\n  = s : List.concat\n         [ eclosure a st\n         | st &lt;- getClosure . List.filter (equal_transaction Nothing s)\n                     $ transactions a ]\n</code></pre>\n\n<p>The problem is that if there is a cycle in the closure, the code runs forever. I understand the reasons behind this behavior, but I don't know how to fix it. Could you please help me?</p>\n"}, {"tags": ["haskell", "llvm"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 8887313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FLPf2.png?s=128&g=1", "display_name": "ATOMP", "link": "https://stackoverflow.com/users/8887313/atomp"}, "edited": false, "score": 0, "creation_date": 1588305493, "post_id": 48885550, "comment_id": 108853071, "body": "I ran into the same problem -- here are some additional resources I found that were useful: (1) discussion about function calls <a href=\"https://github.com/llvm-hs/llvm-hs-examples/issues/2\" rel=\"nofollow noreferrer\">github.com/llvm-hs/llvm-hs-examples/issues/2</a> , (2) example function call: <a href=\"https://gist.github.com/cocreature/93625b5afac68eb7de8b2eaa44561ab6\" rel=\"nofollow noreferrer\">gist.github.com/cocreature/93625b5afac68eb7de8b2eaa44561ab6</a>"}], "tags": [], "owner": {"reputation": 350, "user_id": 6118662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BZg9.jpg?s=128&g=1", "display_name": "linSESH", "link": "https://stackoverflow.com/users/6118662/linsesh"}, "is_accepted": true, "score": 2, "last_activity_date": 1519130529, "creation_date": 1519130529, "answer_id": 48885550, "question_id": 48846787, "link": "https://stackoverflow.com/questions/48846787/encodeexception-the-serialized-globalreference-has-type-pointertype/48885550#48885550", "title": "EncodeException &quot;The serialized GlobalReference has type PointerType&quot;", "body": "<p>Just found the error, I changed the line of the call with :</p>\n\n<pre><code>(Right $ ConstantOperand $ GlobalReference (PointerType (FunctionType int [int, int] False) (A.AddrSpace 0)) (Name \"subbing\"))\n</code></pre>\n"}], "owner": {"reputation": 350, "user_id": 6118662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1BZg9.jpg?s=128&g=1", "display_name": "linSESH", "link": "https://stackoverflow.com/users/6118662/linsesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 48885550, "answer_count": 1, "score": 3, "last_activity_date": 1519130560, "creation_date": 1518908664, "last_edit_date": 1519130560, "question_id": 48846787, "link": "https://stackoverflow.com/questions/48846787/encodeexception-the-serialized-globalreference-has-type-pointertype", "title": "EncodeException &quot;The serialized GlobalReference has type PointerType&quot;", "body": "<p>As a CS student, I am asked to write a compiler in a functional language with LLVM. I chose Haskell, despite the fact that I am very new to it and that I don't understand everything in source code examples, that's why my code may looks disgracious.</p>\n\n<p>Before really beginning my project, I wanted to play a little bit with LLVM's Haskell bindings and make a function that call another which returns the difference between the two integers passed as parameters.</p>\n\n<p>When running the code, I have the following exception :</p>\n\n<blockquote>\n  <p>EncodeException \"The serialized GlobalReference has type PointerType {pointerReferent = FunctionType {resultType = IntegerType {typeBits = 32}, argumentTypes = [IntegerType {typeBits = 32},IntegerType {typeBits = 32}], isVarArg = False}, pointerAddrSpace = AddrSpace 0} but should have type IntegerType {typeBits = 32}</p>\n</blockquote>\n\n<p>And I really don't understand what is wrong with my code.</p>\n\n<p>Here is my complete source code, thanks for your help.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\n\nimport Control.Monad.Except\n\n-- Pretty Printer\n\nimport LLVM.Pretty (ppllvm, ppll)\n\nimport LLVM.Module\nimport LLVM.Context\nimport LLVM.Module\n\n-- AST\nimport LLVM.AST\nimport qualified LLVM.AST as AST\nimport LLVM.AST.Global\nimport LLVM.AST.CallingConvention\nimport LLVM.AST.Constant as Kokai\nimport qualified Data.ByteString.Char8 as B\n\n\nint :: Type\nint = IntegerType 32\n\ndefAdd :: Definition\ndefAdd = GlobalDefinition functionDefaults\n  { name = Name \"subbing\"\n  , parameters =\n      ( [ Parameter int (Name \"a\") []\n        , Parameter int (Name \"b\") [] ]\n      , False )\n  , returnType = int\n  , basicBlocks = [block]\n  }\n  where\n\nblock :: BasicBlock\nblock = BasicBlock\n    (Name \"entry\")\n    [ Name \"result\" :=\n      AST.Sub False\n      False\n      (LocalReference int (Name \"a\"))\n      (LocalReference int (Name \"b\"))\n      [] ]\n    (Do $ Ret (Just (LocalReference int (Name \"result\"))) [])\n\nfoo :: Definition\nfoo = GlobalDefinition functionDefaults\n  { name = Name \"random_func\"\n  , parameters = ([], False)\n  , returnType = int\n  , basicBlocks = [calli]\n  }\n  where\ncalli :: BasicBlock\ncalli = BasicBlock\n            (Name \"entry\")\n            [Name \"res\" :=\n             Call\n                Nothing\n                C\n                []\n                (Right $ ConstantOperand $ GlobalReference int \"subbing\")\n                [(ConstantOperand $ Int 32 10, []),\n                (ConstantOperand $ Int 32 7, [])]\n                []\n                []\n                    ]\n            (Do $ Ret (Just (ConstantOperand $ Int 32 10)) [])\n            --(Do $ Ret (Just (LocalReference int (Name \"res\"))) [])\n\nastModule :: AST.Module\nastModule = defaultModule\n  { moduleName = \"my-module\"\n  , moduleDefinitions = [defAdd, foo]\n  }\n\nnimoft :: IO B.ByteString\nnimoft = withContext $ \\context -&gt;\n    withModuleFromAST context astModule $ \\m -&gt; do\n      llstr &lt;- moduleLLVMAssembly m\n      B.putStrLn llstr\n      return llstr\n\nmain :: IO ()\nmain = do\n  lol &lt;- nimoft\n  Prelude.putStrLn \"hello\"\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1518906197, "post_id": 48846437, "comment_id": 84697090, "body": "Related: <a href=\"https://stackoverflow.com/q/5535512/2682729\">How to hack GHCi (or Hugs) so that it prints Unicode chars unescaped?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1518907136, "post_id": 48846438, "comment_id": 84697304, "body": "The output of <code>Show</code> is 7-bit clean, a nice property for inclusion in/attachment to email because that means it doesn&#39;t need an extra round of escaping, nice because ASCII is available almost everywhere, and nice because many popular encodings agree on what bytes to use for 7-bit clean text."}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518908501, "post_id": 48846438, "comment_id": 84697609, "body": "Is that just a useful side effect of the current implementation or one of the actual justifications for having it the way it is?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518914562, "post_id": 48846438, "comment_id": 84698793, "body": "That is the folklore justification that I have heard repeated often. I don&#39;t have a canonical source to support it, though."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 3, "creation_date": 1518949542, "post_id": 48846438, "comment_id": 84704669, "body": "15 years ago being compatible with non-unicode systems was more important than it is now. However there is also the bonus that when you read an escaped string you can see exactly what is there, including control characters. That is useful because different strings can wind up looking the same when printed. The escaped version lets you know what is really going on."}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1518982218, "post_id": 48846438, "comment_id": 84714877, "body": "@Paul Johnson, good point! Having never really written code that needs to interop with old code, I didn&#39;t think of that."}], "tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": true, "score": 7, "last_activity_date": 1518982604, "last_edit_date": 1518982604, "creation_date": 1518905543, "answer_id": 48846438, "question_id": 48846437, "link": "https://stackoverflow.com/questions/48846437/semantics-of-show-w-r-t-escape-characters/48846438#48846438", "title": "Semantics of show w.r.t. escape characters", "body": "<h3>TL:DR; Printable characters inside the ASCII range (0-127) will be <code>show</code>n as graphic characters.* Everything else will be escaped.</h3>\n\n<p>* Except for double quotes (as they're used for string delimiters) and\nbackslashes (because they're needed for escaping).</p>\n\n<p>Let's have a look at the source code to figure this one out!</p>\n\n<p>Since we have <code>String = [Char]</code>, we should hunt for <code>instance Show Char</code> in\nthe source. It can be found \n<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Show.html\" rel=\"nofollow noreferrer\">here</a>.\nIt is defined as:</p>\n\n<pre><code>-- | @since 2.01\ninstance  Show Char  where\n    showsPrec _ '\\'' = showString \"'\\\\''\"\n    showsPrec _ c    = showChar '\\'' . showLitChar c . showChar '\\''\n\n    showList cs = showChar '\"' . showLitString cs . showChar '\"'\n</code></pre>\n\n<p>So showing a <code>String</code> (using <code>showList</code>) is basically a wrapper around\n<code>ShowLitString</code>, and showing a <code>Char</code> is a wrapper around <code>ShowLitChar</code>.\nLet's look at those functions.</p>\n\n<pre><code>showLitString :: String -&gt; ShowS\n-- | Same as 'showLitChar', but for strings\n-- It converts the string to a string using Haskell escape conventions\n-- for non-printable characters. Does not add double-quotes around the\n-- whole thing; the caller should do that.\n-- The main difference from showLitChar (apart from the fact that the\n-- argument is a string not a list) is that we must escape double-quotes\nshowLitString []         s = s\nshowLitString ('\"' : cs) s = showString \"\\\\\\\"\" (showLitString cs s)\nshowLitString (c   : cs) s = showLitChar c (showLitString cs s)\n   -- [explanatory comments ...]\n</code></pre>\n\n<p>As you might've expected, <code>showLitString</code> is mostly a wrapper around\n<code>showLitChar</code>. \n[Note: If you're unfamiliar with the <code>ShowS</code> type, this is a good\n<a href=\"https://stackoverflow.com/a/9198124/2682729\">answer</a> to understand why\nit might be useful.]\nNot quite what we were looking for, so let us go to <code>showLitChar</code> (I've\nomitted parts of the definition which aren't relevant to the question).</p>\n\n<pre><code>-- | Convert a character to a string using only printable characters,\n-- using Haskell source-language escape conventions.  For example:\n-- [...]\nshowLitChar                :: Char -&gt; ShowS\nshowLitChar c s | c &gt; '\\DEL' =  showChar '\\\\' (protectEsc isDec (shows (ord c)) s)\n-- ^ Pattern matched for cat\nshowLitChar '\\DEL'         s =  showString \"\\\\DEL\" s\nshowLitChar '\\\\'           s =  showString \"\\\\\\\\\" s\n-- ^ Pattern matched for backslash\nshowLitChar c s | c &gt;= ' '   =  showChar c s\n-- ^ Pattern matched for d\n-- Some more escape codes\nshowLitChar '\\a'           s =  showString \"\\\\a\" s\n-- similarly for '\\b', '\\f', '\\n', '\\r', '\\t', '\\v' etc.\n-- showLitChar ... = ...\n</code></pre>\n\n<p>Now you see where the problem is. <code>ord c</code> is an <code>int</code>, and the first is taken\nfor all non-ASCII characters (<code>ord '\\DEL' == 127</code>).\nFor characters in the ASCII range, the printable characters are printed and\nthe rest are escaped. For characters outside it, all of them are escaped.</p>\n\n<p>The code doesn't answer the \"why\" part of the question. The answer to that\n(I think) is in the very first comment that we saw:</p>\n\n<pre><code>-- | @since 2.01\ninstance  Show Char  where\n</code></pre>\n\n<p><s>If I were guessing, this behaviour has been kept around for maintain backwards\ncompatibility.</s> I don't need to guess: see the comments for some good answers to this.</p>\n\n<h3>Bonus</h3>\n\n<p>We can do a <code>git blame</code> online using GHC's Github mirror ;). Let's see\nwhen this code was written\n(<a href=\"https://github.com/ghc/ghc/blame/bc761ad9c65c7aa62d38db39c59a6c0ae59c8ab8/libraries/base/GHC/Show.hs#L360\" rel=\"nofollow noreferrer\">blame link</a>).\nThe relevant <a href=\"https://github.com/ghc/ghc/commit/fbf9b826362cc72631e99045e3cc6ab1bf4d5b1f\" rel=\"nofollow noreferrer\">commit</a> is 15 years old (!). However, it does mention Unicode.</p>\n\n<p>The functionality to distinguish between different types of Unicode characters\nis present in the <code>Data.Char</code> module. Looking at the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Unicode.html#isPrint\" rel=\"nofollow noreferrer\">source</a>:</p>\n\n<pre><code>isPrint    c = iswprint (ord c) /= 0\n\nforeign import ccall unsafe \"u_iswprint\"\n  iswprint :: Int -&gt; Int\n</code></pre>\n\n<p>If you trace the commit which introduced <code>iswprint</code>, you'll land up \n<a href=\"https://github.com/ghc/ghc/commit/2b179f023136bb22103856f74e44de281f31be82\" rel=\"nofollow noreferrer\">here</a>. That commit was made 13 years ago.\n<s>Maybe there was sufficient code written in those two years which they didn't\nwant to break? I don't know. If some GHC developer could shed more light on this,\nthat'd be awesome :).</s> Daniel Wagner and Paul Johnson in the comments have pointed out a very good reason for this - operating with non-Unicode systems must've been a high priority (~15 years ago) as Unicode was relatively new back then.</p>\n"}], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 48846438, "answer_count": 1, "score": 5, "last_activity_date": 1518982604, "creation_date": 1518905543, "question_id": 48846437, "link": "https://stackoverflow.com/questions/48846437/semantics-of-show-w-r-t-escape-characters", "title": "Semantics of show w.r.t. escape characters", "body": "<p>Consider the following examples (<code>\u03bb&gt;</code> = ghci, <code>$</code> = shell):</p>\n\n<pre><code>\u03bb&gt; writeFile \"d\" $ show \"d\"\n$ cat d\n\"d\"\n\n\u03bb&gt; writeFile \"d\" \"d\"\n$ cat d\nd\n\n\u03bb&gt; writeFile \"backslash\" $ show \"\\\\\"\n$ cat backslash\n\"\\\\\"\n\n\u03bb&gt; writeFile \"backslash\" \"\\\\\"\n$ cat backslash\n\\\n\n\u03bb&gt; writeFile \"cat\" $ show \"\ud83d\udc08\" -- U+1F408\n$ cat cat\n\"\\128008\"\n\n\u03bb&gt; writeFile \"cat\" \"\ud83d\udc08\"\n$ cat cat\n\ud83d\udc08\n</code></pre>\n\n<p>I understand that another way of <code>\"\\128008\"</code> is just another way of representing\n<code>\"\ud83d\udc08\"</code> in Haskell source code.\nMy question is: why does the <code>\"\ud83d\udc08\"</code> example behave like the backslash instead of\nlike <code>\"d\"</code>? Since it is a printable character, shouldn't it behave like\na letter?</p>\n\n<p>More generally, what is the rule to determine whether the character will be\nshown as a printable character or as an escape code? I looked at <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1270006.3\" rel=\"noreferrer\">Section 6.3</a>\nin the Haskell 2010 Language report but it doesn't specify the exact behaviour.</p>\n"}, {"tags": ["haskell", "jwt", "yesod"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518922809, "post_id": 48846326, "comment_id": 84699966, "body": "Side note: in your use case, <code>currtime</code> in <code>isDateExpired</code> being <code>Nothing</code> means there was a parse failure in <code>JWT.numericDate</code>, and you end up merging this case with the expiration-date-missing failure. In this case it doesn&#39;t really matter (as far as I can tell, <code>getPOSIXTime</code> can&#39;t produce an invalid date for this purpose), but it&#39;s good to be attentive to situations like this, in which something might slip through the cracks."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4880943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nngiJ.png?s=128&g=1", "display_name": "L&#233;o Vital", "link": "https://stackoverflow.com/users/4880943/l%c3%a9o-vital"}, "edited": false, "score": 0, "creation_date": 1518930177, "post_id": 48848254, "comment_id": 84701037, "body": "What a fascinating language! Thanks a lot for the answer. I&#39;m still struggling with the whole concept of monads and such, but that just makes learning it more fun!  The one thing that I couldn&#39;t understand in your answer was how <code>let mExpired = isDateExpired expiration . JWT.numericDate &lt;$&gt; getPOSIXTime</code> works. If the current time is wrapped in IO, how can it be passed as an argument to isDateExpired?  About your puzzle, my guess would be: <code>maybe (Nothing) (\\v -&gt; ...) (k)</code>. Was I close?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 13, "user_id": 4880943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nngiJ.png?s=128&g=1", "display_name": "L&#233;o Vital", "link": "https://stackoverflow.com/users/4880943/l%c3%a9o-vital"}, "edited": false, "score": 0, "creation_date": 1518956740, "post_id": 48848254, "comment_id": 84706618, "body": "@L&#233;oVital (1) <code>(.)</code> has higher precedence than <code>(&lt;$&gt;)</code>, so that amounts to <code>(isDateExpired expiration . JWT.numericDate) &lt;$&gt; getPOSIXTime</code> (that is, we&#39;re <code>fmap</code>ping the <code>isDateExpired expiration</code> as well. (2) Yup, that is spot on. By the way, that would look even nicer in terms of <code>(=&lt;&lt;)</code> (bind with flipped arguments) -- <code>(=&lt;&lt;) = maybe Nothing</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1518925721, "creation_date": 1518925721, "answer_id": 48848254, "question_id": 48846326, "link": "https://stackoverflow.com/questions/48846326/how-to-properly-handle-the-expiration-date-of-a-jwt-with-yesod/48848254#48848254", "title": "How to properly handle the expiration date of a JWT with Yesod?", "body": "<p>Let's have a second look at <code>isDateExpired</code>:</p>\n\n<pre><code>isDateExpired :: Maybe JWT.NumericDate -&gt; Maybe JWT.NumericDate -&gt; IO (Maybe Bool)\nisDateExpired exptime currtime = return $ (&lt;) &lt;$&gt; exptime &lt;*&gt; currtime\n</code></pre>\n\n<p>This is actually a pure function: <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> here are those of the <code>Maybe</code> functor, and the result is in <code>IO</code> merely because of the <code>return</code> at the end. So let's get rid of it:</p>\n\n<pre><code>isDateExpired :: Maybe JWT.NumericDate -&gt; Maybe JWT.NumericDate -&gt; Maybe Bool\nisDateExpired exptime currtime = (&lt;) &lt;$&gt; exptime &lt;*&gt; currtime\n</code></pre>\n\n<p>This clears our view quite a bit; we can deal with how to get that into <code>IO</code> as a separate step.</p>\n\n<p>Given that <code>isDateExpired</code> is now a pure function, we don't need the <code>(&gt;&gt;=)</code> in <code>mExpired</code> any longer:</p>\n\n<pre><code>    let mExpired = isDateExpired expiration . JWT.numericDate &lt;$&gt; getPOSIXTime\n</code></pre>\n\n<p><code>mExpired</code> is still an <code>IO (Maybe Bool)</code>, thanks to <code>getPOSIXTime</code>. We can change that by using <code>&lt;-</code> (and <code>liftIO</code>) rather than <code>let</code>:</p>\n\n<pre><code>    mExpired &lt;- liftIO $ isDateExpired expiration . JWT.numericDate &lt;$&gt; getPOSIXTime\n</code></pre>\n\n<p>(Note that you had done almost the same thing. I brought the <code>liftIO</code> together with the rest of it so that I don't have to think of a redundant name for the <code>IO (Maybe Bool)</code> intermediate value, which is for the most part uninteresting.)</p>\n\n<p>The most straightforward way to decide what to do next is pattern matching on <code>mExpired</code>:</p>\n\n<pre><code>    case mExpired of\n        Nothing -&gt; permissionDenied \"Expiration date missing.\"\n        Just expired -&gt; when expired $ permissionDenied \"Invalid expiration date.\"\n</code></pre>\n\n<p>Pattern matching tends to be more comfortable to use than boolean tests, except perhaps when you already have a <code>Bool</code> in your hands. (A corollary is that there usually is a nicer alternative to using <code>isJust</code> and <code>isNothing</code> -- though I feel the your uses of <code>isNothing</code> with <code>when</code> elsewhere in the do-block are fine.)</p>\n\n<hr>\n\n<p>The refactoring just above assumes you want to distinguish the missing date case from the invalid date one. Though I suspect that is actually what you want/need, let's assume for a moment that you'd rather disregard the difference (and thus handle <code>Nothing</code> and <code>Just False</code> in the same way). <code>fromMaybe</code> from <code>Data.Maybe</code> allows you to do that in a very convenient way:</p>\n\n<pre><code>fromMaybe :: a -&gt; Maybe a -&gt; a\n</code></pre>\n\n\n\n<pre><code>    when (fromMaybe True mExpired) $ permissionDenied \"Invalid expiration date.\"\n</code></pre>\n\n<p>This amounts to your \"pseudo-Haskell\" line -- in effect, we are supplying <code>True</code> as a default value for <code>mExpired</code>. If you were to go down that route, you might even move the <code>fromMaybe True</code> to <code>isExpired</code>, so that it would result in a <code>Bool</code> to begin with.</p>\n\n<p>Another function worth mentioning is <code>maybe</code>, which amounts to case analysis on <code>Maybe</code> packaged into a function:</p>\n\n<pre><code>maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b\n</code></pre>\n\n<p>Using it, the case-statement I wrote a few lines above could be replaced with:</p>\n\n<pre><code>    -- Line breaks added for clarity.\n    maybe\n        (permissionDenied \"Expiration date missing.\")\n        (\\expired -&gt; when expired $ permissionDenied \"Invalid expiration date.\")\n        mExpired\n</code></pre>\n\n<p>While this is, in this case, arguably less readable than the case-statement, <code>maybe</code> is a function that you can compose, partially apply, etc.; which can be taken advantage of in other circumstances.</p>\n\n<p>(A tiny puzzle: what does <code>(&gt;&gt;=)</code> for <code>Maybe</code> look like if you use <code>maybe</code> to define it?)</p>\n"}], "owner": {"reputation": 13, "user_id": 4880943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nngiJ.png?s=128&g=1", "display_name": "L&#233;o Vital", "link": "https://stackoverflow.com/users/4880943/l%c3%a9o-vital"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 48848254, "answer_count": 1, "score": 1, "last_activity_date": 1518925829, "creation_date": 1518904606, "last_edit_date": 1518925829, "question_id": 48846326, "link": "https://stackoverflow.com/questions/48846326/how-to-properly-handle-the-expiration-date-of-a-jwt-with-yesod", "title": "How to properly handle the expiration date of a JWT with Yesod?", "body": "<p>I am currently developing a web server using the Yesod framework for a course project. I am new to Haskell and I am fascinated by how different it is to everything else I know regarding programming languages. However, it is not all roses. Sometimes I get stuck for days, and this question is about one such case.</p>\n\n<p>These are the functions that validate the bearer tokens that come with the requests:</p>\n\n<pre><code>isDateExpired :: Maybe JWT.NumericDate -&gt; Maybe JWT.NumericDate -&gt; IO (Maybe Bool)\nisDateExpired exptime currtime = return $ (&lt;) &lt;$&gt; exptime &lt;*&gt; currtime\n\nvalidateToken :: Handler AuthResult\nvalidateToken = do\n    bearerToken &lt;- lookupBearerAuth\n    master &lt;- getYesod\n    when (isNothing bearerToken) $ permissionDenied \"Token not present in headers.\"\n    let decodedAndVerified  = join $ JWT.decodeAndVerifySignature (JWT.secret (clientSecret master)) &lt;$&gt; bearerToken\n        claimset            = JWT.claims &lt;$&gt; decodedAndVerified\n        audience            = join $ JWT.aud &lt;$&gt; claimset\n        iss = join $ JWT.iss &lt;$&gt; claimset\n        expiration = join $ JWT.exp &lt;$&gt; claimset\n    case audience of\n        Just a -&gt; do\n            case a of\n                Left uniqueAud -&gt; do \n                    when (Just uniqueAud /= JWT.stringOrURI (clientId master)) $ permissionDenied \"Invalid aud.\"\n                Right _ -&gt; permissionDenied \"Tokens with multiple aud values not currently supported.\"\n        _ -&gt; permissionDenied \"Audience not defined.\"\n    when (iss /= JWT.stringOrURI (configIssuer master)) $\n        permissionDenied \"Invalid issuer.\"\n    when (isNothing claimset) $\n        permissionDenied \"Claimset invalid.\"\n    let mExpired = JWT.numericDate &lt;$&gt; getPOSIXTime &gt;&gt;= isDateExpired expiration\n    --FIXME Currently, this next part has to be at the end of the function.\n    liftIO $ mExpired &gt;&gt;= \n        \\y -&gt; if isNothing y then return $ Unauthorized \"Expiration date missing.\" \n            else if y==Just True then return $ Unauthorized \"Invalid expiration date.\"\n                else return $ Authorized\n</code></pre>\n\n<p>Well, this code actually works. It correctly validates the tokens. However, as you can see with the FIXME there, the last part of the <code>validateToken</code> function is very hacky. It necessarily has to be the last line, and that annoys me.</p>\n\n<p>From what I have gathered, the proper way to handle this would be to use <code>when</code> just like it's done in the cases above it. The problem, that I hope someone here can shed some light on, is that when validating the expiration date I end up with an <code>IO (Maybe Bool)</code> in that <code>mExpired</code> variable. And <code>when</code> doesn't accept that.</p>\n\n<p>What I wanted to do was (in pseudo-Haskell) something like this:</p>\n\n<pre><code>when (isNothing mExpired || mExpired == Just True) $ permissionDenied \"Invalid expiration date.\"\n</code></pre>\n\n<p>And then I could check other things after that, and at the end of the function put <code>Authorized</code> and all is correct and beautiful.</p>\n\n<p>Is something like that at all possible? </p>\n\n<p>FYI: <code>permissionDenied</code>'s type is <code>Failure ErrorResponse m =&gt; String -&gt; m a</code></p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "edited": false, "score": 1, "creation_date": 1518899474, "post_id": 48845646, "comment_id": 84695388, "body": "For debugging purposes you could use Debug.Trace: <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/Debug-Trace.h&zwnj;&#8203;tml</a>"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1518902290, "post_id": 48845973, "comment_id": 84696113, "body": "And the caveat I called out about laziness in my answer applies here, as well, of course: none of the multiplications are done until all of the printing has already finished, which probably is not the desired behavior. It can be fixed in the same way as in my answer, by inserting a <code>$!</code> between <code>go (n-1)</code> and <code>(ret * n)</code>."}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 3, "last_activity_date": 1518910538, "last_edit_date": 1518910538, "creation_date": 1518901856, "answer_id": 48845973, "question_id": 48845646, "link": "https://stackoverflow.com/questions/48845646/how-to-print-the-iterations-inside-a-haskell-recursion-call/48845973#48845973", "title": "how to print the iterations inside a Haskell recursion call?", "body": "<p>The problem here is you are trying to do some IO (<code>print</code>) within a pure function (<code>factorial</code>): you can't do so in Haskell.</p>\n\n<p>One workaround is to use the module <code>Debug.Trace</code> likewise:</p>\n\n<pre><code>import Debug.Trace\n\nfactorial n = go n 1\n  where\n  go n ret | (\"n value is: \" ++ show n) `trace` n &gt; 1 = go (n-1) (ret * n)\n           | otherwise = ret\n</code></pre>\n\n<p>And you'll get:</p>\n\n<pre><code>*Main Debug.Trace&gt; factorial 5\nn value is: 5\nn value is: 4\nn value is: 3\nn value is: 2\nn value is: 1\n120\n</code></pre>\n\n<p>There are some caveats though as stated in the library: </p>\n\n<blockquote>\n  <p>The trace function should only be used for debugging, or for\n  monitoring execution. The function is not referentially transparent:\n  its type indicates that it is a pure function but it has the side\n  effect of outputting the trace message.</p>\n</blockquote>\n\n<p>As Daniel pointed out, if we want to enforce the multiplication to occur in each step of the evaluation, we have to rewrite this as follows:</p>\n\n<pre><code>factorial n = go n 1\n  where\n  go n ret | (\"n value is: \" ++ show n) `trace` n &gt; 1 = go (n-1) $! (ret * n)\n           | otherwise = ret\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1518902227, "last_edit_date": 1518902227, "creation_date": 1518901903, "answer_id": 48845978, "question_id": 48845646, "link": "https://stackoverflow.com/questions/48845646/how-to-print-the-iterations-inside-a-haskell-recursion-call/48845978#48845978", "title": "how to print the iterations inside a Haskell recursion call?", "body": "<p>You can use <code>(&gt;&gt;)</code> to sequence <code>IO</code> actions and <code>return</code> to turn pure computations into <code>IO</code> actions. So:</p>\n\n<pre><code>factorial n = go n 1 where\n    go n ret | n &gt; 1 = print n &gt;&gt; go (n-1) (ret*n)\n             | otherwise = return ret\n</code></pre>\n\n<p>Of course, <code>factorial</code> is now a function that produces an <code>IO</code> action; its callers may need to be fixed up to accommodate that.</p>\n\n<p>Also, beware: due to laziness, none of the actual multiplications are done until <em>after</em> all of the printing! This is <em>probably</em> not what you intended. It won't matter much for the kinds of tests you'll be doing on a microbenchmark like this, but for larger functions that do more computation per iteration you might start to notice. You can fix this using <code>$!</code> or similar to make the computation of the <code>IO</code> action depend on the computation of this iteration's work. So:</p>\n\n<pre><code>factorial n = go n 1 where\n    go n ret | n &gt; 1 = print n &gt;&gt; (go (n-1) $! ret*n)\n             | otherwise = return ret\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518904555, "post_id": 48846081, "comment_id": 84696706, "body": "(And don&#39;t forget to use <code>$!</code> or similar to interleave the multiplications with the printing.)"}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1518907101, "last_edit_date": 1592644375, "creation_date": 1518902755, "answer_id": 48846081, "question_id": 48845646, "link": "https://stackoverflow.com/questions/48845646/how-to-print-the-iterations-inside-a-haskell-recursion-call/48846081#48846081", "title": "how to print the iterations inside a Haskell recursion call?", "body": "<h3>The type</h3>\n<p>To print, you'll need to lift the value into the I/O Applicative; the type will change from</p>\n<pre><code>factorial :: (Num a, Ord a) =&gt; a -&gt; a\n</code></pre>\n<p>to</p>\n<pre><code>factorial :: (Num a, Ord a, Show a) =&gt; a -&gt; IO a\n</code></pre>\n<h3>What the <code>go</code> action does</h3>\n<p>The <code>go</code> action needs to do two things:</p>\n<ol>\n<li>print the number <code>n</code></li>\n<li>either recursively call <code>go</code> or produce the result</li>\n</ol>\n<h3>How to do two I/O actions sequentially</h3>\n<p>To do two things, we need some combinator to combine them. The appropriate one here is <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Applicative.html#v:-42--62-\" rel=\"nofollow noreferrer\"><code>*&gt;</code></a>:</p>\n<blockquote>\n<p><code>(*&gt;) :: Applicative f =&gt; f a -&gt; f b -&gt; f b</code></p>\n<p>Sequence actions, discarding the value of the first argument.</p>\n</blockquote>\n<p>This is exactly what we need because we don't need to use the value of the first action (the type of the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:print\" rel=\"nofollow noreferrer\"><code>print</code></a> action is <code>IO ()</code>, so it doesn't contain any useful result).</p>\n<h3>Lifting a value into I/O</h3>\n<p>We also need <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Applicative.html#v:pure\" rel=\"nofollow noreferrer\"><code>pure</code></a> at the end</p>\n<blockquote>\n<p><code>pure :: Applicative f =&gt; a -&gt; f a</code></p>\n<p>Lift a value.</p>\n</blockquote>\n<p>to lift the result into the I/O Applicative.</p>\n<h3>The code</h3>\n<pre><code>factorial n = go n 1\n  where\n    go n acc =\n      print n *&gt;\n      if n &gt; 1\n        then let !acc' = acc * n\n             in  go (n-1) acc'\n        else pure acc\n</code></pre>\n<p>The <code>!</code> in the binding of <code>acc'</code> <a href=\"https://stackoverflow.com/questions/993112/what-does-the-exclamation-mark-mean-in-a-haskell-declaration\">forces</a> the multiplication to occur immediately (thanks to <a href=\"https://stackoverflow.com/a/48845978/402884\">Daniel Wagner</a> for pointing out the need for this).</p>\n<p>Testing in GHCi:</p>\n<pre><code>\u03bb&gt; factorial 5 &gt;&gt;= print\n5\n4\n3\n2\n1\n120\n</code></pre>\n"}], "owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 1, "accepted_answer_id": 48846081, "answer_count": 3, "score": 4, "last_activity_date": 1606871126, "creation_date": 1518899363, "last_edit_date": 1606871126, "question_id": 48845646, "link": "https://stackoverflow.com/questions/48845646/how-to-print-the-iterations-inside-a-haskell-recursion-call", "title": "how to print the iterations inside a Haskell recursion call?", "body": "<p>Considering the code below which returns the factorial of  a number:</p>\n<pre><code>factorial n = go n 1\n  where\n    go n ret | n &gt; 1 = go (n-1) (ret * n)\n             | otherwise = ret\n</code></pre>\n<p>how can I print <code>n</code> in every single recursive call of <code>go n ret</code>? Since <code>n</code> is being decremented each time, I want to see if I can print it every time it gets decremented (like <code>5 4 3 2 1</code>).\nThis is how I tried to do it (which is totally wrong) but I can't think of a different way:</p>\n<pre><code>factorial n = go n 1\n  where\n    go n ret | n &gt; 1 = go (n-1) (ret * n) print n\n             | otherwise = ret\n</code></pre>\n"}, {"tags": ["haskell", "happstack", "hdbc"], "answers": [{"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 1, "last_activity_date": 1518933966, "creation_date": 1518933966, "answer_id": 48848962, "question_id": 48845497, "link": "https://stackoverflow.com/questions/48845497/how-to-pass-http-request-parameter-to-quickquery/48848962#48848962", "title": "How to pass HTTP request parameter to quickQuery?", "body": "<p>As you may have guessed, this is too an issue with monads. There are a <a href=\"http://hackage.haskell.org/package/happstack-server-7.5.0.1/docs/Happstack-Server-Monads.html\" rel=\"nofollow noreferrer\">handful</a> of them in <code>happstack</code> (<code>HasRqData</code>, among others), so you may well consider it a complicated case.</p>\n\n<p>Let us begin with the <em>innocent-looking</em> <a href=\"http://hackage.haskell.org/package/happstack-server-7.5.0.1/docs/Happstack-Server-RqData.html#v:look\" rel=\"nofollow noreferrer\"><code>look</code></a> function.</p>\n\n<pre><code>look :: (Functor m, Monad m, HasRqData m) =&gt; String -&gt; m String\n</code></pre>\n\n<p>Indeed, there is a non-trivial constraint <code>HasRqData</code>. Let us ask ourselves: <a href=\"http://hackage.haskell.org/package/happstack-server-7.5.0.1/docs/Happstack-Server-RqData.html#t:HasRqData\" rel=\"nofollow noreferrer\">what monads <em>HaveRqData</em></a>? (It so happens that <code>IO</code> has not!)</p>\n\n<pre><code>class HasRqData m where\n...\n\nInstances\n    HasRqData RqData         \n    (MonadIO m, MonadPlus m) =&gt; HasRqData (ServerPartT m)\n    ...\n</code></pre>\n\n<p>The other instances are derivative of these first two, so, it looks like we have to consider these two options first.</p>\n\n<ul>\n<li>The <a href=\"http://hackage.haskell.org/package/happstack-server-7.5.0.1/docs/Happstack-Server-RqData.html#t:RqData\" rel=\"nofollow noreferrer\"><code>RqData</code></a> has limited effects \u2014 you can only do <code>look</code> and its derivatives, extracting information from the request at hand. As we want to also have other effects \u2014 querying the database, for one, \u2014 this is not enough for us.</li>\n<li>The <code>ServerPartT m</code> is the general form of the same <a href=\"https://stackoverflow.com/q/48820722/2108477\">old friend of ours</a>, <code>ServerPart \u2261 ServerPartT IO</code>. It happens that it also <code>HasRqData</code>. This is not a coincidence, but rather an implication of the design of <code>happstack</code> \u2014 looks like the authors meant us to use this single monad everywhere, unless we need particular granularity. So, let's give it a try.</li>\n</ul>\n\n<p>&nbsp;</p>\n\n<pre><code>myFunc :: ServerPart String\nmyFunc = do r &lt;- look \"personId\"\n            return undefined\n</code></pre>\n\n<p>This compiles.</p>\n\n<p>Now, we don't even need to lift <code>myFunc</code> in <code>handlers</code> \u2014 our <a href=\"https://stackoverflow.com/q/48820722/2108477\">previous predicament</a> solved itself. We will need to lift our access to the database though, by the same <a href=\"https://stackoverflow.com/a/48822589/2108477\"><em>jar logic</em></a> we discussed before.</p>\n\n<p>I believe you can figure the details by yourself. In any case, let me know how it works out!</p>\n"}], "owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 48848962, "answer_count": 1, "score": 1, "last_activity_date": 1518933966, "creation_date": 1518898367, "question_id": 48845497, "link": "https://stackoverflow.com/questions/48845497/how-to-pass-http-request-parameter-to-quickquery", "title": "How to pass HTTP request parameter to quickQuery?", "body": "<p>I'm using Happstack to receive some parameters from an HTTP request then pass these parameters to a function that will retrieve data from the database and return this data in the HTTP response as follow:</p>\n\n<pre><code>myFunc :: IO String\nmyFunc = do r &lt;- look \"personId\"\n            conn &lt;- connectODBC \"... my connection string ...\";\n            vals &lt;- quickQuery conn (\"SELECT Name FROM Person where Id = ?\") [(toSql r)];\n            return (processData vals)\n\nhandlers :: ServerPartT IO Response\nhandlers = do\n       x &lt;- liftIO (myFunc);\n       decodeBody (defaultBodyPolicy \"/tmp/\" 0 1000 1000)\n       msum [ \n              dir \"getData\" $ ok $ toResponse x\n            , ... other handlers ...\n            ]\n\nmainFunc = simpleHTTP nullConf handlers\n</code></pre>\n\n<p>But when I build the above code I get the following error:</p>\n\n<blockquote>\n  <p>No instance for (HasRqData IO) arising from a use of `look'\n  In a stmt of a 'do' block: r &lt;- look \"personId\"</p>\n</blockquote>\n\n<p>After reading questions on similar issues (like <a href=\"https://stackoverflow.com/questions/16154592/haskell-no-instance-for-eq-a-arising-from-a-use-of\">this one</a>) I think I have to include <code>HasRqData</code> constraint somewhere, but I couldn't learn where and how.</p>\n"}, {"tags": ["haskell", "refactoring"], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 4, "last_activity_date": 1518897769, "last_edit_date": 1518897769, "creation_date": 1518897335, "answer_id": 48845330, "question_id": 48845151, "link": "https://stackoverflow.com/questions/48845151/best-way-to-refactor-such-a-dummy-code-with-help-of-haskells-standard-libraries/48845330#48845330", "title": "Best way to refactor such a dummy code with help of Haskell&#39;s standard libraries?", "body": "<p>Yes, what you're looking for is called <em>pattern matching</em>, and you can't really write haskell without it. Here's the most straightforward adaptation of your code:</p>\n\n<pre><code>try_parse_parameters (p:ps) kvps options = \n    case try_parse_kvp p of\n      Just kvp -&gt; try_parse_parameters ps (kvp : kvps) options\n      Nothing -&gt; \n        case try_parse_option p of\n          Just o -&gt; try_parse_parameters ps kvps (o : options)\n          Nothing -&gt; try_parse_parameters ps kvps options\n</code></pre>\n\n<p>From here there are a lot of things you might improve, now or later as you learn more haskell:</p>\n\n<ul>\n<li>I would really suggest using CamelCase, which is standard but also more readable because you can easily distinguish functions from their arguments</li>\n<li>you're doing a <em>fold</em> over the list. You could use <code>foldr</code> to factor out the recursion and make it more clear to people reading your code what it does (and what it can't do; i.e. making it easier to reason about)</li>\n<li>add a type signature, handle the empty list case, maybe other issues</li>\n<li>You might find that the <code>Alternative</code> class is helpful, or using a monadic fold perhaps if you want the entire computation to fail if any of the parses fail completely</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 4, "last_activity_date": 1518904946, "last_edit_date": 1518904946, "creation_date": 1518897990, "answer_id": 48845429, "question_id": 48845151, "link": "https://stackoverflow.com/questions/48845151/best-way-to-refactor-such-a-dummy-code-with-help-of-haskells-standard-libraries/48845429#48845429", "title": "Best way to refactor such a dummy code with help of Haskell&#39;s standard libraries?", "body": "<p>You can also handle more than one case with pattern matching, avoiding the <a href=\"https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming)\" rel=\"nofollow noreferrer\">pyramid of doom</a>.</p>\n\n<pre><code>try_parse_parameters (p:ps) kvps options = \n    case (try_parse_kvp p, try_parse_option p) of\n      (Just k, _)       -&gt; try_parse_parameters ps (k : kvps) options\n      (Nothing, Just o) -&gt; try_parse_parameters ps kvps (o : options)\n      (Nothing, Nothing)-&gt; try_parse_parameters ps kvps options\n</code></pre>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 48845429, "answer_count": 2, "score": 2, "last_activity_date": 1518904946, "creation_date": 1518896109, "question_id": 48845151, "link": "https://stackoverflow.com/questions/48845151/best-way-to-refactor-such-a-dummy-code-with-help-of-haskells-standard-libraries", "title": "Best way to refactor such a dummy code with help of Haskell&#39;s standard libraries?", "body": "<p>I am currently working with quite dirty project written in Haskell.\nIt contains lots of code like:</p>\n\n<pre><code>try_parse_parameters (p:ps) kvps options = \n        let maybeKvp = try_parse_kvp p \n        in\n          if isJust maybeKvp \n            then try_parse_parameters ps ((fromJust maybeKvp) : kvps) options\n            else \n              let maybeOption = try_parse_option p\n              in \n                if isJust maybeOption\n                  then try_parse_parameters ps kvps ((fromJust maybeOption) : options)\n                  else try_parse_parameters ps kvps options\n</code></pre>\n\n<p>Thus, my questions is: is there some <strong>standard</strong> method(s) to deal with such a situation?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 1, "creation_date": 1518889352, "post_id": 48844061, "comment_id": 84692513, "body": "What if they&#39;re out of order? e.g. do you want it to return True for (0,0), (1,1), (1,0), (0,1)? And do you want it to recognize squares that are not aligned with the coordinate axes?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1518889587, "post_id": 48844061, "comment_id": 84692583, "body": "You can&#39;t get distance between a list of points, you need a list of <i>pairs</i> of points that are neighbors in the square.  Instead of enumerating what you tried how about you show the code and the error message in addition to telling us what part you can&#39;t figure out?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518890142, "post_id": 48844061, "comment_id": 84692753, "body": "I don&#39;t know how to make the list of pairs of points? I get suck on this too"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1518913123, "post_id": 48844061, "comment_id": 84698524, "body": "<a href=\"https://codegolf.stackexchange.com/a/1630/69655\">Here</a> is an answer on Programming Puzzles and Code Golf Stack Exchange that does this by counting the number of unique lengths when lengths are calculated pairwise."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518898563, "post_id": 48845134, "comment_id": 84695180, "body": "This check is not enough. e.g. let two congruent equilateral triangles share an edge and you will find there are only two different distance values between any pair of those four points, but they do not form a square. Another counterexample is to put a point at the center of an equilateral triangle. There may be others."}], "tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 0, "last_activity_date": 1518896361, "last_edit_date": 1518896361, "creation_date": 1518896009, "answer_id": 48845134, "question_id": 48844061, "link": "https://stackoverflow.com/questions/48844061/testing-whether-four-points-form-a-square-in-haskell/48845134#48845134", "title": "Testing whether four points form a square in Haskell", "body": "<p>If you have points p1, p2, p3 and p4 calculate the distances d1 =|p1 p2|, d2= |p1 p3|, d3 = |p1 p4|, d4 = |p2 p3|, d5 = |p2, p4|, d6 = |p3 p4|. (You can also compute the square of the distance...)</p>\n\n<p>Look how many different distance values you got. If you have only 2 different values, then one is for the length of the 4 edges, the other for the length of the 2 diagonals and you have a square. </p>\n\n<p>If you have more than 2 different values, it's not a square!</p>\n\n<p>Hints for implementation: Create a list of the distances and then look at the list functions.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1518899629, "post_id": 48845222, "comment_id": 84695427, "body": "Please, don&#39;t define <code>Num</code> instances on non-number types like multidimensional vectors! This easily leads to strange bugs because multiplication and number literals have semantics that don&#39;t really make sense for vectors as mathematical objects. (Yes, I know Edward Kmett has done this mistake in <code>linear</code> as well... it has caused me some bugs that were almost Matlab-level weird.) Use <a href=\"http://hackage.haskell.org/package/vector-space-0.13/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\">the purpose-intended class</a> instead."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518900273, "post_id": 48845222, "comment_id": 84695583, "body": "@leftaroundabout Fair point. Updated to not use a class at all."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1518979434, "post_id": 48845222, "comment_id": 84713985, "body": "@leftaroundabout, you might appreciate <a href=\"https://github.com/benl23x5/gloss/pull/39#event-1479449106\" rel=\"nofollow noreferrer\">my recent PR</a> for <code>gloss</code>."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 3, "last_activity_date": 1518900255, "last_edit_date": 1518900255, "creation_date": 1518896684, "answer_id": 48845222, "question_id": 48844061, "link": "https://stackoverflow.com/questions/48844061/testing-whether-four-points-form-a-square-in-haskell/48845222#48845222", "title": "Testing whether four points form a square in Haskell", "body": "<p>I'm sure there are a number of ways to solve this problem, but this is the first one that occurred to me.</p>\n\n<pre><code>import Data.Functor\nimport Data.Maybe\nimport Control.Applicative\nimport Control.Monad\n</code></pre>\n\n<p>First let's define a type for two-dimensional vectors and some basic operations on them. We're going to need to be able to add and subtract, and to use the dot product to test for orthogonality.</p>\n\n<pre><code>data V2 a = V2 a a\n  deriving Eq\n\n(^+), (^-) :: Num a =&gt; V2 a -&gt; V2 a -&gt; V2 a\nV2 x y ^+ V2 x' y' = V2 (x + x') (y + y')\nV2 x y ^- V2 x' y' = V2 (x - x') (y - y')\ninfixl 6 ^+, ^-\n\ndotProduct :: (Num a) =&gt; V2 a -&gt; V2 a -&gt; a\ndotProduct (V2 x y) (V2 x' y') = (x * x') + (y * y')\n\northogonal :: (Eq a, Num a) =&gt; V2 a -&gt; V2 a -&gt; Bool\northogonal a b = dotProduct a b == 0\n</code></pre>\n\n<p>And we'll also define a line segment:</p>\n\n<pre><code>data LineSegment a = LineSegment (V2 a) (V2 a)\n</code></pre>\n\n<p>The <code>isSquare</code> function is going to start by taking the first three points and seeing whether they form a right triangle. So let's define a right triangle type, and a function to turn three points into a right triangle if there is a right angle among them.</p>\n\n<pre><code>data RightTriangle a =\n  RightTriangle\n    (V2 a)          -- Point at the right angle\n    (LineSegment a) -- Hypotenuse\n\nrightTriangleMaybe :: (Eq a, Num a)\n  =&gt; V2 a -&gt; LineSegment a -&gt; Maybe (RightTriangle a)\nrightTriangleMaybe x hyp@(LineSegment a b) =\n  guard (orthogonal (x ^- a) (x ^- b)) $&gt; RightTriangle x hyp\n\nrightTriangleMaybe' :: (Eq a, Num a)\n  =&gt; V2 a -&gt; V2 a -&gt; V2 a -&gt; Maybe (RightTriangle a)\nrightTriangleMaybe' a b c =\n  rightTriangleMaybe a (LineSegment b c) &lt;|&gt;\n  rightTriangleMaybe b (LineSegment a c) &lt;|&gt;\n  rightTriangleMaybe c (LineSegment a b)\n</code></pre>\n\n<p>Testing whether four points form a square now boils down to two steps:</p>\n\n<ol>\n<li>Find the right angle among the first three points</li>\n<li>Test whether the fourth point is in the right place</li>\n</ol>\n\n\n\n<pre><code>isSquare :: (Eq a, Num a) =&gt; V2 a -&gt; V2 a -&gt; V2 a -&gt; V2 a -&gt; Bool\nisSquare a b c d = isJust $ do\n  RightTriangle x (LineSegment y z) &lt;- rightTriangleMaybe' a b c\n  guard $ y ^+ z ^- x == d\n</code></pre>\n\n<p>(Try drawing a visual proof to see why the fourth point must lie at <code>y + z - x</code>)</p>\n\n<p>Tests:</p>\n\n<pre><code>\u03bb&gt; isSquare (V2 0 1) (V2 1 0) (V2 0 (-1)) (V2 (-1) 0)\nTrue\n\n\u03bb&gt; isSquare (V2 0 1) (V2 1 0) (V2 0 (-1)) (V2 (-2) 0)\nFalse\n\n\u03bb&gt; isSquare (V2 0 1) (V2 1 0) (V2 0 0) (V2 1 1)\nTrue\n\n\u03bb&gt; isSquare (V2 0 1) (V2 1 0) (V2 0 0) (V2 1 2)\nFalse\n\n\u03bb&gt; isSquare (V2 3 4) (V2 3 4) (V2 3 4) (V2 3 4)\nTrue\n\n\u03bb&gt; isSquare (V2 3 4) (V2 3 4) (V2 3 4) (V2 3 5)\nFalse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518947985, "post_id": 48846341, "comment_id": 84704319, "body": "I don&#39;t understand this: <code>d1!!0 == d1!!1 &amp;&amp; sqrt((d1!!0)^2+(d1!!1)^2) == d1!!2</code>"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518948000, "post_id": 48846341, "comment_id": 84704321, "body": "And this: <code>d1 = sort $ map m1 [(x2,y2),(x3,y3),(x4,y4)]</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518980004, "post_id": 48846341, "comment_id": 84714173, "body": "There&#39;s really no need to take square roots; that just makes the calculations less precise. You really only need the <i>squares</i> of the distances."}], "tags": [], "owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "is_accepted": false, "score": 0, "last_activity_date": 1518990377, "last_edit_date": 1518990377, "creation_date": 1518904681, "answer_id": 48846341, "question_id": 48844061, "link": "https://stackoverflow.com/questions/48844061/testing-whether-four-points-form-a-square-in-haskell/48846341#48846341", "title": "Testing whether four points form a square in Haskell", "body": "<p>We create a function that returns the cartesian distance between two points:</p>\n\n<pre><code>dist (x1, y1) (x2, y2) = sqrt $ (x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)\n</code></pre>\n\n<p>From each point we can calculate distances to the three other points. </p>\n\n<p>For a square, these distances will be the same for each of the points, and will have the form <code>[a, a, sqrt(2*a^2)]</code>. One can test for the following to establish that a given set of points form a square:</p>\n\n<ul>\n<li>all the distance lists are the same</li>\n<li>the shorter two distances are equal</li>\n<li>the longest distance = sqrt(2 * a^2) where a is the short distance</li>\n</ul>\n\n<p><em>in practice we don't need to establish the above conditions hold for all of the points, so you could chop a few lines from the following function</em></p>\n\n<pre><code>import Data.List\n\nisSquare (x1, y1) (x2, y2) (x3, y3) (x4, y4) =\n  let m1 = dist (x1,y1)\n      m2 = dist (x2,y2)\n      m3 = dist (x3,y3)\n      m4 = dist (x4,y4)\n      d1 = sort $ map m1 [(x2,y2),(x3,y3),(x4,y4)]\n      d2 = sort $ map m2 [(x1,y1),(x3,y3),(x4,y4)]\n      d3 = sort $ map m3 [(x1,y1),(x2,y2),(x4,y4)]\n      d4 = sort $ map m4 [(x1,y1),(x2,y2),(x3,y3)] \n  in d1 == d2 &amp;&amp; d2 == d3 &amp;&amp; d3 == d4 &amp;&amp; d1!!0 == d1!!1 &amp;&amp; sqrt((d1!!0)^2+(d1!!1)^2) == d1!!2 \n</code></pre>\n\n<p>Here d1, d2, d3 &amp; d4 are the sorted distance lists for each of the points</p>\n\n<p>example: </p>\n\n<p>for the square given by the points <code>(0,0) (0,1) (1,1) (1,0)</code></p>\n\n<p>the sorted distance list for point (0,0) is <code>[1,1,1.414]</code></p>\n\n<pre><code>* distance to (0,1) = 1\n* distance to (1,0) = 1\n* distance to (1,1) = sqrt(2) ~ 1.414\n</code></pre>\n\n<p>similarly, the distance list for all the other points are <code>[1,1,1.414]</code></p>\n\n<p>We calculate the distance by mapping the partial distance functions over the lists, and then we sort so that the shorter distances are guaranteed to be at the head.</p>\n\n<p>Then we can look into the distance lists and ensure that the first two elements are equal, </p>\n\n<pre><code>d1!!0 == d1!!1\n</code></pre>\n\n<p>and that the diagonal distance is equal to the square root of the squared sum of the two edge distances</p>\n\n<pre><code>sqrt((d1!!0)^2+(d1!!1)^2) == d1!!2\n</code></pre>\n\n<p>You can write this last condition equivalently as </p>\n\n<pre><code>(d1!!0)^2+(d1!!1)^2 == (d1!!2)^2 \n</code></pre>\n\n<p>Actually, as user @dfeuer points out, we can use the squared distances for establishing a set of points is a square. Then, the functions can be written as</p>\n\n<pre><code>dist (x1, y1) (x2, y2) = (x2-x1)^2 + (y2-y1)^2\n\nisSquare (x1,y1) (x2,y2) (x3,y3) (x4,y4) =\n  let m1 = dist (x1,y1)\n      m2 = dist (x2,y2)\n      m3 = dist (x3,y3)\n      m4 = dist (x4,y4)\n      d1 = sort $ map m1 [(x2,y2),(x3,y3),(x4,y4)]\n      d2 = sort $ map m2 [(x1,y1),(x3,y3),(x4,y4)]\n      d3 = sort $ map m3 [(x1,y1),(x2,y2),(x4,y4)]\n      d4 = sort $ map m4 [(x1,y1),(x2,y2),(x3,y3)]\n  in d1 == d2 &amp;&amp; d2 == d3 &amp;&amp; d3 == d4 &amp;&amp; d1!!0 == d1!!1 &amp;&amp; 2*d1!!0 == d1!!2\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1518990377, "creation_date": 1518889040, "last_edit_date": 1518898067, "question_id": 48844061, "link": "https://stackoverflow.com/questions/48844061/testing-whether-four-points-form-a-square-in-haskell", "title": "Testing whether four points form a square in Haskell", "body": "<p>On a website, I found the following challenge and got caught and I don't know how to solve it. We need to define the following function:</p>\n\n<p><code>isSquare :: (Num a, Ord a) =&gt; (a,a) -&gt; (a,a) -&gt; (a,a) -&gt; (a,a) -&gt; Bool</code></p>\n\n<p>Such that it returns True when the points are vertex of a square and False when they are not.</p>\n\n<pre><code>isSquare (1,1) (1,1) (1,1) (1,1)    == True\nisSquare (0,0) (0,2) (3,2) (3,0)    == False\nisSquare (0,0) (3,4) (8,4) (5,0)    == False\nisSquare (0,0) (0,0) (1,1) (0,0)    == False\n</code></pre>\n\n<p>I have tried this:</p>\n\n<ol>\n<li><p>Define a function that calculates the distance between points</p></li>\n<li><p>Map <code>distance</code> to the list formated by points.</p></li>\n<li><p>If the distances are equal, then <code>True</code></p></li>\n</ol>\n"}, {"tags": ["haskell", "recursion-schemes"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518900210, "post_id": 48845592, "comment_id": 84695569, "body": "Your <code>inList</code> is called <code>embed</code> in the library (it&#39;s a method of the <code>Corecursive</code> class)."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1518901664, "post_id": 48845592, "comment_id": 84695948, "body": "@Li-yao Thanks. The first part with the Natural Transformation is fine. This reasoning is also valid for non-list catamorphisms. However with the filters I have not yet any criterias other than these natural transformations, when composing f-algebras for non-list data structures (eg expression trees) are possible."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1518907412, "post_id": 48845592, "comment_id": 84697368, "body": "@Jogger I expanded my answer with a criterion that you may find interesting."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1518908160, "post_id": 48845592, "comment_id": 84697521, "body": "In Haskell, <code>filter</code> is actually a homomorphism to the dual semigroup: <code>filter p . filter q = filter (liftA2 (&amp;&amp;) q p)</code>. In particular, <code>filter (const undefined) . filter (const False) = filter (const False)</code>. Apparently, failing to swap these led to a bug in the <code>filter</code> rewrite rules in the early days of GHC!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1518909151, "post_id": 48845592, "comment_id": 84697754, "body": "Good catch! That&#39;s an interesting observation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518911081, "post_id": 48845592, "comment_id": 84698105, "body": "I don&#39;t know if I&#39;d have noticed it if I hadn&#39;t read the relevant comment in <code>GHC.List</code> years ago."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1518952298, "post_id": 48845592, "comment_id": 84705378, "body": "@Li-yao Thanks for elaborating the additional &quot;filter&quot;-explanation"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1518907359, "last_edit_date": 1518907359, "creation_date": 1518899038, "answer_id": 48845592, "question_id": 48843987, "link": "https://stackoverflow.com/questions/48843987/what-are-the-rules-to-compose-f-algebras-in-a-catamorphism/48845592#48845592", "title": "What are the rules to compose f-algebras in a catamorphism", "body": "<p>\"Structure preserving algebras\" can be formalized as natural transformations (that can be between different functors).</p>\n\n<pre><code>inList :: ListF a [a] -&gt; [a]\ninList Nil = []\ninList (Cons a as) = a : as\n\nntDouble, ntTriple :: forall a. ListF Int a -&gt; ListF Int a\nalgDouble = inList . ntDouble\nalgTriple = inList . ntTriple\n</code></pre>\n\n<p>Then, for any algebra <code>f</code> and natural transformation <code>n</code>,</p>\n\n<pre><code>cata (f . inList . n) = cata f . cata n\n</code></pre>\n\n<p>The <code>doubleAndTriple</code> example is an instance of that for <code>f = algTriple</code> and <code>n = ntDouble</code>.</p>\n\n<p>This doesn't easily generalize to larger classes of algebras.</p>\n\n<p>I think the case of filter is easier to see without categories, as a consequence of the fact that <code>filter</code> is a semigroup homomorphism: <code>filter p . filter q = filter (liftA2 (&amp;&amp;) p q)</code>.</p>\n\n<hr>\n\n<p>I searched for a general but sufficient condition for a \"distributive law\" on filter-like algebras. Abbreviate a bit <code>afs = algFilterSmall</code>, <code>afb = algFilterBig</code>. We reason backwards, to find a sufficient condition for:</p>\n\n<pre><code>cata (afs . project . afb) = cata afs . cata afb  -- Equation (0)\n</code></pre>\n\n<p>By definition of a catamorphism, <code>z = cata (afs . project . afb)</code> is the unique solution to this equation (a disguised commutative diagram):</p>\n\n<pre><code>z . inList = afs . project . afb . fmap z\n</code></pre>\n\n<p>Substitute <code>z</code> with the RHS of the previous equation:</p>\n\n<pre><code>cata afs . cata afb . inList = afs . project . afb . fmap (cata afs . cata afb)\n-- (1), equivalent to (0)\n</code></pre>\n\n<ul>\n<li><p>On the LHS, we apply the definition of <code>cata</code> as a Haskell function, <code>cata afb = afb . fmap (cata afb) . project</code>, and simplify with <code>project . inList = id</code>;</p></li>\n<li><p>on the RHS, we apply a functor law <code>fmap (f . g) = fmap f . fmap g</code>.</p></li>\n</ul>\n\n<p>This yields:</p>\n\n<pre><code>cata afs . afb . fmap (cata afb) = afs . project . afb . fmap (cata afs) . fmap (cata afb)\n-- (2), equivalent to (1)\n</code></pre>\n\n<p>We \"cosimplify\" away the last factor <code>fmap (cata afb)</code> (remember that we are reasoning backwards):</p>\n\n<pre><code>cata afs . afb = afs . project . afb . fmap (cata afs)  -- (3), implies (2)\n</code></pre>\n\n<p>This is the simplest one I could come up with.</p>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 2, "accepted_answer_id": 48845592, "answer_count": 1, "score": 5, "last_activity_date": 1518907359, "creation_date": 1518888584, "question_id": 48843987, "link": "https://stackoverflow.com/questions/48843987/what-are-the-rules-to-compose-f-algebras-in-a-catamorphism", "title": "What are the rules to compose f-algebras in a catamorphism", "body": "<p>Here are some simple F-algebras for lists. They work with the <code>cata</code> function from the \n<a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"noreferrer\">recursion-schemes</a> library. </p>\n\n<pre><code>import Data.Functor.Foldable\n\nalgFilterSmall :: ListF Int [Int] -&gt; [Int]\nalgFilterSmall Nil = [] \nalgFilterSmall (Cons x xs) = if x &gt;= 10 then (x:xs) else xs\n\nalgFilterBig :: ListF Int [Int] -&gt; [Int]\nalgFilterBig Nil = [] \nalgFilterBig (Cons x xs) = if x &lt; 100 then (x:xs) else xs\n\nalgDouble :: ListF Int [Int] -&gt; [Int]\nalgDouble Nil = [] \nalgDouble (Cons x xs) = 2*x : xs\n\nalgTripple :: ListF Int [Int] -&gt; [Int]\nalgTripple Nil = [] \nalgTripple (Cons x xs) = 3*x : xs\n</code></pre>\n\n<p>Now I compose them: </p>\n\n<pre><code>doubleAndTripple :: [Int] -&gt; [Int]\ndoubleAndTripple = cata $ algTripple . project . algDouble\n-- &gt;&gt;&gt; doubleAndTripple [200,300,20,30,2,3]\n-- [1200,1800,120,180,12,18]\n</code></pre>\n\n<p><code>doubleAndTriple</code> works as expected. Both algebras are <em>structure preserving</em>, they don't \nchange the length of the list, so cata can apply both algebras to every item of the list.</p>\n\n<p>Next one is filter and double: </p>\n\n<pre><code>filterAndDouble :: [Int] -&gt; [Int] \nfilterAndDouble = cata $ algDouble . project . algFilterBig\n-- &gt;&gt;&gt; filterAndDouble [200,300,20,30,2,3]\n-- [160,60,4,6]\n</code></pre>\n\n<p>It doesn't work properly. I assume it's because <code>algFilterBig</code> is not structure preserving.</p>\n\n<p>Now the last example: </p>\n\n<pre><code>filterBoth :: [Int] -&gt; [Int] \nfilterBoth = cata $ algFilterSmall . project . algFilterBig \n-- &gt;&gt;&gt; filterBoth [200,300,20,30,2,3]\n-- [20,30]\n</code></pre>\n\n<p>Here both algebras are not structure preserving, but this example is working.</p>\n\n<p>What are the exact rules for composing f-algebras?</p>\n"}, {"tags": ["haskell", "concurrency", "thread-synchronization", "memory-model", "haskell-vector"], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1518907590, "creation_date": 1518886461, "last_edit_date": 1518907590, "question_id": 48843670, "link": "https://stackoverflow.com/questions/48843670/do-shared-mutable-vectors-synchronize-with-atomic-operations-in-ghc-haskell", "title": "Do shared mutable vectors synchronize with atomic operations in GHC Haskell?", "body": "<p>I'm looking for shared concurrent vectors in Haskell, so I would accept an answer that points to a performant solution other than what I'm discussing here, which is to combine the vector library with stm or atomic-primops.</p>\n\n<p>I have two threads sharing a mutable vector (<code>Data.Vector.Mutable.IOVector</code>) and some flag that can be switched once atomically (e.g., <code>TVar</code> with stm or <code>IORef</code> with atomic-primops). Thread 1 may write to the vector (nonatomically) before or after switching the flag atomically, and Thread 2 may read from the vector, before or after checking whether the flag has been switched.</p>\n\n<p>For concreteness, here are some minimal examples. Is there a data race that causes them to   evaluate <code>undefined</code>?</p>\n\n<ul>\n<li>Example using STM: <a href=\"http://lpaste.net/362596\" rel=\"nofollow noreferrer\">http://lpaste.net/362596</a></li>\n<li>Example using atomic-primops: <a href=\"http://lpaste.net/362595\" rel=\"nofollow noreferrer\">http://lpaste.net/362595</a></li>\n</ul>\n\n<p>More generally, do the relative ordering of the atomic operations on the flag imply some ordering between operations on the vector? In particular, I'm wondering whether the following is true:</p>\n\n<ul>\n<li>If the check happens before the switch, then reads preceding the check cannot see writes following the switch.</li>\n<li>If the check happens after the switch, then reads following the check must see writes preceding the switch.</li>\n</ul>\n\n<p>In the case of atomic-primops I particularly have doubts about using <code>readIORef</code>/<code>readForCAS</code>, since the docs say <a href=\"https://hackage.haskell.org/package/atomic-primops-0.8.1.1/docs/Data-Atomics.html#v:readForCAS\" rel=\"nofollow noreferrer\">it does not imply any barriers</a>.</p>\n"}, {"tags": ["haskell", "recursion", "sum"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518871067, "post_id": 48841246, "comment_id": 84686685, "body": "If you&#39;ve written some code that doesn&#39;t work, include it in your question and include any errors you get."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518871129, "post_id": 48841246, "comment_id": 84686708, "body": "So you have $g(n,k,m) = \\sum_{h=0}^n \\operatornane{gfunct}(n-h,m-1,h-1)$ when $m\\ge n$ and $k\\ne 0$?"}, {"owner": {"reputation": 143, "user_id": 4153266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uNwyz.png?s=128&g=1", "display_name": "Raphael J.F. Berger", "link": "https://stackoverflow.com/users/4153266/raphael-j-f-berger"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518871982, "post_id": 48841246, "comment_id": 84686959, "body": "@DanRobertson: I have confused two functions while copying, sorry, I have corrected it."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4153266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uNwyz.png?s=128&g=1", "display_name": "Raphael J.F. Berger", "link": "https://stackoverflow.com/users/4153266/raphael-j-f-berger"}, "edited": false, "score": 0, "creation_date": 1518871697, "post_id": 48841393, "comment_id": 84686874, "body": "This works perfectly, I am surprised that it is that simple! Thank you very much."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 3, "last_activity_date": 1518871247, "creation_date": 1518871247, "answer_id": 48841393, "question_id": 48841246, "link": "https://stackoverflow.com/questions/48841246/recursive-conditional-definition-including-summation-in-haskell/48841393#48841393", "title": "Recursive conditional definition including summation in Haskell", "body": "<p>If you want to sum something for $h$ from 0 to $n$ then you can just write that:</p>\n\n<pre><code>sum [ gfunct (n-h) (m-1) (h-1) | h &lt;- [0..n] ]\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 4153266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uNwyz.png?s=128&g=1", "display_name": "Raphael J.F. Berger", "link": "https://stackoverflow.com/users/4153266/raphael-j-f-berger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 48841393, "answer_count": 1, "score": -2, "last_activity_date": 1518871934, "creation_date": 1518870392, "last_edit_date": 1518871934, "question_id": 48841246, "link": "https://stackoverflow.com/questions/48841246/recursive-conditional-definition-including-summation-in-haskell", "title": "Recursive conditional definition including summation in Haskell", "body": "<p>In Haskell, I want to define a function recursively and using summation there, what I have is this:</p>\n\n<pre><code>partitions n m l = gfunct n m l\n       where\n       gfunct n m l\n         | n == 0 &amp;&amp; m == 0 = 0\n         | n &lt; m  || m == 0 = 1\n         | otherwise        = -- here the Summation \n</code></pre>\n\n<p>This summation shall be an implementation of what one would write in maths like</p>\n\n<p><a href=\"https://i.stack.imgur.com/PTAOe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PTAOe.png\" alt=\"enter image description here\"></a></p>\n\n<p>As far as I understand Haskell should support that style of programming.</p>\n\n<p>(I am a confused newbie in Haskell, and I mostly seek for the solution and not so much to dig deep in functional programming)  I have tried out implementing it with <code>fold</code> or <code>scan</code> but I always failed.</p>\n"}, {"tags": ["haskell", "recursion", "types", "tuples", "type-mismatch"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518868868, "post_id": 48840310, "comment_id": 84686119, "body": "To improve these error messages, it is common practice to write explicit type annotations for top-level functions. Indeed, it is usually recommended to start writing a function starting from its type, and use the type as a guide to write the rest of the code."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4153266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uNwyz.png?s=128&g=1", "display_name": "Raphael J.F. Berger", "link": "https://stackoverflow.com/users/4153266/raphael-j-f-berger"}, "edited": false, "score": 2, "creation_date": 1518863878, "post_id": 48840381, "comment_id": 84684885, "body": "So the solution is &quot;otherwise        = gfunct  (n-m) (k-1) (m+1)  + gfunct (n) (k) (m+1)&quot;. Thank you very much!!"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1518863618, "creation_date": 1518863618, "answer_id": 48840381, "question_id": 48840310, "link": "https://stackoverflow.com/questions/48840310/recursion-in-conditional-definition-in-haskell-gives-error-occurs-check-canno/48840381#48840381", "title": "Recursion in conditional definition in Haskell gives error ( Occurs check: cannot construct the infinite type:)", "body": "<p>A function </p>\n\n<pre><code>g a b c = 0\n</code></pre>\n\n<p>will return <code>0</code> if supplied by three values, <code>a</code>, <code>b</code> and <code>c</code>; but a function</p>\n\n<pre><code>g (a,b,c) = 0\n</code></pre>\n\n<p>will return <code>0</code> if supplied by <em>one</em> value <code>(a,b,c)</code>. Which is a <em>triple</em> of values, <code>a</code>, <code>b</code> and <code>c</code>.</p>\n"}], "owner": {"reputation": 143, "user_id": 4153266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uNwyz.png?s=128&g=1", "display_name": "Raphael J.F. Berger", "link": "https://stackoverflow.com/users/4153266/raphael-j-f-berger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 48840381, "answer_count": 1, "score": 1, "last_activity_date": 1518863766, "creation_date": 1518863041, "last_edit_date": 1518863766, "question_id": 48840310, "link": "https://stackoverflow.com/questions/48840310/recursion-in-conditional-definition-in-haskell-gives-error-occurs-check-canno", "title": "Recursion in conditional definition in Haskell gives error ( Occurs check: cannot construct the infinite type:)", "body": "<p>I want to define a function conditional and using recursion in Haskell (ghci 7.x) like:</p>\n\n<pre><code>partitions n k m = gfunct n k m\n       where\n       gfunct n k m\n         | n == 0 &amp;&amp; k == 0 = 1\n         | n &lt; m  || k == 0 = 0\n         | otherwise        = gfunct (n-m,k-1,m+1) + gfunct (n,k,m+1)\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>fib.hs:20:35:\nOccurs check: cannot construct the infinite type:\n  a1 ~ t6 -&gt; (t5, t6, t7) -&gt; a1\nRelevant bindings include\n  m :: (t5, t6, t7) (bound at fib.hs:17:23)\n  k :: t6 (bound at fib.hs:17:21)\n  n :: (t5, t6, t7) (bound at fib.hs:17:19)\n  gfunct :: (t5, t6, t7) -&gt; t6 -&gt; (t5, t6, t7) -&gt; a1\n    (bound at fib.hs:17:12)\nIn the first argument of \u2018(+)\u2019, namely\n  \u2018gfunct (n - m, k - 1, m + 1)\u2019\nIn the expression:\n  gfunct (n - m, k - 1, m + 1) + gfunct (n, k, m + 1)\n</code></pre>\n\n<p>What am I doing wrong? </p>\n"}, {"tags": ["function", "haskell", "casting", "int"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 9275308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72039ffc6ea410a2be4eba8464039e3?s=128&d=identicon&r=PG&f=1", "display_name": "Brooke", "link": "https://stackoverflow.com/users/9275308/brooke"}, "edited": false, "score": 0, "creation_date": 1518844633, "post_id": 48838097, "comment_id": 84680819, "body": "Thanks for the assistance. I am still trying to grasp how to define the types. Your description was very clear."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1518844372, "creation_date": 1518844372, "answer_id": 48838097, "question_id": 48837993, "link": "https://stackoverflow.com/questions/48837993/haskell-calculating-an-int-100-why-does-one-way-work-however-the-other-wa/48838097#48838097", "title": "Haskell - calculating an Int *100 : why does one way work, however, the other way provides an error?", "body": "<p>Your type says the function takes two <code>Int</code> arguments:</p>\n\n<pre><code>percent :: Int -&gt; Int -&gt; Float\n</code></pre>\n\n<p>But your implementation takes only one:</p>\n\n<pre><code>percent x = {- ... -}\n</code></pre>\n\n<p>Change one or the other of these.</p>\n"}], "owner": {"reputation": 59, "user_id": 9275308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72039ffc6ea410a2be4eba8464039e3?s=128&d=identicon&r=PG&f=1", "display_name": "Brooke", "link": "https://stackoverflow.com/users/9275308/brooke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 48838097, "answer_count": 1, "score": 0, "last_activity_date": 1518844372, "creation_date": 1518843339, "question_id": 48837993, "link": "https://stackoverflow.com/questions/48837993/haskell-calculating-an-int-100-why-does-one-way-work-however-the-other-wa", "title": "Haskell - calculating an Int *100 : why does one way work, however, the other way provides an error?", "body": "<p>I am new to haskell and am trying to learn why certain things do not compile in haskell. For example, I get the following error: </p>\n\n<pre><code> \u2022 Couldn't match expected type \u2018Int -&gt; Float\u2019\n                  with actual type \u2018Float\u2019\n    \u2022 Possible cause: \u2018(/)\u2019 is applied to too many arguments\n      In the expression: (fromIntegral x :: Float) / 100.0\n      In an equation for \u2018percent\u2019:\n          percent x = (fromIntegral x :: Float) / 100.0\n</code></pre>\n\n<p>For this code:</p>\n\n<pre><code>percent :: Int -&gt; Int -&gt; Float\npercent x =  (fromIntegral x :: Float) * 100.0\n</code></pre>\n\n<p>Or something like this:</p>\n\n<pre><code>    percent :: Int -&gt; Int -&gt; Float\n    percent x =   a * 100.0\n        where a = fromIntegral x :: Float\n</code></pre>\n\n<p>While, this method works, that I found on this <a href=\"https://stackoverflow.com/questions/10303251/haskell-converting-int-to-float\">post</a>,  that is slightly more complex as it divides two ints before it multiplies the 100? It follows a similar methodology as the ones I coded as well that involve only one int multiplied by 100. The second one I coded, I modeled after the code seen below. I'm not confused as to why the above do not work, however, the one below that is doing a similar thing works.</p>\n\n<pre><code>percent :: Int -&gt; Int -&gt; Float\npercent x y =   100 * ( a / b )\n  where a = fromIntegral x :: Float\n        b = fromIntegral y :: Float\n</code></pre>\n\n<p>I would appreciate the assistance as I am new to Haskell and still trying to learn how it operates. </p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 1, "creation_date": 1518833472, "post_id": 48837238, "comment_id": 84679254, "body": "Follow your code and ask yourself what happens when you call that with a 0 argument.  That follows the &quot;else&quot; path of your code, which makes a recursive call with x-1..."}, {"owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 2, "creation_date": 1518833517, "post_id": 48837238, "comment_id": 84679270, "body": "if x== <b>0</b> then"}, {"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1518842799, "post_id": 48837238, "comment_id": 84680580, "body": "@MarcTalbot Thanks!! seems my recursion skills are not good. How would the above code change for the input &quot;findKthElem 50 [1..9]&quot;???"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1518855530, "post_id": 48837238, "comment_id": 84682868, "body": "Why the <code>Ord</code> constraint?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518861108, "post_id": 48837238, "comment_id": 84684134, "body": "Minor point: the error message could be less specific, since <code>findKthElem 100 [1,2,3]</code> will reach the empty-list case, even if the list is not empty, causing a puzzling error message."}], "answers": [{"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 2, "last_activity_date": 1518879710, "creation_date": 1518879710, "answer_id": 48842654, "question_id": 48837238, "link": "https://stackoverflow.com/questions/48837238/return-the-item-at-the-specified-position-in-list/48842654#48842654", "title": "Return the item at the specified position in list", "body": "<p>An approach using guards to match against different index values:</p>\n\n<pre><code>findKthElem :: Ord a =&gt; Int -&gt; [a] -&gt; a\nfindKthElem _ [] = error \"empty list provided\"\nfindKthElem i (x:xs) | i &lt; 0 = error \"invalid index\"\n                     | i == 0 = x\n                     | otherwise = findKthElem (i - 1) xs\n</code></pre>\n\n<p>You can also use the <code>Maybe</code> monad to remain error free:</p>\n\n<pre><code>findKthElem :: Ord a =&gt; Int -&gt; [a] -&gt; Maybe a\nfindKthElem _ [] = Nothing\nfindKthElem i (x:xs) | i &lt; 0 = Nothing\n                     | i == 0 = Just x\n                     | otherwise = findKthElem (i - 1) xs\n</code></pre>\n"}], "owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1518879710, "creation_date": 1518833344, "last_edit_date": 1518871125, "question_id": 48837238, "link": "https://stackoverflow.com/questions/48837238/return-the-item-at-the-specified-position-in-list", "title": "Return the item at the specified position in list", "body": "<p>I'm trying to find out en element at a particular position in a list using recursive function. The function takes 2 parameter, an int &amp; list. int is the position of the item in the list. I have specified 2 cases, 1st case for empty list provided and 2nd case for non- empty list.</p>\n\n<p>.hs code</p>\n\n<pre><code>findKthElem :: Ord a =&gt; Int -&gt; [a] -&gt; a\nfindKthElem x [] = error \"empty list provided\"\nfindKthElem x (y:ys) = if x==1 then y else findKthElem (x-1) ys  \n</code></pre>\n\n<p><strong>Input</strong> </p>\n\n<pre><code>*Main&gt; findKthElem 0 [1..99]\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>** Exception: empty list provided\n</code></pre>\n\n<p><strong>Expected Output</strong></p>\n\n<pre><code> 1\n</code></pre>\n\n<p>Since I'm a newbie in Haskell I can't understand where I'm going wrong. Please Help.</p>\n"}, {"tags": ["haskell", "functor", "traversable", "foldable"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1518828901, "post_id": 48836776, "comment_id": 84678574, "body": "A traversal would be a function to relabel the leaves, i.e., just a monadic generalization of functors.  If you meant to apply the permutation recursively at every level, that would be a catamorphism (a fold, but in a different sense from <code>Foldable</code>). But as it currently is, I don&#39;t see an interesting generalization."}, {"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1518834672, "post_id": 48836776, "comment_id": 84679404, "body": "Thanks for pointing out catamorphisms. This is exactly what I need!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518838236, "post_id": 48836776, "comment_id": 84679915, "body": "There were a few errors in <code>applyPermutation</code> -- it looked like you might have accidentally pasted an older version of your function. I took the liberty of editing them away. Feel free to edit it further if I guessed what you meant wrongly."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "edited": false, "score": 0, "creation_date": 1518851320, "post_id": 48838221, "comment_id": 84682025, "body": "Thanks. You mention very interesting ideas. I&#39;ve seen <i>lens</i> often without knowing what it meant. This is clearly a motivation to learn more about it."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1518928611, "last_edit_date": 1518928611, "creation_date": 1518845706, "answer_id": 48838221, "question_id": 48836776, "link": "https://stackoverflow.com/questions/48836776/changing-indices-within-a-haskell-tree/48838221#48838221", "title": "Changing indices within a Haskell tree", "body": "<blockquote>\n  <p><code>Functor</code> does not work, since I use it to change the content of the tree, not its indexing scheme. It seems I would need two instances of <code>Functor</code>, one to change the content and the other to change the array indices.</p>\n</blockquote>\n\n<p>Your intuition here is spot on: a functor that acted on the <code>Neighborhood a</code> field would do what you need, and it is correct to call such a thing \"functor\". Here is one possible refactoring of <code>applyPermutation</code>:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\n-- I prefer case syntax for this sort of definition; with it, there is less stuff\n-- that needs to be repeated. LambdaCase is the icing on the cake: it frees me\n-- me from naming the Tree a argument -- without it I would be forced to write\n-- mapOverNeighborhoods f t = case t of {- etc. -}\nmapOverNeighborhoods :: (Neighborhood a -&gt; Neighborhood a) -&gt; Tree a -&gt; Tree a\nmapOverNeighborhoods f = \\case \n    Empty -&gt; Empty\n    Leaf x -&gt; Leaf x\n    Internal x ts -&gt; Internal x (f (mapOverNeighborhoods f &lt;$&gt; ts))\n\napplyPermutation :: Permutation -&gt; Tree a -&gt; Tree a\napplyPermutation perm = mapOverNeighborhoods applyPermutation'\n    where applyPermutation' = ixmap (Xp, Zm) (perm !)\n</code></pre>\n\n<p>(You might prefer to go even further and use a mapping that takes <code>UnitDirection -&gt; UnitDirection</code> directly, rather than <code>Neighborhood a -&gt; Neighborhood a</code>. I didn't do that primarily to make it mirror the rest of this answer more closely, but also because it arguably makes for a more honest interface -- rearranging indices in an <code>Array</code> is not quite as straightforward as applying an arbitrary function to the indices.)</p>\n\n<p>There are two limitations of this attempt to define another functor:</p>\n\n<ul>\n<li><p>We already have a <code>Functor</code> instance, as you point out. It wouldn't be sensible to replace just for this use case, and defining a <code>newtype</code> for it would be too annoying.</p></li>\n<li><p>Even if that wasn't the case, <code>mapOverNeighborhoods</code> can't be made into a <code>Functor</code> instance, as <code>fmap</code> takes arbitrary <code>a -&gt; b</code> functions, and changing the type of the neighborhoods is not an option.</p></li>\n</ul>\n\n<p>These two concerns are addressed by optics libraries such as <a href=\"https://hackage.haskell.org/package/lens-4.16\" rel=\"nofollow noreferrer\"><em>lens</em></a> (if you end up using optics for just this one thing in your code base, though, you might prefer <a href=\"http://hackage.haskell.org/package/microlens\" rel=\"nofollow noreferrer\"><em>microlens</em></a> for a smaller dependency footprint).</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-} -- makeLenses needs this.\n{-# LANGUAGE DeriveFunctor #-} -- For the sake of convenience.\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n\n-- Record fields on sum types are nasty; these, however, are only here for the\n-- sake of automatically generating optics with makeLenses, so it's okay.\ndata Tree a\n    = Empty \n    | Leaf { _value :: a } \n    | Internal { _value :: a, _neighborhood :: Neighborhood a }\n    deriving (Eq, Show, Functor, Foldable, Traversable)\nmakeLenses ''Tree\n\napplyPermutation :: Permutation -&gt; Tree a -&gt; Tree a\napplyPermutation perm = over neighborhood applyPermutation'\n    where applyPermutation' = ixmap (Xp, Zm) (perm !)\n</code></pre>\n\n<p><code>over</code> (infix spelling: <code>%~</code>) is literally an <code>fmap</code> which allows choosing the targets. We do that by passing it an appropriate optic (in this case, <code>neighborhood</code>, which is a <code>Traversal</code> that targets all neighborhoods in a tree -- <code>over neighborhood</code> can be read as \"map over all neighborhoods\"). Note that the fact that we can't change the type of the neighborhood is not a problem (and also, in other circumstances, it would be possible to have type-changing optics).</p>\n\n<p>On a final note, the type of <code>neighborhoods</code> is <code>Traversal' (Tree a) (Neighborhood a)</code>. If we expand the <code>Traversal'</code> type synonym, we get:</p>\n\n<pre><code>GHCi&gt; :t neighborhood\nneighborhood\n  :: Applicative f =&gt;\n     (Neighborhood a -&gt; f (Neighborhood a)) -&gt; Tree a -&gt; f (Tree a)\n</code></pre>\n\n<p>While going into the reasons why it is like that would make this answer too long, it is worth noting that this is a lot like the signature of <code>traverse</code> for <code>Tree</code>...</p>\n\n<pre><code>GHCi&gt; :set -XTypeApplications\nGHCi&gt; :t traverse @Tree\ntraverse @Tree\n  :: Applicative f =&gt; (a -&gt; f b) -&gt; Tree a -&gt; f (Tree b)\n</code></pre>\n\n<p>... except that it acts on the neighborhoods rather than on the values (cf. the parallel between <code>fmap</code> and <code>mapOverNeighborhoods</code>). In fact, if you were to adequately implement the <code>traverse</code> analogue with that type, you would be able to use it instead of the one automatically generated by <code>makeLenses</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "edited": false, "score": 1, "creation_date": 1518919833, "post_id": 48839996, "comment_id": 84699563, "body": "Thank you for your answer as well. I&#39;m really impressed by what Haskell can do. It&#39;s the third time I dive into this language and I think it will be hard from now on to go back to other languages! Reading about catamorphisms, lens and so on is definitely the next step!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1518860951, "creation_date": 1518860951, "answer_id": 48839996, "question_id": 48836776, "link": "https://stackoverflow.com/questions/48836776/changing-indices-within-a-haskell-tree/48839996#48839996", "title": "Changing indices within a Haskell tree", "body": "<p>For completeness, I coded a small variant based on catamorphisms, exploiting <code>recursion-schemes</code>.</p>\n\n<pre><code>{-# LANGUAGE LambdaCase, DeriveFunctor, KindSignatures, TypeFamilies, \n    DeriveFoldable, DeriveTraversable, TemplateHaskell #-}\n\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\nimport Data.Array\ndata UnitDir = Xp | Xm | Yp | Ym | Zp | Zm\n    deriving (Show, Eq, Ord, Enum, Bounded, Ix)\n\ntype Neighborhood a = Array UnitDir (Tree a)\n\ndata Tree a = Empty | Leaf a | Internal a (Neighborhood a)\n    deriving (Eq, Show, Functor)\n\n-- Use TH to automatically define a base functor for Tree,\n-- enabling recursion-schemes\nmakeBaseFunctor ''Tree\n</code></pre>\n\n<p>The wanted mapping function is then:</p>\n\n<pre><code>mapOverNeighborhoods :: (Neighborhood a -&gt; Neighborhood a) -&gt; Tree a -&gt; Tree a\nmapOverNeighborhoods f = cata $ \\case\n   EmptyF -&gt; Empty\n   LeafF x -&gt; Leaf x\n   InternalF x nb -&gt; Internal x (f nb)\n</code></pre>\n\n<p>Roughly, <code>cata</code> does all the recursion for us. It provides to its function argument (<code>\\case ...</code>, above) a value of type <code>TreeF a (Tree a)</code> which is essentially the same as a plain <code>Tree a</code> except that the very first \"layer\" uses different constructors, ending with an extra <code>F</code>. All such constructors have their inner trees already pre-processed by <code>cata</code>: above, we can assume that all the trees inside the <code>nb</code> array already had <code>f</code> applied recursively. What we need to do is to handle the first \"layer\", transforming the <code>F</code> constructors into the regular ones, and applying <code>f</code> to this first \"layer\" as well.</p>\n"}], "owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 48838221, "answer_count": 2, "score": 2, "last_activity_date": 1518928611, "creation_date": 1518827805, "last_edit_date": 1518845850, "question_id": 48836776, "link": "https://stackoverflow.com/questions/48836776/changing-indices-within-a-haskell-tree", "title": "Changing indices within a Haskell tree", "body": "<p>(Sorry for the long context description, but I couldn't find a simpler way to explain my problem) Consider the following types:</p>\n\n<pre><code>import Data.Array\n\ndata UnitDir = Xp | Xm | Yp | Ym | Zp | Zm\n    deriving (Show, Eq, Ord, Enum, Bounded, Ix)\n\ntype Neighborhood a = Array UnitDir (Tree a)\n\ndata Tree a = Empty | Leaf a | Internal a (Neighborhood a)\n    deriving (Eq, Show)\n</code></pre>\n\n<p>Clearly, <code>Tree</code> can be defined as an instance of <code>Functor</code> as follows:</p>\n\n<pre><code>instance Functor Tree where\n    fmap _ Empty           = Empty\n    fmap f (Leaf x)        = Leaf (f x)\n    fmap f (Internal x ts) = Internal (f x) $ fmap (fmap f) ts\n</code></pre>\n\n<p>I would like to define a function that traverses an instance of <code>Tree</code> by permuting the indices of the <code>Array UnitDir (Tree a)</code> (so it's a permutation on the 6 possible values of <code>UnitDir</code>).</p>\n\n<p>A possible implementation would be this one:</p>\n\n<pre><code>type Permutation = Array UnitDir UnitDir\n\napplyPermutation :: Permutation -&gt; Tree a -&gt; Tree a\napplyPermutation _ Empty = Empty\napplyPermutation _ (Leaf x) = Leaf x\napplyPermutation f (Internal x ts) = Internal x (applyPermutation' ts)\n    where applyPermutation' ts = ixmap (Xp, Zm) (f !) (applyPermutation f &lt;$&gt; ts)\n</code></pre>\n\n<p>My question is the following: Is there a natural Haskell construction to \"traverse\" the tree while reindexing the children?</p>\n\n<p><code>Functor</code> does not work, since I use it to change the content of the tree, not its indexing scheme. It seems I would need two instances of <code>Functor</code>, one to change the content and the other to change the array indices.</p>\n\n<p>I thought that <code>Traversable</code> would be the right choice, but none of the signatures of the provided functions matches that of <code>applyPermutation</code>.</p>\n\n<p>Thanks in advance for any help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1518824827, "post_id": 48836429, "comment_id": 84677690, "body": "What do you mean, <code>Empty</code>? What is the Empty type you are trying to compare Void to?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5158149"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1518825062, "post_id": 48836429, "comment_id": 84677749, "body": "@amalloy Empty type is also initial object <a href=\"https://wiki.haskell.org/Hask\" rel=\"nofollow noreferrer\">wiki.haskell.org/Hask</a>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1518826064, "post_id": 48836429, "comment_id": 84677992, "body": "The <code>Empty</code> considered on that page is the same as the <code>Void</code> from Data.Void."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1518831781, "post_id": 48836429, "comment_id": 84679000, "body": "The section mentioning <code>Empty</code> was added to that Wiki page in 2012. <code>Data.Void</code> was only added to <i>base</i> in 2015. I guess that if that page were written today the author would have used <code>Void</code> instead."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1518854561, "post_id": 48836429, "comment_id": 84682690, "body": "That is not the definition of <code>absurd</code>. The real definition is <code>absurd x = case x of</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518858873, "post_id": 48836429, "comment_id": 84683566, "body": "@dfeuer I concur. More precisely, I believe it is <code>absurd x = case x of {}</code>, since otherwise GHC tries to parse the next line(s) as if they were part of the <code>case</code>. We also need to turn on the GHC extension for empty cases."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518859123, "post_id": 48836429, "comment_id": 84683616, "body": "@Tcraft Note that the page you mention proves that <code>Empty</code> (and, implicitly <code>Void</code> which is the same) is <i>not</i> the initial object. Indeed, most categorical properties fail because of bottoms. If we ignore bottoms, then many properties do hold."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518880104, "post_id": 48836429, "comment_id": 84689487, "body": "@chi, the braces are optional. Try it yourself!"}], "owner": {"user_type": "does_not_exist", "display_name": "user5158149"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 381, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518824627, "creation_date": 1518824627, "question_id": 48836429, "link": "https://stackoverflow.com/questions/48836429/what-is-the-difference-between-empty-and-void-type-in-haskell", "title": "What is the difference between empty and void type in Haskell", "body": "<p>In <strong>Hask</strong>, <code>Void</code> (uninhabited type) is the initial object of the category:</p>\n\n<pre><code>data Void\n</code></pre>\n\n<p>The unique function is required to show that <code>Void</code> is indeed the initial object:</p>\n\n<pre><code>absurd :: Void -&gt; a\nabsurd = absurd\n</code></pre>\n\n<p>The type <code>Void</code> is not quite empty because Haskell types have <em>bottom</em>, but what is the difference between <code>Empty</code> and <code>Void</code> types?</p>\n"}, {"tags": ["haskell", "haskell-warp"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1518821415, "post_id": 48835948, "comment_id": 84676707, "body": "<code>getJSON</code> itself is not mutable like <i>any</i> <code>IO</code> object, but if you bind multiple <code>getJSON</code>s after each other, you will alter the state."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 7, "last_activity_date": 1518823055, "creation_date": 1518823055, "answer_id": 48836210, "question_id": 48835948, "link": "https://stackoverflow.com/questions/48835948/re-evaluate-constants-at-runtime-in-haskell/48836210#48836210", "title": "Re-evaluate constants at runtime in Haskell", "body": "<p>To elaborate on @Willem Van Onsem's point...</p>\n\n<p>Even though the value of <code>getJSON</code> is immutable, that immutable value is <strong>not</strong> a bytestring.  It's an immutable IO <strong>action</strong> that returns a bytestring, but that doesn't imply that it returns the same bytestring every time.  The action is an immutable constant, but that doesn't mean the bytestring is also a constant.</p>\n\n<p>This is similar to the way that:</p>\n\n<pre><code>getLine :: IO String\ngetLine = ... some immutable IO action ...\n</code></pre>\n\n<p>while itself an immutable value (an immutable IO action), can return different strings each time the action is executed.</p>\n\n<p>For example, the following self-contained program will return two different JSON bytestrings, <code>one</code> and <code>two</code> resulting from two HTTP requests, both initiated by the same <code>getJSON</code> action:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8 as B\nimport Control.Concurrent (threadDelay)\nimport Network.HTTP.Client\n\njsonURL :: String\njsonURL = \"http://time.jsontest.com\"\n\ngetJSON :: IO B.ByteString\ngetJSON = do\n  request &lt;- parseRequest jsonURL\n  manager &lt;- newManager defaultManagerSettings\n  resp &lt;- httpLbs request manager\n  return $ responseBody resp\n\nmain = do\n  one &lt;- getJSON\n  threadDelay (3*10^6)  -- delay three seconds\n  two &lt;- getJSON\n  putStrLn $ \"one was:\\n\" ++ B.unpack one ++ \"\\n\"\n  putStrLn $ \"two was:\\n\" ++ B.unpack two ++ \"\\n\"\n</code></pre>\n"}], "owner": {"reputation": 318, "user_id": 3310317, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1490518186/picture?type=large", "display_name": "SparklingWater", "link": "https://stackoverflow.com/users/3310317/sparklingwater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518823055, "creation_date": 1518821336, "question_id": 48835948, "link": "https://stackoverflow.com/questions/48835948/re-evaluate-constants-at-runtime-in-haskell", "title": "Re-evaluate constants at runtime in Haskell", "body": "<p>I am fetching this JSON use it for some computations and want to return a result, using warp as well. Now getJSON is obviously not mutable and won't change at all.\nHow can I re-evaluate getJSON on every http request? What is the cleanest way?</p>\n\n<pre><code> getJSON :: IO B.ByteString\n    getJSON = do\n                let authHeader = (\"Authorization\", token)\n                request' &lt;- parseRequest jsonURL\n                let request = request' { requestHeaders = [authHeader] }\n                manager &lt;- newManager tlsManagerSettings\n                resp &lt;- httpLbs request manager\n                return $ responseBody resp\n</code></pre>\n"}, {"tags": ["validation", "haskell", "command-line-arguments", "optparse-applicative"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518815664, "post_id": 48833162, "comment_id": 84674505, "body": "Using the monad abstraction is the correct way to go here; however, I would instead write a function of type <code>Options -&gt; Either ErrorMessage ValidatedOptions</code> (with appropriate definitions for ErrorMessage and ValidatedOptions); maybe you would want <code>.. -&gt; ErrorT IO .. ..</code> if you need to check the existance of files (but that is hardly useful; a file which exists now may not exist later - consider reading the contents of the file as part of the validation)."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518820306, "post_id": 48835376, "comment_id": 84676326, "body": "Looks really neat! I wasn&#39;t aware of <code>Errors</code> data type. Though it looks like magic at first glance... It&#39;s not even obvious to me why <code>-XApplicativeDo</code> here is not required and you still can use <code>do</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518826986, "post_id": 48835376, "comment_id": 84678187, "body": "@Shersh The  <code>do exists &lt;- ...</code> constructs a <code>IO</code> action that returns <code>Errors [String] FilePath</code>. One can construct the action is a &quot;monadic&quot; way and later compose it applicatively with other actions. The <code>Validation</code> Applicative from <a href=\"http://hackage.haskell.org/package/validation\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/validation</a> is an alternative to <code>Errors</code>. <a href=\"https://ro-che.info/articles/2015-05-02-smarter-validation\" rel=\"nofollow noreferrer\">ro-che.info/articles/2015-05-02-smarter-validation</a>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1519670065, "post_id": 48835376, "comment_id": 84995158, "body": "As it turns out, this solution is unnecessarily complicated. The maintainer of the library recommends <a href=\"https://www.reddit.com/r/haskell/comments/800ho7/validators_in_optparseapplicative/dutm4i1/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/800ho7/&hellip;</a> performing validation in the <code>ReadM</code> monad, which already provides mechanisms for notifying errors <a href=\"http://hackage.haskell.org/package/optparse-applicative-0.14.2.0/docs/Options-Applicative.html#t:ReadM\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/optparse-applicative-0.14.2.0/do&zwnj;&#8203;cs/&hellip;</a>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1519728193, "post_id": 48835376, "comment_id": 85017877, "body": "<code>ReadM</code> is a pure monad: <code>newtype ReadM a = ReadM { unReadM :: ReaderT String (Except ParseError) a }</code>. I can&#39;t check for file existence for example inside this monad."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1518881592, "last_edit_date": 1518881592, "creation_date": 1518817905, "answer_id": 48835376, "question_id": 48833162, "link": "https://stackoverflow.com/questions/48833162/programming-pattern-or-library-i-e-idiomatic-way-to-handle-cli-arguments-sema/48835376#48835376", "title": "Programming pattern or library (i.e. idiomatic way) to handle CLI arguments semantic errors?", "body": "<p>Instead of validating the options record <em>after</em> it has been constructed, perhaps we could use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\">applicative functor composition</a> to combine argument parsing and validation:</p>\n\n<pre><code>import Control.Monad\nimport Data.Functor.Compose\nimport Control.Lens ((&lt;&amp;&gt;)) -- flipped fmap\nimport Control.Applicative.Lift (runErrors,failure) -- form transformers\nimport qualified Options.Applicative as O\nimport System.Directory -- from directory\n\ndata Options = Options { path :: FilePath, count :: Int } deriving Show\n\nmain :: IO ()\nmain = do\n    let pathOption = Compose (Compose (O.argument O.str (O.metavar \"FILE\") &lt;&amp;&gt; \\file -&gt;\n            do exists &lt;- doesPathExist file\n               pure $ if exists\n                      then pure file\n                      else failure [\"Could not find file.\"]))\n        countOption = Compose (Compose (O.argument O.auto (O.metavar \"INT\") &lt;&amp;&gt; \\i -&gt;\n            do pure $ if i &lt; 10\n                      then pure i\n                      else failure [\"Incorrect number.\"]))\n        Compose (Compose parsy) = Options &lt;$&gt; pathOption &lt;*&gt; countOption\n    io &lt;- O.execParser $ O.info parsy mempty\n    errs &lt;- io\n    case runErrors errs of\n        Left msgs -&gt; print msgs\n        Right r -&gt; print r\n</code></pre>\n\n<p>The composed parser has type <code>Compose (Compose Parser IO) (Errors [String]) Options</code>. The <code>IO</code> layer is for performing file existence checks, while <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Applicative-Lift.html#t:Errors\" rel=\"nofollow noreferrer\"><code>Errors</code></a> is a validation-like Applicative from <em>transformers</em> that accumulates error messages. Running the parser produces an <code>IO</code> action that, when run, produces an <code>Errors [String] Options</code> value.</p>\n\n<p>The code is a bit verbose but those argument parsers could be packed in a library and reused.</p>\n\n<p>Some examples form the repl:</p>\n\n<pre><code>\u039b :main \"/tmp\" 2\nOptions {path = \"/tmp\", count = 2}\n\u039b :main \"/tmpx\" 2\n[\"Could not find file.\"]\n\u039b :main \"/tmpx\" 22\n[\"Could not find file.\",\"Incorrect number.\"]\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "accepted_answer_id": 48835376, "answer_count": 1, "score": 2, "last_activity_date": 1518881592, "creation_date": 1518807107, "question_id": 48833162, "link": "https://stackoverflow.com/questions/48833162/programming-pattern-or-library-i-e-idiomatic-way-to-handle-cli-arguments-sema", "title": "Programming pattern or library (i.e. idiomatic way) to handle CLI arguments semantic errors?", "body": "<p>I have a Haskell application which uses <a href=\"http://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\"><code>optparse-applicative</code></a> library for CLI arguments parsing. My data type for CLI arguments contains <code>FilePath</code>s (both files and directories), <code>Double</code>s and etc. <code>optparse-applicative</code> can handle parse errors but I want to ensure that some files and some directories exist (or don't exist), numbers are <code>&gt;= 0</code> and etc.</p>\n\n<p>What can be done is an implementation of a bunch of helper functions like these ones:</p>\n\n<pre><code>exitIfM :: IO Bool -&gt; Text -&gt; IO ()\nexitIfM predicateM errorMessage = whenM predicateM $ putTextLn errorMessage &gt;&gt; exitFailure \n\nexitIfNotM :: IO Bool -&gt; Text -&gt; IO ()\nexitIfNotM predicateM errorMessage = unlessM predicateM $ putTextLn errorMessage &gt;&gt; exitFailure \n</code></pre>\n\n<p>And then I use it like this:</p>\n\n<pre><code>body :: Options -&gt; IO ()\nbody (Options path1 path2 path3 count) = do\n    exitIfNotM (doesFileExist path1) (\"File \" &lt;&gt; (toText ledgerPath) &lt;&gt; \" does not exist\") \n    exitIfNotM (doesDirectoryExist path2) (\"Directory \" &lt;&gt; (toText skKeysPath) &lt;&gt; \" does not exist\")\n    exitIfM (doesFileExist path3) (\"File \" &lt;&gt; (toText nodeExe) &lt;&gt; \" already exist\")\n    exitIf (count &lt;= 0) (\"--counter should be positive\")\n</code></pre>\n\n<p>This looks too ad-hoc and ugly to me. Also, I need similar functionality for almost every application I write. Are there some idiomatic ways to deal with this sort of programming pattern when I want to do a bunch of checks before actually doing something with data type? The less boilerplate involved the better it is :)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6021, "user_id": 3688648, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/migGL.jpg?s=128&g=1", "display_name": "Felk", "link": "https://stackoverflow.com/users/3688648/felk"}, "edited": false, "score": 2, "creation_date": 1518801954, "post_id": 48831930, "comment_id": 84668019, "body": "You are using a dictionary in python, but a list of tuples in Haskell. Use a dictionary (called &quot;Map&quot; in Haskell) instead"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 8, "last_activity_date": 1518802341, "creation_date": 1518802341, "answer_id": 48832046, "question_id": 48831930, "link": "https://stackoverflow.com/questions/48831930/how-can-i-encode-data-to-json-using-haskell/48832046#48832046", "title": "How can I encode data to JSON using Haskell?", "body": "<p>As @felk said, use a map:</p>\n\n<pre><code>Prelude&gt; import Data.Aeson\nPrelude Data.Aeson&gt; import Data.Map\nPrelude Data.Aeson Data.Map&gt; myData = fromList [(\"name\", \"Jono\"), (\"age\", \"36\"), (\"skill\", \"beginner\")]\nPrelude Data.Aeson Data.Map&gt; encode $ toJSON myData\n\"{\\\"age\\\":\\\"36\\\",\\\"name\\\":\\\"Jono\\\",\\\"skill\\\":\\\"beginner\\\"}\"\n...&gt; Data.ByteString.Lazy.Char8.putStrLn $ encode $ toJSON myData\n{\"age\":\"36\",\"name\":\"Jono\",\"skill\":\"beginner\"}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1518806181, "post_id": 48832277, "comment_id": 84670158, "body": "Instead of explaining why the repl escapes things, why not simply write <code>putStrLn $ encode Person {...}</code> so that the escaping is not an issue?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1518806952, "post_id": 48832277, "comment_id": 84670519, "body": "@amalloy Hiding the issue does not make the issue disappear. It just makes it more confusing when the issue that is still there rears its head again. Explaining the issue, on the other hand, is a general solution. (Or, to say it another way: why try to trick the new programmer with <code>putStrLn $ encode Person { ... }</code>? Why not simply explain what the programmer sees and what it means, so that they do not need to memorize any tricks?)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1518804449, "last_edit_date": 1518804449, "creation_date": 1518803269, "answer_id": 48832277, "question_id": 48831930, "link": "https://stackoverflow.com/questions/48831930/how-can-i-encode-data-to-json-using-haskell/48832277#48832277", "title": "How can I encode data to JSON using Haskell?", "body": "<p>Python frequently uses hashmaps as a lightweight data structure. In Haskell, data types are lightweight enough that it is idiomatic to just make one whenever you need to instead.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Data.Aeson\nimport Data.Aeson.TH\n\ndata Person = Person\n    { name :: String\n    , age :: Int\n    , skill :: String -- you should probably use a more structured type here\n    }\n\nderiveJSON defaultOptions ''Person\n</code></pre>\n\n<p>Then you can use it. No need to call <code>toJSON</code> first.</p>\n\n<pre><code>&gt; encode Person { name = \"Jono\", age = 36, skill = \"beginner\" }\n\"{\\\"name\\\":\\\"Jono\\\",\\\"age\\\":36,\\\"skill\\\":\\\"beginner\\\"}\"\n</code></pre>\n\n<p>(Don't be fooled by the extra escaping and quote marks: this is just how the repl displays string-y things to avoid ambiguity. The <code>ByteString</code> being displayed is indeed a valid JSON object.)</p>\n\n<p>This is almost identical to the example <a href=\"http://hackage.haskell.org/package/aeson-1.2.4.0/docs/Data-Aeson.html\" rel=\"noreferrer\">given at the beginning of the documentation</a>; I encourage you to read that page, as there's lots of good information there.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1518804449, "creation_date": 1518801817, "question_id": 48831930, "link": "https://stackoverflow.com/questions/48831930/how-can-i-encode-data-to-json-using-haskell", "title": "How can I encode data to JSON using Haskell?", "body": "<p>I'm a haskell beginner. In Python, I can do this: </p>\n\n<pre><code>&gt;&gt;&gt; import json\n&gt;&gt;&gt; data = {'name': 'Jono', 'age': 36, 'skill': 'beginner'}\n&gt;&gt;&gt; json.dumps(data)\n'{\"name\": \"Jono\", \"age\": 36, \"skill\": \"beginner\"}'\n</code></pre>\n\n<p>So I'm trying to do the same thing in Haskell. Here's what I've tried: </p>\n\n<pre><code>*Main Data.Aeson&gt; myData = [(\"name\", \"Jono\"), (\"age\", \"36\"), (\"skill\", \"beginner\")]\n*Main Data.Aeson&gt; toJSON myData\nArray [Array [String \"name\",String \"Jono\"],Array [String \"age\",String \"36\"],Array [String \"skill\",String \"beginner\"]]\n*Main Data.Aeson&gt; encode $ toJSON myData\n\"[[\\\"name\\\",\\\"Jono\\\"],[\\\"age\\\",\\\"36\\\"],[\\\"skill\\\",\\\"beginner\\\"]]\"\n</code></pre>\n\n<p>I can't quite get it to output JSON. How can I do that? I've looked at the Data.Aeson documentation on Hackage, but I can't make heads or tails of it.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "is_accepted": true, "score": 3, "last_activity_date": 1518801841, "creation_date": 1518801841, "answer_id": 48831934, "question_id": 48831640, "link": "https://stackoverflow.com/questions/48831640/how-to-convert-a-sqlvalue-from-hdbc-in-haskell/48831934#48831934", "title": "How to convert a SqlValue from HDBC in Haskell?", "body": "<p>The compiler is unable to infer the type of thing to print.  You can add a type annotation (as the error message suggests) to make it work:</p>\n\n<pre><code>Prelude Database.HDBC&gt; fromSql $ toSql \"test\" :: String\n\"test\"\n</code></pre>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 48831934, "answer_count": 1, "score": 1, "last_activity_date": 1518801841, "creation_date": 1518800646, "question_id": 48831640, "link": "https://stackoverflow.com/questions/48831640/how-to-convert-a-sqlvalue-from-hdbc-in-haskell", "title": "How to convert a SqlValue from HDBC in Haskell?", "body": "<p>I'm a Haskell beginner, and I can't seem to get strings from SqlValues in HDBC. In ghci: </p>\n\n<pre><code>*Main&gt; import Database.HDBC\n*Main Database.HDBC&gt; toSql \"test\"\nSqlString \"test\"\n*Main Database.HDBC&gt; fromSql $ toSql \"test\"\n\n&lt;interactive&gt;:3:1: error:\n    \u2022 Non type-variable argument\n        in the constraint: Convertible SqlValue a\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall a. Convertible SqlValue a =&gt; a\n*Main Database.HDBC&gt; :set -XFlexibleContexts\n*Main Database.HDBC&gt; fromSql $ toSql \"test\"\n\n&lt;interactive&gt;:5:1: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance [safe] Show SqlValue\n          -- Defined in \u2018Database.HDBC.SqlValue\u2019\n        instance [safe] Show SqlError\n          -- Defined in \u2018Database.HDBC.Statement\u2019\n        instance (Show b, Show a) =&gt; Show (Either a b)\n          -- Defined in \u2018Data.Either\u2019\n        ...plus 45 others\n        ...plus 184 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1518884895, "post_id": 48822986, "comment_id": 84690975, "body": "Have you checked out <a href=\"http://nbviewer.jupyter.org/github/gibiansky/IHaskell/blob/master/notebooks/IHaskell.ipynb\" rel=\"nofollow noreferrer\">IHaskell</a>?"}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518889163, "post_id": 48822986, "comment_id": 84692462, "body": "Well, I know about it and considered it too much trouble for just occasional prototyping needs. But the more I read of it, the more relevant it seems."}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1518883957, "creation_date": 1518770747, "last_edit_date": 1518883957, "question_id": 48822986, "link": "https://stackoverflow.com/questions/48822986/export-and-import-ghci-session", "title": "Export and import GHCi session", "body": "<p>Is there a way to save my current GHCi session to a file? Maybe even import it next time when I open GHCi again?</p>\n\n<p>I could probably resort to <code>head -n 42 ~/.ghc/ghci_history | tac</code> but that's kind-of hacky.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1518770761, "post_id": 48822958, "comment_id": 84649301, "body": "In that case I would remodel it such that <code>symbol :: Maybe Char</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1518772096, "post_id": 48822958, "comment_id": 84649983, "body": "Incidentally the word you&#39;re looking for in the typical description of an NFA is Transition, not Transaction."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1518772284, "last_edit_date": 1518772284, "creation_date": 1518771486, "answer_id": 48823170, "question_id": 48822958, "link": "https://stackoverflow.com/questions/48822958/pass-no-char-to-a-function-that-is-expecting-it-in-haskell/48823170#48823170", "title": "Pass no char to a function that is expecting it in Haskell", "body": "<p>Well the idea of defining a type is that every value you pass to that field is a \"member\" of that type. <code>Char</code> only contains only characters (and the empty string is <em>not</em> a character) and <code>undefined</code> (but it is advisable <em>not</em> to use <code>undefined</code> here).</p>\n\n<p>Usually in case you want to make values optional, you can use a <code>Maybe a</code> type instead, so:</p>\n\n<pre><code>data Transaction = Transaction {\n     start_state :: Int, \n     symbol :: <b>Maybe Char</b>, \n     end_state :: Int\n} deriving Show</code></pre>\n\n<p>So now we can pass two kinds of values: <code>Nothing</code> which thus should be interpreted as \"<em>no character</em>\", or <code>Just x</code>, with <code>x</code> a character, and this thus acts as a character, so in your case, that would be:</p>\n\n<pre><code>Transaction 0 <b>Nothing</b> 1</code></pre>\n\n<p><code>Maybe</code> is also an instance of <code>Functor</code>, <code>Applicative</code> and <code>Monad</code>, which should make working with <code>Maybe</code> types quite convenient (yes it can sometimes introduce some extra work, but by using <code>fmap</code>, etc. the amount of pattern matching shifting to <code>Maybe Char</code> should be rather low).</p>\n\n<blockquote>\n  <p><strong>Note</strong>: like @amalloy says, an <code>NFA</code> (and <code>DFA</code>) has <code>Transition</code>s, not <code>Transaction</code>s.</p>\n</blockquote>\n"}], "owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 48823170, "answer_count": 1, "score": 3, "last_activity_date": 1518773879, "creation_date": 1518770627, "last_edit_date": 1518773879, "question_id": 48822958, "link": "https://stackoverflow.com/questions/48822958/pass-no-char-to-a-function-that-is-expecting-it-in-haskell", "title": "Pass no char to a function that is expecting it in Haskell", "body": "<p>I am working with Haskell and I have defined the following type </p>\n\n<pre><code>--Build type Transition--\ndata Transition = Transition {\n     start_state :: Int, \n     symbol :: Char, \n     end_state :: Int\n} deriving Show\n</code></pre>\n\n<p>and I would like to be able to define the following Transition </p>\n\n<pre><code>Transition 0 '' 1 \n</code></pre>\n\n<p>which would be mean \"a transition given by no symbol\" (I need it to compute the epsilon closure of a NFA). How can I do this?\nThank you!</p>\n"}, {"tags": ["haskell", "happstack", "hdbc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1518774305, "post_id": 48820722, "comment_id": 84651258, "body": "I&#39;d recommend to read a monad tutorial. There are many in the web. <code>IO String</code> vs <code>String</code> is one of the classic &quot;common issues&quot; in Haskell. You are trying to do pretty advanced stuff (Happstack) which involves monads (and possibly monad transformers). Grasping monads will not provide the immediate solution to your specific problems, but will tell you that certain approaches like trying to convert <code>IO String</code> to <code>String</code> can not work (in a sense, a main design feature of the <code>IO</code> monad is precisely to prevent such conversion)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1518787352, "post_id": 48820722, "comment_id": 84659089, "body": "Cf. <a href=\"https://stackoverflow.com/q/11229854/2751851\"><i>How can I parse the IO String in Haskell</i></a>, <a href=\"https://stackoverflow.com/q/5948300/2751851\"><i>transforming IO String to String</i></a>, <a href=\"https://stackoverflow.com/q/35613771/2751851\"><i>Change a function to support IO String instead of String</i></a>."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1518789607, "post_id": 48822589, "comment_id": 84660512, "body": "It is perhaps worth mentioning <code>liftIO</code> (alongside, or even instead, <code>lift</code>), tying in with the OP&#39;s mention of it."}, {"owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "edited": false, "score": 0, "creation_date": 1518791654, "post_id": 48822589, "comment_id": 84661749, "body": "Thank you so much for your thorough answer.. I already tried to use <code>lift</code> before but I get this error <code>Variable not in scope:   lift :: IO String -&gt; ServerPartT IO (ServerPartT IO Response) Perhaps you meant &#39;liftM&#39; (imported from Control.Monad)</code>, and I couldn&#39;t find which package or interface I missed."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "edited": false, "score": 1, "creation_date": 1518792206, "post_id": 48822589, "comment_id": 84662091, "body": "@asp You&#39;re welcome! The module hierarchy and the package interdependencies in the case of monads and monad transformers are more complicated than they could be, due to historical reasons, but one can usually find what one seeks in <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">hayoo</a>."}, {"owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "edited": false, "score": 0, "creation_date": 1518804314, "post_id": 48822589, "comment_id": 84669220, "body": "@Kindaro I used the <code>require</code> function and it works perfectly. Thanks"}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 6, "last_activity_date": 1518792090, "last_edit_date": 1518792090, "creation_date": 1518768845, "answer_id": 48822589, "question_id": 48820722, "link": "https://stackoverflow.com/questions/48820722/how-to-use-io-string-as-an-http-response-in-happstack/48822589#48822589", "title": "How to use &quot;IO String&quot; as an HTTP response in Happstack?", "body": "<p>You have to design your <code>handlers</code> around the fact that fetching from a database is a <a href=\"https://stackoverflow.com/a/48767895/2108477\">magical action</a> that may not give you what you expect. (For example, your database may crash.) This is why its result is served as an <code>IO</code>, which is a particular case of a <strong>monad</strong>.</p>\n\n<p>A monad is a jar with a very narrow neck, so narrow even that, once you put something in there, you cannot unput it. <em>(Unless it happens to also be a <code>comonad</code>, but that's a whole another story and not the case with <code>IO</code> nor with <code>ServerPart</code>.)</em> So, you would never convert an <code>IO String</code> to a <code>String</code>. Not that you can't, but your program would become incorrect.</p>\n\n<p>Your case is kind of tricky as you have two monads at play there: <code>IO</code> and <code>ServerPart</code>. Fortunately, <code>ServerPart</code> builds upon <code>IO</code>, it is \" <em>larger</em> \" and can, in a sense, <em>absorb</em> <code>IO</code>: we can put some <code>IO</code> into a <code>ServerPart</code> and it will be a <code>ServerPart</code> still, so we may then give it to <code>simpleHTTP</code>. In <code>happstack</code>, this conversion may be done via <a href=\"http://hackage.haskell.org/package/happstack-server-7.5.0.1/docs/Happstack-Server-Monads.html#v:require\" rel=\"nofollow noreferrer\"><code>require</code></a> function, but there is a more general solution as well, involving <em>monad transformers</em> and <code>lift</code>.</p>\n\n<p>&nbsp;</p>\n\n<p>Let's take a look at the <strong>solution with <code>require</code></strong> first. Its type (simplified to our case) is:</p>\n\n<pre><code>IO (Maybe a) -&gt; (a -&gt; ServerPart r) -&gt; ServerPart r\n</code></pre>\n\n<p>\u2014 So, it takes an <code>IO</code> jar with some argument and makes it suitable for a function that lives in the <code>ServerPart</code> jar. We just have to adjust types a bit and create one <em>lambda abstraction</em>:</p>\n\n<pre><code>myFunc :: Integer -&gt; IO (Maybe String)\nmyFunc _ = return . Just $ \"A thing of beauty is a joy forever.\"\n\nhandlers :: ServerPart Response\nhandlers = require (myFunc 1) $ \\x -&gt;\n    do decodeBody (defaultBodyPolicy \"/tmp/\" 0 1000 1000)\n       msum [\n                dir \"getData\" $ ok $ toResponse x\n            ]\n\nmainFunc = simpleHTTP nullConf handlers\n</code></pre>\n\n<p>As you see, we have to make 2 modifications:</p>\n\n<ul>\n<li><p>Adjust <code>myFunc</code> so that it returns <code>Maybe</code>, as necessitated by <code>require</code>. This is a better design because <code>myFunc</code> may now fail in two ways:</p>\n\n<ul>\n<li>As a <code>Maybe</code>, it may return <code>Nothing</code>, which means <code>404</code> or the like. This is rather common a situation.</li>\n<li>As an <code>IO</code>, it may error out, which means the database crashed. Now is the time to alert the DevOps team.</li>\n</ul></li>\n<li><p>Adjust <code>handlers</code> so that <code>myFunc</code> is external to them. One may say more specifically: <em>abstract <code>myFunc</code> from <code>handlers</code></em>. This is why this syntax is called a lambda <em>abstraction</em>.</p></li>\n</ul>\n\n<p>&nbsp;</p>\n\n<p><code>require</code> is the way to deal with monads in <code>happstack</code> specifically. Generally though, this is just a case of <strong><em>transforming</em> monads</strong> into larger ones, which is done <strong>via <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a></strong>. The type of <code>lift</code> (again, simplified), is:</p>\n\n<pre><code>IO String -&gt; ServerPart String\n</code></pre>\n\n<p>So, we can just <code>lift</code> the <code>myFunc 1 :: IO String</code> value to the right monad and then compose with <code>&gt;&gt;=</code>, as usual:</p>\n\n<pre><code>myFunc :: Integer -&gt; IO String\nmyFunc _ = return $ \"Its loveliness increases,..\"\n\nhandlers :: ServerPart Response\nhandlers = lift (myFunc 1) &gt;&gt;= \\x -&gt;\n    do decodeBody (defaultBodyPolicy \"/tmp/\" 0 1000 1000)\n       msum [\n                dir \"getData\" $ ok $ toResponse x\n            ]\n\nmainFunc = simpleHTTP nullConf handlers\n</code></pre>\n\n<p>As simple as that. I used the same lambda abstraction trick again, but you may as well use <em>do-notation</em>:</p>\n\n<pre><code>myFunc :: Integer -&gt; IO String\nmyFunc _ = return $ \"...it will never pass into nothingness.\"\n\nhandlers :: ServerPart Response\nhandlers = do\n    x &lt;- lift (myFunc 1)\n    decodeBody (defaultBodyPolicy \"/tmp/\" 0 1000 1000)\n    msum [\n            dir \"getData\" $ ok $ toResponse x\n         ]\n\nmainFunc = simpleHTTP nullConf handlers\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p><strong>P.S.</strong> Returning to the story of large and small jars: you can put <code>IO</code> into <code>ServerPart</code> precisely because <code>ServerPart</code> is also <em>an <code>IO</code> monad</em> \u2014 it is an instance of the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Monad-IO-Class.html\" rel=\"nofollow noreferrer\"><code>MonadIO</code> class</a>. That means that anything you can do in <code>IO</code> you can also do in <code>ServerPart</code>, and, besides general <code>lift</code>, there is a specialized <code>liftIO</code> function that you can use everywhere I used <code>lift</code>. You are likely to meet many other monads out there that are instances of <code>MonadIO</code> as it's a handy way of structuring code in large applications.</p>\n\n<p>In your particular case, I would stick with the <code>require</code> way nevertheless because I think it's how the designers of <code>happstack</code> meant it to be done. I'm not particularly knowledgeable about <code>happstack</code> though, so I may be wrong.</p>\n\n<p>&nbsp;</p>\n\n<p>That's it. Happy hacking!</p>\n"}], "owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 48822589, "answer_count": 1, "score": 1, "last_activity_date": 1518792090, "creation_date": 1518759697, "question_id": 48820722, "link": "https://stackoverflow.com/questions/48820722/how-to-use-io-string-as-an-http-response-in-happstack", "title": "How to use &quot;IO String&quot; as an HTTP response in Happstack?", "body": "<p>I'm retrieving data from a database using HDBC, then trying to send this data to a web client using Happstack.</p>\n\n<pre><code>myFunc :: Integer -&gt; IO String\nmyFunc = ... fetch from db here ...\n\nhandlers :: ServerPart Response\nhandlers =\n    do decodeBody (defaultBodyPolicy \"/tmp/\" 0 1000 1000)\n       msum [ \n                dir \"getData\" $ ok $ toResponse $ myFunc $ toInteger 1\n            ]\n\nmainFunc = simpleHTTP nullConf handlers\n</code></pre>\n\n<p>When I build the above code I get this error:</p>\n\n<blockquote>\n  <p>No instance for (ToMessage (IO String)) arising from a use of\n  `toResponse'</p>\n</blockquote>\n\n<p><strong>What did I try ?</strong></p>\n\n<ol>\n<li>I tried to convert the <code>IO String</code> to <code>String</code> (using <code>liftIO</code> for example). </li>\n<li>I tried to find any similar questions here.</li>\n<li>I tried to find a similar example in the Happstack Crash Course.</li>\n<li>I googled all related keywords in all different combinations.</li>\n</ol>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1518753397, "post_id": 48819600, "comment_id": 84643446, "body": "I will leave &quot;why&quot; to a more philosophical answer.  As for how, you can use <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a> which takes actions in a base monad to actions in a transformer.  E.g. <code>lift (putStrLn &quot;hello&quot;)</code> will have type <code>ActionT t IO ()</code>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1518753576, "post_id": 48819600, "comment_id": 84643480, "body": "Why? Because the types are different. Why are the types different? Because they do different things. A scotty action isn&#39;t just an IO action. It&#39;s a description of an http request handler that can embed IO actions inside it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518760417, "post_id": 48819600, "comment_id": 84645105, "body": "@luqui, it&#39;s probably a better habit to use <code>liftIO</code> than to use <code>lift</code> directly here."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1518769194, "post_id": 48819600, "comment_id": 84648604, "body": "@dfeuer Why? For the same reason as it&#39;s better to use <code>map</code> if you have just<code>[a]  -- A list</code> ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1518773429, "post_id": 48819600, "comment_id": 84650739, "body": "@Kindaro, because <code>liftIO</code> will lift through any transformer stack, while <code>lift</code> only lifts one step."}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518790463, "post_id": 48819600, "comment_id": 84661007, "body": "So what I&#39;m hearing is that the scotty <code>do</code> syntax is different from a <code>main</code> do syntax in that it needs to be a certain kind of monad? So I have to get things from a base monad to a transformer monad. But how do I import <code>lift</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518799785, "post_id": 48819600, "comment_id": 84666819, "body": "@Jono, <code>import Control.Monad.Trans (lift)</code> (or <code>liftIO</code> if you want to take dfeuer&#39;s suggestion)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1518801557, "post_id": 48819600, "comment_id": 84667805, "body": "<code>do</code> is a built in concept in the Haskell language and the syntax is the same no matter the monad."}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1518751182, "creation_date": 1518751182, "question_id": 48819600, "link": "https://stackoverflow.com/questions/48819600/how-can-i-get-these-haskell-data-types-to-align", "title": "How can I get these Haskell data types to align?", "body": "<p>I'm trying to write a simple REST API in Haskell that uses Scotty. After a lot of work, <a href=\"https://github.com/JonathanReeve/corpus-db/blob/22fd44a2a31a67ab0006ed5ed5afab990ba91fc5/src/db.hs\" rel=\"nofollow noreferrer\">my database layer</a> works, and can retrieve a row from my sqlite database. And <a href=\"https://github.com/JonathanReeve/corpus-db/blob/22fd44a2a31a67ab0006ed5ed5afab990ba91fc5/src/Main.hs\" rel=\"nofollow noreferrer\">the API end</a> works, too, and I can go to localhost/api/etc and it returns JSON like it should. But I can't seem to connect all the parts. Really I don't know how Haskell data types can be converted to each other. When I try to <a href=\"https://github.com/JonathanReeve/corpus-db/blob/ca4ba9195576f830cfae1c3bdc3f0e40c0502bde/src/Main.hs\" rel=\"nofollow noreferrer\">put the two together, as in this file</a>, I can't seem to align the types correctly. The error I'm getting is: </p>\n\n<pre><code>Main.hs:41:15: error:\n    \u2022 Couldn't match type \u2018IO\u2019\n                     with \u2018Web.Scotty.Internal.Types.ActionT\n                             Data.Text.Internal.Lazy.Text IO\u2019\n      Expected type: Web.Scotty.Internal.Types.ActionT\n                       Data.Text.Internal.Lazy.Text IO Connection\n        Actual type: IO Connection\n    \u2022 In a stmt of a 'do' block: conn &lt;- connectSqlite3 db\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do { conn &lt;- connectSqlite3 db;\n              meta &lt;- getByID conn \"9.0\";\n              json meta }\u2019\n</code></pre>\n\n<p>How do I convert an <code>IO</code> to a <code>Web.Scotty.Internal.Types.ActionT Data.Text.Internal.Lazy IO Connection</code>? And also why do I have to do this? </p>\n"}, {"tags": ["haskell", "configuration", "haskell-stack", "compiler-flags"], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 2, "last_activity_date": 1518740569, "creation_date": 1518740569, "answer_id": 48818401, "question_id": 48818176, "link": "https://stackoverflow.com/questions/48818176/default-ghc-flags-with-haskell-stack/48818401#48818401", "title": "Default GHC flags with Haskell Stack", "body": "<p>Yup, I consider this to be a bug.  I have a PR that hasn't been merged yet that fixes it <a href=\"https://github.com/commercialhaskell/stack/pull/3781\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/pull/3781</a></p>\n"}], "owner": {"reputation": 2004, "user_id": 4916831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/kIpeA.jpg?s=128&g=1", "display_name": "lcmylin", "link": "https://stackoverflow.com/users/4916831/lcmylin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 48818401, "answer_count": 1, "score": 1, "last_activity_date": 1518740569, "creation_date": 1518738925, "question_id": 48818176, "link": "https://stackoverflow.com/questions/48818176/default-ghc-flags-with-haskell-stack", "title": "Default GHC flags with Haskell Stack", "body": "<p>I wanted to set some custom compiler flags for all stack-compiled packages on my machine (more aggressive optimizations than the defaults), and following the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">stack guide</a>, I added some <code>ghc-options</code> (applying to <code>\"$everything\"</code>) to my <code>~/.stack/config.yaml</code>. These flags were properly applied to <code>stack</code> invocations outside of any project directory.</p>\n\n<p>Within project directories, however, the <code>stack.yaml</code> options don't just take precedence; everything in <code>~/.stack/config.yaml</code> is completely ignored! I have no <code>ghc-options</code> specified in any project-local <code>stack.yaml</code> files, but those specified <code>~/.stack/config.yaml</code> have no effect.</p>\n\n<p>The <a href=\"https://docs.haskellstack.org/en/stable/architecture/#configuration\" rel=\"nofollow noreferrer\"><code>stack</code> documentation</a> would seem to suggest that options should collapse, as I had expected them to:</p>\n\n<blockquote>\n  <p>stack has two layers of configuration: project and non-project. All of these are stored in stack.yaml files, but the former has extra fields (resolver, packages, extra-deps, and flags). <strong>The latter can be monoidally combined so that a system config file provides defaults, which a user can override with ~/.stack/config.yaml, and a project can further customize.</strong></p>\n</blockquote>\n\n<p>Unless I have a very different idea of what \"customize\" means, this isn't the behavior I'm observing. Is there something I'm doing incorrectly, or is the documentation misleading in this respect?</p>\n"}, {"tags": ["haskell", "ghc"], "owner": {"reputation": 31, "user_id": 9362960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4098416e087eb4b76b14c115694911f5?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Dougherty", "link": "https://stackoverflow.com/users/9362960/patrick-dougherty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1518732774, "creation_date": 1518732774, "question_id": 48817158, "link": "https://stackoverflow.com/questions/48817158/inconsistent-allocation-with-rtsstats", "title": "Inconsistent allocation with RTSStats", "body": "<p>I'm working on measuring function allocation, and I'm running into some behavior that I don't quite understand. Here's a simple reproduction of it:</p>\n\n<pre><code>module Main where\n\nimport GHC.Stats (GCDetails(..), RTSStats(..), getRTSStats)\nimport System.Mem (performGC)\n\nmain :: IO ()\nmain = loop 100\n  where\n    loop 0 = return ()\n    loop n = runOtherThing n &gt;&gt; loop (n-1)\n\nrunOtherThing :: Int -&gt; IO ()\nrunOtherThing n = do\n    performGC\n    stats &lt;- getRTSStats\n    putStrLn $ show (n `mod` 15) ++ \": \"\n            ++ show (gcdetails_allocated_bytes (gc stats))\n            ++ \" num: \" ++ show (gcs stats)\n    --putStrLn \"inflate allocation\"\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>$ ghc Main.hs\n$ ./Main +RTS -s\n...\n14: 4648 num: 12\n13: 4744 num: 13\n12: 4744 num: 14\n11: 4744 num: 15\n10: 4744 num: 16\n9: 8704 num: 17\n8: 4648 num: 18\n7: 4648 num: 19\n6: 4648 num: 20\n5: 4648 num: 21\n4: 4648 num: 22\n3: 4648 num: 23\n2: 4648 num: 24\n1: 4648 num: 25\n0: 4648 num: 26\n14: 4648 num: 27\n13: 4744 num: 28\n12: 4744 num: 29\n11: 4744 num: 30\n10: 4744 num: 31\n9: 8704 num: 32\n8: 4648 num: 33\n7: 4648 num: 34\n6: 4648 num: 35\n5: 4648 num: 36\n4: 4648 num: 37\n3: 4648 num: 38\n2: 4648 num: 39\n1: 4648 num: 40\n0: 4648 num: 41\n...\n</code></pre>\n\n<p>I'm using 8.2.1 and the new-ish <code>RTSStats</code>, but it applies to the old <code>GCStats</code> as well.</p>\n\n<p>Every 15 GC's, an extra ~4k bytes (perhaps a page?) are allocated. The number on the left is the loop number <code>mod</code> 15 so you don't have to count, just look for the lines that start with <code>9</code> in my output. On the right is the total number of GC's performed by the program which shows that we aren't missing data from any.</p>\n\n<p>I've made lots of changes and the number always sticks exactly to 15. You can uncomment the <code>inflate allocation</code> line, which does what it says. The extra 4k bytes is still reported. Even if you add multiple lines inflating the allocation it doesn't change.</p>\n\n<p>That makes me believe the extra bytes are independent of my code. Or at the very least, not being triggered by me allocating data.</p>\n\n<p>I don't really know what to make of this. For the purposes of measuring allocation, I could probably develop a reasonable strategy for detecting and removing these data points. But is it possible to avoid this altogether? And what is it about 15?</p>\n"}, {"tags": ["haskell", "irc"], "answers": [{"comments": [{"owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "edited": false, "score": 0, "creation_date": 1518734658, "post_id": 48817420, "comment_id": 84639009, "body": "Haha yes, that was me. I tried with multiple different servers and each time I receive the same message. Could it be something unique to Amazon Web Services which I and trying it through?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "edited": false, "score": 0, "creation_date": 1518735368, "post_id": 48817420, "comment_id": 84639241, "body": "Yup, I added an update -- it looks like that&#39;s the problem."}, {"owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "edited": false, "score": 0, "creation_date": 1518735462, "post_id": 48817420, "comment_id": 84639274, "body": "Do you know how to implement SASL with Haskell? I don&#39;t mind learning about it."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "edited": false, "score": 0, "creation_date": 1518735785, "post_id": 48817420, "comment_id": 84639381, "body": "There are <code>sasl</code> and <code>gsasl</code> packages, but neither looks to be in very good shape."}, {"owner": {"reputation": 12819, "user_id": 845414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fbe63f77ce3f9656c62b27db4d8583b?s=128&d=identicon&r=PG", "display_name": "Johannes Kuhn", "link": "https://stackoverflow.com/users/845414/johannes-kuhn"}, "edited": false, "score": 1, "creation_date": 1522210132, "post_id": 48817420, "comment_id": 86057593, "body": "You don&#39;t really need SASL here. IRC uses PLAIN, which is just <code>username + &quot;\\0&quot; + password</code> encoded as base64. To implement SASL, you have to send <code>CAP LS</code> before the initial <code>USER</code> command, and then a <code>CAP REQ :sasl</code> when you receive <code>CAP * LS :... sasl ...</code> line, after that you send <code>AUTHENTICATE base64(username+\\0+password)</code> and finally a <code>CAP END</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1518735356, "last_edit_date": 1518735356, "creation_date": 1518734131, "answer_id": 48817420, "question_id": 48816235, "link": "https://stackoverflow.com/questions/48816235/no-ident-response-and-notice-you-need-to-identify-via-sasl-to-use-this-ser/48817420#48817420", "title": "&#39;No Ident response&quot; and &quot;Notice -- You need to identify via SASL to use this server&quot; when attempting to connect to IRC with Roll Your Own Haskell Bot", "body": "<p>The <code>No Ident Response</code> notice refers to an hilariously antiqued protocol from the depths of Internet history.  In the olden days, when multi-user Unix machines were the rule rather than the exception, sometimes a server wanted to get some information on the specific user on the connecting client who had initiated the connection. The <a href=\"https://en.wikipedia.org/wiki/Ident_protocol\" rel=\"nofollow noreferrer\">Ident protocol</a> was created for this purpose.  I guess IRC servers still contain code to try to query Ident servers, but they probably receive vanishingly few responses, so you can probably ignore this error.</p>\n\n<p>The SASL error is more serious.  It suggests that the specific IRC server you're connecting to has been configured to require user identification and authentication via the SASL protocol before allowing a connection.  You probably don't want the added complexity of adding SASL support to your bot!</p>\n\n<p>However, I'm not able to duplicate your problem.  When I run the code you've posted above, I connect to host <code>kornbluth.freenode.net [2001:1bc0:c1::6667/6667]</code>, see the notice about <code>No Ident response</code>, but my connection is accepted, as are the commands to set my nickname and join the <code>#tutbot-testing</code> channel, and I see the message of the day.  I also see messages from some poor soul (maybe you?) asking for help with his or her bot, but I can't respond because the tutbot code above can't send any commands!</p>\n\n<p>Is it possible you were testing it using a difference <code>server</code> or <code>nick</code> than the one in the code above, and that's caused the problem?  If not, it's possible that there's a specific \"irc.freenode.org\" server that's configured to require SASL while the rest are working fine.  Try switching the server name to:</p>\n\n<pre><code>server = \"kornbluth.freenode.net\"\n</code></pre>\n\n<p>That seemed to work for me.</p>\n\n<p><strong>Update:</strong>  It looks like freenode requires SASL authentication from Amazon Web Services IP addresses (as noted in this <a href=\"https://github.com/StackStorm-Exchange/stackstorm-irc/issues/1\" rel=\"nofollow noreferrer\">bug report for an IRC client</a>), so that would explain the problem you're having.</p>\n"}], "owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 48817420, "answer_count": 1, "score": 0, "last_activity_date": 1518735356, "creation_date": 1518728631, "question_id": 48816235, "link": "https://stackoverflow.com/questions/48816235/no-ident-response-and-notice-you-need-to-identify-via-sasl-to-use-this-ser", "title": "&#39;No Ident response&quot; and &quot;Notice -- You need to identify via SASL to use this server&quot; when attempting to connect to IRC with Roll Your Own Haskell Bot", "body": "<p>I am using <a href=\"https://wiki.haskell.org/Roll_your_own_IRC_bot\" rel=\"nofollow noreferrer\">Roll Your Own IRC Bot</a> on the Haskell wiki and I receive those two errors when running the code provided by the guide.</p>\n\n<p>What is wrong? Why can't I connect?</p>\n\n<p>I am using Ubuntu and I've tried compiling it with ghc and running it with ghci.</p>\n\n<pre><code>import Network\nimport System.IO\nimport Text.Printf\n\nserver = \"irc.freenode.org\"\nport   = 6667\nchan   = \"#tutbot-testing\"\nnick   = \"tutbot\"\n\nmain = do\n    h &lt;- connectTo server (PortNumber (fromIntegral port))\n    hSetBuffering h NoBuffering\n    write h \"NICK\" nick\n    write h \"USER\" (nick++\" 0 * :tutorial bot\")\n    write h \"JOIN\" chan\n    listen h\n\nwrite :: Handle -&gt; String -&gt; String -&gt; IO ()\nwrite h s t = do\n    hPrintf h \"%s %s\\r\\n\" s t\n    printf    \"&gt; %s %s\\n\" s t\n\nlisten :: Handle -&gt; IO ()\nlisten h = forever $ do\n    s &lt;- hGetLine h\n    putStrLn s\n  where\n    forever a = do a; forever a\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1518720681, "post_id": 48813929, "comment_id": 84632311, "body": "As chi said, <code>DuplicateRecordFields</code> is not up to any nontrivial disambiguation. IMO this extension should never be used \u2013 either use plain Haskell98 with explicit module quantifiers, or ad-hoc type classes such as <a href=\"http://hackage.haskell.org/package/lens-4.16/docs/Control-Lens-TH.html#v:makeFields\" rel=\"nofollow noreferrer\">lens&#39; <code>makeFields</code></a> generates. When <code>OverloadedRecordFields</code> is up running, the record problem will be largely solved; until then, don&#39;t fray the language with unidiomatic stuff like <code>DuplicateRecordFields</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1518742237, "post_id": 48813929, "comment_id": 84641084, "body": "just for completeness&#39; sake - <a href=\"https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0002-overloaded-record-fields.rst\" rel=\"nofollow noreferrer\">here</a> is the proposal for <code>OverloadedRecordFields</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2721, "user_id": 22582, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4eb6db2a6ff418cd2f1617c0415e565?s=128&d=identicon&r=PG", "display_name": "Dacto", "link": "https://stackoverflow.com/users/22582/dacto"}, "edited": false, "score": 0, "creation_date": 1518720485, "post_id": 48814127, "comment_id": 84632210, "body": "Using type annotation is what I resorted to. Kind of disappointing."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1518720220, "last_edit_date": 1518720220, "creation_date": 1518719775, "answer_id": 48814127, "question_id": 48813929, "link": "https://stackoverflow.com/questions/48813929/duplicaterecordfields-and-function-composition/48814127#48814127", "title": "DuplicateRecordFields and Function Composition", "body": "<p>I think the extension is too fragile, unfortunately. </p>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>However, we do not infer the type of the argument to determine the datatype, or have any way of deferring the choice to the constraint solver.</p>\n</blockquote>\n\n<p>In <code>f = not . x</code> the type of the argument of <code>x</code> must be inferred, exploiting the type of <code>(.)</code> and of <code>f</code> (which is provided).</p>\n\n<p>Disambiguating is cumbersome. One has to write</p>\n\n<pre><code>f = not . (x :: A -&gt; Bool)\n</code></pre>\n\n<p>or, with <code>PartialTypeSignatures</code> on, (&amp; silencing the warning)</p>\n\n<pre><code>f = not . (x :: A -&gt; _)\n</code></pre>\n\n<p>Neither is convenient.</p>\n"}], "owner": {"reputation": 2721, "user_id": 22582, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4eb6db2a6ff418cd2f1617c0415e565?s=128&d=identicon&r=PG", "display_name": "Dacto", "link": "https://stackoverflow.com/users/22582/dacto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 48814127, "answer_count": 1, "score": 2, "last_activity_date": 1518720220, "creation_date": 1518718961, "question_id": 48813929, "link": "https://stackoverflow.com/questions/48813929/duplicaterecordfields-and-function-composition", "title": "DuplicateRecordFields and Function Composition", "body": "<p>According to <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/DuplicateRecordFields#Selectorfunctions\" rel=\"nofollow noreferrer\">DuplicateRecordFields</a> \"we can use the type being pushed in to the occurrence of the selector, or a type signature on its argument, to determine the datatype that is meant\".</p>\n\n<p>So, the following works<sup><a href=\"https://gist.github.com/tfausak/e99c867e18f908fb41f29de54bc3501f\" rel=\"nofollow noreferrer\">1</a></sup>:\n</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\nmodule Records where\n\ndata A = A { x :: Bool }\ndata B = B { x :: Int }\n\nf :: A -&gt; Bool\nf = x\n</code></pre>\n\n<p>But this doesn't:\n</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\nmodule Records where\n\ndata A = A { x :: Bool }\ndata B = B { x :: Int }\n\nf :: A -&gt; Bool\nf = not . x\n\n{-\n  duprecords.hs:9:11: error:\n      Ambiguous occurrence `x'\n      It could refer to either the field `x',\n                               defined at duprecords.hs:6:14\n                            or the field `x',\n                               defined at duprecords.hs:5:14\n-}\n</code></pre>\n\n<p>Why does this break when using a function with the record field? I thought it would still be disambiguated by the function type.</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 3, "last_activity_date": 1518712819, "creation_date": 1518712819, "answer_id": 48812183, "question_id": 48811247, "link": "https://stackoverflow.com/questions/48811247/aeson-error-building-test-yesod-sqlite-project/48812183#48812183", "title": "Aeson error building test yesod-sqlite project", "body": "<p>If you run <code>stack exec -- stack --version</code> I bet you will find that it is older than 1.6.3.  You should probably delete the stack binary at <code>stack exec -- which stack</code></p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4705899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac1e2ec1928c1e73d8beb7110372477?s=128&d=identicon&r=PG&f=1", "display_name": "SaadRhoulam", "link": "https://stackoverflow.com/users/4705899/saadrhoulam"}, "is_accepted": false, "score": 2, "last_activity_date": 1519169024, "creation_date": 1519169024, "answer_id": 48895815, "question_id": 48811247, "link": "https://stackoverflow.com/questions/48811247/aeson-error-building-test-yesod-sqlite-project/48895815#48895815", "title": "Aeson error building test yesod-sqlite project", "body": "<p>mgsloan's assessment of the cause is correct, at least in my case.</p>\n\n<p>Solution-wise, I'm guessing deleting the stack binary forces it to upgrade. For those who are hesitant to delete stack, <code>stack upgrade</code> did the trick for me.</p>\n"}], "owner": {"reputation": 1818, "user_id": 589352, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ba318b431c968c4883f4f365d989abea?s=128&d=identicon&r=PG", "display_name": "jaybee", "link": "https://stackoverflow.com/users/589352/jaybee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1519169024, "creation_date": 1518710027, "last_edit_date": 1518710472, "question_id": 48811247, "link": "https://stackoverflow.com/questions/48811247/aeson-error-building-test-yesod-sqlite-project", "title": "Aeson error building test yesod-sqlite project", "body": "<p>I'm new to yesod and just trying to use stack to build one or two basic sites from the templates but I get an Aeson error when I do. There is a discussion of the error message here [0] but it is apparently fixed in 1.6.1 and I'm using 1.6.3. This is what I'm trying:</p>\n\n<pre><code>$ stack --version\nVersion 1.6.3\n$ stack new yesod-project yesod-sqlite\nDownloading template \"yesod-sqlite\" to create project \"yesod-project\" in    yesod-project/ ...\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- yesod-project/\n\nSelecting the best among 12 snapshots...\n\n* Matches lts-10.5\n\nSelected resolver: lts-10.5\nInitialising configuration using resolver: lts-10.5\nTotal number of user packages considered: 1\nWriting configuration to file: yesod-project/stack.yaml\nAll done.\n$ cd yesod-project/\n$ stack build\n$ stack exec -- yesod devel\nYesod devel server. Enter 'quit' or hit Ctrl-C to quit.\nApplication can be accessed at:\n\nhttp://localhost:3000\nhttps://localhost:3443\nIf you wish to test https capabilities, you should set the following variable:\nexport APPROOT=https://localhost:3443\n\nDownloading lts-10.5 build plan ...\nDownloaded lts-10.5 build plan.\nAesonException \"Error in $.packages.cassava.constraints.flags['bytestring--lt-0_10_4']: Invalid flag   name: \\\"bytestring--lt-0_10_4\\\"\"\nType help for available commands. Press enter to force a rebuild.\n</code></pre>\n\n<p>[0] <a href=\"https://github.com/commercialhaskell/stack/issues/3634\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/3634</a></p>\n"}, {"tags": ["parsing", "haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1518711975, "post_id": 48810829, "comment_id": 84627226, "body": "Hint: your parser is monadic. It can pick different effects based on values produced. Try writing <code>succeeded :: Parser e s a -&gt; Parser e s Bool</code> in terms of <code>option</code>, and then using monadic binding to branch on the result of that."}, {"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518734974, "post_id": 48810829, "comment_id": 84639130, "body": "Thanks! I like this decomposition. Assuming I didn&#39;t have the <code>(t&#39; -&gt; e)</code> for producing the error, I see how I could use it: <code>do { result &lt;- parser; state &lt;- get; didSucceed &lt;- succeeded shouldFail; if didSucceed then put state &gt;&gt; throwError onUnexpected else put state &gt;&gt; return result }</code> (however I&#39;m still not sure I understand how the <code>get</code> isn&#39;t just lazily evaluated after <code>shouldFail</code>? I can see how <code>succeeded</code> probably shouldn&#39;t modify the state but even if I push the state restoration into it, I still have the lazy issue I think)."}, {"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518738646, "post_id": 48810829, "comment_id": 84640215, "body": "If <code>succeeded</code> did not effect the state, then I could use it like <code>notFollowedBy = do { result &lt;- parser; didSucceed &lt;- succeeded shouldFail; if didSucceed then throwError onUnexpected else return result }</code>. For implementing, <code>succeeded</code> I think I got it: <code>succeeded p = do { state &lt;- get; result &lt;- (p &gt;&gt; return True) `option` (return False); put state; return result }</code>. I still am unsure how that preserves the state, but I think it works so thank you! If there&#39;s a better way please let me know. Feel free to copy &amp; paste that as an answer and I&#39;ll give you the green checkmark!"}], "owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518708812, "creation_date": 1518708812, "question_id": 48810829, "link": "https://stackoverflow.com/questions/48810829/negative-lookahead-in-a-monadic-parser", "title": "Negative Lookahead in a Monadic Parser", "body": "<p>I have a monadic parser that I'm implementing as an exercise. Its signature looks like this:</p>\n\n<pre><code>type Parser err src target = ExceptT err (State [src]) target\n</code></pre>\n\n<p>I've already implemented many basic helpers, but I've come across a use case where a negative lookahead is necessary. In particular, I think I'd like to make something of this signature:</p>\n\n<pre><code>notFollowedBy :: e -&gt; Parser e s t -&gt; Parser e s t' -&gt; Parser e s t\nnotFollowedBy followedByError parser shouldFail = -- ...\n</code></pre>\n\n<p>My thought is that it can be used in context like this:</p>\n\n<pre><code>foo = letter `notFollowedBy'` digit\n    where notFollowedBy' = notFollowedBy FollwedByDigitError\n</code></pre>\n\n<p>I'm stumbling to implement <code>notFollowedBy</code>, though for a variety of reasons:</p>\n\n<ul>\n<li>I need a way to run <code>shouldFail</code> such that I can invert its ExceptT result (ie. if it throws I want to catch it and do nothing, but if it doesn't throw I need to throw <code>notFollowedByError</code>)\n\n<ul>\n<li><code>catchError</code> won't do here (I don't think) and I couldn't figure out a way to use <code>runExceptT</code> to get the <code>Either e t'</code> from <code>shouldFail</code></li>\n</ul></li>\n<li>Before I run <code>shouldFail</code> I need to save the state from <code>StateT</code> because after running <code>shouldFail</code> I need to restore the state (as if this parser wasn't run). But I'm using the Lazy <code>StateT</code>, so it's unclear if I need to switch everything to the strict one just to allow for this case</li>\n</ul>\n\n<p>My best stab doesn't even compile, but it looks like this:</p>\n\n<pre><code>notFollowedBy :: (t' -&gt; e) -&gt; Parser e s t -&gt; Parser e s t' -&gt; Parser e s t\nnotFollowedBy onUnexpected parser shouldFail = do\n  parsed &lt;- parser\n  state &lt;- get -- This isn't strict\n  result &lt;- runExceptT shouldFail -- This doesn't typecheck\n  case result of\n    Left err -&gt; put state &gt;&gt; return parsed\n    Right t -&gt; put state &gt;&gt; throwError $ onUnexpected t\n</code></pre>\n\n<p>(As an implementation note, the first parameter is actually <code>(t' -&gt; e)</code>, because I want to allow customizing the error thrown based on information returned by the second parser. But I don't think that matters for my question.)</p>\n\n<p>The typecheck failure is due to it expecting <code>ExceptT (ExceptT e (State [s])) t</code> but getting <code>Parser e s t</code> (which is <code>ExceptT e (State [s]) t</code>).</p>\n\n<p>After pouring over the docs and reading some of the source for ExceptT and StateT, my best guess is that I need to emulate <code>catchError</code> (which matches on an <code>Either</code>) and then use <code>liftCatch</code>. This is my sloppy stab at that (which also doesn't compile):</p>\n\n<pre><code>notFollowedBy :: (t' -&gt; e) -&gt; Parser e s t -&gt; Parser e s t' -&gt; Parser e s t\nnotFollowedBy onUnexpected parser shouldFail = do\n    state &lt;- get\n    result &lt;- parser\n    catchSuccess' result shouldFail (throwError . onUnexpected)\n    put state\n    return result\n  where catchSuccess' result = liftCatch (catchSuccess result)\n        catchSuccess r (Left l) _ = Right r\n        catchSuccess _ (Right r) h = Left (h r)\n</code></pre>\n\n<p>The typechecker seems to be unhappy about a lot of things the second time around. In particular, it seems like <code>liftCatch</code> (from <code>State.Lazy</code>) is not what we want (because it expects <code>catchSuccess'</code> to return an <code>ExceptT</code>).</p>\n\n<p>At this point I'm just flailing around making random permutations trying to appease the compiler. Can anyone offer any suggestions about how I could implement <code>notFollowedBy</code>?</p>\n\n<p><strong>edit:</strong> After consulting how I implemented <code>optional</code> (below), it seems like the state ordering is not an issue (although how that is is a mystery to me). So my primary issue then is creating the reverse of <code>catchError</code> (<code>catchSuccessAndSuppressError</code>).</p>\n\n<pre><code>option :: Parser e s t -&gt; Parser e s t -&gt; Parser e s t\noption parserA parserB = do\n  state &lt;- get\n  parserA `catchError` \\_ -&gt; put state &gt;&gt; parserB\n</code></pre>\n\n<h2>tl;dr</h2>\n\n<p>I'm trying to write a function with this signature that throws <code>followedByError</code> when <code>shouldFail</code> does not throw an exception (when run after running <code>parser</code>). The state upon return should be the same as the state after <code>parser</code> is run.</p>\n\n<pre><code>type Parser err src target = ExceptT err (State [src]) target\n\nnotFollowedBy :: e -&gt; Parser e s t -&gt; Parser e s t' -&gt; Parser e s t\nnotFollowedBy followedByError parser shouldFail = -- ...\n</code></pre>\n"}, {"tags": ["haskell", "generics", "types"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518757783, "post_id": 48812898, "comment_id": 84644369, "body": "Yes, but with a <code>Natty</code>, you actually have all the evidence you need. See my answer."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1518761763, "post_id": 48812898, "comment_id": 84645598, "body": "@dfeuer Interesting! You still end up having to traverse the whole <code>Natty</code> at runtime, but the problem is sliced differently. The <code>App</code> pattern looks new - I haven&#39;t seen it before."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518773545, "post_id": 48812898, "comment_id": 84650814, "body": "it came in with <code>Type.Reflection</code> in GHC 8.2. The whole <code>Typeable</code> situation is much less unsatisfactory now."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1518715192, "creation_date": 1518715192, "answer_id": 48812898, "question_id": 48810721, "link": "https://stackoverflow.com/questions/48810721/generic-types-with-type-reflection-and-nats/48812898#48812898", "title": "Generic types with Type.Reflection and Nats", "body": "<p>Adding <code>Typeable n</code> reflects the fact that GHC will need to pass in a different <code>Typeable</code> dictionary into <code>boo</code> if it is called with <code>n</code> instantiated differently.</p>\n\n<p>There is some cleverness around the interplay of <code>Typeable</code> and <code>DataKinds</code>. The instances that GHC derives are roughly equivalent to</p>\n\n<pre><code>instance Typeable Nat where ...\ninstance Typeable 'Zero where ...\ninstance Typeable n =&gt; Typeable ('Suc n) where ...\n</code></pre>\n\n<p>The <code>Typeable n</code> constraint you are being prompted to add in will not be filled in by the <code>Typeable Nat</code> instance (remember <code>n</code> has kind <code>Nat</code>, not <code>*</code>!), but by the latter two constraints.</p>\n\n<p>But, I can hear you saying, why can't GHC figure out by simple induction on those two instances that all <code>n :: Nat</code> are <code>Typeable</code>? Because <code>'Zero</code> and <code>'Suc</code> are not the only way of making something of kind <code>Nat</code>...</p>\n\n<pre><code>ghci&gt; type family Stuck :: k\nghci&gt; :kind Natty Stuck          -- a valid type!\nNatty Stuck :: *\n</code></pre>\n\n<p>In other words, GHC can't know at compile time that <code>n :: Nat</code> is <code>Typeable</code>, you need to pass it a runtime witness of this fact.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1518758771, "last_edit_date": 1518758771, "creation_date": 1518749962, "answer_id": 48819459, "question_id": 48810721, "link": "https://stackoverflow.com/questions/48810721/generic-types-with-type-reflection-and-nats/48819459#48819459", "title": "Generic types with Type.Reflection and Nats", "body": "<p>You can implement the function you want, but not for free.</p>\n\n<pre><code>boof :: Natty n -&gt; TypeRep n\nboof Zy = typeRep\nboof (Sy n) = withTypeable (boof n) typeRep\n</code></pre>\n\n<p>More explicitly (this is basically what happens under the hood in <code>boof</code>):</p>\n\n<pre><code>goo :: Natty n -&gt; TypeRep n\ngoo Zy = typeRep @'Zero\ngoo (Sy n) = App (typeRep @'Suc) (goo n)\n</code></pre>\n\n<p>As <code>goo</code> shows, the structure of the <code>TypeRep</code> is actually very similar to the structure of the <code>Natty</code>. Indeed, you can go the other way too, although you can't convince the pattern checker that it's total:</p>\n\n<pre><code>hum :: TypeRep n -&gt; Natty n\nhum (App s n)\n  | Just HRefl &lt;- eqTypeRep s (typeRep @'S) = Sy (hum n)\n  | otherwise = error \"imp possible\"\nhum z\n  | Just HRefl &lt;- eqTypeRep z (typeRep @'Z) = Zy\n  | otherwise = error \"impposs ible\"\n</code></pre>\n\n<hr>\n\n<p>You can wrap up the result as you wish:</p>\n\n<pre><code>boo :: Natty n -&gt; SomeTypeRep\nboo n = SomeTypeRep (boof n)\n</code></pre>\n\n<p>But it seems likely that you should use something a bit more specific than <code>SomeTypeRep</code>. The <code>Typeable</code> internals actually use this:</p>\n\n<pre><code>data SomeKindedTypeRep k where\n  SomeKindedTypeRep :: forall (x :: k). Typeable x =&gt; SomeKindedTypeRep k\n</code></pre>\n\n<p>You can define that and use <code>SomeKindedTypeRep Nat</code>, or define a specialized version just for <code>Nat</code>. That way you don't lose track of the kind (known at compile time) just because you're intentionally forgetting the type.</p>\n"}], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1518758771, "creation_date": 1518708440, "last_edit_date": 1518708546, "question_id": 48810721, "link": "https://stackoverflow.com/questions/48810721/generic-types-with-type-reflection-and-nats", "title": "Generic types with Type.Reflection and Nats", "body": "<p>I have a simple definition for a Nat and a definition for types indexed by Nat's, Natty.</p>\n\n<pre><code>data Nat :: * where \n    Zero :: Nat\n    Suc  :: Nat -&gt; Nat              deriving(Show, Typeable)\n\ndata Natty :: Nat -&gt; * where\n    Zy :: Natty Zero\n    Sy :: Natty n -&gt; Natty (Suc n)  deriving Typeable\n</code></pre>\n\n<p>I want to  store and manipulate these Natty's in a generic fashion with the use of the Type.Reflection module.</p>\n\n<p>Storing as a Nat as a type rep works fine. </p>\n\n<pre><code>foo :: Nat -&gt; SomeTypeRep\nfoo x = SomeTypeRep (typeOf x)\n</code></pre>\n\n<p>But storing a Natty as a type rep doesn't work unless extra constraints are added.</p>\n\n<pre><code>boo :: Natty n -&gt; SomeTypeRep\nboo x = SomeTypeRep (typeOf x)\n</code></pre>\n\n<p>boo produces the following error:</p>\n\n<pre><code>No instance for (Typeable n) arising from the use of 'typeOf'\n</code></pre>\n\n<p><strong>My question is why can Haskell not recognise that n is a nat and should therefore be Typeable?</strong></p>\n\n<p>Like I said I can fix this issue by adding the constraint of Typeable n to the beginning of boo but when I'm using a function that returns natty in the middle of another function its not that simple. </p>\n\n<p>The following extensions and imports have been used.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, GADTs #-} \nimport Type.Reflection\n</code></pre>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1518705694, "post_id": 48809736, "comment_id": 84622904, "body": "What&#39;s the exact error?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518708355, "post_id": 48809736, "comment_id": 84624751, "body": "Your implementation is close to correct. It uses an unnecessary case but that&#39;s probably fine; But it has wrong parentheses placement and some missing function parameters."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518719049, "post_id": 48809736, "comment_id": 84631415, "body": "Do you understand the <code>Functor</code> instance for the regular list? Your type is isomorphic to it, so <code>fmap</code> is really just <code>map</code> adapted to your constructor names."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 7795056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73027687e2c21e51c06f4029fccffe68?s=128&d=identicon&r=PG&f=1", "display_name": "Nightfall", "link": "https://stackoverflow.com/users/7795056/nightfall"}, "edited": false, "score": 0, "creation_date": 1518706730, "post_id": 48810053, "comment_id": 84623668, "body": "Thank you for your response  i have added {-# LANGUAGE DerivingFunctor #-} it works thank you for the information."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 107, "user_id": 7795056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73027687e2c21e51c06f4029fccffe68?s=128&d=identicon&r=PG&f=1", "display_name": "Nightfall", "link": "https://stackoverflow.com/users/7795056/nightfall"}, "edited": false, "score": 0, "creation_date": 1518707152, "post_id": 48810053, "comment_id": 84623934, "body": "Well, but it would be more instructive if you still tried to fix your own implementation. These are really important basics."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1518706398, "creation_date": 1518706398, "answer_id": 48810053, "question_id": 48809736, "link": "https://stackoverflow.com/questions/48809736/recursive-functor-instance-in-haskell/48810053#48810053", "title": "Recursive functor instance in haskell", "body": "<p>There are two ways you can make a class-instance for some type: <strong>either</strong></p>\n\n<ul>\n<li><p>Use a <code>deriving</code> clause. This only works for simple classes where there's <em>one obvious way</em> to define the instance's methods. <a href=\"https://www.haskell.org/onlinereport/derived.html\" rel=\"nofollow noreferrer\">In Haskell98, these classes were only <code>Eq</code>, <code>Ord</code>, <code>Enum</code>, <code>Bounded</code>, <code>Show</code>, and <code>Read</code></a>. By now, the language has evolved a lot and GHC can now derive many more classes, but it always requires switching on a <em>language extension</em>. In particular, to derive <code>Functor</code>, you need to put</p>\n\n<pre><code>{-# LANGUAGE DerivingFunctor #-}\n</code></pre>\n\n<p>at the top of your source file, or alternatively call the compiler/intepreter with</p>\n\n<pre><code>$ ghc -XDeriveFunctor\n</code></pre>\n\n<p>(I wouldn't recommend the latter; your file wouln't be &ldquo;self-sufficient&rdquo; if you do that.)</p>\n\n<p>With that extension enabled, you can simply write</p>\n\n<pre><code>data List x = Hol | Hoofd x (List x)\n        deriving (Show, Eq, Ord, Functor)\n</code></pre></li>\n<li><p>Write the instance yourself. That's what you've done in your code snippet, which has nothing to do with <code>deriving</code>. Your implementation is faulty, which is something you might well ask a question about, but then you should include the information what's currently going wrong.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 107, "user_id": 7795056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73027687e2c21e51c06f4029fccffe68?s=128&d=identicon&r=PG&f=1", "display_name": "Nightfall", "link": "https://stackoverflow.com/users/7795056/nightfall"}, "is_accepted": false, "score": 0, "last_activity_date": 1518890510, "creation_date": 1518890510, "answer_id": 48844292, "question_id": 48809736, "link": "https://stackoverflow.com/questions/48809736/recursive-functor-instance-in-haskell/48844292#48844292", "title": "Recursive functor instance in haskell", "body": "<p>EDIT</p>\n\n<p>found the problem my datatype is recursive but mine Functor instance was not. </p>\n\n<pre><code>data List x = Hol | Hoofd x (List x)\n            deriving (Show,Eq,Ord)\n\n\ninstance Functor List where\n            fmap f Hol = Hol\n            fmap f (Hoofd x rest) = Hoofd (f x) (fmap f rest)\n</code></pre>\n\n<p>Now it works, if there is another element which needs to be processed it will be send back to the instance until there is noting to process</p>\n"}], "owner": {"reputation": 107, "user_id": 7795056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73027687e2c21e51c06f4029fccffe68?s=128&d=identicon&r=PG&f=1", "display_name": "Nightfall", "link": "https://stackoverflow.com/users/7795056/nightfall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "accepted_answer_id": 48810053, "answer_count": 2, "score": 2, "last_activity_date": 1518890510, "creation_date": 1518705370, "last_edit_date": 1518705541, "question_id": 48809736, "link": "https://stackoverflow.com/questions/48809736/recursive-functor-instance-in-haskell", "title": "Recursive functor instance in haskell", "body": "<p>i come across a problem with haskell about recursive Functor instance.</p>\n\n<pre><code>data List x = Hol | Hoofd x (List x)\n            deriving (Show,Eq,Ord)\ninstance Functor List where \n        fmap f (Hoofd x (Hoofd x)) = Hoofd (f x) Hoofd(f x)\n        fmap f Hol               = Hol     \n        fmap f Hoofd x (Hol)     = Hoofd (f x)  \n</code></pre>\n\n<p>I made a datatype List in which i need to inplement the Functor Fmap instance, i tried to use in the datatype deriving (Functor) but i gives me back an error with: can't derive Functor must use DeriveFunctor which i also did not understand...</p>\n\n<p>please help </p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1518708499, "post_id": 48809109, "comment_id": 84624848, "body": "Stackoverflow doesn&#39;t have &quot;threads&quot;; It has Questions and Answers. Your current question doesn&#39;t fit the format for questions, and this doesn&#39;t fit the format for an answer. For now this isn&#39;t a problem (for you) since your current problem is resolved, but going forward I recommend you check out the Help Center and other questions and answers on this website to get a feeling for how to write useful questions and answers."}, {"owner": {"reputation": 1641, "user_id": 1101913, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uJp8V.jpg?s=128&g=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/1101913/uranus"}, "edited": false, "score": 0, "creation_date": 1603934912, "post_id": 48809109, "comment_id": 114196326, "body": "This question was useful for me. I am following the same tutorial (Real World Haskell) and encountered this error. Google returns this page at the top of a list if I put the error message in the search bar. And the solution works. I only suggest @Madderote to add an example to the answer, to make it clear that there is no need to include the SimpleJSON.o object file in the command line since the SimpleJSON module already imported in the source file."}], "tags": [], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "is_accepted": false, "score": 2, "last_activity_date": 1518703333, "creation_date": 1518703333, "answer_id": 48809109, "question_id": 48808945, "link": "https://stackoverflow.com/questions/48808945/ghc-haskell-duplicate-symbols-for-architecture-x86-64/48809109#48809109", "title": "GHC Haskell duplicate symbols for architecture x86_64", "body": "<p>Thread can be closed: if compiled with omitting the object file it seems to be OK. Verified this and seems to be a difference in versions of GHC</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "closed_date": 1519678452, "answer_count": 1, "score": 2, "last_activity_date": 1518703333, "creation_date": 1518702859, "question_id": 48808945, "link": "https://stackoverflow.com/questions/48808945/ghc-haskell-duplicate-symbols-for-architecture-x86-64", "closed_reason": "Needs details or clarity", "title": "GHC Haskell duplicate symbols for architecture x86_64", "body": "<p>If I follow an example in Real World Haskell (JSON example) and I first omit the mistake of the brackets in the module, when I compile I still het the following error</p>\n\n<blockquote>\n  <p>ld: 38 duplicate symbols for architecture x86_64 clang: error: linker\n  command failed with exit code 1 (use -v to see invocation) <code>gcc'\n  failed in phase</code>Linker'. (Exit code: 1)</p>\n</blockquote>\n\n<p>Anybody any idea what that is and how to resolve? Any one had this problem in the Real World Haskell tut as well?</p>\n"}, {"tags": ["regex", "haskell", "applicative", "parser-combinators"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "edited": false, "score": 0, "creation_date": 1518704247, "post_id": 48805257, "comment_id": 84621911, "body": "Exactly the kind of explanation I was looking for! Thank you so much!"}, {"owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "edited": false, "score": 0, "creation_date": 1518742145, "post_id": 48805257, "comment_id": 84641054, "body": "The above explanation is great, but I am still unsure about how to use this with the <code>replace</code> function. It seems it replaces the matched value with the return value of the regex. If I wanted to replace the matched comment with the number of newlines in the comment, do you have a ny idea how that would work? It doesn&#39;t seem like &lt;* or &lt;$ fits."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "edited": false, "score": 1, "creation_date": 1518743685, "post_id": 48805257, "comment_id": 84641424, "body": "@20XX Ah, (not familiar with this library) but I think it&#39;d something like <code>newlineCount . concat &lt;$&gt; sequenceA ...</code> where <code>newlineCount s = &quot;&#47;*&quot; ++ show (length (lines s)) ++ &quot;*&#47;&quot;</code>"}, {"owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "edited": false, "score": 1, "creation_date": 1518765494, "post_id": 48805257, "comment_id": 84646906, "body": "The composition was the way to go! Ended up using <code>newlineCount s = take (length (lines s)) (repeat &#39;\\n&#39;)</code>. Thanks again!"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1518729625, "last_edit_date": 1518729625, "creation_date": 1518691396, "answer_id": 48805257, "question_id": 48803489, "link": "https://stackoverflow.com/questions/48803489/text-regex-applicative-multiline-comments/48805257#48805257", "title": "Text.Regex.Applicative - Multiline Comments", "body": "<p>You are mixing up the applicative idioms.   It's either</p>\n\n<pre><code>f &lt;$&gt; x &lt;*&gt; y &lt;*&gt; z\n  ^^^\n</code></pre>\n\n<p>or</p>\n\n<pre><code>pure f &lt;*&gt; x &lt;*&gt; y &lt;*&gt; z\n       ^^^\n</code></pre>\n\n<p>The mixture you have chosen</p>\n\n<pre><code>pure f &lt;$&gt; x &lt;*&gt; y &lt;*&gt; z\n</code></pre>\n\n<p>is misleading.  Because </p>\n\n<pre><code>(&lt;$&gt;) :: (Functor f) =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>takes a function as its left argument, <code>pure f</code> is being interpreted in the <code>(-&gt;) r</code> applicative, in which <code>pure = const</code>.  So you get</p>\n\n<pre><code>const (++) &lt;$&gt; string \"/*\" &lt;*&gt; many anySym &lt;*&gt; string \"/*\"\n</code></pre>\n\n<p>and now we can hopefully see why the first string is ignored.</p>\n\n<p>You can't apply <code>(++)</code> to three arguments, which is why the other forms don't compile.  What you really need, I think, is</p>\n\n<pre><code>sequenceA :: (Applicative f) =&gt; [f a] -&gt; f [a]\n</code></pre>\n\n<p>which turns a list* of parsers in to a parser that gives a list, and then <code>concat</code> the result.  </p>\n\n<pre><code>regex = concat &lt;$&gt; sequenceA [string \"/*\", many anySym, string \"*/\"]\n</code></pre>\n\n<hr>\n\n<p><sup>*</sup>Actually <code>sequenceA</code> is more general, having type <code>(Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)</code>, but I didn't want to get too far in the clouds for this answer.</p>\n"}], "owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 48805257, "answer_count": 1, "score": 3, "last_activity_date": 1518729625, "creation_date": 1518685834, "question_id": 48803489, "link": "https://stackoverflow.com/questions/48803489/text-regex-applicative-multiline-comments", "title": "Text.Regex.Applicative - Multiline Comments", "body": "<p>I can't figure out the correct way to use the Haskell <code>regex-applicative</code> package to perform a replacement on multiline comments using the <code>replace</code> function. First, I'm trying to get <code>match</code> to return the correct string as a test:</p>\n\n<pre><code>regex = pure (++) &lt;$&gt; string \"/*\" &lt;*&gt; many (anySym) &lt;*&gt; string \"*/\"\nmatch regex \"/* hello world */\"\n</code></pre>\n\n<p>Which returns <code>hello world */</code>. I don't understand why the first matching section is cut off. Any ideas?</p>\n"}, {"tags": ["haskell", "filter"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1518681054, "post_id": 48801614, "comment_id": 84607037, "body": "What did you try?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1518682508, "post_id": 48801614, "comment_id": 84607774, "body": "<code>myFun = nubBy $ \\(x1, y1) (x2, y2) -&gt; x1 == y2 &amp;&amp; y1 == x2</code>"}, {"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518683321, "post_id": 48801614, "comment_id": 84608218, "body": "Great, I wish I can understand more  lambda expression"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1518689457, "post_id": 48801614, "comment_id": 84611883, "body": "Also possible: <code>map head $ groupBy (\\(x1, y1) (x2, y2) -&gt; x1 == y2 &amp;&amp; x2 == y1) xs</code>"}], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518683897, "post_id": 48802959, "comment_id": 84608524, "body": "@Alexis King answer in the comment section do the job, but thanks for your effort, I&#39;ll try this one too"}], "tags": [], "owner": {"reputation": 149, "user_id": 8603461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89dc7ad592a3b25b3a7750501fa18a31?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik Fleischmann", "link": "https://stackoverflow.com/users/8603461/dominik-fleischmann"}, "is_accepted": true, "score": 3, "last_activity_date": 1518683938, "last_edit_date": 1518683938, "creation_date": 1518683755, "answer_id": 48802959, "question_id": 48801614, "link": "https://stackoverflow.com/questions/48801614/haskell-filter-a-list-of-tuples-with-condition/48802959#48802959", "title": "Haskell: Filter a list of tuples with condition", "body": "<p>After some trying I came up with this:</p>\n\n<pre><code>myFun::Ord a =&gt; [(a,a)] -&gt; [(a,a)]\nmyFun ls = auxfun [] ls\n\nauxfun:: Eq a =&gt; [(a,a)] -&gt; [(a,a)] -&gt; [(a,a)]\nauxfun [] [] = []\nauxfun [] (l:ls) = auxfun [l] ls\nauxfun ls [] = ls\nauxfun ls1 ((x,y):ls2)\n    |(y,x) `elem` ls1 = auxfun ls1 ls2\n    |otherwise = auxfun ((x,y):ls1) ls2\n</code></pre>\n\n<p>This will return you [(13,14),(13,15),(11,12),(10,11)] in your test case, in case the order matters you can just reverse it. </p>\n\n<p>This solution is without using any libraries, else you can use a nubBy like another person said.</p>\n"}, {"tags": [], "owner": {"reputation": 595, "user_id": 6583529, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ys6ljqruSZ4/AAAAAAAAAAI/AAAAAAAAAEc/_P2oOaMHOSY/photo.jpg?sz=128", "display_name": "Chai", "link": "https://stackoverflow.com/users/6583529/chai"}, "is_accepted": false, "score": 3, "last_activity_date": 1518702115, "creation_date": 1518702115, "answer_id": 48808694, "question_id": 48801614, "link": "https://stackoverflow.com/questions/48801614/haskell-filter-a-list-of-tuples-with-condition/48808694#48808694", "title": "Haskell: Filter a list of tuples with condition", "body": "<p>I see it has been answered already, but since haskell is so much fun and there are always more possible solutions I'll add one that I found:</p>\n\n<pre><code>foldr (\\x y -&gt; if x == rev (head) y then (x:tail y) else x:y) [rev $ last xs] xs where\n  rev (a,b) = (b,a)\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 0, "accepted_answer_id": 48802959, "answer_count": 2, "score": 1, "last_activity_date": 1518702115, "creation_date": 1518678347, "last_edit_date": 1518678860, "question_id": 48801614, "link": "https://stackoverflow.com/questions/48801614/haskell-filter-a-list-of-tuples-with-condition", "title": "Haskell: Filter a list of tuples with condition", "body": "<p>I have a list of tuples on which I want to apply certain condition. Il looks simple but I'm stuck with this. <strong>The list of tuples is all ready generated</strong></p>\n\n<p>eg : <code>[(10,11),(11,10),(11,12),(12,11),(13,15),(13,14)]</code> </p>\n\n<p>I want to return a list of the same tuples but when a tuple (x1,y1) and (x2,y2) where x1 == y2  and y1 = x2  and  belongs to the list only the (x1,y1) one is returned</p>\n\n<p><strong>My function header</strong></p>\n\n<pre><code>myFun :: Ord a =&gt; [(a,a)] -&gt; [(a,a)]\n    myFun = ....\n</code></pre>\n\n<p>And the expected result should be like this(from the same list)</p>\n\n<pre><code>[(10,11),(11,12),(13,15),(13,14)]\n</code></pre>\n\n<p>Any indications, ideas or hints are welcomed.</p>\n"}, {"tags": ["haskell", "vector", "state", "mutable"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1518673700, "creation_date": 1518673700, "answer_id": 48800666, "question_id": 48799997, "link": "https://stackoverflow.com/questions/48799997/how-to-mutate-an-stvector/48800666#48800666", "title": "How to mutate an STVector?", "body": "<p>You should be fine to write:</p>\n\n<pre><code>verboseCopy :: Vector Int\nverboseCopy = runST $ do v &lt;- thaw x\n                         sort v\n                         freeze v\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; verboseCopy\n[1,2,4]\n&gt;\n</code></pre>\n\n<p>The <code>sort v</code> performs the sort as a side effect on the mutable vector <code>v</code>, so there's no need to \"save\" or \"capture\" the sort result, if that's what you were worried about.</p>\n\n<p>You don't need to explicitly type <code>v</code>.  Haskell will infer it to be a mutable vector and will treat it appropriately as an <code>IOVector</code> or <code>STVector</code> depending on whether you are using it within the IO or ST monad.</p>\n\n<p>For your information, the reason you're getting the error is that the type you're supplying is for <code>v</code>, but you've applied it to <code>thaw x</code> which has a more complex type.  If you write:</p>\n\n<pre><code>verboseCopy :: Vector Int\nverboseCopy = runST $ do v &lt;- thaw x :: ST s (STVector s Int)\n                         sort v\n                         freeze v\n</code></pre>\n\n<p>then it'll type check.  However, again, this is unnecessary and won't change the behavior at all.  Haskell has already figured out this type for you.</p>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 48800666, "answer_count": 1, "score": 4, "last_activity_date": 1518673700, "creation_date": 1518669206, "question_id": 48799997, "link": "https://stackoverflow.com/questions/48799997/how-to-mutate-an-stvector", "title": "How to mutate an STVector?", "body": "<p><code>MVector</code> comes in two flavors, <code>IOVector</code> and <code>STVector</code>. I want to write some functions that use <code>STVector</code>, so that they can be called from pure code despite using the fast mutable-vector algorithms in <code>Data.Vector.Algorithms</code>.</p>\n\n<p>With the help of <a href=\"https://stackoverflow.com/questions/23579959/how-to-put-mutable-vector-into-state-monad\">a related thread</a>, I've gotten partway there: I can stick an immutable <code>Vector</code> into a mutable <code>ST</code> context:</p>\n\n<pre><code>import Control.Monad.ST\nimport Data.Vector\nimport Data.Vector.Algorithms.Intro (sort)\n\nx = fromList [1,4,2] :: Vector Int\n\nverboseCopy :: Vector Int\nverboseCopy = runST $ do v &lt;- thaw x\n                         freeze v\n</code></pre>\n\n<p>I just need to run <code>sort</code> between the thaw and the freeze.</p>\n\n<p>Perhaps surprisingly, I did not have to <code>import Data.Vector.Mutable</code>, which is where <code>STVector</code> is defined. Maybe I should use a type signature to specify that I want <code>thaw</code> to produce an <code>STVector</code>, but I don't know how: If I change the <code>thaw</code> line to this:</p>\n\n<pre><code>v &lt;- thaw x :: Data.Vector.Mutable.STVector s Int\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018MVector\n                                  (primitive-0.6.3.0:Control.Monad.Primitive.PrimState (ST s))\n                                  Int\u2019\n              with actual type \u2018Int\u2019\n\u2022 In the first argument of \u2018freeze\u2019, namely \u2018v\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1518655220, "post_id": 48798498, "comment_id": 84599568, "body": "It is universally quantified. The signature could be alternatively written <code>resolution :: forall p. p a -&gt; Integer</code>. It means the caller of <code>resolution</code> can pick any <code>p</code> they wish, as long as <code>a</code> has a <code>HasResolution</code> instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1518656012, "post_id": 48798498, "comment_id": 84599806, "body": "<code>p</code> is what&#39;s often called a proxy type. The argument to <code>resolution</code> serves only to fix <code>a</code> to a particular type, indicating which <code>HasResolution</code> instance you want. The old-fashioned way to do this is to just take an <code>a</code>, but using a proxy is much clearer once you understand the idiom. <code>p</code> will often, but not always, be <code>Data.Proxy.Proxy</code>, an extremely boring type: <code>data Proxy a = Proxy</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "edited": false, "score": 0, "creation_date": 1518657657, "post_id": 48798638, "comment_id": 84600227, "body": "Thanks, @HTNW.  This is an element of the language I had not seen before and its history is interesting, too."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518829753, "post_id": 48798638, "comment_id": 84678717, "body": "I think it&#39;s worth a small note that there is a second advantage to using a type variable for the proxy type - it prevents pattern matching. You can still pattern match on <code>Proxy</code>, even if it&#39;s a bit silly. But there&#39;s no pattern at all that can be used on a polymorphic type. Given this, the user of the code can look at the type and determine immediately that the argument is only be used to pass a type - it can&#39;t do anything else."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1547416601, "post_id": 48798638, "comment_id": 95176112, "body": "@Carl I don&#39;t think that makes much of a difference. You <i>still</i> can&#39;t pass <code>undefined</code> as argument for the polymorphic version, because <code>seq</code> (or, as I sometimes call it, pattern matching without the pattern matching) can still ruin your day. Granted, using <code>seq</code> on such an argument is absurd, but...."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 13, "last_activity_date": 1537229394, "last_edit_date": 1537229394, "creation_date": 1518656214, "answer_id": 48798638, "question_id": 48798498, "link": "https://stackoverflow.com/questions/48798498/hasresolution-typeclass/48798638#48798638", "title": "HasResolution typeclass", "body": "<p>It's just a proxy.</p>\n\n<p>If you had</p>\n\n<pre><code>class HasResolution a where\n  resolution :: Integer\n</code></pre>\n\n<p>you'd get yelled at because there is no way for the compiler to ever infer <em>which</em> instance of <code>HasResolution</code> you want when you call <code>resolution</code>. Specifically, <code>resolution :: HasResolution a =&gt; Integer</code>, where <code>a</code> appears on the left but not on the right, so you can never infer <code>a</code>.</p>\n\n<p>So, one solution was</p>\n\n<pre><code>class HasResolution a where\n  resolution :: a -&gt; Integer\n</code></pre>\n\n<p>and <code>resolution</code>'s documentation would say that it is not meant to inspect the <code>a</code>; it is just meant to let the compiler figure out which instance to pick. You'd use it as <code>resolution (undefined :: a)</code>. Then, another solution emerged:</p>\n\n<pre><code>data Proxy a = Proxy\n\nclass HasResolution a where\n  resolution :: Proxy a -&gt; Integer\n</code></pre>\n\n<p><code>Proxy</code> gives no information to <code>resolution</code>; it exists, again, only for the compiler to infer what <code>a</code> is. It's better than the original in that <code>resolution</code> <em>really</em> can't inspect its argument, so the <code>Integer</code> is really associated with the type and not with the argument to <code>resolution</code>. It's slightly worse (or better, depending on who you ask) in that usage is the more verbose <code>resolution (Proxy :: Proxy a)</code> (you can't just use <code>undefined</code> because the implementation may pattern match on <code>Proxy</code>).</p>\n\n<p>This evolved into</p>\n\n<pre><code>class HasResolution a where\n  resolution :: p a -&gt; Integer\n</code></pre>\n\n<p>This means that you aren't tied down to just <code>Proxy</code>, and it means that if you have, e.g., a <code>[a]</code> lying in scope, you can pass it to <code>resolution</code> without incurring massive verbosity, while maintaining compatibility with code that just used <code>Proxy</code>. Again, <code>resolution</code>'s first argument is for the compiler's use only. It means nothing to the actual implementation. You simply use it to select the instance of <code>HasResolution</code> you want.</p>\n\n<p><code>Proxy</code> eventually became so common that <code>GHC.Exts</code> got a new member: <a href=\"https://hackage.haskell.org/package/base/docs/GHC-Exts.html#t:Proxy-35-\" rel=\"nofollow noreferrer\"><code>Proxy#</code></a>. <code>Proxy#</code> has no runtime representation, so it incurs no performance penalty, unlike <code>Proxy</code> (or the above polymorphic <code>p</code> trick). <code>Proxy#</code>, however, suffers from the fact that its kind is <code>forall k. k -&gt; TYPE (TupleRep '[])</code>. By not living in <code>*</code> like all the other \"well-behaved\" types, it cannot participate in the polymorphic <code>p</code> trick.</p>\n\n<pre><code>class HasResolution a where\n  resolution :: Proxy# a -&gt; Integer\n</code></pre>\n\n<p>The first solution is rather dated, though you see examples sometimes. The second and third are rather common, and the fourth was superseded pretty quickly by the most recent solution, which is to enable <code>-XTypeApplications -XAllowAmbiguousTypes</code> and just have</p>\n\n<pre><code>class HasResolution a where\n  resolution :: Integer\n</code></pre>\n\n<p>again. <code>-XAllowAmbiguousTypes</code> staves off the error and <code>-XTypeApplications</code> lets you specify <code>a</code> at the call site as <code>resolution @a</code>. This can't be used in code that needs to be a certain degree of backwards compatible, but you see it more in libraries that require new GHC anyway and can afford to not have compatibility.</p>\n"}], "owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 48798638, "answer_count": 1, "score": 7, "last_activity_date": 1537229394, "creation_date": 1518655062, "question_id": 48798498, "link": "https://stackoverflow.com/questions/48798498/hasresolution-typeclass", "title": "HasResolution typeclass", "body": "<p>I just looked up the <code>HasResolution</code> <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Fixed.html#t:HasResolution\" rel=\"noreferrer\">typeclass</a> and it has a single method, <code>resolution</code> that is declared as follows:</p>\n\n<pre><code>class HasResolution a where\n   ...\n   resolution :: p a -&gt; Integer\n</code></pre>\n\n<p>I don't understand the <code>p</code> in the above declaration.  Where does it come from and what does it mean?</p>\n"}, {"tags": ["haskell", "functor", "maybe"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 9, "last_activity_date": 1518655068, "creation_date": 1518655068, "answer_id": 48798502, "question_id": 48798384, "link": "https://stackoverflow.com/questions/48798384/operate-on-a-list-of-maybe-values/48798502#48798502", "title": "Operate on a list of Maybe values", "body": "<p>A straightforward solution is adding another <code>fmap</code> to get through the <code>Maybe</code> layer:</p>\n\n<pre><code>GHCi&gt; fmap (* 2) &lt;$&gt; [Just 1, Nothing, Just 3]\n[Just 2,Nothing,Just 6]\n</code></pre>\n\n<p>Alternatively, that can be expressed using <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\"><code>Compose</code></a>, which allows handling the two functor layers as one:</p>\n\n<pre><code>GHCi&gt; import Data.Functor.Compose\nGHCi&gt; (* 2) &lt;$&gt; Compose [Just 1, Nothing, Just 3]\nCompose [Just 2,Nothing,Just 6]\nGHCi&gt; getCompose $ (* 2) &lt;$&gt; Compose [Just 1, Nothing, Just 3]\n[Just 2,Nothing,Just 6]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1518660262, "post_id": 48798513, "comment_id": 84600805, "body": "Sure you can, the syntax is <code>((* 2) &lt;$&gt;) &lt;$&gt; [Just 1, Nothing, Just 3]</code>. Only do this if you like being deliberately obtuse."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1518655162, "creation_date": 1518655162, "answer_id": 48798513, "question_id": 48798384, "link": "https://stackoverflow.com/questions/48798384/operate-on-a-list-of-maybe-values/48798513#48798513", "title": "Operate on a list of Maybe values", "body": "<p>You need to map twice: once to get inside the list, second time to get inside the maybe. The operator <code>&lt;$&gt;</code> only maps once, and you can't use the same operator twice, so you have to add a call to <code>fmap</code>:</p>\n\n<pre><code>fmap (* 2) &lt;$&gt; [Just 1, Nothing, Just 3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7404, "user_id": 491497, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e4aab95d9512cd6cd431b60fe00d974c?s=128&d=identicon&r=PG", "display_name": "Sagi", "link": "https://stackoverflow.com/users/491497/sagi"}, "is_accepted": false, "score": 0, "last_activity_date": 1543160776, "creation_date": 1543160776, "answer_id": 53469150, "question_id": 48798384, "link": "https://stackoverflow.com/questions/48798384/operate-on-a-list-of-maybe-values/53469150#53469150", "title": "Operate on a list of Maybe values", "body": "<p>You can compose 2 <code>fmap</code> functions:</p>\n\n<pre><code>(fmap . fmap) (*2) [Just 1, Nothing, Just 3]\n</code></pre>\n\n<p>The first will be the fmap of the list, the second is the fmap of the maybe.</p>\n"}], "owner": {"reputation": 443, "user_id": 7614169, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/19256e5028714a68659cd2e32780c144?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7614169/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 1, "accepted_answer_id": 48798513, "answer_count": 3, "score": 2, "last_activity_date": 1543160776, "creation_date": 1518654342, "last_edit_date": 1518655124, "question_id": 48798384, "link": "https://stackoverflow.com/questions/48798384/operate-on-a-list-of-maybe-values", "title": "Operate on a list of Maybe values", "body": "<p>I can multiply a list per 2:</p>\n\n<pre><code>(* 2) &lt;$&gt; [1, 2, 3]\n</code></pre>\n\n<p>But I want multiply the elements which are Just:</p>\n\n<pre><code>(* 2) &lt;$&gt; [Just 1, Nothing, Just 3]\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n<pre><code>* Non type-variable argument in the constraint: Num (Maybe a)\n  (Use FlexibleContexts to permit this)\n* When checking the inferred type\n    it :: forall a. (Num (Maybe a), Num a) =&gt; [Maybe a] Prelude Data.List \n</code></pre>\n</blockquote>\n\n<p>Another try:</p>\n\n<pre><code>fmap (* 2) [Just 1, Nothing, Just 3]\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n<pre><code>* Non type-variable argument in the constraint: Num (Maybe a)\n  (Use FlexibleContexts to permit this)\n* When checking the inferred type\n    it :: forall a. (Num (Maybe a), Num a) =&gt; [Maybe a]\n</code></pre>\n</blockquote>\n\n<p>I have tried more things: map2, fmap2, map (*2) map, etc.</p>\n"}]